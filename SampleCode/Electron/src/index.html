<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ä¼šè®®ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹</title>
  </head>
  <body>
    <h1>ğŸ’– ä¼šè®®ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹</h1>
    <div>
      <label>appKeyï¼š</label>
      <input id="appKey" type="text" value="" />
      <button id="initialize">åˆå§‹åŒ–</button>
      <div id="initializeRes">æœªåˆå§‹åŒ–</div>
    </div>
    <div>
      <label>è´¦å·ï¼š</label>
      <input id="userUuid" type="text" value="" />
      <label>å¯†ç ï¼š</label>
      <input id="password" type="text" value="" />
      <button id="login">ç™»å½•</button>
      <div id="loginRes">æœªç™»å½•</div>
    </div>
    <div>
      <label>æ˜µç§°ï¼š</label>
      <input id="displayName" type="text" value="æœ€æ£’çš„äºº" />
      <button id="startMeeting">åˆ›å»ºä¼šè®®</button>
    </div>
  </body>
  <script>
    let isInitialize = false
    let isLogin = false
    document
      .getElementById('initialize')
      .addEventListener('click', function () {
        const appKey = document.getElementById('appKey').value
        if (!appKey) {
          alert('appKey å’Œ serverUrl ä¸èƒ½ä¸ºç©º')
          return
        }
        window.ipcRenderer
          .invoke('initialize', {
            appKey,
          })
          .then((result) => {
            if (result.code === 0) {
              isInitialize = true
              document.getElementById('initializeRes').innerText = 'åˆå§‹åŒ–æˆåŠŸ'
            }
          })
      })

    document.getElementById('login').addEventListener('click', function () {
      if (!isInitialize) {
        alert('è¯·å…ˆåˆå§‹åŒ–')
        return
      }
      const userUuid = document.getElementById('userUuid').value
      const password = document.getElementById('password').value
      if (!userUuid || !password) {
        alert('userUuid å’Œ password ä¸èƒ½ä¸ºç©º')
        return
      }
      window.ipcRenderer
        .invoke('loginByPassword', {
          userUuid,
          password,
        })
        .then((result) => {
          if (result.code === 0) {
            isLogin = true
            document.getElementById('loginRes').innerText = JSON.stringify(
              result.data
            )
          } else {
            document.getElementById('loginRes').innerText = result.message
          }
        })
    })

    document
      .getElementById('startMeeting')
      .addEventListener('click', function () {
        if (!isInitialize) {
          alert('è¯·å…ˆåˆå§‹åŒ–')
          return
        }
        if (!isLogin) {
          alert('ç™»å½•åæ‰èƒ½åˆ›å»ºä¼šè®®')
          return
        }
        const displayName = document.getElementById('displayName').value
        if (!displayName) {
          alert('æ˜µç§°ä¸èƒ½ä¸ºç©º')
          return
        }
        window.ipcRenderer.invoke('startMeeting', {
          displayName,
        })
      })
  </script>
</html>
