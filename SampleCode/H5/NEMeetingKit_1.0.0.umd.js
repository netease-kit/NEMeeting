!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).NEMeetingKit=t()}(this,(function(){"use strict";function _mergeNamespaces(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}var commonjsGlobal$1="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs$1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={},getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty$6=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function shouldUseNative(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map((function(e){return t[e]}));if("0123456789"!==n.join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(e,t){for(var r,n,i=toObject(e),o=1;o<arguments.length;o++){for(var a in r=Object(arguments[o]))hasOwnProperty$6.call(r,a)&&(i[a]=r[a]);if(getOwnPropertySymbols){n=getOwnPropertySymbols(r);for(var s=0;s<n.length;s++)propIsEnumerable.call(r,n[s])&&(i[n[s]]=r[n[s]])}}return i},l$1=objectAssign,n$2="function"==typeof Symbol&&Symbol.for,p$1=n$2?Symbol.for("react.element"):60103,q$1=n$2?Symbol.for("react.portal"):60106,r$1=n$2?Symbol.for("react.fragment"):60107,t=n$2?Symbol.for("react.strict_mode"):60108,u$1=n$2?Symbol.for("react.profiler"):60114,v$1=n$2?Symbol.for("react.provider"):60109,w$1=n$2?Symbol.for("react.context"):60110,x=n$2?Symbol.for("react.forward_ref"):60112,y$1=n$2?Symbol.for("react.suspense"):60113,z=n$2?Symbol.for("react.memo"):60115,A=n$2?Symbol.for("react.lazy"):60116,B="function"==typeof Symbol&&Symbol.iterator;function C$1(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E$1={};function F$1(e,t,r){this.props=e,this.context=t,this.refs=E$1,this.updater=r||D}function G$1(){}function H$1(e,t,r){this.props=e,this.context=t,this.refs=E$1,this.updater=r||D}F$1.prototype.isReactComponent={},F$1.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(C$1(85));this.updater.enqueueSetState(this,e,t,"setState")},F$1.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},G$1.prototype=F$1.prototype;var I$1=H$1.prototype=new G$1;I$1.constructor=H$1,l$1(I$1,F$1.prototype),I$1.isPureReactComponent=!0;var J$1={current:null},K$1=Object.prototype.hasOwnProperty,L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(e,t,r){var n,i={},o=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)K$1.call(t,n)&&!L$1.hasOwnProperty(n)&&(i[n]=t[n]);var s=arguments.length-2;if(1===s)i.children=r;else if(1<s){for(var c=Array(s),u=0;u<s;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===i[n]&&(i[n]=s[n]);return{$$typeof:p$1,type:e,key:o,ref:a,props:i,_owner:J$1.current}}function N$1(e,t){return{$$typeof:p$1,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return"object"==typeof e&&null!==e&&e.$$typeof===p$1}function escape$1(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}var P$1=/\/+/g,Q$1=[];function R$1(e,t,r,n){if(Q$1.length){var i=Q$1.pop();return i.result=e,i.keyPrefix=t,i.func=r,i.context=n,i.count=0,i}return{result:e,keyPrefix:t,func:r,context:n,count:0}}function S$1(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>Q$1.length&&Q$1.push(e)}function T$1(e,t,r,n){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var o=!1;if(null===e)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case p$1:case q$1:o=!0}}if(o)return r(n,e,""===t?"."+U$1(e,0):t),1;if(o=0,t=""===t?".":t+":",Array.isArray(e))for(var a=0;a<e.length;a++){var s=t+U$1(i=e[a],a);o+=T$1(i,s,r,n)}else if(null===e||"object"!=typeof e?s=null:s="function"==typeof(s=B&&e[B]||e["@@iterator"])?s:null,"function"==typeof s)for(e=s.call(e),a=0;!(i=e.next()).done;)o+=T$1(i=i.value,s=t+U$1(i,a++),r,n);else if("object"===i)throw r=""+e,Error(C$1(31,"[object Object]"===r?"object with keys {"+Object.keys(e).join(", ")+"}":r,""));return o}function V$1(e,t,r){return null==e?0:T$1(e,"",t,r)}function U$1(e,t){return"object"==typeof e&&null!==e&&null!=e.key?escape$1(e.key):t.toString(36)}function W$1(e,t){e.func.call(e.context,t,e.count++)}function aa$1(e,t,r){var n=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?X$1(e,n,r,(function(e){return e})):null!=e&&(O$1(e)&&(e=N$1(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(P$1,"$&/")+"/")+r)),n.push(e))}function X$1(e,t,r,n,i){var o="";null!=r&&(o=(""+r).replace(P$1,"$&/")+"/"),V$1(e,aa$1,t=R$1(t,o,n,i)),S$1(t)}var Y$1={current:null};function Z$1(){var e=Y$1.current;if(null===e)throw Error(C$1(321));return e}var ba$1={ReactCurrentDispatcher:Y$1,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:J$1,IsSomeRendererActing:{current:!1},assign:l$1};react_production_min.Children={map:function(e,t,r){if(null==e)return e;var n=[];return X$1(e,n,null,t,r),n},forEach:function(e,t,r){if(null==e)return e;V$1(e,W$1,t=R$1(null,null,t,r)),S$1(t)},count:function(e){return V$1(e,(function(){return null}),null)},toArray:function(e){var t=[];return X$1(e,t,null,(function(e){return e})),t},only:function(e){if(!O$1(e))throw Error(C$1(143));return e}},react_production_min.Component=F$1,react_production_min.Fragment=r$1,react_production_min.Profiler=u$1,react_production_min.PureComponent=H$1,react_production_min.StrictMode=t,react_production_min.Suspense=y$1,react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ba$1,react_production_min.cloneElement=function(e,t,r){if(null==e)throw Error(C$1(267,e));var n=l$1({},e.props),i=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=J$1.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(c in t)K$1.call(t,c)&&!L$1.hasOwnProperty(c)&&(n[c]=void 0===t[c]&&void 0!==s?s[c]:t[c])}var c=arguments.length-2;if(1===c)n.children=r;else if(1<c){s=Array(c);for(var u=0;u<c;u++)s[u]=arguments[u+2];n.children=s}return{$$typeof:p$1,type:e.type,key:i,ref:o,props:n,_owner:a}},react_production_min.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:w$1,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:v$1,_context:e},e.Consumer=e},react_production_min.createElement=M$1,react_production_min.createFactory=function(e){var t=M$1.bind(null,e);return t.type=e,t},react_production_min.createRef=function(){return{current:null}},react_production_min.forwardRef=function(e){return{$$typeof:x,render:e}},react_production_min.isValidElement=O$1,react_production_min.lazy=function(e){return{$$typeof:A,_ctor:e,_status:-1,_result:null}},react_production_min.memo=function(e,t){return{$$typeof:z,type:e,compare:void 0===t?null:t}},react_production_min.useCallback=function(e,t){return Z$1().useCallback(e,t)},react_production_min.useContext=function(e,t){return Z$1().useContext(e,t)},react_production_min.useDebugValue=function(){},react_production_min.useEffect=function(e,t){return Z$1().useEffect(e,t)},react_production_min.useImperativeHandle=function(e,t,r){return Z$1().useImperativeHandle(e,t,r)},react_production_min.useLayoutEffect=function(e,t){return Z$1().useLayoutEffect(e,t)},react_production_min.useMemo=function(e,t){return Z$1().useMemo(e,t)},react_production_min.useReducer=function(e,t,r){return Z$1().useReducer(e,t,r)},react_production_min.useRef=function(e){return Z$1().useRef(e)},react_production_min.useState=function(e){return Z$1().useState(e)},react_production_min.version="16.14.0",react.exports=react_production_min;var React=react.exports,f=react.exports,g=60103;if(reactJsxRuntime_production_min.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var h$1=Symbol.for;g=h$1("react.element"),reactJsxRuntime_production_min.Fragment=h$1("react.fragment")}var m$1=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n$1=Object.prototype.hasOwnProperty,p={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var n,i={},o=null,a=null;for(n in void 0!==r&&(o=""+r),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(a=t.ref),t)n$1.call(t,n)&&!p.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:g,type:e,key:o,ref:a,props:i,_owner:m$1.current}}reactJsxRuntime_production_min.jsx=q,reactJsxRuntime_production_min.jsxs=q,jsxRuntime.exports=reactJsxRuntime_production_min;var reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};!function(e){var t,r,n,i,o;if("undefined"==typeof window||"function"!=typeof MessageChannel){var a=null,s=null,c=function(){if(null!==a)try{var t=e.unstable_now();a(!0,t),a=null}catch(e){throw setTimeout(c,0),e}},u=Date.now();e.unstable_now=function(){return Date.now()-u},t=function(e){null!==a?setTimeout(t,0,e):(a=e,setTimeout(c,0))},r=function(e,t){s=setTimeout(e,t)},n=function(){clearTimeout(s)},i=function(){return!1},o=e.unstable_forceFrameRate=function(){}}else{var l=window.performance,d=window.Date,p=window.setTimeout,f=window.clearTimeout;if("undefined"!=typeof console){var h=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof h&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==typeof l&&"function"==typeof l.now)e.unstable_now=function(){return l.now()};else{var m=d.now();e.unstable_now=function(){return d.now()-m}}var g=!1,v=null,y=-1,b=5,S=0;i=function(){return e.unstable_now()>=S},o=function(){},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):b=0<e?Math.floor(1e3/e):5};var _=new MessageChannel,M=_.port2;_.port1.onmessage=function(){if(null!==v){var t=e.unstable_now();S=t+b;try{v(!0,t)?M.postMessage(null):(g=!1,v=null)}catch(e){throw M.postMessage(null),e}}else g=!1},t=function(e){v=e,g||(g=!0,M.postMessage(null))},r=function(t,r){y=p((function(){t(e.unstable_now())}),r)},n=function(){f(y),y=-1}}function T(e,t){var r=e.length;e.push(t);e:for(;;){var n=r-1>>>1,i=e[n];if(!(void 0!==i&&0<I(i,t)))break e;e[n]=t,e[r]=i,r=n}}function w(e){return void 0===(e=e[0])?null:e}function x(e){var t=e[0];if(void 0!==t){var r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,i=e.length;n<i;){var o=2*(n+1)-1,a=e[o],s=o+1,c=e[s];if(void 0!==a&&0>I(a,r))void 0!==c&&0>I(c,a)?(e[n]=c,e[s]=r,n=s):(e[n]=a,e[o]=r,n=o);else{if(!(void 0!==c&&0>I(c,r)))break e;e[n]=c,e[s]=r,n=s}}}return t}return null}function I(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}var E=[],A=[],C=1,k=null,O=3,N=!1,R=!1,P=!1;function D(e){for(var t=w(A);null!==t;){if(null===t.callback)x(A);else{if(!(t.startTime<=e))break;x(A),t.sortIndex=t.expirationTime,T(E,t)}t=w(A)}}function j(e){if(P=!1,D(e),!R)if(null!==w(E))R=!0,t(L);else{var n=w(A);null!==n&&r(j,n.startTime-e)}}function L(t,o){R=!1,P&&(P=!1,n()),N=!0;var a=O;try{for(D(o),k=w(E);null!==k&&(!(k.expirationTime>o)||t&&!i());){var s=k.callback;if(null!==s){k.callback=null,O=k.priorityLevel;var c=s(k.expirationTime<=o);o=e.unstable_now(),"function"==typeof c?k.callback=c:k===w(E)&&x(E),D(o)}else x(E);k=w(E)}if(null!==k)var u=!0;else{var l=w(A);null!==l&&r(j,l.startTime-o),u=!1}return u}finally{k=null,O=a,N=!1}}function z(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var U=o;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){R||N||(R=!0,t(L))},e.unstable_getCurrentPriorityLevel=function(){return O},e.unstable_getFirstCallbackNode=function(){return w(E)},e.unstable_next=function(e){switch(O){case 1:case 2:case 3:var t=3;break;default:t=O}var r=O;O=t;try{return e()}finally{O=r}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=U,e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=O;O=e;try{return t()}finally{O=r}},e.unstable_scheduleCallback=function(i,o,a){var s=e.unstable_now();if("object"==typeof a&&null!==a){var c=a.delay;c="number"==typeof c&&0<c?s+c:s,a="number"==typeof a.timeout?a.timeout:z(i)}else a=z(i),c=s;return i={id:C++,callback:o,priorityLevel:i,startTime:c,expirationTime:a=c+a,sortIndex:-1},c>s?(i.sortIndex=c,T(A,i),null===w(E)&&i===w(A)&&(P?n():P=!0,r(j,c-s))):(i.sortIndex=a,T(E,i),R||N||(R=!0,t(L))),i},e.unstable_shouldYield=function(){var t=e.unstable_now();D(t);var r=w(E);return r!==k&&null!==k&&null!==r&&null!==r.callback&&r.startTime<=t&&r.expirationTime<k.expirationTime||i()},e.unstable_wrapCallback=function(e){var t=O;return function(){var r=O;O=t;try{return e.apply(this,arguments)}finally{O=r}}}}(scheduler_production_min),scheduler.exports=scheduler_production_min;var aa=react.exports,n=objectAssign,r=scheduler.exports;function u(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!aa)throw Error(u(227));function ba(e,t,r,n,i,o,a,s,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(e){this.onError(e)}}var da=!1,ea=null,fa=!1,ha=null,ia={onError:function(e){da=!0,ea=e}};function ja(e,t,r,n,i,o,a,s,c){da=!1,ea=null,ba.apply(ia,arguments)}function ka(e,t,r,n,i,o,a,s,c){if(ja.apply(this,arguments),da){if(!da)throw Error(u(198));var l=ea;da=!1,ea=null,fa||(fa=!0,ha=l)}}var la=null,ma=null,na=null;function oa(e,t,r){var n=e.type||"unknown-event";e.currentTarget=na(r),ka(n,t,void 0,e),e.currentTarget=null}var pa=null,qa={};function ra(){if(pa)for(var e in qa){var t=qa[e],r=pa.indexOf(e);if(!(-1<r))throw Error(u(96,e));if(!sa[r]){if(!t.extractEvents)throw Error(u(97,e));for(var n in sa[r]=t,r=t.eventTypes){var i=void 0,o=r[n],a=t,s=n;if(ta.hasOwnProperty(s))throw Error(u(99,s));ta[s]=o;var c=o.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&ua(c[i],a,s);i=!0}else o.registrationName?(ua(o.registrationName,a,s),i=!0):i=!1;if(!i)throw Error(u(98,n,e))}}}}function ua(e,t,r){if(va[e])throw Error(u(100,e));va[e]=t,wa[e]=t.eventTypes[r].dependencies}var sa=[],ta={},va={},wa={};function xa(e){var t,r=!1;for(t in e)if(e.hasOwnProperty(t)){var n=e[t];if(!qa.hasOwnProperty(t)||qa[t]!==n){if(qa[t])throw Error(u(102,t));qa[t]=n,r=!0}}r&&ra()}var ya=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),za=null,Aa=null,Ba=null;function Ca(e){if(e=ma(e)){if("function"!=typeof za)throw Error(u(280));var t=e.stateNode;t&&(t=la(t),za(e.stateNode,e.type,t))}}function Da(e){Aa?Ba?Ba.push(e):Ba=[e]:Aa=e}function Ea(){if(Aa){var e=Aa,t=Ba;if(Ba=Aa=null,Ca(e),t)for(e=0;e<t.length;e++)Ca(t[e])}}function Fa(e,t){return e(t)}function Ga(e,t,r,n,i){return e(t,r,n,i)}function Ha(){}var Ia=Fa,Ja=!1,Ka=!1;function La(){null===Aa&&null===Ba||(Ha(),Ea())}function Ma(e,t,r){if(Ka)return e(t,r);Ka=!0;try{return Ia(e,t,r)}finally{Ka=!1,La()}}var Na=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Oa=Object.prototype.hasOwnProperty,Pa={},Qa={};function Ra(e){return!!Oa.call(Qa,e)||!Oa.call(Pa,e)&&(Na.test(e)?Qa[e]=!0:(Pa[e]=!0,!1))}function Sa(e,t,r,n){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}function Ta(e,t,r,n){if(null==t||Sa(e,t,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function v(e,t,r,n,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){C[e]=new v(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];C[t]=new v(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){C[e]=new v(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){C[e]=new v(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){C[e]=new v(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){C[e]=new v(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){C[e]=new v(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){C[e]=new v(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){C[e]=new v(e,5,!1,e.toLowerCase(),null,!1)}));var Ua=/[\-:]([a-z])/g;function Va(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(Ua,Va);C[t]=new v(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(Ua,Va);C[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(Ua,Va);C[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){C[e]=new v(e,1,!1,e.toLowerCase(),null,!1)})),C.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){C[e]=new v(e,1,!1,e.toLowerCase(),null,!0)}));var Wa=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Xa(e,t,r,n){var i=C.hasOwnProperty(t)?C[t]:null;(null!==i?0===i.type:!n&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(Ta(t,r,i,n)&&(r=null),n||null===i?Ra(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=null===r?3!==i.type&&"":r:(t=i.attributeName,n=i.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(i=i.type)||4===i&&!0===r?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}Wa.hasOwnProperty("ReactCurrentDispatcher")||(Wa.ReactCurrentDispatcher={current:null}),Wa.hasOwnProperty("ReactCurrentBatchConfig")||(Wa.ReactCurrentBatchConfig={suspense:null});var Ya=/^(.*)[\\\/]/,E="function"==typeof Symbol&&Symbol.for,Za=E?Symbol.for("react.element"):60103,$a=E?Symbol.for("react.portal"):60106,ab=E?Symbol.for("react.fragment"):60107,bb=E?Symbol.for("react.strict_mode"):60108,cb=E?Symbol.for("react.profiler"):60114,db=E?Symbol.for("react.provider"):60109,eb=E?Symbol.for("react.context"):60110,fb=E?Symbol.for("react.concurrent_mode"):60111,gb=E?Symbol.for("react.forward_ref"):60112,hb=E?Symbol.for("react.suspense"):60113,ib=E?Symbol.for("react.suspense_list"):60120,jb=E?Symbol.for("react.memo"):60115,kb=E?Symbol.for("react.lazy"):60116,lb=E?Symbol.for("react.block"):60121,mb="function"==typeof Symbol&&Symbol.iterator;function nb(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=mb&&e[mb]||e["@@iterator"])?e:null}function ob(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}function pb(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case ab:return"Fragment";case $a:return"Portal";case cb:return"Profiler";case bb:return"StrictMode";case hb:return"Suspense";case ib:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case eb:return"Context.Consumer";case db:return"Context.Provider";case gb:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case jb:return pb(e.type);case lb:return pb(e.render);case kb:if(e=1===e._status?e._result:null)return pb(e)}return null}function qb(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var r="";break e;default:var n=e._debugOwner,i=e._debugSource,o=pb(e.type);r=null,n&&(r=pb(n.type)),n=o,o="",i?o=" (at "+i.fileName.replace(Ya,"")+":"+i.lineNumber+")":r&&(o=" (created by "+r+")"),r="\n    in "+(n||"Unknown")+o}t+=r,e=e.return}while(e);return t}function rb(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function sb(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function tb(e){var t=sb(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==r&&"function"==typeof r.get&&"function"==typeof r.set){var i=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function xb(e){e._valueTracker||(e._valueTracker=tb(e))}function yb(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=sb(e)?e.checked?"true":"false":e.value),(e=n)!==r&&(t.setValue(e),!0)}function zb(e,t){var r=t.checked;return n({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function Ab(e,t){var r=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;r=rb(null!=t.value?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Bb(e,t){null!=(t=t.checked)&&Xa(e,"checked",t,!1)}function Cb(e,t){Bb(e,t);var r=rb(t.value),n=t.type;if(null!=r)"number"===n?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?Db(e,t.type,r):t.hasOwnProperty("defaultValue")&&Db(e,t.type,rb(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Eb(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function Db(e,t,r){"number"===t&&e.ownerDocument.activeElement===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}function Fb(e){var t="";return aa.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}function Gb(e,t){return e=n({children:void 0},t),(t=Fb(t.children))&&(e.children=t),e}function Hb(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+rb(r),t=null,i=0;i<e.length;i++){if(e[i].value===r)return e[i].selected=!0,void(n&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Ib(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(u(91));return n({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Jb(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(u(92));if(Array.isArray(r)){if(!(1>=r.length))throw Error(u(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:rb(r)}}function Kb(e,t){var r=rb(t.value),n=rb(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=n&&(e.defaultValue=""+n)}function Lb(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var Mb={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Nb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ob(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Nb(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Pb,Qb=(a=function(e,t){if(e.namespaceURI!==Mb.svg||"innerHTML"in e)e.innerHTML=t;else{for((Pb=Pb||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Pb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,r,n){MSApp.execUnsafeLocalFunction((function(){return a(e,t)}))}:a),a;function Rb(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}function Sb(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Tb={animationend:Sb("Animation","AnimationEnd"),animationiteration:Sb("Animation","AnimationIteration"),animationstart:Sb("Animation","AnimationStart"),transitionend:Sb("Transition","TransitionEnd")},Ub={},Vb={};function Wb(e){if(Ub[e])return Ub[e];if(!Tb[e])return e;var t,r=Tb[e];for(t in r)if(r.hasOwnProperty(t)&&t in Vb)return Ub[e]=r[t];return e}ya&&(Vb=document.createElement("div").style,"AnimationEvent"in window||(delete Tb.animationend.animation,delete Tb.animationiteration.animation,delete Tb.animationstart.animation),"TransitionEvent"in window||delete Tb.transitionend.transition);var Xb=Wb("animationend"),Yb=Wb("animationiteration"),Zb=Wb("animationstart"),$b=Wb("transitionend"),ac="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bc=new("function"==typeof WeakMap?WeakMap:Map);function cc(e){var t=bc.get(e);return void 0===t&&(t=new Map,bc.set(e,t)),t}function dc(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).effectTag)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function ec(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function fc(e){if(dc(e)!==e)throw Error(u(188))}function gc(e){var t=e.alternate;if(!t){if(null===(t=dc(e)))throw Error(u(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(n=i.return)){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return fc(i),e;if(o===n)return fc(i),t;o=o.sibling}throw Error(u(188))}if(r.return!==n.return)r=i,n=o;else{for(var a=!1,s=i.child;s;){if(s===r){a=!0,r=i,n=o;break}if(s===n){a=!0,n=i,r=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===r){a=!0,r=o,n=i;break}if(s===n){a=!0,n=o,r=i;break}s=s.sibling}if(!a)throw Error(u(189))}}if(r.alternate!==n)throw Error(u(190))}if(3!==r.tag)throw Error(u(188));return r.stateNode.current===r?e:t}function hc(e){if(!(e=gc(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function ic(e,t){if(null==t)throw Error(u(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function jc(e,t,r){Array.isArray(e)?e.forEach(t,r):e&&t.call(r,e)}var kc=null;function lc(e){if(e){var t=e._dispatchListeners,r=e._dispatchInstances;if(Array.isArray(t))for(var n=0;n<t.length&&!e.isPropagationStopped();n++)oa(e,t[n],r[n]);else t&&oa(e,t,r);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function mc(e){if(null!==e&&(kc=ic(kc,e)),e=kc,kc=null,e){if(jc(e,lc),kc)throw Error(u(95));if(fa)throw e=ha,fa=!1,ha=null,e}}function nc(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function oc(e){if(!ya)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var pc=[];function qc(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>pc.length&&pc.push(e)}function rc(e,t,r,n){if(pc.length){var i=pc.pop();return i.topLevelType=e,i.eventSystemFlags=n,i.nativeEvent=t,i.targetInst=r,i}return{topLevelType:e,eventSystemFlags:n,nativeEvent:t,targetInst:r,ancestors:[]}}function sc(e){var t=e.targetInst,r=t;do{if(!r){e.ancestors.push(r);break}var n=r;if(3===n.tag)n=n.stateNode.containerInfo;else{for(;n.return;)n=n.return;n=3!==n.tag?null:n.stateNode.containerInfo}if(!n)break;5!==(t=r.tag)&&6!==t||e.ancestors.push(r),r=tc(n)}while(r);for(r=0;r<e.ancestors.length;r++){t=e.ancestors[r];var i=nc(e.nativeEvent);n=e.topLevelType;var o=e.nativeEvent,a=e.eventSystemFlags;0===r&&(a|=64);for(var s=null,c=0;c<sa.length;c++){var u=sa[c];u&&(u=u.extractEvents(n,t,o,i,a))&&(s=ic(s,u))}mc(s)}}function uc(e,t,r){if(!r.has(e)){switch(e){case"scroll":vc(t,"scroll",!0);break;case"focus":case"blur":vc(t,"focus",!0),vc(t,"blur",!0),r.set("blur",null),r.set("focus",null);break;case"cancel":case"close":oc(e)&&vc(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===ac.indexOf(e)&&F(e,t)}r.set(e,null)}}var wc,xc,yc,zc=!1,Ac=[],Bc=null,Cc=null,Dc=null,Ec=new Map,Fc=new Map,Gc=[],Hc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Ic="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Jc(e,t){var r=cc(t);Hc.forEach((function(e){uc(e,t,r)})),Ic.forEach((function(e){uc(e,t,r)}))}function Kc(e,t,r,n,i){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|r,nativeEvent:i,container:n}}function Lc(e,t){switch(e){case"focus":case"blur":Bc=null;break;case"dragenter":case"dragleave":Cc=null;break;case"mouseover":case"mouseout":Dc=null;break;case"pointerover":case"pointerout":Ec.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fc.delete(t.pointerId)}}function Mc(e,t,r,n,i,o){return null===e||e.nativeEvent!==o?(e=Kc(t,r,n,i,o),null!==t&&(null!==(t=Nc(t))&&xc(t)),e):(e.eventSystemFlags|=n,e)}function Oc(e,t,r,n,i){switch(t){case"focus":return Bc=Mc(Bc,e,t,r,n,i),!0;case"dragenter":return Cc=Mc(Cc,e,t,r,n,i),!0;case"mouseover":return Dc=Mc(Dc,e,t,r,n,i),!0;case"pointerover":var o=i.pointerId;return Ec.set(o,Mc(Ec.get(o)||null,e,t,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,Fc.set(o,Mc(Fc.get(o)||null,e,t,r,n,i)),!0}return!1}function Pc(e){var t=tc(e.target);if(null!==t){var n=dc(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=ec(n)))return e.blockedOn=t,void r.unstable_runWithPriority(e.priority,(function(){yc(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Qc(e){if(null!==e.blockedOn)return!1;var t=Rc(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var r=Nc(t);return null!==r&&xc(r),e.blockedOn=t,!1}return!0}function Sc(e,t,r){Qc(e)&&r.delete(t)}function Tc(){for(zc=!1;0<Ac.length;){var e=Ac[0];if(null!==e.blockedOn){null!==(e=Nc(e.blockedOn))&&wc(e);break}var t=Rc(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:Ac.shift()}null!==Bc&&Qc(Bc)&&(Bc=null),null!==Cc&&Qc(Cc)&&(Cc=null),null!==Dc&&Qc(Dc)&&(Dc=null),Ec.forEach(Sc),Fc.forEach(Sc)}function Uc(e,t){e.blockedOn===t&&(e.blockedOn=null,zc||(zc=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Tc)))}function Vc(e){function t(t){return Uc(t,e)}if(0<Ac.length){Uc(Ac[0],e);for(var r=1;r<Ac.length;r++){var n=Ac[r];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Bc&&Uc(Bc,e),null!==Cc&&Uc(Cc,e),null!==Dc&&Uc(Dc,e),Ec.forEach(t),Fc.forEach(t),r=0;r<Gc.length;r++)(n=Gc[r]).blockedOn===e&&(n.blockedOn=null);for(;0<Gc.length&&null===(r=Gc[0]).blockedOn;)Pc(r),null===r.blockedOn&&Gc.shift()}var Wc={},Yc=new Map,Zc=new Map,$c=["abort","abort",Xb,"animationEnd",Yb,"animationIteration",Zb,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",$b,"transitionEnd","waiting","waiting"];function ad(e,t){for(var r=0;r<e.length;r+=2){var n=e[r],i=e[r+1],o="on"+(i[0].toUpperCase()+i.slice(1));o={phasedRegistrationNames:{bubbled:o,captured:o+"Capture"},dependencies:[n],eventPriority:t},Zc.set(n,t),Yc.set(n,o),Wc[i]=o}}ad("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),ad("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),ad($c,2);for(var bd="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),cd=0;cd<bd.length;cd++)Zc.set(bd[cd],0);var dd=r.unstable_UserBlockingPriority,ed=r.unstable_runWithPriority,fd=!0;function F(e,t){vc(t,e,!1)}function vc(e,t,r){var n=Zc.get(t);switch(void 0===n?2:n){case 0:n=gd.bind(null,t,1,e);break;case 1:n=hd.bind(null,t,1,e);break;default:n=id.bind(null,t,1,e)}r?e.addEventListener(t,n,!0):e.addEventListener(t,n,!1)}function gd(e,t,r,n){Ja||Ha();var i=id,o=Ja;Ja=!0;try{Ga(i,e,t,r,n)}finally{(Ja=o)||La()}}function hd(e,t,r,n){ed(dd,id.bind(null,e,t,r,n))}function id(e,t,r,n){if(fd)if(0<Ac.length&&-1<Hc.indexOf(e))e=Kc(null,e,t,r,n),Ac.push(e);else{var i=Rc(e,t,r,n);if(null===i)Lc(e,n);else if(-1<Hc.indexOf(e))e=Kc(i,e,t,r,n),Ac.push(e);else if(!Oc(i,e,t,r,n)){Lc(e,n),e=rc(e,n,null,t);try{Ma(sc,e)}finally{qc(e)}}}}function Rc(e,t,r,n){if(null!==(r=tc(r=nc(n)))){var i=dc(r);if(null===i)r=null;else{var o=i.tag;if(13===o){if(null!==(r=ec(i)))return r;r=null}else if(3===o){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;r=null}else i!==r&&(r=null)}}e=rc(e,n,r,t);try{Ma(sc,e)}finally{qc(e)}return null}var jd={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kd=["Webkit","ms","Moz","O"];function ld(e,t,r){return null==t||"boolean"==typeof t||""===t?"":r||"number"!=typeof t||0===t||jd.hasOwnProperty(e)&&jd[e]?(""+t).trim():t+"px"}function md(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var n=0===r.indexOf("--"),i=ld(r,t[r],n);"float"===r&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}Object.keys(jd).forEach((function(e){kd.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),jd[t]=jd[e]}))}));var nd=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function od(e,t){if(t){if(nd[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(u(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(u(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(u(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(u(62,""))}}function pd(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qd=Mb.html;function rd(e,t){var r=cc(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=wa[t];for(var n=0;n<t.length;n++)uc(t[n],e,r)}function sd(){}function td(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function ud(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function vd(e,t){var r,n=ud(e);for(e=0;n;){if(3===n.nodeType){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ud(n)}}function wd(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?wd(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function xd(){for(var e=window,t=td();t instanceof e.HTMLIFrameElement;){try{var r="string"==typeof t.contentWindow.location.href}catch(e){r=!1}if(!r)break;t=td((e=t.contentWindow).document)}return t}function yd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var zd="$",Ad="/$",Bd="$?",Cd="$!",Dd=null,Ed=null;function Fd(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Gd(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Hd="function"==typeof setTimeout?setTimeout:void 0,Id="function"==typeof clearTimeout?clearTimeout:void 0;function Jd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Kd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if(r===zd||r===Cd||r===Bd){if(0===t)return e;t--}else r===Ad&&t++}e=e.previousSibling}return null}var Ld=Math.random().toString(36).slice(2),Md="__reactInternalInstance$"+Ld,Nd="__reactEventHandlers$"+Ld,Od="__reactContainere$"+Ld;function tc(e){var t=e[Md];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Od]||r[Md]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=Kd(e);null!==e;){if(r=e[Md])return r;e=Kd(e)}return t}r=(e=r).parentNode}return null}function Nc(e){return!(e=e[Md]||e[Od])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Pd(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(u(33))}function Qd(e){return e[Nd]||null}function Rd(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function Sd(e,t){var r=e.stateNode;if(!r)return null;var n=la(r);if(!n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(r&&"function"!=typeof r)throw Error(u(231,t,typeof r));return r}function Td(e,t,r){(t=Sd(e,r.dispatchConfig.phasedRegistrationNames[t]))&&(r._dispatchListeners=ic(r._dispatchListeners,t),r._dispatchInstances=ic(r._dispatchInstances,e))}function Ud(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,r=[];t;)r.push(t),t=Rd(t);for(t=r.length;0<t--;)Td(r[t],"captured",e);for(t=0;t<r.length;t++)Td(r[t],"bubbled",e)}}function Vd(e,t,r){e&&r&&r.dispatchConfig.registrationName&&(t=Sd(e,r.dispatchConfig.registrationName))&&(r._dispatchListeners=ic(r._dispatchListeners,t),r._dispatchInstances=ic(r._dispatchInstances,e))}function Wd(e){e&&e.dispatchConfig.registrationName&&Vd(e._targetInst,null,e)}function Xd(e){jc(e,Ud)}var Yd=null,Zd=null,$d=null;function ae(){if($d)return $d;var e,t,r=Zd,n=r.length,i="value"in Yd?Yd.value:Yd.textContent,o=i.length;for(e=0;e<n&&r[e]===i[e];e++);var a=n-e;for(t=1;t<=a&&r[n-t]===i[o-t];t++);return $d=i.slice(e,1<t?1-t:void 0)}function be(){return!0}function ce(){return!1}function G(e,t,r,n){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=r,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(r):"target"===i?this.target=n:this[i]=r[i]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?be:ce,this.isPropagationStopped=ce,this}function ee(e,t,r,n){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,r,n),i}return new this(e,t,r,n)}function fe(e){if(!(e instanceof this))throw Error(u(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function de(e){e.eventPool=[],e.getPooled=ee,e.release=fe}n(G.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=be)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=be)},persist:function(){this.isPersistent=be},isPersistent:ce,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ce,this._dispatchInstances=this._dispatchListeners=null}}),G.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},G.extend=function(e){function t(){}function r(){return i.apply(this,arguments)}var i=this;t.prototype=i.prototype;var o=new t;return n(o,r.prototype),r.prototype=o,r.prototype.constructor=r,r.Interface=n({},i.Interface,e),r.extend=i.extend,de(r),r},de(G);var ge=G.extend({data:null}),he=G.extend({data:null}),ie=[9,13,27,32],je=ya&&"CompositionEvent"in window,ke=null;ya&&"documentMode"in document&&(ke=document.documentMode);var le=ya&&"TextEvent"in window&&!ke,me=ya&&(!je||ke&&8<ke&&11>=ke),ne=String.fromCharCode(32),oe={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},pe=!1;function qe(e,t){switch(e){case"keyup":return-1!==ie.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function re(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var se=!1;function te(e,t){switch(e){case"compositionend":return re(t);case"keypress":return 32!==t.which?null:(pe=!0,ne);case"textInput":return(e=t.data)===ne&&pe?null:e;default:return null}}function ue(e,t){if(se)return"compositionend"===e||!je&&qe(e,t)?(e=ae(),$d=Zd=Yd=null,se=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return me&&"ko"!==t.locale?null:t.data}}var ve={eventTypes:oe,extractEvents:function(e,t,r,n){var i;if(je)e:{switch(e){case"compositionstart":var o=oe.compositionStart;break e;case"compositionend":o=oe.compositionEnd;break e;case"compositionupdate":o=oe.compositionUpdate;break e}o=void 0}else se?qe(e,r)&&(o=oe.compositionEnd):"keydown"===e&&229===r.keyCode&&(o=oe.compositionStart);return o?(me&&"ko"!==r.locale&&(se||o!==oe.compositionStart?o===oe.compositionEnd&&se&&(i=ae()):(Zd="value"in(Yd=n)?Yd.value:Yd.textContent,se=!0)),o=ge.getPooled(o,t,r,n),i?o.data=i:null!==(i=re(r))&&(o.data=i),Xd(o),i=o):i=null,(e=le?te(e,r):ue(e,r))?((t=he.getPooled(oe.beforeInput,t,r,n)).data=e,Xd(t)):t=null,null===i?t:null===t?i:[i,t]}},we={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xe(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!we[e.type]:"textarea"===t}var ye={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function ze(e,t,r){return(e=G.getPooled(ye.change,e,t,r)).type="change",Da(r),Xd(e),e}var Ae=null,Be=null;function Ce(e){mc(e)}function De(e){if(yb(Pd(e)))return e}function Ee(e,t){if("change"===e)return t}var Fe=!1;function Ge(){Ae&&(Ae.detachEvent("onpropertychange",He),Be=Ae=null)}function He(e){if("value"===e.propertyName&&De(Be))if(e=ze(Be,e,nc(e)),Ja)mc(e);else{Ja=!0;try{Fa(Ce,e)}finally{Ja=!1,La()}}}function Ie(e,t,r){"focus"===e?(Ge(),Be=r,(Ae=t).attachEvent("onpropertychange",He)):"blur"===e&&Ge()}function Je(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return De(Be)}function Ke(e,t){if("click"===e)return De(t)}function Le(e,t){if("input"===e||"change"===e)return De(t)}ya&&(Fe=oc("input")&&(!document.documentMode||9<document.documentMode));var Me={eventTypes:ye,_isInputEventSupported:Fe,extractEvents:function(e,t,r,n){var i=t?Pd(t):window,o=i.nodeName&&i.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===i.type)var a=Ee;else if(xe(i))if(Fe)a=Le;else{a=Je;var s=Ie}else(o=i.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(a=Ke);if(a&&(a=a(e,t)))return ze(a,r,n);s&&s(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&Db(i,"number",i.value)}},Ne=G.extend({view:null,detail:null}),Oe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Oe[e])&&!!t[e]}function Qe(){return Pe}var Re=0,Se=0,Te=!1,Ue=!1,Ve=Ne.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Qe,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Re;return Re=e.screenX,Te?"mousemove"===e.type?e.screenX-t:0:(Te=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Se;return Se=e.screenY,Ue?"mousemove"===e.type?e.screenY-t:0:(Ue=!0,0)}}),We=Ve.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Xe={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Ye={eventTypes:Xe,extractEvents:function(e,t,r,n,i){var o="mouseover"===e||"pointerover"===e,a="mouseout"===e||"pointerout"===e;if(o&&0==(32&i)&&(r.relatedTarget||r.fromElement)||!a&&!o)return null;(o=n.window===n?n:(o=n.ownerDocument)?o.defaultView||o.parentWindow:window,a)?(a=t,null!==(t=(t=r.relatedTarget||r.toElement)?tc(t):null)&&(t!==dc(t)||5!==t.tag&&6!==t.tag)&&(t=null)):a=null;if(a===t)return null;if("mouseout"===e||"mouseover"===e)var s=Ve,c=Xe.mouseLeave,u=Xe.mouseEnter,l="mouse";else"pointerout"!==e&&"pointerover"!==e||(s=We,c=Xe.pointerLeave,u=Xe.pointerEnter,l="pointer");if(e=null==a?o:Pd(a),o=null==t?o:Pd(t),(c=s.getPooled(c,a,r,n)).type=l+"leave",c.target=e,c.relatedTarget=o,(r=s.getPooled(u,t,r,n)).type=l+"enter",r.target=o,r.relatedTarget=e,l=t,(n=a)&&l)e:{for(u=l,a=0,e=s=n;e;e=Rd(e))a++;for(e=0,t=u;t;t=Rd(t))e++;for(;0<a-e;)s=Rd(s),a--;for(;0<e-a;)u=Rd(u),e--;for(;a--;){if(s===u||s===u.alternate)break e;s=Rd(s),u=Rd(u)}s=null}else s=null;for(u=s,s=[];n&&n!==u&&(null===(a=n.alternate)||a!==u);)s.push(n),n=Rd(n);for(n=[];l&&l!==u&&(null===(a=l.alternate)||a!==u);)n.push(l),l=Rd(l);for(l=0;l<s.length;l++)Vd(s[l],"bubbled",c);for(l=n.length;0<l--;)Vd(n[l],"captured",r);return 0==(64&i)?[c]:[c,r]}};function Ze(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var $e="function"==typeof Object.is?Object.is:Ze,af=Object.prototype.hasOwnProperty;function bf(e,t){if($e(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++)if(!af.call(t,r[n])||!$e(e[r[n]],t[r[n]]))return!1;return!0}var cf=ya&&"documentMode"in document&&11>=document.documentMode,df={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},ef=null,ff=null,gf=null,hf=!1;function jf(e,t){var r=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return hf||null==ef||ef!==td(r)?null:("selectionStart"in(r=ef)&&yd(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},gf&&bf(gf,r)?null:(gf=r,(e=G.getPooled(df.select,ff,e,t)).type="select",e.target=ef,Xd(e),e))}var kf={eventTypes:df,extractEvents:function(e,t,r,n,i,o){if(!(o=!(i=o||(n.window===n?n.document:9===n.nodeType?n:n.ownerDocument)))){e:{i=cc(i),o=wa.onSelect;for(var a=0;a<o.length;a++)if(!i.has(o[a])){i=!1;break e}i=!0}o=!i}if(o)return null;switch(i=t?Pd(t):window,e){case"focus":(xe(i)||"true"===i.contentEditable)&&(ef=i,ff=t,gf=null);break;case"blur":gf=ff=ef=null;break;case"mousedown":hf=!0;break;case"contextmenu":case"mouseup":case"dragend":return hf=!1,jf(r,n);case"selectionchange":if(cf)break;case"keydown":case"keyup":return jf(r,n)}return null}},lf=G.extend({animationName:null,elapsedTime:null,pseudoElement:null}),mf=G.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),nf=Ne.extend({relatedTarget:null});function of(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var pf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rf=Ne.extend({key:function(e){if(e.key){var t=pf[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=of(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?qf[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Qe,charCode:function(e){return"keypress"===e.type?of(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?of(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),sf=Ve.extend({dataTransfer:null}),tf=Ne.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Qe}),uf=G.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),vf=Ve.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),wf={eventTypes:Wc,extractEvents:function(e,t,r,n){var i=Yc.get(e);if(!i)return null;switch(e){case"keypress":if(0===of(r))return null;case"keydown":case"keyup":e=rf;break;case"blur":case"focus":e=nf;break;case"click":if(2===r.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Ve;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=sf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=tf;break;case Xb:case Yb:case Zb:e=lf;break;case $b:e=uf;break;case"scroll":e=Ne;break;case"wheel":e=vf;break;case"copy":case"cut":case"paste":e=mf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=We;break;default:e=G}return Xd(t=e.getPooled(i,t,r,n)),t}};if(pa)throw Error(u(101));pa=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),ra();var xf=Nc;la=Qd,ma=xf,na=Pd,xa({SimpleEventPlugin:wf,EnterLeaveEventPlugin:Ye,ChangeEventPlugin:Me,SelectEventPlugin:kf,BeforeInputEventPlugin:ve});var yf=[],zf=-1;function H(e){0>zf||(e.current=yf[zf],yf[zf]=null,zf--)}function I(e,t){zf++,yf[zf]=e.current,e.current=t}var Af={},J={current:Af},K={current:!1},Bf=Af;function Cf(e,t){var r=e.type.contextTypes;if(!r)return Af;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in r)o[i]=t[i];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function L(e){return null!=(e=e.childContextTypes)}function Df(){H(K),H(J)}function Ef(e,t,r){if(J.current!==Af)throw Error(u(168));I(J,t),I(K,r)}function Ff(e,t,r){var i=e.stateNode;if(e=t.childContextTypes,"function"!=typeof i.getChildContext)return r;for(var o in i=i.getChildContext())if(!(o in e))throw Error(u(108,pb(t)||"Unknown",o));return n({},r,{},i)}function Gf(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Af,Bf=J.current,I(J,e),I(K,K.current),!0}function Hf(e,t,r){var n=e.stateNode;if(!n)throw Error(u(169));r?(e=Ff(e,t,Bf),n.__reactInternalMemoizedMergedChildContext=e,H(K),H(J),I(J,e)):H(K),I(K,r)}var If=r.unstable_runWithPriority,Jf=r.unstable_scheduleCallback,Kf=r.unstable_cancelCallback,Lf=r.unstable_requestPaint,Mf=r.unstable_now,Nf=r.unstable_getCurrentPriorityLevel,Of=r.unstable_ImmediatePriority,Pf=r.unstable_UserBlockingPriority,Qf=r.unstable_NormalPriority,Rf=r.unstable_LowPriority,Sf=r.unstable_IdlePriority,Tf={},Uf=r.unstable_shouldYield,Vf=void 0!==Lf?Lf:function(){},Wf=null,Xf=null,Yf=!1,Zf=Mf(),$f=1e4>Zf?Mf:function(){return Mf()-Zf};function ag(){switch(Nf()){case Of:return 99;case Pf:return 98;case Qf:return 97;case Rf:return 96;case Sf:return 95;default:throw Error(u(332))}}function bg(e){switch(e){case 99:return Of;case 98:return Pf;case 97:return Qf;case 96:return Rf;case 95:return Sf;default:throw Error(u(332))}}function cg(e,t){return e=bg(e),If(e,t)}function dg(e,t,r){return e=bg(e),Jf(e,t,r)}function eg(e){return null===Wf?(Wf=[e],Xf=Jf(Of,fg)):Wf.push(e),Tf}function gg(){if(null!==Xf){var e=Xf;Xf=null,Kf(e)}fg()}function fg(){if(!Yf&&null!==Wf){Yf=!0;var e=0;try{var t=Wf;cg(99,(function(){for(;e<t.length;e++){var r=t[e];do{r=r(!0)}while(null!==r)}})),Wf=null}catch(t){throw null!==Wf&&(Wf=Wf.slice(e+1)),Jf(Of,gg),t}finally{Yf=!1}}}function hg(e,t,r){return 1073741821-(1+((1073741821-e+t/10)/(r/=10)|0))*r}function ig(e,t){if(e&&e.defaultProps)for(var r in t=n({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}var jg={current:null},kg=null,lg=null,mg=null;function ng(){mg=lg=kg=null}function og(e){var t=jg.current;H(jg),e.type._context._currentValue=t}function pg(e,t){for(;null!==e;){var r=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==r&&r.childExpirationTime<t&&(r.childExpirationTime=t);else{if(!(null!==r&&r.childExpirationTime<t))break;r.childExpirationTime=t}e=e.return}}function qg(e,t){kg=e,mg=lg=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(rg=!0),e.firstContext=null)}function sg(e,t){if(mg!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(mg=e,t=1073741823),t={context:e,observedBits:t,next:null},null===lg){if(null===kg)throw Error(u(308));lg=t,kg.dependencies={expirationTime:0,firstContext:t,responders:null}}else lg=lg.next=t;return e._currentValue}var tg=!1;function ug(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function vg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function wg(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function xg(e,t){if(null!==(e=e.updateQueue)){var r=(e=e.shared).pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}}function yg(e,t){var r=e.alternate;null!==r&&vg(r,e),null===(r=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=r.next,r.next=t)}function zg(e,t,r,i){var o=e.updateQueue;tg=!1;var a=o.baseQueue,s=o.shared.pending;if(null!==s){if(null!==a){var c=a.next;a.next=s.next,s.next=c}a=s,o.shared.pending=null,null!==(c=e.alternate)&&(null!==(c=c.updateQueue)&&(c.baseQueue=s))}if(null!==a){c=a.next;var u=o.baseState,l=0,d=null,p=null,f=null;if(null!==c)for(var h=c;;){if((s=h.expirationTime)<i){var m={expirationTime:h.expirationTime,suspenseConfig:h.suspenseConfig,tag:h.tag,payload:h.payload,callback:h.callback,next:null};null===f?(p=f=m,d=u):f=f.next=m,s>l&&(l=s)}else{null!==f&&(f=f.next={expirationTime:1073741823,suspenseConfig:h.suspenseConfig,tag:h.tag,payload:h.payload,callback:h.callback,next:null}),Ag(s,h.suspenseConfig);e:{var g=e,v=h;switch(s=t,m=r,v.tag){case 1:if("function"==typeof(g=v.payload)){u=g.call(m,u,s);break e}u=g;break e;case 3:g.effectTag=-4097&g.effectTag|64;case 0:if(null==(s="function"==typeof(g=v.payload)?g.call(m,u,s):g))break e;u=n({},u,s);break e;case 2:tg=!0}}null!==h.callback&&(e.effectTag|=32,null===(s=o.effects)?o.effects=[h]:s.push(h))}if(null===(h=h.next)||h===c){if(null===(s=o.shared.pending))break;h=a.next=s.next,s.next=c,o.baseQueue=a=s,o.shared.pending=null}}null===f?d=u:f.next=p,o.baseState=d,o.baseQueue=f,Bg(l),e.expirationTime=l,e.memoizedState=u}}function Cg(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(null!==i){if(n.callback=null,n=i,i=r,"function"!=typeof n)throw Error(u(191,n));n.call(i)}}}var Dg=Wa.ReactCurrentBatchConfig,Eg=(new aa.Component).refs;function Fg(e,t,r,i){r=null==(r=r(i,t=e.memoizedState))?t:n({},t,r),e.memoizedState=r,0===e.expirationTime&&(e.updateQueue.baseState=r)}var Jg={isMounted:function(e){return!!(e=e._reactInternalFiber)&&dc(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternalFiber;var n=Gg(),i=Dg.suspense;(i=wg(n=Hg(n,e,i),i)).payload=t,null!=r&&(i.callback=r),xg(e,i),Ig(e,n)},enqueueReplaceState:function(e,t,r){e=e._reactInternalFiber;var n=Gg(),i=Dg.suspense;(i=wg(n=Hg(n,e,i),i)).tag=1,i.payload=t,null!=r&&(i.callback=r),xg(e,i),Ig(e,n)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var r=Gg(),n=Dg.suspense;(n=wg(r=Hg(r,e,n),n)).tag=2,null!=t&&(n.callback=t),xg(e,n),Ig(e,r)}};function Kg(e,t,r,n,i,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!bf(r,n)||!bf(i,o))}function Lg(e,t,r){var n=!1,i=Af,o=t.contextType;return"object"==typeof o&&null!==o?o=sg(o):(i=L(t)?Bf:J.current,o=(n=null!=(n=t.contextTypes))?Cf(e,i):Af),t=new t(r,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Jg,e.stateNode=t,t._reactInternalFiber=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Mg(e,t,r,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Jg.enqueueReplaceState(t,t.state,null)}function Ng(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs=Eg,ug(e);var o=t.contextType;"object"==typeof o&&null!==o?i.context=sg(o):(o=L(t)?Bf:J.current,i.context=Cf(e,o)),zg(e,r,i,n),i.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(Fg(e,t,o,r),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Jg.enqueueReplaceState(i,i.state,null),zg(e,r,i,n),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.effectTag|=4)}var Og=Array.isArray;function Pg(e,t,r){if(null!==(e=r.ref)&&"function"!=typeof e&&"object"!=typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(u(309));var n=r.stateNode}if(!n)throw Error(u(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=n.refs;t===Eg&&(t=n.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(u(284));if(!r._owner)throw Error(u(290,e))}return e}function Qg(e,t){if("textarea"!==e.type)throw Error(u(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Rg(e){function t(t,r){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=r,t.lastEffect=r):t.firstEffect=t.lastEffect=r,r.nextEffect=null,r.effectTag=8}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Sg(e,t)).index=0,e.sibling=null,e}function o(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.effectTag=2,r):n:(t.effectTag=2,r):r}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function s(e,t,r,n){return null===t||6!==t.tag?((t=Tg(r,e.mode,n)).return=e,t):((t=i(t,r)).return=e,t)}function c(e,t,r,n){return null!==t&&t.elementType===r.type?((n=i(t,r.props)).ref=Pg(e,t,r),n.return=e,n):((n=Ug(r.type,r.key,r.props,null,e.mode,n)).ref=Pg(e,t,r),n.return=e,n)}function l(e,t,r,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Vg(r,e.mode,n)).return=e,t):((t=i(t,r.children||[])).return=e,t)}function d(e,t,r,n,o){return null===t||7!==t.tag?((t=Wg(r,e.mode,n,o)).return=e,t):((t=i(t,r)).return=e,t)}function p(e,t,r){if("string"==typeof t||"number"==typeof t)return(t=Tg(""+t,e.mode,r)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case Za:return(r=Ug(t.type,t.key,t.props,null,e.mode,r)).ref=Pg(e,null,t),r.return=e,r;case $a:return(t=Vg(t,e.mode,r)).return=e,t}if(Og(t)||nb(t))return(t=Wg(t,e.mode,r,null)).return=e,t;Qg(e,t)}return null}function f(e,t,r,n){var i=null!==t?t.key:null;if("string"==typeof r||"number"==typeof r)return null!==i?null:s(e,t,""+r,n);if("object"==typeof r&&null!==r){switch(r.$$typeof){case Za:return r.key===i?r.type===ab?d(e,t,r.props.children,n,i):c(e,t,r,n):null;case $a:return r.key===i?l(e,t,r,n):null}if(Og(r)||nb(r))return null!==i?null:d(e,t,r,n,null);Qg(e,r)}return null}function h(e,t,r,n,i){if("string"==typeof n||"number"==typeof n)return s(t,e=e.get(r)||null,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case Za:return e=e.get(null===n.key?r:n.key)||null,n.type===ab?d(t,e,n.props.children,i,n.key):c(t,e,n,i);case $a:return l(t,e=e.get(null===n.key?r:n.key)||null,n,i)}if(Og(n)||nb(n))return d(t,e=e.get(r)||null,n,i,null);Qg(t,n)}return null}function m(i,a,s,c){for(var u=null,l=null,d=a,m=a=0,g=null;null!==d&&m<s.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=f(i,d,s[m],c);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(i,d),a=o(v,a,m),null===l?u=v:l.sibling=v,l=v,d=g}if(m===s.length)return r(i,d),u;if(null===d){for(;m<s.length;m++)null!==(d=p(i,s[m],c))&&(a=o(d,a,m),null===l?u=d:l.sibling=d,l=d);return u}for(d=n(i,d);m<s.length;m++)null!==(g=h(d,i,m,s[m],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),a=o(g,a,m),null===l?u=g:l.sibling=g,l=g);return e&&d.forEach((function(e){return t(i,e)})),u}function g(i,a,s,c){var l=nb(s);if("function"!=typeof l)throw Error(u(150));if(null==(s=l.call(s)))throw Error(u(151));for(var d=l=null,m=a,g=a=0,v=null,y=s.next();null!==m&&!y.done;g++,y=s.next()){m.index>g?(v=m,m=null):v=m.sibling;var b=f(i,m,y.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(i,m),a=o(b,a,g),null===d?l=b:d.sibling=b,d=b,m=v}if(y.done)return r(i,m),l;if(null===m){for(;!y.done;g++,y=s.next())null!==(y=p(i,y.value,c))&&(a=o(y,a,g),null===d?l=y:d.sibling=y,d=y);return l}for(m=n(i,m);!y.done;g++,y=s.next())null!==(y=h(m,i,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),a=o(y,a,g),null===d?l=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(i,e)})),l}return function(e,n,o,s){var c="object"==typeof o&&null!==o&&o.type===ab&&null===o.key;c&&(o=o.props.children);var l="object"==typeof o&&null!==o;if(l)switch(o.$$typeof){case Za:e:{for(l=o.key,c=n;null!==c;){if(c.key===l){if(7===c.tag){if(o.type===ab){r(e,c.sibling),(n=i(c,o.props.children)).return=e,e=n;break e}}else if(c.elementType===o.type){r(e,c.sibling),(n=i(c,o.props)).ref=Pg(e,c,o),n.return=e,e=n;break e}r(e,c);break}t(e,c),c=c.sibling}o.type===ab?((n=Wg(o.props.children,e.mode,s,o.key)).return=e,e=n):((s=Ug(o.type,o.key,o.props,null,e.mode,s)).ref=Pg(e,n,o),s.return=e,e=s)}return a(e);case $a:e:{for(c=o.key;null!==n;){if(n.key===c){if(4===n.tag&&n.stateNode.containerInfo===o.containerInfo&&n.stateNode.implementation===o.implementation){r(e,n.sibling),(n=i(n,o.children||[])).return=e,e=n;break e}r(e,n);break}t(e,n),n=n.sibling}(n=Vg(o,e.mode,s)).return=e,e=n}return a(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==n&&6===n.tag?(r(e,n.sibling),(n=i(n,o)).return=e,e=n):(r(e,n),(n=Tg(o,e.mode,s)).return=e,e=n),a(e);if(Og(o))return m(e,n,o,s);if(nb(o))return g(e,n,o,s);if(l&&Qg(e,o),void 0===o&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(u(152,e.displayName||e.name||"Component"))}return r(e,n)}}var Xg=Rg(!0),Yg=Rg(!1),Zg={},$g={current:Zg},ah={current:Zg},bh={current:Zg};function ch(e){if(e===Zg)throw Error(u(174));return e}function dh(e,t){switch(I(bh,t),I(ah,e),I($g,Zg),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ob(null,"");break;default:t=Ob(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}H($g),I($g,t)}function eh(){H($g),H(ah),H(bh)}function fh(e){ch(bh.current);var t=ch($g.current),r=Ob(t,e.type);t!==r&&(I(ah,e),I($g,r))}function gh(e){ah.current===e&&(H($g),H(ah))}var M={current:0};function hh(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||r.data===Bd||r.data===Cd))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ih(e,t){return{responder:e,props:t}}var jh=Wa.ReactCurrentDispatcher,kh=Wa.ReactCurrentBatchConfig,lh=0,N=null,O=null,P=null,mh=!1;function Q(){throw Error(u(321))}function nh(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!$e(e[r],t[r]))return!1;return!0}function oh(e,t,r,n,i,o){if(lh=o,N=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,jh.current=null===e||null===e.memoizedState?ph:qh,e=r(n,i),t.expirationTime===lh){o=0;do{if(t.expirationTime=0,!(25>o))throw Error(u(301));o+=1,P=O=null,t.updateQueue=null,jh.current=rh,e=r(n,i)}while(t.expirationTime===lh)}if(jh.current=sh,t=null!==O&&null!==O.next,lh=0,P=O=N=null,mh=!1,t)throw Error(u(300));return e}function th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===P?N.memoizedState=P=e:P=P.next=e,P}function uh(){if(null===O){var e=N.alternate;e=null!==e?e.memoizedState:null}else e=O.next;var t=null===P?N.memoizedState:P.next;if(null!==t)P=t,O=e;else{if(null===e)throw Error(u(310));e={memoizedState:(O=e).memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},null===P?N.memoizedState=P=e:P=P.next=e}return P}function vh(e,t){return"function"==typeof t?t(e):t}function wh(e){var t=uh(),r=t.queue;if(null===r)throw Error(u(311));r.lastRenderedReducer=e;var n=O,i=n.baseQueue,o=r.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}n.baseQueue=i=o,r.pending=null}if(null!==i){i=i.next,n=n.baseState;var s=a=o=null,c=i;do{var l=c.expirationTime;if(l<lh){var d={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===s?(a=s=d,o=n):s=s.next=d,l>N.expirationTime&&(N.expirationTime=l,Bg(l))}else null!==s&&(s=s.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),Ag(l,c.suspenseConfig),n=c.eagerReducer===e?c.eagerState:e(n,c.action);c=c.next}while(null!==c&&c!==i);null===s?o=n:s.next=a,$e(n,t.memoizedState)||(rg=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=s,r.lastRenderedState=n}return[t.memoizedState,r.dispatch]}function xh(e){var t=uh(),r=t.queue;if(null===r)throw Error(u(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,o=t.memoizedState;if(null!==i){r.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);$e(o,t.memoizedState)||(rg=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function yh(e){var t=th();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:vh,lastRenderedState:e}).dispatch=zh.bind(null,N,e),[t.memoizedState,e]}function Ah(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},null===(t=N.updateQueue)?(t={lastEffect:null},N.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e),e}function Bh(){return uh().memoizedState}function Ch(e,t,r,n){var i=th();N.effectTag|=e,i.memoizedState=Ah(1|t,r,void 0,void 0===n?null:n)}function Dh(e,t,r,n){var i=uh();n=void 0===n?null:n;var o=void 0;if(null!==O){var a=O.memoizedState;if(o=a.destroy,null!==n&&nh(n,a.deps))return void Ah(t,r,o,n)}N.effectTag|=e,i.memoizedState=Ah(1|t,r,o,n)}function Eh(e,t){return Ch(516,4,e,t)}function Fh(e,t){return Dh(516,4,e,t)}function Gh(e,t){return Dh(4,2,e,t)}function Hh(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ih(e,t,r){return r=null!=r?r.concat([e]):null,Dh(4,2,Hh.bind(null,t,e),r)}function Jh(){}function Kh(e,t){return th().memoizedState=[e,void 0===t?null:t],e}function Lh(e,t){var r=uh();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&nh(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Mh(e,t){var r=uh();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&nh(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function Nh(e,t,r){var n=ag();cg(98>n?98:n,(function(){e(!0)})),cg(97<n?97:n,(function(){var n=kh.suspense;kh.suspense=void 0===t?null:t;try{e(!1),r()}finally{kh.suspense=n}}))}function zh(e,t,r){var n=Gg(),i=Dg.suspense;i={expirationTime:n=Hg(n,e,i),suspenseConfig:i,action:r,eagerReducer:null,eagerState:null,next:null};var o=t.pending;if(null===o?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=e.alternate,e===N||null!==o&&o===N)mh=!0,i.expirationTime=lh,N.expirationTime=lh;else{if(0===e.expirationTime&&(null===o||0===o.expirationTime)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,r);if(i.eagerReducer=o,i.eagerState=s,$e(s,a))return}catch(e){}Ig(e,n)}}var sh={readContext:sg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useResponder:Q,useDeferredValue:Q,useTransition:Q},ph={readContext:sg,useCallback:Kh,useContext:sg,useEffect:Eh,useImperativeHandle:function(e,t,r){return r=null!=r?r.concat([e]):null,Ch(4,2,Hh.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Ch(4,2,e,t)},useMemo:function(e,t){var r=th();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=th();return t=void 0!==r?r(t):t,n.memoizedState=n.baseState=t,e=(e=n.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=zh.bind(null,N,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},th().memoizedState=e},useState:yh,useDebugValue:Jh,useResponder:ih,useDeferredValue:function(e,t){var r=yh(e),n=r[0],i=r[1];return Eh((function(){var r=kh.suspense;kh.suspense=void 0===t?null:t;try{i(e)}finally{kh.suspense=r}}),[e,t]),n},useTransition:function(e){var t=yh(!1),r=t[0];return t=t[1],[Kh(Nh.bind(null,t,e),[t,e]),r]}},qh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:wh,useRef:Bh,useState:function(){return wh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(e,t){var r=wh(vh),n=r[0],i=r[1];return Fh((function(){var r=kh.suspense;kh.suspense=void 0===t?null:t;try{i(e)}finally{kh.suspense=r}}),[e,t]),n},useTransition:function(e){var t=wh(vh),r=t[0];return t=t[1],[Lh(Nh.bind(null,t,e),[t,e]),r]}},rh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:xh,useRef:Bh,useState:function(){return xh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(e,t){var r=xh(vh),n=r[0],i=r[1];return Fh((function(){var r=kh.suspense;kh.suspense=void 0===t?null:t;try{i(e)}finally{kh.suspense=r}}),[e,t]),n},useTransition:function(e){var t=xh(vh),r=t[0];return t=t[1],[Lh(Nh.bind(null,t,e),[t,e]),r]}},Oh=null,Ph=null,Qh=!1;function Rh(e,t){var r=Sh(5,null,null,0);r.elementType="DELETED",r.type="DELETED",r.stateNode=t,r.return=e,r.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=r,e.lastEffect=r):e.firstEffect=e.lastEffect=r}function Th(e,t){switch(e.tag){case 5:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Uh(e){if(Qh){var t=Ph;if(t){var r=t;if(!Th(e,t)){if(!(t=Jd(r.nextSibling))||!Th(e,t))return e.effectTag=-1025&e.effectTag|2,Qh=!1,void(Oh=e);Rh(Oh,r)}Oh=e,Ph=Jd(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Qh=!1,Oh=e}}function Vh(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Oh=e}function Wh(e){if(e!==Oh)return!1;if(!Qh)return Vh(e),Qh=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Gd(t,e.memoizedProps))for(t=Ph;t;)Rh(e,t),t=Jd(t.nextSibling);if(Vh(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(u(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if(r===Ad){if(0===t){Ph=Jd(e.nextSibling);break e}t--}else r!==zd&&r!==Cd&&r!==Bd||t++}e=e.nextSibling}Ph=null}}else Ph=Oh?Jd(e.stateNode.nextSibling):null;return!0}function Xh(){Ph=Oh=null,Qh=!1}var Yh=Wa.ReactCurrentOwner,rg=!1;function R(e,t,r,n){t.child=null===e?Yg(t,null,r,n):Xg(t,e.child,r,n)}function Zh(e,t,r,n,i){r=r.render;var o=t.ref;return qg(t,i),n=oh(e,t,r,n,o,i),null===e||rg?(t.effectTag|=1,R(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),$h(e,t,i))}function ai(e,t,r,n,i,o){if(null===e){var a=r.type;return"function"!=typeof a||bi(a)||void 0!==a.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=Ug(r.type,null,n,null,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,ci(e,t,a,n,i,o))}return a=e.child,i<o&&(i=a.memoizedProps,(r=null!==(r=r.compare)?r:bf)(i,n)&&e.ref===t.ref)?$h(e,t,o):(t.effectTag|=1,(e=Sg(a,n)).ref=t.ref,e.return=t,t.child=e)}function ci(e,t,r,n,i,o){return null!==e&&bf(e.memoizedProps,n)&&e.ref===t.ref&&(rg=!1,i<o)?(t.expirationTime=e.expirationTime,$h(e,t,o)):di(e,t,r,n,o)}function ei(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.effectTag|=128)}function di(e,t,r,n,i){var o=L(r)?Bf:J.current;return o=Cf(t,o),qg(t,i),r=oh(e,t,r,n,o,i),null===e||rg?(t.effectTag|=1,R(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),$h(e,t,i))}function fi(e,t,r,n,i){if(L(r)){var o=!0;Gf(t)}else o=!1;if(qg(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),Lg(t,r,n),Ng(t,r,n,i),n=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var c=a.context,u=r.contextType;"object"==typeof u&&null!==u?u=sg(u):u=Cf(t,u=L(r)?Bf:J.current);var l=r.getDerivedStateFromProps,d="function"==typeof l||"function"==typeof a.getSnapshotBeforeUpdate;d||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==n||c!==u)&&Mg(t,a,n,u),tg=!1;var p=t.memoizedState;a.state=p,zg(t,n,a,i),c=t.memoizedState,s!==n||p!==c||K.current||tg?("function"==typeof l&&(Fg(t,r,l,n),c=t.memoizedState),(s=tg||Kg(t,r,s,n,p,c,u))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.effectTag|=4)):("function"==typeof a.componentDidMount&&(t.effectTag|=4),t.memoizedProps=n,t.memoizedState=c),a.props=n,a.state=c,a.context=u,n=s):("function"==typeof a.componentDidMount&&(t.effectTag|=4),n=!1)}else a=t.stateNode,vg(e,t),s=t.memoizedProps,a.props=t.type===t.elementType?s:ig(t.type,s),c=a.context,"object"==typeof(u=r.contextType)&&null!==u?u=sg(u):u=Cf(t,u=L(r)?Bf:J.current),(d="function"==typeof(l=r.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==n||c!==u)&&Mg(t,a,n,u),tg=!1,c=t.memoizedState,a.state=c,zg(t,n,a,i),p=t.memoizedState,s!==n||c!==p||K.current||tg?("function"==typeof l&&(Fg(t,r,l,n),p=t.memoizedState),(l=tg||Kg(t,r,s,n,c,p,u))?(d||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(n,p,u),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,p,u)),"function"==typeof a.componentDidUpdate&&(t.effectTag|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=256),t.memoizedProps=n,t.memoizedState=p),a.props=n,a.state=p,a.context=u,n=l):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=256),n=!1);return gi(e,t,r,n,o,i)}function gi(e,t,r,n,i,o){ei(e,t);var a=0!=(64&t.effectTag);if(!n&&!a)return i&&Hf(t,r,!1),$h(e,t,o);n=t.stateNode,Yh.current=t;var s=a&&"function"!=typeof r.getDerivedStateFromError?null:n.render();return t.effectTag|=1,null!==e&&a?(t.child=Xg(t,e.child,null,o),t.child=Xg(t,null,s,o)):R(e,t,s,o),t.memoizedState=n.state,i&&Hf(t,r,!0),t.child}function hi(e){var t=e.stateNode;t.pendingContext?Ef(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Ef(e,t.context,!1),dh(e,t.containerInfo)}var ii={dehydrated:null,retryTime:0},ni,oi,pi,qi;function ji(e,t,r){var n,i=t.mode,o=t.pendingProps,a=M.current,s=!1;if((n=0!=(64&t.effectTag))||(n=0!=(2&a)&&(null===e||null!==e.memoizedState)),n?(s=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(a|=1),I(M,1&a),null===e){if(void 0!==o.fallback&&Uh(t),s){if(s=o.fallback,(o=Wg(null,i,0,null)).return=t,0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(r=Wg(s,i,r,null)).return=t,o.sibling=r,t.memoizedState=ii,t.child=o,r}return i=o.children,t.memoizedState=null,t.child=Yg(t,null,i,r)}if(null!==e.memoizedState){if(i=(e=e.child).sibling,s){if(o=o.fallback,(r=Sg(e,e.pendingProps)).return=t,0==(2&t.mode)&&(s=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(r.child=s;null!==s;)s.return=r,s=s.sibling;return(i=Sg(i,o)).return=t,r.sibling=i,r.childExpirationTime=0,t.memoizedState=ii,t.child=r,i}return r=Xg(t,e.child,o.children,r),t.memoizedState=null,t.child=r}if(e=e.child,s){if(s=o.fallback,(o=Wg(null,i,0,null)).return=t,o.child=e,null!==e&&(e.return=o),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(r=Wg(s,i,r,null)).return=t,o.sibling=r,r.effectTag|=2,o.childExpirationTime=0,t.memoizedState=ii,t.child=o,r}return t.memoizedState=null,t.child=Xg(t,e,o.children,r)}function ki(e,t){e.expirationTime<t&&(e.expirationTime=t);var r=e.alternate;null!==r&&r.expirationTime<t&&(r.expirationTime=t),pg(e.return,t)}function li(e,t,r,n,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailExpiration:0,tailMode:i,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=r,a.tailExpiration=0,a.tailMode=i,a.lastEffect=o)}function mi(e,t,r){var n=t.pendingProps,i=n.revealOrder,o=n.tail;if(R(e,t,n.children,r),0!=(2&(n=M.current)))n=1&n|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ki(e,r);else if(19===e.tag)ki(e,r);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(I(M,n),0==(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;null!==r;)null!==(e=r.alternate)&&null===hh(e)&&(i=r),r=r.sibling;null===(r=i)?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),li(t,!1,i,r,o,t.lastEffect);break;case"backwards":for(r=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===hh(e)){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}li(t,!0,r,null,o,t.lastEffect);break;case"together":li(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function $h(e,t,r){null!==e&&(t.dependencies=e.dependencies);var n=t.expirationTime;if(0!==n&&Bg(n),t.childExpirationTime<r)return null;if(null!==e&&t.child!==e.child)throw Error(u(153));if(null!==t.child){for(r=Sg(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Sg(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function ri(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function si(e,t,r){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return L(t.type)&&Df(),null;case 3:return eh(),H(K),H(J),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||!Wh(t)||(t.effectTag|=4),oi(t),null;case 5:gh(t),r=ch(bh.current);var o=t.type;if(null!==e&&null!=t.stateNode)pi(e,t,o,i,r),e.ref!==t.ref&&(t.effectTag|=128);else{if(!i){if(null===t.stateNode)throw Error(u(166));return null}if(e=ch($g.current),Wh(t)){i=t.stateNode,o=t.type;var a=t.memoizedProps;switch(i[Md]=t,i[Nd]=a,o){case"iframe":case"object":case"embed":F("load",i);break;case"video":case"audio":for(e=0;e<ac.length;e++)F(ac[e],i);break;case"source":F("error",i);break;case"img":case"image":case"link":F("error",i),F("load",i);break;case"form":F("reset",i),F("submit",i);break;case"details":F("toggle",i);break;case"input":Ab(i,a),F("invalid",i),rd(r,"onChange");break;case"select":i._wrapperState={wasMultiple:!!a.multiple},F("invalid",i),rd(r,"onChange");break;case"textarea":Jb(i,a),F("invalid",i),rd(r,"onChange")}for(var s in od(o,a),e=null,a)if(a.hasOwnProperty(s)){var c=a[s];"children"===s?"string"==typeof c?i.textContent!==c&&(e=["children",c]):"number"==typeof c&&i.textContent!==""+c&&(e=["children",""+c]):va.hasOwnProperty(s)&&null!=c&&rd(r,s)}switch(o){case"input":xb(i),Eb(i,a,!0);break;case"textarea":xb(i),Lb(i);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(i.onclick=sd)}r=e,t.updateQueue=r,null!==r&&(t.effectTag|=4)}else{switch(s=9===r.nodeType?r:r.ownerDocument,e===qd&&(e=Nb(o)),e===qd?"script"===o?((e=s.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=s.createElement(o,{is:i.is}):(e=s.createElement(o),"select"===o&&(s=e,i.multiple?s.multiple=!0:i.size&&(s.size=i.size))):e=s.createElementNS(e,o),e[Md]=t,e[Nd]=i,ni(e,t,!1,!1),t.stateNode=e,s=pd(o,i),o){case"iframe":case"object":case"embed":F("load",e),c=i;break;case"video":case"audio":for(c=0;c<ac.length;c++)F(ac[c],e);c=i;break;case"source":F("error",e),c=i;break;case"img":case"image":case"link":F("error",e),F("load",e),c=i;break;case"form":F("reset",e),F("submit",e),c=i;break;case"details":F("toggle",e),c=i;break;case"input":Ab(e,i),c=zb(e,i),F("invalid",e),rd(r,"onChange");break;case"option":c=Gb(e,i);break;case"select":e._wrapperState={wasMultiple:!!i.multiple},c=n({},i,{value:void 0}),F("invalid",e),rd(r,"onChange");break;case"textarea":Jb(e,i),c=Ib(e,i),F("invalid",e),rd(r,"onChange");break;default:c=i}od(o,c);var l=c;for(a in l)if(l.hasOwnProperty(a)){var d=l[a];"style"===a?md(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&Qb(e,d):"children"===a?"string"==typeof d?("textarea"!==o||""!==d)&&Rb(e,d):"number"==typeof d&&Rb(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(va.hasOwnProperty(a)?null!=d&&rd(r,a):null!=d&&Xa(e,a,d,s))}switch(o){case"input":xb(e),Eb(e,i,!1);break;case"textarea":xb(e),Lb(e);break;case"option":null!=i.value&&e.setAttribute("value",""+rb(i.value));break;case"select":e.multiple=!!i.multiple,null!=(r=i.value)?Hb(e,!!i.multiple,r,!1):null!=i.defaultValue&&Hb(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof c.onClick&&(e.onclick=sd)}Fd(o,i)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)qi(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(u(166));r=ch(bh.current),ch($g.current),Wh(t)?(r=t.stateNode,i=t.memoizedProps,r[Md]=t,r.nodeValue!==i&&(t.effectTag|=4)):((r=(9===r.nodeType?r:r.ownerDocument).createTextNode(i))[Md]=t,t.stateNode=r)}return null;case 13:return H(M),i=t.memoizedState,0!=(64&t.effectTag)?(t.expirationTime=r,t):(r=null!==i,i=!1,null===e?void 0!==t.memoizedProps.fallback&&Wh(t):(i=null!==(o=e.memoizedState),r||null===o||null!==(o=e.child.sibling)&&(null!==(a=t.firstEffect)?(t.firstEffect=o,o.nextEffect=a):(t.firstEffect=t.lastEffect=o,o.nextEffect=null),o.effectTag=8)),r&&!i&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&M.current)?S===ti&&(S=ui):(S!==ti&&S!==ui||(S=vi),0!==wi&&null!==T&&(xi(T,U),yi(T,wi)))),(r||i)&&(t.effectTag|=4),null);case 4:return eh(),oi(t),null;case 10:return og(t),null;case 19:if(H(M),null===(i=t.memoizedState))return null;if(o=0!=(64&t.effectTag),null===(a=i.rendering)){if(o)ri(i,!1);else if(S!==ti||null!==e&&0!=(64&e.effectTag))for(a=t.child;null!==a;){if(null!==(e=hh(a))){for(t.effectTag|=64,ri(i,!1),null!==(o=e.updateQueue)&&(t.updateQueue=o,t.effectTag|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=t.child;null!==i;)a=r,(o=i).effectTag&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,null===(e=o.alternate)?(o.childExpirationTime=0,o.expirationTime=a,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null):(o.childExpirationTime=e.childExpirationTime,o.expirationTime=e.expirationTime,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,a=e.dependencies,o.dependencies=null===a?null:{expirationTime:a.expirationTime,firstContext:a.firstContext,responders:a.responders}),i=i.sibling;return I(M,1&M.current|2),t.child}a=a.sibling}}else{if(!o)if(null!==(e=hh(a))){if(t.effectTag|=64,o=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.effectTag|=4),ri(i,!0),null===i.tail&&"hidden"===i.tailMode&&!a.alternate)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*$f()-i.renderingStartTime>i.tailExpiration&&1<r&&(t.effectTag|=64,o=!0,ri(i,!1),t.expirationTime=t.childExpirationTime=r-1);i.isBackwards?(a.sibling=t.child,t.child=a):(null!==(r=i.last)?r.sibling=a:t.child=a,i.last=a)}return null!==i.tail?(0===i.tailExpiration&&(i.tailExpiration=$f()+500),r=i.tail,i.rendering=r,i.tail=r.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=$f(),r.sibling=null,t=M.current,I(M,o?1&t|2:1&t),r):null}throw Error(u(156,t.tag))}function zi(e){switch(e.tag){case 1:L(e.type)&&Df();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(eh(),H(K),H(J),0!=(64&(t=e.effectTag)))throw Error(u(285));return e.effectTag=-4097&t|64,e;case 5:return gh(e),null;case 13:return H(M),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return H(M),null;case 4:return eh(),null;case 10:return og(e),null;default:return null}}function Ai(e,t){return{value:e,source:t,stack:qb(t)}}ni=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},oi=function(){},pi=function(e,t,r,i,o){var a=e.memoizedProps;if(a!==i){var s,c,u=t.stateNode;switch(ch($g.current),e=null,r){case"input":a=zb(u,a),i=zb(u,i),e=[];break;case"option":a=Gb(u,a),i=Gb(u,i),e=[];break;case"select":a=n({},a,{value:void 0}),i=n({},i,{value:void 0}),e=[];break;case"textarea":a=Ib(u,a),i=Ib(u,i),e=[];break;default:"function"!=typeof a.onClick&&"function"==typeof i.onClick&&(u.onclick=sd)}for(s in od(r,i),r=null,a)if(!i.hasOwnProperty(s)&&a.hasOwnProperty(s)&&null!=a[s])if("style"===s)for(c in u=a[s])u.hasOwnProperty(c)&&(r||(r={}),r[c]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(va.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in i){var l=i[s];if(u=null!=a?a[s]:void 0,i.hasOwnProperty(s)&&l!==u&&(null!=l||null!=u))if("style"===s)if(u){for(c in u)!u.hasOwnProperty(c)||l&&l.hasOwnProperty(c)||(r||(r={}),r[c]="");for(c in l)l.hasOwnProperty(c)&&u[c]!==l[c]&&(r||(r={}),r[c]=l[c])}else r||(e||(e=[]),e.push(s,r)),r=l;else"dangerouslySetInnerHTML"===s?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(e=e||[]).push(s,l)):"children"===s?u===l||"string"!=typeof l&&"number"!=typeof l||(e=e||[]).push(s,""+l):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(va.hasOwnProperty(s)?(null!=l&&rd(o,s),e||u===l||(e=[])):(e=e||[]).push(s,l))}r&&(e=e||[]).push("style",r),o=e,(t.updateQueue=o)&&(t.effectTag|=4)}},qi=function(e,t,r,n){r!==n&&(t.effectTag|=4)};var Bi="function"==typeof WeakSet?WeakSet:Set;function Ci(e,t){var r=t.source,n=t.stack;null===n&&null!==r&&(n=qb(r)),null!==r&&pb(r.type),t=t.value,null!==e&&1===e.tag&&pb(e.type);try{console.error(t)}catch(e){setTimeout((function(){throw e}))}}function Di(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Ei(e,t)}}function Fi(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Ei(e,t)}else t.current=null}function Gi(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 3:case 5:case 6:case 4:case 17:return;case 1:if(256&t.effectTag&&null!==e){var r=e.memoizedProps,n=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?r:ig(t.type,r),n),e.__reactInternalSnapshotBeforeUpdate=t}return}throw Error(u(163))}function Hi(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var n=r.destroy;r.destroy=void 0,void 0!==n&&n()}r=r.next}while(r!==t)}}function Ii(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function Ji(e,t,r){switch(r.tag){case 0:case 11:case 15:case 22:return void Ii(3,r);case 1:if(e=r.stateNode,4&r.effectTag)if(null===t)e.componentDidMount();else{var n=r.elementType===r.type?t.memoizedProps:ig(r.type,t.memoizedProps);e.componentDidUpdate(n,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=r.updateQueue)&&Cg(r,t,e));case 3:if(null!==(t=r.updateQueue)){if(e=null,null!==r.child)switch(r.child.tag){case 5:case 1:e=r.child.stateNode}Cg(r,t,e)}return;case 5:return e=r.stateNode,void(null===t&&4&r.effectTag&&Fd(r.type,r.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:return;case 13:return void(null===r.memoizedState&&(r=r.alternate,null!==r&&(r=r.memoizedState,null!==r&&(r=r.dehydrated,null!==r&&Vc(r)))))}throw Error(u(163))}function Ki(e,t,r){switch("function"==typeof Li&&Li(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e.next;cg(97<r?97:r,(function(){var e=n;do{var r=e.destroy;if(void 0!==r){var i=t;try{r()}catch(e){Ei(i,e)}}e=e.next}while(e!==n)}))}break;case 1:Fi(t),"function"==typeof(r=t.stateNode).componentWillUnmount&&Di(t,r);break;case 5:Fi(t);break;case 4:Mi(e,t,r)}}function Ni(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&Ni(t)}function Oi(e){return 5===e.tag||3===e.tag||4===e.tag}function Pi(e){e:{for(var t=e.return;null!==t;){if(Oi(t)){var r=t;break e}t=t.return}throw Error(u(160))}switch(t=r.stateNode,r.tag){case 5:var n=!1;break;case 3:case 4:t=t.containerInfo,n=!0;break;default:throw Error(u(161))}16&r.effectTag&&(Rb(t,""),r.effectTag&=-17);e:t:for(r=e;;){for(;null===r.sibling;){if(null===r.return||Oi(r.return)){r=null;break e}r=r.return}for(r.sibling.return=r.return,r=r.sibling;5!==r.tag&&6!==r.tag&&18!==r.tag;){if(2&r.effectTag)continue t;if(null===r.child||4===r.tag)continue t;r.child.return=r,r=r.child}if(!(2&r.effectTag)){r=r.stateNode;break e}}n?Qi(e,r,t):Ri(e,r,t)}function Qi(e,t,r){var n=e.tag,i=5===n||6===n;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!=(r=r._reactRootContainer)||null!==t.onclick||(t.onclick=sd));else if(4!==n&&null!==(e=e.child))for(Qi(e,t,r),e=e.sibling;null!==e;)Qi(e,t,r),e=e.sibling}function Ri(e,t,r){var n=e.tag,i=5===n||6===n;if(i)e=i?e.stateNode:e.stateNode.instance,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==n&&null!==(e=e.child))for(Ri(e,t,r),e=e.sibling;null!==e;)Ri(e,t,r),e=e.sibling}function Mi(e,t,r){for(var n,i,o=t,a=!1;;){if(!a){a=o.return;e:for(;;){if(null===a)throw Error(u(160));switch(n=a.stateNode,a.tag){case 5:i=!1;break e;case 3:case 4:n=n.containerInfo,i=!0;break e}a=a.return}a=!0}if(5===o.tag||6===o.tag){e:for(var s=e,c=o,l=r,d=c;;)if(Ki(s,d,l),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===c)break e;for(;null===d.sibling;){if(null===d.return||d.return===c)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}i?(s=n,c=o.stateNode,8===s.nodeType?s.parentNode.removeChild(c):s.removeChild(c)):n.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){n=o.stateNode.containerInfo,i=!0,o.child.return=o,o=o.child;continue}}else if(Ki(e,o,r),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(a=!1)}o.sibling.return=o.return,o=o.sibling}}function Si(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void Hi(3,t);case 1:case 12:case 17:return;case 5:var r=t.stateNode;if(null!=r){var n=t.memoizedProps,i=null!==e?e.memoizedProps:n;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(r[Nd]=n,"input"===e&&"radio"===n.type&&null!=n.name&&Bb(r,n),pd(e,i),t=pd(e,n),i=0;i<o.length;i+=2){var a=o[i],s=o[i+1];"style"===a?md(r,s):"dangerouslySetInnerHTML"===a?Qb(r,s):"children"===a?Rb(r,s):Xa(r,a,s,t)}switch(e){case"input":Cb(r,n);break;case"textarea":Kb(r,n);break;case"select":t=r._wrapperState.wasMultiple,r._wrapperState.wasMultiple=!!n.multiple,null!=(e=n.value)?Hb(r,!!n.multiple,e,!1):t!==!!n.multiple&&(null!=n.defaultValue?Hb(r,!!n.multiple,n.defaultValue,!0):Hb(r,!!n.multiple,n.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(u(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Vc(t.containerInfo)));case 13:if(r=t,null===t.memoizedState?n=!1:(n=!0,r=t.child,Ti=$f()),null!==r)e:for(e=r;;){if(5===e.tag)o=e.stateNode,n?"function"==typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,i=null!=(i=e.memoizedProps.style)&&i.hasOwnProperty("display")?i.display:null,o.style.display=ld("display",i));else if(6===e.tag)e.stateNode.nodeValue=n?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===r)break;for(;null===e.sibling;){if(null===e.return||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void Ui(t);case 19:return void Ui(t)}throw Error(u(163))}function Ui(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new Bi),t.forEach((function(t){var n=Vi.bind(null,e,t);r.has(t)||(r.add(t),t.then(n,n))}))}}var Wi="function"==typeof WeakMap?WeakMap:Map;function Xi(e,t,r){(r=wg(r,null)).tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Yi||(Yi=!0,Zi=n),Ci(e,t)},r}function $i(e,t,r){(r=wg(r,null)).tag=3;var n=e.type.getDerivedStateFromError;if("function"==typeof n){var i=t.value;r.payload=function(){return Ci(e,t),n(i)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(r.callback=function(){"function"!=typeof n&&(null===aj?aj=new Set([this]):aj.add(this),Ci(e,t));var r=t.stack;this.componentDidCatch(t.value,{componentStack:null!==r?r:""})}),r}var bj=Math.ceil,cj=Wa.ReactCurrentDispatcher,dj=Wa.ReactCurrentOwner,V=0,ej=8,fj=16,gj=32,ti=0,hj=1,ij=2,ui=3,vi=4,jj=5,W=V,T=null,X=null,U=0,S=ti,kj=null,lj=1073741823,mj=1073741823,nj=null,wi=0,oj=!1,Ti=0,pj=500,Y=null,Yi=!1,Zi=null,aj=null,qj=!1,rj=null,sj=90,tj=null,uj=0,vj=null,wj=0,Rj;function Gg(){return(W&(fj|gj))!==V?1073741821-($f()/10|0):0!==wj?wj:wj=1073741821-($f()/10|0)}function Hg(e,t,r){if(0==(2&(t=t.mode)))return 1073741823;var n=ag();if(0==(4&t))return 99===n?1073741823:1073741822;if((W&fj)!==V)return U;if(null!==r)e=hg(e,0|r.timeoutMs||5e3,250);else switch(n){case 99:e=1073741823;break;case 98:e=hg(e,150,100);break;case 97:case 96:e=hg(e,5e3,250);break;case 95:e=2;break;default:throw Error(u(326))}return null!==T&&e===U&&--e,e}function Ig(e,t){if(50<uj)throw uj=0,vj=null,Error(u(185));if(null!==(e=xj(e,t))){var r=ag();1073741823===t?(W&ej)!==V&&(W&(fj|gj))===V?yj(e):(Z(e),W===V&&gg()):Z(e),(4&W)===V||98!==r&&99!==r||(null===tj?tj=new Map([[e,t]]):(void 0===(r=tj.get(e))||r>t)&&tj.set(e,t))}}function xj(e,t){e.expirationTime<t&&(e.expirationTime=t);var r=e.alternate;null!==r&&r.expirationTime<t&&(r.expirationTime=t);var n=e.return,i=null;if(null===n&&3===e.tag)i=e.stateNode;else for(;null!==n;){if(r=n.alternate,n.childExpirationTime<t&&(n.childExpirationTime=t),null!==r&&r.childExpirationTime<t&&(r.childExpirationTime=t),null===n.return&&3===n.tag){i=n.stateNode;break}n=n.return}return null!==i&&(T===i&&(Bg(t),S===vi&&xi(i,U)),yi(i,t)),i}function zj(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!Aj(e,t=e.firstPendingTime))return t;var r=e.lastPingedTime;return 2>=(e=r>(e=e.nextKnownPendingLevel)?r:e)&&t!==e?0:e}function Z(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=eg(yj.bind(null,e));else{var t=zj(e),r=e.callbackNode;if(0===t)null!==r&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var n=Gg();if(1073741823===t?n=99:1===t||2===t?n=95:n=0>=(n=10*(1073741821-t)-10*(1073741821-n))?99:250>=n?98:5250>=n?97:95,null!==r){var i=e.callbackPriority;if(e.callbackExpirationTime===t&&i>=n)return;r!==Tf&&Kf(r)}e.callbackExpirationTime=t,e.callbackPriority=n,t=1073741823===t?eg(yj.bind(null,e)):dg(n,Bj.bind(null,e),{timeout:10*(1073741821-t)-$f()}),e.callbackNode=t}}}function Bj(e,t){if(wj=0,t)return Cj(e,t=Gg()),Z(e),null;var r=zj(e);if(0!==r){if(t=e.callbackNode,(W&(fj|gj))!==V)throw Error(u(327));if(Dj(),e===T&&r===U||Ej(e,r),null!==X){var n=W;W|=fj;for(var i=Fj();;)try{Gj();break}catch(t){Hj(e,t)}if(ng(),W=n,cj.current=i,S===hj)throw t=kj,Ej(e,r),xi(e,r),Z(e),t;if(null===X)switch(i=e.finishedWork=e.current.alternate,e.finishedExpirationTime=r,n=S,T=null,n){case ti:case hj:throw Error(u(345));case ij:Cj(e,2<r?2:r);break;case ui:if(xi(e,r),r===(n=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=Ij(i)),1073741823===lj&&10<(i=Ti+pj-$f())){if(oj){var o=e.lastPingedTime;if(0===o||o>=r){e.lastPingedTime=r,Ej(e,r);break}}if(0!==(o=zj(e))&&o!==r)break;if(0!==n&&n!==r){e.lastPingedTime=n;break}e.timeoutHandle=Hd(Jj.bind(null,e),i);break}Jj(e);break;case vi:if(xi(e,r),r===(n=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=Ij(i)),oj&&(0===(i=e.lastPingedTime)||i>=r)){e.lastPingedTime=r,Ej(e,r);break}if(0!==(i=zj(e))&&i!==r)break;if(0!==n&&n!==r){e.lastPingedTime=n;break}if(1073741823!==mj?n=10*(1073741821-mj)-$f():1073741823===lj?n=0:(n=10*(1073741821-lj)-5e3,0>(n=(i=$f())-n)&&(n=0),(r=10*(1073741821-r)-i)<(n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*bj(n/1960))-n)&&(n=r)),10<n){e.timeoutHandle=Hd(Jj.bind(null,e),n);break}Jj(e);break;case jj:if(1073741823!==lj&&null!==nj){o=lj;var a=nj;if(0>=(n=0|a.busyMinDurationMs)?n=0:(i=0|a.busyDelayMs,n=(o=$f()-(10*(1073741821-o)-(0|a.timeoutMs||5e3)))<=i?0:i+n-o),10<n){xi(e,r),e.timeoutHandle=Hd(Jj.bind(null,e),n);break}}Jj(e);break;default:throw Error(u(329))}if(Z(e),e.callbackNode===t)return Bj.bind(null,e)}}return null}function yj(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,(W&(fj|gj))!==V)throw Error(u(327));if(Dj(),e===T&&t===U||Ej(e,t),null!==X){var r=W;W|=fj;for(var n=Fj();;)try{Kj();break}catch(t){Hj(e,t)}if(ng(),W=r,cj.current=n,S===hj)throw r=kj,Ej(e,t),xi(e,t),Z(e),r;if(null!==X)throw Error(u(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,T=null,Jj(e),Z(e)}return null}function Lj(){if(null!==tj){var e=tj;tj=null,e.forEach((function(e,t){Cj(t,e),Z(t)})),gg()}}function Mj(e,t){var r=W;W|=1;try{return e(t)}finally{(W=r)===V&&gg()}}function Nj(e,t){var r=W;W&=-2,W|=ej;try{return e(t)}finally{(W=r)===V&&gg()}}function Ej(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var r=e.timeoutHandle;if(-1!==r&&(e.timeoutHandle=-1,Id(r)),null!==X)for(r=X.return;null!==r;){var n=r;switch(n.tag){case 1:null!=(n=n.type.childContextTypes)&&Df();break;case 3:eh(),H(K),H(J);break;case 5:gh(n);break;case 4:eh();break;case 13:case 19:H(M);break;case 10:og(n)}r=r.return}T=e,X=Sg(e.current,null),U=t,S=ti,kj=null,mj=lj=1073741823,nj=null,wi=0,oj=!1}function Hj(e,t){for(;;){try{if(ng(),jh.current=sh,mh)for(var r=N.memoizedState;null!==r;){var n=r.queue;null!==n&&(n.pending=null),r=r.next}if(lh=0,P=O=N=null,mh=!1,null===X||null===X.return)return S=hj,kj=t,X=null;e:{var i=e,o=X.return,a=X,s=t;if(t=U,a.effectTag|=2048,a.firstEffect=a.lastEffect=null,null!==s&&"object"==typeof s&&"function"==typeof s.then){var c=s;if(0==(2&a.mode)){var u=a.alternate;u?(a.updateQueue=u.updateQueue,a.memoizedState=u.memoizedState,a.expirationTime=u.expirationTime):(a.updateQueue=null,a.memoizedState=null)}var l=0!=(1&M.current),d=o;do{var p;if(p=13===d.tag){var f=d.memoizedState;if(null!==f)p=null!==f.dehydrated;else{var h=d.memoizedProps;p=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!l)}}if(p){var m=d.updateQueue;if(null===m){var g=new Set;g.add(c),d.updateQueue=g}else m.add(c);if(0==(2&d.mode)){if(d.effectTag|=64,a.effectTag&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var v=wg(1073741823,null);v.tag=2,xg(a,v)}a.expirationTime=1073741823;break e}s=void 0,a=t;var y=i.pingCache;if(null===y?(y=i.pingCache=new Wi,s=new Set,y.set(c,s)):void 0===(s=y.get(c))&&(s=new Set,y.set(c,s)),!s.has(a)){s.add(a);var b=Oj.bind(null,i,c,a);c.then(b,b)}d.effectTag|=4096,d.expirationTime=t;break e}d=d.return}while(null!==d);s=Error((pb(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+qb(a))}S!==jj&&(S=ij),s=Ai(s,a),d=o;do{switch(d.tag){case 3:c=s,d.effectTag|=4096,d.expirationTime=t,yg(d,Xi(d,c,t));break e;case 1:c=s;var _=d.type,T=d.stateNode;if(0==(64&d.effectTag)&&("function"==typeof _.getDerivedStateFromError||null!==T&&"function"==typeof T.componentDidCatch&&(null===aj||!aj.has(T)))){d.effectTag|=4096,d.expirationTime=t,yg(d,$i(d,c,t));break e}}d=d.return}while(null!==d)}X=Pj(X)}catch(e){t=e;continue}break}}function Fj(){var e=cj.current;return cj.current=sh,null===e?sh:e}function Ag(e,t){e<lj&&2<e&&(lj=e),null!==t&&e<mj&&2<e&&(mj=e,nj=t)}function Bg(e){e>wi&&(wi=e)}function Kj(){for(;null!==X;)X=Qj(X)}function Gj(){for(;null!==X&&!Uf();)X=Qj(X)}function Qj(e){var t=Rj(e.alternate,e,U);return e.memoizedProps=e.pendingProps,null===t&&(t=Pj(e)),dj.current=null,t}function Pj(e){X=e;do{var t=X.alternate;if(e=X.return,0==(2048&X.effectTag)){if(t=si(t,X,U),1===U||1!==X.childExpirationTime){for(var r=0,n=X.child;null!==n;){var i=n.expirationTime,o=n.childExpirationTime;i>r&&(r=i),o>r&&(r=o),n=n.sibling}X.childExpirationTime=r}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=X.firstEffect),null!==X.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=X.firstEffect),e.lastEffect=X.lastEffect),1<X.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=X:e.firstEffect=X,e.lastEffect=X))}else{if(null!==(t=zi(X)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=X.sibling))return t;X=e}while(null!==X);return S===ti&&(S=jj),null}function Ij(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function Jj(e){var t=ag();return cg(99,Sj.bind(null,e,t)),null}function Sj(e,t){do{Dj()}while(null!==rj);if((W&(fj|gj))!==V)throw Error(u(327));var r=e.finishedWork,n=e.finishedExpirationTime;if(null===r)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,r===e.current)throw Error(u(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var i=Ij(r);if(e.firstPendingTime=i,n<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:n<=e.firstSuspendedTime&&(e.firstSuspendedTime=n-1),n<=e.lastPingedTime&&(e.lastPingedTime=0),n<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===T&&(X=T=null,U=0),1<r.effectTag?null!==r.lastEffect?(r.lastEffect.nextEffect=r,i=r.firstEffect):i=r:i=r.firstEffect,null!==i){var o=W;W|=gj,dj.current=null,Dd=fd;var a=xd();if(yd(a)){if("selectionStart"in a)var s={start:a.selectionStart,end:a.selectionEnd};else e:{var c=(s=(s=a.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(c&&0!==c.rangeCount){s=c.anchorNode;var l=c.anchorOffset,d=c.focusNode;c=c.focusOffset;try{s.nodeType,d.nodeType}catch(e){s=null;break e}var p=0,f=-1,h=-1,m=0,g=0,v=a,y=null;t:for(;;){for(var b;v!==s||0!==l&&3!==v.nodeType||(f=p+l),v!==d||0!==c&&3!==v.nodeType||(h=p+c),3===v.nodeType&&(p+=v.nodeValue.length),null!==(b=v.firstChild);)y=v,v=b;for(;;){if(v===a)break t;if(y===s&&++m===l&&(f=p),y===d&&++g===c&&(h=p),null!==(b=v.nextSibling))break;y=(v=y).parentNode}v=b}s=-1===f||-1===h?null:{start:f,end:h}}else s=null}s=s||{start:0,end:0}}else s=null;Ed={activeElementDetached:null,focusedElem:a,selectionRange:s},fd=!1,Y=i;do{try{Tj()}catch(e){if(null===Y)throw Error(u(330));Ei(Y,e),Y=Y.nextEffect}}while(null!==Y);Y=i;do{try{for(a=e,s=t;null!==Y;){var S=Y.effectTag;if(16&S&&Rb(Y.stateNode,""),128&S){var _=Y.alternate;if(null!==_){var M=_.ref;null!==M&&("function"==typeof M?M(null):M.current=null)}}switch(1038&S){case 2:Pi(Y),Y.effectTag&=-3;break;case 6:Pi(Y),Y.effectTag&=-3,Si(Y.alternate,Y);break;case 1024:Y.effectTag&=-1025;break;case 1028:Y.effectTag&=-1025,Si(Y.alternate,Y);break;case 4:Si(Y.alternate,Y);break;case 8:Mi(a,l=Y,s),Ni(l)}Y=Y.nextEffect}}catch(e){if(null===Y)throw Error(u(330));Ei(Y,e),Y=Y.nextEffect}}while(null!==Y);if(M=Ed,_=xd(),S=M.focusedElem,s=M.selectionRange,_!==S&&S&&S.ownerDocument&&wd(S.ownerDocument.documentElement,S)){null!==s&&yd(S)&&(_=s.start,void 0===(M=s.end)&&(M=_),"selectionStart"in S?(S.selectionStart=_,S.selectionEnd=Math.min(M,S.value.length)):(M=(_=S.ownerDocument||document)&&_.defaultView||window).getSelection&&(M=M.getSelection(),l=S.textContent.length,a=Math.min(s.start,l),s=void 0===s.end?a:Math.min(s.end,l),!M.extend&&a>s&&(l=s,s=a,a=l),l=vd(S,a),d=vd(S,s),l&&d&&(1!==M.rangeCount||M.anchorNode!==l.node||M.anchorOffset!==l.offset||M.focusNode!==d.node||M.focusOffset!==d.offset)&&((_=_.createRange()).setStart(l.node,l.offset),M.removeAllRanges(),a>s?(M.addRange(_),M.extend(d.node,d.offset)):(_.setEnd(d.node,d.offset),M.addRange(_))))),_=[];for(M=S;M=M.parentNode;)1===M.nodeType&&_.push({element:M,left:M.scrollLeft,top:M.scrollTop});for("function"==typeof S.focus&&S.focus(),S=0;S<_.length;S++)(M=_[S]).element.scrollLeft=M.left,M.element.scrollTop=M.top}fd=!!Dd,Ed=Dd=null,e.current=r,Y=i;do{try{for(S=e;null!==Y;){var w=Y.effectTag;if(36&w&&Ji(S,Y.alternate,Y),128&w){_=void 0;var x=Y.ref;if(null!==x){var I=Y.stateNode;Y.tag,_=I,"function"==typeof x?x(_):x.current=_}}Y=Y.nextEffect}}catch(e){if(null===Y)throw Error(u(330));Ei(Y,e),Y=Y.nextEffect}}while(null!==Y);Y=null,Vf(),W=o}else e.current=r;if(qj)qj=!1,rj=e,sj=t;else for(Y=i;null!==Y;)t=Y.nextEffect,Y.nextEffect=null,Y=t;if(0===(t=e.firstPendingTime)&&(aj=null),1073741823===t?e===vj?uj++:(uj=0,vj=e):uj=0,"function"==typeof Uj&&Uj(r.stateNode,n),Z(e),Yi)throw Yi=!1,e=Zi,Zi=null,e;return(W&ej)!==V||gg(),null}function Tj(){for(;null!==Y;){var e=Y.effectTag;0!=(256&e)&&Gi(Y.alternate,Y),0==(512&e)||qj||(qj=!0,dg(97,(function(){return Dj(),null}))),Y=Y.nextEffect}}function Dj(){if(90!==sj){var e=97<sj?97:sj;return sj=90,cg(e,Vj)}}function Vj(){if(null===rj)return!1;var e=rj;if(rj=null,(W&(fj|gj))!==V)throw Error(u(331));var t=W;for(W|=gj,e=e.current.firstEffect;null!==e;){try{var r=e;if(0!=(512&r.effectTag))switch(r.tag){case 0:case 11:case 15:case 22:Hi(5,r),Ii(5,r)}}catch(t){if(null===e)throw Error(u(330));Ei(e,t)}r=e.nextEffect,e.nextEffect=null,e=r}return W=t,gg(),!0}function Wj(e,t,r){xg(e,t=Xi(e,t=Ai(r,t),1073741823)),null!==(e=xj(e,1073741823))&&Z(e)}function Ei(e,t){if(3===e.tag)Wj(e,e,t);else for(var r=e.return;null!==r;){if(3===r.tag){Wj(r,e,t);break}if(1===r.tag){var n=r.stateNode;if("function"==typeof r.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===aj||!aj.has(n))){xg(r,e=$i(r,e=Ai(t,e),1073741823)),null!==(r=xj(r,1073741823))&&Z(r);break}}r=r.return}}function Oj(e,t,r){var n=e.pingCache;null!==n&&n.delete(t),T===e&&U===r?S===vi||S===ui&&1073741823===lj&&$f()-Ti<pj?Ej(e,U):oj=!0:Aj(e,r)&&(0!==(t=e.lastPingedTime)&&t<r||(e.lastPingedTime=r,Z(e)))}function Vi(e,t){var r=e.stateNode;null!==r&&r.delete(t),0===(t=0)&&(t=Hg(t=Gg(),e,null)),null!==(e=xj(e,t))&&Z(e)}Rj=function(e,t,r){var n=t.expirationTime;if(null!==e){var i=t.pendingProps;if(e.memoizedProps!==i||K.current)rg=!0;else{if(n<r){switch(rg=!1,t.tag){case 3:hi(t),Xh();break;case 5:if(fh(t),4&t.mode&&1!==r&&i.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:L(t.type)&&Gf(t);break;case 4:dh(t,t.stateNode.containerInfo);break;case 10:n=t.memoizedProps.value,i=t.type._context,I(jg,i._currentValue),i._currentValue=n;break;case 13:if(null!==t.memoizedState)return 0!==(n=t.child.childExpirationTime)&&n>=r?ji(e,t,r):(I(M,1&M.current),null!==(t=$h(e,t,r))?t.sibling:null);I(M,1&M.current);break;case 19:if(n=t.childExpirationTime>=r,0!=(64&e.effectTag)){if(n)return mi(e,t,r);t.effectTag|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null),I(M,M.current),!n)return null}return $h(e,t,r)}rg=!1}}else rg=!1;switch(t.expirationTime=0,t.tag){case 2:if(n=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,i=Cf(t,J.current),qg(t,r),i=oh(null,t,n,e,i,r),t.effectTag|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,L(n)){var o=!0;Gf(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,ug(t);var a=n.getDerivedStateFromProps;"function"==typeof a&&Fg(t,n,a,e),i.updater=Jg,t.stateNode=i,i._reactInternalFiber=t,Ng(t,n,e,r),t=gi(null,t,n,!0,o,r)}else t.tag=0,R(null,t,i,r),t=t.child;return t;case 16:e:{if(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,ob(i),1!==i._status)throw i._result;switch(i=i._result,t.type=i,o=t.tag=Xj(i),e=ig(i,e),o){case 0:t=di(null,t,i,e,r);break e;case 1:t=fi(null,t,i,e,r);break e;case 11:t=Zh(null,t,i,e,r);break e;case 14:t=ai(null,t,i,ig(i.type,e),n,r);break e}throw Error(u(306,i,""))}return t;case 0:return n=t.type,i=t.pendingProps,di(e,t,n,i=t.elementType===n?i:ig(n,i),r);case 1:return n=t.type,i=t.pendingProps,fi(e,t,n,i=t.elementType===n?i:ig(n,i),r);case 3:if(hi(t),n=t.updateQueue,null===e||null===n)throw Error(u(282));if(n=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,vg(e,t),zg(t,n,null,r),(n=t.memoizedState.element)===i)Xh(),t=$h(e,t,r);else{if((i=t.stateNode.hydrate)&&(Ph=Jd(t.stateNode.containerInfo.firstChild),Oh=t,i=Qh=!0),i)for(r=Yg(t,null,n,r),t.child=r;r;)r.effectTag=-3&r.effectTag|1024,r=r.sibling;else R(e,t,n,r),Xh();t=t.child}return t;case 5:return fh(t),null===e&&Uh(t),n=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,Gd(n,i)?a=null:null!==o&&Gd(n,o)&&(t.effectTag|=16),ei(e,t),4&t.mode&&1!==r&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(R(e,t,a,r),t=t.child),t;case 6:return null===e&&Uh(t),null;case 13:return ji(e,t,r);case 4:return dh(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Xg(t,null,n,r):R(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,Zh(e,t,n,i=t.elementType===n?i:ig(n,i),r);case 7:return R(e,t,t.pendingProps,r),t.child;case 8:case 12:return R(e,t,t.pendingProps.children,r),t.child;case 10:e:{n=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value;var s=t.type._context;if(I(jg,s._currentValue),s._currentValue=o,null!==a)if(s=a.value,0===(o=$e(s,o)?0:0|("function"==typeof n._calculateChangedBits?n._calculateChangedBits(s,o):1073741823))){if(a.children===i.children&&!K.current){t=$h(e,t,r);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var c=s.dependencies;if(null!==c){a=s.child;for(var l=c.firstContext;null!==l;){if(l.context===n&&0!=(l.observedBits&o)){1===s.tag&&((l=wg(r,null)).tag=2,xg(s,l)),s.expirationTime<r&&(s.expirationTime=r),null!==(l=s.alternate)&&l.expirationTime<r&&(l.expirationTime=r),pg(s.return,r),c.expirationTime<r&&(c.expirationTime=r);break}l=l.next}}else a=10===s.tag&&s.type===t.type?null:s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}R(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=(o=t.pendingProps).children,qg(t,r),n=n(i=sg(i,o.unstable_observedBits)),t.effectTag|=1,R(e,t,n,r),t.child;case 14:return o=ig(i=t.type,t.pendingProps),ai(e,t,i,o=ig(i.type,o),n,r);case 15:return ci(e,t,t.type,t.pendingProps,n,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:ig(n,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,L(n)?(e=!0,Gf(t)):e=!1,qg(t,r),Lg(t,n,i),Ng(t,n,i,r),gi(null,t,n,!0,e,r);case 19:return mi(e,t,r)}throw Error(u(156,t.tag))};var Uj=null,Li=null;function Yj(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var r=t.inject(e);Uj=function(e){try{t.onCommitFiberRoot(r,e,void 0,64==(64&e.current.effectTag))}catch(e){}},Li=function(e){try{t.onCommitFiberUnmount(r,e)}catch(e){}}}catch(e){}return!0}function Zj(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Sh(e,t,r,n){return new Zj(e,t,r,n)}function bi(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Xj(e){if("function"==typeof e)return bi(e)?1:0;if(null!=e){if((e=e.$$typeof)===gb)return 11;if(e===jb)return 14}return 2}function Sg(e,t){var r=e.alternate;return null===r?((r=Sh(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.effectTag=0,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null),r.childExpirationTime=e.childExpirationTime,r.expirationTime=e.expirationTime,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Ug(e,t,r,n,i,o){var a=2;if(n=e,"function"==typeof e)bi(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case ab:return Wg(r.children,i,o,t);case fb:a=8,i|=7;break;case bb:a=8,i|=1;break;case cb:return(e=Sh(12,r,t,8|i)).elementType=cb,e.type=cb,e.expirationTime=o,e;case hb:return(e=Sh(13,r,t,i)).type=hb,e.elementType=hb,e.expirationTime=o,e;case ib:return(e=Sh(19,r,t,i)).elementType=ib,e.expirationTime=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case db:a=10;break e;case eb:a=9;break e;case gb:a=11;break e;case jb:a=14;break e;case kb:a=16,n=null;break e;case lb:a=22;break e}throw Error(u(130,null==e?e:typeof e,""))}return(t=Sh(a,r,t,i)).elementType=e,t.type=n,t.expirationTime=o,t}function Wg(e,t,r,n){return(e=Sh(7,e,n,t)).expirationTime=r,e}function Tg(e,t,r){return(e=Sh(6,e,null,t)).expirationTime=r,e}function Vg(e,t,r){return(t=Sh(4,null!==e.children?e.children:[],e.key,t)).expirationTime=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ak(e,t,r){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=r,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Aj(e,t){var r=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==r&&r>=t&&e<=t}function xi(e,t){var r=e.firstSuspendedTime,n=e.lastSuspendedTime;r<t&&(e.firstSuspendedTime=t),(n>t||0===r)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function yi(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var r=e.firstSuspendedTime;0!==r&&(t>=r?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Cj(e,t){var r=e.lastExpiredTime;(0===r||r>t)&&(e.lastExpiredTime=t)}function bk(e,t,r,n){var i=t.current,o=Gg(),a=Dg.suspense;o=Hg(o,i,a);e:if(r){t:{if(dc(r=r._reactInternalFiber)!==r||1!==r.tag)throw Error(u(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(L(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}s=s.return}while(null!==s);throw Error(u(171))}if(1===r.tag){var c=r.type;if(L(c)){r=Ff(r,c,s);break e}}r=s}else r=Af;return null===t.context?t.context=r:t.pendingContext=r,(t=wg(o,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),xg(i,t),Ig(i,o),o}function ck(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function dk(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function ek(e,t){dk(e,t),(e=e.alternate)&&dk(e,t)}function fk(e,t,r){var n=new ak(e,t,r=null!=r&&!0===r.hydrate),i=Sh(3,null,null,2===t?7:1===t?3:0);n.current=i,i.stateNode=n,ug(i),e[Od]=n.current,r&&0!==t&&Jc(e,9===e.nodeType?e:e.ownerDocument),this._internalRoot=n}function gk(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function hk(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var r;r=e.lastChild;)e.removeChild(r);return new fk(e,0,t?{hydrate:!0}:void 0)}function ik(e,t,r,n,i){var o=r._reactRootContainer;if(o){var a=o._internalRoot;if("function"==typeof i){var s=i;i=function(){var e=ck(a);s.call(e)}}bk(t,a,e,i)}else{if(o=r._reactRootContainer=hk(r,n),a=o._internalRoot,"function"==typeof i){var c=i;i=function(){var e=ck(a);c.call(e)}}Nj((function(){bk(t,a,e,i)}))}return ck(a)}function jk(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:$a,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}}function kk(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!gk(t))throw Error(u(200));return jk(e,t,null,r)}fk.prototype.render=function(e){bk(e,this._internalRoot,null,null)},fk.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;bk(null,e,null,(function(){t[Od]=null}))},wc=function(e){if(13===e.tag){var t=hg(Gg(),150,100);Ig(e,t),ek(e,t)}},xc=function(e){13===e.tag&&(Ig(e,3),ek(e,3))},yc=function(e){if(13===e.tag){var t=Gg();Ig(e,t=Hg(t,e,null)),ek(e,t)}},za=function(e,t,r){switch(t){case"input":if(Cb(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=Qd(n);if(!i)throw Error(u(90));yb(n),Cb(n,i)}}}break;case"textarea":Kb(e,r);break;case"select":null!=(t=r.value)&&Hb(e,!!r.multiple,t,!1)}},Fa=Mj,Ga=function(e,t,r,n,i){var o=W;W|=4;try{return cg(98,e.bind(null,t,r,n,i))}finally{(W=o)===V&&gg()}},Ha=function(){(W&(1|fj|gj))===V&&(Lj(),Dj())},Ia=function(e,t){var r=W;W|=2;try{return e(t)}finally{(W=r)===V&&gg()}};var lk={Events:[Nc,Pd,Qd,xa,ta,Xd,function(e){jc(e,Wd)},Da,Ea,id,mc,Dj,{current:!1}]};function checkDCE(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}!function(e){var t=e.findFiberByHostInstance;Yj(n({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wa.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=hc(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:tc,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}),reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lk,reactDom_production_min.createPortal=kk,reactDom_production_min.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(u(188));throw Error(u(268,Object.keys(e)))}return e=null===(e=hc(t))?null:e.stateNode},reactDom_production_min.flushSync=function(e,t){if((W&(fj|gj))!==V)throw Error(u(187));var r=W;W|=1;try{return cg(99,e.bind(null,t))}finally{W=r,gg()}},reactDom_production_min.hydrate=function(e,t,r){if(!gk(t))throw Error(u(200));return ik(null,e,t,!0,r)},reactDom_production_min.render=function(e,t,r){if(!gk(t))throw Error(u(200));return ik(null,e,t,!1,r)},reactDom_production_min.unmountComponentAtNode=function(e){if(!gk(e))throw Error(u(40));return!!e._reactRootContainer&&(Nj((function(){ik(null,null,e,!1,(function(){e._reactRootContainer=null,e[Od]=null}))})),!0)},reactDom_production_min.unstable_batchedUpdates=Mj,reactDom_production_min.unstable_createPortal=function(e,t){return kk(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!gk(r))throw Error(u(200));if(null==e||void 0===e._reactInternalFiber)throw Error(u(38));return ik(e,t,r,!1,n)},reactDom_production_min.version="16.14.0",checkDCE(),reactDom.exports=reactDom_production_min;var ReactDOM=reactDom.exports,ReactDOM$1=_mergeNamespaces({__proto__:null,default:ReactDOM},[reactDom.exports]);function isObject$8(e){return null!==e&&"object"==typeof e&&"constructor"in e&&e.constructor===Object}function extend$4(e={},t={}){Object.keys(t).forEach((r=>{void 0===e[r]?e[r]=t[r]:isObject$8(t[r])&&isObject$8(e[r])&&Object.keys(t[r]).length>0&&extend$4(e[r],t[r])}))}const ssrDocument={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector:()=>null,querySelectorAll:()=>[],getElementById:()=>null,createEvent:()=>({initEvent(){}}),createElement:()=>({children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName:()=>[]}),createElementNS:()=>({}),importNode:()=>null,location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function getDocument(){const e="undefined"!=typeof document?document:{};return extend$4(e,ssrDocument),e}const ssrWindow={document:ssrDocument,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle:()=>({getPropertyValue:()=>""}),Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia:()=>({}),requestAnimationFrame:e=>"undefined"==typeof setTimeout?(e(),null):setTimeout(e,0),cancelAnimationFrame(e){"undefined"!=typeof setTimeout&&clearTimeout(e)}};function getWindow(){const e="undefined"!=typeof window?window:{};return extend$4(e,ssrWindow),e}function makeReactive(e){const t=e.__proto__;Object.defineProperty(e,"__proto__",{get:()=>t,set(e){t.__proto__=e}})}class Dom7 extends Array{constructor(e){"number"==typeof e?super(e):(super(...e||[]),makeReactive(this))}}function arrayFlat(e=[]){const t=[];return e.forEach((e=>{Array.isArray(e)?t.push(...arrayFlat(e)):t.push(e)})),t}function arrayFilter(e,t){return Array.prototype.filter.call(e,t)}function arrayUnique(e){const t=[];for(let r=0;r<e.length;r+=1)-1===t.indexOf(e[r])&&t.push(e[r]);return t}function qsa(e,t){if("string"!=typeof e)return[e];const r=[],n=t.querySelectorAll(e);for(let e=0;e<n.length;e+=1)r.push(n[e]);return r}function $(e,t){const r=getWindow(),n=getDocument();let i=[];if(!t&&e instanceof Dom7)return e;if(!e)return new Dom7(i);if("string"==typeof e){const r=e.trim();if(r.indexOf("<")>=0&&r.indexOf(">")>=0){let e="div";0===r.indexOf("<li")&&(e="ul"),0===r.indexOf("<tr")&&(e="tbody"),0!==r.indexOf("<td")&&0!==r.indexOf("<th")||(e="tr"),0===r.indexOf("<tbody")&&(e="table"),0===r.indexOf("<option")&&(e="select");const t=n.createElement(e);t.innerHTML=r;for(let e=0;e<t.childNodes.length;e+=1)i.push(t.childNodes[e])}else i=qsa(e.trim(),t||n)}else if(e.nodeType||e===r||e===n)i.push(e);else if(Array.isArray(e)){if(e instanceof Dom7)return e;i=e}return new Dom7(arrayUnique(i))}function addClass(...e){const t=arrayFlat(e.map((e=>e.split(" "))));return this.forEach((e=>{e.classList.add(...t)})),this}function removeClass(...e){const t=arrayFlat(e.map((e=>e.split(" "))));return this.forEach((e=>{e.classList.remove(...t)})),this}function toggleClass(...e){const t=arrayFlat(e.map((e=>e.split(" "))));this.forEach((e=>{t.forEach((t=>{e.classList.toggle(t)}))}))}function hasClass(...e){const t=arrayFlat(e.map((e=>e.split(" "))));return arrayFilter(this,(e=>t.filter((t=>e.classList.contains(t))).length>0)).length>0}function attr(e,t){if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(let r=0;r<this.length;r+=1)if(2===arguments.length)this[r].setAttribute(e,t);else for(const t in e)this[r][t]=e[t],this[r].setAttribute(t,e[t]);return this}function removeAttr(e){for(let t=0;t<this.length;t+=1)this[t].removeAttribute(e);return this}function transform(e){for(let t=0;t<this.length;t+=1)this[t].style.transform=e;return this}function transition$1(e){for(let t=0;t<this.length;t+=1)this[t].style.transitionDuration="string"!=typeof e?`${e}ms`:e;return this}function on(...e){let[t,r,n,i]=e;function o(e){const t=e.target;if(!t)return;const i=e.target.dom7EventData||[];if(i.indexOf(e)<0&&i.unshift(e),$(t).is(r))n.apply(t,i);else{const e=$(t).parents();for(let t=0;t<e.length;t+=1)$(e[t]).is(r)&&n.apply(e[t],i)}}function a(e){const t=e&&e.target&&e.target.dom7EventData||[];t.indexOf(e)<0&&t.unshift(e),n.apply(this,t)}"function"==typeof e[1]&&([t,n,i]=e,r=void 0),i||(i=!1);const s=t.split(" ");let c;for(let e=0;e<this.length;e+=1){const t=this[e];if(r)for(c=0;c<s.length;c+=1){const e=s[c];t.dom7LiveListeners||(t.dom7LiveListeners={}),t.dom7LiveListeners[e]||(t.dom7LiveListeners[e]=[]),t.dom7LiveListeners[e].push({listener:n,proxyListener:o}),t.addEventListener(e,o,i)}else for(c=0;c<s.length;c+=1){const e=s[c];t.dom7Listeners||(t.dom7Listeners={}),t.dom7Listeners[e]||(t.dom7Listeners[e]=[]),t.dom7Listeners[e].push({listener:n,proxyListener:a}),t.addEventListener(e,a,i)}}return this}function off(...e){let[t,r,n,i]=e;"function"==typeof e[1]&&([t,n,i]=e,r=void 0),i||(i=!1);const o=t.split(" ");for(let e=0;e<o.length;e+=1){const t=o[e];for(let e=0;e<this.length;e+=1){const o=this[e];let a;if(!r&&o.dom7Listeners?a=o.dom7Listeners[t]:r&&o.dom7LiveListeners&&(a=o.dom7LiveListeners[t]),a&&a.length)for(let e=a.length-1;e>=0;e-=1){const r=a[e];n&&r.listener===n||n&&r.listener&&r.listener.dom7proxy&&r.listener.dom7proxy===n?(o.removeEventListener(t,r.proxyListener,i),a.splice(e,1)):n||(o.removeEventListener(t,r.proxyListener,i),a.splice(e,1))}}}return this}function trigger(...e){const t=getWindow(),r=e[0].split(" "),n=e[1];for(let i=0;i<r.length;i+=1){const o=r[i];for(let r=0;r<this.length;r+=1){const i=this[r];if(t.CustomEvent){const r=new t.CustomEvent(o,{detail:n,bubbles:!0,cancelable:!0});i.dom7EventData=e.filter(((e,t)=>t>0)),i.dispatchEvent(r),i.dom7EventData=[],delete i.dom7EventData}}}return this}function transitionEnd$1(e){const t=this;return e&&t.on("transitionend",(function r(n){n.target===this&&(e.call(this,n),t.off("transitionend",r))})),this}function outerWidth(e){if(this.length>0){if(e){const e=this.styles();return this[0].offsetWidth+parseFloat(e.getPropertyValue("margin-right"))+parseFloat(e.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null}function outerHeight(e){if(this.length>0){if(e){const e=this.styles();return this[0].offsetHeight+parseFloat(e.getPropertyValue("margin-top"))+parseFloat(e.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null}function offset(){if(this.length>0){const e=getWindow(),t=getDocument(),r=this[0],n=r.getBoundingClientRect(),i=t.body,o=r.clientTop||i.clientTop||0,a=r.clientLeft||i.clientLeft||0,s=r===e?e.scrollY:r.scrollTop,c=r===e?e.scrollX:r.scrollLeft;return{top:n.top+s-o,left:n.left+c-a}}return null}function styles(){const e=getWindow();return this[0]?e.getComputedStyle(this[0],null):{}}function css(e,t){const r=getWindow();let n;if(1===arguments.length){if("string"!=typeof e){for(n=0;n<this.length;n+=1)for(const t in e)this[n].style[t]=e[t];return this}if(this[0])return r.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(n=0;n<this.length;n+=1)this[n].style[e]=t;return this}return this}function each$1(e){return e?(this.forEach(((t,r)=>{e.apply(t,[t,r])})),this):this}function filter(e){return $(arrayFilter(this,e))}function html(e){if(void 0===e)return this[0]?this[0].innerHTML:null;for(let t=0;t<this.length;t+=1)this[t].innerHTML=e;return this}function text(e){if(void 0===e)return this[0]?this[0].textContent.trim():null;for(let t=0;t<this.length;t+=1)this[t].textContent=e;return this}function is$1(e){const t=getWindow(),r=getDocument(),n=this[0];let i,o;if(!n||void 0===e)return!1;if("string"==typeof e){if(n.matches)return n.matches(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);for(i=$(e),o=0;o<i.length;o+=1)if(i[o]===n)return!0;return!1}if(e===r)return n===r;if(e===t)return n===t;if(e.nodeType||e instanceof Dom7){for(i=e.nodeType?[e]:e,o=0;o<i.length;o+=1)if(i[o]===n)return!0;return!1}return!1}function index$1(){let e,t=this[0];if(t){for(e=0;null!==(t=t.previousSibling);)1===t.nodeType&&(e+=1);return e}}function eq$3(e){if(void 0===e)return this;const t=this.length;if(e>t-1)return $([]);if(e<0){const r=t+e;return $(r<0?[]:[this[r]])}return $([this[e]])}function append(...e){let t;const r=getDocument();for(let n=0;n<e.length;n+=1){t=e[n];for(let e=0;e<this.length;e+=1)if("string"==typeof t){const n=r.createElement("div");for(n.innerHTML=t;n.firstChild;)this[e].appendChild(n.firstChild)}else if(t instanceof Dom7)for(let r=0;r<t.length;r+=1)this[e].appendChild(t[r]);else this[e].appendChild(t)}return this}function prepend(e){const t=getDocument();let r,n;for(r=0;r<this.length;r+=1)if("string"==typeof e){const i=t.createElement("div");for(i.innerHTML=e,n=i.childNodes.length-1;n>=0;n-=1)this[r].insertBefore(i.childNodes[n],this[r].childNodes[0])}else if(e instanceof Dom7)for(n=0;n<e.length;n+=1)this[r].insertBefore(e[n],this[r].childNodes[0]);else this[r].insertBefore(e,this[r].childNodes[0]);return this}function next(e){return this.length>0?e?this[0].nextElementSibling&&$(this[0].nextElementSibling).is(e)?$([this[0].nextElementSibling]):$([]):this[0].nextElementSibling?$([this[0].nextElementSibling]):$([]):$([])}function nextAll(e){const t=[];let r=this[0];if(!r)return $([]);for(;r.nextElementSibling;){const n=r.nextElementSibling;e?$(n).is(e)&&t.push(n):t.push(n),r=n}return $(t)}function prev(e){if(this.length>0){const t=this[0];return e?t.previousElementSibling&&$(t.previousElementSibling).is(e)?$([t.previousElementSibling]):$([]):t.previousElementSibling?$([t.previousElementSibling]):$([])}return $([])}function prevAll(e){const t=[];let r=this[0];if(!r)return $([]);for(;r.previousElementSibling;){const n=r.previousElementSibling;e?$(n).is(e)&&t.push(n):t.push(n),r=n}return $(t)}function parent(e){const t=[];for(let r=0;r<this.length;r+=1)null!==this[r].parentNode&&(e?$(this[r].parentNode).is(e)&&t.push(this[r].parentNode):t.push(this[r].parentNode));return $(t)}function parents(e){const t=[];for(let r=0;r<this.length;r+=1){let n=this[r].parentNode;for(;n;)e?$(n).is(e)&&t.push(n):t.push(n),n=n.parentNode}return $(t)}function closest(e){let t=this;return void 0===e?$([]):(t.is(e)||(t=t.parents(e).eq(0)),t)}function find(e){const t=[];for(let r=0;r<this.length;r+=1){const n=this[r].querySelectorAll(e);for(let e=0;e<n.length;e+=1)t.push(n[e])}return $(t)}function children(e){const t=[];for(let r=0;r<this.length;r+=1){const n=this[r].children;for(let r=0;r<n.length;r+=1)e&&!$(n[r]).is(e)||t.push(n[r])}return $(t)}function remove(){for(let e=0;e<this.length;e+=1)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this}$.fn=Dom7.prototype;const Methods={addClass:addClass,removeClass:removeClass,hasClass:hasClass,toggleClass:toggleClass,attr:attr,removeAttr:removeAttr,transform:transform,transition:transition$1,on:on,off:off,trigger:trigger,transitionEnd:transitionEnd$1,outerWidth:outerWidth,outerHeight:outerHeight,styles:styles,offset:offset,css:css,each:each$1,html:html,text:text,is:is$1,index:index$1,eq:eq$3,append:append,prepend:prepend,next:next,nextAll:nextAll,prev:prev,prevAll:prevAll,parent:parent,parents:parents,closest:closest,find:find,children:children,filter:filter,remove:remove};function deleteProps(e){const t=e;Object.keys(t).forEach((e=>{try{t[e]=null}catch(e){}try{delete t[e]}catch(e){}}))}function nextTick(e,t){return void 0===t&&(t=0),setTimeout(e,t)}function now(){return Date.now()}function getComputedStyle$1(e){const t=getWindow();let r;return t.getComputedStyle&&(r=t.getComputedStyle(e,null)),!r&&e.currentStyle&&(r=e.currentStyle),r||(r=e.style),r}function getTranslate(e,t){void 0===t&&(t="x");const r=getWindow();let n,i,o;const a=getComputedStyle$1(e);return r.WebKitCSSMatrix?(i=a.transform||a.webkitTransform,i.split(",").length>6&&(i=i.split(", ").map((e=>e.replace(",","."))).join(", ")),o=new r.WebKitCSSMatrix("none"===i?"":i)):(o=a.MozTransform||a.OTransform||a.MsTransform||a.msTransform||a.transform||a.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=o.toString().split(",")),"x"===t&&(i=r.WebKitCSSMatrix?o.m41:16===n.length?parseFloat(n[12]):parseFloat(n[4])),"y"===t&&(i=r.WebKitCSSMatrix?o.m42:16===n.length?parseFloat(n[13]):parseFloat(n[5])),i||0}function isObject$7(e){return"object"==typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)}function isNode(e){return"undefined"!=typeof window&&void 0!==window.HTMLElement?e instanceof HTMLElement:e&&(1===e.nodeType||11===e.nodeType)}function extend$3(){const e=Object(arguments.length<=0?void 0:arguments[0]),t=["__proto__","constructor","prototype"];for(let r=1;r<arguments.length;r+=1){const n=r<0||arguments.length<=r?void 0:arguments[r];if(null!=n&&!isNode(n)){const r=Object.keys(Object(n)).filter((e=>t.indexOf(e)<0));for(let t=0,i=r.length;t<i;t+=1){const i=r[t],o=Object.getOwnPropertyDescriptor(n,i);void 0!==o&&o.enumerable&&(isObject$7(e[i])&&isObject$7(n[i])?n[i].__swiper__?e[i]=n[i]:extend$3(e[i],n[i]):!isObject$7(e[i])&&isObject$7(n[i])?(e[i]={},n[i].__swiper__?e[i]=n[i]:extend$3(e[i],n[i])):e[i]=n[i])}}}return e}function setCSSProperty(e,t,r){e.style.setProperty(t,r)}function animateCSSModeScroll(e){let{swiper:t,targetPosition:r,side:n}=e;const i=getWindow(),o=-t.translate;let a,s=null;const c=t.params.speed;t.wrapperEl.style.scrollSnapType="none",i.cancelAnimationFrame(t.cssModeFrameID);const u=r>o?"next":"prev",l=(e,t)=>"next"===u&&e>=t||"prev"===u&&e<=t,d=()=>{a=(new Date).getTime(),null===s&&(s=a);const e=Math.max(Math.min((a-s)/c,1),0),u=.5-Math.cos(e*Math.PI)/2;let p=o+u*(r-o);if(l(p,r)&&(p=r),t.wrapperEl.scrollTo({[n]:p}),l(p,r))return t.wrapperEl.style.overflow="hidden",t.wrapperEl.style.scrollSnapType="",setTimeout((()=>{t.wrapperEl.style.overflow="",t.wrapperEl.scrollTo({[n]:p})})),void i.cancelAnimationFrame(t.cssModeFrameID);t.cssModeFrameID=i.requestAnimationFrame(d)};d()}let support,deviceCached,browser$1;function calcSupport(){const e=getWindow(),t=getDocument();return{smoothScroll:t.documentElement&&"scrollBehavior"in t.documentElement.style,touch:!!("ontouchstart"in e||e.DocumentTouch&&t instanceof e.DocumentTouch),passiveListener:function(){let t=!1;try{const r=Object.defineProperty({},"passive",{get(){t=!0}});e.addEventListener("testPassiveListener",null,r)}catch(e){}return t}(),gestures:"ongesturestart"in e}}function getSupport(){return support||(support=calcSupport()),support}function calcDevice(e){let{userAgent:t}=void 0===e?{}:e;const r=getSupport(),n=getWindow(),i=n.navigator.platform,o=t||n.navigator.userAgent,a={ios:!1,android:!1},s=n.screen.width,c=n.screen.height,u=o.match(/(Android);?[\s\/]+([\d.]+)?/);let l=o.match(/(iPad).*OS\s([\d_]+)/);const d=o.match(/(iPod)(.*OS\s([\d_]+))?/),p=!l&&o.match(/(iPhone\sOS|iOS)\s([\d_]+)/),f="Win32"===i;let h="MacIntel"===i;return!l&&h&&r.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${s}x${c}`)>=0&&(l=o.match(/(Version)\/([\d.]+)/),l||(l=[0,1,"13_0_0"]),h=!1),u&&!f&&(a.os="android",a.android=!0),(l||p||d)&&(a.os="ios",a.ios=!0),a}function getDevice(e){return void 0===e&&(e={}),deviceCached||(deviceCached=calcDevice(e)),deviceCached}function calcBrowser(){const e=getWindow();return{isSafari:function(){const t=e.navigator.userAgent.toLowerCase();return t.indexOf("safari")>=0&&t.indexOf("chrome")<0&&t.indexOf("android")<0}(),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e.navigator.userAgent)}}function getBrowser(){return browser$1||(browser$1=calcBrowser()),browser$1}function Resize(e){let{swiper:t,on:r,emit:n}=e;const i=getWindow();let o=null,a=null;const s=()=>{t&&!t.destroyed&&t.initialized&&(n("beforeResize"),n("resize"))},c=()=>{t&&!t.destroyed&&t.initialized&&n("orientationchange")};r("init",(()=>{t.params.resizeObserver&&void 0!==i.ResizeObserver?t&&!t.destroyed&&t.initialized&&(o=new ResizeObserver((e=>{a=i.requestAnimationFrame((()=>{const{width:r,height:n}=t;let i=r,o=n;e.forEach((e=>{let{contentBoxSize:r,contentRect:n,target:a}=e;a&&a!==t.el||(i=n?n.width:(r[0]||r).inlineSize,o=n?n.height:(r[0]||r).blockSize)})),i===r&&o===n||s()}))})),o.observe(t.el)):(i.addEventListener("resize",s),i.addEventListener("orientationchange",c))})),r("destroy",(()=>{a&&i.cancelAnimationFrame(a),o&&o.unobserve&&t.el&&(o.unobserve(t.el),o=null),i.removeEventListener("resize",s),i.removeEventListener("orientationchange",c)}))}function Observer(e){let{swiper:t,extendParams:r,on:n,emit:i}=e;const o=[],a=getWindow(),s=function(e,t){void 0===t&&(t={});const r=new(a.MutationObserver||a.WebkitMutationObserver)((e=>{if(1===e.length)return void i("observerUpdate",e[0]);const t=function(){i("observerUpdate",e[0])};a.requestAnimationFrame?a.requestAnimationFrame(t):a.setTimeout(t,0)}));r.observe(e,{attributes:void 0===t.attributes||t.attributes,childList:void 0===t.childList||t.childList,characterData:void 0===t.characterData||t.characterData}),o.push(r)};r({observer:!1,observeParents:!1,observeSlideChildren:!1}),n("init",(()=>{if(t.params.observer){if(t.params.observeParents){const e=t.$el.parents();for(let t=0;t<e.length;t+=1)s(e[t])}s(t.$el[0],{childList:t.params.observeSlideChildren}),s(t.$wrapperEl[0],{attributes:!1})}})),n("destroy",(()=>{o.forEach((e=>{e.disconnect()})),o.splice(0,o.length)}))}Object.keys(Methods).forEach((e=>{Object.defineProperty($.fn,e,{value:Methods[e],writable:!0})}));var eventsEmitter={on(e,t,r){const n=this;if(!n.eventsListeners||n.destroyed)return n;if("function"!=typeof t)return n;const i=r?"unshift":"push";return e.split(" ").forEach((e=>{n.eventsListeners[e]||(n.eventsListeners[e]=[]),n.eventsListeners[e][i](t)})),n},once(e,t,r){const n=this;if(!n.eventsListeners||n.destroyed)return n;if("function"!=typeof t)return n;function i(){n.off(e,i),i.__emitterProxy&&delete i.__emitterProxy;for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];t.apply(n,o)}return i.__emitterProxy=t,n.on(e,i,r)},onAny(e,t){const r=this;if(!r.eventsListeners||r.destroyed)return r;if("function"!=typeof e)return r;const n=t?"unshift":"push";return r.eventsAnyListeners.indexOf(e)<0&&r.eventsAnyListeners[n](e),r},offAny(e){const t=this;if(!t.eventsListeners||t.destroyed)return t;if(!t.eventsAnyListeners)return t;const r=t.eventsAnyListeners.indexOf(e);return r>=0&&t.eventsAnyListeners.splice(r,1),t},off(e,t){const r=this;return!r.eventsListeners||r.destroyed?r:r.eventsListeners?(e.split(" ").forEach((e=>{void 0===t?r.eventsListeners[e]=[]:r.eventsListeners[e]&&r.eventsListeners[e].forEach(((n,i)=>{(n===t||n.__emitterProxy&&n.__emitterProxy===t)&&r.eventsListeners[e].splice(i,1)}))})),r):r},emit(){const e=this;if(!e.eventsListeners||e.destroyed)return e;if(!e.eventsListeners)return e;let t,r,n;for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];"string"==typeof o[0]||Array.isArray(o[0])?(t=o[0],r=o.slice(1,o.length),n=e):(t=o[0].events,r=o[0].data,n=o[0].context||e),r.unshift(n);return(Array.isArray(t)?t:t.split(" ")).forEach((t=>{e.eventsAnyListeners&&e.eventsAnyListeners.length&&e.eventsAnyListeners.forEach((e=>{e.apply(n,[t,...r])})),e.eventsListeners&&e.eventsListeners[t]&&e.eventsListeners[t].forEach((e=>{e.apply(n,r)}))})),e}};function updateSize(){const e=this;let t,r;const n=e.$el;t=void 0!==e.params.width&&null!==e.params.width?e.params.width:n[0].clientWidth,r=void 0!==e.params.height&&null!==e.params.height?e.params.height:n[0].clientHeight,0===t&&e.isHorizontal()||0===r&&e.isVertical()||(t=t-parseInt(n.css("padding-left")||0,10)-parseInt(n.css("padding-right")||0,10),r=r-parseInt(n.css("padding-top")||0,10)-parseInt(n.css("padding-bottom")||0,10),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=0),Object.assign(e,{width:t,height:r,size:e.isHorizontal()?t:r}))}function updateSlides(){const e=this;function t(t){return e.isHorizontal()?t:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[t]}function r(e,r){return parseFloat(e.getPropertyValue(t(r))||0)}const n=e.params,{$wrapperEl:i,size:o,rtlTranslate:a,wrongRTL:s}=e,c=e.virtual&&n.virtual.enabled,u=c?e.virtual.slides.length:e.slides.length,l=i.children(`.${e.params.slideClass}`),d=c?e.virtual.slides.length:l.length;let p=[];const f=[],h=[];let m=n.slidesOffsetBefore;"function"==typeof m&&(m=n.slidesOffsetBefore.call(e));let g=n.slidesOffsetAfter;"function"==typeof g&&(g=n.slidesOffsetAfter.call(e));const v=e.snapGrid.length,y=e.slidesGrid.length;let b=n.spaceBetween,S=-m,_=0,M=0;if(void 0===o)return;"string"==typeof b&&b.indexOf("%")>=0&&(b=parseFloat(b.replace("%",""))/100*o),e.virtualSize=-b,a?l.css({marginLeft:"",marginBottom:"",marginTop:""}):l.css({marginRight:"",marginBottom:"",marginTop:""}),n.centeredSlides&&n.cssMode&&(setCSSProperty(e.wrapperEl,"--swiper-centered-offset-before",""),setCSSProperty(e.wrapperEl,"--swiper-centered-offset-after",""));const T=n.grid&&n.grid.rows>1&&e.grid;let w;T&&e.grid.initSlides(d);const x="auto"===n.slidesPerView&&n.breakpoints&&Object.keys(n.breakpoints).filter((e=>void 0!==n.breakpoints[e].slidesPerView)).length>0;for(let i=0;i<d;i+=1){w=0;const a=l.eq(i);if(T&&e.grid.updateSlide(i,a,d,t),"none"!==a.css("display")){if("auto"===n.slidesPerView){x&&(l[i].style[t("width")]="");const o=getComputedStyle(a[0]),s=a[0].style.transform,c=a[0].style.webkitTransform;if(s&&(a[0].style.transform="none"),c&&(a[0].style.webkitTransform="none"),n.roundLengths)w=e.isHorizontal()?a.outerWidth(!0):a.outerHeight(!0);else{const e=r(o,"width"),t=r(o,"padding-left"),n=r(o,"padding-right"),i=r(o,"margin-left"),s=r(o,"margin-right"),c=o.getPropertyValue("box-sizing");if(c&&"border-box"===c)w=e+i+s;else{const{clientWidth:r,offsetWidth:o}=a[0];w=e+t+n+i+s+(o-r)}}s&&(a[0].style.transform=s),c&&(a[0].style.webkitTransform=c),n.roundLengths&&(w=Math.floor(w))}else w=(o-(n.slidesPerView-1)*b)/n.slidesPerView,n.roundLengths&&(w=Math.floor(w)),l[i]&&(l[i].style[t("width")]=`${w}px`);l[i]&&(l[i].swiperSlideSize=w),h.push(w),n.centeredSlides?(S=S+w/2+_/2+b,0===_&&0!==i&&(S=S-o/2-b),0===i&&(S=S-o/2-b),Math.abs(S)<.001&&(S=0),n.roundLengths&&(S=Math.floor(S)),M%n.slidesPerGroup==0&&p.push(S),f.push(S)):(n.roundLengths&&(S=Math.floor(S)),(M-Math.min(e.params.slidesPerGroupSkip,M))%e.params.slidesPerGroup==0&&p.push(S),f.push(S),S=S+w+b),e.virtualSize+=w+b,_=w,M+=1}}if(e.virtualSize=Math.max(e.virtualSize,o)+g,a&&s&&("slide"===n.effect||"coverflow"===n.effect)&&i.css({width:`${e.virtualSize+n.spaceBetween}px`}),n.setWrapperSize&&i.css({[t("width")]:`${e.virtualSize+n.spaceBetween}px`}),T&&e.grid.updateWrapperSize(w,p,t),!n.centeredSlides){const t=[];for(let r=0;r<p.length;r+=1){let i=p[r];n.roundLengths&&(i=Math.floor(i)),p[r]<=e.virtualSize-o&&t.push(i)}p=t,Math.floor(e.virtualSize-o)-Math.floor(p[p.length-1])>1&&p.push(e.virtualSize-o)}if(0===p.length&&(p=[0]),0!==n.spaceBetween){const r=e.isHorizontal()&&a?"marginLeft":t("marginRight");l.filter(((e,t)=>!n.cssMode||t!==l.length-1)).css({[r]:`${b}px`})}if(n.centeredSlides&&n.centeredSlidesBounds){let e=0;h.forEach((t=>{e+=t+(n.spaceBetween?n.spaceBetween:0)})),e-=n.spaceBetween;const t=e-o;p=p.map((e=>e<0?-m:e>t?t+g:e))}if(n.centerInsufficientSlides){let e=0;if(h.forEach((t=>{e+=t+(n.spaceBetween?n.spaceBetween:0)})),e-=n.spaceBetween,e<o){const t=(o-e)/2;p.forEach(((e,r)=>{p[r]=e-t})),f.forEach(((e,r)=>{f[r]=e+t}))}}if(Object.assign(e,{slides:l,snapGrid:p,slidesGrid:f,slidesSizesGrid:h}),n.centeredSlides&&n.cssMode&&!n.centeredSlidesBounds){setCSSProperty(e.wrapperEl,"--swiper-centered-offset-before",-p[0]+"px"),setCSSProperty(e.wrapperEl,"--swiper-centered-offset-after",e.size/2-h[h.length-1]/2+"px");const t=-e.snapGrid[0],r=-e.slidesGrid[0];e.snapGrid=e.snapGrid.map((e=>e+t)),e.slidesGrid=e.slidesGrid.map((e=>e+r))}if(d!==u&&e.emit("slidesLengthChange"),p.length!==v&&(e.params.watchOverflow&&e.checkOverflow(),e.emit("snapGridLengthChange")),f.length!==y&&e.emit("slidesGridLengthChange"),n.watchSlidesProgress&&e.updateSlidesOffset(),!(c||n.cssMode||"slide"!==n.effect&&"fade"!==n.effect)){const t=`${n.containerModifierClass}backface-hidden`,r=e.$el.hasClass(t);d<=n.maxBackfaceHiddenSlides?r||e.$el.addClass(t):r&&e.$el.removeClass(t)}}function updateAutoHeight(e){const t=this,r=[],n=t.virtual&&t.params.virtual.enabled;let i,o=0;"number"==typeof e?t.setTransition(e):!0===e&&t.setTransition(t.params.speed);const a=e=>n?t.slides.filter((t=>parseInt(t.getAttribute("data-swiper-slide-index"),10)===e))[0]:t.slides.eq(e)[0];if("auto"!==t.params.slidesPerView&&t.params.slidesPerView>1)if(t.params.centeredSlides)(t.visibleSlides||$([])).each((e=>{r.push(e)}));else for(i=0;i<Math.ceil(t.params.slidesPerView);i+=1){const e=t.activeIndex+i;if(e>t.slides.length&&!n)break;r.push(a(e))}else r.push(a(t.activeIndex));for(i=0;i<r.length;i+=1)if(void 0!==r[i]){const e=r[i].offsetHeight;o=e>o?e:o}(o||0===o)&&t.$wrapperEl.css("height",`${o}px`)}function updateSlidesOffset(){const e=this,t=e.slides;for(let r=0;r<t.length;r+=1)t[r].swiperSlideOffset=e.isHorizontal()?t[r].offsetLeft:t[r].offsetTop}function updateSlidesProgress(e){void 0===e&&(e=this&&this.translate||0);const t=this,r=t.params,{slides:n,rtlTranslate:i,snapGrid:o}=t;if(0===n.length)return;void 0===n[0].swiperSlideOffset&&t.updateSlidesOffset();let a=-e;i&&(a=e),n.removeClass(r.slideVisibleClass),t.visibleSlidesIndexes=[],t.visibleSlides=[];for(let e=0;e<n.length;e+=1){const s=n[e];let c=s.swiperSlideOffset;r.cssMode&&r.centeredSlides&&(c-=n[0].swiperSlideOffset);const u=(a+(r.centeredSlides?t.minTranslate():0)-c)/(s.swiperSlideSize+r.spaceBetween),l=(a-o[0]+(r.centeredSlides?t.minTranslate():0)-c)/(s.swiperSlideSize+r.spaceBetween),d=-(a-c),p=d+t.slidesSizesGrid[e];(d>=0&&d<t.size-1||p>1&&p<=t.size||d<=0&&p>=t.size)&&(t.visibleSlides.push(s),t.visibleSlidesIndexes.push(e),n.eq(e).addClass(r.slideVisibleClass)),s.progress=i?-u:u,s.originalProgress=i?-l:l}t.visibleSlides=$(t.visibleSlides)}function updateProgress(e){const t=this;if(void 0===e){const r=t.rtlTranslate?-1:1;e=t&&t.translate&&t.translate*r||0}const r=t.params,n=t.maxTranslate()-t.minTranslate();let{progress:i,isBeginning:o,isEnd:a}=t;const s=o,c=a;0===n?(i=0,o=!0,a=!0):(i=(e-t.minTranslate())/n,o=i<=0,a=i>=1),Object.assign(t,{progress:i,isBeginning:o,isEnd:a}),(r.watchSlidesProgress||r.centeredSlides&&r.autoHeight)&&t.updateSlidesProgress(e),o&&!s&&t.emit("reachBeginning toEdge"),a&&!c&&t.emit("reachEnd toEdge"),(s&&!o||c&&!a)&&t.emit("fromEdge"),t.emit("progress",i)}function updateSlidesClasses(){const e=this,{slides:t,params:r,$wrapperEl:n,activeIndex:i,realIndex:o}=e,a=e.virtual&&r.virtual.enabled;let s;t.removeClass(`${r.slideActiveClass} ${r.slideNextClass} ${r.slidePrevClass} ${r.slideDuplicateActiveClass} ${r.slideDuplicateNextClass} ${r.slideDuplicatePrevClass}`),s=a?e.$wrapperEl.find(`.${r.slideClass}[data-swiper-slide-index="${i}"]`):t.eq(i),s.addClass(r.slideActiveClass),r.loop&&(s.hasClass(r.slideDuplicateClass)?n.children(`.${r.slideClass}:not(.${r.slideDuplicateClass})[data-swiper-slide-index="${o}"]`).addClass(r.slideDuplicateActiveClass):n.children(`.${r.slideClass}.${r.slideDuplicateClass}[data-swiper-slide-index="${o}"]`).addClass(r.slideDuplicateActiveClass));let c=s.nextAll(`.${r.slideClass}`).eq(0).addClass(r.slideNextClass);r.loop&&0===c.length&&(c=t.eq(0),c.addClass(r.slideNextClass));let u=s.prevAll(`.${r.slideClass}`).eq(0).addClass(r.slidePrevClass);r.loop&&0===u.length&&(u=t.eq(-1),u.addClass(r.slidePrevClass)),r.loop&&(c.hasClass(r.slideDuplicateClass)?n.children(`.${r.slideClass}:not(.${r.slideDuplicateClass})[data-swiper-slide-index="${c.attr("data-swiper-slide-index")}"]`).addClass(r.slideDuplicateNextClass):n.children(`.${r.slideClass}.${r.slideDuplicateClass}[data-swiper-slide-index="${c.attr("data-swiper-slide-index")}"]`).addClass(r.slideDuplicateNextClass),u.hasClass(r.slideDuplicateClass)?n.children(`.${r.slideClass}:not(.${r.slideDuplicateClass})[data-swiper-slide-index="${u.attr("data-swiper-slide-index")}"]`).addClass(r.slideDuplicatePrevClass):n.children(`.${r.slideClass}.${r.slideDuplicateClass}[data-swiper-slide-index="${u.attr("data-swiper-slide-index")}"]`).addClass(r.slideDuplicatePrevClass)),e.emitSlidesClasses()}function updateActiveIndex(e){const t=this,r=t.rtlTranslate?t.translate:-t.translate,{slidesGrid:n,snapGrid:i,params:o,activeIndex:a,realIndex:s,snapIndex:c}=t;let u,l=e;if(void 0===l){for(let e=0;e<n.length;e+=1)void 0!==n[e+1]?r>=n[e]&&r<n[e+1]-(n[e+1]-n[e])/2?l=e:r>=n[e]&&r<n[e+1]&&(l=e+1):r>=n[e]&&(l=e);o.normalizeSlideIndex&&(l<0||void 0===l)&&(l=0)}if(i.indexOf(r)>=0)u=i.indexOf(r);else{const e=Math.min(o.slidesPerGroupSkip,l);u=e+Math.floor((l-e)/o.slidesPerGroup)}if(u>=i.length&&(u=i.length-1),l===a)return void(u!==c&&(t.snapIndex=u,t.emit("snapIndexChange")));const d=parseInt(t.slides.eq(l).attr("data-swiper-slide-index")||l,10);Object.assign(t,{snapIndex:u,realIndex:d,previousIndex:a,activeIndex:l}),t.emit("activeIndexChange"),t.emit("snapIndexChange"),s!==d&&t.emit("realIndexChange"),(t.initialized||t.params.runCallbacksOnInit)&&t.emit("slideChange")}function updateClickedSlide(e){const t=this,r=t.params,n=$(e).closest(`.${r.slideClass}`)[0];let i,o=!1;if(n)for(let e=0;e<t.slides.length;e+=1)if(t.slides[e]===n){o=!0,i=e;break}if(!n||!o)return t.clickedSlide=void 0,void(t.clickedIndex=void 0);t.clickedSlide=n,t.virtual&&t.params.virtual.enabled?t.clickedIndex=parseInt($(n).attr("data-swiper-slide-index"),10):t.clickedIndex=i,r.slideToClickedSlide&&void 0!==t.clickedIndex&&t.clickedIndex!==t.activeIndex&&t.slideToClickedSlide()}var update$1={updateSize:updateSize,updateSlides:updateSlides,updateAutoHeight:updateAutoHeight,updateSlidesOffset:updateSlidesOffset,updateSlidesProgress:updateSlidesProgress,updateProgress:updateProgress,updateSlidesClasses:updateSlidesClasses,updateActiveIndex:updateActiveIndex,updateClickedSlide:updateClickedSlide};function getSwiperTranslate(e){void 0===e&&(e=this.isHorizontal()?"x":"y");const{params:t,rtlTranslate:r,translate:n,$wrapperEl:i}=this;if(t.virtualTranslate)return r?-n:n;if(t.cssMode)return n;let o=getTranslate(i[0],e);return r&&(o=-o),o||0}function setTranslate(e,t){const r=this,{rtlTranslate:n,params:i,$wrapperEl:o,wrapperEl:a,progress:s}=r;let c=0,u=0;let l;r.isHorizontal()?c=n?-e:e:u=e,i.roundLengths&&(c=Math.floor(c),u=Math.floor(u)),i.cssMode?a[r.isHorizontal()?"scrollLeft":"scrollTop"]=r.isHorizontal()?-c:-u:i.virtualTranslate||o.transform(`translate3d(${c}px, ${u}px, 0px)`),r.previousTranslate=r.translate,r.translate=r.isHorizontal()?c:u;const d=r.maxTranslate()-r.minTranslate();l=0===d?0:(e-r.minTranslate())/d,l!==s&&r.updateProgress(e),r.emit("setTranslate",r.translate,t)}function minTranslate(){return-this.snapGrid[0]}function maxTranslate(){return-this.snapGrid[this.snapGrid.length-1]}function translateTo(e,t,r,n,i){void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===r&&(r=!0),void 0===n&&(n=!0);const o=this,{params:a,wrapperEl:s}=o;if(o.animating&&a.preventInteractionOnTransition)return!1;const c=o.minTranslate(),u=o.maxTranslate();let l;if(l=n&&e>c?c:n&&e<u?u:e,o.updateProgress(l),a.cssMode){const e=o.isHorizontal();if(0===t)s[e?"scrollLeft":"scrollTop"]=-l;else{if(!o.support.smoothScroll)return animateCSSModeScroll({swiper:o,targetPosition:-l,side:e?"left":"top"}),!0;s.scrollTo({[e?"left":"top"]:-l,behavior:"smooth"})}return!0}return 0===t?(o.setTransition(0),o.setTranslate(l),r&&(o.emit("beforeTransitionStart",t,i),o.emit("transitionEnd"))):(o.setTransition(t),o.setTranslate(l),r&&(o.emit("beforeTransitionStart",t,i),o.emit("transitionStart")),o.animating||(o.animating=!0,o.onTranslateToWrapperTransitionEnd||(o.onTranslateToWrapperTransitionEnd=function(e){o&&!o.destroyed&&e.target===this&&(o.$wrapperEl[0].removeEventListener("transitionend",o.onTranslateToWrapperTransitionEnd),o.$wrapperEl[0].removeEventListener("webkitTransitionEnd",o.onTranslateToWrapperTransitionEnd),o.onTranslateToWrapperTransitionEnd=null,delete o.onTranslateToWrapperTransitionEnd,r&&o.emit("transitionEnd"))}),o.$wrapperEl[0].addEventListener("transitionend",o.onTranslateToWrapperTransitionEnd),o.$wrapperEl[0].addEventListener("webkitTransitionEnd",o.onTranslateToWrapperTransitionEnd))),!0}var translate={getTranslate:getSwiperTranslate,setTranslate:setTranslate,minTranslate:minTranslate,maxTranslate:maxTranslate,translateTo:translateTo};function setTransition(e,t){const r=this;r.params.cssMode||r.$wrapperEl.transition(e),r.emit("setTransition",e,t)}function transitionEmit(e){let{swiper:t,runCallbacks:r,direction:n,step:i}=e;const{activeIndex:o,previousIndex:a}=t;let s=n;if(s||(s=o>a?"next":o<a?"prev":"reset"),t.emit(`transition${i}`),r&&o!==a){if("reset"===s)return void t.emit(`slideResetTransition${i}`);t.emit(`slideChangeTransition${i}`),"next"===s?t.emit(`slideNextTransition${i}`):t.emit(`slidePrevTransition${i}`)}}function transitionStart(e,t){void 0===e&&(e=!0);const r=this,{params:n}=r;n.cssMode||(n.autoHeight&&r.updateAutoHeight(),transitionEmit({swiper:r,runCallbacks:e,direction:t,step:"Start"}))}function transitionEnd(e,t){void 0===e&&(e=!0);const r=this,{params:n}=r;r.animating=!1,n.cssMode||(r.setTransition(0),transitionEmit({swiper:r,runCallbacks:e,direction:t,step:"End"}))}var transition={setTransition:setTransition,transitionStart:transitionStart,transitionEnd:transitionEnd};function slideTo(e,t,r,n,i){if(void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===r&&(r=!0),"number"!=typeof e&&"string"!=typeof e)throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof e}] given.`);if("string"==typeof e){const t=parseInt(e,10);if(!isFinite(t))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${e}] given.`);e=t}const o=this;let a=e;a<0&&(a=0);const{params:s,snapGrid:c,slidesGrid:u,previousIndex:l,activeIndex:d,rtlTranslate:p,wrapperEl:f,enabled:h}=o;if(o.animating&&s.preventInteractionOnTransition||!h&&!n&&!i)return!1;const m=Math.min(o.params.slidesPerGroupSkip,a);let g=m+Math.floor((a-m)/o.params.slidesPerGroup);g>=c.length&&(g=c.length-1),(d||s.initialSlide||0)===(l||0)&&r&&o.emit("beforeSlideChangeStart");const v=-c[g];if(o.updateProgress(v),s.normalizeSlideIndex)for(let e=0;e<u.length;e+=1){const t=-Math.floor(100*v),r=Math.floor(100*u[e]),n=Math.floor(100*u[e+1]);void 0!==u[e+1]?t>=r&&t<n-(n-r)/2?a=e:t>=r&&t<n&&(a=e+1):t>=r&&(a=e)}if(o.initialized&&a!==d){if(!o.allowSlideNext&&v<o.translate&&v<o.minTranslate())return!1;if(!o.allowSlidePrev&&v>o.translate&&v>o.maxTranslate()&&(d||0)!==a)return!1}let y;if(y=a>d?"next":a<d?"prev":"reset",p&&-v===o.translate||!p&&v===o.translate)return o.updateActiveIndex(a),s.autoHeight&&o.updateAutoHeight(),o.updateSlidesClasses(),"slide"!==s.effect&&o.setTranslate(v),"reset"!==y&&(o.transitionStart(r,y),o.transitionEnd(r,y)),!1;if(s.cssMode){const e=o.isHorizontal(),r=p?v:-v;if(0===t){const t=o.virtual&&o.params.virtual.enabled;t&&(o.wrapperEl.style.scrollSnapType="none",o._immediateVirtual=!0),f[e?"scrollLeft":"scrollTop"]=r,t&&requestAnimationFrame((()=>{o.wrapperEl.style.scrollSnapType="",o._swiperImmediateVirtual=!1}))}else{if(!o.support.smoothScroll)return animateCSSModeScroll({swiper:o,targetPosition:r,side:e?"left":"top"}),!0;f.scrollTo({[e?"left":"top"]:r,behavior:"smooth"})}return!0}return o.setTransition(t),o.setTranslate(v),o.updateActiveIndex(a),o.updateSlidesClasses(),o.emit("beforeTransitionStart",t,n),o.transitionStart(r,y),0===t?o.transitionEnd(r,y):o.animating||(o.animating=!0,o.onSlideToWrapperTransitionEnd||(o.onSlideToWrapperTransitionEnd=function(e){o&&!o.destroyed&&e.target===this&&(o.$wrapperEl[0].removeEventListener("transitionend",o.onSlideToWrapperTransitionEnd),o.$wrapperEl[0].removeEventListener("webkitTransitionEnd",o.onSlideToWrapperTransitionEnd),o.onSlideToWrapperTransitionEnd=null,delete o.onSlideToWrapperTransitionEnd,o.transitionEnd(r,y))}),o.$wrapperEl[0].addEventListener("transitionend",o.onSlideToWrapperTransitionEnd),o.$wrapperEl[0].addEventListener("webkitTransitionEnd",o.onSlideToWrapperTransitionEnd)),!0}function slideToLoop(e,t,r,n){if(void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===r&&(r=!0),"string"==typeof e){const t=parseInt(e,10);if(!isFinite(t))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${e}] given.`);e=t}const i=this;let o=e;return i.params.loop&&(o+=i.loopedSlides),i.slideTo(o,t,r,n)}function slideNext(e,t,r){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);const n=this,{animating:i,enabled:o,params:a}=n;if(!o)return n;let s=a.slidesPerGroup;"auto"===a.slidesPerView&&1===a.slidesPerGroup&&a.slidesPerGroupAuto&&(s=Math.max(n.slidesPerViewDynamic("current",!0),1));const c=n.activeIndex<a.slidesPerGroupSkip?1:s;if(a.loop){if(i&&a.loopPreventsSlide)return!1;n.loopFix(),n._clientLeft=n.$wrapperEl[0].clientLeft}return a.rewind&&n.isEnd?n.slideTo(0,e,t,r):n.slideTo(n.activeIndex+c,e,t,r)}function slidePrev(e,t,r){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);const n=this,{params:i,animating:o,snapGrid:a,slidesGrid:s,rtlTranslate:c,enabled:u}=n;if(!u)return n;if(i.loop){if(o&&i.loopPreventsSlide)return!1;n.loopFix(),n._clientLeft=n.$wrapperEl[0].clientLeft}function l(e){return e<0?-Math.floor(Math.abs(e)):Math.floor(e)}const d=l(c?n.translate:-n.translate),p=a.map((e=>l(e)));let f=a[p.indexOf(d)-1];if(void 0===f&&i.cssMode){let e;a.forEach(((t,r)=>{d>=t&&(e=r)})),void 0!==e&&(f=a[e>0?e-1:e])}let h=0;if(void 0!==f&&(h=s.indexOf(f),h<0&&(h=n.activeIndex-1),"auto"===i.slidesPerView&&1===i.slidesPerGroup&&i.slidesPerGroupAuto&&(h=h-n.slidesPerViewDynamic("previous",!0)+1,h=Math.max(h,0))),i.rewind&&n.isBeginning){const i=n.params.virtual&&n.params.virtual.enabled&&n.virtual?n.virtual.slides.length-1:n.slides.length-1;return n.slideTo(i,e,t,r)}return n.slideTo(h,e,t,r)}function slideReset(e,t,r){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0);return this.slideTo(this.activeIndex,e,t,r)}function slideToClosest(e,t,r,n){void 0===e&&(e=this.params.speed),void 0===t&&(t=!0),void 0===n&&(n=.5);const i=this;let o=i.activeIndex;const a=Math.min(i.params.slidesPerGroupSkip,o),s=a+Math.floor((o-a)/i.params.slidesPerGroup),c=i.rtlTranslate?i.translate:-i.translate;if(c>=i.snapGrid[s]){const e=i.snapGrid[s];c-e>(i.snapGrid[s+1]-e)*n&&(o+=i.params.slidesPerGroup)}else{const e=i.snapGrid[s-1];c-e<=(i.snapGrid[s]-e)*n&&(o-=i.params.slidesPerGroup)}return o=Math.max(o,0),o=Math.min(o,i.slidesGrid.length-1),i.slideTo(o,e,t,r)}function slideToClickedSlide(){const e=this,{params:t,$wrapperEl:r}=e,n="auto"===t.slidesPerView?e.slidesPerViewDynamic():t.slidesPerView;let i,o=e.clickedIndex;if(t.loop){if(e.animating)return;i=parseInt($(e.clickedSlide).attr("data-swiper-slide-index"),10),t.centeredSlides?o<e.loopedSlides-n/2||o>e.slides.length-e.loopedSlides+n/2?(e.loopFix(),o=r.children(`.${t.slideClass}[data-swiper-slide-index="${i}"]:not(.${t.slideDuplicateClass})`).eq(0).index(),nextTick((()=>{e.slideTo(o)}))):e.slideTo(o):o>e.slides.length-n?(e.loopFix(),o=r.children(`.${t.slideClass}[data-swiper-slide-index="${i}"]:not(.${t.slideDuplicateClass})`).eq(0).index(),nextTick((()=>{e.slideTo(o)}))):e.slideTo(o)}else e.slideTo(o)}var slide={slideTo:slideTo,slideToLoop:slideToLoop,slideNext:slideNext,slidePrev:slidePrev,slideReset:slideReset,slideToClosest:slideToClosest,slideToClickedSlide:slideToClickedSlide};function loopCreate(){const e=this,t=getDocument(),{params:r,$wrapperEl:n}=e,i=n.children().length>0?$(n.children()[0].parentNode):n;i.children(`.${r.slideClass}.${r.slideDuplicateClass}`).remove();let o=i.children(`.${r.slideClass}`);if(r.loopFillGroupWithBlank){const e=r.slidesPerGroup-o.length%r.slidesPerGroup;if(e!==r.slidesPerGroup){for(let n=0;n<e;n+=1){const e=$(t.createElement("div")).addClass(`${r.slideClass} ${r.slideBlankClass}`);i.append(e)}o=i.children(`.${r.slideClass}`)}}"auto"!==r.slidesPerView||r.loopedSlides||(r.loopedSlides=o.length),e.loopedSlides=Math.ceil(parseFloat(r.loopedSlides||r.slidesPerView,10)),e.loopedSlides+=r.loopAdditionalSlides,e.loopedSlides>o.length&&e.params.loopedSlidesLimit&&(e.loopedSlides=o.length);const a=[],s=[];o.each(((e,t)=>{$(e).attr("data-swiper-slide-index",t)}));for(let t=0;t<e.loopedSlides;t+=1){const e=t-Math.floor(t/o.length)*o.length;s.push(o.eq(e)[0]),a.unshift(o.eq(o.length-e-1)[0])}for(let e=0;e<s.length;e+=1)i.append($(s[e].cloneNode(!0)).addClass(r.slideDuplicateClass));for(let e=a.length-1;e>=0;e-=1)i.prepend($(a[e].cloneNode(!0)).addClass(r.slideDuplicateClass))}function loopFix(){const e=this;e.emit("beforeLoopFix");const{activeIndex:t,slides:r,loopedSlides:n,allowSlidePrev:i,allowSlideNext:o,snapGrid:a,rtlTranslate:s}=e;let c;e.allowSlidePrev=!0,e.allowSlideNext=!0;const u=-a[t]-e.getTranslate();if(t<n){c=r.length-3*n+t,c+=n;e.slideTo(c,0,!1,!0)&&0!==u&&e.setTranslate((s?-e.translate:e.translate)-u)}else if(t>=r.length-n){c=-r.length+t+n,c+=n;e.slideTo(c,0,!1,!0)&&0!==u&&e.setTranslate((s?-e.translate:e.translate)-u)}e.allowSlidePrev=i,e.allowSlideNext=o,e.emit("loopFix")}function loopDestroy(){const{$wrapperEl:e,params:t,slides:r}=this;e.children(`.${t.slideClass}.${t.slideDuplicateClass},.${t.slideClass}.${t.slideBlankClass}`).remove(),r.removeAttr("data-swiper-slide-index")}var loop$1={loopCreate:loopCreate,loopFix:loopFix,loopDestroy:loopDestroy};function setGrabCursor(e){const t=this;if(t.support.touch||!t.params.simulateTouch||t.params.watchOverflow&&t.isLocked||t.params.cssMode)return;const r="container"===t.params.touchEventsTarget?t.el:t.wrapperEl;r.style.cursor="move",r.style.cursor=e?"grabbing":"grab"}function unsetGrabCursor(){const e=this;e.support.touch||e.params.watchOverflow&&e.isLocked||e.params.cssMode||(e["container"===e.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="")}var grabCursor={setGrabCursor:setGrabCursor,unsetGrabCursor:unsetGrabCursor};function closestElement(e,t){return void 0===t&&(t=this),function t(r){if(!r||r===getDocument()||r===getWindow())return null;r.assignedSlot&&(r=r.assignedSlot);const n=r.closest(e);return n||r.getRootNode?n||t(r.getRootNode().host):null}(t)}function onTouchStart(e){const t=this,r=getDocument(),n=getWindow(),i=t.touchEventsData,{params:o,touches:a,enabled:s}=t;if(!s)return;if(t.animating&&o.preventInteractionOnTransition)return;!t.animating&&o.cssMode&&o.loop&&t.loopFix();let c=e;c.originalEvent&&(c=c.originalEvent);let u=$(c.target);if("wrapper"===o.touchEventsTarget&&!u.closest(t.wrapperEl).length)return;if(i.isTouchEvent="touchstart"===c.type,!i.isTouchEvent&&"which"in c&&3===c.which)return;if(!i.isTouchEvent&&"button"in c&&c.button>0)return;if(i.isTouched&&i.isMoved)return;!!o.noSwipingClass&&""!==o.noSwipingClass&&c.target&&c.target.shadowRoot&&e.path&&e.path[0]&&(u=$(e.path[0]));const l=o.noSwipingSelector?o.noSwipingSelector:`.${o.noSwipingClass}`,d=!(!c.target||!c.target.shadowRoot);if(o.noSwiping&&(d?closestElement(l,u[0]):u.closest(l)[0]))return void(t.allowClick=!0);if(o.swipeHandler&&!u.closest(o.swipeHandler)[0])return;a.currentX="touchstart"===c.type?c.targetTouches[0].pageX:c.pageX,a.currentY="touchstart"===c.type?c.targetTouches[0].pageY:c.pageY;const p=a.currentX,f=a.currentY,h=o.edgeSwipeDetection||o.iOSEdgeSwipeDetection,m=o.edgeSwipeThreshold||o.iOSEdgeSwipeThreshold;if(h&&(p<=m||p>=n.innerWidth-m)){if("prevent"!==h)return;e.preventDefault()}if(Object.assign(i,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),a.startX=p,a.startY=f,i.touchStartTime=now(),t.allowClick=!0,t.updateSize(),t.swipeDirection=void 0,o.threshold>0&&(i.allowThresholdMove=!1),"touchstart"!==c.type){let e=!0;u.is(i.focusableElements)&&(e=!1,"SELECT"===u[0].nodeName&&(i.isTouched=!1)),r.activeElement&&$(r.activeElement).is(i.focusableElements)&&r.activeElement!==u[0]&&r.activeElement.blur();const n=e&&t.allowTouchMove&&o.touchStartPreventDefault;!o.touchStartForcePreventDefault&&!n||u[0].isContentEditable||c.preventDefault()}t.params.freeMode&&t.params.freeMode.enabled&&t.freeMode&&t.animating&&!o.cssMode&&t.freeMode.onTouchStart(),t.emit("touchStart",c)}function onTouchMove(e){const t=getDocument(),r=this,n=r.touchEventsData,{params:i,touches:o,rtlTranslate:a,enabled:s}=r;if(!s)return;let c=e;if(c.originalEvent&&(c=c.originalEvent),!n.isTouched)return void(n.startMoving&&n.isScrolling&&r.emit("touchMoveOpposite",c));if(n.isTouchEvent&&"touchmove"!==c.type)return;const u="touchmove"===c.type&&c.targetTouches&&(c.targetTouches[0]||c.changedTouches[0]),l="touchmove"===c.type?u.pageX:c.pageX,d="touchmove"===c.type?u.pageY:c.pageY;if(c.preventedByNestedSwiper)return o.startX=l,void(o.startY=d);if(!r.allowTouchMove)return $(c.target).is(n.focusableElements)||(r.allowClick=!1),void(n.isTouched&&(Object.assign(o,{startX:l,startY:d,currentX:l,currentY:d}),n.touchStartTime=now()));if(n.isTouchEvent&&i.touchReleaseOnEdges&&!i.loop)if(r.isVertical()){if(d<o.startY&&r.translate<=r.maxTranslate()||d>o.startY&&r.translate>=r.minTranslate())return n.isTouched=!1,void(n.isMoved=!1)}else if(l<o.startX&&r.translate<=r.maxTranslate()||l>o.startX&&r.translate>=r.minTranslate())return;if(n.isTouchEvent&&t.activeElement&&c.target===t.activeElement&&$(c.target).is(n.focusableElements))return n.isMoved=!0,void(r.allowClick=!1);if(n.allowTouchCallbacks&&r.emit("touchMove",c),c.targetTouches&&c.targetTouches.length>1)return;o.currentX=l,o.currentY=d;const p=o.currentX-o.startX,f=o.currentY-o.startY;if(r.params.threshold&&Math.sqrt(p**2+f**2)<r.params.threshold)return;if(void 0===n.isScrolling){let e;r.isHorizontal()&&o.currentY===o.startY||r.isVertical()&&o.currentX===o.startX?n.isScrolling=!1:p*p+f*f>=25&&(e=180*Math.atan2(Math.abs(f),Math.abs(p))/Math.PI,n.isScrolling=r.isHorizontal()?e>i.touchAngle:90-e>i.touchAngle)}if(n.isScrolling&&r.emit("touchMoveOpposite",c),void 0===n.startMoving&&(o.currentX===o.startX&&o.currentY===o.startY||(n.startMoving=!0)),n.isScrolling)return void(n.isTouched=!1);if(!n.startMoving)return;r.allowClick=!1,!i.cssMode&&c.cancelable&&c.preventDefault(),i.touchMoveStopPropagation&&!i.nested&&c.stopPropagation(),n.isMoved||(i.loop&&!i.cssMode&&r.loopFix(),n.startTranslate=r.getTranslate(),r.setTransition(0),r.animating&&r.$wrapperEl.trigger("webkitTransitionEnd transitionend"),n.allowMomentumBounce=!1,!i.grabCursor||!0!==r.allowSlideNext&&!0!==r.allowSlidePrev||r.setGrabCursor(!0),r.emit("sliderFirstMove",c)),r.emit("sliderMove",c),n.isMoved=!0;let h=r.isHorizontal()?p:f;o.diff=h,h*=i.touchRatio,a&&(h=-h),r.swipeDirection=h>0?"prev":"next",n.currentTranslate=h+n.startTranslate;let m=!0,g=i.resistanceRatio;if(i.touchReleaseOnEdges&&(g=0),h>0&&n.currentTranslate>r.minTranslate()?(m=!1,i.resistance&&(n.currentTranslate=r.minTranslate()-1+(-r.minTranslate()+n.startTranslate+h)**g)):h<0&&n.currentTranslate<r.maxTranslate()&&(m=!1,i.resistance&&(n.currentTranslate=r.maxTranslate()+1-(r.maxTranslate()-n.startTranslate-h)**g)),m&&(c.preventedByNestedSwiper=!0),!r.allowSlideNext&&"next"===r.swipeDirection&&n.currentTranslate<n.startTranslate&&(n.currentTranslate=n.startTranslate),!r.allowSlidePrev&&"prev"===r.swipeDirection&&n.currentTranslate>n.startTranslate&&(n.currentTranslate=n.startTranslate),r.allowSlidePrev||r.allowSlideNext||(n.currentTranslate=n.startTranslate),i.threshold>0){if(!(Math.abs(h)>i.threshold||n.allowThresholdMove))return void(n.currentTranslate=n.startTranslate);if(!n.allowThresholdMove)return n.allowThresholdMove=!0,o.startX=o.currentX,o.startY=o.currentY,n.currentTranslate=n.startTranslate,void(o.diff=r.isHorizontal()?o.currentX-o.startX:o.currentY-o.startY)}i.followFinger&&!i.cssMode&&((i.freeMode&&i.freeMode.enabled&&r.freeMode||i.watchSlidesProgress)&&(r.updateActiveIndex(),r.updateSlidesClasses()),r.params.freeMode&&i.freeMode.enabled&&r.freeMode&&r.freeMode.onTouchMove(),r.updateProgress(n.currentTranslate),r.setTranslate(n.currentTranslate))}function onTouchEnd(e){const t=this,r=t.touchEventsData,{params:n,touches:i,rtlTranslate:o,slidesGrid:a,enabled:s}=t;if(!s)return;let c=e;if(c.originalEvent&&(c=c.originalEvent),r.allowTouchCallbacks&&t.emit("touchEnd",c),r.allowTouchCallbacks=!1,!r.isTouched)return r.isMoved&&n.grabCursor&&t.setGrabCursor(!1),r.isMoved=!1,void(r.startMoving=!1);n.grabCursor&&r.isMoved&&r.isTouched&&(!0===t.allowSlideNext||!0===t.allowSlidePrev)&&t.setGrabCursor(!1);const u=now(),l=u-r.touchStartTime;if(t.allowClick){const e=c.path||c.composedPath&&c.composedPath();t.updateClickedSlide(e&&e[0]||c.target),t.emit("tap click",c),l<300&&u-r.lastClickTime<300&&t.emit("doubleTap doubleClick",c)}if(r.lastClickTime=now(),nextTick((()=>{t.destroyed||(t.allowClick=!0)})),!r.isTouched||!r.isMoved||!t.swipeDirection||0===i.diff||r.currentTranslate===r.startTranslate)return r.isTouched=!1,r.isMoved=!1,void(r.startMoving=!1);let d;if(r.isTouched=!1,r.isMoved=!1,r.startMoving=!1,d=n.followFinger?o?t.translate:-t.translate:-r.currentTranslate,n.cssMode)return;if(t.params.freeMode&&n.freeMode.enabled)return void t.freeMode.onTouchEnd({currentPos:d});let p=0,f=t.slidesSizesGrid[0];for(let e=0;e<a.length;e+=e<n.slidesPerGroupSkip?1:n.slidesPerGroup){const t=e<n.slidesPerGroupSkip-1?1:n.slidesPerGroup;void 0!==a[e+t]?d>=a[e]&&d<a[e+t]&&(p=e,f=a[e+t]-a[e]):d>=a[e]&&(p=e,f=a[a.length-1]-a[a.length-2])}let h=null,m=null;n.rewind&&(t.isBeginning?m=t.params.virtual&&t.params.virtual.enabled&&t.virtual?t.virtual.slides.length-1:t.slides.length-1:t.isEnd&&(h=0));const g=(d-a[p])/f,v=p<n.slidesPerGroupSkip-1?1:n.slidesPerGroup;if(l>n.longSwipesMs){if(!n.longSwipes)return void t.slideTo(t.activeIndex);"next"===t.swipeDirection&&(g>=n.longSwipesRatio?t.slideTo(n.rewind&&t.isEnd?h:p+v):t.slideTo(p)),"prev"===t.swipeDirection&&(g>1-n.longSwipesRatio?t.slideTo(p+v):null!==m&&g<0&&Math.abs(g)>n.longSwipesRatio?t.slideTo(m):t.slideTo(p))}else{if(!n.shortSwipes)return void t.slideTo(t.activeIndex);t.navigation&&(c.target===t.navigation.nextEl||c.target===t.navigation.prevEl)?c.target===t.navigation.nextEl?t.slideTo(p+v):t.slideTo(p):("next"===t.swipeDirection&&t.slideTo(null!==h?h:p+v),"prev"===t.swipeDirection&&t.slideTo(null!==m?m:p))}}function onResize(){const e=this,{params:t,el:r}=e;if(r&&0===r.offsetWidth)return;t.breakpoints&&e.setBreakpoint();const{allowSlideNext:n,allowSlidePrev:i,snapGrid:o}=e;e.allowSlideNext=!0,e.allowSlidePrev=!0,e.updateSize(),e.updateSlides(),e.updateSlidesClasses(),("auto"===t.slidesPerView||t.slidesPerView>1)&&e.isEnd&&!e.isBeginning&&!e.params.centeredSlides?e.slideTo(e.slides.length-1,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0),e.autoplay&&e.autoplay.running&&e.autoplay.paused&&e.autoplay.run(),e.allowSlidePrev=i,e.allowSlideNext=n,e.params.watchOverflow&&o!==e.snapGrid&&e.checkOverflow()}function onClick(e){const t=this;t.enabled&&(t.allowClick||(t.params.preventClicks&&e.preventDefault(),t.params.preventClicksPropagation&&t.animating&&(e.stopPropagation(),e.stopImmediatePropagation())))}function onScroll(){const e=this,{wrapperEl:t,rtlTranslate:r,enabled:n}=e;if(!n)return;let i;e.previousTranslate=e.translate,e.isHorizontal()?e.translate=-t.scrollLeft:e.translate=-t.scrollTop,0===e.translate&&(e.translate=0),e.updateActiveIndex(),e.updateSlidesClasses();const o=e.maxTranslate()-e.minTranslate();i=0===o?0:(e.translate-e.minTranslate())/o,i!==e.progress&&e.updateProgress(r?-e.translate:e.translate),e.emit("setTranslate",e.translate,!1)}let dummyEventAttached=!1;function dummyEventListener(){}const events=(e,t)=>{const r=getDocument(),{params:n,touchEvents:i,el:o,wrapperEl:a,device:s,support:c}=e,u=!!n.nested,l="on"===t?"addEventListener":"removeEventListener",d=t;if(c.touch){const t=!("touchstart"!==i.start||!c.passiveListener||!n.passiveListeners)&&{passive:!0,capture:!1};o[l](i.start,e.onTouchStart,t),o[l](i.move,e.onTouchMove,c.passiveListener?{passive:!1,capture:u}:u),o[l](i.end,e.onTouchEnd,t),i.cancel&&o[l](i.cancel,e.onTouchEnd,t)}else o[l](i.start,e.onTouchStart,!1),r[l](i.move,e.onTouchMove,u),r[l](i.end,e.onTouchEnd,!1);(n.preventClicks||n.preventClicksPropagation)&&o[l]("click",e.onClick,!0),n.cssMode&&a[l]("scroll",e.onScroll),n.updateOnWindowResize?e[d](s.ios||s.android?"resize orientationchange observerUpdate":"resize observerUpdate",onResize,!0):e[d]("observerUpdate",onResize,!0)};function attachEvents(){const e=this,t=getDocument(),{params:r,support:n}=e;e.onTouchStart=onTouchStart.bind(e),e.onTouchMove=onTouchMove.bind(e),e.onTouchEnd=onTouchEnd.bind(e),r.cssMode&&(e.onScroll=onScroll.bind(e)),e.onClick=onClick.bind(e),n.touch&&!dummyEventAttached&&(t.addEventListener("touchstart",dummyEventListener),dummyEventAttached=!0),events(e,"on")}function detachEvents(){events(this,"off")}var events$1={attachEvents:attachEvents,detachEvents:detachEvents};const isGridEnabled=(e,t)=>e.grid&&t.grid&&t.grid.rows>1;function setBreakpoint(){const e=this,{activeIndex:t,initialized:r,loopedSlides:n=0,params:i,$el:o}=e,a=i.breakpoints;if(!a||a&&0===Object.keys(a).length)return;const s=e.getBreakpoint(a,e.params.breakpointsBase,e.el);if(!s||e.currentBreakpoint===s)return;const c=(s in a?a[s]:void 0)||e.originalParams,u=isGridEnabled(e,i),l=isGridEnabled(e,c),d=i.enabled;u&&!l?(o.removeClass(`${i.containerModifierClass}grid ${i.containerModifierClass}grid-column`),e.emitContainerClasses()):!u&&l&&(o.addClass(`${i.containerModifierClass}grid`),(c.grid.fill&&"column"===c.grid.fill||!c.grid.fill&&"column"===i.grid.fill)&&o.addClass(`${i.containerModifierClass}grid-column`),e.emitContainerClasses()),["navigation","pagination","scrollbar"].forEach((t=>{const r=i[t]&&i[t].enabled,n=c[t]&&c[t].enabled;r&&!n&&e[t].disable(),!r&&n&&e[t].enable()}));const p=c.direction&&c.direction!==i.direction,f=i.loop&&(c.slidesPerView!==i.slidesPerView||p);p&&r&&e.changeDirection(),extend$3(e.params,c);const h=e.params.enabled;Object.assign(e,{allowTouchMove:e.params.allowTouchMove,allowSlideNext:e.params.allowSlideNext,allowSlidePrev:e.params.allowSlidePrev}),d&&!h?e.disable():!d&&h&&e.enable(),e.currentBreakpoint=s,e.emit("_beforeBreakpoint",c),f&&r&&(e.loopDestroy(),e.loopCreate(),e.updateSlides(),e.slideTo(t-n+e.loopedSlides,0,!1)),e.emit("breakpoint",c)}function getBreakpoint(e,t,r){if(void 0===t&&(t="window"),!e||"container"===t&&!r)return;let n=!1;const i=getWindow(),o="window"===t?i.innerHeight:r.clientHeight,a=Object.keys(e).map((e=>{if("string"==typeof e&&0===e.indexOf("@")){const t=parseFloat(e.substr(1));return{value:o*t,point:e}}return{value:e,point:e}}));a.sort(((e,t)=>parseInt(e.value,10)-parseInt(t.value,10)));for(let e=0;e<a.length;e+=1){const{point:o,value:s}=a[e];"window"===t?i.matchMedia(`(min-width: ${s}px)`).matches&&(n=o):s<=r.clientWidth&&(n=o)}return n||"max"}var breakpoints={setBreakpoint:setBreakpoint,getBreakpoint:getBreakpoint};function prepareClasses(e,t){const r=[];return e.forEach((e=>{"object"==typeof e?Object.keys(e).forEach((n=>{e[n]&&r.push(t+n)})):"string"==typeof e&&r.push(t+e)})),r}function addClasses(){const e=this,{classNames:t,params:r,rtl:n,$el:i,device:o,support:a}=e,s=prepareClasses(["initialized",r.direction,{"pointer-events":!a.touch},{"free-mode":e.params.freeMode&&r.freeMode.enabled},{autoheight:r.autoHeight},{rtl:n},{grid:r.grid&&r.grid.rows>1},{"grid-column":r.grid&&r.grid.rows>1&&"column"===r.grid.fill},{android:o.android},{ios:o.ios},{"css-mode":r.cssMode},{centered:r.cssMode&&r.centeredSlides},{"watch-progress":r.watchSlidesProgress}],r.containerModifierClass);t.push(...s),i.addClass([...t].join(" ")),e.emitContainerClasses()}function removeClasses(){const{$el:e,classNames:t}=this;e.removeClass(t.join(" ")),this.emitContainerClasses()}var classes={addClasses:addClasses,removeClasses:removeClasses};function loadImage(e,t,r,n,i,o){const a=getWindow();let s;function c(){o&&o()}$(e).parent("picture")[0]||e.complete&&i?c():t?(s=new a.Image,s.onload=c,s.onerror=c,n&&(s.sizes=n),r&&(s.srcset=r),t&&(s.src=t)):c()}function preloadImages(){const e=this;function t(){null!=e&&e&&!e.destroyed&&(void 0!==e.imagesLoaded&&(e.imagesLoaded+=1),e.imagesLoaded===e.imagesToLoad.length&&(e.params.updateOnImagesReady&&e.update(),e.emit("imagesReady")))}e.imagesToLoad=e.$el.find("img");for(let r=0;r<e.imagesToLoad.length;r+=1){const n=e.imagesToLoad[r];e.loadImage(n,n.currentSrc||n.getAttribute("src"),n.srcset||n.getAttribute("srcset"),n.sizes||n.getAttribute("sizes"),!0,t)}}var images={loadImage:loadImage,preloadImages:preloadImages};function checkOverflow(){const e=this,{isLocked:t,params:r}=e,{slidesOffsetBefore:n}=r;if(n){const t=e.slides.length-1,r=e.slidesGrid[t]+e.slidesSizesGrid[t]+2*n;e.isLocked=e.size>r}else e.isLocked=1===e.snapGrid.length;!0===r.allowSlideNext&&(e.allowSlideNext=!e.isLocked),!0===r.allowSlidePrev&&(e.allowSlidePrev=!e.isLocked),t&&t!==e.isLocked&&(e.isEnd=!1),t!==e.isLocked&&e.emit(e.isLocked?"lock":"unlock")}var checkOverflow$1={checkOverflow:checkOverflow},defaults$9={init:!0,direction:"horizontal",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopedSlidesLimit:!0,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1};function moduleExtendParams(e,t){return function(r){void 0===r&&(r={});const n=Object.keys(r)[0],i=r[n];"object"==typeof i&&null!==i?(["navigation","pagination","scrollbar"].indexOf(n)>=0&&!0===e[n]&&(e[n]={auto:!0}),n in e&&"enabled"in i?(!0===e[n]&&(e[n]={enabled:!0}),"object"!=typeof e[n]||"enabled"in e[n]||(e[n].enabled=!0),e[n]||(e[n]={enabled:!1}),extend$3(t,r)):extend$3(t,r)):extend$3(t,r)}}const prototypes={eventsEmitter:eventsEmitter,update:update$1,translate:translate,transition:transition,slide:slide,loop:loop$1,grabCursor:grabCursor,events:events$1,breakpoints:breakpoints,checkOverflow:checkOverflow$1,classes:classes,images:images},extendedDefaults={};class Swiper$1{constructor(){let e,t;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];if(1===n.length&&n[0].constructor&&"Object"===Object.prototype.toString.call(n[0]).slice(8,-1)?t=n[0]:[e,t]=n,t||(t={}),t=extend$3({},t),e&&!t.el&&(t.el=e),t.el&&$(t.el).length>1){const e=[];return $(t.el).each((r=>{const n=extend$3({},t,{el:r});e.push(new Swiper$1(n))})),e}const o=this;o.__swiper__=!0,o.support=getSupport(),o.device=getDevice({userAgent:t.userAgent}),o.browser=getBrowser(),o.eventsListeners={},o.eventsAnyListeners=[],o.modules=[...o.__modules__],t.modules&&Array.isArray(t.modules)&&o.modules.push(...t.modules);const a={};o.modules.forEach((e=>{e({swiper:o,extendParams:moduleExtendParams(t,a),on:o.on.bind(o),once:o.once.bind(o),off:o.off.bind(o),emit:o.emit.bind(o)})}));const s=extend$3({},defaults$9,a);return o.params=extend$3({},s,extendedDefaults,t),o.originalParams=extend$3({},o.params),o.passedParams=extend$3({},t),o.params&&o.params.on&&Object.keys(o.params.on).forEach((e=>{o.on(e,o.params.on[e])})),o.params&&o.params.onAny&&o.onAny(o.params.onAny),o.$=$,Object.assign(o,{enabled:o.params.enabled,el:e,classNames:[],slides:$(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===o.params.direction,isVertical:()=>"vertical"===o.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:o.params.allowSlideNext,allowSlidePrev:o.params.allowSlidePrev,touchEvents:function(){const e=["touchstart","touchmove","touchend","touchcancel"],t=["pointerdown","pointermove","pointerup"];return o.touchEventsTouch={start:e[0],move:e[1],end:e[2],cancel:e[3]},o.touchEventsDesktop={start:t[0],move:t[1],end:t[2]},o.support.touch||!o.params.simulateTouch?o.touchEventsTouch:o.touchEventsDesktop}(),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:o.params.focusableElements,lastClickTime:now(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:o.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),o.emit("_swiper"),o.params.init&&o.init(),o}enable(){const e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){const e=this;e.enabled&&(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,t){const r=this;e=Math.min(Math.max(e,0),1);const n=r.minTranslate(),i=(r.maxTranslate()-n)*e+n;r.translateTo(i,void 0===t?0:t),r.updateActiveIndex(),r.updateSlidesClasses()}emitContainerClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const t=e.el.className.split(" ").filter((t=>0===t.indexOf("swiper")||0===t.indexOf(e.params.containerModifierClass)));e.emit("_containerClasses",t.join(" "))}getSlideClasses(e){const t=this;return t.destroyed?"":e.className.split(" ").filter((e=>0===e.indexOf("swiper-slide")||0===e.indexOf(t.params.slideClass))).join(" ")}emitSlidesClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const t=[];e.slides.each((r=>{const n=e.getSlideClasses(r);t.push({slideEl:r,classNames:n}),e.emit("_slideClass",r,n)})),e.emit("_slideClasses",t)}slidesPerViewDynamic(e,t){void 0===e&&(e="current"),void 0===t&&(t=!1);const{params:r,slides:n,slidesGrid:i,slidesSizesGrid:o,size:a,activeIndex:s}=this;let c=1;if(r.centeredSlides){let e,t=n[s].swiperSlideSize;for(let r=s+1;r<n.length;r+=1)n[r]&&!e&&(t+=n[r].swiperSlideSize,c+=1,t>a&&(e=!0));for(let r=s-1;r>=0;r-=1)n[r]&&!e&&(t+=n[r].swiperSlideSize,c+=1,t>a&&(e=!0))}else if("current"===e)for(let e=s+1;e<n.length;e+=1){(t?i[e]+o[e]-i[s]<a:i[e]-i[s]<a)&&(c+=1)}else for(let e=s-1;e>=0;e-=1){i[s]-i[e]<a&&(c+=1)}return c}update(){const e=this;if(!e||e.destroyed)return;const{snapGrid:t,params:r}=e;function n(){const t=e.rtlTranslate?-1*e.translate:e.translate,r=Math.min(Math.max(t,e.maxTranslate()),e.minTranslate());e.setTranslate(r),e.updateActiveIndex(),e.updateSlidesClasses()}let i;r.breakpoints&&e.setBreakpoint(),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.params.freeMode&&e.params.freeMode.enabled?(n(),e.params.autoHeight&&e.updateAutoHeight()):(i=("auto"===e.params.slidesPerView||e.params.slidesPerView>1)&&e.isEnd&&!e.params.centeredSlides?e.slideTo(e.slides.length-1,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0),i||n()),r.watchOverflow&&t!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,t){void 0===t&&(t=!0);const r=this,n=r.params.direction;return e||(e="horizontal"===n?"vertical":"horizontal"),e===n||"horizontal"!==e&&"vertical"!==e||(r.$el.removeClass(`${r.params.containerModifierClass}${n}`).addClass(`${r.params.containerModifierClass}${e}`),r.emitContainerClasses(),r.params.direction=e,r.slides.each((t=>{"vertical"===e?t.style.width="":t.style.height=""})),r.emit("changeDirection"),t&&r.update()),r}changeLanguageDirection(e){const t=this;t.rtl&&"rtl"===e||!t.rtl&&"ltr"===e||(t.rtl="rtl"===e,t.rtlTranslate="horizontal"===t.params.direction&&t.rtl,t.rtl?(t.$el.addClass(`${t.params.containerModifierClass}rtl`),t.el.dir="rtl"):(t.$el.removeClass(`${t.params.containerModifierClass}rtl`),t.el.dir="ltr"),t.update())}mount(e){const t=this;if(t.mounted)return!0;const r=$(e||t.params.el);if(!(e=r[0]))return!1;e.swiper=t;const n=()=>`.${(t.params.wrapperClass||"").trim().split(" ").join(".")}`;let i=(()=>{if(e&&e.shadowRoot&&e.shadowRoot.querySelector){const t=$(e.shadowRoot.querySelector(n()));return t.children=e=>r.children(e),t}return r.children?r.children(n()):$(r).children(n())})();if(0===i.length&&t.params.createElements){const e=getDocument().createElement("div");i=$(e),e.className=t.params.wrapperClass,r.append(e),r.children(`.${t.params.slideClass}`).each((e=>{i.append(e)}))}return Object.assign(t,{$el:r,el:e,$wrapperEl:i,wrapperEl:i[0],mounted:!0,rtl:"rtl"===e.dir.toLowerCase()||"rtl"===r.css("direction"),rtlTranslate:"horizontal"===t.params.direction&&("rtl"===e.dir.toLowerCase()||"rtl"===r.css("direction")),wrongRTL:"-webkit-box"===i.css("display")}),!0}init(e){const t=this;if(t.initialized)return t;return!1===t.mount(e)||(t.emit("beforeInit"),t.params.breakpoints&&t.setBreakpoint(),t.addClasses(),t.params.loop&&t.loopCreate(),t.updateSize(),t.updateSlides(),t.params.watchOverflow&&t.checkOverflow(),t.params.grabCursor&&t.enabled&&t.setGrabCursor(),t.params.preloadImages&&t.preloadImages(),t.params.loop?t.slideTo(t.params.initialSlide+t.loopedSlides,0,t.params.runCallbacksOnInit,!1,!0):t.slideTo(t.params.initialSlide,0,t.params.runCallbacksOnInit,!1,!0),t.attachEvents(),t.initialized=!0,t.emit("init"),t.emit("afterInit")),t}destroy(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);const r=this,{params:n,$el:i,$wrapperEl:o,slides:a}=r;return void 0===r.params||r.destroyed||(r.emit("beforeDestroy"),r.initialized=!1,r.detachEvents(),n.loop&&r.loopDestroy(),t&&(r.removeClasses(),i.removeAttr("style"),o.removeAttr("style"),a&&a.length&&a.removeClass([n.slideVisibleClass,n.slideActiveClass,n.slideNextClass,n.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),r.emit("destroy"),Object.keys(r.eventsListeners).forEach((e=>{r.off(e)})),!1!==e&&(r.$el[0].swiper=null,deleteProps(r)),r.destroyed=!0),null}static extendDefaults(e){extend$3(extendedDefaults,e)}static get extendedDefaults(){return extendedDefaults}static get defaults(){return defaults$9}static installModule(e){Swiper$1.prototype.__modules__||(Swiper$1.prototype.__modules__=[]);const t=Swiper$1.prototype.__modules__;"function"==typeof e&&t.indexOf(e)<0&&t.push(e)}static use(e){return Array.isArray(e)?(e.forEach((e=>Swiper$1.installModule(e))),Swiper$1):(Swiper$1.installModule(e),Swiper$1)}}function createElementIfNotDefined(e,t,r,n){const i=getDocument();return e.params.createElements&&Object.keys(n).forEach((o=>{if(!r[o]&&!0===r.auto){let a=e.$el.children(`.${n[o]}`)[0];a||(a=i.createElement("div"),a.className=n[o],e.$el.append(a)),r[o]=a,t[o]=a}})),r}function classesToSelector(e){return void 0===e&&(e=""),`.${e.trim().replace(/([\.:!\/])/g,"\\$1").replace(/ /g,".")}`}function Pagination(e){let{swiper:t,extendParams:r,on:n,emit:i}=e;const o="swiper-pagination";let a;r({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:e=>e,formatFractionTotal:e=>e,bulletClass:`${o}-bullet`,bulletActiveClass:`${o}-bullet-active`,modifierClass:`${o}-`,currentClass:`${o}-current`,totalClass:`${o}-total`,hiddenClass:`${o}-hidden`,progressbarFillClass:`${o}-progressbar-fill`,progressbarOppositeClass:`${o}-progressbar-opposite`,clickableClass:`${o}-clickable`,lockClass:`${o}-lock`,horizontalClass:`${o}-horizontal`,verticalClass:`${o}-vertical`,paginationDisabledClass:`${o}-disabled`}}),t.pagination={el:null,$el:null,bullets:[]};let s=0;function c(){return!t.params.pagination.el||!t.pagination.el||!t.pagination.$el||0===t.pagination.$el.length}function u(e,r){const{bulletActiveClass:n}=t.params.pagination;e[r]().addClass(`${n}-${r}`)[r]().addClass(`${n}-${r}-${r}`)}function l(){const e=t.rtl,r=t.params.pagination;if(c())return;const n=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.slides.length,o=t.pagination.$el;let l;const d=t.params.loop?Math.ceil((n-2*t.loopedSlides)/t.params.slidesPerGroup):t.snapGrid.length;if(t.params.loop?(l=Math.ceil((t.activeIndex-t.loopedSlides)/t.params.slidesPerGroup),l>n-1-2*t.loopedSlides&&(l-=n-2*t.loopedSlides),l>d-1&&(l-=d),l<0&&"bullets"!==t.params.paginationType&&(l=d+l)):l=void 0!==t.snapIndex?t.snapIndex:t.activeIndex||0,"bullets"===r.type&&t.pagination.bullets&&t.pagination.bullets.length>0){const n=t.pagination.bullets;let i,c,d;if(r.dynamicBullets&&(a=n.eq(0)[t.isHorizontal()?"outerWidth":"outerHeight"](!0),o.css(t.isHorizontal()?"width":"height",a*(r.dynamicMainBullets+4)+"px"),r.dynamicMainBullets>1&&void 0!==t.previousIndex&&(s+=l-(t.previousIndex-t.loopedSlides||0),s>r.dynamicMainBullets-1?s=r.dynamicMainBullets-1:s<0&&(s=0)),i=Math.max(l-s,0),c=i+(Math.min(n.length,r.dynamicMainBullets)-1),d=(c+i)/2),n.removeClass(["","-next","-next-next","-prev","-prev-prev","-main"].map((e=>`${r.bulletActiveClass}${e}`)).join(" ")),o.length>1)n.each((e=>{const t=$(e),n=t.index();n===l&&t.addClass(r.bulletActiveClass),r.dynamicBullets&&(n>=i&&n<=c&&t.addClass(`${r.bulletActiveClass}-main`),n===i&&u(t,"prev"),n===c&&u(t,"next"))}));else{const e=n.eq(l),o=e.index();if(e.addClass(r.bulletActiveClass),r.dynamicBullets){const e=n.eq(i),a=n.eq(c);for(let e=i;e<=c;e+=1)n.eq(e).addClass(`${r.bulletActiveClass}-main`);if(t.params.loop)if(o>=n.length){for(let e=r.dynamicMainBullets;e>=0;e-=1)n.eq(n.length-e).addClass(`${r.bulletActiveClass}-main`);n.eq(n.length-r.dynamicMainBullets-1).addClass(`${r.bulletActiveClass}-prev`)}else u(e,"prev"),u(a,"next");else u(e,"prev"),u(a,"next")}}if(r.dynamicBullets){const i=Math.min(n.length,r.dynamicMainBullets+4),o=(a*i-a)/2-d*a,s=e?"right":"left";n.css(t.isHorizontal()?s:"top",`${o}px`)}}if("fraction"===r.type&&(o.find(classesToSelector(r.currentClass)).text(r.formatFractionCurrent(l+1)),o.find(classesToSelector(r.totalClass)).text(r.formatFractionTotal(d))),"progressbar"===r.type){let e;e=r.progressbarOpposite?t.isHorizontal()?"vertical":"horizontal":t.isHorizontal()?"horizontal":"vertical";const n=(l+1)/d;let i=1,a=1;"horizontal"===e?i=n:a=n,o.find(classesToSelector(r.progressbarFillClass)).transform(`translate3d(0,0,0) scaleX(${i}) scaleY(${a})`).transition(t.params.speed)}"custom"===r.type&&r.renderCustom?(o.html(r.renderCustom(t,l+1,d)),i("paginationRender",o[0])):i("paginationUpdate",o[0]),t.params.watchOverflow&&t.enabled&&o[t.isLocked?"addClass":"removeClass"](r.lockClass)}function d(){const e=t.params.pagination;if(c())return;const r=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.slides.length,n=t.pagination.$el;let o="";if("bullets"===e.type){let i=t.params.loop?Math.ceil((r-2*t.loopedSlides)/t.params.slidesPerGroup):t.snapGrid.length;t.params.freeMode&&t.params.freeMode.enabled&&!t.params.loop&&i>r&&(i=r);for(let r=0;r<i;r+=1)e.renderBullet?o+=e.renderBullet.call(t,r,e.bulletClass):o+=`<${e.bulletElement} class="${e.bulletClass}"></${e.bulletElement}>`;n.html(o),t.pagination.bullets=n.find(classesToSelector(e.bulletClass))}"fraction"===e.type&&(o=e.renderFraction?e.renderFraction.call(t,e.currentClass,e.totalClass):`<span class="${e.currentClass}"></span> / <span class="${e.totalClass}"></span>`,n.html(o)),"progressbar"===e.type&&(o=e.renderProgressbar?e.renderProgressbar.call(t,e.progressbarFillClass):`<span class="${e.progressbarFillClass}"></span>`,n.html(o)),"custom"!==e.type&&i("paginationRender",t.pagination.$el[0])}function p(){t.params.pagination=createElementIfNotDefined(t,t.originalParams.pagination,t.params.pagination,{el:"swiper-pagination"});const e=t.params.pagination;if(!e.el)return;let r=$(e.el);0!==r.length&&(t.params.uniqueNavElements&&"string"==typeof e.el&&r.length>1&&(r=t.$el.find(e.el),r.length>1&&(r=r.filter((e=>$(e).parents(".swiper")[0]===t.el)))),"bullets"===e.type&&e.clickable&&r.addClass(e.clickableClass),r.addClass(e.modifierClass+e.type),r.addClass(t.isHorizontal()?e.horizontalClass:e.verticalClass),"bullets"===e.type&&e.dynamicBullets&&(r.addClass(`${e.modifierClass}${e.type}-dynamic`),s=0,e.dynamicMainBullets<1&&(e.dynamicMainBullets=1)),"progressbar"===e.type&&e.progressbarOpposite&&r.addClass(e.progressbarOppositeClass),e.clickable&&r.on("click",classesToSelector(e.bulletClass),(function(e){e.preventDefault();let r=$(this).index()*t.params.slidesPerGroup;t.params.loop&&(r+=t.loopedSlides),t.slideTo(r)})),Object.assign(t.pagination,{$el:r,el:r[0]}),t.enabled||r.addClass(e.lockClass))}function f(){const e=t.params.pagination;if(c())return;const r=t.pagination.$el;r.removeClass(e.hiddenClass),r.removeClass(e.modifierClass+e.type),r.removeClass(t.isHorizontal()?e.horizontalClass:e.verticalClass),t.pagination.bullets&&t.pagination.bullets.removeClass&&t.pagination.bullets.removeClass(e.bulletActiveClass),e.clickable&&r.off("click",classesToSelector(e.bulletClass))}n("init",(()=>{!1===t.params.pagination.enabled?h():(p(),d(),l())})),n("activeIndexChange",(()=>{(t.params.loop||void 0===t.snapIndex)&&l()})),n("snapIndexChange",(()=>{t.params.loop||l()})),n("slidesLengthChange",(()=>{t.params.loop&&(d(),l())})),n("snapGridLengthChange",(()=>{t.params.loop||(d(),l())})),n("destroy",(()=>{f()})),n("enable disable",(()=>{const{$el:e}=t.pagination;e&&e[t.enabled?"removeClass":"addClass"](t.params.pagination.lockClass)})),n("lock unlock",(()=>{l()})),n("click",((e,r)=>{const n=r.target,{$el:o}=t.pagination;if(t.params.pagination.el&&t.params.pagination.hideOnClick&&o&&o.length>0&&!$(n).hasClass(t.params.pagination.bulletClass)){if(t.navigation&&(t.navigation.nextEl&&n===t.navigation.nextEl||t.navigation.prevEl&&n===t.navigation.prevEl))return;const e=o.hasClass(t.params.pagination.hiddenClass);i(!0===e?"paginationShow":"paginationHide"),o.toggleClass(t.params.pagination.hiddenClass)}}));const h=()=>{t.$el.addClass(t.params.pagination.paginationDisabledClass),t.pagination.$el&&t.pagination.$el.addClass(t.params.pagination.paginationDisabledClass),f()};Object.assign(t.pagination,{enable:()=>{t.$el.removeClass(t.params.pagination.paginationDisabledClass),t.pagination.$el&&t.pagination.$el.removeClass(t.params.pagination.paginationDisabledClass),p(),d(),l()},disable:h,render:d,update:l,init:p,destroy:f})}function isObject$6(e){return"object"==typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)}function extend$2(e,t){const r=["__proto__","constructor","prototype"];Object.keys(t).filter((e=>r.indexOf(e)<0)).forEach((r=>{void 0===e[r]?e[r]=t[r]:isObject$6(t[r])&&isObject$6(e[r])&&Object.keys(t[r]).length>0?t[r].__swiper__?e[r]=t[r]:extend$2(e[r],t[r]):e[r]=t[r]}))}function needsNavigation(e){return void 0===e&&(e={}),e.navigation&&void 0===e.navigation.nextEl&&void 0===e.navigation.prevEl}function needsPagination(e){return void 0===e&&(e={}),e.pagination&&void 0===e.pagination.el}function needsScrollbar(e){return void 0===e&&(e={}),e.scrollbar&&void 0===e.scrollbar.el}function uniqueClasses(e){void 0===e&&(e="");const t=e.split(" ").map((e=>e.trim())).filter((e=>!!e)),r=[];return t.forEach((e=>{r.indexOf(e)<0&&r.push(e)})),r.join(" ")}Object.keys(prototypes).forEach((e=>{Object.keys(prototypes[e]).forEach((t=>{Swiper$1.prototype[t]=prototypes[e][t]}))})),Swiper$1.use([Resize,Observer]);const paramsList=["modules","init","_direction","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_preloadImages","updateOnImagesReady","_loop","_loopAdditionalSlides","_loopedSlides","_loopedSlidesLimit","_loopFillGroupWithBlank","loopPreventsSlide","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideBlankClass","slideActiveClass","slideDuplicateActiveClass","slideVisibleClass","slideDuplicateClass","slideNextClass","slideDuplicateNextClass","slidePrevClass","slideDuplicatePrevClass","wrapperClass","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","lazy","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom"];function getParams(e,t){void 0===e&&(e={}),void 0===t&&(t=!0);const r={on:{}},n={},i={};extend$2(r,Swiper$1.defaults),extend$2(r,Swiper$1.extendedDefaults),r._emitClasses=!0,r.init=!1;const o={},a=paramsList.map((e=>e.replace(/_/,""))),s=Object.assign({},e);return Object.keys(s).forEach((s=>{void 0!==e[s]&&(a.indexOf(s)>=0?isObject$6(e[s])?(r[s]={},i[s]={},extend$2(r[s],e[s]),extend$2(i[s],e[s])):(r[s]=e[s],i[s]=e[s]):0===s.search(/on[A-Z]/)&&"function"==typeof e[s]?t?n[`${s[2].toLowerCase()}${s.substr(3)}`]=e[s]:r.on[`${s[2].toLowerCase()}${s.substr(3)}`]=e[s]:o[s]=e[s])})),["navigation","pagination","scrollbar"].forEach((e=>{!0===r[e]&&(r[e]={}),!1===r[e]&&delete r[e]})),{params:r,passedParams:i,rest:o,events:n}}function mountSwiper(e,t){let{el:r,nextEl:n,prevEl:i,paginationEl:o,scrollbarEl:a,swiper:s}=e;needsNavigation(t)&&n&&i&&(s.params.navigation.nextEl=n,s.originalParams.navigation.nextEl=n,s.params.navigation.prevEl=i,s.originalParams.navigation.prevEl=i),needsPagination(t)&&o&&(s.params.pagination.el=o,s.originalParams.pagination.el=o),needsScrollbar(t)&&a&&(s.params.scrollbar.el=a,s.originalParams.scrollbar.el=a),s.init(r)}function calcLoopedSlides(e,t){let r=t.slidesPerView;if(t.breakpoints){const e=Swiper$1.prototype.getBreakpoint(t.breakpoints),n=e in t.breakpoints?t.breakpoints[e]:void 0;n&&n.slidesPerView&&(r=n.slidesPerView)}let n=Math.ceil(parseFloat(t.loopedSlides||r,10));return n+=t.loopAdditionalSlides,n>e.length&&t.loopedSlidesLimit&&(n=e.length),n}function renderLoop(e,t,r){const n=t.map(((t,r)=>React.cloneElement(t,{swiper:e,"data-swiper-slide-index":r})));function i(e,t,n){return React.cloneElement(e,{key:`${e.key}-duplicate-${t}-${n}`,className:`${e.props.className||""} ${r.slideDuplicateClass}`})}if(r.loopFillGroupWithBlank){const e=r.slidesPerGroup-n.length%r.slidesPerGroup;if(e!==r.slidesPerGroup)for(let t=0;t<e;t+=1){const e=React.createElement("div",{className:`${r.slideClass} ${r.slideBlankClass}`});n.push(e)}}"auto"!==r.slidesPerView||r.loopedSlides||(r.loopedSlides=n.length);const o=calcLoopedSlides(n,r),a=[],s=[];for(let e=0;e<o;e+=1){const t=e-Math.floor(e/n.length)*n.length;s.push(i(n[t],e,"append")),a.unshift(i(n[n.length-t-1],e,"prepend"))}return e&&(e.loopedSlides=o),[...a,...n,...s]}function getChangedParams(e,t,r,n,i){const o=[];if(!t)return o;const a=e=>{o.indexOf(e)<0&&o.push(e)};if(r&&n){const e=n.map(i),t=r.map(i);e.join("")!==t.join("")&&a("children"),n.length!==r.length&&a("children")}return paramsList.filter((e=>"_"===e[0])).map((e=>e.replace(/_/,""))).forEach((r=>{if(r in e&&r in t)if(isObject$6(e[r])&&isObject$6(t[r])){const n=Object.keys(e[r]),i=Object.keys(t[r]);n.length!==i.length?a(r):(n.forEach((n=>{e[r][n]!==t[r][n]&&a(r)})),i.forEach((n=>{e[r][n]!==t[r][n]&&a(r)})))}else e[r]!==t[r]&&a(r)})),o}function processChildren(e){const t=[];return React.Children.toArray(e).forEach((e=>{e.type&&"SwiperSlide"===e.type.displayName?t.push(e):e.props&&e.props.children&&processChildren(e.props.children).forEach((e=>t.push(e)))})),t}function getChildren(e){const t=[],r={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return React.Children.toArray(e).forEach((e=>{if(e.type&&"SwiperSlide"===e.type.displayName)t.push(e);else if(e.props&&e.props.slot&&r[e.props.slot])r[e.props.slot].push(e);else if(e.props&&e.props.children){const n=processChildren(e.props.children);n.length>0?n.forEach((e=>t.push(e))):r["container-end"].push(e)}else r["container-end"].push(e)})),{slides:t,slots:r}}function updateSwiper(e){let{swiper:t,slides:r,passedParams:n,changedParams:i,nextEl:o,prevEl:a,scrollbarEl:s,paginationEl:c}=e;const u=i.filter((e=>"children"!==e&&"direction"!==e)),{params:l,pagination:d,navigation:p,scrollbar:f,virtual:h,thumbs:m}=t;let g,v,y,b,S;i.includes("thumbs")&&n.thumbs&&n.thumbs.swiper&&l.thumbs&&!l.thumbs.swiper&&(g=!0),i.includes("controller")&&n.controller&&n.controller.control&&l.controller&&!l.controller.control&&(v=!0),i.includes("pagination")&&n.pagination&&(n.pagination.el||c)&&(l.pagination||!1===l.pagination)&&d&&!d.el&&(y=!0),i.includes("scrollbar")&&n.scrollbar&&(n.scrollbar.el||s)&&(l.scrollbar||!1===l.scrollbar)&&f&&!f.el&&(b=!0),i.includes("navigation")&&n.navigation&&(n.navigation.prevEl||a)&&(n.navigation.nextEl||o)&&(l.navigation||!1===l.navigation)&&p&&!p.prevEl&&!p.nextEl&&(S=!0);if(u.forEach((e=>{if(isObject$6(l[e])&&isObject$6(n[e]))extend$2(l[e],n[e]);else{const i=n[e];!0!==i&&!1!==i||"navigation"!==e&&"pagination"!==e&&"scrollbar"!==e?l[e]=n[e]:!1===i&&t[r=e]&&(t[r].destroy(),"navigation"===r?(l[r].prevEl=void 0,l[r].nextEl=void 0,t[r].prevEl=void 0,t[r].nextEl=void 0):(l[r].el=void 0,t[r].el=void 0))}var r})),u.includes("controller")&&!v&&t.controller&&t.controller.control&&l.controller&&l.controller.control&&(t.controller.control=l.controller.control),i.includes("children")&&r&&h&&l.virtual.enabled?(h.slides=r,h.update(!0)):i.includes("children")&&t.lazy&&t.params.lazy.enabled&&t.lazy.load(),g){m.init()&&m.update(!0)}v&&(t.controller.control=l.controller.control),y&&(c&&(l.pagination.el=c),d.init(),d.render(),d.update()),b&&(s&&(l.scrollbar.el=s),f.init(),f.updateSize(),f.setTranslate()),S&&(o&&(l.navigation.nextEl=o),a&&(l.navigation.prevEl=a),p.init(),p.update()),i.includes("allowSlideNext")&&(t.allowSlideNext=n.allowSlideNext),i.includes("allowSlidePrev")&&(t.allowSlidePrev=n.allowSlidePrev),i.includes("direction")&&t.changeDirection(n.direction,!1),t.update()}function renderVirtual(e,t,r){if(!r)return null;const n=e.isHorizontal()?{[e.rtlTranslate?"right":"left"]:`${r.offset}px`}:{top:`${r.offset}px`};return t.filter(((e,t)=>t>=r.from&&t<=r.to)).map((t=>React.cloneElement(t,{swiper:e,style:n})))}const updateOnVirtualData=e=>{!e||e.destroyed||!e.params.virtual||e.params.virtual&&!e.params.virtual.enabled||(e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.lazy&&e.params.lazy.enabled&&e.lazy.load(),e.parallax&&e.params.parallax&&e.params.parallax.enabled&&e.parallax.setTranslate())};function useIsomorphicLayoutEffect$3(e,t){return"undefined"==typeof window?react.exports.useEffect(e,t):react.exports.useLayoutEffect(e,t)}const SwiperSlideContext=react.exports.createContext(null),SwiperContext=react.exports.createContext(null);function _extends$4(){return _extends$4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends$4.apply(this,arguments)}const Swiper=react.exports.forwardRef((function(e,t){let{className:r,tag:n="div",wrapperTag:i="div",children:o,onSwiper:a,...s}=void 0===e?{}:e,c=!1;const[u,l]=react.exports.useState("swiper"),[d,p]=react.exports.useState(null),[f,h]=react.exports.useState(!1),m=react.exports.useRef(!1),g=react.exports.useRef(null),v=react.exports.useRef(null),y=react.exports.useRef(null),b=react.exports.useRef(null),S=react.exports.useRef(null),_=react.exports.useRef(null),M=react.exports.useRef(null),T=react.exports.useRef(null),{params:w,passedParams:x,rest:I,events:E}=getParams(s),{slides:A,slots:C}=getChildren(o),k=()=>{h(!f)};Object.assign(w.on,{_containerClasses(e,t){l(t)}});const O=()=>{if(Object.assign(w.on,E),c=!0,v.current=new Swiper$1(w),v.current.loopCreate=()=>{},v.current.loopDestroy=()=>{},w.loop&&(v.current.loopedSlides=calcLoopedSlides(A,w)),v.current.virtual&&v.current.params.virtual.enabled){v.current.virtual.slides=A;const e={cache:!1,slides:A,renderExternal:p,renderExternalUpdate:!1};extend$2(v.current.params.virtual,e),extend$2(v.current.originalParams.virtual,e)}};g.current||O(),v.current&&v.current.on("_beforeBreakpoint",k);return react.exports.useEffect((()=>()=>{v.current&&v.current.off("_beforeBreakpoint",k)})),react.exports.useEffect((()=>{!m.current&&v.current&&(v.current.emitSlidesClasses(),m.current=!0)})),useIsomorphicLayoutEffect$3((()=>{if(t&&(t.current=g.current),g.current)return v.current.destroyed&&O(),mountSwiper({el:g.current,nextEl:S.current,prevEl:_.current,paginationEl:M.current,scrollbarEl:T.current,swiper:v.current},w),a&&a(v.current),()=>{v.current&&!v.current.destroyed&&v.current.destroy(!0,!1)}}),[]),useIsomorphicLayoutEffect$3((()=>{!c&&E&&v.current&&Object.keys(E).forEach((e=>{v.current.on(e,E[e])}));const e=getChangedParams(x,y.current,A,b.current,(e=>e.key));return y.current=x,b.current=A,e.length&&v.current&&!v.current.destroyed&&updateSwiper({swiper:v.current,slides:A,passedParams:x,changedParams:e,nextEl:S.current,prevEl:_.current,scrollbarEl:T.current,paginationEl:M.current}),()=>{E&&v.current&&Object.keys(E).forEach((e=>{v.current.off(e,E[e])}))}})),useIsomorphicLayoutEffect$3((()=>{updateOnVirtualData(v.current)}),[d]),React.createElement(n,_extends$4({ref:g,className:uniqueClasses(`${u}${r?` ${r}`:""}`)},I),React.createElement(SwiperContext.Provider,{value:v.current},C["container-start"],React.createElement(i,{className:"swiper-wrapper"},C["wrapper-start"],w.virtual?renderVirtual(v.current,A,d):!w.loop||v.current&&v.current.destroyed?A.map((e=>React.cloneElement(e,{swiper:v.current}))):renderLoop(v.current,A,w),C["wrapper-end"]),needsNavigation(w)&&React.createElement(React.Fragment,null,React.createElement("div",{ref:_,className:"swiper-button-prev"}),React.createElement("div",{ref:S,className:"swiper-button-next"})),needsScrollbar(w)&&React.createElement("div",{ref:T,className:"swiper-scrollbar"}),needsPagination(w)&&React.createElement("div",{ref:M,className:"swiper-pagination"}),C["container-end"]))}));function _extends$3(){return _extends$3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends$3.apply(this,arguments)}Swiper.displayName="Swiper";const SwiperSlide=react.exports.forwardRef((function(e,t){let{tag:r="div",children:n,className:i="",swiper:o,zoom:a,virtualIndex:s,...c}=void 0===e?{}:e;const u=react.exports.useRef(null),[l,d]=react.exports.useState("swiper-slide");function p(e,t,r){t===u.current&&d(r)}useIsomorphicLayoutEffect$3((()=>{if(t&&(t.current=u.current),u.current&&o){if(!o.destroyed)return o.on("_slideClass",p),()=>{o&&o.off("_slideClass",p)};"swiper-slide"!==l&&d("swiper-slide")}})),useIsomorphicLayoutEffect$3((()=>{o&&u.current&&!o.destroyed&&d(o.getSlideClasses(u.current))}),[o]);const f={isActive:l.indexOf("swiper-slide-active")>=0||l.indexOf("swiper-slide-duplicate-active")>=0,isVisible:l.indexOf("swiper-slide-visible")>=0,isDuplicate:l.indexOf("swiper-slide-duplicate")>=0,isPrev:l.indexOf("swiper-slide-prev")>=0||l.indexOf("swiper-slide-duplicate-prev")>=0,isNext:l.indexOf("swiper-slide-next")>=0||l.indexOf("swiper-slide-duplicate-next")>=0},h=()=>"function"==typeof n?n(f):n;return React.createElement(r,_extends$3({ref:u,className:uniqueClasses(`${l}${i?` ${i}`:""}`),"data-swiper-slide-index":s},c),React.createElement(SwiperSlideContext.Provider,{value:f},a?React.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":"number"==typeof a?a:void 0},h()):h()))}));function styleInject(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}SwiperSlide.displayName="SwiperSlide";var css_248z$h='@font-face{font-family:swiper-icons;font-style:normal;font-weight:400;src:url("data:application/font-woff;charset=utf-8;base64, d09GRgABAAAAAAZgABAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAGRAAAABoAAAAci6qHkUdERUYAAAWgAAAAIwAAACQAYABXR1BPUwAABhQAAAAuAAAANuAY7+xHU1VCAAAFxAAAAFAAAABm2fPczU9TLzIAAAHcAAAASgAAAGBP9V5RY21hcAAAAkQAAACIAAABYt6F0cBjdnQgAAACzAAAAAQAAAAEABEBRGdhc3AAAAWYAAAACAAAAAj//wADZ2x5ZgAAAywAAADMAAAD2MHtryVoZWFkAAABbAAAADAAAAA2E2+eoWhoZWEAAAGcAAAAHwAAACQC9gDzaG10eAAAAigAAAAZAAAArgJkABFsb2NhAAAC0AAAAFoAAABaFQAUGG1heHAAAAG8AAAAHwAAACAAcABAbmFtZQAAA/gAAAE5AAACXvFdBwlwb3N0AAAFNAAAAGIAAACE5s74hXjaY2BkYGAAYpf5Hu/j+W2+MnAzMYDAzaX6QjD6/4//Bxj5GA8AuRwMYGkAPywL13jaY2BkYGA88P8Agx4j+/8fQDYfA1AEBWgDAIB2BOoAeNpjYGRgYNBh4GdgYgABEMnIABJzYNADCQAACWgAsQB42mNgYfzCOIGBlYGB0YcxjYGBwR1Kf2WQZGhhYGBiYGVmgAFGBiQQkOaawtDAoMBQxXjg/wEGPcYDDA4wNUA2CCgwsAAAO4EL6gAAeNpj2M0gyAACqxgGNWBkZ2D4/wMA+xkDdgAAAHjaY2BgYGaAYBkGRgYQiAHyGMF8FgYHIM3DwMHABGQrMOgyWDLEM1T9/w8UBfEMgLzE////P/5//f/V/xv+r4eaAAeMbAxwIUYmIMHEgKYAYjUcsDAwsLKxc3BycfPw8jEQA/gZBASFhEVExcQlJKWkZWTl5BUUlZRVVNXUNTQZBgMAAMR+E+gAEQFEAAAAKgAqACoANAA+AEgAUgBcAGYAcAB6AIQAjgCYAKIArAC2AMAAygDUAN4A6ADyAPwBBgEQARoBJAEuATgBQgFMAVYBYAFqAXQBfgGIAZIBnAGmAbIBzgHsAAB42u2NMQ6CUAyGW568x9AneYYgm4MJbhKFaExIOAVX8ApewSt4Bic4AfeAid3VOBixDxfPYEza5O+Xfi04YADggiUIULCuEJK8VhO4bSvpdnktHI5QCYtdi2sl8ZnXaHlqUrNKzdKcT8cjlq+rwZSvIVczNiezsfnP/uznmfPFBNODM2K7MTQ45YEAZqGP81AmGGcF3iPqOop0r1SPTaTbVkfUe4HXj97wYE+yNwWYxwWu4v1ugWHgo3S1XdZEVqWM7ET0cfnLGxWfkgR42o2PvWrDMBSFj/IHLaF0zKjRgdiVMwScNRAoWUoH78Y2icB/yIY09An6AH2Bdu/UB+yxopYshQiEvnvu0dURgDt8QeC8PDw7Fpji3fEA4z/PEJ6YOB5hKh4dj3EvXhxPqH/SKUY3rJ7srZ4FZnh1PMAtPhwP6fl2PMJMPDgeQ4rY8YT6Gzao0eAEA409DuggmTnFnOcSCiEiLMgxCiTI6Cq5DZUd3Qmp10vO0LaLTd2cjN4fOumlc7lUYbSQcZFkutRG7g6JKZKy0RmdLY680CDnEJ+UMkpFFe1RN7nxdVpXrC4aTtnaurOnYercZg2YVmLN/d/gczfEimrE/fs/bOuq29Zmn8tloORaXgZgGa78yO9/cnXm2BpaGvq25Dv9S4E9+5SIc9PqupJKhYFSSl47+Qcr1mYNAAAAeNptw0cKwkAAAMDZJA8Q7OUJvkLsPfZ6zFVERPy8qHh2YER+3i/BP83vIBLLySsoKimrqKqpa2hp6+jq6RsYGhmbmJqZSy0sraxtbO3sHRydnEMU4uR6yx7JJXveP7WrDycAAAAAAAH//wACeNpjYGRgYOABYhkgZgJCZgZNBkYGLQZtIJsFLMYAAAw3ALgAeNolizEKgDAQBCchRbC2sFER0YD6qVQiBCv/H9ezGI6Z5XBAw8CBK/m5iQQVauVbXLnOrMZv2oLdKFa8Pjuru2hJzGabmOSLzNMzvutpB3N42mNgZGBg4GKQYzBhYMxJLMlj4GBgAYow/P/PAJJhLM6sSoWKfWCAAwDAjgbRAAB42mNgYGBkAIIbCZo5IPrmUn0hGA0AO8EFTQAA")}:root{--swiper-theme-color:#007aff}.swiper{list-style:none;margin-left:auto;margin-right:auto;overflow:hidden;padding:0;position:relative;z-index:1}.swiper-vertical>.swiper-wrapper{flex-direction:column}.swiper-wrapper{box-sizing:content-box;display:flex;height:100%;position:relative;transition-property:transform;width:100%;z-index:1}.swiper-android .swiper-slide,.swiper-wrapper{transform:translateZ(0)}.swiper-pointer-events{touch-action:pan-y}.swiper-pointer-events.swiper-vertical{touch-action:pan-x}.swiper-slide{flex-shrink:0;height:100%;position:relative;transition-property:transform;width:100%}.swiper-slide-invisible-blank{visibility:hidden}.swiper-autoheight,.swiper-autoheight .swiper-slide{height:auto}.swiper-autoheight .swiper-wrapper{align-items:flex-start;transition-property:transform,height}.swiper-backface-hidden .swiper-slide{-webkit-backface-visibility:hidden;backface-visibility:hidden;transform:translateZ(0)}.swiper-3d,.swiper-3d.swiper-css-mode .swiper-wrapper{perspective:1200px}.swiper-3d .swiper-cube-shadow,.swiper-3d .swiper-slide,.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top,.swiper-3d .swiper-wrapper{transform-style:preserve-3d}.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top{height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%;z-index:10}.swiper-3d .swiper-slide-shadow{background:rgba(0,0,0,.15)}.swiper-3d .swiper-slide-shadow-left{background-image:linear-gradient(270deg,rgba(0,0,0,.5),transparent)}.swiper-3d .swiper-slide-shadow-right{background-image:linear-gradient(90deg,rgba(0,0,0,.5),transparent)}.swiper-3d .swiper-slide-shadow-top{background-image:linear-gradient(0deg,rgba(0,0,0,.5),transparent)}.swiper-3d .swiper-slide-shadow-bottom{background-image:linear-gradient(180deg,rgba(0,0,0,.5),transparent)}.swiper-css-mode>.swiper-wrapper{-ms-overflow-style:none;overflow:auto;scrollbar-width:none}.swiper-css-mode>.swiper-wrapper::-webkit-scrollbar{display:none}.swiper-css-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:start start}.swiper-horizontal.swiper-css-mode>.swiper-wrapper{scroll-snap-type:x mandatory}.swiper-vertical.swiper-css-mode>.swiper-wrapper{scroll-snap-type:y mandatory}.swiper-centered>.swiper-wrapper:before{content:"";flex-shrink:0;order:9999}.swiper-centered.swiper-horizontal>.swiper-wrapper>.swiper-slide:first-child{-webkit-margin-start:var(--swiper-centered-offset-before);margin-inline-start:var(--swiper-centered-offset-before)}.swiper-centered.swiper-horizontal>.swiper-wrapper:before{height:100%;min-height:1px;width:var(--swiper-centered-offset-after)}.swiper-centered.swiper-vertical>.swiper-wrapper>.swiper-slide:first-child{-webkit-margin-before:var(--swiper-centered-offset-before);margin-block-start:var(--swiper-centered-offset-before)}.swiper-centered.swiper-vertical>.swiper-wrapper:before{height:var(--swiper-centered-offset-after);min-width:1px;width:100%}.swiper-centered>.swiper-wrapper>.swiper-slide{scroll-snap-align:center center}';styleInject(css_248z$h);var css_248z$g=".meeting-canvas{overflow:hidden;position:relative}.meeting-canvas .meeting-canvas-swiper{background-color:#18181f}.meeting-canvas .meeting-canvas-swiper .swiper-pagination-bullet-active{background-color:#fff}.meeting-canvas .meeting-canvas-swiper .swiper-pagination-bullets.swiper-pagination-horizontal{background-color:hsla(0,0%,40%,.5);border-radius:8px;bottom:70px;left:50%;line-height:1;margin:auto;padding:1px 2px;transform:translateX(-50%);width:auto}.meeting-canvas .video-view-nickname{left:0;margin-top:0;right:0;top:50%;transform:translateY(-50%)}.meeting-canvas .video-view-nickname .icon-audio{left:-1px;position:relative;top:1px}.meeting-canvas .nickname-tip{align-items:center;background:rgba(0,0,0,.5);border-radius:2px;bottom:4px;display:flex;left:4px;max-width:100%;padding:3px 4px;position:absolute}.meeting-canvas .nickname-tip .nickname{color:#fff;font-size:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.meeting-canvas .nickname-tip .iconfont{font-size:10px;margin-right:2px}.meeting-canvas .video-view-wrap.full-screen-card{height:100%;width:100%}.meeting-canvas .video-view-wrap.full-screen-card .icon-audio{display:inline-block}.meeting-canvas .video-view-wrap.full-screen-card.local-member .icon-audio{display:none!important}.meeting-canvas .video-view-wrap{background-color:#292933;border:1px solid #000;box-sizing:border-box;color:#fff;overflow:hidden}.meeting-canvas .video-view-wrap .icon-audio{display:none}.meeting-canvas .small-video-card{border:1px solid #fff;height:20%;overflow:hidden;position:absolute!important;right:15px;top:80px;width:20%;z-index:1}.meeting-canvas .meeting-canvas-swiper .nertc-screen-container,.meeting-canvas .meeting-canvas-swiper .nertc-video-container-local,.meeting-canvas .meeting-canvas-swiper .nertc-video-container-remote{height:100%!important;width:100%!important}.meeting-canvas .whiteboard-view,.meeting-canvas .whiteboard-wrap{height:100%;width:100%}.meeting-canvas .whiteboard-index{left:0;position:absolute;top:0;z-index:2}.meeting-canvas .active-border{border:2px solid #59f20c}";styleInject(css_248z$g);var css_248z$f=".swiper-pagination{position:absolute;text-align:center;transform:translateZ(0);transition:opacity .3s;z-index:10}.swiper-pagination.swiper-pagination-hidden{opacity:0}.swiper-pagination-disabled>.swiper-pagination,.swiper-pagination.swiper-pagination-disabled{display:none!important}.swiper-horizontal>.swiper-pagination-bullets,.swiper-pagination-bullets.swiper-pagination-horizontal,.swiper-pagination-custom,.swiper-pagination-fraction{bottom:10px;left:0;width:100%}.swiper-pagination-bullets-dynamic{font-size:0;overflow:hidden}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{position:relative;transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active,.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev{transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next{transform:scale(.33)}.swiper-pagination-bullet{background:var(--swiper-pagination-bullet-inactive-color,#000);border-radius:50%;display:inline-block;height:var(--swiper-pagination-bullet-height,var(--swiper-pagination-bullet-size,8px));opacity:var(--swiper-pagination-bullet-inactive-opacity,.2);width:var(--swiper-pagination-bullet-width,var(--swiper-pagination-bullet-size,8px))}button.swiper-pagination-bullet{-webkit-appearance:none;-moz-appearance:none;appearance:none;border:none;box-shadow:none;margin:0;padding:0}.swiper-pagination-clickable .swiper-pagination-bullet{cursor:pointer}.swiper-pagination-bullet:only-child{display:none!important}.swiper-pagination-bullet-active{background:var(--swiper-pagination-color,var(--swiper-theme-color));opacity:var(--swiper-pagination-bullet-opacity,1)}.swiper-pagination-vertical.swiper-pagination-bullets,.swiper-vertical>.swiper-pagination-bullets{right:10px;top:50%;transform:translate3d(0,-50%,0)}.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets .swiper-pagination-bullet{display:block;margin:var(--swiper-pagination-bullet-vertical-gap,6px) 0}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{top:50%;transform:translateY(-50%);width:8px}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{display:inline-block;transition:transform .2s,top .2s}.swiper-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet{margin:0 var(--swiper-pagination-bullet-horizontal-gap,4px)}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{left:50%;transform:translateX(-50%);white-space:nowrap}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:transform .2s,left .2s}.swiper-horizontal.swiper-rtl>.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:transform .2s,right .2s}.swiper-pagination-progressbar{background:rgba(0,0,0,.25);position:absolute}.swiper-pagination-progressbar .swiper-pagination-progressbar-fill{background:var(--swiper-pagination-color,var(--swiper-theme-color));height:100%;left:0;position:absolute;top:0;transform:scale(0);transform-origin:left top;width:100%}.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill{transform-origin:right top}.swiper-horizontal>.swiper-pagination-progressbar,.swiper-pagination-progressbar.swiper-pagination-horizontal,.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite,.swiper-vertical>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite{height:4px;left:0;top:0;width:100%}.swiper-horizontal>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-vertical,.swiper-vertical>.swiper-pagination-progressbar{height:100%;left:0;top:0;width:4px}.swiper-pagination-lock{display:none}",EventType,UserEventType,memberAction,hostAction,ActionType,NEClientType$1,NEMeetingRole,AttendeeOffType,Role,NEMeetingIdDisplayOptions;function createMeetingInfoFactory(){return{localMember:{uuid:"",isAudioOn:!1,isInChatroom:!1,isInRtcChannel:!1,isSharingScreen:!1,isVideoOn:!1,isSharingWhiteboard:!1,properties:{},clientType:NEClientType$1.WEB,role:Role.member,name:""},meetingId:"",hostUuid:"",hostName:"",screenUuid:"",whiteboardUuid:"",focusUuid:"",activeSpeakerUuid:"",properties:{},subject:"",startTime:"",endTime:"",type:0,shortId:"",myUuid:"",audioOff:AttendeeOffType.disable,videoOff:AttendeeOffType.disable,isLocked:!1}}styleInject(css_248z$f),function(e){e.MemberAudioMuteChanged="memberAudioMuteChanged",e.MemberJoinRoom="memberJoinRoom",e.MemberNameChanged="memberNameChanged",e.MemberJoinRtcChannel="memberJoinRtcChannel",e.MemberLeaveChatroom="memberLeaveChatroom",e.MemberLeaveRoom="memberLeaveRoom",e.MemberLeaveRtcChannel="memberLeaveRtcChannel",e.MemberRoleChanged="memberRoleChanged",e.MemberScreenShareStateChanged="memberScreenShareStateChanged",e.MemberVideoMuteChanged="memberVideoMuteChanged",e.MemberWhiteboardStateChanged="memberWhiteboardStateChanged",e.RoomPropertiesChanged="roomPropertiesChanged",e.RoomLockStateChanged="roomLockStateChanged",e.MemberPropertiesChanged="memberPropertiesChanged",e.MemberPropertiesDeleted="memberPropertiesDeleted",e.RoomPropertiesDeleted="roomPropertiesDeleted",e.RoomEnded="roomEnded",e.RtcActiveSpeakerChanged="rtcActiveSpeakerChanged",e.RtcChannelError="rtcChannelError",e.RoomConnectStateChanged="roomConnectStateChanged",e.CameraDeviceChanged="cameraDeviceChanged",e.PlayoutDeviceChanged="playoutDeviceChanged",e.RecordDeviceChanged="recordDeviceChanged",e.ReceiveChatroomMessages="receiveChatroomMessages",e.ReceivePassThroughMessage="receivePassThroughMessage",e.DeviceChange="deviceChange",e.NetworkError="networkError",e.ClientBanned="ClientBanned",e.AutoPlayNotAllowed="autoplayNotAllowed",e.NetworkReconnect="networkReconnect",e.NetworkReconnectSuccess="networkReconnectSuccess"}(EventType||(EventType={})),function(e){e.Login="login",e.Logout="logout",e.LoginWithPassword="loginWithPassword",e.CreateMeeting="createMeeting",e.JoinMeeting="joinMeeting",e.AnonymousJoinMeeting="anonymousJoinMeeting",e.SetLeaveCallback="setLeaveCallback"}(UserEventType||(UserEventType={})),function(e){e[e.muteAudio=51]="muteAudio",e[e.unmuteAudio=56]="unmuteAudio",e[e.muteVideo=50]="muteVideo",e[e.unmuteVideo=55]="unmuteVideo",e[e.muteScreen=52]="muteScreen",e[e.unmuteScreen=57]="unmuteScreen",e[e.handsUp=58]="handsUp",e[e.handsDown=59]="handsDown",e[e.openWhiteShare=60]="openWhiteShare",e[e.closeWhiteShare=61]="closeWhiteShare",e[e.shareWhiteShare=62]="shareWhiteShare",e[e.cancelShareWhiteShare=63]="cancelShareWhiteShare",e[e.modifyMeetingNickName=104]="modifyMeetingNickName"}(memberAction||(memberAction={})),function(e){e[e.remove=0]="remove",e[e.muteMemberVideo=10]="muteMemberVideo",e[e.muteMemberAudio=11]="muteMemberAudio",e[e.muteAllAudio=12]="muteAllAudio",e[e.lockMeeting=13]="lockMeeting",e[e.muteAllVideo=14]="muteAllVideo",e[e.unmuteMemberVideo=15]="unmuteMemberVideo",e[e.unmuteMemberAudio=16]="unmuteMemberAudio",e[e.unmuteAllAudio=17]="unmuteAllAudio",e[e.unlockMeeting=18]="unlockMeeting",e[e.unmuteAllVideo=19]="unmuteAllVideo",e[e.muteVideoAndAudio=20]="muteVideoAndAudio",e[e.unmuteVideoAndAudio=21]="unmuteVideoAndAudio",e[e.transferHost=22]="transferHost",e[e.setCoHost=23]="setCoHost",e[e.unSetCoHost=9999]="unSetCoHost",e[e.setFocus=30]="setFocus",e[e.unsetFocus=31]="unsetFocus",e[e.forceMuteAllAudio=40]="forceMuteAllAudio",e[e.rejectHandsUp=42]="rejectHandsUp",e[e.forceMuteAllVideo=43]="forceMuteAllVideo",e[e.closeScreenShare=53]="closeScreenShare",e[e.openWhiteShare=60]="openWhiteShare",e[e.closeWhiteShare=61]="closeWhiteShare"}(hostAction||(hostAction={})),function(e){e.UPDATE_NAME="updateName",e.RESET_NAME="resetName",e.UPDATE_MEMBER="updateMember",e.ADD_MEMBER="addMember",e.REMOVE_MEMBER="removeMember",e.UPDATE_MEETING_INFO="updateMeetingInfo",e.SET_MEETING="setMeeting",e.RESET_MEETING="resetMeeting",e.JOIN_LOADING="joinLoading"}(ActionType||(ActionType={})),function(e){e.WEB="web",e.ANDROID="android",e.IOS="ios",e.PC="pc",e.MINIAPP="miniApp",e.MAC="mac",e.SIP="SIP",e.UNKNOWN="unknown"}(NEClientType$1||(NEClientType$1={})),function(e){e.participant="member",e.host="host",e.coHost="cohost",e.ghost="ghost"}(NEMeetingRole||(NEMeetingRole={})),function(e){e.offNotAllowSelfOn="offNotAllowSelfOn",e.offAllowSelfOn="offAllowSelfOn",e.disable="disable"}(AttendeeOffType||(AttendeeOffType={})),function(e){e.member="member",e.host="host",e.coHost="cohost"}(Role||(Role={})),function(e){e[e.displayAll=0]="displayAll",e[e.displayLongId=1]="displayLongId",e[e.displayShortId=2]="displayShortId"}(NEMeetingIdDisplayOptions||(NEMeetingIdDisplayOptions={}));const GlobalContext=React.createContext({}),globalReducer=(e,t)=>{if(t.type===ActionType.JOIN_LOADING){const r=t.data;return Object.assign(Object.assign({},e),{joinLoading:r})}return Object.assign({},e)},GlobalContextProvider=e=>{const[t,r]=react.exports.useReducer(globalReducer,{eventEmitter:e.eventEmitter,outEventEmitter:e.outEventEmitter,neMeeting:e.neMeeting,joinLoading:e.joinLoading});return jsxRuntime.exports.jsx(GlobalContext.Provider,Object.assign({value:Object.assign(Object.assign({},t),{dispatch:r})},{children:e.children}))},MeetingInfoContext=React.createContext({meetingInfo:createMeetingInfoFactory(),memberList:[]}),meetingInfoReducer=(e,t)=>{switch(t.type){case ActionType.UPDATE_MEMBER:{const r=t.data,n=e.meetingInfo;let{memberList:i}=e;const o=i.findIndex((e=>e.uuid===r.uuid));return o>-1&&(i[o]=Object.assign(Object.assign({},i[o]),r.member)),i=sortMembers(i,n.localMember.uuid),n.localMember.uuid===r.uuid&&(n.localMember=Object.assign(Object.assign({},n.localMember),r.member)),void 0!==r.member.role&&r.member.role===Role.host&&(n.hostUuid=r.uuid,n.hostName=i[o].name),void 0!==r.member.isSharingScreen&&1===Object.keys(r.member).length&&(n.screenUuid=r.member.isSharingScreen?i[o].uuid:""),Object.assign(Object.assign({},e),{memberList:i,meetingInfo:n})}case ActionType.ADD_MEMBER:{const{member:r}=t.data;let{memberList:n}=e;const i=e.meetingInfo,o=n.findIndex((e=>e.uuid===r.uuid));return o>-1?n[o]=r:n.push(r),n=sortMembers(n,i.localMember.uuid),Object.assign(Object.assign({},e),{memberList:n})}case ActionType.REMOVE_MEMBER:{const{uuids:r}=t.data,{memberList:n}=e;return r.forEach((e=>{const t=n.findIndex((t=>t.uuid===e));t>-1&&n.splice(t,1)})),Object.assign(Object.assign({},e),{memberList:n})}case ActionType.UPDATE_MEETING_INFO:{let{meetingInfo:r}=e;const n=t.data;return r=Object.assign(Object.assign({},r),n),Object.assign(Object.assign({},e),{meetingInfo:r})}case ActionType.SET_MEETING:{const r=t.data;let n=r.memberList;const{meetingInfo:i}=e;return n=sortMembers(n,i.localMember.uuid),r.memberList=n,Object.assign(Object.assign({},e),r)}case ActionType.RESET_MEETING:return{memberList:[],meetingInfo:createMeetingInfoFactory()};default:return Object.assign({},e)}},MeetingInfoContextProvider=e=>{const t=sortMembers(e.memberList,e.meetingInfo.localMember.uuid),[r,n]=react.exports.useReducer(meetingInfoReducer,{meetingInfo:e.meetingInfo,memberList:t});return jsxRuntime.exports.jsx(MeetingInfoContext.Provider,Object.assign({value:Object.assign(Object.assign({},r),{dispatch:n})},{children:e.children}))};function sortMembers(e,t){const r=[...e];return r.sort(((e,r)=>e.role!==Role.host&&r.role!==Role.host?e.role===Role.coHost&&r.role===Role.coHost||e.role!==Role.coHost&&r.role!==Role.coHost?e.uuid!==t&&r.uuid!==t?e.isHandsUp&&r.isHandsUp||!e.isHandsUp&&!r.isHandsUp?e.isSharingScreen&&r.isSharingScreen||!e.isSharingScreen&&!r.isSharingScreen?e.isSharingWhiteboard&&r.isSharingWhiteboard||!e.isSharingWhiteboard&&!r.isSharingWhiteboard?e.isVideoOn&&e.isAudioOn&&r.isAudioOn&&r.isVideoOn?0:e.isVideoOn&&r.isVideoOn||!e.isVideoOn&&!r.isVideoOn?e.isAudioOn&&r.isAudioOn||!e.isAudioOn&&!r.isAudioOn?0:e.isAudioOn>r.isAudioOn?-1:1:e.isVideoOn>r.isVideoOn?-1:1:!!e.isSharingWhiteboard>!!r.isSharingWhiteboard?-1:1:!!e.isSharingScreen>!!r.isSharingScreen?-1:1:!!e.isHandsUp>!!r.isHandsUp?-1:1:e.uuid===t?-1:1:e.role===Role.coHost?-1:1:e.role===Role.host?-1:1)),r}function useWatch(e,t,r={immediate:!1}){const{immediate:n}=r,i=react.exports.useRef(),o=react.exports.useRef(!1),a=react.exports.useRef(!1);react.exports.useEffect((()=>{const r=()=>t(i.current);o.current||(a.current?r():(a.current=!0,n&&r()),i.current=e)}),[e])}const VideoCard=e=>{const{member:t,className:r,onClick:n,isMySelf:i,isMain:o,showBorder:a}=e,s=e.type||"video",c=!1!==e.isSubscribeVideo,{dispatch:u,meetingInfo:l}=react.exports.useContext(MeetingInfoContext),{neMeeting:d}=react.exports.useContext(GlobalContext),p=react.exports.useRef(null),f=react.exports.useRef(null),h=react.exports.useMemo((()=>o?0:1),[o]),m=()=>{var e,r;i||(c?(console.log("viewRef",p.current),p.current&&(null===(e=null==d?void 0:d.rtcController)||void 0===e||e.setupRemoteVideoCanvas(p.current,t.uuid)),null===(r=null==d?void 0:d.rtcController)||void 0===r||r.subscribeRemoteVideoStream(t.uuid,h)):console.warn("非当前页不播放视频"))},g=()=>{var e,r;i||"screen"!==s||(p.current&&(null===(e=null==d?void 0:d.rtcController)||void 0===e||e.setupRemoteVideoSubStreamCanvas(p.current,t.uuid)),null===(r=null==d?void 0:d.rtcController)||void 0===r||r.subscribeRemoteVideoSubStream(t.uuid))};return react.exports.useEffect((()=>{var e,r,n;if(console.log("mounted",t,c),i){p.current&&(null===(e=null==d?void 0:d.rtcController)||void 0===e||e.setupLocalVideoCanvas(p.current)),t.isVideoOn&&(null===(r=null==d?void 0:d.rtcController)||void 0===r||r.playLocalStream("video"));const n=t.role===Role.host||t.role===Role.coHost;(l.isUnMutedVideo&&l.videoOff===AttendeeOffType.disable||n)&&(null==d||d.unmuteLocalVideo()),(l.isUnMutedAudio&&l.audioOff===AttendeeOffType.disable||n)&&(null==d||d.unmuteLocalAudio()),u&&u({type:ActionType.UPDATE_MEETING_INFO,data:{isUnMutedVideo:!1,isUnMutedAudio:!1}})}else"screen"===s?g():t.isVideoOn&&(c?m():null===(n=null==d?void 0:d.rtcController)||void 0===n||n.unsubscribeRemoteVideoStream(t.uuid,h));return()=>{f.current&&clearTimeout(f.current)}}),[]),useWatch(c,(e=>{e!==c&&"screen"!==s&&t.isVideoOn&&(c?f.current?(console.log("开始清除定时器"),clearTimeout(f.current),f.current=null):m():(console.log("开始取消订阅视频"),f.current=setTimeout((()=>{var e;null===(e=null==d?void 0:d.rtcController)||void 0===e||e.unsubscribeRemoteVideoStream(t.uuid,h),f.current=null}),1e4)))})),useWatch(t.isVideoOn,(e=>{var r,n,o;t.isVideoOn!==e&&"screen"!==s&&(t.isVideoOn?i?null===(r=null==d?void 0:d.rtcController)||void 0===r||r.playLocalStream("video"):c?m():null===(n=null==d?void 0:d.rtcController)||void 0===n||n.unsubscribeRemoteVideoStream(t.uuid,h):!i&&(null===(o=null==d?void 0:d.rtcController)||void 0===o||o.unsubscribeRemoteVideoStream(t.uuid,h)))})),useWatch(t.isSharingScreen,(e=>{var r,n;"screen"===s&&(i?t.isSharingScreen?null===(r=null==d?void 0:d.rtcController)||void 0===r||r.startScreenShare():null===(n=null==d?void 0:d.rtcController)||void 0===n||n.stopScreenShare():g())})),jsxRuntime.exports.jsxs("div",Object.assign({className:`video-view-wrap relative ${t.uuid}-${s}  ${a?"active-border":""} ${r||""}`,onClick:e=>function(e){null==n||n(e)}(e)},{children:[jsxRuntime.exports.jsx("div",{ref:p,className:`video-view h-full w-full ${t.uuid}-${s}-${o}`,style:{display:t.isVideoOn?"block":"none"}}),!t.isVideoOn&&jsxRuntime.exports.jsxs("p",Object.assign({className:"video-view-nickname absolute"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"icon-audio"},{children:t.isAudioOn?jsxRuntime.exports.jsx("i",{className:"iconfont iconyx-tv-voice-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red iconfont iconyx-tv-voice-offx"})})),t.name]})),jsxRuntime.exports.jsx("div",Object.assign({className:"nickname-tip"},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"nickname"},{children:[t.isAudioOn?jsxRuntime.exports.jsx("i",{className:"iconfont iconyx-tv-voice-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red iconfont iconyx-tv-voice-offx"}),t.name]}))}))]}))};var VideoCard$1=React.memo(VideoCard);function groupMembersService(e){const{memberList:t,groupNum:r,focusUuid:n,screenUuid:i,myUuid:o,activeSpeakerUuid:a}=e,s=Array.isArray(t)?[...t]:[];if(1===s.length)return[s];const c=[];if(a&&sortMember2Top(s,a),i&&sortMember2Top(s,i,!0),s.length>=2){const e=s.find((e=>e.uuid===o));if(!i)if(n)sortMember2Top(s,o),sortMember2Top(s,n);else if(a){const t=s.shift();e&&sortMember2Top(s,e.uuid),s.unshift(t)}else{const e=s.shift();if(e&&e.uuid!==o)sortMember2Top(s,o),s.unshift(e);else{const t=s.shift();s.unshift(e),s.unshift(t)}}const t=s.shift(),u=s.shift(),l=Math.ceil(s.length/r);console.log("tmpMemberList",s,t,u);for(let e=0;e<l;e++)c.push(s.slice(e*r,(e+1)*r));c.unshift([t,u])}return c}function sortMember2Top(e,t,r=!1){const n=e.findIndex((e=>e.uuid===t));let i=null;if(n>=0){const[t]=e.splice(n,1);i=t,e.unshift(i),r&&e.unshift(i)}return i}const WhiteboardView=({className:e})=>{const t=react.exports.useRef(null);react.exports.useContext(MeetingInfoContext);const{neMeeting:r}=react.exports.useContext(GlobalContext);return react.exports.useEffect((()=>{var e;t.current&&(null===(e=null==r?void 0:r.whiteboardController)||void 0===e||e.setupWhiteboardCanvas(t.current).then((()=>{var e;null===(e=null==r?void 0:r.whiteboardController)||void 0===e||e.setEnableDraw(!1)})))}),[]),jsxRuntime.exports.jsx("div",Object.assign({className:`whiteboard-wrap ${e}`},{children:jsxRuntime.exports.jsx("div",{ref:t,className:"whiteboard-view"})}))};var WhiteboardView$1=React.memo(WhiteboardView);const MeetingCanvas=e=>{const{className:t}=e,[r,n]=react.exports.useState(4),[i,o]=react.exports.useState(0),{meetingInfo:a,memberList:s}=react.exports.useContext(MeetingInfoContext),[c,u]=react.exports.useState(0),l=react.exports.useMemo((()=>a.screenUuid?"screen":"video"),[a.screenUuid]),d=react.exports.useMemo((()=>groupMembersService({memberList:s,groupNum:r,screenUuid:a.screenUuid,focusUuid:a.focusUuid,myUuid:a.localMember.uuid,activeSpeakerUuid:a.activeSpeakerUuid})),[s,s.length,a.hostUuid,a.focusUuid,a.activeSpeakerUuid,a.screenUuid]);return react.exports.useEffect((()=>{a.screenUuid&&o(0)}),[a.screenUuid]),jsxRuntime.exports.jsxs("div",Object.assign({className:`meeting-canvas ${t}`},{children:[jsxRuntime.exports.jsx(Swiper,Object.assign({spaceBetween:50,slidesPerView:1,modules:[Pagination],pagination:!0,className:"meeting-canvas-swiper h-full w-full",onActiveIndexChange:e=>u(e.activeIndex)},{children:d.map(((e,t)=>jsxRuntime.exports.jsx(SwiperSlide,Object.assign({className:"swiper-slide flex flex-wrap relative"},{children:0===t?e.map(((e,r)=>jsxRuntime.exports.jsx(VideoCard$1,{isMySelf:e.uuid===a.myUuid,isSubscribeVideo:t===c,isMain:0===r,type:0===r?l:"video",className:`${r===i?"full-screen-card":"small-video-card"} ${e.uuid===a.localMember.uuid?"local-member":""}`,onClick:t=>function(e,t,r){t!==i&&r.stopPropagation(),a.screenUuid!==e&&o(t)}(e.uuid,r,t),member:e},`${e.uuid}-main-${r}-${0===r?l:"video"}`))):e.map(((e,r)=>jsxRuntime.exports.jsx(VideoCard$1,{showBorder:a.focusUuid?a.focusUuid===e.uuid:a.activeSpeakerUuid===e.uuid,isSubscribeVideo:t===c,isMain:!1,isMySelf:e.uuid===a.myUuid,type:"video",className:"w-full h-full text-white w-1/2 h-1/2",member:e},e.uuid)))}),t)))})),(null==a?void 0:a.whiteboardUuid)&&jsxRuntime.exports.jsx(WhiteboardView$1,{className:"whiteboard-index"})]}))};var MeetingCanvas$1=React.memo(MeetingCanvas),css_248z$e=':root{--adm-radius-s:4px;--adm-radius-m:8px;--adm-radius-l:12px;--adm-font-size-1:9px;--adm-font-size-2:10px;--adm-font-size-3:11px;--adm-font-size-4:12px;--adm-font-size-5:13px;--adm-font-size-6:14px;--adm-font-size-7:15px;--adm-font-size-8:16px;--adm-font-size-9:17px;--adm-font-size-10:18px;--adm-color-primary:#1677ff;--adm-color-success:#00b578;--adm-color-warning:#ff8f1f;--adm-color-danger:#ff3141;--adm-color-white:#fff;--adm-color-text:#333;--adm-color-text-secondary:#666;--adm-color-weak:#999;--adm-color-light:#ccc;--adm-color-border:#eee;--adm-color-box:#f5f5f5;--adm-color-background:#fff;--adm-font-size-main:var(--adm-font-size-5);--adm-font-family:-apple-system,blinkmacsystemfont,"Helvetica Neue",helvetica,segoe ui,arial,roboto,"PingFang SC","miui","Hiragino Sans GB","Microsoft Yahei",sans-serif;--adm-border-color:var(--adm-color-border)}html[data-prefers-color-scheme=dark]{--adm-color-primary:#3086ff;--adm-color-success:#34b368;--adm-color-warning:#ffa930;--adm-color-danger:#ff4a58;--adm-color-text:#e6e6e6;--adm-color-text-secondary:#b3b3b3;--adm-color-weak:grey;--adm-color-light:#4d4d4d;--adm-color-border:#2b2b2b;--adm-color-box:#0a0a0a;--adm-color-background:#1a1a1a;--adm-border-color:var(--adm-color-border)}:root{-webkit-tap-highlight-color:rgba(0,0,0,0)}body{color:var(--adm-color-text);font-family:var(--adm-font-family);font-size:var(--adm-font-size-main)}a,button{cursor:pointer}a{color:var(--adm-color-primary);transition:opacity .2s ease-in-out}a:active{opacity:.8}.adm-plain-anchor{color:unset;transition:none}.adm-plain-anchor:active{opacity:unset}body.adm-overflow-hidden{overflow:hidden!important}div.adm-px-tester{--size:1;bottom:-100vh;height:calc(var(--size)/2*2px);pointer-events:none;position:fixed;right:-100vw;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:0}';styleInject(css_248z$e);const canUseDom=!("undefined"==typeof window||"undefined"==typeof document||!window.document||!window.document.createElement);function __awaiter$1(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function mergeLocale(e,t){return function e(t,r){if("object"!=typeof t||"object"!=typeof r||Array.isArray(t)||Array.isArray(r))return void 0!==r?r:t;const n={};for(const i in t)t.hasOwnProperty(i)&&(n[i]=e(t[i],r[i]));return n}(e,t)}canUseDom&&document.addEventListener("touchstart",(()=>{}),!0);const typeTemplate$1="${label} is not a valid ${type}",base={locale:"en",common:{confirm:"Confirm",cancel:"Cancel",loading:"Loading"},Calendar:{markItems:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],renderYearAndMonth:(e,t)=>`${e}/${t}`},Cascader:{placeholder:"Selecting"},Dialog:{ok:"OK"},ErrorBlock:{default:{title:"Oops, something went wrong",description:"Please wait a minute and try again"},busy:{title:"Oops, not loading",description:"Try to refresh the page"},disconnected:{title:"Network is busy",description:"Try to refresh the page"},empty:{title:"Hmm, couldn't find that...",description:"Want to try a new search?"}},Form:{required:"Required",optional:"Optional",defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:typeTemplate$1,method:typeTemplate$1,array:typeTemplate$1,object:typeTemplate$1,number:typeTemplate$1,date:typeTemplate$1,boolean:typeTemplate$1,integer:typeTemplate$1,float:typeTemplate$1,regexp:typeTemplate$1,email:typeTemplate$1,url:typeTemplate$1,hex:typeTemplate$1},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},ImageUploader:{uploading:"Uploading...",upload:"Upload"},InfiniteScroll:{noMore:"No more",failedToLoad:"Failed to load",retry:"Retry"},Input:{clear:"clear"},Mask:{name:"Mask"},Modal:{ok:"OK"},PasscodeInput:{name:"Passcode Input"},PullToRefresh:{pulling:"Scroll down to refresh",canRelease:"Release to refresh immediately",complete:"Refresh successful"},SearchBar:{name:"Search Bar"},Slider:{name:"Slider"},Stepper:{decrease:"decrease",increase:"increase"},Switch:{name:"Switch"}},typeTemplate="${label}不是一个有效的${type}",zhCN=mergeLocale(base,{locale:"zh-CH",common:{confirm:"确定",cancel:"取消",loading:"加载中"},Calendar:{markItems:["一","二","三","四","五","六","日"],renderYearAndMonth:(e,t)=>`${e}年${t}月`},Cascader:{placeholder:"请选择"},Dialog:{ok:"我知道了"},ErrorBlock:{default:{title:"页面遇到一些小问题",description:"待会来试试"},busy:{title:"前方拥堵",description:"刷新试试"},disconnected:{title:"网络有点忙",description:"动动手指帮忙修复"},empty:{title:"没有找到你需要的东西",description:"找找其他的吧"}},Form:{required:"必填",optional:"选填",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:typeTemplate,method:typeTemplate,array:typeTemplate,object:typeTemplate,number:typeTemplate,date:typeTemplate,boolean:typeTemplate,integer:typeTemplate,float:typeTemplate,regexp:typeTemplate,email:typeTemplate,url:typeTemplate,hex:typeTemplate},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},ImageUploader:{uploading:"上传中...",upload:"上传"},InfiniteScroll:{noMore:"没有更多了",failedToLoad:"加载失败",retry:"重新加载"},Input:{clear:"清除"},Mask:{name:"遮罩层"},Modal:{ok:"我知道了"},PasscodeInput:{name:"密码输入框"},PullToRefresh:{pulling:"下拉刷新",canRelease:"释放立即刷新",complete:"刷新成功"},SearchBar:{name:"搜索框"},Slider:{name:"滑动输入条"},Stepper:{decrease:"减少",increase:"增加"},Switch:{name:"开关"}});var zhCN$1=zhCN;const defaultConfigRef={current:{locale:zhCN$1}};function getDefaultConfig(){return defaultConfigRef.current}const ConfigContext=React.createContext(null);function useConfig(){var e;return null!==(e=react.exports.useContext(ConfigContext))&&void 0!==e?e:getDefaultConfig()}var css_248z$d=".adm-action-sheet-popup>.adm-popup-body{border-top-left-radius:8px;border-top-right-radius:8px;overflow:hidden}.adm-action-sheet-extra{color:var(--adm-color-weak);display:flex;font-size:var(--adm-font-size-7);justify-content:center;padding:18px 12px}.adm-action-sheet-button-item-wrapper,.adm-action-sheet-button-list,.adm-action-sheet-extra{border-bottom:1px solid var(--adm-color-border)}.adm-action-sheet-button-item-wrapper:last-child{border-bottom:none}.adm-action-sheet-button-item{background-color:var(--adm-color-background);display:block;padding:16px;text-align:center}.adm-action-sheet-button-item:active{background-color:#eee}.adm-action-sheet-button-item-disabled{cursor:not-allowed;opacity:.4;pointer-events:none}.adm-action-sheet-button-item-name{color:var(--adm-color-text);font-size:var(--adm-font-size-10)}.adm-action-sheet-button-item-description{color:var(--adm-color-weak);font-size:var(--adm-font-size-4);padding-top:2px}.adm-action-sheet-button-item-danger .adm-action-sheet-button-item-name{color:var(--adm-color-danger)}.adm-action-sheet-cancel{background-color:var(--adm-color-box);padding-top:8px}";function attachPropertiesToComponent(e,t){const r=e;for(const e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}styleInject(css_248z$d);var classnames={exports:{}};!function(e){!function(){var t={}.hasOwnProperty;function r(){for(var e=[],n=0;n<arguments.length;n++){var i=arguments[n];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)){if(i.length){var a=r.apply(null,i);a&&e.push(a)}}else if("object"===o)if(i.toString===Object.prototype.toString)for(var s in i)t.call(i,s)&&i[s]&&e.push(s);else e.push(i.toString())}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):window.classNames=r}()}(classnames);var classNames=classnames.exports;function withNativeProps(e,t){const r=Object.assign({},t.props);e.className&&(r.className=classNames(t.props.className,e.className)),e.style&&(r.style=Object.assign(Object.assign({},r.style),e.style)),void 0!==e.tabIndex&&(r.tabIndex=e.tabIndex);for(const t in e)e.hasOwnProperty(t)&&(t.startsWith("data-")||t.startsWith("aria-"))&&(r[t]=e[t]);return React.cloneElement(t,r)}var freeGlobal$1="object"==typeof commonjsGlobal$1&&commonjsGlobal$1&&commonjsGlobal$1.Object===Object&&commonjsGlobal$1,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root$2=freeGlobal||freeSelf||Function("return this")(),_root=root$2,root$1=_root,Symbol$3=root$1.Symbol,_Symbol=Symbol$3,Symbol$2=_Symbol,objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty,nativeObjectToString$1=objectProto$7.toString,symToStringTag$1=Symbol$2?Symbol$2.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$5.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch(e){}var i=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),i}var _getRawTag=getRawTag$1,objectProto$6=Object.prototype,nativeObjectToString=objectProto$6.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,Symbol$1=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag$3(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$3;function isObject$5(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var isObject_1=isObject$5,baseGetTag$2=_baseGetTag,isObject$4=isObject_1,asyncTag="[object AsyncFunction]",funcTag$1="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$4(e){if(!isObject$4(e))return!1;var t=baseGetTag$2(e);return t==funcTag$1||t==genTag||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$4,root=_root,coreJsData$1=root["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""),uid?"Symbol(src)_1."+uid:""),uid;function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource$1(e){if(null!=e){try{return funcToString$1.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var _toSource=toSource$1,isFunction$3=isFunction_1,isMasked=_isMasked,isObject$3=isObject_1,toSource=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$5=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$4=objectProto$5.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$4).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){return!(!isObject$3(e)||isMasked(e))&&(isFunction$3(e)?reIsNative:reIsHostCtor).test(toSource(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return null==e?void 0:e[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$1(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$1,getNative=_getNative,defineProperty$2=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),_defineProperty=defineProperty$2,defineProperty$1=_defineProperty;function baseAssignValue$2(e,t,r){"__proto__"==t&&defineProperty$1?defineProperty$1(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var _baseAssignValue=baseAssignValue$2;function eq$2(e,t){return e===t||e!=e&&t!=t}var eq_1=eq$2,baseAssignValue$1=_baseAssignValue,eq$1=eq_1,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function assignValue$1(e,t,r){var n=e[t];hasOwnProperty$3.call(e,t)&&eq$1(n,r)&&(void 0!==r||t in e)||baseAssignValue$1(e,t,r)}var _assignValue=assignValue$1,assignValue=_assignValue,baseAssignValue=_baseAssignValue;function copyObject$1(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=n?n(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),i?baseAssignValue(r,s,c):assignValue(r,s,c)}return r}var _copyObject=copyObject$1;function identity$2(e){return e}var identity_1=identity$2;function apply$1(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _apply=apply$1,apply=_apply,nativeMax=Math.max;function overRest$1(e,t,r){return t=nativeMax(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=nativeMax(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(a),apply(e,this,s)}}var _overRest=overRest$1;function constant$1(e){return function(){return e}}var constant_1=constant$1,constant=constant_1,defineProperty=_defineProperty,identity$1=identity_1,baseSetToString$1=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity$1,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(e){var t=0,r=0;return function(){var n=nativeNow(),i=HOT_SPAN-(n-r);if(r=n,i>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$1=shortOut(baseSetToString),_setToString=setToString$1,identity=identity_1,overRest=_overRest,setToString=_setToString;function baseRest$1(e,t){return setToString(overRest(e,t,identity),e+"")}var _baseRest=baseRest$1,MAX_SAFE_INTEGER$1=9007199254740991;function isLength$2(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$1}var isLength_1=isLength$2,isFunction$2=isFunction_1,isLength$1=isLength_1;function isArrayLike$2(e){return null!=e&&isLength$1(e.length)&&!isFunction$2(e)}var isArrayLike_1=isArrayLike$2,MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$2(e,t){var r=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$2,eq=eq_1,isArrayLike$1=isArrayLike_1,isIndex$1=_isIndex,isObject$2=isObject_1;function isIterateeCall$1(e,t,r){if(!isObject$2(r))return!1;var n=typeof t;return!!("number"==n?isArrayLike$1(r)&&isIndex$1(t,r.length):"string"==n&&t in r)&&eq(r[t],e)}var _isIterateeCall=isIterateeCall$1,baseRest=_baseRest,isIterateeCall=_isIterateeCall;function createAssigner$1(e){return baseRest((function(t,r){var n=-1,i=r.length,o=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&isIterateeCall(r[0],r[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,o)}return t}))}var _createAssigner=createAssigner$1;function baseTimes$1(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes$1;function isObjectLike$3(e){return null!=e&&"object"==typeof e}var isObjectLike_1=isObjectLike$3,baseGetTag$1=_baseGetTag,isObjectLike$2=isObjectLike_1,argsTag$1="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$2(e)&&baseGetTag$1(e)==argsTag$1}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$1=isObjectLike_1,objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,isArguments$1=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$1(e)&&hasOwnProperty$2.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArguments_1=isArguments$1,isArray$3=Array.isArray,isArray_1=isArray$3,isBuffer$3={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;!function(e,t){var r=_root,n=stubFalse_1,i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i?r.Buffer:void 0,s=(a?a.isBuffer:void 0)||n;e.exports=s}(isBuffer$3,isBuffer$3.exports);var baseGetTag=_baseGetTag,isLength=isLength_1,isObjectLike=isObjectLike_1,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray$1(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$1(e){return function(t){return e(t)}}var _baseUnary=baseUnary$1,_nodeUtil={exports:{}};!function(e,t){var r=_freeGlobal,n=t&&!t.nodeType&&t,i=n&&e&&!e.nodeType&&e,o=i&&i.exports===n&&r.process,a=function(){try{var e=i&&i.require&&i.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a}(_nodeUtil,_nodeUtil.exports);var baseIsTypedArray=_baseIsTypedArray,baseUnary=_baseUnary,nodeUtil=_nodeUtil.exports,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray$2=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$2,baseTimes=_baseTimes,isArguments=isArguments_1,isArray$2=isArray_1,isBuffer$2=isBuffer$3.exports,isIndex=_isIndex,isTypedArray$1=isTypedArray_1,objectProto$2=Object.prototype,hasOwnProperty$1=objectProto$2.hasOwnProperty;function arrayLikeKeys$1(e,t){var r=isArray$2(e),n=!r&&isArguments(e),i=!r&&!n&&isBuffer$2(e),o=!r&&!n&&!i&&isTypedArray$1(e),a=r||n||i||o,s=a?baseTimes(e.length,String):[],c=s.length;for(var u in e)!t&&!hasOwnProperty$1.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex(u,c))||s.push(u);return s}var _arrayLikeKeys=arrayLikeKeys$1,objectProto$1=Object.prototype;function isPrototype$1(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$1)}var _isPrototype=isPrototype$1;function overArg$1(e,t){return function(r){return e(t(r))}}var _overArg=overArg$1,overArg=_overArg,nativeKeys$1=overArg(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype=_isPrototype,nativeKeys=_nativeKeys,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseKeys$1(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty.call(e,r)&&"constructor"!=r&&t.push(r);return t}var _baseKeys=baseKeys$1,arrayLikeKeys=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike=isArrayLike_1;function keys$1(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}var keys_1=keys$1,copyObject=_copyObject,createAssigner=_createAssigner,keys=keys_1,assignWith=createAssigner((function(e,t,r,n){copyObject(t,keys(t),e,n)})),assignWith_1=assignWith;function mergeProps(...e){function t(e,t){return void 0===t?e:t}let r=Object.assign({},e[0]);for(let n=1;n<e.length;n++)r=assignWith_1(r,e[n],t);return r}var css_248z$c=".adm-popup{--z-index:var(--adm-popup-z-index,1000);position:fixed;z-index:var(--z-index)}.adm-popup-body{background-color:var(--adm-color-background);position:fixed;z-index:calc(var(--z-index) + 10)}.adm-popup-body .adm-popup-close-icon{position:absolute;z-index:100}.adm-popup-body-position-bottom{bottom:0;left:0;width:100%}.adm-popup-body-position-bottom .adm-popup-close-icon{right:8px;top:8px}.adm-popup-body-position-top{left:0;top:0;width:100%}.adm-popup-body-position-top .adm-popup-close-icon{bottom:8px;right:8px}.adm-popup-body-position-left{height:100%;left:0;top:0}.adm-popup-body-position-left .adm-popup-close-icon{right:8px;top:8px}.adm-popup-body-position-right{height:100%;right:0;top:0}.adm-popup-body-position-right .adm-popup-close-icon{left:8px;top:8px}.adm-popup-close-icon{color:var(--adm-color-weak);cursor:pointer;font-size:18px;padding:4px}";styleInject(css_248z$c);var isBrowser=!("undefined"==typeof window||!window.document||!window.document.createElement),isBrowser$1=isBrowser,useIsomorphicLayoutEffect$1=isBrowser$1?react.exports.useLayoutEffect:react.exports.useEffect,useIsomorphicLayoutEffect$2=useIsomorphicLayoutEffect$1,useUnmountedRef=function(){var e=react.exports.useRef(!1);return react.exports.useEffect((function(){return e.current=!1,function(){e.current=!0}}),[]),e},useUnmountedRef$1=useUnmountedRef,css_248z$b=".adm-mask{--z-index:var(--adm-mask-z-index,1000);display:block;position:fixed;z-index:var(--z-index)}.adm-mask,.adm-mask-aria-button{height:100%;left:0;top:0;width:100%}.adm-mask-aria-button{pointer-events:none;position:absolute;z-index:0}.adm-mask-content{z-index:1}";styleInject(css_248z$b);const MIN_DISTANCE=10;function getDirection(e,t){return e>t&&e>MIN_DISTANCE?"horizontal":t>e&&t>MIN_DISTANCE?"vertical":""}function useTouch(){const e=react.exports.useRef(0),t=react.exports.useRef(0),r=react.exports.useRef(0),n=react.exports.useRef(0),i=react.exports.useRef(0),o=react.exports.useRef(0),a=react.exports.useRef(""),s=()=>{r.current=0,n.current=0,i.current=0,o.current=0,a.current=""};return{move:s=>{const c=s.touches[0];r.current=c.clientX<0?0:c.clientX-e.current,n.current=c.clientY-t.current,i.current=Math.abs(r.current),o.current=Math.abs(n.current),a.current||(a.current=getDirection(i.current,o.current))},start:r=>{s(),e.current=r.touches[0].clientX,t.current=r.touches[0].clientY},reset:s,startX:e,startY:t,deltaX:r,deltaY:n,offsetX:i,offsetY:o,direction:a,isVertical:()=>"vertical"===a.current,isHorizontal:()=>"horizontal"===a.current}}const defaultRoot=canUseDom?window:void 0,overflowStylePatterns=["scroll","auto","overlay"];function isElement(e){return 1===e.nodeType}function getScrollParent(e,t=defaultRoot){let r=e;for(;r&&r!==t&&isElement(r);){if(r===document.body)return t;const{overflowY:e}=window.getComputedStyle(r);if(overflowStylePatterns.includes(e)&&r.scrollHeight>r.clientHeight)return r;r=r.parentNode}return t}let supportsPassive=!1;if(canUseDom)try{const e={};Object.defineProperty(e,"passive",{get(){supportsPassive=!0}}),window.addEventListener("test-passive",null,e)}catch(e){}let totalLockCount=0;const BODY_LOCK_CLASS="adm-overflow-hidden";function useLockScroll(e,t){const r=useTouch(),n=t=>{r.move(t);const n=r.deltaY.current>0?"10":"01",i=getScrollParent(t.target,e.current);if(!i)return;const{scrollHeight:o,offsetHeight:a,scrollTop:s}=i;let c="11";0===s?c=a>=o?"00":"01":s+a>=o&&(c="10"),"11"===c||!r.isVertical()||parseInt(c,2)&parseInt(n,2)||t.cancelable&&t.preventDefault()};react.exports.useEffect((()=>{if(t)return document.addEventListener("touchstart",r.start),document.addEventListener("touchmove",n,!!supportsPassive&&{passive:!1}),totalLockCount||document.body.classList.add(BODY_LOCK_CLASS),totalLockCount++,()=>{totalLockCount&&(document.removeEventListener("touchstart",r.start),document.removeEventListener("touchmove",n),totalLockCount--,totalLockCount||document.body.classList.remove(BODY_LOCK_CLASS))}}),[t])}let updateQueue=makeQueue();const raf=e=>schedule(e,updateQueue);let writeQueue=makeQueue();raf.write=e=>schedule(e,writeQueue);let onStartQueue=makeQueue();raf.onStart=e=>schedule(e,onStartQueue);let onFrameQueue=makeQueue();raf.onFrame=e=>schedule(e,onFrameQueue);let onFinishQueue=makeQueue();raf.onFinish=e=>schedule(e,onFinishQueue);let timeouts=[];raf.setTimeout=(e,t)=>{let r=raf.now()+t,n=()=>{let e=timeouts.findIndex((e=>e.cancel==n));~e&&timeouts.splice(e,1),pendingCount-=~e?1:0},i={time:r,handler:e,cancel:n};return timeouts.splice(findTimeout(r),0,i),pendingCount+=1,start(),i};let findTimeout=e=>~(~timeouts.findIndex((t=>t.time>e))||~timeouts.length);raf.cancel=e=>{onStartQueue.delete(e),onFrameQueue.delete(e),onFinishQueue.delete(e),updateQueue.delete(e),writeQueue.delete(e)},raf.sync=e=>{sync=!0,raf.batchedUpdates(e),sync=!1},raf.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function n(...e){t=e,raf.onStart(r)}return n.handler=e,n.cancel=()=>{onStartQueue.delete(r),t=null},n};let nativeRaf="undefined"!=typeof window?window.requestAnimationFrame:()=>{};raf.use=e=>nativeRaf=e,raf.now="undefined"!=typeof performance?()=>performance.now():Date.now,raf.batchedUpdates=e=>e(),raf.catch=console.error,raf.frameLoop="always",raf.advance=()=>{"demand"!==raf.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):update()};let ts=-1,pendingCount=0,sync=!1;function schedule(e,t){sync?(t.delete(e),e(0)):(t.add(e),start())}function start(){ts<0&&(ts=0,"demand"!==raf.frameLoop&&nativeRaf(loop))}function stop(){ts=-1}function loop(){~ts&&(nativeRaf(loop),raf.batchedUpdates(update))}function update(){let e=ts;ts=raf.now();let t=findTimeout(ts);t&&(eachSafely(timeouts.splice(0,t),(e=>e.handler())),pendingCount-=t),pendingCount?(onStartQueue.flush(),updateQueue.flush(e?Math.min(64,ts-e):16.667),onFrameQueue.flush(),writeQueue.flush(),onFinishQueue.flush()):stop()}function makeQueue(){let e=new Set,t=e;return{add(r){pendingCount+=t!=e||e.has(r)?0:1,e.add(r)},delete:r=>(pendingCount-=t==e&&e.has(r)?1:0,e.delete(r)),flush(r){t.size&&(e=new Set,pendingCount-=t.size,eachSafely(t,(t=>t(r)&&e.add(t))),pendingCount+=e.size,t=e)}}}function eachSafely(e,t){e.forEach((e=>{try{t(e)}catch(e){raf.catch(e)}}))}function noop(){}const defineHidden=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),is={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function isEqual(e,t){if(is.arr(e)){if(!is.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}const each=(e,t)=>e.forEach(t);function eachProp(e,t,r){if(is.arr(e))for(let n=0;n<e.length;n++)t.call(r,e[n],`${n}`);else for(const n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n)}const toArray$1=e=>is.und(e)?[]:is.arr(e)?e:[e];function flush(e,t){if(e.size){const r=Array.from(e);e.clear(),each(r,t)}}const flushCalls=(e,...t)=>flush(e,(e=>e(...t))),isSSR=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let createStringInterpolator$1,to,colors$1=null,skipAnimation=!1,willAdvance=noop;const assign=e=>{e.to&&(to=e.to),e.now&&(raf.now=e.now),void 0!==e.colors&&(colors$1=e.colors),null!=e.skipAnimation&&(skipAnimation=e.skipAnimation),e.createStringInterpolator&&(createStringInterpolator$1=e.createStringInterpolator),e.requestAnimationFrame&&raf.use(e.requestAnimationFrame),e.batchedUpdates&&(raf.batchedUpdates=e.batchedUpdates),e.willAdvance&&(willAdvance=e.willAdvance),e.frameLoop&&(raf.frameLoop=e.frameLoop)};var globals=Object.freeze({__proto__:null,get createStringInterpolator(){return createStringInterpolator$1},get to(){return to},get colors(){return colors$1},get skipAnimation(){return skipAnimation},get willAdvance(){return willAdvance},assign:assign});const startQueue=new Set;let currentFrame=[],prevFrame=[],priority=0;const frameLoop={get idle(){return!startQueue.size&&!currentFrame.length},start(e){priority>e.priority?(startQueue.add(e),raf.onStart(flushStartQueue)):(startSafely(e),raf(advance))},advance:advance,sort(e){if(priority)raf.onFrame((()=>frameLoop.sort(e)));else{const t=currentFrame.indexOf(e);~t&&(currentFrame.splice(t,1),startUnsafely(e))}},clear(){currentFrame=[],startQueue.clear()}};function flushStartQueue(){startQueue.forEach(startSafely),startQueue.clear(),raf(advance)}function startSafely(e){currentFrame.includes(e)||startUnsafely(e)}function startUnsafely(e){currentFrame.splice(findIndex(currentFrame,(t=>t.priority>e.priority)),0,e)}function advance(e){const t=prevFrame;for(let r=0;r<currentFrame.length;r++){const n=currentFrame[r];priority=n.priority,n.idle||(willAdvance(n),n.advance(e),n.idle||t.push(n))}return priority=0,prevFrame=currentFrame,prevFrame.length=0,currentFrame=t,currentFrame.length>0}function findIndex(e,t){const r=e.findIndex(t);return r<0?e.length:r}const colors={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},NUMBER="[-+]?\\d*\\.?\\d+",PERCENTAGE=NUMBER+"%";function call(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const rgb=new RegExp("rgb"+call(NUMBER,NUMBER,NUMBER)),rgba=new RegExp("rgba"+call(NUMBER,NUMBER,NUMBER,NUMBER)),hsl=new RegExp("hsl"+call(NUMBER,PERCENTAGE,PERCENTAGE)),hsla=new RegExp("hsla"+call(NUMBER,PERCENTAGE,PERCENTAGE,NUMBER)),hex3=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex4=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6=/^#([0-9a-fA-F]{6})$/,hex8=/^#([0-9a-fA-F]{8})$/;function normalizeColor(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=hex6.exec(e))?parseInt(t[1]+"ff",16)>>>0:colors$1&&void 0!==colors$1[e]?colors$1[e]:(t=rgb.exec(e))?(parse255(t[1])<<24|parse255(t[2])<<16|parse255(t[3])<<8|255)>>>0:(t=rgba.exec(e))?(parse255(t[1])<<24|parse255(t[2])<<16|parse255(t[3])<<8|parse1(t[4]))>>>0:(t=hex3.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=hex8.exec(e))?parseInt(t[1],16)>>>0:(t=hex4.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=hsl.exec(e))?(255|hslToRgb(parse360(t[1]),parsePercentage(t[2]),parsePercentage(t[3])))>>>0:(t=hsla.exec(e))?(hslToRgb(parse360(t[1]),parsePercentage(t[2]),parsePercentage(t[3]))|parse1(t[4]))>>>0:null}function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function hslToRgb(e,t,r){const n=r<.5?r*(1+t):r+t-r*t,i=2*r-n,o=hue2rgb(i,n,e+1/3),a=hue2rgb(i,n,e),s=hue2rgb(i,n,e-1/3);return Math.round(255*o)<<24|Math.round(255*a)<<16|Math.round(255*s)<<8}function parse255(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function parse360(e){return(parseFloat(e)%360+360)%360/360}function parse1(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function parsePercentage(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function colorToRgba(e){let t=normalizeColor(e);return null===t?e:(t=t||0,`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`)}const createInterpolator=(e,t,r)=>{if(is.fun(e))return e;if(is.arr(e))return createInterpolator({range:e,output:t,extrapolate:r});if(is.str(e.output[0]))return createStringInterpolator$1(e);const n=e,i=n.output,o=n.range||[0,1],a=n.extrapolateLeft||n.extrapolate||"extend",s=n.extrapolateRight||n.extrapolate||"extend",c=n.easing||(e=>e);return e=>{const t=findRange(e,o);return interpolate(e,o[t],o[t+1],i[t],i[t+1],c,a,s,n.map)}};function interpolate(e,t,r,n,i,o,a,s,c){let u=c?c(e):e;if(u<t){if("identity"===a)return u;"clamp"===a&&(u=t)}if(u>r){if("identity"===s)return u;"clamp"===s&&(u=r)}return n===i?n:t===r?e<=t?n:i:(t===-1/0?u=-u:r===1/0?u-=t:u=(u-t)/(r-t),u=o(u),n===-1/0?u=-u:i===1/0?u+=n:u=u*(i-n)+n,u)}function findRange(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}function _extends$2(){return _extends$2=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends$2.apply(this,arguments)}const $get=Symbol.for("FluidValue.get"),$observers=Symbol.for("FluidValue.observers"),hasFluidValue=e=>Boolean(e&&e[$get]),getFluidValue=e=>e&&e[$get]?e[$get]():e,getFluidObservers=e=>e[$observers]||null;function callFluidObserver(e,t){e.eventObserved?e.eventObserved(t):e(t)}function callFluidObservers(e,t){let r=e[$observers];r&&r.forEach((e=>{callFluidObserver(e,t)}))}class FluidValue{constructor(e){if(this[$get]=void 0,this[$observers]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");setFluidGetter(this,e)}}const setFluidGetter=(e,t)=>setHidden(e,$get,t);function addFluidObserver(e,t){if(e[$get]){let r=e[$observers];r||setHidden(e,$observers,r=new Set),r.has(t)||(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function removeFluidObserver(e,t){let r=e[$observers];if(r&&r.has(t)){const n=r.size-1;n?r.delete(t):e[$observers]=null,e.observerRemoved&&e.observerRemoved(n,t)}}const setHidden=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),numberRegex=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,colorRegex=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,unitRegex=new RegExp(`(${numberRegex.source})(%|[a-z]+)`,"i"),rgbaRegex=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,cssVariableRegex=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,variableToRgba=e=>{const[t,r]=parseCSSVariable(e);if(!t||isSSR())return e;const n=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(n)return n.trim();if(r&&r.startsWith("--")){const t=window.getComputedStyle(document.documentElement).getPropertyValue(r);return t||e}return r&&cssVariableRegex.test(r)?variableToRgba(r):r||e},parseCSSVariable=e=>{const t=cssVariableRegex.exec(e);if(!t)return[,];const[,r,n]=t;return[r,n]};let namedColorRegex;const rgbaRound=(e,t,r,n,i)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(n)}, ${i})`,createStringInterpolator=e=>{namedColorRegex||(namedColorRegex=colors$1?new RegExp(`(${Object.keys(colors$1).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map((e=>getFluidValue(e).replace(cssVariableRegex,variableToRgba).replace(colorRegex,colorToRgba).replace(namedColorRegex,colorToRgba))),r=t.map((e=>e.match(numberRegex).map(Number))),n=r[0].map(((e,t)=>r.map((e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})))).map((t=>createInterpolator(_extends$2({},e,{output:t}))));return e=>{var r;const i=!unitRegex.test(t[0])&&(null==(r=t.find((e=>unitRegex.test(e))))?void 0:r.replace(numberRegex,""));let o=0;return t[0].replace(numberRegex,(()=>`${n[o++](e)}${i||""}`)).replace(rgbaRegex,rgbaRound)}},prefix="react-spring: ",once=e=>{const t=e;let r=!1;if("function"!=typeof t)throw new TypeError(`${prefix}once requires a function parameter`);return(...e)=>{r||(t(...e),r=!0)}},warnInterpolate=once(console.warn);function deprecateInterpolate(){warnInterpolate(`${prefix}The "interpolate" function is deprecated in v9 (use "to" instead)`)}const warnDirectCall=once(console.warn);function deprecateDirectCall(){warnDirectCall(`${prefix}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function isAnimatedString(e){return is.str(e)&&("#"==e[0]||/\d/.test(e)||!isSSR()&&cssVariableRegex.test(e)||e in(colors$1||{}))}const useIsomorphicLayoutEffect=isSSR()?react.exports.useEffect:react.exports.useLayoutEffect,useIsMounted=()=>{const e=react.exports.useRef(!1);return useIsomorphicLayoutEffect((()=>(e.current=!0,()=>{e.current=!1})),[]),e};function useForceUpdate(){const e=react.exports.useState()[1],t=useIsMounted();return()=>{t.current&&e(Math.random())}}function useMemoOne(e,t){const[r]=react.exports.useState((()=>({inputs:t,result:e()}))),n=react.exports.useRef(),i=n.current;let o=i;if(o){Boolean(t&&o.inputs&&areInputsEqual(t,o.inputs))||(o={inputs:t,result:e()})}else o=r;return react.exports.useEffect((()=>{n.current=o,i==r&&(r.inputs=r.result=void 0)}),[o]),o.result}function areInputsEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const useOnce=e=>react.exports.useEffect(e,emptyDeps),emptyDeps=[];function usePrev(e){const t=react.exports.useRef();return react.exports.useEffect((()=>{t.current=e})),t.current}const $node=Symbol.for("Animated:node"),isAnimated=e=>!!e&&e[$node]===e,getAnimated=e=>e&&e[$node],setAnimated=(e,t)=>defineHidden(e,$node,t),getPayload=e=>e&&e[$node]&&e[$node].getPayload();class Animated{constructor(){this.payload=void 0,setAnimated(this,this)}getPayload(){return this.payload||[]}}class AnimatedValue extends Animated{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,is.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new AnimatedValue(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return is.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,is.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class AnimatedString extends AnimatedValue{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=createInterpolator({output:[e,e]})}static create(e){return new AnimatedString(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(is.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=createInterpolator({output:[this.getValue(),e]})),this._value=0,super.reset()}}const TreeContext={dependencies:null};class AnimatedObject extends Animated{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return eachProp(this.source,((r,n)=>{isAnimated(r)?t[n]=r.getValue(e):hasFluidValue(r)?t[n]=getFluidValue(r):e||(t[n]=r)})),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&each(this.payload,(e=>e.reset()))}_makePayload(e){if(e){const t=new Set;return eachProp(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){TreeContext.dependencies&&hasFluidValue(e)&&TreeContext.dependencies.add(e);const t=getPayload(e);t&&each(t,(e=>this.add(e)))}}class AnimatedArray extends AnimatedObject{constructor(e){super(e)}static create(e){return new AnimatedArray(e)}getValue(){return this.source.map((e=>e.getValue()))}setValue(e){const t=this.getPayload();return e.length==t.length?t.map(((t,r)=>t.setValue(e[r]))).some(Boolean):(super.setValue(e.map(makeAnimated)),!0)}}function makeAnimated(e){return(isAnimatedString(e)?AnimatedString:AnimatedValue).create(e)}function getAnimatedType(e){const t=getAnimated(e);return t?t.constructor:is.arr(e)?AnimatedArray:isAnimatedString(e)?AnimatedString:AnimatedValue}function _extends$1(){return _extends$1=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends$1.apply(this,arguments)}const withAnimated=(e,t)=>{const r=!is.fun(e)||e.prototype&&e.prototype.isReactComponent;return react.exports.forwardRef(((n,i)=>{const o=react.exports.useRef(null),a=r&&react.exports.useCallback((e=>{o.current=updateRef(i,e)}),[i]),[s,c]=getAnimatedState(n,t),u=useForceUpdate(),l=()=>{const e=o.current;if(r&&!e)return;!1===(!!e&&t.applyAnimatedValues(e,s.getValue(!0)))&&u()},d=new PropsObserver(l,c),p=react.exports.useRef();useIsomorphicLayoutEffect((()=>(p.current=d,each(c,(e=>addFluidObserver(e,d))),()=>{p.current&&(each(p.current.deps,(e=>removeFluidObserver(e,p.current))),raf.cancel(p.current.update))}))),react.exports.useEffect(l,[]),useOnce((()=>()=>{const e=p.current;each(e.deps,(t=>removeFluidObserver(t,e)))}));const f=t.getComponentProps(s.getValue());return react.exports.createElement(e,_extends$1({},f,{ref:a}))}))};class PropsObserver{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&raf.write(this.update)}}function getAnimatedState(e,t){const r=new Set;return TreeContext.dependencies=r,e.style&&(e=_extends$1({},e,{style:t.createAnimatedStyle(e.style)})),e=new AnimatedObject(e),TreeContext.dependencies=null,[e,r]}function updateRef(e,t){return e&&(is.fun(e)?e(t):e.current=t),t}const cacheKey=Symbol.for("AnimatedComponent"),createHost=(e,{applyAnimatedValues:t=(()=>!1),createAnimatedStyle:r=(e=>new AnimatedObject(e)),getComponentProps:n=(e=>e)}={})=>{const i={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:n},o=e=>{const t=getDisplayName(e)||"Anonymous";return(e=is.str(e)?o[e]||(o[e]=withAnimated(e,i)):e[cacheKey]||(e[cacheKey]=withAnimated(e,i))).displayName=`Animated(${t})`,e};return eachProp(e,((t,r)=>{is.arr(e)&&(r=getDisplayName(t)),o[r]=o(t)})),{animated:o}},getDisplayName=e=>is.str(e)?e:e&&is.str(e.displayName)?e.displayName:is.fun(e)&&e.name||null;function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}function callProp(e,...t){return is.fun(e)?e(...t):e}const matchProp=(e,t)=>!0===e||!!(t&&e&&(is.fun(e)?e(t):toArray$1(e).includes(t))),resolveProp=(e,t)=>is.obj(e)?t&&e[t]:e,getDefaultProp=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,noopTransform=e=>e,getDefaultProps=(e,t=noopTransform)=>{let r=DEFAULT_PROPS;e.default&&!0!==e.default&&(e=e.default,r=Object.keys(e));const n={};for(const i of r){const r=t(e[i],i);is.und(r)||(n[i]=r)}return n},DEFAULT_PROPS=["config","onProps","onStart","onChange","onPause","onResume","onRest"],RESERVED_PROPS={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function getForwardProps(e){const t={};let r=0;if(eachProp(e,((e,n)=>{RESERVED_PROPS[n]||(t[n]=e,r++)})),r)return t}function inferTo(e){const t=getForwardProps(e);if(t){const r={to:t};return eachProp(e,((e,n)=>n in t||(r[n]=e))),r}return _extends({},e)}function computeGoal(e){return e=getFluidValue(e),is.arr(e)?e.map(computeGoal):isAnimatedString(e)?globals.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function hasProps(e){for(const t in e)return!0;return!1}function isAsyncTo(e){return is.fun(e)||is.arr(e)&&is.obj(e[0])}function detachRefs(e,t){var r;null==(r=e.ref)||r.delete(e),null==t||t.delete(e)}function replaceRef(e,t){var r;t&&e.ref!==t&&(null==(r=e.ref)||r.delete(e),t.add(e),e.ref=t)}const config={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},c1=1.70158,c2=1.525*c1,c3=c1+1,c4=2*Math.PI/3,c5=2*Math.PI/4.5,bounceOut=e=>{const t=7.5625,r=2.75;return e<1/r?t*e*e:e<2/r?t*(e-=1.5/r)*e+.75:e<2.5/r?t*(e-=2.25/r)*e+.9375:t*(e-=2.625/r)*e+.984375},easings={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>c3*e*e*e-c1*e*e,easeOutBack:e=>1+c3*Math.pow(e-1,3)+c1*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(2*(c2+1)*e-c2)/2:(Math.pow(2*e-2,2)*((c2+1)*(2*e-2)+c2)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*c4),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*c4)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*c5)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*c5)/2+1,easeInBounce:e=>1-bounceOut(1-e),easeOutBounce:bounceOut,easeInOutBounce:e=>e<.5?(1-bounceOut(1-2*e))/2:(1+bounceOut(2*e-1))/2},defaults$8=_extends({},config.default,{mass:1,damping:1,easing:easings.linear,clamp:!1});class AnimationConfig{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,defaults$8)}}function mergeConfig$6(e,t,r){r&&(sanitizeConfig(r=_extends({},r),t),t=_extends({},r,t)),sanitizeConfig(e,t),Object.assign(e,t);for(const t in defaults$8)null==e[t]&&(e[t]=defaults$8[t]);let{mass:n,frequency:i,damping:o}=e;return is.und(i)||(i<.01&&(i=.01),o<0&&(o=0),e.tension=Math.pow(2*Math.PI/i,2)*n,e.friction=4*Math.PI*o*n/i),e}function sanitizeConfig(e,t){if(is.und(t.decay)){const r=!is.und(t.tension)||!is.und(t.friction);!r&&is.und(t.frequency)&&is.und(t.damping)&&is.und(t.mass)||(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}else e.duration=void 0}const emptyArray=[];class Animation{constructor(){this.changed=!1,this.values=emptyArray,this.toValues=null,this.fromValues=emptyArray,this.to=void 0,this.from=void 0,this.config=new AnimationConfig,this.immediate=!1}}function scheduleProps(e,{key:t,props:r,defaultProps:n,state:i,actions:o}){return new Promise(((a,s)=>{var c;let u,l,d=matchProp(null!=(c=r.cancel)?c:null==n?void 0:n.cancel,t);if(d)h();else{is.und(r.pause)||(i.paused=matchProp(r.pause,t));let e=null==n?void 0:n.pause;!0!==e&&(e=i.paused||matchProp(e,t)),u=callProp(r.delay||0,t),e?(i.resumeQueue.add(f),o.pause()):(o.resume(),f())}function p(){i.resumeQueue.add(f),i.timeouts.delete(l),l.cancel(),u=l.time-raf.now()}function f(){u>0&&!globals.skipAnimation?(i.delayed=!0,l=raf.setTimeout(h,u),i.pauseQueue.add(p),i.timeouts.add(l)):h()}function h(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(p),i.timeouts.delete(l),e<=(i.cancelId||0)&&(d=!0);try{o.start(_extends({},r,{callId:e,cancel:d}),a)}catch(e){s(e)}}}))}const getCombinedResult=(e,t)=>1==t.length?t[0]:t.some((e=>e.cancelled))?getCancelledResult(e.get()):t.every((e=>e.noop))?getNoopResult(e.get()):getFinishedResult(e.get(),t.every((e=>e.finished))),getNoopResult=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),getFinishedResult=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),getCancelledResult=e=>({value:e,cancelled:!0,finished:!1});function runAsync(e,t,r,n){const{callId:i,parentId:o,onRest:a}=t,{asyncTo:s,promise:c}=r;return o||e!==s||t.reset?r.promise=(async()=>{r.asyncId=i,r.asyncTo=e;const u=getDefaultProps(t,((e,t)=>"onRest"===t?void 0:e));let l,d;const p=new Promise(((e,t)=>(l=e,d=t))),f=e=>{const t=i<=(r.cancelId||0)&&getCancelledResult(n)||i!==r.asyncId&&getFinishedResult(n,!1);if(t)throw e.result=t,d(e),e},h=(e,t)=>{const o=new BailSignal,a=new SkipAniamtionSignal;return(async()=>{if(globals.skipAnimation)throw stopAsync(r),a.result=getFinishedResult(n,!1),d(a),a;f(o);const s=is.obj(e)?_extends({},e):_extends({},t,{to:e});s.parentId=i,eachProp(u,((e,t)=>{is.und(s[t])&&(s[t]=e)}));const c=await n.start(s);return f(o),r.paused&&await new Promise((e=>{r.resumeQueue.add(e)})),c})()};let m;if(globals.skipAnimation)return stopAsync(r),getFinishedResult(n,!1);try{let t;t=is.arr(e)?(async e=>{for(const t of e)await h(t)})(e):Promise.resolve(e(h,n.stop.bind(n))),await Promise.all([t.then(l),p]),m=getFinishedResult(n.get(),!0,!1)}catch(e){if(e instanceof BailSignal)m=e.result;else{if(!(e instanceof SkipAniamtionSignal))throw e;m=e.result}}finally{i==r.asyncId&&(r.asyncId=o,r.asyncTo=o?s:void 0,r.promise=o?c:void 0)}return is.fun(a)&&raf.batchedUpdates((()=>{a(m,n,n.item)})),m})():c}function stopAsync(e,t){flush(e.timeouts,(e=>e.cancel())),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class BailSignal extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class SkipAniamtionSignal extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const isFrameValue=e=>e instanceof FrameValue;let nextId$1=1;class FrameValue extends FluidValue{constructor(...e){super(...e),this.id=nextId$1++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=getAnimated(this);return e&&e.getValue()}to(...e){return globals.to(this,e)}interpolate(...e){return deprecateInterpolate(),globals.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){callFluidObservers(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||frameLoop.sort(this),callFluidObservers(this,{type:"priority",parent:this,priority:e})}}const $P=Symbol.for("SpringPhase"),HAS_ANIMATED=1,IS_ANIMATING=2,IS_PAUSED=4,hasAnimated=e=>(e[$P]&HAS_ANIMATED)>0,isAnimating=e=>(e[$P]&IS_ANIMATING)>0,isPaused=e=>(e[$P]&IS_PAUSED)>0,setActiveBit=(e,t)=>t?e[$P]|=IS_ANIMATING|HAS_ANIMATED:e[$P]&=~IS_ANIMATING,setPausedBit=(e,t)=>t?e[$P]|=IS_PAUSED:e[$P]&=~IS_PAUSED;class SpringValue extends FrameValue{constructor(e,t){if(super(),this.key=void 0,this.animation=new Animation,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!is.und(e)||!is.und(t)){const r=is.obj(e)?_extends({},e):_extends({},t,{from:e});is.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(isAnimating(this)||this._state.asyncTo)||isPaused(this)}get goal(){return getFluidValue(this.animation.to)}get velocity(){const e=getAnimated(this);return e instanceof AnimatedValue?e.lastVelocity||0:e.getPayload().map((e=>e.lastVelocity||0))}get hasAnimated(){return hasAnimated(this)}get isAnimating(){return isAnimating(this)}get isPaused(){return isPaused(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1;const n=this.animation;let{config:i,toValues:o}=n;const a=getPayload(n.to);!a&&hasFluidValue(n.to)&&(o=toArray$1(getFluidValue(n.to))),n.values.forEach(((s,c)=>{if(s.done)return;const u=s.constructor==AnimatedString?1:a?a[c].lastPosition:o[c];let l=n.immediate,d=u;if(!l){if(d=s.lastPosition,i.tension<=0)return void(s.done=!0);let t=s.elapsedTime+=e;const r=n.fromValues[c],o=null!=s.v0?s.v0:s.v0=is.arr(i.velocity)?i.velocity[c]:i.velocity;let a;if(is.und(i.duration))if(i.decay){const e=!0===i.decay?.998:i.decay,n=Math.exp(-(1-e)*t);d=r+o/(1-e)*(1-n),l=Math.abs(s.lastPosition-d)<.1,a=o*n}else{a=null==s.lastVelocity?o:s.lastVelocity;const t=i.precision||(r==u?.005:Math.min(1,.001*Math.abs(u-r))),n=i.restVelocity||t/10,c=i.clamp?0:i.bounce,p=!is.und(c),f=r==u?s.v0>0:r<u;let h,m=!1;const g=1,v=Math.ceil(e/g);for(let e=0;e<v&&(h=Math.abs(a)>n,h||(l=Math.abs(u-d)<=t,!l));++e){p&&(m=d==u||d>u==f,m&&(a=-a*c,d=u));a+=(1e-6*-i.tension*(d-u)+.001*-i.friction*a)/i.mass*g,d+=a*g}}else{let n=1;i.duration>0&&(this._memoizedDuration!==i.duration&&(this._memoizedDuration=i.duration,s.durationProgress>0&&(s.elapsedTime=i.duration*s.durationProgress,t=s.elapsedTime+=e)),n=(i.progress||0)+t/this._memoizedDuration,n=n>1?1:n<0?0:n,s.durationProgress=n),d=r+i.easing(n)*(u-r),a=(d-s.lastPosition)/e,l=1==n}s.lastVelocity=a,Number.isNaN(d)&&(console.warn("Got NaN while animating:",this),l=!0)}a&&!a[c].done&&(l=!1),l?s.done=!0:t=!1,s.setValue(d,i.round)&&(r=!0)}));const s=getAnimated(this),c=s.getValue();if(t){const e=getFluidValue(n.to);c===e&&!r||i.decay?r&&i.decay&&this._onChange(c):(s.setValue(e),this._onChange(e)),this._stop()}else r&&this._onChange(c)}set(e){return raf.batchedUpdates((()=>{this._stop(),this._focus(e),this._set(e)})),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(isAnimating(this)){const{to:e,config:t}=this.animation;raf.batchedUpdates((()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()}))}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return is.und(e)?(r=this.queue||[],this.queue=[]):r=[is.obj(e)?e:_extends({},t,{to:e})],Promise.all(r.map((e=>this._update(e)))).then((e=>getCombinedResult(this,e)))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),stopAsync(this._state,e&&this._lastCallId),raf.batchedUpdates((()=>this._stop(t,e))),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:r,from:n}=e;r=is.obj(r)?r[t]:r,(null==r||isAsyncTo(r))&&(r=void 0),n=is.obj(n)?n[t]:n,null==n&&(n=void 0);const i={to:r,from:n};return hasAnimated(this)||(e.reverse&&([r,n]=[n,r]),n=getFluidValue(n),is.und(n)?getAnimated(this)||this._set(r):this._set(n)),i}_update(e,t){let r=_extends({},e);const{key:n,defaultProps:i}=this;r.default&&Object.assign(i,getDefaultProps(r,((e,t)=>/^on/.test(t)?resolveProp(e,n):e))),mergeActiveFn(this,r,"onProps"),sendEvent(this,"onProps",r,this);const o=this._prepareNode(r);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const a=this._state;return scheduleProps(++this._lastCallId,{key:n,props:r,defaultProps:i,state:a,actions:{pause:()=>{isPaused(this)||(setPausedBit(this,!0),flushCalls(a.pauseQueue),sendEvent(this,"onPause",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},resume:()=>{isPaused(this)&&(setPausedBit(this,!1),isAnimating(this)&&this._resume(),flushCalls(a.resumeQueue),sendEvent(this,"onResume",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},start:this._merge.bind(this,o)}}).then((e=>{if(r.loop&&e.finished&&(!t||!e.noop)){const e=createLoopUpdate(r);if(e)return this._update(e,!0)}return e}))}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(getCancelledResult(this));const n=!is.und(e.to),i=!is.und(e.from);if(n||i){if(!(t.callId>this._lastToId))return r(getCancelledResult(this));this._lastToId=t.callId}const{key:o,defaultProps:a,animation:s}=this,{to:c,from:u}=s;let{to:l=c,from:d=u}=e;!i||n||t.default&&!is.und(l)||(l=d),t.reverse&&([l,d]=[d,l]);const p=!isEqual(d,u);p&&(s.from=d),d=getFluidValue(d);const f=!isEqual(l,c);f&&this._focus(l);const h=isAsyncTo(t.to),{config:m}=s,{decay:g,velocity:v}=m;(n||i)&&(m.velocity=0),t.config&&!h&&mergeConfig$6(m,callProp(t.config,o),t.config!==a.config?callProp(a.config,o):void 0);let y=getAnimated(this);if(!y||is.und(l))return r(getFinishedResult(this,!0));const b=is.und(t.reset)?i&&!t.default:!is.und(d)&&matchProp(t.reset,o),S=b?d:this.get(),_=computeGoal(l),M=is.num(_)||is.arr(_)||isAnimatedString(_),T=!h&&(!M||matchProp(a.immediate||t.immediate,o));if(f){const e=getAnimatedType(l);if(e!==y.constructor){if(!T)throw Error(`Cannot animate between ${y.constructor.name} and ${e.name}, as the "to" prop suggests`);y=this._set(_)}}const w=y.constructor;let x=hasFluidValue(l),I=!1;if(!x){const e=b||!hasAnimated(this)&&p;(f||e)&&(I=isEqual(computeGoal(S),_),x=!I),(isEqual(s.immediate,T)||T)&&isEqual(m.decay,g)&&isEqual(m.velocity,v)||(x=!0)}if(I&&isAnimating(this)&&(s.changed&&!b?x=!0:x||this._stop(c)),!h&&((x||hasFluidValue(c))&&(s.values=y.getPayload(),s.toValues=hasFluidValue(l)?null:w==AnimatedString?[1]:toArray$1(_)),s.immediate!=T&&(s.immediate=T,T||b||this._set(c)),x)){const{onRest:e}=s;each(ACTIVE_EVENTS,(e=>mergeActiveFn(this,t,e)));const n=getFinishedResult(this,checkFinished(this,c));flushCalls(this._pendingCalls,n),this._pendingCalls.add(r),s.changed&&raf.batchedUpdates((()=>{s.changed=!b,null==e||e(n,this),b?callProp(a.onRest,n):null==s.onStart||s.onStart(n,this)}))}b&&this._set(S),h?r(runAsync(t.to,t,this._state,this)):x?this._start():isAnimating(this)&&!f?this._pendingCalls.add(r):r(getNoopResult(S))}_focus(e){const t=this.animation;e!==t.to&&(getFluidObservers(this)&&this._detach(),t.to=e,getFluidObservers(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;hasFluidValue(t)&&(addFluidObserver(t,this),isFrameValue(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;hasFluidValue(e)&&removeFluidObserver(e,this)}_set(e,t=!0){const r=getFluidValue(e);if(!is.und(r)){const e=getAnimated(this);if(!e||!isEqual(r,e.getValue())){const n=getAnimatedType(r);e&&e.constructor==n?e.setValue(r):setAnimated(this,n.create(r)),e&&raf.batchedUpdates((()=>{this._onChange(r,t)}))}}return getAnimated(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,sendEvent(this,"onStart",getFinishedResult(this,checkFinished(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),callProp(this.animation.onChange,e,this)),callProp(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;getAnimated(this).reset(getFluidValue(e.to)),e.immediate||(e.fromValues=e.values.map((e=>e.lastPosition))),isAnimating(this)||(setActiveBit(this,!0),isPaused(this)||this._resume())}_resume(){globals.skipAnimation?this.finish():frameLoop.start(this)}_stop(e,t){if(isAnimating(this)){setActiveBit(this,!1);const r=this.animation;each(r.values,(e=>{e.done=!0})),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),callFluidObservers(this,{type:"idle",parent:this});const n=t?getCancelledResult(this.get()):getFinishedResult(this.get(),checkFinished(this,null!=e?e:r.to));flushCalls(this._pendingCalls,n),r.changed&&(r.changed=!1,sendEvent(this,"onRest",n,this))}}}function checkFinished(e,t){const r=computeGoal(t);return isEqual(computeGoal(e.get()),r)}function createLoopUpdate(e,t=e.loop,r=e.to){let n=callProp(t);if(n){const i=!0!==n&&inferTo(n),o=(i||e).reverse,a=!i||i.reset;return createUpdate(_extends({},e,{loop:t,default:!1,pause:void 0,to:!o||isAsyncTo(r)?r:void 0,from:a?e.from:void 0,reset:a},i))}}function createUpdate(e){const{to:t,from:r}=e=inferTo(e),n=new Set;return is.obj(t)&&findDefined(t,n),is.obj(r)&&findDefined(r,n),e.keys=n.size?Array.from(n):null,e}function declareUpdate(e){const t=createUpdate(e);return is.und(t.default)&&(t.default=getDefaultProps(t)),t}function findDefined(e,t){eachProp(e,((e,r)=>null!=e&&t.add(r)))}const ACTIVE_EVENTS=["onStart","onRest","onChange","onPause","onResume"];function mergeActiveFn(e,t,r){e.animation[r]=t[r]!==getDefaultProp(t,r)?resolveProp(t[r],e.key):void 0}function sendEvent(e,t,...r){var n,i,o,a;null==(n=(i=e.animation)[t])||n.call(i,...r),null==(o=(a=e.defaultProps)[t])||o.call(a,...r)}const BATCHED_EVENTS=["onStart","onChange","onRest"];let nextId=1;class Controller{constructor(e,t){this.id=nextId++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(_extends({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every((e=>e.idle&&!e.isDelayed&&!e.isPaused))}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each(((t,r)=>e[r]=t.get())),e}set(e){for(const t in e){const r=e[t];is.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(createUpdate(e)),this}start(e){let{queue:t}=this;return e?t=toArray$1(e).map(createUpdate):this.queue=[],this._flush?this._flush(this,t):(prepareKeys(this,t),flushUpdateQueue(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const r=this.springs;each(toArray$1(t),(t=>r[t].stop(!!e)))}else stopAsync(this._state,this._lastAsyncId),this.each((t=>t.stop(!!e)));return this}pause(e){if(is.und(e))this.start({pause:!0});else{const t=this.springs;each(toArray$1(e),(e=>t[e].pause()))}return this}resume(e){if(is.und(e))this.start({pause:!1});else{const t=this.springs;each(toArray$1(e),(e=>t[e].resume()))}return this}each(e){eachProp(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:r}=this._events,n=this._active.size>0,i=this._changed.size>0;(n&&!this._started||i&&!this._started)&&(this._started=!0,flush(e,(([e,t])=>{t.value=this.get(),e(t,this,this._item)})));const o=!n&&this._started,a=i||o&&r.size?this.get():null;i&&t.size&&flush(t,(([e,t])=>{t.value=a,e(t,this,this._item)})),o&&(this._started=!1,flush(r,(([e,t])=>{t.value=a,e(t,this,this._item)})))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}raf.onFrame(this._onFrame)}}function flushUpdateQueue(e,t){return Promise.all(t.map((t=>flushUpdate(e,t)))).then((t=>getCombinedResult(e,t)))}async function flushUpdate(e,t,r){const{keys:n,to:i,from:o,loop:a,onRest:s,onResolve:c}=t,u=is.obj(t.default)&&t.default;a&&(t.loop=!1),!1===i&&(t.to=null),!1===o&&(t.from=null);const l=is.arr(i)||is.fun(i)?i:void 0;l?(t.to=void 0,t.onRest=void 0,u&&(u.onRest=void 0)):each(BATCHED_EVENTS,(r=>{const n=t[r];if(is.fun(n)){const i=e._events[r];t[r]=({finished:e,cancelled:t})=>{const r=i.get(n);r?(e||(r.finished=!1),t&&(r.cancelled=!0)):i.set(n,{value:null,finished:e||!1,cancelled:t||!1})},u&&(u[r]=t[r])}}));const d=e._state;t.pause===!d.paused?(d.paused=t.pause,flushCalls(t.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(t.pause=!0);const p=(n||Object.keys(e.springs)).map((r=>e.springs[r].start(t))),f=!0===t.cancel||!0===getDefaultProp(t,"cancel");(l||f&&d.asyncId)&&p.push(scheduleProps(++e._lastAsyncId,{props:t,state:d,actions:{pause:noop,resume:noop,start(t,r){f?(stopAsync(d,e._lastAsyncId),r(getCancelledResult(e))):(t.onRest=s,r(runAsync(l,t,d,e)))}}})),d.paused&&await new Promise((e=>{d.resumeQueue.add(e)}));const h=getCombinedResult(e,await Promise.all(p));if(a&&h.finished&&(!r||!h.noop)){const r=createLoopUpdate(t,a,i);if(r)return prepareKeys(e,[r]),flushUpdate(e,r,!0)}return c&&raf.batchedUpdates((()=>c(h,e,e.item))),h}function getSprings(e,t){const r=_extends({},e.springs);return t&&each(toArray$1(t),(e=>{is.und(e.keys)&&(e=createUpdate(e)),is.obj(e.to)||(e=_extends({},e,{to:void 0})),prepareSprings(r,e,(e=>createSpring(e)))})),setSprings(e,r),r}function setSprings(e,t){eachProp(t,((t,r)=>{e.springs[r]||(e.springs[r]=t,addFluidObserver(t,e))}))}function createSpring(e,t){const r=new SpringValue;return r.key=e,t&&addFluidObserver(r,t),r}function prepareSprings(e,t,r){t.keys&&each(t.keys,(n=>{(e[n]||(e[n]=r(n)))._prepareNode(t)}))}function prepareKeys(e,t){each(t,(t=>{prepareSprings(e.springs,t,(t=>createSpring(t,e)))}))}function _objectWithoutPropertiesLoose$1(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}const _excluded$3=["children"],SpringContext=e=>{let{children:t}=e,r=_objectWithoutPropertiesLoose$1(e,_excluded$3);const n=react.exports.useContext(ctx),i=r.pause||!!n.pause,o=r.immediate||!!n.immediate;r=useMemoOne((()=>({pause:i,immediate:o})),[i,o]);const{Provider:a}=ctx;return react.exports.createElement(a,{value:r},t)},ctx=makeContext(SpringContext,{});function makeContext(e,t){return Object.assign(e,react.exports.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}SpringContext.Provider=ctx.Provider,SpringContext.Consumer=ctx.Consumer;const SpringRef=()=>{const e=[],t=function(t){deprecateDirectCall();const n=[];return each(e,((e,i)=>{if(is.und(t))n.push(e.start());else{const o=r(t,e,i);o&&n.push(e.start(o))}})),n};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const r=e.indexOf(t);~r&&e.splice(r,1)},t.pause=function(){return each(e,(e=>e.pause(...arguments))),this},t.resume=function(){return each(e,(e=>e.resume(...arguments))),this},t.set=function(t){each(e,(e=>e.set(t)))},t.start=function(t){const r=[];return each(e,((e,n)=>{if(is.und(t))r.push(e.start());else{const i=this._getProps(t,e,n);i&&r.push(e.start(i))}})),r},t.stop=function(){return each(e,(e=>e.stop(...arguments))),this},t.update=function(t){return each(e,((e,r)=>e.update(this._getProps(t,e,r)))),this};const r=function(e,t,r){return is.fun(e)?e(r,t):e};return t._getProps=r,t};function useSprings(e,t,r){const n=is.fun(t)&&t;n&&!r&&(r=[]);const i=react.exports.useMemo((()=>n||3==arguments.length?SpringRef():void 0),[]),o=react.exports.useRef(0),a=useForceUpdate(),s=react.exports.useMemo((()=>({ctrls:[],queue:[],flush(e,t){const r=getSprings(e,t);return o.current>0&&!s.queue.length&&!Object.keys(r).some((t=>!e.springs[t]))?flushUpdateQueue(e,t):new Promise((n=>{setSprings(e,r),s.queue.push((()=>{n(flushUpdateQueue(e,t))})),a()}))}})),[]),c=react.exports.useRef([...s.ctrls]),u=[],l=usePrev(e)||0;function d(e,r){for(let i=e;i<r;i++){const e=c.current[i]||(c.current[i]=new Controller(null,s.flush)),r=n?n(i,e):t[i];r&&(u[i]=declareUpdate(r))}}react.exports.useMemo((()=>{each(c.current.slice(e,l),(e=>{detachRefs(e,i),e.stop(!0)})),c.current.length=e,d(l,e)}),[e]),react.exports.useMemo((()=>{d(0,Math.min(l,e))}),r);const p=c.current.map(((e,t)=>getSprings(e,u[t]))),f=react.exports.useContext(SpringContext),h=usePrev(f),m=f!==h&&hasProps(f);useIsomorphicLayoutEffect((()=>{o.current++,s.ctrls=c.current;const{queue:e}=s;e.length&&(s.queue=[],each(e,(e=>e()))),each(c.current,((e,t)=>{null==i||i.add(e),m&&e.start({default:f});const r=u[t];r&&(replaceRef(e,r.ref),e.ref?e.queue.push(r):e.start(r))}))})),useOnce((()=>()=>{each(s.ctrls,(e=>e.stop(!0)))}));const g=p.map((e=>_extends({},e)));return i?[g,i]:g}function useSpring(e,t){const r=is.fun(e),[[n],i]=useSprings(1,r?e:[e],r?t||[]:t);return r||2==arguments.length?[n,i]:n}let TransitionPhase;!function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"}(TransitionPhase||(TransitionPhase={}));class Interpolation extends FrameValue{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=createInterpolator(...t);const r=this._get(),n=getAnimatedType(r);setAnimated(this,n.create(r))}advance(e){const t=this._get();isEqual(t,this.get())||(getAnimated(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&checkIdle(this._active)&&becomeIdle(this)}_get(){const e=is.arr(this.source)?this.source.map(getFluidValue):toArray$1(getFluidValue(this.source));return this.calc(...e)}_start(){this.idle&&!checkIdle(this._active)&&(this.idle=!1,each(getPayload(this),(e=>{e.done=!1})),globals.skipAnimation?(raf.batchedUpdates((()=>this.advance())),becomeIdle(this)):frameLoop.start(this))}_attach(){let e=1;each(toArray$1(this.source),(t=>{hasFluidValue(t)&&addFluidObserver(t,this),isFrameValue(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))})),this.priority=e,this._start()}_detach(){each(toArray$1(this.source),(e=>{hasFluidValue(e)&&removeFluidObserver(e,this)})),this._active.clear(),becomeIdle(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=toArray$1(this.source).reduce(((e,t)=>Math.max(e,(isFrameValue(t)?t.priority:0)+1)),0))}}function isIdle(e){return!1!==e.idle}function checkIdle(e){return!e.size||Array.from(e).every(isIdle)}function becomeIdle(e){e.idle||(e.idle=!0,each(getPayload(e),(e=>{e.done=!0})),callFluidObservers(e,{type:"idle",parent:e}))}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}globals.assign({createStringInterpolator:createStringInterpolator,to:(e,t)=>new Interpolation(e,t)});const _excluded$2=["style","children","scrollTop","scrollLeft"],isCustomPropRE=/^--/;function dangerousStyleValue(e,t){return null==t||"boolean"==typeof t||""===t?"":"number"!=typeof t||0===t||isCustomPropRE.test(e)||isUnitlessNumber.hasOwnProperty(e)&&isUnitlessNumber[e]?(""+t).trim():t+"px"}const attributeCache={};function applyAnimatedValues(e,t){if(!e.nodeType||!e.setAttribute)return!1;const r="filter"===e.nodeName||e.parentNode&&"filter"===e.parentNode.nodeName,n=t,{style:i,children:o,scrollTop:a,scrollLeft:s}=n,c=_objectWithoutPropertiesLoose(n,_excluded$2),u=Object.values(c),l=Object.keys(c).map((t=>r||e.hasAttribute(t)?t:attributeCache[t]||(attributeCache[t]=t.replace(/([A-Z])/g,(e=>"-"+e.toLowerCase())))));void 0!==o&&(e.textContent=o);for(let t in i)if(i.hasOwnProperty(t)){const r=dangerousStyleValue(t,i[t]);isCustomPropRE.test(t)?e.style.setProperty(t,r):e.style[t]=r}l.forEach(((t,r)=>{e.setAttribute(t,u[r])})),void 0!==a&&(e.scrollTop=a),void 0!==s&&(e.scrollLeft=s)}let isUnitlessNumber={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const prefixKey=(e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1),prefixes=["Webkit","Ms","Moz","O"];isUnitlessNumber=Object.keys(isUnitlessNumber).reduce(((e,t)=>(prefixes.forEach((r=>e[prefixKey(r,t)]=e[t])),e)),isUnitlessNumber);const _excluded$1=["x","y","z"],domTransforms=/^(matrix|translate|scale|rotate|skew)/,pxTransforms=/^(translate)/,degTransforms=/^(rotate|skew)/,addUnit=(e,t)=>is.num(e)&&0!==e?e+t:e,isValueIdentity=(e,t)=>is.arr(e)?e.every((e=>isValueIdentity(e,t))):is.num(e)?e===t:parseFloat(e)===t;class AnimatedStyle extends AnimatedObject{constructor(e){let{x:t,y:r,z:n}=e,i=_objectWithoutPropertiesLoose(e,_excluded$1);const o=[],a=[];(t||r||n)&&(o.push([t||0,r||0,n||0]),a.push((e=>[`translate3d(${e.map((e=>addUnit(e,"px"))).join(",")})`,isValueIdentity(e,0)]))),eachProp(i,((e,t)=>{if("transform"===t)o.push([e||""]),a.push((e=>[e,""===e]));else if(domTransforms.test(t)){if(delete i[t],is.und(e))return;const r=pxTransforms.test(t)?"px":degTransforms.test(t)?"deg":"";o.push(toArray$1(e)),a.push("rotate3d"===t?([e,t,n,i])=>[`rotate3d(${e},${t},${n},${addUnit(i,r)})`,isValueIdentity(i,0)]:e=>[`${t}(${e.map((e=>addUnit(e,r))).join(",")})`,isValueIdentity(e,t.startsWith("scale")?1:0)])}})),o.length&&(i.transform=new FluidTransform(o,a)),super(i)}}class FluidTransform extends FluidValue{constructor(e,t){super(),this._value=null,this.inputs=e,this.transforms=t}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return each(this.inputs,((r,n)=>{const i=getFluidValue(r[0]),[o,a]=this.transforms[n](is.arr(i)?i:r.map(getFluidValue));e+=" "+o,t=t&&a})),t?"none":e}observerAdded(e){1==e&&each(this.inputs,(e=>each(e,(e=>hasFluidValue(e)&&addFluidObserver(e,this)))))}observerRemoved(e){0==e&&each(this.inputs,(e=>each(e,(e=>hasFluidValue(e)&&removeFluidObserver(e,this)))))}eventObserved(e){"change"==e.type&&(this._value=null),callFluidObservers(this,e)}}const primitives=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],_excluded=["scrollTop","scrollLeft"];globals.assign({batchedUpdates:reactDom.exports.unstable_batchedUpdates,createStringInterpolator:createStringInterpolator,colors:colors});const host=createHost(primitives,{applyAnimatedValues:applyAnimatedValues,createAnimatedStyle:e=>new AnimatedStyle(e),getComponentProps:e=>_objectWithoutPropertiesLoose(e,_excluded)}),animated=host.animated;function resolveContainer(e){return("function"==typeof e?e():e)||document.body}function renderToContainer(e,t){if(canUseDom&&e){const r=resolveContainer(e);return reactDom.exports.createPortal(t,r)}return t}function useInitialized(e){const t=react.exports.useRef(e);return e&&(t.current=!0),!!t.current}const ShouldRender=e=>useShouldRender(e.active,e.forceRender,e.destroyOnClose)?e.children:null;function useShouldRender(e,t,r){const n=useInitialized(e);return!!t||(!!e||!!n&&!r)}const eventToPropRecord={click:"onClick"};function withStopPropagation(e,t){const r=Object.assign({},t.props);for(const n of e){const e=eventToPropRecord[n];r[e]=function(r){var n,i;r.stopPropagation(),null===(i=(n=t.props)[e])||void 0===i||i.call(n,r)}}return React.cloneElement(t,r)}const classPrefix$3="adm-mask",opacityRecord={default:.55,thin:.35,thick:.75},defaultProps$2={visible:!0,destroyOnClose:!1,forceRender:!1,color:"black",opacity:"default",disableBodyScroll:!0,getContainer:null,stopPropagation:["click"]},Mask$1=e=>{const t=mergeProps(defaultProps$2,e),{locale:r}=useConfig(),n=react.exports.useRef(null);useLockScroll(n,t.visible&&t.disableBodyScroll);const i=react.exports.useMemo((()=>{var e;const r=null!==(e=opacityRecord[t.opacity])&&void 0!==e?e:t.opacity;return`rgba(${"white"===t.color?"255, 255, 255":"0, 0, 0"}, ${r})`}),[t.color,t.opacity]),[o,a]=react.exports.useState(t.visible),s=useUnmountedRef$1(),{opacity:c}=useSpring({opacity:t.visible?1:0,config:{precision:.01,mass:1,tension:250,friction:30,clamp:!0},onStart:()=>{a(!0)},onRest:()=>{var e,r;s.current||(a(t.visible),t.visible?null===(e=t.afterShow)||void 0===e||e.call(t):null===(r=t.afterClose)||void 0===r||r.call(t))}}),u=withStopPropagation(t.stopPropagation,withNativeProps(t,React.createElement(animated.div,{className:classPrefix$3,ref:n,style:Object.assign(Object.assign({},t.style),{background:i,opacity:c,display:o?void 0:"none"}),onClick:e=>{var r;e.target===e.currentTarget&&(null===(r=t.onMaskClick)||void 0===r||r.call(t,e))}},t.onMaskClick&&React.createElement("div",{className:`${classPrefix$3}-aria-button`,role:"button","aria-label":r.Mask.name,onClick:t.onMaskClick}),React.createElement("div",{className:`${classPrefix$3}-content`},t.children))));return React.createElement(ShouldRender,{active:o,forceRender:t.forceRender,destroyOnClose:t.destroyOnClose},renderToContainer(t.getContainer,u))};var Mask=Mask$1;function CloseOutline(e){return react.exports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),react.exports.createElement("g",{id:"CloseOutline-CloseOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},react.exports.createElement("g",{id:"CloseOutline-编组"},react.exports.createElement("rect",{id:"CloseOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),react.exports.createElement("path",{d:"M10.6085104,8.11754663 L24.1768397,21.8195031 L24.1768397,21.8195031 L37.7443031,8.1175556 C37.8194278,8.04168616 37.9217669,7.999 38.0285372,7.999 L41.1040268,7.999 C41.3249407,7.999 41.5040268,8.1780861 41.5040268,8.399 C41.5040268,8.50440471 41.4624226,8.60554929 41.3882578,8.68044752 L26.2773302,23.9408235 L26.2773302,23.9408235 L41.5021975,39.3175645 C41.65763,39.4745475 41.6563731,39.7278104 41.4993901,39.8832429 C41.4244929,39.9574004 41.3233534,39.999 41.2179546,39.999 L38.1434012,39.999 C38.0366291,39.999 37.9342885,39.9563124 37.8591634,39.8804408 L24.1768397,26.0621438 L24.1768397,26.0621438 L10.4936501,39.8804497 C10.4185257,39.9563159 10.3161889,39.999 10.2094212,39.999 L7.13584526,39.999 C6.91493136,39.999 6.73584526,39.8199139 6.73584526,39.599 C6.73584526,39.4936017 6.77744443,39.3924627 6.85160121,39.3175656 L22.0763492,23.9408235 L22.0763492,23.9408235 L6.96554081,8.68044639 C6.81010226,8.52346929 6.81134951,8.27020637 6.9683266,8.11476782 C7.04322474,8.04060377 7.14436883,7.999 7.24977299,7.999 L10.3242852,7.999 C10.4310511,7.999 10.5333863,8.04168267 10.6085104,8.11754663 Z",id:"CloseOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}const defaultPopupBaseProps={closeOnMaskClick:!1,destroyOnClose:!1,disableBodyScroll:!0,forceRender:!1,getContainer:()=>document.body,mask:!0,showCloseButton:!1,stopPropagation:["click"],visible:!1};function useInnerVisible(e){const[t,r]=react.exports.useState(e);return useIsomorphicLayoutEffect$2((()=>{r(e)}),[e]),t}const classPrefix$2="adm-popup",defaultProps$1=Object.assign(Object.assign({},defaultPopupBaseProps),{position:"bottom"}),Popup$1=e=>{const t=mergeProps(defaultProps$1,e),r=classNames(`${classPrefix$2}-body`,t.bodyClassName,`${classPrefix$2}-body-position-${t.position}`),[n,i]=react.exports.useState(t.visible);useIsomorphicLayoutEffect$2((()=>{t.visible&&i(!0)}),[t.visible]);const o=react.exports.useRef(null);useLockScroll(o,t.disableBodyScroll&&n);const a=useUnmountedRef$1(),{percent:s}=useSpring({percent:t.visible?0:100,config:{precision:.1,mass:.4,tension:300,friction:30},onRest:()=>{var e,r;a.current||(i(t.visible),t.visible?null===(e=t.afterShow)||void 0===e||e.call(t):null===(r=t.afterClose)||void 0===r||r.call(t))}}),c=useInnerVisible(n&&t.visible),u=withStopPropagation(t.stopPropagation,withNativeProps(t,React.createElement("div",{className:classPrefix$2,onClick:t.onClick,style:{display:n?void 0:"none"}},t.mask&&React.createElement(Mask,{visible:c,forceRender:t.forceRender,destroyOnClose:t.destroyOnClose,onMaskClick:e=>{var r,n;null===(r=t.onMaskClick)||void 0===r||r.call(t,e),t.closeOnMaskClick&&(null===(n=t.onClose)||void 0===n||n.call(t))},className:t.maskClassName,style:t.maskStyle,disableBodyScroll:!1,stopPropagation:t.stopPropagation}),React.createElement(animated.div,{className:r,style:Object.assign(Object.assign({},t.bodyStyle),{transform:s.to((e=>"bottom"===t.position?`translate(0, ${e}%)`:"top"===t.position?`translate(0, -${e}%)`:"left"===t.position?`translate(-${e}%, 0)`:"right"===t.position?`translate(${e}%, 0)`:"none"))}),ref:o},t.showCloseButton&&React.createElement("a",{className:classNames(`${classPrefix$2}-close-icon`,"adm-plain-anchor"),onClick:()=>{var e;null===(e=t.onClose)||void 0===e||e.call(t)}},React.createElement(CloseOutline,null)),t.children))));return React.createElement(ShouldRender,{active:n,forceRender:t.forceRender,destroyOnClose:t.destroyOnClose},renderToContainer(t.getContainer,u))};var Popup=Popup$1,css_248z$a=".adm-safe-area{--multiple:var(--adm-safe-area-multiple,1);display:block;width:100%}.adm-safe-area-position-top{padding-top:calc(env(safe-area-inset-top)*var(--multiple))}.adm-safe-area-position-bottom{padding-bottom:calc(env(safe-area-inset-bottom)*var(--multiple))}";styleInject(css_248z$a);const classPrefix$1="adm-safe-area",SafeArea$1=e=>withNativeProps(e,React.createElement("div",{className:classNames(classPrefix$1,`${classPrefix$1}-position-${e.position}`)}));var SafeArea=SafeArea$1;const fullClone=Object.assign({},ReactDOM$1),{version:version$1,render:reactRender,unmountComponentAtNode:unmountComponentAtNode}=fullClone;let createRoot;try{const e=Number((version$1||"").split(".")[0]);e>=18&&fullClone.createRoot&&(createRoot=fullClone.createRoot)}catch(e){}function toggleWarning(e){const{__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:t}=fullClone;t&&"object"==typeof t&&(t.usingClientEntryPoint=e)}const MARK="__antd_mobile_root__";function legacyRender(e,t){reactRender(e,t)}function concurrentRender(e,t){toggleWarning(!0);const r=t[MARK]||createRoot(t);toggleWarning(!1),r.render(e),t[MARK]=r}function render$1(e,t){createRoot?concurrentRender(e,t):legacyRender(e,t)}function legacyUnmount(e){return unmountComponentAtNode(e)}function concurrentUnmount(e){return __awaiter$1(this,void 0,void 0,(function*(){return Promise.resolve().then((()=>{var t;null===(t=e[MARK])||void 0===t||t.unmount(),delete e[MARK]}))}))}function unmount(e){return createRoot?concurrentUnmount(e):legacyUnmount(e)}function renderToBody(e){const t=document.createElement("div");return document.body.appendChild(t),render$1(e,t),function(){unmount(t)&&t.parentNode&&t.parentNode.removeChild(t)}}function renderImperatively(e){const t=React.forwardRef(((t,r)=>{const[i,o]=react.exports.useState(!1),a=react.exports.useRef(!1),[s,c]=react.exports.useState(e),u=react.exports.useRef(0);function l(){var e,t;a.current=!0,o(!1),null===(t=(e=s.props).onClose)||void 0===t||t.call(e)}function d(){var e,t;n(),null===(t=(e=s.props).afterClose)||void 0===t||t.call(e)}return react.exports.useEffect((()=>{a.current?d():o(!0)}),[]),react.exports.useImperativeHandle(r,(()=>({close:l,replace:e=>{var t,r;u.current++,null===(r=(t=s.props).afterClose)||void 0===r||r.call(t),c(e)}}))),React.cloneElement(s,Object.assign(Object.assign({},s.props),{key:u.current,visible:i,onClose:l,afterClose:d}))})),r=React.createRef(),n=renderToBody(React.createElement(t,{ref:r}));return{close:()=>{var e;null===(e=r.current)||void 0===e||e.close()},replace:e=>{var t;null===(t=r.current)||void 0===t||t.replace(e)}}}const classPrefix="adm-action-sheet",defaultProps={visible:!1,actions:[],cancelText:"",closeOnAction:!1,closeOnMaskClick:!0,safeArea:!0,destroyOnClose:!1,forceRender:!1},ActionSheet$1=e=>{const t=mergeProps(defaultProps,e);return React.createElement(Popup,{visible:t.visible,onMaskClick:()=>{var e,r;null===(e=t.onMaskClick)||void 0===e||e.call(t),t.closeOnMaskClick&&(null===(r=t.onClose)||void 0===r||r.call(t))},afterClose:t.afterClose,className:classNames(`${classPrefix}-popup`,t.popupClassName),style:t.popupStyle,getContainer:t.getContainer,destroyOnClose:t.destroyOnClose,forceRender:t.forceRender},withNativeProps(t,React.createElement("div",{className:classPrefix},t.extra&&React.createElement("div",{className:`${classPrefix}-extra`},t.extra),React.createElement("div",{className:`${classPrefix}-button-list`},t.actions.map(((e,r)=>React.createElement("div",{key:e.key,className:`${classPrefix}-button-item-wrapper`},React.createElement("a",{className:classNames("adm-plain-anchor",`${classPrefix}-button-item`,{[`${classPrefix}-button-item-danger`]:e.danger,[`${classPrefix}-button-item-disabled`]:e.disabled}),onClick:()=>{var n,i,o;null===(n=e.onClick)||void 0===n||n.call(e),null===(i=t.onAction)||void 0===i||i.call(t,e,r),t.closeOnAction&&(null===(o=t.onClose)||void 0===o||o.call(t))}},React.createElement("div",{className:`${classPrefix}-button-item-name`},e.text),e.description&&React.createElement("div",{className:`${classPrefix}-button-item-description`},e.description)))))),t.cancelText&&React.createElement("div",{className:`${classPrefix}-cancel`},React.createElement("div",{className:`${classPrefix}-button-item-wrapper`},React.createElement("a",{className:classNames("adm-plain-anchor",`${classPrefix}-button-item`),onClick:()=>{var e;null===(e=t.onClose)||void 0===e||e.call(t)}},React.createElement("div",{className:`${classPrefix}-button-item-name`},t.cancelText)))),t.safeArea&&React.createElement(SafeArea,{position:"bottom"}))))};function showActionSheet(e){return renderImperatively(React.createElement(ActionSheet$1,Object.assign({},e)))}var ActionSheet=attachPropertiesToComponent(ActionSheet$1,{show:showActionSheet}),css_248z$9="#dark-toast{background:#333;background:rgba(29,29,29,.73);border-radius:5px;color:#fff;left:50%;max-width:50%;min-width:100px;padding:5px 10px;pointer-events:none;position:fixed;text-align:center;top:40%;transform:translateX(-50%);z-index:10000}#dark-toast i .rotate-loop{-webkit-animation:rotate-loop 1s infinite;animation:rotate-loop 1s infinite}@-webkit-keyframes rotate-loop{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes rotate-loop{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}";styleInject(css_248z$9);let timer=null;class Toast extends React.Component{static info(e,t=2e3){init(),setTime(t),ReactDOM.render(jsxRuntime.exports.jsx(react.exports.Fragment,{children:jsxRuntime.exports.jsx("span",{children:e})}),document.getElementById("dark-toast"))}static success(e,t=2e3){init(),setTime(t),ReactDOM.render(jsxRuntime.exports.jsxs(react.exports.Fragment,{children:[jsxRuntime.exports.jsx("i",{className:"iconfont icon-check-circle-fill"}),jsxRuntime.exports.jsx("span",{children:e})]}),document.getElementById("dark-toast"))}static fail(e,t=2e3){init(),setTime(t),ReactDOM.render(jsxRuntime.exports.jsxs(react.exports.Fragment,{children:[jsxRuntime.exports.jsx("i",{className:"iconfont icon-close-circle-fill"}),jsxRuntime.exports.jsx("span",{children:e})]}),document.getElementById("dark-toast"))}static warning(e,t=2e3){init(),setTime(t),ReactDOM.render(jsxRuntime.exports.jsxs(react.exports.Fragment,{children:[jsxRuntime.exports.jsx("i",{className:"iconfont icon-warning-circle-fill"}),jsxRuntime.exports.jsx("span",{children:e})]}),document.getElementById("dark-toast"))}static loading(e,t){init(),setLoading(t),ReactDOM.render(jsxRuntime.exports.jsxs(react.exports.Fragment,{children:[jsxRuntime.exports.jsx("i",{className:"iconfont icon-reload rotate-loop"}),jsxRuntime.exports.jsx("span",{children:e})]}),document.getElementById("dark-toast"))}}function setLoading(e){const t=document.getElementById("dark-toast");t.style.display=e?"block":"none"}function init(){clearTimeout(timer);const e=document.getElementById("dark-toast");if(e)e.style.display="block";else{const e=document.createElement("div");e.setAttribute("id","dark-toast"),document.body.appendChild(e)}}function setTime(e){timer=setTimeout((()=>{const e=document.getElementById("dark-toast");e&&(e.style.display="none")}),e)}var md5={};Object.defineProperty(md5,"__esModule",{value:!0});var Md5=function(){function e(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendStr(e).end(t)},e.hashAsciiStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendAsciiStr(e).end(t)},e._hex=function(t){var r,n,i,o,a=e.hexChars,s=e.hexOut;for(o=0;o<4;o+=1)for(n=8*o,r=t[o],i=0;i<8;i+=2)s[n+1+i]=a.charAt(15&r),r>>>=4,s[n+0+i]=a.charAt(15&r),r>>>=4;return s.join("")},e._md5cycle=function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0},e.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this},e.prototype.appendStr=function(t){var r,n,i=this._buffer8,o=this._buffer32,a=this._bufferLength;for(n=0;n<t.length;n+=1){if((r=t.charCodeAt(n))<128)i[a++]=r;else if(r<2048)i[a++]=192+(r>>>6),i[a++]=63&r|128;else if(r<55296||r>56319)i[a++]=224+(r>>>12),i[a++]=r>>>6&63|128,i[a++]=63&r|128;else{if((r=1024*(r-55296)+(t.charCodeAt(++n)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");i[a++]=240+(r>>>18),i[a++]=r>>>12&63|128,i[a++]=r>>>6&63|128,i[a++]=63&r|128}a>=64&&(this._dataLength+=64,e._md5cycle(this._state,o),a-=64,o[0]=o[16])}return this._bufferLength=a,this},e.prototype.appendAsciiStr=function(t){for(var r,n=this._buffer8,i=this._buffer32,o=this._bufferLength,a=0;;){for(r=Math.min(t.length-a,64-o);r--;)n[o++]=t.charCodeAt(a++);if(o<64)break;this._dataLength+=64,e._md5cycle(this._state,i),o=0}return this._bufferLength=o,this},e.prototype.appendByteArray=function(t){for(var r,n=this._buffer8,i=this._buffer32,o=this._bufferLength,a=0;;){for(r=Math.min(t.length-a,64-o);r--;)n[o++]=t[a++];if(o<64)break;this._dataLength+=64,e._md5cycle(this._state,i),o=0}return this._bufferLength=o,this},e.prototype.getState=function(){var e=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}},e.prototype.setState=function(e){var t,r=e.buffer,n=e.state,i=this._state;for(this._dataLength=e.length,this._bufferLength=e.buflen,i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],t=0;t<r.length;t+=1)this._buffer8[t]=r.charCodeAt(t)},e.prototype.end=function(t){void 0===t&&(t=!1);var r=this._bufferLength,n=this._buffer8,i=this._buffer32,o=1+(r>>2);this._dataLength+=r;var a=8*this._dataLength;if(n[r]=128,n[r+1]=n[r+2]=n[r+3]=0,i.set(e.buffer32Identity.subarray(o),o),r>55&&(e._md5cycle(this._state,i),i.set(e.buffer32Identity)),a<=4294967295)i[14]=a;else{var s=a.toString(16).match(/(.*?)(.{0,8})$/);if(null===s)return;var c=parseInt(s[2],16),u=parseInt(s[1],16)||0;i[14]=c,i[15]=u}return e._md5cycle(this._state,i),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}(),Md5_1=md5.Md5=Md5;if("5d41402abc4b2a76b9719d911017c592"!==Md5.hashStr("hello"))throw new Error("Md5 self test failed.");let localStorage$1=window.localStorage;localStorage$1&&"function"==typeof localStorage$1.getItem&&"function"==typeof localStorage$1.setItem&&"function"==typeof localStorage$1.removeItem||(localStorage$1={privateObj:{},setItem:function(e,t){localStorage$1.privateObj[e]=t},getItem:function(e){return localStorage$1.privateObj[e]},removeItem:function(e){delete localStorage$1.privateObj[e]}});var dist={exports:{}};!function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=106)}([function(e,t,r){var n=r(3),i=r(27).f,o=r(74),a=r(9),s=r(12),c=r(14),u=r(13),l=function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,d,p,f,h,m,g,v,y=e.target,b=e.global,S=e.stat,_=e.proto,M=b?n:S?n[y]:(n[y]||{}).prototype,T=b?a:a[y]||(a[y]={}),w=T.prototype;for(p in t)r=!o(b?p:y+(S?".":"#")+p,e.forced)&&M&&u(M,p),h=T[p],r&&(m=e.noTargetGet?(v=i(M,p))&&v.value:M[p]),f=r&&m?m:t[p],r&&typeof h==typeof f||(g=e.bind&&r?s(f,n):e.wrap&&r?l(f):_&&"function"==typeof f?s(Function.call,f):f,(e.sham||f&&f.sham||h&&h.sham)&&c(g,"sham",!0),T[p]=g,_&&(u(a,d=y+"Prototype")||c(a,d,{}),a[d][p]=f,e.real&&w&&!w[p]&&c(w,p,f)))}},function(e,t,r){var n=r(10);e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){e.exports=!0},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,r(110))},function(e,t,r){var n=r(1),i=r(116),o=r(29),a=r(12),s=r(82),c=r(117),u=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,r){var l,d,p,f,h,m,g,v=r&&r.that,y=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_ITERATOR),S=!(!r||!r.INTERRUPTED),_=a(t,v,1+y+S),M=function(e){return l&&c(l),new u(!0,e)},T=function(e){return y?(n(e),S?_(e[0],e[1],M):_(e[0],e[1])):S?_(e,M):_(e)};if(b)l=e;else{if("function"!=typeof(d=s(e)))throw TypeError("Target is not iterable");if(i(d)){for(p=0,f=o(e.length);f>p;p++)if((h=T(e[p]))&&h instanceof u)return h;return new u(!1)}l=d.call(e)}for(m=l.next;!(g=m.call(l)).done;){try{h=T(g.value)}catch(e){throw c(l),e}if("object"==typeof h&&h&&h instanceof u)return h}return new u(!1)}},function(e,t,r){var n=r(9),i=r(13),o=r(68),a=r(15).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||a(t,e,{value:o.f(e)})}},function(e,t,r){var n=r(3),i=r(53),o=r(13),a=r(40),s=r(58),c=r(81),u=i("wks"),l=n.Symbol,d=c?l:l&&l.withoutSetter||a;e.exports=function(e){return o(u,e)&&(s||"string"==typeof u[e])||(s&&o(l,e)?u[e]=l[e]:u[e]=d("Symbol."+e)),u[e]}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t){e.exports={}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(7);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var n=r(8);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(19),i={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return i.call(n(e),t)}},function(e,t,r){var n=r(11),i=r(15),o=r(22);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(11),i=r(73),o=r(1),a=r(37),s=Object.defineProperty;t.f=n?s:function(e,t,r){if(o(e),t=a(t,!0),o(r),i)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(9),i=r(3),o=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e])||o(i[e]):n[e]&&n[e][t]||i[e]&&i[e][t]}},function(e,t,r){var n=r(2),i=r(224);e.exports=n?i:function(e){return Map.prototype.entries.call(e)}},function(e,t,r){var n=r(72),i=r(36);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(36);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n,i,o,a=r(89),s=r(3),c=r(10),u=r(14),l=r(13),d=r(54),p=r(39),f=r(30),h=s.WeakMap;if(a||d.state){var m=d.state||(d.state=new h),g=m.get,v=m.has,y=m.set;n=function(e,t){if(v.call(m,e))throw new TypeError("Object already initialized");return t.facade=e,y.call(m,e,t),t},i=function(e){return g.call(m,e)||{}},o=function(e){return v.call(m,e)}}else{var b=p("state");f[b]=!0,n=function(e,t){if(l(e,b))throw new TypeError("Object already initialized");return t.facade=e,u(e,b,t),t},i=function(e){return l(e,b)?e[b]:{}},o=function(e){return l(e,b)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(9);e.exports=function(e){return n[e+"Prototype"]}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports={}},function(e,t,r){var n=r(59),i=r(15).f,o=r(14),a=r(13),s=r(119),c=r(6)("toStringTag");e.exports=function(e,t,r,u){if(e){var l=r?e:e.prototype;a(l,c)||i(l,c,{configurable:!0,value:t}),u&&!n&&o(l,"toString",s)}}},function(e,t,r){var n=r(12),i=r(72),o=r(19),a=r(29),s=r(63),c=[].push,u=function(e){var t=1==e,r=2==e,u=3==e,l=4==e,d=6==e,p=7==e,f=5==e||d;return function(h,m,g,v){for(var y,b,S=o(h),_=i(S),M=n(m,g,3),T=a(_.length),w=0,x=v||s,I=t?x(h,T):r||p?x(h,0):void 0;T>w;w++)if((f||w in _)&&(b=M(y=_[w],w,S),e))if(t)I[w]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return w;case 2:c.call(I,y)}else switch(e){case 4:return!1;case 7:c.call(I,y)}return d?-1:u||l?l:I}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterOut:u(7)}},function(e,t,r){e.exports=r(107)},function(e,t,r){var n=r(11),i=r(71),o=r(22),a=r(18),s=r(37),c=r(13),u=r(73),l=Object.getOwnPropertyDescriptor;t.f=n?l:function(e,t){if(e=a(e),t=s(t,!0),u)try{return l(e,t)}catch(e){}if(c(e,t))return o(!i.f.call(e,t),e[t])}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(42),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t){e.exports={}},function(e,t,r){var n=r(14);e.exports=function(e,t,r,i){i&&i.enumerable?e[t]=r:n(e,t,r)}},function(e,t,r){var n=r(1),i=r(8),o=r(6)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||null==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n=r(8),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},function(e,t,r){r(128);var n=r(129),i=r(3),o=r(45),a=r(14),s=r(23),c=r(6)("toStringTag");for(var u in n){var l=i[u],d=l&&l.prototype;d&&o(d)!==c&&a(d,c,u),s[u]=s.Array}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,r){var n=r(10);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){e.exports=r(111)},function(e,t,r){var n=r(53),i=r(40),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+n).toString(36)}},function(e,t,r){var n,i=r(1),o=r(76),a=r(57),s=r(30),c=r(80),u=r(51),l=r(39)("IE_PROTO"),d=function(){},p=function(e){return"<script>"+e+"<\/script>"},f=function(){try{n=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;f=n?function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t}(n):((t=u("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F);for(var r=a.length;r--;)delete f.prototype[a[r]];return f()};s[l]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(d.prototype=i(e),r=new d,d.prototype=null,r[l]=e):r=f(),void 0===t?r:o(r,t)}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n,i,o=r(3),a=r(44),s=o.process,c=s&&s.versions,u=c&&c.v8;u?i=(n=u.split("."))[0]<4?1:n[0]+n[1]:a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(i=n[1]),e.exports=i&&+i},function(e,t,r){var n=r(16);e.exports=n("navigator","userAgent")||""},function(e,t,r){var n=r(59),i=r(28),o=r(6)("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=n?i:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?r:a?i(t):"Object"==(n=i(t))&&"function"==typeof t.callee?"Arguments":n}},function(e,t){},function(e,t,r){var n=r(31);e.exports=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:n(e,i,t[i],r);return e}},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,r){var n=r(30),i=r(10),o=r(13),a=r(15).f,s=r(40),c=r(217),u=s("meta"),l=0,d=Object.isExtensible||function(){return!0},p=function(e){a(e,u,{value:{objectID:"O"+ ++l,weakData:{}}})},f=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,u)){if(!d(e))return"F";if(!t)return"E";p(e)}return e[u].objectID},getWeakData:function(e,t){if(!o(e,u)){if(!d(e))return!0;if(!t)return!1;p(e)}return e[u].weakData},onFreeze:function(e){return c&&f.REQUIRED&&d(e)&&!o(e,u)&&p(e),e}};n[u]=!0},function(e,t,r){var n=r(3),i=r(10),o=n.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,r){var n=r(13),i=r(19),o=r(39),a=r(114),s=o("IE_PROTO"),c=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=i(e),n(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},function(e,t,r){var n=r(2),i=r(54);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.13.1",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(3),i=r(113),o=n["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,r){var n=r(1),i=r(115);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,o){return n(r),i(o),t?e.call(r,o):r.__proto__=o,r}}():void 0)},function(e,t,r){var n=r(77),i=r(57);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){var n=r(43),i=r(7);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(e,t,r){var n={};n[r(6)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){var n=r(28),i=r(3);e.exports="process"==n(i.process)},function(e,t,r){var n=r(126).charAt,i=r(20),o=r(62),a=i.set,s=i.getterFor("String Iterator");o(String,"String",(function(e){a(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=s(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(0),i=r(127),o=r(52),a=r(55),s=r(24),c=r(14),u=r(31),l=r(6),d=r(2),p=r(23),f=r(92),h=f.IteratorPrototype,m=f.BUGGY_SAFARI_ITERATORS,g=l("iterator"),v=function(){return this};e.exports=function(e,t,r,l,f,y,b){i(r,t,l);var S,_,M,T=function(e){if(e===f&&A)return A;if(!m&&e in I)return I[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},w=t+" Iterator",x=!1,I=e.prototype,E=I[g]||I["@@iterator"]||f&&I[f],A=!m&&E||T(f),C="Array"==t&&I.entries||E;if(C&&(S=o(C.call(new e)),h!==Object.prototype&&S.next&&(d||o(S)===h||(a?a(S,h):"function"!=typeof S[g]&&c(S,g,v)),s(S,w,!0,!0),d&&(p[w]=v))),"values"==f&&E&&"values"!==E.name&&(x=!0,A=function(){return E.call(this)}),d&&!b||I[g]===A||c(I,g,A),p[t]=A,f)if(_={values:T("values"),keys:y?A:T("keys"),entries:T("entries")},b)for(M in _)(m||x||!(M in I))&&u(I,M,_[M]);else n({target:t,proto:!0,forced:m||x},_);return _}},function(e,t,r){var n=r(10),i=r(64),o=r(6)("species");e.exports=function(e,t){var r;return i(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!i(r.prototype)?n(r)&&null===(r=r[o])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}},function(e,t,r){var n=r(28);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(37),i=r(15),o=r(22);e.exports=function(e,t,r){var a=n(t);a in e?i.f(e,a,o(0,r)):e[a]=r}},function(e,t,r){var n=r(7),i=r(6),o=r(43),a=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,r){var n=r(77),i=r(57).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(6);t.f=n},function(e,t,r){var n=r(7);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},function(e,t,r){var n=r(1);e.exports=function(e,t){var r,i=n(this),o=arguments.length>2?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof o)throw TypeError("At least one callback required");return i.has(e)?(r=i.get(e),"function"==typeof t&&(r=t(r),i.set(e,r))):"function"==typeof o&&(r=o(),i.set(e,r)),r}},function(e,t,r){var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!n.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},function(e,t,r){var n=r(7),i=r(28),o="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?o.call(e,""):Object(e)}:Object},function(e,t,r){var n=r(11),i=r(7),o=r(51);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(7),i=/#|\.prototype\./,o=function(e,t){var r=s[a(e)];return r==u||r!=c&&("function"==typeof t?n(t):!!t)},a=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},s=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";e.exports=o},function(e,t,r){var n=r(0),i=r(52),o=r(55),a=r(41),s=r(14),c=r(22),u=r(4),l=function(e,t){var r=this;if(!(r instanceof l))return new l(e,t);o&&(r=o(new Error(void 0),i(r))),void 0!==t&&s(r,"message",String(t));var n=[];return u(e,n.push,{that:n}),s(r,"errors",n),r};l.prototype=a(Error.prototype,{constructor:c(5,l),message:c(5,""),name:c(5,"AggregateError")}),n({global:!0},{AggregateError:l})},function(e,t,r){var n=r(11),i=r(15),o=r(1),a=r(56);e.exports=n?Object.defineProperties:function(e,t){o(e);for(var r,n=a(t),s=n.length,c=0;s>c;)i.f(e,r=n[c++],t[r]);return e}},function(e,t,r){var n=r(13),i=r(18),o=r(78).indexOf,a=r(30);e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)!n(a,r)&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){var n=r(18),i=r(29),o=r(79),a=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),l=o(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,r){var n=r(42),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},function(e,t,r){var n=r(16);e.exports=n("document","documentElement")},function(e,t,r){var n=r(58);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n=r(45),i=r(23),o=r(6)("iterator");e.exports=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[n(e)]}},function(e,t,r){var n=r(3);e.exports=n.Promise},function(e,t,r){var n=r(16),i=r(15),o=r(6),a=r(11),s=o("species");e.exports=function(e){var t=n(e),r=i.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(54),i=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return i.call(e)}),e.exports=n.inspectSource},function(e,t,r){var n,i,o,a=r(3),s=r(7),c=r(12),u=r(80),l=r(51),d=r(87),p=r(60),f=a.location,h=a.setImmediate,m=a.clearImmediate,g=a.process,v=a.MessageChannel,y=a.Dispatch,b=0,S={},_=function(e){if(S.hasOwnProperty(e)){var t=S[e];delete S[e],t()}},M=function(e){return function(){_(e)}},T=function(e){_(e.data)},w=function(e){a.postMessage(e+"",f.protocol+"//"+f.host)};h&&m||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return S[++b]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},n(b),b},m=function(e){delete S[e]},p?n=function(e){g.nextTick(M(e))}:y&&y.now?n=function(e){y.now(M(e))}:v&&!d?(o=(i=new v).port2,i.port1.onmessage=T,n=c(o.postMessage,o,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts&&f&&"file:"!==f.protocol&&!s(w)?(n=w,a.addEventListener("message",T,!1)):n="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),_(e)}}:function(e){setTimeout(M(e),0)}),e.exports={set:h,clear:m}},function(e,t,r){var n=r(44);e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(n)},function(e,t,r){var n=r(1),i=r(10),o=r(33);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(3),i=r(85),o=n.WeakMap;e.exports="function"==typeof o&&/native code/.test(i(o))},function(e,t,r){var n=r(0),i=r(8),o=r(33),a=r(49),s=r(4);n({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=o.f(t),n=r.resolve,c=r.reject,u=a((function(){var r=i(t.resolve),o=[],a=0,c=1;s(e,(function(e){var i=a++,s=!1;o.push(void 0),c++,r.call(t,e).then((function(e){s||(s=!0,o[i]={status:"fulfilled",value:e},--c||n(o))}),(function(e){s||(s=!0,o[i]={status:"rejected",reason:e},--c||n(o))}))})),--c||n(o)}));return u.error&&c(u.value),r.promise}})},function(e,t,r){var n=r(0),i=r(8),o=r(16),a=r(33),s=r(49),c=r(4);n({target:"Promise",stat:!0},{any:function(e){var t=this,r=a.f(t),n=r.resolve,u=r.reject,l=s((function(){var r=i(t.resolve),a=[],s=0,l=1,d=!1;c(e,(function(e){var i=s++,c=!1;a.push(void 0),l++,r.call(t,e).then((function(e){c||d||(d=!0,n(e))}),(function(e){c||d||(c=!0,a[i]=e,--l||u(new(o("AggregateError"))(a,"No one promise resolved")))}))})),--l||u(new(o("AggregateError"))(a,"No one promise resolved"))}));return l.error&&u(l.value),r.promise}})},function(e,t,r){var n,i,o,a=r(7),s=r(52),c=r(14),u=r(13),l=r(6),d=r(2),p=l("iterator"),f=!1;[].keys&&("next"in(o=[].keys())?(i=s(s(o)))!==Object.prototype&&(n=i):f=!0);var h=null==n||a((function(){var e={};return n[p].call(e)!==e}));h&&(n={}),d&&!h||u(n,p)||c(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},function(e,t){e.exports=function(){}},function(e,t,r){var n=r(0),i=r(7),o=r(64),a=r(10),s=r(19),c=r(29),u=r(65),l=r(63),d=r(66),p=r(6),f=r(43),h=p("isConcatSpreadable"),m=f>=51||!i((function(){var e=[];return e[h]=!1,e.concat()[0]!==e})),g=d("concat"),v=function(e){if(!a(e))return!1;var t=e[h];return void 0!==t?!!t:o(e)};n({target:"Array",proto:!0,forced:!m||!g},{concat:function(e){var t,r,n,i,o,a=s(this),d=l(a,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(v(o=-1===t?a:arguments[t])){if(p+(i=c(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<i;r++,p++)r in o&&u(d,p,o[r])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(d,p++,o)}return d.length=p,d}})},function(e,t,r){var n=r(0),i=r(3),o=r(16),a=r(2),s=r(11),c=r(58),u=r(81),l=r(7),d=r(13),p=r(64),f=r(10),h=r(1),m=r(19),g=r(18),v=r(37),y=r(22),b=r(41),S=r(56),_=r(67),M=r(147),T=r(96),w=r(27),x=r(15),I=r(71),E=r(14),A=r(31),C=r(53),k=r(39),O=r(30),N=r(40),R=r(6),P=r(68),D=r(5),j=r(24),L=r(20),z=r(25).forEach,U=k("hidden"),B=R("toPrimitive"),F=L.set,V=L.getterFor("Symbol"),H=Object.prototype,$=i.Symbol,W=o("JSON","stringify"),Y=w.f,G=x.f,Q=M.f,q=I.f,J=C("symbols"),Z=C("op-symbols"),K=C("string-to-symbol-registry"),X=C("symbol-to-string-registry"),ee=C("wks"),te=i.QObject,re=!te||!te.prototype||!te.prototype.findChild,ne=s&&l((function(){return 7!=b(G({},"a",{get:function(){return G(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=Y(H,t);n&&delete H[t],G(e,t,r),n&&e!==H&&G(H,t,n)}:G,ie=function(e,t){var r=J[e]=b($.prototype);return F(r,{type:"Symbol",tag:e,description:t}),s||(r.description=t),r},oe=u?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof $},ae=function(e,t,r){e===H&&ae(Z,t,r),h(e);var n=v(t,!0);return h(r),d(J,n)?(r.enumerable?(d(e,U)&&e[U][n]&&(e[U][n]=!1),r=b(r,{enumerable:y(0,!1)})):(d(e,U)||G(e,U,y(1,{})),e[U][n]=!0),ne(e,n,r)):G(e,n,r)},se=function(e,t){h(e);var r=g(t),n=S(r).concat(de(r));return z(n,(function(t){s&&!ce.call(r,t)||ae(e,t,r[t])})),e},ce=function(e){var t=v(e,!0),r=q.call(this,t);return!(this===H&&d(J,t)&&!d(Z,t))&&(!(r||!d(this,t)||!d(J,t)||d(this,U)&&this[U][t])||r)},ue=function(e,t){var r=g(e),n=v(t,!0);if(r!==H||!d(J,n)||d(Z,n)){var i=Y(r,n);return!i||!d(J,n)||d(r,U)&&r[U][n]||(i.enumerable=!0),i}},le=function(e){var t=Q(g(e)),r=[];return z(t,(function(e){d(J,e)||d(O,e)||r.push(e)})),r},de=function(e){var t=e===H,r=Q(t?Z:g(e)),n=[];return z(r,(function(e){!d(J,e)||t&&!d(H,e)||n.push(J[e])})),n};c||(A(($=function(){if(this instanceof $)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=N(e),r=function(e){this===H&&r.call(Z,e),d(this,U)&&d(this[U],t)&&(this[U][t]=!1),ne(this,t,y(1,e))};return s&&re&&ne(H,t,{configurable:!0,set:r}),ie(t,e)}).prototype,"toString",(function(){return V(this).tag})),A($,"withoutSetter",(function(e){return ie(N(e),e)})),I.f=ce,x.f=ae,w.f=ue,_.f=M.f=le,T.f=de,P.f=function(e){return ie(R(e),e)},s&&(G($.prototype,"description",{configurable:!0,get:function(){return V(this).description}}),a||A(H,"propertyIsEnumerable",ce,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:$}),z(S(ee),(function(e){D(e)})),n({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=String(e);if(d(K,t))return K[t];var r=$(t);return K[t]=r,X[r]=t,r},keyFor:function(e){if(!oe(e))throw TypeError(e+" is not a symbol");if(d(X,e))return X[e]},useSetter:function(){re=!0},useSimple:function(){re=!1}}),n({target:"Object",stat:!0,forced:!c,sham:!s},{create:function(e,t){return void 0===t?b(e):se(b(e),t)},defineProperty:ae,defineProperties:se,getOwnPropertyDescriptor:ue}),n({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:le,getOwnPropertySymbols:de}),n({target:"Object",stat:!0,forced:l((function(){T.f(1)}))},{getOwnPropertySymbols:function(e){return T.f(m(e))}}),W&&n({target:"JSON",stat:!0,forced:!c||l((function(){var e=$();return"[null]"!=W([e])||"{}"!=W({a:e})||"{}"!=W(Object(e))}))},{stringify:function(e,t,r){for(var n,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(n=t,(f(t)||void 0!==e)&&!oe(e))return p(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!oe(t))return t}),i[1]=t,W.apply(null,i)}}),$.prototype[B]||E($.prototype,B,$.prototype.valueOf),j($,"Symbol"),O[U]=!0},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){r(5)("iterator")},function(e,t,r){e.exports=r(174)},function(e,t,r){e.exports=r(182)},function(e,t,r){var n=r(0),i=r(3),o=r(50),a=r(7),s=r(14),c=r(4),u=r(48),l=r(10),d=r(24),p=r(15).f,f=r(25).forEach,h=r(11),m=r(20),g=m.set,v=m.getterFor;e.exports=function(e,t,r){var m,y=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),S=y?"set":"add",_=i[e],M=_&&_.prototype,T={};if(h&&"function"==typeof _&&(b||M.forEach&&!a((function(){(new _).entries().next()})))){m=t((function(t,r){g(u(t,m,e),{type:e,collection:new _}),null!=r&&c(r,t[S],{that:t,AS_ENTRIES:y})}));var w=v(e);f(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in M)||b&&"clear"==e||s(m.prototype,e,(function(r,n){var i=w(this).collection;if(!t&&b&&!l(r))return"get"==e&&void 0;var o=i[e](0===r?0:r,n);return t?this:o}))})),b||p(m.prototype,"size",{configurable:!0,get:function(){return w(this).collection.size}})}else m=r.getConstructor(t,e,y,S),o.REQUIRED=!0;return d(m,e,!1,!0),T[e]=m,n({global:!0,forced:!0},T),b||r.setStrong(m,e,y),m}},function(e,t,r){var n=r(8),i=r(12),o=r(4);e.exports=function(e){var t,r,a,s,c=arguments.length,u=c>1?arguments[1]:void 0;return n(this),(t=void 0!==u)&&n(u),null==e?new this:(r=[],t?(a=0,s=i(u,c>2?arguments[2]:void 0,2),o(e,(function(e){r.push(s(e,a++))}))):o(e,r.push,{that:r}),new this(r))}},function(e,t,r){e.exports=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}},function(e,t,r){var n=r(1),i=r(8);e.exports=function(){for(var e,t=n(this),r=i(t.delete),o=!0,a=0,s=arguments.length;a<s;a++)e=r.call(t,arguments[a]),o=o&&e;return!!o}},function(e,t,r){var n=r(1);e.exports=function(e,t){var r=n(this),i=r.has(e)&&"update"in t?t.update(r.get(e),e,r):t.insert(e,r);return r.set(e,i),i}},function(e,t,r){e.exports=r(241)},function(e,t,r){var n=r(35),i=n(r(26)),o=n(r(38)),a=n(r(134)),s=n(r(139)),c=function(e){return e&&e.__esModule?e:{default:e}};(0,i.default)(t,"__esModule",{value:!0});var u=c(r(143)),l=function(){function e(e,t,r){if(void 0===t&&(t=864e5),this.name=e,this.expire=t,this.onError=r,this.logQueue=[],this.addTimer=-1,this.onError=r||function(){},"undefined"==typeof indexedDB||"undefined"==typeof IDBKeyRange||"undefined"==typeof Proxy)return this.onError("not support indexeddb or Proxy"),this.get=function(){return o.default.resolve([])},this.delete=function(){return o.default.resolve()},void(this.log=function(){});this.db=new u.default(e,t)}return e.prototype.get=function(e){return this.db.getLogs(e)},e.prototype.delete=function(e){return this.db.deleteLogs(e)},e.prototype.log=function(e,t,r){var n,i=this,o={time:+new Date,level:e,type:r,logStr:t};this.logQueue.push(o),clearTimeout(this.addTimer),this.logQueue.length>3e3?this.db.save((0,a.default)(n=this.logQueue).call(n,0)):this.addTimer=(0,s.default)((function(){var e;i.db.save((0,a.default)(e=i.logQueue).call(e,0))}),2e3)},e}();t.default=l},function(e,t,r){var n=r(108);e.exports=n},function(e,t,r){r(109);var n=r(9).Object,i=e.exports=function(e,t,r){return n.defineProperty(e,t,r)};n.defineProperty.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(11);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperty:r(15).f})},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(112);r(130),r(131),r(132),r(133),e.exports=n},function(e,t,r){r(75),r(46),r(118),r(90),r(91),r(125),r(61),r(34);var n=r(9);e.exports=n.Promise},function(e,t,r){var n=r(3),i=r(14);e.exports=function(e,t){try{i(n,e,t)}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(7);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var n=r(10);e.exports=function(e){if(!n(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,r){var n=r(6),i=r(23),o=n("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[o]===e)}},function(e,t,r){var n=r(1);e.exports=function(e){var t=e.return;if(void 0!==t)return n(t.call(e)).value}},function(e,t,r){var n,i,o,a,s=r(0),c=r(2),u=r(3),l=r(16),d=r(83),p=r(31),f=r(47),h=r(55),m=r(24),g=r(84),v=r(10),y=r(8),b=r(48),S=r(85),_=r(4),M=r(120),T=r(32),w=r(86).set,x=r(121),I=r(88),E=r(123),A=r(33),C=r(49),k=r(20),O=r(74),N=r(6),R=r(124),P=r(60),D=r(43),j=N("species"),L="Promise",z=k.get,U=k.set,B=k.getterFor(L),F=d&&d.prototype,V=d,H=F,$=u.TypeError,W=u.document,Y=u.process,G=A.f,Q=G,q=!!(W&&W.createEvent&&u.dispatchEvent),J="function"==typeof PromiseRejectionEvent,Z=!1,K=O(L,(function(){var e=S(V)!==String(V);if(!e&&66===D)return!0;if(c&&!H.finally)return!0;if(D>=51&&/native code/.test(V))return!1;var t=new V((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(t.constructor={})[j]=r,!(Z=t.then((function(){}))instanceof r)||!e&&R&&!J})),X=K||!M((function(e){V.all(e).catch((function(){}))})),ee=function(e){var t;return!(!v(e)||"function"!=typeof(t=e.then))&&t},te=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;x((function(){for(var n=e.value,i=1==e.state,o=0;r.length>o;){var a,s,c,u=r[o++],l=i?u.ok:u.fail,d=u.resolve,p=u.reject,f=u.domain;try{l?(i||(2===e.rejection&&oe(e),e.rejection=1),!0===l?a=n:(f&&f.enter(),a=l(n),f&&(f.exit(),c=!0)),a===u.promise?p($("Promise-chain cycle")):(s=ee(a))?s.call(a,d,p):d(a)):p(n)}catch(e){f&&!c&&f.exit(),p(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&ne(e)}))}},re=function(e,t,r){var n,i;q?((n=W.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!J&&(i=u["on"+e])?i(n):"unhandledrejection"===e&&E("Unhandled promise rejection",r)},ne=function(e){w.call(u,(function(){var t,r=e.facade,n=e.value;if(ie(e)&&(t=C((function(){P?Y.emit("unhandledRejection",n,r):re("unhandledrejection",r,n)})),e.rejection=P||ie(e)?2:1,t.error))throw t.value}))},ie=function(e){return 1!==e.rejection&&!e.parent},oe=function(e){w.call(u,(function(){var t=e.facade;P?Y.emit("rejectionHandled",t):re("rejectionhandled",t,e.value)}))},ae=function(e,t,r){return function(n){e(t,n,r)}},se=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,te(e,!0))},ce=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw $("Promise can't be resolved itself");var n=ee(t);n?x((function(){var r={done:!1};try{n.call(t,ae(ce,r,e),ae(se,r,e))}catch(t){se(r,t,e)}})):(e.value=t,e.state=1,te(e,!1))}catch(t){se({done:!1},t,e)}}};if(K&&(H=(V=function(e){b(this,V,L),y(e),n.call(this);var t=z(this);try{e(ae(ce,t),ae(se,t))}catch(e){se(t,e)}}).prototype,(n=function(e){U(this,{type:L,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=f(H,{then:function(e,t){var r=B(this),n=G(T(this,V));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=P?Y.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&te(r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=z(e);this.promise=e,this.resolve=ae(ce,t),this.reject=ae(se,t)},A.f=G=function(e){return e===V||e===o?new i(e):Q(e)},!c&&"function"==typeof d&&F!==Object.prototype)){a=F.then,Z||(p(F,"then",(function(e,t){var r=this;return new V((function(e,t){a.call(r,e,t)})).then(e,t)}),{unsafe:!0}),p(F,"catch",H.catch,{unsafe:!0}));try{delete F.constructor}catch(e){}h&&h(F,H)}s({global:!0,wrap:!0,forced:K},{Promise:V}),m(V,L,!1,!0),g(L),o=l(L),s({target:L,stat:!0,forced:K},{reject:function(e){var t=G(this);return t.reject.call(void 0,e),t.promise}}),s({target:L,stat:!0,forced:c||K},{resolve:function(e){return I(c&&this===o?V:this,e)}}),s({target:L,stat:!0,forced:X},{all:function(e){var t=this,r=G(t),n=r.resolve,i=r.reject,o=C((function(){var r=y(t.resolve),o=[],a=0,s=1;_(e,(function(e){var c=a++,u=!1;o.push(void 0),s++,r.call(t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=G(t),n=r.reject,i=C((function(){var i=y(t.resolve);_(e,(function(e){i.call(t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},function(e,t,r){var n=r(59),i=r(45);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,r){var n=r(6)("iterator"),i=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){i=!0}};a[n]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},function(e,t,r){var n,i,o,a,s,c,u,l,d=r(3),p=r(27).f,f=r(86).set,h=r(87),m=r(122),g=r(60),v=d.MutationObserver||d.WebKitMutationObserver,y=d.document,b=d.process,S=d.Promise,_=p(d,"queueMicrotask"),M=_&&_.value;M||(n=function(){var e,t;for(g&&(e=b.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():o=void 0,e}}o=void 0,e&&e.enter()},h||g||m||!v||!y?S&&S.resolve?((u=S.resolve(void 0)).constructor=S,l=u.then,a=function(){l.call(u,n)}):a=g?function(){b.nextTick(n)}:function(){f.call(d,n)}:(s=!0,c=y.createTextNode(""),new v(n).observe(c,{characterData:!0}),a=function(){c.data=s=!s})),e.exports=M||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,a()),o=t}},function(e,t,r){var n=r(44);e.exports=/web0s(?!.*chrome)/i.test(n)},function(e,t,r){var n=r(3);e.exports=function(e,t){var r=n.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},function(e,t){e.exports="object"==typeof window},function(e,t,r){var n=r(0),i=r(2),o=r(83),a=r(7),s=r(16),c=r(32),u=r(88),l=r(31);if(n({target:"Promise",proto:!0,real:!0,forced:!!o&&a((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=c(this,s("Promise")),r="function"==typeof e;return this.then(r?function(r){return u(t,e()).then((function(){return r}))}:e,r?function(r){return u(t,e()).then((function(){throw r}))}:e)}}),!i&&"function"==typeof o){var d=s("Promise").prototype.finally;o.prototype.finally!==d&&l(o.prototype,"finally",d,{unsafe:!0})}},function(e,t,r){var n=r(42),i=r(36),o=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}};e.exports={codeAt:o(!1),charAt:o(!0)}},function(e,t,r){var n=r(92).IteratorPrototype,i=r(41),o=r(22),a=r(24),s=r(23),c=function(){return this};e.exports=function(e,t,r){var u=t+" Iterator";return e.prototype=i(n,{next:o(1,r)}),a(e,u,!1,!0),s[u]=c,e}},function(e,t,r){var n=r(18),i=r(93),o=r(23),a=r(20),s=r(62),c=a.set,u=a.getterFor("Array Iterator");e.exports=s(Array,"Array",(function(e,t){c(this,{type:"Array Iterator",target:n(e),index:0,kind:t})}),(function(){var e=u(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){r(75)},function(e,t,r){r(90)},function(e,t,r){var n=r(0),i=r(33),o=r(49);n({target:"Promise",stat:!0},{try:function(e){var t=i.f(this),r=o(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}})},function(e,t,r){r(91)},function(e,t,r){e.exports=r(135)},function(e,t,r){var n=r(136);e.exports=n},function(e,t,r){var n=r(137),i=Array.prototype;e.exports=function(e){var t=e.splice;return e===i||e instanceof Array&&t===i.splice?n:t}},function(e,t,r){r(138);var n=r(21);e.exports=n("Array").splice},function(e,t,r){var n=r(0),i=r(79),o=r(42),a=r(29),s=r(19),c=r(63),u=r(65),l=r(66)("splice"),d=Math.max,p=Math.min;n({target:"Array",proto:!0,forced:!l},{splice:function(e,t){var r,n,l,f,h,m,g=s(this),v=a(g.length),y=i(e,v),b=arguments.length;if(0===b?r=n=0:1===b?(r=0,n=v-y):(r=b-2,n=p(d(o(t),0),v-y)),v+r-n>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=c(g,n),f=0;f<n;f++)(h=y+f)in g&&u(l,f,g[h]);if(l.length=n,r<n){for(f=y;f<v-n;f++)m=f+r,(h=f+n)in g?g[m]=g[h]:delete g[m];for(f=v;f>v-n+r;f--)delete g[f-1]}else if(r>n)for(f=v-n;f>y;f--)m=f+r-1,(h=f+n-1)in g?g[m]=g[h]:delete g[m];for(f=0;f<r;f++)g[f+y]=arguments[f+2];return g.length=v-n+r,l}})},function(e,t,r){e.exports=r(140)},function(e,t,r){var n=r(141);e.exports=n},function(e,t,r){r(142);var n=r(9);e.exports=n.setTimeout},function(e,t,r){var n=r(0),i=r(3),o=r(44),a=[].slice,s=function(e){return function(t,r){var n=arguments.length>2,i=n?a.call(arguments,2):void 0;return e(n?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,r)}};n({global:!0,bind:!0,forced:/MSIE .\./.test(o)},{setTimeout:s(i.setTimeout),setInterval:s(i.setInterval)})},function(e,t,r){var n=r(35),i=n(r(38)),o=n(r(144)),a=n(r(171)),s=n(r(26)),c=n(r(98)),u=n(r(178)),l=n(r(99)),d=function(e,t,r,n){return new(r||(r=i.default))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},p=function(e,t){var r,n,i,s,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof o.default&&(s[a.default]=function(){return this}),s;function u(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return c.label++,{value:o[1],done:!1};case 5:c.label++,n=o[1],o=[0];continue;case 7:o=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){c=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){c.label=o[1];break}if(6===o[0]&&c.label<i[1]){c.label=i[1],i=o;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(o);break}i[2]&&c.ops.pop(),c.trys.pop();continue}o=t.call(e,c)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};(0,s.default)(t,"__esModule",{value:!0});var f=r(188),h=function(){function e(e,t){void 0===t&&(t=86400),this.name=e,this.expire=t,this.dbVersion=2,this.name=e,this.expire=t,this.dbPromise=this.initDB()}return e.prototype.initDB=function(){return f.openDB(this.name,this.dbVersion,{upgrade:function(e,t,r,n){if(1===t)try{e.deleteObjectStore("log_detail")}catch(e){}e.createObjectStore("log_detail",{keyPath:"id",autoIncrement:!0}).createIndex("time","time")}})},e.prototype.getLogs=function(e){return d(this,void 0,void 0,(function(){var t,r,n,o,a,s,u,l;return p(this,(function(d){switch(d.label){case 0:return t=[],[4,this.dbPromise];case 1:return r=d.sent(),n=f.unwrap(r).transaction("log_detail","readonly").objectStore("log_detail"),o=function(e){var t=e.end,r=e.start,n=e.type,i=e.level,o=IDBKeyRange.bound(r||0,t||+new Date),a=function(e){return!0},s=0;switch(n&&(s+=2),i&&(s+=1),s){case 1:a=function(e){return e.level===i};break;case 2:a=function(e){return e.type===n};break;case 3:a=function(e){return e.type===n&&e.level===i}}return{indexName:"time",filter:a,keyRange:o}}(e),a=o.indexName,s=o.keyRange,u=(0,c.default)(o),l=n.index(a).openCursor(s),[2,new i.default((function(e,r){l.onsuccess=function(r){var n=r.target.result;n?(u(n.value)&&t.push(n.value),n.continue()):e(t)},l.onerror=function(e){r(e)}}))]}}))}))},e.prototype.deleteLogs=function(e){return d(this,void 0,void 0,(function(){var t,r,n,o,a;return p(this,(function(s){switch(s.label){case 0:return[4,this.dbPromise];case 1:return t=s.sent(),r=f.unwrap(t).transaction("log_detail","readwrite").objectStore("log_detail"),n=e.start,o=e.end,a=r.index("time").openKeyCursor(IDBKeyRange.bound(n,o)),[2,new i.default((function(e,t){a.onsuccess=function(){var t=a.result;t?(r.delete(t.primaryKey),t.continue()):e(null)},a.onerror=function(e){t(e)}}))]}}))}))},e.prototype.save=function(e){return d(this,void 0,void 0,(function(){var t,r;return p(this,(function(n){switch(n.label){case 0:return[4,this.dbPromise];case 1:return t=n.sent(),r=[],[2,this.deleteLogs({start:0,end:(0,u.default)()-this.expire}).then((function(){var n=t.transaction("log_detail","readwrite").objectStore("log_detail");return(0,l.default)(e).call(e,(function(e){r.push(n.put(e))})),i.default.all(r)}))]}}))}))},e}();t.default=h},function(e,t,r){e.exports=r(145)},function(e,t,r){var n=r(146);r(164),r(165),r(166),r(167),r(168),r(169),r(170),e.exports=n},function(e,t,r){r(94),r(46),r(95),r(148),r(149),r(150),r(151),r(97),r(152),r(153),r(154),r(155),r(156),r(157),r(158),r(159),r(160),r(161),r(162),r(163);var n=r(9);e.exports=n.Symbol},function(e,t,r){var n=r(18),i=r(67).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},function(e,t,r){r(5)("asyncIterator")},function(e,t){},function(e,t,r){r(5)("hasInstance")},function(e,t,r){r(5)("isConcatSpreadable")},function(e,t,r){r(5)("match")},function(e,t,r){r(5)("matchAll")},function(e,t,r){r(5)("replace")},function(e,t,r){r(5)("search")},function(e,t,r){r(5)("species")},function(e,t,r){r(5)("split")},function(e,t,r){r(5)("toPrimitive")},function(e,t,r){r(5)("toStringTag")},function(e,t,r){r(5)("unscopables")},function(e,t,r){var n=r(3);r(24)(n.JSON,"JSON",!0)},function(e,t){},function(e,t){},function(e,t,r){r(5)("asyncDispose")},function(e,t,r){r(5)("dispose")},function(e,t,r){r(5)("matcher")},function(e,t,r){r(5)("metadata")},function(e,t,r){r(5)("observable")},function(e,t,r){r(5)("patternMatch")},function(e,t,r){r(5)("replaceAll")},function(e,t,r){e.exports=r(172)},function(e,t,r){var n=r(173);e.exports=n},function(e,t,r){r(97),r(61),r(34);var n=r(68);e.exports=n.f("iterator")},function(e,t,r){var n=r(175);e.exports=n},function(e,t,r){var n=r(176),i=Array.prototype;e.exports=function(e){var t=e.filter;return e===i||e instanceof Array&&t===i.filter?n:t}},function(e,t,r){r(177);var n=r(21);e.exports=n("Array").filter},function(e,t,r){var n=r(0),i=r(25).filter;n({target:"Array",proto:!0,forced:!r(66)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(179)},function(e,t,r){var n=r(180);e.exports=n},function(e,t,r){r(181);var n=r(9);e.exports=n.Date.now},function(e,t,r){r(0)({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},function(e,t,r){var n=r(183);e.exports=n},function(e,t,r){r(34);var n=r(184),i=r(45),o=Array.prototype,a={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===o||e instanceof Array&&t===o.forEach||a.hasOwnProperty(i(e))?n:t}},function(e,t,r){var n=r(185);e.exports=n},function(e,t,r){r(186);var n=r(21);e.exports=n("Array").forEach},function(e,t,r){var n=r(0),i=r(187);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},function(e,t,r){var n=r(25).forEach,i=r(69)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){var n=r(189),i=r(193),o=r(98),a=r(196),s=r(99),c=r(200),u=r(205),l=r(26),d=r(35);l(t,"__esModule",{value:!0}),t.deleteDB=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).blocked,r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",(function(){return t()})),(0,v.w)(r).then((function(){}))},t.openDB=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.blocked,i=r.upgrade,o=r.blocking,a=r.terminated,s=indexedDB.open(e,t),c=(0,v.w)(s);return i&&s.addEventListener("upgradeneeded",(function(e){i((0,v.w)(s.result),e.oldVersion,e.newVersion,(0,v.w)(s.transaction))})),n&&s.addEventListener("blocked",(function(){return n()})),c.then((function(e){a&&e.addEventListener("close",(function(){return a()})),o&&e.addEventListener("versionchange",(function(){return o()}))})).catch((function(){})),c},l(t,"unwrap",{enumerable:!0,get:function(){return v.u}}),l(t,"wrap",{enumerable:!0,get:function(){return v.w}});var p=d(r(209)),f=d(r(211)),h=d(r(212)),m=d(r(213)),g=d(r(105)),v=r(250);function y(e,t){var r=n(e);if(i){var s=i(e);t&&(s=o(s).call(s,(function(t){return a(e,t).enumerable}))),r.push.apply(r,s)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)s(r=y(Object(n),!0)).call(r,(function(t){(0,f.default)(e,t,n[t])}));else if(c)u(e,c(n));else{var i;s(i=y(Object(n))).call(i,(function(t){l(e,t,a(n,t))}))}}return e}var S=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],M=new m.default;function T(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(M.get(t))return M.get(t);var r=t.replace(/FromIndex$/,""),n=t!==r,i=(0,g.default)(_).call(_,r);if(r in(n?IDBIndex:IDBObjectStore).prototype&&(i||(0,g.default)(S).call(S,r))){var o=function(){var e=(0,h.default)(p.default.mark((function e(t){var o,a,s,c,u,l,d,f=arguments;return p.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=this.transaction(t,i?"readwrite":"readonly"),s=a.store,c=f.length,u=new Array(c>1?c-1:0),l=1;l<c;l++)u[l-1]=f[l];return n&&(s=s.index(u.shift())),e.next=6,(o=s)[r].apply(o,u);case 6:if(d=e.sent,!i){e.next=10;break}return e.next=10,a.done;case 10:return e.abrupt("return",d);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return M.set(t,o),o}}}(0,v.r)((function(e){return b(b({},e),{},{get:function(t,r,n){return T(t,r)||e.get(t,r,n)},has:function(t,r){return!!T(t,r)||e.has(t,r)}})}))},function(e,t,r){e.exports=r(190)},function(e,t,r){var n=r(191);e.exports=n},function(e,t,r){r(192);var n=r(9);e.exports=n.Object.keys},function(e,t,r){var n=r(0),i=r(19),o=r(56);n({target:"Object",stat:!0,forced:r(7)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},function(e,t,r){e.exports=r(194)},function(e,t,r){var n=r(195);e.exports=n},function(e,t,r){r(95);var n=r(9);e.exports=n.Object.getOwnPropertySymbols},function(e,t,r){e.exports=r(197)},function(e,t,r){var n=r(198);e.exports=n},function(e,t,r){r(199);var n=r(9).Object,i=e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)};n.getOwnPropertyDescriptor.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(7),o=r(18),a=r(27).f,s=r(11),c=i((function(){a(1)}));n({target:"Object",stat:!0,forced:!s||c,sham:!s},{getOwnPropertyDescriptor:function(e,t){return a(o(e),t)}})},function(e,t,r){e.exports=r(201)},function(e,t,r){var n=r(202);e.exports=n},function(e,t,r){r(203);var n=r(9);e.exports=n.Object.getOwnPropertyDescriptors},function(e,t,r){var n=r(0),i=r(11),o=r(204),a=r(18),s=r(27),c=r(65);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=a(e),i=s.f,u=o(n),l={},d=0;u.length>d;)void 0!==(r=i(n,t=u[d++]))&&c(l,t,r);return l}})},function(e,t,r){var n=r(16),i=r(67),o=r(96),a=r(1);e.exports=n("Reflect","ownKeys")||function(e){var t=i.f(a(e)),r=o.f;return r?t.concat(r(e)):t}},function(e,t,r){e.exports=r(206)},function(e,t,r){var n=r(207);e.exports=n},function(e,t,r){r(208);var n=r(9).Object,i=e.exports=function(e,t){return n.defineProperties(e,t)};n.defineProperties.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(11);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperties:r(76)})},function(e,t,r){e.exports=r(210)},function(e,t,r){var n=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof d?t:d,o=Object.create(i.prototype),a=new T(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return x()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function p(){}function f(){}var h={};h[i]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,i)&&(h=g);var v=f.prototype=d.prototype=Object.create(h);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(i,o){function a(){return new t((function(n,a){!function n(i,o,a,s){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function w(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return p.prototype=v.constructor=f,f.constructor=p,p.displayName=s(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),b.prototype[o]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),s(v,a,"Generator"),v[i]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=w,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},function(e,t,r){var n=r(26);e.exports=function(e,t,r){return t in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(38);function i(e,t,r,i,o,a,s){try{var c=e[a](s),u=c.value}catch(e){return void r(e)}c.done?t(u):n.resolve(u).then(i,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new n((function(n,o){var a=e.apply(t,r);function s(e){i(a,n,o,s,c,"next",e)}function c(e){i(a,n,o,s,c,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(214)},function(e,t,r){var n=r(215);r(219),r(220),r(221),r(222),r(223),r(225),r(226),r(227),r(228),r(229),r(231),r(232),r(233),r(234),r(235),r(236),r(237),r(238),r(239),r(240),e.exports=n},function(e,t,r){r(216),r(46),r(61),r(34);var n=r(9);e.exports=n.Map},function(e,t,r){var n=r(100),i=r(218);e.exports=n("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),i)},function(e,t,r){var n=r(7);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(e,t,r){var n=r(15).f,i=r(41),o=r(47),a=r(12),s=r(48),c=r(4),u=r(62),l=r(84),d=r(11),p=r(50).fastKey,f=r(20),h=f.set,m=f.getterFor;e.exports={getConstructor:function(e,t,r,u){var l=e((function(e,n){s(e,l,t),h(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),f=m(t),g=function(e,t,r){var n,i,o=f(e),a=v(e,t);return a?a.value=r:(o.last=a={index:i=p(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=a),n&&(n.next=a),d?o.size++:e.size++,"F"!==i&&(o.index[i]=a)),e},v=function(e,t){var r,n=f(e),i=p(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return o(l.prototype,{clear:function(){for(var e=f(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t=f(this),r=v(this,e);if(r){var n=r.next,i=r.previous;delete t.index[r.index],r.removed=!0,i&&(i.next=n),n&&(n.previous=i),t.first==r&&(t.first=n),t.last==r&&(t.last=i),d?t.size--:this.size--}return!!r},forEach:function(e){for(var t,r=f(this),n=a(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!v(this,e)}}),o(l.prototype,r?{get:function(e){var t=v(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),d&&n(l.prototype,"size",{get:function(){return f(this).size}}),l},setStrong:function(e,t,r){var n=t+" Iterator",i=m(t),o=m(n);u(e,t,(function(e,t){h(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),l(t)}}},function(e,t,r){r(0)({target:"Map",stat:!0},{from:r(101)})},function(e,t,r){r(0)({target:"Map",stat:!0},{of:r(102)})},function(e,t,r){var n=r(0),i=r(2),o=r(103);n({target:"Map",proto:!0,real:!0,forced:i},{deleteAll:function(){return o.apply(this,arguments)}})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{emplace:r(104)})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(12),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{every:function(e){var t=o(this),r=s(t),n=a(e,arguments.length>1?arguments[1]:void 0,3);return!c(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){var n=r(1),i=r(82);e.exports=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return n(t.call(e))}},function(e,t,r){var n=r(0),i=r(2),o=r(16),a=r(1),s=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{filter:function(e){var t=a(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=s(i.set);return d(r,(function(e,r){n(r,e,t)&&p.call(i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(12),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{find:function(e){var t=o(this),r=s(t),n=a(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(12),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{findKey:function(e){var t=o(this),r=s(t),n=a(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(4),o=r(8);n({target:"Map",stat:!0},{groupBy:function(e,t){var r=new this;o(t);var n=o(r.has),a=o(r.get),s=o(r.set);return i(e,(function(e){var i=t(e);n.call(r,i)?a.call(r,i).push(e):s.call(r,i,[e])})),r}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(17),s=r(230),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{includes:function(e){return c(a(o(this)),(function(t,r,n){if(s(r,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){var n=r(0),i=r(4),o=r(8);n({target:"Map",stat:!0},{keyBy:function(e,t){var r=new this;o(t);var n=o(r.set);return i(e,(function(e){n.call(r,t(e),e)})),r}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(17),s=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{keyOf:function(e){return s(a(o(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(2),o=r(16),a=r(1),s=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{mapKeys:function(e){var t=a(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=s(i.set);return d(r,(function(e,r){p.call(i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(16),a=r(1),s=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{mapValues:function(e){var t=a(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=s(i.set);return d(r,(function(e,r){p.call(i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(8),s=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{merge:function(e){for(var t=o(this),r=a(t.set),n=0;n<arguments.length;)s(arguments[n++],r,{that:t,AS_ENTRIES:!0});return t}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(8),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{reduce:function(e){var t=o(this),r=s(t),n=arguments.length<2,i=n?void 0:arguments[1];if(a(e),c(r,(function(r,o){n?(n=!1,i=o):i=e(i,o,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(12),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{some:function(e){var t=o(this),r=s(t),n=a(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(8);n({target:"Map",proto:!0,real:!0,forced:i},{update:function(e,t){var r=o(this),n=arguments.length;a(t);var i=r.has(e);if(!i&&n<3)throw TypeError("Updating absent value");var s=i?r.get(e):a(n>2?arguments[2]:void 0)(e,r);return r.set(e,t(s,e,r)),r}})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{upsert:r(70)})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{updateOrInsert:r(70)})},function(e,t,r){var n=r(242);e.exports=n},function(e,t,r){var n=r(243),i=r(245),o=Array.prototype,a=String.prototype;e.exports=function(e){var t=e.includes;return e===o||e instanceof Array&&t===o.includes?n:"string"==typeof e||e===a||e instanceof String&&t===a.includes?i:t}},function(e,t,r){r(244);var n=r(21);e.exports=n("Array").includes},function(e,t,r){var n=r(0),i=r(78).includes,o=r(93);n({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(e,t,r){r(246);var n=r(21);e.exports=n("String").includes},function(e,t,r){var n=r(0),i=r(247),o=r(36);n({target:"String",proto:!0,forced:!r(249)("includes")},{includes:function(e){return!!~String(o(this)).indexOf(i(e),arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(248);e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,r){var n=r(10),i=r(28),o=r(6)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(6)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){var n=r(26),i=r(35);n(t,"__esModule",{value:!0}),t.r=function(e){b=e(b)},t.w=M,t.u=t.i=t.a=void 0;var o,a,s=i(r(251)),c=i(r(256)),u=i(r(38)),l=i(r(266)),d=i(r(270)),p=i(r(105)),f=function(e,t){return(0,s.default)(t).call(t,(function(t){return e instanceof t}))};t.i=f;var h=new c.default,m=new c.default,g=new c.default,v=new c.default,y=new c.default;t.a=y;var b={get:function(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return m.get(e);if("objectStoreNames"===t)return e.objectStoreNames||g.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return M(e[t])},set:function(e,t,r){return e[t]=r,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function S(e){var t;return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(0,p.default)(t=a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).call(t,e)?function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.apply(T(this),r),M(h.get(this))}:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return M(e.apply(T(this),r))}:function(t){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var a=e.call.apply(e,(0,l.default)(r=[T(this),t]).call(r,i));return g.set(a,(0,d.default)(t)?(0,d.default)(t).call(t):[t]),M(a)}}function _(e){return"function"==typeof e?S(e):(e instanceof IDBTransaction&&function(e){if(!m.has(e)){var t=new u.default((function(t,r){var n=function(){e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=function(){t(),n()},o=function(){r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));m.set(e,t)}}(e),f(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,b):e)}function M(e){if(e instanceof IDBRequest)return t=e,(r=new u.default((function(e,r){var n=function(){t.removeEventListener("success",i),t.removeEventListener("error",o)},i=function(){e(M(t.result)),n()},o=function(){r(t.error),n()};t.addEventListener("success",i),t.addEventListener("error",o)}))).then((function(e){e instanceof IDBCursor&&h.set(e,t)})).catch((function(){})),y.set(r,t),r;var t,r;if(v.has(e))return v.get(e);var n=_(e);return n!==e&&(v.set(e,n),y.set(n,e)),n}var T=function(e){return y.get(e)};t.u=T},function(e,t,r){e.exports=r(252)},function(e,t,r){var n=r(253);e.exports=n},function(e,t,r){var n=r(254),i=Array.prototype;e.exports=function(e){var t=e.some;return e===i||e instanceof Array&&t===i.some?n:t}},function(e,t,r){r(255);var n=r(21);e.exports=n("Array").some},function(e,t,r){var n=r(0),i=r(25).some;n({target:"Array",proto:!0,forced:!r(69)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(257)},function(e,t,r){var n=r(258);r(261),r(262),r(263),r(264),r(265),e.exports=n},function(e,t,r){r(46),r(259),r(34);var n=r(9);e.exports=n.WeakMap},function(e,t,r){var n,i=r(3),o=r(47),a=r(50),s=r(100),c=r(260),u=r(10),l=r(20).enforce,d=r(89),p=!i.ActiveXObject&&"ActiveXObject"in i,f=Object.isExtensible,h=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},m=e.exports=s("WeakMap",h,c);if(d&&p){n=c.getConstructor(h,"WeakMap",!0),a.REQUIRED=!0;var g=m.prototype,v=g.delete,y=g.has,b=g.get,S=g.set;o(g,{delete:function(e){if(u(e)&&!f(e)){var t=l(this);return t.frozen||(t.frozen=new n),v.call(this,e)||t.frozen.delete(e)}return v.call(this,e)},has:function(e){if(u(e)&&!f(e)){var t=l(this);return t.frozen||(t.frozen=new n),y.call(this,e)||t.frozen.has(e)}return y.call(this,e)},get:function(e){if(u(e)&&!f(e)){var t=l(this);return t.frozen||(t.frozen=new n),y.call(this,e)?b.call(this,e):t.frozen.get(e)}return b.call(this,e)},set:function(e,t){if(u(e)&&!f(e)){var r=l(this);r.frozen||(r.frozen=new n),y.call(this,e)?S.call(this,e,t):r.frozen.set(e,t)}else S.call(this,e,t);return this}})}},function(e,t,r){var n=r(47),i=r(50).getWeakData,o=r(1),a=r(10),s=r(48),c=r(4),u=r(25),l=r(13),d=r(20),p=d.set,f=d.getterFor,h=u.find,m=u.findIndex,g=0,v=function(e){return e.frozen||(e.frozen=new y)},y=function(){this.entries=[]},b=function(e,t){return h(e.entries,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=b(this,e);if(t)return t[1]},has:function(e){return!!b(this,e)},set:function(e,t){var r=b(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=m(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,r,u){var d=e((function(e,n){s(e,d,t),p(e,{type:t,id:g++,frozen:void 0}),null!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),h=f(t),m=function(e,t,r){var n=h(e),a=i(o(t),!0);return!0===a?v(n).set(t,r):a[n.id]=r,e};return n(d.prototype,{delete:function(e){var t=h(this);if(!a(e))return!1;var r=i(e);return!0===r?v(t).delete(e):r&&l(r,t.id)&&delete r[t.id]},has:function(e){var t=h(this);if(!a(e))return!1;var r=i(e);return!0===r?v(t).has(e):r&&l(r,t.id)}}),n(d.prototype,r?{get:function(e){var t=h(this);if(a(e)){var r=i(e);return!0===r?v(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return m(this,e,t)}}:{add:function(e){return m(this,e,!0)}}),d}}},function(e,t,r){r(0)({target:"WeakMap",proto:!0,real:!0,forced:r(2)},{emplace:r(104)})},function(e,t,r){r(0)({target:"WeakMap",stat:!0},{from:r(101)})},function(e,t,r){r(0)({target:"WeakMap",stat:!0},{of:r(102)})},function(e,t,r){var n=r(0),i=r(2),o=r(103);n({target:"WeakMap",proto:!0,real:!0,forced:i},{deleteAll:function(){return o.apply(this,arguments)}})},function(e,t,r){r(0)({target:"WeakMap",proto:!0,real:!0,forced:r(2)},{upsert:r(70)})},function(e,t,r){e.exports=r(267)},function(e,t,r){var n=r(268);e.exports=n},function(e,t,r){var n=r(269),i=Array.prototype;e.exports=function(e){var t=e.concat;return e===i||e instanceof Array&&t===i.concat?n:t}},function(e,t,r){r(94);var n=r(21);e.exports=n("Array").concat},function(e,t,r){e.exports=r(271)},function(e,t,r){var n=r(272);e.exports=n},function(e,t,r){var n=r(273),i=Array.prototype;e.exports=function(e){var t=e.sort;return e===i||e instanceof Array&&t===i.sort?n:t}},function(e,t,r){r(274);var n=r(21);e.exports=n("Array").sort},function(e,t,r){var n=r(0),i=r(8),o=r(19),a=r(7),s=r(69),c=[],u=c.sort,l=a((function(){c.sort(void 0)})),d=a((function(){c.sort(null)})),p=s("sort");n({target:"Array",proto:!0,forced:l||!d||!p},{sort:function(e){return void 0===e?u.call(o(this)):u.call(o(this),i(e))}})}]).default}(dist);var LogStorage=getDefaultExportFromCjs$1(dist.exports);let logger$2;class LoggerWithStorage{constructor(){Object.defineProperty(this,"meetingLog",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rtcLog",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"imLog",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.meetingLog=new LogStorage("meeting"),this.rtcLog=new LogStorage("rtc"),this.imLog=new LogStorage("im")}log(e,t){this.baseLog(e,"log",t)}warn(e,t){this.baseLog(e,"warn",t)}error(e,t){this.baseLog(e,"error",t)}async getLog(e,t=0,r=Date.now(),n){return await this.logAction("get",e,t,r,n)}async deleteLog(e,t=0,r=Date.now(),n){return await this.logAction("delete",e,t,r,n)}async logAction(e,t,r=0,n=Date.now(),i){return await this[t][e]({start:r,end:n,type:i})}baseLog(e,t,r,n){this[e].log(t,r,n)}}var LoggerStorage={getInstance:()=>(logger$2||(logger$2=new LoggerWithStorage),logger$2),destroy(){logger$2=null}},axios$5={exports:{}},bind$5=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},bind$4=bind$5,toString$1=Object.prototype.toString,kindOf=(cache=Object.create(null),function(e){var t=toString$1.call(e);return cache[t]||(cache[t]=t.slice(8,-1).toLowerCase())}),cache;function kindOfTest(e){return e=e.toLowerCase(),function(t){return kindOf(t)===e}}function isArray$1(e){return Array.isArray(e)}function isUndefined$1(e){return void 0===e}function isBuffer$1(e){return null!==e&&!isUndefined$1(e)&&null!==e.constructor&&!isUndefined$1(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var isArrayBuffer$1=kindOfTest("ArrayBuffer");function isArrayBufferView$1(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer$1(e.buffer)}function isString$1(e){return"string"==typeof e}function isNumber$1(e){return"number"==typeof e}function isObject$1(e){return null!==e&&"object"==typeof e}function isPlainObject$1(e){if("object"!==kindOf(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var isDate$1=kindOfTest("Date"),isFile$1=kindOfTest("File"),isBlob$1=kindOfTest("Blob"),isFileList=kindOfTest("FileList");function isFunction$1(e){return"[object Function]"===toString$1.call(e)}function isStream$1(e){return isObject$1(e)&&isFunction$1(e.pipe)}function isFormData$1(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||toString$1.call(e)===t||isFunction$1(e.toString)&&e.toString()===t)}var isURLSearchParams$1=kindOfTest("URLSearchParams");function trim$1(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv$1(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach$1(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray$1(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function merge$1(){var e={};function t(t,r){isPlainObject$1(e[r])&&isPlainObject$1(t)?e[r]=merge$1(e[r],t):isPlainObject$1(t)?e[r]=merge$1({},t):isArray$1(t)?e[r]=t.slice():e[r]=t}for(var r=0,n=arguments.length;r<n;r++)forEach$1(arguments[r],t);return e}function extend$1(e,t,r){return forEach$1(t,(function(t,n){e[n]=r&&"function"==typeof t?bind$4(t,r):t})),e}function stripBOM$1(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}function inherits(e,t,r,n){e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,r&&Object.assign(e.prototype,r)}function toFlatObject(e,t,r){var n,i,o,a={};t=t||{};do{for(i=(n=Object.getOwnPropertyNames(e)).length;i-- >0;)a[o=n[i]]||(t[o]=e[o],a[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t}function endsWith(e,t,r){e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;var n=e.indexOf(t,r);return-1!==n&&n===r}function toArray(e){if(!e)return null;var t=e.length;if(isUndefined$1(t))return null;for(var r=new Array(t);t-- >0;)r[t]=e[t];return r}var isTypedArray=(TypedArray="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return TypedArray&&e instanceof TypedArray}),TypedArray,utils$w={isArray:isArray$1,isArrayBuffer:isArrayBuffer$1,isBuffer:isBuffer$1,isFormData:isFormData$1,isArrayBufferView:isArrayBufferView$1,isString:isString$1,isNumber:isNumber$1,isObject:isObject$1,isPlainObject:isPlainObject$1,isUndefined:isUndefined$1,isDate:isDate$1,isFile:isFile$1,isBlob:isBlob$1,isFunction:isFunction$1,isStream:isStream$1,isURLSearchParams:isURLSearchParams$1,isStandardBrowserEnv:isStandardBrowserEnv$1,forEach:forEach$1,merge:merge$1,extend:extend$1,trim:trim$1,stripBOM:stripBOM$1,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,isTypedArray:isTypedArray,isFileList:isFileList},utils$v=utils$w;function encode$1(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$5=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(utils$v.isURLSearchParams(t))n=t.toString();else{var i=[];utils$v.forEach(t,(function(e,t){null!=e&&(utils$v.isArray(e)?t+="[]":e=[e],utils$v.forEach(e,(function(e){utils$v.isDate(e)?e=e.toISOString():utils$v.isObject(e)&&(e=JSON.stringify(e)),i.push(encode$1(t)+"="+encode$1(e))})))})),n=i.join("&")}if(n){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e},utils$u=utils$w;function InterceptorManager$3(){this.handlers=[]}InterceptorManager$3.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},InterceptorManager$3.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager$3.prototype.forEach=function(e){utils$u.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var InterceptorManager_1$1=InterceptorManager$3,utils$t=utils$w,normalizeHeaderName$3=function(e,t){utils$t.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))},utils$s=utils$w;function AxiosError$5(e,t,r,n,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}utils$s.inherits(AxiosError$5,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var prototype=AxiosError$5.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){descriptors[e]={value:e}})),Object.defineProperties(AxiosError$5,descriptors),Object.defineProperty(prototype,"isAxiosError",{value:!0}),AxiosError$5.from=function(e,t,r,n,i,o){var a=Object.create(prototype);return utils$s.toFlatObject(e,a,(function(e){return e!==Error.prototype})),AxiosError$5.call(a,e.message,t,r,n,i),a.name=e.name,o&&Object.assign(a,o),a};var AxiosError_1=AxiosError$5,transitional$1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},utils$r=utils$w;function toFormData$1(e,t){t=t||new FormData;var r=[];function n(e){return null===e?"":utils$r.isDate(e)?e.toISOString():utils$r.isArrayBuffer(e)||utils$r.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(i,o){if(utils$r.isPlainObject(i)||utils$r.isArray(i)){if(-1!==r.indexOf(i))throw Error("Circular reference detected in "+o);r.push(i),utils$r.forEach(i,(function(r,i){if(!utils$r.isUndefined(r)){var a,s=o?o+"."+i:i;if(r&&!o&&"object"==typeof r)if(utils$r.endsWith(i,"{}"))r=JSON.stringify(r);else if(utils$r.endsWith(i,"[]")&&(a=utils$r.toArray(r)))return void a.forEach((function(e){!utils$r.isUndefined(e)&&t.append(s,n(e))}));e(r,s)}})),r.pop()}else t.append(o,n(i))}(e),t}var toFormData_1=toFormData$1,AxiosError$4=AxiosError_1,settle$3=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new AxiosError$4("Request failed with status code "+r.status,[AxiosError$4.ERR_BAD_REQUEST,AxiosError$4.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)},utils$q=utils$w,cookies$3=utils$q.isStandardBrowserEnv()?{write:function(e,t,r,n,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),utils$q.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),utils$q.isString(n)&&a.push("path="+n),utils$q.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},isAbsoluteURL$3=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},combineURLs$3=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},isAbsoluteURL$2=isAbsoluteURL$3,combineURLs$2=combineURLs$3,buildFullPath$4=function(e,t){return e&&!isAbsoluteURL$2(t)?combineURLs$2(e,t):t},utils$p=utils$w,ignoreDuplicateOf$1=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],parseHeaders$3=function(e){var t,r,n,i={};return e?(utils$p.forEach(e.split("\n"),(function(e){if(n=e.indexOf(":"),t=utils$p.trim(e.substr(0,n)).toLowerCase(),r=utils$p.trim(e.substr(n+1)),t){if(i[t]&&ignoreDuplicateOf$1.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([r]):i[t]?i[t]+", "+r:r}})),i):i},utils$o=utils$w,isURLSameOrigin$3=utils$o.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=n(window.location.href),function(t){var r=utils$o.isString(t)?n(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0},AxiosError$3=AxiosError_1,utils$n=utils$w;function CanceledError$3(e){AxiosError$3.call(this,null==e?"canceled":e,AxiosError$3.ERR_CANCELED),this.name="CanceledError"}utils$n.inherits(CanceledError$3,AxiosError$3,{__CANCEL__:!0});var CanceledError_1=CanceledError$3,parseProtocol$1=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},utils$m=utils$w,settle$2=settle$3,cookies$2=cookies$3,buildURL$4=buildURL$5,buildFullPath$3=buildFullPath$4,parseHeaders$2=parseHeaders$3,isURLSameOrigin$2=isURLSameOrigin$3,transitionalDefaults$3=transitional$1,AxiosError$2=AxiosError_1,CanceledError$2=CanceledError_1,parseProtocol=parseProtocol$1,xhr$1=function(e){return new Promise((function(t,r){var n,i=e.data,o=e.headers,a=e.responseType;function s(){e.cancelToken&&e.cancelToken.unsubscribe(n),e.signal&&e.signal.removeEventListener("abort",n)}utils$m.isFormData(i)&&utils$m.isStandardBrowserEnv()&&delete o["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",l=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+l)}var d=buildFullPath$3(e.baseURL,e.url);function p(){if(c){var n="getAllResponseHeaders"in c?parseHeaders$2(c.getAllResponseHeaders()):null,i={data:a&&"text"!==a&&"json"!==a?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:n,config:e,request:c};settle$2((function(e){t(e),s()}),(function(e){r(e),s()}),i),c=null}}if(c.open(e.method.toUpperCase(),buildURL$4(d,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=p:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(p)},c.onabort=function(){c&&(r(new AxiosError$2("Request aborted",AxiosError$2.ECONNABORTED,e,c)),c=null)},c.onerror=function(){r(new AxiosError$2("Network Error",AxiosError$2.ERR_NETWORK,e,c,c)),c=null},c.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||transitionalDefaults$3;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(new AxiosError$2(t,n.clarifyTimeoutError?AxiosError$2.ETIMEDOUT:AxiosError$2.ECONNABORTED,e,c)),c=null},utils$m.isStandardBrowserEnv()){var f=(e.withCredentials||isURLSameOrigin$2(d))&&e.xsrfCookieName?cookies$2.read(e.xsrfCookieName):void 0;f&&(o[e.xsrfHeaderName]=f)}"setRequestHeader"in c&&utils$m.forEach(o,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)})),utils$m.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),a&&"json"!==a&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(n=function(e){c&&(r(!e||e&&e.type?new CanceledError$2:e),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(n),e.signal&&(e.signal.aborted?n():e.signal.addEventListener("abort",n))),i||(i=null);var h=parseProtocol(d);h&&-1===["http","https","file"].indexOf(h)?r(new AxiosError$2("Unsupported protocol "+h+":",AxiosError$2.ERR_BAD_REQUEST,e)):c.send(i)}))},_null=null,utils$l=utils$w,normalizeHeaderName$2=normalizeHeaderName$3,AxiosError$1=AxiosError_1,transitionalDefaults$2=transitional$1,toFormData=toFormData_1,DEFAULT_CONTENT_TYPE$1={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset$1(e,t){!utils$l.isUndefined(e)&&utils$l.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter$1(){var e;return("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=xhr$1),e}function stringifySafely$1(e,t,r){if(utils$l.isString(e))try{return(t||JSON.parse)(e),utils$l.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}var defaults$7={transitional:transitionalDefaults$2,adapter:getDefaultAdapter$1(),transformRequest:[function(e,t){if(normalizeHeaderName$2(t,"Accept"),normalizeHeaderName$2(t,"Content-Type"),utils$l.isFormData(e)||utils$l.isArrayBuffer(e)||utils$l.isBuffer(e)||utils$l.isStream(e)||utils$l.isFile(e)||utils$l.isBlob(e))return e;if(utils$l.isArrayBufferView(e))return e.buffer;if(utils$l.isURLSearchParams(e))return setContentTypeIfUnset$1(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var r,n=utils$l.isObject(e),i=t&&t["Content-Type"];if((r=utils$l.isFileList(e))||n&&"multipart/form-data"===i){var o=this.env&&this.env.FormData;return toFormData(r?{"files[]":e}:e,o&&new o)}return n||"application/json"===i?(setContentTypeIfUnset$1(t,"application/json"),stringifySafely$1(e)):e}],transformResponse:[function(e){var t=this.transitional||defaults$7.transitional,r=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,i=!r&&"json"===this.responseType;if(i||n&&utils$l.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw AxiosError$1.from(e,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$l.forEach(["delete","get","head"],(function(e){defaults$7.headers[e]={}})),utils$l.forEach(["post","put","patch"],(function(e){defaults$7.headers[e]=utils$l.merge(DEFAULT_CONTENT_TYPE$1)}));var defaults_1$1=defaults$7,utils$k=utils$w,defaults$6=defaults_1$1,transformData$3=function(e,t,r){var n=this||defaults$6;return utils$k.forEach(r,(function(r){e=r.call(n,e,t)})),e},isCancel$3=function(e){return!(!e||!e.__CANCEL__)},utils$j=utils$w,transformData$2=transformData$3,isCancel$2=isCancel$3,defaults$5=defaults_1$1,CanceledError$1=CanceledError_1;function throwIfCancellationRequested$1(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new CanceledError$1}var dispatchRequest$3=function(e){return throwIfCancellationRequested$1(e),e.headers=e.headers||{},e.data=transformData$2.call(e,e.data,e.headers,e.transformRequest),e.headers=utils$j.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),utils$j.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||defaults$5.adapter)(e).then((function(t){return throwIfCancellationRequested$1(e),t.data=transformData$2.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return isCancel$2(t)||(throwIfCancellationRequested$1(e),t&&t.response&&(t.response.data=transformData$2.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},utils$i=utils$w,mergeConfig$5=function(e,t){t=t||{};var r={};function n(e,t){return utils$i.isPlainObject(e)&&utils$i.isPlainObject(t)?utils$i.merge(e,t):utils$i.isPlainObject(t)?utils$i.merge({},t):utils$i.isArray(t)?t.slice():t}function i(r){return utils$i.isUndefined(t[r])?utils$i.isUndefined(e[r])?void 0:n(void 0,e[r]):n(e[r],t[r])}function o(e){if(!utils$i.isUndefined(t[e]))return n(void 0,t[e])}function a(r){return utils$i.isUndefined(t[r])?utils$i.isUndefined(e[r])?void 0:n(void 0,e[r]):n(void 0,t[r])}function s(r){return r in t?n(e[r],t[r]):r in e?n(void 0,e[r]):void 0}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s};return utils$i.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,n=t(e);utils$i.isUndefined(n)&&t!==s||(r[e]=n)})),r},data$1={version:"0.27.2"},VERSION$1=data$1.version,AxiosError=AxiosError_1,validators$3={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){validators$3[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var deprecatedWarnings$1={};function assertOptions$1(e,t,r){if("object"!=typeof e)throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(e),i=n.length;i-- >0;){var o=n[i],a=t[o];if(a){var s=e[o],c=void 0===s||a(s,o,e);if(!0!==c)throw new AxiosError("option "+o+" must be "+c,AxiosError.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new AxiosError("Unknown option "+o,AxiosError.ERR_BAD_OPTION)}}validators$3.transitional=function(e,t,r){function n(e,t){return"[Axios v"+VERSION$1+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,i,o){if(!1===e)throw new AxiosError(n(i," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings$1[i]&&(deprecatedWarnings$1[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,o)}};var validator$3={assertOptions:assertOptions$1,validators:validators$3},utils$h=utils$w,buildURL$3=buildURL$5,InterceptorManager$2=InterceptorManager_1$1,dispatchRequest$2=dispatchRequest$3,mergeConfig$4=mergeConfig$5,buildFullPath$2=buildFullPath$4,validator$2=validator$3,validators$2=validator$2.validators;function Axios$3(e){this.defaults=e,this.interceptors={request:new InterceptorManager$2,response:new InterceptorManager$2}}Axios$3.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=mergeConfig$4(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&validator$2.assertOptions(r,{silentJSONParsing:validators$2.transitional(validators$2.boolean),forcedJSONParsing:validators$2.transitional(validators$2.boolean),clarifyTimeoutError:validators$2.transitional(validators$2.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var o,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!i){var s=[dispatchRequest$2,void 0];for(Array.prototype.unshift.apply(s,n),s=s.concat(a),o=Promise.resolve(t);s.length;)o=o.then(s.shift(),s.shift());return o}for(var c=t;n.length;){var u=n.shift(),l=n.shift();try{c=u(c)}catch(e){l(e);break}}try{o=dispatchRequest$2(c)}catch(e){return Promise.reject(e)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},Axios$3.prototype.getUri=function(e){e=mergeConfig$4(this.defaults,e);var t=buildFullPath$2(e.baseURL,e.url);return buildURL$3(t,e.params,e.paramsSerializer)},utils$h.forEach(["delete","get","head","options"],(function(e){Axios$3.prototype[e]=function(t,r){return this.request(mergeConfig$4(r||{},{method:e,url:t,data:(r||{}).data}))}})),utils$h.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,i){return this.request(mergeConfig$4(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}Axios$3.prototype[e]=t(),Axios$3.prototype[e+"Form"]=t(!0)}));var Axios_1$1=Axios$3,CanceledError=CanceledError_1;function CancelToken$1(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new CanceledError(e),t(r.reason))}))}CancelToken$1.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},CancelToken$1.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},CancelToken$1.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},CancelToken$1.source=function(){var e;return{token:new CancelToken$1((function(t){e=t})),cancel:e}};var CancelToken_1$1=CancelToken$1,spread$1=function(e){return function(t){return e.apply(null,t)}},utils$g=utils$w,isAxiosError$1=function(e){return utils$g.isObject(e)&&!0===e.isAxiosError},utils$f=utils$w,bind$3=bind$5,Axios$2=Axios_1$1,mergeConfig$3=mergeConfig$5,defaults$4=defaults_1$1;function createInstance$1(e){var t=new Axios$2(e),r=bind$3(Axios$2.prototype.request,t);return utils$f.extend(r,Axios$2.prototype,t),utils$f.extend(r,t),r.create=function(t){return createInstance$1(mergeConfig$3(e,t))},r}var axios$4=createInstance$1(defaults$4);axios$4.Axios=Axios$2,axios$4.CanceledError=CanceledError_1,axios$4.CancelToken=CancelToken_1$1,axios$4.isCancel=isCancel$3,axios$4.VERSION=data$1.version,axios$4.toFormData=toFormData_1,axios$4.AxiosError=AxiosError_1,axios$4.Cancel=axios$4.CanceledError,axios$4.all=function(e){return Promise.all(e)},axios$4.spread=spread$1,axios$4.isAxiosError=isAxiosError$1,axios$5.exports=axios$4,axios$5.exports.default=axios$4;var axios$3=axios$5.exports;let reporter$1=null;const version="1.0.0";class DataReporter{constructor(e){Object.defineProperty(this,"_appkey",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_nickname",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_meetingId",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_url",{enumerable:!0,configurable:!0,writable:!0,value:"https://statistic.live.126.net/statics/report/common/form"}),Object.defineProperty(this,"_os",{enumerable:!0,configurable:!0,writable:!0,value:this.getOperatingSystemInfo()}),console.log("constructor(), options: %o",e)}init(e){console.log("init(), options: %o",e),e.appkey&&(this._appkey=e.appKey),e.nickName&&(this._nickname=e.nickName),e.uid&&(this._uid=e.uid),e.meetingId&&(this._meetingId=e.meetingId)}send(e){console.log("send(), options: %o",e),axios$3.post(this._url,{event:{action:Object.assign({module:"meeting",platform:"Web",app_key:this._appkey,device_id:"web",version_name:version,os_ver:this._os,manufacturer:"",model:"",network_type:"10",sdk_version:version,nickname:this._nickname,uid:this._uid,meeting_id:this._meetingId,occur_time:Date.now()},e)}},{headers:{"Content-Type":"application/json;charset=utf-8",ver:version,sdktype:"meeting",appkey:this._appkey}}).then((e=>{})).catch((e=>{console.error("send() failed: %o",e)}))}sendLog(e){console.log("sendLog(), options: %o",e),axios$3.post(this._url,{event:{feedback:Object.assign({module:"meeting",platform:"Web",app_key:this._appkey,device_id:"web",version_name:"1.0.0",os_ver:this._os,manufacturer:"",model:"",network_type:"10",sdk_version:"4.2.1",nickname:this._nickname,uid:this._uid,meeting_id:this._meetingId,occur_time:Date.now()},e)}},{headers:{"Content-Type":"application/json;charset=utf-8",ver:"1.0",sdktype:"meeting",appkey:this._appkey}}).then((e=>{})).catch((e=>{console.error("sendLog() failed: %o",e)}))}getOperatingSystemInfo(){const e=navigator.userAgent,t="Win32"==navigator.platform||"Windows"==navigator.platform,r="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(r)return"Mac";if("X11"==navigator.platform&&!t&&!r)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(t){if(e.indexOf("Windows NT 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Win2000";if(e.indexOf("Windows NT 5.1")>-1||e.indexOf("Windows XP")>-1)return"WinXP";if(e.indexOf("Windows NT 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Win2003";if(e.indexOf("Windows NT 6.0")>-1||e.indexOf("Windows Vista")>-1)return"WinVista";if(e.indexOf("Windows NT 6.1")>-1||e.indexOf("Windows 7")>-1)return"Win7";if(-1!=e.indexOf("Windows NT 10"))return"Win10"}return"other"}}var DataReporter$1={getInstance:e=>(reporter$1||(reporter$1=new DataReporter(e)),reporter$1),destroy(){reporter$1=null}};function throttle(e,t=1e3){let r=Date.now();return function(...n){const i=this;Date.now()-r>=t&&(e.apply(i,n),r=Date.now())}}function formatDate(e,t="yyyy/MM/dd hh:mm"){const r=new Date(e),n={"M+":r.getMonth()+1+"","d+":r.getDate()+"","h+":r.getHours()+"","m+":r.getMinutes()+"","s+":r.getSeconds()+"","q+":Math.floor((r.getMonth()+3)/3)+"",S:r.getMilliseconds()+""};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length)));for(const e in n)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[e]:("00"+n[e]).substr((""+n[e]).length)));return t}function copyElementValue(e,t){const r=document.createElement("input");r.setAttribute("readonly","readonly"),r.setAttribute("value",e),document.body.appendChild(r),r.setSelectionRange(0,9999),r.select(),document.execCommand("copy")&&(document.execCommand("copy"),console.log("复制成功"),t()),document.body.removeChild(r)}DataReporter$1.getInstance(),LoggerStorage.getInstance();var css_248z$8=".meeting-name{display:inline-block;margin-right:8.56px}.meeting-info-modal{padding-bottom:env(safe-area-inset-bottom)}.exit-btn{padding:0 .7rem}.meeting-info>div:nth-child(odd){color:#94979a}.meeting-info>div:nth-child(2n){color:#222;word-break:break-all}.meeting-info .info-item{display:flex}.meeting-info .info-item-title{color:#94979a;font-size:14px;width:80px}.meeting-info .info-item-content{color:#222;font-size:14px}.icon{display:inline-block}.meeting-header{height:66px;line-height:66px}.icon-cert.iconfont{color:#26bd71;font-size:14px;margin-right:4px;position:relative;top:1px}.icon-copy.iconfont{color:#337eff;font-size:14px;margin-left:3px}.meeting-header-icons .iconfont{font-size:18px;margin-left:1rem}.meeting-header .icon-blue{color:#337eff}.button-ele{border:0}";styleInject(css_248z$8);const MeetingInfo=({visible:e=!1,onClose:t})=>{const[r,n]=react.exports.useState(!1),{meetingInfo:i}=react.exports.useContext(MeetingInfoContext),o=react.exports.useMemo((()=>{if(null==i?void 0:i.meetingId){const e=i.meetingId;return e.slice(0,3)+"-"+e.slice(3,6)+"-"+e.slice(-4)}return""}),[null==i?void 0:i.meetingId]);react.exports.useEffect((()=>{n(e)}),[e]);const a=e=>jsxRuntime.exports.jsx("i",{className:"icon-copy iconfont iconcopy1x",onClick:()=>{(e=>{copyElementValue(e,(()=>{Toast.success("复制成功")}))})(e)}});return jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:r&&jsxRuntime.exports.jsx("div",Object.assign({className:"w-full h-full absolute top-0 right-0 left-0 z-20 bg-transparent",onClick:e=>{t&&t(),e.stopPropagation()}},{children:jsxRuntime.exports.jsx("div",Object.assign({id:"meetingDiv",className:"w-full absolute z-20 bottom-0 meeting-info-modal",onClick:e=>{e.stopPropagation()}},{children:jsxRuntime.exports.jsx("div",Object.assign({className:" bg-white text-gray-800 rounded-t-2xl pt-6 pb-4 focus:outline-4"},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"text-left px-5 pb-5"},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"drawer-info"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"text-xl font-medium text-zinc-900"},{children:null==i?void 0:i.subject})),jsxRuntime.exports.jsxs("div",Object.assign({className:"text-xs mt-1.5 text-gray-400"},{children:[jsxRuntime.exports.jsx("i",{className:"icon-cert iconfont iconcertification1x"}),jsxRuntime.exports.jsx("span",{children:"会议正加密保护中"})]}))]})),jsxRuntime.exports.jsx("hr",{className:"border-1 border-solid border-zinc-100 mt-4"}),jsxRuntime.exports.jsxs("div",Object.assign({className:"pt-2 meeting-info text-sm"},{children:[(null==i?void 0:i.shortId)&&jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-title"},{children:"会议短号"})),jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-content"},{children:null==i?void 0:i.shortId})),a(null==i?void 0:i.shortId)]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-title"},{children:"会议ID"})),jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item-content"},{children:[jsxRuntime.exports.jsx("span",{children:o}),a(null==i?void 0:i.meetingId)]}))]})),(null==i?void 0:i.password)&&jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-title"},{children:"会议密码"})),jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-content"},{children:null==i?void 0:i.password})),a(null==i?void 0:i.password)]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-title"},{children:"主持人"})),jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-content"},{children:null==i?void 0:i.hostName}))]}))]}))]}))}))}))}))})};var MobileCameraType,MobileMicrophoneType;!function(e){e.FRONT="front",e.BACK="back"}(MobileCameraType||(MobileCameraType={})),function(e){e.HEADSET="headset",e.SPEAKER="speakerphone",e.EARPIECE="earpiece"}(MobileMicrophoneType||(MobileMicrophoneType={}));const MeetingHeader=({className:e="",visible:t=!1,onClick:r})=>{const[n,i]=react.exports.useState(!1),[o,a]=react.exports.useState(!1),{meetingInfo:{localMember:s,hostUuid:c,myUuid:u},dispatch:l}=react.exports.useContext(MeetingInfoContext),{neMeeting:d,dispatch:p}=react.exports.useContext(GlobalContext),[f,h]=react.exports.useState([]),[m,g]=react.exports.useState(!1),[v,y]=react.exports.useState({cameraType:MobileCameraType.FRONT}),[b,S]=react.exports.useState(),_={[MobileCameraType.FRONT]:["front","前置"],[MobileCameraType.BACK]:["back","后置"]},M=async()=>{try{await(null==d?void 0:d.leave())}catch(e){console.log("leaveMeetingRoom",e),l&&l({type:ActionType.RESET_MEETING,data:null}),null==d||d.destroy()}finally{p&&p({type:ActionType.JOIN_LOADING,data:!1})}},T=async()=>{try{await(null==d?void 0:d.end())}catch(e){console.log("leaveMeetingRoom",e),l&&l({type:ActionType.RESET_MEETING,data:null}),null==d||d.destroy()}finally{p&&p({type:ActionType.JOIN_LOADING,data:!1})}},w=async(e,t)=>{if(m)return;g(!0);let r=null==b?void 0:b.cameras;if(!r||0===(null==r?void 0:r.length)){const e=await(async()=>{const e=[null==d?void 0:d.getCameras()],t=await Promise.all(e);if(t[0]){const e=t[0],r=null==d?void 0:d.getSelectedCameraDevice(),n=null==e?void 0:e.find((e=>e.deviceId===r)),i={cameras:e,cameraItem:n};console.log("-------------device---------------"),console.log(i);let o=MobileCameraType.FRONT;if(n){const e=_[MobileCameraType.BACK].includes(n.deviceName.toLowerCase());o=e?MobileCameraType.BACK:MobileCameraType.FRONT}return y((e=>({cameraType:o}))),S((e=>i)),i}})();e&&(r=null==e?void 0:e.cameras)}const{cameraType:n}=v;if(console.log("switchDevice  ",e,v),r&&"camera"===e){const e=n===MobileCameraType.BACK?MobileCameraType.FRONT:MobileCameraType.BACK;r.sort(((e,t)=>e.deviceName<t.deviceName?-1:e.deviceName>t.deviceName?1:0)),console.log("switchTag  ",e);const t=r.find((t=>{if(_[e].some((e=>t.deviceName.toLowerCase().indexOf(e)>-1)))return t}));(null==t?void 0:t.deviceId)&&(await(null==d?void 0:d.muteLocalVideo(!1)),await(null==d?void 0:d.changeLocalVideo(t.deviceId)),null==d||d.unmuteLocalVideo("",!1).then((t=>{y({cameraType:e})})).catch((e=>{console.log(e)})).finally((()=>{g(!1)})))}g(!1)};return jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:t&&jsxRuntime.exports.jsxs("div",Object.assign({className:`w-full absolute z-20 ${e||""} ${n?"h-full":""}`,onClick:e=>{e.stopPropagation()}},{children:[jsxRuntime.exports.jsxs("div",Object.assign({onClick:e=>{return t=e,void(null==r||r(t));var t},className:"meeting-header w-full bg-zinc-900 absolute"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"absolute flex meeting-header-icons"},{children:(null==s?void 0:s.isVideoOn)&&jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:jsxRuntime.exports.jsx("i",{className:"iconfont icon-white iconyx-tv-filpx",onClick:()=>{w("camera",v.cameraType)}})})})),jsxRuntime.exports.jsxs("div",Object.assign({className:"header-title text-white inline-block",onClick:()=>{i(!n)}},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"meeting-name text-base"},{children:"网易会议"})),jsxRuntime.exports.jsx("i",{className:"iconfont icona-45"})]})),jsxRuntime.exports.jsx("button",Object.assign({className:"exit-btn bg-red-500 text-white rounded h-6 text-xs absolute top-5 right-4 button-ele",onClick:()=>{const e=[{text:"离开会议",key:"leave",onClick:async()=>{await M()}},{text:"结束会议",key:"end",danger:!0,onClick:async()=>{await T()}},{text:"取消",key:"cancel",onClick:async()=>{a(!1)}}];c!==u&&e.splice(1,1),h(e),a(!0)}},{children:c===u?"结束":"离开"}))]})),jsxRuntime.exports.jsx(MeetingInfo,{visible:n,onClose:()=>{i(!1)}}),jsxRuntime.exports.jsx(ActionSheet,{visible:o,actions:f,getContainer:null,onClose:()=>a(!1)})]}))})};var css_248z$7=".dialog-com{background-color:rgba(0,0,0,.5);z-index:9999}.dialog-content{max-height:500px;min-height:60px}.dialog-foot{border-top:1px solid rgba(0,0,80,.05);display:flex;justify-content:space-between;text-align:center}.dialog-foot>span{width:49%}.dialog-cancel{border-right:1px solid rgba(0,0,80,.05);color:#666}.dialog-confirm{color:#007aff}.dialog-title{text-align:center}";styleInject(css_248z$7);const Dialog=({visible:e,ifShowCancel:t=!0,onCancel:r,onConfirm:n,title:i,popupClassName:o,cancelText:a="否",confirmText:s="是",children:c})=>{const[u,l]=react.exports.useState(!1);return react.exports.useEffect((()=>{l(e)}),[e]),jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:u&&jsxRuntime.exports.jsx("div",Object.assign({className:"w-full dialog-com h-full fixed top-0 right-0 left-0 flex items-center justify-center",onClick:e=>{e.stopPropagation()}},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:`dialog-box bg-white rounded-2xl w-10/12 pt-5 ${o||""}`},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"dialog-title text-lg text-black"},{children:i})),jsxRuntime.exports.jsx("div",Object.assign({className:"dialog-content px-4 mt-2 overflow-hidden text-clip"},{children:c})),jsxRuntime.exports.jsxs("div",Object.assign({className:"dialog-foot h-11 leading-10 text-base "},{children:[t&&jsxRuntime.exports.jsx("span",Object.assign({className:"inline-block dialog-cancel",onClick:e=>{r&&r(),e.stopPropagation()}},{children:a})),jsxRuntime.exports.jsx("span",Object.assign({className:"inline-block dialog-confirm",style:{width:t?"49%":"100%"},onClick:e=>{n&&n(),e.stopPropagation()}},{children:s}))]}))]}))}))})};var css_248z$6=".member-list{background-color:rgba(0,0,0,.8);bottom:0;font-size:14px;height:0;overflow:hidden;position:absolute;width:100%;z-index:21}.member-list .iconfont{color:#49494d;font-size:15px;margin-right:3px}.member-list-title{font-size:16px}.member-list.show{height:100%;transition:height .3s;-webkit-transition:height .3s}.member-list-content{background-color:#fff;border-top-left-radius:1rem;border-top-right-radius:1rem;bottom:0;height:0;left:0;position:absolute;right:0;z-index:22}.member-list-content.show{height:91%;transition:height .3s;-webkit-transition:height .3s}.mr10{margin-right:10px}.b-b-1-gray{border-bottom:1px solid #f2f3f5}.line-height-3{line-height:3rem}.member-scroll{height:calc(100% - 110px)}.member-scroll-forhost{height:calc(100% - 235px)}.member-scroll .icon{height:1.23rem;margin-left:.75rem;width:1.25rem}.member-info{align-items:center;color:#333;display:flex;height:100%;width:calc(100% - 4.5rem)}.member-info .member-tag{color:#999;font-size:12px}.style{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.entireOperation span{color:#337eff;display:inline-block;width:49%}.entireOperation span:nth-child(odd){border-right:1px solid #f2f3f5}.action-sheet .adm-action-sheet-button-item-name{color:#337eff}.action-sheet .adm-action-sheet-cancel{font-weight:500}.change-name{height:70px;text-align:left}.input-ele{background-color:#f3f4f6;border:0;border-radius:1rem;height:2.25rem;outline:none;padding:0 1rem;width:90%}.change-name-error .input-ele{border:1px solid red}.change-name-error{color:red}.change-name-error>span{display:block;margin:5px 0}";styleInject(css_248z$6);const MemberListUI=({visible:e=!1,onClose:t})=>{const[r,n]=react.exports.useState(!1),{meetingInfo:{localMember:i,hostUuid:o,myUuid:a},memberList:s}=react.exports.useContext(MeetingInfoContext),{neMeeting:c}=react.exports.useContext(GlobalContext),[u,l]=react.exports.useState(!1),[d,p]=react.exports.useState(),[f,h]=react.exports.useState([]),[m,g]=react.exports.useState(!1),[v,y]=react.exports.useState(!1),[b,S]=react.exports.useState(""),[_,M]=react.exports.useState("");react.exports.useEffect((()=>{n(e)}),[e]);const T=e=>{t&&t(),e.stopPropagation()},w=react.exports.useCallback(((e,t)=>{console.log(e);const r=[];[{id:memberAction.modifyMeetingNickName,name:"改名",isShow:e.uuid===(null==i?void 0:i.uuid)}].map((t=>{t.isShow&&(t.id===memberAction.modifyMeetingNickName?r.push({text:t.name,key:t.id,onClick:async()=>{S(null==i?void 0:i.name),l(!1),y(!0)}}):r.push({text:t.name,key:t.id,onClick:async()=>{x(e,null==e?void 0:e.uuid,t.id)}}))})),r.length>0&&(p(e),h(r),l(!0),console.log("diplayBtns ",r))}),[i]),x=async(e,t,r)=>{await(null==c?void 0:c.sendMemberControl(r,e.uuid))},I=(e,t)=>{const r=[];return t===Role.host&&r.push("主持人"),t===Role.coHost&&r.push("联席主持人"),e===a&&r.push("我"),"("+r.join("，")+")"},E=react.exports.useMemo((()=>{console.log(s,"filteredMemberList");return s.filter((e=>e.name.indexOf(_)>-1))}),[s,_,null==s?void 0:s.length]);return jsxRuntime.exports.jsxs(jsxRuntime.exports.Fragment,{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"member-list "+(r?"show":""),onClick:e=>{T(e)}},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"member-list-content "+(r?"show":""),onClick:e=>{e.stopPropagation()}},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"line-height-3 text-center h-12 b-b-1-gray font-medium"},{children:[jsxRuntime.exports.jsxs("span",Object.assign({className:"member-list-title"},{children:["参会者(",null==s?void 0:s.length,")"]})),jsxRuntime.exports.jsx("i",{onClick:e=>{T(e)},className:"iconfont iconyx-pc-closex absolute right-4"})]})),jsxRuntime.exports.jsx("div",Object.assign({className:"py-2.5 px-5 b-b-1-gray"},{children:jsxRuntime.exports.jsx("input",{className:"input-ele",placeholder:"搜索成员",value:_,onChange:e=>{var t;M(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)}})})),jsxRuntime.exports.jsx("div",Object.assign({className:`member-scroll text-left overflow-y-scroll ${["host","cohost"].includes(null==i?void 0:i.role)&&"member-scroll-forhost"}`},{children:E.map(((e,t)=>jsxRuntime.exports.jsxs("div",Object.assign({className:"b-b-1-gray h-12 px-5 align-middle relative",onClick:()=>{w(e,(null==i?void 0:i.uuid)===o)}},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"member-info"},{children:(null==e?void 0:e.role)===Role.coHost||(null==e?void 0:e.role)===Role.host||(null==e?void 0:e.uuid)===a?jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"truncate"},{children:[null==e?void 0:e.name,jsxRuntime.exports.jsx("div",Object.assign({className:"member-tag"},{children:I(e.uuid,e.role)}))]}))}):jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:jsxRuntime.exports.jsx("span",Object.assign({className:"line-height-3 inline-block w-full truncate"},{children:null==e?void 0:e.name}))})})),jsxRuntime.exports.jsxs("div",Object.assign({className:"inline-block absolute line-height-3 right-3 top-0"},{children:[(null==e?void 0:e.isSharingScreen)?jsxRuntime.exports.jsx("i",{className:"iconfont icon-bule icongongxiangpingmu"}):"",(null==e?void 0:e.isVideoOn)?jsxRuntime.exports.jsx("i",{className:"iconfont iconyx-tv-video-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red iconfont iconyx-tv-video-offx"}),(null==e?void 0:e.isAudioOn)?jsxRuntime.exports.jsx("i",{className:"iconfont iconyx-tv-voice-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red iconfont iconyx-tv-voice-offx"})]}))]}),(null==e?void 0:e.uuid)+t)))}))]}))})),jsxRuntime.exports.jsx(ActionSheet,{extra:null==d?void 0:d.name,cancelText:"取消",visible:u,actions:f,getContainer:null,onClose:()=>l(!1),popupClassName:"action-sheet"}),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:m,title:"移交主持人",onCancel:()=>{g(!1)},onConfirm:()=>{}},{children:"确认移交主持人权限给小A？"})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:v,title:"改名",cancelText:"取消",confirmText:"确认",onCancel:()=>{y(!1)},onConfirm:async()=>{b&&(null==c||c.modifyNickName({nickName:b}).then((()=>{y(!1),Toast.success("昵称修改成功")})).catch((e=>{Toast.fail("failure"===(null==e?void 0:e.message)?"请求失败":null==e?void 0:e.message)})))}},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:`change-name ${!b&&"change-name-error"}`},{children:[jsxRuntime.exports.jsx("input",{className:"input-ele",value:b,placeholder:"输入名称",maxLength:20,required:!0,onChange:e=>{S(e.target.value)}}),!b&&jsxRuntime.exports.jsx("span",{children:"请输入昵称"})]}))}))]})};var css_248z$5=".meeting-controller{background-color:#292933;border-top:.5px solid #666;font-size:10px}.meeting-controller .controller-item{flex:1}.meeting-controller .member-count{left:62%;top:-2px}.meeting-controller .icon-tool{font-size:1.5rem;margin:0 auto .125rem}.meeting-controller .icon-blue{color:#337eff}.meeting-controller .unread-count{background-color:#fe3b30;border-radius:50%;box-sizing:border-box;color:#fff;font-size:10px;height:18px;line-height:18px;min-width:18px;padding:0 3px;position:absolute;right:15%;text-align:center;top:0;vertical-align:middle}.meeting-controller .hands-up-tip{background:#337eff;border-radius:5px;left:50%;padding-bottom:2px;position:absolute;top:-3rem;transform:translateX(-50%) scale(.75);width:3rem}.meeting-controller .hands-arrow{border:8px solid transparent;border-top-color:#337eff;bottom:-16px;height:0;left:50%;position:absolute;transform:translateX(-50%);width:0}.meeting-controller .hands-arrow-text{display:inline-block}.meeting-controller .hands-icon{color:#fff;display:block;font-size:20px;height:1.5rem;margin:3px auto 0;width:1.5rem}";styleInject(css_248z$5);var css_248z$4=".msg-wrap{margin-bottom:20px}.msg-wrap .msg-content-other{justify-content:flex-start}.msg-wrap .msg-content-wrap{display:flex}.msg-wrap .msg-content-self{justify-content:flex-end}.msg-wrap .msg-text{word-wrap:break-word;border-radius:8px;font-size:14px;min-height:12px;overflow:hidden;padding:5px 6px;text-align:left}.msg-wrap .msg-text-self{background:#cce1ff}.msg-wrap .msg-text-other{background:#f2f3f5}.msg-wrap .user-icon{border-radius:50%;height:16px;width:16px}.msg-wrap .nickname{color:#333;display:inline-block;font-size:12px;line-height:12px;margin-right:5px;max-width:115px;overflow:hidden;padding:0 2px;text-overflow:ellipsis;white-space:nowrap}.msg-wrap .date{color:#999;font-size:12px;line-height:12px}.msg-wrap .msg-type{color:#337eff;font-size:12px;line-height:12px}.msg-wrap .private-mag{color:#999}.msg-wrap .msg-info{align-items:center;display:flex;margin-bottom:6px}.msg-wrap .msg-info-self{justify-content:flex-end}.msg-wrap .msg-info-other{justify-content:flex-start}.msg-wrap .msg-text-error{background-color:#ff69b433}.msg-wrap .msg-item{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.msg-wrap .resend-icon{background-color:#ff4d4f;border-radius:50%;color:#fff;display:inline-block;height:16px;margin-right:10px;text-align:center;width:16px}";styleInject(css_248z$4);const NEChatRoomUI=({msgs:e,resendMsg:t})=>{const[r,n]=react.exports.useState(!1);return jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-ui"},{children:[jsxRuntime.exports.jsx(Dialog,Object.assign({visible:r,title:"",onCancel:()=>{n(!1)},onConfirm:function(){null==t||t(),n(!1)}},{children:"确认重发此条消息？"})),e&&e.map(((e,t)=>jsxRuntime.exports.jsx("div",{children:(null==e?void 0:e.isMe)?jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-wrap msg-wrap-self"},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-info msg-info-self"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"nickname"},{children:e.fromNick})),jsxRuntime.exports.jsx("span",Object.assign({className:"date"},{children:e.time}))]})),jsxRuntime.exports.jsx("div",Object.assign({className:"msg-content-wrap msg-content-self"},{children:"text"===e.type?jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-item"},{children:["fail"===e.status?jsxRuntime.exports.jsx("i",{onClick:()=>{n(!0)},className:"iconfont iconSubtract icon-red mr10"}):"",jsxRuntime.exports.jsx("span",Object.assign({className:"msg-text msg-text-self"},{children:e.text}))]})):jsxRuntime.exports.jsx("span",Object.assign({className:"msg-text msg-text-self msg-text-error"},{children:"暂不支持该消息类型"}))}))]})):jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-wrap msg-wrap-other"},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-info msg-info-other"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"nickname"},{children:e.fromNick})),jsxRuntime.exports.jsx("span",Object.assign({className:"date"},{children:e.time}))]})),jsxRuntime.exports.jsx("div",Object.assign({className:"msg-content-wrap msg-content-other"},{children:"text"===e.type?jsxRuntime.exports.jsx("span",Object.assign({className:"msg-text msg-text-other"},{children:e.text})):jsxRuntime.exports.jsx("span",Object.assign({className:"msg-text msg-text-other msg-text-error"},{children:"暂不支持该消息类型"}))}))]}))},t)))]}))};function handleRecMsgService(e){let t=0;return{msgs:e=e.filter((e=>("notification"!==e.type&&(t+=1),"notification"!==e.type||"notification"===e.type&&e.text))).map((e=>e=formatMsg(e))),unReadMsgsCount:t}}const handleMap={group:(e,t)=>(console.log("params",t),e.sendGroupTextMessage(t.toAccids,t.text).then((e=>e.data)).catch((e=>e))),orientation:(e,t)=>(console.log("params",t),e.sendBroadcastTextMessage(t.text).then((e=>e.data)).catch((e=>e))),resend:(e,t)=>(console.log("params",t),e.resendTextMessage(t.text,t.idClient,t.toAccids).then((e=>(console.log(e,"resend success"),e.data))).catch((e=>(console.log(e,"resend err"),e))))};function handleSendMsgService(e,t){return handleMap[t.msgType](e,t)}function formatMsg(e,t){return e.time=formatDate(e.time,"yyyy-MM-dd hh:mm:ss"),t&&(e.isMe=e.from===t),e}var css_248z$3=".ne-meeting-chatroom{background-color:rgba(0,0,0,.5);bottom:0;font-size:15px;height:0;left:0;overflow:hidden;position:absolute;right:0;width:100%;z-index:20}.ne-meeting-chatroom.show{height:100%}.ne-meeting-chatroom .ne-chatroom-body{background-color:#fff;bottom:0;height:0;left:0;position:absolute;right:0;z-index:21}.ne-meeting-chatroom .ne-chatroom-body.show{height:100%;transition:height .3s;-webkit-transition:height .3s}.ne-chatroom-header{font-weight:500;height:3rem;line-height:3rem;text-align:center}.ne-chatroom-header .title{font-size:1rem}.chatroom-icon-close{color:#337eff;font-size:1rem;left:1rem;position:absolute;top:0}.ne-chatroom-content{height:calc(100% - 130px);overflow-y:scroll;padding:16px}.ne-chatroom-footer{background-color:#fff;border-top:1px solid #e1e3e6;bottom:0;box-sizing:border-box;display:flex;height:56px;justify-content:space-between;left:0;line-height:56px;padding:8px 10px calc(8px + env(safe-area-inset-bottom));position:absolute;right:0;z-index:22}.ne-chatroom-input{background:#f2f3f5;border:0;border-radius:1rem;height:40px;line-height:40px;outline:none;padding:0 12px;width:100%}.ne-chatroom-btn{align-self:center;background-color:#4d8eff;border-radius:14px;color:#fff;font-size:14px;height:28px;line-height:28px;margin-left:8px;min-width:52px}";styleInject(css_248z$3);const NEChatRoom=({visible:e=!1,onClose:t,unReadChange:r,receiveMsg:n})=>{const{neMeeting:i}=react.exports.useContext(GlobalContext),{meetingInfo:o,memberList:a}=react.exports.useContext(MeetingInfoContext),[s,c]=react.exports.useState(!1),[u,l]=react.exports.useState(0),[d,p]=react.exports.useState(""),[f,h]=react.exports.useState(),[m,g]=react.exports.useState([]),v=o.localMember,y=react.exports.useRef(null);react.exports.useEffect((()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)}),[m]);const b={msgs:m,resendMsg:function(){if(console.log(f,"errorMsg"),!f)return;_({idClient:null==f?void 0:f.idClient,text:null==f?void 0:f.text,type:null==f?void 0:f.type,msgType:"resend",toAccids:[]})}};react.exports.useEffect((()=>{n&&function(e){console.log("--------onReceiveMsgs---------",e);const t=e,r=t[0].attach&&t[0].attach.type,n=["memberExit","memberEnter","kickMember","updateChatroom"];(function(e){const t=[...m],{msgs:r,unReadMsgsCount:n}=handleRecMsgService(e);console.log("--------unReadMsgs---------------",r,n),l(n+u);const i=[...t,...r];g(i)})(t),r&&n.includes(r)&&M()}(n)}),[n]),react.exports.useEffect((()=>{c(e),e?(null==r||r(0),l(0)):null==r||r(u)}),[e,u,r]),react.exports.useEffect((()=>{console.log(v,a,"memberList"),function(){if(null==i?void 0:i.chatController){i.chatController.joinChatroom().then((e=>{console.log("joinChatroom success"),M()})).catch((e=>{console.error("joinChatroom err",e)}))}}()}),[]);const S=()=>{null==t||t()};function _(e){handleSendMsgService(null==i?void 0:i.chatController,e).then((e=>{e=formatMsg(e,v.uuid);const t=[...m];if(e.resend&&"success"===e.status){const r=t.findIndex((t=>t.idClient===e.idClient));return r>-1&&(t[r]=e),void g(t)}if(!e.resend){if("fail"===e.status||!e.status)return e.fromNick=v.name||"",h(e),void Toast.fail("发送失败，请重试");g([...t,e]),h(e)}p("")})).catch((e=>{console.error(e)}))}function M(){if(!(null==i?void 0:i.chatController))return void console.error("not init chatroom");const e=v.uuid;let t=a;return t=t.filter((t=>t.isInChatroom&&t.uuid!==e)),console.log("---------chatroom members------------",t),t}return jsxRuntime.exports.jsx("div",Object.assign({className:"ne-meeting-chatroom "+(s?"show":""),onClick:S},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-body "+(s?"show":""),onClick:e=>{e.stopPropagation()}},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-header"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"chatroom-icon-close",onClick:S},{children:"关闭"})),jsxRuntime.exports.jsx("span",Object.assign({className:"title"},{children:"聊天"}))]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-content",ref:y},{children:[jsxRuntime.exports.jsx(NEChatRoomUI,Object.assign({},b)),jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-footer"},{children:[jsxRuntime.exports.jsx("input",{value:d,className:"ne-chatroom-input",placeholder:"请输入消息...",onChange:e=>{p(e.target.value)}}),jsxRuntime.exports.jsx("span",Object.assign({className:"ne-chatroom-btn",onClick:function(){d&&d.trim()?(y.current&&(y.current.scrollTop=y.current.scrollHeight),_({text:d,type:"text",msgType:"orientation",toAccids:[]})):Toast.fail("无法发送内容为空的消息")}},{children:"发送"}))]}))]}))]}))}))},MeetingController=({className:e="",visible:t=!1,onClick:r,onRef:n})=>{const{meetingInfo:{localMember:i,audioOff:o,videoOff:a,screenUuid:s},memberList:c,dispatch:u}=react.exports.useContext(MeetingInfoContext),{neMeeting:l,eventEmitter:d}=react.exports.useContext(GlobalContext),[p,f]=react.exports.useState(!1),[h,m]=react.exports.useState(!1),[g,v]=react.exports.useState(0),[y,b]=react.exports.useState();react.exports.useImperativeHandle(n,(()=>({checkNeedHandsUp:E}))),react.exports.useEffect((()=>(console.log(i,c,"memberList"),null==d||d.on(EventType.ReceiveChatroomMessages,(e=>{b(e)})),null==d||d.on("needAudioHandsUp",(e=>{T(e)})),null==d||d.on("needVideoHandsUp",(e=>{_(e)})),()=>{null==d||d.off(EventType.ReceiveChatroomMessages),null==d||d.off("needAudioHandsUp"),null==d||d.off("needVideoHandsUp")})),[]);const[S,_]=react.exports.useState(!1),[M,T]=react.exports.useState(!1),[w,x]=react.exports.useState(!1),I=react.exports.useMemo((()=>!!s&&s===i.uuid),[s]),E=(e,t)=>{if(!t)return void("audio"===e?A(0):k(0));const r=i.role===Role.host||i.role===Role.coHost;"video"===e?a!==AttendeeOffType.offNotAllowSelfOn||r||I?k(1):i.isHandsUp?Toast.info("您已举手，等待主持人处理"):_(!0):"audio"===e&&(o!==AttendeeOffType.offNotAllowSelfOn||r||I?A(1):i.isHandsUp?Toast.info("您已举手，等待主持人处理"):T(!0))},A=async e=>{console.log("操作本人音频 ",e);try{switch(e){case 1:await(null==l?void 0:l.unmuteLocalAudio());break;case 0:await(null==l?void 0:l.muteLocalAudio())}}catch(e){console.log("operateLocalAudio ",e)}},C=e=>{null==l||l.sendMemberControl(e,i.uuid).then((()=>{e===memberAction.handsUp?Toast.info("举手成功，等待主持人处理"):Toast.info("取消举手成功"),u&&u({type:ActionType.UPDATE_MEMBER,data:{uuid:i.uuid,member:{isHandsUp:e===memberAction.handsUp}}})})).finally((()=>{e===memberAction.handsUp?(_(!1),T(!1)):x(!1)}))},k=async e=>{console.log("操作本人视频 ",e);try{switch(e){case 1:await(null==l?void 0:l.unmuteLocalVideo());break;case 0:await(null==l?void 0:l.muteLocalVideo())}}catch(e){console.log("operateLocalVideo ",e)}};return jsxRuntime.exports.jsxs(jsxRuntime.exports.Fragment,{children:[t&&jsxRuntime.exports.jsxs("div",Object.assign({className:`w-full meeting-controller absolute z-10 bottom-0 flex h-14 justify-around pt-1.5 text-white ${e||""}`,onClick:e=>{return t=e,void(null==r||r(t));var t}},{children:[jsxRuntime.exports.jsxs("div",Object.assign({onClick:()=>{E("audio",!i.isAudioOn)},className:"controller-item"},{children:[i.isAudioOn?jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconyx-tv-voice-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red icon-tool iconfont iconyx-tv-voice-offx"}),jsxRuntime.exports.jsx("div",{children:i.isAudioOn?"静音":"取消静音"})]})),jsxRuntime.exports.jsxs("div",Object.assign({onClick:()=>{E("video",!i.isVideoOn)},className:"controller-item"},{children:[i.isVideoOn?jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconyx-tv-video-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red icon-tool iconfont iconyx-tv-video-offx"}),jsxRuntime.exports.jsx("div",{children:i.isVideoOn?"停止视频":"开启视频"})]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"relative controller-item"},{children:[i.isHandsUp&&jsxRuntime.exports.jsxs("span",Object.assign({className:"hands-up-tip",onClick:()=>{x(!0)}},{children:[jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconraisehands1x"}),jsxRuntime.exports.jsx("span",{className:"hands-arrow"}),jsxRuntime.exports.jsx("span",Object.assign({className:"hands-arrow-text"},{children:"举手中"}))]})),jsxRuntime.exports.jsxs("div",Object.assign({onClick:()=>{f(!p)}},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"absolute member-count"},{children:(null==c?void 0:c.length)>99?"99+":null==c?void 0:c.length})),jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconyx-tv-attendeex"}),jsxRuntime.exports.jsx("div",{children:i.role===Role.host||i.role===Role.coHost?"管理参会者":"参会者"})]}))]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"relative controller-item",onClick:()=>{m(!0),v(0)}},{children:[g?jsxRuntime.exports.jsx("div",Object.assign({className:"unread-count"},{children:g>99?"99+":g})):"",jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconshipin-liaotian"}),jsxRuntime.exports.jsx("div",{children:"聊天"})]}))]})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:S,title:"提示",onCancel:()=>{_(!1)},onConfirm:()=>{C(memberAction.handsUp)}},{children:jsxRuntime.exports.jsx("div",Object.assign({style:{color:"#000",fontSize:"13px"}},{children:"主持人已将全体关闭视频，您可以举手申请发言"}))})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:M,title:"提示",onCancel:()=>{T(!1)},onConfirm:()=>{C(memberAction.handsUp)}},{children:jsxRuntime.exports.jsx("div",Object.assign({style:{color:"#000",fontSize:"13px"}},{children:"主持人已将全体关闭音频，您可以举手申请发言"}))})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:w,title:"提示",onCancel:()=>{x(!1)},onConfirm:()=>{C(memberAction.handsDown)}},{children:jsxRuntime.exports.jsx("div",Object.assign({style:{color:"#000",fontSize:"13px"}},{children:"确认取消举手申请吗？"}))})),jsxRuntime.exports.jsx(NEChatRoom,{visible:h,onClose:()=>m(!1),unReadChange:e=>v(e),receiveMsg:y}),jsxRuntime.exports.jsx(MemberListUI,{visible:p,onClose:()=>{f(!1)}})]})};var css_248z$2=".App{height:100%;text-align:center}.App-header{align-items:center;background-color:#282c34;color:#fff;display:flex;flex-direction:column;font-size:calc(10px + 2vmin);justify-content:center;min-height:100vh}.meeting-loading{background:#292932;height:100vh;margin:auto;padding-top:242px;position:relative;text-align:center;width:100vw;z-index:510}.meeting-loading-text{color:#fff;font-size:14px}.meeting-loading-img{height:100px;width:100px}.icon-white{color:#fff!important}.icon-red{color:#fe3b30!important}.icon-bule{color:#337eff!important}";styleInject(css_248z$2);var css_248z$1='@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/c/font_2183559_tkkdsglaz4q.woff2?t=1659448086418) format("woff2"),url(//at.alicdn.com/t/c/font_2183559_tkkdsglaz4q.woff?t=1659448086418) format("woff"),url(//at.alicdn.com/t/c/font_2183559_tkkdsglaz4q.ttf?t=1659448086418) format("truetype")}.iconfont{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:iconfont!important;font-size:14px;font-style:normal}.iconxiangjifanzhuan1:before{content:"\\e600"}.iconguzhang:before{content:"\\e62c"}.iconxiangmu1:before{content:"\\e62b"}.icona-Frame2:before{content:"\\e6b9"}.iconjinggao:before{content:"\\e601"}.iconfsfds:before{content:"\\e69c"}.icona-45:before{content:"\\e69d"}.iconSIP:before{content:"\\e68b"}.iconSIP-copy:before{content:"\\e83e"}.iconzhuanshipin:before{content:"\\e67c"}.iconzhuanyuyin:before{content:"\\e67b"}.iconjiantou-zuo:before{content:"\\e675"}.iconbeijing:before{content:"\\e676"}.iconjiantou-shang:before{content:"\\e677"}.iconjiantou-you:before{content:"\\e678"}.iconxunirenkaiqi:before{content:"\\e679"}.iconxunirenguanbi:before{content:"\\e67a"}.iconshipin-shexiangtou:before{content:"\\e621"}.iconshipin-xianshi:before{content:"\\e622"}.iconshipin-maikefeng:before{content:"\\e623"}.iconshipin-shexiangtou-jinyong:before{content:"\\e624"}.iconshipin-gongxiangpingmu:before{content:"\\e625"}.iconyinliang2:before{content:"\\e626"}.iconyinliang1:before{content:"\\e627"}.iconshipin-liaotian:before{content:"\\e628"}.iconshipin-yincang:before{content:"\\e629"}.iconshipin-maikefeng-jinyong:before{content:"\\e62a"}.iconchuansongtupian:before{content:"\\e617"}.iconchuansongfujian:before{content:"\\e618"}.iconxiaochengxu:before{content:"\\e824"}.iconduigou:before{content:"\\e807"}.iconduorenshipin:before{content:"\\e808"}.iconshexiangtouguan:before{content:"\\e809"}.icongeren2:before{content:"\\e80b"}.icondianhua:before{content:"\\e80c"}.iconshexiangtoukai:before{content:"\\e80d"}.iconchahao:before{content:"\\e80e"}.icongeren1:before{content:"\\e80f"}.iconyingyong2:before{content:"\\e810"}.iconyingyong1:before{content:"\\e811"}.icongengduo:before{content:"\\e812"}.iconshezhi:before{content:"\\e813"}.iconfangda:before{content:"\\e814"}.iconsuoxiao:before{content:"\\e815"}.iconAndroid:before{content:"\\e816"}.iconmeiyan:before{content:"\\e81d"}.iconiOS:before{content:"\\e81e"}.iconxinhao:before{content:"\\e81f"}.iconshuju:before{content:"\\e820"}.iconWindows:before{content:"\\e821"}.iconxiangjifanzhuan:before{content:"\\e822"}.iconmacOS:before{content:"\\e823"}.iconyasuobao:before{content:"\\e619"}.iconqitawenjian1:before{content:"\\e61b"}.iconExcel:before{content:"\\e61c"}.iconWord:before{content:"\\e61d"}.iconSubtract:before{content:"\\e61e"}.iconPDF:before{content:"\\e61f"}.iconPPT:before{content:"\\e620"}.iconxiazai:before{content:"\\e61a"}.iconshangchuantupian:before{content:"\\e60c"}.iconbendiluzhi:before{content:"\\e60d"}.iconfengxiantishi:before{content:"\\e60e"}.iconshishipaizhao:before{content:"\\e60f"}.icongongxiangpingmu:before{content:"\\e610"}.icontonghuaguaqi:before{content:"\\e611"}.iconshangchuanfujian:before{content:"\\e612"}.iconkaiqimeiyan:before{content:"\\e613"}.iconzhuanjie:before{content:"\\e614"}.iconyaoqingzuoxi:before{content:"\\e615"}.icongongxiangwenjian:before{content:"\\e616"}.iconmorentouxiang:before{content:"\\e60b"}.iconqitawenjian:before{content:"\\e608"}.iconbaiban-fuzhi:before{content:"\\e605"}.iconbaiban-wenjianjia:before{content:"\\e606"}.iconyx-baiban:before{content:"\\e603"}.iconcross-y1x:before{content:"\\e830"}.iconhook-y1x:before{content:"\\e831"}.iconwarning-y1x:before{content:"\\e832"}.iconproblem1x:before{content:"\\e833"}.icondianzanx:before{content:"\\e754"}.icondianchapingx:before{content:"\\e759"}.iconhappy1x:before{content:"\\e83d"}.iconhang-up-y1x:before{content:"\\e82f"}.iconyx-input-clearx:before{content:"\\e789"}.iconfd-editx:before{content:"\\e78b"}.iconyx-tv-settingx1:before{content:"\\e78c"}.iconpassword-displayx:before{content:"\\e78d"}.iconpassword-hidex:before{content:"\\e78e"}.iconyx-pc-closex:before{content:"\\e790"}.iconyx-pc-maximizex:before{content:"\\e791"}.iconyx-pc-narrowx:before{content:"\\e792"}.iconyx-pc-restorex:before{content:"\\e796"}.iconyx-allowx:before{content:"\\e7a5"}.iconyx-tv-layout-bx:before{content:"\\e7b2"}.iconyx-tv-layout-ax:before{content:"\\e7b3"}.iconyx-tv-sharescreen1x:before{content:"\\e7b9"}.iconsound-soft1x:before{content:"\\e7bf"}.iconsound-loud1x:before{content:"\\e7c0"}.iconvideo-shrink-a1x:before{content:"\\e7c1"}.iconvideo-fullscreen-a1x:before{content:"\\e7c2"}.iconsignal1x:before{content:"\\e7d2"}.iconcheck-line-regular1x:before{content:"\\e7d3"}.iconsound-medium:before{content:"\\e7d4"}.iconsound-mute:before{content:"\\e7d5"}.iconsound-loud:before{content:"\\e7d6"}.iconyx-tv-more1x:before{content:"\\e7fd"}.iconcalendar1x:before{content:"\\e7fe"}.icondate-line:before{content:"\\e683"}.icontriangle-up1x:before{content:"\\e7f3"}.icontriangle-down1x:before{content:"\\e7f4"}.iconearpiece1x:before{content:"\\e7ff"}.iconamplify:before{content:"\\e800"}.iconheadset1x:before{content:"\\e801"}.iconarrow-double-line-regular:before{content:"\\e720"}.iconarrow-line-regular:before{content:"\\e724"}.iconyx-tv-duankai1x:before{content:"\\e607"}.iconcertification1x:before{content:"\\e817"}.iconcopy1x:before{content:"\\e818"}.iconnarrow-line1x:before{content:"\\e819"}.iconsearch2-line1x:before{content:"\\e81a"}.iconcross:before{content:"\\e80a"}.iconraisehands1x:before{content:"\\e81b"}.iconbeauty1x:before{content:"\\e81c"}.iconyx-tv-filpx-copy:before{content:"\\e83f"}.iconyx-tv-createx:before{content:"\\e75e"}.iconyx-tv-voice-offx:before{content:"\\e761"}.iconyx-tv-voice-onx:before{content:"\\e763"}.iconyx-tv-video-onx:before{content:"\\e760"}.iconyx-tv-video-offx:before{content:"\\e762"}.iconyx-tv-invitex:before{content:"\\e764"}.iconyx-tv-attendeex:before{content:"\\e765"}.iconyx-tv-joinx:before{content:"\\e766"}.iconyx-tv-likaix:before{content:"\\e767"}.iconyx-tv-duankaix:before{content:"\\e768"}.iconyx-tv-jieshux:before{content:"\\e769"}.iconyx-tv-computerx:before{content:"\\e76a"}.iconyx-tv-tvx:before{content:"\\e76b"}.iconyx-tv-cancelx:before{content:"\\e76c"}.iconyx-tv-settingx:before{content:"\\e76d"}.iconyx-tv-filpx:before{content:"\\e76e"}.iconyx-tv-removex:before{content:"\\e770"}.iconyx-pc-successx:before{content:"\\e76f"}.iconroom-flowx:before{content:"\\e77f"}.iconanchor-flowx:before{content:"\\e780"}.iconyx-returnx:before{content:"\\e788"}';styleInject(css_248z$1);var browser={exports:{}},s=1e3,m=60*s,h=60*m,d=24*h,w=7*d,y=365.25*d,ms=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return parse(e);if("number"===r&&isFinite(e))return t.long?fmtLong(e):fmtShort(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*y;case"weeks":case"week":case"w":return r*w;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*h;case"minutes":case"minute":case"mins":case"min":case"m":return r*m;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function fmtShort(e){var t=Math.abs(e);return t>=d?Math.round(e/d)+"d":t>=h?Math.round(e/h)+"h":t>=m?Math.round(e/m)+"m":t>=s?Math.round(e/s)+"s":e+"ms"}function fmtLong(e){var t=Math.abs(e);return t>=d?plural(e,t,d,"day"):t>=h?plural(e,t,h,"hour"):t>=m?plural(e,t,m,"minute"):t>=s?plural(e,t,s,"second"):e+" ms"}function plural(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}function setup(e){function t(e){let n,i,o,a=null;function s(...e){if(!s.enabled)return;const r=s,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";a++;const o=t.formatters[i];if("function"==typeof o){const t=e[a];n=o.call(r,t),e.splice(a,1),a--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{a=e}}),"function"==typeof t.init&&t.init(s),s}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=ms,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}var common=setup;!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=common(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(browser,browser.exports);var debug=browser.exports;debug.formatters.t=()=>`[${formatDate(new Date,"yyyy-MM-dd hh:mm:ss")}]`;const APP_NAME="NeMeeting";class Logger{constructor(e,t){Object.defineProperty(this,"_debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_warn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e?(this._debug=debug(e),this._warn=debug(`${e}:WARN`),this._error=debug(`${e}:ERROR:`)):(this._debug=debug(APP_NAME),this._warn=debug(`${APP_NAME}:WARN`),this._error=debug(`${APP_NAME}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console),t&&(this._debug.enabled=!0,this._warn.enabled=!0,this._error.enabled=!0)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}const logger$1=new Logger("Meeting-NeMeeting",!0);function updateMeetingService(e,t){const r=null==e?void 0:e.getMeetingInfo();console.log("获取会议信息",r),r&&t({type:ActionType.SET_MEETING,data:r})}class NEMeetingService{constructor(e){Object.defineProperty(this,"roomContext",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rtcController",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"chatController",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"whiteboardController",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"previewController",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isUnMutedAudio",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isUnMutedVideo",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_isAnonymous",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_isLoginedByAccount",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_meetingStatus",{enumerable:!0,configurable:!0,writable:!0,value:"unlogin"}),Object.defineProperty(this,"roomService",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"authService",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"messageService",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_roomkit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_eventEmitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_userUuid",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_appKey",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_token",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_meetingServerDomain",{enumerable:!0,configurable:!0,writable:!0,value:"https://roomkit.netease.im"}),Object.defineProperty(this,"_privateMeetingNum",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_meetingInfo",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_meetingType",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_isReuseIM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this._roomkit=e.roomkit,this._eventEmitter=e.eventEmitter,this._request=this.createRequest()}get meetingId(){return this._meetingInfo.meetingNum}init(e){var t;this._appKey=e.appKey,e.meetingServerDomain&&(this._meetingServerDomain=e.meetingServerDomain),this._isReuseIM=!!e.im,this._roomkit.initialize({appKey:this._appKey,serverConfig:{roomKitServerConfig:{roomServer:this._meetingServerDomain},imServerConfig:e.imPrivateConf,rtcServerConfig:e.neRtcServerAddresses,whiteboardServerConfig:e.whiteboardConfig},im:e.im}),this._request=this.createRequest(),this.authService=this._roomkit.authService,this.roomService=this._roomkit.roomService,this.previewController=null===(t=this.roomService.getPreviewRoomContext())||void 0===t?void 0:t.previewController,this.messageService=this._roomkit.messageChannelService,this.messageService.addMessageChannelListener({onReceiveCustomMessage:e=>{if(console.log("onReceiveCustomMessage",e),99!==e.commandId)return;const t=e.data.body;"[object String]"==Object.prototype.toString.call(t)&&(e.data.body=JSON.parse(t)),this._eventEmitter.emit(EventType.ReceivePassThroughMessage,e)}})}async login(e){try{const{username:t,password:r}=e;if(1===e.loginType){this._userUuid=e.accountId,this._token=e.accountToken,this.authService&&await this.authService.login(e.accountId,e.accountToken);const t=await this._request.get(`/scene/meeting/${this._appKey}/v1/account/info`);this._privateMeetingNum=t.privateMeetingNum}else{const e=await this._request.post(`/scene/meeting/${this._appKey}/v1/login/${t}`,{password:Md5_1.hashStr(r+"@yiyong.im")});this._userUuid=e.userUuid,this._token=e.userToken,this._privateMeetingNum=e.privateMeetingNum,this.authService&&await this.authService.login(e.userUuid,e.userToken)}return void(this._isLoginedByAccount=!0)}catch(e){return this._isLoginedByAccount=!1,Promise.reject(e)}}async create(e){try{const{meetingId:t,password:r,subject:n,roleBinds:i,noSip:o}=e;this.isUnMutedAudio=1==e.audio,this.isUnMutedVideo=1==e.video,this._meetingType=e.meetingId;const a=await this._request.put(`/scene/meeting/${this._appKey}/v1/create/${t}`,{password:r,subject:n,roleBinds:i,roomConfigId:40,roomConfig:{resource:{rtc:!0,chatroom:!e.nochat,whiteboard:!0,record:!e.noCloudRecord,sip:void 0!==o&&!o}},roomProperties:{cloudRecord:{mode:0,videoEnable:!0,audioEnable:!0},extraData:{value:e.extraData},lock:{value:0},audioOff:{value:(e.attendeeAudioOff?AttendeeOffType.offNotAllowSelfOn:AttendeeOffType.disable)+`_${(new Date).getTime()}`},videoOff:{value:(e.attendeeVideoOff?AttendeeOffType.offNotAllowSelfOn:AttendeeOffType.disable)+`_${(new Date).getTime()}`}}});if(this._meetingInfo=a,await this._joinRoomkit({role:"host",roomUuid:a.roomUuid,nickname:e.nickName,initialProperties:{tag:{value:e.memberTag}}}),this._addRoomListener(),e.videoProfile){const{resolution:t,frameRate:r}=e.videoProfile;await this.setVideoProfile(t,r)}this.rtcController&&await this.rtcController.joinRtcChannel(),console.log("create meeting ",a),this._meetingStatus="created",this._meetingStatus="joined"}catch(e){return 3100===e.code?this._meetingType=2:this._meetingType=0,this._meetingStatus="login"===this._meetingStatus?"login":"unlogin",Promise.reject(e)}}async anonymousJoin(e){if(this._isReuseIM)return console.warn("im复用不支持匿名入会"),{code:-101,message:"im复用不支持匿名入会"};if(this._isLoginedByAccount)return console.warn("已通过账号登录，建议直接入会。或者登出后再匿名入会"),{code:-102,message:"已通过账号登录，建议直接入会。或者登出后再匿名入会"};this.isUnMutedAudio=1==e.audio,this.isUnMutedVideo=1==e.video,this._isAnonymous=!0,console.log("anonymousJoin",e);try{const t=await this._request.post(`/scene/apps/${this._appKey}/v1/anonymous/login`);e.role=e.role||Role.member,this._userUuid=t.userUuid,this._token=t.userToken,this._privateMeetingNum=t.privateMeetingNum||"";try{this.authService&&await this.authService.login(t.userUuid,t.userToken)}catch(e){console.log("authService.login",e)}await this._joinHandler(e)}catch(e){throw console.log("anonymousJoin",e),e}}async logout(){try{this.authService&&this.authService.logout(),this._isLoginedByAccount=!1,this._isAnonymous=!1,this._meetingStatus="unlogin"}catch(e){throw console.log("logout",e),e}}async leave(e){try{logger$1.debug("leave() %t"),this.roomContext&&await this.roomContext.leaveRoom(),"AnonymousParticipant"===e||this._isAnonymous?this._meetingStatus="unlogin":this._meetingStatus="login",this._reset(),logger$1.debug("leave() successed %t")}catch(e){return Promise.reject(e)}}async end(){try{logger$1.debug("end():  %s %t",this._isAnonymous),this.roomContext&&await this.roomContext.endRoom(),this._isAnonymous?this._meetingStatus="unlogin":this._meetingStatus="login",DataReporter$1.destroy(),this._reset(),logger$1.debug("end() successed:  %s %t",this._meetingStatus)}catch(e){return Promise.reject(e)}}resetStatus(){this._isAnonymous?(this._meetingStatus="unlogin",this.authService&&this.authService.logout(),this._isAnonymous=!1):this._meetingStatus="login"}getMeetingInfo(){var e,t,r,n;if(!this.roomContext)return null;const i=this.roomContext.remoteMembers,o=this.roomContext.localMember,a=this.roomContext.roomProperties;a.audioOff&&(a.audioOff.value=null===(e=a.audioOff.value)||void 0===e?void 0:e.split("_")[0]),a.videoOff&&(a.videoOff.value=null===(t=a.videoOff.value)||void 0===t?void 0:t.split("_")[0]);let s="",c="";const u=this.rtcController.getScreenSharingUserUuid(),l=a.wbSharingUuid?a.wbSharingUuid.value:"",d=a.focus?a.focus.value:"";o.isInChatroom=!0;const p=[o,...i],f=[];let h=!1;p.forEach((e=>{var t,r,n,i,a;if(e.isInRtcChannel||e.uuid===o.uuid){(null===(t=e.role)||void 0===t?void 0:t.name)===NEMeetingRole.host&&(s=e.uuid,c=e.name);const u=null===(r=e.properties)||void 0===r?void 0:r.handsUp,l=(null===(n=e.role)||void 0===n?void 0:n.name)!==NEMeetingRole.host&&(null===(i=e.role)||void 0===i?void 0:i.name)!==NEMeetingRole.coHost&&(!(!u||!u.value)&&1==u.value);e.isHandsUp=l,e.uuid===o.uuid&&(h=l),f.push(Object.assign(Object.assign({},e),{role:null===(a=e.role)||void 0===a?void 0:a.name}))}}));const{subject:m,startTime:g,endTime:v,type:y,settings:b,shortMeetingNum:S,meetingNum:_}=this._meetingInfo;return{memberList:f,meetingInfo:{localMember:Object.assign(Object.assign({},o),{role:null===(r=o.role)||void 0===r?void 0:r.name,isHandsUp:h}),myUuid:o.uuid,focusUuid:d,hostUuid:s,hostName:c,screenUuid:u,whiteboardUuid:l,properties:a,password:this.roomContext.password,subject:m,startTime:g,endTime:v,type:y,shortId:S,sipCid:this.roomContext.sipCid,activeSpeakerUuid:"",meetingId:_,videoOff:a.videoOff?a.videoOff.value:AttendeeOffType.disable,audioOff:a.audioOff?a.audioOff.value:AttendeeOffType.disable,isLocked:1===(null===(n=a.lock)||void 0===n?void 0:n.value)}}}sendMemberControl(e,t){return this._handleMemberAction(e,t)}sendHostControl(e,t){return this._handleHostAction(e,t)}async muteLocalAudio(e=!0){return e?this.sendMemberControl(memberAction.muteAudio):!!this.rtcController&&(await this.rtcController.muteMyAudio(),!0)}async unmuteLocalAudio(e,t=!0){return t?this.sendMemberControl(memberAction.unmuteAudio):!!this.rtcController&&(e?await this.rtcController.switchDevice({type:"microphone",deviceId:e}):await this.rtcController.unmuteMyAudio(),!0)}async muteLocalVideo(e=!0){return e?this.sendMemberControl(memberAction.muteVideo):!!this.rtcController&&(await this.rtcController.muteMyVideo(),!0)}async unmuteLocalVideo(e,t=!0){if(t)return this.sendMemberControl(memberAction.unmuteVideo);if(!this.rtcController)return console.warn("unmuteLocalVideo no _webrtc %t"),!1;try{return await this.rtcController.unmuteMyVideo(),console.debug("unmuteLocalVideo success %t"),!0}catch(e){return console.warn("unmuteLocalVideo failed ",e),!1}}async muteLocalScreenShare(){console.debug("muteLocalScreenShare"),this.rtcController?(await this.rtcController.stopScreenShare(),console.debug("muteLocalScreenShare success %t")):console.warn("muteLocalScreenShare no _webrtc %t")}async unmuteLocalScreenShare(){logger$1.debug("unmuteLocalScreenShare %t"),this.rtcController?(await this.rtcController.startScreenShare(),logger$1.debug("unmuteLocalScreenShare success %t")):logger$1.warn("unmuteLocalScreenShare no _webrtc %t")}async changeLocalAudio(e){this.rtcController?(await this.rtcController.switchDevice({type:"microphone",deviceId:e}),logger$1.debug("changeLocalAudio success %t")):logger$1.warn("changeLocalAudio no _webrtc %t")}async changeLocalVideo(e,t=!0){if(this.rtcController)try{await this.rtcController.switchDevice({type:"camera",deviceId:e}),logger$1.debug("changeLocalVideo success %t")}catch(e){throw logger$1.warn("changeLocalVideo error",e),e}else logger$1.warn("changeLocalVideo no _webrtc %t")}async join(e){try{return e.role=e.role||Role.member,this.isUnMutedAudio=1==e.audio,this.isUnMutedVideo=1==e.video,logger$1.debug("_meetingStatus:  %s %t",this._meetingStatus),"created"!==this._meetingStatus&&"login"!==this._meetingStatus||logger$1.debug("join() %o %t",e),this._joinHandler(e)}catch(e){return logger$1.debug("join() failed: %o",e),Promise.reject(e)}}getSelectedRecordDevice(){return this.rtcController?this.rtcController.getSelectedRecordDevice():""}getSelectedCameraDevice(){return this.rtcController?this.rtcController.getSelectedCameraDevice():""}getSelectedPlayoutDevice(){return this.rtcController?this.rtcController.getSelectedPlayoutDevice():""}async getMicrophones(){if(this.rtcController){const e=await this.rtcController.enumRecordDevices();return logger$1.debug("getMicrophones success, %o %t",e.data),e.data.map((e=>(e.deviceName.indexOf("USB")<0&&e.deviceName.indexOf("Built")<0&&e.deviceName.indexOf("外置")<0&&e.deviceName.indexOf("麦克风")<0&&e.deviceName.indexOf("默认")<0&&(e.deviceName=e.deviceName+"（不推荐）"),e)))}return logger$1.warn("getMicrophones no previewController %t"),[]}async getCameras(){if(logger$1.debug("getCameras"),this.rtcController){const e=await this.rtcController.enumCameraDevices();return logger$1.debug("getCameras success, %o %t",e.data),e.data}logger$1.warn("getCameras no _webrtc %t")}async getSpeakers(){if(logger$1.debug("getSpeakers %t"),this.rtcController){const e=await this.rtcController.enumPlayoutDevices();return logger$1.debug("getSpeakers success, %o %t",e.data),e.data.map((e=>(e.deviceName.indexOf("USB")<0&&e.deviceName.indexOf("Built")<0&&e.deviceName.indexOf("外置")<0&&e.deviceName.indexOf("扬声器")<0&&e.deviceName.indexOf("默认")<0&&(e.deviceName=e.deviceName+"（不推荐）"),e)))}logger$1.warn("getSpeakers no _webrtc %t")}async selectSpeakers(e){if(logger$1.debug("selectSpeakers %s %t",e),this.rtcController)return await this.rtcController.switchDevice({type:"speaker",deviceId:e}),void logger$1.debug("selectSpeakers success %t");logger$1.warn("selectSpeakers no _webrtc %t")}async setVideoProfile(e,t){this.rtcController?await this.rtcController.setLocalVideoConfig({resolution:e,frameRate:t}):console.warn("setVideoProfile no _webrtc %t")}async setAudioProfile(e){this.rtcController?await this.rtcController.setLocalAudioProfile(e):console.warn("setAudioProfile no _webrtc %t")}async modifyNickName(e){var t;return await(null===(t=this.roomContext)||void 0===t?void 0:t.changeMyName(e.nickName))}replayRemoteStream(e){logger$1.debug("replayRemoteStream %s %t",e.userUuid,e.type),this.rtcController&&this.rtcController.replayRemoteStream(e)}async checkSystemRequirements(){return this.previewController?this.previewController.checkSystemRequirements():Promise.reject("检查异常")}async destroy(){var e;logger$1.debug("destroy() %t"),await this.destroyRoomContext(),null===(e=this.authService)||void 0===e||e.logout(),this._meetingStatus="unlogin"}async destroyRoomContext(){logger$1.debug("destroyRoomContext() %t"),this.roomContext&&await this.roomContext.destroy(),this._isAnonymous&&(this._meetingStatus="unlogin",this.authService&&this.authService.logout(),this._isAnonymous=!1),this._reset()}_reset(){this.roomContext=null,this.rtcController=null,this.whiteboardController=null,this.chatController=null,this._meetingType=0,this._isLoginedByAccount=!1}_addRoomListener(){this.roomContext&&this.roomContext.addRoomListener({onMemberAudioMuteChanged:(e,t,r)=>{this._eventEmitter.emit(EventType.MemberAudioMuteChanged,e,t,r)},onMemberJoinChatroom:async e=>{console.log("onMemberJoinChatroom",e[0])},onMemberJoinRoom:e=>{console.log(EventType.MemberJoinRoom,e)},onMemberNameChanged:(e,t)=>{this._eventEmitter.emit(EventType.MemberNameChanged,e,t)},onMemberJoinRtcChannel:async e=>{console.log(EventType.MemberJoinRtcChannel,e,this._eventEmitter),this._eventEmitter.emit(EventType.MemberJoinRtcChannel,e)},onMemberLeaveChatroom:e=>{console.log(EventType.MemberLeaveChatroom,e)},onMemberLeaveRoom:e=>{var t;console.log("onMemberLeaveRoom",e),1==e.length&&(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)===e[0].uuid&&(this._meetingStatus="login"),this._eventEmitter.emit(EventType.MemberLeaveRoom,e)},onMemberRoleChanged:(e,t,r)=>{this._eventEmitter.emit(EventType.MemberRoleChanged,e,t.name,r.name)},onMemberScreenShareStateChanged:async(e,t,r)=>{this._eventEmitter.emit(EventType.MemberScreenShareStateChanged,e,t,r)},onMemberVideoMuteChanged:async(e,t,r)=>{this._eventEmitter.emit(EventType.MemberVideoMuteChanged,e,t,r)},onMemberWhiteboardStateChanged:async(e,t,r)=>{this._eventEmitter.emit(EventType.MemberWhiteboardStateChanged,e,t,r)},onReceiveChatroomMessages:e=>{this._eventEmitter.emit(EventType.ReceiveChatroomMessages,e)},onRoomPropertiesChanged:e=>{this._eventEmitter.emit(EventType.RoomPropertiesChanged,e)},onRoomLockStateChanged:e=>{this._eventEmitter.emit(EventType.RoomLockStateChanged,e)},onMemberPropertiesChanged:(e,t)=>{this._eventEmitter.emit(EventType.MemberPropertiesChanged,e.uuid,t)},onMemberPropertiesDeleted:(e,t)=>{const r=Object.keys(t);this._eventEmitter.emit(EventType.MemberPropertiesDeleted,e,r)},onRoomPropertiesDeleted:e=>{const t=Object.keys(e);this._eventEmitter.emit(EventType.RoomPropertiesDeleted,t)},onRoomEnded:e=>{this._meetingStatus="login","kICK_BY_SELF"===e?this._clientBanned():this._eventEmitter.emit(EventType.RoomEnded,e)},onRtcActiveSpeakerChanged:e=>{this._eventEmitter.emit(EventType.RtcActiveSpeakerChanged,e)},onRtcChannelError:e=>{console.log("onRtcChannelError",e),"SOCKET_ERROR"===e&&(this._isAnonymous?(this._meetingStatus="unlogin",this.authService&&this.authService.logout()):this._meetingStatus="login",this._eventEmitter.emit(EventType.NetworkError))},onRoomConnectStateChanged:e=>{console.log(EventType.RoomConnectStateChanged,e),this._connectionStateChange(e)},onCameraDeviceChanged:e=>{this._deviceChange(e)},onPlayoutDeviceChanged:e=>{this._deviceChange(e)},onRecordDeviceChanged:e=>{this._deviceChange(e)},onAutoPlayNotAllowed:e=>{this._eventEmitter.emit(EventType.AutoPlayNotAllowed,e)}})}async _joinHandler(e){const t=2===this._meetingType?this._privateMeetingNum:e.meetingId;console.log(9);const r=await this._request.get(`/scene/meeting/${this._appKey}/v1/info/${t}`);if(console.log(10,r),this._meetingInfo=r,console.log("options..",e),await this._joinRoomkit({role:e.role,roomUuid:r.roomUuid,nickname:e.nickName,password:e.password,initialProperties:{tag:{value:e.memberTag}}}),this._addRoomListener(),e.videoProfile){const{resolution:t,frameRate:r}=e.videoProfile;await this.setVideoProfile(t,r)}this.rtcController&&(await this.rtcController.joinRtcChannel(),await this.rtcController.setLocalAudioProfile("standard_stereo")),this._meetingStatus="joined"}_deviceChange(e){}_connectionStateChange(e){"DISCONNECTED"===e.curState&&"joined"===this._meetingStatus||("CONNECTING"===e.curState&&"joined"===this._meetingStatus?this._eventEmitter.emit(EventType.NetworkReconnect):("CONNECTED"===e.prevState&&"CONNECTED"===e.curState||"CONNECTING"===e.prevState&&"CONNECTED"===e.curState)&&"joined"===this._meetingStatus&&this._eventEmitter.emit(EventType.NetworkReconnectSuccess))}async _handleMemberAction(e,t){t=t||this.roomContext.localMember.uuid;const r=this.roomContext.rtcController,n=this.roomContext.whiteboardController;switch(e){case memberAction.muteAudio:return r.muteMyAudio();case memberAction.unmuteAudio:return r.unmuteMyAudio();case memberAction.muteVideo:return r.muteMyVideo();case memberAction.unmuteVideo:return r.unmuteMyVideo();case memberAction.unmuteScreen:return r.startScreenShare();case memberAction.muteScreen:return r.stopScreenShare();case memberAction.openWhiteShare:return n.startWhiteboardShare();case memberAction.closeWhiteShare:return n.stopWhiteboardShare();case memberAction.shareWhiteShare:return this.roomContext.updateMemberProperty(t,"wbDrawable",JSON.stringify({value:"1"}));case memberAction.cancelShareWhiteShare:return this.roomContext.updateMemberProperty(t,"wbDrawable",JSON.stringify({value:"0"}));case memberAction.modifyMeetingNickName:return;case memberAction.handsUp:return this.roomContext.updateMemberProperty(t,"handsUp",JSON.stringify({value:"1"}));case memberAction.handsDown:return this.roomContext.deleteMemberProperty(t,"handsUp")}}async _handleHostAction(e,t){const r=this.roomContext;switch(e){case hostAction.remove:return r.kickMemberOut(t);case hostAction.muteMemberVideo:return this.rtcController.muteMemberVideo(t);case hostAction.muteMemberAudio:return this.rtcController.muteMemberAudio(t);case hostAction.muteAllAudio:return r.updateRoomProperty("audioOff",JSON.stringify({value:AttendeeOffType.offAllowSelfOn+`_${(new Date).getTime()}`}));case hostAction.lockMeeting:return r.lockRoom();case hostAction.muteAllVideo:return r.updateRoomProperty("videoOff",JSON.stringify({value:AttendeeOffType.offAllowSelfOn+`_${(new Date).getTime()}`}));case hostAction.unmuteMemberVideo:return this.messageService.sendCustomMessage(this.meetingId,t,99,JSON.stringify({type:2,category:"meeting_control"}));case hostAction.unmuteMemberAudio:return this.messageService.sendCustomMessage(this.meetingId,t,99,JSON.stringify({type:1,category:"meeting_control"}));case hostAction.unmuteAllAudio:return r.updateRoomProperty("audioOff",JSON.stringify({value:AttendeeOffType.disable+`_${(new Date).getTime()}`}));case hostAction.unlockMeeting:return r.unlockRoom();case hostAction.unmuteAllVideo:return r.updateRoomProperty("videoOff",JSON.stringify({value:AttendeeOffType.disable+`_${(new Date).getTime()}`}));case hostAction.muteVideoAndAudio:return this.rtcController.muteMemberVideo(t),void this.rtcController.muteMemberAudio(t);case hostAction.unmuteVideoAndAudio:return this.messageService.sendCustomMessage(this.meetingId,t,99,JSON.stringify({type:3,category:"meeting_control"}));case hostAction.transferHost:return r.handOverMyRole(t);case hostAction.setCoHost:return r.changeMemberRole(t,Role.coHost);case hostAction.unSetCoHost:return r.changeMemberRole(t,Role.member);case hostAction.setFocus:return r.updateRoomProperty("focus",JSON.stringify({value:t}),t);case hostAction.unsetFocus:return r.updateRoomProperty("focus",JSON.stringify({value:""}));case hostAction.forceMuteAllAudio:return r.updateRoomProperty("audioOff",JSON.stringify({value:AttendeeOffType.offNotAllowSelfOn+`_${(new Date).getTime()}`}));case hostAction.rejectHandsUp:return r.updateMemberProperty(t,"handsUp",JSON.stringify({value:"2"}));case hostAction.forceMuteAllVideo:return r.updateRoomProperty("videoOff",JSON.stringify({value:AttendeeOffType.offNotAllowSelfOn+`_${(new Date).getTime()}`}));case hostAction.closeScreenShare:return this.rtcController.stopMemberScreenShare(t);case hostAction.openWhiteShare:return this.whiteboardController.startWhiteboardShare();case hostAction.closeWhiteShare:return this.whiteboardController.stopMemberWhiteboardShare(t)}}async _joinRoomkit(e){return this.roomService.joinRoom({role:e.role,roomUuid:e.roomUuid,userName:e.nickname,password:e.password,initialProperties:e.initialProperties},{}).then((t=>{this.roomContext=this.roomService.getRoomContext(e.roomUuid),this.roomContext&&(this.rtcController=this.roomContext.rtcController,this.whiteboardController=this.roomContext.whiteboardController,this.whiteboardController.initWhiteboard(),this.chatController=this.roomContext.chatController)}))}_clientBanned(){this._isAnonymous?(this._meetingStatus="unlogin",this.authService&&this.authService.logout()):this._meetingStatus="login",this._eventEmitter.emit(EventType.ClientBanned)}createRequest(){const e=axios$3.create({baseURL:this._meetingServerDomain});return e.interceptors.request.use((e=>(e.headers=Object.assign(Object.assign({},e.headers),{clientType:"web",user:this._userUuid,token:this._token,versionCode:"3.1.0",deviceId:this._roomkit.deviceId}),e)),(function(e){return Promise.reject(e)})),e.interceptors.response.use((function(e){var t;return 0!==e.data.code?Promise.reject(e.data):null===(t=e.data)||void 0===t?void 0:t.data}),(function(e){return Promise.reject(e)})),e}}var img="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAsMSURBVHgB7Z1daFzHFcfP3F03fajBeUlshVayiZ1CEryWZSipZcl+SoPAHzTgkEBtQ4JfEsvKS9OHyBI0NQTjjxKwY4jVh6CQFCSBoXnzKnZtU0XSGkIf7ILXTtHqrQrWQ4vu7vT890NZrXZXd+/OvXdmNT8s9lp7Je3c/5wzM2fOzAhqIRKJ3k2xWLaXSLY7jkhISR34wntCFF5L8PcXhBBpvuJXSudyMsWv91w3nkqlkgvUIggymB8FFfwlD1aK6B+RklKm+GIim40lTRbcOIEhajzuJvijD7IVJljUTRQ841KK8enpb/5ChmGMwAVhc6fYsvpDEnUVXKHS/JLMZpeGUqm7aTIA7QVmYTvYDZ9hUX9HGsFij5ggtLYCFy12kB9lP2mM7kLHSEP27Nl3SojcOFttL2kOf0buB8QOPfdcu5ibe3yXNEMrC04kXknE47HzfNlLBoI2mq15v07WrI0FF6xWjLBF/JIMBZ0/x4n1t7V10Nzco0nSgMgtGJ2oeDx7jQy12jokXXfpeNTWHKnAcMmxWGxMXYBCL+CyHSd7eGrqdooiwqGIgEvm9na2VcUFKJuUsdmuru7IRgKRtMFdXfsw/DlL64dXo2qXQ3XRxdjxea7Zx2gdwuUemZq6eZxCJDSBi4GLG2y5CVrXiJTrOvvDmsAIpQ0uhhtnrbhAJvAsEolfdVAIBG7BRXFvtHJnyg9hBUUCFdiKW58wRA5MYCuuN4IWORCBrbiNEaTIygW24vojKJGVCmzFbY4gRFYmsBVXDapFViKwFVctKkVuWmArbjCoErkpga24waJCZN8CFycOWnq6Tw+ai137jkVj4sCKGwYygWcNgyIf+BJ49+7ua3biIExkYsOG7HnyQcMT/pisZ8vVOle5RUn4SRpoSGCk2ayzTAzd6G1ra/+hkfxrz52sYs7yLFkiR4jsLq+JfJ7a4MJwKDZGFi3I5WJjXhMGPAmMvGXbY9YHaBGPb7jm5d412+BCBuT6TJLTnA4v7XHdNri46uAhWXRlwXWXdtWLdNV10QhDkkVnNq3lqmu66MKQiI6SRXfquuqqLtpOIhgHu+rY1mrx6ni1u4tbJnRQBGzc+DPasmVz/lUFT54s0v37/yJd6O3tpqNHf5svXzJ5i65e9dQZXovibgh0uvKNVRYcdscKBe3p2cvx7V38lWBxt1AQ3L//gKanUzQ5eTP/GjYo59tvH6c33nh9xfc//fSaKpGJO1xbKztcqwTmiYSRMDY8gZWisH19v1FmrV7JZObzD3ZmZpZju/MUNKi4g4N/yJe5EniYAwdeIxVgv5Dp6ZVrn1YIHIb11qrJUVAS+vr1v1FQDAy8u2ZZuUNLquC2+OnytnjFMAltLwUI2p+JiS+1EBfAogYHP6DLly9SW9tmUgl+9+effxZ6WeNxd8VMX+U4uIcCAlb78cd/DN0dewHt/+XLl2jHjudJBUePvp4XV9Xvawxxqjw5YFngzs7uY0H1nCHuO++Euiy2YWBxELmv71XyS+F3XKT33383yopc3OqxwLLALO5BCgATxC0BUQYG3vNleWh+YLXwBtEjBktXeYFh0izwIVIMXJUp4paAyLDkRtpkDZufRMlN5wUubMmrFrgruCoTgVAffviBp3thuRpWYnbT2Xx/quSilVvvlSuXyGTgauGB6oFKjGGQjkgp9+M1L7AQcicpBMGLaoN604Bl1nO7eF/fcop8n8op+GqhNAXWtHa3FhC3lhVDWFRkXcGICNo65V1qFRTiyeZbb4lagQo9esv1QTvsqE5g17lW+wFWjEpbSTRBjEbJbXWkdJQK3NPTTa1GtTKZILAQzk6HfXU7KQI1XcdQZLNgKGQi3JPugItWdsDF9u3bqRVRmYAQJlIKCCw6SBGqZ2R0wtSOI8bByiy4Fd1zCRMFxlBJ6V6VrTQ8qmTjxo1kIkoFRvqJRS+UCry42LoCZzIZMhGneFybEqwFa8eCUgvWKf9YNWaWTaQR6EiTIpB73IpAXDO9U24BLvoRKcLcB1EfUysuDsBmC84pTfPHyoFWI5lcXSbkVOuOlLl7mGxIk0KCTCKPAgg5OXlr1fejWP7SOCLl4AhzUggK3kqdrVoVFp5K9+bIdeMpB8scVA6VwOjol9QKwHprCQxx9fZWIgVti8MkOUEKuX79a7Zk83dcGh39qu7iNKwK1NWKeaow34YUBRZJUszQ0J+M7lHDeiFwPVC+4eGPSEd4+DuO17zAxXZY6UlceEBXr35GJoLPfvLke57uVbiIWymuG8tveZjfo2N+Pv3ftrZ2LMrpIIV8990/UZOMSFArB+Km048934+O5YMHD+jll1/0NWUaQAWZmJn5ZgQXy5uwtLX9ggMe4hgpBoU3RWS43LNnz9GdO/+gRkGFwHgZAu/Y0Vhmi2qBpRRnM5lH93C9LPAzz2xbcBx5ki9/SooxQWSIC8v1I24JzKZhzLy4+IReeulFeuqpn3j6OZUCY0RUvsp/ebKhsCpcXqSAwEr6oaGPtIwAoQK+9dYJZeP30dG/0ptvnoiqrMny/6zYJ4utOMVW/HsKCDxAv24sCGC1n3xyJe+WVff4Yc3ohXvxXCotOJtdOjw//+/lDnOkm7BgiUsUifIQ84svvsoLEMZQDmXFYrzIN2EBUW2j1NOzj1544fnA8rrgPRB8iXIbJVToyrVOqGjnzv2ZVOBpGyWwe/feCzzVdIoiQPVGaGgHw9gqySvYIqKv77V8ijFCneibqKCa9YJaWxluKlqxspRaS3DUO1+p6makCHxs3vzz/7EV+9+RxBIaPKc/NDNz5+uq79X7wa6ubmwn3EsWbWHrfciueVut9+sm3QmRxeaWSmPUFrWwaz5Q7/26W/rPzX0/b121zkh2zbfH693h6Vgd66r1g13zGLvmI2vd5ykvmqeejqvO+rD4B+0uu+YBL/d6Phhrz55XElLag7E0QLputjOV8nYwluej7Yrt8Q+2PY6a3MBa7W45DZ1dmMl8f5fnjdnqRS9ZIkAOffvt3xs6O7Lh00fn5h4nt2xp38oTEvZ42RAphCJvnW7053wtPstmY/1IyyRLSIjZanFmL/gSGMkBOHbcihw86DHzsz5APvG9fLQo8mE7fAqO4nDoQLXzkLzieZhUC3uIVjD8KG7tcwm90LTAwIqsFlXiAiUCAyuyGlSKC5QJDKzIzaFaXKBUYGBF9kcQ4gLlAgMrcmMEJS4IRGBgRfZGkOKCwAQGVuT6BC0uCFRgYEWuThjiAqUboVWDozBpjl3vtxGvcsRsGOLm/xKFRCHXOndD9RkR5iFmEVtuJvzY0F+jkAlr7ZOOYMqPvdnpsMQFDc8HN0sm83h8HSYNSP43jPlcLCqgEAldYICkgXWU/iORZtNoJoYqQnfR5SCRL5eLjbVqD7vQU84e8ZogFwSB96LrMTV1O4UeNlWsSm8B4JJvFHrKtyNNiojUgsvp6tp7pvxgY1Nhq/2PELlhdskXSAO0ERgYHhSB1SZd1z0RxvjWK1oJXKKz89f9QjinTBFaN6stJ5Je9Fog//rZZ7dNCCGf1jw9VzIXs9n4kZmZm0nSEC0tuJyi2z6jWXBEFoIWS8M6ueNqaC9wiZLQfNkTkeuGqAvsVS65bvxCmNGoZjBG4HI6O7uPOY48yB//EAVLSVQMdYaxwbYpwpYwUuASmMBgq+7ly0Msws4mj6qXyxf5mS8xwVeT2InXNFHLMVrgSgozVm6CBdrpOCKB83P525twzCq79RU7BpWmL7lipDlk+jCXk/f4f49MF7SS/wOAnm9iigOiJgAAAABJRU5ErkJggg==";const logger=new Logger("Meeting-NeMeeting",!0),reporter=DataReporter$1.getInstance(),App=({height:e,width:t})=>{const{meetingInfo:r,memberList:n,dispatch:i}=react.exports.useContext(MeetingInfoContext),{neMeeting:o,joinLoading:a,dispatch:s}=react.exports.useContext(GlobalContext),{eventEmitter:c,outEventEmitter:u}=react.exports.useContext(GlobalContext),[l,d]=react.exports.useState(null),p=react.exports.useRef(r),f=react.exports.useRef(n),h=react.exports.useRef(null);p.current=r,f.current=n;const[m,g]=react.exports.useState(!1),[v,y]=react.exports.useState(!1),[b,S]=react.exports.useState(!0),[_,M]=react.exports.useState(!1),T=react.exports.useRef(!1),[w,x]=react.exports.useState(!1),[I,E]=react.exports.useState(!1),A=react.exports.useRef(null),C=react.exports.useCallback((()=>{null==u||u.on(UserEventType.SetLeaveCallback,(e=>{d(e)})),null==c||c.on(EventType.MemberAudioMuteChanged,((e,t,r)=>{logger.debug("onMemberAudioMuteChanged: %o %o %t",e,r),i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{isAudioOn:!t}}}),p.current.localMember.uuid===e.uuid&&(t?e.uuid!==r.uuid&&Toast.info("您已被静音"):(p.current.localMember.role!==Role.host&&r.uuid!==p.current.localMember.uuid&&Toast.info("主持人已将您解除静音，您可以自由发言"),p.current.localMember.isHandsUp&&(null==o||o.sendMemberControl(memberAction.handsDown,e.uuid))))})),null==c||c.on(EventType.MemberJoinRtcChannel,(e=>{logger.debug("用户加入: %o %t",e);if(e.findIndex((e=>e.uuid===p.current.localMember.uuid))>0)return;e.forEach((e=>{var t,r;p.current.localMember.role,Role.host,e.role.name===Role.host&&i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{hostUuid:e.uuid,hostName:e.name}}),i&&(i({type:ActionType.ADD_MEMBER,data:{member:Object.assign(Object.assign({},e),{role:null===(t=e.role)||void 0===t?void 0:t.name})}}),p.current.screenUuid&&!e.isSharingScreen&&p.current.screenUuid===e.uuid&&(i({type:ActionType.UPDATE_MEETING_INFO,data:{screenUuid:""}}),null===(r=null==o?void 0:o.rtcController)||void 0===r||r.unsubscribeRemoteVideoSubStream(e.uuid)))}));const t=e.map((e=>({uuid:e.uuid,name:e.name})));null==u||u.emit("peerJoin",t)})),null==c||c.on(EventType.MemberNameChanged,((e,t)=>{logger.debug("onMemberNameChanged: %o %t",e),i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{name:t}}}),e.role.name===Role.host&&i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{hostName:e.name}})})),null==c||c.on(EventType.MemberJoinRoom,(()=>{})),null==c||c.on(EventType.MemberLeaveChatroom,(()=>{})),null==c||c.on(EventType.MemberLeaveRoom,(e=>{console.log("用户离开",e),logger.debug("用户离开: %o %t",e);const t=e.map((e=>e.uuid));i&&i({type:ActionType.REMOVE_MEMBER,data:{uuids:t}});e.find((e=>e.role.name===Role.host))&&i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{hostUuid:"",hostName:""}}),null==u||u.emit("peerLeave",t);t.findIndex((e=>e===p.current.localMember.uuid))>-1||p.current.localMember.role===Role.host&&e.forEach((e=>{Toast.info(`${e.name}离开会议`)}))})),null==c||c.on(EventType.MemberLeaveRtcChannel,(()=>{})),null==c||c.on(EventType.MemberRoleChanged,((e,t,r)=>{if(logger.debug("onMemberRoleChanged: %o %o %o %t",e,t,r),e.uuid===p.current.localMember.uuid)console.log("afterRole",r),r===Role.host?Toast.info("您已经成为主持人"):r===Role.coHost?Toast.info("您已成为联席主持人"):t===Role.coHost&&r!==Role.host&&Toast.info("您已被取消设为联席主持人"),r!==Role.coHost&&r!==Role.host||(null==o||o.sendMemberControl(memberAction.handsDown,e.uuid),null==c||c.emit("needAudioHandsUp",!1),null==c||c.emit("needVideoHandsUp",!1));else if(p.current.localMember.role===Role.host||p.current.localMember.role===Role.coHost)if(r===Role.coHost)Toast.info(`${e.name}已经成为联席主持人`);else{const t=f.current.find((t=>t.uuid===e.uuid));t&&t.role===Role.coHost&&Toast.info(`${e.name}已被取消设为联席主持人`)}r===Role.host&&i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{hostUuid:e.uuid,hostName:e.name}}),o&&updateMeetingService(o,i)})),null==c||c.on(EventType.MemberScreenShareStateChanged,((e,t,r)=>{logger.debug("onMemberScreenShareStateChanged: %o %t",e),i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{isSharingScreen:t}}}),t||(r.uuid!==e.uuid&&e.uuid===p.current.localMember.uuid&&Toast.info("主持人已终止了您的共享"),reporter.send({action_name:"member_screen_share_stop",member_uid:e.uuid}))})),null==c||c.on(EventType.MemberVideoMuteChanged,((e,t,r)=>{logger.debug("login_对端发mutedChange: %o %t",e),i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{isVideoOn:!t}}}),e.uuid===p.current.localMember.uuid&&(t&&e.uuid!==r.uuid&&Toast.info("您已被停止视频"),t||p.current.localMember.isHandsUp&&(null==o||o.sendMemberControl(memberAction.handsDown,e.uuid)))})),null==c||c.on(EventType.MemberWhiteboardStateChanged,((e,t,r)=>{var n,a,s;logger.debug("onMemberWhiteboardStateChanged: %o %t",e,t),i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{whiteboardUuid:t?e.uuid:""}}),e||t?e&&(i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{properties:{wbDrawable:{value:t?"1":"0"}}}}}),t||("1"===(null===(a=p.current.localMember.properties.wbDrawable)||void 0===a?void 0:a.value)&&(null==o||o.sendMemberControl(memberAction.cancelShareWhiteShare,p.current.localMember.uuid)),e.uuid===p.current.localMember.uuid&&r.uuid===p.current.hostUuid&&p.current.hostUuid!==p.current.localMember.uuid&&Toast.info("主持人已终止了您的共享"),e.uuid===p.current.localMember.uuid&&!t&&(null===(s=null==o?void 0:o.whiteboardController)||void 0===s||s.setEnableDraw(!1)))):"1"===(null===(n=p.current.localMember.properties.wbDrawable)||void 0===n?void 0:n.value)&&(null==o||o.sendMemberControl(memberAction.cancelShareWhiteShare,p.current.localMember.uuid))})),null==c||c.on(EventType.RoomPropertiesChanged,(e=>{var t,r;if(logger.debug("onRoomPropertiesChanged: %o %o %t",e),e.focus){const t=e.focus;t.value?p.current.localMember.uuid===t.value?Toast.info("您已被设置为焦点视频"):(p.current.localMember.uuid,p.current.focusUuid):O(),i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{focusUuid:t.value}})}else if(e.audioOff){const r=null===(t=e.audioOff.value)||void 0===t?void 0:t.split("_")[0];switch(i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{audioOff:r}}),r!==AttendeeOffType.offAllowSelfOn&&r!==AttendeeOffType.disable||(null==c||c.emit("needAudioHandsUp",!1),p.current.localMember.isHandsUp&&(null==o||o.sendMemberControl(memberAction.handsDown,p.current.localMember.uuid))),r){case AttendeeOffType.offNotAllowSelfOn:case AttendeeOffType.offAllowSelfOn:if(x(!1),p.current.localMember.role!==Role.host&&p.current.localMember.role!==Role.coHost&&Toast.info("主持人设置了全体静音"),!p.current.localMember.isAudioOn||p.current.localMember.role===Role.host||p.current.localMember.role===Role.coHost)return;null==o||o.muteLocalAudio();break;case AttendeeOffType.disable:if(x(!0),null==o||o.sendMemberControl(memberAction.handsDown,p.current.localMember.uuid),p.current.localMember.isAudioOn||p.current.localMember.role===Role.host||p.current.localMember.role===Role.coHost)return;Toast.info("主持人已将您解除静音，您可以自由发言"),R()}}else if(e.videoOff){const t=null===(r=e.videoOff.value)||void 0===r?void 0:r.split("_")[0];switch(i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{videoOff:t}}),t!==AttendeeOffType.offAllowSelfOn&&t!==AttendeeOffType.disable||(console.log("needVideoHandsUp",t),null==c||c.emit("needVideoHandsUp",!1),p.current.localMember.isHandsUp&&(null==o||o.sendMemberControl(memberAction.handsDown,p.current.localMember.uuid))),t){case AttendeeOffType.offNotAllowSelfOn:case AttendeeOffType.offAllowSelfOn:if(E(!1),p.current.localMember.role!==Role.host&&p.current.localMember.role!==Role.coHost&&Toast.info("主持人设置了全体关闭视频"),!p.current.localMember.isVideoOn||p.current.localMember.role===Role.host||p.current.localMember.role===Role.coHost)return;null==o||o.muteLocalVideo();break;case AttendeeOffType.disable:if(E(!0),null==o||o.sendMemberControl(memberAction.handsDown,p.current.localMember.uuid),p.current.localMember.isVideoOn||p.current.localMember.role===Role.host||p.current.localMember.role===Role.coHost)return;N()}}})),null==c||c.on(EventType.RoomLockStateChanged,(e=>{logger.debug("onRoomLockStateChanged: %o %t",e),i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{properties:{isLocked:e}}})})),null==c||c.on(EventType.MemberPropertiesChanged,((e,t)=>{if(logger.debug("onMemberPropertiesChanged: %o %t",t,e),t.handsUp){const r=t.handsUp;i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:e,member:{isHandsUp:"1"==r.value}}}),"2"==r.value&&e===p.current.localMember.uuid&&Toast.info("主持人已将您的手放下")}else t.wbDrawable&&i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:e,member:{properties:{wbDrawable:t.wbDrawable}}}})})),null==c||c.on(EventType.MemberPropertiesDeleted,((e,t)=>{logger.debug("onMemberPropertiesDeleted: %o %o %t",t,e),i&&t.forEach((t=>{"handsUp"===t?i({type:ActionType.UPDATE_MEMBER,data:{uuid:e,member:{isHandsUp:!1}}}):"wbDrawable"===t&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:e,member:{properties:{wbDrawable:{value:"0"}}}}})}))})),null==c||c.on(EventType.RoomPropertiesDeleted,(e=>{console.log("RoomPropertiesDeleted",e),logger.debug("onRoomPropertiesDeleted: %o %t",e),e.forEach((e=>{"focus"===e?(O(),i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{focusUuid:""}})):"lock"===e&&i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{isLocked:!1}})}))})),null==c||c.on(EventType.RoomEnded,(e=>{console.log("RoomEnded",e),logger.debug("onRoomEnded: %o %t",e);const t={UNKNOWN:"未知异常",LOGIN_STATE_ERROR:"账号异常",CLOSE_BY_BACKEND:"后台关闭房间",ALL_MEMBERS_OUT:"所有成员退出房间",END_OF_LIFE:"房间时间到期",CLOSE_BY_MEMBER:"房间被关闭",KICK_OUT:"您已被主持人移出会议",SYNC_DATA_ERROR:"数据同步错误",LEAVE_BY_SELF:"您已离开房间",OTHER:"OTHER"};t[e]&&Toast.info(t[e]),k(e)})),null==c||c.on(EventType.RtcActiveSpeakerChanged,throttle((e=>{e.userUuid!==p.current.activeSpeakerUuid&&i&&i({type:ActionType.UPDATE_MEETING_INFO,data:{activeSpeakerUuid:e.userUuid}})}),4e3)),null==c||c.on(EventType.ClientBanned,(()=>{logger.debug("clientBanned: 当前用户被踢出 %t"),i&&i({type:ActionType.RESET_MEETING,data:null}),Toast.info("因被主持人移出或切换至其他设备，您已退出当前会议"),g(!1),y(!1),null==u||u.emit(EventType.RoomEnded,"kICK_BY_SELF"),l&&l("kICK_BY_SELF"),null==o||o.destroy()})),null==c||c.on(EventType.NetworkError,(()=>{console.log("断网 NetworkError"),setTimeout((()=>{k("NetworkError")}),1e3)})),null==c||c.on(EventType.NetworkReconnectSuccess,(()=>{Toast.info("网络重连成功"),o&&updateMeetingService(o,i)})),null==c||c.on(EventType.DeviceChange,(e=>{console.log("deviceChange  "),console.log(e)})),null==c||c.on(EventType.ReceivePassThroughMessage,(e=>{logger.debug("onReceivePassThroughMessage: %o %t",e);const{body:t}=e.data,r=e.senderUuid,n=p.current.localMember;n.isHandsUp&&(null==o||o.sendMemberControl(memberAction.handsDown,n.uuid));const i=r===n.uuid;switch(t.type){case 1:logger.debug("开启mic请求 %t"),!i&&n.isHandsUp&&Toast.info("主持人已将您解除静音，您可以自由发言"),R(i);break;case 2:logger.debug("开启camera请求 %t"),N(i);break;case 3:logger.debug("开启音视频请求 %t"),!i&&n.isHandsUp&&Toast.info("主持人已将您解除静音，您可以自由发言"),R(i),N(i)}})),null==c||c.on(EventType.AutoPlayNotAllowed,(e=>{console.log("-notAllowedError- ",e,T.current),!1===T.current&&M(!0),T.current=!0}))}),[]),k=(e="OTHER")=>{i&&i({type:ActionType.RESET_MEETING,data:null}),g(!1),y(!1),T.current=!1,null==o||o.destroy(),s&&s({type:ActionType.JOIN_LOADING,data:!1}),null==u||u.emit(EventType.RoomEnded,e);try{l&&l(e)}catch(e){logger.warn("leaveCallback failed",e)}},O=()=>{p.current.localMember.uuid===p.current.focusUuid&&Toast.info("您已被取消焦点视频")},N=(e=!1)=>{const t=p.current.localMember;t.isVideoOn||(null==c||c.emit("needVideoHandsUp",!1),t.role!==Role.host&&t.role!==Role.coHost||!e?(E(!0),y(!0)):null==o||o.unmuteLocalVideo().then((()=>{i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})))},R=(e=!1)=>{const t=p.current.localMember;t.isAudioOn||(null==c||c.emit("needAudioHandsUp",!1),t.role!==Role.host&&t.role!==Role.coHost?t.isHandsUp?null==o||o.unmuteLocalAudio().then((()=>{i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})):(x(!0),g(!0)):null==o||o.unmuteLocalAudio().then((()=>{i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})))},P=e=>{if(e.target instanceof Window){const{innerHeight:t,innerWidth:r}=e.target;r-t>80&&(console.log({innerHeight:t,innerWidth:r}),S(!1))}};function D(){h.current&&(clearTimeout(h.current),h.current=null),h.current=setTimeout((()=>{S(!1)}),5e3)}return react.exports.useEffect((()=>(C(),window.addEventListener("resize",P),()=>{null==c||c.removeAllListeners(),null==u||u.removeAllListeners(),window.removeEventListener("resize",P),k()})),[]),jsxRuntime.exports.jsx("div",Object.assign({className:"App flex flex-col h-full relative",style:{width:""+(t?`${t}px`:"100%"),height:""+(e?`${e}px`:"100%")},onClick:function(){S(!b),D()}},{children:r.meetingId?jsxRuntime.exports.jsxs(jsxRuntime.exports.Fragment,{children:[jsxRuntime.exports.jsx(Dialog,Object.assign({visible:v,title:"打开摄像头",onCancel:()=>{E(!1),y(!1)},onConfirm:()=>{(()=>{var e;const{localMember:t,videoOff:r,screenUuid:n}=p.current,a=t.role===Role.host||t.role===Role.coHost,s=!!n&&n===t.uuid;if(!t.isVideoOn){if(r===AttendeeOffType.offNotAllowSelfOn&&!a&&!s&&!I)return y(!1),void(null===(e=A.current)||void 0===e||e.checkNeedHandsUp("video",!0));E(!1),null==o||o.unmuteLocalVideo().then((()=>{i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})).catch((e=>{Toast.info("打开视频失败"),logger.error("muteLocalVideo %o %t",e)})),y(!1)}})()}},{children:"主持人已重新打开您的摄像头，确认打开？"})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:m,title:"打开麦克风",onCancel:()=>{x(!1),g(!1)},onConfirm:()=>{(()=>{var e;const{localMember:t,audioOff:r,screenUuid:n}=p.current,a=t.role===Role.host||t.role===Role.coHost,s=!!n&&n===t.uuid;if(!t.isAudioOn){if(r===AttendeeOffType.offNotAllowSelfOn&&!a&&!s&&!w)return g(!1),void(null===(e=A.current)||void 0===e||e.checkNeedHandsUp("audio",!0));x(!1),null==o||o.unmuteLocalAudio().then((()=>{i&&i({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})).catch((e=>{Toast.info("打开音频失败"),logger.error("muteLocalAudio %o %t",e)})),g(!1)}})()}},{children:"主持人已重新打开您的麦克风，确认打开？"})),jsxRuntime.exports.jsx(MeetingHeader,{className:"",visible:b,onClick:function(e){e.stopPropagation(),h.current&&(clearTimeout(h.current),h.current=null)}}),jsxRuntime.exports.jsx(MeetingCanvas$1,{className:"flex-1 h-full"}),jsxRuntime.exports.jsx(MeetingController,{className:"",visible:b,onClick:function(e){e.stopPropagation(),D()},onRef:A}),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:_,onConfirm:()=>{M(!1);const e=f.current.filter((e=>!!e.isAudioOn));console.log("重新播放远端成员音频",e),e.forEach((e=>{null==o||o.replayRemoteStream({userUuid:e.uuid,type:"audio"})}))},ifShowCancel:!1},{children:jsxRuntime.exports.jsx("span",{children:"即将开始播放其他成员的音视频"})}))]}):a?jsxRuntime.exports.jsxs("div",Object.assign({className:"meeting-loading"},{children:[jsxRuntime.exports.jsx("img",{className:"meeting-loading-img",src:img,alt:""}),jsxRuntime.exports.jsx("div",Object.assign({className:"meeting-loading-text"},{children:"正在进入会议..."}))]})):""}))};var css_248z=".container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.visible{visibility:visible}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.bottom-0{bottom:0}.top-5{top:1.25rem}.right-4{right:1rem}.top-0{top:0}.right-0{right:0}.left-0{left:0}.right-3{right:.75rem}.z-10{z-index:10}.z-20{z-index:20}.col-span-2{grid-column:span 2/span 2}.mt-1\\.5{margin-top:.375rem}.mt-1{margin-top:.25rem}.mt-4{margin-top:1rem}.mt-2{margin-top:.5rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.hidden{display:none}.h-full{height:100%}.h-1\\/2{height:50%}.h-14{height:3.5rem}.h-6{height:1.5rem}.h-12{height:3rem}.h-24{height:6rem}.h-11{height:2.75rem}.w-full{width:100%}.w-1\\/2{width:50%}.w-10\\/12{width:83.333333%}.flex-1{flex:1 1 0%}.flex-grow{flex-grow:1}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.resize{resize:both}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.overflow-hidden{overflow:hidden}.overflow-y-scroll{overflow-y:scroll}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.text-clip{text-overflow:clip}.break-all{word-break:break-all}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:1rem}.rounded-t-2xl{border-top-left-radius:1rem;border-top-right-radius:1rem}.border{border-width:1px}.border-solid{border-style:solid}.border-zinc-100{--tw-border-opacity:1;border-color:rgb(244 244 245/var(--tw-border-opacity))}.bg-zinc-900{--tw-bg-opacity:1;background-color:rgb(24 24 27/var(--tw-bg-opacity))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68/var(--tw-bg-opacity))}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-2\\.5{padding-bottom:.625rem;padding-top:.625rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.pt-1\\.5{padding-top:.375rem}.pt-1{padding-top:.25rem}.pt-6{padding-top:1.5rem}.pb-4{padding-bottom:1rem}.pb-5{padding-bottom:1.25rem}.pt-2{padding-top:.5rem}.pt-5{padding-top:1.25rem}.text-left{text-align:left}.text-center{text-align:center}.align-middle{vertical-align:middle}.text-base{font-size:1rem;line-height:1.5rem}.text-xs{font-size:.75rem;line-height:1rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.font-medium{font-weight:500}.italic{font-style:italic}.leading-10{line-height:2.5rem}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.text-zinc-900{--tw-text-opacity:1;color:rgb(24 24 27/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.text-black{--tw-text-opacity:1;color:rgb(0 0 0/var(--tw-text-opacity))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.outline{outline-style:solid}.blur{--tw-blur:blur(8px)}.blur,.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.\\[event\\:\\%s\\]{event:%s}.\\[iceParameters\\:\\%o\\]{ice-parameters:%o}.\\[role\\:\\%s\\]{role:%s}.\\[mid\\:\\%s\\]{mid:%s}.\\[routerRtpCapabilities\\:\\%o\\]{router-rtp-capabilities:%o}.\\[method\\:\\%s\\]{method:%s}.\\[currentAttempt\\:\\%s\\]{current-attempt:%s}.\\[answer\\:\\%o\\]{answer:%o}.\\[offer\\:\\%o\\]{offer:%o}.\\[transceivers\\:\\%d\\]{transceivers:%d}.\\[localId\\:\\%s\\]{local-id:%s}.\\[answer\\:\\%s\\]{answer:%s}.\\[-T\\:\\+Z\\]{--t:+Z}.icon{fill:currentColor;height:1em;overflow:hidden;vertical-align:-.15em;width:1em}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}.focus\\:outline-4:focus{outline-width:4px}";styleInject(css_248z);var extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},extendStatics(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return __assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign.apply(this,arguments)},NEClientType,e;function __awaiter(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function __generator(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function __spreadArray(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}e=NEClientType||(NEClientType={}),e.WEB="web",e.ANDROID="android",e.IOS="ios",e.PC="pc",e.MINIAPP="miniApp",e.MAC="mac",e.SIP="SIP",e.UNKNOWN="unknown";var LevelMap={log:0,trace:1,debug:2,info:3,warn:4,error:5},NERoomEvent,NERoomEventFromServer,NEAuthEvent,NEPreviewDeviceChangeEvent,NERoomChatMessageType,NERoomEndReason,ServiceType,NEErrorCode,NEErrorMessage,OperateCodeForApi;!function(e){e.MEMBER_AUDIO_MUTE_CHANGED="memberAudioMuteChanged",e.MEMBER_JOIN_CHATROOM="memberJoinChatroom",e.MEMBER_JOIN_ROOM="memberJoinRoom",e.MEMBER_JOIN_RTC_CHANNEL="memberJoinRtcChannel",e.MEMBER_LEAVE_CHATROOM="memberLeaveChatroom",e.MEMBER_LEAVE_ROOM="memberLeaveRoom",e.MEMBER_LEAVE_RT_CHANNEL="memberLeaveRtcChannel",e.MEMBER_ROLE_CHANGED="memberRoleChanged",e.MEMBER_SCREEN_SHARE_STATE_CHANGED="memberScreenShareStateChanged",e.MEMBER_VIDEO_MUTE_CHANGED="memberVideoMuteChanged",e.MEMBER_WHITEBOARD_STATE_CHANGED="memberWhiteboardStateChanged",e.MEMBER_WHITEBOARD_PERMISSION_CHANGED="memberWhiteboardPermissionChanged",e.RECEIVE_CHATROOM_MESSAGES="receiveChatroomMessages",e.ROOM_ENDED="roomEnded",e.RTC_CHANNEL_ERROR="rtcChannelError"}(NERoomEvent||(NERoomEvent={})),function(e){e[e.ROOM_STATE_CHANGED=1]="ROOM_STATE_CHANGED",e[e.ROOM_STATE_DELETE=2]="ROOM_STATE_DELETE",e[e.ROOM_PROPERTIES_CHANGED=10]="ROOM_PROPERTIES_CHANGED",e[e.ROOM_PROPERTIES_DELETE=11]="ROOM_PROPERTIES_DELETE",e[e.MEMBER_PROPERTIES_CHANGED=20]="MEMBER_PROPERTIES_CHANGED",e[e.MEMBER_PROPERTIES_DELETE=21]="MEMBER_PROPERTIES_DELETE",e[e.MEMBER_JOIN_ROOM=30]="MEMBER_JOIN_ROOM",e[e.MEMBER_LEAVE_ROOM=33]="MEMBER_LEAVE_ROOM",e[e.MEMBER_JOIN_RTC_ROOM=32]="MEMBER_JOIN_RTC_ROOM",e[e.MEMBER_LEAVE_RTC_ROOM=31]="MEMBER_LEAVE_RTC_ROOM",e[e.MEMBER_JOIN_CHATROOM_ROOM=34]="MEMBER_JOIN_CHATROOM_ROOM",e[e.MEMBER_LEAVE_CHATROOM_ROOM=35]="MEMBER_LEAVE_CHATROOM_ROOM",e[e.MEMBER_STREAM_STATE_CHANGED=40]="MEMBER_STREAM_STATE_CHANGED",e[e.MEMBER_STREAM_STATE_DELETE=41]="MEMBER_STREAM_STATE_DELETE",e[e.MEMBER_STREAM_STATE_INIT=42]="MEMBER_STREAM_STATE_INIT",e[e.MEMBER_ROLE_TYPE_CHANGED=70]="MEMBER_ROLE_TYPE_CHANGED",e[e.MEMBER_NICKNAME_CHANGED=71]="MEMBER_NICKNAME_CHANGED",e[e.ROOM_ENDED=51]="ROOM_ENDED",e[e.PASS_THROUGH_MESSAGE=99]="PASS_THROUGH_MESSAGE",e[e.ROOM_LIVE_STATE_CHANGED=111]="ROOM_LIVE_STATE_CHANGED"}(NERoomEventFromServer||(NERoomEventFromServer={})),function(e){e[e.KICK_OUT=0]="KICK_OUT",e[e.UNAUTHORIZED=1]="UNAUTHORIZED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.ACCOUNT_TOKEN_ERROR=3]="ACCOUNT_TOKEN_ERROR",e[e.LOGGED_IN=4]="LOGGED_IN",e[e.LOGGED_OUT=5]="LOGGED_OUT",e[e.TOKEN_EXPIRED=1026]="TOKEN_EXPIRED",e[e.TOKEN_INCORRECT=1027]="TOKEN_INCORRECT"}(NEAuthEvent||(NEAuthEvent={})),function(e){e[e.ACTIVE=0]="ACTIVE",e[e.INACTIVE=1]="INACTIVE",e[e.CHANGED=2]="CHANGED"}(NEPreviewDeviceChangeEvent||(NEPreviewDeviceChangeEvent={})),function(e){e.TEXT="text",e.IMAGE="image",e.AUDIO="audio",e.VIDEO="video",e.FILE="file",e.GEO="geo",e.CUSTOM="custom",e.TIP="tip",e.NOTIFICATION="notification",e.ATTACHSTR="attachStr"}(NERoomChatMessageType||(NERoomChatMessageType={})),function(e){e.UNKNOWN="UNKNOWN",e.LOGIN_STATE_ERROR="LOGIN_STATE_ERROR",e.CLOSE_BY_BACKEND="CLOSE_BY_BACKEND",e.ALL_MEMBERS_OUT="ALL_MEMBERS_OUT",e.END_OF_LIFE="END_OF_LIFE",e.CLOSE_BY_MEMBER="CLOSE_BY_MEMBER",e.KICK_OUT="KICK_OUT",e.SYNC_DATA_ERROR="SYNC_DATA_ERROR",e.LEAVE_BY_SELF="LEAVE_BY_SELF",e.kICK_BY_SELF="kICK_BY_SELF"}(NERoomEndReason||(NERoomEndReason={})),function(e){e.NEAuthService="authService",e.NERoomService="roomService",e.NEMessageService="messageService"}(ServiceType||(ServiceType={})),function(e){e[e.FAILURE=-1]="FAILURE",e[e.SUCCESS=0]="SUCCESS",e[e.UNAUTHORIZED=402]="UNAUTHORIZED",e[e.TOKEN_EXPIRED=1026]="TOKEN_EXPIRED",e[e.TOKEN_INCORRECT=1027]="TOKEN_INCORRECT",e[e.IM_REUSE_NOT_LOGIN=100004]="IM_REUSE_NOT_LOGIN",e[e.IM_REUSE_ACCOUNT_NOT_MATCH=100005]="IM_REUSE_ACCOUNT_NOT_MATCH"}(NEErrorCode||(NEErrorCode={})),function(e){e.SUCCESS="success",e.FAILURE="failure",e.NOT_SUPPORT="not support",e.NOT_INIT_RTC="not init rtc",e.NOT_INIT_CHATROOM="not init chatroom",e.NOT_JOIN_ROOMKIT="not join roomkit",e.NOT_JOIN_RTC="not join rtc",e.NOT_JOIN_WHITEBOARD="not join whiteboard",e.NOT_INIT_PREVIEW="not init preview",e.NOT_JOIN_CHATROOM="not join chatroom",e.CHATROOM_JOIN_FAIL="join chatroom fail",e.NO_UUID="lack of uuid",e.NO_DEVICEID="no deviceId",e.GET_REMOTE_MEMBER_FAILED_BY_UUID="get remote member fail by uuid",e.NO_MESSAGE_CONTENT="lack of message content",e.NO_APPKEY="lack of appKey",e.NOT_OPEN_VIDEO="not open video",e.NOT_SHARING_SCREEN="Member is not sharing screen",e.MEMBER_IS_EMPTY="Member is empty",e.PARAMS_IS_INCORRECT="params is incorrect"}(NEErrorMessage||(NEErrorMessage={})),function(e){e[e.OPEN=1]="OPEN",e[e.CLOSE=0]="CLOSE"}(OperateCodeForApi||(OperateCodeForApi={}));var NEPrivateError={UID_NOT_FOUND:"uid is not found",MY_UID_NOT_FOUND:"myUid is not found",MY_USERINFO_NOT_FOUND:"my userInfo is not found",USERINFO_NOT_FOUND:"userInfo is not found",NO_IMPLEMENTS:"no implements",MEMBER_CAN_RAISE_UP:"only members can call raiseMyHand",HOST_CAN_LOWERHAND:"only host can call lowerHand",NO_STREAM:"no stream",NOT_LOGIN:"not login"},IM_EVENT,HTTP_EVENT,RTC_EVENT,NEActionType,NEVideoStreamType,NetworkStatus,StreamType,NERoomLiveStreamAudioSampleRate,NERoomLiveStreamAudioCodecProfile,NERoomLiveLayout,NERoomLiveState,NEChatRoomMemberQueryType,Format,NERoomLiveStreamMode,AudioProfile;!function(e){e.CHATROOM_MESSAGE_RECEIVE="chatroomMessagesReceive"}(IM_EVENT||(IM_EVENT={})),function(e){e.UNAUTHORIZED="unauthorized",e.TOKEN_EXPIRED="tokenExpired",e.TOKEN_INCORRECT="tokenIncorrect"}(HTTP_EVENT||(HTTP_EVENT={})),function(e){e.STREAM_ADDED="streamAdded",e.STREAM_REMOVED="streamRemoved",e.STREAM_SUBSCRIBED="streamSubscribed",e.NETWORK_QUALITY="network-quality",e.CLIENT_BANNED="clientBanned",e.CHANNEL_CLOSED="channelClosed",e.CONNECTION_STATE_CHHANGE="connectionStateChange",e.STOP_SCREEN_SHARE="stopScreenShare",e.VOLUME_INDICATOR="volume-indicator",e.PEER_ONLINE="peer-online",e.PEER_LEAVE="peer-leave",e.RTC_STATS="rtcStats",e.ACTIVE_SPEAKER="activeSpeaker",e.DISCONNECTED="disconnected",e.OPEN="open",e.WILLRECONNECT="willreconnect",e.RECONNECTED="reconnected",e.SENDCOMMANDOVERTIME="sendCommandOverTime",e.ERROR="error",e.ROLE_CHANGED="roleChanged",e.SYNCDONE="syncDone",e.MUTE_AUDIO="muteAudio",e.MUTE_VIDEO="muteVideo",e.UNMUTE_VIDEO="unmuteVideo",e.UNMUTE_AUDIO="unmuteAudio",e.ABILITY_NOT_SUPPORT="ability-not-support",e.RECORD_DEVICES_CHANGE="recording-device-changed",e.CAMERA_DEVICE_CHANGE="camera-changed",e.SPEAKER_DEVICE_CHANGE="playout-device-changed",e.CONNECTION_STATE_CHANGE="connection-state-change",e.VIDEO_TRACK_ENDED="videoTrackEnded",e.MINIAPP_STREAM_CHANGED="miniapp-stream-changed",e.ACCESS_DENIED="accessDenied",e.UNMUTE_SCREEN="unmute-screen",e.NOTALLOWEDERROR="notAllowedError"}(RTC_EVENT||(RTC_EVENT={})),function(e){e[e.kickout=0]="kickout",e[e.muteVideo=10]="muteVideo",e[e.muteAudio=11]="muteAudio",e[e.muteAllAudio=12]="muteAllAudio",e[e.lockRoom=13]="lockRoom",e[e.unmuteVideo=15]="unmuteVideo",e[e.unmuteAudio=16]="unmuteAudio",e[e.unmuteAllAudio=17]="unmuteAllAudio",e[e.unlockRoom=18]="unlockRoom",e[e.muteAllVideo=20]="muteAllVideo",e[e.unmuteAllVideo=21]="unmuteAllVideo",e[e.changeHost=22]="changeHost",e[e.focusVideo=30]="focusVideo",e[e.unfocusVideo=31]="unfocusVideo",e[e.hangUp=32]="hangUp",e[e.unHangUp=33]="unHangUp",e[e.forceMuteAllAudio=40]="forceMuteAllAudio",e[e.acceptHandsUp=41]="acceptHandsUp",e[e.rejectHandsUp=42]="rejectHandsUp",e[e.muteVideoBySelf=50]="muteVideoBySelf",e[e.muteAudioBySelf=51]="muteAudioBySelf",e[e.stopScreenShareBySelf=52]="stopScreenShareBySelf",e[e.stopScreenShare=53]="stopScreenShare",e[e.unmuteVideoBySelf=55]="unmuteVideoBySelf",e[e.unmuteAudioBySelf=56]="unmuteAudioBySelf",e[e.startScreenShareBySelf=57]="startScreenShareBySelf",e[e.handsUp=58]="handsUp",e[e.unHandsUp=59]="unHandsUp",e[e.startWhiteBoard=60]="startWhiteBoard",e[e.stopWhiteBoard=61]="stopWhiteBoard",e[e.enableWhiteBoard=62]="enableWhiteBoard",e[e.disableWhiteBoard=63]="disableWhiteBoard",e[e.common=66]="common",e[e.transformAudioToVideo=67]="transformAudioToVideo",e[e.transformVideoToAudio=68]="transformVideoToAudio",e[e.audioStateChanged=100]="audioStateChanged",e[e.videoStateChanged=101]="videoStateChanged",e[e.focusVideoChanged=102]="focusVideoChanged",e[e.hostChanged=103]="hostChanged",e[e.roleTypeChanged=23]="roleTypeChanged",e[e.roomNameChanged=104]="roomNameChanged",e[e.screenShareChanged=105]="screenShareChanged",e[e.memberComeBack=106]="memberComeBack",e[e.lockStateChanged=107]="lockStateChanged",e[e.memberKickedOut=108]="memberKickedOut",e[e.kickedOutByOtherClient=109]="kickedOutByOtherClient",e[e.roomInfoChanged=110]="roomInfoChanged",e[e.memberHandsUp=111]="memberHandsUp",e[e.passwordChangedByOtherClient=1e3]="passwordChangedByOtherClient"}(NEActionType||(NEActionType={})),function(e){e[e.HIGH=0]="HIGH",e[e.LOW=1]="LOW"}(NEVideoStreamType||(NEVideoStreamType={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.EXCELLENT=1]="EXCELLENT",e[e.GOOD=2]="GOOD",e[e.POOR=3]="POOR",e[e.BAD=4]="BAD",e[e.VERYBAD=5]="VERYBAD",e[e.DOWN=6]="DOWN"}(NetworkStatus||(NetworkStatus={})),function(e){e.AUDIO_DEVICE="audio_device",e.VIDEO_DEVICE="video_device",e.AUDIO="audio",e.VIDEO="video",e.SUB_VIDEO="subVideo"}(StreamType||(StreamType={})),function(e){e[e.SAMPLE_RATE_32000=32e3]="SAMPLE_RATE_32000",e[e.SAMPLE_RATE_44100=44100]="SAMPLE_RATE_44100",e[e.SAMPLE_RATE_48000=48e3]="SAMPLE_RATE_48000"}(NERoomLiveStreamAudioSampleRate||(NERoomLiveStreamAudioSampleRate={})),function(e){e[e["LC-AAC"]=0]="LC-AAC",e[e["HE-AAC"]=1]="HE-AAC"}(NERoomLiveStreamAudioCodecProfile||(NERoomLiveStreamAudioCodecProfile={})),function(e){e[e.NONE=0]="NONE",e[e.GALLERY=1]="GALLERY",e[e.FOCUS=2]="FOCUS",e[e.SCREEN_SHARE=4]="SCREEN_SHARE"}(NERoomLiveLayout||(NERoomLiveLayout={})),function(e){e[e.INVALID=0]="INVALID",e[e.INIT=1]="INIT",e[e.STARTED=2]="STARTED",e[e.ENDED=3]="ENDED"}(NERoomLiveState||(NERoomLiveState={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.ONLINE_NORMAL=1]="ONLINE_NORMAL",e[e.GUEST_DESC=2]="GUEST_DESC",e[e.GUEST_ASC=3]="GUEST_ASC"}(NEChatRoomMemberQueryType||(NEChatRoomMemberQueryType={})),function(e){e[e.I420=0]="I420",e[e.NV21=1]="NV21",e[e.RGBA=2]="RGBA",e[e.TEXTURE_OES=3]="TEXTURE_OES",e[e.TEXTURE_RGB=4]="TEXTURE_RGB"}(Format||(Format={})),function(e){e[e.ModeVideo=0]="ModeVideo",e[e.ModeAudio=1]="ModeAudio"}(NERoomLiveStreamMode||(NERoomLiveStreamMode={})),function(e){e.speech_low_quality="speech_low_quality",e.speech_standard="speech_standard",e.music_standard="music_standard",e.standard_stereo="standard_stereo",e.high_quality="high_quality",e.high_quality_stereo="high_quality_stereo"}(AudioProfile||(AudioProfile={}));var RTC=function(){function e(e){this.debug=!1,this.nrtcAppKey="",this.enableExternalVideo=!1,this.logger=e.logger,this.debug=e.debug,this.emitter=e.emitter}return e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];(t=this.emitter).emit.apply(t,__spreadArray([e],__read(r),!1))},e.prototype.setExternalVideoSource=function(e){this.externalVideoSource=e},e.prototype.setEnableExternalVideo=function(e){this.enableExternalVideo=e},e}();function SuccessBody(e,t){return{code:NEErrorCode.SUCCESS,message:t||NEErrorMessage.SUCCESS,data:e}}function FailureBody(e,t,r){if(e){if(e.code)throw{code:r||e.code,message:e.msg||e.message||NEErrorMessage.FAILURE};throw{code:r||NEErrorCode.FAILURE,message:t||NEErrorMessage.FAILURE,data:e}}throw{code:r||NEErrorCode.FAILURE,message:t||NEErrorMessage.FAILURE}}function FailureBodySync(e,t,r){return e?e.code?{code:r||e.code,message:e.msg||NEErrorMessage.FAILURE,data:e}:{code:r||NEErrorCode.FAILURE,message:t||NEErrorMessage.FAILURE,data:e}:{code:r||NEErrorCode.FAILURE,message:t||NEErrorMessage.FAILURE,data:null}}var NEBaseController=function(e){this.isSupported=!1,this.isSupported=e.isSupported},NERoomRtcBaseController=function(e){function t(t){var r=this;return t.rtc?((r=e.call(this,{isSupported:t.isSupported})||this).isSupported=t.isSupported,r.logger=t.logger,r._rtc=t.rtc,r._token=t.token,r):(t.isSupported=!1,r)}return __extends(t,e),t.prototype.setupLocalVideoCanvas=function(e){return this.isSupported?this._isInit?(this._rtc.setupLocalVideoCanvas(e),0):(console.error(NEErrorMessage.NOT_INIT_RTC),-1):(console.error(NEErrorMessage.NOT_SUPPORT),-1)},t.prototype.enumRecordDevices=function(){return this._rtc.getMicrophones().then((function(e){return SuccessBody(e.map((function(e){return{deviceId:e.deviceId,deviceName:e.label}})))}))},t.prototype.enumCameraDevices=function(){return this._rtc.getCameras().then((function(e){return SuccessBody(e.map((function(e){return{deviceId:e.deviceId,deviceName:e.label}})))}))},t.prototype.enumPlayoutDevices=function(){return this._rtc.getSpeakers().then((function(e){return SuccessBody(e.map((function(e){return{deviceId:e.deviceId,deviceName:e.label}})))}))},t.prototype.getSelectedRecordDevice=function(){return this._rtc.getMicId()},t.prototype.getSelectedCameraDevice=function(){return this._rtc.getCameraId()},t.prototype.getSelectedPlayoutDevice=function(){return this._rtc.getSpeakerId()},t.prototype.switchDevice=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n;return __generator(this,(function(i){switch(i.label){case 0:this.logger.log("switchDevice",e),i.label=1;case 1:return i.trys.push([1,3,,9]),[4,this._rtc.switchDevice({type:e.type,deviceId:e.deviceId})];case 2:return t=i.sent(),this.logger.log("switchDevice success ",t),[2,t];case 3:if(r=i.sent(),"camera"!==(null==e?void 0:e.type))return[3,8];i.label=4;case 4:return i.trys.push([4,7,,8]),[4,this._rtc.close("video")];case 5:return i.sent(),[4,this._rtc.open("video",!0,null==e?void 0:e.deviceId)];case 6:return i.sent(),[2,SuccessBody({type:null==e?void 0:e.type,deviceId:null==e?void 0:e.deviceId})];case 7:throw n=i.sent(),new Error(n);case 8:throw new Error(r);case 9:return[2]}}))}))},t.prototype.setSelectedRecordDevice=function(e){return this.switchDevice({deviceId:e,type:"microphone"})},t.prototype.setSelectedCameraDevice=function(e){return this.switchDevice({deviceId:e,type:"camera"})},t.prototype.setSelectedPlayoutDevice=function(e){return this.switchDevice({deviceId:e,type:"speaker"})},t}(NEBaseController),NERoomRtcController=function(e){function t(r){var n=e.call(this,{rtc:r.rtc,isSupported:!!r.rtc,token:r.token,logger:r.logger})||this;if(n.isSupported=!1,n._subscribedStreamMap=new Map,n._subscribedSubStreamMap=new Map,n._subscribeAudioStreamMap=new Map,n._videoProfile={resolution:480,frameRate:15},n._audioProfile=AudioProfile.speech_standard,!(r.rtc&&r.appKey&&r.channelName&&r.cid))return n.isSupported=!1,n;n._privateRtcConfig=r.privateRtcConfig,n._emitter=r.emitter,n._isInit=!0,n.logger=r.logger,n.logger.log(t.TAG_NAME,"constructor",r),n.isSupported=!0,n._screenSharingUserUuid=r.screenSharingUserUuid,n._localMember=r.member;var i=n._localMember.role;if(i&&i.params&&i.params.video){var o=i.params.video.height,a=i.params.video.fps;n._videoProfile.resolution=o||480,n._videoProfile.frameRate=a||15}return i&&i.params&&i.params.audio&&(n._audioProfile=i.params.audio.profile||AudioProfile.speech_standard),n._setMemberIsInClientRtc=r.setMemberIsInClientRtc,n._rtc=r.rtc,n._appKey=r.appKey,n._request=r.request,n._channelName=r.channelName,n._token=r.token,n._uid=r.uid,n._remoteMemberMap=r.remoteMemberMap,n}return __extends(t,e),t.prototype.stopMemberScreenShare=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){return e?(t=this.getScreenSharingUserUuid())&&t==e?this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.stopScreenShare()]:[2,this._changeMemberStream(e,StreamType.SUB_VIDEO,!1)]:[2,FailureBodySync(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)]:[2,FailureBody(null,"".concat(e,">").concat(t," ").concat(NEErrorMessage.NOT_SHARING_SCREEN))]:[2,FailureBody(null,NEErrorMessage.MEMBER_IS_EMPTY)]}))}))},t.prototype.muteMemberAudio=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.muteMyAudio()]:[2,this._changeMemberStream(e,StreamType.AUDIO,!1)]:[2,FailureBodySync(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)]}))}))},t.prototype.muteMemberVideo=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.muteMyVideo()]:[2,this._changeMemberStream(e,StreamType.VIDEO,!1)]:[2,FailureBodySync(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)]}))}))},t.prototype.unmuteMemberAudio=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.unmuteMyAudio()]:[2,this._changeMemberStream(e,StreamType.AUDIO,!0)]:[2,FailureBodySync(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)]}))}))},t.prototype.unmuteMemberVideo=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.unmuteMyVideo()]:[2,this._changeMemberStream(e,StreamType.VIDEO,!0)]:[2,FailureBodySync(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)]}))}))},t.prototype.joinRtcChannel=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(this._isJoined)return this.logger.warn("已加入rtcChannel 请勿重复加入"),[2,SuccessBody(null)];this.logger.log(t.TAG_NAME,"joinRtcChannel",this._uid,this._token),e.label=1;case 1:return e.trys.push([1,4,,5]),this._rtc.init({nrtcAppKey:this._appKey,neRtcServerAddresses:this._privateRtcConfig}),this._addRtcListener(),this._rtc.setProfile({videoProfile:{resolution:this._videoProfile.resolution,frameRate:this._videoProfile.frameRate},screenProfile:{resolution:1080,frameRate:5},audioProfile:this._audioProfile}),this._isJoined=!0,[4,this._request.joinRtcChannelApi(this._channelName)];case 2:return e.sent(),[4,this._rtc.joinRtcChannel({channelName:this._channelName,uid:this._uid,token:this._token})];case 3:return e.sent(),[2,SuccessBody(null)];case 4:return[2,FailureBody(e.sent())];case 5:return[2]}}))}))},t.prototype.leaveRtcChannel=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];this.logger.log(t.TAG_NAME,"leaveRtcChannel",this._channelName),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.leaveRtcChannelApi(this._channelName)];case 2:return e.sent(),[4,this._rtc.leaveRtcChannel()];case 3:return e.sent(),this._resetState(),[2,SuccessBody(null)];case 4:return[2,FailureBody(e.sent(),NEErrorMessage.FAILURE)];case 5:return[2]}}))}))},t.prototype.setRemoteMemberMap=function(e){return this._remoteMemberMap=e,SuccessBody(null)},t.prototype.setLocalMember=function(e){return this._localMember=e,SuccessBody(null)},t.prototype.setScreenSharingUserUuid=function(e){this._screenSharingUserUuid=e},t.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._rtc.leaveRtcChannel()];case 2:return e.sent(),this._resetState(),this._isInit=!1,[2,SuccessBody(null)];case 3:return[2,FailureBody(e.sent(),NEErrorMessage.FAILURE)];case 4:return[2]}}))}))},t.prototype.muteMyAudio=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.changeMemberStreamsApi({isOpen:!1,roomUuid:this._channelName,streamKey:StreamType.AUDIO,userUuid:this._localMember.uuid})];case 2:return e.sent(),[4,this._rtc.close("audio")];case 3:return e.sent(),[2,SuccessBody(null)];case 4:return[2,FailureBody(e.sent())];case 5:return[2]}}))}))},t.prototype.operateStream=function(e,t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){return t?[2,this._rtc.open(e)]:[2,this._rtc.close(e)]}))}))},t.prototype.playLocalStream=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!this._localMember.isVideoOn&&"video"===e)return[2,FailureBody(null,NEErrorMessage.NOT_OPEN_VIDEO)];t.label=1;case 1:return t.trys.push([1,6,,7]),"screen"===e?[3,3]:[4,this._rtc.playLocalStream(e,{audio:"audio"===e,video:"video"===e,screen:!1})];case 2:return t.sent(),[3,5];case 3:return[4,this._rtc.playLocalSubStream()];case 4:t.sent(),t.label=5;case 5:return[2,SuccessBody(null)];case 6:return[2,FailureBody(t.sent())];case 7:return[2]}}))}))},t.prototype.muteMyVideo=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.changeMemberStreamsApi({isOpen:!1,roomUuid:this._channelName,streamKey:StreamType.VIDEO,userUuid:this._localMember.uuid})];case 2:return e.sent(),[4,this._rtc.close("video")];case 3:return e.sent(),[2,SuccessBody(null)];case 4:return[2,FailureBody(e.sent())];case 5:return[2]}}))}))},t.prototype.setupLocalVideoCanvas=function(e){return this.isSupported?this._isInit?(this._rtc.setupLocalVideoCanvas(e),0):(console.error(NEErrorMessage.NOT_INIT_RTC),-1):(console.error(NEErrorMessage.NOT_SUPPORT),-1)},t.prototype.setupRemoteVideoSubStreamCanvas=function(e,r){var n=this._getRtcUidByUuid(r);if(!n)return console.error(NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID),-1;if(this.logger.log(t.TAG_NAME,"setupRemoteVideoSubStreamCanvas",r,n),this._rtc.setupRemoteSubVideoCanvas(e,n),this._subscribedSubStreamMap.has(n)){var i=this._subscribedSubStreamMap.get(n);i&&i.isSubscribed&&i.streamObj&&this._playRemoteSubStream(i.streamObj.stream,n)}return 0},t.prototype.getLocalAudioStats=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._rtc.getLocalAudioStats().then((function(e){if(e&&e[0]){var t=e[0];return{codecType:t.CodecType,muteState:t.MuteState,recordingLevel:t.RecordingLevel,samplingRate:t.SamplingRate,sendBitrate:t.SendBitrate,sendLevel:t.SendLevel}}return{codecType:"",muteState:!1,recordingLevel:0,samplingRate:0,sendBitrate:0,sendLevel:0}}))]}))}))},t.prototype.getLocalVideoStats=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._rtc.getLocalVideoStats().then((function(e){var t=[];for(var r in e){var n=e[r];t.push({layerType:n.LayerType,captureFrameRate:n.CaptureFrameRate,captureResolutionHeight:n.CaptureResolutionHeight,captureResolutionWidth:n.CaptureResolutionWidth,encodeDelay:n.EncodeDelay,muteState:n.MuteState,sendBitrate:n.SendBitrate,sendFrameRate:n.SendFrameRate,sendResolutionHeight:n.SendResolutionHeight,sendResolutionWidth:n.SendResolutionWidth,targetSendBitrate:n.TargetSendBitrate,totalDuration:n.TotalDuration,totalFreezeTime:n.TotalFreezeTime})}return t}))]}))}))},t.prototype.getRemoteAudioStats=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._rtc.getRemoteAudioStats().then((function(e){var t=[];for(var r in e){var n=e[r];t.push({codecType:n.CodecType,end2EndDelay:n.End2EndDelay,muteState:n.MuteState,packetLossRate:n.PacketLossRate,recvBitrate:n.RecvBitrate,recvLevel:n.RecvLevel,totalFreezeTime:n.TotalFreezeTime,totalPlayDuration:n.TotalPlayDuration,transportDelay:n.TransportDelay})}return t}))]}))}))},t.prototype.getRemoteVideoStats=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,r;return __generator(this,(function(n){switch(n.label){case 0:return e=[],[4,this._rtc.getRemoteVideoStats("video")];case 1:return t=n.sent(),[4,this._rtc.getRemoteVideoStats("screen")];case 2:return r=n.sent(),Object.keys(t).forEach((function(n){var i=[];t[n]&&i.push(t[n]),r[n]&&i.push(r[n]),e.push({userUuid:n,layers:i})})),[2,e]}}))}))},t.prototype.getSessionStats=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._rtc.getSessionStats().then((function(e){return{duration:e.Duration,recvBitrate:e.RecvBitrate,recvBytes:e.RecvBytes,sendBitrate:e.SendBitrate,sendBytes:e.SendBytes,userCount:e.UserCount}}))]}))}))},t.prototype.setupRemoteVideoCanvas=function(e,r){var n=this._getRtcUidByUuid(r);if(!n)return console.error(NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID),-1;if(this.logger.log(t.TAG_NAME,"setupRemoteVideoCanvas",r,n),n&&this._rtc.setupRemoteVideoCanvas(e,n),this._subscribedStreamMap.has(n)){var i=this._subscribedStreamMap.get(n);i&&i.isSubscribed&&i.streamObj&&this._playRemoteStream(i.streamObj.stream,n,"video")}return 0},t.prototype.setupRemoteStreamContext=function(e,r,n){var i=this._getRtcUidByUuid(e);if(!i)return this.logger.error(NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID),-1;if(this.logger.log(t.TAG_NAME,"setupRemoteStreamContext",e,i,r),i&&this._rtc.setupRemoteStreamContext({context:n,rtcUid:i,mediaType:r}),this._subscribedStreamMap.has(i)){var o=this._subscribedStreamMap.get(i);o&&o.isSubscribed&&o.streamObj&&this._rtc.playRemoteStream({stream:o.streamObj.stream,uid:i,type:r})}return 0},t.prototype.startScreenShare=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];r.label=1;case 1:return r.trys.push([1,10,,13]),e?[4,this.setLocalScreenProfile(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[4,this._rtc.open("screen")];case 4:return r.sent(),this._rtc.localStream?this._rtc.localStream.hasScreen()?[4,this._request.changeMemberStreamsApi({isOpen:!0,roomUuid:this._channelName,streamKey:StreamType.SUB_VIDEO,userUuid:this._localMember.uuid})]:[3,6]:[3,8];case 5:return r.sent(),[2,SuccessBody(null)];case 6:return[2,FailureBody("open screenShare failed")];case 7:return[3,9];case 8:return[2,SuccessBody(null)];case 9:return[3,13];case 10:return(t=r.sent()).code&&41009!=t.code?[4,this._rtc.close("screen")]:[3,12];case 11:r.sent(),r.label=12;case 12:return[2,FailureBody(t)];case 13:return[2]}}))}))},t.prototype.stopScreenShare=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.changeMemberStreamsApi({isOpen:!1,roomUuid:this._channelName,streamKey:StreamType.SUB_VIDEO,userUuid:this._localMember.uuid})];case 2:return e.sent(),[4,this._rtc.close("screen")];case 3:return e.sent(),[2,SuccessBody(null)];case 4:return[2,FailureBody(e.sent())];case 5:return[2]}}))}))},t.prototype.subscribeRemoteVideoSubStream=function(e){return __awaiter(this,void 0,void 0,(function(){var r,n;return __generator(this,(function(i){switch(i.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];i.label=1;case 1:return i.trys.push([1,5,,6]),this.logger.log(t.TAG_NAME,"subscribeRemoteVideoSubStream",e),(r=this._getRtcUidByUuid(e))?(n=this._subscribedSubStreamMap.get(r))&&n.streamObj?(n.isSubscribed=!0,this._subscribedSubStreamMap.set(r,n),[4,this._subscribeStream(n.streamObj.stream,!0,"screen",r)]):[3,3]:[2,FailureBody(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)];case 2:return i.sent(),[3,4];case 3:this._subscribedSubStreamMap.set(r,{isSubscribed:!0,streamObj:null}),i.label=4;case 4:return[2,SuccessBody(null)];case 5:return[2,FailureBody(i.sent())];case 6:return[2]}}))}))},t.prototype.unsubscribeRemoteVideoSubStream=function(e){return __awaiter(this,void 0,void 0,(function(){var r,n;return __generator(this,(function(i){switch(i.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];if(this.logger.log(t.TAG_NAME,"unsubscribeRemoteVideoSubStream"),!(r=this._getRtcUidByUuid(e)))return[2,FailureBody(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)];if(!(n=this._subscribedSubStreamMap.get(r)))return[3,5];if(!n.isSubscribed||!n.streamObj)return[3,4];this._rtc.stopPlayingRemoteStream("screen",n.streamObj.stream),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._subscribeStream(n.streamObj.stream,!1,"screen",r)];case 2:return i.sent(),[3,4];case 3:return[2,FailureBody(i.sent())];case 4:return n.isSubscribed=!1,this._subscribedSubStreamMap.set(r,n),[2,SuccessBody(null)];case 5:return console.warn("之前未订阅无须取消"),[2,SuccessBody(null)]}}))}))},t.prototype.subscribeRemoteVideoStream=function(e,r){return __awaiter(this,void 0,void 0,(function(){var n,i;return __generator(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];o.label=1;case 1:return o.trys.push([1,5,,6]),this.logger.log(t.TAG_NAME,"subscribeRemoteVideoStream",e),(n=this._getRtcUidByUuid(e))?(i=this._subscribedStreamMap.get(n))&&i.streamObj?(i.isSubscribed=!0,i.streamType=r,this._subscribedStreamMap.set(Number(n),i),[4,this._subscribeStream(i.streamObj.stream,!0,"video",n,r)]):[3,3]:[2,FailureBody(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)];case 2:return o.sent(),[3,4];case 3:this._subscribedStreamMap.set(Number(n),{isSubscribed:!0,streamObj:null,streamType:r}),o.label=4;case 4:return[2,SuccessBody(null)];case 5:return[2,FailureBody(o.sent())];case 6:return[2]}}))}))},t.prototype.unsubscribeRemoteVideoStream=function(e,r){return __awaiter(this,void 0,void 0,(function(){var r,n;return __generator(this,(function(i){switch(i.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];if(this.logger.log(t.TAG_NAME,"unsubscribeRemoteVideoStream",e),!(r=this._getRtcUidByUuid(e)))return[2,FailureBody(null,NEErrorMessage.GET_REMOTE_MEMBER_FAILED_BY_UUID)];if(!(n=this._subscribedStreamMap.get(r)))return[3,5];if(!n.isSubscribed||!n.streamObj)return[3,4];console.log("取消订阅的流",n.streamObj),this._rtc.stopPlayingRemoteStream("video",n.streamObj.stream),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._subscribeStream(n.streamObj.stream,!1,"video",r)];case 2:return i.sent(),[3,4];case 3:return[2,FailureBody(i.sent())];case 4:return n.isSubscribed=!1,this._subscribedStreamMap.set(r,n),[2,SuccessBody(null)];case 5:return console.warn("之前未订阅无须取消",r),[2,SuccessBody(null)]}}))}))},t.prototype.switchDevice=function(e){return __awaiter(this,void 0,void 0,(function(){var r,n,i;return __generator(this,(function(o){switch(o.label){case 0:this.logger.log(t.TAG_NAME,"switchDevice",e),o.label=1;case 1:return o.trys.push([1,3,,9]),[4,this._rtc.switchDevice({type:e.type,deviceId:e.deviceId})];case 2:return r=o.sent(),this.logger.log(t.TAG_NAME,"switchDevice success ",r),[2,r];case 3:if(n=o.sent(),"camera"!==(null==e?void 0:e.type))return[3,8];o.label=4;case 4:return o.trys.push([4,7,,8]),[4,this._rtc.close("video")];case 5:return o.sent(),[4,this._rtc.open("video",!0,null==e?void 0:e.deviceId)];case 6:return o.sent(),[2,SuccessBody({type:null==e?void 0:e.type,deviceId:null==e?void 0:e.deviceId})];case 7:throw i=o.sent(),new Error(i);case 8:throw new Error(n);case 9:return[2]}}))}))},t.prototype.unmuteMyAudio=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.changeMemberStreamsApi({isOpen:!0,roomUuid:this._channelName,streamKey:StreamType.AUDIO,userUuid:this._localMember.uuid})];case 2:return e.sent(),[4,this._rtc.open("audio")];case 3:return e.sent(),[2,SuccessBody(null)];case 4:return e.sent(),[2,FailureBody()];case 5:return[2]}}))}))},t.prototype.unmuteMyVideo=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.changeMemberStreamsApi({isOpen:!0,roomUuid:this._channelName,streamKey:StreamType.VIDEO,userUuid:this._localMember.uuid})];case 2:return e.sent(),[4,this._rtc.open("video")];case 3:return e.sent(),[2,SuccessBody(null)];case 4:return[2,FailureBody(e.sent())];case 5:return[2]}}))}))},t.prototype.getScreenSharingUserUuid=function(){return this._screenSharingUserUuid},t.prototype.setLocalAudioProfile=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];this.logger.log(t.TAG_NAME,"setLocalAudioProfile",e),r.label=1;case 1:return r.trys.push([1,7,,8]),this._localMember.isAudioOn?[4,this._rtc.close("audio")]:[3,5];case 2:return r.sent(),[4,this._rtc.setAudioProfile(e)];case 3:return r.sent(),[4,this._rtc.open("audio")];case 4:return r.sent(),[3,6];case 5:this._rtc.setAudioProfile(e),r.label=6;case 6:return[2,SuccessBody(null)];case 7:return[2,FailureBody(r.sent())];case 8:return[2]}}))}))},t.prototype.setLocalVideoConfig=function(e){return __awaiter(this,void 0,void 0,(function(){var r,n,i;return __generator(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];this._isJoined||this.logger.warn(NEErrorMessage.NOT_JOIN_RTC),this.logger.log(t.TAG_NAME,"setLocalVideoProfile",e),this._videoProfile=__assign(__assign({},this._videoProfile),e),r=this._videoProfile,n=r.resolution,i=r.frameRate,o.label=1;case 1:return o.trys.push([1,6,,7]),this._localMember.isVideoOn?[4,this._rtc.close("video")]:[3,4];case 2:return o.sent(),this._rtc.setVideoProfile(n,i),[4,this._rtc.open("video")];case 3:return o.sent(),[3,5];case 4:this._rtc.setVideoProfile(n,i),o.label=5;case 5:return[2,SuccessBody(null)];case 6:return[2,FailureBody(o.sent())];case 7:return[2]}}))}))},t.prototype.setLocalScreenProfile=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_RTC)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_RTC)];this.logger.log(t.TAG_NAME,"setLocalScreenProfile",e);try{return this._rtc.setScreenProfile(e.resolution,e.frameRate),[2,SuccessBody(null)]}catch(e){return[2,FailureBody(e)]}return[2]}))}))},t.prototype.addLiveStreamTask=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(!e.layout)throw new Error("liveStreamTaskInfo ".concat(NEErrorMessage.PARAMS_IS_INCORRECT));t=this._liveStreamTaskInfo2RtcTask(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._rtc.addTasks({rtmpTasks:[t]})];case 2:return r.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(r.sent())];case 4:return[2]}}))}))},t.prototype.updateLiveStreamTask=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:t=this._liveStreamTaskInfo2RtcTask(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._rtc.updateTasks({rtmpTasks:[t]})];case 2:return r.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(r.sent())];case 4:return[2]}}))}))},t.prototype.removeLiveStreamTask=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!e)return[2,FailureBody(null,NEErrorMessage.PARAMS_IS_INCORRECT)];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._rtc.deleteTasks({taskIds:[e]})];case 2:return t.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(t.sent())];case 4:return[2]}}))}))},t.prototype.enableEarBack=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),this._localMember.isAudioOn?(this.logger.log(t.TAG_NAME,"enableEarBack",e),[4,this._rtc.playLocalStream("audio",{audio:!0})]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2,SuccessBody(null)];case 3:return[2,FailureBody(r.sent())];case 4:return[2]}}))}))},t.prototype.disableEarBack=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),this._localMember.isAudioOn?(this.logger.log(t.TAG_NAME,"disableEarBack"),[4,this._rtc.stopLocalStream("audio")]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2,SuccessBody(null)];case 3:return[2,FailureBody(e.sent())];case 4:return[2]}}))}))},t.prototype.playEffect=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t.playbackVolume&&0!==t.playbackVolume&&this._rtc.setEffectsVolume(t.playbackVolume),[4,this._rtc.playEffect({soundId:e,filePath:t.path,cycle:t.loopCount})];case 1:return r.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(r.sent())];case 3:return[2]}}))}))},t.prototype.setAudioMixingPlaybackVolume=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rtc.adjustAudioMixingVolume(e)];case 1:return t.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(t.sent())];case 3:return[2]}}))}))},t.prototype.setEffectSendVolume=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rtc.setEffectsVolume(e)];case 1:return t.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(t.sent())];case 3:return[2]}}))}))},t.prototype.startAudioMixing=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:e.playbackVolume||0===e.playbackVolume||(e.playbackVolume=100),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._rtc.startAudioMixing({audioFilePath:e.path,auidoMixingEnd:e.audioMixingEnd||null,cycle:e.loopCount||0,loopback:e.loopback,playStartTime:e.playStartTime||0,replace:e.replace,volume:e.playbackVolume})];case 2:return t.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(t.sent())];case 4:return[2]}}))}))},t.prototype.stopAllEffects=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._rtc.stopAllEffects()];case 1:return e.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(e.sent())];case 3:return[2]}}))}))},t.prototype.stopAudioMixing=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._rtc.stopAudioMixing()];case 1:return e.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(e.sent())];case 3:return[2]}}))}))},t.prototype.stopEffect=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rtc.stopEffect(e)];case 1:return t.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(t.sent())];case 3:return[2]}}))}))},t.prototype.pushExternalVideoFrame=function(e){return e?(this._rtc.setExternalVideoSource(e),0):(this.logger.warn("videoSource is required"),-1)},t.prototype.seExternalVideoSource=function(e){return this._rtc.setEnableExternalVideo(e),0},t.prototype._getRtcUidByUuid=function(e){var t;if(this._localMember.uuid===e?t=this._localMember:this._remoteMemberMap.has(e)&&(t=this._remoteMemberMap.get(e)),t)return t.rtcUid?Number(t.rtcUid):t.rtcUid;this.logger.error("getRtcUidByUuid: ".concat(e," not in the remoteMemberMap"),this._remoteMemberMap)},t.prototype._getUuidByRtcUid=function(e){var t,r,n="";if(this._localMember.rtcUid===+e)n=this._localMember.uuid;else try{for(var i=__values(this._remoteMemberMap.values()),o=i.next();!o.done;o=i.next()){var a=o.value;if(a.rtcUid===+e){n=a.uuid;break}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},t.prototype.stopPlayingRemoteStream=function(e,t){var r=this._getRtcUidByUuid(t);if(r){var n=this._subscribedSubStreamMap.get(r);n&&n.streamObj&&this._rtc.stopPlayingRemoteStream(e,n.streamObj.stream)}},t.prototype.replayRemoteStream=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n;return __generator(this,(function(i){if(t=e.userUuid,!(r=this._getRtcUidByUuid(t)))return[2,FailureBody("该用户不存在")];try{return console.log("音频流map",this._subscribeAudioStreamMap),this._subscribeAudioStreamMap.has(r)&&(n=this._subscribeAudioStreamMap.get(r))&&n.stream&&n.stream.resume(),[2,SuccessBody(null)]}catch(e){return[2,FailureBody(e)]}return[2]}))}))},t.prototype._subscribeStream=function(e,t,r,n,i){return __awaiter(this,void 0,void 0,(function(){var o,a,s,c,u;return __generator(this,(function(l){switch(l.label){case 0:return l.trys.push([0,5,,6]),t?(o=void 0,"audio"===r?(a=this._subscribedSubStreamMap.get(n),s=this._subscribedStreamMap.get(n),o={audio:!0,screen:Boolean(a&&a.isSubscribed&&a.streamObj),video:Boolean(s&&s.isSubscribed&&s.streamObj)}):"video"===r?(a=this._subscribedSubStreamMap.get(n),o={video:!0,audio:!0,screen:Boolean(a&&a.isSubscribed&&a.streamObj),highOrLow:i}):(s=this._subscribedStreamMap.get(n),o={screen:!0,video:Boolean(s&&s.isSubscribed&&s.streamObj),audio:!0}),[4,this._rtc.subscribe(e,o,{mediaType:r,rtcUid:n})]):[3,2];case 1:return l.sent(),[3,4];case 2:return[4,this._rtc.subscribe(e,(u={},u[r]=!1,u),{mediaType:r,rtcUid:n,unsubscribe:!0})];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:return c=l.sent(),[2,Promise.reject(c)];case 6:return[2]}}))}))},t.prototype._playRemoteStream=function(e,t,r){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._rtc.playRemoteStream({stream:e,uid:t,type:r})];case 1:return n.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(n.sent())];case 3:return[2]}}))}))},t.prototype._changeMemberStream=function(e,t,r){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._request.changeMemberStreamsApi({roomUuid:this._channelName,userUuid:e,streamKey:t,isOpen:r})];case 1:return[2,SuccessBody(n.sent())];case 2:return[2,FailureBody(n.sent())];case 3:return[2]}}))}))},t.prototype._resetState=function(){this._subscribedStreamMap.clear(),this._subscribedSubStreamMap.clear(),this._subscribeAudioStreamMap.clear(),this._isJoined=!1,this._removeListener()},t.prototype._addRtcListener=function(){var e=this;return this.isSupported?this._isInit?(this._rtc.on(RTC_EVENT.STREAM_ADDED,(function(r){return __awaiter(e,void 0,void 0,(function(){var e,n;return __generator(this,(function(i){switch(i.label){case 0:return this.logger.log(t.TAG_NAME,"STREAM_ADDED",r),(e=r.stream.streamID)===this._localMember.rtcUid?[2]:"video"!==r.mediaType?[3,4]:(n=this._subscribedStreamMap.get(e))&&n.isSubscribed?(n.streamObj=r,this._subscribedStreamMap.set(e,n),[4,this._subscribeStream(r.stream,!0,"video",e,n.streamType)]):[3,2];case 1:return i.sent(),[3,3];case 2:this._subscribedStreamMap.set(e,{isSubscribed:!1,streamType:NEVideoStreamType.HIGH,streamObj:r}),i.label=3;case 3:return[3,9];case 4:return"audio"!==r.mediaType?[3,6]:(console.log("音频自动订阅"),[4,this._subscribeStream(r.stream,!0,"audio",e)]);case 5:return i.sent(),[3,9];case 6:return(n=this._subscribedSubStreamMap.get(e))&&n.isSubscribed?(n.streamObj=r,this._subscribedSubStreamMap.set(e,n),[4,this._subscribeStream(r.stream,!0,"screen",e)]):[3,8];case 7:return i.sent(),[3,9];case 8:this._subscribedSubStreamMap.set(e,{isSubscribed:!1,streamObj:r}),i.label=9;case 9:return[2]}}))}))})),this._rtc.on(RTC_EVENT.STREAM_SUBSCRIBED,(function(r){return __awaiter(e,void 0,void 0,(function(){var e,n,i,o=this;return __generator(this,(function(a){switch(a.label){case 0:return this.logger.log(t.TAG_NAME,"STREAM_SUBSCRIBED",r.stream.streamID,r.mediaType),e=r.stream.streamID,n=r,"audio"!==r.mediaType?[3,2]:(console.log("音频自动订阅完成"),n.stream.on(RTC_EVENT.NOTALLOWEDERROR,(function(r){if(41030===r.getCode()){var n=o._getUuidByRtcUid(e);o.logger.log(t.TAG_NAME,"STREAM_SUBSCRIBED NOTALLOWEDERROR",n),o._emitter.emit(RTC_EVENT.NOTALLOWEDERROR,{userUuid:n,type:"audio"})}})),this._subscribeAudioStreamMap.set(e,{stream:n.stream}),[4,this._playRemoteStream(n.stream,e,"audio")]);case 1:return a.sent(),[3,9];case 2:return"video"!==r.mediaType?[3,6]:(i=this._subscribedStreamMap.get(e))?[4,this._playRemoteStream(n.stream,e,"video")]:[3,4];case 3:return a.sent(),this._subscribedStreamMap.set(e,__assign(__assign({},i),{isSubscribed:!0,streamObj:n})),[3,5];case 4:this._subscribedStreamMap.set(e,{isSubscribed:!0,streamObj:n,streamType:NEVideoStreamType.HIGH}),a.label=5;case 5:return[3,9];case 6:return"screen"!==r.mediaType?[3,9]:this._subscribedSubStreamMap.has(e)?[4,this._playRemoteSubStream(n.stream,e)]:[3,8];case 7:a.sent(),a.label=8;case 8:this._subscribedSubStreamMap.set(e,{isSubscribed:!0,streamObj:n}),a.label=9;case 9:return[2]}}))}))})),this._rtc.on(RTC_EVENT.STREAM_REMOVED,(function(r){return __awaiter(e,void 0,void 0,(function(){var e,n,i,o;return __generator(this,(function(a){switch(a.label){case 0:if(this.logger.log(t.TAG_NAME,"STREAM_REMOVED",r),e=r.stream.streamID,"screen"!==r.mediaType)return[3,6];if(!(i=this._subscribedSubStreamMap.get(e)))return[3,5];if(!i.streamObj)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),this._rtc.stopPlayingRemoteStream("screen",i.streamObj.stream),[4,this._subscribeStream(i.streamObj.stream,!1,"screen",e)];case 2:return a.sent(),[3,4];case 3:return n=a.sent(),this.logger.warn("unsubscribe screen stream failed: ",n),[3,4];case 4:this._subscribedSubStreamMap.set(e,__assign(__assign({},i),{streamObj:null})),a.label=5;case 5:return[3,13];case 6:if("video"!==r.mediaType)return[3,12];if(!(i=this._subscribedStreamMap.get(e)))return[3,11];if(!i.streamObj)return[3,10];a.label=7;case 7:return a.trys.push([7,9,,10]),this._rtc.stopPlayingRemoteStream("video",i.streamObj.stream),[4,this._subscribeStream(i.streamObj.stream,!1,"video",e)];case 8:return a.sent(),[3,10];case 9:return o=a.sent(),this.logger.warn("unsubscribe video stream failed: ",o),[3,10];case 10:this._subscribedStreamMap.set(e,__assign(__assign({},i),{streamObj:null})),a.label=11;case 11:return[3,13];case 12:"audio"===r.mediaType&&this._subscribeAudioStreamMap.delete(e),a.label=13;case 13:return[2]}}))}))})),this._rtc.on(RTC_EVENT.STOP_SCREEN_SHARE,(function(){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.logger.log(t.TAG_NAME,"STOP_SCREEN_SHARE",this._localMember),this._localMember.isSharingScreen?[4,this.stopScreenShare()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})),this._rtc.on(RTC_EVENT.ACTIVE_SPEAKER,(function(t){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(r){return e=this._getUuidByRtcUid(t.uid),this._emitter.emit(RTC_EVENT.ACTIVE_SPEAKER,{userUuid:e,volume:t.level}),[2]}))}))})),this._rtc.on(RTC_EVENT.VOLUME_INDICATOR,(function(t){var r=t.map((function(t){return{userUuid:e._getUuidByRtcUid(t.uid),volume:t.level}}));e._emitter.emit(RTC_EVENT.VOLUME_INDICATOR,r)})),this._rtc.on(RTC_EVENT.PEER_ONLINE,(function(t){var r=e._getUuidByRtcUid(String(t.uid));e._setMemberIsInClientRtc(r,t.uid,!0);var n=e._remoteMemberMap.get(r);n&&n._isInServerRtc&&(n.isInRtcChannel=!0,e._remoteMemberMap.set(r,n))})),this._rtc.on(RTC_EVENT.PEER_LEAVE,(function(t){console.log("PEER_LEAVE",t.uid);var r=e._getUuidByRtcUid(String(t.uid));e._setMemberIsInClientRtc(r,t.uid,!1);var n=e._remoteMemberMap.get(r);n&&(n._isInServerRtc||(n.isInRtcChannel=!1,e._remoteMemberMap.set(r,n)))})),this._rtc.on(RTC_EVENT.CONNECTION_STATE_CHANGE,(function(t){"DISCONNECTED"===t.curState&&t.reconnect&&(e._isJoined=!1),e._emitter.emit(RTC_EVENT.CONNECTION_STATE_CHANGE,t)})),this._rtc.on(RTC_EVENT.NETWORK_QUALITY,(function(t){var r=t.map((function(t){return{userUuid:e._getUuidByRtcUid(t.uid),downStatus:t.downlinkNetworkQuality,upStatus:t.uplinkNetworkQuality}}));e._emitter.emit(RTC_EVENT.NETWORK_QUALITY,r)})),this._rtc.on(RTC_EVENT.VIDEO_TRACK_ENDED,(function(){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){return[2]}))}))})),this._rtc.on(RTC_EVENT.ERROR,(function(t){console.log("RTC_ERROR",t),e._emitter.emit(RTC_EVENT.ERROR,t)})),this._rtc.on(RTC_EVENT.ABILITY_NOT_SUPPORT,(function(t){var r=e._getUuidByRtcUid(String(t.uid));r&&(console.log("ABILITY_NOT_SUPPORT",r),t.uid=r),e._emitter.emit(RTC_EVENT.ABILITY_NOT_SUPPORT,t)})),this._rtc.on(RTC_EVENT.MINIAPP_STREAM_CHANGED,(function(t){var r=e._getUuidByRtcUid(String(t.uid)),n=e._remoteMemberMap.get(r);"local"===t.uid&&(r=e._localMember.uuid,n=e._localMember),n&&(n.miniAppStreamInfo=Object.assign(n.miniAppStreamInfo||{},t.stream),e._emitter.emit(RTC_EVENT.MINIAPP_STREAM_CHANGED,n))})),this._rtc.on(RTC_EVENT.CAMERA_DEVICE_CHANGE,(function(t){e._emitter.emit(RTC_EVENT.CAMERA_DEVICE_CHANGE,t)})),this._rtc.on(RTC_EVENT.SPEAKER_DEVICE_CHANGE,(function(t){e._emitter.emit(RTC_EVENT.SPEAKER_DEVICE_CHANGE,t)})),void this._rtc.on(RTC_EVENT.RECORD_DEVICES_CHANGE,(function(t){e._emitter.emit(RTC_EVENT.RECORD_DEVICES_CHANGE,t)}))):FailureBody(null,NEErrorMessage.NOT_INIT_RTC):FailureBody(null,NEErrorMessage.NOT_SUPPORT)},t.prototype._removeListener=function(){this._rtc.off(RTC_EVENT.STREAM_SUBSCRIBED),this._rtc.off(RTC_EVENT.STREAM_REMOVED),this._rtc.off(RTC_EVENT.STREAM_ADDED),this._rtc.off(RTC_EVENT.STOP_SCREEN_SHARE),this._rtc.off(RTC_EVENT.CONNECTION_STATE_CHANGE),this._rtc.off(RTC_EVENT.ERROR),this._rtc.off(RTC_EVENT.CAMERA_DEVICE_CHANGE),this._rtc.off(RTC_EVENT.SPEAKER_DEVICE_CHANGE),this._rtc.off(RTC_EVENT.RECORD_DEVICES_CHANGE)},t.prototype._playRemoteSubStream=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._rtc.playRemoteStream({stream:e,uid:t,type:"screen"})];case 1:return r.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(r.sent())];case 3:return[2]}}))}))},t.prototype._liveStreamTaskInfo2RtcTask=function(e){var t=this,r=e.layout;if(!r)throw new Error("liveStreamTaskInfo ".concat(NEErrorMessage.PARAMS_IS_INCORRECT));var n=r.userTranscodingList?r.userTranscodingList.map((function(e){return{uid:t._getRtcUidByUuid(e.uuid)||"",x:e.x,y:e.y,width:e.width,height:e.height,pushAudio:e.audioPush,pushVideo:e.videoPush,zOrder:e.zOrder,adaption:1}})):[],i={canvas:{width:r.width,height:r.height,color:r.backgroundColor},users:n,images:r.images?r.images:[]},o={audioParam:{}},a=e.config;return a&&((a.audioBitrate||0===a.audioBitrate)&&(o.audioParam.bitRate=a.audioBitrate),a.sampleRate&&(o.audioParam.sampleRate=a.sampleRate),a.channels&&(o.audioParam.channels=a.channels),a.audioCodecProfile&&(o.audioParam.codecProfile=a.audioCodecProfile),o.singleVideoNoTrans=a.singleVideoPassthrough),{taskId:e.taskId,streamUrl:e.streamUrl,record:e.serverRecordEnabled,layout:i,extraInfo:e.extraInfo,config:o}},t.TAG_NAME="NERoomRtcController",t}(NERoomRtcBaseController),NERoomWhiteboardController=function(){function e(t){this.isSupported=!0,this._whiteboard=null,this._drawPlugin=null,this._toolCollection=null,this._WhiteBoardSDK=null,this._ToolCollectionSDK=null,this._roomUuid="",this.hasTransDoc=!1;var r=t.whiteboard,n=t.toolCollection,i=t.isSupported,o=t.request,a=t.roomUuid,s=t.logger,c=t.roomWhiteboard,u=t.localMember,l=t.wbSharingUserUuid;this.isSupported=i,r&&this.isSupported?(this.logger=s,this._WhiteBoardSDK=r,this._ToolCollectionSDK=n,this._request=o,this._roomUuid=a,this._initOptions=t,this._roomWhiteboard=c,this._localMember=u,this.logger.log(e.TAG_NAME,"constructor",t),this._wbSharingUuid=l):this.isSupported=!1}return Object.defineProperty(e.prototype,"isJoinedWhiteboard",{get:function(){return this._isJoined},enumerable:!1,configurable:!0}),e.prototype.setWhiteboardNeedInfo=function(t){try{return this.logger.log(e.TAG_NAME,"setWhiteboardNeedInfo params",t),this._wbSharingUuid=t,SuccessBody(null)}catch(e){return FailureBodySync(e,NEErrorMessage.FAILURE)}},e.prototype.getWhiteboardSharingUserUuid=function(){if(!this.isSupported)throw new Error(NEErrorMessage.NOT_SUPPORT);if(!this._isJoined)throw new Error(NEErrorMessage.NOT_JOIN_WHITEBOARD);return this._wbSharingUuid||""},e.prototype.resetWhiteboardCanvas=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return e?[3,2]:[4,this._drawPlugin.setContainer(e)];case 1:return t.sent(),[2,SuccessBody(null)];case 2:return[2,this.setupWhiteboardCanvas(e)]}}))}))},e.prototype.setupWhiteboardCanvas=function(t){return __awaiter(this,void 0,void 0,(function(){var r,n,i;return __generator(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._drawPlugin||!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_WHITEBOARD)];if(t&&"[object String]"==Object.prototype.toString.call(t)?(n=document.querySelector(t),r=n||void 0):r=t,!r)return[2,FailureBody({code:NEErrorCode.FAILURE,msg:"view is not exit"})];this.logger.log(e.TAG_NAME,"设置白板视图--start--",r),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._drawPlugin.setContainer(r)];case 2:return o.sent(),this.logger.log(e.TAG_NAME,"设置白板视图 success "),[3,4];case 3:return i=o.sent(),this.logger.error(e.TAG_NAME,"setupWhiteboardCanvas fail:","".concat(r),"".concat(i)),[2,FailureBody({code:NEErrorCode.FAILURE,msg:i})];case 4:return this.setToolCollection(r),[2,SuccessBody(null)]}}))}))},e.prototype.setEnableDraw=function(t){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._drawPlugin||!this._toolCollection||!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_WHITEBOARD)];n.label=1;case 1:return n.trys.push([1,5,,6]),[4,this.getWhiteboardSharingUserUuid()];case 2:return!n.sent()&&t?[2,FailureBody({code:NEErrorCode.FAILURE,msg:"房间内白板尚未开启"})]:(this.logger.log(e.TAG_NAME,"设置白板是否可绘制--start--",t),[4,this._drawPlugin.enableDraw(t)]);case 3:return n.sent(),this.logger.log(e.TAG_NAME,"白板设置完成 ",t),[4,this._toolCollection.setVisibility({bottomRight:{visible:t},topRight:{visible:t},left:{visible:t,exclude:t?["exportImage","opacity"]:[]},bottomLeft:{visible:!0,exclude:t?[]:["visionControl"]}})];case 4:return n.sent(),this.logger.log(e.TAG_NAME,"设置工具栏显隐 success ",t),[3,6];case 5:return r=n.sent(),this.logger.error(e.TAG_NAME,"设置白板是否可绘制失败 ","".concat(t),"".concat(r)),[2,FailureBody({code:NEErrorCode.FAILURE,msg:r})];case 6:return[2,SuccessBody(null)]}}))}))},e.prototype.startWhiteboardShare=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_WHITEBOARD)];this.logger.log(e.TAG_NAME,"开始共享白板--start--"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.updateRoomPropertiesApi({roomUuid:this._roomUuid,propertyKey:"wbSharingUuid",associatedUuid:this._localMember.uuid,data:{value:this._localMember.uuid}})];case 2:return r.sent(),this.logger.log(e.TAG_NAME,"开始共享白板 success"),[2,SuccessBody(null)];case 3:return t=r.sent(),this.logger.error(e.TAG_NAME,"startWhiteboardShare fail:",t),[2,FailureBody(t)];case 4:return[2]}}))}))},e.prototype.stopWhiteboardShare=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_WHITEBOARD)];this.logger.log(e.TAG_NAME,"停止共享白板--start--"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.deleteRoomPropertyApi({roomUuid:this._roomUuid,propertyKey:"wbSharingUuid"})];case 2:return r.sent(),this.logger.log(e.TAG_NAME,"停止共享白板 success"),[2,SuccessBody(null)];case 3:return t=r.sent(),this.logger.error(e.TAG_NAME,"stopWhiteboardShare fail:",t),[2,FailureBody(t)];case 4:return[2]}}))}))},e.prototype.initWhiteboard=function(){return __awaiter(this,void 0,void 0,(function(){var t,r,n,i,o,a,s,c,u,l,d,p,f,h=this;return __generator(this,(function(m){switch(m.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(this._isJoined)return this.logger.warn(e.TAG_NAME,"已加入白板房间 请勿重复加入"),[2,SuccessBody(null)];this.logger.log(e.TAG_NAME,"初始化白板--start--",this._roomWhiteboard),t=this._initOptions,(r=document.createElement("div")).id="initWbDom",n=this._roomWhiteboard.channelName,t.privateConf&&(o=t.privateConf,a=o.roomServer,s=o.sdkLogNosServer,c=o.dataReportServer,u=o.directNosServer,l=o.mediaUploadServer,d=o.docTransServer,i={roomServerAddr:a,sdkLogNosAddr:s,dataReportAddr:c,directNosAddr:u,mediaUploadAddr:l,docTransAddr:d}),m.label=1;case 1:return m.trys.push([1,4,,5]),p=this,[4,this._WhiteBoardSDK.getInstance({appKey:t.appKey,nickname:t.nickname,uid:t.uid,platform:"web",container:r,record:!1,privateConf:i||{},getAuthInfo:function(){return __awaiter(h,void 0,void 0,(function(){return __generator(this,(function(e){return[2,{checksum:t.checksum,nonce:t.nonce,curTime:t.curTime}]}))}))}})];case 2:return p._whiteboard=m.sent(),this.logger.log(e.TAG_NAME,"创建白板实例"),[4,this._whiteboard.joinRoom({channel:n,createRoom:!0},{ondisconnected:function(){h._WhiteBoardSDK.hideToast()}}).then((function(t){h._drawPlugin=t,h._isJoined=!0,h.logger.log(e.TAG_NAME,"白板加入房间")})).catch((function(t){return h.logger.error(e.TAG_NAME,"白板joinRoom fail:",n,t),FailureBody({code:NEErrorCode.FAILURE,msg:t})}))];case 3:return m.sent(),[2,SuccessBody(null)];case 4:return f=m.sent(),this.logger.error(e.TAG_NAME,"initWhiteboard fail:",n,f),[2,FailureBody({code:NEErrorCode.FAILURE,msg:f})];case 5:return[2]}}))}))},e.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.logger.log(e.TAG_NAME,"白板destroy--start--");try{return this._whiteboard&&this._whiteboard.destroy(),this._toolCollection&&this._toolCollection.destroy(),this._toolCollection=null,this._drawPlugin=null,this._whiteboard=null,this._isJoined=!1,this.logger.log(e.TAG_NAME,"白板destroy success"),[2,SuccessBody(null)]}catch(t){return this.logger.error(e.TAG_NAME,"白板destroy fail:","".concat(t)),[2,FailureBody({code:NEErrorCode.FAILURE,msg:t})]}return[2]}))}))},e.prototype.stopMemberWhiteboardShare=function(e){return this._wbSharingUuid!==e?FailureBody("".concat(e," not sharing whiteboard")):this.stopWhiteboardShare()},e.prototype.setToolCollection=function(t){var r;return __awaiter(this,void 0,void 0,(function(){var n,i=this;return __generator(this,(function(o){return this.isSupported?this._drawPlugin&&this._isJoined?(this.logger.log(e.TAG_NAME,"设置工具栏--start-- ",t),this._toolCollection=this._ToolCollectionSDK.getInstance({container:t,handler:this._drawPlugin,options:{platform:"web",debug:!0}}),this._toolCollection.addOrSetTool({position:"left",item:{tool:"video",hint:"视频上传"},insertAfterTool:"image"}),this._toolCollection.show(),n=document.getElementById("initWbDom"),null===(r=null==n?void 0:n.parentNode)||void 0===r||r.removeChild(n),this.logger.log(e.TAG_NAME,"设置工具栏 success ",this._toolCollection),this._drawPlugin.on("event:appState:change",(function(e,t){var r,n;"board"===e&&(!i.hasTransDoc&&i._drawPlugin.hasTransDoc()?(i.hasTransDoc=!0,null===(r=i._toolCollection)||void 0===r||r.addOrSetContainer({position:"bottomRight",items:[{tool:"prevPage",hint:"上一页"},{tool:"prevAnim",hint:"上一步"},{tool:"pageInfo"},{tool:"nextAnim",hint:"下一步"},{tool:"nextPage",hint:"下一页"},{tool:"preview",hint:"预览",previewSliderPosition:"right"}]})):i.hasTransDoc&&!i._drawPlugin.hasTransDoc()&&(i.hasTransDoc=!1,null===(n=i._toolCollection)||void 0===n||n.addOrSetContainer({position:"bottomRight",items:[{tool:"firstPage",hint:"第一页"},{tool:"prevPage",hint:"上一页"},{tool:"pageInfo"},{tool:"nextPage",hint:"下一页"},{tool:"lastPage",hint:"最后一页"},{tool:"preview",hint:"预览",previewSliderPosition:"right"}]})))})),[2]):[2,FailureBody({code:NEErrorCode.FAILURE,msg:NEErrorMessage.NOT_JOIN_WHITEBOARD})]:[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)]}))}))},e.TAG_NAME="NERoomWhiteboardController",e}(),NERoomChatController=function(){function e(t){this.isSupported=!0,this.logger=t.logger,this.logger.log(e.TAG_NAME,"constructor",t),this.isSupported=t.isSupported,this.isSupported&&(this._emitter=t.emitter,this.chatroomInit(t))}return e.prototype.joinChatroom=function(){return __awaiter(this,void 0,void 0,(function(){var t,r=this;return __generator(this,(function(n){switch(n.label){case 0:if(this.logger.log(e.TAG_NAME,"joinChatroom"),!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(this._isJoined)return this.logger.warn("已加入聊天室 请勿重复加入"),[2,SuccessBody(null)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_CHATROOM)];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._chatroom.login(this._loginParams)];case 2:return n.sent(),this._isJoined=!0,this._chatroom.on("onRecvMsg",(function(e){r._emitter.emit(IM_EVENT.CHATROOM_MESSAGE_RECEIVE,e)})),[2,SuccessBody(null)];case 3:return t=n.sent(),this.logger.error(e.TAG_NAME,"joinChatroom",t),[2,FailureBody(t,NEErrorMessage.CHATROOM_JOIN_FAIL)];case 4:return[2]}}))}))},e.prototype.leaveChatroom=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(this.logger.log(e.TAG_NAME,"leaveChatroom"),!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_CHATROOM)];if(!this._isJoined)return[2,FailureBody(null,NEErrorMessage.NOT_JOIN_CHATROOM)];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._resetState()];case 2:return r.sent(),[2,SuccessBody(null)];case 3:return t=r.sent(),this.logger.error(e.TAG_NAME,t,"leaveChatroom"),[2,FailureBody(null)];case 4:return[2]}}))}))},e.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:this.logger.log(e.TAG_NAME,"destory"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._resetState()];case 2:return r.sent(),this._isInit=!1,[2,SuccessBody(null)];case 3:return t=r.sent(),this.logger.error(e.TAG_NAME,t,"destory"),[2,FailureBody(null)];case 4:return[2]}}))}))},e.prototype.sendBroadcastTextMessage=function(t){var r=this;return new Promise((function(n,i){if(r.logger.log(e.TAG_NAME,"sendBroadcastTextMessage"),!r.isSupported)return i(NEErrorMessage.NOT_SUPPORT);if(!r._isJoined)return i(NEErrorMessage.NOT_JOIN_CHATROOM);if(!r._isInit)return i(NEErrorMessage.NOT_INIT_CHATROOM);if(!t.trim())return i(NEErrorMessage.NO_MESSAGE_CONTENT);var o={text:t,type:"text",fromAccount:r._account,toAccids:[],done:function(e,t){e?i(e):n(t)}};r._chatroom.sendTextMessage(o)})).then((function(e){return SuccessBody(e)})).catch((function(e){return FailureBody(e)}))},e.prototype.resendTextMessage=function(t,r,n){var i=this;return new Promise((function(o,a){if(i.logger.log(e.TAG_NAME,"resendTextMessage",n),!i.isSupported)return a(NEErrorMessage.NOT_SUPPORT);if(!i._isJoined)return a(NEErrorMessage.NOT_JOIN_CHATROOM);if(!i._isInit)return a(NEErrorMessage.NOT_INIT_CHATROOM);if(!t.trim())return a(NEErrorMessage.NO_MESSAGE_CONTENT);var s={text:t,type:"text",idClient:r,fromAccount:i._account,toAccids:n,done:function(e,t){e?a(e):o(t)}};i._chatroom.resendTextMessage(s)})).then((function(e){return SuccessBody(e)})).catch((function(e){return FailureBody(e)}))},e.prototype.sendDirectTextMessage=function(t,r){var n=this;return new Promise((function(i,o){if(n.logger.log(e.TAG_NAME,"sendDirectTextMessage",t),!n.isSupported)return o(NEErrorMessage.NOT_SUPPORT);if(!n._isJoined)return o(NEErrorMessage.NOT_JOIN_CHATROOM);if(!n._isInit)return o(NEErrorMessage.NOT_INIT_CHATROOM);if(!t)return o(NEErrorMessage.NO_UUID);if(!r.trim())return o(NEErrorMessage.NO_MESSAGE_CONTENT);var a={text:r,type:"text",fromAccount:n._account,custom:JSON.stringify({toAccids:[t]}),toAccids:[t],done:function(e,t){e?o(e):i(t)}};n._chatroom.sendTextMessage(a)})).then((function(e){return SuccessBody(e)})).catch((function(e){return FailureBody(e)}))},e.prototype.sendGroupTextMessage=function(t,r){var n=this;return new Promise((function(i,o){if(n.logger.log(e.TAG_NAME,"sendGroupTextMessage",t),!n.isSupported)return o(NEErrorMessage.NOT_SUPPORT);if(!n._isJoined)return o(NEErrorMessage.NOT_JOIN_CHATROOM);if(!n._isInit)return o(NEErrorMessage.NOT_INIT_CHATROOM);if(!t.length)return o(NEErrorMessage.NO_UUID);if(!r.trim())return o(NEErrorMessage.NO_MESSAGE_CONTENT);var a={text:r,type:"text",custom:JSON.stringify({toAccids:t}),fromAccount:n._account,toAccids:t,done:function(e,t){e?o(e):i(t)}};n._chatroom.sendTextMessage(a)})).then((function(e){return SuccessBody(e)})).catch((function(e){return FailureBody(e)}))},e.prototype.getHistoryMsgs=function(t){var r=this;return new Promise((function(n,i){return r.logger.log(e.TAG_NAME,"sendGroupTextMessage"),r.isSupported?r._isJoined?r._isInit?(t=__assign(__assign({},t),{done:function(e,t){e?i(e):n(t)}}),void r._chatroom.getHistoryMsgs(t)):i(NEErrorMessage.NOT_INIT_CHATROOM):i(NEErrorMessage.NOT_JOIN_CHATROOM):i(NEErrorMessage.NOT_SUPPORT)})).then((function(e){return SuccessBody(e)})).catch((function(e){return FailureBody(e)}))},e.prototype.fetchChatRoomMembers=function(e,t){var r;switch(e){case NEChatRoomMemberQueryType.NORMAL:r={guest:!1,limit:t};break;case NEChatRoomMemberQueryType.ONLINE_NORMAL:r={guest:!1,onlyOnline:!0,limit:t};break;case NEChatRoomMemberQueryType.GUEST_DESC:r={desc:!0,guest:!0,limit:t};break;case NEChatRoomMemberQueryType.GUEST_ASC:r={desc:!1,guest:!0,limit:t}}return this._chatroom.getMembers(r||{}).then((function(e){return e.map((function(e){return{nick:e.nick,avatar:e.avatar}}))}))},e.prototype._removeChatRoomListener=function(){this._chatroom.off("onRecvMsg")},e.prototype.chatroomInit=function(e){var t=e.appKey,r=e.debug,n=e.account,i=e.token,o=e.chatroomNick,a=e.chatroom,s=e.chatroomId,c=e.tags,u=e.notifyTargetTags,l=e.chatroomCustom;this._chatroom=a,this._account=n,this._loginParams={appKey:t,debug:r,account:n,token:i,chatroomId:s,chatroomNick:o,tags:c,notifyTargetTags:u,chatroomCustom:l},this._isInit=!0},e.prototype._resetState=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(this.logger.log(e.TAG_NAME,"_resetState"),!this.isSupported||!this._isInit)return[2];this._isJoined=!1,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._chatroom.logout()];case 2:return r.sent(),this._removeChatRoomListener(),[3,4];case 3:throw t=r.sent(),this.logger.error(e.TAG_NAME,"_resetState",t),new Error(t);case 4:return[2]}}))}))},e.TAG_NAME="NERoomChatController",e}();function getRoleFromTemplate(e,t){var r=t.roleConfigs[e];if(!r)throw new Error("role not exits");var n=r.params;return{name:e,limit:r.limit,params:{audio:n&&n.audio,video:n&&n.video,screen:n&&n.screen},superRole:r.superRole}}function getStreamPermissionFromTemplate(e,t){var r,n=null===(r=t.permissions.member)||void 0===r?void 0:r.streams,i=n.audio,o=n.video,a=n.subVideo,s=!0,c=!0,u=!0;if(i.roles){var l=i.roles.findIndex((function(e){return e.split(".")[0]==e}));s=l>=0}return o.roles&&(l=o.roles.findIndex((function(e){return e.split(".")[0]==e})),c=l>=0),a.roles&&(l=a.roles.findIndex((function(e){return e.split(".")[0]==e})),u=l>=0),{audio:s,video:c,subVideo:u}}function getUUID(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)}))}var NEBaseService=function(){},NERoomLiveController=function(){function e(e){this._liveInfo=null,this.logger=e.logger,this._request=e.request,this._rtcController=e.rtcController,this._roomUuid=e.roomUuid,this.isSupported=e.isSupported}return e.prototype.getLiveInfo=function(){return JSON.parse(JSON.stringify(this._liveInfo))},e.prototype.setLiveInfo=function(e){var t=e.taskId,r=e.pushUrl,n=e.chatRoomId,i=e.pullHttpUrl,o=e.pullRtmpUrl,a=e.pullRtsUrl,s=e.pullHlsUrl,c=e.title,u=e.liveLayout,l=e.password,d=e.state,p=e.extensionConfig,f=e.userUuidList;this._liveInfo={taskId:t,pushUrl:r,chatRoomId:n,pullHttpUrl:i,pullRtmpUrl:o,pullRtsUrl:a,pullHlsUrl:s,title:c,liveLayout:u,password:l,userUuidList:f,state:d,extensionConfig:p}},e.prototype.startLive=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r=this;return __generator(this,(function(n){return t=this._getRtcUidListByUuidList(e.userUuidList),[2,this._request.startLive({roomUuid:this._roomUuid,data:{title:e.title,liveLayout:e.liveLayout,liveChatRoomIndependent:!1,liveAVRoomUids:t,password:e.password,extensionConfig:e.extensionConfig}}).then((function(t){var n=r._getUuidListByRtcUidList(t.liveAVRoomUids);return SuccessBody({taskId:t.taskId,pushUrl:t.pushUrl,chatRoomId:t.chatRoomId,pullHttpUrl:t.pullHttpUrl,pullRtmpUrl:t.pullRtmpUrl,pullRtsUrl:t.pullRtsUrl,pullHlsUrl:t.pullHlsUrl,title:t.title,liveLayout:t.liveLayout,password:e.password,userUuidList:n,state:NERoomLiveState.INVALID,extensionConfig:t.extensionConfig})})).catch((function(e){return FailureBody(e)}))]}))}))},e.prototype.stopLive=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._request.endLive({roomUuid:this._roomUuid}).then((function(e){return SuccessBody(null)})).catch((function(e){return FailureBody(e)}))]}))}))},e.prototype.updateLive=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r=this;return __generator(this,(function(n){return t=this._getRtcUidListByUuidList(e.userUuidList),[2,this._request.updateLive({roomUuid:this._roomUuid,data:{title:e.title,liveLayout:e.liveLayout,password:e.password,liveAVRoomUids:t,extensionConfig:e.extensionConfig||""}}).then((function(t){var n=r._getUuidListByRtcUidList(t.liveAVRoomUids);return SuccessBody({taskId:t.taskId,pushUrl:t.pushUrl,chatRoomId:t.chatRoomId,pullHttpUrl:t.pullHttpUrl,pullRtmpUrl:t.pullRtmpUrl,pullRtsUrl:t.pullRtsUrl,pullHlsUrl:t.pullHlsUrl,title:t.title,liveLayout:t.liveLayout,password:e.password,userUuidList:n,state:NERoomLiveState.INVALID,extensionConfig:t.extensionConfig})})).catch((function(e){return FailureBody(e)}))]}))}))},e.prototype.addLiveStreamTask=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._rtcController.addLiveStreamTask(e).then((function(){return SuccessBody(null)})).catch((function(e){return FailureBody(e)}))]}))}))},e.prototype.removeLiveStreamTask=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._rtcController.removeLiveStreamTask(e).then((function(){return SuccessBody(null)})).catch((function(e){return FailureBody(e)}))]}))}))},e.prototype.updateLiveStreamTask=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._rtcController.updateLiveStreamTask(e).then((function(){return SuccessBody(null)})).catch((function(e){return FailureBody(e)}))]}))}))},e.prototype._getUuidListByRtcUidList=function(e){var t=this,r=[];return e&&Array.isArray(e)&&e.forEach((function(e){var n=t._rtcController._getUuidByRtcUid(String(e));r.push(n)})),r},e.prototype._getRtcUidListByUuidList=function(e){var t=this,r=[];return e&&Array.isArray(e)&&e.forEach((function(e){var n=t._rtcController._getRtcUidByUuid(e);n&&r.push(n)})),r},e}(),NERoomContextService=function(e){function t(r){var n,i,o,a=this;(a=e.call(this)||this)._roomProperties={},a._sequence=0,a._listeners={},a._rtcStatsListeners={},a._remoteIsInClientRtcMap=new Map,a._rtcListenerTimer=null,a._isFetching=!1,a._isLeavedRoom=!1,a._controlNotifyListener=function(e){return __awaiter(a,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:return 99===(r=JSON.parse(e.body)).cmd||r.data.roomUuid!=this.roomUuid?[2]:this._isFetching?(this._logger.warn("正在拉取快照"),[2]):[4,this._handleSequence(r.sequence)];case 1:return n.sent()?(this._listenerHandlesMap[r.cmd]&&this._listenerHandlesMap[r.cmd](r.data),this._sequence=r.sequence):this._logger.warn(t.TAG_NAME,"存在消息丢失",this._sequence),[2]}}))}))},a._request=r.request,a._deviceId=r.deviceId,a._roomInfo=r.snapshotData.snapshot.room,a._joinRoomInfo=r.joinRoomInfo,a._templateConfig=r.templateConfig,a._sequence=r.snapshotData.sequence,a.roomName=r.roomName,a.roomUuid=r.roomUuid,a.appKey=r.appKey,a._logger=r.logger,a._eventEmitter=r.eventEmitter,a._im=r.IM,a._roomProperties=r.roomProperties;var s=r.member;a.userName=s.userName;var c=null===(n=r.member)||void 0===n?void 0:n.wbAuth,u=c.checksum,l=c.curTime,d=c.nonce,p=(null===(o=null===(i=r.roomProperties)||void 0===i?void 0:i.chatRoom)||void 0===o?void 0:o.chatRoomId)||"",f=r.roomProperties,h=f.whiteboard,m=f.wbSharingUuid,g=__read(a._createRemoteMembers(r.snapshotData.snapshot.members,r.snapshotData.snapshot.room,s.userUuid),2),v=g[0],y=g[1];return a._remoteMemberMap=v,a._localMember=y,a._deleteRoomContext=r.deleteRoomContext,a.rtcController=new NERoomRtcController({rtc:r.Rtc,setMemberIsInClientRtc:a._setMemberIsInClientRtc.bind(a),channelName:r.roomUuid,uid:s.rtcUid,appKey:a.appKey,cid:r.cid,screenSharingUserUuid:a._screenSharingUserUuid,remoteMemberMap:a._remoteMemberMap,token:s.rtcToken,request:r.request,emitter:a._eventEmitter,member:a._localMember,logger:r.logger,privateRtcConfig:r.privateRtcConfig}),a.chatController=new NERoomChatController({chatroom:r.Chatroom,appKey:r.appKey,debug:r.debug,account:s.userUuid,token:a._request.imToken,logger:a._logger,emitter:a._eventEmitter,chatroomId:p,chatroomNick:s.userName,isSupported:!!p,notifyTargetTags:JSON.stringify({tag:".*",matchType:"regex"})}),a.whiteboardController=new NERoomWhiteboardController({roomUuid:r.roomUuid,appKey:r.appKey,uid:s.rtcUid,checksum:u,nonce:d,curTime:l,record:!1,privateConf:r.privateWhiteboardConfig,isSupported:!!(null==h?void 0:h.channelName),whiteboard:r.Whiteboard,wbSharingUserUuid:m?m.value:"",toolCollection:r.toolCollection,request:r.request,logger:a._logger,roomWhiteboard:h,localMember:a._localMember}),a.liveController=new NERoomLiveController({roomUuid:r.roomUuid,request:r.request,logger:r.logger,rtcController:a.rtcController,isSupported:!0}),a._initListener(),a}return __extends(t,e),Object.defineProperty(t.prototype,"remoteMembers",{get:function(){return JSON.parse(JSON.stringify(this._membersMap2List()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localMember",{get:function(){return JSON.parse(JSON.stringify(this._localMember))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roomProperties",{get:function(){return JSON.parse(JSON.stringify(this._roomProperties))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sipCid",{get:function(){var e;return null===(e=this._roomProperties.sip)||void 0===e?void 0:e.sipCid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"password",{get:function(){return this._joinRoomInfo.password},enumerable:!1,configurable:!0}),t.prototype.addRoomListener=function(e){this._listeners=e||{}},t.prototype.changeMemberRole=function(e,r){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:this._logger.log(t.TAG_NAME,this.roomUuid,e,r,"changeMemberRole"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._request.updateMemberInfoApi({roomUuid:this.roomUuid,userUuid:e,data:{role:r}})];case 2:return n.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(n.sent())];case 4:return[2]}}))}))},t.prototype.changeMyName=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:this._logger.log(t.TAG_NAME,this.roomUuid,e,"changeMyName"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.updateMemberInfoApi({roomUuid:this.roomUuid,userUuid:this._localMember.uuid,data:{userName:e}})];case 2:return r.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(r.sent())];case 4:return[2]}}))}))},t.prototype.handOverMyRole=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:if(this._logger.log(t.TAG_NAME,"handOverMyRole",this.roomUuid,e),!e)return[2,FailureBody(null,"userUuid is required")];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.handOverRoleApi({roomUuid:this.roomUuid,userUuid:e})];case 2:return r.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(r.sent())];case 4:return[2]}}))}))},t.prototype.changeMemberNickname=function(e,r){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:this._logger.log(t.TAG_NAME,"changeMemberNickname",this.roomUuid,e,r),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._request.updateMemberInfoApi({roomUuid:this.roomUuid,userUuid:e,data:{userName:r}})];case 2:return n.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(n.sent())];case 4:return[2]}}))}))},t.prototype.endRoom=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._request.endRoomApi(this.roomUuid)];case 1:return e.sent(),[2,SuccessBody(null)];case 2:return[2,FailureBody(e.sent())];case 3:return[2]}}))}))},t.prototype.kickMemberOut=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return e?[2,this._request.removeOrLeaveRoomApi({roomUuid:this.roomUuid,userUuid:e}).then((function(e){return SuccessBody(null)})).catch((function(e){return FailureBody(e)}))]:[2,FailureBody(null,NEErrorMessage.NO_UUID)]}))}))},t.prototype.leaveRoom=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._request.removeOrLeaveRoomApi({roomUuid:this.roomUuid,userUuid:this._localMember.uuid})];case 1:return t.sent(),[2,SuccessBody(null)];case 2:return e=t.sent(),this.destroy(),[2,FailureBody(e)];case 3:return[2]}}))}))},t.prototype.destroy=function(){var e,r,n,i;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(o){switch(o.label){case 0:this._logger.log(t.TAG_NAME,"开始销毁"),o.label=1;case 1:return o.trys.push([1,6,,7]),this._isLeavedRoom=!0,this._im.off("controlNotify",this._controlNotifyListener),this._im.off("imDisconnect"),this._eventEmitter.off(RTC_EVENT.CONNECTION_STATE_CHANGE),this._eventEmitter.off(RTC_EVENT.ERROR),this._eventEmitter.off(RTC_EVENT.MINIAPP_STREAM_CHANGED),this._eventEmitter.off(RTC_EVENT.VOLUME_INDICATOR),this._eventEmitter.off(RTC_EVENT.ACTIVE_SPEAKER),this._eventEmitter.off(RTC_EVENT.CAMERA_DEVICE_CHANGE),this._eventEmitter.off(RTC_EVENT.SPEAKER_DEVICE_CHANGE),this._eventEmitter.off(RTC_EVENT.RECORD_DEVICES_CHANGE),this._eventEmitter.off(RTC_EVENT.NETWORK_QUALITY),this._eventEmitter.off(RTC_EVENT.NOTALLOWEDERROR),this._eventEmitter.off(IM_EVENT.CHATROOM_MESSAGE_RECEIVE),this.removeRoomListener(),this.removeRtcStatsListener(),[4,null===(e=this.rtcController)||void 0===e?void 0:e.destroy()];case 2:return o.sent(),this.rtcController=null,[4,null===(r=this.chatController)||void 0===r?void 0:r.destroy()];case 3:return o.sent(),this.chatController=null,(null===(n=this.whiteboardController)||void 0===n?void 0:n.isJoinedWhiteboard)?[4,null===(i=this.whiteboardController)||void 0===i?void 0:i.destroy()]:[3,5];case 4:o.sent(),o.label=5;case 5:return this.whiteboardController=null,this._remoteMemberMap.clear(),this._localMember=this._resetMember(),this._sequence=0,this.roomName="",this.userName="",this.appKey="",this._deleteRoomContext(this.roomUuid),this.roomUuid="",[2,SuccessBody(null)];case 6:return[2,FailureBody(o.sent())];case 7:return[2]}}))}))},t.prototype.removeRoomListener=function(e){this._listeners={}},t.prototype.updateRoomProperty=function(e,t,r){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:try{n=JSON.parse(t)}catch(e){n=t}i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._request.updateRoomPropertiesApi({roomUuid:this.roomUuid,propertyKey:e,associatedUuid:r,data:n})];case 2:return[2,SuccessBody(i.sent())];case 3:return[2,FailureBody(i.sent())];case 4:return[2]}}))}))},t.prototype.deleteRoomProperty=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._request.deleteRoomPropertyApi({roomUuid:this.roomUuid,propertyKey:e})];case 1:return[2,SuccessBody(t.sent())];case 2:return[2,FailureBody(t.sent())];case 3:return[2]}}))}))},t.prototype.updateMemberProperty=function(e,t,r){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:try{n=JSON.parse(r)}catch(e){n=r}i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._request.updateMemberPropertiesApi({userUuid:e,roomUuid:this.roomUuid,propertyKey:t,value:n})];case 2:return i.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(i.sent())];case 4:return[2]}}))}))},t.prototype.deleteMemberProperty=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._request.deleteMemberPropertyApi({userUuid:e,roomUuid:this.roomUuid,propertyKey:t})];case 1:return[2,SuccessBody(r.sent())];case 2:return[2,FailureBody(r.sent())];case 3:return[2]}}))}))},t.prototype.lockRoom=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._changeRoomLockState(OperateCodeForApi.OPEN)]}))}))},t.prototype.unlockRoom=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._changeRoomLockState(OperateCodeForApi.CLOSE)]}))}))},t.prototype.getMember=function(e){return e?this._localMember.uuid===e?this.localMember:this._remoteMemberMap.get(e)||null:null},t.prototype.addRtcStatsListener=function(e){var t=this;this._rtcStatsListeners=e||{},this._rtcListenerTimer&&(clearInterval(this._rtcListenerTimer),this._rtcListenerTimer=null),this._rtcListenerTimer=setInterval((function(){return __awaiter(t,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){return this.rtcController.getSessionStats().then((function(t){e._rtcStatsListeners.onRtcStats&&e._rtcStatsListeners.onRtcStats(t)})),this.rtcController.getLocalAudioStats().then((function(t){e._rtcStatsListeners.onLocalAudioStats&&e._rtcStatsListeners.onLocalAudioStats(t)})),this.rtcController.getLocalVideoStats().then((function(t){e._rtcStatsListeners.onLocalVideoStats&&e._rtcStatsListeners.onLocalVideoStats(t)})),this.rtcController.getRemoteAudioStats().then((function(t){e._rtcStatsListeners.onRemoteAudioStats&&e._rtcStatsListeners.onRemoteAudioStats(t)})),this.rtcController.getRemoteVideoStats().then((function(t){e._rtcStatsListeners.onRemoteVideoStats&&e._rtcStatsListeners.onRemoteVideoStats(t)})),[2]}))}))}),2e3)},t.prototype.removeRtcStatsListener=function(e){this._rtcStatsListeners={},this._rtcListenerTimer&&(clearInterval(this._rtcListenerTimer),this._rtcListenerTimer=null)},t.prototype._createRemoteMembers=function(e,t,r){var n=this,i=new Map;e.forEach((function(e){e.streams.subVideo&&1===e.streams.subVideo.value&&(n._screenSharingUserUuid=e.userUuid),i.set(e.userUuid,n._createMember(e,t))}));var o=i.get(r);return i.delete(r),[i,o]},t.prototype._createMember=function(e,t){var r,n,i,o,a="";t.properties.whiteboard&&1===t.properties.whiteboard.openValue&&(a=t.properties.whiteboard.userUuid);var s=Boolean(e.streams.subVideo&&1===e.streams.subVideo.value),c={};return this._localMember&&e.userUuid===this._localMember.uuid?c=this._localMember:this._remoteMemberMap&&this._remoteMemberMap.has(e.userUuid)&&(c=this._remoteMemberMap.get(e.userUuid)),__assign(__assign({},c),{isAudioOn:Boolean(e.streams.audio&&1===e.streams.audio.value),isInChatroom:Boolean((null===(r=e.properties)||void 0===r?void 0:r.states.chatroomState)&&2===(null===(n=e.properties)||void 0===n?void 0:n.states.chatroomState)),isInRtcChannel:Boolean((null===(i=e.properties)||void 0===i?void 0:i.states.rtcState)&&2===(null===(o=e.properties)||void 0===o?void 0:o.states.rtcState)),isSharingScreen:s,isVideoOn:Boolean(e.streams.video&&1===e.streams.video.value),isSharingWhiteboard:Boolean(!!a&&a===e.userUuid),name:e.userName,rtcUid:e.rtcUid,properties:e.properties,role:getRoleFromTemplate(e.role,this._templateConfig),uuid:e.userUuid,clientType:e.clientType})},t.prototype._changeRoomLockState=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._request.updateRoomPropertiesApi({roomUuid:this.roomUuid,propertyKey:"lock",data:{value:e}})];case 1:return[2,SuccessBody(t.sent())];case 2:return[2,FailureBody(t.sent())];case 3:return[2]}}))}))},t.prototype._membersMap2List=function(){var e,t,r=[];try{for(var n=__values(this._remoteMemberMap.values()),i=n.next();!i.done;i=n.next()){var o=i.value;r.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},t.prototype._addInnerListeners=function(){var e=this;this._eventEmitter.on(RTC_EVENT.CONNECTION_STATE_CHANGE,(function(t){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if("CONNECTED"!==t.curState||"CONNECTING"!==t.prevState||!t.reconnect)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._getMeetingInfo()];case 2:return e.sent(),[3,4];case 3:return 1004===e.sent().code&&this._listeners.onRoomEnded&&this._listeners.onRoomEnded(NERoomEndReason.LEAVE_BY_SELF),[3,4];case 4:return!this._isLeavedRoom&&this._listeners.onRoomConnectStateChanged&&this._listeners.onRoomConnectStateChanged(t),[2]}}))}))})),this._eventEmitter.on(RTC_EVENT.ERROR,(function(t){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){return this._listeners.onRtcChannelError&&this._listeners.onRtcChannelError(t),[2]}))}))})),this._eventEmitter.on(RTC_EVENT.ABILITY_NOT_SUPPORT,(function(t){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){return this._listeners.onRtcAbilityNotSupport&&this._listeners.onRtcAbilityNotSupport(t),[2]}))}))})),this._eventEmitter.on(RTC_EVENT.MINIAPP_STREAM_CHANGED,(function(t){return __awaiter(e,void 0,void 0,(function(){var e,r,n;return __generator(this,(function(i){return this._logger.log("MINIAPP_STREAM_CHANGED ",t),e=__read(this._getMember(t.uuid),2),r=e[0],n=e[1],r?(this._setMember(r,n),this._listeners.onMemberStreamChanged&&this._listeners.onMemberStreamChanged(t),[2]):(this._logger.error("not found member ".concat(t.uuid)),[2])}))}))})),this._eventEmitter.on(RTC_EVENT.VOLUME_INDICATOR,(function(t){e._listeners.onRtcAudioVolumeIndication&&e._listeners.onRtcAudioVolumeIndication(t)})),this._eventEmitter.on(RTC_EVENT.ACTIVE_SPEAKER,(function(t){e._listeners.onRtcActiveSpeakerChanged&&e._listeners.onRtcActiveSpeakerChanged(t)})),this._eventEmitter.on(RTC_EVENT.CAMERA_DEVICE_CHANGE,(function(t){e._listeners.onCameraDeviceChanged&&e._listeners.onCameraDeviceChanged(t)})),this._eventEmitter.on(RTC_EVENT.SPEAKER_DEVICE_CHANGE,(function(t){e._listeners.onPlayoutDeviceChanged&&e._listeners.onPlayoutDeviceChanged(t)})),this._eventEmitter.on(RTC_EVENT.RECORD_DEVICES_CHANGE,(function(t){e._listeners.onRecordDeviceChanged&&e._listeners.onRecordDeviceChanged(t)})),this._eventEmitter.on(RTC_EVENT.NETWORK_QUALITY,(function(t){e._rtcStatsListeners.onNetworkQuality&&e._rtcStatsListeners.onNetworkQuality(t)})),this._eventEmitter.on(IM_EVENT.CHATROOM_MESSAGE_RECEIVE,(function(t){e._listeners.onReceiveChatroomMessages&&e._listeners.onReceiveChatroomMessages(t)})),this._eventEmitter.on(RTC_EVENT.NETWORK_QUALITY,(function(t){e._listeners.onRtcNetworkQuality&&e._listeners.onRtcNetworkQuality(t)})),this._eventEmitter.on(RTC_EVENT.NOTALLOWEDERROR,(function(t){e._listeners.onAutoPlayNotAllowed&&e._listeners.onAutoPlayNotAllowed(t)}))},t.prototype._createListenerHandlesMap=function(){var e,t=this;return(e={})[NERoomEventFromServer.MEMBER_JOIN_ROOM]=function(e){var r=e.members[0];if(r.userUuid!==t._localMember.uuid){var n=t._createMember(r,t._roomInfo);t._remoteMemberMap.set(n.uuid,n),t.rtcController&&t.rtcController.setRemoteMemberMap(t._remoteMemberMap),t._listeners.onMemberJoinRoom&&t._listeners.onMemberJoinRoom([n])}},e[NERoomEventFromServer.MEMBER_LEAVE_ROOM]=function(e){return __awaiter(t,void 0,void 0,(function(){var t,r,n,i,o,a,s;return __generator(this,(function(c){switch(c.label){case 0:if(e.roomUuid!=this.roomUuid)return[2];if(t=e.members[0],r=__read(this._getMember(t.userUuid),2),n=r[0],i=r[1],n&&this.rtcController&&n.uuid===this.rtcController.getScreenSharingUserUuid()&&this.rtcController.setScreenSharingUserUuid(""),!i)return[3,5];if(n){if(s=__assign(__assign({},n),{reason:t.reason}),this._listeners.onMemberLeaveRoom&&this._listeners.onMemberLeaveRoom([s]),o=NERoomEndReason.LEAVE_BY_SELF,this._deviceId!==t.reason.deviceId)return[2];"SELF_KICK"===t.reason.type?o=NERoomEndReason.kICK_BY_SELF:"NORMAL"===t.reason.type?o=NERoomEndReason.LEAVE_BY_SELF:"ADMIN_KICK"===t.reason.type&&(o=NERoomEndReason.KICK_OUT),this._listeners.onRoomEnded&&this._listeners.onRoomEnded(o)}return t.rtcUid?[3,2]:[4,this.destroy()];case 1:return c.sent(),[3,4];case 2:return t.rtcUid&&t.rtcUid==this._localMember.rtcUid?(console.warn("用户互踢"),[4,this.destroy()]):[3,4];case 3:c.sent(),c.label=4;case 4:return[3,6];case 5:(a=this._remoteMemberMap.get(t.userUuid))&&(a.rtcUid?a.rtcUid==t.rtcUid&&this._remoteMemberMap.delete(t.userUuid):this._remoteMemberMap.delete(t.userUuid)),this.rtcController&&this.rtcController.setRemoteMemberMap(this._remoteMemberMap),n&&(s=__assign(__assign({},n),{reason:t.reason}),this._listeners.onMemberLeaveRoom&&this._listeners.onMemberLeaveRoom([s])),c.label=6;case 6:return[2]}}))}))},e[NERoomEventFromServer.ROOM_ENDED]=function(e){return __awaiter(t,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return e.roomUuid!==this.roomUuid?[2]:(this._listeners.onRoomEnded&&this._listeners.onRoomEnded(NERoomEndReason[e.reason]),[4,this.destroy()]);case 1:return t.sent(),[2]}}))}))},e[NERoomEventFromServer.MEMBER_ROLE_TYPE_CHANGED]=function(e){var r=e.member,n=getRoleFromTemplate(e.role,t._templateConfig),i=__read(t._getMember(r.userUuid),2),o=i[0],a=i[1];if(o){var s=o.role;o.role=n,t._setMember(o,a),a&&t._handlePermissionByRoleChanged(n.name),t._listeners.onMemberRoleChanged&&t._listeners.onMemberRoleChanged(o,s,n)}else t._logger.error("not found member ".concat(r.userUuid))},e[NERoomEventFromServer.MEMBER_JOIN_RTC_ROOM]=function(e){console.log("MEMBER_JOIN_RTC_ROOM",e);var r=t._createMember(e.members[0],t._roomInfo),n=__read(t._getMember(r.uuid),2),i=n[0],o=n[1];i?(r.isInRtcChannel=!0,r._isInServerRtc=!0,i=__assign(__assign({},i),r),t._setMember(i,o),i.rtcUid&&t._remoteIsInClientRtcMap.get(i.rtcUid)&&i._isInServerRtc&&t._listeners.onMemberJoinRtcChannel&&t._listeners.onMemberJoinRtcChannel([i])):t._logger.error("not found member ".concat(r.uuid))},e[NERoomEventFromServer.MEMBER_LEAVE_RTC_ROOM]=function(e){var r=e.members[0],n=__read(t._getMember(r.userUuid),2),i=n[0],o=n[1];i?(i.isInRtcChannel=!1,i._isInServerRtc=!1,i.rtcUid=0,t._setMember(i,o),!i.rtcUid||t._remoteIsInClientRtcMap.get(i.rtcUid)||i.isInRtcChannel||t._listeners.onMemberLeaveRtcChannel&&t._listeners.onMemberLeaveRtcChannel([i])):console.warn("member ".concat(r.userUuid," not in RtcChannel"))},e[NERoomEventFromServer.MEMBER_NICKNAME_CHANGED]=function(e){var r=e.member,n=__read(t._getMember(r.userUuid),2),i=n[0],o=n[1];i?(i.name=r.userName,t._setMember(i,o),t._listeners.onMemberNameChanged&&t._listeners.onMemberNameChanged(i,i.name)):t._logger.error("not found member ".concat(r.userUuid))},e[NERoomEventFromServer.MEMBER_PROPERTIES_CHANGED]=function(e){var r=e.member,n=__read(t._getMember(r.userUuid),2),i=n[0],o=n[1];i?__read(t._getMember(e.operatorMember.userUuid),1)[0]?(i.properties=__assign(__assign({},i.properties),e.properties),t._setMember(i,o),t._listeners.onMemberPropertiesChanged&&t._listeners.onMemberPropertiesChanged(i,e.properties)):t._logger.error("not found operatorMember ".concat(e.operatorMember.userUuid)):t._logger.error("not found member ".concat(r.userUuid))},e[NERoomEventFromServer.MEMBER_PROPERTIES_DELETE]=function(e){var r,n=e.member,i=__read(t._getMember(n.userUuid),2),o=i[0],a=i[1];if(o){var s=o.properties[e.key];if(delete o.properties[e.key],"whiteboard"===e.key){if(!__read(t._getMember(e.operatorMember.userUuid),1)[0])return void t._logger.error("not found operatorMember ".concat(e.operatorMember.userUuid));t._logger.log("成员白板属性删除 "),o.isSharingWhiteboard=!1}t._setMember(o,a),t._listeners.onMemberPropertiesDeleted&&t._listeners.onMemberPropertiesDeleted(o.uuid,((r={})[e.key]=s,r))}else t._logger.error("not found member ".concat(n.userUuid))},e[NERoomEventFromServer.MEMBER_STREAM_STATE_CHANGED]=function(e){return __awaiter(t,void 0,void 0,(function(){var t,r,n,i,o,a,s;return __generator(this,(function(c){if(t=e.streams,r=e.member,n=__read(this._getMember(e.operatorMember.userUuid),1),i=n[0],o=__read(this._getMember(r.userUuid),2),a=o[0],s=o[1],!a)return this._logger.error("not found member ".concat(r.userUuid)),[2];if(!i)return this._logger.error("not found operatorMember ".concat(e.operatorMember.userUuid)),[2];if(t.video)a.isVideoOn=1===t.video.value,this._setMember(a,s),s&&i.uuid!==a.uuid&&this.rtcController&&this.rtcController.operateStream("video",a.isVideoOn),this._listeners.onMemberVideoMuteChanged&&this._listeners.onMemberVideoMuteChanged(a,!a.isVideoOn,i);else if(t.audio)a.isAudioOn=1===t.audio.value,this._setMember(a,s),s&&i.uuid!==a.uuid&&this.rtcController&&this.rtcController.operateStream("audio",a.isAudioOn),this._listeners.onMemberAudioMuteChanged&&this._listeners.onMemberAudioMuteChanged(a,!a.isAudioOn,i);else if(t.subVideo){if(!i)return this._logger.error("not found operatorMember ".concat(e.operatorMember.userUuid)),[2];a.isSharingScreen=1===t.subVideo.value,this._setMember(a,s),s&&i.uuid!==a.uuid&&a.isSharingScreen&&this.rtcController&&this.rtcController.operateStream("screen",a.isSharingScreen),this.rtcController&&this.rtcController.setScreenSharingUserUuid(a.isSharingScreen?a.uuid:""),this._listeners.onMemberScreenShareStateChanged&&this._listeners.onMemberScreenShareStateChanged(a,a.isSharingScreen,i)}return[2]}))}))},e[NERoomEventFromServer.MEMBER_STREAM_STATE_DELETE]=function(e){return __awaiter(t,void 0,void 0,(function(){var t,r,n,i,o,a;return __generator(this,(function(s){if(t=e.member,r=__read(this._getMember(t.userUuid),2),n=r[0],i=r[1],o=__read(this._getMember(e.operatorMember.userUuid),1),a=o[0],!n)return this._logger.error("MEMBER_STREAM_STATE_DELETE not found member ".concat(t.userUuid,", ")),[2];if(!a)return this._logger.error("not found operatorMember ".concat(e.operatorMember.userUuid)),[2];if("video"===e.streamType)n.isVideoOn=!1,this._listeners.onMemberVideoMuteChanged&&this._listeners.onMemberVideoMuteChanged(n,!0,a),i&&a.uuid!==n.uuid&&this.rtcController&&this.rtcController.operateStream("video",!1);else if("audio"===e.streamType)n.isAudioOn=!1,this._listeners.onMemberAudioMuteChanged&&this._listeners.onMemberAudioMuteChanged(n,!0,a),i&&a.uuid!==n.uuid&&this.rtcController&&this.rtcController.operateStream("audio",!1);else if("subVideo"===e.streamType){if(!a)return this._logger.error("not found operatorMember ".concat(e.operatorMember.userUuid)),[2];i&&a.uuid!==n.uuid&&this.rtcController&&this.rtcController.operateStream("screen",!1),n.isSharingScreen=!1,this.rtcController&&this.rtcController.setScreenSharingUserUuid(""),this._listeners.onMemberScreenShareStateChanged&&this._listeners.onMemberScreenShareStateChanged(n,!1,a)}return this._setMember(n,i),[2]}))}))},e[NERoomEventFromServer.MEMBER_STREAM_STATE_INIT]=function(e){var r=e.member;if(e.roomUuid===t.roomUuid){var n=__read(t._getMember(r.userUuid),2),i=n[0],o=n[1];if(!i)throw new Error("not found member ".concat(r.userUuid));i.isAudioOn&&(i.isAudioOn=!1,t._listeners.onMemberAudioMuteChanged&&t._listeners.onMemberAudioMuteChanged(i,!0,i)),i.isVideoOn&&(i.isVideoOn=!1,t._listeners.onMemberVideoMuteChanged&&t._listeners.onMemberVideoMuteChanged(i,!0,i)),i.isSharingScreen&&(i.isSharingScreen=!1,t.rtcController&&t.rtcController.setScreenSharingUserUuid(""),t._listeners.onMemberScreenShareStateChanged&&t._listeners.onMemberScreenShareStateChanged(i,!1,i)),t._setMember(i,o)}},e[NERoomEventFromServer.ROOM_PROPERTIES_CHANGED]=function(e){var r;if(e.properties){var n=e.properties;t._roomInfo.properties=__assign(__assign({},t._roomInfo.properties),n),t._roomProperties=__assign(__assign({},t._roomProperties),n);var i=n.wbSharingUuid;if(i){t._logger.log("房间白板属性变更 ",i);var o=i.value,a=__read(t._getMember(o),2),s=a[0],c=a[1];if(!s)return void t._logger.error("not found member ".concat(o));var u=__read(t._getMember(e.operatorMember.userUuid),1)[0];if(!u)return void t._logger.error("not found operatorMember ".concat(e.operatorMember.userUuid));s.isSharingWhiteboard=s.uuid===o,null===(r=t.whiteboardController)||void 0===r||r.setWhiteboardNeedInfo(o),t._setMember(s,c),t._listeners.onMemberWhiteboardStateChanged&&t._listeners.onMemberWhiteboardStateChanged(__assign({},s),s.isSharingWhiteboard,u)}else n.lock?(t._logger.log("房间锁定状态变更",n),t.isRoomLocked=1===n.lock.value,t._listeners.onRoomLockStateChanged&&t._listeners.onRoomLockStateChanged(t.isRoomLocked)):(t._logger.log("房间属性变更",n),t._listeners.onRoomPropertiesChanged&&t._listeners.onRoomPropertiesChanged(n))}},e[NERoomEventFromServer.ROOM_PROPERTIES_DELETE]=function(e){var r,n,i=t._roomProperties[e.key];if(i&&"wbSharingUuid"===e.key){t._logger.log("房间白板属性删除",i);var o=__read(t._getMember(i.value),2),a=o[0],s=o[1],c=__read(t._getMember(e.operatorMember.userUuid),1)[0];a||c?a&&(a.isSharingWhiteboard=!1,t._setMember(a,s)):(t._logger.warn("not found member ".concat(i.value)),t._logger.warn("not found operatorMember ".concat(e.operatorMember.userUuid))),t._listeners.onMemberWhiteboardStateChanged&&t._listeners.onMemberWhiteboardStateChanged(a,!1,c),i.value="",null===(n=t.whiteboardController)||void 0===n||n.setWhiteboardNeedInfo("")}var u=t._roomProperties[e.key];delete t._roomInfo.properties[e.key],delete t._roomProperties[e.key],t._listeners.onRoomPropertiesDeleted&&t._listeners.onRoomPropertiesDeleted(((r={})[e.key]=u,r))},e[NERoomEventFromServer.ROOM_STATE_CHANGED]=function(){},e[NERoomEventFromServer.ROOM_STATE_DELETE]=function(){},e[NERoomEventFromServer.MEMBER_JOIN_CHATROOM_ROOM]=function(e){var r=e.members[0],n=__read(t._getMember(r.userUuid),2),i=n[0],o=n[1];i?(i.isInChatroom=!0,t._setMember(i,o),t._listeners.onMemberJoinChatroom&&t._listeners.onMemberJoinChatroom([i])):console.warn("member ".concat(r.userUuid," not in room"))},e[NERoomEventFromServer.MEMBER_LEAVE_CHATROOM_ROOM]=function(e){var r=e.members[0],n=__read(t._getMember(r.userUuid),2),i=n[0],o=n[1];i?(i.isInChatroom=!1,t._setMember(i,o),t._listeners.onMemberLeaveChatroom&&t._listeners.onMemberLeaveChatroom([i])):console.warn("member ".concat(r.userUuid," not in room"))},e[NERoomEventFromServer.ROOM_LIVE_STATE_CHANGED]=function(e){var r=__assign({},e);t.liveController&&(r.userUuidList&&Array.isArray(r.userUuidList)&&(r.userUuidList=t.liveController._getUuidListByRtcUidList(e.liveAVRoomUids)),t.liveController.setLiveInfo(r)),t._listeners.onRoomLiveStateChanged&&t._listeners.onRoomLiveStateChanged(e.state)},e},t.prototype._setMember=function(e,t){t?(this._localMember=e,this.rtcController&&this.rtcController.setLocalMember(this._localMember)):(this._remoteMemberMap.set(e.uuid,e),this.rtcController&&this.rtcController.setRemoteMemberMap(this._remoteMemberMap))},t.prototype._setMemberIsInClientRtc=function(e,t,r){if(console.log("setMemberIsInClientRtc",e,t,r),this._remoteIsInClientRtcMap.set(t,r),e){var n=__read(this._getMember(e),2),i=n[0],o=n[1];console.log("localMember",i),i&&(i.rtcUid=t,r?(i._isInServerRtc||i.isInRtcChannel)&&(i.isInRtcChannel=!0,this._listeners.onMemberJoinRtcChannel&&this._listeners.onMemberJoinRtcChannel([i])):!1===i._isInServerRtc&&(i.isInRtcChannel=!1,i.rtcUid=0,this._listeners.onMemberLeaveRtcChannel&&this._listeners.onMemberLeaveRtcChannel([i])),this._setMember(i,o))}},t.prototype._getMember=function(e){var t,r=!1;return this._localMember&&e===this._localMember.uuid?(t=this._localMember,r=!0):t=this._remoteMemberMap.get(e),t&&(t=JSON.parse(JSON.stringify(t))),[t,r]},t.prototype._initListener=function(){var e=this;this._listenerHandlesMap=this._createListenerHandlesMap(),console.log("initListener"),this._im.on("imDisconnect",(function(t){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return"kicked"!==t.code?[3,2]:[4,this.destroy()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})),this._im.on("controlNotify",this._controlNotifyListener),this._addInnerListeners()},t.prototype._resetMember=function(){return{isAudioOn:!1,isInChatroom:!1,isInRtcChannel:!1,isSharingScreen:!1,isVideoOn:!1,isSharingWhiteboard:!1,name:"",rtcUid:0,properties:{},role:{name:"",limit:0,params:{audio:{profile:"",scenario:""},screen:{videoProfile:""},video:{fps:0,height:0,width:0}},superRole:!1},uuid:"",clientType:NEClientType.WEB}},t.prototype._handleSequence=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:if(t=!0,!(e-this._sequence>1))return[3,5];t=!1,n.label=1;case 1:return n.trys.push([1,3,4,5]),this._isFetching=!0,[4,this._getMeetingInfo()];case 2:return n.sent(),[3,5];case 3:return r=n.sent(),console.error(r),t=!0,[3,5];case 4:return this._isFetching=!1,[7];case 5:return[2,t]}}))}))},t.prototype._getMeetingInfo=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._request.getSnapshotApi(this.roomUuid)];case 1:return e=r.sent(),this._diffMeetingInfo(e),[3,3];case 2:return t=r.sent(),[2,Promise.reject(t)];case 3:return[2]}}))}))},t.prototype._diffMeetingInfo=function(e){var t,r=e.snapshot.room,n=__read(this._createRemoteMembers(e.snapshot.members,e.snapshot.room,this._localMember.uuid),2),i=n[0],o=n[1];this._diffRoomInfo(r,i),this._diffMember(i,o),this._remoteMemberMap=i,this._localMember=o,this._sequence=e.sequence,this._roomInfo=e.snapshot.room,this._roomProperties=__assign(__assign({},this._roomProperties),e.snapshot.room.properties);var a=this._roomInfo.properties.whiteboard;null===(t=this.whiteboardController)||void 0===t||t.setWhiteboardNeedInfo(a)},t.prototype._diffMember=function(e,t){var r,n,i,o,a=[],s=[],c=function(r,n){var i=e.get(r);if(i){if(n.role.name!=i.role.name&&(n.uuid===u._localMember.uuid&&u._handlePermissionByRoleChanged(n.role.name),u._listeners.onMemberRoleChanged&&u._listeners.onMemberRoleChanged(t,n.role,i.role)),n.isInRtcChannel!=i.isInRtcChannel&&(i.isInRtcChannel?u._listeners.onMemberJoinRtcChannel&&u._listeners.onMemberJoinRtcChannel([i]):u._listeners.onMemberLeaveRtcChannel&&u._listeners.onMemberLeaveRtcChannel([i])),n.name!=i.name&&u._listeners.onMemberNameChanged&&u._listeners.onMemberNameChanged(i,i.name),n.isVideoOn!=i.isVideoOn&&u._listeners.onMemberVideoMuteChanged&&u._listeners.onMemberVideoMuteChanged(i,!i.isVideoOn,i),n.isAudioOn!=i.isAudioOn&&u._listeners.onMemberAudioMuteChanged&&u._listeners.onMemberAudioMuteChanged(i,!i.isAudioOn,i),n.isSharingScreen!=i.isSharingScreen&&(u.rtcController&&u.rtcController.setScreenSharingUserUuid(i.isSharingScreen?i.uuid:""),u._listeners.onMemberScreenShareStateChanged&&u._listeners.onMemberScreenShareStateChanged(i,i.isSharingScreen,i)),n.isInChatroom!=i.isInChatroom&&(i.isInChatroom?u._listeners.onMemberJoinChatroom&&u._listeners.onMemberJoinChatroom([i]):u._listeners.onMemberLeaveChatroom&&u._listeners.onMemberLeaveChatroom([i])),i.properties){var o={},s={},c=i.properties,l=n.properties,d=Object.keys(l),p=Object.keys(c);d.forEach((function(e){var t=p.indexOf(e);if(t>0){var r=JSON.stringify(c[e]),n=JSON.stringify(l[e]);"[object Object]"===Object.prototype.toString.call(c[e])&&"[object Object]"===Object.prototype.toString.call(l[e])&&(r=JSON.stringify(__assign(__assign({},l[e]),c[e]))),r!=n&&(o[e]=c[e])}else s[e]=l[e];p.splice(t,1)})),p.length>0&&p.forEach((function(e){o[e]=c[e]})),Object.keys(o).length>0&&u._listeners.onMemberPropertiesChanged&&u._listeners.onMemberPropertiesChanged(t,o),Object.keys(s).length>0&&u._listeners.onMemberPropertiesDeleted&&u._listeners.onMemberPropertiesDeleted(t.uuid,s)}}else a.push(n)},u=this;try{for(var l=__values(this._remoteMemberMap.entries()),d=l.next();!d.done;d=l.next()){var p=__read(d.value,2);c(p[0],p[1])}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}a.length>0&&this._listeners.onMemberLeaveRoom&&this._listeners.onMemberLeaveRoom(a);try{for(var f=__values(e.keys()),h=f.next();!h.done;h=f.next()){var m=h.value;if(!this._remoteMemberMap.has(m)){var g=e.get(m);g&&s.push(g)}}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}s.length>0&&this._listeners.onMemberJoinRoom&&this._listeners.onMemberJoinRoom(s)},t.prototype._diffRoomInfo=function(e,t){var r=this;console.log("开始房间属性diff");var n=Object.keys(this._roomProperties),i=Object.keys(e.properties),o={},a={};n.forEach((function(n){var s=i.indexOf(n);if(s>=0)if("wbSharingUuid"===n){var c=e.properties[n].value;if(r._roomProperties[n].value!=c){var u=t.get(c);r._listeners.onMemberWhiteboardStateChanged&&r._listeners.onMemberWhiteboardStateChanged(__assign({},u),!0,__assign({},u))}}else if("lock"===n){var l=e.properties[n].value;r._roomProperties[n].value!=l&&(r.isRoomLocked=1==l,r._listeners.onRoomLockStateChanged&&r._listeners.onRoomLockStateChanged(r.isRoomLocked))}else{var d=JSON.stringify(e.properties[n]),p=JSON.stringify(r._roomProperties[n]);"[object Object]"===Object.prototype.toString.call(e.properties[n])&&"[object Object]"===Object.prototype.toString.call(r._roomProperties[n])&&(d=JSON.stringify(__assign(__assign({},r._roomProperties[n]),e.properties[n]))),d!=p&&(a[n]=e.properties[n])}else o[n]=r._roomProperties[n];i.splice(s,1)})),i.length>0&&i.forEach((function(t){a[t]=e.properties[t]})),Object.keys(a).length>0&&this._listeners.onRoomPropertiesChanged&&this._listeners.onRoomPropertiesChanged(a),Object.keys(o).length>0&&this._listeners.onRoomPropertiesDeleted&&this._listeners.onRoomPropertiesDeleted(a)},t.prototype._handlePermissionByRoleChanged=function(e){var t=getStreamPermissionFromTemplate(e,this._templateConfig);this._logger.log("角色变更rolePermissions",t),!t.audio&&this._localMember.isAudioOn&&this.rtcController&&this.rtcController.muteMyAudio,!t.video&&this._localMember.isVideoOn&&this.rtcController&&this.rtcController.muteMyVideo(),!t.subVideo&&this._localMember.isSharingScreen&&this.rtcController&&this.rtcController.stopScreenShare()},t.TAG_NAME="NERoomContextService",t}(NEBaseService),NEPreviewController=function(e){function t(r){var n=e.call(this,{rtc:r.rtc,isSupported:!!r.rtc,token:r.token,logger:r.logger})||this;return n.isSupported=!0,n._listener={},n.isSupported=r.isSupported,r.rtc?(n.logger=r.logger,n._rtc=r.rtc,n._appkey=r.appkey||"123123",n._token=r.token,n.logger.log(t.TAG_NAME,"constructor",r),n.init(),n):(n.isSupported=!1,n)}return __extends(t,e),t.prototype.init=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];this.logger.log(t.TAG_NAME,"init--start--");try{this._rtc.init({nrtcAppKey:this._appkey}),this._rtc.setUid(11),this._rtc.setMediaParams({audio:!1,video:!1,screen:!1}),this._isInit=!0,this.logger.log(t.TAG_NAME,"init success")}catch(e){return this.logger.log(t.TAG_NAME,"init fail",e),[2,FailureBody(e)]}return[2]}))}))},t.prototype.getDeviceListData=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0})];case 1:return t.sent(),[2,this._rtc.getDeviceListData()];case 2:throw e=t.sent(),new Error(e);case 3:return[2]}}))}))},t.prototype.switchDevice=function(e){var r;return __awaiter(this,void 0,void 0,(function(){var n,i;return __generator(this,(function(o){switch(o.label){case 0:if(!this.isSupported)throw new Error(NEErrorMessage.NOT_SUPPORT);if(!this._isInit)throw new Error(NEErrorMessage.NOT_INIT_PREVIEW);if(this._testMic||this._testSpeaker)throw new Error("请先停止设备检测");this.logger.log(t.TAG_NAME,"switchDevice"),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this._rtc.switchDevice(e)];case 2:return n=o.sent(),[4,null===(r=this._testAudio)||void 0===r?void 0:r.setSinkId(n.deviceId)];case 3:return o.sent(),[2,n];case 4:throw i=o.sent(),new Error(i);case 5:return[2]}}))}))},t.prototype.startRecordDeviceTest=function(e){return __awaiter(this,void 0,void 0,(function(){var r,n,i=this;return __generator(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,FailureBody(NEErrorCode.FAILURE,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(NEErrorCode.FAILURE,NEErrorMessage.NOT_INIT_PREVIEW)];if(this._testSpeaker)return[2,FailureBody({code:NEErrorCode.FAILURE,msg:"请先停止扬声器检测"})];if(this._testMic)return[2,FailureBody({msg:"麦克风检测进行时..."})];this.logger.log(t.TAG_NAME,"startCheckMicrophone--start--"),o.label=1;case 1:return o.trys.push([1,3,,4]),this._videoView||((r=document.createElement("div")).id="tempDivForLocalStream",r.style.height="10px",r.style.width="10px",document.body.appendChild(r),this._rtc.setupLocalVideoCanvas(r)),this._rtc.setMediaParams({audio:!1}),[4,this._rtc.open("audio",!1)];case 2:return o.sent(),i._microTestTimer=window.setInterval((function(){var t=i._rtc.getAudioLevel();console.log("level   ",t),e(NEErrorCode.SUCCESS,t)}),100),this._testMic=!0,this.logger.log(t.TAG_NAME,"startCheckMicrophone success"),[2,SuccessBody(null)];case 3:return n=o.sent(),this.logger.log(t.TAG_NAME,"startCheckMicrophone fail",n),[2,FailureBody(n)];case 4:return[2]}}))}))},t.prototype.stopRecordDeviceTest=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_PREVIEW)];if(!this._testMic)return[2,FailureBody({msg:"请先开始麦克风检测"})];this.logger.log(t.TAG_NAME,"stopCheckMicrophone--start--");try{return this._rtc.close("audio"),window.clearInterval(this._microTestTimer),this._microTestTimer=0,this._testMic=!1,this.logger.log(t.TAG_NAME,"stopCheckMicrophone success"),[2,SuccessBody(null)]}catch(e){return this.logger.log(t.TAG_NAME,"stopCheckMicrophone fail",e),[2,FailureBody(e)]}return[2]}))}))},t.prototype.startPlayoutDeviceTest=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_PREVIEW)];if(this._testMic)return[2,FailureBody({code:NEErrorCode.FAILURE,msg:"请先停止麦克风检测"})];if(this._testSpeaker)return[2,FailureBody({msg:"扬声器检测进行时..."})];try{return this.logger.log(t.TAG_NAME,"startCheckSpeaker"),e=e||"https://app.yunxin.163.com/webdemo/audio/rain.mp3",this._testAudio=new Audio(e),this._testAudio.loop=!0,this._testAudio.play(),this._testSpeaker=!0,[2,SuccessBody(null)]}catch(e){return[2,FailureBody(e)]}return[2]}))}))},t.prototype.stopPlayoutDeviceTest=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this.isSupported?this._isInit?this._testAudio?(this.logger.log(t.TAG_NAME,"stopCheckSpeaker"),this._testAudio.pause(),this._testSpeaker=!1,[2,SuccessBody(null)]):[2,FailureBody({code:NEErrorCode.FAILURE,msg:"请先开始扬声器检测"})]:[2,FailureBody(null,NEErrorMessage.NOT_INIT_PREVIEW)]:[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)]}))}))},t.prototype.setupLocalVideoCanvas=function(e){if(!this.isSupported)return this.logger.error(NEErrorMessage.NOT_SUPPORT),-1;if(!this._isInit)return this.logger.error(NEErrorMessage.NOT_INIT_PREVIEW),-1;if(!e)return this.logger.error("请设置正确的绘制视图"),-1;this.logger.log(t.TAG_NAME,"setVideoView--start--");try{this._videoView=e,this._rtc.setupLocalVideoCanvas(e);var r=document.getElementById("tempDivForLocalStream");if(r){var n=null==r?void 0:r.parentNode;null==n||n.removeChild(r)}return this.logger.log(t.TAG_NAME,"setVideoView success"),0}catch(e){return this.logger.log(t.TAG_NAME,"setVideoView fail",e),-1}},t.prototype.startPreview=function(e){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_PREVIEW)];if(!this._videoView&&!e)return[2,FailureBody({code:NEErrorCode.FAILURE,msg:"请先设置视图"})];this.logger.log(t.TAG_NAME,"startVideoPreview--start--"),n.label=1;case 1:return n.trys.push([1,3,,4]),e&&this.setupLocalVideoCanvas(e),[4,this._rtc.open("video",!1)];case 2:return n.sent(),this.logger.log(t.TAG_NAME,"startVideoPreview success"),[2,SuccessBody(null)];case 3:return r=n.sent(),this.logger.log(t.TAG_NAME,"startVideoPreview fail",r),[2,FailureBody(r)];case 4:return[2]}}))}))},t.prototype.stopPreview=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_PREVIEW)];this.logger.log(t.TAG_NAME,"stopVideoPreview--start--"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._rtc.close("video")];case 2:return r.sent(),this.logger.log(t.TAG_NAME,"stopVideoPreview success"),[2,SuccessBody(null)];case 3:return e=r.sent(),this.logger.log(t.TAG_NAME,"stopVideoPreview fail",e),[2,FailureBody(e)];case 4:return[2]}}))}))},t.prototype.checkSystemRequirements=function(){return __awaiter(this,void 0,void 0,(function(){var e,r;return __generator(this,(function(n){switch(n.label){case 0:if(!this.isSupported)throw new Error(NEErrorMessage.NOT_SUPPORT);if(!this._isInit)throw new Error(NEErrorMessage.NOT_INIT_PREVIEW);this.logger.log(t.TAG_NAME,"checkSystemRequirements--start--"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._rtc.checkSystemRequirements()];case 2:return e=n.sent(),this.logger.log(t.TAG_NAME,"checkSystemRequirements success",e),[2,e];case 3:throw r=n.sent(),this.logger.log(t.TAG_NAME,"checkSystemRequirements fail",r),new Error(r);case 4:return[2]}}))}))},t.prototype.destroy=function(){var e;return __awaiter(this,void 0,void 0,(function(){var r,n,i;return __generator(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,FailureBody(null,NEErrorMessage.NOT_SUPPORT)];if(!this._isInit)return[2,FailureBody(null,NEErrorMessage.NOT_INIT_PREVIEW)];this.logger.log(t.TAG_NAME,"destroy--start--"),o.label=1;case 1:return o.trys.push([1,6,,7]),this._testMic?[4,this.stopRecordDeviceTest()]:[3,3];case 2:o.sent(),o.label=3;case 3:return this._testSpeaker?[4,this.stopPlayoutDeviceTest()]:[3,5];case 4:o.sent(),o.label=5;case 5:return this._testAudio=null,(r=document.getElementById("tempDivForLocalStream"))&&(null==(n=null==r?void 0:r.parentNode)||n.removeChild(r)),this._rtc.destroy(),null===(e=this._recvClient)||void 0===e||e.destroy(),this._recvClient=null,this._isInit=!1,this.logger.log(t.TAG_NAME,"destroy success"),[3,7];case 6:return i=o.sent(),this.logger.log(t.TAG_NAME,"destroy fail",i),[2,FailureBody(i)];case 7:return[2]}}))}))},t.TAG_NAME="NEPreviewController",t}(NERoomRtcBaseController),NEPreviewRoomContextService=function(){function e(e){this._listeners={},this._eventEmitter=e.eventEmitter,this.previewController=new NEPreviewController({logger:e.logger,rtc:e.Rtc,appkey:e.appKey,token:e.token,isSupported:!!e.Rtc}),this._initListener()}return e.prototype.addPreviewRoomListener=function(e){this._listeners=e||{}},e.prototype.removePreviewRoomListener=function(e){this._listeners={}},e.prototype.destroy=function(){this.previewController.destroy()},e.prototype._initListener=function(){var e=this;this._eventEmitter.on(RTC_EVENT.CAMERA_DEVICE_CHANGE,(function(t){e._listeners.onCameraDeviceChanged&&e._listeners.onCameraDeviceChanged(t)})),this._eventEmitter.on(RTC_EVENT.SPEAKER_DEVICE_CHANGE,(function(t){e._listeners.onPlayoutDeviceChanged&&e._listeners.onPlayoutDeviceChanged(t)})),this._eventEmitter.on(RTC_EVENT.RECORD_DEVICES_CHANGE,(function(t){e._listeners.onRecordDeviceChanged&&e._listeners.onRecordDeviceChanged(t)}))},e}(),NERoomService=function(e){function t(t){var r=e.call(this)||this;return r._roomContext=null,r._roomContextMap=new Map,r._request=t.request,r._Rtc=t.rtc,r._PreviewRtc=t.previewRtc,r._Chatroom=t.chatroom,r._Whiteboard=t.whiteboard,r._ToolCollection=t.toolCollection,r._eventEmitter=t.eventEmitter,r._logger=t.logger,r._debug=t.debug||!1,r._Im=t.IM,r._privateRtcConfig=t.privateRtcConfig,r._privateWhiteboardConfig=t.privateWhiteboardConfig,r._deviceId=t.deviceId,r}return __extends(t,e),t.prototype.createRoom=function(e,r){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:this._logger.log(t.TAG_NAME,"createRoom"),n.label=1;case 1:return n.trys.push([1,3,,4]),r=r||{enableChatroom:!0,enableLive:!1,enableRecord:!0,enableRtc:!0,enableWhiteboard:!1},[4,this._request.createRoomApi({properties:e.initialProperties,roomName:e.roomName,roomUuid:e.roomUuid,configId:e.templateId,password:e.password,config:{resource:{rtc:null==r?void 0:r.enableRtc,chatroom:null==r?void 0:r.enableChatroom,whiteboard:null==r?void 0:r.enableWhiteboard,live:null==r?void 0:r.enableLive,record:null==r?void 0:r.enableRecord}}})];case 2:return n.sent(),[2,SuccessBody(null)];case 3:return[2,FailureBody(n.sent())];case 4:return[2]}}))}))},t.prototype.getRoomContext=function(e){return this._roomContextMap.get(e)||null},t.prototype.getPreviewRoomContext=function(){return this._previewRoomContext||(this._previewRoomContext=new NEPreviewRoomContextService({debug:this._debug,Rtc:this._PreviewRtc,eventEmitter:this._eventEmitter,appKey:"",token:"",logger:this._logger})),this._previewRoomContext},t.prototype.getTemplateConfig=function(e){return this._request.getRoomConfigApi(e)},t.prototype.previewRoom=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this._previewRoomContext||(this._previewRoomContext=new NEPreviewRoomContextService({debug:this._debug,Rtc:this._PreviewRtc,eventEmitter:this._eventEmitter,appKey:"",token:"",logger:this._logger})),[2,SuccessBody(this._previewRoomContext)]}))}))},t.prototype.joinRoom=function(e,r){return __awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,c,u,l,d,p,f;return __generator(this,(function(h){switch(h.label){case 0:if(!e.role||!e.roomUuid)throw this._logger.error(t.TAG_NAME,"joinRoom params error"),new Error("joinRoom params error");h.label=1;case 1:return h.trys.push([1,5,,6]),r=this,[4,this._request.getRoomConfigApi(e.roomUuid)];case 2:return r._templateConfig=h.sent(),[4,this._request.joinRoomApi({role:e.role,roomUuid:e.roomUuid,userName:e.userName,password:e.password,properties:e.initialProperties})];case 3:return n=h.sent(),this._logger.log(t.TAG_NAME,"joinRoomInfo",n),i=n.member,o=n.room,a=o.roomName,s=o.roomUuid,c=o.properties,u=o.rtcCid,[4,this._request.getSnapshotApi(s)];case 4:if(l=h.sent(),d=this._roomContextMap.get(e.roomUuid)){if(d.roomUuid)return console.warn("重复加入房间",e.roomUuid),[2,SuccessBody(d)];console.warn("该房间已销毁重新初始化: ",e.roomUuid),this._roomContextMap.delete(e.roomUuid)}return p=new NERoomContextService({debug:this._debug,deviceId:this._deviceId,Rtc:this._Rtc,Chatroom:this._Chatroom,Whiteboard:this._Whiteboard,roomName:a,roomUuid:s,cid:u,toolCollection:this._ToolCollection,request:this._request,eventEmitter:this._eventEmitter,roomProperties:c,appKey:i.rtcKey,member:i,deleteRoomContext:this._deleteRoomContext.bind(this),templateConfig:this._templateConfig,snapshotData:l,joinRoomInfo:o,logger:this._logger,IM:this._Im,privateRtcConfig:this._privateRtcConfig,privateWhiteboardConfig:this._privateWhiteboardConfig}),this._roomContextMap.set(s,p),[2,SuccessBody(p)];case 5:return f=h.sent(),[2,Promise.reject(f)];case 6:return[2]}}))}))},t.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){var e,r,n,i,o,a;return __generator(this,(function(s){switch(s.label){case 0:this._logger.log(t.TAG_NAME,"destroy"),s.label=1;case 1:s.trys.push([1,6,7,8]),e=__values(this._roomContextMap.keys()),r=e.next(),s.label=2;case 2:return r.done?[3,5]:(n=r.value,[4,this._resetState(n)]);case 3:s.sent(),s.label=4;case 4:return r=e.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),o={error:i},[3,8];case 7:try{r&&!r.done&&(a=e.return)&&a.call(e)}finally{if(o)throw o.error}return[7];case 8:return[2]}}))}))},t.prototype._resetState=function(e){var r;return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),this._roomContextMap.has(e)?[4,null===(r=this._roomContextMap.get(e))||void 0===r?void 0:r.destroy()]:[3,2];case 1:i.sent(),this._roomContextMap.delete(e),i.label=2;case 2:return[3,4];case 3:return n=i.sent(),this._logger.error(t.TAG_NAME,"resetState",n),[3,4];case 4:return[2]}}))}))},t.prototype._deleteRoomContext=function(e){this._roomContextMap.has(e)&&this._roomContextMap.delete(e)},t.TAG_NAME="NERoomService",t}(NEBaseService),NEAuthService=function(e){function t(t){var r=e.call(this)||this;return r.isLoggedIn=!1,r.imPrivateConf=void 0,r._im=t.IM,r._request=t.request,r.logger=t.logger,r.imPrivateConf=t.privateConf,r._eventEmitter=t.eventEmitter,r}return __extends(t,e),t.prototype.addAuthListener=function(e){var r=this;this.logger.log(t.TAG_NAME,"addAuthListener"),this._im.on("imDisconnect",(function(n){if(r.logger.log(t.TAG_NAME,"连接断开",n),n)switch(n.code){case 302:e.onAuthEvent&&e.onAuthEvent(NEAuthEvent.ACCOUNT_TOKEN_ERROR);break;case 417:break;case"kicked":e.onAuthEvent&&e.onAuthEvent(NEAuthEvent.KICK_OUT)}})),this._im.on("imConnect",(function(n){r.logger.log(t.TAG_NAME,"连接成功",n),e.onAuthEvent&&e.onAuthEvent(NEAuthEvent.LOGGED_IN)})),this._im.on("imLogout",(function(n){r.logger.log(t.TAG_NAME,"退出登录",n),e.onAuthEvent&&e.onAuthEvent(NEAuthEvent.LOGGED_OUT)})),this._eventEmitter.on(HTTP_EVENT.UNAUTHORIZED,(function(n){return __awaiter(r,void 0,void 0,(function(){return __generator(this,(function(r){return this.logger.log(t.TAG_NAME,"unauthorized"),this.logout().finally((function(){e.onAuthEvent&&e.onAuthEvent(n)})),[2]}))}))})),this._eventEmitter.on(HTTP_EVENT.TOKEN_EXPIRED,(function(n){r.logger.log(t.TAG_NAME,"token_expired"),e.onAuthEvent&&e.onAuthEvent(n)}))},t.prototype.login=function(e,r){return __awaiter(this,void 0,void 0,(function(){var n,i;return __generator(this,(function(o){switch(o.label){case 0:this.logger.log(t.TAG_NAME,"login",e,r),o.label=1;case 1:return o.trys.push([1,4,,5]),this._request.setToken(r),this._request.setUserUuid(e),this._request.setHeaders({}),[4,this._request.loginApi()];case 2:return n=o.sent(),this.roomAccountId=n.userUuid,this.roomAccountToken=n.imToken,this.roomAppKey=n.imKey,[4,this.loginIM({appKey:n.imKey,token:n.imToken,account:n.userUuid})];case 3:return o.sent(),[2,SuccessBody(null)];case 4:throw i=o.sent(),this.logger.error(t.TAG_NAME,"login fail：",i),this._request.setToken(""),this._request.setUserUuid(""),i;case 5:return[2]}}))}))},t.prototype.loginByDynamicToken=function(e,r){return __awaiter(this,void 0,void 0,(function(){var n,i;return __generator(this,(function(o){switch(o.label){case 0:this.logger.log(t.TAG_NAME,"loginByDynamicToken",e,r),this._request.setHeaders({authType:1}),this._request.setUserUuid(e),this._request.setToken(r),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this._request.loginByIMApi()];case 2:return n=o.sent(),this.roomAccountId=n.userUuid,this.roomAccountToken=this._im.nim.options.token,this.roomAppKey=n.imKey,[4,this.loginIM({appKey:n.imKey,token:this.roomAccountToken,account:n.userUuid})];case 3:return o.sent(),[2,SuccessBody(null)];case 4:throw i=o.sent(),this.logger.error(t.TAG_NAME,"loginByDynamicToken fail：",i),this._request.setToken(""),this._request.setUserUuid(""),i;case 5:return[2]}}))}))},t.prototype.loginByIM=function(e,r,n){return __awaiter(this,void 0,void 0,(function(){var i,o;return __generator(this,(function(a){switch(a.label){case 0:this.logger.log(t.TAG_NAME,"loginByIM",e,r,n),a.label=1;case 1:return a.trys.push([1,4,,5]),this._request.setHeaders({authType:1}),this._request.setUserUuid(e),this._request.setToken(r),[4,this._request.loginByIMApi()];case 2:return i=a.sent(),this.roomAccountId=i.userUuid,this.roomAccountToken=n,this.roomAppKey=i.imKey,[4,this.loginIM({appKey:i.imKey,token:n,account:i.userUuid})];case 3:return a.sent(),[2,SuccessBody(null)];case 4:throw o=a.sent(),this.logger.error(t.TAG_NAME,"loginByIM fail：",o),this._request.setToken(""),this._request.setUserUuid(""),o;case 5:return[2]}}))}))},t.prototype.logout=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:this.logger.log(t.TAG_NAME,"logout"),r.label=1;case 1:return r.trys.push([1,3,,4]),this.isLoggedIn=!1,[4,this._im.logout()];case 2:return r.sent(),this._request.setToken(""),this._request.setUserUuid(""),[2,SuccessBody(null)];case 3:throw e=r.sent(),this.logger.error(t.TAG_NAME,"logout fail: ",e),e;case 4:return[2]}}))}))},t.prototype.removeAuthListener=function(){this.logger.log(t.TAG_NAME,"removeAuthListener"),this._im.off("imDisconnect"),this._im.off("imConnect"),this._eventEmitter.off(HTTP_EVENT.UNAUTHORIZED),this._eventEmitter.off(HTTP_EVENT.TOKEN_EXPIRED)},t.prototype.resetState=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.isLoggedIn?[4,this.logout()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.removeAuthListener(),this._request.setHeaders({}),this.imPrivateConf=void 0,[2]}}))}))},t.prototype.renewToken=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:if(!e)return[2,FailureBody(null,"token is empty")];t=this._request.token,this._request.setToken(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._request.checkToken()];case 2:return n.sent(),[2,SuccessBody(null)];case 3:return r=n.sent(),this._request.setToken(t),[2,FailureBody(r)];case 4:return[2]}}))}))},t.prototype.destroy=function(){this.logger.log(t.TAG_NAME,"destroy"),this.resetState()},t.prototype.loginIM=function(e){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:this.logger.log(t.TAG_NAME,"loginIM"),n.label=1;case 1:if(n.trys.push([1,3,,4]),!this.roomAppKey||!this.roomAccountId||!this.roomAccountToken)throw Error(NEPrivateError.NOT_LOGIN);return this._im.init(__assign(__assign({},e),{imPrivateConf:this.imPrivateConf,roomAppKey:this.roomAppKey,roomAccountId:this.roomAccountId,roomAccountToken:this.roomAccountToken})),this._request.setImToken(this.roomAccountToken),[4,this._im.login()];case 2:return n.sent(),this.isLoggedIn=!0,[3,4];case 3:throw r=n.sent(),this.logger.error(t.TAG_NAME,"loginIM fail: ",r),r;case 4:return[2]}}))}))},t.TAG_NAME="NEAuthService",t}(NEBaseService),NEMessageChannelService=function(e){function t(r){var n=e.call(this)||this;return n._controlNotifyListener=function(e){return __awaiter(n,void 0,void 0,(function(){var r,n,i,o,a;return __generator(this,(function(s){return(r=JSON.parse(e.body)).cmd<98||(this._logger.log(t.TAG_NAME,"controlNotify",r),n=r.data.message,i=r.data.roomUuid,o=null===(a=r.data.operatorMember)||void 0===a?void 0:a.userUuid,this._listener.onReceiveCustomMessage&&this._listener.onReceiveCustomMessage({roomUuid:i,senderUuid:o,data:n,commandId:r.cmd})),[2]}))}))},n._im=r.IM,n._request=r.request,n._logger=r.logger,n}return __extends(t,e),t.prototype.addMessageChannelListener=function(e){e&&(this._listener=e,this._im.on("controlNotify",this._controlNotifyListener))},t.prototype.removeMessageChannelListener=function(){this._im.off("controlNotify",this._controlNotifyListener)},t.prototype.sendCustomMessage=function(e,r,n,i){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(o){return this._logger.log(t.TAG_NAME,"sendCustomMessage",i),[2,this._request.passThroughMessageApi({roomUuid:e,userUuid:r,data:{cmdId:n,message:i}}).then((function(e){return SuccessBody(e)})).catch((function(e){return FailureBody(e)}))]}))}))},t.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this.removeMessageChannelListener(),[2,SuccessBody(null)]}))}))},t.TAG_NAME="NEMessageChannelService",t}(NEBaseService),Roomkit=function(){function e(e){this.isInitialized=!1,this._debug=!1,this._roomService=null,this._authService=null,this._messageService=null;var t=e.logger,r=e.EventEmitter,n=e.emitter,i=e.Chatroom,o=e.Rtc,a=e.Whiteboard,s=e.request,c=e.Im,u=e.ToolCollection,l=e.deviceId;a&&(this._whiteboard=a),u&&(this._ToolCollection=u),this._deviceId=l,this._IM=c,this._RTC=o,this._Chatroom=i,this._request=s,this._EventEmitter=r,this._eventEmitter=n,this._debug=e.debug||!1,this._logger=t}return e.prototype.getService=function(e){switch(e){case ServiceType.NERoomService:return this._getRoomService();case ServiceType.NEAuthService:return this._getAuthService();case ServiceType.NEMessageService:return this._getMessageService();default:return this._getRoomService()}},Object.defineProperty(e.prototype,"sdkVersions",{get:function(){return{imVersion:"8.11.3",roomKitVersion:"1.4.0",rtcVersion:"4.6.11",whiteboardVersion:"3.7.7"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authService",{get:function(){return this._getAuthService()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomService",{get:function(){return this._getRoomService()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"messageChannelService",{get:function(){return this._getMessageService()},enumerable:!1,configurable:!0}),e.prototype.initialize=function(e){if(!e.appKey)return FailureBodySync(null,NEErrorMessage.NO_APPKEY);if(this.isInitialized)return this._logger.warn("已初始化过"),SuccessBody(null);this._logger.log("initialize",e);var t=!1,r=new this._EventEmitter,n=new this._IM({logger:this._logger,debug:t,emitter:r,deviceId:"",version:"",clientType:NEClientType.WEB,reuseIM:e.im});if(this._im=n,this._chatroom=new this._Chatroom({debug:t,logger:this._logger,emitter:r,im:n}),this._previewRtc=new this._RTC({logger:this._logger,emitter:this._eventEmitter,debug:t}),this._rtc=new this._RTC({logger:this._logger,emitter:r,debug:t}),this.isInitialized=!0,this._request.setAppKey(e.appKey),console.log("options.serverConfig",e.serverConfig),e.serverConfig){this._privateImConfig=e.serverConfig.imServerConfig||null,this._privateRtcConfig=e.serverConfig.rtcServerConfig||null,this._privateWhiteboardConfig=e.serverConfig.whiteboardServerConfig||null;var i=e.serverConfig.roomKitServerConfig;i&&i.roomServer&&this._request.setBaseUrl(i.roomServer)}return this._authService=new NEAuthService({IM:this._im,eventEmitter:this._eventEmitter,request:this._request,logger:this._logger,privateConf:this._privateImConfig}),this._roomService=new NERoomService({debug:this._debug,request:this._request,rtc:this._rtc,previewRtc:this._previewRtc,whiteboard:this._whiteboard,toolCollection:this._ToolCollection,chatroom:this._chatroom,eventEmitter:this._eventEmitter,IM:this._im,logger:this._logger,privateRtcConfig:this._privateRtcConfig,privateWhiteboardConfig:this._privateWhiteboardConfig,deviceId:this._deviceId}),this._messageService=new NEMessageChannelService({IM:this._im,request:this._request,logger:this._logger}),SuccessBody(null)},e.prototype.release=function(){var e,t,r;try{return null===(e=this._roomService)||void 0===e||e.destroy(),null===(t=this._authService)||void 0===t||t.destroy(),null===(r=this._messageService)||void 0===r||r.destroy(),this._rtc.destroy(),this._im.destroy(),this.isInitialized=!1,SuccessBody(null)}catch(e){return FailureBodySync(e,NEErrorMessage.FAILURE)}},e.prototype.emit=function(e,t){this._im&&(console.log("emit...",e,t),this._im.onReuseIm(e,t))},e.prototype.reuseIM=function(e){if(e.getInstance){var t=this,r=e.getInstance.bind(e);this._logger.log("开始复写getInstance"),e.getInstance=function(e){var n={onwillreconnect:"reuseImWillReconnect",ondisconnect:"reuseImDisconnect",onerror:"reuseImError",onmsgs:"reuseImMsgs",onProxyMsg:"reuseImProxyMsg"};return Object.keys(n).forEach((function(r){var i=e[r];e[r]=function(e){i&&"[object Function]"===Object.prototype.toString.call(i)&&i.call(this,e),t.emit(n[r],e)}})),r(e)}}return e},e.prototype._getRoomService=function(){return this._roomService||(this._roomService=new NERoomService({deviceId:this._deviceId,debug:this._debug,request:this._request,rtc:this._rtc,previewRtc:this._previewRtc,whiteboard:this._whiteboard,toolCollection:this._ToolCollection,chatroom:this._chatroom,eventEmitter:this._eventEmitter,logger:this._logger,IM:this._im,privateRtcConfig:this._privateRtcConfig,privateWhiteboardConfig:this._privateWhiteboardConfig})),this._roomService},e.prototype._getAuthService=function(){return this._authService||(this._authService=new NEAuthService({IM:this._im,eventEmitter:this._eventEmitter,request:this._request,logger:this._logger,privateConf:this._privateImConfig})),this._authService},e.prototype._getMessageService=function(){return this._messageService||(this._messageService=new NEMessageChannelService({IM:this._im,request:this._request,logger:this._logger})),this._messageService},e.TAG_NAME="RoomKit",e}(),NERequest=function(){function e(e){var t=this;this.headers={};var r=e.appKey,n=e.baseDomain,i=e.versionCode,o=e.clientType,a=e.token,s=e.userUuid,c=e.deviceId;this.appKey=r,this.baseDomain=n,this.versionCode=i,this.clientType=o,this.token=a,this.userUuid=s,this.request=function(r){return r.headers=__assign(__assign({clientType:o,user:t.userUuid,token:t.token,versionCode:i,deviceId:c},t.headers),r.headers),r.baseURL=t.baseDomain,e.request(r).then((function(e){return e.data}))}}return e.prototype.setAppKey=function(e){this.appKey=e},e.prototype.setToken=function(e){this.token=e},e.prototype.setUserUuid=function(e){this.userUuid=e},e.prototype.setImToken=function(e){this.imToken=e},e.prototype.setBaseUrl=function(e){console.log("setBaseUrl",e),this.baseDomain=e},e.prototype.setHeaders=function(e){this.headers=e},e.prototype.getRoomInfoApi=function(e){return this.request({method:"GET",url:"/scene/apps/".concat(this.appKey,"/v2/rooms/").concat(e)})},e.prototype.loginByAnonymousApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/anonymous/login"),headers:{Authorization:e}})},e.prototype.getRoomConfigApi=function(e){return this.request({method:"GET",url:"/scene/apps/".concat(this.appKey,"/v2/rooms/").concat(e,"/config")})},e.prototype.joinRoomApi=function(e){var t=e.roomUuid,r=e.userName,n=e.role,i=e.streams,o=e.properties,a=e.password;return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(t,"/entry"),data:{userName:r,role:n,streams:i,password:a,properties:o}})},e.prototype.deleteRoomApi=function(e){return this.request({method:"DELETE",url:"/scene/apps/".concat(this.appKey,"/v2/rooms/").concat(e)})},e.prototype.updateMemberPropertiesApi=function(e){var t=e.roomUuid,r=e.propertyKey,n=e.userUuid,i=e.value;return this.request({method:"PUT",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(t,"/members/").concat(n,"/properties/").concat(r),data:i})},e.prototype.deleteMemberPropertyApi=function(e){var t=e.roomUuid,r=e.propertyKey,n=e.userUuid;return this.request({method:"DELETE",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(t,"/members/").concat(n,"/properties/").concat(r)})},e.prototype.loginApi=function(){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/login")})},e.prototype.loginByIMApi=function(){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/login"),headers:{authType:1}})},e.prototype.createRoomApi=function(e){var t=e.roomUuid,r=e.roomName,n=e.properties,i=e.configId,o=e.config;return this.request({method:"PUT",url:"/scene/apps/".concat(this.appKey,"/v2/rooms/").concat(t),data:{roomName:r,properties:n,configId:i,config:o,password:e.password}})},e.prototype.endRoomApi=function(e){return this.request({method:"DELETE",url:"/scene/apps/".concat(this.appKey,"/v2/rooms/").concat(e)})},e.prototype.removeOrLeaveRoomApi=function(e){return this.request({method:"DELETE",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(e.roomUuid,"/members/").concat(e.userUuid),data:e.data})},e.prototype.updateMemberInfoApi=function(e){var t=e.roomUuid,r=e.userUuid;return this.request({method:"PUT",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(t,"/members/").concat(r),data:e.data})},e.prototype.updateRoomPropertiesApi=function(e){var t=e.roomUuid,r=e.propertyKey;return this.request({method:"PUT",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(t,"/properties/").concat(r),data:e.data,params:{a:e.associatedUuid}})},e.prototype.deleteRoomPropertyApi=function(e){var t=e.roomUuid,r=e.propertyKey;return this.request({method:"DELETE",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(t,"/properties/").concat(r)})},e.prototype.joinRtcChannelApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(e,"/members/joinRtc")})},e.prototype.leaveRtcChannelApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(e,"/members/leaveRtc")})},e.prototype.changeMemberStreamsApi=function(e){return this.request({method:e.isOpen?"PUT":"DELETE",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(e.roomUuid,"/members/").concat(e.userUuid,"/streams/").concat(e.streamKey),data:{value:e.isOpen?1:0}})},e.prototype.handOverRoleApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(e.roomUuid,"/members/").concat(e.userUuid,"/handoverRole")})},e.prototype.getSnapshotApi=function(e){return this.request({method:"GET",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(e,"/snapshot")})},e.prototype.passThroughMessageApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/rooms/").concat(e.roomUuid,"/members/").concat(e.userUuid,"/send"),data:e.data})},e.prototype.checkToken=function(){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/checkToken")})},e.prototype.startLive=function(e){return this.request({method:"PUT",url:"/scene/apps/".concat(this.appKey,"/v1/").concat(e.roomUuid,"/live/start"),data:e.data})},e.prototype.endLive=function(e){return this.request({method:"DELETE",url:"/scene/apps/".concat(this.appKey,"/v1/").concat(e.roomUuid,"/live/end")})},e.prototype.updateLive=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/").concat(e.roomUuid,"/live/update"),data:e.data})},e}(),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var eventemitter3$1={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,o),!0;case 6:return l.fn.call(l.context,t,n,i,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(eventemitter3$1);var EventEmitter=eventemitter3$1.exports,axios$2={exports:{}},bind$2=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},bind$1=bind$2,toString=Object.prototype.toString;function isArray(e){return Array.isArray(e)}function isUndefined(e){return void 0===e}function isBuffer(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isArrayBuffer(e){return"[object ArrayBuffer]"===toString.call(e)}function isFormData(e){return"[object FormData]"===toString.call(e)}function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer(e.buffer)}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return null!==e&&"object"==typeof e}function isPlainObject(e){if("[object Object]"!==toString.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate(e){return"[object Date]"===toString.call(e)}function isFile(e){return"[object File]"===toString.call(e)}function isBlob(e){return"[object Blob]"===toString.call(e)}function isFunction(e){return"[object Function]"===toString.call(e)}function isStream(e){return isObject(e)&&isFunction(e.pipe)}function isURLSearchParams(e){return"[object URLSearchParams]"===toString.call(e)}function trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document}function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function merge(){var e={};function t(t,r){isPlainObject(e[r])&&isPlainObject(t)?e[r]=merge(e[r],t):isPlainObject(t)?e[r]=merge({},t):isArray(t)?e[r]=t.slice():e[r]=t}for(var r=0,n=arguments.length;r<n;r++)forEach(arguments[r],t);return e}function extend(e,t,r){return forEach(t,(function(t,n){e[n]=r&&"function"==typeof t?bind$1(t,r):t})),e}function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}var utils$e={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM},utils$d=utils$e;function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$2=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(utils$d.isURLSearchParams(t))n=t.toString();else{var i=[];utils$d.forEach(t,(function(e,t){null!=e&&(utils$d.isArray(e)?t+="[]":e=[e],utils$d.forEach(e,(function(e){utils$d.isDate(e)?e=e.toISOString():utils$d.isObject(e)&&(e=JSON.stringify(e)),i.push(encode(t)+"="+encode(e))})))})),n=i.join("&")}if(n){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e},utils$c=utils$e;function InterceptorManager$1(){this.handlers=[]}InterceptorManager$1.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},InterceptorManager$1.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager$1.prototype.forEach=function(e){utils$c.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var InterceptorManager_1=InterceptorManager$1,utils$b=utils$e,normalizeHeaderName$1=function(e,t){utils$b.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))},enhanceError$2=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},enhanceError$1=enhanceError$2,createError$2=function(e,t,r,n,i){var o=new Error(e);return enhanceError$1(o,t,r,n,i)},createError$1=createError$2,settle$1=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(createError$1("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)},utils$a=utils$e,cookies$1=utils$a.isStandardBrowserEnv()?{write:function(e,t,r,n,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),utils$a.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),utils$a.isString(n)&&a.push("path="+n),utils$a.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},isAbsoluteURL$1=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},combineURLs$1=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},isAbsoluteURL=isAbsoluteURL$1,combineURLs=combineURLs$1,buildFullPath$1=function(e,t){return e&&!isAbsoluteURL(t)?combineURLs(e,t):t},utils$9=utils$e,ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],parseHeaders$1=function(e){var t,r,n,i={};return e?(utils$9.forEach(e.split("\n"),(function(e){if(n=e.indexOf(":"),t=utils$9.trim(e.substr(0,n)).toLowerCase(),r=utils$9.trim(e.substr(n+1)),t){if(i[t]&&ignoreDuplicateOf.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([r]):i[t]?i[t]+", "+r:r}})),i):i},utils$8=utils$e,isURLSameOrigin$1=utils$8.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=n(window.location.href),function(t){var r=utils$8.isString(t)?n(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0};function Cancel$3(e){this.message=e}Cancel$3.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Cancel$3.prototype.__CANCEL__=!0;var Cancel_1=Cancel$3,utils$7=utils$e,settle=settle$1,cookies=cookies$1,buildURL$1=buildURL$2,buildFullPath=buildFullPath$1,parseHeaders=parseHeaders$1,isURLSameOrigin=isURLSameOrigin$1,createError=createError$2,transitionalDefaults$1=transitional,Cancel$2=Cancel_1,xhr=function(e){return new Promise((function(t,r){var n,i=e.data,o=e.headers,a=e.responseType;function s(){e.cancelToken&&e.cancelToken.unsubscribe(n),e.signal&&e.signal.removeEventListener("abort",n)}utils$7.isFormData(i)&&delete o["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",l=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+l)}var d=buildFullPath(e.baseURL,e.url);function p(){if(c){var n="getAllResponseHeaders"in c?parseHeaders(c.getAllResponseHeaders()):null,i={data:a&&"text"!==a&&"json"!==a?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:n,config:e,request:c};settle((function(e){t(e),s()}),(function(e){r(e),s()}),i),c=null}}if(c.open(e.method.toUpperCase(),buildURL$1(d,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=p:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(p)},c.onabort=function(){c&&(r(createError("Request aborted",e,"ECONNABORTED",c)),c=null)},c.onerror=function(){r(createError("Network Error",e,null,c)),c=null},c.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||transitionalDefaults$1;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(createError(t,e,n.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",c)),c=null},utils$7.isStandardBrowserEnv()){var f=(e.withCredentials||isURLSameOrigin(d))&&e.xsrfCookieName?cookies.read(e.xsrfCookieName):void 0;f&&(o[e.xsrfHeaderName]=f)}"setRequestHeader"in c&&utils$7.forEach(o,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)})),utils$7.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),a&&"json"!==a&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(n=function(e){c&&(r(!e||e&&e.type?new Cancel$2("canceled"):e),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(n),e.signal&&(e.signal.aborted?n():e.signal.addEventListener("abort",n))),i||(i=null),c.send(i)}))},utils$6=utils$e,normalizeHeaderName=normalizeHeaderName$1,enhanceError=enhanceError$2,transitionalDefaults=transitional,DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!utils$6.isUndefined(e)&&utils$6.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter(){var e;return("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=xhr),e}function stringifySafely(e,t,r){if(utils$6.isString(e))try{return(t||JSON.parse)(e),utils$6.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}var defaults$3={transitional:transitionalDefaults,adapter:getDefaultAdapter(),transformRequest:[function(e,t){return normalizeHeaderName(t,"Accept"),normalizeHeaderName(t,"Content-Type"),utils$6.isFormData(e)||utils$6.isArrayBuffer(e)||utils$6.isBuffer(e)||utils$6.isStream(e)||utils$6.isFile(e)||utils$6.isBlob(e)?e:utils$6.isArrayBufferView(e)?e.buffer:utils$6.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):utils$6.isObject(e)||t&&"application/json"===t["Content-Type"]?(setContentTypeIfUnset(t,"application/json"),stringifySafely(e)):e}],transformResponse:[function(e){var t=this.transitional||defaults$3.transitional,r=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,i=!r&&"json"===this.responseType;if(i||n&&utils$6.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw enhanceError(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$6.forEach(["delete","get","head"],(function(e){defaults$3.headers[e]={}})),utils$6.forEach(["post","put","patch"],(function(e){defaults$3.headers[e]=utils$6.merge(DEFAULT_CONTENT_TYPE)}));var defaults_1=defaults$3,utils$5=utils$e,defaults$2=defaults_1,transformData$1=function(e,t,r){var n=this||defaults$2;return utils$5.forEach(r,(function(r){e=r.call(n,e,t)})),e},isCancel$1=function(e){return!(!e||!e.__CANCEL__)},utils$4=utils$e,transformData=transformData$1,isCancel=isCancel$1,defaults$1=defaults_1,Cancel$1=Cancel_1;function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Cancel$1("canceled")}var dispatchRequest$1=function(e){return throwIfCancellationRequested(e),e.headers=e.headers||{},e.data=transformData.call(e,e.data,e.headers,e.transformRequest),e.headers=utils$4.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),utils$4.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||defaults$1.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},utils$3=utils$e,mergeConfig$2=function(e,t){t=t||{};var r={};function n(e,t){return utils$3.isPlainObject(e)&&utils$3.isPlainObject(t)?utils$3.merge(e,t):utils$3.isPlainObject(t)?utils$3.merge({},t):utils$3.isArray(t)?t.slice():t}function i(r){return utils$3.isUndefined(t[r])?utils$3.isUndefined(e[r])?void 0:n(void 0,e[r]):n(e[r],t[r])}function o(e){if(!utils$3.isUndefined(t[e]))return n(void 0,t[e])}function a(r){return utils$3.isUndefined(t[r])?utils$3.isUndefined(e[r])?void 0:n(void 0,e[r]):n(void 0,t[r])}function s(r){return r in t?n(e[r],t[r]):r in e?n(void 0,e[r]):void 0}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s};return utils$3.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,n=t(e);utils$3.isUndefined(n)&&t!==s||(r[e]=n)})),r},data={version:"0.26.1"},VERSION=data.version,validators$1={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){validators$1[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var deprecatedWarnings={};function assertOptions(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),i=n.length;i-- >0;){var o=n[i],a=t[o];if(a){var s=e[o],c=void 0===s||a(s,o,e);if(!0!==c)throw new TypeError("option "+o+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+o)}}validators$1.transitional=function(e,t,r){function n(e,t){return"[Axios v"+VERSION+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,i,o){if(!1===e)throw new Error(n(i," has been removed"+(t?" in "+t:"")));return t&&!deprecatedWarnings[i]&&(deprecatedWarnings[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,o)}};var validator$1={assertOptions:assertOptions,validators:validators$1},utils$2=utils$e,buildURL=buildURL$2,InterceptorManager=InterceptorManager_1,dispatchRequest=dispatchRequest$1,mergeConfig$1=mergeConfig$2,validator=validator$1,validators=validator.validators;function Axios$1(e){this.defaults=e,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios$1.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=mergeConfig$1(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&validator.assertOptions(r,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var o,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!i){var s=[dispatchRequest,void 0];for(Array.prototype.unshift.apply(s,n),s=s.concat(a),o=Promise.resolve(t);s.length;)o=o.then(s.shift(),s.shift());return o}for(var c=t;n.length;){var u=n.shift(),l=n.shift();try{c=u(c)}catch(e){l(e);break}}try{o=dispatchRequest(c)}catch(e){return Promise.reject(e)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},Axios$1.prototype.getUri=function(e){return e=mergeConfig$1(this.defaults,e),buildURL(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},utils$2.forEach(["delete","get","head","options"],(function(e){Axios$1.prototype[e]=function(t,r){return this.request(mergeConfig$1(r||{},{method:e,url:t,data:(r||{}).data}))}})),utils$2.forEach(["post","put","patch"],(function(e){Axios$1.prototype[e]=function(t,r,n){return this.request(mergeConfig$1(n||{},{method:e,url:t,data:r}))}}));var Axios_1=Axios$1,Cancel=Cancel_1;function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new Cancel(e),t(r.reason))}))}CancelToken.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},CancelToken.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},CancelToken.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},CancelToken.source=function(){var e;return{token:new CancelToken((function(t){e=t})),cancel:e}};var CancelToken_1=CancelToken,spread=function(e){return function(t){return e.apply(null,t)}},utils$1=utils$e,isAxiosError=function(e){return utils$1.isObject(e)&&!0===e.isAxiosError},utils=utils$e,bind=bind$2,Axios=Axios_1,mergeConfig=mergeConfig$2,defaults=defaults_1;function createInstance(e){var t=new Axios(e),r=bind(Axios.prototype.request,t);return utils.extend(r,Axios.prototype,t),utils.extend(r,t),r.create=function(t){return createInstance(mergeConfig(e,t))},r}var axios$1=createInstance(defaults);axios$1.Axios=Axios,axios$1.Cancel=Cancel_1,axios$1.CancelToken=CancelToken_1,axios$1.isCancel=isCancel$1,axios$1.VERSION=data.version,axios$1.all=function(e){return Promise.all(e)},axios$1.spread=spread,axios$1.isAxiosError=isAxiosError,axios$2.exports=axios$1,axios$2.exports.default=axios$1;var axios=axios$2.exports,WhiteBoardSDK_v3_7_7={exports:{}};(function(module,exports){var t;t=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=412)}([function(e,t,r){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,r){t.__esModule=!0;var n,i=(n=r(47))&&n.__esModule?n:{default:n};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,i.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},function(e,t,r){e.exports={default:r(186),__esModule:!0}},function(e,t,r){t.__esModule=!0;var n,i=(n=r(20))&&n.__esModule?n:{default:n};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,r){t.__esModule=!0;var n=a(r(127)),i=a(r(86)),o=a(r(20));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},function(e,t,r){e.exports={default:r(146),__esModule:!0}},function(e,t){var r=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=r)},,function(e,t,r){var n=r(12),i=r(6),o=r(26),a=r(27),s=r(33),c=function(e,t,r){var u,l,d,p=e&c.F,f=e&c.G,h=e&c.S,m=e&c.P,g=e&c.B,v=e&c.W,y=f?i:i[t]||(i[t]={}),b=y.prototype,S=f?n:h?n[t]:(n[t]||{}).prototype;for(u in f&&(r=t),r)(l=!p&&S&&void 0!==S[u])&&s(y,u)||(d=l?S[u]:r[u],y[u]=f&&"function"!=typeof S[u]?r[u]:g&&l?o(d,n):v&&S[u]==d?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):m&&"function"==typeof d?o(Function.call,d):d,m&&((y.virtual||(y.virtual={}))[u]=d,e&c.R&&b&&!b[u]&&a(b,u,d)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){e.exports={default:r(180),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(5)),i=u(r(0)),o=u(r(1)),a=u(r(20)),s=r(54),c=r(142);function u(e){return e&&e.__esModule?e:{default:e}}var l=void 0,d={type:"",boardName:"whiteboard",pageIndex:"0",dependOn:void 0,timestamp:0},p=!1;function f(e,t,r,n){var i=!1;return d.pageIndex!==r||d.boardName!==n?i=!0:d.inProgress?(e!==d.type||(void 0===t?"undefined":(0,a.default)(t))!==(0,a.default)(d.dependOn)||"string"==typeof t&&t!==d.dependOn||Array.isArray(t)&&Array.isArray(d.dependOn)&&t.join(",")!==d.dependOn.join(",")||p||-1!==["undo","redo","image"].indexOf(e))&&(i=!0):i=!0,i}var h=function(){function e(t){(0,i.default)(this,e),this.type="base",this.app=t,this.opsManager=t.opsManager,this.registerHooks()}return(0,o.default)(e,[{key:"registerHooks",value:function(){}},{key:"eventsToListen",value:function(){return{exec:{value:!1,information:{args:"",message:"执行"+this.type+"事件"}},activate:{value:!1,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"execCommand",value:function(){console.warn("DEV--\x3e","若设置了exec为true，请继承execCommand函数，并作出对应的处理。")}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"opIdForseen",value:function(e,t){return f(e,t,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName)?this.opsManager.currPage.getNextOpId():this.opsManager.currPage.getOpId()}},{key:"dispatch",value:function(e){if(e.hasOwnProperty("type"))if(s.globalSnapshotTypes.indexOf(e.type)>-1)this.dispatchGlobalAction(e);else if("page"===e.type)this.dispatchPageAction(e);else if("board"===e.type||"transDoc"===e.type)this.dispatchBoardAction(e);else{var t=this.app.room.boards[this.app.room.currIndex],r=Date.now()+this.app.ntpTimeDiff,n=void 0;if(e.reuseOpType)n=this.app.account+"-"+e.reuseOpType,delete e.reuseOpType;else{var i=f(e.type,e.dependOn,this.opsManager.currPage.pageIndex,this.opsManager.currPage.boardName);p=!1,d={type:e.type,dependOn:e.dependOn,timestamp:r,pageIndex:this.opsManager.currPage.pageIndex,boardName:this.opsManager.currPage.boardName,inProgress:e.inProgress},i&&this.opsManager.currPage.prepareNewOpId(),n=this.opsManager.currPage.getOpId()}var o={category:"inPageOp",board:this.app.room.currIndex,page:t.currIndex,time:r,uid:this.app.account,opId:n,data:e};this.app.room.dispatch(o)}else{var a={opId:this.opsManager.currPage.getOpId(),data:e};this.app.room.dispatch(a)}}},{key:"dispatchFromPage",value:function(e,t){var r=Date.now()+this.app.ntpTimeDiff;t.prepareNewOpId();var n={category:"inPageOp",board:t.boardName,page:Number(t.pageIndex),time:r,uid:this.app.account,opId:t.getOpId(),data:e};d={type:e.type,dependOn:e.dependOn,timestamp:r,pageIndex:t.pageIndex,boardName:t.boardName,inProgress:e.inProgress},this.app.room.dispatch(n)}},{key:"dispatchPageAction",value:function(e){var t=Date.now()+this.app.ntpTimeDiff,r={category:"pageOp",board:this.app.room.currIndex,time:t,uid:this.app.account,opId:(0,c.v4)(),data:e};this.app.room.dispatch(r)}},{key:"dispatchBoardAction",value:function(e){var t={category:"boardOp",time:Date.now()+this.app.ntpTimeDiff,uid:this.app.account,opId:(0,c.v4)(),data:e};this.app.room.dispatch(t)}},{key:"dispatchGlobalAction",value:function(e){var t=void 0,r=Date.now()+this.app.ntpTimeDiff;e.reuseOpType?(t=this.app.account+"-"+e.reuseOpType,delete e.reuseOpType):(l&&!p||(l=(0,c.v4)(),p=!1),t=l);var n={category:"globalOp",time:r,uid:this.app.account,opId:t,data:e};this.app.room.dispatch(n)}},{key:"emit",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(t=this.app.dispatcher).emit.apply(t,[e].concat(n))}},{key:"draw",value:function(e,t,r){console.warn("DEV--\x3e","请实现"+this.type+"子类中draw函数。")}},{key:"preview",value:function(e,t,r){this.draw(e,t,r)}},{key:"hide",value:function(e,t,r){}},{key:"mergePartial",value:function(e,t){return t.hasOwnProperty("category")?t.time>=e.time?t:e:(0,n.default)((0,n.default)({},e),{data:(0,n.default)((0,n.default)({},e.data),t.data)})}},{key:"beginBatch",value:function(){p=!0}},{key:"isKeyDown",value:function(e){return this.app.container.isKeyDown(e)}},{key:"getOpTypeByOpId",value:function(e){return this.opsManager.drawOpsOfPage.hasOwnProperty(e)?this.opsManager.drawOpsOfPage[e].data.type:void 0}},{key:"isMouseDown",get:function(){return this.app.container.isMouseDown}},{key:"logger",get:function(){return this.app.logger}},{key:"opsOfPage",get:function(){return this.opsManager.currPage.opQueue}},{key:"drawOpsOfPage",get:function(){return this.opsManager.drawOpsOfPage}}]),e}();t.default=h},function(e,t,r){var n=r(79)("wks"),i=r(60),o=r(12).Symbol,a="function"==typeof o;(e.exports=function(e){return n[e]||(n[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=n},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){e.exports={default:r(245),__esModule:!0}},function(e,t,r){e.exports={default:r(169),__esModule:!0}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(23),i=r(106),o=r(74),a=Object.defineProperty;t.f=r(17)?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!r(28)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getLineFromPointsY=t.getVerticalLineY=t.getXFromCoefAndOffset=t.getLineCoef=t.getArrowPoints=void 0,t.distSqrt=i,t.dist=o,t.rectCollide=function(e,t){return!(e.sx>t.sx+t.w||e.sx+e.w<t.sx||e.sy>t.sy+t.h||e.sy+e.h<t.sy)},t.pointCollideWithPoint=function(e,t,r){return i(e,t)<=r*r},t.pointCollideWithLine=function(e,t,r,n){return o(e,t)+o(e,r)-o(t,r)<=n},t.pointInRect=function(e,t){return t[0]>e.sx&&t[0]<e.sx+e.w&&t[1]>e.sy&&t[1]<e.sy+e.h},t.getTransformedBoundary=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{factor:1,coordinate:0},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{factor:1,coordinate:0},a=i.factor*(t.sx-i.coordinate)+i.coordinate,s=o.factor*(t.sy-o.coordinate)+o.coordinate;a+=r||0,s+=n||0;var c=t.w*i.factor,u=t.h*o.factor;return c<0&&(a+=c,c=-c),u<0&&(s+=u,u=-u),t.fixRealWorldHeight&&e&&(u=t.fixRealWorldHeight/e),{sx:a,sy:s,w:c,h:u}},t.getTransformedPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{factor:1,coordinate:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{factor:1,coordinate:0},o=n.factor*(e[0]-n.coordinate)+n.coordinate,a=i.factor*(e[1]-i.coordinate)+i.coordinate;return[o+=t||0,a+=r||0]},t.combineBoundary=function(e,t){var r=(0,n.min)(e.sx,t.sx,e.sx+e.w,t.sx+t.w),i=(0,n.min)(e.sy,t.sy,e.sy+e.h,t.sy+t.h);return{sx:r,sy:i,w:(0,n.max)(e.sx,t.sx,e.sx+e.w,t.sx+t.w)-r,h:(0,n.max)(e.sy,t.sy,e.sy+e.h,t.sy+t.h)-i}},t.getBoundaryBoxFromTwoPoints=function(e,t){var r=(0,n.min)(e[0],t[0]),i=(0,n.max)(e[0],t[0]),o=(0,n.min)(e[1],t[1]);return{sx:r,sy:o,w:i-r,h:(0,n.max)(e[1],t[1])-o}};var n=r(184);function i(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function o(e,t){return Math.sqrt(i(e,t))}t.getArrowPoints=function(e,t){var r=5*e,n=2*e,i=a(t),o=t[1][0]-t[0][0]>0?s(t[1],i,r):2*t[1][0]-s(t[1],i,r),l=t[1][0]-t[0][0]==0?t[1][1]+(t[1][1]-t[0][1]>0?r:-r):u(t,o),d=s(t[1],-1/i,n),p=t[1][1]-t[0][1]==0?t[1][1]-n:c(t[1],i,d),f=2*t[1][0]-s(t[1],-1/i,n);return[[o,l],[d,p],[f,t[1][1]-t[0][1]==0?t[1][1]+n:c(t[1],i,f)]]};var a=t.getLineCoef=function(e){return(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0},s=t.getXFromCoefAndOffset=function(e,t,r){return Math.sqrt(Math.pow(r,2)/(Math.pow(t,2)+1))+e[0]},c=t.getVerticalLineY=function(e,t,r){return(e[0]-r)/t+e[1]},u=t.getLineFromPointsY=function(e,t){return Math.max(-1e6,(e[1][1]-e[0][1])/(e[1][0]-e[0][0])||0)*(t-e[0][0])+e[0][1]}},function(e,t,r){e.exports={default:r(166),__esModule:!0}},function(e,t,r){t.__esModule=!0;var n=a(r(151)),i=a(r(65)),o="function"==typeof i.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===o(n.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}},function(e,t,r){e.exports=r(310)},,function(e,t,r){var n=r(15);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r,n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(r=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),a=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(a).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];null!=o&&(n[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];null!=a[0]&&n[a[0]]||(r&&!a[2]?a[2]=r:r&&(a[2]="("+a[2]+") and ("+r+")"),t.push(a))}},t}},function(e,t,r){var n,i,o={},a=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=n.apply(this,arguments)),i}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},c=function(e){var t={};return function(e,r){if("function"==typeof e)return e();if(void 0===t[e]){var n=s.call(this,e,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),u=null,l=0,d=[],p=r(205);function f(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=o[n.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](n.parts[a]);for(;a<n.parts.length;a++)i.parts.push(b(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(b(n.parts[a],t));o[n.id]={id:n.id,refs:1,parts:s}}}}function h(e,t){for(var r=[],n={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};n[a]?n[a].parts.push(s):r.push(n[a]={id:a,parts:[s]})}return r}function m(e,t){var r=c(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),d.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=c(e.insertAt.before,r);r.insertBefore(t,i)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=r.nc;n&&(e.attrs.nonce=n)}return y(t,e.attrs),m(e,t),t}function y(e,t){Object.keys(t).forEach((function(r){e.setAttribute(r,t[r])}))}function b(e,t){var r,n,i,o;if(t.transform&&e.css){if(!(o="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=o}if(t.singleton){var a=l++;r=u||(u=v(t)),n=M.bind(null,r,a,!1),i=M.bind(null,r,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",y(t,e.attrs),m(e,t),t}(t),n=w.bind(null,r,t),i=function(){g(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(t),n=T.bind(null,r),i=function(){g(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=h(e,t);return f(r,t),function(e){for(var n=[],i=0;i<r.length;i++){var a=r[i];(s=o[a.id]).refs--,n.push(s)}for(e&&f(h(e,t),t),i=0;i<n.length;i++){var s;if(0===(s=n[i]).refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete o[s.id]}}}};var S,_=(S=[],function(e,t){return S[e]=t,S.filter(Boolean).join("\n")});function M(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=_(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function T(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function w(e,t,r){var n=r.css,i=r.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(n=p(n)),i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},function(e,t,r){var n=r(58);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(16),i=r(45);e.exports=r(17)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeToastIntercept=exports.interceptShowToast=exports.hideToast=exports.showToast=void 0;var _typeof2=__webpack_require__(20),_typeof3=_interopRequireDefault(_typeof2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_stringify=__webpack_require__(19),_stringify2=_interopRequireDefault(_stringify),_classCallCheck2=__webpack_require__(0),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_toastCtrl=__webpack_require__(206),_toastCtrl2=_interopRequireDefault(_toastCtrl);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var ToastClass=function ToastClass(){var _this=this;(0,_classCallCheck3.default)(this,ToastClass),this.show=function(e){var t=e.msg,r=e.time,n=void 0===r?2:r,i=e.type,o=void 0===i?"info":i,a=e.top,s=void 0===a?30:a,c={msgType:e.msgType,args:e.args,msg:t.constructor===String?t:(0,_stringify2.default)(t),time:n,type:o,top:s};if("function"==typeof _this.interceptShowFn){var u=_this.interceptShowFn((0,_assign2.default)({},c));if(!u)return;"object"===(void 0===u?"undefined":(0,_typeof3.default)(u))&&(c=u)}c&&_toastCtrl2.default.show(c)},this.hide=function(){("function"!=typeof _this.interceptHideFn||_this.interceptHideFn())&&_toastCtrl2.default.hide()},this.interceptShow=function(fn){if("string"==typeof fn)try{fn=eval(fn)}catch(e){return console.error(e),void console.error("interceptShowToast如果参数为string，该string需要能够被eval解析: "+fn)}"function"!=typeof fn?console.error("interceptShowToast的参数必须为函数"):_this.interceptShowFn=fn},this.interceptHide=function(e){"function"!=typeof e?console.error("Toast.interceptHide的参数必须为函数"):_this.interceptHideFn=e},this.removeIntercept=function(){_this.interceptShowFn=void 0,_this.interceptHideFn=void 0}};window.__newb__=window.__newb__||{},window.__newb__.Toast||(window.__newb__.Toast=new ToastClass),exports.showToast=window.__newb__.Toast.show,exports.hideToast=window.__newb__.Toast.hide,exports.interceptShowToast=window.__newb__.Toast.interceptShow,exports.removeToastIntercept=window.__newb__.Toast.removeIntercept},function(e,t,r){var n=r(75),i=r(76);e.exports=function(e){return n(i(e))}},function(e,t,r){e.exports={default:r(171),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default={SYNCHRONIZING:"SYNCHRONIZING",ON_CONNECTED:"ON_CONNECTED",ON_WILL_RECONNECT:"ON_WILL_RECONNECT",ON_DISCONNECTED:"ON_DISCONNECTED",NETWORK_INSTABLE:"NETWORK_INSTABLE",SYNC_FAIL:"SYNC_FAIL",DELAY_DISPATCH_WHILE_NETWORK_INSTABLE:"DELAY_DISPATCH_WHILE_NETWORK_INSTABLE",START_BROADCAST:"START_BROADCAST",STOP_BROADCAST:"STOP_BROADCAST",SWITCH_TO_FOLLOWER:"SWITCH_TO_FOLLOWER",SWITCH_TO_FREE_OBSERVER:"SWITCH_TO_FREE_OBSERVER",NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER:"NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER",NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER:"NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER",RECEIVE_STOP_BROADCAST:"RECEIVE_STOP_BROADCAST",RECEIVE_START_BROADCAST:"RECEIVE_START_BROADCAST",CURRENT_USER_IS_BROADCASTER:"CURRENT_USER_IS_BROADCASTER",CURRENT_USER_IS_FOLLOWER:"CURRENT_USER_IS_FOLLOWER",CURRENT_USER_IS_FREE_OBSERVER:"CURRENT_USER_IS_FREE_OBSERVER",FILE_SIZE_EXCEED_LIMIT:"FILE_SIZE_EXCEED_LIMIT",FILE_ACCEPTED_TYPE_LIMIT:"FILE_ACCEPTED_TYPE_LIMIT",FILE_UPLOAD_FAIL:"FILE_UPLOAD_FAIL",FILE_IS_UPLOADING:"FILE_IS_UPLOADING",FILE_TRANSCODE_SUCCEED:"FILE_TRANSCODE_SUCCEED",FILE_TRANSCODE_FAIL:"FILE_TRANSCODE_FAIL",VIDEO_UPLOAD_FAIL:"VIDEO_UPLOAD_FAIL",AUDIO_UPLOAD_FAIL:"AUDIO_UPLOAD_FAIL",VIDEO_TYPE_NOT_ALLOWED:"VIDEO_TYPE_NOT_ALLOWED",AUDIO_TYPE_NOT_ALLOWED:"AUDIO_TYPE_NOT_ALLOWED",PIC_UPLOAD_FAIL:"PIC_UPLOAD_FAIL",LOG_FILE_UPLOAD_THROTTLE:"LOG_FILE_UPLOAD_THROTTLE",LOG_FILE_IS_UPLOADING:"LOG_FILE_IS_UPLOADING",LOG_FILE_UPLOAD_SUCCEED:"LOG_FILE_UPLOAD_SUCCEED",LOG_FILE_UPLOAD_FAIL:"LOG_FILE_UPLOAD_FAIL",ONE_MEDIA_LIMIT:"ONE_MEDIA_LIMIT",IOS_NOT_SUPPORT_TEXT:"IOS_NOT_SUPPORT_TEXT"}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(76);e.exports=function(e){return Object(n(e))}},function(e,t,r){t.__esModule=!0;var n=o(r(253)),i=o(r(9));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,n.default)(Object(e)))return function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var s,c=(0,i.default)(e);!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getElementPartOutOfContainer=t.filterNonMediaOpIds=t.transformPropertyOverwriteOp=t.drawUserName=t.roundRect=t.arrayDeduce=t.idsChanged=t.snapshotSelectable=t.findOpsUnderMouse=t.findOpsUnderRect=void 0;var n=c(r(5)),i=c(r(9)),o=c(r(14)),a=c(r(35)),s=r(18);function c(e){return e&&e.__esModule?e:{default:e}}t.findOpsUnderRect=function(e,t,r){if(0===t.length)return[];var n=(0,s.getBoundaryBoxFromTwoPoints)(t[0],t[t.length-1]),i=[];for(var o in r){var a=r[o];if(a.data.boundary&&l(a)){var c=(0,s.getTransformedBoundary)(e,a.data.boundary,a.data.dx,a.data.dy,a.data.scaleX,a.data.scaleY);(0,s.rectCollide)(c,n)&&i.push(o)}}return i},t.findOpsUnderMouse=function(e,t,r,n){if(0===t.length)return[];for(var i=(0,s.getBoundaryBoxFromTwoPoints)(t[0],t[t.length-1]),c=(0,a.default)(t[t.length-1],2),u=c[0],d=c[1],p=(0,o.default)(r),f=(p=p.sort((function(e,t){var n=r[e],i=r[t];return n.data.type===i.data.type?0:"video"===n.data.type||"audio"===n.data.type?-1:"video"===i.data.type||"audio"===i.data.type?1:"image"===n.data.type?-1:"image"===n.data.type?1:0}))).length-1;f>=0;f--){var h=r[p[f]],m=n.opMap[h.data.type];if(h.data.boundary&&l(h)){var g=(0,s.getTransformedBoundary)(e,h.data.boundary,h.data.dx,h.data.dy,h.data.scaleX,h.data.scaleY);if((0,s.rectCollide)(g,i)){if(!m||!("ifMouseOnOp"in m))return[p[f]];if(m.ifMouseOnOp(h,u,d))return[p[f]]}}}return[]};var u=["mouse-pointer","eraser"],l=t.snapshotSelectable=function(e){return!(-1!==u.indexOf(e.data.type)||e.data.locked)},d=(t.idsChanged=function(e,t){if(e.length!==t.length)return!0;var r=!0,n=!1,o=void 0;try{for(var a,s=(0,i.default)(e);!(r=(a=s.next()).done);r=!0){var c=a.value;if(-1===t.indexOf(c))return!0}}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return!1},t.arrayDeduce=function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var s,c=(0,i.default)(e);!(n=(s=c.next()).done);n=!0){var u=s.value;-1===t.indexOf(u)&&r.push(u)}}catch(e){o=!0,a=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw a}}return r},t.roundRect=function(e,t,r,n,i,o,a){e.beginPath(),e.moveTo(t+o,r),e.lineTo(t+n-o,r),e.quadraticCurveTo(t+n,r,t+n,r+o),e.lineTo(t+n,r+i-o),e.quadraticCurveTo(t+n,r+i,t+n-o,r+i),e.lineTo(t+o,r+i),e.quadraticCurveTo(t,r+i,t,r+i-o),e.lineTo(t,r+o),e.quadraticCurveTo(t,r,t+o,r),e.closePath(),"stroke"===a?e.stroke():e.fill()});t.drawUserName=function(e){var t=e.ctx,r=e.account,n=e.scale,i=e.px,o=e.py,a=e.bgColor,s=e.fontSize,c=void 0===s?24:s,u=e.textPadding,l=void 0===u?15:u,p=e.rectMarginBottom,f=void 0===p?15:p,h=e.radius,m=void 0===h?10:h,g=(c+12)/n;l/=n,f/=n,c/=n,m/=n;var v="white"===a||"rgb(255,255,255)"===a||"#ffffff"===a||"#fff"===a?"black":"white";t.beginPath(),t.font=c+"px Arial";var y=t.measureText(r).width;t.fillStyle=a,d(t,i-y/2-l,o-f-g,y+2*l,g,m,"fill"),t.fillStyle=v,t.textAlign="left",t.textBaseline="middle",t.fillText(r,i-y/2,o-f-g/2)},t.transformPropertyOverwriteOp=function(e,t){var r=t.data,i=(0,n.default)({},e.data);for(var o in r)"dependOn"!==o&&(i[o]=r[o]);return"text"===e.data.type&&(i.dx=0,i.dy=0,i.scaleX={coordinate:0,factor:1},i.scaleY={coordinate:0,factor:1}),(0,n.default)({},e,{data:i})},t.filterNonMediaOpIds=function(e,t){return t.filter((function(t){if(e.drawOpsOfPage.hasOwnProperty(t)){var r=e.drawOpsOfPage[t];if("audio"!==r.data.type&&"video"!==r.data.type)return!0}return!1}))},t.getElementPartOutOfContainer=function(e,t){var r=e.sx,n=e.sy,i=r+e.w,o=n+e.h,a=t.getContainerWorldRect(),s=Math.max(0,a.centerX-a.width/2-r),c=Math.max(0,i-(a.centerX+a.width/2)),u=Math.max(0,a.centerY-a.height/2-n),l=Math.max(0,o-(a.centerY+a.height/2));return s>0||c>0||u>0||l>0?{left:s,right:c,top:u,bottom:l}:null}},function(e,t,r){var n=r(153)(!0);r(81)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=d(r(55)),i=d(r(31)),o=d(r(86)),a=d(r(9)),s=d(r(5)),c=d(r(20)),u=d(r(0)),l=d(r(1));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){(0,u.default)(this,e),Array.isArray(t)||(t=[]),this._args=t,this.taps=[],this.interceptors=[],this.call=this._call,this.promise=this._promise,this.callAsync=this._callAsync,this._x=void 0}return(0,l.default)(e,[{key:"compile",value:function(e){throw new Error("Abstract: should be overriden")}},{key:"_createCall",value:function(e){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:e})}},{key:"tap",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,c.default)(e))||null===e)throw new Error("Invalid arguments to tap(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"sync",fn:t},e)).name||""===e.name)throw new Error("Missing name for tap");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapAsync",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,c.default)(e))||null===e)throw new Error("Invalid arguments to tapAsync(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"async",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapAsync");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"tapPromise",value:function(e,t){if("string"==typeof e&&(e={name:e}),"object"!==(void 0===e?"undefined":(0,c.default)(e))||null===e)throw new Error("Invalid arguments to tapPromise(options: Object, fn: function)");if("string"!=typeof(e=(0,s.default)({type:"promise",fn:t},e)).name||""===e.name)throw new Error("Missing name for tapPromise");e=this._runRegisterInterceptors(e),this._insert(e)}},{key:"_runRegisterInterceptors",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=(0,a.default)(this.interceptors);!(t=(i=o.next()).done);t=!0){var s=i.value;if(s.register){var c=s.register(e);void 0!==c&&(e=c)}}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}return e}},{key:"withOptions",value:function(e){var t=function(t){return(0,s.default)({},e,"string"==typeof t?{name:t}:t)};e=(0,s.default)({},e,this._withOptions);var r=this._withOptionsBase||this,n=(0,o.default)(r);return n.tapAsync=function(e,n){return r.tapAsync(t(e),n)},n.tap=function(e,n){return r.tap(t(e),n)},n.tapPromise=function(e,n){return r.tapPromise(t(e),n)},n._withOptions=e,n._withOptionsBase=r,n}},{key:"isUsed",value:function(){return this.taps.length>0||this.interceptors.length>0}},{key:"intercept",value:function(e){if(this._resetCompilation(),this.interceptors.push((0,s.default)({},e)),e.register)for(var t=0;t<this.taps.length;t++)this.taps[t]=e.register(this.taps[t])}},{key:"_resetCompilation",value:function(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}},{key:"_insert",value:function(e){this._resetCompilation();var t=void 0;"string"==typeof e.before?t=new i.default([e.before]):Array.isArray(e.before)&&(t=new i.default(e.before));var r=0;"number"==typeof e.stage&&(r=e.stage);for(var n=this.taps.length;n>0;){n--;var o=this.taps[n];this.taps[n+1]=o;var a=o.stage||0;if(t){if(t.has(o.name)){t.delete(o.name);continue}if(t.size>0)continue}if(!(a>r)){n++;break}}this.taps[n]=e}}]),e}();function f(e,t){return function(){return this[e]=this._createCall(t),this[e].apply(this,arguments)}}(0,n.default)(p.prototype,{_call:{value:f("call","sync"),configurable:!0,writable:!0},_promise:{value:f("promise","promise"),configurable:!0,writable:!0},_callAsync:{value:f("callAsync","async"),configurable:!0,writable:!0}}),e.exports=p},function(e,t){!function(r){"object"==typeof t&&void 0!==e?e.exports=r():("undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:this).EventEmitter3=r()}((function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof commonjsRequire&&commonjsRequire;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,(function(e){return i(t[a][1][e]||e)}),l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof commonjsRequire&&commonjsRequire,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new a(r,n||e,o),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,a=new Array(o);n<o;n++)a[n]=r[n].fn;return a},u.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,n,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var c,u=this._events[s],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,o),!0;case 6:return u.fn.call(u.context,t,r,n,o,a),!0}for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];u.fn.apply(u.context,c)}else for(var d,p=u.length,f=0;f<p;f++)switch(u[f].once&&this.removeListener(e,u[f].fn,void 0,!0),l){case 1:u[f].fn.call(u[f].context);break;case 2:u[f].fn.call(u[f].context,t);break;case 3:u[f].fn.call(u[f].context,t,r);break;case 4:u[f].fn.call(u[f].context,t,r,n);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u[f].fn.apply(u[f].context,c)}return!0},u.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,n){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return c(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||c(this,o);else{for(var s=0,u=[],l=a.length;s<l;s++)(a[s].fn!==t||n&&!a[s].once||r&&a[s].context!==r)&&u.push(a[s]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&c(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}]},{},[1])(1)}))},function(e,t){e.exports={}},function(e,t,r){t.__esModule=!0;var n,i=(n=r(118))&&n.__esModule?n:{default:n};t.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return(0,i.default)(e)}},function(e,t,r){var n=a(r(9)),i=a(r(0)),o=a(r(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,i.default)(this,e),this.config=t,this.options=void 0,this._args=void 0}return(0,o.default)(e,[{key:"create",value:function(e){this.init(e);var t=void 0;switch(this.options.type){case"sync":t=new Function(this.args(),'"use strict";\n'+this.header()+this.content({onError:function(e){return"throw "+e+";\n"},onResult:function(e){return"return "+e+";\n"},resultReturns:!0,onDone:function(){return""},rethrowIfPossible:!0}));break;case"async":t=new Function(this.args({after:"_callback"}),'"use strict";\n'+this.header()+this.content({onError:function(e){return"_callback("+e+");\n"},onResult:function(e){return"_callback(null, "+e+");\n"},onDone:function(){return"_callback();\n"}}));break;case"promise":var r=!1,n=this.content({onError:function(e){return r=!0,"_error("+e+");\n"},onResult:function(e){return"_resolve("+e+");\n"},onDone:function(){return"_resolve();\n"}}),i="";i+='"use strict";\n',i+="return new Promise((_resolve, _reject) => {\n",r&&(i+="var _sync = true;\n",i+="function _error(_err) {\n",i+="if(_sync)\n",i+="_resolve(Promise.resolve().then(() => { throw _err; }));\n",i+="else\n",i+="_reject(_err);\n",i+="};\n"),i+=this.header(),i+=n,r&&(i+="_sync = false;\n"),i+="});\n",t=new Function(this.args(),i)}return this.deinit(),t}},{key:"setup",value:function(e,t){e._x=t.taps.map((function(e){return e.fn}))}},{key:"init",value:function(e){this.options=e,this._args=e.args.slice()}},{key:"deinit",value:function(){this.options=void 0,this._args=void 0}},{key:"header",value:function(){var e="";this.needContext()?e+="var _context = {};\n":e+="var _context;\n",e+="var _x = this._x;\n",this.options.interceptors.length>0&&(e+="var _taps = this.taps;\n",e+="var _interceptors = this.interceptors;\n");for(var t=0;t<this.options.interceptors.length;t++){var r=this.options.interceptors[t];r.call&&(e+=this.getInterceptor(t)+".call("+this.args({before:r.context?"_context":void 0})+");\n")}return e}},{key:"needContext",value:function(){var e=!0,t=!1,r=void 0;try{for(var i,o=(0,n.default)(this.options.taps);!(e=(i=o.next()).done);e=!0)if(i.value.context)return!0}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}return!1}},{key:"callTap",value:function(e,t){for(var r=t.onError,n=t.onResult,i=t.onDone,o=t.rethrowIfPossible,a="",s=!1,c=0;c<this.options.interceptors.length;c++){var u=this.options.interceptors[c];u.tap&&(s||(a+="var _tap"+e+" = "+this.getTap(e)+";\n",s=!0),a+=this.getInterceptor(c)+".tap("+(u.context?"_context, ":"")+"_tap"+e+");\n")}a+="var _fn"+e+" = "+this.getTapFn(e)+";\n";var l=this.options.taps[e];switch(l.type){case"sync":o||(a+="var _hasError"+e+" = false;\n",a+="try {\n"),a+=n?"var _result"+e+" = _fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n":"_fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n",o||(a+="} catch(_err) {\n",a+="_hasError"+e+" = true;\n",a+=r("_err"),a+="}\n",a+="if(!_hasError"+e+") {\n"),n&&(a+=n("_result"+e)),i&&(a+=i()),o||(a+="}\n");break;case"async":var d="";d+=n?"(_err"+e+", _result"+e+") => {\n":"_err"+e+" => {\n",d+="if(_err"+e+") {\n",d+=r("_err"+e),d+="} else {\n",n&&(d+=n("_result"+e)),i&&(d+=i()),d+="}\n",d+="}",a+="_fn"+e+"("+this.args({before:l.context?"_context":void 0,after:d})+");\n";break;case"promise":a+="var _hasResult"+e+" = false;\n",a+="var _promise"+e+" = _fn"+e+"("+this.args({before:l.context?"_context":void 0})+");\n",a+="if (!_promise"+e+" || !_promise"+e+".then)\n",a+="  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise"+e+" + ')');\n",a+="_promise"+e+".then(_result"+e+" => {\n",a+="_hasResult"+e+" = true;\n",n&&(a+=n("_result"+e)),i&&(a+=i()),a+="}, _err"+e+" => {\n",a+="if(_hasResult"+e+") throw _err"+e+";\n",a+=r("_err"+e),a+="});\n"}return a}},{key:"callTapsSeries",value:function(e){var t=this,r=e.onError,n=e.onResult,i=e.resultReturns,o=e.onDone,a=e.doneReturns,s=e.rethrowIfPossible;if(0===this.options.taps.length)return o();for(var c=this.options.taps.findIndex((function(e){return"sync"!==e.type})),u=i||a||!1,l="",d=o,p=function(e){var i=e;d!==o&&"sync"!==t.options.taps[i].type&&(l+="function _next"+i+"() {\n",l+=d(),l+="}\n",d=function(){return(u?"return ":"")+"_next"+i+"();\n"});var a=d,p=function(e){return e?"":o()},f=t.callTap(i,{onError:function(e){return r(i,e,a,p)},onResult:n&&function(e){return n(i,e,a,p)},onDone:!n&&a,rethrowIfPossible:s&&(c<0||i<c)});d=function(){return f}},f=this.options.taps.length-1;f>=0;f--)p(f);return l+=d()}},{key:"callTapsLooping",value:function(e){var t=e.onError,r=e.onDone,n=e.rethrowIfPossible;if(0===this.options.taps.length)return r();var i=this.options.taps.every((function(e){return"sync"===e.type})),o="";i||(o+="var _looper = () => {\n",o+="var _loopAsync = false;\n"),o+="var _loop;\n",o+="do {\n",o+="_loop = false;\n";for(var a=0;a<this.options.interceptors.length;a++){var s=this.options.interceptors[a];s.loop&&(o+=this.getInterceptor(a)+".loop("+this.args({before:s.context?"_context":void 0})+");\n")}return o+=this.callTapsSeries({onError:t,onResult:function(e,t,r,n){var o="";return o+="if("+t+" !== undefined) {\n",o+="_loop = true;\n",i||(o+="if(_loopAsync) _looper();\n"),o+=n(!0),o+="} else {\n",(o+=r())+"}\n"},onDone:r&&function(){var e="";return e+="if(!_loop) {\n",(e+=r())+"}\n"},rethrowIfPossible:n&&i}),o+="} while(_loop);\n",i||(o+="_loopAsync = true;\n",o+="};\n",o+="_looper();\n"),o}},{key:"callTapsParallel",value:function(e){var t=this,r=e.onError,n=e.onResult,i=e.onDone,o=e.rethrowIfPossible,a=e.onTap,s=void 0===a?function(e,t){return t()}:a;if(this.options.taps.length<=1)return this.callTapsSeries({onError:r,onResult:n,onDone:i,rethrowIfPossible:o});var c="";c+="do {\n",c+="var _counter = "+this.options.taps.length+";\n",i&&(c+="var _done = () => {\n",c+=i(),c+="};\n");for(var u=function(e){var a=function(){return i?"if(--_counter === 0) _done();\n":"--_counter;"},u=function(e){return e||!i?"_counter = 0;\n":"_counter = 0;\n_done();\n"};c+="if(_counter <= 0) break;\n",c+=s(e,(function(){return t.callTap(e,{onError:function(t){var n="";return n+="if(_counter > 0) {\n",(n+=r(e,t,a,u))+"}\n"},onResult:n&&function(t){var r="";return r+="if(_counter > 0) {\n",(r+=n(e,t,a,u))+"}\n"},onDone:!n&&function(){return a()},rethrowIfPossible:o})}),a,u)},l=0;l<this.options.taps.length;l++)u(l);return c+="} while(false);\n"}},{key:"args",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.before,r=e.after,n=this._args;return t&&(n=[t].concat(n)),r&&(n=n.concat(r)),0===n.length?"":n.join(", ")}},{key:"getTapFn",value:function(e){return"_x["+e+"]"}},{key:"getTap",value:function(e){return"_taps["+e+"]"}},{key:"getInterceptor",value:function(e){return"_interceptors["+e+"]"}}]),e}();e.exports=s},function(e,t,r){r(155);for(var n=r(12),i=r(27),o=r(40),a=r(11)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var u=s[c],l=n[u],d=l&&l.prototype;d&&!d[a]&&i(d,a,u),o[u]=o.Array}},function(e,t,r){(function(e){var n=r(344),i=r(223),o=r(345);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=p(e,t),e}(e,t,r,n):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|h(t,r),i=(e=s(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):p(e,t);if("Buffer"===t.type&&o(t.data))return p(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=s(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function p(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function h(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return E(this,t,r);case"latin1":case"binary":return A(this,t,r);case"base64":return x(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var o,a=1,s=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=r;o<s;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(r+c>s&&(r=s-c),o=r;o>=0;o--){for(var d=!0,p=0;p<c;p++)if(u(e,o+p)!==u(t,p)){d=!1;break}if(d)return o}return-1}function b(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function S(e,t,r,n){return V(B(t,e.length-r),e,r,n)}function _(e,t,r,n){return V(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function M(e,t,r,n){return _(e,t,r,n)}function T(e,t,r,n){return V(F(t),e,r,n)}function w(e,t,r,n){return V(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function x(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,c,u=e[i],l=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=r)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(c=(15&u)<<12|(63&o)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}function E(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function C(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=U(e[o]);return i}function k(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,r,n,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function R(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function P(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function D(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function j(e,t,r,n,o){return o||D(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,o){return o||D(e,0,r,8),i.write(e,t,r,n,52,8),r+8}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return u(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return function(e,t,r,n){return l(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},c.byteLength=h,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(o,a),u=this.slice(n,i),l=e.slice(t,r),d=0;d<s;++d)if(u[d]!==l[d]){o=u[d],a=l[d];break}return o<a?-1:a<o?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return b(this,e,t,r);case"utf8":case"utf-8":return S(this,e,t,r);case"ascii":return _(this,e,t,r);case"latin1":case"binary":return M(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},c.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;r=new c(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||O(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||O(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},c.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||O(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||O(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return j(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return j(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=c.isBuffer(e)?e:B(new c(e,n).toString()),s=a.length;for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var z=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function F(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(z,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(73))},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(107),i=r(80);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){e.exports={default:r(167),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(0)),i=o(r(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=new(function(){function e(){(0,n.default)(this,e),this.strokeColor="rgb(0,0,0)",this.pointsPerBatch=1,this.strokeWidth=5,this.opacity=1}return(0,i.default)(e,[{key:"setStrokeColor",value:function(e){this.strokeColor=e}},{key:"setStrokeWidth",value:function(e){this.strokeWidth=e}},{key:"setOpacity",value:function(e){this.opacity=e}}]),e}());t.default=a},function(e,t){e.exports=!0},function(e,t,r){var n=r(16).f,i=r(33),o=r(11)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){var n=r(26),i=r(111),o=r(112),a=r(23),s=r(59),c=r(84),u={},l={};(t=e.exports=function(e,t,r,d,p){var f,h,m,g,v=p?function(){return e}:c(e),y=n(r,d,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(f=s(e.length);f>b;b++)if((g=t?y(a(h=e[b])[0],h[1]):y(e[b]))===u||g===l)return g}else for(m=v.call(e);!(h=m.next()).done;)if((g=i(m,y,h.value,t))===u||g===l)return g}).BREAK=u,t.RETURN=l},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=s(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||l||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.snapshotOutOfNormalFlowTypes=["background","pan","zoom","mouse-pointer","select","select-hover","laser","camera-bound"],t.globalSnapshotTypes=["camera-bound"],t.cameraSnapshotTypes=["pan","zoom","camera-bound","reset-camera","fit-to-content","fit-to-doc","resize-camera"]},function(e,t,r){e.exports={default:r(261),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.convertToCameraBoundSnapshot=void 0;var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=l(r(19)),u=l(r(10));function l(e){return e&&e.__esModule?e:{default:e}}t.convertToCameraBoundSnapshot=function(e,t){var r=e.getNextCameraBound(t);return(r.width>1e5||r.height>1e5)&&(r.width>r.height?(r.height=1e5*r.height/r.width,r.width=1e5):(r.width=1e5*r.width/r.height,r.height=1e5)),!r.width||!r.height||r.width<0||r.height<0?(e.app.logger.warn("[白板] boundary计算结果不可用，这次camera bound转换返回原值",(0,c.default)(r)),e.app.logger.warn("[白板] container宽高为",e.app.container.width,e.app.container.height),e.app.logger.warn("[白板] 快照类型",t.type),{type:"camera-bound",boundary:{centerX:e.centerX,centerY:e.centerY,width:e.width,height:e.height},skipUndo:!0,animate:!1,reuseOpType:"camera-bound"}):{type:"camera-bound",boundary:r,skipUndo:!0,animate:t.animate,reuseOpType:"camera-bound"}};var d=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="camera-bound",e.description="视角位置",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{"camera-bound:send":{value:this.sendCameraBound.bind(this),information:{args:"boundary: {centerX: number, centerY: number, width: number, width: number}, animate: boolean",message:"发送当前用户的camera-bound，常用于主播同步自己的camera-bound"}}}}},{key:"sendCameraBound",value:function(e,t){this.dispatch({type:"camera-bound",boundary:e,skipUndo:!0,animate:t,reuseOpType:"camera-bound"})}}]),t}(u.default);t.default=d},function(e,t,r){t.__esModule=!0;var n,i=(n=r(13))&&n.__esModule?n:{default:n};t.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,r){return function n(o,a){try{var s=t[o](a),c=s.value}catch(e){return void r(e)}if(!s.done)return i.default.resolve(c).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(c)}("next")}))}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var n=r(77),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var n=r(23),i=r(120),o=r(80),a=r(78)("IE_PROTO"),s=function(){},c=function(){var e,t=r(89)("iframe"),n=o.length;for(t.style.display="none",r(121).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[o[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[a]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){t.f=r(11)},function(e,t,r){e.exports={default:r(157),__esModule:!0}},function(e,t){},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){var n=o(r(20)),i=o(r(86));function o(e){return e&&e.__esModule?e:{default:e}}var a={};function s(e,t,r){r||(r=Error);var n=function(e){var r,n;function o(r,n,i){return e.call(this,function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(r,n,i))||this}return n=e,(r=o).prototype=(0,i.default)(n.prototype),r.prototype.constructor=r,r.__proto__=n,o}(r);n.prototype.name=r.name,n.prototype.code=e,a[e]=n}function c(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}s("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),s("ERR_INVALID_ARG_TYPE",(function(e,t,r){var i,o,a;if("string"==typeof t&&(o="not ",t.substr(0,o.length)===o)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))a="The ".concat(e," ").concat(i," ").concat(c(t,"type"));else{var s=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+".".length>e.length)&&-1!==e.indexOf(".",r)}(e)?"property":"argument";a='The "'.concat(e,'" ').concat(s," ").concat(i," ").concat(c(t,"type"))}return a+". Received type ".concat(void 0===r?"undefined":(0,n.default)(r))}),TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=a},function(e,t,r){(function(t){var n,i=((n=r(14))&&n.__esModule?n:{default:n}).default||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=l;var o=r(224),a=r(229);r(67)(l,o);for(var s=i(a.prototype),c=0;c<s.length;c++){var u=s[c];l.prototype[u]||(l.prototype[u]=a.prototype[u])}function l(e){if(!(this instanceof l))return new l(e);o.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",d)))}function d(){this._writableState.ended||t.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this,r(52))},function(e,t,r){e.exports={default:r(143),__esModule:!0}},function(e,t,r){var n=r(61),i=r(45),o=r(30),a=r(74),s=r(33),c=r(106),u=Object.getOwnPropertyDescriptor;t.f=r(17)?u:function(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){var n=r(53),i=r(11)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:o?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(15);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(53);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(79)("keys"),i=r(60);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var n=r(6),i=r(12),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(49)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(49),i=r(8),o=r(108),a=r(27),s=r(40),c=r(154),u=r(50),l=r(90),d=r(11)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,r,h,m,g,v){c(r,t,h);var y,b,S,_=function(e){if(!p&&e in x)return x[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},M=t+" Iterator",T="values"==m,w=!1,x=e.prototype,I=x[d]||x["@@iterator"]||m&&x[m],E=I||_(m),A=m?T?_("entries"):E:void 0,C="Array"==t&&x.entries||I;if(C&&(S=l(C.call(new e)))!==Object.prototype&&S.next&&(u(S,M,!0),n||"function"==typeof S[d]||a(S,d,f)),T&&I&&"values"!==I.name&&(w=!0,E=function(){return I.call(this)}),n&&!v||!p&&!w&&x[d]||a(x,d,E),s[t]=E,s[M]=f,m)if(y={values:T?E:_("values"),keys:g?E:_("keys"),entries:A},v)for(b in y)b in x||o(x,b,y[b]);else i(i.P+i.F*(p||w),t,y);return y}},function(e,t,r){var n=r(60)("meta"),i=r(15),o=r(33),a=r(16).f,s=0,c=Object.isExtensible||function(){return!0},u=!r(28)((function(){return c(Object.preventExtensions({}))})),l=function(e){a(e,n,{value:{i:"O"+ ++s,w:{}}})},d=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[n].i},getWeak:function(e,t){if(!o(e,n)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[n].w},onFreeze:function(e){return u&&d.NEED&&c(e)&&!o(e,n)&&l(e),e}}},function(e,t,r){var n=r(12),i=r(6),o=r(49),a=r(64),s=r(16).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t,r){var n=r(72),i=r(11)("iterator"),o=r(40);e.exports=r(6).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t,r){var n=r(15);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,r){e.exports={default:r(191),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(9)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(184),l=p(r(10)),d=p(r(48));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="",e.shouldSaniteEp=!1,e.movedDuringMouseDown=!1,e.points=[],e.sampleSeq=0,e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pageChange.tap("PageChange",this.handlePageChange.bind(this))}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handlePageChange",value:function(){this.beginBatch(),this.sampleSeq=0,this.points=[],this.movedDuringMouseDown=!1}},{key:"handleMouseMove",value:function(e,t,n){if(this.isMouseDown||this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+r(199)+") 0 17, auto":document.body.style.cursor="auto",this.isMouseDown){this.movedDuringMouseDown=!0,t=Number(t.toFixed(1)),n=Number(n.toFixed(1)),this.points.push([t,n]);try{this.dispatch(this.getSnapshot(!0))}catch(e){this.logger.warn("[白板] MouseMoveDrawOp MouseMove Error: "+e)}this.sampleSeq+=1}}},{key:"handleMouseDown",value:function(e,t,r){this.beginBatch(),t=Number(t.toFixed(1)),r=Number(r.toFixed(1)),this.points=[[t,r]],this.movedDuringMouseDown=!1,this.sampleSeq=0}},{key:"handleMouseUp",value:function(e,t,r){if(this.isMouseDown&&this.movedDuringMouseDown){t=Number(t.toFixed(1)),r=Number(r.toFixed(1)),this.points.push([t,r]);try{this.dispatch(this.getSnapshot(!1))}catch(e){this.logger.warn("[白板] MouseMoveDrawOp MouseUp Error: "+e)}this.movedDuringMouseDown=!1,this.points=[]}}},{key:"getTwoPointShapeCommonProperty",value:function(e){var t={type:this.type,boundary:this.getBoundaryRectOfLine(),sp:this.sp,ep:this.ep,lineWidth:this.lineWidth,inProgress:e.inProgress,opacity:this.opacity};return"stroke"===e.strokeOrFill?t.stroke=this.color:"fill"===e.strokeOrFill?t.fill=this.color:t.color=this.color,t}},{key:"getFreeDrawCommonProperty",value:function(e){var t={type:this.type,boundary:this.getBoundaryRectOfFreeDraw(),lineWidth:this.lineWidth,inProgress:e.inProgress,opacity:this.opacity};return t.color=this.color,t}},{key:"getBoundaryRectOfFreeDraw",value:function(){var e=this.points;if(0===e.length)throw this.logger.warn("[白板] 涂鸦没有记录任何数据"),new Error("涂鸦没有记录任何数据");var t=e[0][0],r=e[0][1],i=t,o=r,a=!0,s=!1,c=void 0;try{for(var l,d=(0,n.default)(e);!(a=(l=d.next()).done);a=!0){var p=l.value;t=(0,u.min)(p[0],t),r=(0,u.min)(p[1],r),i=(0,u.max)(p[0],i),o=(0,u.max)(p[1],o)}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}return{sx:t,sy:r,w:Number((i-t).toFixed(2)),h:Number((o-r).toFixed(2))}}},{key:"getBoundaryRectOfLine",value:function(){var e=(0,u.min)(this.sp[0],this.ep[0]),t=(0,u.min)(this.sp[1],this.ep[1]),r=(0,u.max)(this.sp[0],this.ep[0]),n=(0,u.max)(this.sp[1],this.ep[1]);return{sx:e,sy:t,w:Number((r-e).toFixed(2)),h:Number((n-t).toFixed(2))}}},{key:"strokeOrFill",value:function(e,t){e.save(),e.lineWidth=t.lineWidth,t.opacity&&(e.globalAlpha=Number(t.opacity)),t.stroke?(e.strokeStyle=t.stroke,e.stroke()):t.fill&&(e.fillStyle=t.fill,e.fill()),e.restore()}},{key:"sanityEp",value:function(e){return e[0]-this.sp[0]>=0&&e[0]-this.sp[0]<1&&(e[0]=this.sp[0]+1),e[1]-this.sp[1]>=0&&e[1]-this.sp[1]<1&&(e[1]=this.sp[1]+1),e}},{key:"lineWidth",get:function(){return Number(d.default.strokeWidth)}},{key:"opacity",get:function(){return Number(d.default.opacity)}},{key:"color",get:function(){return d.default.strokeColor}},{key:"sp",get:function(){return this.points[0]}},{key:"ep",get:function(){var e=this.points[this.points.length-1];return this.shouldSaniteEp&&(e=this.sanityEp(e)),e}}]),t}(l.default);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.shouldDispatch=function(e){var t=e.vision.mode;return"broadcaster"===t||"freeObserver"===t}},function(e,t,r){var n=r(15),i=r(12).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,r){var n=r(33),i=r(34),o=r(78)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,r){var n=r(107),i=r(80).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(27);e.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},function(e,t,r){var n=r(8),i=r(6),o=r(28);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],a={};a[e]=t(r),n(n.S+n.F*o((function(){r(1)})),"Object",a)}},function(e,t,r){e.exports={default:r(193),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=!0;t.LOG=n,t.setLOG=function(e){t.LOG=n=e}},function(e,t,r){e.exports=function(e,t){return"string"!=typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),/["'() \t\n]/.test(e)||t?'"'+e.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DataReportConnError=t.DataReportRunError=void 0;var n=s(r(220)),i=s(r(5)),o=s(r(19)),a=s(r(237));function s(e){return e&&e.__esModule?e:{default:e}}t.DataReportRunError={Board_Lost:3,Page_Lost:4},t.DataReportConnError={Get_Channel_Error:1,IM_Join_Channel_Error:2,IM_Create_Channel_Error:3,Socket_Conn_Closed:4,HeartBeat_Timeout:5,Socket_Closed:6,Sync_Timeout:7,Resend_Count_Exceed_Max:8},t.default=function(e,t,r,s){fetch(e,{method:"post",headers:{"content-type":"application/json"},body:(0,o.default)({common:{device_id:"",session_id:(0,a.default)(r),sdk_type:"whiteboard",ver:"2.0"},event:(0,n.default)({},t,(0,i.default)((0,i.default)({},s),{sdkVersion:"3.7.7"}))})})}},,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DPI=void 0;var n=f(r(5)),i=f(r(70)),o=f(r(35)),a=f(r(41)),s=f(r(9)),c=f(r(0)),u=f(r(1)),l=r(139),d=r(18),p=r(256);function f(e){return e&&e.__esModule?e:{default:e}}var h=t.DPI=window.devicePixelRatio||1,m=0,g=function(){function e(t){var r=this;(0,c.default)(this,e),this.elInitW=1920,this.elInitH=1080,this.interactionEnabled=!0,this.streamFixedWidth=0,this.isLandscape=!1,this.elesToResize=[],this.top=0,this.left=0,this.focus=!1,this.keyPressed={},this.maybeClick=!1,this.mouseEventCache=[],this.isMouseDown=!1,this.sx=0,this.sy=0,this.lastMx=0,this.lastMy=0,this.lastClientX=0,this.lastClientY=0,this.lastTPos=[],this.lastSingleTPos=[],this.histScaleP=.5,this.currTC=0,this.inPan=!1,this._resize=function(e){var t,n=r.el.getBoundingClientRect();r.containerRect=n,r.app.ifDeviceSupportOrientation&&(r.isLandscape=n.width>n.height);var i=!0,o=!1,a=void 0;try{for(var c,u=(0,s.default)(r.elesToResize);!(i=(c=u.next()).done);i=!0){var l=c.value;l.style.width=n.width+"px",l.style.height=n.height+"px",r.streamFixedWidth>0&&l===r.streamCanvas?(l.width=(0,p.evenify)(r.streamFixedWidth),l.height=(0,p.evenify)(l.width*n.height/n.width)):l instanceof HTMLCanvasElement&&(l!==r.streamCanvas||r.keepStreamDPI?(l.width=(0,p.evenify)(n.width*h),l.height=(0,p.evenify)(n.height*h)):(l.width=(0,p.evenify)(n.width),l.height=(0,p.evenify)(n.height)))}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}r.top=n.top,r.left=n.left,r.setElePosition(r.backgroundEl,"fixed"),r.setElePosition(r.h5El,"fixed"),r.setElePosition(r.imageEl,"fixed"),r.setElePosition(r.domEl,"fixed"),r.setElePosition(r.textAreaEl,"fixed"),r.ctx.lineCap="round",r.ctx.lineJoin="round",r.frontCtx.lineCap="round",r.frontCtx.lineJoin="round",r.laserCtx.lineCap="round",r.laserCtx.lineJoin="round",r.streamCtx&&(r.streamCtx.lineCap="round",r.streamCtx.lineJoin="round"),e&&(null===(t=r.opsManager)||void 0===t||t.resize(e,n.width,n.height)),r.streamCanvas&&r.dispatcher.emit("event:appState:change","streamSize",{width:r.streamCanvas.width,height:r.streamCanvas.height}),r.dispatcher.emit("container:resize"),r.app.room.refresh()},this.unbindEvents=function(){var e;window.ResizeObserver&&(null===(e=r._ro)||void 0===e||e.disconnect()),window.removeEventListener("scroll",r._resize,!0),window.removeEventListener("resize",r._resize),window.removeEventListener("orientationchange",r._resize),window.removeEventListener("mousewheel",r._mousewheel,{capture:!1}),window.removeEventListener("wheel",r._mousewheel,{capture:!1}),document.removeEventListener("gesturestart",r._zoom),document.removeEventListener("gesturechange",r._zoom),document.removeEventListener("gestureend",r._zoom),(0,l.off)(r.el,"mousedown",r.mousedown),(0,l.off)(r.el,"mouseleave",r._mouseleave),(0,l.off)(r.el,"focus",r.elFocus),(0,l.off)(r.el,"blur",r.elBlur),(0,l.off)(window.document,"mousemove",r.mousemove),(0,l.off)(window.document,"mouseup",r.mouseup),(0,l.off)(r.el,"touchstart",r._touchdown),(0,l.off)(r.el,"touchmove",r._touchmove),(0,l.off)(r.el,"touchend",r._touchup),(0,l.off)(window.document,"keyup",r._keyup),(0,l.off)(window.document,"keydown",r._keydown),(0,l.off)(document.body,"contextmenu",r._contextmenu)},this.getEventClientPos=function(e){var t=void 0,n=void 0;return e.touches&&e.touches.length>0?(t=e.touches[0].clientX,n=e.touches[0].clientY):(t=e.clientX,n=e.clientY),t-=r.left,n-=r.top,[].concat((0,a.default)(r.app.camera.convertToPointInWorld(t,n)),[t,n])},this.getTouchEventClientPos=function(e){for(var t=[],r=0;r<e.touches.length;r++)t.push(e.touches[r].clientX),t.push(e.touches[r].clientY);return t},this._contextmenu=function(e){e.preventDefault()},this._touchdown=function(e){r.mouseEmitTimer=clearTimeout(r.mouseEmitTimer),r.mouseEventCache=[];var t=e.touches.length;r.inPan=!1,r.currTC=t,r.lastAction=void 0,r.histScaleP=.5,1===t?r.mousedown(e):(r.mouseup(e),2===t&&(r.lastTPos=r.getTouchEventClientPos(e)))},this.elFocus=function(){r.focus=!0,r.keyPressed={}},this.elBlur=function(){r.focus=!1,r.keyPressed={}},this._touchmove=function(e){var t,n,i,o,a,s=e.touches.length;if(1===s&&r.inPan){var c=r.getTouchEventClientPos(e);r.lastSingleTPos.length>0&&(null===(t=r.opsManager)||void 0===t||t.pan(e,c[0]-r.lastSingleTPos[0],c[1]-r.lastSingleTPos[1])),r.lastSingleTPos=c}else if(1===s)r.mousemove(e);else if(2===s){var u=r.getTouchEventClientPos(e),l=(0,p.deltaXY)(r.lastTPos,u),d=(0,p.pinchScale)(r.lastTPos,u),f=(0,p.fingerDiff)(r.lastTPos,u);r.lastTPos=u;var h=Math.abs(l[0])/2+Math.abs(l[1])/2,m=Math.abs(1-d),g=(0,p.scaleProb)(f,h,m);g+r.histScaleP<.75&&h>.5?(null===(n=r.opsManager)||void 0===n||n.pan(e,l[0],l[1]),r.lastAction="pan"):g+r.histScaleP>=1.25&&m>.007?(d=Math.max(Math.min(d,1.2),.8),null===(i=r.opsManager)||void 0===i||i.scale(e,d,u[0]/2+u[2]/2,u[1]/2+u[3]/2),r.lastAction="scale"):"pan"===r.lastAction?null===(o=r.opsManager)||void 0===o||o.pan(e,l[0],l[1]):"move"===r.lastAction&&(null===(a=r.opsManager)||void 0===a||a.scale(e,d,u[0]/2+u[2]/2,u[1]/2+u[3]/2)),r.histScaleP=.8*r.histScaleP+.2*g}},this._touchup=function(e){var t=e.touches.length;r.lastSingleTPos=[],0===t?(r.mouseup(e),r.inPan=!1):1===t&&r.currTC>1?r.inPan=!0:r.inPan=!1,r.currTC=t},this.mousedown=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((r.interactionEnabled||t)&&!r.isMouseDown){var n=r.getEventClientPos(e),i=(0,o.default)(n,4),a=i[0],s=i[1],c=i[2],u=i[3];r.lastMx=a,r.lastMy=s,r.lastClientX=c,r.lastClientY=u,r.isMouseDown=!0,r.maybeClick=!0,r.sx=a,r.sy=s,r.mouseEventCache.push({type:"mousedown",args:[e,r.sx,r.sy,c,u]}),r.mouseEmitTimer=setTimeout((function(){r.maybeClick=!1,r._emitMouseEvents()}),150)}},this.mousemove=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r.interactionEnabled||n){var i=r.getEventClientPos(e),a=(0,o.default)(i,4),s=a[0],c=a[1],u=a[2],l=a[3];r.lastMx=s,r.lastMy=c,r.lastClientX=u,r.lastClientY=l,r.maybeClick&&(r.maybeClick=(0,d.distSqrt)([s,c],[r.sx,r.sy])<=5),r.maybeClick?r.mouseEventCache.push({type:"mousemove",args:[e,s,c,u,l]}):(r.mouseEmitTimer&&(r.mouseEmitTimer=clearTimeout(r.mouseEmitTimer),r._emitMouseEvents()),null===(t=r.opsManager)||void 0===t||t.mousemove(e,s,c,u,l))}},this.mouseup=function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((r.interactionEnabled||i)&&r.isMouseDown){var o=[r.lastMx,r.lastMy,r.lastClientX,r.lastClientY],a=o[0],s=o[1],c=o[2],u=o[3];r.maybeClick?(r.mouseEmitTimer=clearTimeout(r.mouseEmitTimer),r.mouseEventCache=[],r.maybeClick=!1,null===(n=r.opsManager)||void 0===n||n.click(e,a,s,c,u)):(r.mouseEmitTimer&&(r.mouseEmitTimer=clearTimeout(r.mouseEmitTimer),r._emitMouseEvents()),r.mouseEventCache=[],null===(t=r.opsManager)||void 0===t||t.mouseup(e,a,s,c,u)),r.isMouseDown=!1}},this._mouseleave=function(e){var t,n=r.getEventClientPos(e),i=(0,o.default)(n,4),a=i[0],s=i[1],c=i[2],u=i[3];null===(t=r.opsManager)||void 0===t||t.mouseleave(e,a,s,c,u)},this._zoom=function(e){var t;if(r.isTargetOnContainer(e.target)){var n=r.getEventClientPos(e),i=(0,o.default)(n,4),a=i[0],s=i[1],c=i[2],u=i[3];return null===(t=r.opsManager)||void 0===t||t.mousewheel(e,a,s,c,u),e.preventDefault()}},this._mousewheel=function(e){var t,n;if(r.isTargetOnContainer(e.target)){var a=navigator.platform.toUpperCase().indexOf("MAC")>=0,s=navigator.userAgent.toUpperCase().indexOf("FIREFOX")>=0;if(a&&!s&&(0,i.default)(e.deltaX)&&(0,i.default)(e.deltaY)){if((m+=1)>2){var c=Math.max(Math.abs(e.deltaX),Math.abs(e.deltaY))/50,u=1.5*e.deltaX,l=1.5*e.deltaY;c>1&&(u/=c,l/=c),null===(t=r.opsManager)||void 0===t||t.pan(e,-u,-l)}}else{var d=r.getEventClientPos(e),p=(0,o.default)(d,4),f=p[0],h=p[1],g=p[2],v=p[3];null===(n=r.opsManager)||void 0===n||n.mousewheel(e,f,h,g,v),m=0}e.preventDefault()}},this._keyup=function(e){var t;if(e&&e.key&&r.focus){var n=e.key.toLocaleLowerCase();null===(t=r.opsManager)||void 0===t||t.keyup(e),r.keyPressed[n]=!1}},this._keydown=function(e){var t;if(e&&e.key&&r.focus){var n=e.key.toLocaleLowerCase();r.keyPressed[n]=!0,null===(t=r.opsManager)||void 0===t||t.keydown(e)}},this.app=t,this.dispatcher=t.dispatcher,this.el=document.createElement("div"),(0,n.default)(this.el.style,{userSelect:"none",position:"relative",width:"100%",height:"100%",outline:"none"}),this.el.id="yunxin-whiteboard",this.el.tabIndex=0,this.setBackgroundColor();var u=this.setupCanvasElement("bg-canvas");this.bgCanvas=u.canvas,this.bgCtx=u.ctx,this.backgroundEl=this.setupDivElement("bg-el"),this.h5El=this.setupDivElement("h5-el"),this.imageEl=this.setupDivElement("image-el"),u=this.setupCanvasElement("anchor-canvas"),this.canvas=u.canvas,this.ctx=u.ctx,u=this.setupCanvasElement("inc-canvas"),this.frontCanvas=u.canvas,this.frontCtx=u.ctx,this.domEl=this.setupDivElement("dom-el"),this.textAreaEl=this.setupDivElement("toolbar-el"),u=this.setupCanvasElement("laser-canvas"),this.laserCanvas=u.canvas,this.laserCtx=u.ctx}return(0,u.default)(e,[{key:"disableInteraction",value:function(){this.interactionEnabled=!1}},{key:"enableInteraction",value:function(){this.interactionEnabled=!0}},{key:"setBackgroundColor",value:function(){this.el.style.backgroundColor=this.app.appConfig.canvasBgColor}},{key:"getStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.el.getBoundingClientRect();this.streamFixedWidth=e.width?e.width:0;var n=!e.hasOwnProperty("keepDPI")||e.keepDPI;this.keepStreamDPI=n;var i=e.width?e.width:n?r.width*h:r.width,o=i*r.height/r.width;if(i=(0,p.evenify)(i),o=(0,p.evenify)(o),!this.streamCanvas){var a=this.setupCanvasElement("stream-canvas");this.streamCanvas=a.canvas,this.streamCanvas.style.visibility="hidden",this.streamCtx=a.ctx}return this.streamCanvas.width=i,this.streamCanvas.height=o,this.streamCanvas.style.width=r.width+"px",this.streamCanvas.style.height=r.height+"px",this.streamCtx&&(this.streamCtx.lineCap="round",this.streamCtx.lineJoin="round"),this.streamCanvas&&this.dispatcher.emit("event:appState:change","streamSize",{width:this.streamCanvas.width,height:this.streamCanvas.height}),t||!this.stream?(this.stopStream(),this.stream=this.streamCanvas.captureStream(),this.stream):this.stream}},{key:"stopStream",value:function(){if(this.stream){var e=this.stream.getTracks(),t=!0,r=!1,n=void 0;try{for(var i,o=(0,s.default)(e);!(t=(i=o.next()).done);t=!0)i.value.stop()}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}this.stream=void 0}}},{key:"appendTo",value:function(e){e.style.overflow="hidden",e.appendChild(this.el),this._resize(),this.dispatcher.emit("container:set"),this._bindEvents(e)}},{key:"addOpsManager",value:function(e){this.opsManager=e}},{key:"isKeyDown",value:function(e){return this.keyPressed.hasOwnProperty(e)&&this.keyPressed[e]}},{key:"resize",value:function(){this._resize()}},{key:"isTargetOnContainer",value:function(e){for(;e;){if(e===this.el)return!0;e=e.parentNode}return!1}},{key:"setupDivElement",value:function(e){var t=document.createElement("div");return t.style.pointerEvents="none",t.style.transformOrigin="left top",t.className=e,this.el.appendChild(t),t}},{key:"setupCanvasElement",value:function(e){var t=document.createElement("canvas");this.setElePosition(t),t.className=e,t.style.pointerEvents="none";var r=t.getContext("2d");return this.el.appendChild(t),this.elesToResize.push(t),{canvas:t,ctx:r}}},{key:"_bindEvents",value:function(e){var t,r=this;this.unbindEvents(),window.ResizeObserver&&(this._ro=new window.ResizeObserver((function(e,t){r._resize(!0)})),null===(t=this._ro)||void 0===t||t.observe(e)),window.addEventListener("scroll",this._resize,!0),window.addEventListener("resize",this._resize),window.addEventListener("orientationchange",this._resize),(0,l.on)(this.el,"mousedown",this.mousedown),(0,l.on)(this.el,"mouseleave",this._mouseleave),(0,l.on)(this.el,"focus",this.elFocus),(0,l.on)(this.el,"blur",this.elBlur),(0,l.on)(window.document,"mousemove",this.mousemove),(0,l.on)(window.document,"mouseup",this.mouseup),window.addEventListener("wheel",this._mousewheel,{passive:!1,capture:!1}),window.addEventListener("mousewheel",this._mousewheel,{passive:!1,capture:!1}),document.addEventListener("gesturestart",this._zoom),document.addEventListener("gesturechange",this._zoom),document.addEventListener("gestureend",this._zoom),(0,l.on)(this.el,"touchstart",this._touchdown),(0,l.on)(this.el,"touchmove",this._touchmove),(0,l.on)(this.el,"touchend",this._touchup),(0,l.on)(window.document,"keyup",this._keyup),(0,l.on)(window.document,"keydown",this._keydown),(0,l.on)(document.body,"contextmenu",this._contextmenu)}},{key:"destroy",value:function(){this.unbindEvents(),this.stopStream()}},{key:"setElePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"absolute";"absolute"===t?(e.style.position=t,e.style.left="0px",e.style.right="0px",e.style.top="0px",e.style.bottom="0px"):(e.style.position="fixed",e.style.left=this.left+"px",e.style.width=this.width+"px",e.style.top=this.top+"px",e.style.height=this.height+"px")}},{key:"_emitMouseEvents",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=(0,s.default)(this.mouseEventCache);!(e=(n=i.next()).done);e=!0){var o,c=n.value;(o=this.opsManager)[c.type].apply(o,(0,a.default)(c.args))}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}this.mouseEventCache=[]}},{key:"width",get:function(){return this.containerRect?this.containerRect.width:this.canvas.width}},{key:"height",get:function(){return this.containerRect?this.containerRect.height:this.canvas.height}}]),e}();t.default=g},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(9)),i=f(r(2)),o=f(r(0)),a=f(r(1)),s=f(r(3)),c=f(r(4)),u=r(18),l=f(r(201)),d=f(r(48)),p=r(36);function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="select",e.lineWidth=0,e.fillColor="rgba(230, 100, 100, 0.4)",e.eleContainerColor="rgb(0, 0, 0)",e.eleContainerWidth=2,e.eleContainerPadding=3,e.activate=!1,e.selectedOpIds=[],e.inProgressSelectedOpIds=[],e.description="选择操作工具。\n首先使用op:select:activate设置画布为选择模式。通过。然后画布会监听鼠标动作，生成选择框。具体用法如下：",e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"getSelectedIds",value:function(){return this.selectedOpIds.slice()}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"select:width":{value:this.setLineWidth.bind(this),information:{args:"width: number",message:"设置选择框线段宽度"}},"select:fill:color":{value:this.setFillColor.bind(this),information:{args:"color: ColorString",message:"设置选择框填充色"}},"select:stroke:color":{value:this.setStrokeColor.bind(this),information:{args:"color: ColorString",message:"设置选择框填充色"}},"select:eleContainer:color":{value:this.setEleContainerColor.bind(this),information:{args:"color: ColorString",message:"设置被选中元素包含盒颜色"}},"select:eleContainer:width":{value:this.setEleContainerWidth.bind(this),information:{args:"width: number",message:"设置被选中元素包含盒线段宽度"}},"select:eleContainerPadding":{value:this.setEleContainerPadding.bind(this),information:{args:"width: number",message:"设置被选中元素包含盒的padding"}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this)),this.opsManager.hooks.pageChange.tap("pageChange",this.handlePageChange.bind(this))}},{key:"handlePageChange",value:function(e){e.uid===this.app.account&&this.selectedOpIds.length>0&&this.dispatch(this.getSnapshot([]))}},{key:"handleOpChange",value:function(e){var t;"select"!==e&&"select"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&this.dispatch(this.getSnapshot([])),this.beginBatch()}},{key:"postMouseUp",value:function(e){this.dispatch(this.getSnapshot(e)),this.lastSelectedOpIds=e}},{key:"postClick",value:function(e){0===e.length&&Date.now()-this.opsManager.opMap.text.blurAt<100||this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return{type:"select",sp:this.sp,ep:this.ep,inProgress:!1,selectedOpIds:e.slice(),reuseOpType:"select",skipUndo:!0,color:d.default.strokeColor,nickname:this.app.nickname}}},{key:"draw",value:function(e,t){var r=e.data.color?e.data.color:"rgb(0,0,0)";this.drawSelectBox(e,t);var n=this.drawSelectedElementBox(e,t,r);if(!e.data.inProgress&&e.uid!==this.app.account&&Array.isArray(n)&&1===n.length){var i=n[0].sx+n[0].w/2,o=n[0].sy;if(!this.app.appConfig.showSelectNickname)return;(0,p.drawUserName)({ctx:t,account:e.data.nickname?e.data.nickname:e.uid,scale:this.app.camera.scale,px:i,py:o,bgColor:r,fontSize:16,textPadding:8,radius:6})}}},{key:"drawSelectBox",value:function(e,t){var r=e.data,n=void 0,i=void 0;if(Array.isArray(r.points)&&r.points.length>=2?(n=r.points[0],i=r.points[r.points.length-1]):r.sp&&r.ep&&(r.sp[0]===r.ep[0]&&r.sp[1]===r.ep[1]||(n=r.sp,i=r.ep)),r.inProgress&&n&&i){var o=(0,u.getBoundaryBoxFromTwoPoints)(n,i),a=o.sx,s=o.sy,c=o.w,l=o.h;t.beginPath(),this.strokeColor&&this.lineWidth&&(t.strokeStyle=this.strokeColor,t.lineWidth=this.lineWidth,t.strokeRect(a,s,c,l)),this.fillColor&&(t.fillStyle=this.fillColor,t.fillRect(a,s,c,l))}}},{key:"drawSelectedElementBox",value:function(e,r,i){var o=this,a=e.data,s=a.selectedOpIds.filter((function(e){return o.drawOpsOfPage[e]})),c=this.eleContainerPadding;if(0!==s.length){var l=s.map((function(e){var t=o.drawOpsOfPage[e];return(0,u.getTransformedBoundary)(o.app.camera.scale,t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)}));a.inProgress||(l=[l.reduce((function(e,t){return(0,u.combineBoundary)(e,t)}))]),r.strokeStyle=i,r.fillStyle=i,r.lineWidth=this.eleContainerWidth;var d=5/this.app.camera.scale,p=!0,f=!1,h=void 0;try{for(var m,g=(0,n.default)(l);!(p=(m=g.next()).done);p=!0){var v=m.value;r.beginPath(),r.strokeRect(v.sx-c,v.sy-c,v.w+2*c,v.h+2*c),!a.inProgress&&this.opsManager.currOp instanceof t&&(r.fillRect(v.sx-c-d/2,v.sy-c-d/2,d,d),r.fillRect(v.sx+v.w+c-d/2,v.sy+v.h+c-d/2,d,d),r.fillRect(v.sx+v.w+c-d/2,v.sy-c-d/2,d,d),r.fillRect(v.sx-c-d/2,v.sy+v.h+c-d/2,d,d))}}catch(e){f=!0,h=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw h}}return l}}},{key:"setSelectedOpIds",value:function(e){this.selectedOpIds.join(",")!==e.join(",")&&(this.emit("event:appState:change","selectChange",this.selectedOpIds.slice(),e.slice(),(0,p.filterNonMediaOpIds)(this,e)),this.opsManager.hooks.selectChange.call(this.selectedOpIds.slice(),e.slice()),this.selectedOpIds=e,this.dispatch(this.getSnapshot(e.slice())))}},{key:"setInProgressSelectedOpIds",value:function(e){this.inProgressSelectedOpIds=e.slice()}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setFillColor",value:function(e){this.fillColor=e}},{key:"setStrokeColor",value:function(e){this.strokeColor=e}},{key:"setEleContainerColor",value:function(e){this.eleContainerColor=e}},{key:"setEleContainerWidth",value:function(e){this.eleContainerWidth=e}},{key:"setEleContainerPadding",value:function(e){this.eleContainerPadding=e}}]),t}(l.default);t.default=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_FONTSIZE=void 0;var n=a(r(5)),i=a(r(14)),o=a(r(0));function a(e){return e&&e.__esModule?e:{default:e}}t.DEFAULT_FONTSIZE=32,t.default=function e(t){var r=this;(0,o.default)(this,e),this.setAppConfig=function(e){var t,o,a;if(0===(0,i.default)(e).length)r.app.logger.error("[白板]","调用了setAppConfig, 但传入的参数为空",e);else for(var s in e)"canvasBgColor"===s?(r.config.canvasBgColor=e.canvasBgColor,r.app.container.setBackgroundColor(),null===(t=r.app.previewFactory)||void 0===t||t.setBackgroundColor()):"canvas_bg_color"===s?(r.config.canvasBgColor=e.canvas_bg_color,r.app.container.setBackgroundColor(),null===(o=r.app.previewFactory)||void 0===o||o.setBackgroundColor()):"previewMode"===s?(r.config.previewMode=e.previewMode,null===(a=r.app.previewFactory)||void 0===a||a.refreshPreviewsOfCurrBoard(!0)):r.config.hasOwnProperty(s)?r.config[s]=e[s]:(r.app.logger.error("[白板]","setAppConfig传入的参数键值"+s+"不是有效的配置项"),r.app.logger.error("[白板]","目前支持的配置项有："+(0,i.default)(r.config)));(0,n.default)(r.config,e),r.app.emit("event:appState:change","config",r.config)},this.getAppConfig=function(){return r.config},this.app=t,this.config={canvasBgColor:"#f5f5f7",showCursorNickname:!1,showSelectNickname:!1,showLaserNickname:!1,cameraTransformEnabled:!0,allowReplaceActiveBroadcaster:!0,zoomSensitivity:.91,staticDocType:"template",previewMode:"fitDoc",previewCustomBg:!1,disableAutoResize:!0}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaResource=t.mediaResourceLoaded=t.getResource=t.resourceLoaded=t.fetchMediaResource=t.fetchResource=void 0;var n=s(r(9)),i=s(r(288)),o=r(29),a=s(r(32));function s(e){return e&&e.__esModule?e:{default:e}}var c={},u={},l={},d={},p={},f=t.fetchResource=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];c.hasOwnProperty(e)||(l[e]=new Image,l[e].crossOrigin="anonymous",l[e].src=e,r?(c[e]=new Image,c[e].src=e):c[e]=l[e]),"function"==typeof t&&m(e,"",t)},h=t.fetchMediaResource=function(e,t,r,n){if(!u.hasOwnProperty(e))if(u[e]=document.createElement(r),"audio"===r){var i=document.createElement("source");i.src=e,i.setAttribute("type",t),u[e].appendChild(i)}else u[e].src=e+"#t=0.1";"function"==typeof n&&m(e,t,n,r)},m=function(e,t,r,i){d[e]=d[e]||[],d[e].push(r);var s=i?u[e]:c[e];i?s.onloadedmetadata=function(){var t=d[e]||[],r=!0,i=!1,o=void 0;try{for(var a,c=(0,n.default)(t);!(r=(a=c.next()).done);r=!0)(0,a.value)(s)}catch(e){i=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw o}}}:s.onload=function(){var t=d[e]||[],r=!0,i=!1,o=void 0;try{for(var a,c=(0,n.default)(t);!(r=(a=c.next()).done);r=!0)(0,a.value)(s)}catch(e){i=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw o}}},s.onerror=function(n){p[e]||(p[e]=0),console.error("[白板] "+i+"资源 [url: "+e+"] 第"+p[e]+"加载失败"),console.error(n);var s=i?"video"===i?a.default.VIDEO_UPLOAD_FAIL:a.default.AUDIO_UPLOAD_FAIL:a.default.PIC_UPLOAD_FAIL,l=p[e]<3,m=i?"video"===i?"视频":"音频":"图片";if(p[e]>0&&(0,o.showToast)({type:"error",msg:m+"加载失败"+(l?", 5s后将尝试重新加载("+(p[e]+1)+"/3)":""),time:3,msgType:s}),delete c[e],delete u[e],delete d[e],l){var g=p[e]>0?5e3:100;setTimeout((function(){console.warn("[白板] "+(i?"文件":"图片")+"加载失败，第"+p[e]+"次重新加载: "+e),i?h(e,t,i,r):f(e,r,!0)}),g)}p[e]+=1}};t.resourceLoaded=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t?l[e]:c[e];return r&&r.complete&&r.width>0&&r.height>0},t.getResource=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?l[e]:c[e]},t.mediaResourceLoaded=function(e,t){if("video"===t){var r=u[e];return r&&r.videoWidth>0&&r.videoHeight>0&&r.readyState>=1}var n=u[e];return n&&n.readyState>=1},t.getMediaResource=function(e){return u[e]},c.imageLoading=new Image,c.imageLoading.src=i.default,l.imageLoading=new Image,l.imageLoading.src=i.default,l.imageLoading.setAttribute("crossorigin","anonymous")},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformOp=function(e,t,r){var n=e.opsManager.opMap[r.data.type];try{return"transformOp"in n?n.transformOp(t,r):t}catch(r){return e.logger.warn("transform op error"),e.logger.warn(t),e.logger.warn(r),t}},t.opNeedRefresh=function(e,t){return!((-1!==["select","laser","text"].indexOf(t.data.type)||-1!==e.opsManager.drawOpTypes.indexOf(t.data.type))&&t.data.inProgress||"mouse-pointer"===t.data.type)},t.getSelectedOpIds=function(e){var t=[],r=e.lastSelectOfUser[e.app.account];return r&&(t=r.data.selectedOpIds.slice()),t.filter((function(t){return e.drawOpQueue.hasOwnProperty(t)&&!e.drawOpQueue[t].data.locked}))},t.clearCtx=function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)},t.fillCtx=function(e){e.fillRect(0,0,e.canvas.width,e.canvas.height)}},function(e,t,r){var n=c(r(21)),i=c(r(57)),o=c(r(1)),a=c(r(13)),s=c(r(0));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StreamReader=t.EndOfStreamError=void 0;var u=r(232),l=r(232);Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return l.EndOfStreamError}});var d=function e(){var t=this;(0,s.default)(this,e),this.promise=new a.default((function(e,r){t.reject=r,t.resolve=e}))},p=function(){function e(t){var r=this;if((0,s.default)(this,e),this.s=t,this.endOfStream=!1,this.peekQueue=[],!t.read||!t.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",(function(){return r.reject(new u.EndOfStreamError)})),this.s.once("error",(function(e){return r.reject(e)})),this.s.once("close",(function(){return r.reject(new Error("Stream closed"))}))}var t,r,a;return(0,o.default)(e,[{key:"peek",value:(a=(0,i.default)(n.default.mark((function e(t,r,i){var o;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.read(t,r,i);case 2:return o=e.sent,this.peekQueue.push(t.slice(r,r+o)),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return a.apply(this,arguments)})},{key:"read",value:(r=(0,i.default)(n.default.mark((function e(t,r,i){var o,a,s,c,l,d;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==i){e.next=2;break}return e.abrupt("return",0);case 2:if(0!==this.peekQueue.length||!this.endOfStream){e.next=4;break}throw new u.EndOfStreamError;case 4:for(o=i,a=0;this.peekQueue.length>0&&o>0;)s=this.peekQueue.pop(),c=Math.min(s.length,o),s.copy(t,r+a,0,c),a+=c,o-=c,c<s.length&&this.peekQueue.push(s.slice(c));case 7:if(!(o>0)||this.endOfStream){e.next=18;break}return l=Math.min(o,1048576),e.next=11,this._read(t,r+a,l);case 11:if(d=e.sent,a+=d,!(d<l)){e.next=15;break}return e.abrupt("break",18);case 15:o-=d,e.next=7;break;case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_read",value:(t=(0,i.default)(n.default.mark((function e(t,r,i){var o,a=this;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.request){e.next=2;break}throw new Error("Concurrent read operation?");case 2:if(!(o=this.s.read(i))){e.next=8;break}return o.copy(t,r),e.abrupt("return",o.length);case 8:return this.request={buffer:t,offset:r,length:i,deferred:new d},this.s.once("readable",(function(){a.tryRead()})),e.abrupt("return",this.request.deferred.promise.then((function(e){return e}),(function(e){throw e})));case 11:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"tryRead",value:function(){var e=this,t=this.s.read(this.request.length);t?(t.copy(this.request.buffer,this.request.offset),this.request.deferred.resolve(t.length),this.request=null):this.s.once("readable",(function(){e.tryRead()}))}},{key:"reject",value:function(e){this.endOfStream=!0,this.request&&(this.request.deferred.reject(e),this.request=null)}}]),e}();t.StreamReader=p},function(e,t,r){e.exports=!r(17)&&!r(28)((function(){return 7!=Object.defineProperty(r(89)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(33),i=r(30),o=r(149)(!1),a=r(78)("IE_PROTO");e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)r!=a&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){e.exports=r(27)},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(53);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(23);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},function(e,t,r){var n=r(40),i=r(11)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){var n=r(16).f,i=r(62),o=r(93),a=r(26),s=r(92),c=r(51),u=r(81),l=r(109),d=r(124),p=r(17),f=r(82).fastKey,h=r(85),m=p?"_s":"size",g=function(e,t){var r,n=f(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,u){var l=e((function(e,n){s(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,null!=n&&c(n,r,e[u],e)}));return o(l.prototype,{clear:function(){for(var e=h(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var r=h(this,t),n=g(r,e);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[m]--}return!!n},forEach:function(e){h(this,t);for(var r,n=a(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!g(h(this,t),e)}}),p&&n(l.prototype,"size",{get:function(){return h(this,t)[m]}}),l},def:function(e,t,r){var n,i,o=g(e,t);return o?o.v=r:(e._l=o={i:i=f(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[m]++,"F"!==i&&(e._i[i]=o)),e},getEntry:g,setStrong:function(e,t,r){u(e,t,(function(e,r){this._t=h(e,t),this._k=r,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),r?"entries":"values",!r,!0),d(t)}}},function(e,t,r){var n=r(12),i=r(8),o=r(82),a=r(28),s=r(27),c=r(93),u=r(51),l=r(92),d=r(15),p=r(50),f=r(16).f,h=r(173)(0),m=r(17);e.exports=function(e,t,r,g,v,y){var b=n[e],S=b,_=v?"set":"add",M=S&&S.prototype,T={};return m&&"function"==typeof S&&(y||M.forEach&&!a((function(){(new S).entries().next()})))?(S=t((function(t,r){l(t,S,e,"_c"),t._c=new b,null!=r&&u(r,v,t[_],t)})),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in M)||y&&"clear"==e||s(S.prototype,e,(function(r,n){if(l(this,S,e),!t&&y&&!d(r))return"get"==e&&void 0;var i=this._c[e](0===r?0:r,n);return t?this:i}))})),y||f(S.prototype,"size",{get:function(){return this._c.size}})):(S=g.getConstructor(t,e,v,_),c(S.prototype,r),o.NEED=!0),p(S,e),T[e]=S,i(i.G+i.W+i.F,T),y||g.setStrong(S,e,v),S}},function(e,t,r){var n=r(72),i=r(177);e.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,r){var n=r(8);e.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,r){var n=r(8),i=r(58),o=r(26),a=r(51);e.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,s,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),null==e?new this:(r=[],t?(n=0,s=o(c,arguments[2],2),a(e,!1,(function(e){r.push(s(e,n++))}))):a(e,!1,r.push,r),new this(r))}})}},function(e,t,r){e.exports={default:r(182),__esModule:!0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){var n=r(16),i=r(23),o=r(46);e.exports=r(17)?Object.defineProperties:function(e,t){i(e);for(var r,a=o(t),s=a.length,c=0;s>c;)n.f(e,r=a[c++],t[r]);return e}},function(e,t,r){var n=r(12).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(12),i=r(33),o=r(17),a=r(8),s=r(108),c=r(82).KEY,u=r(28),l=r(79),d=r(50),p=r(60),f=r(11),h=r(64),m=r(83),g=r(158),v=r(110),y=r(23),b=r(15),S=r(34),_=r(30),M=r(74),T=r(45),w=r(62),x=r(159),I=r(71),E=r(63),A=r(16),C=r(46),k=I.f,O=A.f,N=x.f,R=n.Symbol,P=n.JSON,D=P&&P.stringify,j=f("_hidden"),L=f("toPrimitive"),z={}.propertyIsEnumerable,U=l("symbol-registry"),B=l("symbols"),F=l("op-symbols"),V=Object.prototype,H="function"==typeof R&&!!E.f,$=n.QObject,W=!$||!$.prototype||!$.prototype.findChild,Y=o&&u((function(){return 7!=w(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=k(V,t);n&&delete V[t],O(e,t,r),n&&e!==V&&O(V,t,n)}:O,G=function(e){var t=B[e]=w(R.prototype);return t._k=e,t},Q=H&&"symbol"==typeof R.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof R},q=function(e,t,r){return e===V&&q(F,t,r),y(e),t=M(t,!0),y(r),i(B,t)?(r.enumerable?(i(e,j)&&e[j][t]&&(e[j][t]=!1),r=w(r,{enumerable:T(0,!1)})):(i(e,j)||O(e,j,T(1,{})),e[j][t]=!0),Y(e,t,r)):O(e,t,r)},J=function(e,t){y(e);for(var r,n=g(t=_(t)),i=0,o=n.length;o>i;)q(e,r=n[i++],t[r]);return e},Z=function(e){var t=z.call(this,e=M(e,!0));return!(this===V&&i(B,e)&&!i(F,e))&&(!(t||!i(this,e)||!i(B,e)||i(this,j)&&this[j][e])||t)},K=function(e,t){if(e=_(e),t=M(t,!0),e!==V||!i(B,t)||i(F,t)){var r=k(e,t);return!r||!i(B,t)||i(e,j)&&e[j][t]||(r.enumerable=!0),r}},X=function(e){for(var t,r=N(_(e)),n=[],o=0;r.length>o;)i(B,t=r[o++])||t==j||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===V,n=N(r?F:_(e)),o=[],a=0;n.length>a;)!i(B,t=n[a++])||r&&!i(V,t)||o.push(B[t]);return o};H||(s((R=function(){if(this instanceof R)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===V&&t.call(F,r),i(this,j)&&i(this[j],e)&&(this[j][e]=!1),Y(this,e,T(1,r))};return o&&W&&Y(V,e,{configurable:!0,set:t}),G(e)}).prototype,"toString",(function(){return this._k})),I.f=K,A.f=q,r(91).f=x.f=X,r(61).f=Z,E.f=ee,o&&!r(49)&&s(V,"propertyIsEnumerable",Z,!0),h.f=function(e){return G(f(e))}),a(a.G+a.W+a.F*!H,{Symbol:R});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)f(te[re++]);for(var ne=C(f.store),ie=0;ne.length>ie;)m(ne[ie++]);a(a.S+a.F*!H,"Symbol",{for:function(e){return i(U,e+="")?U[e]:U[e]=R(e)},keyFor:function(e){if(!Q(e))throw TypeError(e+" is not a symbol!");for(var t in U)if(U[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),a(a.S+a.F*!H,"Object",{create:function(e,t){return void 0===t?w(e):J(w(e),t)},defineProperty:q,defineProperties:J,getOwnPropertyDescriptor:K,getOwnPropertyNames:X,getOwnPropertySymbols:ee});var oe=u((function(){E.f(1)}));a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return E.f(S(e))}}),P&&a(a.S+a.F*(!H||u((function(){var e=R();return"[null]"!=D([e])||"{}"!=D({a:e})||"{}"!=D(Object(e))}))),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(b(t)||void 0!==e)&&!Q(e))return v(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Q(t))return t}),n[1]=t,D.apply(P,n)}}),R.prototype[L]||r(27)(R.prototype,L,R.prototype.valueOf),d(R,"Symbol"),d(Math,"Math",!0),d(n.JSON,"JSON",!0)},function(e,t,r){var n=r(58);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){var n=r(12),i=r(6),o=r(16),a=r(17),s=r(11)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];a&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(11)("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:r=!0}},o[n]=function(){return a},e(o)}catch(e){}return r}},function(e,t,r){var n=r(16),i=r(45);e.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},function(e,t,r){e.exports={default:r(188),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformArray=["android","ios","pc","mac","pad","web"],t.TouchPlatformArray=["android","ios","pad"];var n=t.PluginType=void 0;!function(e){e[e.OneMotion=0]="OneMotion"}(n||(t.PluginType=n={}))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultFontName=t.CustomFontName=void 0;var n=o(r(0)),i=o(r(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=t.CustomFontName="customWBFont",s=t.DefaultFontName="defaultWBFont",c=["embedded-opentype","woff","truetype","svg","opentype","woff2"],u=new(function(){function e(){(0,n.default)(this,e),this.fontFamily="",this.fontFaceSet=!1,this.appendFontFaceStyle([{url:"https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.ttf",format:"truetype"},{url:"https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.woff",format:"woff"},{url:"https://app.yunxin.163.com/webdemo/whiteboard/assets/font/Helvetica.woff2",format:"woff2"}],s)}return(0,i.default)(e,[{key:"getFontFamily",value:function(){return this.fontFamily&&this.fontFaceSet?'"'+this.fontFamily+'", "'+a+'"':this.fontFamily?this.fontFamily:this.fontFaceSet?a:'"Helvetica", "'+s+'"'}},{key:"setFontFamily",value:function(e){this.fontFamily=e}},{key:"setFontFace",value:function(e){this.fontFaceSet=!0,this.appendFontFaceStyle(e,a)}},{key:"appendFontFaceStyle",value:function(e,t){var r=document;try{if(r&&r.fonts&&r.fonts.check&&r.fonts.check("12px '"+t+"'"))return}catch(e){console.error("检测字体是否存在抛出异常",e)}var n=e.map((function(e){return e.format&&-1===c.indexOf(e.format)?(console.error("[白板] 字体format应该为以下值中的一个: "+c.join(",")+", 或者不设置format"),'url("'+e.url+'")'):e.format?'url("'+e.url+'") format("'+e.format+'")':'url("'+e.url+'")'})).join(",\n"),i=document.createElement("style");i.setAttribute("type","text/css"),i.appendChild(document.createTextNode('\n@font-face {\n    font-family: "'+t+'";\n    src: '+n+";\n}\n")),document.head.appendChild(i)}}]),e}());t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isIosDevice=function(){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getBackgroundImagePorperPosition=t.getImageProperPosition=t.draw=t.addImage=void 0;var n=r(103),i=r(36),o=r(130);t.addImage=function(e,t,r){var i=e.app.room.currBoard,o=e.opsManager.currPage;if(r&&void 0!==r.boardName&&void 0!==r.pageName){var a=e.app.room.getPage(r.boardName,r.pageName);a&&(o=a)}else if(r&&void 0!==r.pageName){var s=e.app.room.getPage(i.boardName,r.pageName);s&&(o=s)}if((0,n.resourceLoaded)(t)){var c=(0,n.getResource)(t),u=(null==r?void 0:r.width)?r.width:c.width,l=(null==r?void 0:r.height)?r.height:c.height;e.dispatchImage(t,u,l,o)}else(null==r?void 0:r.width)&&(null==r?void 0:r.height)?e.dispatchImage(t,null==r?void 0:r.width,null==r?void 0:r.height,o):(o.addWaitingResource(t),(0,n.fetchResource)(t,(function(n){var i=(null==r?void 0:r.width)?r.width:n.width,a=(null==r?void 0:r.height)?r.height:n.height;e.dispatchImage(t,i,a,o),o.removeWaitingResource(t)})))},t.draw=function(e,t,r,a){var s=a.page,c=a.div,u=a.preview,l=a.id,d=a.supportToDataUrl;if((0,n.resourceLoaded)(t)&&!u&&c&&l&&!(0,o.isIosDevice)()){var p=c.querySelector("[id='"+l+"']");p||((p="background"===a.type?(0,n.getResource)(t):(0,n.getResource)(t).cloneNode(!0)).id=""+l,p.style.userSelect="none",p.style.pointerEvents="none",p.style.position="absolute",p.style.imageRendering="-webkit-optimize-contrast",c.appendChild(p)),p.width=r.w,p.height=r.h,p.style.left=r.sx+"px",p.style.top=r.sy+"px";var f=(0,i.getElementPartOutOfContainer)(r,a.page.app.camera);p.style.clipPath=f?"inset("+f.top+"px "+f.right+"px "+f.bottom+"px "+f.left+"px)":"none"}else d&&(0,n.resourceLoaded)(t,!0)?e.drawImage((0,n.getResource)(t,!0),r.sx,r.sy,r.w,r.h):!d&&(0,n.resourceLoaded)(t)?e.drawImage((0,n.getResource)(t,!1),r.sx,r.sy,r.w,r.h):(0,n.resourceLoaded)("imageLoading")&&e.drawImage((0,n.getResource)("imageLoading"),r.sx+5,r.sy+5,Math.max(0,r.w-10),Math.max(0,r.h-10));(0,n.resourceLoaded)(t)||(s.addWaitingResource(t),(0,n.fetchResource)(t,(function(){s.removeWaitingResource(t)})))},t.getImageProperPosition=function(e,t,r){var n=e.app.container.width,i=e.app.container.height;return t>n&&r<i?(r=r*n/t,t=n):t<n&&r>i?(t=t*i/r,r=i):t>n&&r>i&&(t/r>n/i?(r=r*n/t,t=n):(t=t*i/r,r=i)),t/=e.app.camera.scale,r/=e.app.camera.scale,{sx:e.app.camera.centerX-t/2,sy:e.app.camera.centerY-r/2,width:t,height:r}},t.getBackgroundImagePorperPosition=function(e,t,r){return{sx:-t/2,sy:-r/2,width:t,height:r}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"subMany",value:function(e){for(var t in e)this.on(t,e[t])}},{key:"destroy",value:function(){var e=this;this.eventNames().forEach((function(t){e.removeAllListeners(t)}))}}]),t}(c(r(39)).default);t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=void 0,i=(t.transitionToCameraBound=function(e,t,r){var n=t,o=e.centerX,a=e.centerY,s=e.width,c=e.height,u=e.app.isRecordPlayer?1:15;i({total:u,worker:function(t){var r=(t+1)/u;e.setCameraBound({centerX:n.centerX*r+o*(1-r),centerY:n.centerY*r+a*(1-r),width:n.width*r+s*(1-r),height:n.height*r+c*(1-r)})},callback:r})},t.animate=function(e){cancelAnimationFrame(n),o(0,e)}),o=(t.stopTransitionToCameraBound=function(){cancelAnimationFrame(n)},function e(t,r){t>=r.total?"function"==typeof r.callback&&r.callback():n=requestAnimationFrame((function(){r.worker(t),e(t+1,r)}))})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(19)),i=s(r(14)),o=s(r(5)),a=s(r(20));function s(e){return e&&e.__esModule?e:{default:e}}t.default={isUndefined:function(e){return void 0===e},isDOM:function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,a.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,a.default)(e))&&1===e.nodeType&&"string"==typeof e.nodeName},isValidString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isFunction:function(e){return"function"==typeof e},isNumber:function(e){return"number"==typeof e},isValidArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isValidHexColor:function(e){return/^#[0-9abcdef]{6}$/gi.test(e)},isObject:function(e){return"object"===(void 0===e?"undefined":(0,a.default)(e))},isValidObject:function(e){if("object"!==(void 0===e?"undefined":(0,a.default)(e)))return!1;if(e=(0,o.default)({},e),i.default&&0===(0,i.default)(e).length)return!1;try{return"{}"!==(0,n.default)(e)}catch(e){return!1}},validate:function(e,t,r,o){var a=this,s=[];return(0,i.default)(o).map((function(e){var t=o[e],i=r[e];if(a.isUndefined(i))t.isRequire&&s.push({key:e,message:e+" is required"});else{switch(t.type.toLowerCase()){case"dom":a.isDOM(i)||s.push({key:e,message:"Expected dom, but get other type"});break;case"string":a.isValidString(i)||s.push({key:e,message:"Expected string, but get other type"});break;case"boolean":a.isBoolean(i)||s.push({key:e,message:"Expected boolean, but get other type"});break;case"function":a.isFunction(i)||s.push({key:e,message:"Expected function, but get other type"});break;case"number":a.isNumber(i)||s.push({key:e,message:"Expected number, but get other type"});break;case"object":a.isObject(i)||s.push({key:e,message:"Expected object, but get other type"});break;case"array":a.isValidArray(i)||s.push({key:e,message:"Expected array, but get other type"});break;default:s.push({key:e,message:e+"的类型未知: "+t.type.toLowerCase()})}t.enum&&-1===t.enum.indexOf(i)&&s.push({key:e,message:"Expected "+e+" to be one of "+(0,n.default)(t.enum)+", but it is not"})}})),s.length>0&&(e.error("[白板]",t+"参数异常"),e.error("[白板]","错误信息：",s),e.error("[白板]","参数为：",r)),0===s.length}}},function(e,t,r){var n=r(68).codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,r,o){if("function"==typeof r)return e(t,null,r);r||(r={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(o||i);var a=r.readable||!1!==r.readable&&t.readable,s=r.writable||!1!==r.writable&&t.writable,c=function(){t.writable||l()},u=t._writableState&&t._writableState.finished,l=function(){s=!1,u=!0,a||o.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){a=!1,d=!0,s||o.call(t)},f=function(e){o.call(t,e)},h=function(){var e;return a&&!d?(t._readableState&&t._readableState.ended||(e=new n),o.call(t,e)):s&&!u?(t._writableState&&t._writableState.ended||(e=new n),o.call(t,e)):void 0},m=function(){t.req.on("finish",l)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",l),t.on("abort",h),t.req?m():t.on("request",m)):s&&!t._writableState&&(t.on("end",c),t.on("close",c)),t.on("end",p),t.on("finish",l),!1!==r.error&&t.on("error",f),t.on("close",h),function(){t.removeListener("complete",l),t.removeListener("abort",h),t.removeListener("request",m),t.req&&t.req.removeListener("finish",l),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",l),t.removeListener("end",p),t.removeListener("error",f),t.removeListener("close",h)}}},,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.on=function(e,t,r){e.addEventListener(t,r)},t.off=function(e,t,r){e.removeEventListener(t,r)}},,,function(e,t,r){var n;r.r(t),r.d(t,"v1",(function(){return m})),r.d(t,"v3",(function(){return x})),r.d(t,"v4",(function(){return I})),r.d(t,"v5",(function(){return C})),r.d(t,"NIL",(function(){return k})),r.d(t,"version",(function(){return O})),r.d(t,"validate",(function(){return s})),r.d(t,"stringify",(function(){return p})),r.d(t,"parse",(function(){return g}));var i=new Uint8Array(16);function o(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)}for(var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,s=function(e){return"string"==typeof e&&a.test(e)},c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));var l,d,p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!s(r))throw TypeError("Stringified UUID is invalid");return r},f=0,h=0,m=function(e,t,r){var n=t&&r||0,i=t||new Array(16),a=(e=e||{}).node||l,s=void 0!==e.clockseq?e.clockseq:d;if(null==a||null==s){var c=e.random||(e.rng||o)();null==a&&(a=l=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==s&&(s=d=16383&(c[6]<<8|c[7]))}var u=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:h+1,g=u-f+(m-h)/1e4;if(g<0&&void 0===e.clockseq&&(s=s+1&16383),(g<0||u>f)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=u,h=m,d=s;var v=(1e4*(268435455&(u+=122192928e5))+m)%4294967296;i[n++]=v>>>24&255,i[n++]=v>>>16&255,i[n++]=v>>>8&255,i[n++]=255&v;var y=u/4294967296*1e4&268435455;i[n++]=y>>>8&255,i[n++]=255&y,i[n++]=y>>>24&15|16,i[n++]=y>>>16&255,i[n++]=s>>>8|128,i[n++]=255&s;for(var b=0;b<6;++b)i[n+b]=a[b];return t||p(i)},g=function(e){if(!s(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r},v=function(e,t,r){function n(e,n,i,o){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=g(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(n),a.set(e,n.length),(a=r(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,i){o=o||0;for(var s=0;s<16;++s)i[o+s]=a[s];return i}return p(a)}try{n.name=e}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n};function y(e){return 14+(e+64>>>9<<4)+1}function b(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function S(e,t,r,n,i,o){return b((a=b(b(t,e),b(n,o)))<<(s=i)|a>>>32-s,r);var a,s}function _(e,t,r,n,i,o,a){return S(t&r|~t&n,e,t,i,o,a)}function M(e,t,r,n,i,o,a){return S(t&n|r&~n,e,t,i,o,a)}function T(e,t,r,n,i,o,a){return S(t^r^n,e,t,i,o,a)}function w(e,t,r,n,i,o,a){return S(r^(t|~n),e,t,i,o,a)}var x=v("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n=0;n<r;n+=8){var i=e[n>>5]>>>n%32&255,o=parseInt("0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[y(t)-1]=t;for(var r=1732584193,n=-271733879,i=-1732584194,o=271733878,a=0;a<e.length;a+=16){var s=r,c=n,u=i,l=o;r=_(r,n,i,o,e[a],7,-680876936),o=_(o,r,n,i,e[a+1],12,-389564586),i=_(i,o,r,n,e[a+2],17,606105819),n=_(n,i,o,r,e[a+3],22,-1044525330),r=_(r,n,i,o,e[a+4],7,-176418897),o=_(o,r,n,i,e[a+5],12,1200080426),i=_(i,o,r,n,e[a+6],17,-1473231341),n=_(n,i,o,r,e[a+7],22,-45705983),r=_(r,n,i,o,e[a+8],7,1770035416),o=_(o,r,n,i,e[a+9],12,-1958414417),i=_(i,o,r,n,e[a+10],17,-42063),n=_(n,i,o,r,e[a+11],22,-1990404162),r=_(r,n,i,o,e[a+12],7,1804603682),o=_(o,r,n,i,e[a+13],12,-40341101),i=_(i,o,r,n,e[a+14],17,-1502002290),r=M(r,n=_(n,i,o,r,e[a+15],22,1236535329),i,o,e[a+1],5,-165796510),o=M(o,r,n,i,e[a+6],9,-1069501632),i=M(i,o,r,n,e[a+11],14,643717713),n=M(n,i,o,r,e[a],20,-373897302),r=M(r,n,i,o,e[a+5],5,-701558691),o=M(o,r,n,i,e[a+10],9,38016083),i=M(i,o,r,n,e[a+15],14,-660478335),n=M(n,i,o,r,e[a+4],20,-405537848),r=M(r,n,i,o,e[a+9],5,568446438),o=M(o,r,n,i,e[a+14],9,-1019803690),i=M(i,o,r,n,e[a+3],14,-187363961),n=M(n,i,o,r,e[a+8],20,1163531501),r=M(r,n,i,o,e[a+13],5,-1444681467),o=M(o,r,n,i,e[a+2],9,-51403784),i=M(i,o,r,n,e[a+7],14,1735328473),r=T(r,n=M(n,i,o,r,e[a+12],20,-1926607734),i,o,e[a+5],4,-378558),o=T(o,r,n,i,e[a+8],11,-2022574463),i=T(i,o,r,n,e[a+11],16,1839030562),n=T(n,i,o,r,e[a+14],23,-35309556),r=T(r,n,i,o,e[a+1],4,-1530992060),o=T(o,r,n,i,e[a+4],11,1272893353),i=T(i,o,r,n,e[a+7],16,-155497632),n=T(n,i,o,r,e[a+10],23,-1094730640),r=T(r,n,i,o,e[a+13],4,681279174),o=T(o,r,n,i,e[a],11,-358537222),i=T(i,o,r,n,e[a+3],16,-722521979),n=T(n,i,o,r,e[a+6],23,76029189),r=T(r,n,i,o,e[a+9],4,-640364487),o=T(o,r,n,i,e[a+12],11,-421815835),i=T(i,o,r,n,e[a+15],16,530742520),r=w(r,n=T(n,i,o,r,e[a+2],23,-995338651),i,o,e[a],6,-198630844),o=w(o,r,n,i,e[a+7],10,1126891415),i=w(i,o,r,n,e[a+14],15,-1416354905),n=w(n,i,o,r,e[a+5],21,-57434055),r=w(r,n,i,o,e[a+12],6,1700485571),o=w(o,r,n,i,e[a+3],10,-1894986606),i=w(i,o,r,n,e[a+10],15,-1051523),n=w(n,i,o,r,e[a+1],21,-2054922799),r=w(r,n,i,o,e[a+8],6,1873313359),o=w(o,r,n,i,e[a+15],10,-30611744),i=w(i,o,r,n,e[a+6],15,-1560198380),n=w(n,i,o,r,e[a+13],21,1309151649),r=w(r,n,i,o,e[a+4],6,-145523070),o=w(o,r,n,i,e[a+11],10,-1120210379),i=w(i,o,r,n,e[a+2],15,718787259),n=w(n,i,o,r,e[a+9],21,-343485551),r=b(r,s),n=b(n,c),i=b(i,u),o=b(o,l)}return[r,n,i,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(y(t)),n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))})),I=function(e,t,r){var n=(e=e||{}).random||(e.rng||o)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return p(n)};function E(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}function A(e,t){return e<<t|e>>>32-t}var C=v("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var i=0;i<n.length;++i)e.push(n.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,a=Math.ceil(o/16),s=new Array(a),c=0;c<a;++c){for(var u=new Uint32Array(16),l=0;l<16;++l)u[l]=e[64*c+4*l]<<24|e[64*c+4*l+1]<<16|e[64*c+4*l+2]<<8|e[64*c+4*l+3];s[c]=u}s[a-1][14]=8*(e.length-1)/Math.pow(2,32),s[a-1][14]=Math.floor(s[a-1][14]),s[a-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<a;++d){for(var p=new Uint32Array(80),f=0;f<16;++f)p[f]=s[d][f];for(var h=16;h<80;++h)p[h]=A(p[h-3]^p[h-8]^p[h-14]^p[h-16],1);for(var m=r[0],g=r[1],v=r[2],y=r[3],b=r[4],S=0;S<80;++S){var _=Math.floor(S/20),M=A(m,5)+E(_,g,v,y)+b+t[_]+p[S]>>>0;b=y,y=v,v=A(g,30)>>>0,g=m,m=M}r[0]=r[0]+m>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+v>>>0,r[3]=r[3]+y>>>0,r[4]=r[4]+b>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),k="00000000-0000-0000-0000-000000000000",O=function(e){if(!s(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},function(e,t,r){r(144),e.exports=r(6).Number.isInteger},function(e,t,r){var n=r(8);n(n.S,"Number",{isInteger:r(145)})},function(e,t,r){var n=r(15),i=Math.floor;e.exports=function(e){return!n(e)&&isFinite(e)&&i(e)===e}},function(e,t,r){r(147),e.exports=r(6).Object.assign},function(e,t,r){var n=r(8);n(n.S+n.F,"Object",{assign:r(148)})},function(e,t,r){var n=r(17),i=r(46),o=r(63),a=r(61),s=r(34),c=r(75),u=Object.assign;e.exports=!u||r(28)((function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=u({},e)[r]||Object.keys(u({},t)).join("")!=n}))?function(e,t){for(var r=s(e),u=arguments.length,l=1,d=o.f,p=a.f;u>l;)for(var f,h=c(arguments[l++]),m=d?i(h).concat(d(h)):i(h),g=m.length,v=0;g>v;)f=m[v++],n&&!p.call(h,f)||(r[f]=h[f]);return r}:u},function(e,t,r){var n=r(30),i=r(59),o=r(150);e.exports=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),l=o(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}}},function(e,t,r){var n=r(77),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},function(e,t,r){e.exports={default:r(152),__esModule:!0}},function(e,t,r){r(37),r(43),e.exports=r(64).f("iterator")},function(e,t,r){var n=r(77),i=r(76);e.exports=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},function(e,t,r){var n=r(62),i=r(45),o=r(50),a={};r(27)(a,r(11)("iterator"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n(a,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t,r){var n=r(156),i=r(109),o=r(40),a=r(30);e.exports=r(81)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t,r){r(122),r(66),r(160),r(161),e.exports=r(6).Symbol},function(e,t,r){var n=r(46),i=r(63),o=r(61);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var a,s=r(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,r){var n=r(30),i=r(91).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},function(e,t,r){r(83)("asyncIterator")},function(e,t,r){r(83)("observable")},function(e,t,r){var n=r(23),i=r(58),o=r(11)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||null==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n,i,o,a=r(26),s=r(247),c=r(121),u=r(89),l=r(12),d=l.process,p=l.setImmediate,f=l.clearImmediate,h=l.MessageChannel,m=l.Dispatch,g=0,v={},y=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){y.call(e.data)};p&&f||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return v[++g]=function(){s("function"==typeof e?e:Function(e),t)},n(g),g},f=function(e){delete v[e]},"process"==r(53)(d)?n=function(e){d.nextTick(a(y,e,1))}:m&&m.now?n=function(e){m.now(a(y,e,1))}:h?(o=(i=new h).port2,i.port1.onmessage=b,n=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):n="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),y.call(e)}}:function(e){setTimeout(a(y,e,1),0)}),e.exports={set:p,clear:f}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(23),i=r(15),o=r(123);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(6),i=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,r){r(168);var n=r(6).Object;e.exports=function(e,t,r){return n.defineProperty(e,t,r)}},function(e,t,r){var n=r(8);n(n.S+n.F*!r(17),"Object",{defineProperty:r(16).f})},function(e,t,r){r(170),e.exports=r(6).Object.keys},function(e,t,r){var n=r(34),i=r(46);r(94)("keys",(function(){return function(e){return i(n(e))}}))},function(e,t,r){r(66),r(37),r(43),r(172),r(176),r(178),r(179),e.exports=r(6).Set},function(e,t,r){var n=r(113),i=r(85);e.exports=r(114)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},function(e,t,r){var n=r(26),i=r(75),o=r(34),a=r(59),s=r(174);e.exports=function(e,t){var r=1==e,c=2==e,u=3==e,l=4==e,d=6==e,p=5==e||d,f=t||s;return function(t,s,h){for(var m,g,v=o(t),y=i(v),b=n(s,h,3),S=a(y.length),_=0,M=r?f(t,S):c?f(t,0):void 0;S>_;_++)if((p||_ in y)&&(g=b(m=y[_],_,v),e))if(r)M[_]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return _;case 2:M.push(m)}else if(l)return!1;return d?-1:u||l?l:M}}},function(e,t,r){var n=r(175);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(15),i=r(110),o=r(11)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(8);n(n.P+n.R,"Set",{toJSON:r(115)("Set")})},function(e,t,r){var n=r(51);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},function(e,t,r){r(116)("Set")},function(e,t,r){r(117)("Set")},function(e,t,r){r(43),r(37),e.exports=r(181)},function(e,t,r){var n=r(23),i=r(84);e.exports=r(6).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},function(e,t,r){r(37),r(183),e.exports=r(6).Array.from},function(e,t,r){var n=r(26),i=r(8),o=r(34),a=r(111),s=r(112),c=r(59),u=r(126),l=r(84);i(i.S+i.F*!r(125)((function(e){Array.from(e)})),"Array",{from:function(e){var t,r,i,d,p=o(e),f="function"==typeof this?this:Array,h=arguments.length,m=h>1?arguments[1]:void 0,g=void 0!==m,v=0,y=l(p);if(g&&(m=n(m,h>2?arguments[2]:void 0,2)),null==y||f==Array&&s(y))for(r=new f(t=c(p.length));t>v;v++)u(r,v,g?m(p[v],v):p[v]);else for(d=y.call(p),r=new f;!(i=d.next()).done;v++)u(r,v,g?a(d,m,[i.value,v],!0):i.value);return r.length=v,r}})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.min=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return Math.min(e,t)}))},t.max=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return Math.max(e,t)}))}},function(e,t,r){var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=r(38),l=new(function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,r=e.onResult,n=e.resultReturns,i=e.onDone,o=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,r){return t(r)},onResult:function(e,t,n){return"if("+t+" !== undefined) {\n"+r(t)+";\n} else {\n"+n()+"}\n"},resultReturns:n,onDone:i,rethrowIfPossible:o})}}]),t}(r(42))),d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncBailHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncBailHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(u);e.exports=d},function(e,t,r){r(187),e.exports=r(6).Object.getPrototypeOf},function(e,t,r){var n=r(34),i=r(90);r(94)("getPrototypeOf",(function(){return function(e){return i(n(e))}}))},function(e,t,r){r(189),e.exports=r(6).Object.setPrototypeOf},function(e,t,r){var n=r(8);n(n.S,"Object",{setPrototypeOf:r(190).set})},function(e,t,r){var n=r(15),i=r(23),o=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=r(26)(Function.call,r(71).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return o(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:o}},function(e,t,r){r(192);var n=r(6).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){var n=r(8);n(n.S,"Object",{create:r(62)})},function(e,t,r){r(66),r(37),r(43),r(194),r(195),r(196),r(197),e.exports=r(6).Map},function(e,t,r){var n=r(113),i=r(85);e.exports=r(114)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},function(e,t,r){var n=r(8);n(n.P+n.R,"Map",{toJSON:r(115)("Map")})},function(e,t,r){r(116)("Map")},function(e,t,r){r(117)("Map")},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(41)),i=m(r(5)),o=m(r(2)),a=m(r(0)),s=m(r(1)),c=m(r(3)),u=m(r(4)),l=r(18),d=m(r(87)),p=m(r(48)),f=r(273),h=r(96);function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(){(0,a.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="pen",e.description="涂鸦操作工具。\n首先使用op:pen:activate设置画布为涂鸦模式。通过op:pen:lineWidth, op:pen:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,u.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){var t=this.points,r=this.opsManager.currPage.getOpId(),n=this.app.room.opIdSnapshotMap[r];if(!n||!n.snapshot.hasOwnProperty("category"))return(0,i.default)({points:t.slice(),total:t.length},this.getFreeDrawCommonProperty({inProgress:e}));var o={boundary:this.getBoundaryRectOfFreeDraw()};return this.sampleSeq>0&&e?(0,i.default)((0,i.default)({},o),{points:t.slice(t.length-p.default.pointsPerBatch),total:t.length}):this.sampleSeq>0?(0,i.default)((0,i.default)({},o),{points:t.slice(t.length-p.default.pointsPerBatch),total:t.length,inProgress:e}):(0,i.default)({points:t.slice(),total:t.length},this.getFreeDrawCommonProperty({inProgress:e}))}},{key:"_draw",value:function(e,t){var r=e.data,n=r.points.map((function(e){return e?(0,l.getTransformedPoint)(e,r.dx,r.dy,r.scaleX,r.scaleY):e}));return(0,f.drawCurve)(t,n,.5),n}},{key:"draw",value:function(e,t){var r=e.data;this._draw(e,t),this.strokeOrFill(t,{stroke:r.color,lineWidth:r.lineWidth,opacity:r.opacity})}},{key:"ifMouseOnOp",value:function(e,t,r){var n=this.app.container.ctx;return this._draw(e,n),n.lineWidth=e.data.lineWidth+20,n.strokeStyle="rgba(0,0,0,0)",n.stroke(),n.isPointInStroke(t,r)}},{key:"mergePartial",value:function(e,t){var r=this._mergePartial(e,t);return r.data.points.length!==r.data.total&&this.logger.warn("merge ........",e,t),r}},{key:"_mergePartial",value:function(e,t){try{var r=t.data.total-e.data.total;if(0===r)return(0,i.default)((0,i.default)({},e),{data:(0,i.default)((0,i.default)((0,i.default)({},e.data),t.data),{points:e.data.points})});if(r<0){var o=t.data.total-t.data.points.length,a=t.data.total;return(0,i.default)((0,i.default)({},e),{data:(0,i.default)((0,i.default)((0,i.default)({},e.data),t.data),{total:e.data.total,boundary:e.data.boundary,points:[].concat((0,n.default)(e.data.points.slice(0,o)),(0,n.default)(t.data.points),(0,n.default)(e.data.points.slice(a)))})})}if(r<=t.data.points.length){var s=t.data.points.length-r;return(0,i.default)((0,i.default)({},e),{data:(0,i.default)((0,i.default)((0,i.default)({},e.data),t.data),{points:e.data.points.concat(t.data.points.slice(s))})})}var c=r-t.data.points.length;return(0,i.default)((0,i.default)({},e),{data:(0,i.default)((0,i.default)((0,i.default)({},e.data),t.data),{points:[].concat((0,n.default)(e.data.points),(0,n.default)(new Array(c)),(0,n.default)(t.data.points))})})}catch(r){return h.LOG&&this.logger.warn("[白板] mergePartial error",e,t),e}}}]),t}(d.default);t.default=g},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMi41Mzg2IDIuNDYwMzRDMTMuMTUyNCAxLjg0NjU2IDE0LjE0NzUgMS44NDY1NSAxNC43NjEzIDIuNDYwMzRMMTcuNTM5NyA1LjIzODcxQzE4LjE1MzQgNS44NTI0OSAxOC4xNTM0IDYuODQ3NjIgMTcuNTM5NyA3LjQ2MTRMNy44MDEyMiAxNy4xOTk4QzcuNTQyMjIgMTcuNDU4OCA3LjIwMDkgMTcuNjE5MiA2LjgzNjIyIDE3LjY1MzRMMy4xODEyNyAxNy45OTUyQzIuNTA3MTMgMTguMDU4MiAxLjk0MTc2IDE3LjQ5MjkgMi4wMDQ4MSAxNi44MTg3TDIuMzQ2NjQgMTMuMTYzOEMyLjM4MDc1IDEyLjc5OTEgMi41NDExNSAxMi40NTc4IDIuODAwMTUgMTIuMTk4OEwxMi41Mzg2IDIuNDYwMzRaTTEzLjkyNzggMy4yOTM4NUMxMy43NzQzIDMuMTQwNCAxMy41MjU2IDMuMTQwNCAxMy4zNzIxIDMuMjkzODVMMy42MzM2NiAxMy4wMzIzQzMuNTY4OTEgMTMuMDk3IDMuNTI4ODEgMTMuMTgyNCAzLjUyMDI4IDEzLjI3MzVMMy4xODk0OSAxNi44MTA1TDYuNzI2NDYgMTYuNDc5N0M2LjgxNzYzIDE2LjQ3MTIgNi45MDI5NiAxNi40MzExIDYuOTY3NyAxNi4zNjYzTDE2LjcwNjIgNi42Mjc4OUMxNi44NTk2IDYuNDc0NDUgMTYuODU5NiA2LjIyNTY2IDE2LjcwNjIgNi4wNzIyMkwxMy45Mjc4IDMuMjkzODVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjYyMjQgOS41NDUxOEwxMC40NTQ4IDUuMzc3NjJMMTEuMjg4MyA0LjU0NDExTDE1LjQ1NTkgOC43MTE2N0wxNC42MjI0IDkuNTQ1MThaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(41)),i=l(r(2)),o=l(r(0)),a=l(r(1)),s=l(r(3)),c=l(r(4)),u=r(18);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="line",e.description="绘制线段。\n首先使用op:line:activate设置画布为线段模式。通过op:line:lineWidth, op:line:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({inProgress:e})}},{key:"getBoundaryRect",value:function(){return this.getBoundaryRectOfLine()}},{key:"draw",value:function(e,t){var r=e.data,i=this.getStartEndPointFromSnapshot(r),o=i.sp,a=i.ep;t.beginPath(),t.moveTo.apply(t,(0,n.default)((0,u.getTransformedPoint)(o,r.dx,r.dy,r.scaleX,r.scaleY))),t.lineTo.apply(t,(0,n.default)((0,u.getTransformedPoint)(a,r.dx,r.dy,r.scaleX,r.scaleY))),this.strokeOrFill(t,{stroke:r.color,lineWidth:r.lineWidth,opacity:r.opacity})}},{key:"ifMouseOnOp",value:function(e,t,r){var i=this.app.container.ctx,o=e.data,a=this.getStartEndPointFromSnapshot(o),s=a.sp,c=a.ep;return i.beginPath(),i.moveTo.apply(i,(0,n.default)((0,u.getTransformedPoint)(s,o.dx,o.dy,o.scaleX,o.scaleY))),i.lineTo.apply(i,(0,n.default)((0,u.getTransformedPoint)(c,o.dx,o.dy,o.scaleX,o.scaleY))),i.strokeStyle="rgba(0,0,0,0)",i.lineWidth=o.lineWidth+20,i.stroke(),i.isPointInStroke(t,r)}},{key:"getStartEndPointFromSnapshot",value:function(e){var t=void 0,r=void 0;return Array.isArray(e.points)?(t=e.points[0],r=e.points[e.points.length-1]):(t=e.sp,r=e.ep),{sp:t,ep:r}}}]),t}(l(r(87)).default);t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=d(r(10)),u=r(36),l=d(r(48));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.points=[],e.lastSelectedOpIds=[],e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"postMouseUp",value:function(e){}},{key:"postClick",value:function(e){}},{key:"postMouseMove",value:function(e,t){}},{key:"handleMouseDown",value:function(e,t,r){t=Number(t.toFixed(1)),r=Number(r.toFixed(1)),this.dispatch(this.getSelectionSnapshot(!1,[])),this.points=[[t,r]];var n=(0,u.findOpsUnderMouse)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage,this.opsManager);this.dispatch(this.getSelectionSnapshot(!0,n)),this.lastSelectedOpIds=n}},{key:"handleMouseMove",value:function(e,t,r){t=Number(t.toFixed(1)),r=Number(r.toFixed(1)),this.isMouseDown?this.points.push([t,r]):this.points=[[t,r]];var n=void 0;if(this.isMouseDown)n=(0,u.findOpsUnderRect)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage),this.dispatch(this.getSelectionSnapshot(!0,n));else{var i=(0,u.findOpsUnderMouse)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage,this.opsManager);n=(0,u.arrayDeduce)(i,this.opsManager.selectedOpIds),(0,u.idsChanged)(n,this.lastSelectedOpIds)&&this.dispatch(this.getSelectionSnapshot(!0,n,!0))}this.lastSelectedOpIds=n,this.postMouseMove(e,n)}},{key:"handleMouseUp",value:function(e,t,r){if(this.isMouseDown){t=Number(t.toFixed(1)),r=Number(r.toFixed(1));var n=this.isMouseDown?(0,u.findOpsUnderRect)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage):(0,u.findOpsUnderMouse)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage,this.opsManager);this.postMouseUp(n)}}},{key:"handleClick",value:function(e,t,r){t=Number(t.toFixed(2)),r=Number(r.toFixed(2)),this.points=[[t,r]];var n=(0,u.findOpsUnderMouse)(this.app.camera.zoomFactor,this.points,this.drawOpsOfPage,this.opsManager);this.postClick(n)}},{key:"getSelectionSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{type:"select",sp:this.sp,ep:this.ep,inProgress:e,selectedOpIds:t.slice(),reuseOpType:r?"select-hover":"select",skipUndo:!0,color:l.default.strokeColor,nickname:this.app.nickname}}},{key:"sp",get:function(){return this.points.length>0?this.points[0]:void 0}},{key:"ep",get:function(){return this.points.length>0?this.points[this.points.length-1]:void 0}}]),t}(c.default);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(2)),i=u(r(0)),o=u(r(1)),a=u(r(3)),s=u(r(4)),c=r(18);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="rect",e.shouldSaniteEp=!0,e.description="绘制矩形。\n首先使用op:rect:activate设置画布为矩形模式。通过op:rect:lineWidth, op:rect:stroke, op:rect:fill设置矩形的宽度和颜色。然后画布会监听鼠标动作，生成矩形。具体用法如下：",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({strokeOrFill:"stroke",inProgress:e})}},{key:"draw",value:function(e,t){var r=e.data,n=(0,c.getTransformedPoint)(r.sp,r.dx,r.dy,r.scaleX,r.scaleY),i=(0,c.getTransformedPoint)(r.ep,r.dx,r.dy,r.scaleX,r.scaleY);t.beginPath(),t.rect(n[0],n[1],i[0]-n[0],i[1]-n[1]),this.strokeOrFill(t,{stroke:r.stroke,fill:r.fill,lineWidth:r.lineWidth,opacity:r.opacity})}}]),t}(u(r(87)).default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(2)),i=u(r(0)),o=u(r(1)),a=u(r(3)),s=u(r(4)),c=r(18);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="ellipse",e.shouldSaniteEp=!0,e.description="绘制椭圆形",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({strokeOrFill:"stroke",inProgress:e})}},{key:"draw",value:function(e,t){var r=e.data,n=(0,c.getTransformedPoint)(r.sp,r.dx,r.dy,r.scaleX,r.scaleY),i=(0,c.getTransformedPoint)(r.ep,r.dx,r.dy,r.scaleX,r.scaleY),o=n[0]/2+i[0]/2,a=n[1]/2+i[1]/2,s=Math.abs(i[0]-n[0])/2,u=Math.abs(i[1]-n[1])/2;t.beginPath(),t.ellipse(o,a,s,u,0,0,2*Math.PI,!0),this.strokeOrFill(t,{stroke:r.stroke,fill:r.fill,lineWidth:r.lineWidth,opacity:r.opacity})}},{key:"ifMouseOnOp",value:function(e,t,r){var n=this.app.container.ctx,i=e.data,o=(0,c.getTransformedPoint)(i.sp,i.dx,i.dy,i.scaleX,i.scaleY),a=(0,c.getTransformedPoint)(i.ep,i.dx,i.dy,i.scaleX,i.scaleY),s=o[0]/2+a[0]/2,u=o[1]/2+a[1]/2,l=Math.abs(a[0]-o[0])/2,d=Math.abs(a[1]-o[1])/2;return n.beginPath(),n.ellipse(s,u,l,d,0,0,2*Math.PI,!0),n.fillStyle="rgba(0,0,0,0)",n.fill(),n.isPointInPath(t,r)}}]),t}(u(r(87)).default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.MIN_FONT_SIZE=t.MAX_FONT_SIZE=t.printTextInMultiLine=void 0;var n,i=(n=r(9))&&n.__esModule?n:{default:n};t.testFontSizeText=function(e){var t=Number(e);return isNaN(t)?"nan":t>o?"exceed_max":t<=a?"exceed_min":"valid"},t.printTextInMultiLine=function(e,t,r,n,o){var a=t.split(/\r?\n/g),s=0,c=!0,u=!1,l=void 0;try{for(var d,p=(0,i.default)(a);!(c=(d=p.next()).done);c=!0){var f=d.value;e.fillText(f,r,n+o*s),s++}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}};var o=t.MAX_FONT_SIZE=999,a=t.MIN_FONT_SIZE=12},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,o=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?r+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(0)),i=a(r(1)),o=a(r(207));function a(e){return e&&e.__esModule?e:{default:e}}var s=void 0,c=function(){function e(){(0,n.default)(this,e)}return(0,i.default)(e,null,[{key:"createInstance",value:function(){return this._instance=this._instance||new o.default,this._instance}},{key:"show",value:function(e){var t=this,r=e.time,n=void 0===r?3:r;this._instance||this.createInstance(),this._instance.show(e),s&&clearTimeout(s),n&&(s=setTimeout((function(){t.hide()}),1e3*n))}},{key:"hide",value:function(){s&&clearTimeout(s),this._instance&&this._instance.hide()}},{key:"destory",value:function(){this._instance&&(this._instance.destroy(),this._instance=null)}}]),e}();t.default=c,c._instance=null},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(70)),i=a(r(0)),o=a(r(1));function a(e){return e&&e.__esModule?e:{default:e}}r(208);var s=function(){function e(){(0,i.default)(this,e),this.toastDiv=document.createElement("div"),this.toastDiv.className="whiteboard-toast",this.toastDiv.onclick=this.hide.bind(this),document.body.appendChild(this.toastDiv)}return(0,o.default)(e,[{key:"show",value:function(e){var t=this.toastDiv;t.style.display="block","warn"===e.type?(t.style.color="#8a6d3b",t.style.backgroundColor="#fcf8e3",t.style.borderColor="#faebcc"):"info"===e.type?(t.style.color="#31708f",t.style.backgroundColor="#d9edf7",t.style.borderColor="#bce8f1"):"error"===e.type?(t.style.color="#a94442",t.style.backgroundColor="#f2dede",t.style.borderColor="#ebccd1"):(t.style.color="#3c763d",t.style.backgroundColor="#dff0d8",t.style.borderColor="#d6e9c6"),(0,n.default)(e.top)&&(t.style.top=e.top+"px"),t.innerHTML=e.msg}},{key:"hide",value:function(){this.toastDiv&&(this.toastDiv.style.display="none")}},{key:"destroy",value:function(){this.toastDiv&&(document.body.removeChild(this.toastDiv),this.toastDiv=null)}}]),e}();t.default=s},function(e,t,r){var n=r(209);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".whiteboard-toast {\n    display: none;\n    position: fixed;\n    left: 50%;\n    transform: translate(-50%);\n    top: 200px;\n    padding: 8px 15px;\n    margin-bottom: 20px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    color: #3c763d;\n    background-color: #dff0d8;\n    border-color: #d6e9c6;\n    z-index: 100;\n}",""])},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTIiIHk9IjEuNDQyMjkiIHdpZHRoPSI4LjM4OTY3IiBoZWlnaHQ9IjE0LjY4MTkiIHJ4PSIxIiB0cmFuc2Zvcm09InJvdGF0ZSg0NSAxMiAxLjQ0MjI5KSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuNTg0NSA4Ljg1Nzc5TDEwLjUxNjkgMTQuNzkwMiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTQuMjI0NjQgMTcuNjgxOEgxNS43NjA0IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=v(r(35)),i=v(r(5)),o=v(r(2)),a=v(r(0)),s=v(r(1)),c=v(r(3)),u=v(r(4)),l=v(r(10)),d=r(18),p=r(103),f=r(131),h=r(36),m=v(r(309)),g=v(r(322));function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(){(0,a.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.mediaPlugins={},e.description="多媒体文件类操作",e}return(0,u.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.app.on("event:deletePage",this.handleDeletePage.bind(this))}},{key:"handleDeletePage",value:function(e){if(e)for(var t in e.drawOpQueue)this.mediaPlugins.hasOwnProperty(t)&&(this.mediaPlugins[t].destroy(),delete this.mediaPlugins[t])}},{key:"destroy",value:function(){for(var e in this.mediaPlugins)this.mediaPlugins[e].destroy(),delete this.mediaPlugins[e]}},{key:"getMediaPluginByType",value:function(e){return"video"===e?m.default:g.default}},{key:"addMedia",value:function(e,t){var r=this,n=this.app.room.currBoard,i=this.opsManager.currPage;if(t&&void 0!==t.boardName&&void 0!==t.pageName){var o=this.app.room.getPage(t.boardName,t.pageName);o&&(i=o)}else if(t&&void 0!==t.pageName){var a=this.app.room.getPage(n.boardName,t.pageName);a&&(i=a)}if((0,p.mediaResourceLoaded)(e,this.type)){var s=(0,p.getMediaResource)(e),c=this.getMediaPluginByType(this.type).getElementWidth(t.width,s),u=this.getMediaPluginByType(this.type).getElementHeight(c,s);this.dispatchMedia({url:e,title:t.title,width:c,height:u,page:i,sourceType:t.sourceType})}else i.addWaitingResource(e),(0,p.fetchMediaResource)(e,t.sourceType,this.type,(function(n){var o=r.getMediaPluginByType(r.type).getElementWidth(t.width,n),a=r.getMediaPluginByType(r.type).getElementHeight(o,n);r.dispatchMedia({url:e,title:t.title,width:o,height:a,page:i,sourceType:t.sourceType}),i.removeWaitingResource(e)}))}},{key:"dispatchMedia",value:function(e){var t=(0,f.getImageProperPosition)(this,e.width,e.height),r=t.sx,n=t.sy,o=t.width,a=t.height,s={};"audio"===this.type&&(s.fixRealWorldHeight=g.default.getElementHeight()),e.page?this.dispatchFromPage({type:this.type,url:e.url,skipUndo:!1,title:e.title?e.title:"",sourceType:e.sourceType,boundary:(0,i.default)({w:o,h:a,sx:r,sy:n},s)},e.page):this.dispatch({type:this.type,url:e.url,skipUndo:!1,title:e.title?e.title:"",sourceType:e.sourceType,boundary:(0,i.default)({w:o,h:a,sx:r,sy:n},s)})}},{key:"preview",value:function(){}},{key:"draw",value:function(e,t,r){if(!this.mediaPlugins[e.opId]){var i=this.getMediaPluginByType(e.data.type);this.mediaPlugins[e.opId]=new i(e,this.app,this)}var o=this.mediaPlugins[e.opId],a=e.data,s=(0,d.getTransformedBoundary)(this.app.camera.scale,a.boundary,a.dx,a.dy,a.scaleX,a.scaleY),c=this.app.container.el,u=a.url;if((0,p.mediaResourceLoaded)(u,this.type)&&c){var l=c.querySelector("[id='"+e.opId+"']");l||((l=document.createElement("div")).style.position="fixed",l.id=""+e.opId,l.className="video-plugin-container",c.insertBefore(l,this.app.container.imageEl),o.mountElement(l,u));var f=this.app.camera.convertWorldPointInContainer(s.sx,s.sy),h=(0,n.default)(f,2),m=h[0],g=h[1],v=this.app.camera.convertWorldPointInContainer(s.sx+s.w,s.sy+s.h),y=(0,n.default)(v,2),b=y[0],S=y[1];l.style.width=b-m+"px",l.style.height=S-g+"px",l.style.left=m+this.app.container.left+"px",l.style.top=g+this.app.container.top+"px",o.onReceiveAttributes(e),o.onSizeChange({width:b-m,height:S-g})}var _=e.data.sourceType;(0,p.mediaResourceLoaded)(u,this.type)||(r.page.addWaitingResource(u),(0,p.fetchMediaResource)(u,_,this.type,(function(){r.page.removeWaitingResource(u)})))}},{key:"hide",value:function(e,t,r){var n=this.mediaPlugins[e.opId];n&&(n.destroy(),delete this.mediaPlugins[e.opId])}},{key:"transformOp",value:function(e,t){return(0,h.transformPropertyOverwriteOp)(e,t)}}]),t}(l.default);t.default=y},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(5)),i=a(r(0)),o=a(r(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{emitEvent:!0};(0,i.default)(this,e),this.isDragging=!1,this.lastPercent=0,this.onMouseDown=function(e){e.stopPropagation(),e.preventDefault(),t.isDragging=!0,t.lastPercent=-1,t.onMouseMove(e)},this.onMouseMove=function(e){if(t.isDragging){e.stopPropagation(),e.preventDefault();var r=t.getPercent(e);t.lastPercent=r,t.seekListener&&t.seekListener(r,!0),t.updateProgress(r)}},this.onMouseUp=function(e){if(t.isDragging){e.stopPropagation(),e.preventDefault();var r=t.lastPercent;t.updateProgress(r),t.seekListener&&t.seekListener(r,!1)}t.isDragging=!1},this.getPercent=function(e){var r=0,n=t.widget.getBoundingClientRect().left;r=e.type.search(/mouse|click/)>-1?e.clientX-n:e.touches[0].clientX-n;var i=t.widget.offsetWidth;return r<0&&(r=0),r>i&&(r=i),r/i};var a=document.createElement("div");(0,n.default)(a.style,{flex:"auto",height:"4px",position:"relative",pointerEvents:o.emitEvent?"auto":"none",cursor:o.emitEvent?"pointer":"auto"});var s=document.createElement("div"),c=document.createElement("div");a.appendChild(s),a.appendChild(c);var u={height:"100%",position:"absolute",top:"50%",transform:"translateY(-50%)"};(0,n.default)(s.style,(0,n.default)({width:"100%",backgroundColor:"rgb(0,0,0)"},u)),(0,n.default)(c.style,(0,n.default)({width:100*r+"%",backgroundColor:"rgb(255,255,255)"},u)),this.widget=a,this.frontBar=c,o.emitEvent&&this.bindEvents()}return(0,o.default)(e,[{key:"addSeekListener",value:function(e){this.seekListener=e}},{key:"bindEvents",value:function(){this.widget.addEventListener("mousedown",this.onMouseDown),this.widget.addEventListener("touchstart",this.onMouseDown),window.document.addEventListener("mousemove",this.onMouseMove),window.document.addEventListener("touchmove",this.onMouseMove),window.document.addEventListener("mouseup",this.onMouseUp),window.document.addEventListener("touchend",this.onMouseUp)}},{key:"destroy",value:function(){this.widget.removeEventListener("mousedown",this.onMouseDown),this.widget.removeEventListener("touchstart",this.onMouseDown),window.document.removeEventListener("mousemove",this.onMouseMove),window.document.removeEventListener("touchmove",this.onMouseMove),window.document.removeEventListener("mouseup",this.onMouseUp),window.document.removeEventListener("touchend",this.onMouseUp),this.seekListener=void 0}},{key:"updateProgress",value:function(e){this.lastPercent=e,this.frontBar.style.width=100*e+"%"}}]),e}();t.default=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=S(r(5)),i=S(r(21)),o=S(r(2)),a=S(r(0)),s=S(r(1)),c=S(r(3)),u=S(r(4)),l=S(r(13)),d=r(103),p=S(r(312)),f=S(r(214)),h=S(r(313)),m=S(r(314)),g=S(r(315));r(316);var v=r(319),y=r(215),b=r(130);function S(e){return e&&e.__esModule?e:{default:e}}var _=function(e,t,r,n){return new(r||(r=l.default))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},M=function(e){return new l.default((function(t){return setTimeout(t,e)}))},T=(0,b.isIosDevice)(),w=function(e){function t(){(0,a.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.selfMute=!T,e.count=0,e.lastTimeCalibrateCheck=null,e.isWaiting=!1,e.onPageInVisible=function(){e.media&&e.media.pause()},e.onPageVisible=function(){e.boardName===e.app.room.currIndex&&e.pageName===e.app.room.currBoard.currIndex.toString()&&e.setNativeInitState()},e.onContainerMouseOver=function(){var t;null===(t=e.mediaDiv)||void 0===t||t.classList.add("visible")},e.onContainerMouseMove=function(){var t;clearTimeout(e.mediaDivHideTimer),e.mediaDivHideTimer=void 0,null===(t=e.mediaDiv)||void 0===t||t.classList.add("visible")},e.onContainerMouseLeave=function(){e.mediaDivHideTimer||(e.mediaDivHideTimer=setTimeout((function(){var t;null===(t=e.mediaDiv)||void 0===t||t.classList.remove("visible"),e.mediaDivHideTimer=void 0}),1500))},e.onMediaWait=function(){e.isWaiting=!0},e.onMediaCanPlay=function(){clearTimeout(e.canPlayTimer),e.canPlayTimer=setTimeout((function(){if(e.isWaiting&&e.media){e.isWaiting=!1;var t=e.getCurrTimeFromData(e.data);Math.abs(t-e.media.currentTime)>1.5&&e.setNativeCurrTime(e.data)}}),30)},e.onDurationChange=function(){e.media&&(e.duration=e.media.duration,e.updateTimeLabel(e.data.seek))},e.onTimeUpdate=function(){var t;if(e.media){e.updateTimeLabel(e.media.currentTime),"number"!=typeof e.duration||isNaN(e.duration)||null===(t=e.progressController)||void 0===t||t.updateProgress(e.media.currentTime/e.duration);var r=e.getNtpTime();if(null===e.lastTimeCalibrateCheck||r-e.lastTimeCalibrateCheck>5e3){var n=e.getCurrTimeFromData(e.data);Math.abs(n-e.media.currentTime)>1.2&&e.setNativeCurrTime(e.data),e.lastTimeCalibrateCheck=r}}},e.onMediaEnd=function(){if(e.isCreator()&&!e.isInReplay()&&e.media&&e.duration){var t=e.media.currentTime-e.duration;e.count<100&&(e.count++,console.warn("media end","video time",e.media.currentTime,"duration",e.duration),console.warn("")),Math.abs(t)<1&&e.putAttributes({ended:!0,seek:"number"==typeof e.duration?e.duration:0,play:!1})}},e.onPlayClick=function(t){t.stopPropagation(),t.preventDefault(),e.media&&(e.data.ended?e.onNativePlayChange(!0,0):e.onNativePlayChange(!e.data.play,e.media.currentTime))},e.onDeleteClick=function(t){t.stopPropagation(),t.preventDefault(),e.app.deleteElementByOpIds([e.opId])},e.onSelfMuteClick=function(){e.selfMute=!e.selfMute,e.updateSelfMute()},e.eventStopPropagation=function(e){e.stopPropagation()},e.setNativeInitState=function(){return _(e,void 0,void 0,i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.data.hasOwnProperty("play")&&this.setNativePlayState(this.data.play),!this.data.hasOwnProperty("seek")){e.next=6;break}if(!T){e.next=5;break}return e.next=5,M(300);case 5:this.setNativeCurrTime(this.data);case 6:case"end":return e.stop()}}),e,this)})))},e.onNativePlayChange=function(t,r){e.isCreator()&&!e.isInReplay()&&e.putAttributes({play:t,seek:r,seekTime:e.getNtpTime()/1e3,ended:!1})},e.onNativeSeek=function(t){e.isCreator()&&!e.isInReplay()&&e.putAttributes({seek:t,seekTime:e.getNtpTime()/1e3})},e.setNativePlayState=function(t){return _(e,void 0,void 0,i.default.mark((function e(){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.media,this.updatePlayIcon("boolean"==typeof t&&t),!t||!r){e.next=15;break}return e.prev=3,e.next=6,r.play();case 6:e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(3),""+e.t0.name!="NotAllowedError"&&""+e.t0.name!="AbortError"){e.next=13;break}return e.next=13,r.play();case 13:e.next=18;break;case 15:if(!r){e.next=18;break}return e.next=18,r.pause();case 18:case"end":return e.stop()}}),e,this,[[3,8]])})))},e.getTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=function(e){return e<10?"0"+e:""+e},n=(e=~~e)%60,i=(e=~~((e-=n)/60))%60,o=~~(e/60);return 0===o&&!1===t?r(i)+":"+r(n):o+":"+r(i)+":"+r(n)},e}return(0,u.default)(t,e),(0,s.default)(t,[{key:"getNtpTime",value:function(){return Date.now()+this.ntpTimeDiff}},{key:"mountElement",value:function(e,t){var r=(0,d.getMediaResource)(t).cloneNode(!0);e.appendChild(this.createHeader()),e.appendChild(r),e.className="neteaseyunxin-wb-media-container "+this.type,r.preload="metadata",(0,n.default)(r.style,{userSelect:"none",width:"100%",height:"100%",pointerEvents:"none"}),r.controls=!1,r.playsInline=!0,r.disablePictureInPicture=!0,r.muted=this.selfMute,this.duration=r.duration,this.media=r,e.appendChild(this.createControllor()),this.mediaDiv=e,this.addContainerListener(),this.addMediaListener(),this.setNativeInitState(),"function"==typeof this.unregisterVisibleChangeListener&&this.unregisterVisibleChangeListener(),this.unregisterVisibleChangeListener=(0,y.registerVisibleChangeHandler)(this.onPageVisible,this.onPageInVisible)}},{key:"onPrePageChange",value:function(e){this.media&&e===this.app.account&&this.data.play&&this.putAttributes({play:!1,seek:this.media.currentTime,seekTime:this.getNtpTime()/1e3,ended:!1})}},{key:"onPlaySpeedChange",value:function(e){this.media&&(this.media.playbackRate=e)}},{key:"onAttributeUpdated",value:function(e){return _(this,void 0,void 0,i.default.mark((function t(){var r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.play===this.data.play&&!this.isInReplay()){t.next=5;break}return r=e.play,this.isInReplay()&&(r=r&&"play"===this.replayMode()),t.next=5,this.setNativePlayState(r);case 5:(e.seek!==this.data.seek||e.seekTime!==this.data.seekTime||this.app.isRecordPlayer)&&this.setNativeCurrTime(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"addContainerListener",value:function(){this.mediaDiv&&(this.mediaDiv.addEventListener("mouseover",this.onContainerMouseOver),this.mediaDiv.addEventListener("mouseleave",this.onContainerMouseLeave),this.mediaDiv.addEventListener("touchstart",this.onContainerMouseOver),this.mediaDiv.addEventListener("touchmove",this.onContainerMouseMove),window.document.addEventListener("touchend",this.onContainerMouseLeave))}},{key:"addMediaListener",value:function(){var e=this;this.media&&(this.media.addEventListener("durationchange",this.onDurationChange),this.media.addEventListener("timeupdate",this.onTimeUpdate),this.media.addEventListener("ended",this.onMediaEnd),this.media.addEventListener("waiting",this.onMediaWait),this.media.addEventListener("canplay",this.onMediaCanPlay)),this.isCreator()&&!this.isInReplay()&&(this.playWidget&&this.playWidget.addEventListener("click",this.onPlayClick),this.progressController&&this.progressController.addSeekListener((function(t,r){if("number"==typeof e.duration&&!isNaN(e.duration)){var n=t*e.duration;r&&e.media?(e.media.pause(),e.media.currentTime=n):e.media&&(e.setNativePlayState(e.data.play),e.onNativeSeek(n))}}))),this.deleteIcon&&this.deleteIcon.addEventListener("click",this.onDeleteClick),this.selfMuteIcon&&this.selfMuteIcon.addEventListener("click",this.onSelfMuteClick),this.playWidget&&this.playWidget.addEventListener("click",this.eventStopPropagation),this.selfMuteIcon&&this.selfMuteIcon.addEventListener("click",this.eventStopPropagation),this.deleteIcon&&this.deleteIcon.addEventListener("click",this.eventStopPropagation)}},{key:"onPluginWillDestroy",value:function(){this.media&&(this.media.removeEventListener("durationchange",this.onDurationChange),this.media.removeEventListener("timeupdate",this.onTimeUpdate),this.media.removeEventListener("ended",this.onMediaEnd),this.media.removeEventListener("waiting",this.onMediaWait),this.media.removeEventListener("canplay",this.onMediaCanPlay)),"function"==typeof this.unregisterVisibleChangeListener&&this.unregisterVisibleChangeListener(),this.isCreator()&&!this.isInReplay()&&(this.playWidget&&this.playWidget.removeEventListener("click",this.onPlayClick),this.progressController&&this.progressController.destroy()),this.deleteIcon&&this.deleteIcon.removeEventListener("click",this.onDeleteClick),this.selfMuteIcon&&this.selfMuteIcon.removeEventListener("click",this.onSelfMuteClick),this.playWidget&&this.playWidget.removeEventListener("click",this.eventStopPropagation),this.selfMuteIcon&&this.selfMuteIcon.removeEventListener("click",this.eventStopPropagation),this.deleteIcon&&this.deleteIcon.removeEventListener("click",this.eventStopPropagation)}},{key:"getCurrTimeFromData",value:function(e){var t=0;if(this.app.isRecordPlayer)if(e.hasOwnProperty("seek")&&e.play){var r=this.replaySeekDiff();t=e.seek+r}else e.hasOwnProperty("seek")&&(t=e.seek);else e.play&&e.seekTime&&e.hasOwnProperty("seek")?t=e.seek+this.getNtpTime()/1e3-e.seekTime:e.hasOwnProperty("seek")&&(t=e.seek);return"number"!=typeof this.duration||isNaN(this.duration)||(t=Math.min(t,this.duration)),t}},{key:"setNativeCurrTime",value:function(e){var t=this.getCurrTimeFromData(e),r=this.media;r&&(r.currentTime=t)}},{key:"createHeader",value:function(){var e=document.createElement("div");e.className="header";var t=document.createElement("div");t.className="title",t.innerText=this.getTitle(),e.appendChild(t);var r=document.createElement("div");return r.className="close icon",e.appendChild(r),this.deleteIcon=r,this.headerWidget=e,e}},{key:"createControlContainer",value:function(){var e=document.createElement("div");return e.className="control-container",e}},{key:"createPlayWidget",value:function(){var e=document.createElement("div");return e.className="play-icon",this.playWidget=e,(0,n.default)(e.style,{pointerEvents:this.isCreator()&&!this.isInReplay()?"auto":"none",cursor:this.isCreator()&&!this.isInReplay()?"pointer":"auto"}),e}},{key:"createTimeIndicator",value:function(){var e=document.createElement("div"),t=document.createElement("span");return e.className="time-container",t.className="time-text",this.timeIndicator=t,this.timeWidget=e,e.appendChild(t),e}},{key:"createVolumeWidget",value:function(){var e=document.createElement("div");(0,n.default)(e.style,{display:"inline-flex",height:"40px",color:"white",flexDirection:"row",alignItems:"center",verticalAlign:"top",marginRight:"16px"});var t=document.createElement("div");(0,v.appendTooltip)(t,"开关本端声音");var r=this.selfMute?g.default:m.default;return(0,n.default)(t.style,{display:"inline-block",height:"20px",width:"20px",backgroundImage:"url("+r+")",backgroundSize:"contain",pointerEvents:"auto",cursor:"pointer",marginLeft:"10px"}),e.appendChild(t),this.selfMuteIcon=t,e}},{key:"updatePlayIcon",value:function(e){if(this.playWidget){var t=e?h.default:f.default;this.playWidget.style.backgroundImage="url("+t+")"}}},{key:"updateTimeLabel",value:function(e){var t=!1,r="00:00";e||(e=0),"number"!=typeof this.duration||isNaN(this.duration)||(t=this.duration>=3600,r=this.getTime(this.duration,t));var n=this.getTime(e,t)+" / "+r;this.timeIndicator&&(this.timeIndicator.innerText=n)}},{key:"updateSelfMute",value:function(){var e=this.selfMute?g.default:m.default;if(this.selfMuteIcon&&(this.selfMuteIcon.style.backgroundImage="url("+e+")"),this.media){this.media.muted=this.selfMute;var t=this.data.play;this.isInReplay()&&(t=t&&"play"===this.replayMode()),this.setNativePlayState(t),this.setNativeCurrTime(this.data)}}},{key:"ntpTimeDiff",get:function(){return this.app.ntpTimeDiff}}]),t}(p.default);t.default=w},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTI0MjE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTgwMCAtODAwIDI2MjQgMjYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIxMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNOTEyLjcyNDg4NCA0MjkuMzU1NjgxTDIwOC43OTc1NDUgMTMuMTk4NjM4QzE1MS42MDM0NDktMjAuNTk3ODc0IDY0LjAxMjQ5IDEyLjE5ODc0MSA2NC4wMTI0OSA5NS43OTAxMTJWOTI3LjkwNDIxOWMwIDc0Ljk5MjI1OSA4MS4zOTE1OTkgMTIwLjE4NzU5NCAxNDQuNzg1MDU1IDgyLjU5MTQ3NWw3MDMuOTI3MzM5LTQxNS45NTcwNjRjNjIuNzkzNTE4LTM2Ljk5NjE4MSA2Mi45OTM0OTgtMTI4LjE4Njc2OCAwLTE2NS4xODI5NDl6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyMTMyIj48L3BhdGg+PC9zdmc+"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=void 0,i=void 0;void 0!==document.hidden?(n="hidden",i="visibilitychange"):void 0!==document.msHidden?(n="msHidden",i="msvisibilitychange"):void 0!==document.webkitHidden&&(n="webkitHidden",i="webkitvisibilitychange"),t.registerVisibleChangeHandler=function(e,t){function r(){document[n]?t():e()}return document.addEventListener(i,r,!1),function(){document.removeEventListener(i,r)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(0)),i=s(r(1)),o=s(r(217)),a=r(218);function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,r,i){(0,n.default)(this,e),this.pages={},this.pageNames=[],this.newPageIndex=1,this.hasDoc=!1,this.app=t,this.dispatch=t.dispatcher,this.boardName=r,this.displayName=i,this.pages={0:new o.default(t,r,"0")},this.pageNames=["0"],this.currIndex=0}return(0,i.default)(e,[{key:"getPageByIndex",value:function(e){return this.pages[this.pageNames[e]]}},{key:"getPageNameByAnimPageIndex",value:function(e){for(var t=this.payloadOfPages,r=0;r<t.length;r++){var n=t[r];if(n&&n.animPageIndex===e)return this.pageNames[r]}return null}},{key:"getCurrPageIndex",value:function(){return this.pageNames.indexOf(this.currIndex.toString())}},{key:"getPageSnapshots",value:function(){var e=this;return this.app.room.boardOps[this.boardName].pageSnapshotIds.map((function(t){return e.app.room.opIdSnapshotMap[t]})).filter((function(e){return"goto"!==e.snapshot.data.action}))}},{key:"getPageBuiltInIndex",value:function(e){return Number(this.pageNames[e])}},{key:"addOpInBoard",value:function(e){var t=e.data,r=t.action,n=t.page,i=t.insertAfter;"add"===r&&(0,a.addPage)(this,i,e),"goto"===r&&(0,a.gotoPage)(this,n,e),"delete"===r&&(0,a.deletePage)(this,n,e),this.app.opsManager.hooks.addOpHook.call(e,!0)}},{key:"addTransDocOp",value:function(e,t){var r=this.app.opsManager.opMap.transDoc;this.transDocSnapshot?this.transDocSnapshot.opId!==e.data.dependOn?this.logger.warn("[白板] transDocOp添加的snapshot有问题",this.transDocSnapshot,e):this.transDocSnapshot=r.transformOp(this.transDocSnapshot,e):this.transDocSnapshot=e;try{if(this.transDocSnapshot.data.transDocData){var n=Number(this.getPageNameByAnimPageIndex(this.transDocSnapshot.data.transDocData.animPageIndex));null!==this.transDocSnapshot.data.transDocData.animPageIndex&&n!==this.currIndex&&(0,a.gotoPage)(this,n,e)}r.apply(this.transDocSnapshot,t)}catch(e){this.logger.error("[白板] transDoc.apply",e)}}},{key:"previewDoc",value:function(e){try{this.transDocSnapshot&&this.app.opsManager.opMap.transDoc.previewDoc(this.transDocSnapshot,e)}catch(e){this.logger.error("[白板] previewDoc",e)}}},{key:"updateDocClipPath",value:function(){this.transDocSnapshot&&this.app.opsManager.opMap.transDoc.updateDocClipPath(this.transDocSnapshot)}},{key:"logger",get:function(){return this.app.logger}},{key:"currPage",get:function(){return this.pages[this.currIndex]}},{key:"payloadOfPages",get:function(){var e=this;return this.pageNames.map((function(t){return e.pages[t].payload}))}}]),e}();t.default=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(0)),i=d(r(1)),o=r(103),a=r(142),s=r(328),c=r(329),u=r(104),l=r(330);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t,r,i){(0,n.default)(this,e),this.drawOpQueue={},this.hiddenOpQueue={},this.lastSelectOfUser={},this.lastInProgressSelectOfUser={},this.lastInProgressSnapshotOfUser={},this.lastLaserOfUser={},this.lastMousePointerOfUser={},this.blockedResourceList=[],this._currOpId=(0,a.v4)(),this._nextOpId=(0,a.v4)(),this.app=t,this.opsManager=t.opsManager,this.boardName=r,this.pageIndex=i,window.page=this}return(0,i.default)(e,[{key:"getBoard",value:function(){return this.app.room.boards[this.boardName]}},{key:"prepareNewOpId",value:function(){this._currOpId=this._nextOpId,this._nextOpId=(0,a.v4)()}},{key:"getOpId",value:function(){return this.app.account+"-"+this._currOpId}},{key:"getNextOpId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?(this.prepareNewOpId(),this.getOpId()):this.app.account+"-"+this._nextOpId}},{key:"setBackgroundSnapshot",value:function(e){this.backgroundSnapshot=e,this.getBoard().hasDoc=!0}},{key:"hasMedia",value:function(e){for(var t in this.drawOpQueue)if(this.drawOpQueue[t].data.type===e)return!0;return!1}},{key:"getAnimPageIndex",value:function(){return this.payload&&this.payload.hasOwnProperty("animPageIndex")?this.payload.animPageIndex:null}},{key:"setPayload",value:function(e){this.payload=e}},{key:"addWaitingResource",value:function(e){-1!==this.blockedResourceList.indexOf(e)||(0,o.resourceLoaded)(e)||this.blockedResourceList.push(e)}},{key:"removeWaitingResource",value:function(e){var t=this.blockedResourceList.indexOf(e);t>-1&&(this.blockedResourceList.splice(t,1),this.blocked||(this.app.opsManager.hooks.pageReady.call(this.boardName,this.pageIndex),this.isCurrPage&&(this.app.room.pageToRefresh=this)))}},{key:"addOpInPage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"none"===e.opId?(this.logger.warn("[白板]","snapshot no opid",e),!1):(this.lastInProgressSnapshotOfUser.hasOwnProperty(e.uid)&&-1===["mouse-pointer"].indexOf(e.data.type)&&(e.data.inProgress&&e.opId===this.lastInProgressSnapshotOfUser[e.uid].snapshot.opId||delete this.lastInProgressSnapshotOfUser[e.uid]),"background"===e.data.type&&(this.setBackgroundSnapshot(e),this.cleanNonCanvasElements(!0)),(0,u.opNeedRefresh)(this,e)&&!this.app.room.isReceivingBatchSnapshots&&this.calcDrawOpQueue(),this.app.room.isReceivingBatchSnapshots||((0,u.opNeedRefresh)(this,e)?(-1!==["undo","redo","clear"].indexOf(e.data.type)&&this.cleanNonCanvasElements(!1),t&&this.boardName===this.app.room.currIndex&&this.pageIndex===this.app.room.currBoard.currIndex.toString()&&(this.app.room.pageToRefresh=this)):(0,l.addIncrementSnapshot)(this,e)),this.opsManager.hooks.addOpHook.call(e),(0,u.opNeedRefresh)(this,e))}},{key:"calcDrawOpQueue",value:function(){(0,c.calcDrawOpQueue)(this,this.app.room.isReceivingBatchSnapshots)}},{key:"cleanNonCanvasElements",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,s.cleanNonCanvasElements)(this,e)}},{key:"refresh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.refresh)(this,e)}},{key:"incRefresh",value:function(){(0,s.drawInProgressSnapshots)(this)}},{key:"refreshOnStreamCanvas",value:function(){(0,s.refreshOnStreamCanvas)(this)}},{key:"logger",get:function(){return this.app.logger}},{key:"opQueue",get:function(){var e=this.app.room;try{return e.boardOps[this.boardName].pages[this.pageIndex].inPageSnapshotIds.map((function(t){return e.opIdSnapshotMap[t].snapshot}))}catch(e){return[]}}},{key:"isCurrPage",get:function(){return this.app.room.currBoard.currPage===this}},{key:"bgCtx",get:function(){return this.app.container.bgCtx}},{key:"ctx",get:function(){return this.app.container.ctx}},{key:"frontCtx",get:function(){return this.app.container.frontCtx}},{key:"laserCtx",get:function(){return this.app.container.laserCtx}},{key:"width",get:function(){return this.app.container.width}},{key:"height",get:function(){return this.app.container.height}},{key:"blocked",get:function(){return this.blockedResourceList.length>0}}]),e}();t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.deletePage=t.gotoPage=t.addPage=void 0;var n=o(r(14)),i=o(r(217));function o(e){return e&&e.__esModule?e:{default:e}}t.addPage=function(e,t,r,n){e.app.emit("event:prePageChange",r),e.pages[e.newPageIndex]=new i.default(e.app,e.boardName,e.newPageIndex.toString()),n?e.pages[e.newPageIndex].setPayload(n):"pageOp"===r.category&&e.pages[e.newPageIndex].setPayload(r.data.payload),t=void 0===t?e.pageNames.length-1:t,e.pageNames.splice(t+1,0,e.newPageIndex.toString()),e.app.room.isReceivingBatchSnapshots||(e.pages[e.newPageIndex].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[e.newPageIndex]),e.currIndex=e.newPageIndex,e.newPageIndex+=1,e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(r),s(e.app)},t.gotoPage=function(e,t,r){if(!e.pages.hasOwnProperty(t))return e.logger.error("[白板] goto的页面不存在, 不执行goto动作");e.app.emit("event:prePageChange",r),e.currIndex=Number(t),e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(r),s(e.app),e.app.room.isReceivingBatchSnapshots||(e.pages[t].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[t])},t.deletePage=function(e,t,r){if(e.pages.hasOwnProperty(t))if(1===(0,n.default)(e.pages).length)e.logger.error("[白板]","不能删除最后一页");else{e.app.emit("event:prePageChange",r),e.app.emit("event:deletePage",e.pages[t]),delete e.pages[t];var i=e.pageNames.indexOf(t.toString());-1!==i&&e.pageNames.splice(i,1);var o=i;i===e.pageNames.length&&(o=i-1),e.currIndex=Number(e.pageNames[o]),e.pages[e.currIndex]&&e.pages[e.currIndex].cleanNonCanvasElements(),e.app.opsManager.hooks.pageChange.call(r),s(e.app),e.app.room.isReceivingBatchSnapshots||(e.pages[e.currIndex].calcDrawOpQueue(),e.app.room.pageToRefresh=e.pages[e.currIndex])}else e.logger.error("[白板]","删除页面:"+t+", 但是页面不存在")};var a=void 0;function s(e){clearTimeout(a),a=setTimeout((function(){var t=e.room.currBoard.currIndex;e.preparePreview([t-2,t-1,t,t+1,t+2])}),0)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getCameraBoundFromGlobalOp=function(e,t){var r=e.app.camera,n=e.app.vision;if("camera-bound"===t.data.type){if(r.cameraBoundByUser[t.uid]=t.data.boundary,"freeObserver"===n.mode&&t.uid===e.app.account)return t.data.boundary;if("broadcaster"===n.mode&&t.uid===e.app.account)return t.data.boundary;if("follower"===n.mode&&t.uid===n.broadcaster)return t.data.boundary;if("follower"===n.mode&&t.uid===e.app.account)return t.data.boundary}return null},t.shouldCacheSnapshot=function(e){return!!e.category&&(!("boardOp"!==e.category||"add"!==e.data.action||!e.data.tmpl)||"boardOp"===e.category&&"addTransDoc"===e.data.action||"video"===e.data.type||"audio"===e.data.type||"image"===e.data.type)};var n=void 0;t.fitToContentAfterBoardChange=function(e){clearTimeout(n),e.isReceivingBatchSnapshots&&"data"!==e.batchSource||(n=setTimeout((function(){(e.app.hasBackground()||e.app.hasTransDoc())&&e.app.fitToContent(!1)}),0))}},function(e,t,r){t.__esModule=!0;var n,i=(n=r(47))&&n.__esModule?n:{default:n};t.default=function(e,t,r){return t in e?(0,i.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.popupFileChooserAndUpload=t.uploadAndAddResource=t.constraintByType=void 0;var n=l(r(13)),i=l(r(5)),o=r(29),a=l(r(32)),s=r(222),c=l(r(343)),u=r(380);function l(e){return e&&e.__esModule?e:{default:e}}window.__wbResLocal__||(window.__wbResLocal__={drawPlugin:void 0,resourceDimensions:{},resourceType:"image",resourcePageName:void 0,resourceBoardName:void 0},window.addEventListener("load",(function(){g()})));var d=t.constraintByType={image:{acceptTypes:["jpg","jpeg","png","bmp","webp"],sizeLimit:10485760},video:{acceptTypes:["mp4","m3u8","m3u","move","quicktime"],sizeLimit:209715200},audio:{acceptTypes:["mp3","aac","mpeg"],sizeLimit:10485760}},p=t.uploadAndAddResource=function(e,t,r,n){var s=n.type,c=n.sourceType,l=n.pageName,d=n.boardName;return t.dataURL||t.fileInput?t.dataURL&&!t.fileName?e.logger.error("[白板] uploadAndAddResource 提供了dataURL时，必须同时提供fileName"):(e.logger.log("[白板] 已选择"+s+"文件，现在开始上传文件"),"image"!==s&&""===c?e.logger.warn("[白板] 上传"+s+"时必须传入sourceType"):(e.nim,(0,u.uploadMedia)(e,(0,i.default)((0,i.default)({},t),{mediaType:n.type,uploadprogress:function(e){e&&"string"==typeof e.percentageText&&(0,o.showToast)({msg:"文件上传进度"+e.percentageText,time:1e5,type:"info",msgType:a.default.FILE_IS_UPLOADING})},done:function(t,n){(0,o.hideToast)(),t?(e.logger.error("[白板] 文件上传失败",t),(0,o.showToast)({msg:"上传失败",type:"error",time:3,msgType:a.default.FILE_UPLOAD_FAIL})):(e.logger.log("[白板] 上传"+s+"文件成功"),(0,o.showToast)({msg:s+"上传成功",type:"success",time:3,msgType:a.default.FILE_UPLOAD_FAIL}),"image"===s?e.addImage({url:n.url,width:r.width,height:r.height,pageName:l,boardName:d}):"video"===s?e.addVideo({url:n.url,width:r.width,pageName:l,boardName:d,sourceType:c}):"audio"===s&&e.addAudio({url:n.url,width:r.width,pageName:l,boardName:d,sourceType:c}))}})),void(0,o.showToast)({msg:"上传文件中...",time:1e5,type:"info",msgType:a.default.FILE_IS_UPLOADING}))):e.logger.error("[白板] uploadAndAddResource dataURL和fileInput至少提供一个")},f=(t.popupFileChooserAndUpload=function(e,t){window.__wbResLocal__.drawPlugin=e,window.__wbResLocal__.resourceDimensions={width:t.width,height:t.height},window.__wbResLocal__.resourceType=t.type,window.__wbResLocal__.resourcePageName=t.pageName,window.__wbResLocal__.resourceBoardName=t.boardName;var r=m();r.accept=f().map((function(e){return"."+e})).join(","),r.value="",r.onchange=h,r.click()},function(){return d[window.__wbResLocal__.resourceType].acceptTypes}),h=function(e){var t=window.__wbResLocal__,r=t.drawPlugin,i=t.resourceType,u=t.resourceDimensions,l=t.resourcePageName,h=t.resourceBoardName,m=e.target,g=e.target.files[0],v=d[window.__wbResLocal__.resourceType].sizeLimit,y=f();if(g&&g.size&&g.size>v)return m.value="",(0,o.showToast)({msg:"文件大小不能超过"+Math.round(v/1024/1024)+"M",type:"error",msgType:a.default.FILE_SIZE_EXCEED_LIMIT});var b=g.name.split("."),S=b[b.length-1],_=-1!==y.indexOf(S.toLowerCase());_||(m&&m.files&&m.files.length>0&&(S=m.files[0].type),_=(0,s.isValidMediaType)(S,i));var M=n.default.resolve();_||(M=c.default.fromBlob(g).then((function(e){e.mime&&(0,s.isValidMediaType)(e.mime,i)?(_=!0,S=e.mime):e.ext&&(0,s.isValidMediaType)(e.ext,i)?(_=!0,S=e.ext):_=!1}))),M.then((function(){if(!_)return m.value="",(0,o.showToast)({msg:"当前仅支持"+y.join(",")+"格式文件",time:3,type:"error",msgType:a.default.FILE_ACCEPTED_TYPE_LIMIT});p(r,{fileInput:m},u,{type:i,pageName:l,boardName:h,sourceType:S})}))},m=function(){return document.getElementById("netease-wb-resource-input")||g()},g=function(){var e=document.createElement("input");return document.body.appendChild(e),e.id="netease-wb-resource-input",e.style.position="absolute",e.style.visibility="hidden",e.type="file",e.style.width="0",e.style.height="0",e.style.top="-100px",e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isValidMediaType=t.getTransformedMediaType=void 0;var n,i=(n=r(9))&&n.__esModule?n:{default:n},o=r(221);t.getTransformedMediaType=function(e,t){var r=o.constraintByType[t].acceptTypes,n=!0,a=!1,s=void 0;try{for(var c,u=(0,i.default)(r);!(n=(c=u.next()).done);n=!0){var l=c.value;if(e===l)return t+"/"+e;if(e===t+"/"+l)return e}}catch(e){a=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw s}}return null},t.isValidMediaType=function(e,t){var r=o.constraintByType[t].acceptTypes,n=!0,a=!1,s=void 0;try{for(var c,u=(0,i.default)(r);!(n=(c=u.next()).done);n=!0){var l=c.value;if(e===l)return!0;if(e===t+"/"+l)return!0}}catch(e){a=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw s}}return!1}},function(e,t){t.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,c=(1<<s)-1,u=c>>1,l=-7,d=r?i-1:0,p=r?-1:1,f=e[t+d];for(d+=p,o=f&(1<<-l)-1,f>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+d],d+=p,l-=8);if(0===o)o=1-u;else{if(o===c)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=u}return(f?-1:1)*a*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var a,s,c,u=8*o-i-1,l=(1<<u)-1,d=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*c-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&s,f+=h,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;e[r+f]=255&a,f+=h,a/=256,u-=8);e[r+f-h]|=128*m}},function(e,t,r){(function(t,n){var i,o=s(r(65)),a=s(r(2));function s(e){return e&&e.__esModule?e:{default:e}}e.exports=A,A.ReadableState=E,r(225).EventEmitter;var c,u=function(e,t){return e.listeners(t).length},l=r(226),d=r(44).Buffer,p=t.Uint8Array||function(){},f=r(348);c=f&&f.debuglog?f.debuglog("stream"):function(){};var h,m,g,v=r(349),y=r(227),b=r(228).getHighWaterMark,S=r(68).codes,_=S.ERR_INVALID_ARG_TYPE,M=S.ERR_STREAM_PUSH_AFTER_EOF,T=S.ERR_METHOD_NOT_IMPLEMENTED,w=S.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r(67)(A,l);var x=y.errorOrDestroy,I=["error","close","destroy","pause","resume"];function E(e,t,n){i=i||r(69),e=e||{},"boolean"!=typeof n&&(n=t instanceof i),this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=b(this,e,"readableHighWaterMark",n),this.buffer=new v,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(h||(h=r(230).StringDecoder),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function A(e){if(i=i||r(69),!(this instanceof A))return new A(e);var t=this instanceof i;this._readableState=new E(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function C(e,t,r,n,i){c("readableAddChunk",t);var o,s=e._readableState;if(null===t)s.reading=!1,function(e,t){if(c("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?N(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,R(e)))}}(e,s);else if(i||(o=function(e,t){var r,n;return n=t,d.isBuffer(n)||n instanceof p||"string"==typeof t||void 0===t||e.objectMode||(r=new _("chunk",["string","Buffer","Uint8Array"],t)),r}(s,t)),o)x(e,o);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||(0,a.default)(t)===d.prototype||(t=function(e){return d.from(e)}(t)),n)s.endEmitted?x(e,new w):k(e,s,t,!0);else if(s.ended)x(e,new M);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?k(e,s,t,!1):P(e,s)):k(e,s,t,!1)}else n||(s.reading=!1,P(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function k(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&N(e)),P(e,t)}function O(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=1073741824?e=1073741824:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function N(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(R,e))}function R(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,U(e)}function P(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(D,e,t))}function D(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(c("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function j(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function L(e){c("readable nexttick read 0"),e.read(0)}function z(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),U(e),t.flowing&&!t.reading&&e.read(0)}function U(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function F(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(V,t,e))}function V(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function H(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),A.prototype.destroy=y.destroy,A.prototype._undestroy=y.undestroy,A.prototype._destroy=function(e,t){t(e)},A.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=d.from(e,t),t=""),r=!0),C(this,e,t,!1,r)},A.prototype.unshift=function(e){return C(this,e,null,!0,!1)},A.prototype.isPaused=function(){return!1===this._readableState.flowing},A.prototype.setEncoding=function(e){h||(h=r(230).StringDecoder);var t=new h(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this},A.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):N(this),null;if(0===(e=O(e,t))&&t.ended)return 0===t.length&&F(this),null;var n,i=t.needReadable;return c("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",i=!0),t.ended||t.reading?c("reading or ended",i=!1):i&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=O(r,t))),null===(n=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&F(this)),null!==n&&this.emit("data",n),n},A.prototype._read=function(e){x(this,new T("_read()"))},A.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,c("pipe count=%d opts=%j",i.pipesCount,t);var o=t&&!1===t.end||e===n.stdout||e===n.stderr?m:a;function a(){c("onend"),e.end()}i.endEmitted?n.nextTick(o):r.once("end",o),e.on("unpipe",(function t(n,o){c("onunpipe"),n===r&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,c("cleanup"),e.removeListener("close",f),e.removeListener("finish",h),e.removeListener("drain",s),e.removeListener("error",p),e.removeListener("unpipe",t),r.removeListener("end",a),r.removeListener("end",m),r.removeListener("data",d),l=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||s())}));var s=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&u(e,"data")&&(t.flowing=!0,U(e))}}(r);e.on("drain",s);var l=!1;function d(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==H(i.pipes,e))&&!l&&(c("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function p(t){c("onerror",t),m(),e.removeListener("error",p),0===u(e,"error")&&x(e,t)}function f(){e.removeListener("finish",h),m()}function h(){c("onfinish"),e.removeListener("close",f),m()}function m(){c("unpipe"),r.unpipe(e)}return r.on("data",d),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",p),e.once("close",f),e.once("finish",h),e.emit("pipe",r),i.flowing||(c("pipe resume"),r.resume()),e},A.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=H(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},A.prototype.on=function(e,t){var r=l.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,c("on readable",i.length,i.reading),i.length?N(this):i.reading||n.nextTick(L,this))),r},A.prototype.addListener=A.prototype.on,A.prototype.removeListener=function(e,t){var r=l.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(j,this),r},A.prototype.removeAllListeners=function(e){var t=l.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||n.nextTick(j,this),t},A.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(z,e,t))}(this,e)),e.paused=!1,this},A.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},A.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(c("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){c("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<I.length;o++)e.on(I[o],this.emit.bind(this,I[o]));return this._read=function(t){c("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof o.default&&(A.prototype[o.default.asyncIterator]=function(){return void 0===m&&(m=r(365)),m(this)}),Object.defineProperty(A.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(A.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(A.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),A._fromList=B,Object.defineProperty(A.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof o.default&&(A.from=function(e,t){return void 0===g&&(g=r(366)),g(A,e,t)})}).call(this,r(73),r(52))},function(e,t,r){var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,n){function i(){void 0!==o&&e.removeListener("error",o),r([].slice.call(arguments))}var o;"error"!==t&&(o=function(r){e.removeListener(t,i),n(r)},e.once("error",o)),e.once(t,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,a,s;if(u(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=p.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,l=g(c,u);for(r=0;r<u;++r)o(l[r],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,o,a;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},s.prototype.listenerCount=m,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){e.exports=r(225).EventEmitter},function(e,t,r){(function(t){function r(e,t){i(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,o){var a=this,s=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return s||c?(o?o(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,t.nextTick(i,this,e)):t.nextTick(i,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!o&&e?a._writableState?a._writableState.errorEmitted?t.nextTick(n,a):(a._writableState.errorEmitted=!0,t.nextTick(r,a,e)):t.nextTick(r,a,e):o?(t.nextTick(n,a),o(e)):t.nextTick(n,a)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this,r(52))},function(e,t,r){var n=r(68).codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,r,i){var o=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,r);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new n(i?r:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},function(e,t,r){(function(t,n){var i,o=c(r(47)),a=c(r(360)),s=c(r(65));function c(e){return e&&e.__esModule?e:{default:e}}function u(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(void 0),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=C,C.WritableState=A;var l,d={deprecate:r(363)},p=r(226),f=r(44).Buffer,h=t.Uint8Array||function(){},m=r(227),g=r(228).getHighWaterMark,v=r(68).codes,y=v.ERR_INVALID_ARG_TYPE,b=v.ERR_METHOD_NOT_IMPLEMENTED,S=v.ERR_MULTIPLE_CALLBACK,_=v.ERR_STREAM_CANNOT_PIPE,M=v.ERR_STREAM_DESTROYED,T=v.ERR_STREAM_NULL_VALUES,w=v.ERR_STREAM_WRITE_AFTER_END,x=v.ERR_UNKNOWN_ENCODING,I=m.errorOrDestroy;function E(){}function A(e,t,o){i=i||r(69),e=e||{},"boolean"!=typeof o&&(o=t instanceof i),this.objectMode=!!e.objectMode,o&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=g(this,e,"writableHighWaterMark",o),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,i=r.sync,o=r.writecb;if("function"!=typeof o)throw new S;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,i,o){--t.pendingcb,r?(n.nextTick(o,i),n.nextTick(D,e,t),e._writableState.errorEmitted=!0,I(e,i)):(o(i),e._writableState.errorEmitted=!0,I(e,i),D(e,t))}(e,r,i,t,o);else{var a=R(r)||e.destroyed;a||r.corked||r.bufferProcessing||!r.bufferedRequest||N(e,r),i?n.nextTick(O,e,r,a,o):O(e,r,a,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new u(this)}function C(e){var t=this instanceof(i=i||r(69));if(!t&&!l.call(C,this))return new C(e);this._writableState=new A(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),p.call(this)}function k(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new M("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function O(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),D(e,t)}function N(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0,s=!0;r;)i[a]=r,r.isBuf||(s=!1),r=r.next,a+=1;i.allBuffers=s,k(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new u(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,l=r.encoding,d=r.callback;if(k(e,t,!1,t.objectMode?1:c.length,c,l,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function P(e,t){e._final((function(r){t.pendingcb--,r&&I(e,r),t.prefinished=!0,e.emit("prefinish"),D(e,t)}))}function D(e,t){var r=R(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(P,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return r}r(67)(C,p),A.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(A.prototype,"buffer",{get:d.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof s.default&&a.default&&"function"==typeof Function.prototype[a.default]?(l=Function.prototype[a.default],(0,o.default)(C,a.default,{value:function(e){return!!l.call(this,e)||this===C&&e&&e._writableState instanceof A}})):l=function(e){return e instanceof this},C.prototype.pipe=function(){I(this,new _)},C.prototype.write=function(e,t,r){var i,o=this._writableState,a=!1,s=!o.objectMode&&(i=e,f.isBuffer(i)||i instanceof h);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof r&&(r=E),o.ending?function(e,t){var r=new w;I(e,r),n.nextTick(t,r)}(this,r):(s||function(e,t,r,i){var o;return null===r?o=new T:"string"==typeof r||t.objectMode||(o=new y("chunk",["string","Buffer"],r)),!o||(I(e,o),n.nextTick(i,o),!1)}(this,o,e,r))&&(o.pendingcb++,a=function(e,t,r,n,i,o){if(!r){var a=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,r)),t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else k(e,t,!1,s,n,i,o);return c}(this,o,s,e,t,r)),a},C.prototype.cork=function(){this._writableState.corked++},C.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||N(this,e))},C.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new x(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(C.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(C.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),C.prototype._write=function(e,t,r){r(new b("_write()"))},C.prototype._writev=null,C.prototype.end=function(e,t,r){var i=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,r){t.ending=!0,D(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,i,r),this},Object.defineProperty(C.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(C.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),C.prototype.destroy=m.destroy,C.prototype._undestroy=m.undestroy,C.prototype._destroy=function(e,t){t(e)}}).call(this,r(73),r(52))},function(e,t,r){var n=r(364).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=l,this.end=d,t=3;break;default:return this.write=p,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function l(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=a(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=a(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=a(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,r){e.exports=l;var n=r(68).codes,i=n.ERR_METHOD_NOT_IMPLEMENTED,o=n.ERR_MULTIPLE_CALLBACK,a=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=n.ERR_TRANSFORM_WITH_LENGTH_0,c=r(69);function u(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new o);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);c.call(this,e),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush((function(t,r){p(e,t,r)}))}function p(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new s;if(e._transformState.transforming)throw new a;return e.push(null)}r(67)(l,c),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,r){r(new i("_transform()"))},l.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))}},function(e,t,r){var n=s(r(2)),i=s(r(0)),o=s(r(3)),a=s(r(4));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EndOfStreamError=t.defaultMessages=void 0,t.defaultMessages="End-Of-Stream";var c=function(e){function r(){return(0,i.default)(this,r),(0,o.default)(this,(r.__proto__||(0,n.default)(r)).call(this,t.defaultMessages))}return(0,a.default)(r,e),r}(Error);t.EndOfStreamError=c},,,,function(e,t,r){(function(e){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,a=String(e).replace(i,(function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),c=n[r];r<o;c=n[++r])m(c)||!S(c)?a+=" "+c:a+=" "+s(c);return a},t.deprecate=function(r,n){if(void 0!==e&&!0===e.noDeprecation)return r;if(void 0===e)return function(){return t.deprecate(r,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n),i=!0}return r.apply(this,arguments)}};var o,a={};function s(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),h(r)?n.showHidden=r:r&&t._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),l(n,e,n.depth)}function c(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function u(e,t){return e}function l(e,r,n){if(e.customInspect&&r&&T(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return v(i)||(i=l(e,i,n)),i}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return g(t)?e.stylize(""+t,"number"):h(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,r);if(o)return o;var a=Object.keys(r),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(r)),M(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return d(r);if(0===a.length){if(T(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(b(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(_(r))return e.stylize(Date.prototype.toString.call(r),"date");if(M(r))return d(r)}var u,S="",w=!1,x=["{","}"];return f(r)&&(w=!0,x=["[","]"]),T(r)&&(S=" [Function"+(r.name?": "+r.name:"")+"]"),b(r)&&(S=" "+RegExp.prototype.toString.call(r)),_(r)&&(S=" "+Date.prototype.toUTCString.call(r)),M(r)&&(S=" "+d(r)),0!==a.length||w&&0!=r.length?n<0?b(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=w?function(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)A(t,String(a))?o.push(p(e,t,r,n,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(p(e,t,r,n,i,!0))})),o}(e,r,n,s,a):a.map((function(t){return p(e,r,n,s,t,w)})),e.seen.pop(),function(e,t,r){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(u,S,x)):x[0]+S+x[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,n,i,o){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),A(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(c.value)<0?(s=m(r)?l(e,c.value,null):l(e,c.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function f(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return S(e)&&"[object RegExp]"===w(e)}function S(e){return"object"==typeof e&&null!==e}function _(e){return S(e)&&"[object Date]"===w(e)}function M(e){return S(e)&&("[object Error]"===w(e)||e instanceof Error)}function T(e){return"function"==typeof e}function w(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(r){if(y(o)&&(o=e.env.NODE_DEBUG||""),r=r.toUpperCase(),!a[r])if(new RegExp("\\b"+r+"\\b","i").test(o)){var n=e.pid;a[r]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",r,n,e)}}else a[r]=function(){};return a[r]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=h,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=b,t.isObject=S,t.isDate=_,t.isError=M,t.isFunction=T,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(260);var I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(){var e=new Date,t=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":");return[e.getDate(),I[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",E(),t.format.apply(t,arguments))},t.inherits=r(67),t._extend=function(e,t){if(!t||!S(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var C="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function k(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(C&&e[C]){var t;if("function"!=typeof(t=e[C]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,C,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise((function(e,n){t=e,r=n})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,n){e?r(e):t(n)}));try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),C&&Object.defineProperty(t,C,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},t.promisify.custom=C,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var i=r.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return i.apply(o,arguments)};t.apply(this,r).then((function(t){e.nextTick(a,null,t)}),(function(t){e.nextTick(k,t,a)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.defineProperties(r,n(t)),r}}).call(this,r(52))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,n,i,o,a;return i=2147483648&e,o=2147483648&t,a=(1073741823&e)+(1073741823&t),(r=1073741824&e)&(n=1073741824&t)?2147483648^a^i^o:r|n?1073741824&a?3221225472^a^i^o:1073741824^a^i^o:a^i^o}function n(e,n,i,o,a,s,c){return e=r(e,r(r(function(e,t,r){return e&t|~e&r}(n,i,o),a),c)),r(t(e,s),n)}function i(e,n,i,o,a,s,c){return e=r(e,r(r(function(e,t,r){return e&r|t&~r}(n,i,o),a),c)),r(t(e,s),n)}function o(e,n,i,o,a,s,c){return e=r(e,r(r(function(e,t,r){return e^t^r}(n,i,o),a),c)),r(t(e,s),n)}function a(e,n,i,o,a,s,c){return e=r(e,r(r(function(e,t,r){return t^(e|~r)}(n,i,o),a),c)),r(t(e,s),n)}function s(e){var t,r="",n="";for(t=0;t<=3;t++)r+=(n="0"+(e>>>8*t&255).toString(16)).substr(n.length-2,2);return r}var c,u,l,d,p,f,h,m,g,v=Array();for(v=function(e){for(var t,r=e.length,n=r+8,i=16*((n-n%64)/64+1),o=Array(i-1),a=0,s=0;s<r;)a=s%4*8,o[t=(s-s%4)/4]=o[t]|e.charCodeAt(s)<<a,s++;return a=s%4*8,o[t=(s-s%4)/4]=o[t]|128<<a,o[i-2]=r<<3,o[i-1]=r>>>29,o}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}(e)),f=1732584193,h=4023233417,m=2562383102,g=271733878,c=0;c<v.length;c+=16)u=f,l=h,d=m,p=g,f=n(f,h,m,g,v[c+0],7,3614090360),g=n(g,f,h,m,v[c+1],12,3905402710),m=n(m,g,f,h,v[c+2],17,606105819),h=n(h,m,g,f,v[c+3],22,3250441966),f=n(f,h,m,g,v[c+4],7,4118548399),g=n(g,f,h,m,v[c+5],12,1200080426),m=n(m,g,f,h,v[c+6],17,2821735955),h=n(h,m,g,f,v[c+7],22,4249261313),f=n(f,h,m,g,v[c+8],7,1770035416),g=n(g,f,h,m,v[c+9],12,2336552879),m=n(m,g,f,h,v[c+10],17,4294925233),h=n(h,m,g,f,v[c+11],22,2304563134),f=n(f,h,m,g,v[c+12],7,1804603682),g=n(g,f,h,m,v[c+13],12,4254626195),m=n(m,g,f,h,v[c+14],17,2792965006),f=i(f,h=n(h,m,g,f,v[c+15],22,1236535329),m,g,v[c+1],5,4129170786),g=i(g,f,h,m,v[c+6],9,3225465664),m=i(m,g,f,h,v[c+11],14,643717713),h=i(h,m,g,f,v[c+0],20,3921069994),f=i(f,h,m,g,v[c+5],5,3593408605),g=i(g,f,h,m,v[c+10],9,38016083),m=i(m,g,f,h,v[c+15],14,3634488961),h=i(h,m,g,f,v[c+4],20,3889429448),f=i(f,h,m,g,v[c+9],5,568446438),g=i(g,f,h,m,v[c+14],9,3275163606),m=i(m,g,f,h,v[c+3],14,4107603335),h=i(h,m,g,f,v[c+8],20,1163531501),f=i(f,h,m,g,v[c+13],5,2850285829),g=i(g,f,h,m,v[c+2],9,4243563512),m=i(m,g,f,h,v[c+7],14,1735328473),f=o(f,h=i(h,m,g,f,v[c+12],20,2368359562),m,g,v[c+5],4,4294588738),g=o(g,f,h,m,v[c+8],11,2272392833),m=o(m,g,f,h,v[c+11],16,1839030562),h=o(h,m,g,f,v[c+14],23,4259657740),f=o(f,h,m,g,v[c+1],4,2763975236),g=o(g,f,h,m,v[c+4],11,1272893353),m=o(m,g,f,h,v[c+7],16,4139469664),h=o(h,m,g,f,v[c+10],23,3200236656),f=o(f,h,m,g,v[c+13],4,681279174),g=o(g,f,h,m,v[c+0],11,3936430074),m=o(m,g,f,h,v[c+3],16,3572445317),h=o(h,m,g,f,v[c+6],23,76029189),f=o(f,h,m,g,v[c+9],4,3654602809),g=o(g,f,h,m,v[c+12],11,3873151461),m=o(m,g,f,h,v[c+15],16,530742520),f=a(f,h=o(h,m,g,f,v[c+2],23,3299628645),m,g,v[c+0],6,4096336452),g=a(g,f,h,m,v[c+7],10,1126891415),m=a(m,g,f,h,v[c+14],15,2878612391),h=a(h,m,g,f,v[c+5],21,4237533241),f=a(f,h,m,g,v[c+12],6,1700485571),g=a(g,f,h,m,v[c+3],10,2399980690),m=a(m,g,f,h,v[c+10],15,4293915773),h=a(h,m,g,f,v[c+1],21,2240044497),f=a(f,h,m,g,v[c+8],6,1873313359),g=a(g,f,h,m,v[c+15],10,4264355552),m=a(m,g,f,h,v[c+6],15,2734768916),h=a(h,m,g,f,v[c+13],21,1309151649),f=a(f,h,m,g,v[c+4],6,4149444226),g=a(g,f,h,m,v[c+11],10,3174756917),m=a(m,g,f,h,v[c+2],15,718787259),h=a(h,m,g,f,v[c+9],21,3951481745),f=r(f,u),h=r(h,l),m=r(m,d),g=r(g,p);return(s(f)+s(h)+s(m)+s(g)).toLowerCase()}},function(e,t,r){(function(e){var n,i,o,a,s=m(r(1)),c=m(r(0)),u=m(r(5)),l=m(r(9)),d=m(r(19)),p=m(r(14)),f=m(r(47)),h=m(r(20));function m(e){return e&&e.__esModule?e:{default:e}}a=function(){return function(){var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&(0,f.default)(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return a}});var r=window.localStorage;window.localStorage&&"function"==typeof window.localStorage.getItem&&"function"==typeof window.localStorage.setItem&&"function"==typeof window.localStorage.removeItem||(r={privateObj:{},setItem:function(e,t){r.privateObj[e]=t},getItem:function(e){return r.privateObj[e]},removeItem:function(e){delete r.privateObj[e]},getKeys:function(){return(0,p.default)(r.privateObj)}});var n={getFileKey:function(e){var t=e.size.toString(),r=e.lastModified.toString();return e.name+t.slice(t.length-5)+r.slice(r.length-5)},getFileInfo:function(e){var t=r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}},initFile:function(e,t){n.clearExpiredInfo();var i=this.getFileKey(t),o={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:Date.now(),end:!1};return e.payload&&(o.payload=e.payload),r.setItem(i,(0,d.default)(o)),i},setUploadContext:function(e,t){var n=this.getFileInfo(e);n&&(n.ctx=t,r.setItem(e,(0,d.default)(n)))},setComplete:function(e){var t=this.getFileInfo(e);t&&(t.modifyAt=Date.now(),t.end=!0,r.setItem(e,(0,d.default)(t)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){r.removeItem(e)},clearExpiredInfo:function(){var e="function"==typeof r.getKeys?r.getKeys():(0,p.default)(r),t=Date.now(),i=[],o=!0,s=!1,c=void 0;try{for(var u,d=(0,l.default)(e);!(o=(u=d.next()).done);o=!0){var f=u.value,h=n.getFileInfo(f);null===h||t-h.modifyAt>a.expireTime?r.removeItem(f):i.push({fileInfo:h,key:f})}}catch(e){s=!0,c=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw c}}if(i.length>a.maxFileCache){var m=i.sort((function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt})).slice(a.maxFileCache),g=!0,v=!1,y=void 0;try{for(var b,S=(0,l.default)(m);!(g=(b=S.next()).done);g=!0){var _=b.value;r.removeItem(_.key)}}catch(e){v=!0,y=e}finally{try{!g&&S.return&&S.return()}finally{if(v)throw y}}}}},i=n,o={maxFileCache:100,expireTime:31536e6,getFileUploadInformation:function(e){var t=i.getFileKey(e),r=i.getFileInfo(t);return null===r?null:Date.now()-r.modifyAt>o.expireTime?(i.removeFileInfo(t),null):{uploadInfo:(0,u.default)({bucketName:r.bucket,objectName:r.obj,token:r.token,ctx:r.ctx},r.payload?{payload:r.payload}:{}),complete:r.end}},setMaxFileCache:function(e){o.maxFileCache=e},setExpireTime:function(e){o.expireTime=e},printCaches:function(){var e=(0,p.default)(localStorage),t=!0,r=!1,n=void 0;try{for(var o,a=(0,l.default)(e);!(t=(o=a.next()).done);t=!0){var s=o.value,c=i.getFileInfo(s);c&&console.log(c,"modifiedAt",new Date(c.modifyAt).toTimeString())}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}},createConfig:function(e){return new function e(t){for(var r in(0,c.default)(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=2,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.onError=function(e){},this.onProgress=function(e){},this.onComplete=function(e){},t)this[r]=t[r]}(e)},createTask:function(e,t,r){return new(function(){function e(t,r,n){(0,c.default)(this,e),this.uploadState="paused",this.config=n,this.file=t,this.param=r,this.fileKey=i.initFile(r,t),this.resume()}return(0,s.default)(e,[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;!function e(t,r,n){if("uploading"===t.uploadState){var o=t.config,a=t.param,s=i.getUploadContext(t.fileKey);if(!s)return n(0);var c=new XMLHttpRequest;c.onreadystatechange=function(){if("abort"!==t.uploadState&&4===c.readyState){var a=void 0;try{a=JSON.parse(c.responseText)}catch(e){a={errMsg:"返回json无法解析",errCode:500}}200===c.status?a.errCode?t.config.onError({errCode:a.errCode,errMsg:a.errMsg}):n(a.offset):c.status.toString().match(/^5/)?e(t,r-1,n):(o.onError(c.statusText),404===c.status&&i.removeFileInfo(t.fileKey))}};var u=o.directUploadAddr+"/"+a.bucketName+"/"+encodeURIComponent(a.objectName)+"?uploadContext&context="+s+"&version="+o.version;c.open("get",u),c.setRequestHeader("x-nos-token",a.token),c.timeout=o.getOffsetTimeout,c.send()}}(this,t.retryCount,(function(r){!function e(t,r,n,o){if("uploading"===t.uploadState){var a=t.param,s=t.config,c=File.prototype.slice,u=void 0!==a.ctx?a.ctx:"",l=r+s.trunkSize>t.file.size,d=l?t.file.size:r+s.trunkSize,p=new XMLHttpRequest;p.upload.onprogress=function(e){var n=0;e.lengthComputable?(n=(r+e.loaded)/t.file.size,s.onProgress(n)):s.onError({errMsg:"浏览器不支持进度事件"})},p.onreadystatechange=function(){if("abort"!==t.uploadState&&4===p.readyState){var a=void 0;try{a=JSON.parse(p.responseText)}catch(e){console.error("分片上传异常:",e),a={errMsg:"分片上传未知类型错误"}}200===p.status?(t.setContext(a.context),l?(o(),t.setComplete()):e(t,a.offset,s.retryCount,o)):p.status.toString().match(/^5/)?n>0?e(t,r,n-1,o):(i.removeFileInfo(t.fileKey),s.onError({errCode:a.errCode,errMsg:a.errMsg})):p.status?(i.removeFileInfo(t.fileKey),s.onError({errCode:a.errCode,errMsg:a.errMsg})):console.log("上传已暂停",p)}},p.open("post",s.directUploadAddr+"/"+a.bucketName+"/"+encodeURIComponent(a.objectName)+"?offset="+r+"&complete="+l+"&context="+u+"&version="+s.version),p.setRequestHeader("x-nos-token",a.token),p.timeout=s.trunkUploadTimeout,p.send(c.call(t.file,r,d))}}(e,r,t.retryCount,(function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.setUploadState("abort"),i.removeFileInfo(this.fileKey)}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){i.setUploadContext(this.fileKey,e),this.param.ctx=e}},{key:"setComplete",value:function(){i.setComplete(this.fileKey),this.setUploadState("ended")}}]),e}())(e,t,r)}},a=o;return t.default}()},"object"==(0,h.default)(t)&&"object"==(0,h.default)(e)?e.exports=a():(i=[],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o))}).call(this,r(119)(e))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.delay=t.stringToBlob=t.formatLogs=t.SPLITTER=void 0;var n,i=(n=r(13))&&n.__esModule?n:{default:n},o=t.SPLITTER="*&(&(*&(&(&*(*&^&^$^%$($^%";t.formatLogs=function(e,t,r){for(var n=[],i="用户账号: "+r+", 房间ID: "+t+"\n\n",a=0;a<e.length;a++)e[a]&&(-1!==e[a].indexOf(o)&&n.length>0?(i+=n.join("\n")+"\n\n\n\n\n\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n******************************************************************************************\n\n\n",n=[]):n.push(e[a]));return n.length>0&&(i+=n.join("\n")+"\n\n"),i},t.stringToBlob=function(e,t){var r=new Blob([e],{type:"text/plain"});return r.lastModifiedDate=new Date,r.name=t,r},t.delay=function(e){return new i.default((function(t){setTimeout((function(){t()}),e)}))}},,,,,,function(e,t,r){r(66),r(37),r(43),r(246),r(250),r(251),e.exports=r(6).Promise},function(e,t,r){var n,i,o,a,s=r(49),c=r(12),u=r(26),l=r(72),d=r(8),p=r(15),f=r(58),h=r(92),m=r(51),g=r(162),v=r(163).set,y=r(248)(),b=r(123),S=r(164),_=r(249),M=r(165),T=c.TypeError,w=c.process,x=w&&w.versions,I=x&&x.v8||"",E=c.Promise,A="process"==l(w),C=function(){},k=i=b.f,O=!!function(){try{var e=E.resolve(1),t=(e.constructor={})[r(11)("species")]=function(e){e(C,C)};return(A||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t&&0!==I.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),N=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},R=function(e,t){if(!e._n){e._n=!0;var r=e._c;y((function(){for(var n=e._v,i=1==e._s,o=0,a=function(t){var r,o,a,s=i?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{s?(i||(2==e._h&&j(e),e._h=1),!0===s?r=n:(l&&l.enter(),r=s(n),l&&(l.exit(),a=!0)),r===t.promise?u(T("Promise-chain cycle")):(o=N(r))?o.call(r,c,u):c(r)):u(n)}catch(e){l&&!a&&l.exit(),u(e)}};r.length>o;)a(r[o++]);e._c=[],e._n=!1,t&&!e._h&&P(e)}))}},P=function(e){v.call(c,(function(){var t,r,n,i=e._v,o=D(e);if(o&&(t=S((function(){A?w.emit("unhandledRejection",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=A||D(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},j=function(e){v.call(c,(function(){var t;A?w.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},L=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),R(t,!0))},z=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw T("Promise can't be resolved itself");(t=N(e))?y((function(){var n={_w:r,_d:!1};try{t.call(e,u(z,n,1),u(L,n,1))}catch(e){L.call(n,e)}})):(r._v=e,r._s=1,R(r,!1))}catch(e){L.call({_w:r,_d:!1},e)}}};O||(E=function(e){h(this,E,"Promise","_h"),f(e),n.call(this);try{e(u(z,this,1),u(L,this,1))}catch(e){L.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(93)(E.prototype,{then:function(e,t){var r=k(g(this,E));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=A?w.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&R(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n;this.promise=e,this.resolve=u(z,e,1),this.reject=u(L,e,1)},b.f=k=function(e){return e===E||e===a?new o(e):i(e)}),d(d.G+d.W+d.F*!O,{Promise:E}),r(50)(E,"Promise"),r(124)("Promise"),a=r(6).Promise,d(d.S+d.F*!O,"Promise",{reject:function(e){var t=k(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!O),"Promise",{resolve:function(e){return M(s&&this===a?E:this,e)}}),d(d.S+d.F*!(O&&r(125)((function(e){E.all(e).catch(C)}))),"Promise",{all:function(e){var t=this,r=k(t),n=r.resolve,i=r.reject,o=S((function(){var r=[],o=0,a=1;m(e,!1,(function(e){var s=o++,c=!1;r.push(void 0),a++,t.resolve(e).then((function(e){c||(c=!0,r[s]=e,--a||n(r))}),i)})),--a||n(r)}));return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=k(t),n=r.reject,i=S((function(){m(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(12),i=r(163).set,o=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,c="process"==r(53)(a);e.exports=function(){var e,t,r,u=function(){var n,i;for(c&&(n=a.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){a.nextTick(u)};else if(!o||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);r=function(){l.then(u)}}else r=function(){i.call(n,u)};else{var d=!0,p=document.createTextNode("");new o(u).observe(p,{characterData:!0}),r=function(){p.data=d=!d}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){var n=r(12).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(8),i=r(6),o=r(12),a=r(162),s=r(165);n(n.P+n.R,"Promise",{finally:function(e){var t=a(this,i.Promise||o.Promise),r="function"==typeof e;return this.then(r?function(r){return s(t,e()).then((function(){return r}))}:e,r?function(r){return s(t,e()).then((function(){throw r}))}:e)}})},function(e,t,r){var n=r(8),i=r(123),o=r(164);n(n.S,"Promise",{try:function(e){var t=i.f(this),r=o(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.App=void 0;var _keys=__webpack_require__(14),_keys2=_interopRequireDefault(_keys),_typeof2=__webpack_require__(20),_typeof3=_interopRequireDefault(_typeof2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_stringify=__webpack_require__(19),_stringify2=_interopRequireDefault(_stringify),_set=__webpack_require__(31),_set2=_interopRequireDefault(_set),_classCallCheck2=__webpack_require__(0),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=__webpack_require__(1),_createClass3=_interopRequireDefault(_createClass2),_container=__webpack_require__(100),_container2=_interopRequireDefault(_container),_OpsManager=__webpack_require__(257),_OpsManager2=_interopRequireDefault(_OpsManager),_dispatcher2=__webpack_require__(132),_dispatcher3=_interopRequireDefault(_dispatcher2),_room=__webpack_require__(327),_room2=_interopRequireDefault(_room),_dataHub=__webpack_require__(333),_dataHub2=_interopRequireDefault(_dataHub),_types=__webpack_require__(128),_previewFactory=__webpack_require__(338),_previewFactory2=_interopRequireDefault(_previewFactory),_config=__webpack_require__(102),_config2=_interopRequireDefault(_config),_camera=__webpack_require__(339),_camera2=_interopRequireDefault(_camera),_validate=__webpack_require__(134),_validate2=_interopRequireDefault(_validate),_player=__webpack_require__(340),_player2=_interopRequireDefault(_player),_drawConfig=__webpack_require__(48),_drawConfig2=_interopRequireDefault(_drawConfig),_simulator=__webpack_require__(341),_simulator2=_interopRequireDefault(_simulator),_vision=__webpack_require__(342),_vision2=_interopRequireDefault(_vision),_toast=__webpack_require__(29),_util=__webpack_require__(221),_isBase=__webpack_require__(381),_isBase2=_interopRequireDefault(_isBase),_textConfig=__webpack_require__(129),_textConfig2=_interopRequireDefault(_textConfig),_OneMotionPlugin=__webpack_require__(382),OneMotionPlugin=_interopRequireWildcard(_OneMotionPlugin),_globalVar=__webpack_require__(96),_constant=__webpack_require__(32),_constant2=_interopRequireDefault(_constant),_mediaValid=__webpack_require__(222),_dataReport=__webpack_require__(98),_dataReport2=_interopRequireDefault(_dataReport),_aliveManager=__webpack_require__(383),_aliveManager2=_interopRequireDefault(_aliveManager);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var App=function(){function App(e){var t,r,n,i,o,a,s,c,u,l;(0,_classCallCheck3.default)(this,App),this.PluginType=_types.PluginType,this.isRecordPlayer=!1,this.editEnabled=!1,this.showCursor=!1,this.isConnected=!1,this.zoomTo1AfterJoin=!0,this.reportedError=new _set2.default,this.account=e.account,this.nickname=e.nickname?e.nickname:e.account,this.platform=e.platform,this.appkey=e.appkey,this.logger=e.logger,this.isG1=e.isG1,this.serviceConf=e.serviceConf,this.ntpTimeDiff=e.ntpTimeDiff?e.ntpTimeDiff:0,this.uid=Number(e.uid),!isNaN(Number(null===(t=e.cameraBound)||void 0===t?void 0:t.centerX))&&!isNaN(Number(null===(r=e.cameraBound)||void 0===r?void 0:r.centerY))&&!isNaN(Number(null===(n=e.cameraBound)||void 0===n?void 0:n.width))&&!isNaN(Number(null===(i=e.cameraBound)||void 0===i?void 0:i.height))&&Number(null===(o=e.cameraBound)||void 0===o?void 0:o.width)>0&&Number(null===(a=e.cameraBound)||void 0===a?void 0:a.height)>0?this.defaultCameraBound={centerX:Number(null===(s=e.cameraBound)||void 0===s?void 0:s.centerX),centerY:Number(null===(c=e.cameraBound)||void 0===c?void 0:c.centerY),width:Number(null===(u=e.cameraBound)||void 0===u?void 0:u.width),height:Number(null===(l=e.cameraBound)||void 0===l?void 0:l.height)}:e.cameraBound&&this.logger.error("[白板] 初始坐标系存在问题",(0,_stringify2.default)(e.cameraBound)),this.zoomTo1AfterJoin=void 0===e.zoomTo1AfterJoin||!0===e.zoomTo1AfterJoin,this.nim=e.nim,this.simulator=new _simulator2.default(this),this.configInstance=new _config2.default(this),this.dispatcher=new _dispatcher3.default,this.opsManager=new _OpsManager2.default(this),this.opsManager.extendDefaultOps(),this.dataHub=new _dataHub2.default(this,e.connector),this.container=new _container2.default(this),this.room=new _room2.default(this,this.dataHub),this.container.addOpsManager(this.opsManager),this.opsManager.addContainer(this.container),this.camera=new _camera2.default(this,this.defaultCameraBound),this.vision=new _vision2.default(this),this.isRecordPlayer=!!e.isRecordPlayer,e.isRecordPlayer||(this.previewFactory=new _previewFactory2.default(this)),this.aliveManager=new _aliveManager2.default(this),e.isRecordPlayer&&(this.player=new _player2.default(this)),e.container&&this.setContainer(e.container)}return(0,_createClass3.default)(App,[{key:"getStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _validate2.default.validate(this.logger,"container.getStream",e,{width:{isRequire:!1,type:"number"},keepDPI:{isRequire:!1,type:"boolean"}}),this.container.getStream(e,!0)}},{key:"updateStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _validate2.default.validate(this.logger,"container.updateStream",e,{width:{isRequire:!1,type:"number"},keepDPI:{isRequire:!1,type:"boolean"}}),this.container.getStream(e,!1)}},{key:"stopStream",value:function(){this.container.stopStream()}},{key:"getStrokeWidth",value:function(){return _drawConfig2.default.strokeWidth}},{key:"getOpacity",value:function(){return _drawConfig2.default.opacity}},{key:"getColor",value:function(){return _drawConfig2.default.strokeColor}},{key:"getRedoCount",value:function(){return this.opsManager.opMap.redo.getCount()}},{key:"getUndoCount",value:function(){return this.opsManager.opMap.undo.getCount()}},{key:"isClearAvailable",value:function(){return this.opsManager.opMap.clear.isAvailable()}},{key:"isTextAreaFocus",value:function(){return this.opsManager.opMap.text.isFocus}},{key:"getSelectedIds",value:function(){return this.opsManager.opMap.select.getSelectedIds()}},{key:"getZoomFactor",value:function(){return this.camera.zoomFactor}},{key:"getCameraBound",value:function(){return this.camera.getContainerWorldRect()}},{key:"getVisionState",value:function(){return{mode:this.vision.mode,broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}},{key:"setAppConfig",value:function(e){this.configInstance.setAppConfig(e)}},{key:"setContainer",value:function(e){var t;this.logger.log("set container"),e.innerHTML="",this.container.appendTo(e),null===(t=this.previewFactory)||void 0===t||t.reset()}},{key:"updateContainerAfterResize",value:function(){this.container.resize()}},{key:"readyToSyncData",value:function(){document.body.style.cursor="auto",this.dataHub.sendSyncRequest()}},{key:"stopSyncData",value:function(){_globalVar.LOG&&this.logger.log("[白板]","drawPlugin.stopSyncData"),this.dataHub.stopSyncRequest()}},{key:"setIsConnected",value:function(e){this.isConnected=e,this.isConnected||(document.body.style.cursor="auto")}},{key:"resetState",value:function(){var e;this.logger.log("[白板] resetState"),this.room.reset(),this.dataHub.reset(),this.opsManager.destroy(),null===(e=this.previewFactory)||void 0===e||e.reset()}},{key:"addPlugin",value:function(e,t){if(e===_types.PluginType.OneMotion){var r=OneMotionPlugin.wrapPluginToOp(this.logger,t);if(this.opsManager.hasOpType(t.type))throw new Error("插件类型"+t.type+"已存在，请使用其他类型名");this.opsManager.extendDrawOp(r)}else this.logger.error("drawPlugin.addPlugin 未知插件类型"+e+", 目前支持的参数类型为"+_types.PluginType.OneMotion)}},{key:"addImage",value:function(e){this.logger.log("[白板]","drawPlugin.addImage",e),_validate2.default.validate(this.logger,"drawPlugin.addImage",e,{url:{type:"string",isRequire:!0},width:{type:"number"},height:{type:"number"}});var t=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;(0,_isBase2.default)(e.url)||(0,_isBase2.default)(e.url,{allowMime:!0})?(0,_util.uploadAndAddResource)(this,{dataURL:e.url,fileName:"img.png"},{width:e.width,height:e.height},{type:"image",pageName:t,sourceType:"",boardName:e.boardName}):e.url.length>1e4?this.logger.error("[白板]","drawPlugin.addImage opt.url长度不应该大于10000"):this.emit("op:image:upload",e.url,{width:e.width,height:e.height,pageName:t,boardName:e.boardName})}},{key:"addLocalResource",value:function(e){this.logger.log("[白板]","drawPlugin.addLocalResource",e),("audio"!==e.type&&"video"!==e.type||!this.hasMediaOnPage())&&(_validate2.default.validate(this.logger,"drawPlugin.addLocalResource",e,{width:{type:"number"},height:{type:"number"},type:{type:"string",enum:["image","video","audio"]}}),(0,_util.popupFileChooserAndUpload)(this,{width:e.width,height:e.height,type:e.type,pageName:this.room.currBoard.currIndex.toString(),boardName:this.room.currBoard.boardName}))}},{key:"addVideo",value:function(e){this.logger.log("[白板]","drawPlugin.addVideo",e),_validate2.default.validate(this.logger,"drawPlugin.addVideo",e,{url:{type:"string",isRequire:!0},sourceType:{type:"string",isRequire:!0},width:{type:"number"},title:{type:"string"}});var t=(0,_mediaValid.getTransformedMediaType)(e.sourceType,"video");if(null===t)return(0,_toast.showToast)({type:"error",time:3,msg:"不支持类型为"+e.sourceType+"的视频文件",msgType:_constant2.default.VIDEO_TYPE_NOT_ALLOWED});var r=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;this.hasMediaOnPage(e.boardName,r)||this.emit("op:video:insert",e.url,{width:e.width,title:e.title,sourceType:t,pageName:r,boardName:e.boardName})}},{key:"hasMediaOnPage",value:function(e,t){var r=this.room.getPageWithFallback(e,t);return!(!r||!r.hasMedia("audio")&&!r.hasMedia("video")||(this.logger.warn("[白板] 同一页白板中仅允许插入一个音视频"),(0,_toast.showToast)({msg:"只允许同时放置一个音视频插件",type:"warn",time:3,msgType:_constant2.default.ONE_MEDIA_LIMIT}),0))}},{key:"addAudio",value:function(e){this.logger.log("[白板]","drawPlugin.addAudio",e),_validate2.default.validate(this.logger,"drawPlugin.addAudio",e,{url:{type:"string",isRequire:!0},sourceType:{type:"string",isRequire:!0},width:{type:"number"},title:{type:"string"}});var t=(0,_mediaValid.getTransformedMediaType)(e.sourceType,"audio");if(null===t)return(0,_toast.showToast)({type:"error",time:3,msg:"不支持类型为"+e.sourceType+"的音频文件",msgType:_constant2.default.AUDIO_TYPE_NOT_ALLOWED});var r=void 0===e.pageName?this.room.getPageNameFromIndex(e.boardName,e.pageIndex):e.pageName;this.hasMediaOnPage(e.boardName,r)||this.emit("op:audio:insert",e.url,{width:e.width,title:e.title,sourceType:t,pageName:r,boardName:e.boardName})}},{key:"setPageBackground",value:function(e){this.logger.log("[白板]","drawPlugin.setPageBackground",e),_validate2.default.validate(this.logger,"drawPlugin.setPageBackground",e,{url:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});var t=this.room.getPageNameFromIndex(e.boardName,e.pageIndex);this.emit("op:background:imageUpload",e.url,{width:e.width,height:e.height,pageName:t,boardName:e.boardName})}},{key:"hasBackground",value:function(e){return(e=e||this.room.currBoard.currPage).backgroundSnapshot||null!==e.getAnimPageIndex()}},{key:"hasTransDoc",value:function(){return void 0!==this.room.currBoard.transDocSnapshot}},{key:"hasDoc",value:function(e){return(e=e||this.room.currBoard).hasDoc}},{key:"addTransDoc",value:function(e){this.logger.log("[白板]","drawPlugin.addTransDoc",e);var t=e.docName+"_"+(new Date).valueOf(),r=(0,_assign2.default)({},e,{displayName:e.docName,boardName:t});return this.emit("op:transDoc:add",r),t}},{key:"addDoc",value:function(e){return Array.isArray(e.params)?this._addDocByUrlArray(e):this._addDocByUrlTemplate(e)}},{key:"_addDocByUrlArray",value:function(e){this.logger.log("[白板]","drawPlugin.addDoc",e),_validate2.default.validate(this.logger,"drawPlugin.addDoc",e,{docName:{type:"string",isRequire:!0},params:{type:"array",isRequire:!0}});for(var t=0;t<e.params.length;t++)_validate2.default.validate(this.logger,"drawPlugin.addDoc opt.params["+t+"]",e.params[t],{url:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});if(0===e.params.length)throw new Error("addDoc参数中params的数组长度必须大于0");for(var r=e.docName,n=e.params,i=this.addBoard(r,n.length),o=0;o<n.length;o++)this.setPageBackground({url:n[o].url,width:n[o].width,height:n[o].height,pageIndex:o,boardName:i});return i}},{key:"_addDocByUrlTemplate",value:function(e){if(this.logger.log("[白板]","drawPlugin.addDoc",e),_validate2.default.validate(this.logger,"drawPlugin.addDoc",e,{docName:{type:"string",isRequire:!0}}),_validate2.default.validate(this.logger,"drawPlugin.addDoc opt.params",e.params,{template:{type:"string",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0},pageCount:{type:"number",isRequire:!0},offset:{type:"number",isRequire:!0}}),e.params.pageCount<=0)throw new Error("addDoc参数中params.pageCount必须大于0");var t=e.docName,r=e.params,n=t+"_"+(new Date).valueOf();return this.emit("op:board:add",t,n,r.pageCount,{width:e.params.width,height:e.params.height,template:e.params.template,offset:e.params.offset}),n}},{key:"setCustomBackground",value:function setCustomBackground(coordinate,customFn,bgName){if("string"==typeof customFn)try{customFn=eval(customFn)}catch(e){return void this.logger.error("setCustomBackground的参数应该为函数，或者函数的字符串表达",e)}"function"==typeof customFn&&"world"===coordinate?(this.bgRenderWorld=customFn,this.bgRenderContainer=void 0,this.bgRenderName=bgName):"function"==typeof customFn&&"container"===coordinate?(this.bgRenderWorld=void 0,this.bgRenderContainer=customFn,this.bgRenderName=bgName):this.logger.error("setCustomBackground第一个参数为函数，第二个参数为world或者container"),this.room.refresh()}},{key:"unsetCustomBackground",value:function(){this.bgRenderContainer=void 0,this.bgRenderWorld=void 0,this.bgRenderName=void 0,this.room.refresh()}},{key:"getBgRendererName",value:function(){return this.bgRenderName}},{key:"setTool",value:function(e){this.emit("op:activate",e)}},{key:"setFontsize",value:function(e){this.emit("op:text:fontsize",e)}},{key:"setFontFamily",value:function(e){return _globalVar.LOG&&this.logger.log("[白板]","drawPlugin.setFontFamily",(0,_stringify2.default)(e)),e.fontFace||e.fontFamily?e.fontFace&&Array.isArray(e.fontFace)&&0===e.fontFace.length?this.logger.error("[白板] setFontFamily。你设置了fontFace为数组, 但是数组长度为0"):(e.fontFamily&&console.log("[白板] 设置字体为: "+e.fontFamily+", 您提供的字体应该在各个设备中均可用。如果某些设备中字体不可用，请同时设置opt.fontFace，作为字体的下载地址"),e.fontFace&&console.log("你设置了fontFace, 请保证该URL能被您用户的设备访问, 可以通过在web端检查浏览器的Network->font检测字体是否被下载"),e.fontFamily&&_textConfig2.default.setFontFamily(e.fontFamily),e.fontFace&&Array.isArray(e.fontFace)?_textConfig2.default.setFontFace(e.fontFace):e.fontFace&&_textConfig2.default.setFontFace([e.fontFace]),void this.opsManager.opMap.text.updateFontFamily()):this.logger.error("[白板] drawPlugin.setFontFamily必须提供fontFamily或者fontFace")}},{key:"setColor",value:function(e){this.logger.log("[白板]","drawPlugin.setColor",e),_drawConfig2.default.setStrokeColor(e),this.emit("event:appState:change","renderColor",e)}},{key:"setShapeFill",value:function(){this.logger.error("[白板] setShapeFill已弃用。如果你需要设置图形填充，可以直接设置tool为rect-fill, 或者ellipse-fill")}},{key:"setStrokeWidth",value:function(e){this.logger.log("[白板]","drawPlugin.setStrokeWidth",e),_drawConfig2.default.setStrokeWidth(e),this.emit("event:appState:change","renderWidth",e)}},{key:"setOpacity",value:function(e){if(this.logger.log("[白板]","drawPlugin.setOpacity",e),e>1||e<0)return this.logger.error("drawPlugin.setOpacity的透明度必须大于0，小于等于1");_drawConfig2.default.setOpacity(e),this.emit("event:appState:change","opacity",e)}},{key:"setShowCursor",value:function(e){this.logger.log("[白板]","drawPlugin.setShowCursor",e),this.showCursor=e}},{key:"enableDraw",value:function(e){this.logger.log("[白板]","drawPlugin.enableDraw",e),_validate2.default.validate(this.logger,"drawPlugin.enableDraw",{editEnabled:e},{editEnabled:{type:"boolean",isRequire:!0}}),this.editEnabled!==e&&(e||(document.body.style.cursor="auto"),this.editEnabled=e,this.opsManager.hooks.enableDrawChange.call(e),this.emit("event:editable:change",this.editable))}},{key:"enableCameraTransform",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.enableCameraTransform",e),this.setAppConfig({cameraTransformEnabled:e})}},{key:"resetCamera",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.resetCamera"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:reset-camera:exec",e)}},{key:"setCameraBound",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.logger.log("[白板]","drawPlugin.setCameraBound boundary: ",(0,_stringify2.default)(e),"animate: ",t);var r=_validate2.default.validate(this.logger,"drawPlugin.setCameraBound",e,{centerX:{type:"number",isRequire:!0},centerY:{type:"number",isRequire:!0},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0}});r&&this.emit("op:camera-bound:send",e,t)}},{key:"fitToContent",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.fitToContent"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:fit-to-content:exec",e)}},{key:"fitToDoc",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger.log("[白板]","drawPlugin.fitToDoc"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:fit-to-doc:exec",e)}},{key:"zoomIn",value:function(){this.logger.log("[白板]","drawPlugin.zoomIn"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:in")}},{key:"zoomOut",value:function(){this.logger.log("[白板]","drawPlugin.zoomOut"),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:out")}},{key:"zoomTo",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.logger.log("[白板]","drawPlugin.zoomTo: ",e," animate: ",t),"follower"===this.vision.mode?(0,_toast.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:_constant2.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.vision.broadcasterName,broadcaster:this.vision.broadcaster}}):this.emit("op:zoom:to",e,t)}},{key:"lockCameraWithContent",value:function(e){this.camera.lockCameraWithContent(e)}},{key:"unlockCameraWithContent",value:function(){this.camera.unlockCameraWithContent()}},{key:"undo",value:function(){this.logger.log("[白板]","drawPlugin.undo"),this.emit("op:undo:exec")}},{key:"redo",value:function(){this.logger.log("[白板]","drawPlugin.redo"),this.emit("op:redo:exec")}},{key:"clear",value:function(){this.logger.log("[白板]","drawPlugin.clear"),this.emit("op:clear:exec")}},{key:"duplicate",value:function(){this.logger.log("[白板]","drawPlugin.duplicate"),this.emit("op:duplicate:exec")}},{key:"deleteSelectedElements",value:function(){this.logger.log("[白板]","drawPlugin.deleteSelectedElements"),this.emit("op:delete:exec")}},{key:"deleteElementByOpIds",value:function(e){this.logger.log("[白板]","drawPlugin.deleteElementByOpIds",e),this.emit("op:delete:deleteOps",e)}},{key:"addPage",value:function(e){"object"===(void 0===e?"undefined":(0,_typeof3.default)(e))?this.logger.log("[白板]","drawPlugin.addPage",(0,_stringify2.default)(e)):this.logger.log("[白板]","drawPlugin.addPage, insertAfter",e),"number"==typeof e?e={insertAfter:e}:e||(e={}),this.emit("op:page:add",e)}},{key:"deletePage",value:function(e){var t=this.room.currBoard.getPageBuiltInIndex(e);this.logger.log("[白板]","drawPlugin.deletePage: ",e,"builtInIndex",t),this.emit("op:page:delete",t)}},{key:"gotoPage",value:function(e){var t=this.room.currBoard.getPageBuiltInIndex(e);this.logger.log("[白板]","drawPlugin.gotoPage: ",e,"buildInIndex",t),isNaN(t)?this.logger.error("[白板] 第"+(e+1)+"不存在，当前文档内的页面总数为: "+this.room.currBoard.pageNames.length):this.emit("op:page:goto",t)}},{key:"gotoFirstPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoFirstPage"),this.room.currBoard.getCurrPageIndex()>0&&this.gotoPage(0)}},{key:"gotoPrevPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoPrevPage");var e=this.room.currBoard.getCurrPageIndex();e>0&&this.gotoPage(e-1)}},{key:"gotoNextPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoNextPage");var e=this.room.currBoard,t=e.getCurrPageIndex();t<e.pageNames.length-1&&this.gotoPage(t+1)}},{key:"gotoLastPage",value:function(){this.logger.log("[白板]","drawPlugin.gotoLastPage");var e=this.room.currBoard;e.getCurrPageIndex()<e.pageNames.length-1&&this.gotoPage(e.pageNames.length-1)}},{key:"gotoAnim",value:function(e){if(!this.hasTransDoc())return this.logger.error("[白板] drawPlugin.gotoAnim调用时，当前文档不是动态文档");this.logger.log("[白板] drawPlugin.gotoAnim",e),this.emit("op:transDoc:gotoAnim",e)}},{key:"nextAnim",value:function(){this.logger.log("[白板] drawPlugin.nextAnim"),this.emit("op:transDoc:nextAnim")}},{key:"prevAnim",value:function(){this.logger.log("[白板] drawPlugin.prevAnim"),this.emit("op:transDoc:prevAnim")}},{key:"gotoBoard",value:function(e){_validate2.default.validate(this.logger,"drawPlugin.gotoBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.gotoBoard:",e),this.emit("op:board:goto",e)}},{key:"addBoard",value:function(e,t){_validate2.default.validate(this.logger,"drawPlugin.addBoard",{displayName:e},{displayName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.addBoard, displayName:",e," pageCount:",t);var r=e+"_"+(new Date).valueOf();return this.emit("op:board:add",e,r,t),r}},{key:"deleteBoard",value:function(e){_validate2.default.validate(this.logger,"drawPlugin.deleteBoard",{boardName:e},{boardName:{type:"string",isRequire:!0}}),this.logger.log("[白板]","drawPlugin.deleteBoard: ",e),this.emit("op:board:delete",e)}},{key:"getAnimInfos",value:function(){var e=this.opsManager.opMap.transDoc.getPluginOfCurrBoard();if(e){var t=e.data;return t&&null!==t.animPageIndex?{pageIndex:e.data.animPageIndex,animIndex:e.data.animIndex,animState:e.data.animState}:null}return null}},{key:"getPageInfos",value:function(e){var t=e?this.room.boards[e]:this.room.currBoard;return{pageNames:(t=t||this.room.currBoard).pageNames.slice(),currPage:t.currIndex,activeIndex:t.getCurrPageIndex(),pagePayloads:t.payloadOfPages}}},{key:"getBoardInfos",value:function(){return{boardNames:(0,_keys2.default)(this.room.boards),currBoard:this.room.currIndex,currBoardDisplayName:this.room.currBoard.displayName,boardDisplayNames:this.room.getBoardDisplayNames()}}},{key:"bindPreviewContainer",value:function(e){var t;null===(t=this.previewFactory)||void 0===t||t.bindPreviewContainer(e)}},{key:"preparePreview",value:function(e){var t;null===(t=this.previewFactory)||void 0===t||t.preparePreview(e)}},{key:"emit",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(t=this.dispatcher).emit.apply(t,[e].concat(n))}},{key:"on",value:function(e,t){this.dispatcher.on(e,t)}},{key:"off",value:function(e,t){this.dispatcher.off(e,t)}},{key:"once",value:function(e,t){this.dispatcher.once(e,t)}},{key:"getOpDoc",value:function(e){return this.opsManager.getOpDoc(e)}},{key:"getCurrTool",value:function(){var e;return null===(e=this.opsManager.currOp)||void 0===e?void 0:e.type}},{key:"destroy",value:function(){this.logger.log("[白板]","drawPlugin.destroy"),this.dispatcher.destroy(),this.container.destroy(),this.opsManager.destroy(),this.dataHub.destroy(),this.vision.destroy(),this.aliveManager.destroy(),this.stopStream(),this.toolCollection&&"function"==typeof this.toolCollection.destroy&&this.toolCollection.destroy(),document.body.style.cursor="auto",this.setIsConnected(!1)}},{key:"addRecordData",value:function(e){var t;null===(t=this.player)||void 0===t||t.addRecordData(e)}},{key:"seekTo",value:function(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e)}},{key:"play",value:function(){var e;null===(e=this.player)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.player)||void 0===e||e.pause()}},{key:"setPlaySpeed",value:function(e){var t;null===(t=this.player)||void 0===t||t.setPlaySpeed(e)}},{key:"setViewer",value:function(e){var t;null===(t=this.player)||void 0===t||t.setViewer(e)}},{key:"setSelfAsBroadcaster",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsBroadcaster"),this.vision.setSelfAsBroadcaster()}},{key:"unsetSelfAsBroadcaster",value:function(){this.logger.log("[白板]","drawPlugin.unsetSelfAsBroadcaster"),this.vision.unsetSelfAsBroadcaster()}},{key:"setSelfAsFollower",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsFollower"),this.vision.setSelfAsFollower()}},{key:"setSelfAsFreeObserver",value:function(){this.logger.log("[白板]","drawPlugin.setSelfAsFreeObserver"),this.vision.setSelfAsFreeObserver()}},{key:"exportAsImage",value:function(e){this.logger.log("[白板]","drawPlugin.exportAsImage",e);var t=null==e?void 0:e.type,r=null==e?void 0:e.quality,n="wholePage"===(null==e?void 0:e.content)?"wholePage":"clip",i=!!(null==e?void 0:e.omitSelection),o=!!(null==e?void 0:e.customBg);t&&!t.startsWith("image")&&(t="image/"+t);var a=this.previewFactory.generatePreviewToDataUrl({pageIndex:this.room.currBoard.currIndex.toString(),boardName:this.room.currIndex,state:"ready",content:n,omitSelection:i,customBg:o},t,r),s=document.createElement("a");s.href=a;var c="whiteboard"===this.room.currBoard.boardName?"白板":this.room.currBoard.boardName,u=this.room.currBoard.currPage.pageIndex,l=this.room.currBoard.pageNames.indexOf(u),d=t&&-1!==t.toLowerCase().indexOf("jpeg")?"jpeg":"png";s.download=c+"-"+(l+1)+"."+d,s.click()}},{key:"exportAsBase64String",value:function(e,t){var r=void 0,n=void 0,i=!1,o=!1;return e&&"object"===(void 0===e?"undefined":(0,_typeof3.default)(e))?(r=e.type,t=e.quality,n=e.content,i=!!e.omitSelection,o=!!e.customBg):r=e,n="wholePage"===n?"wholePage":"clip",this.logger.log("[白板]","drawPlugin.exportAsBase64String("+e+", "+t),r&&!r.startsWith("image")&&(r="image/"+r),this.previewFactory.generatePreviewToDataUrl({pageIndex:this.room.currBoard.currIndex.toString(),boardName:this.room.currIndex,state:"ready",content:n,omitSelection:i,customBg:o},r,t)}},{key:"setMemberList",value:function(e){this.emit("event:member:change",e.slice())}},{key:"dataReportUtil",value:function(e,t){this.dataReportUrl&&this.dataReportParams&&!this.isRecordPlayer&&("v3_run_error"===e?t.error&&!this.reportedError.has(t.error.message)&&((0,_dataReport2.default)(this.dataReportUrl,e,this.dataReportParams.appkey+"-"+this.dataReportParams.cid,(0,_assign2.default)((0,_assign2.default)((0,_assign2.default)({},this.dataReportParams),{time:Date.now()}),t)),this.reportedError.add(t.error.message)):(0,_dataReport2.default)(this.dataReportUrl,e,this.dataReportParams.appkey+"-"+this.dataReportParams.cid,(0,_assign2.default)((0,_assign2.default)((0,_assign2.default)({},this.dataReportParams),{time:Date.now()}),t)))}},{key:"setDataReportParams",value:function(e,t){this.dataReportUrl=e,this.dataReportParams=t}},{key:"setToolCollection",value:function(e){this.toolCollection&&"function"==typeof this.toolCollection.destroy&&this.toolCollection.destroy(),this.toolCollection=e}},{key:"disableInteraction",value:function(){this.container.disableInteraction()}},{key:"enableInteraction",value:function(){this.container.enableInteraction()}},{key:"ifDeviceSupportOrientation",get:function(){return-1!==_types.TouchPlatformArray.indexOf(this.platform.toLowerCase())}},{key:"editable",get:function(){return this.editEnabled&&!this.dataHub.isSynchronizing&&this.isConnected}},{key:"appConfig",get:function(){return this.configInstance.getAppConfig()}}]),App}(),DrawPlugin={getInstance:function(e){return e.logger.log("[白板]","DrawPlugin.getInstance arguments:",e),_validate2.default.validate(e.logger,"DrawPlugin.instance",e,{account:{type:"string",isRequire:!0},nickname:{type:"string",isRequire:!1},container:{type:"dom",isRequire:!1},platform:{type:"string",isRequire:!0,enum:_types.PlatformArray},connector:{type:"object",isRequire:!0},nim:{type:"object",isRequire:!0}}),new App(e)}};exports.App=App,exports.default=DrawPlugin},function(e,t,r){e.exports={default:r(254),__esModule:!0}},function(e,t,r){r(43),r(37),e.exports=r(255)},function(e,t,r){var n=r(72),i=r(11)("iterator"),o=r(40);e.exports=r(6).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(n(t))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.evenify=function(e){return 2*Math.ceil(e/2)},t.deltaXY=function(e,t){return[(t[0]-e[0]+t[2]-e[2])/2,(t[1]-e[1]+t[3]-e[3])/2]},t.fingerDiff=function(e,t){return Math.abs(t[0]-e[0]-t[2]+e[2])+Math.abs(t[1]-e[1]-t[3]+e[3])},t.pinchScale=function(e,t){var r=Math.abs(e[0]-e[2])+Math.abs(e[1]-e[3]);return(Math.abs(t[0]-t[2])+Math.abs(t[1]-t[3]))/r},t.ptsCenter=function(e,t){return[(e[0]+e[2]+t[0]+t[2])/4,(e[1]+e[3]+t[1]+t[3])/4]},t.scaleProb=function(e,t,r){var n=[2.5,6],i=[.01,.05],o=e/t;return isNaN(o)?.5:.7*(o>n[1]?1:o>n[0]?Math.min(1,.5+Math.sqrt((o-n[0])/(n[1]-n[0]))/2):(1-Math.sqrt((n[0]-o)/n[0]))/2)+.3*(r>i[1]?1:r>i[0]?Math.min(1,.5+Math.sqrt((r-i[0])/(i[1]-i[0]))/2):(1-Math.sqrt((i[0]-r)/i[0]))/2)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Y(r(19)),i=Y(r(0)),o=Y(r(1)),a=Y(r(31)),s=r(54),c=r(258),u=Y(r(198)),l=Y(r(200)),d=Y(r(101)),p=Y(r(274)),f=Y(r(275)),h=Y(r(276)),m=Y(r(277)),g=Y(r(278)),v=Y(r(279)),y=Y(r(280)),b=Y(r(202)),S=Y(r(203)),_=Y(r(281)),M=Y(r(286)),T=Y(r(287)),w=Y(r(289)),x=Y(r(290)),I=Y(r(292)),E=Y(r(293)),A=Y(r(294)),C=Y(r(295)),k=Y(r(296)),O=Y(r(297)),N=Y(r(298)),R=Y(r(299)),P=Y(r(300)),D=Y(r(301)),j=Y(r(303)),L=Y(r(304)),z=Y(r(305)),U=Y(r(56)),B=Y(r(306)),F=Y(r(307)),V=Y(r(308)),H=r(96),$=Y(r(323)),W=Y(r(324));function Y(e){return e&&e.__esModule?e:{default:e}}var G=new a.default,Q=function(){function e(t){var r=this;(0,i.default)(this,e),this.currOp=null,this.opMap={},this.drawOpTypes=[],this.app=t,this.dispatcher=t.dispatcher,this.hooks={scale:new c.SyncBailHook(["event","scale","clientX","clientY"]),pan:new c.SyncBailHook(["event","clientDx","clientDy"]),mousedown:new c.SyncBailHook(["event","mx","my","clientX","clientY"]),mouseup:new c.SyncBailHook(["event","mx","my","clientX","clientY"]),mousemove:new c.SyncBailHook(["event","mx","my","clientX","clientY"]),mouseleave:new c.SyncBailHook(["event","mx","my","clientX","clientY"]),mousewheel:new c.SyncBailHook(["event","mx","my","clientX","clientY"]),resize:new c.SyncBailHook(["event","width","height"]),click:new c.SyncBailHook(["event","mx","my","clientX","clientY"]),keyup:new c.SyncBailHook(["event"]),keydown:new c.SyncBailHook(["event"]),addOpHook:new c.SyncHook(["snapshot","isNew"]),refresh:new c.SyncHook([]),opChange:new c.SyncHook(["type"]),selectChange:new c.SyncHook(["prevSelectedOpIds","selectedOpIds"]),pageChange:new c.SyncHook(["snapshot"]),boardChange:new c.SyncHook([]),pageReady:new c.SyncHook(["boardName, pageIndex"]),enableDrawChange:new c.SyncHook(["enable"]),previewWaiting:new c.SyncHook(["pageIndex"])},this.dispatcher.on("op:activate",(function(e){r.setCurrOp(e)}))}return(0,o.default)(e,[{key:"extendDefaultOps",value:function(){this.extendOp(D.default),this.extendDrawOp(u.default),this.extendDrawOp(I.default),this.extendDrawOp(E.default),this.extendDrawOp(l.default),this.extendDrawOp(b.default),this.extendDrawOp(B.default),this.extendDrawOp(F.default),this.extendDrawOp(S.default),this.extendOp(_.default),this.extendOp(C.default),this.extendOp(d.default),this.extendOp(f.default),this.extendOp(p.default),this.extendOp(h.default),this.extendOp(x.default),this.extendOp(m.default),this.extendOp(g.default),this.extendOp(v.default),this.extendOp(y.default),this.extendOp(A.default),this.extendOp(M.default),this.extendOp(w.default),this.extendOp(W.default),this.extendOp(T.default),this.extendOp(V.default),this.extendOp($.default),this.extendOp(O.default),this.extendOp(k.default),this.extendOp(N.default),this.extendOp(R.default),this.extendOp(P.default),this.extendOp(j.default),this.extendOp(U.default),this.extendOp(L.default),this.extendOp(z.default),this.setCurrOp("pen")}},{key:"addContainer",value:function(e){this.container=e}},{key:"extendDrawOp",value:function(e){var t=this.extendOp(e);this.drawOpTypes.push(t.type)}},{key:"extendOp",value:function(e){var t,r,n=new e(this.app);this.opMap[n.type]=n;var i=n.eventsToListen();if((null===(t=i.activate)||void 0===t?void 0:t.value)&&(null===(r=i.exec)||void 0===r?void 0:r.value))throw new Error("DEV--\x3e 操作不能同时设置activate和exec为true。操作不同同时为命令类操作，及状态类操作");for(var o in i.activate&&i.activate.value||i.exec&&i.exec.value&&this.dispatcher.on("op:"+n.type+":exec",n.execCommand.bind(n)),i)"activate"!==o&&"exec"!==o&&this.dispatcher.on("op:"+o,i[o].value);return n}},{key:"getOpDoc",value:function(e){var t=[];if(void 0!==e)t=this._getOpDoc(e);else{for(var r in this.opMap)(t=t.concat(this._getOpDoc(r))).push("*************************************");t.push("全局事件\n\n用法：app.on('event:add:snapshot', (data: {local: boolean, snapshot: IOPSnapshot}) => {})\n作用： 接收到新的快照时发送此事件\n"),t.push("*************************************")}return t.join("\n\n")}},{key:"_getOpDoc",value:function(e){var t=[];if(this.opMap.hasOwnProperty(e)){var r=this.opMap[e];r.description&&t.push(r.description);var n=r.eventsToListen();for(var i in n){var o=n[i].information,a="op:"+i;"activate"!==i&&"exec"!==i||(a="op:"+r.type+":"+i),t.push("用法：app.emit('"+a+"'"+(o.args.length>0?", "+o.args:"")+")\n作用："+o.message)}}else this.logger.log("DEV--\x3e","op:"+e+"不存在!!!!!!");return t}},{key:"setCurrOp",value:function(e){var t;return H.LOG&&this.logger.log("[白板]","设置当前op为："+e),(null===(t=this.currOp)||void 0===t?void 0:t.type)!==e&&(document.body.style.cursor="default",this.hooks.opChange.call(e),this.currOp=this.opMap[e],this.app.emit("event:appState:change","currTool",e),!0)}},{key:"currOpIsCamera",value:function(){var e;return this.currOp&&-1!==s.cameraSnapshotTypes.indexOf(null===(e=this.currOp)||void 0===e?void 0:e.type)}},{key:"resize",value:function(e,t,r){this.hooks.resize.call(e,t,r)||this.currOp&&"handleResize"in this.currOp&&this.currOp.handleResize(e,t,r)}},{key:"pan",value:function(e,t,r){(this.app.editable||this.currOpIsCamera())&&(this.hooks.pan.call(e,t,r)||this.currOp&&"handlePan"in this.currOp&&this.currOp.handlePan(e,t,r))}},{key:"scale",value:function(e,t,r,n){(this.app.editable||this.currOpIsCamera())&&(this.hooks.scale.call(e,t,r,n)||this.currOp&&"handleScale"in this.currOp&&this.currOp.handleScale(e,t,r,n))}},{key:"mousedown",value:function(e,t,r,n,i){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousedown.call(e,t,r,n,i)||this.currOp&&"handleMouseDown"in this.currOp&&this.currOp.handleMouseDown(e,t,r,n,i))}},{key:"mouseup",value:function(e,t,r,n,i){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mouseup.call(e,t,r,n,i)||this.currOp&&"handleMouseUp"in this.currOp&&this.currOp.handleMouseUp(e,t,r,n,i))}},{key:"mouseleave",value:function(e,t,r,n,i){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mouseleave.call(e,t,r,n,i)||this.currOp&&"handleMouseLeave"in this.currOp&&this.currOp.handleMouseLeave(e,t,r,n,i))}},{key:"mousewheel",value:function(e,t,r,n,i){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousewheel.call(e,t,r,n,i)||this.currOp&&"handleMouseWheel"in this.currOp&&this.currOp.handleMouseWheel(e,t,r,n,i))}},{key:"mousemove",value:function(e,t,r,n,i){(this.app.editable||this.currOpIsCamera())&&(this.hooks.mousemove.call(e,t,r,n,i)||this.currOp&&"handleMouseMove"in this.currOp&&this.currOp.handleMouseMove(e,t,r,n,i))}},{key:"click",value:function(e,t,r,n,i){this.app.editable&&(this.hooks.click.call(e,t,r,n,i)||this.currOp&&"handleClick"in this.currOp&&this.currOp.handleClick(e,t,r,n,i))}},{key:"keyup",value:function(e){this.app.editable&&(this.hooks.keyup.call(e)||this.currOp&&"handleKeyUp"in this.currOp&&this.currOp.handleKeyUp(e))}},{key:"keydown",value:function(e){this.app.editable&&(this.hooks.keydown.call(e)||this.currOp&&"handleKeyDown"in this.currOp&&this.currOp.handleKeyDown(e))}},{key:"draw",value:function(e,t,r){try{var n=e.data.type;this.opMap[n]&&this.opMap[n].draw(e,t,r)}catch(e){this.logger.warn("[白板] opsManager.draw error",e)}}},{key:"preview",value:function(e,t,r){try{var n=e.data.type;this.opMap[n].preview(e,t,r)}catch(e){this.logger.warn("[白板] opsManager.preview error",e)}}},{key:"hide",value:function(e,t,r){try{var n=e.data.type;this.opMap[n]&&this.opMap[n].hide(e,t,r)}catch(e){this.logger.warn("[白板] opsManager.hide error",e)}}},{key:"mergePartial",value:function(e,t){var r=e.data.type;return this.opMap[r]?this.opMap[r].mergePartial(e,t):(G.has(r)||(this.logger.error("[白板] 找不到type为"+r+"的教具类型",(0,n.default)(e)),G.add(r)),e)}},{key:"mergeTwoPartial",value:function(e,t){var r={opId:e.opId,data:e.data};for(var n in t.data)Array.isArray(t.data[n])&&Array.isArray(r.data[n])?r.data[n]=r.data[n].concat(t.data[n]):r.data[n]=t.data[n];return r}},{key:"hasOpType",value:function(e){return this.opMap.hasOwnProperty(e)}},{key:"resetUndoRedoCount",value:function(){this.opMap.undo.resetCount(),this.opMap.redo.resetCount()}},{key:"destroy",value:function(){for(var e in this.opMap)this.opMap[e]&&"function"==typeof this.opMap[e].destroy&&this.opMap[e].destroy()}},{key:"logger",get:function(){return this.app.logger}},{key:"currPage",get:function(){return this.currBoard.pages[this.currBoard.currIndex]}},{key:"currBoard",get:function(){return this.app.room.boards[this.app.room.currIndex]}},{key:"drawOpsOfPage",get:function(){return this.currPage.drawOpQueue||{}}},{key:"selectOp",get:function(){return this.opMap.select}},{key:"selectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.selectedOpIds}},{key:"inProgressSelectedOpIds",get:function(){return this.currOp!==this.opMap.select?[]:this.selectOp.inProgressSelectedOpIds}}]),e}();t.default=Q},function(e,t,r){t.__esModule=!0,t.Tapable=r(259),t.SyncHook=r(263),t.SyncBailHook=r(185),t.SyncWaterfallHook=r(264),t.SyncLoopHook=r(265),t.AsyncParallelHook=r(266),t.AsyncParallelBailHook=r(267),t.AsyncSeriesHook=r(268),t.AsyncSeriesBailHook=r(269),t.AsyncSeriesWaterfallHook=r(270),t.HookMap=r(271),t.MultiHook=r(272)},function(e,t,r){var n=o(r(31)),i=o(r(9));function o(e){return e&&e.__esModule?e:{default:e}}var a=r(236),s=r(185);function c(){var e=this;this._pluginCompat=new s(["options"]),this._pluginCompat.tap({name:"Tapable camelCase",stage:100},(function(e){e.names.add(e.name.replace(/[- ]([a-z])/g,(function(e,t){return t.toUpperCase()})))})),this._pluginCompat.tap({name:"Tapable this.hooks",stage:200},(function(t){var r=void 0,n=!0,o=!1,a=void 0;try{for(var s,c=(0,i.default)(t.names);!(n=(s=c.next()).done);n=!0){var u=s.value;if(void 0!==(r=e.hooks[u]))break}}catch(e){o=!0,a=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw a}}if(void 0!==r){var l={name:t.fn.name||"unnamed compat plugin",stage:t.stage||0};return t.async?r.tapAsync(l,t.fn):r.tap(l,t.fn),!0}}))}e.exports=c,c.addCompatLayer=function(e){c.call(e),e.plugin=c.prototype.plugin,e.apply=c.prototype.apply},c.prototype.plugin=a.deprecate((function(e,t){if(Array.isArray(e))e.forEach((function(e){this.plugin(e,t)}),this);else if(!this._pluginCompat.call({name:e,fn:t,names:new n.default([e])}))throw new Error("Plugin could not be registered at '"+e+"'. Hook was not found.\nBREAKING CHANGE: There need to exist a hook at 'this.hooks'. To create a compatibility layer for this hook, hook into 'this._pluginCompat'.")}),"Tapable.plugin is deprecated. Use new API on `.hooks` instead"),c.prototype.apply=a.deprecate((function(){for(var e=0;e<arguments.length;e++)arguments[e].apply(this)}),"Tapable.apply is deprecated. Call apply on the plugin directly instead")},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,r){r(262);var n=r(6).Object;e.exports=function(e,t){return n.defineProperties(e,t)}},function(e,t,r){var n=r(8);n(n.S+n.F*!r(17),"Object",{defineProperties:r(120)})},function(e,t,r){var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=r(38),l=new(function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,r=e.onDone,n=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,r){return t(r)},onDone:r,rethrowIfPossible:n})}}]),t}(r(42))),d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(u);e.exports=d},function(e,t,r){var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=r(38),l=new(function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=this,r=e.onError,n=e.onResult,i=e.resultReturns,o=e.rethrowIfPossible;return this.callTapsSeries({onError:function(e,t){return r(t)},onResult:function(e,r,n){var i="";return i+="if("+r+" !== undefined) {\n",i+=t._args[0]+" = "+r+";\n",(i+="}\n")+n()},onDone:function(){return n(t._args[0])},doneReturns:i,rethrowIfPossible:o})}}]),t}(r(42))),d=function(e){function t(e){(0,i.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return r}return(0,s.default)(t,e),(0,o.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncWaterfallHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncWaterfallHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(u);e.exports=d},function(e,t,r){var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=r(38),l=new(function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"content",value:function(e){var t=e.onError,r=e.onDone,n=e.rethrowIfPossible;return this.callTapsLooping({onError:function(e,r){return t(r)},onDone:r,rethrowIfPossible:n})}}]),t}(r(42))),d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"tapAsync",value:function(){throw new Error("tapAsync is not supported on a SyncLoopHook")}},{key:"tapPromise",value:function(){throw new Error("tapPromise is not supported on a SyncLoopHook")}},{key:"compile",value:function(e){return l.setup(this,e),l.create(e)}}]),t}(u);e.exports=d},function(e,t,r){var n=u(r(55)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=r(38),d=new(function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=e.onError,r=e.onDone;return this.callTapsParallel({onError:function(e,r,n,i){return t(r)+i(!0)},onDone:r})}}]),t}(r(42))),p=function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,n.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,r){var n=u(r(55)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=r(38),d=new(function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=e.onError,r=e.onResult,n=e.onDone,i="";return i+="var _results = new Array("+this.options.taps.length+");\n",i+="var _checkDone = () => {\n",i+="for(var i = 0; i < _results.length; i++) {\n",i+="var item = _results[i];\n",i+="if(item === undefined) return false;\n",i+="if(item.result !== undefined) {\n",i+=r("item.result"),i+="return true;\n",i+="}\n",i+="if(item.error) {\n",i+=t("item.error"),i+="return true;\n",i+="}\n",i+="}\n",i+="return false;\n",(i+="}\n")+this.callTapsParallel({onError:function(e,t,r,n){var i="";return i+="if("+e+" < _results.length && ((_results.length = "+(e+1)+"), (_results["+e+"] = { error: "+t+" }), _checkDone())) {\n",i+=n(!0),i+="} else {\n",(i+=r())+"}\n"},onResult:function(e,t,r,n){var i="";return i+="if("+e+" < _results.length && ("+t+" !== undefined && (_results.length = "+(e+1)+"), (_results["+e+"] = { result: "+t+" }), _checkDone())) {\n",i+=n(!0),i+="} else {\n",(i+=r())+"}\n"},onTap:function(e,t,r,n){var i="";return e>0&&(i+="if("+e+" >= _results.length) {\n",i+=r(),i+="} else {\n"),i+=t(),e>0&&(i+="}\n"),i},onDone:n})}}]),t}(r(42))),p=function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,n.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,r){var n=u(r(55)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=r(38),d=new(function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=e.onError,r=e.onDone;return this.callTapsSeries({onError:function(e,r,n,i){return t(r)+i(!0)},onDone:r})}}]),t}(r(42))),p=function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,n.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,r){var n=u(r(55)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=r(38),d=new(function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=e.onError,r=e.onResult,n=e.resultReturns,i=e.onDone;return this.callTapsSeries({onError:function(e,r,n,i){return t(r)+i(!0)},onResult:function(e,t,n){return"if("+t+" !== undefined) {\n"+r(t)+";\n} else {\n"+n()+"}\n"},resultReturns:n,onDone:i})}}]),t}(r(42))),p=function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,n.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,r){var n=u(r(55)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=r(38),d=new(function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"content",value:function(e){var t=this,r=e.onError,n=e.onResult;return e.onDone,this.callTapsSeries({onError:function(e,t,n,i){return r(t)+i(!0)},onResult:function(e,r,n){var i="";return i+="if("+r+" !== undefined) {\n",i+=t._args[0]+" = "+r+";\n",(i+="}\n")+n()},onDone:function(){return n(t._args[0])}})}}]),t}(r(42))),p=function(e){function t(e){(0,o.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));if(e.length<1)throw new Error("Waterfall hooks must have at least one argument");return r}return(0,c.default)(t,e),(0,a.default)(t,[{key:"compile",value:function(e){return d.setup(this,e),d.create(e)}}]),t}(l);(0,n.default)(p.prototype,{_call:{value:void 0,configurable:!0,writable:!0}}),e.exports=p},function(e,t,r){var n=s(r(5)),i=s(r(95)),o=s(r(0)),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){(0,o.default)(this,e),this._map=new i.default,this._factory=t,this._interceptors=[]}return(0,a.default)(e,[{key:"get",value:function(e){return this._map.get(e)}},{key:"for",value:function(e){var t=this.get(e);if(void 0!==t)return t;for(var r=this._factory(e),n=this._interceptors,i=0;i<n.length;i++)r=n[i].factory(e,r);return this._map.set(e,r),r}},{key:"intercept",value:function(e){this._interceptors.push((0,n.default)({factory:function(e,t){return t}},e))}},{key:"tap",value:function(e,t,r){return this.for(e).tap(t,r)}},{key:"tapAsync",value:function(e,t,r){return this.for(e).tapAsync(t,r)}},{key:"tapPromise",value:function(e,t,r){return this.for(e).tapPromise(t,r)}}]),e}();e.exports=c},function(e,t,r){var n=a(r(9)),i=a(r(0)),o=a(r(1));function a(e){return e&&e.__esModule?e:{default:e}}r(38);var s=function(){function e(t){(0,i.default)(this,e),this.hooks=t}return(0,o.default)(e,[{key:"tap",value:function(e,t){var r=!0,i=!1,o=void 0;try{for(var a,s=(0,n.default)(this.hooks);!(r=(a=s.next()).done);r=!0)a.value.tap(e,t)}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"tapAsync",value:function(e,t){var r=!0,i=!1,o=void 0;try{for(var a,s=(0,n.default)(this.hooks);!(r=(a=s.next()).done);r=!0)a.value.tapAsync(e,t)}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"tapPromise",value:function(e,t){var r=!0,i=!1,o=void 0;try{for(var a,s=(0,n.default)(this.hooks);!(r=(a=s.next()).done);r=!0)a.value.tapPromise(e,t)}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"isUsed",value:function(){var e=!0,t=!1,r=void 0;try{for(var i,o=(0,n.default)(this.hooks);!(e=(i=o.next()).done);e=!0)if(i.value.isUsed())return!0}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}return!1}},{key:"intercept",value:function(e){var t=!0,r=!1,i=void 0;try{for(var o,a=(0,n.default)(this.hooks);!(t=(o=a.next()).done);t=!0)o.value.intercept(e)}catch(e){r=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw i}}}},{key:"withOptions",value:function(t){return new e(this.hooks.map((function(e){return e.withOptions(t)})))}}]),e}();e.exports=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.drawCurve=void 0;var n,i=(n=r(41))&&n.__esModule?n:{default:n};t.drawCurve=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;(r>.5||r<=0)&&console.error("k should be between 0 and 0.5"),e.beginPath();for(var n=0;n<t.length;n++)if(void 0!==t[n])for(var i=n+1;i<=t.length;i++)if(i===t.length||void 0===t[i]){o(e,t.slice(n,i),r),n=i;break}};var o=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;if(t.length<=2)2===t.length&&(e.moveTo.apply(e,(0,i.default)(t[0])),e.lineTo.apply(e,(0,i.default)(t[1])));else{e.moveTo.apply(e,(0,i.default)(t[0]));var n=t[0],o=t[1],a=[r*n[0]+(1-r)*o[0],r*n[1]+(1-r)*o[1]];Math.abs(r-.5)>.01&&e.lineTo.apply(e,(0,i.default)(a)),n=o;for(var s=2;s<t.length;s++){o=t[s];var c=[(1-r)*n[0]+r*o[0],(1-r)*n[1]+r*o[1]],u=[r*n[0]+(1-r)*o[0],r*n[1]+(1-r)*o[1]];e.quadraticCurveTo.apply(e,(0,i.default)(n).concat(c)),e.lineTo.apply(e,u),a=u,n=o}e.lineTo.apply(e,(0,i.default)(t[t.length-1]))}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(5)),i=f(r(2)),o=f(r(0)),a=f(r(1)),s=f(r(3)),c=f(r(4)),u=f(r(10)),l=r(18),d=r(36),p=f(r(101));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="move",e.points=[],e.activate=!1,e.description="移动操作工具。内部使用，不提供对外接口",e.idsBeenMoved=[],e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousedown.tap("MousedownPlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseup.tap("MouseupPlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseMove",value:function(e,t,r){if(this.opsManager.currOp instanceof p.default){if(t=Number(t.toFixed(3)),r=Number(r.toFixed(3)),this.activate)return this.points.push([t,r]),this.dispatch(this.getSnapshot(!0,this.idsBeenMoved)),!0;if(!this.isMouseDown&&"nwse-resize"!==document.body.style.cursor&&"nesw-resize"!==document.body.style.cursor)if(this.mouseInSelectedEleBoundary(t,r,this.opsManager.selectedOpIds)||this.opsManager.inProgressSelectedOpIds.length>0)document.body.style.cursor="move";else{var n=(0,d.findOpsUnderMouse)(this.app.camera.scale,[[t,r]],this.drawOpsOfPage,this.opsManager);(0,d.arrayDeduce)(n,this.opsManager.selectedOpIds.concat(this.opsManager.inProgressSelectedOpIds)).length>0?document.body.style.cursor="move":document.body.style.cursor="default"}}}},{key:"handleMouseDown",value:function(e,t,r){if(this.opsManager.currOp instanceof p.default){t=Number(t.toFixed(3)),r=Number(r.toFixed(3));var n=this.opsManager.inProgressSelectedOpIds.concat(this.opsManager.selectOp.lastSelectedOpIds),i=this.mouseInSelectedEleBoundary(t,r,n),o=this.mouseInSelectedEleBoundary(t,r,this.opsManager.selectedOpIds);if(i){var a=n.slice();return this.dispatch(this.opsManager.selectOp.getSnapshot(a)),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=a.slice(),this.points=[[t,r]],this.activate=!0,!0}if(o)return this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=this.opsManager.selectedOpIds,this.points=[[t,r]],this.activate=!0,!0;var s=(0,d.findOpsUnderMouse)(this.app.camera.scale,[[t,r]],this.drawOpsOfPage,this.opsManager);if(s.length>0)return this.dispatch(this.opsManager.selectOp.getSnapshot(s)),this.beginBatch(),document.body.style.cursor="move",this.idsBeenMoved=s.slice(),this.points=[[t,r]],this.activate=!0,!0}this.activate=!1}},{key:"handleMouseUp",value:function(e,t,r){if(this.activate)return this.activate=!1,t=Number(t.toFixed(3)),r=Number(r.toFixed(3)),this.points.push([t,r]),this.dispatch(this.getSnapshot(!1,this.idsBeenMoved)),!0}},{key:"getSnapshot",value:function(e,t){return{type:this.type,sp:this.points[0],ep:this.points[this.points.length-1],dependOn:t.slice(),inProgress:e}}},{key:"mouseInSelectedEleBoundary",value:function(e,t,r){var n=this;if(0===(r=r.filter((function(e){return n.drawOpsOfPage.hasOwnProperty(e)}))).length)return!1;var i=this.opsManager.selectOp.eleContainerPadding,o=r.map((function(e){var t=n.drawOpsOfPage[e];return(0,l.getTransformedBoundary)(n.app.camera.scale,t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)})).reduce((function(e,t){return(0,l.combineBoundary)(e,t)}));return(0,l.pointInRect)({sx:o.sx-i,sy:o.sy-i,w:o.w+2*i,h:o.h+2*i},[e,t])}},{key:"transformOp",value:function(e,t){var r=t.data,i=void 0,o=void 0;Array.isArray(r.points)?(i=r.points[r.points.length-1][0]-r.points[0][0],o=r.points[r.points.length-1][1]-r.points[0][1]):(i=r.ep[0]-r.sp[0],o=r.ep[1]-r.sp[1]);var a=(0,n.default)({},e.data,{dx:i+(e.data.dx||0),dy:o+(e.data.dy||0),inProgress:r.inProgress});return(0,n.default)({},e,{data:a})}}]),t}(u.default);t.default=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=h(r(5)),i=h(r(35)),o=h(r(2)),a=h(r(0)),s=h(r(1)),c=h(r(3)),u=h(r(4)),l=h(r(10)),d=h(r(101)),p=r(18),f=r(128);function h(e){return e&&e.__esModule?e:{default:e}}var m=["text","video"],g=["audio"],v=function(e){function t(){(0,a.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="scale",e.coordinateX=0,e.coordinateY=0,e.boundaryW=1,e.boundaryH=1,e.activate=!1,e.idsBeenScaled=[],e.description="缩放操作工具。内部使用，不提供对外接口",e}return(0,u.default)(t,e),(0,s.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MouseMovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mousedown.tap("MouseMovePlugin",this.handleMouseDown.bind(this)),this.opsManager.hooks.mouseup.tap("MouseMovePlugin",this.handleMouseUp.bind(this))}},{key:"handleMouseDown",value:function(e,t,r){if(this.opsManager.currOp instanceof d.default){var n=this.mousePosTest(t,r);if(document.body.style.cursor=n.cursorSuggestion,!0===n.value)return this.beginBatch(),this.activate=!0,this.coordinateX=n.coordinateX,this.coordinateY=n.coordinateY,this.boundaryW=0===n.w?1:n.w,this.boundaryH=0===n.h?1:n.h,this.idsBeenScaled=this.opsManager.selectedOpIds.slice(),!0}this.activate=!1}},{key:"handleMouseMove",value:function(e,t,r){if(this.opsManager.currOp instanceof d.default){if(this.activate)return this.scaleInfo={scaleX:{coordinate:this.coordinateX,factor:(t-this.coordinateX)/this.boundaryW},scaleY:{coordinate:this.coordinateY,factor:(r-this.coordinateY)/this.boundaryH}},this.dispatch(this.getSnapshot(!0,this.idsBeenScaled)),!0;if(this.opsManager.currOp instanceof d.default&&!this.isMouseDown&&this.opsManager.currOp.selectedOpIds.length>0){var n=this.mousePosTest(t,r);document.body.style.cursor=n.cursorSuggestion}else document.body.style.cursor="default"}}},{key:"handleMouseUp",value:function(e,t,r){if(this.activate&&this.scaleInfo)return this.activate=!1,this.dispatch(this.getSnapshot(!1,this.idsBeenScaled)),this.scaleInfo=void 0,!0}},{key:"mousePosTest",value:function(e,t){var r=this,n=this.opsManager.selectedOpIds;if(0===(n=n.filter((function(e){return r.drawOpsOfPage.hasOwnProperty(e)}))).length)return{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,w:1,h:1};var i=this.opsManager.selectedOpIds.map((function(e){var t=r.drawOpsOfPage[e];return(0,p.getTransformedBoundary)(r.app.camera.scale,t.data.boundary,t.data.dx,t.data.dy,t.data.scaleX,t.data.scaleY)})).reduce((function(e,t){return(0,p.combineBoundary)(e,t)})),o=15;return-1!==f.TouchPlatformArray.indexOf(this.app.platform)&&(o*=2.2),o*=Math.max(1/this.app.camera.zoomFactor,1),(0,p.pointCollideWithPoint)([e,t],[i.sx,i.sy],o)?{value:!0,cursorSuggestion:"nwse-resize",coordinateX:i.sx+i.w,coordinateY:i.sy+i.h,w:-i.w,h:-i.h}:(0,p.pointCollideWithPoint)([e,t],[i.sx+i.w,i.sy],o)?{value:!0,cursorSuggestion:"nesw-resize",coordinateX:i.sx,coordinateY:i.sy+i.h,w:i.w,h:-i.h}:(0,p.pointCollideWithPoint)([e,t],[i.sx,i.sy+i.h],o)?{value:!0,cursorSuggestion:"nesw-resize",coordinateX:i.sx+i.w,coordinateY:i.sy,w:-i.w,h:i.h}:(0,p.pointCollideWithPoint)([e,t],[i.sx+i.w,i.sy+i.h],o)?{value:!0,cursorSuggestion:"nwse-resize",coordinateX:i.sx,coordinateY:i.sy,w:i.w,h:i.h}:{value:!1,cursorSuggestion:"default",coordinateX:0,coordinateY:0,w:i.w,h:i.h}}},{key:"getSnapshot",value:function(e,t){return{type:this.type,inProgress:e,scaleInfo:this._clipScaleInfo(),dependOn:t.slice()}}},{key:"_clipScaleInfo",value:function(){return this.scaleInfo?{scaleX:{coordinate:Number(this.scaleInfo.scaleX.coordinate.toFixed(3)),factor:Number(this.scaleInfo.scaleX.factor.toFixed(3))},scaleY:{coordinate:Number(this.scaleInfo.scaleY.coordinate.toFixed(3)),factor:Number(this.scaleInfo.scaleY.factor.toFixed(3))}}:this.scaleInfo}},{key:"getScaleParameterBySnapshot",value:function(e){var t,r=e.data,n=1,i=1,o=0,a=0,s=(t=Array.isArray(r.scaleList)?r.scaleList[r.scaleList.length-1]:r.scaleInfo).scaleX.factor,c=t.scaleY.factor;return n*=s,i*=c,{dx:o=s*(o-t.scaleX.coordinate)+t.scaleX.coordinate,dy:a=c*(a-t.scaleY.coordinate)+t.scaleY.coordinate,factorX:n,factorY:i}}},{key:"transformOp",value:function(e,t){var r,o,a,s=t.data,c=(null===(r=e.data.scaleX)||void 0===r?void 0:r.factor)||1,u=(null===(o=e.data.scaleY)||void 0===o?void 0:o.factor)||1,l=c,d=u,f=e.data.boundary.sx,h=e.data.boundary.sy,v=(0,p.getTransformedPoint)([f,h],e.data.dx,e.data.dy,e.data.scaleX,e.data.scaleY),y=(0,i.default)(v,2),b=y[0],S=y[1];if(!(a=Array.isArray(s.scaleList)?s.scaleList[s.scaleList.length-1]:s.scaleInfo))return e;var _=a.scaleX.factor,M=a.scaleY.factor;if(l*=_,d*=M,-1!==m.indexOf(e.data.type)){var T=Math.abs(l)/2+Math.abs(d)/2;_=(l*=T/Math.abs(l))/c,M=(d*=T/Math.abs(d))/u}else-1!==g.indexOf(e.data.type)&&(d=1,M=1);var w=(b=_*(b-a.scaleX.coordinate)+a.scaleX.coordinate)-l*f,x=(S=M*(S-a.scaleY.coordinate)+a.scaleY.coordinate)-d*h,I=(0,n.default)({},e.data,{scaleX:{factor:l,coordinate:0},scaleY:{factor:d,coordinate:0},dx:w,dy:x});return"text"!==e.data.type||(I.fontSize=Math.abs(e.data.fontSize*l/c)),(0,n.default)({},e,{data:I})}}]),t}(l.default);t.default=v},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(5)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="delete",e.description="删除元素。",e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"删除当前选中的元素"}},"delete:deleteOps":{value:this.deleteOps.bind(this),information:{args:"opIds: string[]",message:"删除ops"}}}}},{key:"handleKeyDown",value:function(e){var t=e.key.toLocaleLowerCase();if(-1!==["backspace","delete"].indexOf(t))return this.execCommand(),!0}},{key:"deleteOps",value:function(e){Array.isArray(e)&&e.length>0&&this.dispatch({type:this.type,dependOn:e.slice()})}},{key:"execCommand",value:function(){this.opsManager.selectedOpIds.length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type,dependOn:this.opsManager.selectedOpIds.slice()}}},{key:"transformOp",value:function(e,t){var r=(0,n.default)({},e.data,{hidden:!0});return(0,n.default)({},e,{data:r})}}]),t}(u(r(10)).default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(31)),i=d(r(2)),o=d(r(0)),a=d(r(1)),s=d(r(3)),c=d(r(4)),u=d(r(10)),l=r(54);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="undo",e.description="撤销操作",e.idsCouldUndo=new n.default,e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"getCount",value:function(){return this.idsCouldUndo.size}},{key:"registerHooks",value:function(){this.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"z"===e.key.toLocaleLowerCase()&&(this.isKeyDown("control")||this.isKeyDown("command"))&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.idsCouldUndo.clear(),this.emit("event:appState:change","undoCount",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.idsCouldUndo.clear();else{if(e.data.skipUndo||e.data.inProgress||-1!==l.snapshotOutOfNormalFlowTypes.indexOf(e.data.type))return;"undo"===e.data.type?this.idsCouldUndo.delete(e.data.undoOpId):"undo"!==e.data.type&&this.idsCouldUndo.add(e.opId)}this.emit("event:appState:change","undoCount",this.idsCouldUndo.size)}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.idsCouldUndo.size&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",r=new n.default,i=e.length-1;i>=0;i--){var o=e[i],a=o.data.inProgress||o.data.skipUndo||-1!==l.snapshotOutOfNormalFlowTypes.indexOf(o.data.type);if("undo"!==o.data.type&&!a&&!r.has(o.opId)){t=o.opId;break}"undo"===o.data.type&&r.add(o.data.undoOpId)}return{type:this.type,undoOpId:t}}}]),t}(u.default);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(31)),i=d(r(2)),o=d(r(0)),a=d(r(1)),s=d(r(3)),c=d(r(4)),u=d(r(10)),l=r(54);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="redo",e.description="重做操作",e.idsCouldRedo=new n.default,e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"getCount",value:function(){return this.idsCouldRedo.size}},{key:"registerHooks",value:function(){this.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this)),this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){"y"===e.key.toLocaleLowerCase()&&(this.isKeyDown("control")||this.isKeyDown("command"))&&(e.preventDefault(),this.execCommand())}},{key:"resetCount",value:function(){this.idsCouldRedo.clear(),this.emit("event:appState:change","redoCount",0)}},{key:"onOpAdded",value:function(e){if("pageOp"===e.category||"boardOp"===e.category)this.idsCouldRedo.clear();else{if(e.data.inProgress||e.data.skipUndo||-1!==l.snapshotOutOfNormalFlowTypes.indexOf(e.data.type))return;"redo"===e.data.type?this.idsCouldRedo.delete(e.data.redoOpId):"undo"===e.data.type?this.idsCouldRedo.add(e.opId):this.idsCouldRedo.clear()}this.emit("event:appState:change","redoCount",this.idsCouldRedo.size)}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){0!==this.idsCouldRedo.size&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){for(var e=this.opsOfPage,t="",r=0,n=e.length-1;n>=0;n--){var i=e[n];if("undo"===i.data.type&&0===r){t=i.opId;break}"undo"===i.data.type?r--:"redo"===i.data.type?r++:i.data.skipUndo||-1!==l.snapshotOutOfNormalFlowTypes.indexOf(i.data.type)||this.logger.warn("DEV--\x3e","redo操作之前有非undo操作。请查看具体细节",e)}return{type:this.type,redoOpId:t}}}]),t}(u.default);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(14)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="clear",e.description="清空操作",e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"isAvailable",value:function(){return(0,n.default)(this.drawOpsOfPage).length>0}},{key:"registerHooks",value:function(){this.opsManager.hooks.refresh.tap("RefreshPlugin",this.onRefresh.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){(0,n.default)(this.drawOpsOfPage).length>0&&this.dispatch(this.getSnapshot())}},{key:"getSnapshot",value:function(){return{type:this.type}}},{key:"onRefresh",value:function(){var e=(0,n.default)(this.drawOpsOfPage).length>0;this.emit("event:appState:change","clearAvailable",e)}}]),t}(u(r(10)).default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="eraser",e.eraserColor="rgba(230, 100, 100, .4)",e.width=20,e.points=[],e.description="橡皮擦。\n首先使用op:eraser:activate设置画布为橡皮擦模式。具体用法如下：",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"eraser:width":{value:this.setWidth.bind(this),information:{args:"width: number",message:"设置橡皮擦宽度"}},"eraser:color":{value:this.setColor.bind(this),information:{args:"color: Color",message:"设置橡皮擦聚光灯颜色"}}}}},{key:"handleMouseMove",value:function(e,t,r){this.isMouseDown&&(this.points.push([t,r]),this.dispatch(this.getSnapshot()))}},{key:"handleMouseDown",value:function(e,t,r){this.beginBatch(),this.points=[],this.points.push([t,r])}},{key:"handleMouseUp",value:function(e,t,r){this.isMouseDown&&(this.dispatch(this.getSnapshot()),this.points=[])}},{key:"getSnapshot",value:function(){return{type:this.type,points:this.points.slice(),width:this.width}}},{key:"draw",value:function(e,t){t.save(),t.fillStyle="rgb(0, 0, 0)";var r=e.data.points;t.beginPath(),t.globalCompositeOperation="destination-out";for(var n=1;n<r.length;n++)t.moveTo(r[n][0],r[n][1]),t.arc(r[n][0],r[n][1],this.width,0,2*Math.PI,!0);t.fill(),t.restore(),this.drawEraserSignpost(t)}},{key:"drawEraserSignpost",value:function(e){this.opsManager.currOp instanceof t&&this.isMouseDown&&(e.beginPath(),e.arc(this.points[this.points.length-1][0],this.points[this.points.length-1][1],this.width,0,2*Math.PI,!0),e.fillStyle=this.eraserColor,e.fill())}},{key:"setWidth",value:function(e){this.width=e}},{key:"setColor",value:function(e){this.eraserColor=e}}]),t}(c(r(10)).default);t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=_(r(5)),i=_(r(2)),o=_(r(0)),a=_(r(1)),s=_(r(3)),c=_(r(4)),u=_(r(10)),l=r(18),d=_(r(101)),p=r(282),f=_(r(283)),h=r(102),m=_(r(129)),g=r(204),v=r(36),y=r(130),b=r(29),S=_(r(32));function _(e){return e&&e.__esModule?e:{default:e}}var M=function(e){function t(e){(0,o.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));r.type="text",r.dependOn=void 0,r.blurAt=0,r.color="black",r.text="",r.textBeforeEdit="",r.fontSize=h.DEFAULT_FONTSIZE,r.isFocus=!1,r.isNewText=!0,r.description="绘制文字\n首先使用op:text:activate设置画布为文字模式。通过op:text:color, op:text:fontSize, 设置文字的颜色和字体大小。然后画布会监听鼠标动作，生成文本框。具体用法如下：",r.handleTextAreaChange=function(e){var t=e.target.value;t.endsWith("\n")&&(t+="\n"),r.text=t,r.pre.innerText=t||" ",(0,p.setElementsSize)(r.textAreaContainer,r.textArea,r.pre,r.fontSize),r.dispatch(r.getSnapshot(!0))},r.handleTextAreaBlur=function(e){setTimeout((function(){r.opsManager.currPage===r.textFocusAtPage&&r._handleTextAreaBlur()}),0)},r._handleTextAreaBlur=function(){var e=r.opIdToDraw;r.dispatch(r.getSnapshot(!1,r.text===r.textBeforeEdit)),r.isFocus=!1,r.text=" ",(0,p.clearTextArea)(r.textAreaContainer,r.textArea),r.blurAt=Date.now(),r.opsManager.setCurrOp("select"),r.opsManager.selectOp.dispatch(r.opsManager.selectOp.getSnapshot([e]))},r.registerToolbar(new f.default);var n=(0,p.createElements)(),a=n.textAreaContainer,c=n.textArea,u=n.pre;return r.textAreaContainer=a,r.textArea=c,r.pre=u,r.app.on("container:set",(function(){r.app.container.textAreaEl.appendChild(a),r.app.container.textAreaEl.appendChild(u)})),r.app.on("camera:transform",(function(){var e;null===(e=r.toolbar)||void 0===e||e.resize(1/r.app.camera.scale)})),r.textArea.oninput=r.handleTextAreaChange,r.textArea.onblur=r.handleTextAreaBlur,(0,p.setElementsSize)(r.textAreaContainer,r.textArea,r.pre,r.fontSize),r}return(0,c.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.app.on("event:prePageChange",this.handlePrePageChange.bind(this)),this.opsManager.hooks.click.tap("ClickPlugin",this.handleClickExistText.bind(this)),this.opsManager.hooks.selectChange.tap("SelectChangePlugin",this.handleSelectChange.bind(this)),this.opsManager.hooks.enableDrawChange.tap("EnableDrawChange",this.handleEnableDrawChange.bind(this))}},{key:"getIdPrefix",value:function(e,t){return(e+"-"+t).replace(/[\W_]+/g,"-")}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}},"register:toolbar":{value:this.registerToolbar.bind(this),information:{args:"toolbar: IToolbar",message:"自定义工具栏"}},"text:color":{value:this.setColor.bind(this),information:{args:"color: string",message:"设置文本颜色"}},"text:fontsize":{value:this.setFontSize.bind(this),information:{args:"size: number",message:"设置矩形边框颜色"}}}}},{key:"handlePrePageChange",value:function(){this.isFocus&&this._handleTextAreaBlur()}},{key:"handleEnableDrawChange",value:function(e){var t,r;if(e){var n=this.opsManager.selectedOpIds,i=1===n.length&&"text"===this.getOpTypeByOpId(n[0])?n[0]:void 0;if(i&&this.opsManager.currOp instanceof d.default)return this._handleSelectTextOp(i);null===(r=this.toolbar)||void 0===r||r.hide()}else null===(t=this.toolbar)||void 0===t||t.hide()}},{key:"handleSelectChange",value:function(e,t){var r,n=1===e.length&&"text"===this.getOpTypeByOpId(e[0])?e[0]:void 0,i=1===t.length&&"text"===this.getOpTypeByOpId(t[0])?t[0]:void 0;if(n!==i&&i&&this.opsManager.currOp instanceof d.default)return this._handleSelectTextOp(i);null===(r=this.toolbar)||void 0===r||r.hide()}},{key:"_handleSelectTextOp",value:function(e){var t,r=this.drawOpsOfPage[e].data,n=(0,l.getTransformedBoundary)(this.app.camera.scale,r.boundary,r.dx,r.dy,r.scaleX,r.scaleY);return this.color=r.color,this.fontSize=r.fontSize,this.text=r.text,this.isFocus=!1,(0,p.clearTextArea)(this.textAreaContainer,this.textArea),this.isNewText=!1,this.lastSnapshotData=r,this.dependOn=e,null===(t=this.toolbar)||void 0===t?void 0:t.show({left:n.sx,top:n.sy,container:this.app.container.textAreaEl,fontSize:r.fontSize,scale:1/this.app.camera.scale,color:r.color})}},{key:"handleClickExistText",value:function(e,t,r){var i,o;if((0,y.isIosDevice)())return!1;if(this.opsManager.currOp instanceof d.default){var a=this.detectIfClickOnText(t,r);if(a){this.opsManager.selectedOpIds.length>0&&this.opsManager.currOp.dispatch(this.opsManager.currOp.getSnapshot([])),this.opsManager.setCurrOp("text");var s=document.getElementById(this.getIdPrefix(a.board,a.page.toString())+"-"+a.opId+"-pre");null===(i=null==s?void 0:s.parentNode)||void 0===i||i.removeChild(s);var c=a.data;this.isFocus=!0,this.textFocusAtPage=this.opsManager.currPage,this.isNewText=!1,this.lastSnapshotData=c,this.dependOn=a.opId,this.text=c.text||" ",this.textBeforeEdit=this.text,this.textArea.value=this.text,this.pre.innerText=this.text,this.fontSize=c.fontSize,this.color=c.color;var u=(0,l.getTransformedBoundary)(this.app.camera.scale,c.boundary,c.dx,c.dy,c.scaleX,c.scaleY);return(0,p.setElementsStyle)(this.textAreaContainer,this.textArea,this.pre,(0,n.default)({fontSize:c.fontSize,color:c.color},u)),null===(o=this.toolbar)||void 0===o||o.show({left:u.sx,top:u.sy,container:this.app.container.textAreaEl,fontSize:c.fontSize,scale:1/this.app.camera.scale,color:c.color}),this.textArea.focus(),this.beginBatch(),!0}}}},{key:"handleMouseUp",value:function(e,t,r){this.isMouseDown&&this.handleClick(e,t,r)}},{key:"handleMouseMove",value:function(e){this.isFocus?document.body.style.cursor="auto":this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="text":document.body.style.cursor="auto"}},{key:"handleClick",value:function(e,t,r){var n;if((0,y.isIosDevice)())return(0,b.showToast)({msg:"iOS设备暂不支持添加文本",time:3,type:"warn",msgType:S.default.IOS_NOT_SUPPORT_TEXT});this.isFocus||(this.isNewText=!0,this.isFocus=!0,this.textFocusAtPage=this.opsManager.currPage,this.dependOn=void 0,this.text=" ",this.textBeforeEdit=this.text,this.pre.innerText=this.text,(0,p.setElementsStyle)(this.textAreaContainer,this.textArea,this.pre,{fontSize:this.fontSize,color:this.color,sx:t,sy:r}),this.beginBatch(),null===(n=this.toolbar)||void 0===n||n.show({left:t,top:r,container:this.app.container.textAreaEl,fontSize:this.fontSize,scale:1/this.app.camera.scale,color:this.color}),this.textArea.focus())}},{key:"getSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.isNewText?{boundary:this.getBoundaryRect(this.isNewText),type:this.type,color:this.color,text:this.text,fontSize:this.fontSize,inProgress:e,skipUndo:e||t}:{type:this.type,color:this.color,text:this.text,fontSize:this.fontSize,boundary:this.getBoundaryRect(this.isNewText),dependOn:this.dependOn,inProgress:e,skipUndo:e||t}}},{key:"getBoundaryRect",value:function(e){var t=this.workingPre.getBoundingClientRect(),r=t.width,n=t.height;r/=this.app.camera.scale,n/=this.app.camera.scale;var i=void 0;if(e){var o=t.x-this.app.container.left,a=t.y-this.app.container.top;i=this.app.camera.convertToPointInWorld(o,a)}else{var s=this.lastSnapshotData,c=(0,l.getTransformedBoundary)(this.app.camera.scale,s.boundary,s.dx,s.dy,s.scaleX,s.scaleY);i=[c.sx,c.sy]}return{sx:i[0],sy:i[1],w:r,h:n}}},{key:"draw",value:function(e,t,r){if((0,y.isIosDevice)())return this.preview(e,t);var n=r.div,i=e.opId===this.dependOn||e.opId===this.opIdToDraw;if(!this.isFocus||!i){var o=this.app.room.currIndex,a=this.app.room.currBoard.currIndex,s=this.getIdPrefix(o,a.toString())+"-"+e.opId+"-pre";if(!n.querySelector("[id='"+s+"']")){var c=document.createElement("pre");c.style.lineHeight=""+p.DEFAULT_LINEHEIGHT,c.id=s,n.appendChild(c)}var u=n.querySelector("[id='"+s+"']");u?this.drawSnapshot(e.data,u,e.opId):this.logger.warn("[白板] textOp.draw","找不到id为: "+s+" 的pre")}}},{key:"preview",value:function(e,t){var r=e.data,n=(0,l.getTransformedBoundary)(this.app.camera.scale,r.boundary,r.dx,r.dy,r.scaleX,r.scaleY),i=n.sx,o=n.sy,a=p.PADDING*r.fontSize/h.DEFAULT_FONTSIZE;t.save(),t.fillStyle=r.color,t.font=r.fontSize+"px "+m.default.getFontFamily(),t.textAlign="left",t.textBaseline="top",(0,g.printTextInMultiLine)(t,r.text,i+a,o+2*a,r.fontSize*p.DEFAULT_LINEHEIGHT),t.restore()}},{key:"hide",value:function(e,t,r){var n,i=document.getElementById(this.getIdPrefix(e.board,e.page.toString())+"-"+e.opId+"-pre");null===(n=null==i?void 0:i.parentNode)||void 0===n||n.removeChild(i)}},{key:"drawSnapshot",value:function(e,t,r){var n,i,o,a=(0,l.getTransformedBoundary)(this.app.camera.scale,e.boundary,e.dx,e.dy,e.scaleX,e.scaleY),s=a.sx,c=a.sy;(0,p.drawTextSnapshot)(t,{text:e.text,sx:s,sy:c,fontSize:e.fontSize,color:e.color,pxOverBorder:(0,v.getElementPartOutOfContainer)(a,this.app.camera)}),1===this.opsManager.selectedOpIds.length&&this.opsManager.selectedOpIds[0]===r&&(this.fontSize=e.fontSize,this.color=e.color,null===(n=this.toolbar)||void 0===n||n.setFontsize(e.fontSize),null===(i=this.toolbar)||void 0===i||i.setColor(e.color),null===(o=this.toolbar)||void 0===o||o.updatePosition({left:s,top:c}))}},{key:"detectIfClickOnText",value:function(e,t){for(var r in this.drawOpsOfPage)if("text"===this.drawOpsOfPage[r].data.type){var n=this.drawOpsOfPage[r].data,i=(0,l.getTransformedBoundary)(this.app.camera.scale,n.boundary,n.dx,n.dy,n.scaleX,n.scaleY);if((0,l.pointInRect)(i,[e,t]))return this.drawOpsOfPage[r]}}},{key:"setFontSize",value:function(e){this.fontSize!==e&&(this.fontSize=e,this.isNewText=!1,this.lastSnapshotData=this.drawOpsOfPage[this.dependOn].data,this.text=this.lastSnapshotData.text,(0,p.setElementsSize)(this.textAreaContainer,this.textArea,this.workingPre,this.fontSize),this.dispatch(this.getSnapshot(!1)))}},{key:"setColor",value:function(e){this.color!==e&&(this.color=e,this.isNewText=!1,this.lastSnapshotData=this.drawOpsOfPage[this.dependOn].data,this.text=this.lastSnapshotData.text,this.dispatch(this.getSnapshot(!1)))}},{key:"registerToolbar",value:function(e){this.toolbar=e,this.toolbar.onFontSizeChange(this.setFontSize.bind(this)),this.toolbar.onColorChange(this.setColor.bind(this))}},{key:"transformOp",value:function(e,t){return(0,v.transformPropertyOverwriteOp)(e,t)}},{key:"updateFontFamily",value:function(){for(var e=this.app.container.el.getElementsByTagName("textarea"),t=this.app.container.el.getElementsByTagName("pre"),r=0;r<e.length;r++)e[r].style.fontFamily=m.default.getFontFamily();for(var n=0;n<t.length;n++)t[n].style.fontFamily=m.default.getFontFamily()}},{key:"opIdToDraw",get:function(){return this.isNewText?this.opIdForseen(this.type,this.dependOn):this.dependOn}},{key:"workingPre",get:function(){if(this.isFocus)return this.pre;var e=this.app.room.currIndex,t=this.app.room.currBoard.currIndex.toString();return document.getElementById(this.getIdPrefix(e,t)+"-"+this.dependOn+"-pre")}}]),t}(u.default);t.default=M},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_LINEHEIGHT=t.PADDING=t.MIN_WIDTH=void 0,t.createElements=function(){var e=document.createElement("textarea"),t=document.createElement("pre"),r=document.createElement("div");return r.style.position="absolute",r.style.display="none",r.style.outline="1px dashed black",e.style.resize="none",e.style.overflow="hidden",e.style["white-space"]="nowrap",e.style.background="transparent",e.style.fontFamily=o.default.getFontFamily(),e.style.fontSize=i.DEFAULT_FONTSIZE+"px",e.style.transformOrigin="left top",e.style.padding=s+"px",e.style.border="none",e.style.outline="none",e.style.boxSizing="content-box",e.style.lineHeight=""+c,t.style.width="fit-content",t.style.position="absolute",t.style.userSelect="none",t.style.pointerEvents="none",t.style.visibility="hidden",t.style.fontFamily=o.default.getFontFamily(),t.style.fontSize=i.DEFAULT_FONTSIZE+"px",t.style.transformOrigin="left top",t.style.padding=s+"px",t.style.margin="0",t.style.lineHeight=""+c,t.style.boxSizing="border-box",r.appendChild(e),{textAreaContainer:r,textArea:e,pre:t}},t.setElementsStyle=function(e,t,r,n){e.style.display="block",e.style.left=n.sx+"px",e.style.top=n.sy+"px",r.style.left=n.sx+"px",r.style.top=n.sy+"px",t.style.color=n.color,t.style.width=(n.w||a)*i.DEFAULT_FONTSIZE/n.fontSize-2*s+"px",t.style.height=(n.h||n.fontSize+12)*i.DEFAULT_FONTSIZE/n.fontSize-2*s+"px",u(e,t,r,n.fontSize)},t.setElementsSize=u,t.drawTextSnapshot=function(e,t){var r=t.fontSize/i.DEFAULT_FONTSIZE;e.innerText=t.text,e.style.color=t.color,e.style.left=t.sx+"px",e.style.top=t.sy+"px",e.style.position="absolute",e.style.fontFamily=o.default.getFontFamily(),e.style.fontSize=i.DEFAULT_FONTSIZE+"px",e.style.margin="0",e.style.transform="scale("+r+")",e.style.userSelect="none",e.style.transformOrigin="left top",e.style.padding=s+"px",e.style.pointerEvents="none",t.pxOverBorder?e.style.clipPath="inset("+t.pxOverBorder.top/r+"px "+t.pxOverBorder.right/r+"px "+t.pxOverBorder.bottom/r+"px "+t.pxOverBorder.left/r+"px)":e.style.clipPath="none"},t.clearTextArea=function(e,t){t.value="",e.style.display="none"};var n,i=r(102),o=(n=r(129))&&n.__esModule?n:{default:n},a=t.MIN_WIDTH=20,s=t.PADDING=4,c=t.DEFAULT_LINEHEIGHT=1.2;function u(e,t,r,n){r.style.transform="scale("+n/i.DEFAULT_FONTSIZE+")",t.style.transform="scale("+n/i.DEFAULT_FONTSIZE+")",t.style.width=r.clientWidth-2*s+"px",t.style.height=r.clientHeight-2*s+"px",e.style.width=r.clientWidth*n/i.DEFAULT_FONTSIZE+"px",e.style.height=r.clientHeight*n/i.DEFAULT_FONTSIZE+"px"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(0)),i=s(r(1)),o=r(102),a=r(204);function s(e){return e&&e.__esModule?e:{default:e}}r(284);var c="iower-23nsdf090sd",u=function(){function e(){(0,n.default)(this,e),this.fontSize=o.DEFAULT_FONTSIZE,this.color="black",this.fonts=[8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88],this.colors=["rgb(224,32,32)","rgb(250,100,0)","rgb(247,181,0)","rgb(109,212,0)","rgb(68,215,182)","rgb(50,197,255)","rgb(0,145,255)","rgb(98,54,255)","rgb(182,32,224)","rgb(109,114,120)","rgb(0,0,0)","rgb(255,255,255)"],this.fontInputPrevValue="",this.colorCells=[],this.colorPlatteOpen=!1,this.toolbarContainer=document.createElement("div"),this.toolbarContainer.style.pointerEvents="auto",this.toolbarContainer.className="text-toolbar",this.toolbarContainer.id=c,this.colorBtn=document.createElement("div"),this.colorBtn.innerText="",this.colorBtn.className="color flex-cell";var t=document.createElement("span");this.colorBtn.appendChild(t),this.colorPlatteContainer=document.createElement("div"),this.colorPlatteContainer.className="platte-container",this.colorPlatteContainer.onmousemove=function(e){e.stopPropagation()};for(var r=0;r<this.colors.length;r++){var i=document.createElement("div");i.className="color-cell",i.style.backgroundColor=this.colors[r],"rgb(255,255,255)"===this.colors[r]&&(i.style.border="1px solid #D9D9DB"),this.colorPlatteContainer.appendChild(i),this.colorCells.push(i)}this.fontInput=document.createElement("input"),this.fontInput.className="fontsize input",this.fontIncBtn=document.createElement("div"),this.fontIncBtn.className="fontsize inc flex-cell";var a=document.createElement("span");a.innerText="+",this.fontIncBtn.appendChild(a),this.fontDecBtn=document.createElement("div"),this.fontDecBtn.className="fontsize dec flex-cell";var s=document.createElement("span");s.innerText="-",this.fontDecBtn.appendChild(s),this.toolbarContainer.appendChild(this.fontInput),this.toolbarContainer.appendChild(this.fontIncBtn),this.toolbarContainer.appendChild(this.fontDecBtn),this.toolbarContainer.appendChild(this.colorBtn),this.toolbarContainer.appendChild(this.colorPlatteContainer),this._registerEvents(),this._stopPropagation()}return(0,i.default)(e,[{key:"show",value:function(e){var t=e.left,r=e.top,n=e.container,i=e.fontSize,o=e.color,a=e.scale;this.setFontsize(i),this.setColor(o),document.getElementById(c)||n.appendChild(this.toolbarContainer),this.toolbarContainer.style.display="flex",this.toolbarContainer.style.transformOrigin="left bottom",this.toolbarContainer.style.transform="scale("+a+")",this.colorPlatteContainer.style.display="none",this.updatePosition({left:t,top:r})}},{key:"resize",value:function(e){this.toolbarContainer.style.transform="scale("+e+")"}},{key:"updatePosition",value:function(e){var t=e.left,r=e.top;this.toolbarContainer.style.left=t-23+"px",this.toolbarContainer.style.top=r-78+"px"}},{key:"hide",value:function(){this.toolbarContainer.style.display="none"}},{key:"setFontsize",value:function(e){this.fontSize=e,this.fontInputPrevValue=Math.round(e).toString(),this.fontInput.value=this.fontInputPrevValue}},{key:"setColor",value:function(e){this.color=e,this.colorBtn.firstChild.style.backgroundColor=this.color,this.setColorPlatteState(!1)}},{key:"setColorPlatteState",value:function(e){this.colorPlatteOpen=e,this.colorPlatteContainer.style.display=e?"flex":"none"}},{key:"onFontSizeChange",value:function(e){this.fontSizeCb=e}},{key:"onColorChange",value:function(e){this.colorCb=e}},{key:"_registerEvents",value:function(){for(var e=this,t=function(t){e.colorCells[t].onclick=function(r){e.setColor(e.colors[t]),e.colorCb&&e.colorCb(e.color)}},r=0;r<this.colorCells.length;r++)t(r);this.colorBtn.onclick=function(t){e.setColorPlatteState(!e.colorPlatteOpen)},this.fontIncBtn.onclick=function(t){e.fontSize<a.MAX_FONT_SIZE&&e._sendFontChangeCommand(Math.min(e.fontSize+8,a.MAX_FONT_SIZE))},this.fontDecBtn.onclick=function(t){e.fontSize>a.MIN_FONT_SIZE&&e._sendFontChangeCommand(Math.max(e.fontSize-8,a.MIN_FONT_SIZE))};var n=function(t){var r=e.fontInput.value;if(""!==r){var n=(0,a.testFontSizeText)(r),i=void 0;i="exceed_max"===n?a.MAX_FONT_SIZE:"exceed_min"===n?a.MIN_FONT_SIZE:Number(r),e.fontInput.value=i,e.fontInputPrevValue=i.toString(),e._sendFontChangeCommand(e.fontInput.value),t&&e.fontInput.blur()}};this.fontInput.onkeydown=function(e){e.stopPropagation(),"Enter"===e.key&&n(!0)},this.fontInput.onblur=function(){n(!1)},this.fontInput.oninput=function(t){var r=t.target.value;r=r.replace(/\D/g,""),e.fontInput.value=r}}},{key:"_sendFontChangeCommand",value:function(e){var t="string"==typeof e?Number(e):e;this.setFontsize(t),this.fontSizeCb&&this.fontSizeCb(this.fontSize)}},{key:"_stopPropagation",value:function(){this.toolbarContainer.onmousedown=function(e){e.stopPropagation()},this.toolbarContainer.ontouchstart=function(e){e.stopPropagation()}}}]),e}();t.default=u},function(e,t,r){var n=r(285);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".text-toolbar {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-around;\n\n    position: absolute;\n\n    box-sizing: border-box;\n    height: 48px;\n    margin: 12px 12px 24px;\n\n    -webkit-user-select: none;\n\n       -moz-user-select: none;\n\n        -ms-user-select: none;\n\n            user-select: none;\n    background-color: white;\n    border-radius: 4px;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n    z-index: 7;\n}\n\n    .text-toolbar .flex-cell {\n        display: flex;\n        flex: 1;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        border: none;\n        width: 40px;\n        height: 40px;\n    }\n\n    .text-toolbar .color {\n        border-radius: 12px;\n    }\n\n    .text-toolbar .color span {\n            width: 18px;\n            height: 18px;\n            border-radius: 9px;\n        }\n\n    .text-toolbar .fontsize.input {\n        height: 24px;\n        vertical-align: top;\n        box-sizing: border-box;\n        width: 40px;\n        outline: none;\n        border: 1px solid rgba(0, 0, 0, 0.3);\n        margin: 0 6px 0 8px;\n        text-align: center;\n    }\n\n    .text-toolbar .fontsize.inc, .text-toolbar .fontsize.dec {\n        border-radius: 12px;\n        font-size: 32px;\n        line-height: 24px;\n        text-align: center;\n        vertical-align: top;\n        position: relative;\n        top: -3px;\n    }\n\n    .text-toolbar .platte-container {\n        position: absolute;\n        display: none;\n        flex-direction: row;\n        flex-wrap: wrap;\n\n        align-items: center;\n        justify-content: space-around;\n        box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n\n        bottom: 56px;\n        right: 0;\n        background-color: white;\n        width: 100%;\n    }\n\n    .text-toolbar .platte-container .color-cell {\n            width: 20px;\n            height: 20px;\n            border-radius: 10px;\n            margin: 10px;\n            display: inline-block;\n            box-sizing: border-box\n        }\n\n    .text-toolbar .platte-container .color-cell:hover {\n                cursor: pointer;\n            }",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(14)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="page",e.description="页面相关操作",e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pageChange.tap("pageChangePlugin",this.onPageChange.bind(this))}},{key:"onPageChange",value:function(){return this.emit("event:appState:change","page",{activeIndex:this.opsManager.currBoard.getCurrPageIndex(),pageNames:this.opsManager.currBoard.pageNames.slice(),currPage:this.opsManager.currBoard.currIndex,pagePayloads:this.opsManager.currBoard.payloadOfPages})}},{key:"eventsToListen",value:function(){return{"page:goto":{value:this.goto.bind(this),information:{args:"page: number",message:"跳转至页面"}},"page:add":{value:this.add.bind(this),information:{args:"opt: {insertAfter?: number, payload?: any}",message:"添加页面。默认添加至当前board最后"}},"page:delete":{value:this.delete.bind(this),information:{args:"page: number",message:"删除页面。只有当页面数量大于1时可以删除页面"}}}}},{key:"add",value:function(e){this.dispatch({type:this.type,action:"add",insertAfter:e.insertAfter,payload:e.payload})}},{key:"goto",value:function(e){e!==this.opsManager.currBoard.currIndex&&-1!==this.opsManager.currBoard.pageNames.indexOf(e.toString())&&this.dispatch({type:this.type,action:"goto",page:e})}},{key:"delete",value:function(e){var t=this.opsManager.currBoard.pages;e in t&&(0,n.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",page:e})}}]),t}(u(r(10)).default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=d(r(10)),u=r(131),l=r(18);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="image",e.description="图片操作",e.dispatchImage=function(t,r,n,i){var o=(0,u.getImageProperPosition)(e,r,n),a=o.sx,s=o.sy,c=o.width,l=o.height;i?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:a,sy:s,w:c,h:l}},i):e.dispatch({type:e.type,url:t,boundary:{sx:a,sy:s,w:c,h:l}})},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{"image:upload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        width?: number,\n                        height?: number,\n                        pageName?: string,\n                        boardName?: string\n                    }",message:"上传图片"}}}}},{key:"addImage",value:function(e,t){return(0,u.addImage)(this,e,t)}},{key:"preview",value:function(e,t,r){var n=e.data,i=(0,l.getTransformedBoundary)(this.app.camera.scale,n.boundary,n.dx,n.dy,n.scaleX,n.scaleY);return(0,u.draw)(t,n.url,i,{page:r.page,supportToDataUrl:r.supportToDataUrl,preview:!0})}},{key:"draw",value:function(e,t,r){var n=e.data,i=(0,l.getTransformedBoundary)(this.app.camera.scale,n.boundary,n.dx,n.dy,n.scaleX,n.scaleY);return(0,u.draw)(t,n.url,i,{page:r.page,div:r.div,id:e.opId,type:"image"})}},{key:"hide",value:function(e,t,r){var n,i=r.querySelector("[id='"+e.opId+"']");null===(n=null==i?void 0:i.parentNode)||void 0===n||n.removeChild(i)}}]),t}(c.default);t.default=p},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgwIiBoZWlnaHQ9IjM2MCIgdmlld0JveD0iMCAwIDQ4MCAzNjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0wIDBINDgwVjM2MEgwVjBaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQ3OCAySDJWMzU4SDQ3OFYyWk0wIDBWMzYwSDQ4MFYwSDBaIiBmaWxsPSIjRDlEOURCIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTY2LjI5NCAxMjZIMzE1TDMxNSAxODkuMzg2TDI5NS4wNDkgMTY3LjY0QzI5MS4xNDQgMTYzLjM4NCAyODQuNDU2IDE2My4zMTEgMjgwLjQ2IDE2Ny40ODNMMjM4Ljc5MiAyMTAuOTc3TDIxOS45MTcgMTkxLjU3MkMyMTYuNzg0IDE4OC4zNTEgMjExLjYxMyAxODguMzQxIDIwOC40NjggMTkxLjU1MUwxNjcuMzM4IDIzMy41MjlIMTY2LjI5NEwxNjYuMjk0IDEyNlpNMTY2LjI5NCAyNDEuNTI5QzE2NC40NzggMjQxLjUyOSAxNjIuODAzIDI0MC45MjQgMTYxLjQ2IDIzOS45MDRIMTYxLjA5MkwxNjEuMjUyIDIzOS43NDFDMTU5LjQ0NyAyMzguMjc0IDE1OC4yOTQgMjM2LjAzNiAxNTguMjk0IDIzMy41MjlWMTI2QzE1OC4yOTQgMTIxLjU4MiAxNjEuODc2IDExOCAxNjYuMjk0IDExOEgzMTVDMzE5LjQxOCAxMTggMzIzIDEyMS41ODIgMzIzIDEyNlYyMzMuNTI5QzMyMyAyMzcuOTQ4IDMxOS40MTggMjQxLjUyOSAzMTUgMjQxLjUyOUgxNjYuMjk0Wk0yMDEgMTcxLjgwNEMyMDkuMjg0IDE3MS44MDQgMjE2IDE2NS4wODggMjE2IDE1Ni44MDRDMjE2IDE0OC41MiAyMDkuMjg0IDE0MS44MDQgMjAxIDE0MS44MDRDMTkyLjcxNiAxNDEuODA0IDE4NiAxNDguNTIgMTg2IDE1Ni44MDRDMTg2IDE2NS4wODggMTkyLjcxNiAxNzEuODA0IDIwMSAxNzEuODA0WiIgZmlsbD0iI0U2RTdFQiIvPgo8L3N2Zz4K"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(14)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="board",e.description="board相关操作",e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.boardChange.tap("boardChangePlugin",this.onBoardChange.bind(this))}},{key:"onBoardChange",value:function(){var e=this;setTimeout((function(){return e.emit("event:appState:change","board",{boardNames:(0,n.default)(e.app.room.boards),boardDisplayNames:e.app.room.getBoardDisplayNames(),currBoard:e.app.room.currIndex,currBoardDisplayName:e.app.room.currBoard.displayName})}),0)}},{key:"eventsToListen",value:function(){return{"board:goto":{value:this.goto.bind(this),information:{args:"boardName: string",message:"跳转至board。若board不存在，则创建board"}},"board:add":{value:this.add.bind(this),information:{args:"displayName: string, boardName: string, pageCount: number, opt?: {\n                        width: number,\n                        height: number,\n                        template: string,\n                        offset?: number\n                    }",message:"创建[pageCount]页数的board"}},"board:delete":{value:this.delete.bind(this),information:{args:"boardName: string",message:"删除board。只有当board数量大于1时可以删除board"}}}}},{key:"goto",value:function(e){e!==this.app.room.currIndex&&this.dispatch({type:this.type,action:"goto",boardName:e})}},{key:"add",value:function(e,t,r,n){n?this.dispatch({type:this.type,action:"add",boardName:t,displayName:e,pageCount:r,w:n.width,h:n.height,tmpl:n.template,offset:n.offset?n.offset:0}):this.dispatch({type:this.type,action:"add",boardName:t,displayName:e,pageCount:r})}},{key:"delete",value:function(e){var t=this.app.room.boards;e in t&&(0,n.default)(t).length>1&&this.dispatch({type:this.type,action:"delete",boardName:e})}}]),t}(u(r(10)).default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.COPY_PASTE_SHIFT=void 0;var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=d(r(10)),u=d(r(291)),l=r(36);function d(e){return e&&e.__esModule?e:{default:e}}var p=t.COPY_PASTE_SHIFT=50,f=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="duplicate",e.description="拷贝drawable快照",e.copiedSnapshotArray=[],e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.keydown.tap("KeydownPlugin",this.handleKeyDown.bind(this))}},{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"复制当前选中的元素"}}}}},{key:"handleKeyDown",value:function(e){var t=this,r=e.key.toLocaleLowerCase();if("c"===r&&(this.isKeyDown("control")||this.isKeyDown("command"))&&this.opsManager.selectedOpIds.length>0){e.preventDefault();var n=(0,l.filterNonMediaOpIds)(this,this.opsManager.selectedOpIds);return this.copiedSnapshotArray=(0,u.default)(n.map((function(e){return t.drawOpsOfPage[e]}))),!0}if("v"===r&&(this.isKeyDown("control")||this.isKeyDown("command"))&&this.copiedSnapshotArray.length>0)return e.preventDefault(),this.execCommand(this.copiedSnapshotArray.slice()),!0}},{key:"execCommand",value:function(e){var t=(0,l.filterNonMediaOpIds)(this,this.opsManager.selectedOpIds);if(t.length>0||e&&e.length>0){var r=this.getSnapshot(t,e);this.dispatch(r);var n=r.duplicates.map((function(e){return e.opId}));this.opsManager.selectOp.dispatch(this.opsManager.selectOp.getSnapshot(n))}}},{key:"getSnapshot",value:function(e,t){var r=this,n=!!t;if(!t){var i=e;t=[];for(var o=0;o<i.length;o++){var a=i[o];if(this.drawOpsOfPage.hasOwnProperty(a)){var s=this.drawOpsOfPage[a];t.push(s)}}}return t=t.map((function(e){return(e=(0,u.default)(e)).data.dx=(e.data.dx?e.data.dx:0)+p,e.data.dy=(e.data.dy?e.data.dy:0)+p,e.opId=r.opsManager.currPage.getNextOpId(!0),e})),n&&(this.copiedSnapshotArray=t.slice()),{type:this.type,duplicates:t}}}]),t}(c.default);t.default=f},function(e,t,r){(function(e,r){var n="[object Arguments]",i="[object Function]",o="[object GeneratorFunction]",a="[object Map]",s="[object Set]",c=/\w*$/,u=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,d={};d[n]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object DataView]"]=d["[object Boolean]"]=d["[object Date]"]=d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d[a]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d[s]=d["[object String]"]=d["[object Symbol]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Error]"]=d[i]=d["[object WeakMap]"]=!1;var p="object"==typeof e&&e&&e.Object===Object&&e,f="object"==typeof self&&self&&self.Object===Object&&self,h=p||f||Function("return this")(),m=t&&!t.nodeType&&t,g=m&&"object"==typeof r&&r&&!r.nodeType&&r,v=g&&g.exports===m;function y(e,t){return e.set(t[0],t[1]),e}function b(e,t){return e.add(t),e}function S(e,t,r,n){var i=-1,o=e?e.length:0;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function _(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function M(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function T(e,t){return function(r){return e(t(r))}}function w(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var x,I=Array.prototype,E=Function.prototype,A=Object.prototype,C=h["__core-js_shared__"],k=(x=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"",O=E.toString,N=A.hasOwnProperty,R=A.toString,P=RegExp("^"+O.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),D=v?h.Buffer:void 0,j=h.Symbol,L=h.Uint8Array,z=T(Object.getPrototypeOf,Object),U=Object.create,B=A.propertyIsEnumerable,F=I.splice,V=Object.getOwnPropertySymbols,H=D?D.isBuffer:void 0,$=T(Object.keys,Object),W=he(h,"DataView"),Y=he(h,"Map"),G=he(h,"Promise"),Q=he(h,"Set"),q=he(h,"WeakMap"),J=he(Object,"create"),Z=be(W),K=be(Y),X=be(G),ee=be(Q),te=be(q),re=j?j.prototype:void 0,ne=re?re.valueOf:void 0;function ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function oe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ae(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function se(e){this.__data__=new oe(e)}function ce(e,t,r){var n=e[t];N.call(e,t)&&Se(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function ue(e,t){for(var r=e.length;r--;)if(Se(e[r][0],t))return r;return-1}function le(e,t,r,u,l,p,f){var h;if(u&&(h=p?u(e,l,p,f):u(e)),void 0!==h)return h;if(!xe(e))return e;var m=_e(e);if(m){if(h=function(e){var t=e.length,r=e.constructor(t);return t&&"string"==typeof e[0]&&N.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!t)return function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(e,h)}else{var g=ge(e),v=g==i||g==o;if(Te(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if("[object Object]"==g||g==n||v&&!p){if(_(e))return p?e:{};if(h=function(e){return"function"!=typeof e.constructor||ye(e)?{}:xe(t=z(e))?U(t):{};var t}(v?{}:e),!t)return function(e,t){return pe(e,me(e),t)}(e,function(e,t){return e&&pe(t,Ie(t),e)}(h,e))}else{if(!d[g])return p?e:{};h=function(e,t,r,n){var i,o=e.constructor;switch(t){case"[object ArrayBuffer]":return de(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return function(e,t){var r=t?de(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var r=t?de(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case a:return function(e,t,r){return S(t?r(M(e),!0):M(e),y,new e.constructor)}(e,n,r);case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,c.exec(e));return t.lastIndex=e.lastIndex,t}(e);case s:return function(e,t,r){return S(t?r(w(e),!0):w(e),b,new e.constructor)}(e,n,r);case"[object Symbol]":return i=e,ne?Object(ne.call(i)):{}}}(e,g,le,t)}}f||(f=new se);var T=f.get(e);if(T)return T;if(f.set(e,h),!m)var x=r?function(e){return function(e,t,r){var n=t(e);return _e(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,Ie,me)}(e):Ie(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r););}(x||e,(function(n,i){x&&(n=e[i=n]),ce(h,i,le(n,t,r,u,i,e,f))})),h}function de(e){var t=new e.constructor(e.byteLength);return new L(t).set(new L(e)),t}function pe(e,t,r,n){r||(r={});for(var i=-1,o=t.length;++i<o;){var a=t[i],s=n?n(r[a],e[a],a,r,e):void 0;ce(r,a,void 0===s?e[a]:s)}return r}function fe(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function he(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!xe(e)||(t=e,k&&k in t))&&(we(e)||_(e)?P:u).test(be(e));var t}(r)?r:void 0}ie.prototype.clear=function(){this.__data__=J?J(null):{}},ie.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ie.prototype.get=function(e){var t=this.__data__;if(J){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return N.call(t,e)?t[e]:void 0},ie.prototype.has=function(e){var t=this.__data__;return J?void 0!==t[e]:N.call(t,e)},ie.prototype.set=function(e,t){return this.__data__[e]=J&&void 0===t?"__lodash_hash_undefined__":t,this},oe.prototype.clear=function(){this.__data__=[]},oe.prototype.delete=function(e){var t=this.__data__,r=ue(t,e);return!(r<0||(r==t.length-1?t.pop():F.call(t,r,1),0))},oe.prototype.get=function(e){var t=this.__data__,r=ue(t,e);return r<0?void 0:t[r][1]},oe.prototype.has=function(e){return ue(this.__data__,e)>-1},oe.prototype.set=function(e,t){var r=this.__data__,n=ue(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},ae.prototype.clear=function(){this.__data__={hash:new ie,map:new(Y||oe),string:new ie}},ae.prototype.delete=function(e){return fe(this,e).delete(e)},ae.prototype.get=function(e){return fe(this,e).get(e)},ae.prototype.has=function(e){return fe(this,e).has(e)},ae.prototype.set=function(e,t){return fe(this,e).set(e,t),this},se.prototype.clear=function(){this.__data__=new oe},se.prototype.delete=function(e){return this.__data__.delete(e)},se.prototype.get=function(e){return this.__data__.get(e)},se.prototype.has=function(e){return this.__data__.has(e)},se.prototype.set=function(e,t){var r=this.__data__;if(r instanceof oe){var n=r.__data__;if(!Y||n.length<199)return n.push([e,t]),this;r=this.__data__=new ae(n)}return r.set(e,t),this};var me=V?T(V,Object):function(){return[]},ge=function(e){return R.call(e)};function ve(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||l.test(e))&&e>-1&&e%1==0&&e<t}function ye(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||A)}function be(e){if(null!=e){try{return O.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Se(e,t){return e===t||e!=e&&t!=t}(W&&"[object DataView]"!=ge(new W(new ArrayBuffer(1)))||Y&&ge(new Y)!=a||G&&"[object Promise]"!=ge(G.resolve())||Q&&ge(new Q)!=s||q&&"[object WeakMap]"!=ge(new q))&&(ge=function(e){var t=R.call(e),r="[object Object]"==t?e.constructor:void 0,n=r?be(r):void 0;if(n)switch(n){case Z:return"[object DataView]";case K:return a;case X:return"[object Promise]";case ee:return s;case te:return"[object WeakMap]"}return t});var _e=Array.isArray;function Me(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!we(e)}var Te=H||function(){return!1};function we(e){var t=xe(e)?R.call(e):"";return t==i||t==o}function xe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ie(e){return Me(e)?function(e,t){var r=_e(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Me(e)}(e)&&N.call(e,"callee")&&(!B.call(e,"callee")||R.call(e)==n)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=r.length,o=!!i;for(var a in e)!N.call(e,a)||o&&("length"==a||ve(a,i))||r.push(a);return r}(e):function(e){if(!ye(e))return $(e);var t=[];for(var r in Object(e))N.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}r.exports=function(e){return le(e,!0,!0)}}).call(this,r(73),r(119)(e))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(41)),i=f(r(5)),o=f(r(2)),a=f(r(0)),s=f(r(1)),c=f(r(3)),u=f(r(4)),l=r(18),d=f(r(198)),p=f(r(48));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,a.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="pen-arrow",e.description="带箭头的涂鸦操作工具。\n首先使用op:pen-arrow:activate设置画布为涂鸦模式。通过op:pen-arrow:lineWidth, op:pen-arrow:color设置涂鸦的宽度和颜色。然后画布会监听鼠标动作，生成涂鸦。具体用法如下：",e}return(0,u.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getArrowPoints",value:function(e,t,r){var n=[];if(e.length<3||!e[0]||!e[1]||!e[2])return n;if(e.length>1&&r){for(var i=e[e.length-1],o=void 0,a=e.length-2;a>=0&&a>=e.length-30;a--){var s=e[a];if(Math.abs(s[0]-i[0])+Math.abs(s[1]-i[1])>1){o=s;break}}void 0===o&&(o=e[a]);var c=[o,i],u=(0,l.getLineCoef)(c);if((0,l.dist)(c[0],c[1])>1){var d=c[1][0]-c[0][0]>0?(0,l.getXFromCoefAndOffset)(c[1],u,1):2*c[1][0]-(0,l.getXFromCoefAndOffset)(c[1],u,1),p=c[1][0]-c[0][0]==0?c[1][1]+(c[1][1]-c[0][1]>0?1:-1):(0,l.getLineFromPointsY)(c,d);c.push([d,p])}n=(0,l.getArrowPoints)(t+1,c)}return n}},{key:"getSnapshot",value:function(e){var t=this.points,r=!e&&t.length>2,n=this.getArrowPoints(t,this.lineWidth,r),o=this.opsManager.currPage.getOpId(),a=this.app.room.opIdSnapshotMap[o];if(!a||!a.snapshot.hasOwnProperty("category"))return(0,i.default)({points:t.slice(),arrowPoints:n,total:t.length},this.getFreeDrawCommonProperty({inProgress:e}));var s={boundary:this.getBoundaryRectOfFreeDraw()};return this.sampleSeq>0&&e?(0,i.default)((0,i.default)({},s),{points:t.slice(t.length-p.default.pointsPerBatch),total:t.length}):this.sampleSeq>0?(0,i.default)((0,i.default)({},s),{points:t.slice(t.length-p.default.pointsPerBatch),arrowPoints:n,inProgress:e,total:t.length}):(0,i.default)({points:t.slice(),arrowPoints:n,total:t.length},this.getFreeDrawCommonProperty({inProgress:e}))}},{key:"draw",value:function(e,t){t.save();var r=e.data,i=this._draw(e,t);if(t.strokeStyle=r.color,t.lineWidth=r.lineWidth,t.globalAlpha=r.opacity,t.stroke(),3===r.arrowPoints.length){var o=this.getArrowPoints(i,r.lineWidth,!0);3===o.length&&(t.beginPath(),t.moveTo.apply(t,(0,n.default)(o[0])),t.lineTo.apply(t,(0,n.default)(o[1])),t.lineTo.apply(t,(0,n.default)(o[2])),t.fillStyle=r.color,t.fill())}t.restore()}}]),t}(d.default);t.default=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(41)),i=d(r(5)),o=d(r(2)),a=d(r(0)),s=d(r(1)),c=d(r(3)),u=d(r(4)),l=r(18);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,a.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.type="line-arrow",e.description="绘制带箭头线段。\n首先使用op:line-arrow:activate设置画布为线段模式。通过op:line-arrow:lineWidth, op:line-arrow:color设置线段的宽度和颜色。然后画布会监听鼠标动作，生成线段。具体用法如下：",e}return(0,u.default)(t,e),(0,s.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"getSnapshot",value:function(e){var t=!e&&this.points.length>2,r=[];if(this.points.length>1&&t){var n=[this.sp,this.ep];r=(0,l.getArrowPoints)(this.lineWidth+1,n)}return(0,i.default)({arrowPoints:r},this.getTwoPointShapeCommonProperty({inProgress:e}))}},{key:"draw",value:function(e,t){t.save();var r=e.data,i=this.getStartEndPointFromSnapshot(r),o=i.sp,a=i.ep,s=(0,l.getTransformedPoint)(o,r.dx,r.dy,r.scaleX,r.scaleY),c=(0,l.getTransformedPoint)(a,r.dx,r.dy,r.scaleX,r.scaleY);if(t.beginPath(),t.moveTo.apply(t,(0,n.default)(s)),t.lineTo.apply(t,(0,n.default)(c)),t.strokeStyle=r.color,t.lineWidth=r.lineWidth,t.globalAlpha=r.opacity,t.stroke(),3===r.arrowPoints.length){var u=(0,l.getArrowPoints)(r.lineWidth+1,[s,c]);t.beginPath(),t.moveTo.apply(t,(0,n.default)(u[0])),t.lineTo.apply(t,(0,n.default)(u[1])),t.lineTo.apply(t,(0,n.default)(u[2])),t.fillStyle=r.color,t.fill()}t.restore()}}]),t}(d(r(200)).default);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(5)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="element-eraser",e.description="删除元素。",e.lastSelectedOpIds=[],e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"postMouseMove",value:function(e){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="url("+r(210)+") 2 13, auto":document.body.style.cursor="auto"}},{key:"postMouseUp",value:function(e){this.postClick(e)}},{key:"postClick",value:function(e){this.dispatch(this.getSelectionSnapshot(!1,[]));var t=this.filterMediaIds(e);t.length>0&&this.dispatch(this.getSnapshot(t)),this.lastSelectedOpIds=[]}},{key:"filterMediaIds",value:function(e){var t=this;return e.filter((function(e){var r=t.opsManager.drawOpsOfPage[e];return!r||!r.data||"audio"!==r.data.type&&"video"!==r.data.type}))}},{key:"getSnapshot",value:function(e){return{type:"element-eraser",dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var r=(0,n.default)({},e.data,{hidden:!0});return(0,n.default)({},e,{data:r})}}]),t}(u(r(201)).default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=d(r(10)),u=d(r(48)),l=r(36);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="laser",e.description="镭射灯",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"registerHooks",value:function(){this.opsManager.hooks.opChange.tap("OpChange",this.handleOpChange.bind(this))}},{key:"handleOpChange",value:function(e){var t;"laser"!==e&&"laser"===(null===(t=this.opsManager.currOp)||void 0===t?void 0:t.type)&&(document.body.style.cursor="default",this.dispatch(this.getSnapshot(!1)))}},{key:"handleMouseLeave",value:function(e,t,r){this.dispatch(this.getSnapshot(!1))}},{key:"handleMouseMove",value:function(e,t,r){this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="none":document.body.style.cursor="auto",this.dispatch(this.getSnapshot(!0,[t,r]))}},{key:"getSnapshot",value:function(e,t){return{type:"laser",point:t,inProgress:e,skipUndo:!0,reuseOpType:"laser",color:u.default.strokeColor,nickname:this.app.nickname}}},{key:"draw",value:function(e,t){var r=e.data;if(!(Date.now()+this.app.ntpTimeDiff-e.time>9e4)){var n=6/this.app.camera.scale;e.data.inProgress&&r.point&&(t.save(),t.beginPath(),t.arc(r.point[0],r.point[1],n,0,2*Math.PI,!0),t.shadowColor="rgba(255, 0, 0, 0.5)",t.shadowBlur=8,t.fillStyle="#ff0000",t.fill(),t.restore(),e.uid!==this.app.account&&this.app.appConfig.showLaserNickname&&(0,l.drawUserName)({ctx:t,account:r.nickname||e.uid,scale:this.app.camera.scale,px:r.point[0],py:r.point[1],bgColor:r.color}))}}}]),t}(c.default);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(5)),i=u(r(2)),o=u(r(0)),a=u(r(1)),s=u(r(3)),c=u(r(4));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="lock",e.description="锁定元素。",e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"eventsToListen",value:function(){return{lock:{value:this.lockOps.bind(this),information:{args:"opIds",message:"锁定元素"}},unlock:{value:this.unlockOps.bind(this),information:{args:"opIds",message:"解锁元素"}}}}},{key:"lockOps",value:function(e){this.dispatch(this.getSnapshot(e,"lock"))}},{key:"unlockOps",value:function(e){this.dispatch(this.getSnapshot(e,"unlock"))}},{key:"getSnapshot",value:function(e,t){return{type:this.type,action:t,dependOn:e.slice()}}},{key:"transformOp",value:function(e,t){var r=(0,n.default)({},e.data,{locked:"lock"===t.data.action});return(0,n.default)({},e,{data:r})}}]),t}(u(r(10)).default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=l(r(10)),u=r(131);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="background",e.description="设置背景操作",e.getBoundaryFromSnapshot=function(t){var r=void 0;if(t.data.hasOwnProperty("imgWidth")){var n=(0,u.getImageProperPosition)(e,t.data.imgWidth,t.data.imgHeight);r={sx:n.sx,sy:n.sy,w:n.width,h:n.height}}else r=t.data.boundary;return r},e.dispatchImage=function(t,r,n,i){var o=(0,u.getBackgroundImagePorperPosition)(e,r,n),a=o.sx,s=o.sy,c=o.width,l=o.height;i?e.dispatchFromPage({type:e.type,url:t,boundary:{sx:a,sy:s,w:c,h:l}},i):e.dispatch({type:e.type,url:t,boundary:{sx:a,sy:s,w:c,h:l}})},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{"background:imageUpload":{value:this.addImage.bind(this),information:{args:"url: string, opts?: {\n                        width?: number,\n                        height?: number,\n                        pageName?: string,\n                        boardName?: string\n                    }",message:"上传背景图片"}}}}},{key:"addImage",value:function(e,t){return(0,u.addImage)(this,e,t)}},{key:"preview",value:function(e,t,r){var n=e.data;return(0,u.draw)(t,n.url,this.getBoundaryFromSnapshot(e),{page:r.page,supportToDataUrl:r.supportToDataUrl,preview:!0})}},{key:"draw",value:function(e,t,r){var n=e.data;return(0,u.draw)(t,n.url,this.getBoundaryFromSnapshot(e),{page:r.page,div:r.div,id:e.opId,type:"background"})}}]),t}(c.default);t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(2)),i=f(r(0)),o=f(r(1)),a=f(r(3)),s=f(r(4)),c=f(r(10)),u=r(56),l=r(88),d=r(29),p=f(r(32));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="pan",e.activate=!1,e.description="平移操作",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.pan.tap("pan",this.handlePan.bind(this))}},{key:"eventsToListen",value:function(){return{activate:{value:!0,information:{args:"",message:"设置工具栏状态为："+this.type}}}}},{key:"handleMouseMove",value:function(e,t,r,n,i){this.app.appConfig.cameraTransformEnabled&&(0,l.shouldDispatch)(this.app)&&(this.activate?document.body.style.cursor="grabbing":this.app.container.isTargetOnContainer(e.target)?document.body.style.cursor="grab":document.body.style.cursor="auto",this.activate&&this.lastPoint&&(this.dispatch(this.getSnapshot(n-this.lastPoint[0],i-this.lastPoint[1])),this.lastPoint=[n,i]))}},{key:"handlePan",value:function(e,t,r){if(this.app.appConfig.cameraTransformEnabled){if((0,l.shouldDispatch)(this.app)||(0,l.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(t,r)),!0;(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:p.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}})}}},{key:"handleMouseDown",value:function(e,t,r,n,i){this.app.appConfig.cameraTransformEnabled&&((0,l.shouldDispatch)(this.app)?(this.activate=!0,this.beginBatch(),this.lastPoint=[n,i]):(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:p.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}}))}},{key:"handleMouseUp",value:function(e,t,r,n,i){this.app.appConfig.cameraTransformEnabled&&(0,l.shouldDispatch)(this.app)&&(this.activate&&this.lastPoint&&(this.dispatch(this.getSnapshot(n-this.lastPoint[0],i-this.lastPoint[1])),this.lastPoint=void 0),this.activate=!1)}},{key:"getSnapshot",value:function(e,t){return(0,u.convertToCameraBoundSnapshot)(this.app.camera,{type:"pan",dx:-e,dy:-t,animate:!1})}}]),t}(c.default);t.default=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(2)),i=f(r(0)),o=f(r(1)),a=f(r(3)),s=f(r(4)),c=f(r(10)),u=r(56),l=r(88),d=r(29),p=f(r(32));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="zoom",e.sp=[0,0],e.description="缩放操作",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousewheel.tap("MousewheelPlugin",this.handleMouseWheel.bind(this)),this.opsManager.hooks.scale.tap("Scale",this.handleScale.bind(this))}},{key:"eventsToListen",value:function(){return{"zoom:in":{value:this.zoomIn.bind(this),information:{args:"",message:"缩放"}},"zoom:out":{value:this.zoomOut.bind(this),information:{args:"",message:"缩放"}},"zoom:to":{value:this.zoomTo.bind(this),information:{args:"scale: number, animate: boolean",message:"缩放"}}}}},{key:"handleScale",value:function(e,t,r,n){this.app.appConfig.cameraTransformEnabled&&((0,l.shouldDispatch)(this.app)?this.app.camera.zoomFactor*t>=10&&t>1||this.app.camera.zoomFactor*t<=.1&&t<1||(this.beginBatch(),this.dispatch(this.getSnapshot(t,!1,[r,n]))):(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:p.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}}))}},{key:"handleMouseWheel",value:function(e,t,r,n,i){if(this.app.appConfig.cameraTransformEnabled)if((0,l.shouldDispatch)(this.app)){var o=void 0,a=this.app.appConfig.zoomSensitivity;if("gesturestart"!==e.type)if("gestureend"!==e.type){if("gesturechange"===e.type){if(void 0===this.gestureLastScale)return void(this.gestureLastScale=e.scale);o=e.scale/this.gestureLastScale,this.gestureLastScale=e.scale}else a=(1-("DOMMouseScroll"===e.type?1.1:Math.abs(e.deltaY)<20?Math.max(Math.min(Math.pow(Math.abs(e.deltaY)/4,2),.8),.1):Math.max(Math.min(Math.pow(Math.abs(e.deltaY)/150,2),1),.5)))*(1-a)+a,o="DOMMouseScroll"===e.type?e.detail>0?a:1/a:e.deltaY>0?a:1/a;this.app.camera.zoomFactor*o>=10&&o>1||this.app.camera.zoomFactor*o<=.1&&o<1||this.isMouseDown||this.app.container.isTargetOnContainer(e.target)&&(this.beginBatch(),this.dispatch(this.getSnapshot(o,!1,[n,i])))}else this.gestureLastScale=void 0;else this.gestureLastScale=e.scale}else(0,d.showToast)({msg:"你当前处于视角跟随状态",type:"info",msgType:p.default.NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER,args:{broadcasterName:this.app.vision.broadcasterName,broadcaster:this.app.vision.broadcaster}})}},{key:"zoomIn",value:function(){if((0,l.shouldDispatch)(this.app)&&!(this.app.camera.zoomFactor/this.app.appConfig.zoomSensitivity>=10))return this.beginBatch(),this.dispatch(this.getSnapshot(1/this.app.appConfig.zoomSensitivity,!1))}},{key:"zoomOut",value:function(){if((0,l.shouldDispatch)(this.app)&&!(this.app.camera.zoomFactor*this.app.appConfig.zoomSensitivity<=.1))return this.beginBatch(),this.dispatch(this.getSnapshot(this.app.appConfig.zoomSensitivity,!1))}},{key:"zoomTo",value:function(e,t){if((0,l.shouldDispatch)(this.app))return this.beginBatch(),this.dispatch(this.getSnapshot(e/this.app.camera.zoomFactor,t))}},{key:"getSnapshot",value:function(e,t,r){return(0,u.convertToCameraBoundSnapshot)(this.app.camera,{type:"zoom",animate:t,center:r,scale:e})}}]),t}(c.default);t.default=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=d(r(10)),u=r(56),l=r(88);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="reset-camera",e.description="重置视角",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,u.convertToCameraBoundSnapshot)(this.app.camera,{type:"reset-camera",animate:e})}}]),t}(c.default);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(35)),i=m(r(2)),o=m(r(0)),a=m(r(1)),s=m(r(3)),c=m(r(4)),u=m(r(10)),l=m(r(199)),d=m(r(210)),p=m(r(302)),f=m(r(48)),h=r(36);function m(e){return e&&e.__esModule?e:{default:e}}var g=new Image,v=new Image,y=new Image;g.src=l.default,v.src=d.default,y.src=p.default;var b=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="mouse-pointer",e.description="展示鼠标位置",e.sampleSeq=0,e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.mousemove.tap("MousemovePlugin",this.handleMouseMove.bind(this)),this.opsManager.hooks.mouseleave.tap("MousemovePlugin",this.handleMouseLeave.bind(this))}},{key:"handleMouseMove",value:function(e,t,r){var n;if(this.app.showCursor&&"laser"!==(null===(n=this.opsManager.currOp)||void 0===n?void 0:n.type)){var i=this.app.container.isTargetOnContainer(e.target);this.sampleSeq%6==0&&this.dispatch(this.getSnapshot([t,r],i)),this.sampleSeq+=1}}},{key:"handleMouseLeave",value:function(e,t,r){var n;this.app.showCursor&&"laser"!==(null===(n=this.opsManager.currOp)||void 0===n?void 0:n.type)&&(this.dispatch(this.getSnapshot([t,r],!1)),this.sampleSeq=0)}},{key:"getSnapshot",value:function(e,t){return{type:"mouse-pointer",point:[Number(e[0].toFixed(1)),Number(e[1].toFixed(1))],c:f.default.strokeColor,show:t?1:0,op:this.opsManager.currOp?this.opsManager.currOp.type:"",reuseOpType:"mouse-pointer",nickname:this.app.nickname}}},{key:"preview",value:function(){}},{key:"draw",value:function(e,t){if(!((new Date).valueOf()-e.time>5e3)){var r=e.data;if(e.uid!==this.app.account&&r.show&&r.point){var i=this.getImageByOpType(r.op),o=this.mapPointInsideContainer(r.point[0],r.point[1]),a=(0,n.default)(o,2),s=a[0],c=a[1];-1!==this.opsManager.drawOpTypes.indexOf(r.op)&&(s-=1/this.app.camera.scale,c-=27/this.app.camera.scale);var u=32/this.app.camera.scale;t.drawImage(i,s,c,u,u),this.app.appConfig.showCursorNickname&&(0,h.drawUserName)({ctx:t,account:r.nickname||e.uid,scale:this.app.camera.scale,px:s,py:c,bgColor:r.c})}}}},{key:"mapPointInsideContainer",value:function(e,t){var r=this.app.camera.convertToPointInWorld(0,0),i=(0,n.default)(r,2),o=i[0],a=i[1],s=this.app.camera.convertToPointInWorld(this.app.container.width,this.app.container.height),c=(0,n.default)(s,2),u=c[0],l=c[1];return e<o+30?e=o+30:e>u-25&&(e=u-25),t<a+30?t=a+30:t>l-15&&(t=l-15),[e,t]}},{key:"getImageByOpType",value:function(e){return"element-eraser"===e?v:-1!==this.opsManager.drawOpTypes.indexOf(e)?g:y}}]),t}(u.default);t.default=b},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MzA2MTkyNDQ5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwOTYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU2IDBsNjEyLjY1MDY2NyA1NzMuODI0LTI1MC4yODI2NjcgMjIuNzQxMzMzLTQ1LjQ0IDQuMDk2IDE4LjkwMTMzMyA0MS41NTczMzMgMTUxLjg1MDY2NyAzMzIuNTQ0TDYzMS42OCAxMDI0bC0xNDQuODk2LTMzNi4xMjgtMTguMTc2LTQyLjM2OC0zMy41Nzg2NjcgMzEuNTMwNjY3LTE3Ny43OTIgMTY2Ljc0MTMzM0wyNTYgMCIgcC1pZD0iMjA5NyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=l(r(10)),u=r(56);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="resize-camera",e.description="重置视角",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.resize.tap("ResizePlugin",this.handleResize.bind(this))}},{key:"handleResize",value:function(e,t,r){if(t&&r)if("follower"===this.app.vision.mode)this.app.camera.updateTransParamAndRefresh();else{var n=this.app.camera,i=this.app.camera.getNextCameraBound({type:"resize-camera",width:t,height:r,animate:!1});if(Math.abs(i.centerX-n.centerX)+Math.abs(i.centerY-n.centerY)+Math.abs(i.width-n.width)+Math.abs(i.height-n.height)<1)return;this.dispatch(this.getSnapshot(t,r))}else this.logger.warn("[白板] resize 宽高无效",t,r)}},{key:"getSnapshot",value:function(e,t){return(0,u.convertToCameraBoundSnapshot)(this.app.camera,{type:"resize-camera",width:e,height:t,animate:!1})}}]),t}(c.default);t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=d(r(10)),u=r(56),l=r(88);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="fit-to-content",e.description="缩放至完全包含内容",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,u.convertToCameraBoundSnapshot)(this.app.camera,{type:"fit-to-content",animate:e})}}]),t}(c.default);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=d(r(10)),u=r(56),l=r(88);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="fit-to-doc",e.description="缩放至完全包含文档",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{exec:{value:!0,information:{args:"",message:"执行"+this.type+"事件"}}}}},{key:"execCommand",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if((0,l.shouldDispatch)(this.app)&&(this.app.room.currBoard.currPage.backgroundSnapshot||this.app.room.currBoard.transDocSnapshot))return this.dispatch(this.getSnapshot(e))}},{key:"getSnapshot",value:function(e){return(0,u.convertToCameraBoundSnapshot)(this.app.camera,{type:"fit-to-doc",animate:e})}}]),t}(c.default);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="rect-fill",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({strokeOrFill:"fill",inProgress:e})}}]),t}(c(r(202)).default);t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="ellipse-fill",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"getSnapshot",value:function(e){return this.getTwoPointShapeCommonProperty({strokeOrFill:"fill",inProgress:e})}}]),t}(c(r(203)).default);t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="video",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{"video:insert":{value:this.addMedia.bind(this),information:{args:"url: string, opts: {\n                        width: number,\n                        sourceType: string,\n                        title?: string\n                        pageName?: string\n                        boardName?: string\n                    }",message:"上传视频"}}}}}]),t}(c(r(211)).default);t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(2)),i=u(r(0)),o=u(r(1)),a=u(r(3)),s=u(r(4)),c=u(r(212));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"onSizeChange",value:function(e){this.headerWidget&&this.controlWidget&&(this.headerWidget.style.visibility=e.height>130&&e.width>180?"visible":"hidden",this.controlWidget.style.visibility=e.height>130&&e.width>180?"visible":"hidden")}},{key:"getTitle",value:function(){return this.title?this.title:"视频文件"}},{key:"createControllor",value:function(){var e=document.createElement("div");this.progressController=new c.default(0,{emitEvent:this.isCreator()});var t=this.createControlContainer(),r=this.createPlayWidget(),n=this.createTimeIndicator(),i=this.createVolumeWidget();return e.appendChild(this.progressController.widget),e.appendChild(t),t.appendChild(r),t.appendChild(n),t.appendChild(i),e.style.userSelect="none",e.className="media-control",this.controlWidget=e,e}}],[{key:"getElementWidth",value:function(e,t){return e||t.videoWidth}},{key:"getElementHeight",value:function(e,t){return e/t.videoWidth*t.videoHeight}}]),t}(u(r(213)).default);t.default=l},function(e,t,r){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(311),i)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){var r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=m;var l={},d={};d[o]=function(){return this};var p=Object.getPrototypeOf,f=p&&p(p(I([])));f&&f!==r&&n.call(f,o)&&(d=f);var h=b.prototype=v.prototype=Object.create(d);y.prototype=h.constructor=b,b.constructor=y,b[s]=y.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(h),e},u.awrap=function(e){return{__await:e}},S(_.prototype),_.prototype[a]=function(){return this},u.AsyncIterator=_,u.async=function(e,t,r,n){var i=new _(m(e,t,r,n));return u.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(h),h[s]="Generator",h[o]=function(){return this},h.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},u.values=I,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;w(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}}}function m(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),a=new x(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=M(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=g(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function g(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function v(){}function y(){}function b(){}function S(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(r,i){function o(){return new Promise((function(t,o){!function t(r,i,o,a){var s=g(e[r],e,i);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(u).then((function(e){c.value=e,o(c)}),a)}a(s.arg)}(r,i,t,o)}))}return t=t?t.then(o,o):o()}}function M(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=g(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function I(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(21)),i=c(r(5)),o=c(r(0)),a=c(r(1)),s=c(r(13));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,r,n){var i=this;(0,o.default)(this,e),this.recordTime=0,this.handlePrePageChange=function(e){i.app.room.getPage(i.boardName,i.pageName)&&i.boardName===i.app.room.currIndex&&i.pageName===i.app.room.currBoard.currIndex.toString()&&"delete"!==e.data.action&&i.onPrePageChange(e.uid)},this.handlePlayerPlay=function(){i.boardName===i.app.room.currIndex&&i.pageName===i.app.room.currBoard.currIndex.toString()&&i.onAttributeUpdated(i.data)},this.handlePlayerPause=function(){i.boardName===i.app.room.currIndex&&i.pageName===i.app.room.currBoard.currIndex.toString()&&i.onAttributeUpdated(i.data)},this.handlePlayerSeekTo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;clearTimeout(i.seekToTimer),e>30||i.boardName===i.app.room.currIndex&&i.pageName===i.app.room.currBoard.currIndex.toString()&&(i.media?i.onAttributeUpdated(i.data):i.seekToTimer=setTimeout((function(){i.handlePlayerSeekTo(e+1)}),100))},this.handlePlayerPlaySpeed=function(e){i.onPlaySpeedChange(e)},this.opId=t.opId,this.boardName=t.board,this.pageName=t.page.toString(),this.mediaOwner=t.uid,this.app=r,this.operation=n,this.type=n.type,this.title=t.data.title,this.data=t.data.mediaData||{play:!1,seek:0,ended:!1},this.app.player&&(this.app.on("event:player:play",this.handlePlayerPlay),this.app.on("event:player:pause",this.handlePlayerPause),this.app.on("event:player:seekTo",this.handlePlayerSeekTo),this.app.on("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.app.on("event:prePageChange",this.handlePrePageChange)}return(0,a.default)(e,[{key:"isCreator",value:function(){return this.mediaOwner===this.app.account}},{key:"isInReplay",value:function(){return this.app.isRecordPlayer}},{key:"replayMode",value:function(){return this.app.player?this.app.player.state:"pause"}},{key:"replaySeekDiff",value:function(){return this.app.player?(this.app.player.lastTime-this.recordTime)/1e3:0}},{key:"destroy",value:function(){var e;this.app.off("event:prePageChange",this.handlePrePageChange),this.app.player&&(this.app.off("event:player:play",this.handlePlayerPlay),this.app.off("event:player:pause",this.handlePlayerPause),this.app.off("event:player:seekTo",this.handlePlayerSeekTo),this.app.off("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.onPluginWillDestroy();var t=this.app.container.el.querySelector("[id='"+this.opId+"']");null===(e=null==t?void 0:t.parentNode)||void 0===e||e.removeChild(t)}},{key:"putAttributes",value:function(e){var t=this.app.room.getPage(this.boardName,this.pageName);t&&this.operation.dispatchFromPage({dependOn:this.opId,skipUndo:!0,type:this.type,reuseOpType:this.opId+"-"+this.type+"-action",mediaData:(0,i.default)((0,i.default)({},this.data),e)},t)}},{key:"onReceiveAttributes",value:function(e){return function(e,t,r,n){return new(r||(r=s.default))((function(t,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}s((n=n.apply(e,[])).next())}))}(this,0,void 0,n.default.mark((function t(){var r,i;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r={play:!1,seek:0,ended:!1},e.data.hasOwnProperty("mediaData"))for(i in r=e.data.mediaData||{},this.data)r.hasOwnProperty(i)||(r[i]=this.data[i]);return this.recordTime=e.data.recordTime||0,t.next=5,this.onAttributeUpdated(r);case 5:this.data=r;case 6:case"end":return t.stop()}}),t,this)})))}}],[{key:"getElementWidth",value:function(e,t){return e}},{key:"getElementHeight",value:function(e,t){return e}}]),e}();t.default=u},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0MTUxOTUxOTYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTYwMCAtNjAwIDIyMjQgMjIyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MDgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjU5Ljk0NzkyOTA5IDEzMy45MjE4OTNoMTI2LjAyNjAzNDgxYzIzLjMzODE1NDczIDAgNDIuMDA4Njc4MjcgMTguNjcwNTIzNTMgNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZ2NjcyLjEzODg1NzQ4YzAgMjMuMzM4MTU0NzMtMTguNjcwNTIzNTMgNDIuMDA4Njc4MjctNDIuMDA4Njc5NTcgNDIuMDA4Njc4MjZIMjU5Ljk0NzkyOTA5Yy0yMy4zMzgxNTQ3MyAwLTQyLjAwODY3ODI3LTE4LjY3MDUyMzUzLTQyLjAwODY3OTU2LTQyLjAwODY3ODI2VjE3NS45MzA1NzEyNmMwLTIzLjMzODE1NDczIDE4LjY3MDUyMzUzLTQyLjAwODY3ODI3IDQyLjAwODY3OTU2LTQyLjAwODY3ODI2ek02MzguMDI2MDM2MSAxMzMuOTIxODkzaDEyNi4wMjYwMzQ4MWMyMy4zMzgxNTQ3MyAwIDQyLjAwODY3ODI3IDE4LjY3MDUyMzUzIDQyLjAwODY3OTU2IDQyLjAwODY3ODI2djY3Mi4xMzg4NTc0OGMwIDIzLjMzODE1NDczLTE4LjY3MDUyMzUzIDQyLjAwODY3ODI3LTQyLjAwODY3OTU2IDQyLjAwODY3ODI2aC0xMjYuMDI2MDM0ODFjLTIzLjMzODE1NDczIDAtNDIuMDA4Njc4MjctMTguNjcwNTIzNTMtNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZWMTc1LjkzMDU3MTI2YzAtMjMuMzM4MTU0NzMgMTguNjcwNTIzNTMtNDIuMDA4Njc4MjcgNDIuMDA4Njc5NTctNDIuMDA4Njc4MjZ6IiBmaWxsPSIjZmZmZmZmIiBwLWlkPSIyOTA5Ij48L3BhdGg+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBmaWxsPScjZmZmZmZmJyB0PSIxNjIwODcxNDY4NTkwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwMzEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTU2OS44OTg2NjcgMjc1LjJjLTIuMTMzMzMzLTIwLjczNi00LjM5NDY2Ny00Mi4yNC05Ljg5ODY2Ny02My43NDRDNTQ1LjA2NjY2NyAxNjAuMDg1MzMzIDUwMy41MDkzMzMgMTI4IDQ1OS4wMDggMTI4Yy0yNC44MzItMC4wODUzMzMtNTYuMjM0NjY3IDE1LjE4OTMzMy03NC4wNjkzMzMgMzAuNzJsLTE0Ny42MjY2NjcgMTIzLjYwNTMzM2gtNzcuMjI2NjY3Yy01Ni44NzQ2NjcgMC0xMDIuNTcwNjY3IDQzLjgxODY2Ny0xMTEuMjMyIDEwNy4wOTMzMzQtNy4zMzg2NjcgNjAuNzU3MzMzLTkuMTMwNjY3IDE3NS4zNiAwIDI0Mi4yMTg2NjYgNy45MzYgNjYuODU4NjY3IDUxLjYyNjY2NyAxMTAuMDM3MzMzIDExMS4yMzIgMTEwLjAzNzMzNGg3Ny4yMjY2NjdsMTUwLjQ4NTMzMyAxMjUuNDRjMTUuNDQ1MzMzIDEzLjQ0IDQyLjY2NjY2NyAyOC44NDI2NjcgNjcuNzU0NjY3IDI4Ljg0MjY2Nmw0LjQ4IDAuMDQyNjY3YzQ1LjM1NDY2NyAwIDg1LjMzMzMzMy0zMy4yOCAxMDAuMjY2NjY3LTg0LjQ4IDUuNjc0NjY3LTIxLjcxNzMzMyA3LjY4LTQyLjAyNjY2NyA5LjU1NzMzMy02MS42NTMzMzNsMC4wNDI2NjctMC4zNDEzMzQgMi4wMDUzMzMtMTkuNTg0YzcuNjgtNjMuNDQ1MzMzIDcuNjgtMzcyLjg2NCAwLTQzNS44NGwtMi4wMDUzMzMtMTguODU4NjY2eiBtMTcyLjggMS45MmEzOC42OTg2NjcgMzguNjk4NjY3IDAgMCAwLTU0LjU3MDY2Ny0xMC4xMTIgNDAuODMyIDQwLjgzMiAwIDAgMC05LjcyOCA1NS44MDhjMzQuMjE4NjY3IDUwLjQzMiA1My4wMzQ2NjcgMTE3LjU4OTMzMyA1My4wMzQ2NjcgMTg5LjE4NCAwIDcxLjU1Mi0xOC44MTYgMTM4Ljc1Mi01My4wMzQ2NjcgMTg5LjE4NGE0MC43ODkzMzMgNDAuNzg5MzMzIDAgMCAwIDkuODEzMzMzIDU1LjgwOCAzOC42MTMzMzMgMzguNjEzMzMzIDAgMCAwIDU0LjQ4NTMzNC0xMC4xMTJjNDMuMTc4NjY3LTYzLjY1ODY2NyA2Ny4wMjkzMzMtMTQ3LjA3MiA2Ny4wMjkzMzMtMjM0Ljg4cy0yMy44NTA2NjctMTcxLjIyMTMzMy02Ny4wMjkzMzMtMjM0Ljg4ek04MjMuMDQgMTM3LjM4NjY2N2EzOC42MTMzMzMgMzguNjEzMzMzIDAgMCAxIDU0LjQ4NTMzMyAxMC4wNjkzMzNDOTQ0LjQ2OTMzMyAyNDYuMDU4NjY3IDk4MS4zMzMzMzMgMzc1LjU1MiA5ODEuMzMzMzMzIDUxMmMwIDEzNi41MzMzMzMtMzYuODY0IDI2NS45ODQtMTAzLjgwOCAzNjQuNTQ0YTM4LjQ4NTMzMyAzOC40ODUzMzMgMCAwIDEtNTQuNDQyNjY2IDEwLjA2OTMzMyA0MC44MzIgNDAuODMyIDAgMCAxLTkuODEzMzM0LTU1LjgwOGM1Ny44NTYtODUuMjkwNjY3IDg5Ljc3MDY2Ny0xOTguNTI4IDg5Ljc3MDY2Ny0zMTguODA1MzMzIDAtMTIwLjIzNDY2Ny0zMS45MTQ2NjctMjMzLjQ3Mi04OS44MTMzMzMtMzE4Ljc2MjY2N2E0MC44NzQ2NjcgNDAuODc0NjY3IDAgMCAxIDkuODEzMzMzLTU1LjgwOHoiIGZpbGw9IiNmZmZmZmYiIHAtaWQ9IjIwMzIiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjIwODkxOTY3ODE0IiBmaWxsPScjZmZmZmZmJyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE4NzQiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTg5OS42NDggNTMzLjk1MmwxMDIuNC0xMDIuNGMxNC42MjQtMTQuNjI0IDE0LjYyNC0zNi41NzYgMC01MS4ycy0zNi41NzYtMTQuNjI0LTUxLjIgMGwtMTAyLjQgMTAyLjQtMTA5LjcyOC0xMDkuNzI4Yy03LjMyOC03LjMyOC0yOS4yNDgtMjEuOTUyLTUxLjIgMGEzNS4zNiAzNS4zNiAwIDAgMCAwIDUxLjJsMTAyLjQgMTAyLjQtMTAyLjQgMTA5LjcyOGMtMTQuNjI0IDE0LjYyNC0xNC42MjQgMzYuNTc2IDAgNTEuMnMzNi41NzYgMTQuNjI0IDUxLjIgMGwxMDkuNzI4LTEwMi40IDEwMi40IDEwMi40YzE0LjYyNCAxNC42MjQgMzYuNTc2IDE0LjYyNCA1MS4yIDBzMTQuNjI0LTM2LjU3NiAwLTUxLjJsLTEwMi40LTEwMi40eiBtLTQwMi4yNzItNDYwLjhjLTcuMzI4IDAtMTQuNjI0IDAtMjEuOTUyIDcuMzI4TDE1My42IDM1MS4xMDRINzMuMTUyYy0yOS4yNDgtNy4zMjgtNTEuMiAyMS45NTItNTEuMiA1MS4ydjIxOS40MjRjMCAyOS4yNDggMjEuOTUyIDU4LjUyOCA1MS4yIDU4LjUyOCAwIDAgODcuNzc2IDAgOTUuMDcyIDcuMzI4bDMwNy4yIDI2My4zMjhoMjEuOTUyYzIxLjk1MiAwIDM2LjU3Ni0yMS45NTIgMzYuNTc2LTUxLjJWMTI0LjM4NGMwLTI5LjI0OC0xNC42MjQtNTEuMi0zNi41NzYtNTEuMnoiIHAtaWQ9IjE4NzUiPjwvcGF0aD48L3N2Zz4="},function(e,t,r){var n=r(317);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){t=e.exports=r(24)(!1);var n=r(97),i=n(r(318)),o=n(r(214));t.push([e.i,".neteaseyunxin-wb-media-container {\n    position: fixed;\n}\n    .neteaseyunxin-wb-media-container .header {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 32px;\n        background-color: rgba(0,0,0,.7);\n        align-items: center;\n        display: none;\n    }\n    .neteaseyunxin-wb-media-container .header .title {\n            flex: 1;\n            color: white;\n            margin-left: 8px;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            font-size: 18px;\n        }\n    .neteaseyunxin-wb-media-container .header .close.icon {\n            width: 20px;\n            height: 20px;\n            background-image: url("+i+");\n            background-size: contain;\n            margin-right: 8px\n        }\n    .neteaseyunxin-wb-media-container .header .close.icon:hover {\n                cursor: pointer;\n            }\n    .neteaseyunxin-wb-media-container .media-control {\n        width: 100%;\n        position: absolute;\n        bottom: 0;\n        background: rgba(0,0,0,.7);\n        padding-top: 3px;\n        display: none;\n    }\n    .neteaseyunxin-wb-media-container .media-control .control-container {\n            display: flex;\n            height: 40px;\n            width: 100%;\n        }\n    .neteaseyunxin-wb-media-container .media-control .play-icon {\n            display: inline-block;\n            height: 100%;\n            width: 40px;\n            background-image: url("+o+");\n            background-size: contain;\n        }\n    .neteaseyunxin-wb-media-container .media-control .time-container {\n            display: inline-block;\n            height: 40px;\n            color: white;\n            vertical-align: top;\n            margin: 0 16px 0 0;\n        }\n    .neteaseyunxin-wb-media-container .media-control .time-text {\n            line-height: 40px;\n            height: 40px;\n            vertical-align: middle;\n            font-size: 14px;\n        }\n.neteaseyunxin-wb-media-container.visible .header, .neteaseyunxin-wb-media-container.audio .header {\n            display: flex;\n        }\n.neteaseyunxin-wb-media-container.visible .media-control, .neteaseyunxin-wb-media-container.audio .media-control {\n            display: block;\n        }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHQ9IjE2MjA4OTY3NjEwNjEiIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNSAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMTg2MyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIzMi4wMzEyNSIgaGVpZ2h0PSIzMiI+CjxkZWZzPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPgo8cGF0aCBkPSJNNTEzLjM0NCAwYTUxMiA1MTIgMCAxIDAgMCAxMDI0IDUxMiA1MTIgMCAwIDAgMC0xMDI0eiBtMjI2LjA0OCA2NzQuNjI0bC01NC41MjggNTYuODk2LTE3MS41Mi0xNjQuOTI4LTE3MS4zOTIgMTY0LjkyOC01NC41OTItNTYuODk2TDQ1Ni41NzYgNTEyIDI4Ny4zNiAzNDkuMzEybDU0LjU5Mi01Ni43NjggMTcxLjM5MiAxNjQuOCAxNzEuNTItMTY0LjggNTQuNTI4IDU2Ljc2OEw1NzAuMTc2IDUxMmwxNjkuMjE2IDE2Mi42MjR6IiBmaWxsPSIjZDgzZjIzIiBwLWlkPSIxODY0Ij48L3BhdGg+Cjwvc3ZnPg=="},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.appendTooltip=void 0;var n=o(r(0)),i=o(r(1));function o(e){return e&&e.__esModule?e:{default:e}}r(320);var a=function(){function e(t,r){var i=this;(0,n.default)(this,e),this.onMouseOver=function(){i.widget.classList.add("visible")},this.onTouchStart=function(){i.widget.classList.add("visible"),clearTimeout(i.hideTimer),i.hideTimer=setTimeout((function(){i.onMouseLeave()}),1e3)},this.onMouseLeave=function(){i.widget.classList.remove("visible")},t.classList.add("neteaseyunxin-wb-tooltip");var o=document.createElement("span");o.className="tooltiptext",o.innerText=r,t.appendChild(o),this.widget=t,this.bindEvents()}return(0,i.default)(e,[{key:"bindEvents",value:function(){this.widget.addEventListener("mouseover",this.onMouseOver),this.widget.addEventListener("mouseleave",this.onMouseLeave),this.widget.addEventListener("touchstart",this.onTouchStart),window.document.addEventListener("touchend",this.onMouseLeave)}}]),e}();t.appendTooltip=function(e,t){return new a(e,t)}},function(e,t,r){var n=r(321);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".neteaseyunxin-wb-tooltip {\n    position: relative;\n    display: inline-block;\n}\n\n    \n    .neteaseyunxin-wb-tooltip .tooltiptext {\n        visibility: hidden;\n        width: 120px;\n        background-color: black;\n        color: #fff;\n        text-align: center;\n        border-radius: 6px;\n        padding: 5px 0;\n      \n        /* Position the tooltip */\n        position: absolute;\n        z-index: 1;\n        bottom: 30px;\n        left: 50%;\n        transform: translateX(-50%);\n    }\n\n    \n.neteaseyunxin-wb-tooltip.visible .tooltiptext {\n        visibility: visible;\n    }",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(5)),i=l(r(2)),o=l(r(0)),a=l(r(1)),s=l(r(3)),c=l(r(4)),u=l(r(212));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"onSizeChange",value:function(e){this.playWidget&&this.timeWidget&&this.selfMuteIcon&&this.progressController&&(this.playWidget.style.display=e.width>140?"inline-block":"none",this.progressController.widget.style.display=e.width>140?"inline-block":"none",this.timeWidget.style.display=e.width>260?"inline-block":"none",this.selfMuteIcon.style.display=e.width>140?"inline-block":"none")}},{key:"getTitle",value:function(){return this.title?this.title:"音频文件"}},{key:"createControllor",value:function(){var e=document.createElement("div");this.progressController=new u.default(0,{emitEvent:this.isCreator()});var t=this.createControlContainer(),r=this.createPlayWidget(),i=this.createTimeIndicator(),o=this.createVolumeWidget();e.appendChild(t),t.appendChild(r),t.appendChild(i);var a=document.createElement("div");return(0,n.default)(a.style,{height:"40px",lineHeight:"40px",display:"inline-flex",alignItems:"center",flex:1,marginRight:"16px"}),a.appendChild(this.progressController.widget),t.appendChild(a),t.appendChild(o),e.style.userSelect="none",e.className="media-control",this.controlWidget=e,e}}],[{key:"getElementWidth",value:function(e){return e||500}},{key:"getElementHeight",value:function(){return 75}}]),t}(l(r(213)).default);t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.type="audio",e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"eventsToListen",value:function(){return{"audio:insert":{value:this.addMedia.bind(this),information:{args:"url: string, opts: {\n                         width: number,\n                         sourceType: string,\n                         title?: string\n                         pageName?: string\n                         boardName?: string\n                     }",message:"上传视频"}}}}}]),t}(c(r(211)).default);t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(14)),i=f(r(2)),o=f(r(0)),a=f(r(1)),s=f(r(3)),c=f(r(4)),u=r(18),l=f(r(10)),d=r(36),p=f(r(325));function f(e){return e&&e.__esModule?e:{default:e}}var h=void 0,m=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.type="transDoc",e.description="转码相关的操作汇聚地",e.transDocPlugin={},e.boardLastSnapshot={},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"registerHooks",value:function(){this.opsManager.hooks.boardChange.tap("boardChangePlugin",this.onBoardChange.bind(this))}},{key:"getPluginOfCurrBoard",value:function(){var e=this.app.room.currBoard.transDocSnapshot,t=e&&e.opId||"";return this.transDocPlugin[t]}},{key:"eventsToListen",value:function(){return{"transDoc:add":{value:this.addTransDoc.bind(this),information:{args:"opt",message:"添加ppt转码文档页面"}},"transDoc:nextAnim":{value:this.nextAnim.bind(this),information:{args:"",message:"播放下一个动画"}},"transDoc:prevAnim":{value:this.prevAnim.bind(this),information:{args:"",message:"跳到上一个动画"}},"transDoc:gotoAnim":{value:this.gotoAnim.bind(this),information:{args:"",message:"跳到指定位置"}}}}},{key:"addTransDoc",value:function(e){this.dispatch({type:this.type,action:"addTransDoc",boardName:e.boardName,displayName:e.displayName,pageCount:e.pageCount,transDocUrl:e.url,boundary:{sx:-e.width/2,sy:-e.height/2,w:e.width,h:e.height},transDocData:{animIndex:0,animState:"start",animPageIndex:0}})}},{key:"nextAnim",value:function(){var e=this.getPluginOfCurrBoard();if(e)return e.nextAnim()}},{key:"prevAnim",value:function(){var e=this.getPluginOfCurrBoard();if(e)return e.prevAnim()}},{key:"gotoAnim",value:function(e){var t=this.getPluginOfCurrBoard();if(t)return t.gotoAnim(e)}},{key:"onBoardChange",value:function(){var e=(0,n.default)(this.app.room.boards);for(var t in this.transDocPlugin){var r=this.transDocPlugin[t];-1===e.indexOf(r.boardName)?this.destroyPlugin(r):r.boardName!==this.app.room.currIndex&&r.hide()}var i=this.app.room.currIndex;this.boardLastSnapshot.hasOwnProperty(i)&&this.apply(this.boardLastSnapshot[i],{fromBatch:!0})}},{key:"destroy",value:function(){for(var e in this.transDocPlugin)this.destroyPlugin(this.transDocPlugin[e])}},{key:"destroyPlugin",value:function(e){e.destroy(),delete this.transDocPlugin[e.opId]}},{key:"previewDoc",value:function(e,t){var r=this.transDocPlugin[e.opId];r&&r.previewDoc(t)}},{key:"updateDocClipPath",value:function(e){var t=this.transDocPlugin[e.opId];t&&t.updateDocClipPath()}},{key:"apply",value:function(e,t){var r=this;this.boardLastSnapshot[e.data.boardName]=e,clearTimeout(h),t.fromBatch&&!this.app.isRecordPlayer?h=setTimeout((function(){r._apply(e,t)}),0):this._apply(e,t)}},{key:"_apply",value:function(e,t){if(!this.transDocPlugin[e.opId]){if(!this.app.room.boards.hasOwnProperty(e.data.boardName))return;this.transDocPlugin[e.opId]=new p.default(e,this.app,this)}var r=this.transDocPlugin[e.opId],n=e.data,i=n.boundary,o=(0,u.getTransformedBoundary)(this.app.camera.scale,i),a=this.app.container.h5El,s=a.querySelector("[id='"+e.opId+"']"),c=null==s;c&&((s=document.createElement("div")).style.position="fixed",s.id=""+e.opId,s.className="transDoc-plugin-container",a.appendChild(s)),s.style.width=o.w+"px",s.style.height=o.h+"px",s.style.left=o.sx+"px",s.style.top=o.sy+"px",c&&r.mountElement(e,t.fromBatch,s,n.transDocUrl),r.onReceiveAttributes(e.data.transDocData,{jump:t.fromBatch})}},{key:"transformOp",value:function(e,t){return(0,d.transformPropertyOverwriteOp)(e,t)}}]),t}(l.default);t.default=m},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(21)),i=p(r(5)),o=p(r(9)),a=p(r(0)),s=p(r(1)),c=p(r(13)),u=r(18),l=r(36),d=p(r(326));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t,r,n){var i,s=this;(0,a.default)(this,e),this.summaryReady=!1,this.handlePlayerPause=function(){s.pgReader&&s.data.animPageIndex===s.app.room.currBoard.currPage.getAnimPageIndex()&&s.pgReader.gotoAnimation({animIndex:s.data.animIndex,animState:s.data.animState},!0)},this.handlePlayerPlaySpeed=function(e){s.pgReader&&s.pgReader.setAnimSpeed(e)},this.opId=t.opId,this.type=n.type,this.boardName=t.data.boardName,this.app=r,this.operation=n,this.boundary=t.data.boundary;var c=this.app.room.boards[this.boardName];window.PgReader?(this.pgReader=new window.PgReader({fontDownloadPrefix:null===(i=this.app.serviceConf)||void 0===i?void 0:i.fontDownloadUrl,pageCount:t.data.pageCount}),this.pgReader.on("event:pptState:change",(function(e,t){"pageImgLoaded"===e?s.removeBlockH5Img(t):"indexLoaded"===e&&(s.summaryReady=!0,s.onAttributeUpdated(s.data,!0))}))):r.logger.error("房间加载了动态ppt，但是应用没有加载pptRenderer脚本。"),this.data=t.data.transDocData||{animIndex:0,animState:"start",animPageIndex:0},this.operation.opsManager.hooks.pageChange.tap("PageChange",this.handlePageChange.bind(this)),this.operation.opsManager.hooks.previewWaiting.tap("PreviewWaitingPlugin",this.handlePreviewWaiting.bind(this));var u=c.payloadOfPages,l=!0,d=!1,p=void 0;try{for(var f,h=(0,o.default)(u);!(l=(f=h.next()).done);l=!0){var m=f.value;if(m&&m.hasOwnProperty("animPageIndex")){var g=c.getPageNameByAnimPageIndex(m.animPageIndex);null!==g&&c.pages[g].addWaitingResource("h5Image")}}}catch(e){d=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw p}}this.app.isRecordPlayer&&(this.app.on("event:player:pause",this.handlePlayerPause),this.app.on("event:player:playSpeed",this.handlePlayerPlaySpeed))}return(0,s.default)(e,[{key:"removeBlockH5Img",value:function(e){if(this.pgReader){var t=this.app.room.boards[this.boardName],r=t.getPageNameByAnimPageIndex(e);r&&t.pages[r].removeWaitingResource("h5Image")}}},{key:"mountElement",value:function(e,t,r,n){var o,a,s=this;if(this.container=r,this.pgReader){!function(){if(!h){h=!0;var e=document.createElement("style");e.type="text/css",e.innerHTML="\n@keyframes __newb__rotate {\nfrom {transform: rotate(0);}\nto {transform: rotate(360deg);}\n}\n    ",document.getElementsByTagName("head")[0].appendChild(e)}}();var c=document.createElement("img");c.src=d.default,c.className="__newb__ppt_icon_loading",this.container.appendChild(c),(0,i.default)(c.style,{display:"none",position:"absolute",top:"50%",left:"50%",bottom:"0",right:"0",width:"55px",height:"55px",animation:"2s ease-in-out infinite __newb__rotate",transform:"translate(-50%, -50%)",zIndex:"1000"}),this.pgReader.open(n,{mode:"lazy"}).then((function(){s.pgReader.updateContainer(r);var n=Date.now()+s.app.ntpTimeDiff-e.time;e.uid===s.app.account.toString()&&n<1e3&&!t&&0===s.data.animPageIndex&&"start"===s.data.animState&&0===s.data.animIndex&&s.pgReader.waitTilPageReady(0).then((function(){var e=s.pgReader.getFirstAnimationPosition(0);0===e.animIndex&&"start"===e.animState||s.putAttributes((0,i.default)((0,i.default)({},e),{animPageIndex:0,jump:!1}))}))})),this.app.isRecordPlayer&&(null===(o=this.app.player)||void 0===o?void 0:o.playSpeed)&&this.pgReader.setAnimSpeed(null===(a=this.app.player)||void 0===a?void 0:a.playSpeed)}}},{key:"destroy",value:function(){var e;this.container&&(null===(e=this.container.parentNode)||void 0===e||e.removeChild(this.container)),this.app.isRecordPlayer&&(this.app.off("event:player:pause",this.handlePlayerPause),this.app.off("event:player:playSpeed",this.handlePlayerPlaySpeed)),this.pgReader&&this.pgReader.destroy()}},{key:"hide",value:function(){this.container&&(this.container.style.visibility="hidden")}},{key:"show",value:function(){this.container&&(this.container.style.visibility="visible")}},{key:"hideLoading",value:function(){for(var e,t=(null===(e=this.container)||void 0===e?void 0:e.getElementsByClassName("__newb__ppt_icon_loading"))||[],r=0;r<t.length;r++)t[r].style.display="none"}},{key:"showLoading",value:function(){for(var e,t=(null===(e=this.container)||void 0===e?void 0:e.getElementsByClassName("__newb__ppt_icon_loading"))||[],r=0;r<t.length;r++)t[r].style.display="block"}},{key:"updateDocClipPath",value:function(){var e=this.boundary,t=(0,u.getTransformedBoundary)(this.app.camera.scale,e),r=(0,l.getElementPartOutOfContainer)(t,this.app.camera);r&&this.container?this.container.style.clipPath="inset("+r.top+"px "+r.right+"px "+r.bottom+"px "+r.left+"px)":this.container&&(this.container.style.clipPath="none")}},{key:"gotoNextPage",value:function(){var e=this,t=this.app.getPageInfos(),r=t.activeIndex;if(r<t.pageNames.length-1){var n=this.app.room.currBoard.getPageByIndex(r+1).getAnimPageIndex();null===n?this.app.gotoPage(r+1):this.pgReader&&(this.showLoading(),this.pgReader.waitTilPageReady(n).then((function(){var t=e.pgReader.getFirstAnimationPosition(n);e.putAttributes((0,i.default)({jump:!1,animPageIndex:n},t)),e.hideLoading()})).catch((function(){e.putAttributes({jump:!1,animPageIndex:n,animIndex:0,animState:"start"}),e.hideLoading()})))}}},{key:"gotoPrevPage",value:function(){var e=this,t=this.app.getPageInfos().activeIndex;if(t>0){var r=this.app.room.currBoard.getPageByIndex(t-1).getAnimPageIndex();null===r?this.app.gotoPage(t-1):this.pgReader&&(this.showLoading(),this.pgReader.waitTilPageReady(r).then((function(){e.putAttributes({jump:!0,animPageIndex:r,animState:"end",animIndex:e.pgReader.getAnimationLengthOfPage(r)}),e.hideLoading()})).catch((function(){e.putAttributes({jump:!0,animPageIndex:r,animState:"end",animIndex:e.pgReader.getAnimationLengthOfPage(r)}),e.hideLoading()})))}}},{key:"gotoAnim",value:function(e){var t=this;if(this.pgReader){if(null===this.app.room.currBoard.getPageNameByAnimPageIndex(e.pageIndex))return this.app.logger.error("ppt中index为"+e.pageIndex+"的页面不存在");this.showLoading(),this.pgReader.waitTilPageReady(e.pageIndex).then((function(){t.putAttributes({jump:!0,animIndex:e.animIndex,animState:e.animState,animPageIndex:e.pageIndex}),t.hideLoading()})).catch((function(){t.hideLoading()}))}}},{key:"nextAnim",value:function(){if(this.pgReader){var e=void 0!==this.data.animPageIndex&&null!==this.data.animPageIndex,t=this.pgReader.getNextAnimationPosition(),r=this.app.room.currBoard;e&&this.data.animPageIndex===r.currPage.getAnimPageIndex()&&t?this.putAttributes((0,i.default)((0,i.default)({},t),{animPageIndex:this.app.room.currBoard.currPage.getAnimPageIndex(),jump:!1})):this.gotoNextPage()}}},{key:"prevAnim",value:function(){if(this.pgReader){var e=void 0!==this.data.animPageIndex&&null!==this.data.animPageIndex,t=this.pgReader.getPrevAnimationPosition();e&&t&&this.data.animPageIndex===this.app.room.currBoard.currPage.getAnimPageIndex()?this.putAttributes((0,i.default)((0,i.default)({},t),{animPageIndex:this.app.room.currBoard.currPage.getAnimPageIndex(),jump:!0})):this.gotoPrevPage()}}},{key:"handlePreviewWaiting",value:function(e){var t=this.app.room.currBoard.getPageByIndex(e);if(t){var r=t.getAnimPageIndex();r&&this.pgReader&&this.boardName===this.app.room.currBoard.boardName&&this.pgReader.waitTilPageReady(r)}}},{key:"handlePageChange",value:function(e){var t=this;if(this.app.isRecordPlayer||e.uid!==this.app.account||"transDoc"===e.data.type){if(this.app.isRecordPlayer||"transDoc"===e.data.type){if(this.app.isRecordPlayer&&this.boardName===this.app.room.currBoard.boardName){var r=this.app.room.currBoard.currPage.getAnimPageIndex();this.onReceiveAttributes({animIndex:0,animState:"start",animPageIndex:r,jump:!0},{jump:!0})}}else if(this.boardName===this.app.room.currBoard.boardName){var n=this.app.room.currBoard.currPage.getAnimPageIndex();this.onReceiveAttributes({animIndex:0,animState:"start",animPageIndex:n,jump:!0},{jump:!0})}}else{var i=Date.now()+this.app.ntpTimeDiff-e.time;if(this.pgReader&&this.boardName===this.app.room.currBoard.boardName&&i<300){var o=this.app.room.currBoard.currPage.getAnimPageIndex();o||0===o?(this.showLoading(),this.pgReader.waitTilPageReady(o).then((function(){var e=t.pgReader.getFirstAnimationPosition(o);t.putAttributes({jump:!1,animIndex:e.animIndex,animState:e.animState,animPageIndex:o}),t.hideLoading()})).catch((function(){t.hideLoading()}))):this.putAttributes({animIndex:0,animState:"start",animPageIndex:o,jump:!0})}}}},{key:"putAttributes",value:function(e){this.operation.dispatch({boardName:this.boardName,dependOn:this.opId,skipUndo:!0,type:this.type,transDocData:(0,i.default)((0,i.default)({},this.data),e)})}},{key:"onReceiveAttributes",value:function(e,t){return function(e,t,r,n){return new(r||(r=c.default))((function(t,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}s((n=n.apply(e,[])).next())}))}(this,0,void 0,n.default.mark((function r(){var o;return n.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:o=(0,i.default)({},this.data,e||{animState:"start",animIndex:0,animPageIndex:0}),e.jump?this.onAttributeUpdated(o,!0):this.app.isRecordPlayer?this.onAttributeUpdated(o,!1):this.onAttributeUpdated(o,t.jump),this.data=o;case 3:case"end":return r.stop()}}),r,this)})))}},{key:"onAttributeUpdated",value:function(e,t){var r=this;clearTimeout(this.animTimer),this.summaryReady&&(this.animTimer=setTimeout((function(){var n=r.app.room.currBoard.currPage.getAnimPageIndex();null!==n&&n===e.animPageIndex?(r.show(),r.pgReader&&r.pgReader.currPageIndex!==e.animPageIndex&&(r.showLoading(),r.pgReader.waitTilPageReady(e.animPageIndex).then((function(){r.pgReader.gotoPage(e.animPageIndex),r.hideLoading()})).catch((function(){r.pgReader.gotoPage(e.animPageIndex),r.hideLoading()}))),r.pgReader&&(r.showLoading(),r.app.emit("event:appState:change","animation",{pageIndex:e.animPageIndex,animIndex:e.animIndex,animState:e.animState}),r.pgReader.waitTilPageReady(e.animPageIndex).then((function(){r.pgReader.gotoAnimation({animIndex:e.animIndex,animState:e.animState},t),r.hideLoading()})).catch((function(){r.pgReader.gotoAnimation({animIndex:e.animIndex,animState:e.animState},t),r.hideLoading()})))):r.hide()}),20))}},{key:"previewDoc",value:function(e){if(this.pgReader){var t=e.boundary?e.boundary:this.app.camera.getContainerWorldRect(),r=e.ctx.canvas.width,n=e.ctx.canvas.height,i=this.boundary.w;if("fitDoc"===this.app.appConfig.previewMode&&!e.stream&&!e.toDataUrl)return this.pgReader.paintOnCanvas({ctx:e.ctx,pageIndex:e.animPageIndex,keepAnimState:e.keepAnimState});var o,a=[1,0,0,1,0,0];if(r/n>t.width/t.height){var s=n/r*i,c=t.width/t.height*s,u=c/i;a=[u,0,0,u,(i-c)/2,0]}else a=[1,0,0,1,0,(n/r*i-t.height/t.width*i)/2];var l=i/t.width;o=[l,0,0,l,(this.boundary.sx-t.centerX+t.width/2)*l,(this.boundary.sy-t.centerY+t.height/2)*l],this.pgReader.paintOnCanvas({ctx:e.ctx,pageIndex:e.animPageIndex,keepAnimState:e.keepAnimState,transforms:[a[0]*o[0],0,0,a[3]*o[3],a[4]+a[0]*o[4],a[5]+a[3]*o[5]]})}}}]),e}(),h=!1;t.default=f},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM1ODM4Mzk1MTM1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5MTAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNDgwIDk2YTMyIDMyIDAgMCAxIDY0IDB2MTkyYTMyIDMyIDAgMCAxLTY0IDBWOTZ6IG0yNTAuNjI0IDYwLjY0YTMyIDMyIDAgMSAxIDUxLjc3NiAzNy42MzJsLTExMi44MzIgMTU1LjMyOGEzMiAzMiAwIDAgMS01MS44MDgtMzcuNjMybDExMi44NjQtMTU1LjMyOHogbTE2Ny4xMzYgMTk2LjM4NGEzMiAzMiAwIDEgMSAxOS43NzYgNjAuODY0bC0xODIuNjI0IDU5LjMyOGEzMiAzMiAwIDAgMS0xOS43NzYtNjAuODY0bDE4Mi42MjQtNTkuMzI4eiBtMTkuNzc2IDI1Ny4wODhhMzIgMzIgMCAxIDEtMTkuNzc2IDYwLjg2NGwtMTgyLjYyNC01OS4zMjhhMzIgMzIgMCAwIDEgMTkuNzc2LTYwLjg2NGwxODIuNjI0IDU5LjMyOHpNNzgyLjQgODI5Ljc2YTMyIDMyIDAgMCAxLTUxLjc3NiAzNy42MzJsLTExMi44NjQtMTU1LjMyOGEzMiAzMiAwIDEgMSA1MS44MDgtMzcuNjMybDExMi44MzIgMTU1LjMyOHpNNTQ0IDkyOGEzMiAzMiAwIDAgMS02NCAwdi0xOTJhMzIgMzIgMCAwIDEgNjQgMHYxOTJ6IG0tMjUwLjYyNC02MC42NGEzMiAzMiAwIDAgMS01MS43NzYtMzcuNjMybDExMi44MzItMTU1LjMyOGEzMiAzMiAwIDAgMSA1MS44MDggMzcuNjMybC0xMTIuODY0IDE1NS4zMjh6IG0tMTY3LjEzNi0xOTYuMzg0YTMyIDMyIDAgMSAxLTE5Ljc3Ni02MC44NjRsMTgyLjYyNC01OS4zMjhhMzIgMzIgMCAwIDEgMTkuNzc2IDYwLjg2NGwtMTgyLjYyNCA1OS4zMjh6IG0tMTkuNzc2LTI1Ny4wODhhMzIgMzIgMCAwIDEgMTkuNzc2LTYwLjg2NGwxODIuNjI0IDU5LjMyOGEzMiAzMiAwIDEgMS0xOS43NzYgNjAuODY0bC0xODIuNjI0LTU5LjMyOHpNMjQxLjYgMTk0LjI0YTMyIDMyIDAgMSAxIDUxLjc3Ni0zNy42MzJsMTEyLjg2NCAxNTUuMzI4YTMyIDMyIDAgMSAxLTUxLjgwOCAzNy42MzJMMjQxLjYgMTk0LjI0eiIgcC1pZD0iMjkxMSIgZmlsbD0iIzJjMmMyYyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=S(r(5)),i=S(r(9)),o=S(r(19)),a=S(r(14)),s=S(r(31)),c=S(r(0)),u=S(r(1)),l=S(r(216)),d=r(54),p=r(133),f=r(331),h=r(219),m=r(332),g=r(96),v=r(98),y=r(29),b=S(r(32));function S(e){return e&&e.__esModule?e:{default:e}}var _=0,M=function(){function e(t,r){var n=this;(0,c.default)(this,e),this.executedClientIdSet=new s.default,this.currIndex="whiteboard",this.isReceivingBatchSnapshots=!1,this.boards={},this.pkgIdOpIdMap={},this.pageToRefresh=void 0,this.pageToIncRefresh=void 0,this.opIdSnapshotMap={},this.boardsSnapshotIds=[],this.globalSnapshotIds=[],this.boardOps={},this.delayedSnaps=[],this.mergeFailCache={},this._startRefreshLoop2=function(){cancelAnimationFrame(n.refreshAnimationTimer);try{n.refreshAnimationTimer=requestAnimationFrame((function(){return n._startRefreshLoop2()}))}catch(e){_<10&&(_+=1,n.logger.error("[白板] requestAnimationFrame error")),(0,m.polyfillRaf)(),n._startRefreshLoop()}n.pageToRefresh&&n.pageToRefresh===n.currBoard.currPage&&(n.currBoard.currPage.refresh(),n.pageToRefresh=void 0),n.pageToIncRefresh&&n.pageToIncRefresh===n.currBoard.currPage&&(n.currBoard.currPage.incRefresh(),n.pageToIncRefresh=void 0),n.currBoard.currPage.refreshOnStreamCanvas()},this.app=t,this.dataHub=r,this._init()}return(0,u.default)(e,[{key:"getBoardSnapshots",value:function(){var e=this;return this.boardsSnapshotIds.map((function(t){return e.opIdSnapshotMap[t]})).filter((function(e){return"goto"!==e.snapshot.data.action}))}},{key:"getBoardDisplayNames",value:function(){var e=this;return(0,a.default)(this.boards).map((function(t){return e.boards[t].displayName}))}},{key:"getPageWithFallback",value:function(e,t){e=void 0===e?this.currBoard.boardName:e;var r=this.boards[e],n=void 0;if(r){if(n=void 0===t?r.pages[r.currIndex]:r.pages[t])return n;this.logger.warn("[白板] getPageWithFallback 找不到boardName为"+e+"，pageName为"+t+"的白板页")}else this.logger.warn("[白板] getPageWithFallback 找不到boardName为"+e+"的文档")}},{key:"getPage",value:function(e,t){var r=this.boards[e];return r?r.pages[t]||(this.app.dataReportUtil("v3_run_error",{error:{code:v.DataReportRunError.Page_Lost,message:(0,o.default)({snaps:r.getPageSnapshots(),board:e,page:t})}}),void this.logger.warn("[白板] getPage: 找不到boardName: "+e+", pageName: "+t+"的白板页，当前房间白板页码为: "+r.pageNames.join(","))):(this.app.dataReportUtil("v3_run_error",{error:{code:v.DataReportRunError.Board_Lost,message:(0,o.default)({snaps:this.getBoardSnapshots(),board:e,page:t})}}),void this.logger.warn("[白板] getPage: 找不到名字为"+e+"的白板，当前房间白板列表为: "+(0,a.default)(this.app.room.boards).join(",")))}},{key:"getPageByBoardNameAndIndex",value:function(e,t){var r=this.boards[e];if(r){var n=r.pageNames[t];if(n){if(r.pages[n])return r.pages[n];this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到找不到boardName: "+e+", pageName: "+n+"的的白板页，当前房间白板页码为: "+r.pageNames.join(","))}else this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到找不到boardName: "+e+", pageIndex: "+t+"的的白板页，当前房间白板页码为: "+r.pageNames.join(","))}else this.logger.warn("[白板] getPageByBoardNameAndIndex: 找不到名字为"+e+"的白板，当前房间白板列表为: "+(0,a.default)(this.app.room.boards).join(","))}},{key:"getPageNameFromIndex",value:function(e,t){if(void 0!==t){e=e||this.currBoard.boardName;var r=this.getPageByBoardNameAndIndex(e,t);return null==r?void 0:r.pageIndex}}},{key:"recoverFullSnapshot",value:function(e){var t=this.opIdSnapshotMap[e.opId]&&this.opIdSnapshotMap[e.opId].snapshot.data.type,r=e.data.type;if(t&&r)return this.app.opsManager.mergePartial(this.opIdSnapshotMap[e.opId].snapshot,e);if(r){var n=this.mergeFailCache[e.opId],o=e;if(n){var a=!0,s=!1,c=void 0;try{for(var u,l=(0,i.default)(n);!(a=(u=l.next()).done);a=!0){var d=u.value;o=this.app.opsManager.mergePartial(o,d)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}delete this.mergeFailCache[e.opId]}return o}return t?(delete this.mergeFailCache[e.opId],this.app.opsManager.mergePartial(this.opIdSnapshotMap[e.opId].snapshot,e)):(this.mergeFailCache[e.opId]=this.mergeFailCache[e.opId]||[],this.mergeFailCache[e.opId].push(e),e)}},{key:"reset",value:function(){var e,t,r;g.LOG&&this.logger.log("[白板]","room.reset"),this._init(),null===(t=null===(e=this.currBoard)||void 0===e?void 0:e.currPage)||void 0===t||t.cleanNonCanvasElements(),this.pageToRefresh=null===(r=this.currBoard)||void 0===r?void 0:r.currPage}},{key:"beginReceiveBatchSnapshots",value:function(e){this.batchSource=e,this.isReceivingBatchSnapshots=!0}},{key:"endReceiveBatchSnapshots",value:function(e,t,r){var n,i,o,a=this;if(this.batchSource=void 0,this.isReceivingBatchSnapshots=!1,this.currBoard.currPage.calcDrawOpQueue(),e.length>0){var s=e[e.length-1];s.boundary.width>0&&s.boundary.height>0?s.animate?(0,p.transitionToCameraBound)(this.app.camera,s.boundary,(function(){var e;null===(e=a.app.previewFactory)||void 0===e||e.refreshPreviewsOfCurrBoard(),"function"==typeof r&&r(!0)})):((0,p.stopTransitionToCameraBound)(),this.app.camera.setCameraBound(s.boundary),null===(n=this.app.previewFactory)||void 0===n||n.refreshPreviewsOfCurrBoard(),"function"==typeof r&&r(!0)):"function"==typeof r&&r(!1)}else this.pageToRefresh=this.currBoard.currPage,t?null===(i=this.app.previewFactory)||void 0===i||i.refreshPreviewsOfCurrBoard():null===(o=this.app.previewFactory)||void 0===o||o.refreshPreviewsOfCurrPage(),"function"==typeof r&&r(!1)}},{key:"dispatch",value:function(e){var t=-1!==d.cameraSnapshotTypes.indexOf(e.data.type);if("camera-bound"!==e.data.type||e.data.boundary.width&&e.data.boundary.height){if(!this.app.editable&&!t){if(this.app.isRecordPlayer)return;if(!this.app.editEnabled)return this.logger.error("[白板] 请设置enableDraw(true)后，再修改白板");if((0,h.shouldCacheSnapshot)(e)){this.logger.log("[白板] 白板恢复后会上传数据: "+e.data.type);var r=e.data.type,n="文档";return"video"===r?n="视频":"audio"===r?n="音频":"image"===r&&(n="图片"),(0,y.showToast)({time:30,type:"warn",msg:"目前网络不稳定，若30s内恢复网络，将自动添加"+n,msgType:b.default.SYNCHRONIZING,args:{name:n}}),void this.delayedSnaps.push({snap:e,time:Date.now()})}if(!this.app.isConnected)return this.logger.error("[白板] 请在joinRoom时监听onconnected, 等待网络恢复后再修改白板");if(this.dataHub.isSynchronizing)return this.logger.error("[白板] 请在joinRoom时监听onSyncFinish，等待同步结束后再修改白板")}if(this.dataHub.isSynchronizing)this.logger.error("请等待同步结束后再修改白板");else{var i=this.dataHub.sendSnapshot(e);this.execSnapshot({snapshot:e,pkgId:i})}}else this.logger.warn("[白板] error, dispatch camera-bound的宽高无效",(0,o.default)(e.data))}},{key:"execCachedSnapshots",value:function(e){var t=(0,a.default)(e.pkgIdOpIdMap).map((function(e){return Number(e)})).sort((function(e,t){return e-t})),r=[],n=!0,o=!1,s=void 0;try{for(var c,u=(0,i.default)(t);!(n=(c=u.next()).done);n=!0){var l=c.value;if(Number(l)<=e.lastConfirmId){var d=e.pkgIdOpIdMap[l],p=!0,f=!1,h=void 0;try{for(var m,g=(0,i.default)(d);!(p=(m=g.next()).done);p=!0){var v=m.value;r.push(e.opIdSnapshotMap[v])}}catch(e){f=!0,h=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw h}}}}}catch(e){o=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw s}}this.execBatchSnapshots(r,"sync")}},{key:"getCachedTil",value:function(e){for(var t=(0,a.default)(this.pkgIdOpIdMap).map((function(e){return Number(e)})).sort((function(e,t){return e-t})),r=t.length-1;r>=0;r--)if(t[r]<=e)return t[r];return-1}},{key:"executeDelayedSnaps",value:function(){if(this.app.editEnabled)for(;this.delayedSnaps.length>0;){var e=this.delayedSnaps.shift(),t=Date.now();t-e.time<3e4&&(e.snap.time=t,this.dispatch(e.snap))}else this.delayedSnaps=[]}},{key:"execSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromBatch:!1,batchSource:"data"},r=(0,n.default)((0,n.default)({},e),{snapshot:this.recoverFullSnapshot(e.snapshot)});t.fromBatch||(this.cacheSnapshot(r,!0),this.pushSnapshotToQueue(r));var i=r.snapshot;if("inPageOp"===i.category){var o=this.getPage(i.board,i.page.toString());o&&o.addOpInPage(i)}else if("pageOp"===i.category){var a=this.boards[i.board];a&&a.addOpInBoard(i)}else"globalOp"===i.category?(0,f.addGlobalOp)(this,i):(0,f.addOpInRoom)(this,i,{fromBatch:t.fromBatch&&"data"!==t.batchSource})}},{key:"execBatchSnapshots",value:function(e,t,r){var o=this,a=e.map((function(e){var t=(0,n.default)((0,n.default)({},e),{snapshot:o.recoverFullSnapshot(e.snapshot)});return o.pushSnapshotToQueue(t),o.cacheSnapshot(t,!0),t})),s=0===a.filter((function(e){return"inPageOp"!==e.snapshot.category})).length,c=a.filter((function(e){return"boardOp"===e.snapshot.category})).length>0,u=a.filter((function(e){return"globalOp"===e.snapshot.category&&"camera-bound"===e.snapshot.data.type})).map((function(e){return{animate:e.snapshot.data.animate,boundary:(0,h.getCameraBoundFromGlobalOp)(o,e.snapshot)}})).filter((function(e){return e.boundary})),l=a.filter((function(e){return"globalOp"!==e.snapshot.category||"camera-bound"!==e.snapshot.data.type}));if(s){var d=!1;l.forEach((function(e){var t=e.snapshot,r=o.getPage(t.board,t.page.toString());r&&(d=r.addOpInPage(t,!1)||d)})),d?this.endReceiveBatchSnapshots([],!1,r):"function"==typeof r&&r(!1)}else{this.beginReceiveBatchSnapshots(t);try{var p=!0,f=!1,m=void 0;try{for(var g,v=(0,i.default)(l);!(p=(g=v.next()).done);p=!0){var y=g.value;this.execSnapshot(y,{fromBatch:!0,batchSource:t})}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}this.endReceiveBatchSnapshots(u,c,r)}catch(e){this.logger.error("[白板] error",e),this.endReceiveBatchSnapshots(u,c,r)}}}},{key:"cacheOrExecAckPkg",value:function(e,t){var r=this.pkgIdOpIdMap[e.pkgId],n=this.pkgIdOpIdMap[t];r&&-1!==r.indexOf(e.snapshot.opId)||n&&-1!==n.indexOf(e.snapshot.opId)?this.cacheSnapshot(e):this.execSnapshot(e)}},{key:"cacheSnapshot",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.snapshot.opId,i=e.pkgId;if(this.opIdSnapshotMap[n]){r||(e.snapshot=this.recoverFullSnapshot(e.snapshot));var o=this.opIdSnapshotMap[n].pkgId,a=this.pkgIdOpIdMap[o].indexOf(n);this.pkgIdOpIdMap[o].splice(a,1),0===this.pkgIdOpIdMap[o].length&&delete this.pkgIdOpIdMap[o]}this.opIdSnapshotMap[n]=e,(t=this.pkgIdOpIdMap)[i]||(t[i]=[]),this.pkgIdOpIdMap[i].push(n)}},{key:"pushSnapshotToQueue",value:function(e){var t,r,n=e.snapshot.category,i=e.snapshot.opId,o=e.pkgId;if("globalOp"===n)this._pushSnapshotInArray(i,o,this.globalSnapshotIds);else if("boardOp"===n)this._pushSnapshotInArray(i,o,this.boardsSnapshotIds);else if("pageOp"===e.snapshot.category){var a=e.snapshot.board;this.boardOps.hasOwnProperty(a)||(this.boardOps[a]={pageSnapshotIds:[],pages:{}}),(t=this.boardOps[a]).pageSnapshotIds||(t.pageSnapshotIds=[]),this._pushSnapshotInArray(i,o,this.boardOps[a].pageSnapshotIds)}else if("inPageOp"===e.snapshot.category){var s=e.snapshot.board,c=e.snapshot.page;this.boardOps.hasOwnProperty(s)||(this.boardOps[s]={pageSnapshotIds:[],pages:{}}),this.boardOps[s].pages.hasOwnProperty(c)||(this.boardOps[s].pages[c]={inPageSnapshotIds:[]}),(r=this.boardOps[s].pages[c]).inPageSnapshotIds||(r.inPageSnapshotIds=[]),this._pushSnapshotInArray(i,o,this.boardOps[s].pages[c].inPageSnapshotIds)}}},{key:"_pushSnapshotInArray",value:function(e,t,r){var n=r.indexOf(e);-1!==n&&r.splice(n,1);for(var i=r.length;i>=0;i--){if(0===i){r.splice(i,0,e);break}if(this.opIdSnapshotMap[r[i-1]].pkgId<=t){r.splice(i,0,e);break}}}},{key:"mergeDebouncedData",value:function(e,t){if("snapshot"!==t&&e.length>0)return e[e.length-1];if("snapshot"!==t)throw new Error("[白板] mergeDebounceData, dataArr is empty!!");var r={},n=!0,o=!1,s=void 0;try{for(var c,u=(0,i.default)(e);!(n=(c=u.next()).done);n=!0){var l=c.value;"vision"===l.type?r.vision=l:r.hasOwnProperty(l.value.opId)?l.value.hasOwnProperty("category")?r[l.value.opId]=l.value:r[l.value.opId].hasOwnProperty("category")?r[l.value.opId]=this.app.opsManager.mergePartial(r[l.value.opId],l.value):r[l.value.opId]=this.app.opsManager.mergeTwoPartial(r[l.value.opId],l.value):r[l.value.opId]=l.value}}catch(e){o=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw s}}return 1===(0,a.default)(r).length?{type:"snapshot",value:(0,a.default)(r).map((function(e){return r[e]}))[0]}:{type:"snapshotArr",value:(0,a.default)(r).map((function(e){return r[e]}))}}},{key:"_init",value:function(){var e=new l.default(this.app,"whiteboard","whiteboard");this.boards={whiteboard:e},this.currIndex="whiteboard",this.pkgIdOpIdMap={},this.opIdSnapshotMap={},this.boardsSnapshotIds=[],this.globalSnapshotIds=[],this.boardOps={},this.mergeFailCache={},this.executedClientIdSet.clear(),this._startRefreshLoop()}},{key:"_startRefreshLoop",value:function(){cancelAnimationFrame(this.refreshAnimationTimer),this._startRefreshLoop2()}},{key:"refresh",value:function(){this.pageToRefresh=this.currBoard.currPage}},{key:"currBoard",get:function(){return this.boards[this.currIndex]}},{key:"logger",get:function(){return this.app.logger}}]),e}();t.default=M},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.drawInProgressSnapshots=t.refresh=t.refreshOnStreamCanvas=t.cleanNonCanvasElements=void 0;var n=s(r(9)),i=s(r(14)),o=r(100),a=r(104);function s(e){return e&&e.__esModule?e:{default:e}}t.cleanNonCanvasElements=function(e){var t,r,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=(0,i.default)(e.drawOpQueue);if(e.app.container&&e.app.container.imageEl)for(var a=e.app.container.imageEl.children,s=Array.prototype.slice.apply(a),c=0;c<s.length;c++){var u=s[c],l=u.id;-1===o.indexOf(l)&&(null===(t=null==u?void 0:u.parentNode)||void 0===t||t.removeChild(u))}e.app.container&&e.app.container.domEl&&(e.app.container.domEl.innerHTML=""),n&&e.app.container&&e.app.container.backgroundEl&&(e.app.container.backgroundEl.innerHTML="");for(var d=Array.prototype.slice.apply(e.app.container.el.getElementsByClassName("neteaseyunxin-wb-media-container")),p=0;p<d.length;p++){var f=d[p],h=f.id;-1===o.indexOf(h)&&(null===(r=null==f?void 0:f.parentNode)||void 0===r||r.removeChild(f))}},t.refreshOnStreamCanvas=function(e){var t=e.app.container.streamCtx;if(t){if(t.save(),(0,a.clearCtx)(t),t.fillStyle=e.app.appConfig.canvasBgColor,(0,a.fillCtx)(t),e.app.bgRenderContainer&&e.app.bgRenderContainer({width:e.app.container.width,height:e.app.container.height,DPI:o.DPI,zoom:e.app.camera.zoomFactor,ctx:t}),e.app.camera.convertPreviewCanvas(t),e.app.bgRenderWorld){var r=e.app.camera.getContainerWorldRect();e.app.bgRenderWorld({width:e.app.container.width,height:e.app.container.height,DPI:o.DPI,rect:r,zoom:e.app.camera.zoomFactor,ctx:t})}if(e.backgroundSnapshot)e.opsManager.preview(e.backgroundSnapshot,t,{page:e,supportToDataUrl:!0});else{var s=e.getBoard(),u=e.getAnimPageIndex();null!==u&&s.previewDoc({ctx:t,animPageIndex:u,keepAnimState:!0,stream:!0})}var l=(0,i.default)(e.drawOpQueue);l=l.sort((function(t,r){return"image"===e.drawOpQueue[t].data.type&&"image"!==e.drawOpQueue[r].data.type?-1:"image"!==e.drawOpQueue[t].data.type&&"image"===e.drawOpQueue[r].data.type||"text"===e.drawOpQueue[t].data.type&&"text"!==e.drawOpQueue[r].data.type?1:"text"!==e.drawOpQueue[t].data.type&&"text"===e.drawOpQueue[r].data.type?-1:0}));var d=!0,p=!1,f=void 0;try{for(var h,m=(0,n.default)(l);!(d=(h=m.next()).done);d=!0){var g=h.value;e.opsManager.preview(e.drawOpQueue[g],t,{page:e,supportToDataUrl:!0})}}catch(e){p=!0,f=e}finally{try{!d&&m.return&&m.return()}finally{if(p)throw f}}for(var v in c(e,t),e.lastLaserOfUser){var y=e.lastLaserOfUser[v];e.opsManager.preview(y,t,{page:e,supportToDataUrl:!0})}t.restore()}},t.refresh=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.ctx,s=t.preview;r||(r=e.ctx);var l=s?r:e.frontCtx,d=s?r:e.bgCtx,p=!s||!t.supportToDataUrl&&e.app.appConfig.previewCustomBg||t.supportToDataUrl&&t.exportCustomBg;if(e.opsManager.hooks.refresh.call(),r.save(),e.bgCtx.save(),(0,a.clearCtx)(r),(0,a.clearCtx)(d),s&&(d.fillStyle=e.app.appConfig.canvasBgColor,(0,a.fillCtx)(d)),e.app.bgRenderContainer&&p){var f=e.app.container.width,h=e.app.container.height;t.supportToDataUrl&&t.boundary&&(f=d.canvas.width,h=d.canvas.height),e.app.bgRenderContainer({width:f,height:h,DPI:o.DPI,zoom:e.app.camera.zoomFactor,ctx:d})}if(s?t.boundary?e.app.camera.convertPreviewCanvas(r,t.boundary):e.app.camera.convertPreviewCanvas(r):(e.app.camera.convertCanvas(r),e.app.camera.convertCanvas(e.bgCtx)),e.app.bgRenderWorld&&p){var m=e.app.camera.getContainerWorldRect(),g=e.app.camera.zoomFactor,v=t.supportToDataUrl&&t.boundary?t.boundary:m;g*=t.supportToDataUrl&&t.boundary?m.width/t.boundary.width:1,e.app.bgRenderWorld({width:e.app.container.width,height:e.app.container.height,DPI:o.DPI,rect:v,zoom:g,ctx:d})}if(!s&&e.getBoard()&&e.getBoard().updateDocClipPath(),s||(l.save(),e.laserCtx.save(),(0,a.clearCtx)(l),(0,a.clearCtx)(e.laserCtx),e.app.camera.convertCanvas(l),e.app.camera.convertCanvas(e.laserCtx)),e.backgroundSnapshot&&!s?e.opsManager.draw(e.backgroundSnapshot,r,{div:e.app.container.backgroundEl,page:e}):e.backgroundSnapshot&&e.opsManager.preview(e.backgroundSnapshot,r,{page:e,supportToDataUrl:t.supportToDataUrl}),s){var y=e.getBoard(),b=e.getAnimPageIndex();null!==b&&(r.save(),y.previewDoc({ctx:r,animPageIndex:b,keepAnimState:t.supportToDataUrl,toDataUrl:t.supportToDataUrl,boundary:t.boundary}),r.restore())}if(s&&t.omitSelection||c(e,l),s){var S=(0,i.default)(e.drawOpQueue);S=S.sort((function(t,r){return"image"===e.drawOpQueue[t].data.type&&"image"!==e.drawOpQueue[r].data.type?-1:"image"!==e.drawOpQueue[t].data.type&&"image"===e.drawOpQueue[r].data.type||"text"===e.drawOpQueue[t].data.type&&"text"!==e.drawOpQueue[r].data.type?1:"text"!==e.drawOpQueue[t].data.type&&"text"===e.drawOpQueue[r].data.type?-1:0}));var _=!0,M=!1,T=void 0;try{for(var w,x=(0,n.default)(S);!(_=(w=x.next()).done);_=!0){var I=w.value;e.opsManager.preview(e.drawOpQueue[I],r,{page:e,supportToDataUrl:t.supportToDataUrl})}}catch(e){M=!0,T=e}finally{try{!_&&x.return&&x.return()}finally{if(M)throw T}}}else{for(var E in e.drawOpQueue){var A="image"===e.drawOpQueue[E].data.type?e.app.container.imageEl:e.app.container.domEl;e.opsManager.draw(e.drawOpQueue[E],r,{div:A,page:e})}for(var C in e.hiddenOpQueue){var k="image"===e.hiddenOpQueue[C].data.type?e.app.container.imageEl:e.app.container.domEl;e.opsManager.hide(e.hiddenOpQueue[C],r,k)}}if(!s)for(var O in u(e,e.laserCtx),e.lastLaserOfUser){var N=e.lastLaserOfUser[O];e.opsManager.draw(N,e.laserCtx)}r.restore(),e.frontCtx.restore(),e.bgCtx.restore(),s||e.laserCtx.restore()},t.drawInProgressSnapshots=function(e){e.laserCtx.save(),e.frontCtx.save(),(0,a.clearCtx)(e.laserCtx),(0,a.clearCtx)(e.frontCtx),e.app.camera.convertCanvas(e.laserCtx),e.app.camera.convertCanvas(e.frontCtx),(0,i.default)(e.lastInProgressSnapshotOfUser).map((function(t){return e.lastInProgressSnapshotOfUser[t]})).sort((function(e,t){return e.beginAt-t.beginAt})).forEach((function(t){var r="laser"===t.snapshot.data.type?e.laserCtx:e.frontCtx;e.opsManager.draw(t.snapshot,r,{div:e.app.container.domEl,page:e})})),c(e,e.frontCtx),u(e,e.laserCtx),e.laserCtx.restore(),e.frontCtx.restore()};var c=function(e,t){for(var r in e.lastSelectOfUser)e.opsManager.draw(e.lastSelectOfUser[r],t);for(var n in e.lastInProgressSelectOfUser)e.opsManager.draw(e.lastInProgressSelectOfUser[n],t)},u=function(e,t){for(var r in e.lastMousePointerOfUser){var n=e.lastMousePointerOfUser[r];e.opsManager.draw(n,t)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.calcDrawOpQueue=void 0;var n=s(r(9)),i=s(r(31)),o=r(54),a=r(104);function s(e){return e&&e.__esModule?e:{default:e}}var c=new i.default,u=(t.calcDrawOpQueue=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.drawOpQueue={},e.hiddenOpQueue={};var r=f(e,e.opQueue),n=r.normalQueue,i=r.abNormalQueue,o=h(e,n),a=m(e,o),s=g(e,a);u(e,i),l(e,s),t||d(e)},function(e,t){for(var r=0;r<t.length;r++){var n=t[r];"select"===n.data.type?n.data.inProgress?e.lastInProgressSelectOfUser[n.uid]=n:(delete e.lastInProgressSelectOfUser[n.uid],e.lastSelectOfUser[n.uid]=n):"mouse-pointer"===n.data.type?e.lastMousePointerOfUser[n.uid]=n:"laser"===n.data.type&&(e.lastLaserOfUser[n.uid]=n)}}),l=function(e,t){var r={},i=[],o=!0,a=!1,s=void 0;try{for(var u,l=(0,n.default)(t);!(o=(u=l.next()).done);o=!0){var d=u.value;if(e.lastInProgressSelectOfUser={},Array.isArray(d.data.dependOn)){var f=!0,h=!1,m=void 0;try{for(var g,y=(0,n.default)(d.data.dependOn);!(f=(g=y.next()).done);f=!0){var b=g.value;r.hasOwnProperty(b)?(i.push(b),r[b].push(d)):c.has(b)||(c.add(b),e.logger.warn("[白板]","miss op","\nsnapshot: ",d,"\nopQueueMap: ",r))}}catch(e){h=!0,m=e}finally{try{!f&&y.return&&y.return()}finally{if(h)throw m}}}else"string"==typeof d.data.dependOn?r.hasOwnProperty(d.data.dependOn)?(i.push(d.data.dependOn),r[d.data.dependOn].push(d)):c.has(d.data.dependOn)||(c.add(d.data.dependOn),e.logger.warn("[白板]","miss op","\nsnapshot: ",d,"\nopQueueMap",r)):r[d.opId]=[d]}}catch(e){a=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}for(var S in v(e,i),r){var _=p(e,S,r);_.data.hidden?e.hiddenOpQueue[S]=_:e.drawOpQueue[S]=_}},d=function(e){if(e.app.room.currBoard.currPage===e){var t=(0,a.getSelectedOpIds)(e);e.opsManager.selectOp.setSelectedOpIds(t);var r=e.lastInProgressSelectOfUser[e.app.account];r?e.opsManager.selectOp.setInProgressSelectedOpIds(r.data.selectedOpIds):e.opsManager.selectOp.setInProgressSelectedOpIds([])}},p=function(e,t,r){for(var n=r[t][0],i=1;i<r[t].length;i++)n=(0,a.transformOp)(e,n,r[t][i]);return n},f=function(e,t){var r=[],i=[],a=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(t);!(a=(u=l.next()).done);a=!0){var d=u.value;-1!==o.snapshotOutOfNormalFlowTypes.indexOf(d.data.type)?i.push(d):r.push(d)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return{normalQueue:r,abNormalQueue:i}},h=function(e,t){for(var r=t.slice(),n=r.length-1;n>=0;n--){var i=r[n];if("undo"===i.data.type||"redo"===i.data.type)for(var o=i.data.undoOpId||i.data.redoOpId,a=n-1;a>=0;a--)r[a].opId===o&&(r.splice(n,1),r.splice(a,1),n--)}return r},m=function(e,t){for(var r=t.slice(),n=r.length-1;n>=0;n--)if("clear"===r[n].data.type)return v(e,r.slice(0,n+1).map((function(e){return e.opId}))),r.slice(n+1);return r},g=function(e,t){for(var r=[],n=0;n<t.length;n++){var i=t[n];"duplicate"===i.data.type?r=r.concat(i.data.duplicates):r.push(t[n])}return r},v=function(e,t){for(var r in e.lastInProgressSnapshotOfUser){var n=e.lastInProgressSnapshotOfUser[r];-1!==t.indexOf(n.snapshot.opId)&&delete e.lastInProgressSnapshotOfUser[r]}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.addIncrementSnapshot=void 0;var n=r(54),i=r(104),o=(t.addIncrementSnapshot=function(e,t){"text"===t.data.type?o(e,t):a(e,t)},function(e,t){if(e.boardName===e.app.room.currIndex&&e.pageIndex===e.app.room.currBoard.currIndex.toString()){if(t.data.dependOn){var r=t.data.dependOn,n=e.drawOpQueue[r];n&&(n=(0,i.transformOp)(e,n,t),e.drawOpQueue[r]=n,s(e,n))}else e.drawOpQueue[t.opId]=t,s(e,t);e.app.room.pageToIncRefresh=e}}),a=function(e,t){s(e,t),e.boardName===e.app.room.currIndex&&e.pageIndex===e.app.room.currBoard.currIndex.toString()&&(-1===n.snapshotOutOfNormalFlowTypes.indexOf(t.data.type)?e.drawOpQueue[t.opId]=t:"laser"===t.data.type&&(e.lastLaserOfUser[t.uid]=t),e.app.room.pageToIncRefresh=e)},s=function(e,t){"select"===t.data.type?t.data.inProgress&&(e.lastInProgressSelectOfUser[t.uid]=t):"mouse-pointer"===t.data.type?e.lastMousePointerOfUser[t.uid]=t:e.lastInProgressSnapshotOfUser.hasOwnProperty(t.uid)&&e.lastInProgressSnapshotOfUser[t.uid].snapshot.opId===t.opId?e.lastInProgressSnapshotOfUser[t.uid]={snapshot:t,beginAt:e.lastInProgressSnapshotOfUser[t.uid].beginAt}:e.lastInProgressSnapshotOfUser[t.uid]={snapshot:t,beginAt:Date.now()}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.gotoBoard=t.addTransDocBoard=t.addBoard=t.deleteBoard=t.addOpInRoom=t.addGlobalOp=void 0;var n=c(r(14)),i=r(133),o=c(r(216)),a=r(218),s=r(219);function c(e){return e&&e.__esModule?e:{default:e}}t.addGlobalOp=function(e,t){var r,n=e.app.camera,o=(0,s.getCameraBoundFromGlobalOp)(e,t);o&&(t.data.animate?(0,i.transitionToCameraBound)(n,o,(function(){var t;null===(t=e.app.previewFactory)||void 0===t||t.refreshPreviewsOfCurrBoard()})):((0,i.stopTransitionToCameraBound)(),e.app.camera.setCameraBound(o),null===(r=e.app.previewFactory)||void 0===r||r.refreshPreviewsOfCurrBoard()))},t.addOpInRoom=function(e,t,r){var n,i=t.data,o=i.action,a=i.boardName,s=i.type;"goto"===o&&p(e,a,t),"delete"===o&&u(e,a,t),"add"===o&&l(e,a,t),"transDoc"===s&&("addTransDoc"===o&&d(e,a,t),e.boards[a].addTransDocOp(t,r)),e.app.opsManager.hooks.addOpHook.call(t,!0),"transDoc"===s&&"addTransDoc"!==o||null===(n=e.app.previewFactory)||void 0===n||n.refreshPreviewsOfCurrBoard()};var u=t.deleteBoard=function(e,t,r){if(e.boards.hasOwnProperty(t))if(1===(0,n.default)(e.boards).length)e.logger.error("[白板]","不能删除最后一个board");else{var i=(0,n.default)(e.boards),o=i.indexOf(t);delete e.boards[t];var c=o;o===i.length-1&&(c=o-1),e.currIndex=(0,n.default)(e.boards)[c];var u=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call(),(0,a.gotoPage)(u,u.currIndex,r),(0,s.fitToContentAfterBoardChange)(e)}else e.logger.error("[白板]","删除board:"+t+", 但是board不存在")},l=t.addBoard=function(e,t,r){var n=r.data.displayName?r.data.displayName:t;e.boards[t]=new o.default(e.app,t,n),e.currIndex=t;var i=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call();for(var c=1;c<r.data.pageCount;c++)(0,a.addPage)(i,void 0,r);if(r.data.tmpl)for(var u=0;u<r.data.pageCount;u++)i.pages[u].setBackgroundSnapshot({board:t,page:u,category:"inPageOp",opId:r.opId+"_"+u,time:r.time,uid:r.uid,data:{boundary:{sx:-r.data.w/2,sy:-r.data.h/2,w:r.data.w,h:r.data.h},url:r.data.tmpl.replace("{index}",r.data.offset+u),type:"background"}});(0,a.gotoPage)(i,0,r),(0,s.fitToContentAfterBoardChange)(e)},d=t.addTransDocBoard=function(e,t,r){var n=r.data.displayName?r.data.displayName:t;e.boards[t]=new o.default(e.app,t,n),e.currIndex=t;var i=e.boards[e.currIndex];i.hasDoc=!0,e.app.opsManager.hooks.boardChange.call(),i.pages[0].setPayload({animPageIndex:0});for(var c=1;c<r.data.pageCount;c++)(0,a.addPage)(i,void 0,r,{animPageIndex:c});(0,a.gotoPage)(i,0,r),(0,s.fitToContentAfterBoardChange)(e)},p=t.gotoBoard=function(e,t,r){e.boards.hasOwnProperty(t)||(e.boards[t]=new o.default(e.app,t,t)),e.currIndex=t;var n=e.boards[e.currIndex];e.app.opsManager.hooks.boardChange.call(),(0,a.gotoPage)(n,n.currIndex,r),(0,s.fitToContentAfterBoardChange)(e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.polyfillRaf=function(){var e=0;window.requestAnimationFrame=function(t,r){var n=window.performance.now(),i=Math.max(e+16,n);return setTimeout((function(){t(e=i)}),i-n)},window.cancelAnimationFrame=clearTimeout}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(9)),i=m(r(20)),o=m(r(5)),a=m(r(14)),s=m(r(19)),c=m(r(0)),u=m(r(1)),l=r(29),d=m(r(32)),p=r(334),f=r(98),h=r(215);function m(e){return e&&e.__esModule?e:{default:e}}var g=["select","select-hover","camera-bound","mouse-pointer","laser"],v=function(){function e(t,r){var n=this;(0,c.default)(this,e),this.incId=0,this.debounceData={},this.noAckData={},this.dataInResendQueue={},this.lastContinueServerPkgId=-1,this.serverPkgSinceLast=[],this.lastPkgIdToSync=-2,this.dataOfSync={},this.syncStartToLog=-1,this.syncEndToLog=-1,this.pkgInside=0,this.appliedPkgs={},this.isSynchronizing=!1,this.isFirstSync=!0,this.timerTrigger=requestAnimationFrame.bind(window),this._scheduleNextBroadcast=function(e,t){return n.timerTrigger((function(){(new Date).valueOf()-e.time<25?e.timer=n._scheduleNextBroadcast(e,t):n._doBroadcastData(e,t)}))},this._doBroadcastData=function(e,t){var r=n.app.room.mergeDebouncedData(e.dataQueue,t),i={strategy:"snapshot"===t?1:2,data:(0,s.default)(r),client_pkg_id:e.client_pkg_id};"snapshot"!==t&&(i.dataType=t),n.app.isConnected&&n.handler.broadcastData(i),n._shouldDataBeResendIfLost(r)&&n._pushDataToResendQueue(i),n.noAckData[i.client_pkg_id]={data:r,fakePkgId:e.fakePkgId},n.debounceData[t]={timer:null,client_pkg_id:-1,time:0,dataQueue:[],fakePkgId:-1}},this._checkResendQueue=function(){if(0===(0,a.default)(n.dataInResendQueue).length)n.resendTimer=null;else{var e=Date.now();for(var t in n.dataInResendQueue){if(n.dataInResendQueue[t].resendCount>=3)return n.logger.error("重发数据超过3次，停止重发该数据",(0,s.default)(n.dataInResendQueue[t].data)),n.app.dataReportUtil("v3_conn_error",{error:{code:f.DataReportConnError.Resend_Count_Exceed_Max,message:(0,s.default)(n.dataInResendQueue[t].data)}}),n.resendTimer=null,n._handleResendFail();e-n.dataInResendQueue[t].sendAt>2e3&&n.app.isConnected&&(n.handler.broadcastData(n.dataInResendQueue[t].data),n.dataInResendQueue[t]=(0,o.default)((0,o.default)({},n.dataInResendQueue[t]),{sendAt:Date.now(),resendCount:n.dataInResendQueue[t].resendCount+1}))}n.resendTimer=setTimeout(n._checkResendQueue,2e3)}},this._handleResendFail=function(){n.dataInResendQueue={};var e=n.room.getCachedTil(n.lastContinueServerPkgId),t=n.room.pkgIdOpIdMap,r=n.room.opIdSnapshotMap;n.app.resetState(),n.app.room.execCachedSnapshots({lastConfirmId:e,pkgIdOpIdMap:t,opIdSnapshotMap:r}),n.lastContinueServerPkgId=e,(0,l.showToast)({msg:"同步数据中...",time:1e3,type:"info",msgType:d.default.SYNCHRONIZING}),n.app.readyToSyncData()},this._setupResendSyncRequestTimer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;clearTimeout(n.resendSyncRequestTimer),n.resendSyncRequestTimer=setTimeout((function(){e<=8?(n.logger.error("[白板] 同步数据超时，第"+(e+1)+"次请求同步数据, "+n.lastContinueServerPkgId),n.handler.sendSyncRequest(n.lastContinueServerPkgId),n._setupResendSyncRequestTimer(e+1)):((0,l.showToast)({type:"error",msg:"无法同步数据，请检查你的网络",time:1e3,msgType:d.default.SYNC_FAIL}),n.app.dataReportUtil("v3_conn_error",{error:{code:f.DataReportConnError.Sync_Timeout,message:(0,s.default)({lastContinueServerPkgId:n.lastContinueServerPkgId,lastPkgIdToSync:n.lastPkgIdToSync})}}),n.logger.error("[白板] 多次同步数据失败"))}),1e4)},this._setCameraAftRdy=function(){n.app.container.width&&n.app.container.height?n.app.defaultCameraBound?n.app.setCameraBound(n.app.defaultCameraBound,!1):n.app.hasBackground()||n.app.hasTransDoc()?n.app.fitToDoc(!1):n.app.zoomTo1AfterJoin?(n.app.fitToContent(!1),n.app.zoomTo(1,!1)):n.app.setCameraBound({centerX:0,centerY:0,width:1920,height:1080},!1):n.app.once("container:resize",n._setCameraAftRdy)},this.app=t,this.handler=r,this.randomSeed=(0,p.getRandomIntByStr)(9),this.incId=0,this.bindEvents()}return(0,u.default)(e,[{key:"destroy",value:function(){clearTimeout(this.resendSyncRequestTimer),clearTimeout(this.resendTimer),this.isSynchronizing=!1,void 0===(0,i.default)(this.visHandlerUnregist)&&(this.visHandlerUnregist(),this.visHandlerUnregist=void 0)}},{key:"reset",value:function(){for(var e in this.debounceData)this.debounceData[e].timer&&cancelAnimationFrame(this.debounceData[e].timer);this.debounceData={},this.lastContinueServerPkgId=-1,this.serverPkgSinceLast=[],this.lastPkgIdToSync=-2,this.dataOfSync={},this.appliedPkgs={},this.isSynchronizing=!1,this.randomSeed=(0,p.getRandomIntByStr)(9),this.incId=0,clearTimeout(this.resendSyncRequestTimer)}},{key:"bindEvents",value:function(){var e=this;this.handler.on("data",this.onData.bind(this)),this.handler.on("broadcastAck",this.onBroadcastAck.bind(this)),this.handler.on("syncRequestAck",this.onSendRequestAck.bind(this)),this.handler.on("syncRequestResponse",this.onSendRequestResponse.bind(this)),this.visHandlerUnregist=(0,h.registerVisibleChangeHandler)((function(){e.timerTrigger=requestAnimationFrame.bind(window)}),(function(){e.timerTrigger=setTimeout.bind(window)}))}},{key:"hasPkgBeenApplied",value:function(e,t){if(!t||!e)return!1;var r=this.getAppliedPkgKey(e,t);return this.appliedPkgs.hasOwnProperty(r)}},{key:"setPkgBeenApplied",value:function(e,t,r){if(t&&e){var n=this.getAppliedPkgKey(e,t);(!this.appliedPkgs.hasOwnProperty(n)||this.appliedPkgs[n]>r)&&(this.appliedPkgs[n]=r)}}},{key:"getAppliedPkgKey",value:function(e,t){return t.toString()+"_"+e.toString()}},{key:"onData",value:function(e){var t,r=e.data,n=e.server_pkg_id,i=e.client_pkg_id,o=e.source_uid;if(this._updateServerPkgInfo(n,n),this.isSynchronizing)this.dataOfSync[n]={data:r,client_pkg_id:i,source_uid:o};else{if(this.hasPkgBeenApplied(i,o))return;this.setPkgBeenApplied(i,o,n);var a=r.type,s=r.value;"snapshot"===a?this.room.execSnapshot({snapshot:s,pkgId:n}):"broadcaster"===a?this.app.vision.receiveBroadcaster(s):"alive"===a?null===(t=this.app.aliveManager)||void 0===t||t.receiveAlive(s):"snapshotArr"===a&&this.room.execBatchSnapshots(s.map((function(e){return{snapshot:e,pkgId:n}})),"data")}}},{key:"sendSyncRequest",value:function(){this.logger.log("[白板] 请求同步数据, 是否正在同步数据",this.isSynchronizing,"当前最后一个数据id",this.lastContinueServerPkgId),this.isSynchronizing||(this.isSynchronizing=!0,this.handler.sendSyncRequest(this.lastContinueServerPkgId),this.lastPkgIdToSync=-2,this.dataOfSync={},this._setupResendSyncRequestTimer())}},{key:"stopSyncRequest",value:function(){this.logger.log("白板--\x3e 终止同步数据, 是否正在同步数据",this.isSynchronizing),this.isSynchronizing=!1,clearTimeout(this.resendSyncRequestTimer)}},{key:"onSendRequestAck",value:function(e){this.lastPkgIdToSync=e.last_server_pkg_id,this.logger.log("[白板] 收到同步响应，需求同步到序列号: "+this.lastPkgIdToSync),this._updateAppAfterSync()}},{key:"onSendRequestResponse",value:function(e){var t=this;if(this.isSynchronizing){var r=e.start_server_pkg_id,i=e.end_server_pkg_id,o=e.packages;Array.isArray(o)||(o=[]),clearTimeout(this.syncLogTimer),-1!==this.syncEndToLog&&r!==this.syncEndToLog+1?(this.logger.warn("[白板] 收到同步数据不重叠。\n            \n之前同步数据为: "+this.syncStartToLog+"-"+this.syncEndToLog+", 共有"+this.pkgInside+"数据包\n            \n当前同步数据为: "+r+"-"+i+", 共有"+o.length+"数据包"),this.syncStartToLog=-1,this.syncEndToLog=-1,this.pkgInside=0):(this.syncStartToLog=-1===this.syncStartToLog?r:this.syncStartToLog,this.syncEndToLog=i,this.pkgInside=this.pkgInside+o.length,this.syncLogTimer=setTimeout((function(){t.logger.log("[白板] 收到同步数据: "+t.syncStartToLog+"-"+t.syncEndToLog+"。实际包括"+t.pkgInside+"个数据包"),t.syncStartToLog=-1,t.syncEndToLog=-1,t.pkgInside=0}),2e3));var a=!0,s=!1,c=void 0;try{for(var u,l=(0,n.default)(o);!(a=(u=l.next()).done);a=!0){var d=u.value;this.dataOfSync[d.server_pkg_id]={data:d.data,client_pkg_id:d.client_pkg_id,source_uid:d.source_uid}}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}this._updateServerPkgInfo(r,i),this._updateAppAfterSync()}}},{key:"onBroadcastAck",value:function(e){var t=this,r=e.server_pkg_id,n=e.client_pkg_id;delete this.dataInResendQueue[n],this._updateServerPkgInfo(r,r);var i=this.noAckData[n].data,o=this.noAckData[n].fakePkgId;delete this.noAckData[n],i||this.logger.warn("[白板] broadcastAck, clientSeqId:"+n+"的数据不存在"),i&&"snapshot"===i.type?this.app.room.cacheOrExecAckPkg({pkgId:r,snapshot:i.value},o):i&&"snapshotArr"===i.type&&i.value.forEach((function(e){t.app.room.cacheOrExecAckPkg({pkgId:r,snapshot:e},o)}))}},{key:"sendSnapshot",value:function(e){return-1!==g.indexOf(e.data.type)?this.broadcastData({data:{type:"snapshot",value:e}},e.opId):this.broadcastData({data:{type:"snapshot",value:e}},"snapshot")}},{key:"broadcastRoomState",value:function(e,t){return this.broadcastData({data:{type:t,value:e}},t,!0)}},{key:"broadcastData",value:function(e,t,r){if(!this.debounceData.hasOwnProperty(t)||!this.debounceData[t].timer){var n=this.nextLocalFakeId,i=this.getNextClientPkgId();this.debounceData[t]={timer:null,time:(new Date).valueOf(),client_pkg_id:i,dataQueue:[],fakePkgId:n},this.noAckData[i]={data:void 0,fakePkgId:n}}var o=this.debounceData[t];return o.dataQueue.push(e.data),r?this._doBroadcastData(o,t):o.timer||(o.timer=this._scheduleNextBroadcast(o,t)),o.fakePkgId}},{key:"getNextClientPkgId",value:function(){return this.incId+=1,Number(this.randomSeed.toString()+this.incId.toString())}},{key:"_shouldDataBeResendIfLost",value:function(e){if("snapshot"===e.type){var t=e.value&&e.value.data&&e.value.data.type;return!t||-1===["select","select-hover","camera-bound"].indexOf(t)}return!0}},{key:"_pushDataToResendQueue",value:function(e){this.dataInResendQueue[e.client_pkg_id]={data:e,sendAt:Date.now(),resendCount:0},this.resendTimer||(clearTimeout(this.resendTimer),this.resendTimer=setTimeout(this._checkResendQueue,2e3))}},{key:"_updateAppAfterSync",value:function(){var e=this;if(-2!==this.lastPkgIdToSync&&(this.lastContinueServerPkgId>=this.lastPkgIdToSync&&clearTimeout(this.resendSyncRequestTimer),this.lastContinueServerPkgId>=this.lastPkgIdToSync&&this.isSynchronizing)){this.logger.log("[白板] 同步数据接收完毕: "+this.lastContinueServerPkgId+"--"+this.lastPkgIdToSync),this.isSynchronizing=!1,this.app.emit("event:editable:change",this.app.editable);var t=this._getDataToSync();this.dataOfSync={};for(var r=void 0,i=[],o=t.length-1;o>=0;o--)if("broadcaster"===t[o].data.type){r=t[o].data.value;break}for(var a=0;a<t.length;a++)"broadcaster"===t[a].data.type?r=t[a].data.value:"alive"===t[a].data.type&&i.push(t[a].data.value);var s=[],c=!0,u=!1,l=void 0;try{for(var d,p=(0,n.default)(t);!(c=(d=p.next()).done);c=!0){var f=d.value;if(this.dataInResendQueue.hasOwnProperty(f.client_pkg_id)&&delete this.dataInResendQueue[f.client_pkg_id],!this.hasPkgBeenApplied(f.client_pkg_id,f.source_uid))if(this.setPkgBeenApplied(f.client_pkg_id,f.source_uid,f.pkgId),"snapshot"===f.data.type)s.push({pkgId:f.pkgId,snapshot:f.data.value});else if("snapshotArr"===f.data.type){var h=!0,m=!1,g=void 0;try{for(var v,y=(0,n.default)(f.data.value);!(h=(v=y.next()).done);h=!0){var b=v.value;s.push({pkgId:f.pkgId,snapshot:b})}}catch(e){m=!0,g=e}finally{try{!h&&y.return&&y.return()}finally{if(m)throw g}}}}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}this.app.aliveManager.receiveSyncData(i),r&&this.app.vision.receiveBroadcasterAfterSync(r),setTimeout((function(){e.app.dispatcher.emit("event:sync_finished")}),0),this.app.room.execBatchSnapshots(s,"sync",(function(){if(e.isFirstSync){e.isFirstSync=!1;var t=e.app.vision.mode;if("follower"===t||"broadcaster"===t)return;e._setCameraAftRdy()}else e.app.room.executeDelayedSnaps()}))}}},{key:"_getDataToSync",value:function(){var e=this;return(0,a.default)(this.dataOfSync).sort((function(e,t){return Number(e)-Number(t)})).map((function(t){try{var r=e.dataOfSync[t].data;return{data:r="object"===(void 0===r?"undefined":(0,i.default)(r))?r:JSON.parse(r),client_pkg_id:e.dataOfSync[t].client_pkg_id,source_uid:e.dataOfSync[t].source_uid,pkgId:Number(t)}}catch(e){return}})).filter((function(e){return e}))}},{key:"_updateServerPkgInfo",value:function(e,t){for(var r=0,n=e;r<=this.serverPkgSinceLast.length&&!(n>t);)if(n<=this.lastContinueServerPkgId)n++;else if(r===this.serverPkgSinceLast.length){for(var i,o=[];n<=t;)o.push(n),n+=1;(i=this.serverPkgSinceLast).splice.apply(i,[r,0].concat(o))}else this.serverPkgSinceLast[r]<n?r++:this.serverPkgSinceLast[r]===n?(n++,r++):(this.serverPkgSinceLast.splice(r,0,n),n++,r++);for(r=0;r<this.serverPkgSinceLast.length&&this.serverPkgSinceLast[r]===this.lastContinueServerPkgId+r+1;r++);this.lastContinueServerPkgId+=r,this.serverPkgSinceLast.splice(0,r)}},{key:"room",get:function(){return this.app.room}},{key:"logger",get:function(){return this.app.logger}},{key:"lastServerPkgId",get:function(){return this.serverPkgSinceLast.length>0?this.serverPkgSinceLast[this.serverPkgSinceLast.length-1]:this.lastContinueServerPkgId}},{key:"nextLocalFakeId",get:function(){var e=this,t=this.lastServerPkgId,r=(0,a.default)(this.noAckData).map((function(t){return Number(e.noAckData[t].fakePkgId)})).sort((function(e,t){return e-t}));return 0===r.length||t>=r[r.length-1]?t+1:r[r.length-1]+1}}]),e}();t.default=v},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r(335))&&n.__esModule?n:{default:n};function o(e){var t="0123456789abcdefghijklmnopqrstuvwxyz!@#$%^&*()_+[]{}|/<>,./";return e?"0123456789"[Math.floor(Math.random()*"0123456789".length)]:t[Math.floor(Math.random()*t.length)]}t.getRandomIntByStr=function(e){var t,r=(t=function(e){for(var t=0,r=1779033703^e.length;t<e.length;t++)r=(r=(0,i.default)(r^e.charCodeAt(t),3432918353))<<13|r>>>19;return function(){return r=(0,i.default)(r^r>>>16,2246822507),r=(0,i.default)(r^r>>>13,3266489909),(r^=r>>>16)>>>0}}(function(e){for(var t="",r=0;r<18;r++)t+=o(!1);return t}())(),function(){var e=t+=1831565813;return e=(0,i.default)(e^e>>>15,1|e),((e^=e+(0,i.default)(e^e>>>7,61|e))^e>>>14)>>>0})().toString().slice(0,e);if(r.length<e)for(var n=r.length;n<e;n++)r+=o(!0);return r}},function(e,t,r){e.exports={default:r(336),__esModule:!0}},function(e,t,r){r(337),e.exports=r(6).Math.imul},function(e,t,r){var n=r(8),i=Math.imul;n(n.S+n.F*r(28)((function(){return-5!=i(4294967295,5)||2!=i.length})),"Math",{imul:function(e,t){var r=+e,n=+t,i=65535&r,o=65535&n;return 0|i*o+((65535&r>>>16)*o+i*(65535&n>>>16)<<16>>>0)}})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(21)),i=d(r(9)),o=d(r(118)),a=d(r(95)),s=d(r(0)),c=d(r(1)),u=d(r(13)),l=r(100);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t,r,n){return new(r||(r=u.default))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},f=function(){function e(t){(0,s.default)(this,e),this.previewContainerMap=new a.default,this.task=[],this.isLoopBusy=!1,this.visiblePages=[],this.app=t,this.app.opsManager.hooks.pageReady.tap("PageReadyPlugin",this.onPageReady.bind(this)),this.app.opsManager.hooks.addOpHook.tap("AddOpSnapshotPlugin",this.onOpAdded.bind(this))}return(0,c.default)(e,[{key:"getPagePreviewCtx",value:function(e){return this.pagePreviewCtx&&this.pagePreviewCanvas||(this.pagePreviewCanvas=document.createElement("canvas"),this.pagePreviewCtx=this.pagePreviewCanvas.getContext("2d"),this.pagePreviewCanvas.style.visibility="hidden",this.pagePreviewCanvas.style.position="absolute",this.app.container.el.appendChild(this.pagePreviewCanvas)),e.width<8192&&e.height<8192?(this.pagePreviewCanvas.width=e.width,this.pagePreviewCanvas.height=e.height):e.width>e.height?(this.pagePreviewCanvas.width=8192,this.pagePreviewCanvas.height=Math.floor(8192*e.height/e.width)):(this.pagePreviewCanvas.height=8192,this.pagePreviewCanvas.width=Math.floor(8192*e.width/e.height)),this.pagePreviewCtx}},{key:"reset",value:function(){this.previewContainerMap.clear()}},{key:"bindPreviewContainer",value:function(e){var t=this,r=!e.hasOwnProperty("reset")||e.reset,n=!e.hasOwnProperty("keepPrevContainer")||e.keepPrevContainer,a=e.previewContainerSettings.map((function(e){return t.getContainerKey(e)})),s=(0,o.default)(this.previewContainerMap.keys());if(r){var c=!0,u=!1,l=void 0;try{for(var d,p=(0,i.default)(s);!(c=(d=p.next()).done);c=!0){var f=d.value;-1!==a.indexOf(f)&&n||this.previewContainerMap.delete(f)}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}this.task=[]}var h=[];e.previewContainerSettings.forEach((function(e){var r=t.getContainerKey(e);if(!n||!t.previewContainerMap.has(r)||t.previewContainerMap.get(r).id!==e.id){var i=t.setupPreviewElements(e.container),o=i.ctx,a=i.canvasContainer,s=e.container.getBoundingClientRect();h.push({pageIndex:e.pageIndex,boardName:e.boardName}),t.previewContainerMap.set(r,{id:e.id,container:a,ctx:o,width:s.width,height:s.height})}})),this.addPreviewTask(h),this.setBackgroundColor()}},{key:"preparePreview",value:function(e){for(var t=this.app.room.currIndex,r=[],n=0;n<e.length;n++){var i=this.app.room.currBoard.pageNames[e[n]];void 0!==i&&(this.app.opsManager.hooks.previewWaiting.call(e[n]),r.push({pageIndex:i,boardName:t}))}this.visiblePages=r.slice(),this.setPreviewTask(r)}},{key:"generatePreviewToDataUrl",value:function(e,t,r){var n=this.app.room.getPage(e.boardName,e.pageIndex);if(!n)return"";var i=this.app.camera.getCameraBoundFitToContent({padding:100}),o="clip"===e.content?this.ctx:this.getPagePreviewCtx(i);if(!o)return"";n.calcDrawOpQueue(),"clip"===e.content?n.refresh({ctx:o,preview:!0,supportToDataUrl:!0,omitSelection:e.omitSelection,exportCustomBg:e.customBg}):n.refresh({ctx:o,preview:!0,supportToDataUrl:!0,boundary:i,omitSelection:e.omitSelection,exportCustomBg:e.customBg});var a=o.canvas.toDataURL(t,r);return this.app.room.refresh(),a}},{key:"setBackgroundColor",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,o=(0,i.default)(this.previewContainerMap.values());!(e=(n=o.next()).done);e=!0)n.value.container.style.backgroundColor=this.app.appConfig.canvasBgColor}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}},{key:"refreshPreviewsOfCurrBoard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.app.room.isReceivingBatchSnapshots){this.task=[];var t=this.app.room.currBoard,r=t.pages,n=[];for(var i in r)!e&&"fitContainer"!==this.app.appConfig.previewMode&&this.app.hasBackground(r[i])||n.push({boardName:t.boardName,pageIndex:r[i].pageIndex});this.addPreviewTask(n)}}},{key:"refreshPreviewsOfCurrPage",value:function(){if(!this.app.room.isReceivingBatchSnapshots){var e=this.app.room.currBoard;this.invalidatePreview(e.currPage.pageIndex,e.boardName);var t=[{boardName:e.boardName,pageIndex:e.currIndex.toString()}];this.addPreviewTask(t)}}},{key:"generatePreview",value:function(e){var t=this.getContainerKey(e);if(this.previewContainerMap.has(t)){var r=this.previewContainerMap.get(t),n=this.app.room.getPage(e.boardName,e.pageIndex);if(!n)return;var i=void 0;"fitDoc"===this.app.appConfig.previewMode&&this.app.hasBackground(n)&&(i=this.app.camera.getDocCameraBound(n)),n.calcDrawOpQueue(),n.refresh({ctx:null==r?void 0:r.ctx,preview:!0,boundary:i})}}},{key:"invalidatePreview",value:function(e,t){}},{key:"setPreviewTask",value:function(e){this.task=[],this.addPreviewTask(e)}},{key:"addPreviewTask",value:function(e){var t=this;e=e.filter((function(e){return t.isPageVisible(e)})),setTimeout((function(){e.reverse().forEach((function(e){var r=t.getTaskIndexOfPage(e.pageIndex,e.boardName);-1!==r&&t.task.splice(r,1);var n=t.app.room.boards[e.boardName];if(n){var i=n.pages[e.pageIndex];if(i){var o=t.getContainerKey(e);t.previewContainerMap.has(o)&&t.task.unshift({pageIndex:e.pageIndex,boardName:e.boardName,state:i.blocked?"waiting":"ready"})}}})),t.startLoop()}),0)}},{key:"getTaskIndexOfPage",value:function(e,t){for(var r=0;r<this.task.length;r++)if(this.task[r].pageIndex===e&&this.task[r].boardName===t)return r;return-1}},{key:"getContainerKey",value:function(e){return e.boardName+"129*&^ljdfh893"+e.pageIndex.toString()}},{key:"setupPreviewElements",value:function(e){var t=e.getElementsByClassName("preview-canvas-container"),r=void 0,n=void 0,i=void 0;0===t.length?((i=document.createElement("div")).className="preview-canvas-container",i.style.backgroundColor=this.app.appConfig.canvasBgColor,i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",e.appendChild(i),(r=document.createElement("canvas")).style.imageRendering="optimize-contrast",i.appendChild(r),(n=r.getContext("2d")).lineCap="round",n.lineJoin="round"):(i=t[0],n=(r=t[0].getElementsByTagName("canvas")[0]).getContext("2d"));var o=i.getBoundingClientRect();return r.width=o.width*l.DPI,r.height=o.height*l.DPI,r.style.width=o.width+"px",r.style.height=o.height+"px",{ctx:n,canvasContainer:i}}},{key:"onOpAdded",value:function(e){if("inPageOp"===e.category&&!e.data.inProgress&&"laser"!==e.data.type&&"mouse-pointer"!==e.data.type&&!this.app.room.isReceivingBatchSnapshots){var t=e.board,r=e.page;this.invalidatePreview(r.toString(),t),this.addPreviewTask([{pageIndex:r.toString(),boardName:t}])}}},{key:"onPageReady",value:function(e,t){this.invalidatePreview(t.toString(),e),this.addPreviewTask([{pageIndex:t.toString(),boardName:e}])}},{key:"isPageVisible",value:function(e){for(var t=0;t<this.visiblePages.length;t++)if(this.visiblePages[t].boardName===e.boardName&&this.visiblePages[t].pageIndex===e.pageIndex)return!0;return!1}},{key:"startLoop",value:function(){return p(this,void 0,void 0,n.default.mark((function e(){var t,r=this;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoopBusy){e.next=2;break}return e.abrupt("return");case 2:return this.isLoopBusy=!0,e.next=5,new u.default((function(e){setTimeout(e,0)}));case 5:t=n.default.mark((function e(){var t,i;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.shiftNextTastk();case 2:t=e.sent;case 3:if(null!==t){e.next=11;break}return e.next=6,r.delay(30);case 6:return e.next=8,r.shiftNextTastk();case 8:t=e.sent,e.next=3;break;case 11:if(i=r.getContainerKey(t),r.previewContainerMap.has(i)){e.next=14;break}return e.abrupt("return","continue");case 14:return e.next=16,new u.default((function(e){try{t&&r.isPageVisible(t)&&r.generatePreview(t),e()}catch(t){r.app.logger.error("[白板]",t),e()}}));case 16:return e.next=18,r.delay(100);case 18:case"end":return e.stop()}}),e,r)}));case 6:if(!(this.task.length>0)){e.next=13;break}return e.delegateYield(t(),"t0",8);case 8:if("continue"!==e.t0){e.next=11;break}return e.abrupt("continue",6);case 11:e.next=6;break;case 13:this.isLoopBusy=!1;case 14:case"end":return e.stop()}}),e,this)})))}},{key:"shiftNextTastk",value:function(){return p(this,void 0,void 0,n.default.mark((function e(){var t,r;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<this.task.length)){e.next=21;break}if(r=this.task[t],this.task.splice(t,1),e.prev=4,!this.app.room.getPage(r.boardName,r.pageIndex)){e.next=10;break}return e.abrupt("return",r);case 10:return t--,e.abrupt("continue",18);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(4),t--,e.abrupt("continue",18);case 18:t++,e.next=1;break;case 21:return e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,this,[[4,14]])})))}},{key:"delay",value:function(e){return p(this,void 0,void 0,n.default.mark((function t(){return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new u.default((function(t){setTimeout((function(){t()}),e)})));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"ctx",get:function(){return this.app.container.ctx}}]),e}();t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(14)),i=l(r(19)),o=l(r(35)),a=l(r(0)),s=l(r(1)),c=r(100),u=r(18);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(t,r){var n=this;(0,a.default)(this,e),this.scale=1,this.cameraBoundByUser={},this.app=t,this.translateX=0,this.translateY=0,this.scale=1,r?(this.width=r.width,this.height=r.height,this.centerX=r.centerX,this.centerY=r.centerY):(this.width=1920,this.height=1080,this.centerX=0,this.centerY=0),this.app.on("container:set",(function(){n.updateTransParamAndRefresh()}))}return(0,s.default)(e,[{key:"getContainerWorldRect",value:function(){var e=this.container.el.getBoundingClientRect(),t=e.width,r=e.height,n=this.convertToPointInWorld(0,0),i=(0,o.default)(n,2),a=i[0],s=i[1],c=this.convertToPointInWorld(t,r),u=(0,o.default)(c,2),l=u[0],d=u[1];return{centerX:a/2+l/2,centerY:s/2+d/2,width:l-a,height:d-s}}},{key:"getContainerWorldRectByCameraBound",value:function(e,t){if(e.width<=0||e.height<=0)return this.app.logger.warn("[白板] camera.getContainerWorldRectByCameraBound opts width or height less or equal to 0. \n            from: "+t+", width: "+e.width+", height: "+e.height),{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height};var r=this.container.width,n=this.container.height;return r/n>e.width/e.height?e.width=e.height/n*r:e.height=e.width/r*n,e}},{key:"convertToPointInWorld",value:function(e,t){return[e=(e-this.translateX)/this.scale,t=(t-this.translateY)/this.scale]}},{key:"convertWorldPointInContainer",value:function(e,t){return[e=e*this.scale+this.translateX,t=t*this.scale+this.translateY]}},{key:"convertDom",value:function(e){e.style.transform="translate("+this.translateX+"px, "+this.translateY+"px) scale("+this.scale+")",this.app.emit("camera:transform",this.scale)}},{key:"convertDomAndRefresh",value:function(){var e,t;this.convertDom(this.container.backgroundEl),this.convertDom(this.container.imageEl),this.convertDom(this.container.domEl),this.convertDom(this.container.textAreaEl),this.convertDom(this.container.h5El),this.app.room.pageToRefresh=null===(t=null===(e=this.app.room)||void 0===e?void 0:e.currBoard)||void 0===t?void 0:t.currPage}},{key:"convertCanvas",value:function(e){e.translate(this.translateX*c.DPI,this.translateY*c.DPI),e.scale(this.scale*c.DPI,this.scale*c.DPI)}},{key:"convertPreviewCanvas",value:function(e,t){var r=e.canvas.width,n=e.canvas.height,i=this.getTransParam(r,n,t),o=i.scale,a=i.translateX,s=i.translateY;e.translate(a,s),e.scale(o,o)}},{key:"setCameraBound",value:function(e){e.width&&e.height?(this.centerX=e.centerX,this.centerY=e.centerY,this.width=e.width,this.height=e.height,this.updateTransParamAndRefresh()):this.app.logger.warn("[白板] camera.setCameraBound 宽高无效",(0,i.default)(e))}},{key:"getNextCameraBound",value:function(e){return this.cameraLockParam?this.getCameraBoundLockWithContent(this.cameraLockParam):"pan"===e.type?this._roundBoundary(this.getCameraBoundPan(e)):"zoom"===e.type?this._roundBoundary(this.getCameraBoundZoom(e)):"reset-camera"===e.type?this._roundBoundary(this.getCameraBoundReset()):"fit-to-content"===e.type?this._roundBoundary(this.getCameraBoundFitToContent()):"fit-to-doc"===e.type?this._roundBoundary(this.getCameraBoundFitToDoc()):"resize-camera"===e.type?this._roundBoundary(this.getCameraBoundResize(e)):(console.error("不应该进入此分支(getCameraBound), data类型为："+e),{width:this.width,height:this.height,centerX:this.centerX,centerY:this.centerY})}},{key:"_roundBoundary",value:function(e){return{centerX:Number(e.centerX.toFixed(1)),centerY:Number(e.centerY.toFixed(1)),width:Number(e.width.toFixed(1)),height:Number(e.height.toFixed(1))}}},{key:"getCameraBoundPan",value:function(e){var t=this.centerX,r=this.centerY,n=this.width,i=this.height;return t+=e.dx/this.scale,r+=e.dy/this.scale,this.getContainerWorldRectByCameraBound({centerX:t,centerY:r,width:n,height:i},"pan")}},{key:"getCameraBoundZoom",value:function(e){var t,r=this.centerX,n=this.centerY,i=this.width,o=this.height;t=e.center?this.convertToPointInWorld(e.center[0],e.center[1]):[r,n];var a=e.scale;return r=t[0]-(t[0]-r)/a,n=t[1]-(t[1]-n)/a,i/=a,o/=a,this.getContainerWorldRectByCameraBound({centerX:r,centerY:n,width:i,height:o},"zoom")}},{key:"getCameraBoundReset",value:function(){return{centerX:0,centerY:0,width:this.container.width,height:this.container.height}}},{key:"getCameraBoundFitToDoc",value:function(){var e=this.app.room.currBoard.currPage.backgroundSnapshot,t=this.app.room.currBoard.transDocSnapshot;if(t&&t.data.boundary){var r=t.data.boundary,n=r.sx,i=r.sy,o=r.w,a=r.h;return this.getContainerWorldRectByCameraBound({centerX:n+o/2,centerY:i+a/2,width:o,height:a},"fitToDoc")}if(e){var s=e.data.boundary,c=s.sx,u=s.sy,l=s.w,d=s.h;return this.getContainerWorldRectByCameraBound({centerX:c+l/2,centerY:u+d/2,width:l,height:d},"fitToDoc")}return{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height}}},{key:"getDocCameraBound",value:function(e){var t=e.getBoard(),r=e.backgroundSnapshot,n=t.transDocSnapshot;if(n&&n.data.boundary){var i=n.data.boundary,o=i.sx,a=i.sy,s=i.w,c=i.h;return{centerX:o+s/2,centerY:a+c/2,width:s,height:c}}if(r){var u=r.data.boundary,l=u.sx,d=u.sy,p=u.w,f=u.h;return{centerX:l+p/2,centerY:d+f/2,width:p,height:f}}return{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.height}}},{key:"getCameraBoundFitToContent",value:function(e){var t=this.app.room.currBoard.currPage,r=t.drawOpQueue,i=t.backgroundSnapshot,o=this.app.room.currBoard.transDocSnapshot;if(0===(0,n.default)(r).length&&!i&&!o)return this.getCameraBoundReset();var a={sx:1e7,sy:1e7,ex:-1e7,ey:-1e7};if(i){var s=i.data.boundary,c=s.sx,l=s.sy,d=s.w,p=s.h;a.sx=Math.min(a.sx,c),a.sy=Math.min(a.sy,l),a.ex=Math.max(a.ex,c+d),a.ey=Math.max(a.ey,l+p)}if(o&&o.data.boundary){var f=o.data.boundary,h=f.sx,m=f.sy,g=f.w,v=f.h;a.sx=Math.min(a.sx,h),a.sy=Math.min(a.sy,m),a.ex=Math.max(a.ex,h+g),a.ey=Math.max(a.ey,m+v)}for(var y in r){var b=r[y].data;if(b.boundary&&null!==b.boundary.sx&&void 0!==b.boundary.sx&&null!==b.boundary.sy&&void 0!==b.boundary.sy&&null!==b.boundary.w&&void 0!==b.boundary.w&&null!==b.boundary.h&&void 0!==b.boundary.h){var S=(0,u.getTransformedBoundary)(this.scale,b.boundary,b.dx,b.dy,b.scaleX,b.scaleY),_=S.sx,M=S.sy,T=S.w,w=S.h;a.sx=Math.min(a.sx,_),a.sy=Math.min(a.sy,M),a.ex=Math.max(a.ex,_+T),a.ey=Math.max(a.ey,M+w)}}if(a.ex-a.sx<100&&a.ey-a.sy<100){var x=100-(a.ex-a.sx),I=100-(a.ey-a.sy);a.sx=a.sx-x/2,a.ex=a.ex+x/2,a.sy=a.sy-I/2,a.ey=a.ey+I/2}var E=e?e.padding:0;return this.getContainerWorldRectByCameraBound({centerX:a.sx/2+a.ex/2,centerY:a.sy/2+a.ey/2,width:a.ex-a.sx+2*E,height:a.ey-a.sy+2*E},"fitToContent")}},{key:"getCameraBoundResize",value:function(e){return this.app.appConfig.disableAutoResize?{centerX:this.centerX,centerY:this.centerY,width:e.width/this.zoomFactor,height:e.height/this.zoomFactor}:{centerX:this.centerX,centerY:this.centerY,width:this.width,height:this.width/e.width*e.height}}},{key:"getTransParam",value:function(e,t,r){var n=r?r.width:this.width,i=r?r.height:this.height,o=r?r.centerX:this.centerX,a=r?r.centerY:this.centerY,s=void 0,c=void 0,u=void 0;return c=e/2-o*(s=e/t>n/i?t/i:e/n),u=t/2-a*s,s&&isFinite(s)||(this.app.logger.warn("[白板] scale无效:",s,"参数为width: "+e+", height: "+t+", cameraW: "+n+", cameraH: "+i+", centerX: "+o+", centerY: "+a,"重置scale为1"),c=e/2-o*(s=1),u=t/2-a*s),{scale:s,translateX:c,translateY:u}}},{key:"updateTransParamAndRefresh",value:function(){var e=this.getTransParam(this.container.width,this.container.height),t=e.scale,r=e.translateX,n=e.translateY;this.scale=t,this.translateX=r,this.translateY=n,this.convertDomAndRefresh(),this.app.emit("event:appState:change","zoomFactor",this.zoomFactor)}},{key:"getCameraBoundLockWithContent",value:function(e){var t=e.width,r=e.height,n=e.height/e.width*1920,i=void 0,o=void 0;return this.container.width/this.container.height>t/r?(o=n,i=this.container.width/this.container.height*n):(i=1920,o=this.container.height/this.container.width*1920),{centerX:0,centerY:0,width:i/2,height:o/2}}},{key:"lockCameraWithContent",value:function(e){this.cameraLockParam=e,this.setCameraBound(this.getCameraBoundLockWithContent(e))}},{key:"unlockCameraWithContent",value:function(){this.cameraLockParam=void 0}},{key:"zoomFactor",get:function(){return this.scale}},{key:"container",get:function(){return this.app.container}}]),e}();t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(9)),i=a(r(0)),o=a(r(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,i.default)(this,e),this.state="pause",this.playSpeed=1,this.records=[],this.nextRecordIndex=0,this.lastTime=0,this.lastRealTime=0,this.offsetBegin=0,this.pkgId=0,this.app=t}return(0,o.default)(e,[{key:"addRecordData",value:function(e){this.records=e.slice(),this.app.resetState(),this.nextRecordIndex=0}},{key:"setViewer",value:function(e){this.app.account=e;var t=this.lastTime;this.lastTime=1/0,this.seekTo(t)}},{key:"play",value:function(){"pause"===this.state&&(this.state="play",this.app.emit("event:player:play"))}},{key:"pause",value:function(){"play"===this.state&&(this.state="pause",this.app.emit("event:player:pause"))}},{key:"setPlaySpeed",value:function(e){this.playSpeed!==e&&(this.playSpeed=e,this.app.emit("event:player:playSpeed",this.playSpeed))}},{key:"seekTo",value:function(e){var t=Date.now(),r=Math.abs(t-this.lastRealTime-(e-this.lastTime));this.lastRealTime=t;var i=e>=this.lastTime;this.lastTime=e;for(var o=i?this.nextRecordIndex:0,a=o;a<this.records.length&&!(this.records[a].time+this.offsetBegin>e);a++);var s=this.records.slice(o,a);this.nextRecordIndex=a,i||(this.app.resetState(),this.pkgId=0);for(var c=[],u=void 0,l=void 0,d=[],p=0;p<s.length;p++)if("snapshot"===s[p].record.type)c.push({snapshot:s[p].record.value,pkgId:this.pkgId}),this.pkgId+=1;else if("snapshotArr"===s[p].record.type){var f=!0,h=!1,m=void 0;try{for(var g,v=(0,n.default)(s[p].record.value);!(f=(g=v.next()).done);f=!0){var y=g.value;c.push({snapshot:y,pkgId:this.pkgId}),this.pkgId+=1}}catch(e){h=!0,m=e}finally{try{!f&&v.return&&v.return()}finally{if(h)throw m}}}else"broadcaster"===s[p].record.type?u=s[p].record.value:"observeMode"===s[p].record.type?s[p].record.value.account===this.app.account&&(l=s[p].record.value):"alive"===s[p].record.type&&d.push(s[p]);this.app.aliveManager.receiveSyncData(d),u&&this.app.vision.receiveBroadcasterAfterSync(u),l&&this.app.vision.receiveObserveModeAfterSync(l),this.app.room.execBatchSnapshots(c,"player"),r>100&&this.app.emit("event:player:seekTo")}}]),e}();t.default=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(35)),i=a(r(0)),o=a(r(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,i.default)(this,e),this._lastDirection=0,this._interruptFreeDraw=!1,this.task=[],this.lNo=0,this.dNo=0,this.rNo=0,this.repeat=100,this.dInterval=15,this.lInterval=1e3,this.taskGenerator=function(){},this.app=t}return(0,o.default)(e,[{key:"reconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("DEV--\x3e 模拟重连， 是否清空数据: "+t+", 是否重新创建socket连接: "+e),t&&this.app.resetState(),e?this.app.dataHub.handler._simulateReconnect():this.app.readyToSyncData()}},{key:"generateRandomLines",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this._interruptFreeDraw=!1,this.app.disableInteraction(),this._generateRandomLines(e,t,r,n)}},{key:"generateZheng",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this._interruptFreeDraw=!1,this.app.disableInteraction(),this.app.setTool("pen"),this._generateZheng(e,t,r,n)}},{key:"interruptRandomLines",value:function(){clearTimeout(this.timer),this.finish(),this._interruptFreeDraw=!0,this.app.enableInteraction()}},{key:"next",value:function(){var e=this;clearTimeout(this.timer);var t=this.task[this.lNo];if(t)if(t.length>2){var r=t[this.dNo],n=void 0,i=void 0;0===this.dNo?(n="mousedown",i=this.dInterval,this.dNo+=1):this.dNo===t.length-1?(n="mouseup",i=this.lInterval,this.dNo=0,this.lNo+=1):(n="mousemove",i=this.dInterval,this.dNo+=1);var o=new MouseEvent(n,{clientX:r.x,clientY:r.y});this.app.container[n](o,!0),this.timer=setTimeout((function(){e.next()}),i)}else this.lNo+=1,this.next();else this.timer=setTimeout((function(){e.nextTask()}),this.lInterval)}},{key:"nextTask",value:function(){this.lNo=0,this.dNo=0,this.isFinish()?(this.task=[],this._interruptFreeDraw=!0,this.app.enableInteraction()):(this.task=this.taskGenerator(),this.rNo+=1,this.next())}},{key:"isFinish",value:function(){return this._interruptFreeDraw||this.rNo>=this.repeat}},{key:"finish",value:function(){var e=new MouseEvent("mousedown",{clientX:0,clientY:0});this.app.container.mousedown(e,!0),e=new MouseEvent("mouseup",{clientX:0,clientY:0}),this.app.container.mouseup(e,!0)}},{key:"_generateZheng",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this.dInterval=Number(n)||15,this.lInterval=Number(i)||1e3,this.repeat=t||100;var o=Math.ceil(Math.sqrt(t)),a=Math.ceil(Math.sqrt(t));this.taskParam={x:0,y:0,row:a,col:o},this.rNo=0,this.taskGenerator=function(){var t=r.app.container.el.getBoundingClientRect(),n=t.width,i=t.height,s=.9*n/Math.max(o,15),c=.9*i/Math.max(a,15),u=t.left+.05*n+r.taskParam.x*s,l=t.top+.05*i+r.taskParam.y*c,d=t.left+.05*n+(r.taskParam.x+.8)*s,p=t.top+.05*i+(r.taskParam.y+.8)*c,f=[];return f.push(r._generateLine(e,u,l,d,l)),f.push(r._generateLine(e,u/2+d/2,l,u/2+d/2,p)),f.push(r._generateLine(e,u/2+d/2,l/2+p/2,d,l/2+p/2)),f.push(r._generateLine(e,.75*u+.25*d,l/2+p/2,.75*u+.25*d,p)),f.push(r._generateLine(e,u,p,d,p)),r.taskParam.x<a-1?r.taskParam.x+=1:(r.taskParam.y+=1,r.taskParam.x=0),f},this.nextTask()}},{key:"_generateLine",value:function(e,t,r,n,i){for(var o=[],a=0;a<e;a++)o.push({x:t+a/e*(n-t)+Math.random(),y:r+a/e*(i-r)+Math.random()});return o}},{key:"_generateRandomLines",value:function(e,t){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this.dInterval=Number(i)||15,this.lInterval=Number(o)||1e3,this.repeat=Number(t)||100,this.taskParam=e||100,this.rNo=0,this.taskGenerator=function(){var e=r.app.container.el.getBoundingClientRect(),t=e.width,i=e.height,o=Math.random()*t+e.left,a=Math.random()*i+e.top,s=[];s.push({x:o,y:a});for(var c=0;c<r.taskParam;c++){var u=r._getDxDy(c),l=(0,n.default)(u,2);o+=l[0],a+=l[1],s.push({x:o,y:a})}return[s]},this.nextTask()}},{key:"_getDxDy",value:function(e){return e%30==0&&(this._lastDirection=Math.floor(4*Math.random())),0===this._lastDirection?[10*Math.random(),10*Math.random()]:1===this._lastDirection?[10*Math.random(),-10*Math.random()]:2===this._lastDirection?[-10*Math.random(),10*Math.random()]:[-10*Math.random(),-10*Math.random()]}}]),e}();t.default=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(9)),i=u(r(0)),o=u(r(1)),a=r(29),s=u(r(32)),c=r(133);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){var r=this;(0,i.default)(this,e),this.mode="freeObserver",this.unsetWhenDisconnecting=function(){r.broadcaster===r.app.account.toString()&&r.unsetSelfAsBroadcaster()},this.unsetWhenPageHide=function(e){e.persisted&&r.unsetWhenDisconnecting()},this.handleBroadcasterOffline=function(e){r.app.logger.log("[白板] vision broadcaster offline",e,"broadcaster",r.broadcaster);var t=!0,i=!1,o=void 0;try{for(var c,u=(0,n.default)(e);!(t=(c=u.next()).done);t=!0){var l=c.value;if(l.toString()===r.broadcaster){var d=r.broadcasterName,p=r.broadcaster;r.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}});var f=l===r.app.account?"其他用户将停止与您保持视角同步":d+"取消了视角同步",h=l===r.app.account?s.default.STOP_BROADCAST:s.default.RECEIVE_STOP_BROADCAST;(0,a.showToast)({msg:f,type:"success",time:3,msgType:h,args:{broadcasterName:r.broadcasterName,broadcaster:r.broadcaster,prevBroadcasterName:d,prevBroadcaster:p}})}}}catch(e){i=!0,o=e}finally{try{!t&&u.return&&u.return()}finally{if(i)throw o}}},this.app=t,this.camera=this.app.camera,window.addEventListener("beforeunload",this.unsetWhenDisconnecting),window.addEventListener("pagehide",this.unsetWhenPageHide,!1),this.app.on("aliveManager:offline",this.handleBroadcasterOffline)}return(0,o.default)(e,[{key:"destroy",value:function(){this.unsetWhenDisconnecting(),window.removeEventListener("beforeunload",this.unsetWhenDisconnecting),window.removeEventListener("pagehide",this.unsetWhenPageHide,!1),this.app.off("aliveManager:offline",this.handleBroadcasterOffline)}},{key:"setVisionData",value:function(e){e.mode&&(this.mode=e.mode),e.broadcaster&&(this.broadcaster=e.broadcaster.value,this.broadcasterNickname=e.broadcaster.nickname),this.app.emit("event:appState:change","vision",{mode:this.mode,broadcasterName:this.broadcasterName,broadcaster:this.broadcaster})}},{key:"setSelfAsBroadcaster",value:function(){if(this.app.appConfig.allowReplaceActiveBroadcaster||!this.broadcaster||this.broadcaster===this.app.account.toString()){if(this.broadcaster!==this.app.account.toString())if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else{var e=this.app.account,t=this.app.nickname;this.setVisionData({mode:"broadcaster",broadcaster:{value:e,nickname:t}}),(0,a.showToast)({type:"success",msg:"其他用户将与您保持视角同步",time:3,msgType:s.default.START_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({broadcaster:e,nickname:t},"broadcaster"),this.app.emit("op:camera-bound:send",this.camera.getContainerWorldRect(),!0)}}else(0,a.showToast)({type:"error",msg:"其他参会人已开启视角同步",time:3,msgType:s.default.NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}},{key:"unsetSelfAsBroadcaster",value:function(){if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else if("broadcaster"===this.mode){this.broadcaster!==this.app.account&&this.app.logger.error("[白板] unsetSelfAsBroadcaster: 取消广播。但事实上目前用户并不是房间的广播者",this.broadcaster,this.app.account);var e=this.broadcasterName,t=this.broadcaster;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),(0,a.showToast)({type:"success",msg:"其他用户将停止与您保持视角同步",msgType:s.default.STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:e,prevBroadcaster:t}}),this.app.dataHub.broadcastRoomState({broadcaster:void 0},"broadcaster")}}},{key:"setSelfAsFollower",value:function(){if(this.app.dataHub.isSynchronizing)this.app.logger.warn("正在同步数据，请同步后再设置");else if("broadcaster"===this.mode)this.app.logger.error("[白板] setSelfAsFollower: 请先停止广播");else if("freeObserver"===this.mode){this.setVisionData({mode:"follower"});var e=this.camera.cameraBoundByUser[this.broadcaster];(0,c.transitionToCameraBound)(this.camera,e),(0,a.showToast)({type:"success",msg:"与"+this.broadcasterName+"保持视角同步",msgType:s.default.SWITCH_TO_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({account:this.app.account,mode:"follower"},"observeMode")}}},{key:"setSelfAsFreeObserver",value:function(){this.app.dataHub.isSynchronizing?this.app.logger.warn("正在同步数据，请同步后再设置"):"broadcaster"===this.mode?this.app.logger.error("[白板] setSelfAsFreeObserver: 请先停止广播"):"follower"===this.mode&&(this.setVisionData({mode:"freeObserver"}),(0,a.showToast)({type:"success",msg:"与"+this.broadcasterName+"解除视角同步",msgType:s.default.SWITCH_TO_FREE_OBSERVER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}),this.app.dataHub.broadcastRoomState({account:this.app.account,mode:"freeObserver"},"observeMode"),this.app.emit("op:camera-bound:send",this.camera.getContainerWorldRect(),!1))}},{key:"receiveBroadcaster",value:function(e){var t=e.broadcaster,r=e.nickname;if(t)this.setVisionData({mode:"follower",broadcaster:{value:t,nickname:r}}),(0,a.showToast)({msg:"正在与"+this.broadcasterName+"保持视角同步",type:"success",time:3,msgType:s.default.RECEIVE_START_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}});else{var n=this.broadcasterName,i=this.broadcaster;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),(0,a.showToast)({msg:n+"取消了视角同步",type:"success",time:3,msgType:s.default.RECEIVE_STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:n,prevBroadcaster:i}})}}},{key:"receiveBroadcasterAfterSync",value:function(e){var t=this.app.aliveManager.isAlive(e.broadcaster);if(t&&e.broadcaster===this.app.account)"broadcaster"!==this.mode&&(this.setVisionData({mode:"broadcaster",broadcaster:{value:this.app.account,nickname:this.app.nickname}}),(0,a.showToast)({type:"success",msg:"其他用户正与您保持视角同步",time:3,msgType:s.default.CURRENT_USER_IS_BROADCASTER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}));else if(t&&e.broadcaster)"follower"===this.mode&&this.broadcaster===e.broadcaster||(this.setVisionData({mode:"follower",broadcaster:{value:e.broadcaster,nickname:e.nickname}}),(0,a.showToast)({msg:"正在与"+this.broadcasterName+"保持视角同步",type:"success",time:3,msgType:s.default.CURRENT_USER_IS_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}}));else if("freeObserver"!==this.mode||this.broadcaster){var r=this.broadcaster,n=this.broadcasterName;this.setVisionData({mode:"freeObserver",broadcaster:{value:void 0,nickname:void 0}}),this.app.account===r?(0,a.showToast)({type:"success",msg:"其他用户将停止与您保持视角同步",msgType:s.default.STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:n,prevBroadcaster:r}}):r&&(0,a.showToast)({msg:n+"取消了视角同步",type:"success",time:3,msgType:s.default.RECEIVE_STOP_BROADCAST,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster,prevBroadcasterName:n,prevBroadcaster:r}})}}},{key:"receiveObserveModeAfterSync",value:function(e){if(e.account===this.app.account)if("follower"===e.mode){this.setVisionData({mode:"follower"});var t=this.camera.cameraBoundByUser[this.broadcaster];(0,c.transitionToCameraBound)(this.camera,t),(0,a.showToast)({type:"success",msg:"正在与"+this.broadcasterName+"保持视角同步",msgType:s.default.CURRENT_USER_IS_FOLLOWER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}else{this.setVisionData({mode:"freeObserver"});var r=this.camera.cameraBoundByUser[this.app.account];(0,c.transitionToCameraBound)(this.camera,r),(0,a.showToast)({type:"success",msg:"与"+this.broadcasterName+"解除视角同步",msgType:s.default.CURRENT_USER_IS_FREE_OBSERVER,args:{broadcasterName:this.broadcasterName,broadcaster:this.broadcaster}})}}},{key:"broadcasterName",get:function(){return this.broadcasterNickname?this.broadcasterNickname:this.broadcaster}}]),e}();t.default=l},function(e,t,r){(function(t){var n,i,o=d(r(5)),a=d(r(13)),s=d(r(21)),c=d(r(57)),u=(n=(0,c.default)(s.default.mark((function e(t){var r,n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new p(t),e.next=3,f.fromStream(r);case 3:return n=e.sent,e.next=6,r.close();case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)}),l=(i=(0,c.default)(s.default.mark((function e(r){var n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(r);case 2:return n=e.sent,e.abrupt("return",f.fromBuffer(t.from(n)));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)});function d(e){return e&&e.__esModule?e:{default:e}}var p=r(346).ReadableWebToNodeStream,f=r(369);function h(e){return e.arrayBuffer?e.arrayBuffer():new a.default((function(t,r){var n=new FileReader;n.addEventListener("loadend",(function(e){t(e.target.result)})),n.addEventListener("error",(function(e){r(new Error(e.message))})),n.addEventListener("abort",(function(e){r(new Error(e.type))})),n.readAsArrayBuffer(e)}))}(0,o.default)(e.exports,f,{fromStream:u,fromBlob:l})}).call(this,r(44).Buffer)},function(e,t,r){t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=u(e),a=n[0],s=n[1],c=new o(function(e,t,r){return 3*(t+r)/4-r}(0,a,s)),l=0,d=s>0?a-4:a;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,c[l++]=255&t),1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(l(e,a,a+16383>s?s:a+16383));return 1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var i,o,a=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){var n=l(r(21)),i=l(r(57)),o=l(r(2)),a=l(r(0)),s=l(r(1)),c=l(r(3)),u=l(r(4));function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ReadableWebToNodeStream=void 0;var d=function(e){function t(e){(0,a.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.bytesRead=0,r.released=!1,r.reader=e.getReader(),r}var r,l,d,p;return(0,u.default)(t,e),(0,s.default)(t,[{key:"_read",value:(p=(0,i.default)(n.default.mark((function e(){var t;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.released){e.next=3;break}return this.push(null),e.abrupt("return");case 3:return this.pendingRead=this.reader.read(),e.next=6,this.pendingRead;case 6:t=e.sent,delete this.pendingRead,t.done||this.released?this.push(null):(this.bytesRead+=t.value.length,this.push(t.value));case 9:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"waitForReadToComplete",value:(d=(0,i.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead){e.next=3;break}return e.next=3,this.pendingRead;case 3:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"close",value:(l=(0,i.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncAndRelease();case 2:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"syncAndRelease",value:(r=(0,i.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.released=!0,e.next=3,this.waitForReadToComplete();case 3:return e.next=5,this.reader.releaseLock();case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}]),t}(r(347).Readable);t.ReadableWebToNodeStream=d},function(e,t,r){(t=e.exports=r(224)).Stream=t,t.Readable=t,t.Writable=r(229),t.Duplex=r(69),t.Transform=r(231),t.PassThrough=r(367),t.finished=r(135),t.pipeline=r(368)},function(e,t){},function(e,t,r){var n=u(r(47)),i=u(r(55)),o=u(r(350)),a=u(r(354)),s=u(r(357)),c=u(r(14));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var r=(0,c.default)(e);if(s.default){var n=(0,s.default)(e);t&&(n=n.filter((function(t){return(0,a.default)(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e,t,r){return t in e?(0,n.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=r(44).Buffer,f=r(359).inspect,h=f&&f.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t;return(t=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return p.alloc(0);for(var t,r,n,i=p.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,r=i,n=a,p.prototype.copy.call(t,r,n),a+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?n+=i:n+=i.slice(0,e),0==(e-=o)){o===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=p.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(o));break}++n}return this.length-=n,t}},{key:h,value:function(e,t){return f(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){d(e,t,r[t])})):o.default?(0,i.default)(e,(0,o.default)(r)):l(Object(r)).forEach((function(t){(0,n.default)(e,t,(0,a.default)(r,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}])&&function(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(e,i.key,i)}}(e.prototype,t),e}()},function(e,t,r){e.exports={default:r(351),__esModule:!0}},function(e,t,r){r(352),e.exports=r(6).Object.getOwnPropertyDescriptors},function(e,t,r){var n=r(8),i=r(353),o=r(30),a=r(71),s=r(126);n(n.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,r,n=o(e),c=a.f,u=i(n),l={},d=0;u.length>d;)void 0!==(r=c(n,t=u[d++]))&&s(l,t,r);return l}})},function(e,t,r){var n=r(91),i=r(63),o=r(23),a=r(12).Reflect;e.exports=a&&a.ownKeys||function(e){var t=n.f(o(e)),r=i.f;return r?t.concat(r(e)):t}},function(e,t,r){e.exports={default:r(355),__esModule:!0}},function(e,t,r){r(356);var n=r(6).Object;e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)}},function(e,t,r){var n=r(30),i=r(71).f;r(94)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(n(e),t)}}))},function(e,t,r){e.exports={default:r(358),__esModule:!0}},function(e,t,r){r(122),e.exports=r(6).Object.getOwnPropertySymbols},function(e,t){},function(e,t,r){e.exports={default:r(361),__esModule:!0}},function(e,t,r){r(362),e.exports=r(64).f("hasInstance")},function(e,t,r){var n=r(15),i=r(90),o=r(11)("hasInstance"),a=Function.prototype;o in a||r(16).f(a,o,{value:function(e){if("function"!=typeof this||!n(e))return!1;if(!n(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,r){(function(t){function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var r=t.localStorage[e];return null!=r&&"true"===String(r).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,r(73))},function(e,t,r){var n=r(44),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=a),o(i,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){(function(t){var n,i=l(r(86)),o=l(r(13)),a=l(r(127)),s=l(r(2)),c=l(r(65)),u=l(r(47));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t,r){return t in e?(0,u.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=r(135),f=(0,c.default)("lastResolve"),h=(0,c.default)("lastReject"),m=(0,c.default)("error"),g=(0,c.default)("ended"),v=(0,c.default)("lastPromise"),y=(0,c.default)("handlePromise"),b=(0,c.default)("stream");function S(e,t){return{value:e,done:t}}function _(e){var t=e[f];if(null!==t){var r=e[b].read();null!==r&&(e[v]=null,e[f]=null,e[h]=null,t(S(r,!1)))}}function M(e){t.nextTick(_,e)}var T=(0,s.default)((function(){})),w=(0,a.default)((d(n={get stream(){return this[b]},next:function(){var e=this,r=this[m];if(null!==r)return o.default.reject(r);if(this[g])return o.default.resolve(S(void 0,!0));if(this[b].destroyed)return new o.default((function(r,n){t.nextTick((function(){e[m]?n(e[m]):r(S(void 0,!0))}))}));var n,i=this[v];if(i)n=new o.default(function(e,t){return function(r,n){e.then((function(){t[g]?r(S(void 0,!0)):t[y](r,n)}),n)}}(i,this));else{var a=this[b].read();if(null!==a)return o.default.resolve(S(a,!1));n=new o.default(this[y])}return this[v]=n,n}},c.default.asyncIterator,(function(){return this})),d(n,"return",(function(){var e=this;return new o.default((function(t,r){e[b].destroy(null,(function(e){e?r(e):t(S(void 0,!0))}))}))})),n),T);e.exports=function(e){var t,r=(0,i.default)(w,(d(t={},b,{value:e,writable:!0}),d(t,f,{value:null,writable:!0}),d(t,h,{value:null,writable:!0}),d(t,m,{value:null,writable:!0}),d(t,g,{value:e._readableState.endEmitted,writable:!0}),d(t,y,{value:function(e,t){var n=r[b].read();n?(r[v]=null,r[f]=null,r[h]=null,e(S(n,!1))):(r[f]=e,r[h]=t)},writable:!0}),t));return r[v]=null,p(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[h];return null!==t&&(r[v]=null,r[f]=null,r[h]=null,t(e)),void(r[m]=e)}var n=r[f];null!==n&&(r[v]=null,r[f]=null,r[h]=null,n(S(void 0,!0))),r[g]=!0})),e.on("readable",M.bind(null,r)),r}}).call(this,r(52))},function(e,t,r){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},function(e,t,r){e.exports=i;var n=r(231);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(67)(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},function(e,t,r){var n,i=r(68).codes,o=i.ERR_MISSING_ARGS,a=i.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function c(e,t,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var s=!1;e.on("close",(function(){s=!0})),void 0===n&&(n=r(135)),n(e,{readable:t,writable:i},(function(e){if(e)return o(e);s=!0,o()}));var c=!1;return function(t){if(!s&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new a("pipe"))}}function u(e){e()}function l(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?s:e.pop():s}e.exports=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var a=t.map((function(e,r){var o=r<t.length-1;return c(e,o,r>0,(function(e){n||(n=e),e&&a.forEach(u),o||(a.forEach(u),i(n))}))}));return t.reduce(l)}},function(module,exports,__webpack_require__){(function(Buffer){var _set=__webpack_require__(31),_set2=_interopRequireDefault(_set),_promise=__webpack_require__(13),_promise2=_interopRequireDefault(_promise),_maxSafeInteger=__webpack_require__(370),_maxSafeInteger2=_interopRequireDefault(_maxSafeInteger),_getIterator2=__webpack_require__(9),_getIterator3=_interopRequireDefault(_getIterator2),_slicedToArray2=__webpack_require__(35),_slicedToArray3=_interopRequireDefault(_slicedToArray2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_typeof2=__webpack_require__(20),_typeof3=_interopRequireDefault(_typeof2),_regenerator=__webpack_require__(21),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(57),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),fromStream=(_ref=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(t){var r;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,strtok3.fromStream(t);case 2:return r=e.sent,e.prev=3,e.next=6,fromTokenizer(r);case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.next=10,r.close();case 10:return e.finish(7);case 11:case"end":return e.stop()}}),e,this,[[3,,7,11]])}))),function(e){return _ref.apply(this,arguments)}),_ref,fromBuffer=(_ref2=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(t){var r,n;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)){e.next=2;break}throw new TypeError("Expected the `input` argument to be of type `Uint8Array` or `Buffer` or `ArrayBuffer`, got `"+(void 0===t?"undefined":(0,_typeof3.default)(t))+"`");case 2:if((r=t instanceof Buffer?t:Buffer.from(t))&&r.length>1){e.next=5;break}return e.abrupt("return");case 5:return n=strtok3.fromBuffer(r),e.abrupt("return",fromTokenizer(n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return _ref2.apply(this,arguments)}),_ref2,fromTokenizer=(_ref5=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(t){return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",_fromTokenizer(t));case 4:if(e.prev=4,e.t0=e.catch(0),e.t0 instanceof strtok3.EndOfStreamError){e.next=8;break}throw e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])}))),function(e){return _ref5.apply(this,arguments)}),_ref5,_fromTokenizer=(_ref6=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,f,h,m,g,v,y,b,S,_,M,T,w,x,I;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Buffer.alloc(minimumBytes),n=function(e,t){return _check(r,e,t)},i=function(e,t){return n(stringToBytes(e),t)},t.fileInfo.size||(t.fileInfo.size=_maxSafeInteger2.default),e.next=7,t.peekBuffer(r,{length:12,mayBeLess:!0});case 7:if(!n([66,77])){e.next=9;break}return e.abrupt("return",{ext:"bmp",mime:"image/bmp"});case 9:if(!n([11,119])){e.next=11;break}return e.abrupt("return",{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"});case 11:if(!n([120,1])){e.next=13;break}return e.abrupt("return",{ext:"dmg",mime:"application/x-apple-diskimage"});case 13:if(!n([77,90])){e.next=15;break}return e.abrupt("return",{ext:"exe",mime:"application/x-msdownload"});case 15:if(!n([37,33])){e.next=21;break}return e.next=18,t.peekBuffer(r,{length:24,mayBeLess:!0});case 18:if(!i("PS-Adobe-",{offset:2})||!i(" EPSF-",{offset:14})){e.next=20;break}return e.abrupt("return",{ext:"eps",mime:"application/eps"});case 20:return e.abrupt("return",{ext:"ps",mime:"application/postscript"});case 21:if(!n([31,160])&&!n([31,157])){e.next=23;break}return e.abrupt("return",{ext:"Z",mime:"application/x-compress"});case 23:if(!n([255,216,255])){e.next=25;break}return e.abrupt("return",{ext:"jpg",mime:"image/jpeg"});case 25:if(!n([73,73,188])){e.next=27;break}return e.abrupt("return",{ext:"jxr",mime:"image/vnd.ms-photo"});case 27:if(!n([31,139,8])){e.next=29;break}return e.abrupt("return",{ext:"gz",mime:"application/gzip"});case 29:if(!n([66,90,104])){e.next=31;break}return e.abrupt("return",{ext:"bz2",mime:"application/x-bzip2"});case 31:if(!i("ID3")){e.next=42;break}return e.next=34,t.ignore(6);case 34:return e.next=36,t.readToken(uint32SyncSafeToken);case 36:if(o=e.sent,!(t.position+o>t.fileInfo.size)){e.next=39;break}return e.abrupt("return",{ext:"mp3",mime:"audio/mpeg"});case 39:return e.next=41,t.ignore(o);case 41:return e.abrupt("return",fromTokenizer(t));case 42:if(!i("MP+")){e.next=44;break}return e.abrupt("return",{ext:"mpc",mime:"audio/x-musepack"});case 44:if(67!==r[0]&&70!==r[0]||!n([87,83],{offset:1})){e.next=46;break}return e.abrupt("return",{ext:"swf",mime:"application/x-shockwave-flash"});case 46:if(!n([71,73,70])){e.next=48;break}return e.abrupt("return",{ext:"gif",mime:"image/gif"});case 48:if(!i("FLIF")){e.next=50;break}return e.abrupt("return",{ext:"flif",mime:"image/flif"});case 50:if(!i("8BPS")){e.next=52;break}return e.abrupt("return",{ext:"psd",mime:"image/vnd.adobe.photoshop"});case 52:if(!i("WEBP",{offset:8})){e.next=54;break}return e.abrupt("return",{ext:"webp",mime:"image/webp"});case 54:if(!i("MPCK")){e.next=56;break}return e.abrupt("return",{ext:"mpc",mime:"audio/x-musepack"});case 56:if(!i("FORM")){e.next=58;break}return e.abrupt("return",{ext:"aif",mime:"audio/aiff"});case 58:if(!i("icns",{offset:0})){e.next=60;break}return e.abrupt("return",{ext:"icns",mime:"image/icns"});case 60:if(!n([80,75,3,4])){e.next=121;break}e.prev=61;case 62:if(!(t.position+30<t.fileInfo.size)){e.next=114;break}return e.next=65,t.readBuffer(r,{length:30});case 65:return a={compressedSize:r.readUInt32LE(18),uncompressedSize:r.readUInt32LE(22),filenameLength:r.readUInt16LE(26),extraFieldLength:r.readUInt16LE(28)},e.next=68,t.readToken(new Token.StringType(a.filenameLength,"utf-8"));case 68:return a.filename=e.sent,e.next=71,t.ignore(a.extraFieldLength);case 71:if("META-INF/mozilla.rsa"!==a.filename){e.next=73;break}return e.abrupt("return",{ext:"xpi",mime:"application/x-xpinstall"});case 73:if(!a.filename.endsWith(".rels")&&!a.filename.endsWith(".xml")){e.next=83;break}s=a.filename.split("/")[0],e.t0=s,e.next="_rels"===e.t0?78:"word"===e.t0?79:"ppt"===e.t0?80:"xl"===e.t0?81:82;break;case 78:return e.abrupt("break",83);case 79:return e.abrupt("return",{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});case 80:return e.abrupt("return",{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"});case 81:return e.abrupt("return",{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});case 82:return e.abrupt("break",83);case 83:if(!a.filename.startsWith("xl/")){e.next=85;break}return e.abrupt("return",{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});case 85:if(!a.filename.startsWith("3D/")||!a.filename.endsWith(".model")){e.next=87;break}return e.abrupt("return",{ext:"3mf",mime:"model/3mf"});case 87:if("mimetype"!==a.filename||a.compressedSize!==a.uncompressedSize){e.next=98;break}return e.next=90,t.readToken(new Token.StringType(a.compressedSize,"utf-8"));case 90:c=e.sent,e.t1=c,e.next="application/epub+zip"===e.t1?94:"application/vnd.oasis.opendocument.text"===e.t1?95:"application/vnd.oasis.opendocument.spreadsheet"===e.t1?96:"application/vnd.oasis.opendocument.presentation"===e.t1?97:98;break;case 94:return e.abrupt("return",{ext:"epub",mime:"application/epub+zip"});case 95:return e.abrupt("return",{ext:"odt",mime:"application/vnd.oasis.opendocument.text"});case 96:return e.abrupt("return",{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"});case 97:return e.abrupt("return",{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"});case 98:if(0!==a.compressedSize){e.next=110;break}u=-1;case 100:if(!(u<0&&t.position<t.fileInfo.size)){e.next=108;break}return e.next=103,t.peekBuffer(r,{mayBeLess:!0});case 103:return u=r.indexOf("504B0304",0,"hex"),e.next=106,t.ignore(u>=0?u:r.length);case 106:e.next=100;break;case 108:e.next=112;break;case 110:return e.next=112,t.ignore(a.compressedSize);case 112:e.next=62;break;case 114:e.next=120;break;case 116:if(e.prev=116,e.t2=e.catch(61),e.t2 instanceof strtok3.EndOfStreamError){e.next=120;break}throw e.t2;case 120:return e.abrupt("return",{ext:"zip",mime:"application/zip"});case 121:if(!i("OggS")){e.next=140;break}return e.next=124,t.ignore(28);case 124:return l=Buffer.alloc(8),e.next=127,t.readBuffer(l);case 127:if(!_check(l,[79,112,117,115,72,101,97,100])){e.next=129;break}return e.abrupt("return",{ext:"opus",mime:"audio/opus"});case 129:if(!_check(l,[128,116,104,101,111,114,97])){e.next=131;break}return e.abrupt("return",{ext:"ogv",mime:"video/ogg"});case 131:if(!_check(l,[1,118,105,100,101,111,0])){e.next=133;break}return e.abrupt("return",{ext:"ogm",mime:"video/ogg"});case 133:if(!_check(l,[127,70,76,65,67])){e.next=135;break}return e.abrupt("return",{ext:"oga",mime:"audio/ogg"});case 135:if(!_check(l,[83,112,101,101,120,32,32])){e.next=137;break}return e.abrupt("return",{ext:"spx",mime:"audio/ogg"});case 137:if(!_check(l,[1,118,111,114,98,105,115])){e.next=139;break}return e.abrupt("return",{ext:"ogg",mime:"audio/ogg"});case 139:return e.abrupt("return",{ext:"ogx",mime:"application/ogg"});case 140:if(!n([80,75])||3!==r[2]&&5!==r[2]&&7!==r[2]||4!==r[3]&&6!==r[3]&&8!==r[3]){e.next=142;break}return e.abrupt("return",{ext:"zip",mime:"application/zip"});case 142:if(!i("ftyp",{offset:4})||0==(96&r[8])){e.next=167;break}d=r.toString("binary",8,12).replace("\0"," ").trim(),e.t3=d,e.next="avif"===e.t3?147:"mif1"===e.t3?148:"msf1"===e.t3?149:"heic"===e.t3||"heix"===e.t3?150:"hevc"===e.t3||"hevx"===e.t3?151:"qt"===e.t3?152:"M4V"===e.t3||"M4VH"===e.t3||"M4VP"===e.t3?153:"M4P"===e.t3?154:"M4B"===e.t3?155:"M4A"===e.t3?156:"F4V"===e.t3?157:"F4P"===e.t3?158:"F4A"===e.t3?159:"F4B"===e.t3?160:"crx"===e.t3?161:162;break;case 147:return e.abrupt("return",{ext:"avif",mime:"image/avif"});case 148:return e.abrupt("return",{ext:"heic",mime:"image/heif"});case 149:return e.abrupt("return",{ext:"heic",mime:"image/heif-sequence"});case 150:return e.abrupt("return",{ext:"heic",mime:"image/heic"});case 151:return e.abrupt("return",{ext:"heic",mime:"image/heic-sequence"});case 152:return e.abrupt("return",{ext:"mov",mime:"video/quicktime"});case 153:return e.abrupt("return",{ext:"m4v",mime:"video/x-m4v"});case 154:return e.abrupt("return",{ext:"m4p",mime:"video/mp4"});case 155:return e.abrupt("return",{ext:"m4b",mime:"audio/mp4"});case 156:return e.abrupt("return",{ext:"m4a",mime:"audio/x-m4a"});case 157:return e.abrupt("return",{ext:"f4v",mime:"video/mp4"});case 158:return e.abrupt("return",{ext:"f4p",mime:"video/mp4"});case 159:return e.abrupt("return",{ext:"f4a",mime:"audio/mp4"});case 160:return e.abrupt("return",{ext:"f4b",mime:"audio/mp4"});case 161:return e.abrupt("return",{ext:"cr3",mime:"image/x-canon-cr3"});case 162:if(!d.startsWith("3g")){e.next=166;break}if(!d.startsWith("3g2")){e.next=165;break}return e.abrupt("return",{ext:"3g2",mime:"video/3gpp2"});case 165:return e.abrupt("return",{ext:"3gp",mime:"video/3gpp"});case 166:return e.abrupt("return",{ext:"mp4",mime:"video/mp4"});case 167:if(!i("MThd")){e.next=169;break}return e.abrupt("return",{ext:"mid",mime:"audio/midi"});case 169:if(!i("wOFF")||!n([0,1,0,0],{offset:4})&&!i("OTTO",{offset:4})){e.next=171;break}return e.abrupt("return",{ext:"woff",mime:"font/woff"});case 171:if(!i("wOF2")||!n([0,1,0,0],{offset:4})&&!i("OTTO",{offset:4})){e.next=173;break}return e.abrupt("return",{ext:"woff2",mime:"font/woff2"});case 173:if(!n([212,195,178,161])&&!n([161,178,195,212])){e.next=175;break}return e.abrupt("return",{ext:"pcap",mime:"application/vnd.tcpdump.pcap"});case 175:if(!i("DSD ")){e.next=177;break}return e.abrupt("return",{ext:"dsf",mime:"audio/x-dsf"});case 177:if(!i("LZIP")){e.next=179;break}return e.abrupt("return",{ext:"lz",mime:"application/x-lzip"});case 179:if(!i("fLaC")){e.next=181;break}return e.abrupt("return",{ext:"flac",mime:"audio/x-flac"});case 181:if(!n([66,80,71,251])){e.next=183;break}return e.abrupt("return",{ext:"bpg",mime:"image/bpg"});case 183:if(!i("wvpk")){e.next=185;break}return e.abrupt("return",{ext:"wv",mime:"audio/wavpack"});case 185:if(!i("%PDF")){e.next=195;break}return e.next=188,t.ignore(1350);case 188:return p=Buffer.alloc(Math.min(10485760,t.fileInfo.size)),e.next=192,t.readBuffer(p,{mayBeLess:!0});case 192:if(-1===p.indexOf(Buffer.from("AIPrivateData"))){e.next=194;break}return e.abrupt("return",{ext:"ai",mime:"application/postscript"});case 194:return e.abrupt("return",{ext:"pdf",mime:"application/pdf"});case 195:if(!n([0,97,115,109])){e.next=197;break}return e.abrupt("return",{ext:"wasm",mime:"application/wasm"});case 197:if(!n([73,73,42,0])){e.next=210;break}if(!i("CR",{offset:8})){e.next=200;break}return e.abrupt("return",{ext:"cr2",mime:"image/x-canon-cr2"});case 200:if(!n([28,0,254,0],{offset:8})&&!n([31,0,11,0],{offset:8})){e.next=202;break}return e.abrupt("return",{ext:"nef",mime:"image/x-nikon-nef"});case 202:if(!n([8,0,0,0],{offset:4})||!n([45,0,254,0],{offset:8})&&!n([39,0,254,0],{offset:8})){e.next=204;break}return e.abrupt("return",{ext:"dng",mime:"image/x-adobe-dng"});case 204:return r=Buffer.alloc(24),e.next=207,t.peekBuffer(r);case 207:if(!n([16,251,134,1],{offset:4})&&!n([8,0,0,0],{offset:4})||!n([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})){e.next=209;break}return e.abrupt("return",{ext:"arw",mime:"image/x-sony-arw"});case 209:return e.abrupt("return",{ext:"tif",mime:"image/tiff"});case 210:if(!n([77,77,0,42])){e.next=212;break}return e.abrupt("return",{ext:"tif",mime:"image/tiff"});case 212:if(!i("MAC ")){e.next=214;break}return e.abrupt("return",{ext:"ape",mime:"audio/ape"});case 214:if(!n([26,69,223,163])){e.next=230;break}return f=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){var r,n,i,o;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.peekNumber(Token.UINT8);case 2:for(r=e.sent,n=128,i=0;0==(r&n);)++i,n>>=1;return o=Buffer.alloc(i+1),e.next=9,t.readBuffer(o);case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){var t,r,n;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return t=e.sent,e.next=5,f();case 5:return(r=e.sent)[0]^=128>>r.length-1,n=Math.min(6,r.length),e.abrupt("return",{id:t.readUIntBE(0,t.length),len:r.readUIntBE(r.length-n,n)});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(r,n){var i;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n>0)){e.next=11;break}return e.next=3,h();case 3:if(17026!==(i=e.sent).id){e.next=6;break}return e.abrupt("return",t.readToken(new Token.StringType(i.len,"utf-8")));case 6:return e.next=8,t.ignore(i.len);case 8:--n,e.next=0;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),e.next=220,h();case 220:return g=e.sent,e.next=223,m(1,g.len);case 223:v=e.sent,e.t4=v,e.next="webm"===e.t4?227:"matroska"===e.t4?228:229;break;case 227:return e.abrupt("return",{ext:"webm",mime:"video/webm"});case 228:return e.abrupt("return",{ext:"mkv",mime:"video/x-matroska"});case 229:return e.abrupt("return");case 230:if(!n([82,73,70,70])){e.next=237;break}if(!n([65,86,73],{offset:8})){e.next=233;break}return e.abrupt("return",{ext:"avi",mime:"video/vnd.avi"});case 233:if(!n([87,65,86,69],{offset:8})){e.next=235;break}return e.abrupt("return",{ext:"wav",mime:"audio/vnd.wave"});case 235:if(!n([81,76,67,77],{offset:8})){e.next=237;break}return e.abrupt("return",{ext:"qcp",mime:"audio/qcelp"});case 237:if(!i("SQLi")){e.next=239;break}return e.abrupt("return",{ext:"sqlite",mime:"application/x-sqlite3"});case 239:if(!n([78,69,83,26])){e.next=241;break}return e.abrupt("return",{ext:"nes",mime:"application/x-nintendo-nes-rom"});case 241:if(!i("Cr24")){e.next=243;break}return e.abrupt("return",{ext:"crx",mime:"application/x-google-chrome-extension"});case 243:if(!i("MSCF")&&!i("ISc(")){e.next=245;break}return e.abrupt("return",{ext:"cab",mime:"application/vnd.ms-cab-compressed"});case 245:if(!n([237,171,238,219])){e.next=247;break}return e.abrupt("return",{ext:"rpm",mime:"application/x-rpm"});case 247:if(!n([197,208,211,198])){e.next=249;break}return e.abrupt("return",{ext:"eps",mime:"application/eps"});case 249:if(!n([40,181,47,253])){e.next=251;break}return e.abrupt("return",{ext:"zst",mime:"application/zstd"});case 251:if(!n([79,84,84,79,0])){e.next=253;break}return e.abrupt("return",{ext:"otf",mime:"font/otf"});case 253:if(!i("#!AMR")){e.next=255;break}return e.abrupt("return",{ext:"amr",mime:"audio/amr"});case 255:if(!i("{\\rtf")){e.next=257;break}return e.abrupt("return",{ext:"rtf",mime:"application/rtf"});case 257:if(!n([70,76,86,1])){e.next=259;break}return e.abrupt("return",{ext:"flv",mime:"video/x-flv"});case 259:if(!i("IMPM")){e.next=261;break}return e.abrupt("return",{ext:"it",mime:"audio/x-it"});case 261:if(!(i("-lh0-",{offset:2})||i("-lh1-",{offset:2})||i("-lh2-",{offset:2})||i("-lh3-",{offset:2})||i("-lh4-",{offset:2})||i("-lh5-",{offset:2})||i("-lh6-",{offset:2})||i("-lh7-",{offset:2})||i("-lzs-",{offset:2})||i("-lz4-",{offset:2})||i("-lz5-",{offset:2})||i("-lhd-",{offset:2}))){e.next=263;break}return e.abrupt("return",{ext:"lzh",mime:"application/x-lzh-compressed"});case 263:if(!n([0,0,1,186])){e.next=268;break}if(!n([33],{offset:4,mask:[241]})){e.next=266;break}return e.abrupt("return",{ext:"mpg",mime:"video/MP1S"});case 266:if(!n([68],{offset:4,mask:[196]})){e.next=268;break}return e.abrupt("return",{ext:"mpg",mime:"video/MP2P"});case 268:if(!i("ITSF")){e.next=270;break}return e.abrupt("return",{ext:"chm",mime:"application/vnd.ms-htmlhelp"});case 270:if(!n([253,55,122,88,90,0])){e.next=272;break}return e.abrupt("return",{ext:"xz",mime:"application/x-xz"});case 272:if(!i("<?xml ")){e.next=274;break}return e.abrupt("return",{ext:"xml",mime:"application/xml"});case 274:if(!n([55,122,188,175,39,28])){e.next=276;break}return e.abrupt("return",{ext:"7z",mime:"application/x-7z-compressed"});case 276:if(!n([82,97,114,33,26,7])||0!==r[6]&&1!==r[6]){e.next=278;break}return e.abrupt("return",{ext:"rar",mime:"application/x-rar-compressed"});case 278:if(!i("solid ")){e.next=280;break}return e.abrupt("return",{ext:"stl",mime:"model/stl"});case 280:if(!i("BLENDER")){e.next=282;break}return e.abrupt("return",{ext:"blend",mime:"application/x-blender"});case 282:if(!i("!<arch>")){e.next=291;break}return e.next=285,t.ignore(8);case 285:return e.next=287,t.readToken(new Token.StringType(13,"ascii"));case 287:if("debian-binary"!==e.sent){e.next=290;break}return e.abrupt("return",{ext:"deb",mime:"application/x-deb"});case 290:return e.abrupt("return",{ext:"ar",mime:"application/x-unix-archive"});case 291:if(!n([137,80,78,71,13,10,26,10])){e.next=309;break}return y=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readToken(Token.INT32_BE);case 2:return e.t0=e.sent,e.next=5,t.readToken(new Token.StringType(4,"binary"));case 5:return e.t1=e.sent,e.abrupt("return",{length:e.t0,type:e.t1});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.next=295,t.ignore(8);case 295:return e.next=297,y();case 297:if(!((b=e.sent).length<0)){e.next=300;break}return e.abrupt("return");case 300:e.t5=b.type,e.next="IDAT"===e.t5?303:"acTL"===e.t5?304:305;break;case 303:return e.abrupt("return",{ext:"png",mime:"image/png"});case 304:return e.abrupt("return",{ext:"apng",mime:"image/apng"});case 305:return e.next=307,t.ignore(b.length+4);case 307:if(t.position+8<t.fileInfo.size){e.next=295;break}case 308:return e.abrupt("return",{ext:"png",mime:"image/png"});case 309:if(!n([65,82,82,79,87,49,0,0])){e.next=311;break}return e.abrupt("return",{ext:"arrow",mime:"application/x-apache-arrow"});case 311:if(!n([103,108,84,70,2,0,0,0])){e.next=313;break}return e.abrupt("return",{ext:"glb",mime:"model/gltf-binary"});case 313:if(!(n([102,114,101,101],{offset:4})||n([109,100,97,116],{offset:4})||n([109,111,111,118],{offset:4})||n([119,105,100,101],{offset:4}))){e.next=315;break}return e.abrupt("return",{ext:"mov",mime:"video/quicktime"});case 315:if(!n([73,73,82,79,8,0,0,0,24])){e.next=317;break}return e.abrupt("return",{ext:"orf",mime:"image/x-olympus-orf"});case 317:if(!i("gimp xcf ")){e.next=319;break}return e.abrupt("return",{ext:"xcf",mime:"image/x-xcf"});case 319:if(!n([73,73,85,0,24,0,0,0,136,231,116,216])){e.next=321;break}return e.abrupt("return",{ext:"rw2",mime:"image/x-panasonic-rw2"});case 321:if(!n([48,38,178,117,142,102,207,17,166,217])){e.next=345;break}return S=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){var r;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Buffer.alloc(16),e.next=3,t.readBuffer(r);case 3:return e.t0=r,e.next=6,t.readToken(Token.UINT64_LE);case 6:return e.t1=e.sent,e.abrupt("return",{id:e.t0,size:e.t1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.next=325,t.ignore(30);case 325:if(!(t.position+24<t.fileInfo.size)){e.next=344;break}return e.next=328,S();case 328:if(_=e.sent,M=_.size-24,!_check(_.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){e.next=340;break}return T=Buffer.alloc(16),e.next=334,t.readBuffer(T);case 334:if(M-=e.sent,!_check(T,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43])){e.next=337;break}return e.abrupt("return",{ext:"asf",mime:"audio/x-ms-asf"});case 337:if(!_check(T,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43])){e.next=339;break}return e.abrupt("return",{ext:"asf",mime:"video/x-ms-asf"});case 339:return e.abrupt("break",344);case 340:return e.next=342,t.ignore(M);case 342:e.next=325;break;case 344:return e.abrupt("return",{ext:"asf",mime:"application/vnd.ms-asf"});case 345:if(!n([171,75,84,88,32,49,49,187,13,10,26,10])){e.next=347;break}return e.abrupt("return",{ext:"ktx",mime:"image/ktx"});case 347:if(!n([126,16,4])&&!n([126,24,4])||!n([48,77,73,69],{offset:4})){e.next=349;break}return e.abrupt("return",{ext:"mie",mime:"application/x-mie"});case 349:if(!n([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2})){e.next=351;break}return e.abrupt("return",{ext:"shp",mime:"application/x-esri-shape"});case 351:if(!n([0,0,0,12,106,80,32,32,13,10,135,10])){e.next=365;break}return e.next=354,t.ignore(20);case 354:return e.next=356,t.readToken(new Token.StringType(4,"ascii"));case 356:w=e.sent,e.t6=w,e.next="jp2 "===e.t6?360:"jpx "===e.t6?361:"jpm "===e.t6?362:"mjp2"===e.t6?363:364;break;case 360:return e.abrupt("return",{ext:"jp2",mime:"image/jp2"});case 361:return e.abrupt("return",{ext:"jpx",mime:"image/jpx"});case 362:return e.abrupt("return",{ext:"jpm",mime:"image/jpm"});case 363:return e.abrupt("return",{ext:"mj2",mime:"image/mj2"});case 364:return e.abrupt("return");case 365:if(!n([255,10])&&!n([0,0,0,12,74,88,76,32,13,10,135,10])){e.next=367;break}return e.abrupt("return",{ext:"jxl",mime:"image/jxl"});case 367:if(!n([0,0,1,186])&&!n([0,0,1,179])){e.next=369;break}return e.abrupt("return",{ext:"mpg",mime:"video/mpeg"});case 369:if(!n([0,1,0,0,0])){e.next=371;break}return e.abrupt("return",{ext:"ttf",mime:"font/ttf"});case 371:if(!n([0,0,1,0])){e.next=373;break}return e.abrupt("return",{ext:"ico",mime:"image/x-icon"});case 373:if(!n([0,0,2,0])){e.next=375;break}return e.abrupt("return",{ext:"cur",mime:"image/x-icon"});case 375:if(!n([208,207,17,224,161,177,26,225])){e.next=377;break}return e.abrupt("return",{ext:"cfb",mime:"application/x-cfb"});case 377:return e.next=379,t.peekBuffer(r,{length:Math.min(256,t.fileInfo.size),mayBeLess:!0});case 379:if(!i("BEGIN:")){e.next=384;break}if(!i("VCARD",{offset:6})){e.next=382;break}return e.abrupt("return",{ext:"vcf",mime:"text/vcard"});case 382:if(!i("VCALENDAR",{offset:6})){e.next=384;break}return e.abrupt("return",{ext:"ics",mime:"text/calendar"});case 384:if(!i("FUJIFILMCCD-RAW")){e.next=386;break}return e.abrupt("return",{ext:"raf",mime:"image/x-fujifilm-raf"});case 386:if(!i("Extended Module:")){e.next=388;break}return e.abrupt("return",{ext:"xm",mime:"audio/x-xm"});case 388:if(!i("Creative Voice File")){e.next=390;break}return e.abrupt("return",{ext:"voc",mime:"audio/x-voc"});case 390:if(!(n([4,0,0,0])&&r.length>=16)){e.next=402;break}if(!((x=r.readUInt32LE(12))>12&&r.length>=x+16)){e.next=402;break}if(e.prev=393,I=r.slice(16,x+16).toString(),!JSON.parse(I).files){e.next=398;break}return e.abrupt("return",{ext:"asar",mime:"application/x-asar"});case 398:e.next=402;break;case 400:e.prev=400,e.t7=e.catch(393);case 402:if(!n([6,14,43,52,2,5,1,1,13,1,2,1,1,2])){e.next=404;break}return e.abrupt("return",{ext:"mxf",mime:"application/mxf"});case 404:if(!i("SCRM",{offset:44})){e.next=406;break}return e.abrupt("return",{ext:"s3m",mime:"audio/x-s3m"});case 406:if(!n([71],{offset:4})||!n([71],{offset:192})&&!n([71],{offset:196})){e.next=408;break}return e.abrupt("return",{ext:"mts",mime:"video/mp2t"});case 408:if(!n([66,79,79,75,77,79,66,73],{offset:60})){e.next=410;break}return e.abrupt("return",{ext:"mobi",mime:"application/x-mobipocket-ebook"});case 410:if(!n([68,73,67,77],{offset:128})){e.next=412;break}return e.abrupt("return",{ext:"dcm",mime:"application/dicom"});case 412:if(!n([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70])){e.next=414;break}return e.abrupt("return",{ext:"lnk",mime:"application/x.ms.shortcut"});case 414:if(!n([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0])){e.next=416;break}return e.abrupt("return",{ext:"alias",mime:"application/x.apple.alias"});case 416:if(!n([76,80],{offset:34})||!(n([0,0,1],{offset:8})||n([1,0,2],{offset:8})||n([2,0,2],{offset:8}))){e.next=418;break}return e.abrupt("return",{ext:"eot",mime:"application/vnd.ms-fontobject"});case 418:if(!n([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29])){e.next=420;break}return e.abrupt("return",{ext:"indd",mime:"application/x-indesign"});case 420:return e.next=422,t.peekBuffer(r,{length:Math.min(512,t.fileInfo.size),mayBeLess:!0});case 422:if(!tarHeaderChecksumMatches(r)){e.next=424;break}return e.abrupt("return",{ext:"tar",mime:"application/x-tar"});case 424:if(!n([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0])){e.next=426;break}return e.abrupt("return",{ext:"skp",mime:"application/vnd.sketchup.skp"});case 426:if(!i("-----BEGIN PGP MESSAGE-----")){e.next=428;break}return e.abrupt("return",{ext:"pgp",mime:"application/pgp-encrypted"});case 428:if(!(r.length>=2&&n([255,224],{offset:0,mask:[255,224]}))){e.next=439;break}if(!n([16],{offset:1,mask:[22]})){e.next=433;break}if(!n([8],{offset:1,mask:[8]})){e.next=432;break}return e.abrupt("return",{ext:"aac",mime:"audio/aac"});case 432:return e.abrupt("return",{ext:"aac",mime:"audio/aac"});case 433:if(!n([2],{offset:1,mask:[6]})){e.next=435;break}return e.abrupt("return",{ext:"mp3",mime:"audio/mpeg"});case 435:if(!n([4],{offset:1,mask:[6]})){e.next=437;break}return e.abrupt("return",{ext:"mp2",mime:"audio/mpeg"});case 437:if(!n([6],{offset:1,mask:[6]})){e.next=439;break}return e.abrupt("return",{ext:"mp1",mime:"audio/mpeg"});case 439:case"end":return e.stop()}}),e,this,[[61,116],[393,400]])}))),function(e){return _ref6.apply(this,arguments)}),_ref6;function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var Token=__webpack_require__(373),strtok3=__webpack_require__(374),_require=__webpack_require__(378),stringToBytes=_require.stringToBytes,tarHeaderChecksumMatches=_require.tarHeaderChecksumMatches,uint32SyncSafeToken=_require.uint32SyncSafeToken,supported=__webpack_require__(379),minimumBytes=4100;function _check(e,t,r){r=(0,_assign2.default)({offset:0},r);var n=!0,i=!1,o=void 0;try{for(var a,s=(0,_getIterator3.default)(t.entries());!(n=(a=s.next()).done);n=!0){var c=a.value,u=(0,_slicedToArray3.default)(c,2),l=u[0],d=u[1];if(r.mask){if(d!==(r.mask[l]&e[l+r.offset]))return!1}else if(d!==e[l+r.offset])return!1}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return!0}var stream=function stream(readableStream){return new _promise2.default((function(resolve,reject){var stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",(0,_asyncToGenerator3.default)(_regenerator2.default.mark((function e(){var t,r,n,i;return _regenerator2.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new stream.PassThrough,r=void 0,r=stream.pipeline?stream.pipeline(readableStream,t,(function(){})):readableStream.pipe(t),n=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0),e.prev=4,e.next=7,fromBuffer(n);case 7:i=e.sent,t.fileType=i,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),reject(e.t0);case 14:resolve(r);case 15:case"end":return e.stop()}}),e,void 0,[[4,11]])}))))}))},fileType={fromStream:fromStream,fromTokenizer:fromTokenizer,fromBuffer:fromBuffer,stream:stream};Object.defineProperty(fileType,"extensions",{get:function(){return new _set2.default(supported.extensions)}}),Object.defineProperty(fileType,"mimeTypes",{get:function(){return new _set2.default(supported.mimeTypes)}}),module.exports=fileType}).call(this,__webpack_require__(44).Buffer)},function(e,t,r){e.exports={default:r(371),__esModule:!0}},function(e,t,r){r(372),e.exports=9007199254740991},function(e,t,r){var n=r(8);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){var n=o(r(0)),i=o(r(1));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.writeIntBE=t.readIntBE=t.writeUIntBE=t.readUIntBE=t.writeIntLE=t.AnsiStringType=t.StringType=t.BufferType=t.IgnoreType=t.Float80_LE=t.Float80_BE=t.Float64_LE=t.Float64_BE=t.Float32_LE=t.Float32_BE=t.Float16_LE=t.Float16_BE=t.INT64_BE=t.UINT64_BE=t.INT64_LE=t.UINT64_LE=t.INT32_LE=t.INT32_BE=t.INT24_BE=t.INT24_LE=t.INT16_LE=t.INT16_BE=t.INT8=t.UINT32_BE=t.UINT32_LE=t.UINT24_BE=t.UINT24_LE=t.UINT16_BE=t.UINT16_LE=t.UINT8=void 0;var a=r(223);t.UINT8={len:1,get:function(e,t){return e.readUInt8(t)},put:function(e,t,r){return e.writeUInt8(r,t)}},t.UINT16_LE={len:2,get:function(e,t){return e.readUInt16LE(t)},put:function(e,t,r){return e.writeUInt16LE(r,t)}},t.UINT16_BE={len:2,get:function(e,t){return e.readUInt16BE(t)},put:function(e,t,r){return e.writeUInt16BE(r,t)}},t.UINT24_LE={len:3,get:function(e,t){return e.readUIntLE(t,3)},put:function(e,t,r){return e.writeUIntLE(r,t,3)}},t.UINT24_BE={len:3,get:function(e,t){return e.readUIntBE(t,3)},put:function(e,t,r){return e.writeUIntBE(r,t,3)}},t.UINT32_LE={len:4,get:function(e,t){return e.readUInt32LE(t)},put:function(e,t,r){return e.writeUInt32LE(r,t)}},t.UINT32_BE={len:4,get:function(e,t){return e.readUInt32BE(t)},put:function(e,t,r){return e.writeUInt32BE(r,t)}},t.INT8={len:1,get:function(e,t){return e.readInt8(t)},put:function(e,t,r){return e.writeInt8(r,t)}},t.INT16_BE={len:2,get:function(e,t){return e.readInt16BE(t)},put:function(e,t,r){return e.writeInt16BE(r,t)}},t.INT16_LE={len:2,get:function(e,t){return e.readInt16LE(t)},put:function(e,t,r){return e.writeInt16LE(r,t)}},t.INT24_LE={len:3,get:function(e,t){return e.readIntLE(t,3)},put:function(e,t,r){return e.writeIntLE(r,t,3)}},t.INT24_BE={len:3,get:function(e,t){return e.readIntBE(t,3)},put:function(e,t,r){return e.writeIntBE(r,t,3)}},t.INT32_BE={len:4,get:function(e,t){return e.readInt32BE(t)},put:function(e,t,r){return e.writeInt32BE(r,t)}},t.INT32_LE={len:4,get:function(e,t){return e.readInt32LE(t)},put:function(e,t,r){return e.writeInt32LE(r,t)}},t.UINT64_LE={len:8,get:function(e,t){return function(e,t,r){r>>>=0;for(var n=e[t>>>=0],i=1,o=0;++o<r&&(i*=256);)n+=e[t+o]*i;return n}(e,t,this.len)},put:function(e,t,r){return function(e,t,r,n){t=+t,n>>>=0;var i=1,o=0;for(e[r>>>=0]=255&t;++o<n&&(i*=256);)e[r+o]=t/i&255;return r+n}(e,r,t,this.len)}},t.INT64_LE={len:8,get:function(e,t){return function(e,t,r){r>>>=0;for(var n=e[t>>>=0],i=1,o=0;++o<r&&(i*=256);)n+=e[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*r)),n}(e,t,this.len)},put:function(e,t,r){return d(e,r,t,this.len)}},t.UINT64_BE={len:8,get:function(e,t){return p(e,t,this.len)},put:function(e,t,r){return f(e,r,t,this.len)}},t.INT64_BE={len:8,get:function(e,t){return h(e,t,this.len)},put:function(e,t,r){return m(e,r,t,this.len)}},t.Float16_BE={len:2,get:function(e,t){return a.read(e,t,!1,10,this.len)},put:function(e,t,r){return a.write(e,r,t,!1,10,this.len),t+this.len}},t.Float16_LE={len:2,get:function(e,t){return a.read(e,t,!0,10,this.len)},put:function(e,t,r){return a.write(e,r,t,!0,10,this.len),t+this.len}},t.Float32_BE={len:4,get:function(e,t){return e.readFloatBE(t)},put:function(e,t,r){return e.writeFloatBE(r,t)}},t.Float32_LE={len:4,get:function(e,t){return e.readFloatLE(t)},put:function(e,t,r){return e.writeFloatLE(r,t)}},t.Float64_BE={len:8,get:function(e,t){return e.readDoubleBE(t)},put:function(e,t,r){return e.writeDoubleBE(r,t)}},t.Float64_LE={len:8,get:function(e,t){return e.readDoubleLE(t)},put:function(e,t,r){return e.writeDoubleLE(r,t)}},t.Float80_BE={len:10,get:function(e,t){return a.read(e,t,!1,63,this.len)},put:function(e,t,r){return a.write(e,r,t,!1,63,this.len),t+this.len}},t.Float80_LE={len:10,get:function(e,t){return a.read(e,t,!0,63,this.len)},put:function(e,t,r){return a.write(e,r,t,!0,63,this.len),t+this.len}};var s=function(){function e(t){(0,n.default)(this,e),this.len=t}return(0,i.default)(e,[{key:"get",value:function(e,t){}}]),e}();t.IgnoreType=s;var c=function(){function e(t){(0,n.default)(this,e),this.len=t}return(0,i.default)(e,[{key:"get",value:function(e,t){return e.slice(t,t+this.len)}}]),e}();t.BufferType=c;var u=function(){function e(t,r){(0,n.default)(this,e),this.len=t,this.encoding=r}return(0,i.default)(e,[{key:"get",value:function(e,t){return e.toString(this.encoding,t,t+this.len)}}]),e}();t.StringType=u;var l=function(){function e(t){(0,n.default)(this,e),this.len=t}return(0,i.default)(e,[{key:"get",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.decode(t,r,r+this.len)}}],[{key:"decode",value:function(t,r,n){for(var i="",o=r;o<n;++o)i+=e.codePointToString(e.singleByteDecoder(t[o]));return i}},{key:"inRange",value:function(e,t,r){return t<=e&&e<=r}},{key:"codePointToString",value:function(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}},{key:"singleByteDecoder",value:function(t){if(e.inRange(t,0,127))return t;var r=e.windows1252[t-128];if(null===r)throw Error("invaliding encoding");return r}}]),e}();function d(e,t,r,n){t=+t;var i=0,o=1,a=0;for(e[r>>>=0]=255&t;++i<n&&(o*=256);)t<0&&0===a&&0!==e[r+i-1]&&(a=1),e[r+i]=(t/o>>0)-a&255;return r+n}function p(e,t,r){r>>>=0;for(var n=e[(t>>>=0)+--r],i=1;r>0&&(i*=256);)n+=e[t+--r]*i;return n}function f(e,t,r,n){t=+t;var i=(n>>>=0)-1,o=1;for(e[(r>>>=0)+i]=255&t;--i>=0&&(o*=256);)e[r+i]=t/o&255;return r+n}function h(e,t,r){for(var n=r>>>=0,i=1,o=e[(t>>>=0)+--n];n>0&&(i*=256);)o+=e[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*r)),o}function m(e,t,r,n){t=+t;var i=n-1,o=1,a=0;for(e[(r>>>=0)+i]=255&t;--i>=0&&(o*=256);)t<0&&0===a&&0!==e[r+i+1]&&(a=1),e[r+i]=(t/o>>0)-a&255;return r+n}t.AnsiStringType=l,l.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255],t.writeIntLE=d,t.readUIntBE=p,t.writeUIntBE=f,t.readIntBE=h,t.writeIntBE=m},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.fromBuffer=t.fromStream=t.EndOfStreamError=void 0;var n=r(375),i=r(377),o=r(105);Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return o.EndOfStreamError}}),t.fromStream=function(e,t){return t=t||{},new n.ReadStreamTokenizer(e,t)},t.fromBuffer=function(e,t){return new i.BufferTokenizer(e,t)}},function(e,t,r){(function(e){var n=d(r(70)),i=d(r(21)),o=d(r(57)),a=d(r(2)),s=d(r(0)),c=d(r(1)),u=d(r(3)),l=d(r(4));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ReadStreamTokenizer=void 0;var p=r(376),f=r(105),h=function(t){function r(e,t){(0,s.default)(this,r);var n=(0,u.default)(this,(r.__proto__||(0,a.default)(r)).call(this,t));return n.streamReader=new f.StreamReader(e),n}var d,p,h,m;return(0,l.default)(r,t),(0,c.default)(r,[{key:"getFileInfo",value:(m=(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fileInfo);case 1:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"readBuffer",value:(h=(0,o.default)(i.default.mark((function e(t,r){var o,a,s,c;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=0,a=t.length,!r){e.next=15;break}if((0,n.default)(r.length)?a=r.length:a-=r.offset||0,!r.position){e.next=14;break}if(!((s=r.position-this.position)>0)){e.next=12;break}return e.next=9,this.ignore(s);case 9:return e.abrupt("return",this.readBuffer(t,r));case 12:if(!(s<0)){e.next=14;break}throw new Error("`options.position` must be equal or greater than `tokenizer.position`");case 14:r.offset&&(o=r.offset);case 15:if(0!==a){e.next=17;break}return e.abrupt("return",0);case 17:return e.next=19,this.streamReader.read(t,o,a);case 19:if(c=e.sent,this.position+=c,r&&r.mayBeLess||!(c<a)){e.next=23;break}throw new f.EndOfStreamError;case 23:return e.abrupt("return",c);case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"peekBuffer",value:(p=(0,o.default)(i.default.mark((function t(r,o){var a,s,c,u,l;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=0,s=void 0,c=r.length,!o){t.next=19;break}if(o.offset&&(a=o.offset),(0,n.default)(o.length)?c=o.length:c-=o.offset||0,!o.position){t.next=19;break}if(!((u=o.position-this.position)>0)){t.next=17;break}return l=e.alloc(c+u),t.next=12,this.peekBuffer(l,{mayBeLess:o.mayBeLess});case 12:return s=t.sent,l.copy(r,a,u),t.abrupt("return",s-u);case 17:if(!(u<0)){t.next=19;break}throw new Error("Cannot peek from a negative offset in a stream");case 19:return t.prev=19,t.next=22,this.streamReader.peek(r,a,c);case 22:s=t.sent,t.next=30;break;case 25:if(t.prev=25,t.t0=t.catch(19),!(o&&o.mayBeLess&&t.t0 instanceof f.EndOfStreamError)){t.next=29;break}return t.abrupt("return",0);case 29:throw t.t0;case 30:if(o&&o.mayBeLess||!(s<c)){t.next=32;break}throw new f.EndOfStreamError;case 32:return t.abrupt("return",s);case 33:case"end":return t.stop()}}),t,this,[[19,25]])}))),function(e,t){return p.apply(this,arguments)})},{key:"ignore",value:(d=(0,o.default)(i.default.mark((function t(r){var n,o,a,s,c;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Math.min(256e3,r),o=e.alloc(n),a=0;case 3:if(!(a<r)){t.next=13;break}return s=r-a,t.next=7,this.readBuffer(o,{length:Math.min(n,s)});case 7:if(!((c=t.sent)<0)){t.next=10;break}return t.abrupt("return",c);case 10:a+=c,t.next=3;break;case 13:return t.abrupt("return",a);case 14:case"end":return t.stop()}}),t,this)}))),function(e){return d.apply(this,arguments)})}]),r}(p.AbstractTokenizer);t.ReadStreamTokenizer=h}).call(this,r(44).Buffer)},function(e,t,r){(function(e){var n=s(r(21)),i=s(r(57)),o=s(r(0)),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractTokenizer=void 0;var c=r(105),u=function(){function t(r){(0,o.default)(this,t),this.position=0,this.numBuffer=e.alloc(10),this.fileInfo=r||{}}var r,s,u,l,d;return(0,a.default)(t,[{key:"readToken",value:(d=(0,i.default)(n.default.mark((function t(r,i){var o;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.alloc(r.len),t.next=3,this.readBuffer(o,{position:i});case 3:if(!(t.sent<r.len)){t.next=6;break}throw new c.EndOfStreamError;case 6:return t.abrupt("return",r.get(o,0));case 7:case"end":return t.stop()}}),t,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"peekToken",value:(l=(0,i.default)(n.default.mark((function t(r){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.alloc(r.len),t.next=3,this.peekBuffer(i,{position:o});case 3:if(!(t.sent<r.len)){t.next=6;break}throw new c.EndOfStreamError;case 6:return t.abrupt("return",r.get(i,0));case 7:case"end":return t.stop()}}),t,this)}))),function(e){return l.apply(this,arguments)})},{key:"readNumber",value:(u=(0,i.default)(n.default.mark((function e(t){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readBuffer(this.numBuffer,{length:t.len});case 2:if(!(e.sent<t.len)){e.next=5;break}throw new c.EndOfStreamError;case 5:return e.abrupt("return",t.get(this.numBuffer,0));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"peekNumber",value:(s=(0,i.default)(n.default.mark((function e(t){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.peekBuffer(this.numBuffer,{length:t.len});case 2:if(!(e.sent<t.len)){e.next=5;break}throw new c.EndOfStreamError;case 5:return e.abrupt("return",t.get(this.numBuffer,0));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"close",value:(r=(0,i.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}]),t}();t.AbstractTokenizer=u}).call(this,r(44).Buffer)},function(e,t,r){var n=u(r(13)),i=u(r(70)),o=u(r(21)),a=u(r(57)),s=u(r(0)),c=u(r(1));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BufferTokenizer=void 0;var l=r(105),d=function(){function e(t,r){(0,s.default)(this,e),this.buffer=t,this.position=0,this.fileInfo=r||{},this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:t.length}var t,r,u,d,p,f,h,m;return(0,c.default)(e,[{key:"readBuffer",value:(m=(0,a.default)(o.default.mark((function e(t,r){var n=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||!r.position){e.next=4;break}if(!(r.position<this.position)){e.next=3;break}throw new Error("`options.position` must be equal or greater than `tokenizer.position`");case 3:this.position=r.position;case 4:return e.abrupt("return",this.peekBuffer(t,r).then((function(e){return n.position+=e,e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"peekBuffer",value:(h=(0,a.default)(o.default.mark((function e(t,r){var a,s,c,u;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=0,s=t.length,c=this.position,!r){e.next=10;break}if(!r.position){e.next=8;break}if(!(r.position<this.position)){e.next=7;break}throw new Error("`options.position` can be less than `tokenizer.position`");case 7:c=r.position;case 8:(0,i.default)(r.length)?s=r.length:s-=r.offset||0,r.offset&&(a=r.offset);case 10:if(0!==s){e.next=12;break}return e.abrupt("return",n.default.resolve(0));case 12:if(c=c||this.position,s||(s=t.length),u=Math.min(this.buffer.length-c,s),r&&r.mayBeLess||!(u<s)){e.next=19;break}throw new l.EndOfStreamError;case 19:return this.buffer.copy(t,a,c,c+u),e.abrupt("return",u);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"readToken",value:(f=(0,a.default)(o.default.mark((function e(t,r){var n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.position=r||this.position,e.prev=1,n=this.peekToken(t,this.position),this.position+=t.len,e.abrupt("return",n);case 7:throw e.prev=7,e.t0=e.catch(1),this.position+=this.buffer.length-r,e.t0;case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return f.apply(this,arguments)})},{key:"peekToken",value:(p=(0,a.default)(o.default.mark((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.position;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length-r<t.len)){e.next=2;break}throw new l.EndOfStreamError;case 2:return e.abrupt("return",t.get(this.buffer,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"readNumber",value:(d=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readToken(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"peekNumber",value:(u=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.peekToken(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"ignore",value:(r=(0,a.default)(o.default.mark((function e(t){var r;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Math.min(this.buffer.length-this.position,t),this.position+=r,e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"close",value:(t=(0,a.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();t.BufferTokenizer=d},function(e,t,r){var n,i=(n=r(41))&&n.__esModule?n:{default:n};t.stringToBytes=function(e){return[].concat((0,i.default)(e)).map((function(e){return e.charCodeAt(0)}))},t.tarHeaderChecksumMatches=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(r))return!1;for(var n=256,i=t;i<t+148;i++)n+=e[i];for(var o=t+156;o<t+512;o++)n+=e[o];return r===n},t.uint32SyncSafeToken={get:function(e,t){return 127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21},len:4}},function(e,t,r){e.exports={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.uploadMedia=void 0;var n=s(r(19)),i=s(r(13)),o=s(r(5)),a=s(r(238));function s(e){return e&&e.__esModule?e:{default:e}}a.default.setExpireTime(864e5),t.uploadMedia=function(e,t){if("function"==typeof e.getAuthInfo)c(e,t);else{if(e.nim&&"function"==typeof e.nim.previewFile)return e.nim.previewFile(t);e.logger.error("无法上传文件！！")}};var c=function(e,t){var r,n,i,s=(null===(r=e.serviceConf)||void 0===r?void 0:r.mediaUploadAddr)?e.serviceConf.mediaUploadAddr:"https://vcloud.163.com",c=(null===(n=e.serviceConf)||void 0===n?void 0:n.directNosAddr)?null===(i=e.serviceConf)||void 0===i?void 0:i.directNosAddr:"https://wanproxy-web.127.net";e.getAuthInfo().then((function(r){var n=a.default.createConfig({directUploadAddr:c,onError:function(e){t.done(e)},onProgress:function(e){t.uploadprogress({percentageText:(100*e).toFixed(2)+"%"})},onComplete:function(n){u(e,r,n).then((function(e){t.done(void 0,e)})).catch((function(e){t.done(e)}))}}),i=l(t),d=a.default.getFileUploadInformation(i);if(!d)return p((0,o.default)((0,o.default)({},r),{appkey:e.appkey,url:s+"/app/vod/upload/init"}),{originFileName:i.name}).then((function(e){a.default.createTask(i,{bucketName:e.ret.bucket,objectName:e.ret.object,token:e.ret.xNosToken,payload:{mediaType:t.mediaType}},n)})).catch((function(e){t.done(e)}));d.complete?n.onComplete(d.uploadInfo):a.default.createTask(i,d.uploadInfo,n)}))},u=function(e,t,r){var a,s=r&&r.payload&&r.payload.mediaType;if(!s)return i.default.reject("mediaType无法解析: "+s);var c=(null===(a=e.serviceConf)||void 0===a?void 0:a.mediaUploadAddr)?e.serviceConf.mediaUploadAddr:"https://vcloud.163.com";return p((0,o.default)((0,o.default)({url:c+"/app/vod/video/query"},t),{appkey:e.appkey}),{objectNames:[r.objectName]}).then((function(e){if(e.ret&&Array.isArray(e.ret.list)&&e.ret.list.length>0)return"image"===s&&e.ret.list[0].imgId?e.ret.list[0].imgId:e.ret.list[0].vid?e.ret.list[0].vid:i.default.reject("无法获取"+s+" id: "+(0,n.default)(e))})).then((function(r){var n="image"===s?{imageId:r}:{vid:r};return p((0,o.default)((0,o.default)({url:"image"===s?c+"/app/vod/image/get":c+"/app/vod/video/get"},t),{appkey:e.appkey}),n)})).then((function(e){var t=void 0;return"image"===s&&e.ret&&e.ret.url?t=e.ret.url:e.ret&&e.ret.origUrl&&(t=e.ret.origUrl),"string"==typeof t&&t.startsWith("http://")&&(t="https://"+t.slice(7)),"string"==typeof t?{url:t}:i.default.reject("找不到"+s+"的url地址: "+(0,n.default)(e))}))},l=function(e){var t=e.dataURL,r=e.fileInput,n=e.blob,i=e.fileName?e.fileName:Date.now().toString();if(r&&r.files&&r.files.length>0)return r.files[0];if(n)return new File([n],i,{type:"text/plain"});if(t)return d(t,i);throw new Error("previewFile参数中缺少数据")},d=function(e,t){for(var r=e.split(","),n=r[0].match(/:(.*?);/)[1],i=atob(r[1]),o=i.length,a=new Uint8Array(o);o--;)a[o]=i.charCodeAt(o);return new File([a],t,{type:n})},p=function(e,t){return fetch(e.url,{method:"post",headers:{"content-type":"application/json",AppKey:e.appkey,Nonce:e.nonce,CurTime:e.curTime.toString(),CheckSum:e.checksum},body:(0,n.default)(t)}).then((function(e){return e.ok?e.json():i.default.reject(e)})).then((function(e){return 200!==e.code?i.default.reject(e):e}))}},function(e,t,r){!function(r){function n(e,t){if(e instanceof Boolean||"boolean"==typeof e)return!1;if(t instanceof Object||(t={}),!1===t.allowEmpty&&""===e)return!1;var r="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?",n="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)";return!0===t.mimeRequired?r=n+r:!0===t.allowMime&&(r=n+"?"+r),!1===t.paddingRequired&&(r="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+r+"$","gi").test(e)}e.exports&&(t=e.exports=n),t.isBase64=n}()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.wrapPluginToOp=void 0;var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=d(r(134)),u=r(18),l=d(r(87));function d(e){return e&&e.__esModule?e:{default:e}}t.wrapPluginToOp=function(e,t){if(!c.default.validate(e,"OneMotionPlugin.wrapPluginToOp",t,{type:{type:"string",isRequire:!0},draw:{type:"function",isRequire:!0},ifMouseOnOp:{type:"function",isRequire:!0},getBoundary:{type:"function"}}))throw new Error("OneMotion插件参数错误，请仔细检查你的参数");return function(e){function r(){(0,i.default)(this,r);var e=(0,a.default)(this,(r.__proto__||(0,n.default)(r)).apply(this,arguments));return e.type=t.type,e.shouldSaniteEp=!0,e}return(0,s.default)(r,e),(0,o.default)(r,[{key:"getSnapshot",value:function(e){var r="function"==typeof t.getBoundary?t.getBoundary({sp:this.sp,ep:this.ep}):this.getBoundaryRectOfLine();return{type:t.type,boundary:r,inProgress:e,sp:this.sp,ep:this.ep,lineWidth:this.lineWidth,opacity:this.opacity,color:this.color}}},{key:"draw",value:function(e,r){var n=e.data,i=(0,u.getTransformedPoint)(n.sp,n.dx,n.dy,n.scaleX,n.scaleY),o=(0,u.getTransformedPoint)(n.ep,n.dx,n.dy,n.scaleX,n.scaleY);r.save(),t.draw({ctx:r,sp:i,ep:o,lineWidth:n.lineWidth,opacity:n.opacity,color:n.color}),r.restore()}},{key:"ifMouseOnOp",value:function(e,r,n){var i=this.app.container.ctx,o=e.data,a=(0,u.getTransformedPoint)(o.sp,o.dx,o.dy,o.scaleX,o.scaleY),s=(0,u.getTransformedPoint)(o.ep,o.dx,o.dy,o.scaleX,o.scaleY);i.save(),i.beginPath(),i.fillStyle="rgba(0,0,0,0)",i.strokeStyle="rgba(0,0,0,0)";var c=t.ifMouseOnOp(r,n,{ctx:i,sp:a,ep:s,lineWidth:o.lineWidth,opacity:o.opacity,color:o.color});return i.restore(),c}}]),r}(l.default)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(9)),i=c(r(31)),o=c(r(95)),a=c(r(0)),s=c(r(1));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){var r=this;(0,a.default)(this,e),this.isBroadcaster=!1,this.aliveMap=new o.default,this.aliveSet=new i.default,this.visionChangeCb=function(e,t){if("vision"===e){var n=r.shouldKeepAlive;t&&"broadcaster"===t.mode?r.isBroadcaster=!0:r.isBroadcaster=!1,r.update(n)}},this.sendAlive=function(){clearTimeout(r.aliveTimer);var e=Date.now()+r.app.ntpTimeDiff;r.app.dataHub.broadcastData({data:{type:"alive",value:{uid:r.app.account,t:e}}},"alive",!0),r.aliveMap.set(r.app.account,e),r.aliveSet.add(r.app.account),r.aliveTimer=setTimeout(r.sendAlive,7e3)},this.checkAlive=function(){var e=[],t=r.aliveMap.keys(),i=!0,o=!1,a=void 0;try{for(var s,c=(0,n.default)(t);!(i=(s=c.next()).done);i=!0){var u=s.value;r.isAlive(u)||(e.push(u),r.aliveMap.delete(u))}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}e.length>0&&r.app.emit("aliveManager:offline",e),clearTimeout(r.checkTimer),r.checkTimer=setTimeout(r.checkAlive,7e3)},this.app=t,this.app.isRecordPlayer||this.app.on("event:appState:change",this.visionChangeCb),this.checkAlive()}return(0,s.default)(e,[{key:"destroy",value:function(){this.app.isRecordPlayer||this.app.off("event:appState:change",this.visionChangeCb),clearTimeout(this.aliveTimer),clearTimeout(this.checkTimer)}},{key:"update",value:function(e){e!==this.shouldKeepAlive&&(this.shouldKeepAlive?(clearTimeout(this.aliveTimer),this.sendAlive()):clearTimeout(this.aliveTimer))}},{key:"receiveAlive",value:function(e){this.aliveMap.set(e.uid,e.t),this.aliveSet.add(e.uid.toString())}},{key:"receiveSyncData",value:function(e){var t;if(this.app.isRecordPlayer){var r=null===(t=this.app.player)||void 0===t?void 0:t.lastTime;if(r){var i=!0,o=!1,a=void 0;try{for(var s,c=(0,n.default)(e);!(i=(s=c.next()).done);i=!0){var u=s.value;r-u.time<2e4&&(this.aliveMap.set(u.record.value.uid.toString(),u.time),this.aliveSet.add(u.record.value.uid.toString()))}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}}}else{var l=Date.now()+this.app.ntpTimeDiff,d=!0,p=!1,f=void 0;try{for(var h,m=(0,n.default)(e);!(d=(h=m.next()).done);d=!0){var g=h.value;l-g.t<2e4&&(this.aliveMap.set(g.uid.toString(),g.t),this.aliveSet.add(g.uid.toString()))}}catch(e){p=!0,f=e}finally{try{!d&&m.return&&m.return()}finally{if(p)throw f}}}}},{key:"isAlive",value:function(e){var t;if(e&&!this.aliveSet.has(e))return!0;if(e&&this.aliveMap.has(e)){var r=this.aliveMap.get(e);if(this.app.isRecordPlayer){var n=null===(t=this.app.player)||void 0===t?void 0:t.lastTime;if(n&&n>r&&n-r<2e4)return!0}else{var i=Date.now()+this.app.ntpTimeDiff;if(Math.abs(i-r)<2e4)return!0}}return!1}},{key:"shouldKeepAlive",get:function(){return this.isBroadcaster}}]),e}();t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(0)),i=u(r(1)),o=u(r(385)),a=u(r(132)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(386)),c=r(239);function u(e){return e&&e.__esModule?e:{default:e}}var l=(new Date).valueOf(),d=function(){function e(t){(0,n.default)(this,e),this.dispatcher=new a.default,this.logger=new o.default("whiteboard-"+t,864e5),this.wrapLog(),this.log(c.SPLITTER)}return(0,i.default)(e,[{key:"getLogTilNow",value:function(){var e=(new Date).valueOf();return this.logger.get({start:0,end:e}).then((function(e){return e}))}},{key:"deleteLogTilNow",value:function(){var e=(new Date).valueOf();this.logger.delete({start:0,end:e})}},{key:"wrapLog",value:function(){this.log=this.wrapLogByType("log"),this.info=this.wrapLogByType("info"),this.error=this.wrapLogByType("error"),this.warn=this.wrapLogByType("warn"),this.debug=this.wrapLogByType("debug")}},{key:"wrapLogByType",value:function(e){var t=this;return function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];var o=Array.prototype.slice.apply(n);o=[t.getLogPrefix()].concat(o);var a=t.argsToString.call(t,o,e);try{t.dispatcher.emit("log",{type:e,msg:a}),"error"===e&&console[e].apply(console,o),t.logger.log(e,a)}catch(e){}}}},{key:"argsToString",value:function(e,t){var r="";try{for(var n=[],i=0;i<e.length;i++)s.isFunction(e[i])?n.push(e[i].toString()):s.isObject(e[i])||s.isArray(e[i])?n.push(s.JSONStringify(e[i])):n.push(e[i]);r=n.join(" ")}catch(e){}return this.padEnd(t,5)+" "+r}},{key:"getLogPrefix",value:function(){var e=new Date,t=e.valueOf()-l,r=e.toLocaleString();return"+"+this.pad(t/1e3,1,6)+"s "+r}},{key:"pad",value:function(e,t,r){for(var n=e.toFixed(t).toString();n.length<r;)n=" "+n;return n}},{key:"padEnd",value:function(e,t){for(;e.length<t;)e+=" ";return e}}]),e}();t.default=d},function(e,t,r){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=106)}([function(e,t,r){var n=r(3),i=r(27).f,o=r(74),a=r(9),s=r(12),c=r(14),u=r(13),l=function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,d,p,f,h,m,g,v,y=e.target,b=e.global,S=e.stat,_=e.proto,M=b?n:S?n[y]:(n[y]||{}).prototype,T=b?a:a[y]||(a[y]={}),w=T.prototype;for(p in t)r=!o(b?p:y+(S?".":"#")+p,e.forced)&&M&&u(M,p),h=T[p],r&&(m=e.noTargetGet?(v=i(M,p))&&v.value:M[p]),f=r&&m?m:t[p],r&&typeof h==typeof f||(g=e.bind&&r?s(f,n):e.wrap&&r?l(f):_&&"function"==typeof f?s(Function.call,f):f,(e.sham||f&&f.sham||h&&h.sham)&&c(g,"sham",!0),T[p]=g,_&&(u(a,d=y+"Prototype")||c(a,d,{}),a[d][p]=f,e.real&&w&&!w[p]&&c(w,p,f)))}},function(e,t,r){var n=r(10);e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){e.exports=!0},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,r(110))},function(e,t,r){var n=r(1),i=r(116),o=r(29),a=r(12),s=r(82),c=r(117),u=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,r){var l,d,p,f,h,m,g,v=r&&r.that,y=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_ITERATOR),S=!(!r||!r.INTERRUPTED),_=a(t,v,1+y+S),M=function(e){return l&&c(l),new u(!0,e)},T=function(e){return y?(n(e),S?_(e[0],e[1],M):_(e[0],e[1])):S?_(e,M):_(e)};if(b)l=e;else{if("function"!=typeof(d=s(e)))throw TypeError("Target is not iterable");if(i(d)){for(p=0,f=o(e.length);f>p;p++)if((h=T(e[p]))&&h instanceof u)return h;return new u(!1)}l=d.call(e)}for(m=l.next;!(g=m.call(l)).done;){try{h=T(g.value)}catch(e){throw c(l),e}if("object"==typeof h&&h&&h instanceof u)return h}return new u(!1)}},function(e,t,r){var n=r(9),i=r(13),o=r(68),a=r(15).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||a(t,e,{value:o.f(e)})}},function(e,t,r){var n=r(3),i=r(53),o=r(13),a=r(40),s=r(58),c=r(81),u=i("wks"),l=n.Symbol,d=c?l:l&&l.withoutSetter||a;e.exports=function(e){return o(u,e)&&(s||"string"==typeof u[e])||(s&&o(l,e)?u[e]=l[e]:u[e]=d("Symbol."+e)),u[e]}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t){e.exports={}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(7);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var n=r(8);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(19),i={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return i.call(n(e),t)}},function(e,t,r){var n=r(11),i=r(15),o=r(22);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(11),i=r(73),o=r(1),a=r(37),s=Object.defineProperty;t.f=n?s:function(e,t,r){if(o(e),t=a(t,!0),o(r),i)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(9),i=r(3),o=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e])||o(i[e]):n[e]&&n[e][t]||i[e]&&i[e][t]}},function(e,t,r){var n=r(2),i=r(224);e.exports=n?i:function(e){return Map.prototype.entries.call(e)}},function(e,t,r){var n=r(72),i=r(36);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(36);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n,i,o,a=r(89),s=r(3),c=r(10),u=r(14),l=r(13),d=r(54),p=r(39),f=r(30),h=s.WeakMap;if(a||d.state){var m=d.state||(d.state=new h),g=m.get,v=m.has,y=m.set;n=function(e,t){if(v.call(m,e))throw new TypeError("Object already initialized");return t.facade=e,y.call(m,e,t),t},i=function(e){return g.call(m,e)||{}},o=function(e){return v.call(m,e)}}else{var b=p("state");f[b]=!0,n=function(e,t){if(l(e,b))throw new TypeError("Object already initialized");return t.facade=e,u(e,b,t),t},i=function(e){return l(e,b)?e[b]:{}},o=function(e){return l(e,b)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(9);e.exports=function(e){return n[e+"Prototype"]}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports={}},function(e,t,r){var n=r(59),i=r(15).f,o=r(14),a=r(13),s=r(119),c=r(6)("toStringTag");e.exports=function(e,t,r,u){if(e){var l=r?e:e.prototype;a(l,c)||i(l,c,{configurable:!0,value:t}),u&&!n&&o(l,"toString",s)}}},function(e,t,r){var n=r(12),i=r(72),o=r(19),a=r(29),s=r(63),c=[].push,u=function(e){var t=1==e,r=2==e,u=3==e,l=4==e,d=6==e,p=7==e,f=5==e||d;return function(h,m,g,v){for(var y,b,S=o(h),_=i(S),M=n(m,g,3),T=a(_.length),w=0,x=v||s,I=t?x(h,T):r||p?x(h,0):void 0;T>w;w++)if((f||w in _)&&(b=M(y=_[w],w,S),e))if(t)I[w]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return w;case 2:c.call(I,y)}else switch(e){case 4:return!1;case 7:c.call(I,y)}return d?-1:u||l?l:I}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterOut:u(7)}},function(e,t,r){e.exports=r(107)},function(e,t,r){var n=r(11),i=r(71),o=r(22),a=r(18),s=r(37),c=r(13),u=r(73),l=Object.getOwnPropertyDescriptor;t.f=n?l:function(e,t){if(e=a(e),t=s(t,!0),u)try{return l(e,t)}catch(e){}if(c(e,t))return o(!i.f.call(e,t),e[t])}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(42),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t){e.exports={}},function(e,t,r){var n=r(14);e.exports=function(e,t,r,i){i&&i.enumerable?e[t]=r:n(e,t,r)}},function(e,t,r){var n=r(1),i=r(8),o=r(6)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||null==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n=r(8),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},function(e,t,r){r(128);var n=r(129),i=r(3),o=r(45),a=r(14),s=r(23),c=r(6)("toStringTag");for(var u in n){var l=i[u],d=l&&l.prototype;d&&o(d)!==c&&a(d,c,u),s[u]=s.Array}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,r){var n=r(10);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){e.exports=r(111)},function(e,t,r){var n=r(53),i=r(40),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+n).toString(36)}},function(e,t,r){var n,i=r(1),o=r(76),a=r(57),s=r(30),c=r(80),u=r(51),l=r(39)("IE_PROTO"),d=function(){},p=function(e){return"<script>"+e+"<\/script>"},f=function(){try{n=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;f=n?function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t}(n):((t=u("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F);for(var r=a.length;r--;)delete f.prototype[a[r]];return f()};s[l]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(d.prototype=i(e),r=new d,d.prototype=null,r[l]=e):r=f(),void 0===t?r:o(r,t)}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n,i,o=r(3),a=r(44),s=o.process,c=s&&s.versions,u=c&&c.v8;u?i=(n=u.split("."))[0]<4?1:n[0]+n[1]:a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(i=n[1]),e.exports=i&&+i},function(e,t,r){var n=r(16);e.exports=n("navigator","userAgent")||""},function(e,t,r){var n=r(59),i=r(28),o=r(6)("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=n?i:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?r:a?i(t):"Object"==(n=i(t))&&"function"==typeof t.callee?"Arguments":n}},function(e,t){},function(e,t,r){var n=r(31);e.exports=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:n(e,i,t[i],r);return e}},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,r){var n=r(30),i=r(10),o=r(13),a=r(15).f,s=r(40),c=r(217),u=s("meta"),l=0,d=Object.isExtensible||function(){return!0},p=function(e){a(e,u,{value:{objectID:"O"+ ++l,weakData:{}}})},f=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,u)){if(!d(e))return"F";if(!t)return"E";p(e)}return e[u].objectID},getWeakData:function(e,t){if(!o(e,u)){if(!d(e))return!0;if(!t)return!1;p(e)}return e[u].weakData},onFreeze:function(e){return c&&f.REQUIRED&&d(e)&&!o(e,u)&&p(e),e}};n[u]=!0},function(e,t,r){var n=r(3),i=r(10),o=n.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,r){var n=r(13),i=r(19),o=r(39),a=r(114),s=o("IE_PROTO"),c=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=i(e),n(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},function(e,t,r){var n=r(2),i=r(54);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.13.1",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(3),i=r(113),o=n["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,r){var n=r(1),i=r(115);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,o){return n(r),i(o),t?e.call(r,o):r.__proto__=o,r}}():void 0)},function(e,t,r){var n=r(77),i=r(57);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){var n=r(43),i=r(7);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(e,t,r){var n={};n[r(6)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){var n=r(28),i=r(3);e.exports="process"==n(i.process)},function(e,t,r){var n=r(126).charAt,i=r(20),o=r(62),a=i.set,s=i.getterFor("String Iterator");o(String,"String",(function(e){a(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=s(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(0),i=r(127),o=r(52),a=r(55),s=r(24),c=r(14),u=r(31),l=r(6),d=r(2),p=r(23),f=r(92),h=f.IteratorPrototype,m=f.BUGGY_SAFARI_ITERATORS,g=l("iterator"),v=function(){return this};e.exports=function(e,t,r,l,f,y,b){i(r,t,l);var S,_,M,T=function(e){if(e===f&&A)return A;if(!m&&e in I)return I[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},w=t+" Iterator",x=!1,I=e.prototype,E=I[g]||I["@@iterator"]||f&&I[f],A=!m&&E||T(f),C="Array"==t&&I.entries||E;if(C&&(S=o(C.call(new e)),h!==Object.prototype&&S.next&&(d||o(S)===h||(a?a(S,h):"function"!=typeof S[g]&&c(S,g,v)),s(S,w,!0,!0),d&&(p[w]=v))),"values"==f&&E&&"values"!==E.name&&(x=!0,A=function(){return E.call(this)}),d&&!b||I[g]===A||c(I,g,A),p[t]=A,f)if(_={values:T("values"),keys:y?A:T("keys"),entries:T("entries")},b)for(M in _)(m||x||!(M in I))&&u(I,M,_[M]);else n({target:t,proto:!0,forced:m||x},_);return _}},function(e,t,r){var n=r(10),i=r(64),o=r(6)("species");e.exports=function(e,t){var r;return i(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!i(r.prototype)?n(r)&&null===(r=r[o])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}},function(e,t,r){var n=r(28);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(37),i=r(15),o=r(22);e.exports=function(e,t,r){var a=n(t);a in e?i.f(e,a,o(0,r)):e[a]=r}},function(e,t,r){var n=r(7),i=r(6),o=r(43),a=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,r){var n=r(77),i=r(57).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(6);t.f=n},function(e,t,r){var n=r(7);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},function(e,t,r){var n=r(1);e.exports=function(e,t){var r,i=n(this),o=arguments.length>2?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof o)throw TypeError("At least one callback required");return i.has(e)?(r=i.get(e),"function"==typeof t&&(r=t(r),i.set(e,r))):"function"==typeof o&&(r=o(),i.set(e,r)),r}},function(e,t,r){var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!n.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},function(e,t,r){var n=r(7),i=r(28),o="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?o.call(e,""):Object(e)}:Object},function(e,t,r){var n=r(11),i=r(7),o=r(51);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(7),i=/#|\.prototype\./,o=function(e,t){var r=s[a(e)];return r==u||r!=c&&("function"==typeof t?n(t):!!t)},a=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},s=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";e.exports=o},function(e,t,r){var n=r(0),i=r(52),o=r(55),a=r(41),s=r(14),c=r(22),u=r(4),l=function(e,t){var r=this;if(!(r instanceof l))return new l(e,t);o&&(r=o(new Error(void 0),i(r))),void 0!==t&&s(r,"message",String(t));var n=[];return u(e,n.push,{that:n}),s(r,"errors",n),r};l.prototype=a(Error.prototype,{constructor:c(5,l),message:c(5,""),name:c(5,"AggregateError")}),n({global:!0},{AggregateError:l})},function(e,t,r){var n=r(11),i=r(15),o=r(1),a=r(56);e.exports=n?Object.defineProperties:function(e,t){o(e);for(var r,n=a(t),s=n.length,c=0;s>c;)i.f(e,r=n[c++],t[r]);return e}},function(e,t,r){var n=r(13),i=r(18),o=r(78).indexOf,a=r(30);e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)!n(a,r)&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){var n=r(18),i=r(29),o=r(79),a=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),l=o(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,r){var n=r(42),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},function(e,t,r){var n=r(16);e.exports=n("document","documentElement")},function(e,t,r){var n=r(58);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n=r(45),i=r(23),o=r(6)("iterator");e.exports=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[n(e)]}},function(e,t,r){var n=r(3);e.exports=n.Promise},function(e,t,r){var n=r(16),i=r(15),o=r(6),a=r(11),s=o("species");e.exports=function(e){var t=n(e),r=i.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(54),i=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return i.call(e)}),e.exports=n.inspectSource},function(e,t,r){var n,i,o,a=r(3),s=r(7),c=r(12),u=r(80),l=r(51),d=r(87),p=r(60),f=a.location,h=a.setImmediate,m=a.clearImmediate,g=a.process,v=a.MessageChannel,y=a.Dispatch,b=0,S={},_=function(e){if(S.hasOwnProperty(e)){var t=S[e];delete S[e],t()}},M=function(e){return function(){_(e)}},T=function(e){_(e.data)},w=function(e){a.postMessage(e+"",f.protocol+"//"+f.host)};h&&m||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return S[++b]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},n(b),b},m=function(e){delete S[e]},p?n=function(e){g.nextTick(M(e))}:y&&y.now?n=function(e){y.now(M(e))}:v&&!d?(o=(i=new v).port2,i.port1.onmessage=T,n=c(o.postMessage,o,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts&&f&&"file:"!==f.protocol&&!s(w)?(n=w,a.addEventListener("message",T,!1)):n="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),_(e)}}:function(e){setTimeout(M(e),0)}),e.exports={set:h,clear:m}},function(e,t,r){var n=r(44);e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(n)},function(e,t,r){var n=r(1),i=r(10),o=r(33);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(3),i=r(85),o=n.WeakMap;e.exports="function"==typeof o&&/native code/.test(i(o))},function(e,t,r){var n=r(0),i=r(8),o=r(33),a=r(49),s=r(4);n({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=o.f(t),n=r.resolve,c=r.reject,u=a((function(){var r=i(t.resolve),o=[],a=0,c=1;s(e,(function(e){var i=a++,s=!1;o.push(void 0),c++,r.call(t,e).then((function(e){s||(s=!0,o[i]={status:"fulfilled",value:e},--c||n(o))}),(function(e){s||(s=!0,o[i]={status:"rejected",reason:e},--c||n(o))}))})),--c||n(o)}));return u.error&&c(u.value),r.promise}})},function(e,t,r){var n=r(0),i=r(8),o=r(16),a=r(33),s=r(49),c=r(4);n({target:"Promise",stat:!0},{any:function(e){var t=this,r=a.f(t),n=r.resolve,u=r.reject,l=s((function(){var r=i(t.resolve),a=[],s=0,l=1,d=!1;c(e,(function(e){var i=s++,c=!1;a.push(void 0),l++,r.call(t,e).then((function(e){c||d||(d=!0,n(e))}),(function(e){c||d||(c=!0,a[i]=e,--l||u(new(o("AggregateError"))(a,"No one promise resolved")))}))})),--l||u(new(o("AggregateError"))(a,"No one promise resolved"))}));return l.error&&u(l.value),r.promise}})},function(e,t,r){var n,i,o,a=r(7),s=r(52),c=r(14),u=r(13),l=r(6),d=r(2),p=l("iterator"),f=!1;[].keys&&("next"in(o=[].keys())?(i=s(s(o)))!==Object.prototype&&(n=i):f=!0);var h=null==n||a((function(){var e={};return n[p].call(e)!==e}));h&&(n={}),d&&!h||u(n,p)||c(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},function(e,t){e.exports=function(){}},function(e,t,r){var n=r(0),i=r(7),o=r(64),a=r(10),s=r(19),c=r(29),u=r(65),l=r(63),d=r(66),p=r(6),f=r(43),h=p("isConcatSpreadable"),m=f>=51||!i((function(){var e=[];return e[h]=!1,e.concat()[0]!==e})),g=d("concat"),v=function(e){if(!a(e))return!1;var t=e[h];return void 0!==t?!!t:o(e)};n({target:"Array",proto:!0,forced:!m||!g},{concat:function(e){var t,r,n,i,o,a=s(this),d=l(a,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(v(o=-1===t?a:arguments[t])){if(p+(i=c(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<i;r++,p++)r in o&&u(d,p,o[r])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(d,p++,o)}return d.length=p,d}})},function(e,t,r){var n=r(0),i=r(3),o=r(16),a=r(2),s=r(11),c=r(58),u=r(81),l=r(7),d=r(13),p=r(64),f=r(10),h=r(1),m=r(19),g=r(18),v=r(37),y=r(22),b=r(41),S=r(56),_=r(67),M=r(147),T=r(96),w=r(27),x=r(15),I=r(71),E=r(14),A=r(31),C=r(53),k=r(39),O=r(30),N=r(40),R=r(6),P=r(68),D=r(5),j=r(24),L=r(20),z=r(25).forEach,U=k("hidden"),B=R("toPrimitive"),F=L.set,V=L.getterFor("Symbol"),H=Object.prototype,$=i.Symbol,W=o("JSON","stringify"),Y=w.f,G=x.f,Q=M.f,q=I.f,J=C("symbols"),Z=C("op-symbols"),K=C("string-to-symbol-registry"),X=C("symbol-to-string-registry"),ee=C("wks"),te=i.QObject,re=!te||!te.prototype||!te.prototype.findChild,ne=s&&l((function(){return 7!=b(G({},"a",{get:function(){return G(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=Y(H,t);n&&delete H[t],G(e,t,r),n&&e!==H&&G(H,t,n)}:G,ie=function(e,t){var r=J[e]=b($.prototype);return F(r,{type:"Symbol",tag:e,description:t}),s||(r.description=t),r},oe=u?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof $},ae=function(e,t,r){e===H&&ae(Z,t,r),h(e);var n=v(t,!0);return h(r),d(J,n)?(r.enumerable?(d(e,U)&&e[U][n]&&(e[U][n]=!1),r=b(r,{enumerable:y(0,!1)})):(d(e,U)||G(e,U,y(1,{})),e[U][n]=!0),ne(e,n,r)):G(e,n,r)},se=function(e,t){h(e);var r=g(t),n=S(r).concat(de(r));return z(n,(function(t){s&&!ce.call(r,t)||ae(e,t,r[t])})),e},ce=function(e){var t=v(e,!0),r=q.call(this,t);return!(this===H&&d(J,t)&&!d(Z,t))&&(!(r||!d(this,t)||!d(J,t)||d(this,U)&&this[U][t])||r)},ue=function(e,t){var r=g(e),n=v(t,!0);if(r!==H||!d(J,n)||d(Z,n)){var i=Y(r,n);return!i||!d(J,n)||d(r,U)&&r[U][n]||(i.enumerable=!0),i}},le=function(e){var t=Q(g(e)),r=[];return z(t,(function(e){d(J,e)||d(O,e)||r.push(e)})),r},de=function(e){var t=e===H,r=Q(t?Z:g(e)),n=[];return z(r,(function(e){!d(J,e)||t&&!d(H,e)||n.push(J[e])})),n};c||(A(($=function(){if(this instanceof $)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=N(e),r=function(e){this===H&&r.call(Z,e),d(this,U)&&d(this[U],t)&&(this[U][t]=!1),ne(this,t,y(1,e))};return s&&re&&ne(H,t,{configurable:!0,set:r}),ie(t,e)}).prototype,"toString",(function(){return V(this).tag})),A($,"withoutSetter",(function(e){return ie(N(e),e)})),I.f=ce,x.f=ae,w.f=ue,_.f=M.f=le,T.f=de,P.f=function(e){return ie(R(e),e)},s&&(G($.prototype,"description",{configurable:!0,get:function(){return V(this).description}}),a||A(H,"propertyIsEnumerable",ce,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:$}),z(S(ee),(function(e){D(e)})),n({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=String(e);if(d(K,t))return K[t];var r=$(t);return K[t]=r,X[r]=t,r},keyFor:function(e){if(!oe(e))throw TypeError(e+" is not a symbol");if(d(X,e))return X[e]},useSetter:function(){re=!0},useSimple:function(){re=!1}}),n({target:"Object",stat:!0,forced:!c,sham:!s},{create:function(e,t){return void 0===t?b(e):se(b(e),t)},defineProperty:ae,defineProperties:se,getOwnPropertyDescriptor:ue}),n({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:le,getOwnPropertySymbols:de}),n({target:"Object",stat:!0,forced:l((function(){T.f(1)}))},{getOwnPropertySymbols:function(e){return T.f(m(e))}}),W&&n({target:"JSON",stat:!0,forced:!c||l((function(){var e=$();return"[null]"!=W([e])||"{}"!=W({a:e})||"{}"!=W(Object(e))}))},{stringify:function(e,t,r){for(var n,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(n=t,(f(t)||void 0!==e)&&!oe(e))return p(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!oe(t))return t}),i[1]=t,W.apply(null,i)}}),$.prototype[B]||E($.prototype,B,$.prototype.valueOf),j($,"Symbol"),O[U]=!0},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){r(5)("iterator")},function(e,t,r){e.exports=r(174)},function(e,t,r){e.exports=r(182)},function(e,t,r){var n=r(0),i=r(3),o=r(50),a=r(7),s=r(14),c=r(4),u=r(48),l=r(10),d=r(24),p=r(15).f,f=r(25).forEach,h=r(11),m=r(20),g=m.set,v=m.getterFor;e.exports=function(e,t,r){var m,y=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),S=y?"set":"add",_=i[e],M=_&&_.prototype,T={};if(h&&"function"==typeof _&&(b||M.forEach&&!a((function(){(new _).entries().next()})))){m=t((function(t,r){g(u(t,m,e),{type:e,collection:new _}),null!=r&&c(r,t[S],{that:t,AS_ENTRIES:y})}));var w=v(e);f(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in M)||b&&"clear"==e||s(m.prototype,e,(function(r,n){var i=w(this).collection;if(!t&&b&&!l(r))return"get"==e&&void 0;var o=i[e](0===r?0:r,n);return t?this:o}))})),b||p(m.prototype,"size",{configurable:!0,get:function(){return w(this).collection.size}})}else m=r.getConstructor(t,e,y,S),o.REQUIRED=!0;return d(m,e,!1,!0),T[e]=m,n({global:!0,forced:!0},T),b||r.setStrong(m,e,y),m}},function(e,t,r){var n=r(8),i=r(12),o=r(4);e.exports=function(e){var t,r,a,s,c=arguments.length,u=c>1?arguments[1]:void 0;return n(this),(t=void 0!==u)&&n(u),null==e?new this:(r=[],t?(a=0,s=i(u,c>2?arguments[2]:void 0,2),o(e,(function(e){r.push(s(e,a++))}))):o(e,r.push,{that:r}),new this(r))}},function(e,t,r){e.exports=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}},function(e,t,r){var n=r(1),i=r(8);e.exports=function(){for(var e,t=n(this),r=i(t.delete),o=!0,a=0,s=arguments.length;a<s;a++)e=r.call(t,arguments[a]),o=o&&e;return!!o}},function(e,t,r){var n=r(1);e.exports=function(e,t){var r=n(this),i=r.has(e)&&"update"in t?t.update(r.get(e),e,r):t.insert(e,r);return r.set(e,i),i}},function(e,t,r){e.exports=r(241)},function(e,t,r){var n=r(35),i=n(r(26)),o=n(r(38)),a=n(r(134)),s=n(r(139));(0,i.default)(t,"__esModule",{value:!0});var c=function(e){return e&&e.__esModule?e:{default:e}}(r(143)),u=function(){function e(e,t,r){if(void 0===t&&(t=864e5),this.name=e,this.expire=t,this.onError=r,this.logQueue=[],this.addTimer=-1,this.onError=r||function(){},"undefined"==typeof indexedDB||"undefined"==typeof IDBKeyRange||"undefined"==typeof Proxy)return this.onError("not support indexeddb or Proxy"),this.get=function(){return o.default.resolve([])},this.delete=function(){return o.default.resolve()},void(this.log=function(){});this.db=new c.default(e,t)}return e.prototype.get=function(e){return this.db.getLogs(e)},e.prototype.delete=function(e){return this.db.deleteLogs(e)},e.prototype.log=function(e,t,r){var n,i=this,o={time:+new Date,level:e,type:r,logStr:t};this.logQueue.push(o),clearTimeout(this.addTimer),this.logQueue.length>3e3?this.db.save((0,a.default)(n=this.logQueue).call(n,0)):this.addTimer=(0,s.default)((function(){var e;i.db.save((0,a.default)(e=i.logQueue).call(e,0))}),2e3)},e}();t.default=u},function(e,t,r){var n=r(108);e.exports=n},function(e,t,r){r(109);var n=r(9).Object,i=e.exports=function(e,t,r){return n.defineProperty(e,t,r)};n.defineProperty.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(11);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperty:r(15).f})},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(112);r(130),r(131),r(132),r(133),e.exports=n},function(e,t,r){r(75),r(46),r(118),r(90),r(91),r(125),r(61),r(34);var n=r(9);e.exports=n.Promise},function(e,t,r){var n=r(3),i=r(14);e.exports=function(e,t){try{i(n,e,t)}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(7);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var n=r(10);e.exports=function(e){if(!n(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,r){var n=r(6),i=r(23),o=n("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[o]===e)}},function(e,t,r){var n=r(1);e.exports=function(e){var t=e.return;if(void 0!==t)return n(t.call(e)).value}},function(e,t,r){var n,i,o,a,s=r(0),c=r(2),u=r(3),l=r(16),d=r(83),p=r(31),f=r(47),h=r(55),m=r(24),g=r(84),v=r(10),y=r(8),b=r(48),S=r(85),_=r(4),M=r(120),T=r(32),w=r(86).set,x=r(121),I=r(88),E=r(123),A=r(33),C=r(49),k=r(20),O=r(74),N=r(6),R=r(124),P=r(60),D=r(43),j=N("species"),L="Promise",z=k.get,U=k.set,B=k.getterFor(L),F=d&&d.prototype,V=d,H=F,$=u.TypeError,W=u.document,Y=u.process,G=A.f,Q=G,q=!!(W&&W.createEvent&&u.dispatchEvent),J="function"==typeof PromiseRejectionEvent,Z=!1,K=O(L,(function(){var e=S(V)!==String(V);if(!e&&66===D)return!0;if(c&&!H.finally)return!0;if(D>=51&&/native code/.test(V))return!1;var t=new V((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(t.constructor={})[j]=r,!(Z=t.then((function(){}))instanceof r)||!e&&R&&!J})),X=K||!M((function(e){V.all(e).catch((function(){}))})),ee=function(e){var t;return!(!v(e)||"function"!=typeof(t=e.then))&&t},te=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;x((function(){for(var n=e.value,i=1==e.state,o=0;r.length>o;){var a,s,c,u=r[o++],l=i?u.ok:u.fail,d=u.resolve,p=u.reject,f=u.domain;try{l?(i||(2===e.rejection&&oe(e),e.rejection=1),!0===l?a=n:(f&&f.enter(),a=l(n),f&&(f.exit(),c=!0)),a===u.promise?p($("Promise-chain cycle")):(s=ee(a))?s.call(a,d,p):d(a)):p(n)}catch(e){f&&!c&&f.exit(),p(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&ne(e)}))}},re=function(e,t,r){var n,i;q?((n=W.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!J&&(i=u["on"+e])?i(n):"unhandledrejection"===e&&E("Unhandled promise rejection",r)},ne=function(e){w.call(u,(function(){var t,r=e.facade,n=e.value;if(ie(e)&&(t=C((function(){P?Y.emit("unhandledRejection",n,r):re("unhandledrejection",r,n)})),e.rejection=P||ie(e)?2:1,t.error))throw t.value}))},ie=function(e){return 1!==e.rejection&&!e.parent},oe=function(e){w.call(u,(function(){var t=e.facade;P?Y.emit("rejectionHandled",t):re("rejectionhandled",t,e.value)}))},ae=function(e,t,r){return function(n){e(t,n,r)}},se=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,te(e,!0))},ce=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw $("Promise can't be resolved itself");var n=ee(t);n?x((function(){var r={done:!1};try{n.call(t,ae(ce,r,e),ae(se,r,e))}catch(t){se(r,t,e)}})):(e.value=t,e.state=1,te(e,!1))}catch(t){se({done:!1},t,e)}}};if(K&&(H=(V=function(e){b(this,V,L),y(e),n.call(this);var t=z(this);try{e(ae(ce,t),ae(se,t))}catch(e){se(t,e)}}).prototype,(n=function(e){U(this,{type:L,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=f(H,{then:function(e,t){var r=B(this),n=G(T(this,V));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=P?Y.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&te(r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=z(e);this.promise=e,this.resolve=ae(ce,t),this.reject=ae(se,t)},A.f=G=function(e){return e===V||e===o?new i(e):Q(e)},!c&&"function"==typeof d&&F!==Object.prototype)){a=F.then,Z||(p(F,"then",(function(e,t){var r=this;return new V((function(e,t){a.call(r,e,t)})).then(e,t)}),{unsafe:!0}),p(F,"catch",H.catch,{unsafe:!0}));try{delete F.constructor}catch(e){}h&&h(F,H)}s({global:!0,wrap:!0,forced:K},{Promise:V}),m(V,L,!1,!0),g(L),o=l(L),s({target:L,stat:!0,forced:K},{reject:function(e){var t=G(this);return t.reject.call(void 0,e),t.promise}}),s({target:L,stat:!0,forced:c||K},{resolve:function(e){return I(c&&this===o?V:this,e)}}),s({target:L,stat:!0,forced:X},{all:function(e){var t=this,r=G(t),n=r.resolve,i=r.reject,o=C((function(){var r=y(t.resolve),o=[],a=0,s=1;_(e,(function(e){var c=a++,u=!1;o.push(void 0),s++,r.call(t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=G(t),n=r.reject,i=C((function(){var i=y(t.resolve);_(e,(function(e){i.call(t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},function(e,t,r){var n=r(59),i=r(45);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,r){var n=r(6)("iterator"),i=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){i=!0}};a[n]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},function(e,t,r){var n,i,o,a,s,c,u,l,d=r(3),p=r(27).f,f=r(86).set,h=r(87),m=r(122),g=r(60),v=d.MutationObserver||d.WebKitMutationObserver,y=d.document,b=d.process,S=d.Promise,_=p(d,"queueMicrotask"),M=_&&_.value;M||(n=function(){var e,t;for(g&&(e=b.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():o=void 0,e}}o=void 0,e&&e.enter()},h||g||m||!v||!y?S&&S.resolve?((u=S.resolve(void 0)).constructor=S,l=u.then,a=function(){l.call(u,n)}):a=g?function(){b.nextTick(n)}:function(){f.call(d,n)}:(s=!0,c=y.createTextNode(""),new v(n).observe(c,{characterData:!0}),a=function(){c.data=s=!s})),e.exports=M||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,a()),o=t}},function(e,t,r){var n=r(44);e.exports=/web0s(?!.*chrome)/i.test(n)},function(e,t,r){var n=r(3);e.exports=function(e,t){var r=n.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},function(e,t){e.exports="object"==typeof window},function(e,t,r){var n=r(0),i=r(2),o=r(83),a=r(7),s=r(16),c=r(32),u=r(88),l=r(31);if(n({target:"Promise",proto:!0,real:!0,forced:!!o&&a((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=c(this,s("Promise")),r="function"==typeof e;return this.then(r?function(r){return u(t,e()).then((function(){return r}))}:e,r?function(r){return u(t,e()).then((function(){throw r}))}:e)}}),!i&&"function"==typeof o){var d=s("Promise").prototype.finally;o.prototype.finally!==d&&l(o.prototype,"finally",d,{unsafe:!0})}},function(e,t,r){var n=r(42),i=r(36),o=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}};e.exports={codeAt:o(!1),charAt:o(!0)}},function(e,t,r){var n=r(92).IteratorPrototype,i=r(41),o=r(22),a=r(24),s=r(23),c=function(){return this};e.exports=function(e,t,r){var u=t+" Iterator";return e.prototype=i(n,{next:o(1,r)}),a(e,u,!1,!0),s[u]=c,e}},function(e,t,r){var n=r(18),i=r(93),o=r(23),a=r(20),s=r(62),c=a.set,u=a.getterFor("Array Iterator");e.exports=s(Array,"Array",(function(e,t){c(this,{type:"Array Iterator",target:n(e),index:0,kind:t})}),(function(){var e=u(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){r(75)},function(e,t,r){r(90)},function(e,t,r){var n=r(0),i=r(33),o=r(49);n({target:"Promise",stat:!0},{try:function(e){var t=i.f(this),r=o(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}})},function(e,t,r){r(91)},function(e,t,r){e.exports=r(135)},function(e,t,r){var n=r(136);e.exports=n},function(e,t,r){var n=r(137),i=Array.prototype;e.exports=function(e){var t=e.splice;return e===i||e instanceof Array&&t===i.splice?n:t}},function(e,t,r){r(138);var n=r(21);e.exports=n("Array").splice},function(e,t,r){var n=r(0),i=r(79),o=r(42),a=r(29),s=r(19),c=r(63),u=r(65),l=r(66)("splice"),d=Math.max,p=Math.min;n({target:"Array",proto:!0,forced:!l},{splice:function(e,t){var r,n,l,f,h,m,g=s(this),v=a(g.length),y=i(e,v),b=arguments.length;if(0===b?r=n=0:1===b?(r=0,n=v-y):(r=b-2,n=p(d(o(t),0),v-y)),v+r-n>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=c(g,n),f=0;f<n;f++)(h=y+f)in g&&u(l,f,g[h]);if(l.length=n,r<n){for(f=y;f<v-n;f++)m=f+r,(h=f+n)in g?g[m]=g[h]:delete g[m];for(f=v;f>v-n+r;f--)delete g[f-1]}else if(r>n)for(f=v-n;f>y;f--)m=f+r-1,(h=f+n-1)in g?g[m]=g[h]:delete g[m];for(f=0;f<r;f++)g[f+y]=arguments[f+2];return g.length=v-n+r,l}})},function(e,t,r){e.exports=r(140)},function(e,t,r){var n=r(141);e.exports=n},function(e,t,r){r(142);var n=r(9);e.exports=n.setTimeout},function(e,t,r){var n=r(0),i=r(3),o=r(44),a=[].slice,s=function(e){return function(t,r){var n=arguments.length>2,i=n?a.call(arguments,2):void 0;return e(n?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,r)}};n({global:!0,bind:!0,forced:/MSIE .\./.test(o)},{setTimeout:s(i.setTimeout),setInterval:s(i.setInterval)})},function(e,t,r){var n=r(35),i=n(r(38)),o=n(r(144)),a=n(r(171)),s=n(r(26)),c=n(r(98)),u=n(r(178)),l=n(r(99)),d=function(e,t,r,n){return new(r||(r=i.default))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},p=function(e,t){var r,n,i,s,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof o.default&&(s[a.default]=function(){return this}),s;function u(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return c.label++,{value:o[1],done:!1};case 5:c.label++,n=o[1],o=[0];continue;case 7:o=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){c=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){c.label=o[1];break}if(6===o[0]&&c.label<i[1]){c.label=i[1],i=o;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(o);break}i[2]&&c.ops.pop(),c.trys.pop();continue}o=t.call(e,c)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};(0,s.default)(t,"__esModule",{value:!0});var f=r(188),h=function(){function e(e,t){void 0===t&&(t=86400),this.name=e,this.expire=t,this.dbVersion=2,this.name=e,this.expire=t,this.dbPromise=this.initDB()}return e.prototype.initDB=function(){return f.openDB(this.name,this.dbVersion,{upgrade:function(e,t,r,n){if(1===t)try{e.deleteObjectStore("log_detail")}catch(e){}e.createObjectStore("log_detail",{keyPath:"id",autoIncrement:!0}).createIndex("time","time")}})},e.prototype.getLogs=function(e){return d(this,void 0,void 0,(function(){var t,r,n,o,a,s,u,l;return p(this,(function(d){switch(d.label){case 0:return t=[],[4,this.dbPromise];case 1:return r=d.sent(),n=f.unwrap(r).transaction("log_detail","readonly").objectStore("log_detail"),o=function(e){var t=e.end,r=e.start,n=e.type,i=e.level,o=IDBKeyRange.bound(r||0,t||+new Date),a=function(e){return!0},s=0;switch(n&&(s+=2),i&&(s+=1),s){case 1:a=function(e){return e.level===i};break;case 2:a=function(e){return e.type===n};break;case 3:a=function(e){return e.type===n&&e.level===i}}return{indexName:"time",filter:a,keyRange:o}}(e),a=o.indexName,s=o.keyRange,u=(0,c.default)(o),l=n.index(a).openCursor(s),[2,new i.default((function(e,r){l.onsuccess=function(r){var n=r.target.result;n?(u(n.value)&&t.push(n.value),n.continue()):e(t)},l.onerror=function(e){r(e)}}))]}}))}))},e.prototype.deleteLogs=function(e){return d(this,void 0,void 0,(function(){var t,r,n,o,a;return p(this,(function(s){switch(s.label){case 0:return[4,this.dbPromise];case 1:return t=s.sent(),r=f.unwrap(t).transaction("log_detail","readwrite").objectStore("log_detail"),n=e.start,o=e.end,a=r.index("time").openKeyCursor(IDBKeyRange.bound(n,o)),[2,new i.default((function(e,t){a.onsuccess=function(){var t=a.result;t?(r.delete(t.primaryKey),t.continue()):e(null)},a.onerror=function(e){t(e)}}))]}}))}))},e.prototype.save=function(e){return d(this,void 0,void 0,(function(){var t,r;return p(this,(function(n){switch(n.label){case 0:return[4,this.dbPromise];case 1:return t=n.sent(),r=[],[2,this.deleteLogs({start:0,end:(0,u.default)()-this.expire}).then((function(){var n=t.transaction("log_detail","readwrite").objectStore("log_detail");return(0,l.default)(e).call(e,(function(e){r.push(n.put(e))})),i.default.all(r)}))]}}))}))},e}();t.default=h},function(e,t,r){e.exports=r(145)},function(e,t,r){var n=r(146);r(164),r(165),r(166),r(167),r(168),r(169),r(170),e.exports=n},function(e,t,r){r(94),r(46),r(95),r(148),r(149),r(150),r(151),r(97),r(152),r(153),r(154),r(155),r(156),r(157),r(158),r(159),r(160),r(161),r(162),r(163);var n=r(9);e.exports=n.Symbol},function(e,t,r){var n=r(18),i=r(67).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},function(e,t,r){r(5)("asyncIterator")},function(e,t){},function(e,t,r){r(5)("hasInstance")},function(e,t,r){r(5)("isConcatSpreadable")},function(e,t,r){r(5)("match")},function(e,t,r){r(5)("matchAll")},function(e,t,r){r(5)("replace")},function(e,t,r){r(5)("search")},function(e,t,r){r(5)("species")},function(e,t,r){r(5)("split")},function(e,t,r){r(5)("toPrimitive")},function(e,t,r){r(5)("toStringTag")},function(e,t,r){r(5)("unscopables")},function(e,t,r){var n=r(3);r(24)(n.JSON,"JSON",!0)},function(e,t){},function(e,t){},function(e,t,r){r(5)("asyncDispose")},function(e,t,r){r(5)("dispose")},function(e,t,r){r(5)("matcher")},function(e,t,r){r(5)("metadata")},function(e,t,r){r(5)("observable")},function(e,t,r){r(5)("patternMatch")},function(e,t,r){r(5)("replaceAll")},function(e,t,r){e.exports=r(172)},function(e,t,r){var n=r(173);e.exports=n},function(e,t,r){r(97),r(61),r(34);var n=r(68);e.exports=n.f("iterator")},function(e,t,r){var n=r(175);e.exports=n},function(e,t,r){var n=r(176),i=Array.prototype;e.exports=function(e){var t=e.filter;return e===i||e instanceof Array&&t===i.filter?n:t}},function(e,t,r){r(177);var n=r(21);e.exports=n("Array").filter},function(e,t,r){var n=r(0),i=r(25).filter;n({target:"Array",proto:!0,forced:!r(66)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(179)},function(e,t,r){var n=r(180);e.exports=n},function(e,t,r){r(181);var n=r(9);e.exports=n.Date.now},function(e,t,r){r(0)({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},function(e,t,r){var n=r(183);e.exports=n},function(e,t,r){r(34);var n=r(184),i=r(45),o=Array.prototype,a={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===o||e instanceof Array&&t===o.forEach||a.hasOwnProperty(i(e))?n:t}},function(e,t,r){var n=r(185);e.exports=n},function(e,t,r){r(186);var n=r(21);e.exports=n("Array").forEach},function(e,t,r){var n=r(0),i=r(187);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},function(e,t,r){var n=r(25).forEach,i=r(69)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){var n=r(189),i=r(193),o=r(98),a=r(196),s=r(99),c=r(200),u=r(205),l=r(26),d=r(35);l(t,"__esModule",{value:!0}),t.deleteDB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.blocked,n=indexedDB.deleteDatabase(e);return r&&n.addEventListener("blocked",(function(){return r()})),(0,v.w)(n).then((function(){}))},t.openDB=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.blocked,i=r.upgrade,o=r.blocking,a=r.terminated,s=indexedDB.open(e,t),c=(0,v.w)(s);return i&&s.addEventListener("upgradeneeded",(function(e){i((0,v.w)(s.result),e.oldVersion,e.newVersion,(0,v.w)(s.transaction))})),n&&s.addEventListener("blocked",(function(){return n()})),c.then((function(e){a&&e.addEventListener("close",(function(){return a()})),o&&e.addEventListener("versionchange",(function(){return o()}))})).catch((function(){})),c},l(t,"unwrap",{enumerable:!0,get:function(){return v.u}}),l(t,"wrap",{enumerable:!0,get:function(){return v.w}});var p=d(r(209)),f=d(r(211)),h=d(r(212)),m=d(r(213)),g=d(r(105)),v=r(250);function y(e,t){var r=n(e);if(i){var s=i(e);t&&(s=o(s).call(s,(function(t){return a(e,t).enumerable}))),r.push.apply(r,s)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)s(r=y(Object(n),!0)).call(r,(function(t){(0,f.default)(e,t,n[t])}));else if(c)u(e,c(n));else{var i;s(i=y(Object(n))).call(i,(function(t){l(e,t,a(n,t))}))}}return e}var S=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],M=new m.default;function T(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(M.get(t))return M.get(t);var r=t.replace(/FromIndex$/,""),n=t!==r,i=(0,g.default)(_).call(_,r);if(r in(n?IDBIndex:IDBObjectStore).prototype&&(i||(0,g.default)(S).call(S,r))){var o=function(){var e=(0,h.default)(p.default.mark((function e(t){var o,a,s,c,u,l,d,f=arguments;return p.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=this.transaction(t,i?"readwrite":"readonly"),s=a.store,c=f.length,u=new Array(c>1?c-1:0),l=1;l<c;l++)u[l-1]=f[l];return n&&(s=s.index(u.shift())),e.next=6,(o=s)[r].apply(o,u);case 6:if(d=e.sent,!i){e.next=10;break}return e.next=10,a.done;case 10:return e.abrupt("return",d);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return M.set(t,o),o}}}(0,v.r)((function(e){return b(b({},e),{},{get:function(t,r,n){return T(t,r)||e.get(t,r,n)},has:function(t,r){return!!T(t,r)||e.has(t,r)}})}))},function(e,t,r){e.exports=r(190)},function(e,t,r){var n=r(191);e.exports=n},function(e,t,r){r(192);var n=r(9);e.exports=n.Object.keys},function(e,t,r){var n=r(0),i=r(19),o=r(56);n({target:"Object",stat:!0,forced:r(7)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},function(e,t,r){e.exports=r(194)},function(e,t,r){var n=r(195);e.exports=n},function(e,t,r){r(95);var n=r(9);e.exports=n.Object.getOwnPropertySymbols},function(e,t,r){e.exports=r(197)},function(e,t,r){var n=r(198);e.exports=n},function(e,t,r){r(199);var n=r(9).Object,i=e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)};n.getOwnPropertyDescriptor.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(7),o=r(18),a=r(27).f,s=r(11),c=i((function(){a(1)}));n({target:"Object",stat:!0,forced:!s||c,sham:!s},{getOwnPropertyDescriptor:function(e,t){return a(o(e),t)}})},function(e,t,r){e.exports=r(201)},function(e,t,r){var n=r(202);e.exports=n},function(e,t,r){r(203);var n=r(9);e.exports=n.Object.getOwnPropertyDescriptors},function(e,t,r){var n=r(0),i=r(11),o=r(204),a=r(18),s=r(27),c=r(65);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=a(e),i=s.f,u=o(n),l={},d=0;u.length>d;)void 0!==(r=i(n,t=u[d++]))&&c(l,t,r);return l}})},function(e,t,r){var n=r(16),i=r(67),o=r(96),a=r(1);e.exports=n("Reflect","ownKeys")||function(e){var t=i.f(a(e)),r=o.f;return r?t.concat(r(e)):t}},function(e,t,r){e.exports=r(206)},function(e,t,r){var n=r(207);e.exports=n},function(e,t,r){r(208);var n=r(9).Object,i=e.exports=function(e,t){return n.defineProperties(e,t)};n.defineProperties.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(11);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperties:r(76)})},function(e,t,r){e.exports=r(210)},function(e,t,r){var n=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof d?t:d,o=Object.create(i.prototype),a=new T(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function p(){}function f(){}var h={};h[i]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,i)&&(h=g);var v=f.prototype=d.prototype=Object.create(h);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(i,o){function a(){return new t((function(n,a){!function n(i,o,a,s){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function w(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return p.prototype=v.constructor=f,f.constructor=p,p.displayName=s(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),b.prototype[o]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new b(c(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),s(v,a,"Generator"),v[i]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=w,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},function(e,t,r){var n=r(26);e.exports=function(e,t,r){return t in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(38);function i(e,t,r,i,o,a,s){try{var c=e[a](s),u=c.value}catch(e){return void r(e)}c.done?t(u):n.resolve(u).then(i,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new n((function(n,o){var a=e.apply(t,r);function s(e){i(a,n,o,s,c,"next",e)}function c(e){i(a,n,o,s,c,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(214)},function(e,t,r){var n=r(215);r(219),r(220),r(221),r(222),r(223),r(225),r(226),r(227),r(228),r(229),r(231),r(232),r(233),r(234),r(235),r(236),r(237),r(238),r(239),r(240),e.exports=n},function(e,t,r){r(216),r(46),r(61),r(34);var n=r(9);e.exports=n.Map},function(e,t,r){var n=r(100),i=r(218);e.exports=n("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),i)},function(e,t,r){var n=r(7);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(e,t,r){var n=r(15).f,i=r(41),o=r(47),a=r(12),s=r(48),c=r(4),u=r(62),l=r(84),d=r(11),p=r(50).fastKey,f=r(20),h=f.set,m=f.getterFor;e.exports={getConstructor:function(e,t,r,u){var l=e((function(e,n){s(e,l,t),h(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),f=m(t),g=function(e,t,r){var n,i,o=f(e),a=v(e,t);return a?a.value=r:(o.last=a={index:i=p(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=a),n&&(n.next=a),d?o.size++:e.size++,"F"!==i&&(o.index[i]=a)),e},v=function(e,t){var r,n=f(e),i=p(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return o(l.prototype,{clear:function(){for(var e=f(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t=f(this),r=v(this,e);if(r){var n=r.next,i=r.previous;delete t.index[r.index],r.removed=!0,i&&(i.next=n),n&&(n.previous=i),t.first==r&&(t.first=n),t.last==r&&(t.last=i),d?t.size--:this.size--}return!!r},forEach:function(e){for(var t,r=f(this),n=a(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!v(this,e)}}),o(l.prototype,r?{get:function(e){var t=v(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),d&&n(l.prototype,"size",{get:function(){return f(this).size}}),l},setStrong:function(e,t,r){var n=t+" Iterator",i=m(t),o=m(n);u(e,t,(function(e,t){h(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),l(t)}}},function(e,t,r){r(0)({target:"Map",stat:!0},{from:r(101)})},function(e,t,r){r(0)({target:"Map",stat:!0},{of:r(102)})},function(e,t,r){var n=r(0),i=r(2),o=r(103);n({target:"Map",proto:!0,real:!0,forced:i},{deleteAll:function(){return o.apply(this,arguments)}})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{emplace:r(104)})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(12),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{every:function(e){var t=o(this),r=s(t),n=a(e,arguments.length>1?arguments[1]:void 0,3);return!c(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){var n=r(1),i=r(82);e.exports=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return n(t.call(e))}},function(e,t,r){var n=r(0),i=r(2),o=r(16),a=r(1),s=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{filter:function(e){var t=a(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=s(i.set);return d(r,(function(e,r){n(r,e,t)&&p.call(i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(12),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{find:function(e){var t=o(this),r=s(t),n=a(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(12),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{findKey:function(e){var t=o(this),r=s(t),n=a(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(4),o=r(8);n({target:"Map",stat:!0},{groupBy:function(e,t){var r=new this;o(t);var n=o(r.has),a=o(r.get),s=o(r.set);return i(e,(function(e){var i=t(e);n.call(r,i)?a.call(r,i).push(e):s.call(r,i,[e])})),r}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(17),s=r(230),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{includes:function(e){return c(a(o(this)),(function(t,r,n){if(s(r,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){var n=r(0),i=r(4),o=r(8);n({target:"Map",stat:!0},{keyBy:function(e,t){var r=new this;o(t);var n=o(r.set);return i(e,(function(e){n.call(r,t(e),e)})),r}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(17),s=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{keyOf:function(e){return s(a(o(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(2),o=r(16),a=r(1),s=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{mapKeys:function(e){var t=a(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=s(i.set);return d(r,(function(e,r){p.call(i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(16),a=r(1),s=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{mapValues:function(e){var t=a(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=s(i.set);return d(r,(function(e,r){p.call(i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(8),s=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{merge:function(e){for(var t=o(this),r=a(t.set),n=0;n<arguments.length;)s(arguments[n++],r,{that:t,AS_ENTRIES:!0});return t}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(8),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{reduce:function(e){var t=o(this),r=s(t),n=arguments.length<2,i=n?void 0:arguments[1];if(a(e),c(r,(function(r,o){n?(n=!1,i=o):i=e(i,o,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(12),s=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{some:function(e){var t=o(this),r=s(t),n=a(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),a=r(8);n({target:"Map",proto:!0,real:!0,forced:i},{update:function(e,t){var r=o(this),n=arguments.length;a(t);var i=r.has(e);if(!i&&n<3)throw TypeError("Updating absent value");var s=i?r.get(e):a(n>2?arguments[2]:void 0)(e,r);return r.set(e,t(s,e,r)),r}})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{upsert:r(70)})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{updateOrInsert:r(70)})},function(e,t,r){var n=r(242);e.exports=n},function(e,t,r){var n=r(243),i=r(245),o=Array.prototype,a=String.prototype;e.exports=function(e){var t=e.includes;return e===o||e instanceof Array&&t===o.includes?n:"string"==typeof e||e===a||e instanceof String&&t===a.includes?i:t}},function(e,t,r){r(244);var n=r(21);e.exports=n("Array").includes},function(e,t,r){var n=r(0),i=r(78).includes,o=r(93);n({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(e,t,r){r(246);var n=r(21);e.exports=n("String").includes},function(e,t,r){var n=r(0),i=r(247),o=r(36);n({target:"String",proto:!0,forced:!r(249)("includes")},{includes:function(e){return!!~String(o(this)).indexOf(i(e),arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(248);e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,r){var n=r(10),i=r(28),o=r(6)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(6)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){var n=r(26),i=r(35);n(t,"__esModule",{value:!0}),t.r=function(e){b=e(b)},t.w=S,t.u=t.i=t.a=void 0;var o,a,s=i(r(251)),c=i(r(256)),u=i(r(38)),l=i(r(266)),d=i(r(270)),p=i(r(105)),f=function(e,t){return(0,s.default)(t).call(t,(function(t){return e instanceof t}))};t.i=f;var h=new c.default,m=new c.default,g=new c.default,v=new c.default,y=new c.default;t.a=y;var b={get:function(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return m.get(e);if("objectStoreNames"===t)return e.objectStoreNames||g.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return S(e[t])},set:function(e,t,r){return e[t]=r,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function S(e){if(e instanceof IDBRequest)return t=e,(r=new u.default((function(e,r){var n=function(){t.removeEventListener("success",i),t.removeEventListener("error",o)},i=function(){e(S(t.result)),n()},o=function(){r(t.error),n()};t.addEventListener("success",i),t.addEventListener("error",o)}))).then((function(e){e instanceof IDBCursor&&h.set(e,t)})).catch((function(){})),y.set(r,t),r;var t,r;if(v.has(e))return v.get(e);var n=function(e){return"function"==typeof e?function(e){var t;return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(0,p.default)(t=a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).call(t,e)?function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.apply(_(this),r),S(h.get(this))}:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return S(e.apply(_(this),r))}:function(t){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var a=e.call.apply(e,(0,l.default)(r=[_(this),t]).call(r,i));return g.set(a,(0,d.default)(t)?(0,d.default)(t).call(t):[t]),S(a)}}(e):(e instanceof IDBTransaction&&function(e){if(!m.has(e)){var t=new u.default((function(t,r){var n=function(){e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=function(){t(),n()},o=function(){r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));m.set(e,t)}}(e),f(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,b):e)}(e);return n!==e&&(v.set(e,n),y.set(n,e)),n}var _=function(e){return y.get(e)};t.u=_},function(e,t,r){e.exports=r(252)},function(e,t,r){var n=r(253);e.exports=n},function(e,t,r){var n=r(254),i=Array.prototype;e.exports=function(e){var t=e.some;return e===i||e instanceof Array&&t===i.some?n:t}},function(e,t,r){r(255);var n=r(21);e.exports=n("Array").some},function(e,t,r){var n=r(0),i=r(25).some;n({target:"Array",proto:!0,forced:!r(69)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(257)},function(e,t,r){var n=r(258);r(261),r(262),r(263),r(264),r(265),e.exports=n},function(e,t,r){r(46),r(259),r(34);var n=r(9);e.exports=n.WeakMap},function(e,t,r){var n,i=r(3),o=r(47),a=r(50),s=r(100),c=r(260),u=r(10),l=r(20).enforce,d=r(89),p=!i.ActiveXObject&&"ActiveXObject"in i,f=Object.isExtensible,h=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},m=e.exports=s("WeakMap",h,c);if(d&&p){n=c.getConstructor(h,"WeakMap",!0),a.REQUIRED=!0;var g=m.prototype,v=g.delete,y=g.has,b=g.get,S=g.set;o(g,{delete:function(e){if(u(e)&&!f(e)){var t=l(this);return t.frozen||(t.frozen=new n),v.call(this,e)||t.frozen.delete(e)}return v.call(this,e)},has:function(e){if(u(e)&&!f(e)){var t=l(this);return t.frozen||(t.frozen=new n),y.call(this,e)||t.frozen.has(e)}return y.call(this,e)},get:function(e){if(u(e)&&!f(e)){var t=l(this);return t.frozen||(t.frozen=new n),y.call(this,e)?b.call(this,e):t.frozen.get(e)}return b.call(this,e)},set:function(e,t){if(u(e)&&!f(e)){var r=l(this);r.frozen||(r.frozen=new n),y.call(this,e)?S.call(this,e,t):r.frozen.set(e,t)}else S.call(this,e,t);return this}})}},function(e,t,r){var n=r(47),i=r(50).getWeakData,o=r(1),a=r(10),s=r(48),c=r(4),u=r(25),l=r(13),d=r(20),p=d.set,f=d.getterFor,h=u.find,m=u.findIndex,g=0,v=function(e){return e.frozen||(e.frozen=new y)},y=function(){this.entries=[]},b=function(e,t){return h(e.entries,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=b(this,e);if(t)return t[1]},has:function(e){return!!b(this,e)},set:function(e,t){var r=b(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=m(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,r,u){var d=e((function(e,n){s(e,d,t),p(e,{type:t,id:g++,frozen:void 0}),null!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),h=f(t),m=function(e,t,r){var n=h(e),a=i(o(t),!0);return!0===a?v(n).set(t,r):a[n.id]=r,e};return n(d.prototype,{delete:function(e){var t=h(this);if(!a(e))return!1;var r=i(e);return!0===r?v(t).delete(e):r&&l(r,t.id)&&delete r[t.id]},has:function(e){var t=h(this);if(!a(e))return!1;var r=i(e);return!0===r?v(t).has(e):r&&l(r,t.id)}}),n(d.prototype,r?{get:function(e){var t=h(this);if(a(e)){var r=i(e);return!0===r?v(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return m(this,e,t)}}:{add:function(e){return m(this,e,!0)}}),d}}},function(e,t,r){r(0)({target:"WeakMap",proto:!0,real:!0,forced:r(2)},{emplace:r(104)})},function(e,t,r){r(0)({target:"WeakMap",stat:!0},{from:r(101)})},function(e,t,r){r(0)({target:"WeakMap",stat:!0},{of:r(102)})},function(e,t,r){var n=r(0),i=r(2),o=r(103);n({target:"WeakMap",proto:!0,real:!0,forced:i},{deleteAll:function(){return o.apply(this,arguments)}})},function(e,t,r){r(0)({target:"WeakMap",proto:!0,real:!0,forced:r(2)},{upsert:r(70)})},function(e,t,r){e.exports=r(267)},function(e,t,r){var n=r(268);e.exports=n},function(e,t,r){var n=r(269),i=Array.prototype;e.exports=function(e){var t=e.concat;return e===i||e instanceof Array&&t===i.concat?n:t}},function(e,t,r){r(94);var n=r(21);e.exports=n("Array").concat},function(e,t,r){e.exports=r(271)},function(e,t,r){var n=r(272);e.exports=n},function(e,t,r){var n=r(273),i=Array.prototype;e.exports=function(e){var t=e.sort;return e===i||e instanceof Array&&t===i.sort?n:t}},function(e,t,r){r(274);var n=r(21);e.exports=n("Array").sort},function(e,t,r){var n=r(0),i=r(8),o=r(19),a=r(7),s=r(69),c=[],u=c.sort,l=a((function(){c.sort(void 0)})),d=a((function(){c.sort(null)})),p=s("sort");n({target:"Array",proto:!0,forced:l||!d||!p},{sort:function(e){return void 0===e?u.call(o(this)):u.call(o(this),i(e))}})}]).default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.JSONStringify=void 0;var n=a(r(14)),i=a(r(19)),o=a(r(20));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return"[object Number]"==Object.prototype.toString.call(e)}function c(e){return"[object String]"==Object.prototype.toString.call(e)}function u(e){return"[object Array]"==Object.prototype.toString.call(e)}function l(e){return"[object Boolean]"==Object.prototype.toString.call(e)}function d(e){return void 0===e}function p(e){return null===e}function f(e){return"[object Symbol]"==Object.prototype.toString.call(e)}function h(e){return!("[object Object]"!=Object.prototype.toString.call(e)&&(s(e)||c(e)||l(e)||u(e)||p(e)||m(e)||d(e)||f(e)))}function m(e){return"[object Function]"==Object.prototype.toString.call(e)}function g(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,o.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,o.default)(e))&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function v(e){var t=Object.prototype.toString.call(e);return"[object global]"==t||"[object Window]"==t||"[object DOMWindow]"==t}function y(e){return e&&("im"===e.subType||e.__isNimWhiteboard__)}t.getDate=function(e){var t=e>0?new Date(e):new Date,r=t.getDate()<10?"0"+t.getDate():t.getDate(),n=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,i=t.getFullYear(),o=t.getHours()<10?"0"+t.getHours():t.getHours(),a=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),s=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds(),c=t.getMilliseconds()<10?"0"+t.getMilliseconds():t.getMilliseconds();return c<100&&(c="0"+c),{time:+t,year:i,month:n,day:r,hour:o,minute:a,second:s,millisecond:c}},t.isNumber=s,t.isString=c,t.isArray=u,t.isBoolean=l,t.isUndefined=d,t.isNull=p,t.isSymbol=f,t.isObject=h,t.isFunction=m,t.isElement=g,t.isWindow=v,t.isPlainObject=function(e){var t=Object.prototype.hasOwnProperty;if(!e||"object"!==(void 0===e?"undefined":(0,o.default)(e))||e.nodeType||v(e))return!1;try{if(e.constructor&&!t.call(e,"constructor")&&!t.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var r=void 0;for(r in e);return void 0===r||t.call(e,r)},t.getObjAllKeys=function(e){if(!h(e)&&!u(e))return[];var t=[];for(var r in e)t.push(r);return t.sort()},t.getObjName=function(e){return Object.prototype.toString.call(e).replace("[object ","").replace("]","")},t.setStorage=function(e,t){window.localStorage&&(e="vConsole_"+e,localStorage.setItem(e,t))},t.getStorage=function(e){if(window.localStorage)return e="vConsole_"+e,localStorage.getItem(e)},t.JSONStringify=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(h(t)||Array.isArray(t)){if(g(t))return"[HTML Element]";if(y(t))return"[NIM Object]"}else try{return(0,i.default)(t)}catch(e){return""}var a="{",s="}";if(Array.isArray(t)&&(a="[",s="]"),r<1)return"typeof ["+(void 0===t?"undefined":(0,o.default)(t))+"]";var c=(0,n.default)(t);return a+c.map((function(n){return n+": "+e(t[n],r-1)})).join(",")+s}},,,,,,,function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r},function(e,t,r){(function(e,n){var i;(function(){var o={function:!0,object:!0},a=o[typeof window]&&window||this,s=o[typeof t]&&t,c=o[typeof e]&&e&&!e.nodeType&&e,u=s&&c&&"object"==typeof n&&n;!u||u.global!==u&&u.window!==u&&u.self!==u||(a=u);var l=Math.pow(2,53)-1,d=/\bOpera/,p=Object.prototype,f=p.hasOwnProperty,h=p.toString;function m(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function g(e){return e=_(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:m(e)}function v(e,t){for(var r in e)f.call(e,r)&&t(e[r],r,e)}function y(e){return null==e?m(e):h.call(e).slice(8,-1)}function b(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function S(e,t){var r=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=l)for(;++r<n;)t(e[r],r);else v(e,t)}(e,(function(n,i){r=t(r,n,i,e)})),r}function _(e){return String(e).replace(/^ +| +$/g,"")}var M=function e(t){var r=a,n=t&&"object"==typeof t&&"String"!=y(t);n&&(r=t,t=null);var i=r.navigator||{},o=i.userAgent||"";t||(t=o);var s,c,u,l,p,f=n?!!i.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(h.toString()),m=n?"Object":"ScriptBridgingProxyObject",M=n?"Object":"Environment",T=n&&r.java?"JavaPackage":y(r.java),w=n?"Object":"RuntimeObject",x=/\bJava/.test(T)&&r.java,I=x&&y(r.environment)==M,E=x?"a":"α",A=x?"b":"β",C=r.document||{},k=r.operamini||r.opera,O=d.test(O=n&&k?k["[[Class]]"]:y(k))?O:k=null,N=t,R=[],P=null,D=t==o,j=D&&k&&"function"==typeof k.version&&k.version(),L=S([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,r){return e||RegExp("\\b"+(r.pattern||b(r))+"\\b","i").exec(t)&&(r.label||r)})),z=S(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],(function(e,r){return e||RegExp("\\b"+(r.pattern||b(r))+"\\b","i").exec(t)&&(r.label||r)})),U=V([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),B=S({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}},(function(e,r,n){return e||(r[U]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+b(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n})),F=S(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],(function(e,r){var n=r.pattern||b(r);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),g(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,r.label||r)),e}));function V(e){return S(e,(function(e,r){var n=r.pattern||b(r);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=g(e[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function H(e){return S(e,(function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(L&&(L=[L]),/\bAndroid\b/.test(F)&&!U&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(U=_(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),B&&!U?U=V([B]):B&&U&&(U=U.replace(RegExp("^("+b(B)+")[-_.\\s]","i"),B+" ").replace(RegExp("^("+b(B)+")[-_.]?(\\w)","i"),B+" $2")),(s=/\bGoogle TV\b/.exec(U))&&(U=s[0]),/\bSimulator\b/i.test(t)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==z&&/\bOPiOS\b/.test(t)&&R.push("running in Turbo/Uncompressed mode"),"IE"==z&&/\blike iPhone OS\b/.test(t)?(B=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,U=s.product):/^iP/.test(U)?(z||(z="Safari"),F="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==z&&/^Linux\b/i.test(F)?F="Kubuntu":B&&"Google"!=B&&(/Chrome/.test(z)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(U))||/\bAndroid\b/.test(F)&&/^Chrome/.test(z)&&/\bVersion\//i.test(t)?(z="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==z?(/\bMobi/i.test(t)||(F="Android",R.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&R.unshift("accelerated")):"UC Browser"==z&&/\bUCWEB\b/.test(t)?R.push("speed mode"):"PaleMoon"==z&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?R.push("identifying as Firefox "+s[1]):"Firefox"==z&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(F||(F="Firefox OS"),U||(U=s[1])):!z||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(z))?(z&&!U&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(z=null),(s=U||B||F)&&(U||B||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(z=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:s)+" Browser")):"Electron"==z&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&R.push("Chromium "+s),j||(j=H(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",b(z),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==L&&parseFloat(j)>3?"WebKit":/\bOpera\b/.test(z)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(z)&&"NetFront")&&(L=[s]),"IE"==z&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(z+=" Mobile",F="Windows Phone "+(/\+$/.test(s)?s:s+".x"),R.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(z="IE Mobile",F="Windows Phone 8.x",R.unshift("desktop mode"),j||(j=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=z&&"Trident"==L&&(s=/\brv:([\d.]+)/.exec(t))&&(z&&R.push("identifying as "+z+(j?" "+j:"")),z="IE",j=s[1]),D){if(l="global",p=null!=(u=r)?typeof u[l]:"number",/^(?:boolean|number|string|undefined)$/.test(p)||"object"==p&&!u[l])y(s=r.runtime)==m?(z="Adobe AIR",F=s.flash.system.Capabilities.os):y(s=r.phantom)==w?(z="PhantomJS",j=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof C.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(j=[j,C.documentMode],(s=+s[1]+4)!=j[1]&&(R.push("IE "+j[1]+" mode"),L&&(L[1]=""),j[1]=s),j="IE"==z?String(j[1].toFixed(1)):j[0]):"number"==typeof C.documentMode&&/^(?:Chrome|Firefox)\b/.test(z)&&(R.push("masking as "+z+" "+j),z="IE",j="11.0",L=["Trident"],F="Windows");else if(x&&(N=(s=x.lang.System).getProperty("os.arch"),F=F||s.getProperty("os.name")+" "+s.getProperty("os.version")),I){try{j=r.require("ringo/engine").version.join("."),z="RingoJS"}catch(e){(s=r.system)&&s.global.system==r.system&&(z="Narwhal",F||(F=s[0].os||null))}z||(z="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(s=r.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(R.push("Node "+s.versions.node),z="Electron",j=s.versions.electron):"string"==typeof s.versions.nw&&(R.push("Chromium "+j,"Node "+s.versions.node),z="NW.js",j=s.versions.nw)),z||(z="Node.js",N=s.arch,F=s.platform,j=(j=/[\d.]+/.exec(s.version))?j[0]:null));F=F&&g(F)}if(j&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(D&&i.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(P=/b/i.test(s)?"beta":"alpha",j=j.replace(RegExp(s+"\\+?$"),"")+("beta"==P?A:E)+(/\d+\+?/.exec(s)||"")),"Fennec"==z||"Firefox"==z&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(F))z="Firefox Mobile";else if("Maxthon"==z&&j)j=j.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(F=null),"Xbox 360"==U&&/\bIEMobile\b/.test(t)&&R.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(z)&&(!z||U||/Browser|Mobi/.test(z))||"Windows CE"!=F&&!/Mobi/i.test(t))if("IE"==z&&D)try{null===r.external&&R.unshift("platform preview")}catch(e){R.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(t))&&(s=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||j)?(F=((s=[s,/BB10/.test(t)])[1]?(U=null,B="BlackBerry"):"Device Software")+" "+s[0],j=null):this!=v&&"Wii"!=U&&(D&&k||/Opera/.test(z)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==z&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==z&&(F&&!/^Win/.test(F)&&j>5.5||/\bWindows XP\b/.test(F)&&j>8||8==j&&!/\bTrident\b/.test(t)))&&!d.test(s=e.call(v,t.replace(d,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),d.test(z)?(/\bIE\b/.test(s)&&"Mac OS"==F&&(F=null),s="identify"+s):(s="mask"+s,z=O?g(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(F=null),D||(j=null)),L=["Presto"],R.push(s));else z+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==z&&"+"==s[1].slice(-1)?(z="WebKit Nightly",P="alpha",j=s[1].slice(0,-1)):j!=s[1]&&j!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(j=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==L&&(L=["Blink"]),D&&(f||s[1])?(L&&(L[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),L&&(L[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==z&&(!j||parseInt(j)>45)?j=s:"Chrome"==z&&/\bHeadlessChrome/i.test(t)&&R.unshift("headless")),"Opera"==z&&(s=/\bzbov|zvav$/.exec(F))?(z+=" ",R.unshift("desktop mode"),"zvav"==s?(z+="Mini",j=null):z+="Mobile",F=F.replace(RegExp(" *"+s+"$"),"")):"Safari"==z&&/\bChrome\b/.exec(L&&L[1])?(R.unshift("desktop mode"),z="Chrome Mobile",j=null,/\bOS X\b/.test(F)?(B="Apple",F="iOS 4.3+"):F=null):/\bSRWare Iron\b/.test(z)&&!j&&(j=H("Chrome")),j&&0==j.indexOf(s=/[\d.]+$/.exec(F))&&t.indexOf("/"+s+"-")>-1&&(F=_(F.replace(s,""))),F&&-1!=F.indexOf(z)&&!RegExp(z+" OS").test(F)&&(F=F.replace(RegExp(" *"+b(z)+" *"),"")),L&&!/\b(?:Avant|Nook)\b/.test(z)&&(/Browser|Lunascape|Maxthon/.test(z)||"Safari"!=z&&/^iOS/.test(F)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(z)&&L[1])&&(s=L[L.length-1])&&R.push(s),R.length&&(R=["("+R.join("; ")+")"]),B&&U&&U.indexOf(B)<0&&R.push("on "+B),U&&R.push((/^on /.test(R[R.length-1])?"":"on ")+U),F&&(s=/ ([\d.+]+)$/.exec(F),c=s&&"/"==F.charAt(F.length-s[0].length-1),F={architecture:32,family:s&&!c?F.replace(s[0],""):F,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+s),"")),z&&(/\bWOW64\b/i.test(t)||D&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(t))&&R.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==z&&parseFloat(j)>=39&&(F.architecture=64),t||(t=null);var $={};return $.description=t,$.layout=L&&L[0],$.manufacturer=B,$.name=z,$.prerelease=P,$.product=U,$.ua=t,$.version=z&&j,$.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=e,$.toString=function(){return this.description||""},$.version&&R.unshift(j),$.name&&R.unshift(z),F&&z&&(F!=String(F).split(" ")[0]||F!=z.split(" ")[0]&&!U)&&R.push(U?"("+F+")":"on "+F),R.length&&($.description=R.join(" ")),$}();a.platform=M,void 0===(i=function(){return M}.call(t,r,t,e))||(e.exports=i)}).call(this)}).call(this,r(119)(e),r(73))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RECONNECTING_THRESHOLD=8e3,t.HeartBeatTimeout=4e3,t.HeartBeatInterval=4e3,t.LoginAckTimeout=3e3,t.LoginMaxRetry=4,t.SocketConnTimeout=15e3},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.SocketConnClosedError=t.SocketInUseError=void 0;var n=s(r(2)),i=s(r(0)),o=s(r(3)),a=s(r(4));function s(e){return e&&e.__esModule?e:{default:e}}t.SocketInUseError=function(e){function t(e){(0,i.default)(this,t);var r=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.name="SocketInUseError",r}return(0,a.default)(t,e),t}(Error),t.SocketConnClosedError=function(e){function t(e){(0,i.default)(this,t);var r=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.name="SocketConnClosedError",r}return(0,a.default)(t,e),t}(Error)},,,,,,,,,,,,,,,,function(e,t,r){e.exports=r(413)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteBoardSDK=void 0;var n=_(r(70)),i=_(r(5)),o=_(r(20)),a=_(r(13)),s=_(r(19)),c=_(r(0)),u=_(r(1));r(414);var l=_(r(252)),d=r(29),p=r(415),f=r(416),h=r(96),m=_(r(32)),g=_(r(419)),v=_(r(237)),y=_(r(384)),b=r(98),S=_(b);function _(e){return e&&e.__esModule?e:{default:e}}var M={roomServerAddr:"https://roomserver.netease.im/v1/g2/whiteboard/getChannelInfo",sdkLogNosAddr:"https://statistic.live.126.net/sdklog/getToken",dataReportAddr:"https://statistic.live.126.net/statics/report/common/form",directNosAddr:"https://wanproxy-web.127.net",mediaUploadAddr:"https://vcloud.163.com",docTransAddr:"https://vcloud.163.com",fontDownloadUrl:"https://wb.vod.126.net/courseware/pptview/fonts/"},T=void 0,w=function(){function e(t){var r=this;if((0,c.default)(this,e),this.socketState="disconnected",this.joinRoomCallback={},this.ntpTimeDiff=0,this.joinRoom=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.logger.log("[白板] joinRoom"),r.joinRoomCallback=t,r.joinRoomParams=e,r.channel=e.channel,r.getChannelInfo(e).catch((function(e){var t=(0,s.default)({code:e&&e.code,message:e&&(e.error||e.message||e.msg)}),n=Number(e&&e.code);return isNaN(n)&&(n=0),n+=1e3,r._dataReportUtil("v3_login",{time:Date.now(),time_elapsed:0,result:{code:n,message:"getChannelInfo: "+t}}),a.default.reject(e)})).then((function(e){return r.channelInfo={cid:e.cid,wbUrls:e.ips.whiteboardarray,token:e.token},r.startSession()})).catch((function(t){r.logger.warn("[白板] 加入房间("+e.channel+")失败",t);var n=(0,p.getErrorCodeMsgFromEvent)(t,"加入房间失败"),i=n.code,o=n.message;return a.default.reject({type:"JoinRoomError",message:o,code:i})}))},this._getDrawPluginParams=function(){var e,t=null===(e=r.opt)||void 0===e?void 0:e.drawPluginParams;return"object"===(void 0===t?"undefined":(0,o.default)(t))&&null!==t||(t={}),r.joinRoomParams&&r.joinRoomParams.hasOwnProperty("cameraBound")&&(t.cameraBound=r.joinRoomParams.cameraBound),t},this.startSession=function(){var e,t,n;return r.channelInfo?0===(n=(null===(e=r.opt.testParams)||void 0===e?void 0:e.wsUrl)?[null===(t=r.opt.testParams)||void 0===t?void 0:t.wsUrl]:r.channelInfo.wbUrls).length?a.default.reject("urlArray is empty"):r.wbSocketClient.startSession({uid:r.uid.toString(),cid:r.channelInfo.cid.toString(),whiteboardVersion:"3.7.7",urlArray:n,token:r.channelInfo.token,record:r.opt.record,from_g2:!0}).then((function(){r.logger.log("[白板] startSession成功");var e=r._getDrawPluginParams();return r.drawPlugin=l.default.getInstance((0,i.default)({container:r.opt.container,account:r.opt.uid.toString(),uid:r.opt.uid,nickname:r.opt.nickname?r.opt.nickname:r.uid.toString(),platform:r.opt.platform,nim:null,connector:r.wbSocketClient,appkey:r.opt.appKey,logger:r.logger,isG1:!1,serviceConf:r.serviceConf,ntpTimeDiff:r.ntpTimeDiff},e)),r.opt.getAuthInfo||r.logger.error("G2白板初始化时必须提供getAuthInfo"),r.drawPlugin.getAuthInfo=r.opt.getAuthInfo,r.drawPlugin.setDataReportParams(r.serviceConf.dataReportAddr,{uid:r.opt.uid.toString(),cid:r.getChannelId().toString(),ws_url:r.wbSocketClient.urlBeingUsed,channel_name:r.channel,appkey:r.opt.appKey}),r.bindSocketStateChange(),r.drawPlugin.setIsConnected(!0),r.socketState="connected",r._syncFinishPromise(r.drawPlugin).then((function(){return setTimeout((function(){var e;r.joinRoomCallback.onconnected&&r.joinRoomCallback.onconnected(!1),r._onSyncFinish(),null===(e=r.drawPlugin)||void 0===e||e.on("event:sync_finished",(function(){r._onSyncFinish()}))}),0),r.drawPlugin})).catch((function(){return r.logger.error("[白板] 同步超时，无法进入房间"),a.default.reject({message:"同步超时"})}))})).catch((function(e){return r.logger.error("[白板] startSession失败",e),r.destroy({reason:"joinRoomFail",message:"加入房间失败"}),a.default.reject(e)})):a.default.reject("为获取channelInfo")},this.bindSocketStateChange=function(){r.wbSocketClient.on("connected",(function(){r.onSocketStateChange("connected")})),r.wbSocketClient.on("willreconnect",(function(){r.onSocketStateChange("willreconnect")})),r.wbSocketClient.on("reconnecting",(function(){r.onSocketStateChange("willreconnect")})),r.wbSocketClient.on("disconnected",(function(e){r.onSocketStateChange("disconnected",e)}))},this.onSocketStateChange=function(e,t){r.logger.warn("[白板] client.onSocketStateChange set state::"+e+". Current state:"+r.socketState),e!==r.socketState&&(r.socketState=e,"willreconnect"===e?r._onwillreconnect():"disconnected"===e?r._ondisconnected(t):"connected"===e&&r._onconnected(!1))},this.logger=new y.default(t.uid),this.dispatcher=this.logger.dispatcher,this.opt=t,this.uid=Number(t.uid),this.serviceConf=(0,i.default)({},M,t.privateConf||{}),isNaN(this.uid)||this.uid<=0||!(0,n.default)(this.uid))throw new Error("uid必须为正整数");this.wbSocketClient=new g.default(this),(0,h.setLOG)(void 0===t.debug||t.debug),T=this}return(0,u.default)(e,[{key:"getChannelInfo",value:function(e){var t=this,r=void 0;if(!this.opt.hasOwnProperty("isSecureMode")||this.opt.isSecureMode)r=this.opt.getAuthInfo().then((function(e){return{secureType:"1",checksum:e.checksum,nonce:e.nonce,curtime:e.curTime.toString()}}));else{var n=Math.ceil(Date.now()/1e3),o=(0,v.default)(this.opt.appKey+"."+this.uid+"."+n);r=a.default.resolve({secureType:"2",curtime:n.toString(),checksum:o})}var c=void 0;return r.then((function(r){return c=Date.now(),fetch(t.serviceConf.roomServerAddr,{method:"post",headers:{"Content-Type":"application/json"},cache:"no-cache",body:(0,s.default)((0,i.default)({uid:t.uid,appkey:t.opt.appKey,channelName:e.channel,mode:"4",version:"3.7.7"},r))})})).then((function(e){return e.json()})).then((function(e){if(!e||200!==e.code&&"200"!==e.code)return a.default.reject(e);if(e.time.hasOwnProperty("T2")&&e.time.hasOwnProperty("T3")){var r=Date.now(),n=r-c-(e.time.T3-e.time.T2),i=e.time.T3+n/2;t.ntpTimeDiff=i-r}return e}))}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{reason:"manualDestroy",message:"手动调用destroy断开连接"};this.logger.log("[白板] destroy. reason: "+e.reason+", msg: "+e.message),this.drawPlugin&&this.drawPlugin.destroy(),this.wbSocketClient&&(this.wbSocketClient.destroy(e),this.wbSocketClient.removeAllListeners())}},{key:"isConnected",value:function(){return this.drawPlugin&&this.drawPlugin.isConnected}},{key:"isSynchronizing",value:function(){return this.drawPlugin&&this.drawPlugin.dataHub.isSynchronizing}},{key:"getUid",value:function(){return this.uid}},{key:"getChannelId",value:function(){var e;return null===(e=this.channelInfo)||void 0===e?void 0:e.cid}},{key:"_syncFinishPromise",value:function(e){var t=this,r=void 0;return e.once("event:sync_finished",(function(){t.logger.log("[白板] 加入房间时的sync_finished"),(0,d.hideToast)(),"function"==typeof r&&r()})),this._onSyncData(),new a.default((function(e,n){var i=setTimeout((function(){t._dataReportUtil("v3_conn_error",{error:{code:b.DataReportConnError.Sync_Timeout,message:"joinRoom时同步数据超时"}}),n()}),8e4);r=function(){clearTimeout(i),e()}}))}},{key:"_onSyncData",value:function(){this.drawPlugin&&(this.logger.log("[白板] 开始同步数据"),this.drawPlugin.readyToSyncData(),(0,d.showToast)({msg:"同步数据中...",time:1e3,type:"info",top:30,msgType:m.default.SYNCHRONIZING}),"function"==typeof this.joinRoomCallback.onSyncStart&&this.joinRoomCallback.onSyncStart())}},{key:"_onSyncFinish",value:function(){this.logger.log("[白板] sync_finished"),(0,d.hideToast)(),"function"==typeof this.joinRoomCallback.onSyncFinish&&this.joinRoomCallback.onSyncFinish()}},{key:"_onconnected",value:function(e){if(this.logger.warn("[白板] onconnected, isreconnecting",e),(0,d.hideToast)(),e&&!this.drawPlugin&&(0,d.showToast)({msg:"重新连接成功",time:3,type:"success",top:30,msgType:m.default.ON_CONNECTED}),!this.drawPlugin)throw new Error("[白板] connected时drawPlugin未创建");this.drawPlugin.setDataReportParams(this.serviceConf.dataReportAddr,{uid:this.opt.uid.toString(),cid:this.getChannelId().toString(),ws_url:this.wbSocketClient.urlBeingUsed,channel_name:this.channel,appkey:this.opt.appKey}),this.drawPlugin.setIsConnected(!0),this._onSyncData(),"function"==typeof this.joinRoomCallback.onconnected&&this.joinRoomCallback.onconnected(e)}},{key:"_onwillreconnect",value:function(){this.logger.warn("[白板] onwillreconnect"),(0,d.showToast)({msg:"网络状况不稳定，正在重新连接...",time:1e3,type:"warn",msgType:m.default.ON_WILL_RECONNECT}),this.drawPlugin&&(this.drawPlugin.setIsConnected(!1),this.drawPlugin.stopSyncData()),"function"==typeof this.joinRoomCallback.onwillreconnect&&this.joinRoomCallback.onwillreconnect()}},{key:"_ondisconnected",value:function(e){this.logger.warn("[白板] ondisconnected",e),(0,d.showToast)({msg:"连接已断开...",time:1e3,type:"error",msgType:m.default.ON_DISCONNECTED}),this.drawPlugin&&(this.drawPlugin.setIsConnected(!1),this.drawPlugin.stopSyncData()),this.destroy({reason:"websocketClose",message:"连接已关闭"}),"function"==typeof this.joinRoomCallback.ondisconnected&&this.joinRoomCallback.ondisconnected(e)}},{key:"_dataReportUtil",value:function(e,t){(0,S.default)(this.serviceConf.dataReportAddr,e,this.opt.appKey+"-"+this.getChannelId(),(0,i.default)({uid:this.getUid(),cid:this.getChannelId(),ws_url:this.wbSocketClient.urlBeingUsed,channel_name:this.channel,appkey:this.opt.appKey,from_g2:!0,time:Date.now()},t))}}]),e}(),x={getInstance:function(e){return new w(e)},showToast:d.showToast,hideToast:d.hideToast,interceptShowToast:d.interceptShowToast,removeToastIntercept:d.removeToastIntercept};window.yunxinWbLogUpload=function(){return(0,f.uploadLog)(T,{appkey:T.opt.appKey,uid:T.getUid().toString(),channel:T.channel})},window.addEventListener("error",(function(e){if(T){var t,r=e.message,n=e.filename,i=e.lineno,o=e.colno,a=e.error;t=a&&a.stack?a.stack:a?null==a?void 0:a.message:"\n        message: "+r+",\n        filename: "+n+",\n        lineno: "+i+",\n        colno: "+o+"\n      ",console.error(t),T.logger.error(t)}})),t.WhiteBoardSDK=w,t.default=x},function(e,t,r){r.r(t),r.d(t,"Headers",(function(){return h})),r.d(t,"Request",(function(){return _})),r.d(t,"Response",(function(){return T})),r.d(t,"DOMException",(function(){return x})),r.d(t,"fetch",(function(){return I}));var n="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==n&&n,i="URLSearchParams"in n,o="Symbol"in n&&"iterator"in Symbol,a="FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),s="FormData"in n,c="ArrayBuffer"in n;if(c)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&u.indexOf(Object.prototype.toString.call(e))>-1};function d(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function p(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function m(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function g(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function v(e){var t=new FileReader,r=g(t);return t.readAsArrayBuffer(e),r}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:a&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():c&&a&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=m(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?m(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)):this.blob().then(v)}),this.text=function(){var e,t,r,n=m(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=g(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s&&(this.formData=function(){return this.text().then(M)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=d(e),t=p(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},h.prototype.delete=function(e){delete this.map[d(e)]},h.prototype.get=function(e){return e=d(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(d(e))},h.prototype.set=function(e,t){this.map[d(e)]=p(t)},h.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),f(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),f(e)},o&&(h.prototype[Symbol.iterator]=h.prototype.entries);var S=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function _(e,t){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,i=(t=t||{}).body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),S.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function M(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function T(e,t){if(!(this instanceof T))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},b.call(_.prototype),b.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},T.error=function(){var e=new T(null,{status:0,statusText:""});return e.type="error",e};var w=[301,302,303,307,308];T.redirect=function(e,t){if(-1===w.indexOf(t))throw new RangeError("Invalid status code");return new T(null,{status:t,headers:{location:e}})};var x=n.DOMException;try{new x}catch(e){(x=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),x.prototype.constructor=x}function I(e,t){return new Promise((function(r,i){var o=new _(e,t);if(o.signal&&o.signal.aborted)return i(new x("Aborted","AbortError"));var s=new XMLHttpRequest;function u(){s.abort()}s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;setTimeout((function(){r(new T(i,n))}),0)},s.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},s.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},s.onabort=function(){setTimeout((function(){i(new x("Aborted","AbortError"))}),0)},s.open(o.method,function(e){try{return""===e&&n.location.href?n.location.href:e}catch(t){return e}}(o.url),!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&(a?s.responseType="blob":c&&o.headers.get("Content-Type")&&-1!==o.headers.get("Content-Type").indexOf("application/octet-stream")&&(s.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof h?o.headers.forEach((function(e,t){s.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){s.setRequestHeader(e,p(t.headers[e]))})),o.signal&&(o.signal.addEventListener("abort",u),s.onreadystatechange=function(){4===s.readyState&&o.signal.removeEventListener("abort",u)}),s.send(void 0===o._bodyInit?null:o._bodyInit)}))}I.polyfill=!0,n.fetch||(n.fetch=I,n.Headers=h,n.Request=_,n.Response=T)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCodeMsgFromEvent=function(e,t){var r=void 0,n=void 0;return e&&e.event&&e.event.code?r=e.event.code:e&&e.code&&(r=e.code),e&&e.event&&e.event.message?n=e.event.message:e&&e.message?n=e.message:e&&e.event&&e.event.msg?n=e.event.msg:e&&e.msg?n=e.msg:e&&e.error&&(n=e.error),n||(n=t),{code:r,message:n}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(19)),i=d(r(13));t.uploadLog=function(e,t){if(!t.channel||!t.uid)return(0,u.showToast)({type:"warn",msg:"uid或者房间名无法找到"});var r=void 0;return(0,l.delay)(4e3).then((function(){return p(e.serviceConf.sdkLogNosAddr,t)})).then((function(e){r=e})).then((function(){return e.logger.getLogTilNow()})).then((function(e){var r=e.map((function(e){return e.logStr})),n=(0,l.stringToBlob)((0,l.formatLogs)(r,t.channel,t.uid),"whiteboardLog.txt");return new File([n],"whiteboardLog.txt",{type:"text/plain"})})).then((function(n){return f(e.serviceConf.directNosAddr,e.serviceConf.dataReportAddr,r,n,t)})).then((function(){var n="日志上传成功\n请告诉开发者你的appkey,uid: "+t.uid+", 以及上传时间: "+(new Date).toTimeString();return console.log(n),console.log("日志的object为: "+(r&&r.data&&r.data.fileName)),e.logger.deleteLogTilNow(),{time:Date.now(),timeStr:(new Date).toTimeString(),uid:t.uid,objectName:r&&r.data&&r.data.fileName,channel:t.channel}})).catch((function(e){return console.error(e),i.default.reject(e)}))};var o=r(142),a=d(r(417)),s=d(r(238)),c=d(r(98)),u=r(29),l=r(239);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t){var r=(0,o.v4)(),s=Math.round(Date.now()/1e3),c=(0,n.default)({appkey:t.appkey,sdktype:"whiteboard",sdkver:"3.7.7",md5:r,ext:"log"});return fetch(e,{method:"post",headers:{"content-type":"application/json",Nonce:r,CurTime:s.toString(),CheckSum:(0,a.default)(c+r+s+"021cc0370d824a51b7c8180485c27b38")},body:c}).then((function(e){return e.json()})).then((function(e){return e&&200===e.code?e:i.default.reject(e)}))},f=function(e,t,r,n,o){return e=e||"https://wanproxy-web.127.net",new i.default((function(i,a){var u=s.default.createConfig({directUploadAddr:e,onError:function(e){a(e)},onComplete:function(e){(0,c.default)(t,"logUpload",o.appkey+"-"+o.channel,{uid:o.uid,appkey:o.appkey,channel:o.channel,filename:r.data.fileName,time:Date.now()}),i()}});s.default.createTask(n,{bucketName:r.data.bucket,objectName:r.data.fileName,token:r.data.xNosToken},u)}))}},function(e,t,r){(function(t){var n,i,o,a;n=r(418),i=r(393).utf8,o=r(393).bin,(a=function(e,r){var a=n.wordsToBytes(function(e){e.constructor==String?e=i.stringToBytes(e):void 0!==t&&"function"==typeof t.isBuffer&&t.isBuffer(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());var r=n.bytesToWords(e),o=8*e.length,a=[],s=1732584193,c=-271733879,u=-1732584194,l=271733878,d=-1009589776;r[o>>5]|=128<<24-o%32,r[15+(o+64>>>9<<4)]=o;for(var p=0;p<r.length;p+=16){for(var f=s,h=c,m=u,g=l,v=d,y=0;y<80;y++){if(y<16)a[y]=r[p+y];else{var b=a[y-3]^a[y-8]^a[y-14]^a[y-16];a[y]=b<<1|b>>>31}var S=(s<<5|s>>>27)+d+(a[y]>>>0)+(y<20?1518500249+(c&u|~c&l):y<40?1859775393+(c^u^l):y<60?(c&u|c&l|u&l)-1894007588:(c^u^l)-899497514);d=l,l=u,u=c<<30|c>>>2,c=s,s=S}s+=f,c+=h,u+=m,l+=g,d+=v}return[s,c,u,l,d]}(e));return r&&r.asBytes?a:r&&r.asString?o.bytesToString(a):n.bytesToHex(a)})._blocksize=16,a._digestsize=20,e.exports=a}).call(this,r(44).Buffer)},function(e,t){var r,n;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],n=0;n<e.length;n+=3)for(var i=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?t.push(r.charAt(i>>>6*(3-o)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],n=0,i=0;n<e.length;i=++n%4)0!=i&&t.push((r.indexOf(e.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|r.indexOf(e.charAt(n))>>>6-2*i);return t}},e.exports=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=b(r(5)),i=b(r(20)),o=b(r(13)),a=b(r(2)),s=b(r(0)),c=b(r(1)),u=b(r(3)),l=b(r(4)),d=b(r(39)),p=b(r(420)),f=b(r(423)),h=r(424),m=r(395),g=r(98),v=b(g),y=r(396);function b(e){return e&&e.__esModule?e:{default:e}}var S=window,_=new f.default({min:3500,max:15e3,jitter:.7}),M=function(e){function t(e){(0,s.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return r.state="disconnected",r.isOnline=!0,r.params=null,r.onMessage=function(e,t){if("broadcast"===t)r.onbroadcast(e);else if("syncRequestAck"===t||"syncRequestResponse"===t||"broadcastAck"===t){var n=e.content&&e.content.params;r.emit(t,n)}else"roomClosed"===t?r.destroy({reason:"roomClosed",message:"房间关闭"}):"kicked"===t&&r.destroy({reason:"kickedBySameAccount",message:"当前账号在多处重复登录"})},r.reconnect=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t>6)return r.destroy({reason:"maxRetryExceed",message:"重试次数超过6次, 断开连接"});if("disconnected"===r.state)return o.default.resolve(!0);var n=_.duration();if("reconnecting"!==r.state){if(!r.isOnline){var i=1500;return(0,h.delay)(i).then((function(){r.reconnect("internetConnectionRecover")}))}r.setState("reconnecting");var a=void 0;return(0,h.delay)(n).then((function(){if(r.logger.log("白板--\x3e WBSocketClient.reconnect 重连原因:"+e+", "+(new Date).toTimeString()+",  current state: "+r.state+", reconnect after, "+n),"disconnected"!==r.state)return a=Date.now(),r.signal.reconnect(e)})).catch((function(e){return r._reportSocketConnClosed(e),o.default.reject(e)})).then((function(){return r.signal.login(r.params)})).then((function(){r._reportLoginSuccess(a),r.isOnline?r.setState("connected"):r.setState("willreconnect"),_.reset()})).catch((function(e){return r.logger.error("socket reconnect error",e),r._reportLoginFail(e,a),417===e.code||"417"===e.code?r.destroy({reason:"roomClosed",message:"房间已关闭"}):418===e.code||"418"===e.code||419===e.code||"419"===e.code?r.destroy({reason:"incompatibleClientVersion",message:"不同客户端版本登录同一个cid"}):e.code?r.destroy({reason:e.error||e.msg||e.message||"unknownReason",message:"login failed: "+e.code}):(r.logger.log("reconnect fail",e),"disconnected"!==r.state&&r.setState("reconnectFail"),r.reconnect("reconnectFail",t+1))}))}},r._handleOnline=function(){r.logger.log("白板--\x3e WBSocketClient._handleOnline"),r.isOnline=!0,_.reset()},r._handleOffline=function(){r.logger.log("白板--\x3e WBSocketClient._handleOffline"),r.isOnline=!1,"connected"===r.state&&r.setState("willreconnect")},r._reportSocketConnClosed=function(e){r._dataReportUtil("v3_conn_error",{error:{code:g.DataReportConnError.Socket_Conn_Closed,message:e.message}})},r._reportLoginSuccess=function(e){r._dataReportUtil("v3_login",{time:e,time_elapsed:Date.now()-e,result:{code:200,message:"Login Success"}})},r._reportLoginFail=function(e,t){var n=700,o="";e instanceof y.SocketConnClosedError?(n=701,o=e.toString()):e.code?(n=e.code,o=e.error||e.message||e.msg):"object"===(void 0===e?"undefined":(0,i.default)(e))&&e&&(o=e.name||e.error||e.message||e.msg),r._dataReportUtil("v3_login",{time:t,time_elapsed:Date.now()-t,result:{code:n,message:o}})},r._dataReportUtil=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!==r.params&&(0,v.default)(r.whiteboardSDK.serviceConf.dataReportAddr,e,r.whiteboardSDK.opt.appKey+"-"+r.whiteboardSDK.getChannelId(),(0,n.default)({uid:r.params.uid,cid:r.params.cid,from_g2:r.params.from_g2,appkey:r.whiteboardSDK.opt.appKey,channel_name:r.whiteboardSDK.channel,ws_url:r.urlBeingUsed,time:Date.now()},t))},r.signal=new p.default(r,e),r.whiteboardSDK=e,r}return(0,l.default)(t,e),(0,c.default)(t,[{key:"startSession",value:function(e){var t=this;if(this.logger.log("白板--\x3e WBSocketClient.startSession, currentState: "+this.state),this.logger.log("白板startSession",e),this.params={cid:e.cid,uid:e.uid,whiteboardVersion:e.whiteboardVersion,record:e.record,token:e.token,from_g2:void 0===e.from_g2||e.from_g2},"disconnected"!==this.state)return o.default.reject({message:"session已经启动。如果需要重新启动session，请先destroy"});if(0===e.urlArray.length)return o.default.reject({message:"startSession时的urlArray长度为0"});var r=function(){"function"==typeof S.addEventListener&&(S.addEventListener("online",t._handleOnline),S.addEventListener("offline",t._handleOffline));for(var r=o.default.resolve(),n=!1,i=void 0,a=function(a){r=r.then((function(){return i=Date.now(),n?void 0:t.signal.connect({cid:e.cid,uid:e.uid,urlArray:e.urlArray,currIndex:a}).catch((function(e){return t._reportSocketConnClosed(e),o.default.reject(e)})).then((function(){return t.signal.login({whiteboardVersion:e.whiteboardVersion,record:e.record,token:e.token,from_g2:void 0===e.from_g2||e.from_g2})})).then((function(){n=!0,t.setState("connected"),t._reportLoginSuccess(i)})).catch((function(r){if(t.logger.log("startSession: "+e.urlArray[a]+"失败，错误原因为: ",r),t._reportLoginFail(r,i),a===e.urlArray.length-1)return o.default.reject(r)}))}))},s=0;s<e.urlArray.length;s++)a(s);return{v:r}}();return"object"===(void 0===r?"undefined":(0,i.default)(r))?r.v:void 0}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{reason:"manualDestroy",message:"手动调用destroy断开连接"};this.logger.log("白板--\x3e WBSocketClient.destroy, currentState: "+this.state+", reason: "+e.reason),"function"==typeof S.removeEventListener&&(S.removeEventListener("online",this._handleOnline),S.removeEventListener("offline",this._handleOffline)),"disconnected"!==this.state&&("kickedBySameAccount"!==e.reason&&"roomClosed"!==e.reason&&(this._dataReportUtil("v3_logout"),this.signal.logout()),this.signal.destroy(e.reason),this.setState("disconnected",{code:200,message:e.message}))}},{key:"broadcastData",value:function(e){e&&("connected"!==this.state?this.logger.log("白板--\x3e WBSocketClient.broadcastData 信令当前不处于连接状态, 当前状态: "+this.state):this.signal.sendMsg("broadcast",e))}},{key:"sendSyncRequest",value:function(e){"connected"!==this.state?this.logger.log("白板--\x3e WBSocketClient.sendSyncRequest 信令当前不处于连接状态, 当前状态: "+this.state):this.signal.sendMsg("syncRequest",{last_server_pkg_id:e})}},{key:"onHeartBeatTimeout",value:function(e){this.logger.log("白板--\x3e WBSocketClient.onHeartBeatTimeout, currentState: "+this.state),"willreconnect"!==this.state&&"connected"!==this.state||(e<m.RECONNECTING_THRESHOLD?this.setState("willreconnect"):(this._dataReportUtil("v3_conn_error",{error:{code:g.DataReportConnError.HeartBeat_Timeout,message:"心跳超时: "+e+"ms"}}),this.reconnect("heartbeatTimeout")))}},{key:"onHeartBeat",value:function(){"willreconnect"===this.state&&this.isOnline&&this.setState("connected")}},{key:"onSignalClosed",value:function(){this.logger.log("白板--\x3e WBSocketClient.onSignalClosed, currentState: "+this.state),"willreconnect"!==this.state&&"connected"!==this.state||(this._dataReportUtil("v3_conn_error",{error:{code:g.DataReportConnError.Socket_Closed,message:"socket连接断开"}}),this.reconnect("websocketClose"))}},{key:"onbroadcast",value:function(e){var t=e.content&&e.content.params&&e.content.params.data,r=e.content&&e.content.params&&e.content.params.server_pkg_id,n=e.content&&e.content.params&&e.content.params.client_pkg_id,i=e.uid;try{t=JSON.parse(t||null)}catch(e){}this.emit("data",{data:t,server_pkg_id:r,client_pkg_id:n,source_uid:i})}},{key:"setState",value:function(e,t){this.state!==e&&(this.logger.log("socketClient --\x3e setState from "+this.state+" to "+e),this.state=e,this.emit(e,t))}},{key:"logger",get:function(){return this.whiteboardSDK.logger}},{key:"urlBeingUsed",get:function(){return this.signal.urlBeingUsed}}]),t}(d.default);t.default=M},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=g(r(19)),i=g(r(13)),o=g(r(2)),a=g(r(0)),s=g(r(1)),c=g(r(3)),u=g(r(4)),l=g(r(39)),d=g(r(394)),p=r(421),f=r(395),h=r(396),m=r(422);function g(e){return e&&e.__esModule?e:{default:e}}var v=window,y=function(e){function t(e,r){(0,a.default)(this,t);var n=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return n.socket=null,n.recv_bytes=0,n.send_bytes=0,n.hbCount=0,n.connectParams={cid:"",uid:"",urlArray:[],currIndex:-1},n.heartBeat={isBeating:!1,last:null,beatAckTimer:null,sendBeatTimer:null},n.onHeartBeat=function(e){n.hbCount%75==0&&n.logger.log("on heart beat: "+n.hbCount+", "+(new Date).toTimeString()),n.hbCount+=1,n.heartBeat.last=Date.now(),clearTimeout(n.heartBeat.beatAckTimer),clearTimeout(n.heartBeat.sendBeatTimer),n.heartBeat.beatAckTimer=null,n.heartBeat.sendBeatTimer=null,n.handler.onHeartBeat(),n.heartBeat.sendBeatTimer=setTimeout(n.sendHeartBeat,f.HeartBeatInterval)},n.onMessageAsHeartBeatAck=function(){n.heartBeat.last=Date.now()},n.sendHeartBeat=function(){clearTimeout(n.heartBeat.sendBeatTimer),n.heartBeat.sendBeatTimer=null,n.sendMsg("keep_alive"),n.heartBeat.beatAckTimer=setTimeout(n.onHeartBeatTimeout,f.HeartBeatTimeout)},n.onHeartBeatTimeout=function(){null===n.heartBeat.last&&(n.heartBeat.last=Date.now());var e=Date.now()-n.heartBeat.last;n.sendHeartBeat(),e>f.HeartBeatTimeout-30&&(n.logger.log("白板--\x3e Signal.onHeartBeatTimeout socket error: heartbeat timeout",e,(new Date).toTimeString(),n.heartBeat.last),n.handler.onHeartBeatTimeout(e))},n.handler=e,n.whiteboardSDK=r,n}return(0,u.default)(t,e),(0,s.default)(t,[{key:"logout",value:function(){this.logger.log("白板--\x3e Signal logout"),this.stopHeartBeat(),null!==this.socket?this.socketStatus===v.WebSocket.OPEN?this.sendLogoutMsg():this.logger.log("白板--\x3e Signal.login socket不是连接状态"):this.logger.log("白板--\x3e Signal.logout socket尚未初始化")}},{key:"login",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.logger.log("白板--\x3e Signal login"),null===this.socket){var n=this.connectParams,o=n.uid,a=n.cid,s=n.urlArray,c=n.currIndex,u=s[c],l="白板--\x3e Signal.login socket尚未初始化，请先连接socket: "+this.getFinalUrl(u,a,o);return this.logger.log(l),i.default.reject()}if(this.socketStatus!==v.WebSocket.OPEN){var d="白板--\x3e Signal.login socket不是连接状态";return this.logger.log(d),i.default.reject()}return this.sendLoginMsg(e),clearTimeout(this.loginAckTimer),new i.default((function(n,i){t.removeAllListeners("loginSuccess"),t.removeAllListeners("loginFailed"),t.once("loginSuccess",(function(e){clearTimeout(t.loginAckTimer),t.removeAllListeners("loginSuccess"),t.removeAllListeners("loginFailed"),t.logger.log("白板--\x3e Signal Login Success"),n()})),t.once("loginFailed",(function(e){clearTimeout(t.loginAckTimer),t.removeAllListeners("loginSuccess"),t.removeAllListeners("loginFailed"),t.logger.warn("白板--\x3e Login Failed",e),t.destroy("loginFailed"),i(e)})),t.loginAckTimer=setTimeout((function(){if(clearTimeout(t.loginAckTimer),t.removeAllListeners("loginSuccess"),t.removeAllListeners("loginFailed"),r<f.LoginMaxRetry)return t.login(e,r+1).then((function(){n()})).catch((function(e){i(e)}));t.logger.log("白板--\x3e Login Failed. Login Ack超时，且重试次数超过"+f.LoginMaxRetry+"次"),t.destroy("loginFailed"),i("Login Ack超时，且重试次数超过"+f.LoginMaxRetry+"次")}),f.LoginAckTimeout)}))}},{key:"reconnect",value:function(e){return this.destroy(e),this.connect(this.connectParams,!0)}},{key:"connect",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!==this.socket){var n="白板--\x3e Signal.connect socket正处于连接状态，请先销毁再重连";return this.logger.log(n),i.default.reject(new h.SocketInUseError(n))}r?this.connectParams.currIndex=(this.connectParams.currIndex+1)%this.connectParams.urlArray.length:this.connectParams=e;var o=this.connectParams,a=o.cid,s=o.uid,c=o.urlArray,u=o.currIndex,l=c[u];return this.urlBeingUsed=l,l=this.getFinalUrl(l,a,s),new i.default((function(e,r){clearTimeout(t.connetTimer),t.connetTimer=setTimeout((function(){t.socket&&t.socketStatus!==v.WebSocket.OPEN&&(t.socket.onopen=null,t.socket.onclose=null,t.socket.close(),t.socket=null,t.logger.error("socket连接建立过程超时"),r(new h.SocketConnClosedError("socket连接建立过程超时")))}),f.SocketConnTimeout);try{t.logger.log("白板--\x3e Signal.connect url: "+l),t.socket=new v.WebSocket(l),t.socket.onopen=function(r){t.initSignal(),t.logger.log("白板--\x3e Signal onopen"),clearTimeout(t.connetTimer),e(t)},t.socket.onclose=function(e){var n="白板--\x3e Signal onclose: "+l;t.stopHeartBeat(),t.logger.log(n),t.socket=null,t.handler.onSignalClosed(),clearTimeout(t.connetTimer),r(new h.SocketConnClosedError(n))}}catch(e){t.logger.log("白板--\x3e Signal.connect 信令连接建立失败",e),r(e)}}))}},{key:"destroy",value:function(e){this.logger.log("白板--\x3e Signal.destroy 销毁原因: "+e),this.stopHeartBeat(),null!==this.socket&&(this.socket.onmessage=null,this.socket.onclose=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.close(),this.socket=null)}},{key:"getFinalUrl",value:function(e,t,r){return(e=-1!==e.indexOf("?")?e+"&cid="+t+"&uid="+r:"/"===e[e.length-1]?e+"?cid="+t+"&uid="+r:e+"/?cid="+t+"&uid="+r).startsWith("ws://")||e.startsWith("wss://")?e:"wss://"+e}},{key:"initSignal",value:function(){var e=this;null!==this.socket?this.socket.onmessage=function(t){var r=JSON.parse(t.data||null);if(r)return"loginAck"===r.type||r.type===p.serializeWb.gateWay.loginAck?e.onLoginAck(r):!e.heartBeat.isBeating||"keep_alive_ack"!==r.type&&r.type!==p.serializeWb.gateWay.keep_alive_ack?void(r&&e.onMessage(r)):e.onHeartBeat(r)}:this.logger.log("白板--\x3e Signal.initSignal ws is null")}},{key:"onLoginAck",value:function(e){var t=e.content.params,r=t.auth_result-0;if(200!==r){this.logger.log("白板--\x3e Signal.onLoginAck: 服务器验证不通过, 断开连接: "+r);var n="服务器验证不通过, 断开连接";return t.errmsg?n=t.errmsg:t.errMsg&&(n=t.errMsg),this.emit("loginFailed",{code:r,error:n})}this.logger.log("白板--\x3e Signal.onLoginAck: 白板服务器登录成功",e),this.emit("loginSuccess"),this.startHeartbeat()}},{key:"onMessage",value:function(e){e&&e.cid&&e.uid&&(e.cid=+e.cid,e.uid=+e.uid);var t=p.unserializeWb.gateWay[e.type];return t?"logout"!==t&&e.cid!==this.connectParams.cid&&e.cid!==Number(this.connectParams.cid)?this.logger.log("白板--\x3e Signal.onMessage: msg不属于当前cid: "+this.connectParams.cid,e):(this.onMessageAsHeartBeatAck(),void this.handler.onMessage(e,t)):this.logger.log("白板--\x3e Signal.onMessage: msg类型找不到"+e.type)}},{key:"startHeartbeat",value:function(){this.logger.log("白板--\x3e Signal.startHeartbeat:"+(new Date).toTimeString()),this.heartBeat.last=Date.now(),this.heartBeat.isBeating=!0,clearTimeout(this.heartBeat.beatAckTimer),clearTimeout(this.heartBeat.sendBeatTimer),this.heartBeat.beatAckTimer=null,this.heartBeat.sendBeatTimer=null,this.sendHeartBeat()}},{key:"stopHeartBeat",value:function(){this.logger.log("白板--\x3e Signal.stopHeartBeat at: "+(new Date).toLocaleString()),clearTimeout(this.heartBeat.beatAckTimer),clearTimeout(this.heartBeat.sendBeatTimer),this.heartBeat.beatAckTimer=null,this.heartBeat.sendBeatTimer=null,this.heartBeat.isBeating=!1,this.heartBeat.last=null}},{key:"sendLoginMsg",value:function(e){var t={cname:this.whiteboardSDK.channel,token:e.token,client_type:2,client_net:2,client_os:(0,m.getClientOs)(),client_sdk_version:e.whiteboardVersion,client_support_record:e.record};e.from_g2&&(t.from_g2=!0),this.logger.log("白板--\x3e Signal login",t),this.sendMsg("login",t)}},{key:"sendLogoutMsg",value:function(){this.sendMsg("logout",{recv_bytes:this.recv_bytes,send_bytes:this.send_bytes})}},{key:"sendMsg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n={type:e=p.serializeWb.gateWay[e],uid:+this.connectParams.uid,cid:+this.connectParams.cid,version:31,content:{params:t}},i=Date.now(),o=i;o=+i.toString().slice(0,-3),r&&(n.content.params.timestamp=o),this.send(n)}},{key:"receiveStats",value:function(){}},{key:"sendStats",value:function(){}},{key:"send",value:function(e){null!==this.socket&&this.socketStatus===v.WebSocket.OPEN?(e.browser={},e.browser.name=d.default.name,e.browser.version=d.default.version,this.socket.send((0,n.default)(e))):(this.logger.log("白板--\x3e Signal.send失败，socket是否为null: "+(null===this.socket)+", socketStatus: "+this.socketStatus),this.logger.log("白板--\x3e Signal.send失败，数据: "+(0,n.default)(e)))}},{key:"socketStatus",get:function(){return null===this.socket?-1:this.socket.readyState}},{key:"logger",get:function(){return this.whiteboardSDK.logger}}]),t}(l.default);t.default=y},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.serializeWb={gateWay:{login:1,loginAck:2,join:3,keep_alive:4,keep_alive_ack:5,keep_alive_node:6,broadcast:7,toUser:8,logout:9,syncRequest:10,syncRequestAck:11,syncRequestResponse:12,broadcastAck:13,kicked:14,roomClosed:15}},t.unserializeWb={gateWay:{1:"login",2:"loginAck",3:"join",4:"keep_alive",5:"keep_alive_ack",6:"keep_alive_node",7:"broadcast",8:"toUser",9:"logout",10:"syncRequest",11:"syncRequestAck",12:"syncRequestResponse",13:"broadcastAck",14:"kicked",15:"roomClosed"}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getClientOs=t.delay=void 0;var n=o(r(13)),i=o(r(394));function o(e){return e&&e.__esModule?e:{default:e}}t.delay=function(e){return new n.default((function(t){setTimeout((function(){t()}),e)}))},t.getClientOs=function(){var e="",t="";try{e=i.default.description.toLowerCase(),t=i.default.ua.toString().toLowerCase()}catch(e){console.warn(e)}var r=/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,n=/android/.test(e),o=/windows/.test(t),a=/os x/.test(t),s=/electron/.test(t),c=/qtwebengine/.test(t);return n?1:r?2:s||c?o?3:a?4:5:0}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0;var n,i=(n=r(13))&&n.__esModule?n:{default:n};t.delay=function(e){return new i.default((function(t){setTimeout((function(){t()}),e)}))}}]).default},module.exports=t()})(WhiteBoardSDK_v3_7_7);var Whiteboard=getDefaultExportFromCjs(WhiteBoardSDK_v3_7_7.exports),ToolCollection_v3_7_7={exports:{}};(function(module,exports){var e;e=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=453)}([function(e,t,r){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,r){t.__esModule=!0;var n,i=(n=r(47))&&n.__esModule?n:{default:n};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,i.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},function(e,t,r){e.exports={default:r(186),__esModule:!0}},function(e,t,r){t.__esModule=!0;var n,i=(n=r(20))&&n.__esModule?n:{default:n};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,r){t.__esModule=!0;var n=a(r(127)),i=a(r(86)),o=a(r(20));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},function(e,t,r){e.exports={default:r(146),__esModule:!0}},function(e,t){var r=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=r)},function(e,t,r){!function(){function t(e,t){var r,n,i,o,a=C;for(o=arguments.length;o-- >2;)A.push(arguments[o]);for(t&&null!=t.children&&(A.length||A.push(t.children),delete t.children);A.length;)if((n=A.pop())&&void 0!==n.pop)for(o=n.length;o--;)A.push(n[o]);else"boolean"==typeof n&&(n=null),(i="function"!=typeof e)&&(null==n?n="":"number"==typeof n?n+="":"string"!=typeof n&&(i=!1)),i&&r?a[a.length-1]+=n:a===C?a=[n]:a.push(n),r=i;var s=new I;return s.nodeName=e,s.children=a,s.attributes=null==t?void 0:t,s.key=null==t?void 0:t.key,void 0!==E.vnode&&E.vnode(s),s}function r(e,t){for(var r in t)e[r]=t[r];return e}function n(e,t){e&&("function"==typeof e?e(t):e.current=t)}function i(e){!e.__d&&(e.__d=!0)&&1==N.push(e)&&(E.debounceRendering||k)(o)}function o(){for(var e;e=N.pop();)e.__d&&M(e)}function a(e,t,r){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&s(e,t.nodeName):r||e._componentConstructor===t.nodeName}function s(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function c(e){var t=r({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var i in n)void 0===t[i]&&(t[i]=n[i]);return t}function u(e){var t=e.parentNode;t&&t.removeChild(e)}function l(e,t,r,i,o){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n(r,null),n(i,e);else if("class"!==t||o)if("style"===t){if(i&&"string"!=typeof i&&"string"!=typeof r||(e.style.cssText=i||""),i&&"object"==typeof i){if("string"!=typeof r)for(var a in r)a in i||(e.style[a]="");for(var a in i)e.style[a]="number"==typeof i[a]&&!1===O.test(a)?i[a]+"px":i[a]}}else if("dangerouslySetInnerHTML"===t)i&&(e.innerHTML=i.__html||"");else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),i?r||e.addEventListener(t,d,s):e.removeEventListener(t,d,s),(e.__l||(e.__l={}))[t]=i}else if("list"!==t&&"type"!==t&&!o&&t in e){try{e[t]=null==i?"":i}catch(e){}null!=i&&!1!==i||"spellcheck"==t||e.removeAttribute(t)}else{var c=o&&t!==(t=t.replace(/^xlink:?/,""));null==i||!1===i?c?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof i&&(c?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),i):e.setAttribute(t,i))}else e.className=i||""}function d(e){return this.__l[e.type](E.event&&E.event(e)||e)}function p(){for(var e;e=R.shift();)E.afterMount&&E.afterMount(e),e.componentDidMount&&e.componentDidMount()}function f(e,t,r,n,i,o){P++||(D=null!=i&&void 0!==i.ownerSVGElement,j=null!=e&&!("__preactattr_"in e));var a=h(e,t,r,n,o);return i&&a.parentNode!==i&&i.appendChild(a),--P||(j=!1,o||p()),a}function h(e,t,r,n,i){var o=e,a=D;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(o=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(o,e),g(e,!0))),o.__preactattr_=!0,o;var c=t.nodeName;if("function"==typeof c)return T(e,t,r,n);if(D="svg"===c||"foreignObject"!==c&&D,c+="",(!e||!s(e,c))&&(o=function(e,t){var r=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return r.__n=e,r}(c,D),e)){for(;e.firstChild;)o.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(o,e),g(e,!0)}var u=o.firstChild,l=o.__preactattr_,d=t.children;if(null==l){l=o.__preactattr_={};for(var p=o.attributes,f=p.length;f--;)l[p[f].name]=p[f].value}return!j&&d&&1===d.length&&"string"==typeof d[0]&&null!=u&&void 0!==u.splitText&&null==u.nextSibling?u.nodeValue!=d[0]&&(u.nodeValue=d[0]):(d&&d.length||null!=u)&&m(o,d,r,n,j||null!=l.dangerouslySetInnerHTML),y(o,t.attributes,l),D=a,o}function m(e,t,r,n,i){var o,s,c,l,d,p=e.childNodes,f=[],m={},v=0,y=0,b=p.length,S=0,_=t?t.length:0;if(0!==b)for(var M=0;M<b;M++){var T=p[M],w=T.__preactattr_;null!=(x=_&&w?T._component?T._component.__k:w.key:null)?(v++,m[x]=T):(w||(void 0!==T.splitText?!i||T.nodeValue.trim():i))&&(f[S++]=T)}if(0!==_)for(M=0;M<_;M++){var x;if(d=null,null!=(x=(l=t[M]).key))v&&void 0!==m[x]&&(d=m[x],m[x]=void 0,v--);else if(y<S)for(o=y;o<S;o++)if(void 0!==f[o]&&a(s=f[o],l,i)){d=s,f[o]=void 0,o===S-1&&S--,o===y&&y++;break}d=h(d,l,r,n),c=p[M],d&&d!==e&&d!==c&&(null==c?e.appendChild(d):d===c.nextSibling?u(c):e.insertBefore(d,c))}if(v)for(var M in m)void 0!==m[M]&&g(m[M],!1);for(;y<=S;)void 0!==(d=f[S--])&&g(d,!1)}function g(e,t){var r=e._component;r?w(r):(null!=e.__preactattr_&&n(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||u(e),v(e))}function v(e){for(e=e.lastChild;e;){var t=e.previousSibling;g(e,!0),e=t}}function y(e,t,r){var n;for(n in r)t&&null!=t[n]||null==r[n]||l(e,n,r[n],r[n]=void 0,D);for(n in t)"children"===n||"innerHTML"===n||n in r&&t[n]===("value"===n||"checked"===n?e[n]:r[n])||l(e,n,r[n],r[n]=t[n],D)}function b(e,t,r){var n,i=L.length;for(e.prototype&&e.prototype.render?(n=new e(t,r),x.call(n,t,r)):((n=new x(t,r)).constructor=e,n.render=S);i--;)if(L[i].constructor===e)return n.__b=L[i].__b,L.splice(i,1),n;return n}function S(e,t,r){return this.constructor(e,r)}function _(e,t,r,o,a){e.__x||(e.__x=!0,e.__r=t.ref,e.__k=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||a?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,o)),o&&o!==e.context&&(e.__c||(e.__c=e.context),e.context=o),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==r&&(1!==r&&!1===E.syncComponentUpdates&&e.base?i(e):M(e,1,a)),n(e.__r,e))}function M(e,t,n,i){if(!e.__x){var o,a,s,u=e.props,l=e.state,d=e.context,h=e.__p||u,m=e.__s||l,v=e.__c||d,y=e.base,S=e.__b,T=y||S,x=e._component,I=!1,A=v;if(e.constructor.getDerivedStateFromProps&&(l=r(r({},l),e.constructor.getDerivedStateFromProps(u,l)),e.state=l),y&&(e.props=h,e.state=m,e.context=v,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(u,l,d)?I=!0:e.componentWillUpdate&&e.componentWillUpdate(u,l,d),e.props=u,e.state=l,e.context=d),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!I){o=e.render(u,l,d),e.getChildContext&&(d=r(r({},d),e.getChildContext())),y&&e.getSnapshotBeforeUpdate&&(A=e.getSnapshotBeforeUpdate(h,m));var C,k,O=o&&o.nodeName;if("function"==typeof O){var N=c(o);(a=x)&&a.constructor===O&&N.key==a.__k?_(a,N,1,d,!1):(C=a,e._component=a=b(O,N,d),a.__b=a.__b||S,a.__u=e,_(a,N,0,d,!1),M(a,1,n,!0)),k=a.base}else s=T,(C=x)&&(s=e._component=null),(T||1===t)&&(s&&(s._component=null),k=f(s,o,d,n||!y,T&&T.parentNode,!0));if(T&&k!==T&&a!==x){var D=T.parentNode;D&&k!==D&&(D.replaceChild(k,T),C||(T._component=null,g(T,!1)))}if(C&&w(C),e.base=k,k&&!i){for(var j=e,L=e;L=L.__u;)(j=L).base=k;k._component=j,k._componentConstructor=j.constructor}}for(!y||n?R.push(e):I||(e.componentDidUpdate&&e.componentDidUpdate(h,m,A),E.afterUpdate&&E.afterUpdate(e));e.__h.length;)e.__h.pop().call(e);P||i||p()}}function T(e,t,r,n){for(var i=e&&e._component,o=i,a=e,s=i&&e._componentConstructor===t.nodeName,u=s,l=c(t);i&&!u&&(i=i.__u);)u=i.constructor===t.nodeName;return i&&u&&(!n||i._component)?(_(i,l,3,r,n),e=i.base):(o&&!s&&(w(o),e=a=null),i=b(t.nodeName,l,r),e&&!i.__b&&(i.__b=e,a=null),_(i,l,1,r,n),e=i.base,a&&e!==a&&(a._component=null,g(a,!1))),e}function w(e){E.beforeUnmount&&E.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var r=e._component;r?w(r):t&&(null!=t.__preactattr_&&n(t.__preactattr_.ref,null),e.__b=t,u(t),L.push(e),v(t)),n(e.__r,null)}function x(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{},this.__h=[]}var I=function(){},E={},A=[],C=[],k="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,O=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,N=[],R=[],P=0,D=!1,j=!1,L=[];r(x.prototype,{setState:function(e,t){this.__s||(this.__s=this.state),this.state=r(r({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this.__h.push(t),i(this)},forceUpdate:function(e){e&&this.__h.push(e),M(this,2)},render:function(){}});var z={h:t,createElement:t,cloneElement:function(e,n){return t(e.nodeName,r(r({},e.attributes),n),arguments.length>2?[].slice.call(arguments,2):e.children)},createRef:function(){return{}},Component:x,render:function(e,t,r){return f(r,e,{},!1,t,!1)},rerender:o,options:E};e.exports=z}()},function(e,t,r){var n=r(12),i=r(6),o=r(26),a=r(27),s=r(33),c=function(e,t,r){var u,l,d,p=e&c.F,f=e&c.G,h=e&c.S,m=e&c.P,g=e&c.B,v=e&c.W,y=f?i:i[t]||(i[t]={}),b=y.prototype,S=f?n:h?n[t]:(n[t]||{}).prototype;for(u in f&&(r=t),r)(l=!p&&S&&void 0!==S[u])&&s(y,u)||(d=l?S[u]:r[u],y[u]=f&&"function"!=typeof S[u]?r[u]:g&&l?o(d,n):v&&S[u]==d?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):m&&"function"==typeof d?o(Function.call,d):d,m&&((y.virtual||(y.virtual={}))[u]=d,e&c.R&&b&&!b[u]&&a(b,u,d)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){e.exports={default:r(180),__esModule:!0}},,function(e,t,r){var n=r(79)("wks"),i=r(60),o=r(12).Symbol,a="function"==typeof o;(e.exports=function(e){return n[e]||(n[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=n},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},,function(e,t,r){e.exports={default:r(169),__esModule:!0}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(23),i=r(106),o=r(74),a=Object.defineProperty;t.f=r(17)?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!r(28)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},,function(e,t,r){e.exports={default:r(166),__esModule:!0}},function(e,t,r){t.__esModule=!0;var n=a(r(151)),i=a(r(65)),o="function"==typeof i.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===o(n.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}},,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=r(7),u=d(c),l=d(r(244));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.handleClick=function(t){t.stopPropagation(),t.preventDefault();var r=e.props.store.popup;e.props.store.popup=void 0,e.props.onClick?e.props.onClick(t,{currPopup:r}):e.props.store.updateSelectedTool(e.props.option.tool),e.props.onAfterClick&&e.props.onAfterClick(),e.props.store.update()},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this.props,t=e.option,r=e.store,n=e.unavailable,i=e.containerPosition,o=e.itemSizeBase,a=e.hideHint,s=e.toolOptionalName,c=!1;(r.tool===t.tool||Array.isArray(s)&&-1!==s.indexOf(r.tool))&&(c=!0);var d="tc-unit tc-unit-"+t.tool+(t.class?" "+t.class:"")+(c?" selected":"")+(n?" unavailable":""),p={width:o-2,height:o-2};t.backgroundImage&&(p.backgroundImage="url("+t.backgroundImage+")");var f=u.default.createElement("div",{className:d,style:p,onClick:this.handleClick},this.props.children);return t.hint&&!a?u.default.createElement(l.default,{width:o,height:o,hint:t.hint,containerPosition:i},f):u.default.createElement("div",{style:{width:o,height:o}},f)}}]),t}(c.Component);t.default=p},function(e,t,r){var n=r(15);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r,n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(r=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),a=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(a).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];null!=o&&(n[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];null!=a[0]&&n[a[0]]||(r&&!a[2]?a[2]=r:r&&(a[2]="("+a[2]+") and ("+r+")"),t.push(a))}},t}},function(e,t,r){var n,i,o={},a=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=n.apply(this,arguments)),i}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},c=function(e){var t={};return function(e,r){if("function"==typeof e)return e();if(void 0===t[e]){var n=s.call(this,e,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),u=null,l=0,d=[],p=r(205);function f(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=o[n.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](n.parts[a]);for(;a<n.parts.length;a++)i.parts.push(b(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(b(n.parts[a],t));o[n.id]={id:n.id,refs:1,parts:s}}}}function h(e,t){for(var r=[],n={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};n[a]?n[a].parts.push(s):r.push(n[a]={id:a,parts:[s]})}return r}function m(e,t){var r=c(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),d.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=c(e.insertAt.before,r);r.insertBefore(t,i)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=r.nc;n&&(e.attrs.nonce=n)}return y(t,e.attrs),m(e,t),t}function y(e,t){Object.keys(t).forEach((function(r){e.setAttribute(r,t[r])}))}function b(e,t){var r,n,i,o;if(t.transform&&e.css){if(!(o="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=o}if(t.singleton){var a=l++;r=u||(u=v(t)),n=M.bind(null,r,a,!1),i=M.bind(null,r,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",y(t,e.attrs),m(e,t),t}(t),n=w.bind(null,r,t),i=function(){g(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(t),n=T.bind(null,r),i=function(){g(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=h(e,t);return f(r,t),function(e){for(var n=[],i=0;i<r.length;i++){var a=r[i];(s=o[a.id]).refs--,n.push(s)}for(e&&f(h(e,t),t),i=0;i<n.length;i++){var s;if(0===(s=n[i]).refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete o[s.id]}}}};var S,_=(S=[],function(e,t){return S[e]=t,S.filter(Boolean).join("\n")});function M(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=_(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function T(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function w(e,t,r){var n=r.css,i=r.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(n=p(n)),i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},function(e,t,r){var n=r(58);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(16),i=r(45);e.exports=r(17)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeToastIntercept=exports.interceptShowToast=exports.hideToast=exports.showToast=void 0;var _typeof2=__webpack_require__(20),_typeof3=_interopRequireDefault(_typeof2),_assign=__webpack_require__(5),_assign2=_interopRequireDefault(_assign),_stringify=__webpack_require__(19),_stringify2=_interopRequireDefault(_stringify),_classCallCheck2=__webpack_require__(0),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_toastCtrl=__webpack_require__(206),_toastCtrl2=_interopRequireDefault(_toastCtrl);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var ToastClass=function ToastClass(){var _this=this;(0,_classCallCheck3.default)(this,ToastClass),this.show=function(e){var t=e.msg,r=e.time,n=void 0===r?2:r,i=e.type,o=void 0===i?"info":i,a=e.top,s=void 0===a?30:a,c={msgType:e.msgType,args:e.args,msg:t.constructor===String?t:(0,_stringify2.default)(t),time:n,type:o,top:s};if("function"==typeof _this.interceptShowFn){var u=_this.interceptShowFn((0,_assign2.default)({},c));if(!u)return;"object"===(void 0===u?"undefined":(0,_typeof3.default)(u))&&(c=u)}c&&_toastCtrl2.default.show(c)},this.hide=function(){("function"!=typeof _this.interceptHideFn||_this.interceptHideFn())&&_toastCtrl2.default.hide()},this.interceptShow=function(fn){if("string"==typeof fn)try{fn=eval(fn)}catch(e){return console.error(e),void console.error("interceptShowToast如果参数为string，该string需要能够被eval解析: "+fn)}"function"!=typeof fn?console.error("interceptShowToast的参数必须为函数"):_this.interceptShowFn=fn},this.interceptHide=function(e){"function"!=typeof e?console.error("Toast.interceptHide的参数必须为函数"):_this.interceptHideFn=e},this.removeIntercept=function(){_this.interceptShowFn=void 0,_this.interceptHideFn=void 0}};window.__newb__=window.__newb__||{},window.__newb__.Toast||(window.__newb__.Toast=new ToastClass),exports.showToast=window.__newb__.Toast.show,exports.hideToast=window.__newb__.Toast.hide,exports.interceptShowToast=window.__newb__.Toast.interceptShow,exports.removeToastIntercept=window.__newb__.Toast.removeIntercept},function(e,t,r){var n=r(75),i=r(76);e.exports=function(e){return n(i(e))}},function(e,t,r){e.exports={default:r(171),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default={SYNCHRONIZING:"SYNCHRONIZING",ON_CONNECTED:"ON_CONNECTED",ON_WILL_RECONNECT:"ON_WILL_RECONNECT",ON_DISCONNECTED:"ON_DISCONNECTED",NETWORK_INSTABLE:"NETWORK_INSTABLE",SYNC_FAIL:"SYNC_FAIL",DELAY_DISPATCH_WHILE_NETWORK_INSTABLE:"DELAY_DISPATCH_WHILE_NETWORK_INSTABLE",START_BROADCAST:"START_BROADCAST",STOP_BROADCAST:"STOP_BROADCAST",SWITCH_TO_FOLLOWER:"SWITCH_TO_FOLLOWER",SWITCH_TO_FREE_OBSERVER:"SWITCH_TO_FREE_OBSERVER",NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER:"NOT_ALLOWED_REPLACE_ACTIVE_BROADCASTER",NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER:"NOT_ALLOWED_SET_CAMERA_WHILE_FOLLOW_BROADCASTER",RECEIVE_STOP_BROADCAST:"RECEIVE_STOP_BROADCAST",RECEIVE_START_BROADCAST:"RECEIVE_START_BROADCAST",CURRENT_USER_IS_BROADCASTER:"CURRENT_USER_IS_BROADCASTER",CURRENT_USER_IS_FOLLOWER:"CURRENT_USER_IS_FOLLOWER",CURRENT_USER_IS_FREE_OBSERVER:"CURRENT_USER_IS_FREE_OBSERVER",FILE_SIZE_EXCEED_LIMIT:"FILE_SIZE_EXCEED_LIMIT",FILE_ACCEPTED_TYPE_LIMIT:"FILE_ACCEPTED_TYPE_LIMIT",FILE_UPLOAD_FAIL:"FILE_UPLOAD_FAIL",FILE_IS_UPLOADING:"FILE_IS_UPLOADING",FILE_TRANSCODE_SUCCEED:"FILE_TRANSCODE_SUCCEED",FILE_TRANSCODE_FAIL:"FILE_TRANSCODE_FAIL",VIDEO_UPLOAD_FAIL:"VIDEO_UPLOAD_FAIL",AUDIO_UPLOAD_FAIL:"AUDIO_UPLOAD_FAIL",VIDEO_TYPE_NOT_ALLOWED:"VIDEO_TYPE_NOT_ALLOWED",AUDIO_TYPE_NOT_ALLOWED:"AUDIO_TYPE_NOT_ALLOWED",PIC_UPLOAD_FAIL:"PIC_UPLOAD_FAIL",LOG_FILE_UPLOAD_THROTTLE:"LOG_FILE_UPLOAD_THROTTLE",LOG_FILE_IS_UPLOADING:"LOG_FILE_IS_UPLOADING",LOG_FILE_UPLOAD_SUCCEED:"LOG_FILE_UPLOAD_SUCCEED",LOG_FILE_UPLOAD_FAIL:"LOG_FILE_UPLOAD_FAIL",ONE_MEDIA_LIMIT:"ONE_MEDIA_LIMIT",IOS_NOT_SUPPORT_TEXT:"IOS_NOT_SUPPORT_TEXT"}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(76);e.exports=function(e){return Object(n(e))}},,,function(e,t,r){var n=r(153)(!0);r(81)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},,function(e,t){!function(r){"object"==typeof t&&void 0!==e?e.exports=r():("undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:this).EventEmitter3=r()}((function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof commonjsRequire&&commonjsRequire;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,(function(e){return i(t[a][1][e]||e)}),l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof commonjsRequire&&commonjsRequire,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new a(r,n||e,o),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,a=new Array(o);n<o;n++)a[n]=r[n].fn;return a},u.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,n,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var c,u=this._events[s],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,o),!0;case 6:return u.fn.call(u.context,t,r,n,o,a),!0}for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];u.fn.apply(u.context,c)}else for(var d,p=u.length,f=0;f<p;f++)switch(u[f].once&&this.removeListener(e,u[f].fn,void 0,!0),l){case 1:u[f].fn.call(u[f].context);break;case 2:u[f].fn.call(u[f].context,t);break;case 3:u[f].fn.call(u[f].context,t,r);break;case 4:u[f].fn.call(u[f].context,t,r,n);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u[f].fn.apply(u[f].context,c)}return!0},u.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,n){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return c(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||c(this,o);else{for(var s=0,u=[],l=a.length;s<l;s++)(a[s].fn!==t||n&&!a[s].once||r&&a[s].context!==r)&&u.push(a[s]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&c(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}]},{},[1])(1)}))},function(e,t){e.exports={}},function(e,t,r){t.__esModule=!0;var n,i=(n=r(118))&&n.__esModule?n:{default:n};t.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return(0,i.default)(e)}},,function(e,t,r){r(155);for(var n=r(12),i=r(27),o=r(40),a=r(11)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var u=s[c],l=n[u],d=l&&l.prototype;d&&!d[a]&&i(d,a,u),o[u]=o.Array}},,function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(107),i=r(80);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){e.exports={default:r(167),__esModule:!0}},,function(e,t){e.exports=!0},function(e,t,r){var n=r(16).f,i=r(33),o=r(11)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){var n=r(26),i=r(111),o=r(112),a=r(23),s=r(59),c=r(84),u={},l={};(t=e.exports=function(e,t,r,d,p){var f,h,m,g,v=p?function(){return e}:c(e),y=n(r,d,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(f=s(e.length);f>b;b++)if((g=t?y(a(h=e[b])[0],h[1]):y(e[b]))===u||g===l)return g}else for(m=v.call(e);!(h=m.next()).done;)if((g=i(m,y,h.value,t))===u||g===l)return g}).BREAK=u,t.RETURN=l},,function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},,,,,function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var n=r(77),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var n=r(23),i=r(120),o=r(80),a=r(78)("IE_PROTO"),s=function(){},c=function(){var e,t=r(89)("iframe"),n=o.length;for(t.style.display="none",r(121).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[o[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[a]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){t.f=r(11)},function(e,t,r){e.exports={default:r(157),__esModule:!0}},function(e,t){},,,,function(e,t,r){e.exports={default:r(143),__esModule:!0}},function(e,t,r){var n=r(61),i=r(45),o=r(30),a=r(74),s=r(33),c=r(106),u=Object.getOwnPropertyDescriptor;t.f=r(17)?u:function(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){var n=r(53),i=r(11)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:o?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},,function(e,t,r){var n=r(15);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(53);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(79)("keys"),i=r(60);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var n=r(6),i=r(12),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(49)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(49),i=r(8),o=r(108),a=r(27),s=r(40),c=r(154),u=r(50),l=r(90),d=r(11)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,r,h,m,g,v){c(r,t,h);var y,b,S,_=function(e){if(!p&&e in x)return x[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},M=t+" Iterator",T="values"==m,w=!1,x=e.prototype,I=x[d]||x["@@iterator"]||m&&x[m],E=I||_(m),A=m?T?_("entries"):E:void 0,C="Array"==t&&x.entries||I;if(C&&(S=l(C.call(new e)))!==Object.prototype&&S.next&&(u(S,M,!0),n||"function"==typeof S[d]||a(S,d,f)),T&&I&&"values"!==I.name&&(w=!0,E=function(){return I.call(this)}),n&&!v||!p&&!w&&x[d]||a(x,d,E),s[t]=E,s[M]=f,m)if(y={values:T?E:_("values"),keys:g?E:_("keys"),entries:A},v)for(b in y)b in x||o(x,b,y[b]);else i(i.P+i.F*(p||w),t,y);return y}},function(e,t,r){var n=r(60)("meta"),i=r(15),o=r(33),a=r(16).f,s=0,c=Object.isExtensible||function(){return!0},u=!r(28)((function(){return c(Object.preventExtensions({}))})),l=function(e){a(e,n,{value:{i:"O"+ ++s,w:{}}})},d=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[n].i},getWeak:function(e,t){if(!o(e,n)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[n].w},onFreeze:function(e){return u&&d.NEED&&c(e)&&!o(e,n)&&l(e),e}}},function(e,t,r){var n=r(12),i=r(6),o=r(49),a=r(64),s=r(16).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t,r){var n=r(72),i=r(11)("iterator"),o=r(40);e.exports=r(6).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t,r){var n=r(15);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,r){e.exports={default:r(191),__esModule:!0}},,,function(e,t,r){var n=r(15),i=r(12).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,r){var n=r(33),i=r(34),o=r(78)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,r){var n=r(107),i=r(80).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(27);e.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},function(e,t,r){var n=r(8),i=r(6),o=r(28);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],a={};a[e]=t(r),n(n.S+n.F*o((function(){r(1)})),"Object",a)}},function(e,t,r){e.exports={default:r(193),__esModule:!0}},,function(e,t,r){e.exports=function(e,t){return"string"!=typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),/["'() \t\n]/.test(e)||t?'"'+e.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e)}},,,,,,,,,function(e,t,r){e.exports=!r(17)&&!r(28)((function(){return 7!=Object.defineProperty(r(89)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(33),i=r(30),o=r(149)(!1),a=r(78)("IE_PROTO");e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)r!=a&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){e.exports=r(27)},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(53);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(23);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},function(e,t,r){var n=r(40),i=r(11)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){var n=r(16).f,i=r(62),o=r(93),a=r(26),s=r(92),c=r(51),u=r(81),l=r(109),d=r(124),p=r(17),f=r(82).fastKey,h=r(85),m=p?"_s":"size",g=function(e,t){var r,n=f(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,u){var l=e((function(e,n){s(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,null!=n&&c(n,r,e[u],e)}));return o(l.prototype,{clear:function(){for(var e=h(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var r=h(this,t),n=g(r,e);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[m]--}return!!n},forEach:function(e){h(this,t);for(var r,n=a(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!g(h(this,t),e)}}),p&&n(l.prototype,"size",{get:function(){return h(this,t)[m]}}),l},def:function(e,t,r){var n,i,o=g(e,t);return o?o.v=r:(e._l=o={i:i=f(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[m]++,"F"!==i&&(e._i[i]=o)),e},getEntry:g,setStrong:function(e,t,r){u(e,t,(function(e,r){this._t=h(e,t),this._k=r,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),r?"entries":"values",!r,!0),d(t)}}},function(e,t,r){var n=r(12),i=r(8),o=r(82),a=r(28),s=r(27),c=r(93),u=r(51),l=r(92),d=r(15),p=r(50),f=r(16).f,h=r(173)(0),m=r(17);e.exports=function(e,t,r,g,v,y){var b=n[e],S=b,_=v?"set":"add",M=S&&S.prototype,T={};return m&&"function"==typeof S&&(y||M.forEach&&!a((function(){(new S).entries().next()})))?(S=t((function(t,r){l(t,S,e,"_c"),t._c=new b,null!=r&&u(r,v,t[_],t)})),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in M)||y&&"clear"==e||s(S.prototype,e,(function(r,n){if(l(this,S,e),!t&&y&&!d(r))return"get"==e&&void 0;var i=this._c[e](0===r?0:r,n);return t?this:i}))})),y||f(S.prototype,"size",{get:function(){return this._c.size}})):(S=g.getConstructor(t,e,v,_),c(S.prototype,r),o.NEED=!0),p(S,e),T[e]=S,i(i.G+i.W+i.F,T),y||g.setStrong(S,e,v),S}},function(e,t,r){var n=r(72),i=r(177);e.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,r){var n=r(8);e.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,r){var n=r(8),i=r(58),o=r(26),a=r(51);e.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,s,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),null==e?new this:(r=[],t?(n=0,s=o(c,arguments[2],2),a(e,!1,(function(e){r.push(s(e,n++))}))):a(e,!1,r.push,r),new this(r))}})}},function(e,t,r){e.exports={default:r(182),__esModule:!0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){var n=r(16),i=r(23),o=r(46);e.exports=r(17)?Object.defineProperties:function(e,t){i(e);for(var r,a=o(t),s=a.length,c=0;s>c;)n.f(e,r=a[c++],t[r]);return e}},function(e,t,r){var n=r(12).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(12),i=r(33),o=r(17),a=r(8),s=r(108),c=r(82).KEY,u=r(28),l=r(79),d=r(50),p=r(60),f=r(11),h=r(64),m=r(83),g=r(158),v=r(110),y=r(23),b=r(15),S=r(34),_=r(30),M=r(74),T=r(45),w=r(62),x=r(159),I=r(71),E=r(63),A=r(16),C=r(46),k=I.f,O=A.f,N=x.f,R=n.Symbol,P=n.JSON,D=P&&P.stringify,j=f("_hidden"),L=f("toPrimitive"),z={}.propertyIsEnumerable,U=l("symbol-registry"),B=l("symbols"),F=l("op-symbols"),V=Object.prototype,H="function"==typeof R&&!!E.f,$=n.QObject,W=!$||!$.prototype||!$.prototype.findChild,Y=o&&u((function(){return 7!=w(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=k(V,t);n&&delete V[t],O(e,t,r),n&&e!==V&&O(V,t,n)}:O,G=function(e){var t=B[e]=w(R.prototype);return t._k=e,t},Q=H&&"symbol"==typeof R.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof R},q=function(e,t,r){return e===V&&q(F,t,r),y(e),t=M(t,!0),y(r),i(B,t)?(r.enumerable?(i(e,j)&&e[j][t]&&(e[j][t]=!1),r=w(r,{enumerable:T(0,!1)})):(i(e,j)||O(e,j,T(1,{})),e[j][t]=!0),Y(e,t,r)):O(e,t,r)},J=function(e,t){y(e);for(var r,n=g(t=_(t)),i=0,o=n.length;o>i;)q(e,r=n[i++],t[r]);return e},Z=function(e){var t=z.call(this,e=M(e,!0));return!(this===V&&i(B,e)&&!i(F,e))&&(!(t||!i(this,e)||!i(B,e)||i(this,j)&&this[j][e])||t)},K=function(e,t){if(e=_(e),t=M(t,!0),e!==V||!i(B,t)||i(F,t)){var r=k(e,t);return!r||!i(B,t)||i(e,j)&&e[j][t]||(r.enumerable=!0),r}},X=function(e){for(var t,r=N(_(e)),n=[],o=0;r.length>o;)i(B,t=r[o++])||t==j||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===V,n=N(r?F:_(e)),o=[],a=0;n.length>a;)!i(B,t=n[a++])||r&&!i(V,t)||o.push(B[t]);return o};H||(s((R=function(){if(this instanceof R)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===V&&t.call(F,r),i(this,j)&&i(this[j],e)&&(this[j][e]=!1),Y(this,e,T(1,r))};return o&&W&&Y(V,e,{configurable:!0,set:t}),G(e)}).prototype,"toString",(function(){return this._k})),I.f=K,A.f=q,r(91).f=x.f=X,r(61).f=Z,E.f=ee,o&&!r(49)&&s(V,"propertyIsEnumerable",Z,!0),h.f=function(e){return G(f(e))}),a(a.G+a.W+a.F*!H,{Symbol:R});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)f(te[re++]);for(var ne=C(f.store),ie=0;ne.length>ie;)m(ne[ie++]);a(a.S+a.F*!H,"Symbol",{for:function(e){return i(U,e+="")?U[e]:U[e]=R(e)},keyFor:function(e){if(!Q(e))throw TypeError(e+" is not a symbol!");for(var t in U)if(U[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),a(a.S+a.F*!H,"Object",{create:function(e,t){return void 0===t?w(e):J(w(e),t)},defineProperty:q,defineProperties:J,getOwnPropertyDescriptor:K,getOwnPropertyNames:X,getOwnPropertySymbols:ee});var oe=u((function(){E.f(1)}));a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return E.f(S(e))}}),P&&a(a.S+a.F*(!H||u((function(){var e=R();return"[null]"!=D([e])||"{}"!=D({a:e})||"{}"!=D(Object(e))}))),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(b(t)||void 0!==e)&&!Q(e))return v(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Q(t))return t}),n[1]=t,D.apply(P,n)}}),R.prototype[L]||r(27)(R.prototype,L,R.prototype.valueOf),d(R,"Symbol"),d(Math,"Math",!0),d(n.JSON,"JSON",!0)},,function(e,t,r){var n=r(12),i=r(6),o=r(16),a=r(17),s=r(11)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];a&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(11)("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:r=!0}},o[n]=function(){return a},e(o)}catch(e){}return r}},function(e,t,r){var n=r(16),i=r(45);e.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},function(e,t,r){e.exports={default:r(188),__esModule:!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformArray=["android","ios","pc","mac","pad","web"],t.TouchPlatformArray=["android","ios","pad"];var n=t.PluginType=void 0;!function(e){e[e.OneMotion=0]="OneMotion"}(n||(t.PluginType=n={}))},,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"subMany",value:function(e){for(var t in e)this.on(t,e[t])}},{key:"destroy",value:function(){var e=this;this.eventNames().forEach((function(t){e.removeAllListeners(t)}))}}]),t}(c(r(39)).default);t.default=u},,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(19)),i=s(r(14)),o=s(r(5)),a=s(r(20));function s(e){return e&&e.__esModule?e:{default:e}}t.default={isUndefined:function(e){return void 0===e},isDOM:function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":(0,a.default)(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":(0,a.default)(e))&&1===e.nodeType&&"string"==typeof e.nodeName},isValidString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isFunction:function(e){return"function"==typeof e},isNumber:function(e){return"number"==typeof e},isValidArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isValidHexColor:function(e){return/^#[0-9abcdef]{6}$/gi.test(e)},isObject:function(e){return"object"===(void 0===e?"undefined":(0,a.default)(e))},isValidObject:function(e){if("object"!==(void 0===e?"undefined":(0,a.default)(e)))return!1;if(e=(0,o.default)({},e),i.default&&0===(0,i.default)(e).length)return!1;try{return"{}"!==(0,n.default)(e)}catch(e){return!1}},validate:function(e,t,r,o){var a=this,s=[];return(0,i.default)(o).map((function(e){var t=o[e],i=r[e];if(a.isUndefined(i))t.isRequire&&s.push({key:e,message:e+" is required"});else{switch(t.type.toLowerCase()){case"dom":a.isDOM(i)||s.push({key:e,message:"Expected dom, but get other type"});break;case"string":a.isValidString(i)||s.push({key:e,message:"Expected string, but get other type"});break;case"boolean":a.isBoolean(i)||s.push({key:e,message:"Expected boolean, but get other type"});break;case"function":a.isFunction(i)||s.push({key:e,message:"Expected function, but get other type"});break;case"number":a.isNumber(i)||s.push({key:e,message:"Expected number, but get other type"});break;case"object":a.isObject(i)||s.push({key:e,message:"Expected object, but get other type"});break;case"array":a.isValidArray(i)||s.push({key:e,message:"Expected array, but get other type"});break;default:s.push({key:e,message:e+"的类型未知: "+t.type.toLowerCase()})}t.enum&&-1===t.enum.indexOf(i)&&s.push({key:e,message:"Expected "+e+" to be one of "+(0,n.default)(t.enum)+", but it is not"})}})),s.length>0&&(e.error("[白板]",t+"参数异常"),e.error("[白板]","错误信息：",s),e.error("[白板]","参数为：",r)),0===s.length}}},,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(5)),i=d(r(2)),o=d(r(0)),a=d(r(1)),s=d(r(3)),c=d(r(4)),u=r(7),l=d(u);function d(e){return e&&e.__esModule?e:{default:e}}r(465);var p=function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props,t=e.width,r=e.baseItemPosition,i=e.baseItemShift,o=e.baseItemWidth,a=e.store,s={width:t};return"bottomRight"===r||"topRight"===r?t/2>i?(0,n.default)(s,{left:"unset",right:o/2-i,transform:"unset"}):t/2>a.width-i&&(0,n.default)(s,{right:"unset",left:i-a.width+o/2,transform:"unset"}):"bottomLeft"!==r&&"topLeft"!==r||(t/2>i?(0,n.default)(s,{right:"unset",left:o/2-i,transform:"unset"}):t/2>a.width-i&&(0,n.default)(s,{left:"unset",right:i-a.width+o/2,transform:"unset"})),Array.isArray(this.props.sections)?l.default.createElement("div",{className:"tc-popup",onClick:this.handleClick,style:s},this.props.sections.map((function(e,t){return l.default.createElement("div",{className:"tc-popup-section",key:t},e)}))):l.default.createElement("div",{className:"tc-popup tc-popup-left-right",onClick:this.handleClick,style:s},l.default.createElement("div",{className:"tc-popup-left"},this.props.leftSections.map((function(e,t){return l.default.createElement("div",{className:"tc-popup-section",key:t},e)}))),l.default.createElement("div",{className:"tc-popup-right"},this.props.rightSections.map((function(e,t){return l.default.createElement("div",{className:"tc-popup-section",key:t},e)}))))}},{key:"handleClick",value:function(e){e.stopPropagation(),e.preventDefault()}}]),t}(u.Component);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.on=function(e,t,r){e.addEventListener(t,r)},t.off=function(e,t,r){e.removeEventListener(t,r)}},,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=t.defaultPenSubItems=[{tool:"pen",hint:"曲线"},{tool:"line",hint:"直线"},{tool:"pen-arrow",hint:"曲线箭头"},{tool:"line-arrow",hint:"直线箭头"}],i=t.defaultShapeSubItems=[{tool:"rect",hint:"空心矩形"},{tool:"rect-fill",hint:"实心矩形"},{tool:"ellipse",hint:"空心椭圆"},{tool:"ellipse-fill",hint:"实心椭圆"}],o=(t.getDefaultMargin=function(){return{left:{marginLeft:16},leftTop:{marginLeft:16,marginTop:16},leftBottom:{marginLeft:16,marginBottom:16},right:{marginRight:16},rightTop:{marginRight:16,marginTop:16},rightBottom:{marginRight:16,marginBottom:16},top:{marginTop:16},topLeft:{marginTop:16,marginLeft:16},topRight:{marginTop:16,marginRight:16},bottom:{marginBottom:16},bottomLeft:{marginBottom:16,marginLeft:16},bottomRight:{marginBottom:16,marginRight:16}}},t.DEFAULT_COLORS=["rgb(0,0,0)","rgb(255,255,255)","rgb(224,32,32)","rgb(250,100,0)","rgb(247,181,0)","rgb(109,212,0)","rgb(68,215,182)","rgb(50,197,255)","rgb(0,145,255)","rgb(98,54,255)","rgb(182,32,224)","rgb(109,114,120)"],t.DEFAULT_COLORS2=[{color:"rgb(0,0,0)"},{color:"rgb(255,255,255)",border:"rgb(217,217,219)"},{color:"rgb(224,32,32)"},{color:"rgb(250,100,0)"},{color:"rgb(247,181,0)"},{color:"rgb(109,212,0)"},{color:"rgb(68,215,182)"},{color:"rgb(50,197,255)"},{color:"rgb(0,145,255)"},{color:"rgb(98,54,255)"},{color:"rgb(182,32,224)"},{color:"rgb(109,114,120)"}],t.getDefaultContainerOptionsByPlatform=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"web"===e||"mac"===e||"pc"===e?o(t):a(t)},function(e){var t=e?[{tool:"uploadLog",hint:"上传日志"}]:[];return[{position:"left",items:[{tool:"select",hint:"选择"},{tool:"shapeSelect",hint:"选择图形",subItems:[].concat(n,i)},{tool:"platte",hint:"调色盘"},{tool:"widthResize",hint:"画笔粗细"},{tool:"opacity",hint:"透明度"},{tool:"text",hint:"文本"},{tool:"laser",hint:"激光笔"},{tool:"element-eraser",hint:"橡皮擦"},{tool:"duplicate",hint:"复制"},{tool:"clear",hint:"清空"},{tool:"undo",hint:"撤销"},{tool:"redo",hint:"重做"},{tool:"pan",hint:"整体平移"},{tool:"image",hint:"图片上传"},{tool:"exportImage",hint:"导出图片"}].concat(t)},{position:"bottomLeft",items:[{tool:"fitToContentDoc"},{tool:"zoomOut",hint:"缩小"},{tool:"zoomLevel"},{tool:"zoomIn",hint:"放大"},{tool:"visionControl",hint:"视角同步"},{tool:"visionLock",hint:"视角模式切换"}]},{position:"bottomRight",items:[{tool:"firstPage",hint:"第一页"},{tool:"prevPage",hint:"上一页"},{tool:"pageInfo"},{tool:"nextPage",hint:"下一页"},{tool:"lastPage",hint:"最后一页"},{tool:"preview",hint:"预览",previewSliderPosition:"right"}]},{position:"topRight",items:[{tool:"docSelect"},{tool:"docUpload",hint:"上传文档",supportPptToH5:!0,supportDocToPic:!0}]}]}),a=function(e){var t=e?[{tool:"uploadLog",hint:"上传日志"}]:[];return[{position:"bottomRight",items:[{tool:"select",hint:"选择"},{tool:"shapeSelect",hint:"选择图形",subItems:[].concat(n,i)},{tool:"platte",hint:"调色盘"},{tool:"widthResize",hint:"画笔粗细"},{tool:"opacity",hint:"透明度"},{tool:"multiInOne",hint:"更多",subItems:[{tool:"element-eraser"},{tool:"clear"},{tool:"undo"},{tool:"redo"},{tool:"image"},{tool:"exportImage"}]}]},{position:"topRight",items:[{tool:"multiInOne",hint:"更多",subItems:[{tool:"docUpload",supportPptToH5:!0,supportDocToPic:!0},{tool:"fitToContent"},{tool:"fitToDoc"},{tool:"pan"},{tool:"zoomIn"},{tool:"zoomOut"},{tool:"visionControl"},{tool:"visionLock"}].concat(t)},{tool:"zoomLevel",size:2}]},{position:"topLeft",items:[{tool:"pageBoardInfo"},{tool:"preview",hint:"预览",previewSliderPosition:"right"}]}]}},,function(e,t,r){r(144),e.exports=r(6).Number.isInteger},function(e,t,r){var n=r(8);n(n.S,"Number",{isInteger:r(145)})},function(e,t,r){var n=r(15),i=Math.floor;e.exports=function(e){return!n(e)&&isFinite(e)&&i(e)===e}},function(e,t,r){r(147),e.exports=r(6).Object.assign},function(e,t,r){var n=r(8);n(n.S+n.F,"Object",{assign:r(148)})},function(e,t,r){var n=r(17),i=r(46),o=r(63),a=r(61),s=r(34),c=r(75),u=Object.assign;e.exports=!u||r(28)((function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=u({},e)[r]||Object.keys(u({},t)).join("")!=n}))?function(e,t){for(var r=s(e),u=arguments.length,l=1,d=o.f,p=a.f;u>l;)for(var f,h=c(arguments[l++]),m=d?i(h).concat(d(h)):i(h),g=m.length,v=0;g>v;)f=m[v++],n&&!p.call(h,f)||(r[f]=h[f]);return r}:u},function(e,t,r){var n=r(30),i=r(59),o=r(150);e.exports=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),l=o(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}}},function(e,t,r){var n=r(77),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},function(e,t,r){e.exports={default:r(152),__esModule:!0}},function(e,t,r){r(37),r(43),e.exports=r(64).f("iterator")},function(e,t,r){var n=r(77),i=r(76);e.exports=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},function(e,t,r){var n=r(62),i=r(45),o=r(50),a={};r(27)(a,r(11)("iterator"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n(a,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t,r){var n=r(156),i=r(109),o=r(40),a=r(30);e.exports=r(81)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t,r){r(122),r(66),r(160),r(161),e.exports=r(6).Symbol},function(e,t,r){var n=r(46),i=r(63),o=r(61);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var a,s=r(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,r){var n=r(30),i=r(91).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},function(e,t,r){r(83)("asyncIterator")},function(e,t,r){r(83)("observable")},,,,,function(e,t,r){var n=r(6),i=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,r){r(168);var n=r(6).Object;e.exports=function(e,t,r){return n.defineProperty(e,t,r)}},function(e,t,r){var n=r(8);n(n.S+n.F*!r(17),"Object",{defineProperty:r(16).f})},function(e,t,r){r(170),e.exports=r(6).Object.keys},function(e,t,r){var n=r(34),i=r(46);r(94)("keys",(function(){return function(e){return i(n(e))}}))},function(e,t,r){r(66),r(37),r(43),r(172),r(176),r(178),r(179),e.exports=r(6).Set},function(e,t,r){var n=r(113),i=r(85);e.exports=r(114)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},function(e,t,r){var n=r(26),i=r(75),o=r(34),a=r(59),s=r(174);e.exports=function(e,t){var r=1==e,c=2==e,u=3==e,l=4==e,d=6==e,p=5==e||d,f=t||s;return function(t,s,h){for(var m,g,v=o(t),y=i(v),b=n(s,h,3),S=a(y.length),_=0,M=r?f(t,S):c?f(t,0):void 0;S>_;_++)if((p||_ in y)&&(g=b(m=y[_],_,v),e))if(r)M[_]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return _;case 2:M.push(m)}else if(l)return!1;return d?-1:u||l?l:M}}},function(e,t,r){var n=r(175);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(15),i=r(110),o=r(11)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(8);n(n.P+n.R,"Set",{toJSON:r(115)("Set")})},function(e,t,r){var n=r(51);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},function(e,t,r){r(116)("Set")},function(e,t,r){r(117)("Set")},function(e,t,r){r(43),r(37),e.exports=r(181)},function(e,t,r){var n=r(23),i=r(84);e.exports=r(6).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},function(e,t,r){r(37),r(183),e.exports=r(6).Array.from},function(e,t,r){var n=r(26),i=r(8),o=r(34),a=r(111),s=r(112),c=r(59),u=r(126),l=r(84);i(i.S+i.F*!r(125)((function(e){Array.from(e)})),"Array",{from:function(e){var t,r,i,d,p=o(e),f="function"==typeof this?this:Array,h=arguments.length,m=h>1?arguments[1]:void 0,g=void 0!==m,v=0,y=l(p);if(g&&(m=n(m,h>2?arguments[2]:void 0,2)),null==y||f==Array&&s(y))for(r=new f(t=c(p.length));t>v;v++)u(r,v,g?m(p[v],v):p[v]);else for(d=y.call(p),r=new f;!(i=d.next()).done;v++)u(r,v,g?a(d,m,[i.value,v],!0):i.value);return r.length=v,r}})},,,function(e,t,r){r(187),e.exports=r(6).Object.getPrototypeOf},function(e,t,r){var n=r(34),i=r(90);r(94)("getPrototypeOf",(function(){return function(e){return i(n(e))}}))},function(e,t,r){r(189),e.exports=r(6).Object.setPrototypeOf},function(e,t,r){var n=r(8);n(n.S,"Object",{setPrototypeOf:r(190).set})},function(e,t,r){var n=r(15),i=r(23),o=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=r(26)(Function.call,r(71).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return o(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:o}},function(e,t,r){r(192);var n=r(6).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){var n=r(8);n(n.S,"Object",{create:r(62)})},function(e,t,r){r(66),r(37),r(43),r(194),r(195),r(196),r(197),e.exports=r(6).Map},function(e,t,r){var n=r(113),i=r(85);e.exports=r(114)("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},function(e,t,r){var n=r(8);n(n.P+n.R,"Map",{toJSON:r(115)("Map")})},function(e,t,r){r(116)("Map")},function(e,t,r){r(117)("Map")},,,,,,,,function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,o=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?r+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(0)),i=a(r(1)),o=a(r(207));function a(e){return e&&e.__esModule?e:{default:e}}var s=void 0,c=function(){function e(){(0,n.default)(this,e)}return(0,i.default)(e,null,[{key:"createInstance",value:function(){return this._instance=this._instance||new o.default,this._instance}},{key:"show",value:function(e){var t=this,r=e.time,n=void 0===r?3:r;this._instance||this.createInstance(),this._instance.show(e),s&&clearTimeout(s),n&&(s=setTimeout((function(){t.hide()}),1e3*n))}},{key:"hide",value:function(){s&&clearTimeout(s),this._instance&&this._instance.hide()}},{key:"destory",value:function(){this._instance&&(this._instance.destroy(),this._instance=null)}}]),e}();t.default=c,c._instance=null},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(70)),i=a(r(0)),o=a(r(1));function a(e){return e&&e.__esModule?e:{default:e}}r(208);var s=function(){function e(){(0,i.default)(this,e),this.toastDiv=document.createElement("div"),this.toastDiv.className="whiteboard-toast",this.toastDiv.onclick=this.hide.bind(this),document.body.appendChild(this.toastDiv)}return(0,o.default)(e,[{key:"show",value:function(e){var t=this.toastDiv;t.style.display="block","warn"===e.type?(t.style.color="#8a6d3b",t.style.backgroundColor="#fcf8e3",t.style.borderColor="#faebcc"):"info"===e.type?(t.style.color="#31708f",t.style.backgroundColor="#d9edf7",t.style.borderColor="#bce8f1"):"error"===e.type?(t.style.color="#a94442",t.style.backgroundColor="#f2dede",t.style.borderColor="#ebccd1"):(t.style.color="#3c763d",t.style.backgroundColor="#dff0d8",t.style.borderColor="#d6e9c6"),(0,n.default)(e.top)&&(t.style.top=e.top+"px"),t.innerHTML=e.msg}},{key:"hide",value:function(){this.toastDiv&&(this.toastDiv.style.display="none")}},{key:"destroy",value:function(){this.toastDiv&&(document.body.removeChild(this.toastDiv),this.toastDiv=null)}}]),e}();t.default=s},function(e,t,r){var n=r(209);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".whiteboard-toast {\n    display: none;\n    position: fixed;\n    left: 50%;\n    transform: translate(-50%);\n    top: 200px;\n    padding: 8px 15px;\n    margin-bottom: 20px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    color: #3c763d;\n    background-color: #dff0d8;\n    border-color: #d6e9c6;\n    z-index: 100;\n}",""])},,,,,,,,,,,function(e,t,r){t.__esModule=!0;var n,i=(n=r(47))&&n.__esModule?n:{default:n};t.default=function(e,t,r){return t in e?(0,i.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},,,,,,,,,,,,,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=r(7),u=d(c),l=d(r(244));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.handleClick=function(t){t.stopPropagation(),t.preventDefault(),e.props.store.popup=void 0,e.props.onClick?e.props.onClick(t):e.props.store.updateSelectedTool(e.props.option.tool)},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this.props,t=e.store,r=e.unavailable,n=e.containerPosition,i=e.itemSizeBase,o=e.hideHint,a=this.props.option,s=t.tool===a.tool,c="tc-unit tc-unit-"+a.tool+" tc-state-unit-"+a.tool+"-"+this.props.state+(a.class?" "+a.class:"")+(s?" selected":"")+(r?" unavailable":""),d={width:i,height:i};a.backgroundImageByState&&a.backgroundImageByState[this.props.state]&&(d.backgroundImage="url("+a.backgroundImageByState[this.props.state]+")");var p=u.default.createElement("div",{className:c,style:d,onClick:this.handleClick},this.props.children);return a.hint&&!o?u.default.createElement(l.default,{width:i,height:i,hint:a.hint,containerPosition:n},p):p}}]),t}(c.Component);t.default=p},,,,,,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}r(467);var d=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.resizeInputRef=(0,c.createRef)(),e.state={rangeWidth:186},e._calcRangeSize=function(){if(e.resizeInputRef.current){var t=e.resizeInputRef.current.getBoundingClientRect();e.setState({rangeWidth:t.width})}else e.setState({rangeWidth:186})},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this._calcRangeSize),window.addEventListener("orientationchange",this._calcRangeSize),this._calcRangeSize()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._calcRangeSize),window.removeEventListener("orientationchange",this._calcRangeSize)}},{key:"render",value:function(){var e=this,t=this.props,r=t.width,n=t.min,i=t.max,o=t.step,a=t.leftText,s=t.rightText;i=i||30,o=o||1,a=a||"细",s=s||"粗";var c=(r-(n=n||1))*(this.state.rangeWidth-15)/(i-n);return u.default.createElement("div",{className:"tc-resize-container"},u.default.createElement("div",{className:"tc-resize-input",ref:this.resizeInputRef},u.default.createElement("input",{type:"range",min:n,max:i,value:r,step:o,onInput:function(t){return e.props.onWidthChange(t)}}),u.default.createElement("div",{className:"left-bg",style:{width:c}})),u.default.createElement("div",{className:"tc-resize-text"},u.default.createElement("span",{className:"tc-resize-thin"},a),u.default.createElement("span",{className:"tc-resize-thick"},s)))}}]),t}(c.Component);t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}r(469);var d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e={width:this.props.width?this.props.width:"100%",height:this.props.height?this.props.height:"100%"};return u.default.createElement("div",{className:"tc-hint-wrapper",style:e},this.props.children,u.default.createElement("div",{className:"tc-hint "+this.getHintPosition()},u.default.createElement("span",{className:"tc-hint-text"},this.props.hint)))}},{key:"getHintPosition",value:function(){var e=this.props.containerPosition;return e.startsWith("left")?"right":e.startsWith("top")?"bottom":e.startsWith("right")?"left":"top"}}]),t}(c.Component);t.default=d},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.fileTypeMap=t.unserializefileTypeMap=t.serializefileTypeMap=t.FileStateToText=t.FileState=void 0;var n,i,o=(n=r(220))&&n.__esModule?n:{default:n},a=t.FileState=void 0;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.TRANS_IN_PROGRESS=2]="TRANS_IN_PROGRESS",e[e.TRANS_COMPLETE=4]="TRANS_COMPLETE",e[e.TRANS_FAIL=5]="TRANS_FAIL",e[e.UPLOAD_IN_PROGRESS=11]="UPLOAD_IN_PROGRESS",e[e.UPLOAD_COMPLETE=12]="UPLOAD_COMPLETE",e[e.UPLOAD_FAIL=13]="UPLOAD_FAIL"}(a||(t.FileState=a={})),t.FileStateToText=(i={},(0,o.default)(i,a.UNKNOWN,"状态未知"),(0,o.default)(i,a.TRANS_IN_PROGRESS,"转码中"),(0,o.default)(i,a.TRANS_COMPLETE,"转码成功"),(0,o.default)(i,a.TRANS_FAIL,"转码失败"),(0,o.default)(i,a.UPLOAD_IN_PROGRESS,"上传中"),(0,o.default)(i,a.UPLOAD_COMPLETE,"上传成功"),(0,o.default)(i,a.UPLOAD_FAIL,"上传失败"),i),t.serializefileTypeMap={1:"ppt",2:"pptx",3:"pdf",6:"doc",7:"docx"},t.unserializefileTypeMap={ppt:1,pptx:2,pdf:3,doc:6,docx:7},t.fileTypeMap={10:"jpg",11:"png",0:"unknown"}},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEzIDEzQzE1LjE0MjkgMTMgMTguODkyOSAxMyAxOS40Mjg2IDE1LjY3ODZDMTkuOTUzOSAxOC4zMDUxIDEyLjE3NzQgMjMuNTU3NCAxNC4wNzE0IDIzLjE3ODZDMTYuNzUgMjIuNjQyOSAyMi42NDI5IDIxLjU3MTQgMjggMjgiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMS4yIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTMiIHk9IjEzIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHJ4PSIxIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIvPgo8L3N2Zz4K"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}r(495);var d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this;return this.props.showAlert?u.default.createElement("div",null,u.default.createElement("div",{className:"whiteboard-alert-mask"}),u.default.createElement("div",{className:"whiteboard-alert"},u.default.createElement("div",{className:"alert-body"},u.default.createElement("span",{className:"u-icon-tip"}),this.props.alertText),u.default.createElement("div",{className:"alert-button-group"},u.default.createElement("div",{className:"alert-cancel btn",onClick:function(){return e.props.onHide()}},"取消"),u.default.createElement("div",{className:"alert-confirm btn",onClick:function(){return e.props.onConfirm()}},"确定")))):null}}]),t}(c.Component);t.default=d},,,,,,,,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getComponentByToolName=void 0;var n=W(r(462)),i=W(r(473)),o=W(r(474)),a=W(r(475)),s=W(r(476)),c=W(r(22)),u=W(r(477)),l=W(r(478)),d=W(r(479)),p=W(r(480)),f=W(r(481)),h=W(r(482)),m=W(r(483)),g=W(r(486)),v=W(r(487)),y=W(r(488)),b=W(r(489)),S=W(r(490)),_=W(r(491)),M=W(r(492)),T=W(r(493)),w=W(r(494)),x=W(r(500)),I=W(r(503)),E=W(r(504)),A=W(r(505)),C=W(r(506)),k=W(r(507)),O=W(r(508)),N=W(r(509)),R=W(r(512)),P=W(r(513)),D=W(r(517)),j=W(r(518)),L=W(r(519)),z=W(r(523)),U=W(r(524)),B=W(r(525)),F=W(r(526)),V=W(r(527)),H=W(r(528)),$=W(r(530));function W(e){return e&&e.__esModule?e:{default:e}}t.getComponentByToolName=function(e){switch(e){case"pen":return n.default;case"shape":return u.default;case"undo":return i.default;case"redo":return o.default;case"clear":return a.default;case"duplicate":return s.default;case"reset":return l.default;case"fitToContentDoc":return C.default;case"fitToContent":return k.default;case"fitToDoc":return O.default;case"zoomIn":return d.default;case"zoomOut":return p.default;case"zoomLevel":return f.default;case"firstPage":return h.default;case"lastPage":return g.default;case"prevPage":return v.default;case"nextPage":return y.default;case"pageInfo":return m.default;case"preview":return b.default;case"image":return S.default;case"video":return z.default;case"audio":return U.default;case"docUpload":return T.default;case"docSelect":return w.default;case"pageBoardInfo":return x.default;case"visionControl":return I.default;case"visionLock":return E.default;case"exportImage":return A.default;case"multiInOne":return N.default;case"uploadLog":return R.default;case"platte":return P.default;case"widthResize":return D.default;case"opacity":return j.default;case"shapeSelect":return L.default;case"nextAnim":return B.default;case"prevAnim":return F.default;case"bgGridDotW":return V.default;case"bgGridLineW":return H.default;case"bgGridLineC":return $.default;default:return e.startsWith("custom-state-")?M.default:e.startsWith("custom-")?_.default:c.default}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=r(7),u=d(c),l=r(141);function d(e){return e&&e.__esModule?e:{default:e}}r(463);var p=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.state={colorArray:l.DEFAULT_COLORS.slice()},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){this.setState({colorArray:this.getColorPlatte()}),this.updatePopupCellWH()}},{key:"componentDidUpdate",value:function(){this.updatePopupCellWH()}},{key:"render",value:function(){var e=this,t=this.state.colorArray,r=[0,1,2,3];return u.default.createElement("div",{className:"tc-color-platte",onClick:function(e){return e.stopPropagation()}},[0,1,2].map((function(n){return u.default.createElement("div",{className:"tc-color-row"},r.map((function(i){var o=n*r.length+i,a=t[o],s=e.props.color===a?"tc-color-cell-wrapper selected":"tc-color-cell-wrapper";return u.default.createElement("div",{className:s,onClick:function(t){t.stopPropagation(),e.props.onColorChange(a)}},u.default.createElement("div",{className:"tc-color-cell",style:{backgroundColor:a,border:"rgb(255,255,255)"===a?"1px solid #D9D9DB":"none"}}))})))})))}},{key:"getColorPlatte",value:function(){return-1===l.DEFAULT_COLORS.indexOf(this.props.color)?l.DEFAULT_COLORS.slice(0,11).concat([this.props.color]):l.DEFAULT_COLORS}},{key:"updatePopupCellWH",value:function(){for(var e=document.getElementsByClassName("tc-color-cell-wrapper"),t=0;t<e.length;t++){var r=e[t],n=Math.min(r.clientHeight,r.clientWidth);r.style.width=n+"px",r.style.height=n+"px"}}}]),t}(c.Component);t.default=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=r(7),u=d(c),l=d(r(244));function d(e){return e&&e.__esModule?e:{default:e}}r(471);var p=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){this.updatePopupCellWH()}},{key:"componentDidUpdate",value:function(){this.updatePopupCellWH()}},{key:"render",value:function(){var e=this;return u.default.createElement("div",{className:"tc-tool-select-container",onClick:function(e){return e.stopPropagation()}},this.props.toolArray.map((function(t){var r=t.backgroundImage?{backgroundImage:"url("+t.backgroundImage+")"}:{},n=u.default.createElement("div",{className:"tc-tool-select-cell-wrapper "+(e.props.selectedTool===t.tool?"selected":""),onClick:function(r){r.stopPropagation(),e.props.onClick(t.tool)}},u.default.createElement("div",{className:"tc-tool-select-cell tc-pen-popup tc-unit-"+t.tool,style:r}));return t.hint?u.default.createElement(l.default,{hint:t.hint,containerPosition:"bottom"},n):n})))}},{key:"updatePopupCellWH",value:function(){for(var e=document.getElementsByClassName("tc-tool-select-cell-wrapper"),t=1e4,r=0;r<e.length;r++){var n=e[r];t=Math.min(t,n.clientWidth),t=Math.min(t,n.clientHeight)}for(var i=0;i<e.length;i++){var o=e[i];o.style.width=t+"px",o.style.height=t+"px"}}}]),t}(c.Component);t.default=p},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjQgNCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEzIDEzTDI3IDI3IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjQgNCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE0LjM1MzYgMTMuNjQ2NEMxNC4xNTgzIDEzLjQ1MTIgMTMuODQxNyAxMy40NTEyIDEzLjY0NjQgMTMuNjQ2NEwxMC40NjQ1IDE2LjgyODRDMTAuMjY5MiAxNy4wMjM3IDEwLjI2OTIgMTcuMzQwMyAxMC40NjQ1IDE3LjUzNTVDMTAuNjU5NyAxNy43MzA4IDEwLjk3NjMgMTcuNzMwOCAxMS4xNzE2IDE3LjUzNTVMMTQgMTQuNzA3MUwxNi44Mjg0IDE3LjUzNTVDMTcuMDIzNyAxNy43MzA4IDE3LjM0MDMgMTcuNzMwOCAxNy41MzU1IDE3LjUzNTVDMTcuNzMwOCAxNy4zNDAzIDE3LjczMDggMTcuMDIzNyAxNy41MzU1IDE2LjgyODRMMTQuMzUzNiAxMy42NDY0Wk0yNS42NDY0IDI2LjM1MzZDMjUuODQxNyAyNi41NDg4IDI2LjE1ODMgMjYuNTQ4OCAyNi4zNTM2IDI2LjM1MzZMMjkuNTM1NSAyMy4xNzE2QzI5LjczMDggMjIuOTc2MyAyOS43MzA4IDIyLjY1OTcgMjkuNTM1NSAyMi40NjQ1QzI5LjM0MDMgMjIuMjY5MiAyOS4wMjM3IDIyLjI2OTIgMjguODI4NCAyMi40NjQ1TDI2IDI1LjI5MjlMMjMuMTcxNiAyMi40NjQ1QzIyLjk3NjMgMjIuMjY5MiAyMi42NTk3IDIyLjI2OTIgMjIuNDY0NSAyMi40NjQ1QzIyLjI2OTIgMjIuNjU5NyAyMi4yNjkyIDIyLjk3NjMgMjIuNDY0NSAyMy4xNzE2TDI1LjY0NjQgMjYuMzUzNlpNMTMuNSAxNFYyM0gxNC41VjE0SDEzLjVaTTIwLjUgMjNWMTdIMTkuNVYyM0gyMC41Wk0yNS41IDE3VjI2SDI2LjVWMTdIMjUuNVpNMjMgMTQuNUMyNC4zODA3IDE0LjUgMjUuNSAxNS42MTkzIDI1LjUgMTdIMjYuNUMyNi41IDE1LjA2NyAyNC45MzMgMTMuNSAyMyAxMy41VjE0LjVaTTIwLjUgMTdDMjAuNSAxNS42MTkzIDIxLjYxOTMgMTQuNSAyMyAxNC41VjEzLjVDMjEuMDY3IDEzLjUgMTkuNSAxNS4wNjcgMTkuNSAxN0gyMC41Wk0xNyAyNi41QzE4LjkzMyAyNi41IDIwLjUgMjQuOTMzIDIwLjUgMjNIMTkuNUMxOS41IDI0LjM4MDcgMTguMzgwNyAyNS41IDE3IDI1LjVWMjYuNVpNMTMuNSAyM0MxMy41IDI0LjkzMyAxNS4wNjcgMjYuNSAxNyAyNi41VjI1LjVDMTUuNjE5MyAyNS41IDE0LjUgMjQuMzgwNyAxNC41IDIzSDEzLjVaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjQgNCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEzIDEyLjRDMTIuNjY4NiAxMi40IDEyLjQgMTIuNjY4NiAxMi40IDEzVjE4LjRDMTIuNCAxOC43MzE0IDEyLjY2ODYgMTkgMTMgMTlDMTMuMzMxNCAxOSAxMy42IDE4LjczMTQgMTMuNiAxOC40VjEzLjZIMTguNEMxOC43MzE0IDEzLjYgMTkgMTMuMzMxNCAxOSAxM0MxOSAxMi42Njg2IDE4LjczMTQgMTIuNCAxOC40IDEyLjRIMTNaTTI2LjU3NTcgMjcuNDI0M0MyNi44MTAxIDI3LjY1ODYgMjcuMTg5OSAyNy42NTg2IDI3LjQyNDMgMjcuNDI0M0MyNy42NTg2IDI3LjE4OTkgMjcuNjU4NiAyNi44MTAxIDI3LjQyNDMgMjYuNTc1N0wyNi41NzU3IDI3LjQyNDNaTTEyLjU3NTcgMTMuNDI0M0wyNi41NzU3IDI3LjQyNDNMMjcuNDI0MyAyNi41NzU3TDEzLjQyNDMgMTIuNTc1N0wxMi41NzU3IDEzLjQyNDNaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjQgNCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iOCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjQgNCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTMiIHk9IjEzIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHJ4PSIxIiBmaWxsPSIjQkZCRkJGIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjQgNCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iOCIgZmlsbD0iI0JGQkZCRiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDE1SDI4IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik0xNiAxMkgyNCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8cGF0aCBkPSJNMTQgMTVWMjdDMTQgMjcuNTUyMyAxNC40NDc3IDI4IDE1IDI4SDI1QzI1LjU1MjMgMjggMjYgMjcuNTUyMyAyNiAyN1YxNSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTE4LjYgMThDMTguNiAxNy42Njg2IDE4LjMzMTQgMTcuNCAxOCAxNy40QzE3LjY2ODYgMTcuNCAxNy40IDE3LjY2ODYgMTcuNCAxOEgxOC42Wk0xNy40IDI1QzE3LjQgMjUuMzMxNCAxNy42Njg2IDI1LjYgMTggMjUuNkMxOC4zMzE0IDI1LjYgMTguNiAyNS4zMzE0IDE4LjYgMjVIMTcuNFpNMTcuNCAxOFYyNUgxOC42VjE4SDE3LjRaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMjIuNiAxOEMyMi42IDE3LjY2ODYgMjIuMzMxNCAxNy40IDIyIDE3LjRDMjEuNjY4NiAxNy40IDIxLjQgMTcuNjY4NiAyMS40IDE4SDIyLjZaTTIxLjQgMjVDMjEuNCAyNS4zMzE0IDIxLjY2ODYgMjUuNiAyMiAyNS42QzIyLjMzMTQgMjUuNiAyMi42IDI1LjMzMTQgMjIuNiAyNUgyMS40Wk0yMS40IDE4VjI1SDIyLjZWMThIMjEuNFoiIGZpbGw9ImJsYWNrIi8+Cjwvc3ZnPgo="},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){e.exports=r(454)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultContainerOptionsByPlatform=void 0;var n=s(r(5)),i=r(141),o=r(389),a=s(r(455));function s(e){return e&&e.__esModule?e:{default:e}}var c={getInstance:function(e){e.options.containerOptions||(e.options.containerOptions=(0,i.getDefaultContainerOptionsByPlatform)(e.options.platform,e.options.debug));var t=new a.default(e);return{show:function(){return t.show()},hide:function(){return t.hide()},destroy:function(){return t.destroy()},setVisibility:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.setVisibility(e)},setItemDefaultSize:function(e){return t.setItemDefaultSize(e)},setContainerOptions:function(e){return t.setContainerOptions(e)},addOrSetContainer:function(e){return t.addOrSetContainer(e)},addOrSetTool:function(e){return t.addOrSetTool(e)},removeTool:function(e){return t.removeTool(e)},addOrSetSubItem:function(e){return t.addOrSetSubItem(e)},removeSubItem:function(e){return t.removeSubItem(e)},setDefaultDocList:function(e){return t.setDefaultDocList(e)},deleteDoc:function(e){t.store.docStore.removeFileFromList(e)},addDoc:function(e){t.store.docStore.addFileIntoList((0,n.default)((0,n.default)({},e),{state:o.FileState.TRANS_COMPLETE,percent:0}))},on:function(e,r){t.store.on(e,r)},off:function(e,r){t.store.off(e,r)},addToolEventListener:function(e,t){console.error("toolCollection.addToolEventListener is deprecated. Please use toolCollection.on instead.")},removeToolEventListener:function(e,t){console.error("toolCollection.removeToolEventListener is deprecated. Please use toolCollection.off instead.")},addDocEventListener:function(e,t){console.error("toolCollection.addDocEventListener is deprecated. Please use toolCollection.on instead.")},removeDocEventListener:function(e,t){console.error("toolCollection.removeDocEventListener is deprecated. Please use toolCollection.off instead.")}}}};t.default=c,t.getDefaultContainerOptionsByPlatform=i.getDefaultContainerOptionsByPlatform},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(31)),i=m(r(41)),o=m(r(9)),a=m(r(0)),s=m(r(1)),c=r(7),u=m(c),l=r(128),d=m(r(134)),p=m(r(456)),f=m(r(459)),h=r(598);function m(e){return e&&e.__esModule?e:{default:e}}var g=function(){function e(t){var r=this;(0,a.default)(this,e),this.containerConstraint={leftContainerConstraint:{marginTotal:0,occupiedSizeTotal:0,unitSizeTotal:0},rightContainerConstraint:{marginTotal:0,occupiedSizeTotal:0,unitSizeTotal:0},topContainerConstraint:{marginTotal:0,occupiedSizeTotal:0,unitSizeTotal:0},bottomContainerConstraint:{marginTotal:0,occupiedSizeTotal:0,unitSizeTotal:0}},this.containerOptions=[],this.containerOptionsCount=0,this.isShowing=!1,this._render=function(){if(r.isShowing){var e=u.default.createElement(f.default,{store:r.store,platform:r.platform,containerConstraint:r.containerConstraint,containerOptions:r.containerOptions,containerOptionsCount:r.containerOptionsCount,class:r.class,container:r.container,itemDefaultSize:r.itemDefaultSize});return r.lastElement=(0,c.render)(e,r.container,r.lastElement),r.lastElement}},this.handler=t.handler,this.handler.setToolCollection(this),d.default.validate(this.logger,"ToolCollection.getInstance",t,{container:{type:"dom",isRequire:!0},handler:{type:"object",isRequire:!0},options:{type:"object",isRequire:!0}}),d.default.validate(this.logger,"ToolCollection.getInstance.options",t.options,{platform:{type:"string",isRequire:!0,enum:l.PlatformArray},class:{type:"string",isRequire:!1},containerOptions:{type:"array",isRequire:!1},itemDefaultSize:{type:"number",isRequire:!1}}),this.container=t.container,this.class=t.options.class,this.platform=t.options.platform,this.itemDefaultSize=t.options.itemDefaultSize||32,this.store=new p.default(t.handler,this._render,this.container),this.setContainerOptions(t.options.containerOptions)}return(0,s.default)(e,[{key:"setItemDefaultSize",value:function(e){this.itemDefaultSize=e||32,this._render()}},{key:"setContainerOptions",value:function(e){this.preprocessContainerOptions(e),this.containerOptions=e,this.containerOptionsCount=this.containerOptionsCount+1,this.containerConstraint=this._calcContainerSize(e),this.store.setContainerOptions(e),this.store.update()}},{key:"addOrSetContainer",value:function(e){var t=this.containerOptions||[];if(0===e.items.length){for(var r=t.length-1;r>=0;r--)if(t[r].position===e.position){t.splice(r,1);break}}else{for(var n=!1,i=0;i<t.length;i++)t[i].position===e.position&&(n=!0,t[i]=e);n||t.push(e)}this.setContainerOptions(t)}},{key:"addOrSetTool",value:function(e){this.logger.log("[白板] toolCollection.addOrSetTool","\nposition",e.position,"\nitem.tool",e.item.tool,"\ninsertAfterTool",e.insertAfterTool);var t=this.containerOptions,r=!1,n=!0,a=!1,s=void 0;try{for(var c,u=(0,o.default)(t);!(n=(c=u.next()).done);n=!0){var l=c.value;if(l.position===e.position){r=!0;for(var d=l.items,p=d.length-1;p>=0;p--)d[p].tool===e.item.tool&&d.splice(p,1);var f=0;if(e.insertAfterTool)for(var h=0;h<d.length;h++)if(d[h].tool===e.insertAfterTool){f=h+1;break}l.items=[].concat((0,i.default)(l.items.slice(0,f)),[e.item],(0,i.default)(l.items.slice(f)))}}}catch(e){a=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw s}}r||t.push({position:e.position,items:[e.item]}),this.setContainerOptions(t)}},{key:"removeTool",value:function(e){this.logger.log("[白板] toolCollection.removeTool","\nposition",e.position,"\nname",e.name);var t=this.containerOptions,r=void 0,n=!0,i=!1,a=void 0;try{for(var s,c=(0,o.default)(t);!(n=(s=c.next()).done);n=!0){var u=s.value;if(!e.position||u.position===e.position){for(var l=u.items,d=l.length-1;d>=0;d--)l[d].tool===e.name&&l.splice(d,1);0===l.length&&(r=u)}}}catch(e){i=!0,a=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw a}}if(r)for(var p=0;p<t.length;p++)t[p].position===r.position&&t.splice(p,1);this.setContainerOptions(t)}},{key:"addOrSetSubItem",value:function(e){this.logger.log("[白板] toolCollection.addOrSetSubItem","\nposition",e.position,"\nbaseTool",e.baseTool,"\nsubItem.tool",e.subItem.tool,"\ninsertAfterToo",e.insertAfterTool);var t=this.containerOptions,r=!0,n=!1,a=void 0;try{for(var s,c=(0,o.default)(t);!(r=(s=c.next()).done);r=!0){var u=s.value;if(!e.position||u.position===e.position){var l=u.items,d=!0,p=!1,f=void 0;try{for(var h,m=(0,o.default)(l);!(d=(h=m.next()).done);d=!0){var g=h.value;if(g.tool===e.baseTool&&Array.isArray(g.subItems)){for(var v=g.subItems,y=v.length-1;y>=0;y--)v[y].tool===e.subItem.tool&&v.splice(y,1);var b=0;if(e.insertAfterTool)for(var S=0;S<v.length;S++)if(v[S].tool===e.insertAfterTool){b=S+1;break}g.subItems=[].concat((0,i.default)(v.slice(0,b)),[e.subItem],(0,i.default)(v.slice(b)))}}}catch(e){p=!0,f=e}finally{try{!d&&m.return&&m.return()}finally{if(p)throw f}}}}}catch(e){n=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw a}}this.setContainerOptions(t)}},{key:"removeSubItem",value:function(e){this.logger.log("[白板] toolCollection.removeSubItem","\nposition",e.position,"\nbaseTool",e.baseTool,"\nsubItemName",e.subItemName);var t=this.containerOptions,r=!0,n=!1,i=void 0;try{for(var a,s=(0,o.default)(t);!(r=(a=s.next()).done);r=!0){var c=a.value;if(!e.position||c.position===e.position){var u=c.items,l=!0,d=!1,p=void 0;try{for(var f,h=(0,o.default)(u);!(l=(f=h.next()).done);l=!0){var m=f.value;if(m.tool===e.baseTool&&Array.isArray(m.subItems))for(var g=m.subItems,v=g.length-1;v>=0;v--)g[v].tool===e.subItemName&&g.splice(v,1)}}catch(e){d=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw p}}}}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}this.setContainerOptions(t)}},{key:"preprocessContainerOptions",value:function(e){var t=0,r=!0,n=!1,i=void 0;try{for(var a,s=(0,o.default)(e);!(r=(a=s.next()).done);r=!0){var c=a.value;if(c.hasOwnProperty("items")){var u=c,l=!0,d=!1,p=void 0;try{for(var f,h=(0,o.default)(u.items);!(l=(f=h.next()).done);l=!0){var m=f.value;"multiInOne"===m.tool&&(m.key="multiInOne-**(^)-"+t++)}}catch(e){d=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw p}}}}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}}},{key:"setVisibility",value:function(e){for(var t in d.default.validate(this.logger,"toolCollection.setVisibility",{setting:e},{setting:{type:"object",isRequire:!0}}),e)d.default.validate(this.logger,"ToolCollection.setVisibility setting["+t+"]",e[t],{visible:{type:"boolean",isRequire:!0},exclude:{type:"array",isRequire:!1}});this.store.setVisibility(e),this.store.update()}},{key:"setDefaultDocList",value:function(e){this.store&&this.store.docStore?(this.store.docStore.setDefaultDocList(e),this.show()):this.logger.error("[白板] store，或者docStore不可用")}},{key:"show",value:function(){this.isShowing=!0,this._render()}},{key:"hide",value:function(){this.isShowing=!1,this.lastElement=(0,c.render)(null,this.container,this.lastElement)}},{key:"destroy",value:function(){this.logger.log("[白板]工具栏 destroy"),this.store.destroy(),this.hide()}},{key:"_calcContainerSize",value:function(e){var t=this;this._checkContainerOptions(e);var r={marginTotal:0,occupiedSizeTotal:0,unitSizeTotal:0},n={marginTotal:0,occupiedSizeTotal:0,unitSizeTotal:0},i={marginTotal:0,occupiedSizeTotal:0,unitSizeTotal:0},o={marginTotal:0,occupiedSizeTotal:0,unitSizeTotal:0},a=e.map((function(e){return e.position}));return e.forEach((function(e){if("minimap"===e.type){var s=-1!==e.position.indexOf("bottom")?o:i,c=-1!==e.position.indexOf("left")?r:n;s.occupiedSizeTotal+=e.width,c.occupiedSizeTotal+=e.height,s.marginTotal+=(e.marginLeft?e.marginLeft:16)+(e.marginRight?e.marginRight:16),c.marginTotal+=(e.marginTop?e.marginTop:16)+(e.marginBottom?e.marginBottom:16)}else{var u=void 0;e.position.startsWith("left")?(u=r).marginTotal+=(e.marginTop?e.marginTop:16)+(e.marginBottom?e.marginBottom:16):e.position.startsWith("right")?(u=n).marginTotal+=(e.marginTop?e.marginTop:16)+(e.marginBottom?e.marginBottom:16):e.position.startsWith("top")?(u=i).marginTotal+=(e.marginLeft?e.marginLeft:16)+(e.marginRight?e.marginRight:16):(u=o).marginTotal+=(e.marginLeft?e.marginLeft:16)+(e.marginRight?e.marginRight:16),u.unitSizeTotal+=e.items.reduce((function(e,r){return e+(r.size?r.size:t._getUnitSize(r))}),0),"topLeft"===e.position||"bottomLeft"===e.position?(r.unitSizeTotal+=1,r.marginTotal+=24):"topRight"!==e.position&&"bottomRight"!==e.position||(n.unitSizeTotal+=1,n.marginTotal+=24),"left"===e.position?(-1!==a.indexOf("topLeft")&&-1===a.indexOf("bottomLeft")||-1===a.indexOf("topLeft")||-1===a.indexOf("bottomLeft"))&&(r.unitSizeTotal+=1,r.marginTotal+=24):"right"===e.position?(-1!==a.indexOf("topRight")&&-1===a.indexOf("bottomRight")||-1===a.indexOf("topRight")||-1===a.indexOf("bottomRight"))&&(n.unitSizeTotal+=1,n.marginTotal+=24):"top"===e.position?(-1!==a.indexOf("leftTop")&&-1===a.indexOf("rightTop")||-1===a.indexOf("leftTop")||-1===a.indexOf("rightTop"))&&(i.unitSizeTotal+=1,i.marginTotal+=24):"bottom"===e.position&&(-1!==a.indexOf("leftBottom")&&-1===a.indexOf("rightBottom")||-1===a.indexOf("leftBottom")||-1===a.indexOf("rightBottom"))&&(o.unitSizeTotal+=1,o.marginTotal+=24)}})),{leftContainerConstraint:r,rightContainerConstraint:n,topContainerConstraint:i,bottomContainerConstraint:o}}},{key:"_checkContainerOptions",value:function(e){var t=this;if(Array.isArray(e)){e.forEach((function(e,r){"minimap"===e.type?d.default.validate(t.logger,"ToolCollection._checkContainerOptions:"+r,e,y):d.default.validate(t.logger,"ToolCollection._checkContainerOptions:"+r,e,v)}));var r=new n.default;e.forEach((function(e){r.has(e.position)&&t.logger.error("[白板] 请检查ToolCollection中option.containerOptions的position属性。容器之间的position不能重合");var n="[白板] 请检查ToolCollection中option.containerOptions的position属性。不推荐同时存在{left, leftTop},\n                    {left, leftBottom}, {right, rightTop}, {right, rightBottom}, {bottom, bottomLeft}, {bottom, bottomRight}, {top, topLeft}, {top, topRight}\n                ";"leftTop"!==e.position&&"leftBottom"!==e.position||!r.has("left")?(r.has("leftTop")||r.has("leftBottom"))&&"left"===e.position&&t.logger.error(n):t.logger.error(n),"rightTop"!==e.position&&"rightBottom"!==e.position||!r.has("right")?(r.has("rightTop")||r.has("rightBottom"))&&"right"===e.position&&t.logger.error(n):t.logger.error(n),"bottomLeft"!==e.position&&"bottomRight"!==e.position||!r.has("bottom")?(r.has("bottomLeft")||r.has("bottomRight"))&&"bottom"===e.position&&t.logger.error(n):t.logger.error(n),"topLeft"!==e.position&&"topRight"!==e.position||!r.has("top")?(r.has("topLeft")||r.has("topRight"))&&"top"===e.position&&t.logger.error(n):t.logger.error(n),r.add(e.position)}))}else this.logger.error("[白板] ToolCollection._checkContainerOptions: containerOptions to be array, but get other type")}},{key:"_getUnitSize",value:function(e){return-1!==h.IDoubleWidthTool.indexOf(e.tool)?2:-1!==h.IEightWidthTool.indexOf(e.tool)?8:-1!==h.IFiveWidthTool.indexOf(e.tool)?5:1}},{key:"logger",get:function(){return this.handler.logger}}]),e}(),v={position:{type:"string",isRequire:!0,enum:["leftBottom","left","leftTop","topLeft","top","topRight","rightTop","right","rightBottom","bottomRight","bottom","bottomLeft"]},items:{type:"array",isRequire:!0},marginLeft:{type:"number",isRequire:!1},marginRight:{type:"number",isRequire:!1},marginTop:{type:"number",isRequire:!1},marginBottom:{type:"number",isRequire:!1},hidden:{type:"boolean",isRequire:!1},class:{type:"string",isRequire:!1}},y={position:{type:"string",isRequire:!0,enum:["topLeft","topRight","bottomRight","bottomLeft"]},width:{type:"number",isRequire:!0},height:{type:"number",isRequire:!0},marginLeft:{type:"number",isRequire:!1},marginRight:{type:"number",isRequire:!1},marginTop:{type:"number",isRequire:!1},marginBottom:{type:"number",isRequire:!1},hidden:{type:"boolean",isRequire:!1},class:{type:"string",isRequire:!1}};t.default=g},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(0)),i=s(r(1)),o=s(r(132)),a=s(r(457));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,r,i){var s=this;(0,n.default)(this,e),this.containerOptions=[],this.visibilitySetting={},this.showAlert=!1,this.alertText="",this.currPage="",this.currPageIndex=0,this.pageNames=[],this.currBoard="",this.currBoardDisplayName="",this.boardNames=[],this.boardDisplayNames=[],this.previewSliderState="default",this.previewSliderPosition="right",this.previewMode="fitDoc",this.visionMode="freeObserver",this.isBroadcasting=!1,this._resize=function(){var e=s.container.getBoundingClientRect();s.containerRect=e},this.onStateChange=function(e,t){switch(e){case"page":s.setPageInfo(t);break;case"board":s.setBoardInfo(t);break;case"currTool":s.onToolChanage(t);break;case"vision":s.onVisionChange(t);break;case"config":s.onConfigChange(t)}},this.setPageInfo=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s.pageNames=e.pageNames.slice(),s.currPageIndex=e.activeIndex,t&&s.update()},this.setBoardInfo=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s.currBoard=e.currBoard,s.boardNames=e.boardNames,s.boardDisplayNames=e.boardDisplayNames,s.currBoardDisplayName=e.currBoardDisplayName;var r=s.handler.getPageInfos();r&&s.setPageInfo(r,!1),t&&s.update()},this.setVisionState=function(e){s.visionMode=e.mode,s.isBroadcasting=void 0!==e.broadcaster},this.onVisionChange=function(e){s.visionMode=e.mode,s.isBroadcasting=void 0!==e.broadcaster,s.update()},this.onConfigChange=function(e){e&&e.hasOwnProperty("previewMode")&&(s.previewMode=e.previewMode,s.update())},this.onToolChanage=function(e){s.tool=e,s.update()},this.handleAlertCancel=function(){s.showAlert=!1,s.update()},this.handleAlertConfirm=function(){s.showAlert=!1,"function"==typeof s.alertCb&&s.alertCb(),s.update()},this.handler=t,this.previewMode=t.appConfig.previewMode,this.docStore=new a.default(this),this.tool=t.getCurrTool(),this.update=r,this.dispatcher=new o.default,this.handler.on("event:appState:change",this.onStateChange),this.setBoardInfo(this.handler.getBoardInfos()),this.setVisionState(this.handler.getVisionState()),this.container=i,this.bindContainerResize()}return(0,i.default)(e,[{key:"bindContainerResize",value:function(){var e,t=this;window.addEventListener("resize",this._resize),this._ro=new MutationObserver((function(e,r){t._resize()})),null===(e=this._ro)||void 0===e||e.observe(this.container,{attributes:!0,attributeFilter:["style"]})}},{key:"on",value:function(e,t){this.dispatcher.on(e,t)}},{key:"off",value:function(e,t){this.dispatcher.off(e,t)}},{key:"emit",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(t=this.dispatcher).emit.apply(t,[e].concat(n))}},{key:"destroy",value:function(){var e;null===(e=this._ro)||void 0===e||e.disconnect(),window.removeEventListener("resize",this._resize),this.handler.off("event:appState:change",this.onStateChange),this.dispatcher.destroy(),this.previewSliderState="default"}},{key:"setContainerOptions",value:function(e){this.containerOptions=e}},{key:"setVisibility",value:function(e){for(var t in e)Array.isArray(e[t].exclude)||(e[t].exclude=[]);this.visibilitySetting=e}},{key:"updateSelectedTool",value:function(e){this.handler.setTool(e)}},{key:"popupAlert",value:function(e,t){this.alertText=e,this.showAlert=!0,this.alertCb=t,this.update()}},{key:"width",get:function(){return this.containerRect&&this.containerRect.width?this.containerRect.width:window.document.body.clientWidth}},{key:"height",get:function(){return this.containerRect&&this.containerRect.height?this.containerRect.height:window.document.body.clientHeight}}]),e}();t.default=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(5)),i=d(r(95)),o=d(r(0)),a=d(r(1)),s=d(r(458)),c=r(29),u=d(r(32)),l=r(389);function d(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){var r=this;(0,o.default)(this,e),this.visible=!1,this.fileList=[],this.fileListAlreadySet=!1,this.showFileTip=!0,this.supportPptToH5=!1,this.supportDocToPic=!1,this.onGoingTask=new i.default,this.uploadFile=function(e,t){var n,i,o;r.logger.log("[白板] uploadFile","transcode",t);var a=r,d=r.handler;if(e&&e.files){if("function"!=typeof d.getAuthInfo)return r.logger.error("3.4.0版本后，必须在初始化时提供getAuthInfo，才能够进行转码");var p="",f=e.files[0],h=f.name;e.value="";var m=(null===(n=d.serviceConf)||void 0===n?void 0:n.docTransAddr)?d.serviceConf.docTransAddr:"https://vcloud.163.com";m+="/app/wboard",r.logger.log("[白板] uploadFile service url",m),r.logger.log("[白板] uploadFile file name",h);var g=(null===(i=d.serviceConf)||void 0===i?void 0:i.directNosAddr)?null===(o=d.serviceConf)||void 0===o?void 0:o.directNosAddr:"https://wanproxy-web.127.net",v=void 0,y=s.default.createConfig({directUploadAddr:g,transServiceUrl:m,transcodeFormat:t,staticDocType:d.appConfig.staticDocType,onBeginUpload:function(e){r.logger.log("[白板] uploadFile docId",e.docId),p=e.docId,a.addFileIntoList({docId:e.docId,name:h,fileType:a._getFileType(h),params:[],state:l.FileState.UPLOAD_IN_PROGRESS,percent:0,showDelete:!0}),r.onGoingTask.set(e.docId,v)},onUploadProgress:function(e){a._updateFileState({docId:p,percent:100*e,state:l.FileState.UPLOAD_IN_PROGRESS})},onUploadComplete:function(){a._updateFileState({docId:p,percent:100,state:l.FileState.UPLOAD_COMPLETE})},onError:function(e){d.logger.error("transdoc error",e),a._updateFileState({docId:p,percent:100,state:l.FileState.TRANS_FAIL}),(0,c.showToast)({msg:"转码失败: "+f.name,type:"error",time:3,msgType:u.default.FILE_TRANSCODE_FAIL}),r.abortTask(p),r.onGoingTask.delete(p)},onTransProgress:function(e){a._updateFileState({docId:p,percent:100*e,state:l.FileState.TRANS_IN_PROGRESS})},onTransComplete:function(e){a._updateFileWhenTransComplete(p,e),r.onGoingTask.delete(p)}});d.getAuthInfo().then((function(e){v=s.default.createTask(f,{appkey:d.appkey,curtime:e.curTime.toString(),nonce:e.nonce,checksum:e.checksum},y)}))}},this._setFileProgress=function(e,t){var n=r.fileList.find((function(t){return t.docId==e}));n&&(n.percent=t,r._update())},this._update=function(){clearTimeout(r.flushTimer),r.flushTimer=setTimeout((function(){r.store.update()}),0)},this.store=t,this.handler=this.store.handler}return(0,a.default)(e,[{key:"show",value:function(e,t){this.visible=!0,this.supportPptToH5=e,this.supportDocToPic=t}},{key:"hide",value:function(){this.visible=!1}},{key:"onDocAdd",value:function(e){this.store.emit("docAdd",e.map((function(e){return{docId:e.docId,fileType:e.fileType,name:e.name,params:e.params}})))}},{key:"onDocDelete",value:function(e){this.store.emit("docDelete",e.map((function(e){return{docId:e.docId,fileType:e.fileType,name:e.name,params:e.params}})))}},{key:"setDefaultDocList",value:function(e){this.fileList=e.map((function(e){return(0,n.default)((0,n.default)({},e),{state:l.FileState.TRANS_COMPLETE,percent:0})})),this.onDocAdd(e)}},{key:"setFileKitEnable",value:function(e){this.visible=!!e}},{key:"deleteFile",value:function(e){var t=this.fileList.findIndex((function(t){return t.docId==e}));if(-1!==t){var r=this.fileList[t];this.removeFileFromList(e),r.state!==l.FileState.TRANS_COMPLETE&&this.abortTask(e)}}},{key:"abortTask",value:function(e){var t;this.onGoingTask.has(e)&&(null===(t=this.onGoingTask.get(e))||void 0===t||t.abort())}},{key:"useFile",value:function(e){Array.isArray(e.params)||e.params.hasOwnProperty("template")?this.store.handler.addDoc({docName:e.name,params:e.params}):this.store.handler.addTransDoc((0,n.default)({docName:e.name},e.params)),this.visible=!1,this.store.update()}},{key:"addFileIntoList",value:function(e){if(e.docId){var t=this.fileList.findIndex((function(t){return t.docId==e.docId}));-1!==t&&this.fileList.splice(t,1),this.fileList.unshift(e),this._update()}}},{key:"removeFileFromList",value:function(e){if(e){var t=this.fileList.findIndex((function(t){return t.docId==e})),r=this.fileList[t];-1!==t&&(this.onDocDelete([r]),this.fileList.splice(t,1),this._update())}}},{key:"_updateFileState",value:function(e){var t=e.docId;if(!t)return this.logger.error("[白板] 设置文件状态失败，参数缺失docId",e);var r=this.fileList.find((function(e){return e.docId==t}));r&&((r=(0,n.default)(r,e)).percent=Math.ceil(100*r.percent)/100,this._update())}},{key:"_updateFileWhenTransComplete",value:function(e,t){var r=this.fileList.find((function(t){return t.docId==e}));r&&(this.visible||(0,c.showToast)({msg:r.name+"转码成功",type:"success",time:3,msgType:u.default.FILE_TRANSCODE_SUCCEED}),r=(0,n.default)(r,{params:t,state:l.FileState.TRANS_COMPLETE,percent:0}),this.onDocAdd([r]))}},{key:"_getFileType",value:function(e){var t=e.lastIndexOf(".");return-1!==t?e.slice(t+1):"ppt"}},{key:"logger",get:function(){return this.handler.logger}}]),e}();t.default=p},function(e,t,r){(function(e){var n,i,o,a,s=m(r(1)),c=m(r(0)),u=m(r(5)),l=m(r(9)),d=m(r(19)),p=m(r(14)),f=m(r(47)),h=m(r(20));function m(e){return e&&e.__esModule?e:{default:e}}a=function(){return function(){var e={302:function(e){e.exports=function(){var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&(0,f.default)(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return a}});var r=window.localStorage;window.localStorage&&"function"==typeof window.localStorage.getItem&&"function"==typeof window.localStorage.setItem&&"function"==typeof window.localStorage.removeItem||(r={privateObj:{},setItem:function(e,t){r.privateObj[e]=t},getItem:function(e){return r.privateObj[e]},removeItem:function(e){delete r.privateObj[e]},getKeys:function(){return(0,p.default)(r.privateObj)}});var n={getFileKey:function(e){var t=e.size.toString(),r=e.lastModified.toString();return e.name+t.slice(t.length-5)+r.slice(r.length-5)},getFileInfo:function(e){var t=r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}},initFile:function(e,t){n.clearExpiredInfo();var i=this.getFileKey(t),o={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:Date.now(),end:!1};return e.payload&&(o.payload=e.payload),r.setItem(i,(0,d.default)(o)),i},setUploadContext:function(e,t){var n=this.getFileInfo(e);n&&(n.ctx=t,r.setItem(e,(0,d.default)(n)))},setComplete:function(e){var t=this.getFileInfo(e);t&&(t.modifyAt=Date.now(),t.end=!0,r.setItem(e,(0,d.default)(t)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){r.removeItem(e)},clearExpiredInfo:function(){var e="function"==typeof r.getKeys?r.getKeys():(0,p.default)(r),t=Date.now(),i=[],o=!0,s=!1,c=void 0;try{for(var u,d=(0,l.default)(e);!(o=(u=d.next()).done);o=!0){var f=u.value,h=n.getFileInfo(f);null===h||t-h.modifyAt>a.expireTime?r.removeItem(f):i.push({fileInfo:h,key:f})}}catch(e){s=!0,c=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw c}}if(i.length>a.maxFileCache){var m=i.sort((function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt})).slice(a.maxFileCache),g=!0,v=!1,y=void 0;try{for(var b,S=(0,l.default)(m);!(g=(b=S.next()).done);g=!0){var _=b.value;r.removeItem(_.key)}}catch(e){v=!0,y=e}finally{try{!g&&S.return&&S.return()}finally{if(v)throw y}}}}},i=n,o={maxFileCache:100,expireTime:31536e6,getFileUploadInformation:function(e){var t=i.getFileKey(e),r=i.getFileInfo(t);return null===r?null:Date.now()-r.modifyAt>o.expireTime?(i.removeFileInfo(t),null):{uploadInfo:(0,u.default)({bucketName:r.bucket,objectName:r.obj,token:r.token,ctx:r.ctx},r.payload?{payload:r.payload}:{}),complete:r.end}},setMaxFileCache:function(e){o.maxFileCache=e},setExpireTime:function(e){o.expireTime=e},printCaches:function(){var e=(0,p.default)(localStorage),t=!0,r=!1,n=void 0;try{for(var o,a=(0,l.default)(e);!(t=(o=a.next()).done);t=!0){var s=o.value,c=i.getFileInfo(s);c&&console.log(c,"modifiedAt",new Date(c.modifyAt).toTimeString())}}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}},createConfig:function(e){return new function e(t){for(var r in(0,c.default)(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=2,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.onError=function(e){},this.onProgress=function(e){},this.onComplete=function(e){},t)this[r]=t[r]}(e)},createTask:function(e,t,r){return new(function(){function e(t,r,n){(0,c.default)(this,e),this.uploadState="paused",this.config=n,this.file=t,this.param=r,this.fileKey=i.initFile(r,t),this.resume()}return(0,s.default)(e,[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;!function e(t,r,n){if("uploading"===t.uploadState){var o=t.config,a=t.param,s=i.getUploadContext(t.fileKey);if(!s)return n(0);var c=new XMLHttpRequest;c.onreadystatechange=function(){if("abort"!==t.uploadState&&4===c.readyState){var a=void 0;try{a=JSON.parse(c.responseText)}catch(e){a={errMsg:"返回json无法解析",errCode:500}}200===c.status?a.errCode?t.config.onError({errCode:a.errCode,errMsg:a.errMsg}):n(a.offset):c.status.toString().match(/^5/)?e(t,r-1,n):(o.onError(c.statusText),404===c.status&&i.removeFileInfo(t.fileKey))}};var u=o.directUploadAddr+"/"+a.bucketName+"/"+encodeURIComponent(a.objectName)+"?uploadContext&context="+s+"&version="+o.version;c.open("get",u),c.setRequestHeader("x-nos-token",a.token),c.timeout=o.getOffsetTimeout,c.send()}}(this,t.retryCount,(function(r){!function e(t,r,n,o){if("uploading"===t.uploadState){var a=t.param,s=t.config,c=File.prototype.slice,u=void 0!==a.ctx?a.ctx:"",l=r+s.trunkSize>t.file.size,d=l?t.file.size:r+s.trunkSize,p=new XMLHttpRequest;p.upload.onprogress=function(e){var n=0;e.lengthComputable?(n=(r+e.loaded)/t.file.size,s.onProgress(n)):s.onError({errMsg:"浏览器不支持进度事件"})},p.onreadystatechange=function(){if("abort"!==t.uploadState&&4===p.readyState){var a=void 0;try{a=JSON.parse(p.responseText)}catch(e){console.error("分片上传异常:",e),a={errMsg:"分片上传未知类型错误"}}200===p.status?(t.setContext(a.context),l?(o(),t.setComplete()):e(t,a.offset,s.retryCount,o)):p.status.toString().match(/^5/)?n>0?e(t,r,n-1,o):(i.removeFileInfo(t.fileKey),s.onError({errCode:a.errCode,errMsg:a.errMsg})):p.status?(i.removeFileInfo(t.fileKey),s.onError({errCode:a.errCode,errMsg:a.errMsg})):console.log("上传已暂停",p)}},p.open("post",s.directUploadAddr+"/"+a.bucketName+"/"+encodeURIComponent(a.objectName)+"?offset="+r+"&complete="+l+"&context="+u+"&version="+s.version),p.setRequestHeader("x-nos-token",a.token),p.timeout=s.trunkUploadTimeout,p.send(c.call(t.file,r,d))}}(e,r,t.retryCount,(function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.setUploadState("abort"),i.removeFileInfo(this.fileKey)}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){i.setUploadContext(this.fileKey,e),this.param.ctx=e}},{key:"setComplete",value:function(){i.setComplete(this.fileKey),this.setUploadState("ended")}}]),e}())(e,t,r)}},a=o;return t.default}()}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&(0,f.default)(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n={};return function(){function e(e){var t=e.data,r=t.resultUrl,n=t.pageCount,i=t.width,o=t.height,a=r.endsWith("/")?r+"index.json":r+"/index.json";return 0===a.indexOf("http:")&&(a="https:"+a.slice(5)),i||(i=1080),o||(o=1080),{width:i,height:o,url:a,pageCount:n}}function t(e,t){var r=e.data,n=r.pageCount,i=r.format,o=r.resultUrl,a=r.width,s=r.height;if(a||(a=1080),s||(s=1080),"array"===t){for(var c=[],u=0;u<n;u++){var l=""+o+(u+1)+"."+i;0===l.indexOf("http:")&&(l="https:"+l.slice(5)),c.push({url:l,width:a,height:s})}return c}var d=o+"{index}."+i;return 0===d.indexOf("http:")&&(d="https:"+d.slice(5)),{template:d,width:a,height:s,pageCount:n,offset:1}}r.d(n,{default:function(){return s}});var i=function e(t,r,n,i){if(!t.aborted){var o=t.config,a=new XMLHttpRequest;a.onreadystatechange=function(){if(!t.aborted&&4===a.readyState){var s=void 0;try{s=JSON.parse(a.responseText)}catch(e){s={errMsg:"返回json无法解析",errCode:500}}200===a.status?200!==s.code?(t.abort(),o.onError(s)):s.data?40===s.data.status?i(s):30===s.data.status?setTimeout((function(){e(t,r,n,i)}),o.checkTransProgressInterval):(t.abort(),o.onError(a.statusText)):(t.abort(),o.onError(s)):a.status.toString().match(/^5/)?e(t,r,n-1,i):(t.abort(),o.onError(a.statusText))}};var s=o.transServiceUrl+"/transcode/query";a.open("post",s),a.setRequestHeader("content-type","application/json"),a.setRequestHeader("appkey",t.authInfo.appkey),a.setRequestHeader("curtime",t.authInfo.curtime.toString()),a.setRequestHeader("nonce",t.authInfo.nonce),a.setRequestHeader("checksum",t.authInfo.checksum),a.timeout=1e4,a.send((0,d.default)({taskId:r.taskId}))}},o=r(302),a=r.n(o),s={createConfig:function(e){return new function e(t){if((0,c.default)(this,e),this.transServiceUrl="https://vcloud.163.com/app/wboard",this.staticDocType="template",this.onBeginUpload=function(){},this.onError=function(e){},this.onUploadProgress=function(e){},this.onUploadComplete=function(){},this.onTransProgress=function(e){},this.onTransComplete=function(){},this.onTransBegin=function(e){},this.checkTransProgressInterval=4e3,this.transcodeFormat="jpg",t.directUploadAddr&&(this.directUploadAddr=t.directUploadAddr),t.transcodeFormat&&(this.transcodeFormat=t.transcodeFormat),t.onError&&(this.onError=t.onError),t.onBeginUpload&&(this.onBeginUpload=t.onBeginUpload),t.onUploadProgress&&(this.onUploadProgress=t.onUploadProgress),t.onUploadComplete&&(this.onUploadComplete=t.onUploadComplete),t.onTransBegin&&(this.onTransBegin=t.onTransBegin),t.onTransProgress&&(this.onTransProgress=t.onTransProgress),t.onTransComplete&&(this.onTransComplete=t.onTransComplete),t.checkTransProgressInterval&&(this.checkTransProgressInterval=t.checkTransProgressInterval),t.staticDocType&&(this.staticDocType=t.staticDocType),t.transServiceUrl&&(this.transServiceUrl=t.transServiceUrl),this.transServiceUrl.endsWith("/")&&(this.transServiceUrl=this.transServiceUrl.slice(0,this.transServiceUrl.length-1)),-1===["jpg","png","h5"].indexOf(this.transcodeFormat))throw new Error("transcodeFormat只能是h5, jpg或者png")}(e)},createTask:function(r,n,o){return new function r(n,o,s){var u=this;(0,c.default)(this,r),this.abort=function(){u.uploadTask&&u.uploadTask.abort(),clearTimeout(u.transProgressTimer),u.aborted=!0},this.startUploadPhase=function(e){!function e(t,r,n){if(!t.aborted){var i=t.config,o=new XMLHttpRequest;o.onreadystatechange=function(){if(!t.aborted&&4===o.readyState){var a=void 0;try{a=JSON.parse(o.responseText)}catch(e){a={errMsg:"返回json无法解析",errCode:500}}200===o.status?200!==a.code?i.onError(a):n(a):o.status.toString().match(/^5/)?e(t,r-1,n):i.onError(o.statusText)}};var a,s=i.transServiceUrl+"/upload/init";o.open("post",s),o.setRequestHeader("content-type","application/json"),o.setRequestHeader("appkey",t.authInfo.appkey),o.setRequestHeader("curtime",t.authInfo.curtime.toString()),o.setRequestHeader("nonce",t.authInfo.nonce),o.setRequestHeader("checksum",t.authInfo.checksum),o.timeout=1e4,o.send((0,d.default)({name:t.file.name,docFormat:(a=t.file.name,a.slice(a.lastIndexOf(".")+1))}))}}(u,2,(function(t){u.config.onBeginUpload&&u.config.onBeginUpload({docId:t.data.docId}),u.uploadTask=a().createTask(u.file,{bucketName:t.data.bucket,objectName:t.data.objectKey,token:t.data.token,ctx:"",payload:{docId:t.data.docId}},e)}))},this.startTransPhase=function(r){if(!r.payload.docId)return u.config.onError("找不到docId");!function e(t,r,n,i){if(!t.aborted){var o=t.config,a=new XMLHttpRequest;a.onreadystatechange=function(){if(!t.aborted&&4===a.readyState){var s=void 0;try{s=JSON.parse(a.responseText)}catch(e){s={errMsg:"返回json无法解析",errCode:500}}200===a.status?200!==s.code?o.onError(s):i(s):a.status.toString().match(/^5/)?e(t,r,n-1,i):o.onError(a.statusText)}};var s=o.transServiceUrl+"/transcode/commit";a.open("post",s),a.setRequestHeader("content-type","application/json"),a.setRequestHeader("appkey",t.authInfo.appkey),a.setRequestHeader("curtime",t.authInfo.curtime.toString()),a.setRequestHeader("nonce",t.authInfo.nonce),a.setRequestHeader("checksum",t.authInfo.checksum),a.timeout=1e4,a.send((0,d.default)({docId:r.docId,transcodeFormat:o.transcodeFormat,dpi:300}))}}(u,{docId:r.payload.docId},2,(function(r){u.startTransAt=Date.now(),u.sendProgressFeedback(),u.config.onTransBegin({taskId:r.data.taskId,startTransAt:Date.now()}),i(u,{taskId:r.data.taskId},2,(function(r){clearTimeout(u.transProgressTimer),u.config.onTransProgress(1),"h5"===u.config.transcodeFormat?u.config.onTransComplete(e(r)):u.config.onTransComplete(t(r,u.config.staticDocType))}))}))},this.sendProgressFeedback=function(){clearTimeout(u.transProgressTimer),u.transProgressTimer=setTimeout((function(){u.startTransAt||(u.startTransAt=Date.now());var e=Math.floor((Date.now()-u.startTransAt)/1e3),t=1-Math.pow(.97716,e);t=t>.99?.9999:t,u.config.onTransProgress(t),u.sendProgressFeedback()}),1e3)},this.config=s,this.authInfo=o,this.file=n;var l={onProgress:s.onUploadProgress,onError:s.onError};s.directUploadAddr&&(l.directUploadAddr=s.directUploadAddr),l.onComplete=function(e){s.onUploadComplete?function e(t,r,n,i){if(!t.aborted){var o=t.config,a=new XMLHttpRequest;a.onreadystatechange=function(){if(!t.aborted&&4===a.readyState){var s=void 0;try{s=JSON.parse(a.responseText)}catch(e){s={errMsg:"返回json无法解析",errCode:500}}200===a.status?200!==s.code?o.onError(s):i(s):a.status.toString().match(/^5/)?e(t,r,n-1,i):o.onError(a.statusText)}};var s=o.transServiceUrl+"/doc/get";a.open("post",s),a.setRequestHeader("content-type","application/json"),a.setRequestHeader("appkey",t.authInfo.appkey),a.setRequestHeader("curtime",t.authInfo.curtime.toString()),a.setRequestHeader("nonce",t.authInfo.nonce),a.setRequestHeader("checksum",t.authInfo.checksum),a.timeout=1e4,a.send((0,d.default)({docId:r.docId}))}}(u,{docId:e.payload.docId},2,(function(t){t.data&&t.data.docUrl?s.onUploadComplete({docUrl:t.data.docUrl}):s.onUploadComplete({docUrl:null}),u.startTransPhase(e)})):u.startTransPhase(e)};var p=a().createConfig(l);this.startUploadPhase(p)}(r,n,o)},createQueryTask:function(r,n,o){return new function r(n,o,a){var s=this;(0,c.default)(this,r),this.complete=!1,this.abort=function(){clearTimeout(s.transProgressTimer),s.aborted=!0},this.sendProgressFeedback=function(){clearTimeout(s.transProgressTimer),s.complete||(s.transProgressTimer=setTimeout((function(){s.startTransAt||(s.startTransAt=Date.now());var e=Math.floor((Date.now()-s.startTransAt)/1e3),t=1-Math.pow(.97716,e);t=t>.99?.9999:t,s.config.onTransProgress(t),s.sendProgressFeedback()}),1e3))};var u=n.startTransAt,l=n.taskId;this.config=a,this.authInfo=o,this.taskId=l.toString(),this.startTransAt=u,this.sendProgressFeedback(),i(this,{taskId:this.taskId},2,(function(r){clearTimeout(s.transProgressTimer),s.complete=!0,s.config.onTransProgress(1),"h5"===s.config.transcodeFormat?s.config.onTransComplete(e(r)):s.config.onTransComplete(t(r,s.config.staticDocType))}))}(r,n,o)}}}(),n.default}()},"object"==(0,h.default)(t)&&"object"==(0,h.default)(e)?e.exports=a():(i=[],void 0===(o="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=o))}).call(this,r(119)(e))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=v(r(9)),i=v(r(2)),o=v(r(0)),a=v(r(1)),s=v(r(3)),c=v(r(4)),u=r(7),l=v(u),d=v(r(460)),p=v(r(461)),f=v(r(392)),h=v(r(533));r(552),r(554);var m=r(139),g=v(r(591));function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={itemSizeBaseMap:{}},e.stopTcPropagation=function(e){e.stopPropagation()},e.hasPreview=function(){var t=!0,r=!1,i=void 0;try{for(var o,a=(0,n.default)(e.props.containerOptions);!(t=(o=a.next()).done);t=!0){var s=o.value;if(s.hasOwnProperty("items")){var c=!0,u=!1,l=void 0;try{for(var d,p=(0,n.default)(s.items);!(c=(d=p.next()).done);c=!0)if("preview"===d.value.tool)return!0}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}}}catch(e){r=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw i}}return!1},e.clearPopup=function(){"open"!==e.props.store.previewSliderState&&void 0===e.props.store.popup||("open"===e.props.store.previewSliderState&&(e.props.store.previewSliderState="close"),e.props.store.popup=void 0,e.props.store.update())},e._calcItemSizeBase=function(t,r){if(r=r||e.props){var n={},i=r.container.getBoundingClientRect();r.containerOptions.forEach((function(t){n[t.position]=Math.min(r.itemDefaultSize,e._calcItemSizeOfContainer(r,t,i.width,i.height))})),e.setState({itemSizeBaseMap:n})}},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this._calcItemSizeBase),window.addEventListener("orientationchange",this._calcItemSizeBase),(0,m.on)(document,"touchstart",this.clearPopup),(0,m.on)(document,"mousedown",this.clearPopup),(0,m.on)(document,"click",this.clearPopup),this._calcItemSizeBase(void 0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._calcItemSizeBase),window.removeEventListener("orientationchange",this._calcItemSizeBase),(0,m.off)(document,"touchstart",this.clearPopup),(0,m.off)(document,"mousedown",this.clearPopup),(0,m.off)(document,"click",this.clearPopup)}},{key:"componentWillReceiveProps",value:function(e){(this.props.containerOptionsCount!==e.containerOptionsCount||this.props.itemDefaultSize!==e.itemDefaultSize)&&this._calcItemSizeBase(void 0,e)}},{key:"render",value:function(){var e=this,t=this.props.store,r=(this.props.class?this.props.class:"")+" tool-collection tc-"+this.props.platform;return l.default.createElement("div",{id:"yunxin-whiteboard-toolCollection",onTouchStart:this.stopTcPropagation,onMouseDown:this.stopTcPropagation,onClick:this.stopTcPropagation,className:r},this.props.containerOptions.map((function(r){if(t.visibilitySetting.hasOwnProperty(r.position)){var n=t.visibilitySetting[r.position];if(!1===n.visible&&(!Array.isArray(n.exclude)||0===n.exclude.length))return null}return"minimap"===r.type?l.default.createElement(d.default,null):l.default.createElement(p.default,{key:r.position,store:e.props.store,platform:e.props.platform,option:r,itemSizeBase:e.state.itemSizeBaseMap[r.position],cornerOccupied:e.getCornerOccupied(r)})})),this.renderAlert(),this.hasPreview()&&this.renderPreviewSlider(),this.renderDocUploadPopup())}},{key:"renderAlert",value:function(){var e=this.props.store;return l.default.createElement(f.default,{showAlert:e.showAlert,alertText:e.alertText,onHide:e.handleAlertCancel,onConfirm:e.handleAlertConfirm})}},{key:"renderPreviewSlider",value:function(){var e=this.props.store,t=e.previewSliderState,r=e.previewSliderPosition;return l.default.createElement(g.default,{state:t,store:this.props.store,position:r,boardName:this.props.store.currBoard,pageNames:this.props.store.pageNames.slice()})}},{key:"renderDocUploadPopup",value:function(){var e=this;return l.default.createElement(h.default,{platform:this.props.platform,docStore:this.props.store.docStore,onHide:function(){e.props.store.docStore.hide(),e.props.store.update()},supportPptToH5:this.props.store.docStore.supportPptToH5,supportDocToPic:this.props.store.docStore.supportDocToPic})}},{key:"_calcItemSizeOfContainer",value:function(e,t,r,n){var i=this.getContainerConstraint(e,t.position),o=i.occupiedSizeTotal,a=i.marginTotal,s=i.unitSizeTotal;return"minimap"===t.type?this.props.itemDefaultSize:t.position.startsWith("left")||t.position.startsWith("right")?(n-o-a)/s:(r-o-a)/s}},{key:"getCornerOccupied",value:function(e){var t=this.props.containerOptions.map((function(e){return e.position}));return"leftTop"===e.position&&-1!==t.indexOf("topLeft")||"leftBottom"===e.position&&-1!==t.indexOf("bottomLeft")||"rightTop"===e.position&&-1!==t.indexOf("topRight")||"rightBottom"===e.position&&-1!==t.indexOf("bottomRight")}},{key:"getContainerConstraint",value:function(e,t){if(t.startsWith("left"))return e.containerConstraint.leftContainerConstraint;if(t.startsWith("right"))return e.containerConstraint.rightContainerConstraint;if(t.startsWith("top"))return e.containerConstraint.topContainerConstraint;if(t.startsWith("bottom"))return e.containerConstraint.bottomContainerConstraint;throw new Error("[白板] getContainerContraint position should start with one of [left, right, top, bottom]")}}]),t}(u.Component);t.default=y},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=c(r(2)),i=c(r(0)),o=c(r(1)),a=c(r(3)),s=c(r(4));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){return null}}]),t}(r(7).Component);t.default=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(2)),i=p(r(0)),o=p(r(1)),a=p(r(3)),s=p(r(4)),c=r(7),u=p(c),l=r(141),d=r(402);function p(e){return e&&e.__esModule?e:{default:e}}r(531);var f=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.state={marginLeft:0,marginRight:0,marginTop:0,marginBottom:0},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){this.updatePosition(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.updatePosition(e)}},{key:"render",value:function(){var e=this;if(!this.props.option.items||0===this.props.option.items.length)return null;var t="tc-container tc-container-"+this.props.option.position+(this.props.option.class?this.props.option.class:""),r=this.props.store.visibilitySetting[this.props.option.position],n=0,i=this.props.option.items.reduce((function(e,t){return e+(t.size||1)}),0);return u.default.createElement("div",{className:t,style:this.getStyle()},this.props.option.items.map((function(t){var o,a=!0;if(r&&(r.visible&&Array.isArray(r.exclude)&&-1!==r.exclude.indexOf(t.tool)?a=!1:r.visible||(null===(o=r.exclude)||void 0===o?void 0:-1!==o.indexOf(t.tool))||(a=!1)),!a)return null;var s=n;return"bottomRight"!==e.props.option.position&&"topRight"!==e.props.option.position||(s=i-n-(t.size||1)),n+=t.size||1,e.renderItem(t,s)})))}},{key:"renderItem",value:function(e,t){var r=(0,d.getComponentByToolName)(e.tool);return u.default.createElement(r,{itemSizeBase:this.props.itemSizeBase,store:this.props.store,option:e,containerPosition:this.props.option.position,sizeShiftTotal:t})}},{key:"getStyle",value:function(){var e=this.props,t=e.option,r=e.itemSizeBase,n=this.state,i={marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop,marginBottom:n.marginBottom};return t.position.startsWith("left")||t.position.startsWith("right")?i.width=r:i.height=r,i}},{key:"updatePosition",value:function(e){var t=e.option,r=e.itemSizeBase,n={};n=(0,l.getDefaultMargin)()[t.position],t.hasOwnProperty("marginLeft")&&(n.marginLeft=t.marginLeft),t.hasOwnProperty("marginRight")&&(n.marginRight=t.marginRight),t.hasOwnProperty("marginTop")&&(n.marginTop=t.marginTop),t.hasOwnProperty("marginBottom")&&(n.marginBottom=t.marginBottom),e.cornerOccupied&&("leftTop"===t.position||"rightTop"===t.position?n.marginTop+=r+16:"leftBottom"!==t.position&&"rightBottom"!==t.position||(n.marginBottom+=r+16)),this.setState(n)}}]),t}(c.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=_(r(5)),i=_(r(2)),o=_(r(0)),a=_(r(1)),s=_(r(3)),c=_(r(4)),u=r(7),l=_(u),d=_(r(403)),p=_(r(138)),f=_(r(243)),h=_(r(404)),m=r(141),g=_(r(22)),v=_(r(390)),y=_(r(405)),b=_(r(406)),S=_(r(407));function _(e){return e&&e.__esModule?e:{default:e}}var M=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={width:5,color:"rgb(0,0,0)",tool:"pen"},e.populateDefaultImageForToolArray=function(t){return t.map((function(t){return t.backgroundImage||(t.backgroundImage=e.getBackgroundImageOfTool(t.tool)),t}))},e.getBackgroundImageOfTool=function(e){switch(e){case"pen":return v.default;case"pen-arrow":return b.default;case"line":return y.default;case"line-arrow":return S.default;default:return console.error("无法获取图形工具"+e+"的背景图片"),""}},e.handleClick=function(){e.props.store.popup="pen",e.props.store.updateSelectedTool(e.state.tool),e.props.store.update()},e.handleToolChange=function(t){e.props.store.updateSelectedTool(t),e.setState({tool:t})},e.handleWidthChange=function(t){e.props.store.handler.setStrokeWidth(t.target.value)},e.handleColorChange=function(t){e.props.store.handler.setColor(t)},e.setProperty=function(t,r){"renderWidth"===t?e.setState({width:r}):"renderColor"===t&&e.setState({color:r})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setProperty),this.setState({width:this.props.store.handler.getStrokeWidth(),color:this.props.store.handler.getColor()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setProperty)}},{key:"render",value:function(){var e=this.props.option.subItems||m.defaultPenSubItems,t=(e=this.populateDefaultImageForToolArray(e)).map((function(e){return e.tool})),r=l.default.createElement(h.default,{selectedTool:this.state.tool,toolArray:e,onClick:this.handleToolChange}),i=l.default.createElement(f.default,{width:this.state.width,onWidthChange:this.handleWidthChange}),o=l.default.createElement(d.default,{color:this.state.color,onColorChange:this.handleColorChange}),a="horizontal"!==this.props.option.stack?{sections:[r,i,o]}:{leftSections:[r,i],rightSections:[o]},s="horizontal"==this.props.option.stack?380:210;return l.default.createElement(g.default,(0,n.default)({onClick:this.handleClick},this.props,{toolOptionalName:t,hideHint:"pen"===this.props.store.popup}),"pen"===this.props.store.popup&&l.default.createElement(p.default,(0,n.default)({},a,{store:this.props.store,width:s,baseItemWidth:this.props.itemSizeBase,baseItemPosition:this.props.containerPosition,baseItemShift:(this.props.sizeShiftTotal+.5)*this.props.itemSizeBase})))}}]),t}(u.Component);t.default=M},function(e,t,r){var n=r(464);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-color-platte {\n    flex-direction: column;\n    flex-wrap: nowrap;\n    height: 120px;\n    width: 100%;\n    display: flex;\n}\n    \n    .tc-color-platte .tc-color-row {\n        display: flex;\n        flex: 1;\n        width: 100%;\n        justify-content: space-around;\n    }\n    \n    .tc-color-platte .tc-color-row .tc-color-cell-wrapper {\n            width: 25%;\n            padding: 6px;\n            border-radius: 12px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            box-sizing: border-box\n        }\n    \n    .tc-color-platte .tc-color-row .tc-color-cell-wrapper.selected {\n                outline: 1px solid #337EFF;\n            }\n    \n    .tc-color-platte .tc-color-row .tc-color-cell-wrapper:hover {\n                cursor: pointer;\n            }\n    \n    .tc-color-platte .tc-color-row .tc-color-cell-wrapper .tc-color-cell {\n                width: 100%;\n                height: 100%;\n                border-radius: 100%;\n            }",""])},function(e,t,r){var n=r(466);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-popup {\n    width: 210px;\n    padding: 0 12px;\n    box-sizing: border-box;\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    background-color: white;\n    border-radius: 4px;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n}\n\n    .tc-popup .tc-popup-section {\n        display: flex;\n        flex-direction: row;\n        flex-wrap: nowrap;\n        padding: 12px 3px;\n        justify-content: space-between;\n        box-sizing: border-box;\n        width: 100%;\n    }\n\n.tc-popup.tc-popup-left-right {\n        display: flex;\n        flex-direction: row;\n        width: 392px;\n        max-width: 92vw;\n        background: white;\n        position: absolute;\n    }\n\n.tc-popup.tc-popup-left-right .tc-popup-left, .tc-popup.tc-popup-left-right .tc-popup-right {\n            flex: 1;\n        }\n\n.tc-popup.tc-popup-left-right .tc-popup-left {\n            border-right: 1px solid #E6E7EB;\n            display: flex;\n            flex-direction: column;\n            justify-content: space-between;\n            padding: 12px 12px 12px 0;\n        }\n\n.tc-popup.tc-popup-left-right .tc-popup-right {\n            padding: 12px 0 12px 12px;\n        }\n\n.tc-popup :not(:first-child).tc-popup-section {\n        box-shadow: inset 0px 1px 0px 0px #E6E7EB;\n    }\n\n.tc-container-left .tc-popup, .tc-container-leftTop .tc-popup, .tc-container-leftBottom .tc-popup {\n        left: 50px;\n    }\n\n.tc-container-right .tc-popup, .tc-container-rightTop .tc-popup, .tc-container-rightBottom .tc-popup {\n        right: 50px;\n    }\n\n.tc-container-top .tc-popup, .tc-container-topLeft .tc-popup, .tc-container-topRight .tc-popup {\n        top: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n    }\n\n.tc-container-bottom .tc-popup, .tc-container-bottomLeft .tc-popup, .tc-container-bottomRight .tc-popup {\n        bottom: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n    }",""])},function(e,t,r){var n=r(468);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,'.tc-resize-container {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    height: 45px;\n}\n\n    .tc-resize-container .tc-resize-input {\n        width: 100%;\n        position: relative;\n    }\n\n    .tc-resize-container .tc-resize-input input {\n            width: 100%;\n            border-radius: 2px;\n            margin: 0;\n            position: absolute;\n            top: 7px;\n        }\n\n    .tc-resize-container .tc-resize-input input[type="range"] {\n            background: #F2F3F5;\n            height: 4px;\n            -webkit-appearance: none;\n               -moz-appearance: none;\n                    appearance: none;\n            border: none;\n            outline: none;\n        }\n\n    .tc-resize-container .tc-resize-input input[type="range"]::-webkit-slider-thumb {\n            -webkit-appearance: none;\n            appearance: none;\n            width: 15px;\n            height: 15px;\n            border-radius: 15px;\n            background: #337EFF;\n            cursor: pointer;\n        }\n\n    .tc-resize-container .tc-resize-input input[type="range"]::-moz-range-thumb {\n            -moz-appearance: none;\n                 appearance: none;\n            width: 15px;\n            height: 15px;\n            border-radius: 15px;\n            background: #337EFF;\n            cursor: pointer;\n        }\n\n    .tc-resize-container .tc-resize-input:hover {\n            cursor: pointer;\n        }\n\n    .tc-resize-container .tc-resize-input .left-bg {\n            height: 4px;\n            position: absolute;\n            left: 0;\n            top: 7px;\n            margin: 0;\n            background-color: #337EFF;\n            border-radius: 2px 0 0 2px;\n            pointer-events: none;\n        }\n\n    .tc-resize-container .tc-resize-text {\n        display: flex;\n        justify-content: space-between;\n        width: 100%;\n    }\n\n    .tc-resize-container .tc-resize-text span {\n            display: block;\n            margin: 12px 5px 5px;\n        }',""])},function(e,t,r){var n=r(470);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-hint-wrapper {\n    display: inline-block;\n    position: relative;\n}\n    .tc-hint-wrapper .tc-hint {\n        pointer-events: none;\n        display: none;\n        position: absolute;\n        white-space: nowrap;\n        border-radius: 2px;\n        background: #333333;            \n        z-index: 10;\n        padding: 8px 8px 6px;\n    }\n    .tc-hint-wrapper .tc-hint .tc-hint-text {\n            color: #FFFFFF;\n            font-family: PingFang SC;\n            font-weight: regular;\n            font-size: 14px;\n            line-height: 22px;\n            letter-spacing: 0px;\n            text-align: center;\n        }\n    .tc-hint-wrapper .tc-hint::before {\n            content: '';\n            display: block;\n            position: absolute;\n            box-sizing: border-box;\n        }\n    .tc-hint-wrapper .tc-hint.right {\n            left: calc(100% + 15px);\n            top: 50%;\n            transform: translateY(-50%)\n        }\n    .tc-hint-wrapper .tc-hint.right::before {\n                width: 8px;\n                left: -8px;\n                border-top: 4px solid transparent;\n                border-bottom: 4px solid transparent;\n                border-right: 4px solid #333333;\n                top: 50%;\n                transform: translate(0%, -50%);\n            }\n    .tc-hint-wrapper .tc-hint.left {\n            right: calc(100% + 15px);\n            top: 50%;\n            transform: translateY(-50%)\n        }\n    .tc-hint-wrapper .tc-hint.left::before {\n                width: 8px;\n                right: -8px;\n                border-top: 4px solid transparent;\n                border-bottom: 4px solid transparent;\n                border-left: 4px solid #333333;\n                top: 50%;\n                transform: translate(0%, -50%);\n            }\n    .tc-hint-wrapper .tc-hint.top {\n            bottom: calc(100% + 5px);\n            left: 50%;\n            transform: translateX(-50%)\n        }\n    .tc-hint-wrapper .tc-hint.top::before {\n                height: 8px;\n                bottom: -8px;\n                border-left: 4px solid transparent;\n                border-right: 4px solid transparent;\n                border-top: 4px solid #333333;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n    .tc-hint-wrapper .tc-hint.bottom {\n            top: calc(100% + 5px);\n            left: 50%;\n            transform: translateX(-50%)\n        }\n    .tc-hint-wrapper .tc-hint.bottom::before {\n                height: 8px;\n                top: -8px;\n                border-left: 4px solid transparent;\n                border-right: 4px solid transparent;\n                border-bottom: 4px solid #333333;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n@media (any-hover: hover) {\n            .tc-hint-wrapper:hover .tc-hint {\n                display: block;\n            }\n    }",""])},function(e,t,r){var n=r(472);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-tool-select-container {\n    height: 40px;\n    width: 100%;\n    display: flex;\n    justify-content: space-around;\n}\n\n    .tc-tool-select-container .tc-tool-select-cell-wrapper {\n        width: 100%;\n        height: 100%\n    }\n\n    .tc-tool-select-container .tc-tool-select-cell-wrapper.selected {\n            outline: 1px solid #337EFF;\n        }\n\n    .tc-tool-select-container .tc-tool-select-cell-wrapper .tc-tool-select-cell {\n            width: 100%;\n            height: 100%;\n            background-size: contain;\n        }",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={undoCount:0},e.handleClick=function(){e.state.undoCount>0&&e.props.store.handler.undo()},e.setUndoCount=function(t,r){"undoCount"===t&&e.setState({undoCount:r})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setUndoCount),this.setState({undoCount:this.props.store.handler.getUndoCount()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setUndoCount)}},{key:"render",value:function(){var e=0===this.state.undoCount;return l.default.createElement(d.default,(0,n.default)({unavailable:e,onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={redoCount:0},e.handleClick=function(){e.state.redoCount>0&&e.props.store.handler.redo()},e.setRedoCount=function(t,r){"redoCount"===t&&e.setState({redoCount:r})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setRedoCount),this.setState({redoCount:this.props.store.handler.getRedoCount()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setRedoCount)}},{key:"render",value:function(){var e=0===this.state.redoCount;return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:e},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={available:!1},e.handleClick=function(){e.state.available&&e.props.store.popupAlert("确认要清除白板所有内容？",(function(){e.props.store.handler.clear()}))},e.setClearAvailable=function(t,r){"clearAvailable"===t&&e.setState({available:r})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setClearAvailable),this.setState({available:this.props.store.handler.isClearAvailable()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setClearAvailable)}},{key:"render",value:function(){var e=!this.state.available;return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:e},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={selectCount:0},e.handleClick=function(){e.state.selectCount>0&&e.props.store.handler.duplicate()},e.setSelectCount=function(t,r,n,i){"selectChange"===t&&e.setState({selectCount:i.length})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setSelectCount),this.setState({selectCount:this.props.store.handler.getSelectedIds().length})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setSelectCount)}},{key:"render",value:function(){var e=0===this.state.selectCount;return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:e},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=_(r(5)),i=_(r(2)),o=_(r(0)),a=_(r(1)),s=_(r(3)),c=_(r(4)),u=r(7),l=_(u),d=_(r(403)),p=_(r(138)),f=_(r(243)),h=_(r(404)),m=r(141),g=_(r(22)),v=_(r(391)),y=_(r(408)),b=_(r(409)),S=_(r(410));function _(e){return e&&e.__esModule?e:{default:e}}var M=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={width:5,color:"rgb(0,0,0)",tool:"rect"},e.populateDefaultImageForToolArray=function(t){return t.map((function(t){return t.backgroundImage||(t.backgroundImage=e.getBackgroundImageOfTool(t.tool)),t}))},e.getBackgroundImageOfTool=function(e){switch(e){case"rect":return v.default;case"rect-fill":return b.default;case"ellipse":return y.default;case"ellipse-fill":return S.default;default:return console.error("无法获取图形工具"+e+"的背景图片"),""}},e.handleClick=function(){e.props.store.popup="shape",e.props.store.updateSelectedTool(e.state.tool),e.props.store.update()},e.handleToolChange=function(t){e.props.store.updateSelectedTool(t),e.setState({tool:t})},e.handleWidthChange=function(t){e.props.store.handler.setStrokeWidth(t.target.value)},e.handleColorChange=function(t){e.props.store.handler.setColor(t)},e.setProperty=function(t,r){"renderWidth"===t?e.setState({width:r}):"renderColor"===t&&e.setState({color:r})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setProperty),this.setState({width:this.props.store.handler.getStrokeWidth(),color:this.props.store.handler.getColor()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setProperty)}},{key:"render",value:function(){var e=this.props.option.subItems||m.defaultShapeSubItems,t=(e=this.populateDefaultImageForToolArray(e)).map((function(e){return e.tool})),r=l.default.createElement(h.default,{selectedTool:this.state.tool,toolArray:e,onClick:this.handleToolChange}),i=l.default.createElement(f.default,{width:this.state.width,onWidthChange:this.handleWidthChange}),o=l.default.createElement(d.default,{color:this.state.color,onColorChange:this.handleColorChange}),a="horizontal"!==this.props.option.stack?{sections:[r,i,o]}:{leftSections:[r,i],rightSections:[o]},s="horizontal"==this.props.option.stack?380:210;return l.default.createElement(g.default,(0,n.default)({onClick:this.handleClick},this.props,{toolOptionalName:t,hideHint:"shape"===this.props.store.popup}),"shape"===this.props.store.popup&&l.default.createElement(p.default,(0,n.default)({},a,{store:this.props.store,width:s,baseItemWidth:this.props.itemSizeBase,baseItemPosition:this.props.containerPosition,baseItemShift:(this.props.sizeShiftTotal+.5)*this.props.itemSizeBase})))}}]),t}(u.Component);t.default=M},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.resetCamera()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.zoomIn()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.zoomOut()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.state={zoomFactor:1},e.nextZoomFactor=1,e.handleZoomFactorClick=function(){var t=e.props.store.handler;Math.abs(e.state.zoomFactor-1)>.01?(e.nextZoomFactor=e.state.zoomFactor,t.zoomTo(1)):(t.zoomTo(e.nextZoomFactor),e.nextZoomFactor=1)},e.setZoomFactor=function(t,r){"zoomFactor"===t&&e.setState({zoomFactor:r})},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setZoomFactor),this.setState({zoomFactor:this.props.store.handler.getZoomFactor()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setZoomFactor)}},{key:"render",value:function(){var e=this.props,t=e.option,r=e.itemSizeBase,n="tc-unit tc-unit-"+t.tool+(t.class?" "+t.class:""),i={width:r*(t.size?t.size:2),height:r,lineHeight:r+"px",textAlign:"center"},o=Math.round(100*this.state.zoomFactor)+"%";return u.default.createElement("div",{className:n,style:i,onClick:this.handleZoomFactorClick},o)}}]),t}(c.Component);t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.gotoFirstPage()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:this.props.store.currPageIndex<=0},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}r(484);var d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this.props,t=e.option,r=e.itemSizeBase,n="tc-unit tc-unit-"+t.tool+(t.class?" "+t.class:""),i={width:r*(t.size?t.size:2),height:r,lineHeight:r+"px",textAlign:"center"};return u.default.createElement("div",{className:n,style:i},this.props.store.currPageIndex+1," / ",this.props.store.pageNames.length)}}]),t}(c.Component);t.default=d},function(e,t,r){var n=r(485);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-unit.tc-unit-pageInfo:hover {\n    background-color: unset;\n    cursor: auto;\n}",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.gotoLastPage()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.store,t=e.currPageIndex,r=e.pageNames;return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:t===r.length-1},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.gotoPrevPage()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:0===this.props.store.currPageIndex},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.gotoNextPage()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.store,t=e.currPageIndex,r=e.pageNames;return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:t===r.length-1},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(235));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.store.previewSliderState;e.props.store.previewSliderPosition=e.props.option.previewSliderPosition,e.props.store.previewSliderState="close"===t||"default"===t?"open":"close",e.props.store.update()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.store.previewSliderState,t=this.props.option.previewSliderPosition,r=(0,n.default)({},this.props.option);return r.class||(r.class=""),-1===r.class.indexOf("preview-icon-"+t)&&(r.class+=" preview-icon-"+t),this.props.option.class=r.class,l.default.createElement(d.default,(0,n.default)({state:e,onClick:this.handleClick,hideHint:"open"===this.props.store.previewSliderState},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.store.handler;t.editable&&t.addLocalResource({type:"image"})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.emit("iconClick",e.props.option.tool)},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(235));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e){(0,o.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return r.handleClick=function(e){e.stopPropagation(),e.preventDefault();var t=r.props.option.clickCb(r.state.state);r.props.store.emit("iconClick",r.props.option.tool,{state:r.state.state,newState:t}),r.setState({state:t})},r.state={state:e.option.defaultState},r}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props,{state:this.state.state}))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.option,r="boolean"==typeof t.supportPptToH5&&t.supportPptToH5,n="boolean"!=typeof t.supportDocToPic||t.supportDocToPic;e.props.store.docStore.show(r,n),e.props.store.update()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(2)),i=p(r(0)),o=p(r(1)),a=p(r(3)),s=p(r(4)),c=r(7),u=p(c),l=p(r(392)),d=r(139);function p(e){return e&&e.__esModule?e:{default:e}}r(498);var f=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.state={dropDownOpen:!1,showAlert:!1,alertText:"",boardToDelete:""},e.hideDropdown=function(){e.state.showAlert||e.setState({dropDownOpen:!1})},e.handleClickSelectInput=function(){e.setState({dropDownOpen:!e.state.dropDownOpen})},e.handleDeleteBoard=function(t,r){e.setState({showAlert:!0,alertText:"是否删除文档: "+r+"? 删除后无法恢复",boardToDelete:t})},e.handleChooseBoard=function(t){t!==e.props.store.currBoard&&(e.props.store.handler.gotoBoard(t),e.setState({dropDownOpen:!1}))},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){(0,d.on)(document,"touchstart",this.hideDropdown),(0,d.on)(document,"mousedown",this.hideDropdown),(0,d.on)(document,"click",this.hideDropdown)}},{key:"componentWillUnmount",value:function(){(0,d.off)(document,"touchstart",this.hideDropdown),(0,d.off)(document,"mousedown",this.hideDropdown),(0,d.off)(document,"click",this.hideDropdown)}},{key:"render",value:function(){var e=this.props,t=e.option,r=e.itemSizeBase,n="tc-unit tc-unit-"+t.tool+(t.class?" "+t.class:""),i=r-8,o={width:r*(t.size?t.size:8),height:r,lineHeight:i+"px",textAlign:"center"},a=this.props.store.currBoardDisplayName,s=i/4;return u.default.createElement("div",{className:n,style:o},u.default.createElement("div",{className:"select-input "+(this.state.dropDownOpen?"open":"close"),onClick:this.handleClickSelectInput},u.default.createElement("div",{className:"board-name",style:{width:"calc(100% - "+(2*s+1)+"px)"}},a),this.renderArrow({borderUnit:s,lineHeight:i})),this.state.dropDownOpen&&this.renderDropdown(i),this.renderDeleteAlert())}},{key:"renderArrow",value:function(e){var t=e.borderUnit,r=e.lineHeight;return-1!==this.props.containerPosition.indexOf("bottom")?u.default.createElement("div",{className:"arrow",style:{borderWidth:t+"px",borderBottomWidth:2*t+"px",top:"-"+(r/2-t/2)+"px",borderBottom:1.5*t+"px solid black"}}):u.default.createElement("div",{className:"arrow",style:{borderWidth:t+"px",borderTopWidth:2*t+"px",bottom:"-"+(r/2-t/2)+"px",borderTop:1.5*t+"px solid black"}})}},{key:"renderDeleteAlert",value:function(){var e=this;return u.default.createElement(l.default,{showAlert:this.state.showAlert,alertText:this.state.alertText,onHide:function(){e.setState({showAlert:!1})},onConfirm:function(){e.props.store.handler.deleteBoard(e.state.boardToDelete),e.setState({showAlert:!1,dropDownOpen:!1})}})}},{key:"renderDropdown",value:function(e){var t=this,r=this.props.store,n=r.boardNames,i=r.currBoard;return u.default.createElement("div",{className:"dropdown"},n.map((function(n,o){var a="whiteboard"!==n,s="option"+(n===i?" selected":""),c=r.boardDisplayNames[o];return u.default.createElement("div",{className:s,onClick:function(){return t.handleChooseBoard(n)},style:{height:e+8+"px",lineHeight:e+8+"px"}},u.default.createElement("div",{className:"board-name"},c),a&&u.default.createElement("div",{className:"delete-btn",onClick:function(e){e.stopPropagation(),t.handleDeleteBoard(n,c)}}))})))}}]),t}(c.Component);t.default=f},function(e,t,r){var n=r(496);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){t=e.exports=r(24)(!1);var n=r(97)(r(497));t.push([e.i,".whiteboard-alert-mask {\n    position: fixed;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, .1);\n}\n\n.whiteboard-alert {\n    padding: 32px 32px 24px 32px;\n    width: 416px;\n    background: #ffffff;\n    border-radius: 2px;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n    \n    position: fixed;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    margin: auto;\n    max-width: 65%;\n    z-index: 999;\n}\n\n.whiteboard-alert .alert-body {\n        margin-bottom: 32px;\n    }\n\n.whiteboard-alert .alert-body .u-icon-tip {\n            position: relative;\n            top: 5px;\n            display: inline-block;\n            width: 22px;\n            height: 22px;\n            margin-right: 8px;\n            background: url("+n+") center center no-repeat;\n            background-size: 22px 22px;\n        }\n\n.whiteboard-alert .alert-button-group {\n        height: 32px;\n    }\n\n.whiteboard-alert .alert-button-group .btn {\n            float: right;\n            margin-right: 10px;\n            text-align: center;\n\n            width: 60px;\n            height: 32px;\n            line-height: 32px;\n            font-size: 14px;\n            border-radius: 2px\n        }\n\n.whiteboard-alert .alert-button-group .btn:hover {\n                cursor: pointer;\n            }\n\n.whiteboard-alert .alert-button-group .alert-confirm {\n            background-color: #076bf2;\n            color: white;\n        }\n\n.whiteboard-alert .alert-button-group .alert-cancel {\n            background-color: #e3e6ec;\n            color: #313c4c;\n        }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHZpZXdCb3g9IjAgMCAyMiAyMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMSAyMS4zMTI1QzUuMzA0NTYgMjEuMzEyNSAwLjY4NzUgMTYuNjk1NCAwLjY4NzUgMTFDMC42ODc1IDUuMzA0NTYgNS4zMDQ1NiAwLjY4NzUgMTEgMC42ODc1QzE2LjY5NTQgMC42ODc1IDIxLjMxMjUgNS4zMDQ1NiAyMS4zMTI1IDExQzIxLjMxMjUgMTYuNjk1NCAxNi42OTU0IDIxLjMxMjUgMTEgMjEuMzEyNVpNMTAuOTU1MyAxNC41NjU3QzEwLjM5NTUgMTQuNTY1NyA5Ljk0MTczIDE1LjAxOTQgOS45NDE3MyAxNS41NzkyQzkuOTQxNzMgMTYuMTM5IDEwLjM5NTUgMTYuNTkyOCAxMC45NTUzIDE2LjU5MjhDMTEuNTE1MSAxNi41OTI4IDExLjk2ODkgMTYuMTM5IDExLjk2ODkgMTUuNTc5MkMxMS45Njg5IDE1LjAxOTQgMTEuNTE1MSAxNC41NjU3IDEwLjk1NTMgMTQuNTY1N1pNMTEuMDg5MSA1LjI2ODY3QzkuOTcxNzcgNS4yNjg2NyA5LjA5Mzg0IDUuNjEzNTcgOC40NjU3NSA2LjMwNDQ2QzcuODQ3NCA2Ljk1MzY4IDcuNTQ0NDEgNy44MjM3OSA3LjU0NDQxIDguOTE4MzRMNy42ODU4NCA5LjA1OTc3SDguODcwMjVMOS4wMTE2OCA4LjkxODM0QzkuMDExNjggOC4yMTUxMSA5LjE2Njk1IDcuNjc1MTggOS40NzYyMSA3LjI4MTU4QzkuODA4NjQgNi44MjQ2NiAxMC4zMTc5IDYuNjAxIDExLjAyOTIgNi42MDFDMTEuNjM1NiA2LjYwMSAxMi4wODcyIDYuNzU5NTcgMTIuMzk2MyA3LjA4MjE2QzEyLjcwNjIgNy4zOTIxMiAxMi44NjY4IDcuODI0ODEgMTIuODY2OCA4LjM3ODYxQzEyLjg2NjggOC43NjI5OSAxMi43Mjk5IDkuMTIyMjggMTIuNDQ4IDkuNDc0NjdDMTIuMzc0OCA5LjU3MjEgMTIuMjcxNiA5LjY3OTg0IDExLjk0ODcgMTAuMDAyN0MxMS4xMzQgMTAuNzI2NiAxMC42MjY4IDExLjMwOTQgMTAuNDA2MyAxMS43ODIxQzEwLjIxNzQgMTIuMTc1NSAxMC4xMjMxIDEyLjYzMTIgMTAuMTIzMSAxMy4xNDYyVjEzLjQ5MTFMMTAuMjY0NiAxMy42MzI1SDExLjQ2NEwxMS42MDU0IDEzLjQ5MTFDMTEuNjA1NCAxMy4wMTQzIDExLjcxNTEgMTIuMzg2OSAxMS44NzA2IDEyLjEyMzdDMTIuMDE3OCAxMS44NTg4IDEyLjIzNjEgMTEuNjAxOCAxMi41NDU5IDExLjMzNDJDMTMuMTg0NSAxMC43NjgyIDEzLjYxMjggMTAuMzU5NyAxMy43NzY1IDEwLjE2MzNDMTQuMTc3NiA5LjYzNDE1IDE0LjM3OSA5LjAxODAxIDE0LjM3OSA4LjMxODY0QzE0LjM3OSA3LjM4NTgxIDE0LjA4MTkgNi42NDEwOCAxMy40OTM3IDYuMTAwNTZDMTIuODg2NiA1LjU0MDIxIDEyLjA5MTQgNS4yNjg2NyAxMS4wODkxIDUuMjY4NjdaIiBmaWxsPSIjRkZBRjBGIi8+Cjwvc3ZnPgo="},function(e,t,r){var n=r(499);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){t=e.exports=r(24)(!1);var n=r(97)(r(411));t.push([e.i,".tc-container-bottom .dropdown, .tc-container-bottomLeft .dropdown, .tc-container-bottomRight .dropdown {\n        position: absolute;\n        bottom: 100%;\n        left: 0;\n        right: 0;\n    }\n\n.tc-container-top .dropdown, .tc-container-topLeft .dropdown, .tc-container-topRight .dropdown {\n        position: relative;\n        bottom: -3px;\n    }\n\n.tc-unit-docSelect {\n    padding: 0 5px\n}\n\n.tc-unit-docSelect:hover {\n        background-color: unset !important;\n    }\n\n.tc-unit-docSelect .select-input {\n        padding: 3px 5px 3px 12px;\n        text-align: left;\n        border: 1px solid #D9D9DB;\n        height: 100%;\n        box-sizing: border-box\n    }\n\n.tc-unit-docSelect .select-input.open {\n            color: #bfbfbf;\n        }\n\n.tc-unit-docSelect .select-input.open .down-arrow {\n                border-top-color: #bfbfbf;\n            }\n\n.tc-unit-docSelect .select-input .board-name {\n            display: inline-block;\n            height: 100%;\n            vertical-align: middle;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            padding: 0 5px 0 0;\n            text-align: left;\n            box-sizing: border-box;\n        }\n\n.tc-unit-docSelect .select-input .arrow {\n            display: inline-block;\n            width: 0;\n            height: 100%;\n            line-height: 100%;\n            vertical-align: middle;        \n            border: 5px solid transparent;\n            overflow: hidden;\n            box-sizing: border-box;\n            position: relative;\n        }\n\n.tc-unit-docSelect .dropdown {\n        box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n    }\n\n.tc-unit-docSelect .dropdown .option {\n            background-color: white;\n            background: white;\n            padding: 0 4px 0 12px;\n            text-align: left\n        }\n\n.tc-unit-docSelect .dropdown .option.selected {\n                color: #337EFF;\n            }\n\n.tc-unit-docSelect .dropdown .option:hover {\n                background-color: #f5f5f5;\n            }\n\n.tc-unit-docSelect .dropdown .option:hover .delete-btn {\n                    display: inline-block;\n                }\n\n.tc-unit-docSelect .dropdown .option .board-name{\n                display: inline-block;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n                text-align: left;\n                width: calc(100% - 30px);\n                overflow: hidden;\n            }\n\n.tc-unit-docSelect .dropdown .option .delete-btn {\n                display: none;\n                width: 30px;\n                height: 30px;\n                background-image: url("+n+");\n                background-size: contain;\n                vertical-align: top;\n                position: relative;\n            }",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}r(501);var d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this.props,t=e.option,r=e.itemSizeBase,n="tc-unit tc-unit-"+t.tool+(t.class?" "+t.class:""),i=r*(t.size?t.size:5),o={width:"fit-content",height:r,lineHeight:r+"px",verticalAlign:"middle",textAlign:"center"},a=this.props.store.currPageIndex+1+"/"+this.props.store.pageNames.length,s=""+this.props.store.currBoardDisplayName,c=Math.floor(8*a.toString().length),l=i-c;return u.default.createElement("div",{className:n,style:o},u.default.createElement("div",{className:"boardName",style:{width:l,maxWidth:"fit-content",height:r,lineHeight:r+"px",verticalAlign:"middle"}},s),u.default.createElement("div",{className:"pageInfo",style:{width:c,height:r,lineHeight:r+"px",verticalAlign:"middle"}},a))}}]),t}(c.Component);t.default=d},function(e,t,r){var n=r(502);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,"\n    .tc-unit-pageBoardInfo.tc-unit:hover {\n        background-color: unset;\n        cursor: auto;\n    }\n.tc-unit-pageBoardInfo .boardName {\n        display: inline-block;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        padding-left: 4px;\n        box-sizing: border-box;\n    }\n.tc-unit-pageBoardInfo .pageInfo {\n        display: inline-block;\n    }",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(235));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){"broadcaster"===e.props.store.visionMode?e.props.store.handler.unsetSelfAsBroadcaster():e.props.store.handler.setSelfAsBroadcaster(),e.props.store.update()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.store.visionMode,t=(0,n.default)({},this.props.option);return t.class||(t.class=""),this.props.option.class=t.class,l.default.createElement(d.default,(0,n.default)({state:"broadcaster"===e?"broadcasting":"not-broadcasting",onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(235));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.isAvailable=function(){var t=e.props.store,r=t.visionMode,n=t.isBroadcasting;return("follower"===r||"freeObserver"===r)&&n},e.handleClick=function(){var t=e.props.store,r=t.visionMode,n=t.handler;e.isAvailable()&&("follower"===r?n.setSelfAsFreeObserver():n.setSelfAsFollower(),e.props.store.update())},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.store.visionMode,t=(0,n.default)({},this.props.option);t.class||(t.class=""),this.props.option.class=t.class;var r=!this.isAvailable(),i="unlock",o=this.props.option.hint;return r||"follower"!==e?r||"freeObserver"!==e||(i="unlock-activate",o="点击进入视角同步"):(i="lock-activate",o="点击解除视角同步"),t.hint=o,l.default.createElement(d.default,(0,n.default)({unavailable:r,state:i,onClick:this.handleClick},this.props,{option:t}))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.exportAsImage()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(235));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={nextMode:"fit-to-content"},e.handleClick=function(){var t=e.props.store.handler;"fit-to-content"===e.state.nextMode?(t.fitToContent(),t.hasBackground()&&e.setState({nextMode:"fit-to-doc"})):(t.fitToDoc(),e.setState({nextMode:"fit-to-content"})),e.props.store.update()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=(0,n.default)({},this.props.option);e.class||(e.class=""),this.props.option.class=e.class;var t=void 0,r=this.props.option.hint;return"fit-to-content"===this.state.nextMode?(r="适配内容",t="content"):"fit-to-doc"===this.state.nextMode&&(r="适配文档",t="doc"),e.hint=r,l.default.createElement(d.default,(0,n.default)({state:t,onClick:this.handleClick},this.props,{option:e}))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.fitToContent()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=(0,n.default)({},this.props.option);return e.class||(e.class=""),this.props.option.class=e.class,l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.store.handler;t.hasBackground()&&t.fitToDoc()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=(0,n.default)({},this.props.option);e.class||(e.class=""),this.props.option.class=e.class;var t=this.props.store.handler;return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:!t.hasBackground()},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=h(r(5)),i=h(r(2)),o=h(r(0)),a=h(r(1)),s=h(r(3)),c=h(r(4)),u=r(7),l=h(u),d=h(r(22));r(510);var p=r(402),f=h(r(138));function h(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.renderSubItems=function(){var t=e.props.option,r=t.subItems,n=t.itemPerRow;n=n||4;var i=r.slice(),o=0,a=n;i.length>n?i.length%n>0&&(o=n-i.length%n):a=i.length;for(var s=0;s<o;s++)i.push(null);var c=l.default.createElement("div",{className:"tc-multiInOne-popup"},i.map((function(t){return null===t?l.default.createElement("div",{className:"tc-multiInOne-item"}):l.default.createElement("div",{className:"tc-multiInOne-item"},e.renderSubItem(t))})));return l.default.createElement(f.default,{width:e.props.itemSizeBase*a+a+32,store:e.props.store,baseItemWidth:e.props.itemSizeBase,baseItemPosition:e.props.containerPosition,baseItemShift:(e.props.sizeShiftTotal+.5)*e.props.itemSizeBase,sections:[c]})},e.handleClick=function(t,r){var n=e.props.option.key;r.currPopup===n?e.props.store.popup=void 0:e.props.store.popup=n,"open"===e.props.store.previewSliderState&&(e.props.store.previewSliderState="close"),e.props.store.update()},e.handleAfterClickSubItem=function(){var t=e.props.option.key;e.props.store.popup=t,e.props.store.update()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.option.key;return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,hideHint:this.props.store.popup===e},this.props),this.props.store.popup===e&&this.renderSubItems())}},{key:"renderSubItem",value:function(e){var t=(0,p.getComponentByToolName)(e.tool);return l.default.createElement(t,{itemSizeBase:this.props.itemSizeBase,store:this.props.store,option:e,containerPosition:this.props.containerPosition,onAfterClick:this.handleAfterClickSubItem})}}]),t}(u.Component);t.default=m},function(e,t,r){var n=r(511);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-multiInOne-popup {\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n}\n\n    .tc-multiInOne-popup .tc-multiInOne-item {\n        flex: 1\n    }\n\n.tc-unit-multiInOne {\n    position: relative;\n}",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(5)),i=m(r(19)),o=m(r(2)),a=m(r(0)),s=m(r(1)),c=m(r(3)),u=m(r(4)),l=r(7),d=m(l),p=r(29),f=m(r(32)),h=m(r(22));function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(){(0,a.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments));return e.state={available:!1},e.isUploading=!1,e.handleClick=function(){var t=e.props.store;if(e.isUploading)return(0,p.showToast)({msg:"正在上传中，请勿重复点击",time:100,type:"info",msgType:f.default.LOG_FILE_UPLOAD_THROTTLE});(0,p.showToast)({msg:"正在上传中，大概需要5-10s",type:"info",time:100,msgType:f.default.LOG_FILE_IS_UPLOADING}),e.isUploading=!0,(t.handler.isG1?window.yunxinWbLogUpload_g1:window.yunxinWbLogUpload)().then((function(t){(0,p.showToast)({msg:t,type:"success",time:100,msgType:f.default.LOG_FILE_UPLOAD_SUCCEED}),e.isUploading=!1})).catch((function(t){"string"!=typeof t&&(t=(0,i.default)(t)),(0,p.showToast)({msg:t,type:"error",time:100,msgType:f.default.LOG_FILE_UPLOAD_FAIL}),e.isUploading=!1}))},e}return(0,u.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){return d.default.createElement(h.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(l.Component);t.default=g},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=m(r(5)),i=m(r(2)),o=m(r(0)),a=m(r(1)),s=m(r(3)),c=m(r(4)),u=r(7),l=m(u),d=m(r(514)),p=m(r(138)),f=r(141),h=m(r(22));function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={color:"black"},e.handleClick=function(t,r){"platte"===r.currPopup?e.props.store.popup=void 0:e.props.store.popup="platte",e.props.store.update()},e.handleColorChange=function(t){e.props.store.handler.setColor(t)},e.setProperty=function(t,r){"renderColor"===t&&e.setState({color:r})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setProperty),this.setState({color:this.props.store.handler.getColor()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setProperty)}},{key:"render",value:function(){var e=l.default.createElement(d.default,{color:this.state.color,colorArray:this.props.option.colorArray||f.DEFAULT_COLORS2,onColorChange:this.handleColorChange});return l.default.createElement(h.default,(0,n.default)({onClick:this.handleClick},this.props,{hideHint:"platte"===this.props.store.popup}),"platte"===this.props.store.popup&&l.default.createElement(p.default,(0,n.default)({},{sections:[e]},{store:this.props.store,width:210,baseItemWidth:this.props.itemSizeBase,baseItemPosition:this.props.containerPosition,baseItemShift:(this.props.sizeShiftTotal+.5)*this.props.itemSizeBase})))}}]),t}(u.Component);t.default=g},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}r(515);var d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){for(var e=this,t=this.props.colorArray,r=t.length%4,n=r>0?4-r:0,i=[],o=0;o<n;o++)i.push(o);return u.default.createElement("div",{className:"tc-color-platte2",onClick:function(e){return e.stopPropagation()}},t.map((function(t,r){var n=t.color,i=t.border?"1px solid "+t.border:"none",o=e.props.color===n?"tc-color-cell-wrapper selected":"tc-color-cell-wrapper";return u.default.createElement("div",{key:r,className:o,onClick:function(t){t.stopPropagation(),e.props.onColorChange(n)}},u.default.createElement("div",{className:"tc-color-cell",style:{backgroundColor:n,border:i}}))})),i.map((function(e){return u.default.createElement("div",{key:"pad"+e,className:"tc-color-cell-wrapper",style:{pointer:"none"},onClick:function(e){e.stopPropagation()}},u.default.createElement("div",{className:"tc-color-cell",style:{backgroundColor:"rgba(0,0,0,0)"}}))})))}}]),t}(c.Component);t.default=d},function(e,t,r){var n=r(516);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-color-platte2 {\n    flex-direction: row;\n    flex-wrap: nowrap;\n    width: 100%;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-around;\n}\n    \n    .tc-color-platte2 .tc-color-cell-wrapper {\n        width: 40px;\n        height: 40px;\n        padding: 6px;\n        border-radius: 12px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        box-sizing: border-box\n    }\n    \n    .tc-color-platte2 .tc-color-cell-wrapper.selected {\n            outline: 1px solid #337EFF;\n        }\n    \n    .tc-color-platte2 .tc-color-cell-wrapper:hover {\n            cursor: pointer;\n        }\n    \n    .tc-color-platte2 .tc-color-cell-wrapper .tc-color-cell {\n            width: 100%;\n            height: 100%;\n            border-radius: 100%;\n        }",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=h(r(5)),i=h(r(2)),o=h(r(0)),a=h(r(1)),s=h(r(3)),c=h(r(4)),u=r(7),l=h(u),d=h(r(138)),p=h(r(243)),f=h(r(22));function h(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={width:5},e.handleClick=function(t,r){"widthResize"===r.currPopup?e.props.store.popup=void 0:e.props.store.popup="widthResize",e.props.store.update()},e.handleWidthChange=function(t){e.props.store.handler.setStrokeWidth(t.target.value)},e.setProperty=function(t,r){"renderWidth"===t&&e.setState({width:r})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setProperty),this.setState({width:this.props.store.handler.getStrokeWidth()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setProperty)}},{key:"render",value:function(){var e=this.props.option.min,t=this.props.option.max,r=this.props.option.step,i=l.default.createElement(p.default,{width:this.state.width,onWidthChange:this.handleWidthChange,min:e,max:t,step:r});return l.default.createElement(f.default,(0,n.default)({onClick:this.handleClick},this.props,{hideHint:"widthResize"===this.props.store.popup}),"widthResize"===this.props.store.popup&&l.default.createElement(d.default,(0,n.default)({},{sections:[i]},{store:this.props.store,width:210,baseItemWidth:this.props.itemSizeBase,baseItemPosition:this.props.containerPosition,baseItemShift:(this.props.sizeShiftTotal+.5)*this.props.itemSizeBase})))}}]),t}(u.Component);t.default=m},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=h(r(5)),i=h(r(2)),o=h(r(0)),a=h(r(1)),s=h(r(3)),c=h(r(4)),u=r(7),l=h(u),d=h(r(138)),p=h(r(243)),f=h(r(22));function h(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={opacity:1},e.handleClick=function(t,r){"opacity"===r.currPopup?e.props.store.popup=void 0:e.props.store.popup="opacity",e.props.store.update()},e.handleOpacityChange=function(t){e.props.store.handler.setOpacity(t.target.value)},e.setProperty=function(t,r){"opacity"===t&&e.setState({opacity:r})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.store.handler.on("event:appState:change",this.setProperty),this.setState({opacity:this.props.store.handler.getOpacity()})}},{key:"componentWillUnmount",value:function(){this.props.store.handler.off("event:appState:change",this.setProperty)}},{key:"render",value:function(){var e=this.props.option.min||.1,t=this.props.option.max||1,r=this.props.option.step||.01,i=l.default.createElement(p.default,{width:this.state.opacity,onWidthChange:this.handleOpacityChange,min:e,max:t,step:r,leftText:e.toString(),rightText:t.toString()});return l.default.createElement(f.default,(0,n.default)({onClick:this.handleClick},this.props,{hideHint:"opacity"===this.props.store.popup}),"opacity"===this.props.store.popup&&l.default.createElement(d.default,{sections:[i],store:this.props.store,width:210,baseItemWidth:this.props.itemSizeBase,baseItemPosition:this.props.containerPosition,baseItemShift:(this.props.sizeShiftTotal+.5)*this.props.itemSizeBase}))}}]),t}(u.Component);t.default=m},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=M(r(5)),i=M(r(2)),o=M(r(0)),a=M(r(1)),s=M(r(3)),c=M(r(4)),u=r(7),l=M(u),d=M(r(138)),p=M(r(520)),f=M(r(22)),h=M(r(390)),m=M(r(405)),g=M(r(406)),v=M(r(407)),y=M(r(391)),b=M(r(408)),S=M(r(409)),_=M(r(410));function M(e){return e&&e.__esModule?e:{default:e}}var T=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.state={tool:"pen"},e.pickImgFromToolArr=function(t,r){for(var n=0;n<r.length;n++)if(r[n].tool===t)return r[n].backgroundImage?r[n].backgroundImage:e.getBackgroundImageOfTool("pen");return e.getBackgroundImageOfTool("pen")},e.populateDefaultImageForToolArray=function(t){return t.map((function(t){return t.backgroundImage||(t.backgroundImage=e.getBackgroundImageOfTool(t.tool)),t}))},e.getBackgroundImageOfTool=function(e){switch(e){case"pen":return h.default;case"pen-arrow":return g.default;case"line":return m.default;case"line-arrow":return v.default;case"rect":return y.default;case"rect-fill":return S.default;case"ellipse":return b.default;case"ellipse-fill":return _.default;default:return console.error("无法获取图形工具"+e+"的背景图片"),""}},e.handleClick=function(t,r){"shapeSelect"===r.currPopup?e.props.store.popup=void 0:e.props.store.popup="shapeSelect",e.props.store.updateSelectedTool(e.state.tool),e.props.store.update()},e.handleToolChange=function(t){e.props.store.updateSelectedTool(t),e.setState({tool:t})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){var e=this.props.option.subItems||[],t=(e=this.populateDefaultImageForToolArray(e)).map((function(e){return e.tool})),r=l.default.createElement(p.default,{selectedTool:this.state.tool,toolArray:e,onClick:this.handleToolChange});return this.props.option.backgroundImage=this.pickImgFromToolArr(this.state.tool,e),l.default.createElement(f.default,(0,n.default)({onClick:this.handleClick},this.props,{toolOptionalName:t,hideHint:"shapeSelect"===this.props.store.popup}),"shapeSelect"===this.props.store.popup&&l.default.createElement(d.default,{sections:[r],store:this.props.store,width:210,baseItemWidth:this.props.itemSizeBase,baseItemPosition:this.props.containerPosition,baseItemShift:(this.props.sizeShiftTotal+.5)*this.props.itemSizeBase}))}}]),t}(u.Component);t.default=T},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(2)),i=d(r(0)),o=d(r(1)),a=d(r(3)),s=d(r(4)),c=r(7),u=d(c),l=d(r(244));function d(e){return e&&e.__esModule?e:{default:e}}r(521);var p=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this,t=this.props.toolArray.slice(),r=4-t.length%4;r=4===r?0:r;for(var n=0;n<r;n++)t.push(null);return u.default.createElement("div",{className:"tc-tool-select-multi-container",onClick:function(e){return e.stopPropagation()}},t.map((function(t){var r=void 0;return r=null===t?u.default.createElement("div",{className:"tc-tool-select-cell",style:{visibility:"hidden"}}):u.default.createElement("div",{className:"tc-tool-select-cell tc-unit-"+t.tool+(e.props.selectedTool===t.tool?" selected":""),style:{backgroundImage:"url("+t.backgroundImage+")"},onClick:function(r){r.stopPropagation(),e.props.onClick(t.tool)}}),t&&t.hint&&(r=u.default.createElement(l.default,{hint:t.hint,containerPosition:"bottom"},r)),u.default.createElement("div",{className:"tc-tool-select-cell-wrapper"},r)})))}}]),t}(c.Component);t.default=p},function(e,t,r){var n=r(522);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-tool-select-multi-container {\n    width: 100%;\n    display: flex;\n    justify-content: space-around;\n    flex-wrap: wrap;\n}\n\n    .tc-tool-select-multi-container .tc-tool-select-cell-wrapper {\n        width: 40px;\n        height: 40px;\n    }\n\n    .tc-tool-select-multi-container .tc-tool-select-cell-wrapper .selected {\n            outline: 1px solid #337EFF;\n            width: 100%;\n            height: 100%;\n        }\n\n    .tc-tool-select-multi-container .tc-tool-select-cell-wrapper .tc-tool-select-cell {\n            width: 100%;\n            height: 100%;\n            background-size: contain;\n        }",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.store.handler;t.editable&&t.addLocalResource({type:"video"})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.store.handler;t.editable&&t.addLocalResource({type:"audio"})},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.nextAnim()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:!1},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){e.props.store.handler.prevAnim()},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick,unavailable:!1},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.store.handler;"dot-world"===t.getBgRendererName()?t.unsetCustomBackground():t.setCustomBackground("world",(function(e){var t=e.rect,r=e.ctx,n=80*Math.floor((t.centerX-t.width/2)/80),i=80*Math.floor((t.centerY-t.height/2)/80);r.beginPath();for(var o=0;n+o<t.centerX+t.width/2;o+=80)for(var a=0;i+a<t.centerY+t.height/2;a+=80)r.moveTo(n+o,i+a),r.arc(n+o,i+a,3,0,2*Math.PI);var s=Math.max(.9-Math.sqrt(e.zoom),.15);r.fillStyle="rgba(0, 0, 0, "+s+")",r.fill()}),"dot-world")},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(5)),i=f(r(2)),o=f(r(0)),a=f(r(1)),s=f(r(3)),c=f(r(4)),u=r(7),l=f(u),d=f(r(22)),p=r(529);function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.store.handler;"line-world"===t.getBgRendererName()?t.unsetCustomBackground():t.setCustomBackground("world",(function(e){var t=e.rect,r=e.ctx,n=(0,p.findBestGap)(e,35,5),i=n.gapInWorld,o=n.gapInContainer,a=(0,p.findSxy)(e,5*i),s=a.sx,c=a.sy;r.beginPath();for(var u=-1,l=0;s+l<t.centerX+t.width/2;l+=i)++u%5!=0&&(r.moveTo(s+l,c),r.lineTo(s+l,t.centerY+t.height/2));u=-1;for(var d=0;c+d<t.centerY+t.height/2;d+=i)++u%5!=0&&(r.moveTo(s,c+d),r.lineTo(t.centerX+t.width/2,c+d));r.lineWidth=1/e.zoom;var f=.2*Math.sqrt(Math.min((o-35)/140,1));r.strokeStyle="rgba(120, 120, 120, "+f+")",r.stroke(),r.beginPath();for(var h=0;s+h<t.centerX+t.width/2;h+=5*i)r.moveTo(s+h,c),r.lineTo(s+h,t.centerY+t.height/2);for(var m=0;c+m<t.centerY+t.height/2;m+=5*i)r.moveTo(s,c+m),r.lineTo(t.centerX+t.width/2,c+m);r.lineWidth=1/e.zoom,r.strokeStyle="rgba(120, 120, 120, 0.2)",r.stroke()}),"line-world")},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.findBestGap=function(e,t,r){for(var n=e.width,i=e.rect,o=t,a=void 0;;)if((a=n/(i.width/o))<t)o*=r;else{if(!(a>t*r))break;o/=r}return{gapInWorld:o,gapInContainer:a}},t.findSxy=function(e,t){for(var r=e.rect,n=0,i=0,o=r.centerX-r.width/2,a=r.centerY-r.height/2;;)if(n>o)n-=t;else{if(!(n+2*t<o))break;n+=t}for(;;)if(i>a)i-=t;else{if(!(i+2*t<a))break;i+=t}return{sx:n,sy:i}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=p(r(5)),i=p(r(2)),o=p(r(0)),a=p(r(1)),s=p(r(3)),c=p(r(4)),u=r(7),l=p(u),d=p(r(22));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.handleClick=function(){var t=e.props.store.handler;"line-container"===t.getBgRendererName()?t.unsetCustomBackground():t.setCustomBackground("container",(function(e){var t=e.width*e.DPI,r=e.height*e.DPI,n=e.DPI,i=e.ctx,o=90*n;i.beginPath();for(var a=0;a<t;a+=o)i.moveTo(a,0),i.lineTo(a,r);for(var s=0;s<r;s+=o)i.moveTo(0,s),i.lineTo(t,s);i.strokeStyle="rgba(0, 0, 0, 0.15)",i.stroke()}),"line-container")},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"render",value:function(){return l.default.createElement(d.default,(0,n.default)({onClick:this.handleClick},this.props))}}]),t}(u.Component);t.default=f},function(e,t,r){var n=r(532);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".tc-container {\n    box-sizing: content-box;\n    position: absolute;\n    background: #FFFFFF;\n    border-radius: 4px;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n    padding: 4px;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n    display: flex;\n    flex-direction: row;\n}\n\n.tc-container-left, .tc-container-leftTop, .tc-container-leftBottom, .tc-container-right, .tc-container-rightTop, .tc-container-rightBottom {\n    flex-direction: column;\n}\n\n.tc-container-left, .tc-container-right {\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.tc-container-top, .tc-container-bottom {\n    left: 50%;\n    transform: translateX(-50%);\n}\n\n.tc-container-left, .tc-container-leftTop, .tc-container-topLeft, .tc-container-bottomLeft, .tc-container-leftBottom {\n    left: 0;\n}\n\n.tc-container-right, .tc-container-rightTop, .tc-container-topRight, .tc-container-bottomRight, .tc-container-rightBottom {\n    right: 0;\n}\n\n.tc-container-topLeft, .tc-container-leftTop, .tc-container-top, .tc-container-rightTop, .tc-container-topRight {\n    top: 0\n}\n\n.tc-container-bottomLeft, .tc-container-leftBottom, .tc-container-bottom, .tc-container-rightBottom, .tc-container-bottomRight {\n    bottom: 0\n}",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=v(r(2)),i=v(r(0)),o=v(r(1)),a=v(r(3)),s=v(r(4)),c=r(7),u=v(c),l=r(389),d=v(r(534)),p=v(r(537)),f=v(r(540)),h=v(r(392));r(544);var m=r(29),g=v(r(32));function v(e){return e&&e.__esModule?e:{default:e}}var y=["doc","docx","pdf","ppt","pptx"],b=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.picInputRef=(0,c.createRef)(),e.pptInputRef=(0,c.createRef)(),e.state={showAlert:!1,alertText:"",docIdToDelete:void 0},e.handleClickTransPic=function(){e.picInputRef.current&&e.picInputRef.current.click()},e.handleClickTransPpt=function(){e.pptInputRef.current&&e.pptInputRef.current.click()},e.onPicInputChange=function(t){var r=e.props.docStore,n=t.target.files[0];if(n&&n.size&&n.size>104857600)return(0,m.showToast)({msg:"文件大小不能超过100M",type:"error",msgType:g.default.FILE_SIZE_EXCEED_LIMIT});var i=n.name.split("."),o=i[i.length-1];-1!==y.indexOf(o.toLowerCase())?r.uploadFile(t.target,"jpg"):(0,m.showToast)({msg:"当前仅支持"+y.join(",")+"格式文件",time:3,type:"error",msgType:g.default.FILE_ACCEPTED_TYPE_LIMIT})},e.onPptInputChange=function(t){var r=e.props.docStore,n=t.target.files[0];if(n&&n.size&&n.size>104857600)return(0,m.showToast)({msg:"文件大小不能超过100M",type:"error",msgType:g.default.FILE_SIZE_EXCEED_LIMIT});var i=n.name.split("."),o=i[i.length-1];-1!==["ppt","pptx"].indexOf(o.toLowerCase())?r.uploadFile(t.target,"h5"):(0,m.showToast)({msg:"当前仅支持ppt, pptx格式文件",time:3,type:"error",msgType:g.default.FILE_ACCEPTED_TYPE_LIMIT})},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){return this.props.docStore.visible?u.default.createElement("div",null,u.default.createElement("div",{className:"u-mask"}),u.default.createElement("div",{className:"docUpload-popup"},this.renderHeader(),this.renderBody(),this.renderFooter(),this.renderDeleteAlert())):null}},{key:"renderHeader",value:function(){var e=this.props,t=e.docStore,r=e.onHide;return u.default.createElement("div",{className:"docUpload-header"},u.default.createElement("span",null,"文档库"),u.default.createElement("i",{className:"u-icon iconfont",onClick:function(){return r()}}),t.showFileTip&&u.default.createElement(p.default,{message:"关闭文档库窗口，不影响上传",time:5}))}},{key:"renderBody",value:function(){var e=this,t=this.props.docStore;return u.default.createElement("div",{className:"docUpload-body "+(0===t.fileList.length?"empty":"")},t.fileList.map((function(t){return u.default.createElement("div",{key:t.docId,className:"m-kit-file-item"},u.default.createElement("div",{className:"m-kit-file-content"},u.default.createElement("div",{className:"m-kit-file-item-preview "+t.fileType}),u.default.createElement("div",{className:"m-kit-file-item-desc"},t.name),e.renderState(t)),u.default.createElement(d.default,{percent:t.percent,visible:!0}))})))}},{key:"renderFooter",value:function(){var e=this.props.docStore;return this.props.supportDocToPic||this.props.supportPptToH5?u.default.createElement("div",{className:"docUpload-footer"},e.showFileTip&&u.default.createElement(p.default,{message:"上传文档不超过100页",time:5}),u.default.createElement("input",{ref:this.picInputRef,multiple:!1,onChange:this.onPicInputChange,type:"file",accept:y.map((function(e){return"."+e})).join(","),className:"m-kit-file-select"}),u.default.createElement("input",{ref:this.pptInputRef,multiple:!1,onChange:this.onPptInputChange,type:"file",accept:".ppt,.pptx",className:"m-kit-file-select"}),this.props.supportPptToH5&&this.props.supportDocToPic&&u.default.createElement("div",null,u.default.createElement("span",{className:"m-kit-file-upload two-mode"},u.default.createElement("span",{className:"btn",onClick:this.handleClickTransPpt},"动态课件转码"),u.default.createElement("span",{className:"info"},"支持ppt(x)转成html")),u.default.createElement("span",{className:"splitter"}),u.default.createElement("span",{className:"m-kit-file-upload two-mode"},u.default.createElement("span",{className:"btn",onClick:this.handleClickTransPic},"静态课件转码"),u.default.createElement("span",{className:"info"},"支持ppt(x), doc(x), pdf转成图片"))),this.props.supportDocToPic&&!this.props.supportPptToH5&&u.default.createElement("span",{className:"m-kit-file-upload one-mode"},u.default.createElement("span",{className:"btn",onClick:this.handleClickTransPic},"静态课件转码"),u.default.createElement("span",{className:"info"},"支持ppt(x), doc(x), pdf转成图片")),this.props.supportPptToH5&&!this.props.supportDocToPic&&u.default.createElement("span",{className:"m-kit-file-upload one-mode"},u.default.createElement("span",{className:"btn",onClick:this.handleClickTransPic},"动态课件转码"),u.default.createElement("span",{className:"info"},"支持ppt(x)转成html"))):null}},{key:"renderState",value:function(e){var t=this,r=null,n=-1!==["ios","android"].indexOf(this.props.platform);return e.state==l.FileState.TRANS_COMPLETE&&(r=u.default.createElement("div",{className:"m-kit-file-item-option"},u.default.createElement(f.default,{onClick:function(){return t.useFile(e)}},"使用"),u.default.createElement(f.default,{className:"u-btn-white",onClick:function(){return t.deleteFile(e)},visibility:e.showDelete?"visible":"hidden"},"删除"))),e.state!=l.FileState.TRANS_FAIL&&e.state!=l.FileState.UPLOAD_FAIL&&e.state!=l.FileState.UPLOAD_COMPLETE||(r=u.default.createElement("div",{className:"m-kit-file-item-option"},u.default.createElement("div",{className:"file-state"},u.default.createElement("span",null,l.FileStateToText[e.state])),u.default.createElement(f.default,{className:"u-btn-white",onClick:function(){return t.deleteFile(e)}},"删除"))),e.state!=l.FileState.TRANS_IN_PROGRESS&&e.state!=l.FileState.UPLOAD_IN_PROGRESS||(r=u.default.createElement("div",{className:"m-kit-file-item-option"},u.default.createElement("div",{className:"file-state"},u.default.createElement("span",null,l.FileStateToText[e.state]),!n&&u.default.createElement("span",null,"(",e.percent||0,"%)")),u.default.createElement(f.default,{className:"u-btn-white",onClick:function(){return t.deleteFile(e)}},"删除"))),r}},{key:"renderDeleteAlert",value:function(){var e=this,t=this.props.docStore;return u.default.createElement(h.default,{showAlert:this.state.showAlert,alertText:this.state.alertText,onHide:function(){e.setState({showAlert:!1})},onConfirm:function(){t.deleteFile(e.state.docIdToDelete),e.setState({showAlert:!1})}})}},{key:"useFile",value:function(e){var t=this.props.docStore;t.setFileKitEnable(!1),t.useFile(e)}},{key:"deleteFile",value:function(e){this.setState({showAlert:!0,alertText:"确定要删除该文件吗?",docIdToDelete:e.docId})}}]),t}(c.Component);t.default=b},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.className,r=e.percent;return e.visible&&i.default.createElement("div",{className:"u-progress "+(t||"")},i.default.createElement("p",{className:"u-progress-state",style:{width:r+"%"}}))};var n,i=(n=r(7))&&n.__esModule?n:{default:n};r(535)},function(e,t,r){var n=r(536);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".u-progress {\n    display: inline-block;\n    background-color: #ddd;\n    height: 2px;\n    border-radius: 10px;\n    overflow: hidden;\n    min-width: 200px\n}\n.u-progress .u-progress-state {\n        margin: 0;\n        width: 0;\n        background-color: #076BF2;\n        height: 100%;\n    }",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}r(538);var d=function(e){function t(){(0,i.default)(this,t);var e=(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments));return e.state={count:0,visible:!1},e}return(0,s.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){this._startTimer()}},{key:"componentWillReceiveProps",value:function(e){this.setState(e)}},{key:"_startTimer",value:function(){var e=this,t=this.props.time;t&&(this.setState({visible:!0}),setTimeout((function(){e.hide()}),1e3*t))}},{key:"hide",value:function(){return this.setState({visible:!1}),this}},{key:"render",value:function(){var e=this.props.message;return this.state.visible?u.default.createElement("div",{className:"u-tip"},u.default.createElement("div",{className:"u-tip-message"},e)):null}}]),t}(c.Component);t.default=d},function(e,t,r){var n=r(539);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,".u-tip {\n    position: fixed;\n    z-index: 1;\n    left: 0;\n    right: 0;\n    width: 100%;\n    height: 26px;\n    line-height: 26px;\n    text-align: center;\n    opacity: 0.9;\n    background: #ffe2c5;\n  }\n  .u-tip-message {\n    font-family: PingFang-SC-Regular;\n    font-size: 12px;\n    color: #313c4c;\n}",""])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(2)),i=l(r(0)),o=l(r(1)),a=l(r(3)),s=l(r(4)),c=r(7),u=l(c);function l(e){return e&&e.__esModule?e:{default:e}}r(541);var d=function(e){function t(){return(0,i.default)(this,t),(0,a.default)(this,(t.__proto__||(0,n.default)(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"render",value:function(){var e=this.props,t=e.children,r=e.className,n=e.onClick,i=e.loading,o=e.disabled,a=e.visibility;return u.default.createElement("button",{className:"u-btn "+r,disabled:!(!o&&"hidden"!==a),style:{visibility:a||"visible"},onClick:function(){return n()}},i&&u.default.createElement("i",{className:"u-loading"}),t)}}]),t}(c.Component);t.default=d},function(e,t,r){var n=r(542);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){t=e.exports=r(24)(!1);var n=r(97)(r(543));t.push([e.i,".u-btn {\n    font-size: 14px;\n    width: 90px;\n    text-align: center;\n    background-color: #076bf2;\n    color: #fff;\n    border: none;\n    letter-spacing: 0.84px;\n    border-radius: 2px;\n  \n    height: 32px;\n    line-height: 32px;\n    border-radius: 2px;\n    margin-left: 12px\n  }\n  \n  .u-btn:hover {\n      cursor: pointer;\n    }\n  \n  .u-btn.u-btn-smaller {\n      width: 60px;\n      height: 26px;\n      line-height: 26px;\n      font-size: 12px;\n      border-radius: 13px;\n    }\n  \n  .u-btn.u-btn-longer {\n      width: 140px;\n    }\n  \n  .u-btn.u-btn-none {\n      font-size: 12px;\n      background-color: transparent;\n      color: #c6ccd5;\n      border: 0;\n      box-shadow: none;\n    }\n  \n  .u-btn.u-btn-cancle {\n      background-color: #e3e6ec;\n      color: #313c4c;\n      box-shadow: none;\n    }\n  \n  .u-btn.u-btn-disable {\n      background: #c6ccd5;\n      box-shadow: 0 8px 15px -8px rgba(255, 255, 255, 0.6);\n    }\n  \n  .u-btn[disabled] {\n      opacity: 0.5;\n    }\n  \n  .u-btn.u-btn-active:not([disabled]),\n    .u-btn:active:not([disabled]) {\n      background-color: #44a0f4;\n    }\n  \n  .u-btn.u-btn-hover:not([disabled]),\n    .u-btn:hover:not([disabled]) {\n      background-color: #2c8dff;\n    }\n  \n  .u-btn.u-btn-none:hover,\n    .u-btn.u-btn-none:active {\n      background-color: transparent;\n    }\n  \n  .u-btn.u-btn-cancle:hover,\n    .u-btn.u-btn-cancle:active {\n      background-color: #e3e6ec;\n    }\n  \n  .u-btn.u-btn-stop {\n      background-color: #ff5454;\n    }\n  \n  .u-btn.u-btn-stop:active:not([disabled]) {\n      background-color: #ff7373;\n    }\n  \n  .u-btn.u-btn-stop:hover:not([disabled]) {\n      background-color: #ff6868;\n    }\n  \n  .u-loading {\n    width: 20px;\n    height: 20px;\n    display: inline-block;\n    vertical-align: middle;\n    -webkit-animation: loading 1s steps(12) infinite;\n            animation: loading 1s steps(12) infinite;\n    background: transparent url("+n+") no-repeat;\n    background-size: 100%;\n}\n  ",""])},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PHBhdGggZmlsbD0ibm9uZSIgZD0iTTAgMGgxMDB2MTAwSDB6Ii8+PHJlY3Qgd2lkdGg9IjciIGhlaWdodD0iMjAiIHg9IjQ2LjUiIHk9IjQwIiBmaWxsPSIjRTlFOUU5IiByeD0iNSIgcnk9IjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTMwKSIvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjIwIiB4PSI0Ni41IiB5PSI0MCIgZmlsbD0iIzk4OTY5NyIgcng9IjUiIHJ5PSI1IiB0cmFuc2Zvcm09InJvdGF0ZSgzMCAxMDUuOTggNjUpIi8+PHJlY3Qgd2lkdGg9IjciIGhlaWdodD0iMjAiIHg9IjQ2LjUiIHk9IjQwIiBmaWxsPSIjOUI5OTlBIiByeD0iNSIgcnk9IjUiIHRyYW5zZm9ybT0icm90YXRlKDYwIDc1Ljk4IDY1KSIvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjIwIiB4PSI0Ni41IiB5PSI0MCIgZmlsbD0iI0EzQTFBMiIgcng9IjUiIHJ5PSI1IiB0cmFuc2Zvcm09InJvdGF0ZSg5MCA2NSA2NSkiLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIyMCIgeD0iNDYuNSIgeT0iNDAiIGZpbGw9IiNBQkE5QUEiIHJ4PSI1IiByeT0iNSIgdHJhbnNmb3JtPSJyb3RhdGUoMTIwIDU4LjY2IDY1KSIvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjIwIiB4PSI0Ni41IiB5PSI0MCIgZmlsbD0iI0IyQjJCMiIgcng9IjUiIHJ5PSI1IiB0cmFuc2Zvcm09InJvdGF0ZSgxNTAgNTQuMDIgNjUpIi8+PHJlY3Qgd2lkdGg9IjciIGhlaWdodD0iMjAiIHg9IjQ2LjUiIHk9IjQwIiBmaWxsPSIjQkFCOEI5IiByeD0iNSIgcnk9IjUiIHRyYW5zZm9ybT0icm90YXRlKDE4MCA1MCA2NSkiLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIyMCIgeD0iNDYuNSIgeT0iNDAiIGZpbGw9IiNDMkMwQzEiIHJ4PSI1IiByeT0iNSIgdHJhbnNmb3JtPSJyb3RhdGUoLTE1MCA0NS45OCA2NSkiLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIyMCIgeD0iNDYuNSIgeT0iNDAiIGZpbGw9IiNDQkNCQ0IiIHJ4PSI1IiByeT0iNSIgdHJhbnNmb3JtPSJyb3RhdGUoLTEyMCA0MS4zNCA2NSkiLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSIyMCIgeD0iNDYuNSIgeT0iNDAiIGZpbGw9IiNEMkQyRDIiIHJ4PSI1IiByeT0iNSIgdHJhbnNmb3JtPSJyb3RhdGUoLTkwIDM1IDY1KSIvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjIwIiB4PSI0Ni41IiB5PSI0MCIgZmlsbD0iI0RBREFEQSIgcng9IjUiIHJ5PSI1IiB0cmFuc2Zvcm09InJvdGF0ZSgtNjAgMjQuMDIgNjUpIi8+PHJlY3Qgd2lkdGg9IjciIGhlaWdodD0iMjAiIHg9IjQ2LjUiIHk9IjQwIiBmaWxsPSIjRTJFMkUyIiByeD0iNSIgcnk9IjUiIHRyYW5zZm9ybT0icm90YXRlKC0zMCAtNS45OCA2NSkiLz48L3N2Zz4="},function(e,t,r){var n=r(545);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){t=e.exports=r(24)(!1);var n=r(97),i=n(r(546)),o=n(r(547)),a=n(r(548)),s=n(r(549)),c=n(r(550)),u=n(r(551));t.push([e.i,".u-mask {\n    position: fixed;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.3);\n    cursor: auto;\n}\n\n.docUpload-popup {\n    cursor: auto;\n    position: absolute;\n    z-index: 111;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 720px;\n    max-width: 80vw;\n    height: 520px;\n    max-height: 85vh;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1);\n    border-radius: 6px;\n    background: #FFFFFF;\n}\n\n.docUpload-popup .docUpload-header {\n        position: relative;\n        height: 56px;\n        font-size: 16px;\n        font-weight: 600;\n        line-height: 56px !important;\n        padding-left: 24px;\n        border-radius: 8px 8px 0px 0px;\n        border-bottom: 1px solid #e6e7eb;\n    }\n\n.docUpload-popup .docUpload-header .u-icon {\n            position: absolute;\n            width: 16px;\n            height: 16px;\n            right: 24px;\n            top: 20px;\n            background-image: url("+i+")\n        }\n\n.docUpload-popup .docUpload-header .u-icon:hover {\n                cursor: pointer;\n            }\n\n.docUpload-popup .docUpload-header .u-tip {\n            position: absolute;\n            bottom: -26px;\n        }\n\n.docUpload-popup .docUpload-body {\n        height: calc(100% - 112px);\n        overflow: auto;\n        padding: 0 24px\n    }\n\n.docUpload-popup .docUpload-body.empty {\n            background: url("+o+") no-repeat center;\n        }\n\n.docUpload-popup .docUpload-body .m-kit-file-content {\n            margin-top: 5px;\n            display: flex;\n            align-items: center;\n            position: relative;\n        }\n\n.docUpload-popup .docUpload-body .m-kit-file-item {\n            width: 100%;\n            height: 64px;\n            padding: 12px 0;\n        }\n\n.docUpload-popup .docUpload-body .m-kit-file-item .u-progress {\n                width: 100%;\n            }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-preview {\n            width: 40px;\n            height: 40px;\n            display: inline-block;\n            background-image: url("+a+");\n            background-repeat: no-repeat;\n            background-position: center\n        }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-preview.ppt {\n                background-image: url("+s+");\n            }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-preview.pptx {\n                background-image: url("+c+");\n            }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-preview.doc {\n                background-image: url("+u+");\n            }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-preview.docx {\n                background-image: url("+u+");\n            }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-desc {\n            width: 200px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            margin-left: 12px;\n            height: 22px;\n            line-height: 22px;\n            width: 390px;\n            white-space: nowrap;\n            max-width: calc(70% - 60px);\n        }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-desc {\n            text-align: left;\n        }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-option {\n            position: absolute;\n            top: 50%;\n            transform: translateY(-50%);\n            right: 4px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            max-width: 30%;\n        }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-option .file-state {\n                display: inline-block;\n                margin: 4px;\n                text-align: center;\n                width: 90px;\n                padding: 6px;\n                box-sizing: border-box;\n                white-space: nowrap;\n            }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-option .u-btn {\n                margin: 0 4px;\n                line-height: 22px;\n                flex: 1;\n                font-size: 12px;\n                white-space: nowrap\n            }\n\n.docUpload-popup .docUpload-body .m-kit-file-item-option .u-btn.u-btn-white {\n                    border: 1px solid #D9D9DB;\n                    background-color: white;\n                    color: black;\n                }\n\n.docUpload-popup .docUpload-footer {\n        border-top: 1px solid #e6e7eb;\n        line-height: 56px !important;\n        height: 56px;\n        color: #337EFF;\n        text-align: center;\n        font-size: 12px;\n        position: relative;\n    }\n\n.docUpload-popup .docUpload-footer .u-tip {\n            top: -26px;\n            position: absolute;\n        }\n\n.docUpload-popup .docUpload-footer .m-kit-file-select {\n            position: absolute;\n            display: none;\n        }\n\n.docUpload-popup .docUpload-footer .splitter {\n            width: 0;\n            border-left: 1px solid #ccc;\n            display: inline-block;\n            margin: 0 10px;\n            height: 32px;\n            vertical-align: middle;\n        }\n\n.docUpload-popup .docUpload-footer .m-kit-file-upload {\n            text-align: center;\n            display: inline-block\n        }\n\n.docUpload-popup .docUpload-footer .m-kit-file-upload.two-mode {\n                width: calc(49% - 16px)\n            }\n\n@media screen and (max-width: 720px) {\n                    .docUpload-popup .docUpload-footer .m-kit-file-upload.two-mode .info {\n                        display: none;\n                    }\n                }\n\n.docUpload-popup .docUpload-footer .m-kit-file-upload.one-mode {\n                width: 100%\n            }\n\n@media screen and (max-width: 450px) {\n                    .docUpload-popup .docUpload-footer .m-kit-file-upload.one-mode .info {\n                        display: none;\n                    }\n                }\n\n.docUpload-popup .docUpload-footer .m-kit-file-upload .btn {\n                cursor: pointer;\n                margin: 0 4px 0 0;\n                border: 1px solid #ccc;\n                border-radius: 4px;\n                padding: 8px;\n            }\n\n.docUpload-popup .docUpload-footer .m-kit-file-upload .info {\n                color: #666;\n            }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggCiAgICBmaWxsLXJ1bGU9Im5vbnplcm8iIAogICAgY2xpcC1ydWxlPSJub256ZXJvIiAKICAgIGQ9Ik05LjA2NjkyIDcuOTk5OTlMMTMuOTc5IDEyLjkxMjFDMTQuMjczNiAxMy4yMDY3IDE0LjI3MzYgMTMuNjg0NCAxMy45NzkgMTMuOTc5QzEzLjY4NDQgMTQuMjczNiAxMy4yMDY3IDE0LjI3MzYgMTIuOTEyMSAxMy45NzlMNy45OTk5OSA5LjA2NjkyTDMuMDg3ODkgMTMuOTc5QzIuNzkzMjcgMTQuMjczNiAyLjMxNTU4IDE0LjI3MzYgMi4wMjA5NiAxMy45NzlDMS43MjYzMyAxMy42ODQ0IDEuNzI2MzMgMTMuMjA2NyAyLjAyMDk2IDEyLjkxMjFMNi45MzMwNSA3Ljk5OTk5TDIuMDIwOTYgMy4wODc4OUMxLjcyNjMzIDIuNzkzMjcgMS43MjYzMyAyLjMxNTU4IDIuMDIwOTYgMi4wMjA5NkMyLjMxNTU4IDEuNzI2MzMgMi43OTMyNyAxLjcyNjMzIDMuMDg3ODkgMi4wMjA5Nkw3Ljk5OTk5IDYuOTMzMDVMMTIuOTEyMSAyLjAyMDk2QzEzLjIwNjcgMS43MjYzMyAxMy42ODQ0IDEuNzI2MzMgMTMuOTc5IDIuMDIwOTZDMTQuMjczNiAyLjMxNTU4IDE0LjI3MzYgMi43OTMyNyAxMy45NzkgMy4wODc4OUw5LjA2NjkyIDcuOTk5OTlaIiAKICAgIGZpbGw9IiM5OTk5OTkiCi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/png;base64,iVBORwoaCgAAAA1JSERSAAAAegAAAH0IAwAAAFqCh24AAAE4UExURQAAAMTExKurrZ6enp2dncbM1snR28bM1pqamsbN1snM1sfN1pycnMfN1ZqampiYmJmZmZubm52dnZiYmJiYmJ+fn7e6wZmZmZmZmZqampubm5iYmJiYmMfN1piYmJmZmZmZmZmZmZmZmZiYmJiYmMfN1pmZmZmZmZmZmZqams7U4cbM1piYmJiYmJiYmMjP2MfN1piYmJiYmJiYmMjO1pqampeXl5iYmMfN1piYmMjO15eXl5iYmJmZmcbL1cLGzsrT38fM1cfM1peXl5iYmMfN1q+xtsjN1sfN18bO1srO1sjN2Li9w8DFzMjN18jO1ayssPj5+8bM1f///8vQ2fX2+eHk6dbb4fP098jO1+jr7/Hy9tHW3uPn6+3v89TY4N7i6M3S2vf4+9zf5u/x9Njc487U3Ovt8VMKzAAAAFF0Uk5TAAMGChLnHKYuy0vtJfQabjQiDp6EFgt4Xioe1r+9kHNkT0iviYNYVT04Dvr17nw11M+mlU5D5+GbaEfdw2ZTKRXg2ce6rpyPa2M+LuC9ZmJHPm6w/wAABWRJREFUaN7lmody2kAQhv+ThFECpptumm0MuMQlTuL03htrSijudvL+bxABJgKJJEicfDPJN+MZbDP6Zm+X3TvmMA0LgSiKMQX+WAiFPQnXgoTckhfpbR82lzW19rObTiKVWkC8BOdgyKXK2C+ao5QSMiIPFexswgmC4SLyAfyR/DKTtyNg4IhSwCO/jGkI7MO7/Qi8SG7EYYVSDoWdAIfK2oTPB6vI+36sxiXMxM4ObKIuxVG2bQ/5ocI+EiIbPtgjFceM+BTYIYACrp+bN+ZvvPZDADepx2MI4AY16g26AQHMU71ap3lMw78T9SDXNyGAwmutwoWYkxteCIIxCEJWIYolPyww53a53HPgwsKyZMXsIQ3PHK4fNzWr1Sa5wQG2GYUFXFQ9OKiSCxzIp6dPMvU40KAeM6e85LWSZF3NPeV6fGaa1YMxtJQbsLYWifCk+CaimQ1uMmBtLWKZCUV8fNFuVw3UJqlrVRPfjqct/2BoQhEfE9FldZymacH7f5rgtlv+0cevSOO4Rd8MT2yRiZb2HjNEmAZpe+y32+55Iuoe1rWIGsZomjUao9bUzPbViRSGsPv3PH1v/4Ft6lZtYFbf/N1WQPZhwNM3Ls37vdGpDjhrUce22toGSMvw6cmo7JIattVTbfviMQx4RoaPU5u+21ZPtdmNLWOA2xiktuIXjkatKBhw2xTkJZ1cT64lj7GsftCpoxUez+KKe6Yga3RkVz0NuTCuuG9a8XM6cVIdSuIK5jGW1RHVnFRrWFhxvlGnMeS9sawuunToZNR3fPqwHA2y0/hORB0n1UEZQ97Q+XBINbqat3Z+cU25xi2q9b2HPW/r8of22lF1KYxfPKMf9cPjnrfZPtMecYX2akqsqaPr+oqvUK1FtEZax9dwXA1FwpCnLlpb/FLRHzHAsVwzXY3K+6cAZleHkfTi7yxsyBjHrKa/YVCrUO/uIhjFX9jNc1f3Q8LeehEMluCWayWASHYon7vFYGLV55Baw7cTkGRoPF6jLfPYjqcnq/m0FEl64AUqLqoRLd4yh+2gGshngBXqnh1qcvMx1FE1ZPXrfG801c9btLZSwSjhR46qwT5eHQw7TSLPWwadhYdJR9UfqDUcv0ddoue3r23BsUjn+r/bp0SLT0aqPG9Q8xwf96lWr46g1ZtL73ShVM4xNduihums/gQ6LMm3pei8o9Oz6hiHtIVR/CX0UTiroy7jSbJeo/FCS94dRF/kMj50VkxfEpzQIsYpQwXCksxXPTdPhl1ep0W3YCQWCS7xzvU9apqOsG6YkNMFibN6bq3VMZ6n1syNnG36kV/l21K0HbahyI5pBSZiOQYlVeKqZotE3aOxL0o8FUxGSnBVg312ETX1RT+lt+ZEby4408MrK/PUOq8Pu8lzBiOZXTijln1PPhHVGmd6NzHOc+aMunzHy/BBS/lpW+8mJviPj2AeucBgfG0RdduTugkeJLmrg1DvFPV6e+cimtRNyi+4boYlFcqdl1AYRoiubLkrTh8B2PoLyF7rB04e40PG1LD1KE+1FYJprgtuDWHqkMJ1M2yF7LIwtT8rTK1jVv+7uV5dEqZWl7hOLmuIUwclYd1sNytMXc6IGh8a4tRqQtjk8m7IotRYLf93PbxHNiJMLT8s/YcLDuzlmLCol8IAXPTNgojbbRzm699BsufW7yDZIhHBnIfsMeMtNLYd1O+bWWTWu3chVZIhCBZMRSGK/VUIQ0FYhigyYQgjgWwCotjbUBgEoShqRoEg2HIGCxCEjEhamJwVA4ipEIX/LpPE2eW7LxGSIQYvEusRKBKEEApgbz0GrxdCkL0oPIigkBVU+BLUTAAz8RN+KYYp8AVfoQAAAABJRU5ErkJggg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik03LjUyIDBIMjMuOEwzNiAxMi4zMzMzVjM2LjQ0NDRDMzYgMzguNDA4MSAzNC40MjQgNDAgMzIuNDggNDBINy41MkM1LjU3NTk2IDQwIDQgMzguNDA4MSA0IDM2LjQ0NDRWMy41NTU1NkM0IDEuNTkxODggNS41NzU5NiAwIDcuNTIgMFoiIGZpbGw9IiNFNjQ1NDUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMy44IDBMMzYgMTIuMzMzM0gyNy4zMkMyNS4zNzU5IDEyLjMzMzMgMjMuOCAxMC43NDE1IDIzLjggOC43Nzc3OFYwWiIgZmlsbD0iI0ZDOEI4QiIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEwLjg5NDUgMjYuNDY0OEgxMS40OTIyQzEyLjA1MDggMjYuNDY0OCAxMi40Njg3IDI2LjM1NDUgMTIuNzQ2MSAyNi4xMzM4QzEzLjAyMzQgMjUuOTEzMSAxMy4xNjIxIDI1LjU5MTggMTMuMTYyMSAyNS4xNjk5QzEzLjE2MjEgMjQuNzQ0MSAxMy4wNDU5IDI0LjQyOTcgMTIuODEzNSAyNC4yMjY2QzEyLjU4MTEgMjQuMDIzNCAxMi4yMTY4IDIzLjkyMTkgMTEuNzIwNyAyMy45MjE5SDEwLjg5NDVWMjYuNDY0OFpNMTQuOTk2MSAyNS4xMDU1QzE0Ljk5NjEgMjYuMDI3MyAxNC43MDggMjYuNzMyNCAxNC4xMzE4IDI3LjIyMDdDMTMuNTU1NyAyNy43MDkgMTIuNzM2MyAyNy45NTMxIDExLjY3MzggMjcuOTUzMUgxMC44OTQ1VjMxSDkuMDc4MTJWMjIuNDMzNkgxMS44MTQ1QzEyLjg1MzUgMjIuNDMzNiAxMy42NDM2IDIyLjY1NzIgMTQuMTg0NiAyMy4xMDQ1QzE0LjcyNTYgMjMuNTUxOCAxNC45OTYxIDI0LjIxODcgMTQuOTk2MSAyNS4xMDU1Wk0yMy43MjA3IDI2LjYzNDhDMjMuNzIwNyAyOC4wNDQ5IDIzLjMxOTMgMjkuMTI1IDIyLjUxNjYgMjkuODc1QzIxLjcxMzkgMzAuNjI1IDIwLjU1NDcgMzEgMTkuMDM5MSAzMUgxNi42MTMzVjIyLjQzMzZIMTkuMzAyN0MyMC43MDEyIDIyLjQzMzYgMjEuNzg3MSAyMi44MDI3IDIyLjU2MDUgMjMuNTQxQzIzLjMzNCAyNC4yNzkzIDIzLjcyMDcgMjUuMzEwNSAyMy43MjA3IDI2LjYzNDhaTTIxLjgzNCAyNi42ODE2QzIxLjgzNCAyNC44NDE4IDIxLjAyMTUgMjMuOTIxOSAxOS4zOTY1IDIzLjkyMTlIMTguNDI5N1YyOS41SDE5LjIwOUMyMC45NTkgMjkuNSAyMS44MzQgMjguNTYwNiAyMS44MzQgMjYuNjgxNlpNMjcuMjgzMiAzMUgyNS40OTYxVjIyLjQzMzZIMzAuNDA2MlYyMy45MjE5SDI3LjI4MzJWMjYuMTMwOUgzMC4xODk1VjI3LjYxMzNIMjcuMjgzMlYzMVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik03LjUyIDBIMjMuOEwzNiAxMi4zMzMzVjM2LjQ0NDRDMzYgMzguNDA4MSAzNC40MjQgNDAgMzIuNDggNDBINy41MkM1LjU3NTk2IDQwIDQgMzguNDA4MSA0IDM2LjQ0NDRWMy41NTU1NkM0IDEuNTkxODggNS41NzU5NiAwIDcuNTIgMFoiIGZpbGw9IiNFNjREMkUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMy44IDBMMzYgMTIuMzMzM0gyNy4zMkMyNS4zNzU5IDEyLjMzMzMgMjMuOCAxMC43NDE1IDIzLjggOC43Nzc3OFYwWiIgZmlsbD0iI0ZDOTk4QSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3Ljc1ODYgMTguMDEzSDEyLjU0MDVWMzEuMzMzM0gxNC43NzE0VjI1Ljk3NjZIMTcuNzU4NkMxOC40MzI5IDI1Ljk3NjYgMTkuMDMxNiAyNS44NjM2IDE5LjU1NDcgMjUuNjM3NkMyMC4wNzc4IDI1LjQxMTYgMjAuNTE4OSAyNS4xMTI0IDIwLjg3ODEgMjQuNzRDMjEuMjM3MyAyNC4zNjc2IDIxLjUwOTkgMjMuOTQxMSAyMS42OTU4IDIzLjQ2MDVDMjEuODgxNyAyMi45Nzk5IDIxLjk3NDcgMjIuNDg4MSAyMS45NzQ3IDIxLjk4NTNDMjEuOTc0NyAyMS41MDc4IDIxLjg4MTcgMjEuMDMzNiAyMS42OTU4IDIwLjU2MjVDMjEuNTA5OSAyMC4wOTE0IDIxLjIzODkgMTkuNjY2NSAyMC44ODI4IDE5LjI4NzhDMjAuNTI2OCAxOC45MDkgMjAuMDg3MiAxOC42MDE5IDE5LjU2NDEgMTguMzY2M0MxOS4wNDExIDE4LjEzMDggMTguNDM5MiAxOC4wMTMgMTcuNzU4NiAxOC4wMTNaTTE0Ljc3MTQgMTkuOTEzMlYyNC4wODU5SDE3LjI4NTlDMTcuNzQ2IDI0LjA4NTkgMTguMTMyIDI0LjAzMDIgMTguNDQzOSAyMy45MTg4QzE4Ljc1NTkgMjMuODA3NCAxOS4wMDggMjMuNjU2MyAxOS4yMDAyIDIzLjQ2NTNDMTkuMzkyNCAyMy4yNzQzIDE5LjUzMTEgMjMuMDQ5OSAxOS42MTYxIDIyLjc5MjFDMTkuNzAxMiAyMi41MzQzIDE5Ljc0MzcgMjIuMjU1OCAxOS43NDM3IDIxLjk1NjZDMTkuNzQzNyAyMS42NjM4IDE5LjY5MDIgMjEuMzkxNiAxOS41ODMgMjEuMTQwMkMxOS40NzU5IDIwLjg4ODggMTkuMzE4NCAyMC42NzIzIDE5LjExMDQgMjAuNDkwOUMxOC45MDI0IDIwLjMwOTUgMTguNjQ1NiAyMC4xNjc4IDE4LjM0IDIwLjA2NkMxOC4wMzQzIDE5Ljk2NDEgMTcuNjgzIDE5LjkxMzIgMTcuMjg1OSAxOS45MTMySDE0Ljc3MTRaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik03LjUyIDBIMjMuOEwzNiAxMi4zMzMzVjM2LjQ0NDRDMzYgMzguNDA4MSAzNC40MjQgNDAgMzIuNDggNDBINy41MkM1LjU3NTk2IDQwIDQgMzguNDA4MSA0IDM2LjQ0NDRWMy41NTU1NkM0IDEuNTkxODggNS41NzU5NiAwIDcuNTIgMFoiIGZpbGw9IiNFNjREMkUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMy44IDBMMzYgMTIuMzMzM0gyNy4zMkMyNS4zNzU5IDEyLjMzMzMgMjMuOCAxMC43NDE1IDIzLjggOC43Nzc3OFYwWiIgZmlsbD0iI0ZDOTk4QSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3Ljc1ODYgMTguMDEzSDEyLjU0MDVWMzEuMzMzM0gxNC43NzE0VjI1Ljk3NjZIMTcuNzU4NkMxOC40MzI5IDI1Ljk3NjYgMTkuMDMxNiAyNS44NjM2IDE5LjU1NDcgMjUuNjM3NkMyMC4wNzc4IDI1LjQxMTYgMjAuNTE4OSAyNS4xMTI0IDIwLjg3ODEgMjQuNzRDMjEuMjM3MyAyNC4zNjc2IDIxLjUwOTkgMjMuOTQxMSAyMS42OTU4IDIzLjQ2MDVDMjEuODgxNyAyMi45Nzk5IDIxLjk3NDcgMjIuNDg4MSAyMS45NzQ3IDIxLjk4NTNDMjEuOTc0NyAyMS41MDc4IDIxLjg4MTcgMjEuMDMzNiAyMS42OTU4IDIwLjU2MjVDMjEuNTA5OSAyMC4wOTE0IDIxLjIzODkgMTkuNjY2NSAyMC44ODI4IDE5LjI4NzhDMjAuNTI2OCAxOC45MDkgMjAuMDg3MiAxOC42MDE5IDE5LjU2NDEgMTguMzY2M0MxOS4wNDExIDE4LjEzMDggMTguNDM5MiAxOC4wMTMgMTcuNzU4NiAxOC4wMTNaTTE0Ljc3MTQgMTkuOTEzMlYyNC4wODU5SDE3LjI4NTlDMTcuNzQ2IDI0LjA4NTkgMTguMTMyIDI0LjAzMDIgMTguNDQzOSAyMy45MTg4QzE4Ljc1NTkgMjMuODA3NCAxOS4wMDggMjMuNjU2MyAxOS4yMDAyIDIzLjQ2NTNDMTkuMzkyNCAyMy4yNzQzIDE5LjUzMTEgMjMuMDQ5OSAxOS42MTYxIDIyLjc5MjFDMTkuNzAxMiAyMi41MzQzIDE5Ljc0MzcgMjIuMjU1OCAxOS43NDM3IDIxLjk1NjZDMTkuNzQzNyAyMS42NjM4IDE5LjY5MDIgMjEuMzkxNiAxOS41ODMgMjEuMTQwMkMxOS40NzU5IDIwLjg4ODggMTkuMzE4NCAyMC42NzIzIDE5LjExMDQgMjAuNDkwOUMxOC45MDI0IDIwLjMwOTUgMTguNjQ1NiAyMC4xNjc4IDE4LjM0IDIwLjA2NkMxOC4wMzQzIDE5Ljk2NDEgMTcuNjgzIDE5LjkxMzIgMTcuMjg1OSAxOS45MTMySDE0Ljc3MTRaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik03LjUyIDBIMjMuOEwzNiAxMi4zMzMzVjM2LjQ0NDRDMzYgMzguNDA4MSAzNC40MjQgNDAgMzIuNDggNDBINy41MkM1LjU3NTk2IDQwIDQgMzguNDA4MSA0IDM2LjQ0NDRWMy41NTU1NkM0IDEuNTkxODggNS41NzU5NiAwIDcuNTIgMFoiIGZpbGw9IiMzMDc4RjIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMy44IDBMMzYgMTIuMzMzM0gyNy4zMkMyNS4zNzU5IDEyLjMzMzMgMjMuOCAxMC43NDE1IDIzLjggOC43Nzc3OFYwWiIgZmlsbD0iIzk2QkNGRCIvPgo8cGF0aCBkPSJNMTcuOTY1MyAyMS44MjI5TDE1LjIzMzMgMzEuMzMzM0gxMy4wOTY5TDkuNzUwNTIgMTguMDEzSDEyLjA3NkwxNC4yNTk3IDI2Ljg1NUwxNi45NDQzIDE4LjAxM0gxOC45NzY4TDIxLjY0MjYgMjYuNzY5MUwyMy44NzM1IDE4LjAxM0gyNi4xOEwyMi44MTQ3IDMxLjMzMzNIMjAuNjk3MkwxNy45NjUzIDIxLjgyMjlaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K"},function(e,t,r){var n=r(553);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(24)(!1)).push([e.i,'/*\n * 工具类集合容器 \n */\n.tool-collection {\n    /*\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    z-index: -100;\n    */\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n}\n@media (any-hover: hover) {\n        .tool-collection:hover {\n            cursor: pointer;\n        }\n    }\n.tool-collection {\n    \n    font: 12px/1.14 "PingFang-SC-Medium";\n}',""])},function(e,t,r){var n=r(555);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){t=e.exports=r(24)(!1);var n=r(97),i=n(r(556)),o=n(r(390)),a=n(r(391)),s=n(r(557)),c=n(r(558)),u=n(r(559)),l=n(r(560)),d=n(r(411)),p=n(r(561)),f=n(r(562)),h=n(r(563)),m=n(r(564)),g=n(r(565)),v=n(r(566)),y=n(r(567)),b=n(r(568)),S=n(r(569)),_=n(r(570)),M=n(r(571)),T=n(r(572)),w=n(r(573)),x=n(r(574)),I=n(r(575)),E=n(r(576)),A=n(r(577)),C=n(r(578)),k=n(r(579)),O=n(r(580)),N=n(r(581)),R=n(r(582)),P=n(r(583)),D=n(r(584)),j=n(r(585)),L=n(r(586)),z=n(r(587)),U=n(r(588)),B=n(r(589)),F=n(r(590));t.push([e.i,".tc-unit {\n    background-size: contain;\n    display: inline-block;\n    position: relative\n}\n\n.tc-unit.selected {\n        outline: 1px solid #337EFF;\n    }\n\n.tc-unit:hover {\n        background-color: #f0f0f2;\n    }\n\n.tc-unit.unavailable {\n        opacity: 0.4\n    }\n\n@media (any-hover: hover) {\n            .tc-unit.unavailable:hover {\n                cursor: not-allowed;\n            }\n        }\n\n.tc-android .tc-unit:hover, .tc-ios .tc-unit:hover, .tc-pad .tc-unit:hover {\n        background-color: unset;\n    }\n\n.tc-unit-select {\n    background-image: url("+i+");\n}\n\n.tc-unit-pen {\n    background-image: url("+o+");\n}\n\n.tc-unit-shape {\n    background-image: url("+a+");\n}\n\n.tc-unit-text {\n    background-image: url("+s+");\n}\n\n.tc-unit-laser {\n    background-image: url("+c+");\n}\n\n.tc-unit-element-eraser {\n    background-image: url("+u+");\n}\n\n.tc-unit-duplicate {\n    background-image: url("+l+");\n}\n\n.tc-unit-clear {\n    background-image: url("+d+");\n}\n\n.tc-unit-undo {\n    background-image: url("+p+");\n}\n\n.tc-unit-redo {\n    background-image: url("+f+");\n}\n\n.tc-unit-pan {\n    background-image: url("+h+");\n}\n\n.tc-unit-reset {\n    background-image: url("+m+");\n}\n\n.tc-unit-zoomIn {\n    background-image: url("+g+");\n}\n\n.tc-unit-zoomOut {\n    background-image: url("+v+");\n}\n\n.tc-unit-firstPage {\n    background-image: url("+y+");\n}\n\n.tc-unit-prevPage {\n    background-image: url("+b+");\n}\n\n.tc-unit-prevAnim {\n    background-image: url("+S+");\n}\n\n.tc-unit-nextPage {\n    background-image: url("+_+");\n}\n\n.tc-unit-nextAnim {\n    background-image: url("+M+");\n}\n\n.tc-unit-lastPage {\n    background-image: url("+T+");\n}\n\n.tc-unit-image {\n    background-image: url("+w+");\n}\n\n.tc-unit-video {\n    background-image: url("+x+");\n}\n\n.tc-unit-audio {\n    background-image: url("+I+");\n}\n\n.tc-unit-docUpload {\n    background-image: url("+E+");\n}\n\n.tc-unit-exportImage {\n    background-image: url("+A+");\n}\n\n.tc-unit-fitToContent {\n    background-image: url("+C+");\n}\n\n.tc-unit-fitToDoc {\n    background-image: url("+k+");\n}\n\n.tc-unit-multiInOne {\n    background-image: url("+O+");\n}\n\n.tc-unit-uploadLog {\n    background-image: url("+N+");\n}\n\n.tc-unit-platte {\n    background-image: url("+R+");\n}\n\n.tc-unit-widthResize {\n    background-image: url("+P+");\n}\n\n.tc-unit-opacity {\n    background-image: url("+D+");\n}\n\n.tc-unit-shapeSelect {\n    background-image: url("+o+");\n}\n\n/**\n * 状态为open时，选用关闭的图标，表示要关闭预览图\n */\n.preview-icon-right.tc-state-unit-preview-open {\n        background-image: url("+j+");\n    }\n.preview-icon-right.tc-state-unit-preview-close {\n        background-image: url("+L+");\n    }\n.preview-icon-right.tc-state-unit-preview-default {\n        background-image: url("+L+");\n    }\n\n/**\n * 预览滑窗在左侧的话，图标要反过来\n */\n.preview-icon-left.tc-state-unit-preview-open {\n        background-image: url("+L+");\n    }\n.preview-icon-left.tc-state-unit-preview-close {\n        background-image: url("+j+");\n    }\n.preview-icon-left.tc-state-unit-preview-default {\n        background-image: url("+j+");\n    }\n\n\n.tc-state-unit-visionControl-broadcasting {\n    background-image: url("+z+");\n}\n\n.tc-state-unit-visionControl-not-broadcasting {\n    background-image: url("+U+");\n}\n\n.tc-state-unit-visionLock-lock {\n    background-image: url("+B+");\n}\n\n.tc-state-unit-visionLock-unlock {\n    background-image: url("+F+");\n}\n\n.tc-state-unit-visionLock-lock-activate {\n    background-image: url("+B+");\n}\n\n.tc-state-unit-visionLock-unlock-activate {\n    background-image: url("+F+");\n}\n\n.tc-state-unit-fitToContentDoc-content {\n    background-image: url("+C+");\n}\n\n.tc-state-unit-fitToContentDoc-doc {\n    background-image: url("+k+");\n}",""])},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDBweCIgaGVpZ2h0PSI0MHB4IiB2aWV3Qm94PSIwIDAgNDAgNDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYwLjEgKDg4MTMzKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5jdXJzb3I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0i6aG16Z2iLTQiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJXaGl0ZWJvYXJkLUd1aWRlbGluZXMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNC4wMDAwMDAsIC0yMTYuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSJjdXJzb3IiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI0LjAwMDAwMCwgMjE2LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9ouWkh+S7vS0zOCIgZmlsbD0iI0ZGRkZGRiIgb3BhY2l0eT0iMC4wMSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMiI+PC9yZWN0PgogICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9IlN0cm9rZS0x5aSH5Lu9LTEyIiBzdHJva2U9IiMyMTIzMjQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgcG9pbnRzPSIxMyAxMyAxNy42NjY2NjY3IDI3IDIwIDIwIDI3IDE3LjY2NjY2NjciPjwvcG9seWdvbj4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEzIDE2VjEzSDI3VjE2IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CjxwYXRoIGQ9Ik0yMCAxM1YyNyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTE4IDI3SDIyIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMyIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTIwIDEwLjZWMTQuNiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8cGF0aCBkPSJNMjAgMjUuNFYyOS40IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik0yOS40IDIwTDI1LjQgMjAiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMS4yIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPHBhdGggZD0iTTE0LjYgMjBMMTAuNiAyMCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMjIiIHk9IjExLjQ0MjMiIHdpZHRoPSI4LjM4OTY3IiBoZWlnaHQ9IjE0LjY4MTkiIHJ4PSIxIiB0cmFuc2Zvcm09InJvdGF0ZSg0NSAyMiAxMS40NDIzKSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTE0LjU4NDUgMTguODU3OEwyMC41MTY5IDI0Ljc5MDIiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMS4yIi8+CjxwYXRoIGQ9Ik0xNC4yMjQ2IDI3LjY4MTlIMjUuNzYwNCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTciIHk9IjE3IiB3aWR0aD0iMTEiIGhlaWdodD0iMTEiIHJ4PSIxIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIvPgo8cGF0aCBkPSJNMTcgMjNWMjMuNkgxNy42VjIzSDE3Wk0yMyAxN1YxNy42SDIzLjZWMTdIMjNaTTEyLjYgMTNDMTIuNiAxMi43NzkxIDEyLjc3OTEgMTIuNiAxMyAxMi42VjExLjRDMTIuMTE2MyAxMS40IDExLjQgMTIuMTE2MyAxMS40IDEzSDEyLjZaTTEyLjYgMjJWMTNIMTEuNFYyMkgxMi42Wk0xMyAyMi40QzEyLjc3OTEgMjIuNCAxMi42IDIyLjIyMDkgMTIuNiAyMkgxMS40QzExLjQgMjIuODgzNyAxMi4xMTYzIDIzLjYgMTMgMjMuNlYyMi40Wk0xNyAyMi40SDEzVjIzLjZIMTdWMjIuNFpNMTcuNiAyM1YxOEgxNi40VjIzSDE3LjZaTTE3LjYgMThDMTcuNiAxNy43NzkxIDE3Ljc3OTEgMTcuNiAxOCAxNy42VjE2LjRDMTcuMTE2MyAxNi40IDE2LjQgMTcuMTE2MyAxNi40IDE4SDE3LjZaTTE4IDE3LjZIMjNWMTYuNEgxOFYxNy42Wk0yMi40IDEzVjE3SDIzLjZWMTNIMjIuNFpNMjIgMTIuNkMyMi4yMjA5IDEyLjYgMjIuNCAxMi43NzkxIDIyLjQgMTNIMjMuNkMyMy42IDEyLjExNjMgMjIuODgzNyAxMS40IDIyIDExLjRWMTIuNlpNMTMgMTIuNkgyMlYxMS40SDEzVjEyLjZaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIwIDEyLjcyMTZDMjAgMTIuNjM1NSAxOS44OTg0IDEyLjU4OTYgMTkuODMzOCAxMi42NDY2TDEyLjI1NDkgMTkuMzMzOUMxMi4xMTk2IDE5LjQ1MzMgMTIuMTE5NiAxOS42NjQzIDEyLjI1NDkgMTkuNzgzOEwxOS44MzM4IDI2LjQ3MUMxOS44OTg0IDI2LjUyOCAyMCAyNi40ODIyIDIwIDI2LjM5NlYyMi4wNTM1QzIzLjc1NDUgMjIuMDk3IDI2LjUyMDcgMjQuNTE1MSAyNy43OTU4IDI3LjA2MThDMjcuODQ0NCAyNy4xNTg5IDI3Ljk5NDIgMjcuMTI0NyAyNy45ODk2IDI3LjAxNjJDMjcuNzc3OCAyMi4wNzcyIDI0LjM2NTEgMTYuOTY4MiAyMCAxNi40MzIxVjEyLjcyMTZaIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIwIDEyLjcyMTZDMjAgMTIuNjM1NSAyMC4xMDE2IDEyLjU4OTYgMjAuMTY2MiAxMi42NDY2TDI3Ljc0NTEgMTkuMzMzOUMyNy44ODA0IDE5LjQ1MzMgMjcuODgwNCAxOS42NjQzIDI3Ljc0NTEgMTkuNzgzOEwyMC4xNjYyIDI2LjQ3MUMyMC4xMDE2IDI2LjUyOCAyMCAyNi40ODIyIDIwIDI2LjM5NlYyMi4wNTM1QzE2LjI0NTUgMjIuMDk3IDEzLjQ3OTMgMjQuNTE1MSAxMi4yMDQyIDI3LjA2MThDMTIuMTU1NiAyNy4xNTg5IDEyLjAwNTggMjcuMTI0NyAxMi4wMTA0IDI3LjAxNjJDMTIuMjIyMiAyMi4wNzcyIDE1LjYzNDkgMTYuOTY4MiAyMCAxNi40MzIxVjEyLjcyMTZaIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIvPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjExNzQ1MDMyODMzIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTQwMCAtNDAwIDE4MjQgMTgyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQwNTAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNODcwLjQgMjA0LjhjLTE4LjYzNjggMC0zNi4xNDcyIDUuMDE3Ni01MS4yIDEzLjc3MjhWMTUzLjZhMTAyLjUwMjQgMTAyLjUwMjQgMCAwIDAtMTU5LjM4NTYtODUuMDQzMkM2NDUuNzg1NiAyOC42NzIgNjA3Ljc5NTIgMCA1NjMuMiAwUzQ4MC41NjMyIDI4LjY3MiA0NjYuNTg1NiA2OC41NTY4QTEwMi41MDI0IDEwMi41MDI0IDAgMCAwIDMwNy4yIDE1My42djM3Ny40OTc2TDIzOC4yODQ4IDQxMS42NDhhOTkuNjg2NCA5OS42ODY0IDAgMCAwLTYxLjM4ODgtNDguNzkzNiA5NS41MzkyIDk1LjUzOTIgMCAwIDAtNzQuODU0NCAxMC4zNDI0Yy00Ni40Mzg0IDI3Ljg1MjgtNjQuMTUzNiA5MC44Mjg4LTM5LjQyNCAxNDAuMzkwNCAxLjUzNiAzLjEyMzIgMzQuMjAxNiA3MC4wNDE2IDEzNi4xOTIgMjczLjkyIDQ4LjAyNTYgOTYgMTAwLjcxMDQgMTY0LjY1OTIgMTU2LjYyMDggMjAzLjk4MDggNDMuODc4NCAzMC44NzM2IDc0LjE4ODggMzIuNDYwOCA3OS44MjA4IDMyLjQ2MDhoMjU2YzQzLjU3MTIgMCA4NC4wNzA0LTE0LjE4MjQgMTIwLjQyMjQtNDIuMDg2NCAzNC4xNTA0LTI2LjI2NTYgNjMuNzk1Mi02NC4yNTYgODguMDY0LTExMi44NDQ4IDQ3LjgyMDgtOTUuNjQxNiA3My4xMTM2LTIyNy45NDI0IDczLjExMzYtMzgyLjY2ODh2LTE3OS4yYzAtNTYuNDczNi00NS45MjY0LTEwMi40LTEwMi40LTEwMi40eiBtNTEuMiAyODEuNmMwIDE0Ni43OTA0LTIzLjM5ODQgMjcxLjE1NTItNjcuNjg2NCAzNTkuNzMxMkM4MjUuMDM2OCA5MDMuODg0OCA3NzMuMzI0OCA5NzIuOCA2OTEuMiA5NzIuOEg0MzUuNzEyYy0xLjk5NjgtMC4xNTM2LTIzLjU1Mi0yLjU2LTU2LjA2NC0yNi44OC0zMi40MDk2LTI0LjI2ODgtODIuMTc2LTc1LjM2NjQtMTM1LjA2NTYtMTgxLjI0OC0xMDMuNzgyNC0yMDcuNTY0OC0xMzUuNjgtMjcyLjk0NzItMTM1Ljk4NzItMjczLjU2MTZsLTAuMTAyNC0wLjIwNDhjLTEyLjg1MTItMjUuNzUzNi0zLjczNzYtNTkuNDk0NCAxOS45MTY4LTczLjY3NjhhNDQuODUxMiA0NC44NTEyIDAgMCAxIDM1LjA3Mi00Ljg2NCA0OC45NDcyIDQ4Ljk0NzIgMCAwIDEgMzAuMDU0NCAyNC4xNjY0bDAuMzA3MiAwLjUxMiA3OS45MjMyIDEzOC40OTZjMTYuMzMyOCAyOS44NDk2IDM0LjcxMzYgNDIuMzkzNiA1NC42MzA0IDM3LjMyNDggMTkuOTY4LTUuMDY4OCAzMC4wNTQ0LTI1LjAzNjggMzAuMDU0NC01OS4yMzg0VjE1My42YzAtMjguMjExMiAyMi45ODg4LTUxLjIgNTEuMi01MS4yczUxLjIgMjIuOTg4OCA1MS4yIDUxLjJ2MzMyLjhhMjUuNiAyNS42IDAgMCAwIDUxLjIgMFYxMDIuNGMwLTI4LjIxMTIgMjIuOTg4OC01MS4yIDUxLjItNTEuMnM1MS4yIDIyLjk4ODggNTEuMiA1MS4ydjM4NGEyNS42IDI1LjYgMCAwIDAgNTEuMiAwVjE1My42YzAtMjguMjExMiAyMi45ODg4LTUxLjIgNTEuMi01MS4yczUxLjIgMjIuOTg4OCA1MS4yIDUxLjJ2Mzg0YTI1LjYgMjUuNiAwIDAgMCA1MS4yIDBWMzA3LjJjMC0yOC4yMTEyIDIyLjk4ODgtNTEuMiA1MS4yLTUxLjJzNTEuMiAyMi45ODg4IDUxLjIgNTEuMnYxNzkuMnoiIGZpbGw9IiIgcC1pZD0iNDA1MSI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjExODMxNDIxMTU1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTQwMCAtNDAwIDE4MjQgMTgyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE5NjUiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNODA4IDYwMi45Yy0yMy42IDE2NC4yLTE4MS44IDI4NS41LTM1OC43IDI0OC4zQzMzNi45IDgyNy42IDI0NS42IDczNi44IDIyMiA2MjQuNGMtNDAuMy0xOTIgOTItMzYxLjggMjkwLjQtMzYxLjh2OTkuMmwyNDgtMTQ4LjgtMjQ4LTE0OC44djk5LjJjLTI0OCAwLTQzOCAyMjIuNC0zODguNiA0NzYuNSAzMC4xIDE1NC43IDE1NSAyNzkuNCAzMDkuNyAzMDkuNUM2NjggOTk1IDg3NS42IDgzMy45IDkwNi4yIDYxNi4xYzQuMi0yOS42LTE5LjctNTUuOC00OS41LTU1LjhoMC4xYy0yNC43IDAtNDUuMyAxOC4yLTQ4LjggNDIuNnoiIHAtaWQ9IjE5NjYiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjExODE1Njg1MDAzIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTYwMCAtNjAwIDIyMjQgMjIyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI1MTYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTYyLjUyNjMzNCA0NjEuNDczNjk5IDU2Mi41MjYzMzQgNjcuMzY4NDIzYzAtMjYuOTQ3MzY5LTIzLjU3ODk0OC01MC41MjYzMTctNTAuNTI2MzE3LTUwLjUyNjMxN2wwIDBjLTI2Ljk0NzM2OSAwLTUwLjUyNjMxNyAyMy41Nzg5NDgtNTAuNTI2MzE3IDUwLjUyNjMxN2wwIDM5NC4xMDUyNzZMNjcuMzY4NDIzIDQ2MS40NzM2OTljLTI2Ljk0NzM2OSAwLTUwLjUyNjMxNyAyMy41Nzg5NDgtNTAuNTI2MzE3IDUwLjUyNjMxN2wwIDBjMCAyNi45NDczNjkgMjMuNTc4OTQ4IDUwLjUyNjMxNyA1MC41MjYzMTcgNTAuNTI2MzE3bDM5NC4xMDUyNzYgMCAwIDM5NC4xMDUyNzZjMCAyNi45NDczNjkgMjMuNTc4OTQ4IDUwLjUyNjMxNyA1MC41MjYzMTcgNTAuNTI2MzE3bDAgMGMyNi45NDczNjkgMCA1MC41MjYzMTctMjMuNTc4OTQ4IDUwLjUyNjMxNy01MC41MjYzMTdMNTYyLjUyNjMzNCA1NjIuNTI2MzM0bDM5NC4xMDUyNzYgMGMyNi45NDczNjkgMCA1MC41MjYzMTctMjMuNTc4OTQ4IDUwLjUyNjMxNy01MC41MjYzMTdsMCAwYzAtMjYuOTQ3MzY5LTIzLjU3ODk0OC01MC41MjYzMTctNTAuNTI2MzE3LTUwLjUyNjMxN0w1NjIuNTI2MzM0IDQ2MS40NzM2OTkgNTYyLjUyNjMzNCA0NjEuNDczNjk5eiIgcC1pZD0iMjUxNyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjExODE1Njk2NTMwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTYwMCAtNjAwIDIyMjQgMjIyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMyNDEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNOTM4LjY2NjY2NyA0NjkuMzMzMzMzdjg1LjMzMzMzNEg4NS4zMzMzMzN2LTg1LjMzMzMzNHoiIHAtaWQ9IjMyNDIiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzMnB4IiB2aWV3Qm94PSIwIDAgMzIgMzIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYwLjEgKDg4MTMzKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5maXJzdC1kaXNhYmxlPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IueZveadv+mfs+inhumikSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IkZsYXQt6KeE6IyDIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjQuMDAwMDAwLCAtNDIzLjAwMDAwMCkiPgogICAgICAgICAgICA8ZyBpZD0iZmlyc3QtZGlzYWJsZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjQuMDAwMDAwLCA0MjMuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2i5aSH5Lu9LTE5IiBmaWxsPSIjRkZGRkZGIiBvcGFjaXR5PSIwLjAxIiB4PSIwIiB5PSIwIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDxwb2x5bGluZSBpZD0i6Lev5b6ELTEx5aSH5Lu9LTUiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNy4wMDAwMDAsIDE2LjAwMDAwMCkgcm90YXRlKC0zNjAuMDAwMDAwKSB0cmFuc2xhdGUoLTE3LjAwMDAwMCwgLTE2LjAwMDAwMCkgIiBwb2ludHM9IjE5IDIwIDE3IDE4IDE1IDE2IDE3IDE0IDE5IDEyIj48L3BvbHlsaW5lPgogICAgICAgICAgICAgICAgPGxpbmUgeDE9IjEzIiB5MT0iMTIiIHgyPSIxMyIgeTI9IjIwIiBpZD0i6Lev5b6ELTQiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48L2xpbmU+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIzIDEzTDE2IDIwTDIzIDI3IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTYyNzM4Njg1NzQ1MSIKICAgIGZpbGw9JyMzMzMnIHZpZXdCb3g9Ii01MDAgLTUwMCAyMDI0IDIwMjQiCiAgICBjbGFzcz0iaWNvbiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI4MDUiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPgogICAgPHBhdGgKICAgICAgICBkPSJNMzkwLjI3MiA4NTEuMDcyYTI1LjYgMjUuNiAwIDAgMS0xOC4xMTItNy40ODhMNTguNjg4IDUzMC4xMTJhMjUuNiAyNS42IDAgMCAxIDAtMzYuMjI0bDMxMy40NzItMzEzLjQ3MmEyNS42IDI1LjYgMCAwIDEgMzYuMjI0IDM2LjIyNEwxMTMuMDI0IDUxMmwyOTUuMzYgMjk1LjM2YTI1LjYgMjUuNiAwIDAgMS0xOC4xMTIgNDMuNzEyeiIKICAgICAgICBwLWlkPSIyODA2Ij48L3BhdGg+CiAgICA8cGF0aCBkPSJNOTQ3LjIgNTM3LjZINzYuOGEyNS42IDI1LjYgMCAxIDEgMC01MS4yaDg3MC40YTI1LjYgMjUuNiAwIDEgMSAwIDUxLjJ6IiBwLWlkPSIyODA3Ij48L3BhdGg+Cjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE3IDEzTDI0IDIwTDE3IDI3IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdD0iMTYyNzM4NjkxMzQxOCIKICAgIGZpbGw9JyMzMzMnIHZpZXdCb3g9Ii01MDAgLTUwMCAyMDI0IDIwMjQiCiAgICBjbGFzcz0iaWNvbiIgIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBwLWlkPSIyMTgwIgogICAgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj4KICAgIDxwYXRoCiAgICAgICAgZD0iTTYzMy43MjggMTcyLjkyOGEyNS42IDI1LjYgMCAwIDEgMTguMTEyIDcuNDg4bDMxMy40MDggMzEzLjQ3MmEyNS42IDI1LjYgMCAwIDEgMCAzNi4yMjRsLTMxMy40MDggMzEzLjQwOGEyNS42IDI1LjYgMCAwIDEtMzYuMjI0LTM2LjIyNGwyOTUuMjk2LTI5NS4zNi0yOTUuMjk2LTI5NS4zNmEyNS42IDI1LjYgMCAwIDEgMTguMTEyLTQzLjcxMnoiCiAgICAgICAgcC1pZD0iMjE4MSI+PC9wYXRoPgogICAgPHBhdGggZD0iTTc2LjggNDg2LjRoODcwLjRhMjUuNiAyNS42IDAgMSAxIDAgNTEuMkg3Ni44YTI1LjYgMjUuNiAwIDEgMSAwLTUxLjJ6IiBwLWlkPSIyMTgyIj48L3BhdGg+Cjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzMnB4IiB2aWV3Qm94PSIwIDAgMzIgMzIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDYwLjEgKDg4MTMzKSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5sYXN0LWRpc2FibGU8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0i55m95p2/6Z+z6KeG6aKRIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iRmxhdC3op4TojIMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNDQuMDAwMDAwLCAtNDIzLjAwMDAwMCkiPgogICAgICAgICAgICA8ZyBpZD0ibGFzdC1kaXNhYmxlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDQuMDAwMDAwLCA0MjMuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2i5aSH5Lu9LTIzIiBmaWxsPSIjRkZGRkZGIiBvcGFjaXR5PSIwLjAxIiB4PSIwIiB5PSIwIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDxwb2x5bGluZSBpZD0i6Lev5b6ELTEx5aSH5Lu9LTUiIHN0cm9rZT0iIzMzMzMzMyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNS4wMDAwMDAsIDE2LjAwMDAwMCkgc2NhbGUoLTEsIDEpIHJvdGF0ZSgtMzYwLjAwMDAwMCkgdHJhbnNsYXRlKC0xNS4wMDAwMDAsIC0xNi4wMDAwMDApICIgcG9pbnRzPSIxNyAyMCAxNSAxOCAxMyAxNiAxNSAxNCAxNyAxMiI+PC9wb2x5bGluZT4KICAgICAgICAgICAgICAgIDxsaW5lIHgxPSIxOSIgeTE9IjEyIiB4Mj0iMTkiIHkyPSIyMCIgaWQ9Iui3r+W+hC00IiBzdHJva2U9IiMzMzMzMzMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PC9saW5lPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjExNzE5MjA5NTA5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTIwMCAtMjAwIDE0MjQgMTQyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMxNzQiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMjE2LjMyNyAyMjMuNzc0cTE1NC4xMTYgMCA2MTYuNDY1IDAgMjcuMDEwIDAgNDYuMDc2IDE5LjA2NiAxOS4wNjYgMTkuMDY2IDE5LjA2NiA0Ni4wNzYgMCAxNTUuNzA1IDAgNDY3LjExNSAwIDI3LjAxMC0xOS4wNjYgNDYuMDc2LTE5LjA2NiAxOS4wNjYtNDYuMDc2IDE5LjA2Ni0yMDUuNzUzIDAtNjE2LjQ2NSAwLTI2LjIxNiAwLTQ2LjA3Ni0xOS4wNjYtMTkuMDY2LTE5LjA2Ni0xOS4wNjYtNDYuMDc2IDAtNTQuODE1IDAtMTY0LjQ0NCAwLTE5LjA2NiAwLTQ3LjY2NSAwLTE0LjI5OSAwLTMwLjk4MiAwLTIwLjY1NSAwLTQ1LjI4MiAwLTczLjA4NiAwLTE3OC43NDMgMC0yNy4wMTAgMTkuMDY2LTQ2LjA3NiAxOS44Ni0xOS4wNjYgNDYuMDc2LTE5LjA2NnpNMjE2LjMyNyA4NTUuMzMzcTE1NC4xMTYgMCA2MTYuNDY1IDAgNDEuMzEgMCA2OS45MDgtMjguNTk5IDI3LjgwNC0yOC41OTkgMjcuODA0LTY5LjExNCAwLTE1NS43MDUgMC00NjcuOTEgMC00MC41MTUtMjcuODA0LTY5LjExNC0yOC41OTktMjguNTk5LTY5LjkwOC0yOC41OTktMjA1Ljc1MyAwLTYxNi40NjUgMC00MC41MTUgMC02OS4xMTQgMjguNTk5LTI4LjU5OSAyOC41OTktMjguNTk5IDY5LjExNCAwIDQxLjMxIDAgMTIzLjkyOSAwIDQyLjg5OCAwIDEyOC42OTUgMCA0Mi44OTggMCA5Ni45MTggMCAyNy4wMTAgMCA1Ni40MDMgMCAyOS4zOTMgMCA2MS45NjQgMCAzOS43MjEgMjguNTk5IDY4LjMyIDI4LjU5OSAyOS4zOTMgNjkuMTE0IDI5LjM5M3pNMjYyLjQwMyA0MjUuNTU1cTAgMjguNTk5IDE5Ljg2IDQ4LjQ1OSAyMC42NTUgMjAuNjU1IDQ5LjI1NCAyMC42NTUgMjguNTk5IDAgNDkuMjU0LTIwLjY1NSAxOS44Ni0xOS44NiAxOS44Ni00OC40NTkgMC0yOC41OTktMTkuODYtNDguNDU5LTIwLjY1NS0yMC42NTUtNDkuMjU0LTIwLjY1NS0yOC41OTkgMC00OS4yNTQgMjAuNjU1dC0xOS44NiA0OC40NTl6TTI5NC45NzQgNDI1LjU1NXEwLTE1LjA5NCAxMS4xMjItMjYuMjE2IDEwLjMyNy0xMC4zMjcgMjUuNDIxLTEwLjMyNyAxNS4wOTQgMCAyNS40MjEgMTAuMzI3IDExLjEyMiAxMS4xMjIgMTEuMTIyIDI2LjIxNiAwIDE1LjA5NC0xMS4xMjIgMjYuMjE2LTEwLjMyNyAxMC4zMjctMjUuNDIxIDEwLjMyNy0xNC4yOTkgMC0yNS40MjEtMTAuMzI3dC0xMS4xMjItMjYuMjE2ek02NjMuNTgyIDQ5My4wODFxNDIuODk4IDQyLjg5OCAxNzIuMzg4IDE3Mi4zODggNS41NjEgNS41NjEgNS41NjEgMTEuMTIyIDAgNi4zNTUtNS41NjEgMTEuOTE2LTUuNTYxIDYuMzU1LTExLjkxNiA2LjM1NS01LjU2MSAwLTExLjEyMi02LjM1NS01Ny4xOTgtNTcuMTk4LTE3Mi4zODgtMTcyLjM4OC04LjczOS04LjczOS0yMi4yNDQtOC43MzktMTQuMjk5IDAtMjMuODMyIDguNzM5LTQ2LjA3NiA0Ni4wNzYtMTM4LjIyOCAxMzcuNDM0LTE5LjA2NiAxOS4wNjYtNDYuODcgMTkuMDY2LTI3LjAxMCAwLTQ2Ljg3LTE5LjA2Ni03LjE1LTcuMTUtMjEuNDQ5LTIyLjI0NC05LjUzMy04LjczOS0yMy44MzItOC43MzktMTMuNTA1IDAtMjIuMjQ0IDguNzM5LTE5LjA2NiAxOS4wNjYtNTcuMTk4IDU3LjE5OC0xMS4xMjIgMTEuOTE2LTIzLjAzOCAwLTUuNTYxLTUuNTYxLTUuNTYxLTExLjEyMiAwLTUuNTYxIDUuNTYxLTExLjkxNiAxOS4wNjYtMTkuMDY2IDU3LjE5OC01Ny4xOTggMTkuMDY2LTE5LjA2NiA0Ni44Ny0xOS4wNjYgMjcuMDEwIDAgNDYuODcgMTkuMDY2IDcuMTUgNy4xNSAyMS40NDkgMjIuMjQ0IDguNzM5IDguNzM5IDIyLjI0NCA4LjczOSAxNC4yOTkgMCAyMy44MzItOC43MzkgNDUuMjgyLTQ2LjA3NiAxMzYuNjM5LTEzNy40MzQgMTkuODYtMTkuMDY2IDQ3LjY2NS0xOS4wNjYgMjcuMDEwIDAgNDYuMDc2IDE5LjA2NnoiIHAtaWQ9IjMxNzUiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBmaWxsPScjNTU1NTU1JyB0PSIxNjIwMjY4NDg1MTU0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTMwMCAtMzAwIDE2MjQgMTYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwMzciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMTI4IDIxMy4zMzMzMzNsNDY5LjMzMzMzMyAwcTUyLjk5MiAwIDkwLjQ5NiAzNy41MDR0MzcuNTA0IDkwLjQ5NmwwIDc3LjY1MzMzMyAyOTguNjY2NjY3LTE2Mi45ODY2NjcgMCA1MTItMjk4LjY2NjY2Ny0xNjIuOTg2NjY3IDAgNzcuNjUzMzMzcTAgNTIuOTkyLTM3LjUwNCA5MC40OTZ0LTkwLjQ5NiAzNy41MDRsLTQ2OS4zMzMzMzMgMHEtNTIuOTkyIDAtOTAuNDk2LTM3LjUwNHQtMzcuNTA0LTkwLjQ5NmwwLTM0MS4zMzMzMzNxMC01Mi45OTIgMzcuNTA0LTkwLjQ5NnQ5MC40OTYtMzcuNTA0ek01OTcuMzMzMzMzIDI5OC42NjY2NjdsLTQ2OS4zMzMzMzMgMHEtMTcuNjY0IDAtMzAuMTY1MzMzIDEyLjUwMTMzM3QtMTIuNTAxMzMzIDMwLjE2NTMzM2wwIDM0MS4zMzMzMzNxMCAxNy42NjQgMTIuNTAxMzMzIDMwLjE2NTMzM3QzMC4xNjUzMzMgMTIuNTAxMzMzbDQ2OS4zMzMzMzMgMHExNy42NjQgMCAzMC4xNjUzMzMtMTIuNTAxMzMzdDEyLjUwMTMzMy0zMC4xNjUzMzNsMC0zNDEuMzMzMzMzcTAtMTcuNjY0LTEyLjUwMTMzMy0zMC4xNjUzMzN0LTMwLjE2NTMzMy0xMi41MDEzMzN6TTkzOC42NjY2NjcgNjI0LjM0MTMzM2wwLTIyNC42ODI2NjctMjA1LjY1MzMzMyAxMTIuMzQxMzMzeiIgcC1pZD0iMjAzOCI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBmaWxsPScjNDQ0NDQ0JyB0PSIxNjIwMjcyOTk5MzUwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTIwMCAtMjAwIDE0MjQgMTQyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwMzYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMiA2NTguMjg2YTIwMS4xNDMgMjAxLjE0MyAwIDAgMCAyMDEuMTQzLTIwMS4xNDNWMjU2YTIwMS4xNDMgMjAxLjE0MyAwIDAgMC00MDIuMjg2IDB2MjAxLjE0M0EyMDEuMTQzIDIwMS4xNDMgMCAwIDAgNTEyIDY1OC4yODZ6TTM2NS43MTQgMjU2YTE0Ni4yODYgMTQ2LjI4NiAwIDAgMSAyOTIuNTcyIDB2MjAxLjE0M2ExNDYuMjg2IDE0Ni4yODYgMCAwIDEtMjkyLjU3MiAweiIgcC1pZD0iMjAzNyIgZmlsbD0iIzY2NjY2NiI+PC9wYXRoPjxwYXRoIGQ9Ik04NDEuMTQzIDQ3NS40MjlhMjcuNDI5IDI3LjQyOSAwIDAgMC01NC44NTcgMCAyNTYgMjU2IDAgMCAxLTI1NiAyNTZoLTM2LjU3MmEyNTYgMjU2IDAgMCAxLTI1Ni0yNTYgMjcuNDI5IDI3LjQyOSAwIDAgMC01NC44NTcgMCAzMTAuODU3IDMxMC44NTcgMCAwIDAgMzAxLjcxNCAzMTAuODU3VjkzMi41N0gzNjUuNzE0YTI3LjQyOSAyNy40MjkgMCAwIDAgMCA1NC44NThoMjkyLjU3MmEyNy40MjkgMjcuNDI5IDAgMCAwIDAtNTQuODU4SDUzOS40MjlWNzg2LjI4NmEzMTAuODU3IDMxMC44NTcgMCAwIDAgMzAxLjcxNC0zMTAuODU3eiIgcC1pZD0iMjAzOCIgZmlsbD0iIzY2NjY2NiI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDIzVjI4SDI4VjIzIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CjxwYXRoIGQ9Ik0yMCAxMlYyNSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8cGF0aCBkPSJNMTUgMTdMMjAgMTJMMjUgMTciIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMS4yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0NzQwNTk1MjI1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTMwMCAtMzAwIDE2MjQgMTYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwODYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNODIyLjI3MiA2OTcuMzQ0Yy0xMS4yNjQtMS4wMjQtMjEuNTA0IDguMTkyLTIxLjUwNCAxOS40NTYtMi4wNDggMzIuNzY4LTguMTkyIDkwLjExMi0xOC40MzIgMTY0Ljg2NC0yLjA0OCAxMy4zMTItMTIuMjg4IDI0LjU3Ni0yNS42IDI2LjYyNEM2NTguNDMyIDkyMy42NDggNTU5LjEwNCA5MzEuODQgNDYwLjggOTMxLjg0cy0xOTguNjU2LTguMTkyLTI5Ni45Ni0yNC41NzZjLTE0LjMzNi0yLjA0OC0yNC41NzYtMTMuMzEyLTI2LjYyNC0yNi42MjRDMTIwLjgzMiA3NTguNzg0IDExMi42NCA2MzQuODggMTEyLjY0IDUxMmMwLTI4LjY3MiAyLjA0OC01Ni4zMiA1LjEyLTgyLjk0NGgyMjUuMjhjMzkuOTM2IDAgNzEuNjgtMzEuNzQ0IDcxLjY4LTcxLjY4Vjk2LjI1NmMxNy40MDgtMy4wNzIgMzIuNzY4LTQuMDk2IDQ2LjA4LTQuMDk2IDk2LjI1NiAwIDE5NS41ODQgOC4xOTIgMjk2Ljk2IDI0LjU3NiAxMy4zMTIgMi4wNDggMjMuNTUyIDEyLjI4OCAyNS42IDI2LjYyNCA5LjIxNiA3Mi43MDQgMTQuMzM2IDEyNS45NTIgMTcuNDA4IDE1Ny42OTZsMS4wMjQgNy4xNjhjMS4wMjQgMTEuMjY0IDExLjI2NCAxOS40NTYgMjIuNTI4IDE4LjQzMnMxOS40NTYtMTEuMjY0IDE4LjQzMi0yMi41MjhsLTEuMDI0LTcuMTY4Yy0zLjA3Mi0zMS43NDQtOC4xOTItODYuMDE2LTE3LjQwOC0xNTkuNzQ0LTQuMDk2LTMxLjc0NC0yOS42OTYtNTcuMzQ0LTYwLjQxNi02MS40NEM2NjEuNTA0IDU5LjM5MiA1NTkuMTA0IDUxLjIgNDYwLjggNTEuMmMtMjAuNDggMC00My4wMDggMy4wNzItNjguNjA4IDguMTkyLTUuMTIgMC0xMC4yNCAzLjA3Mi0xNC4zMzYgNy4xNjhMODQuOTkyIDM5NS4yNjRsLTIuMDQ4IDIuMDQ4Yy0xLjAyNCAyLjA0OC0yLjA0OCA1LjEyLTMuMDcyIDguMTkyQzc0Ljc1MiA0MzkuMjk2IDcxLjY4IDQ3NC4xMTIgNzEuNjggNTEyYzAgMTIzLjkwNCA4LjE5MiAyNDkuODU2IDI0LjU3NiAzNzQuNzg0IDQuMDk2IDMwLjcyIDI4LjY3MiA1NS4yOTYgNjAuNDE2IDYxLjQ0QzI1Ny4wMjQgOTY0LjYwOCAzNTkuNDI0IDk3Mi44IDQ2MC44IDk3Mi44YzEwMC4zNTIgMCAyMDIuNzUyLTguMTkyIDMwMi4wOC0yNC41NzYgMzEuNzQ0LTQuMDk2IDU2LjMyLTI5LjY5NiA2MC40MTYtNjEuNDQgMTAuMjQtNzUuNzc2IDE2LjM4NC0xMzMuMTIgMTguNDMyLTE2Ni45MTIgMS4wMjQtMTIuMjg4LTguMTkyLTIxLjUwNC0xOS40NTYtMjIuNTI4ek0zNzMuNzYgMTMyLjA5NnYyMjUuMjhjMCAxNy40MDgtMTMuMzEyIDMwLjcyLTMwLjcyIDMwLjcySDE0Ni40MzJsMjI3LjMyOC0yNTZ6IG01NjQuMjI0IDM5NC4yNGMtNDEuOTg0IDU1LjI5Ni03MC42NTYgOTAuMTEyLTkxLjEzNiAxMTAuNTkyLTQuMDk2IDQuMDk2LTkuMjE2IDYuMTQ0LTE0LjMzNiA2LjE0NHMtMTAuMjQtMi4wNDgtMTQuMzM2LTYuMTQ0Yy04LjE5Mi04LjE5Mi04LjE5Mi0yMC40OCAwLTI4LjY3MiAxNC4zMzYtMTQuMzM2IDMzLjc5Mi0zNi44NjQgNTkuMzkyLTcwLjY1Nkg1NTguMDhjLTExLjI2NCAwLTIwLjQ4LTkuMjE2LTIwLjQ4LTIwLjQ4czkuMjE2LTIwLjQ4IDIwLjQ4LTIwLjQ4aDMyNS42MzJjLTI0LjU3Ni0zMi43NjgtNDcuMTA0LTU5LjM5Mi02NS41MzYtNzcuODI0LTguMTkyLTguMTkyLTguMTkyLTIwLjQ4IDAtMjguNjcyczIwLjQ4LTguMTkyIDI4LjY3MiAwYzI0LjU3NiAyNC41NzYgNTUuMjk2IDYyLjQ2NCA5MS4xMzYgMTExLjYxNiA1LjEyIDcuMTY4IDUuMTIgMTcuNDA4IDAgMjQuNTc2eiIgcC1pZD0iMjA4NyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE1MTk1MjczNjEwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTQwMCAtNDAwIDE4MjQgMTgyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIyNzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMzM1LjEwNCA0MTEuNTYyNjY3YTIxLjMzMzMzMyAyMS4zMzMzMzMgMCAwIDEgMCAzMC4yMDhMMjg2LjE2NTMzMyA0OTAuNjY2NjY3aDE2MS40OTMzMzRhMjEuMzMzMzMzIDIxLjMzMzMzMyAwIDEgMSAwIDQyLjY2NjY2NkgyODYuMTY1MzMzbDQ4LjkzODY2NyA0OC44OTZhMjEuMzMzMzMzIDIxLjMzMzMzMyAwIDAgMS0zMC4yMDggMzAuMjA4bC04NS4zMzMzMzMtODUuMzMzMzMzYTIxLjMzMzMzMyAyMS4zMzMzMzMgMCAwIDEgMC0zMC4yMDhsODUuMzMzMzMzLTg1LjMzMzMzM2EyMS4zMzMzMzMgMjEuMzMzMzMzIDAgMCAxIDMwLjIwOCAwek03MzcuODM0NjY3IDUzMy4zMzMzMzNsLTQ4LjkzODY2NyA0OC44OTZhMjEuMzMzMzMzIDIxLjMzMzMzMyAwIDAgMCAzMC4yMDggMzAuMjA4bDg1LjMzMzMzMy04NS4zMzMzMzNhMjEuMzMzMzMzIDIxLjMzMzMzMyAwIDAgMCAwLTMwLjIwOGwtODUuMzMzMzMzLTg1LjMzMzMzM2EyMS4zMzMzMzMgMjEuMzMzMzMzIDAgMCAwLTMwLjIwOCAzMC4yMDhsNDguOTM4NjY3IDQ4Ljg5NmgtMTYxLjQ5MzMzNGEyMS4zMzMzMzMgMjEuMzMzMzMzIDAgMSAwIDAgNDIuNjY2NjY2aDE2MS40OTMzMzR6IiBwLWlkPSIyMjczIj48L3BhdGg+PHBhdGggZD0iTTg1LjMzMzMzMyAyODhBMTE3LjMzMzMzMyAxMTcuMzMzMzMzIDAgMCAxIDIwMi42NjY2NjcgMTcwLjY2NjY2N2g2MTguNjY2NjY2QTExNy4zMzMzMzMgMTE3LjMzMzMzMyAwIDAgMSA5MzguNjY2NjY3IDI4OHY0NDhBMTE3LjMzMzMzMyAxMTcuMzMzMzMzIDAgMCAxIDgyMS4zMzMzMzMgODUzLjMzMzMzM0gyMDIuNjY2NjY3QTExNy4zMzMzMzMgMTE3LjMzMzMzMyAwIDAgMSA4NS4zMzMzMzMgNzM2VjI4OHpNMjAyLjY2NjY2NyAyMzQuNjY2NjY3Yy0yOS40NCAwLTUzLjMzMzMzMyAyMy44OTMzMzMtNTMuMzMzMzM0IDUzLjMzMzMzM3Y0NDhjMCAyOS40NCAyMy44OTMzMzMgNTMuMzMzMzMzIDUzLjMzMzMzNCA1My4zMzMzMzNoNjE4LjY2NjY2NmMyOS40NCAwIDUzLjMzMzMzMy0yMy44OTMzMzMgNTMuMzMzMzM0LTUzLjMzMzMzM1YyODhjMC0yOS40NC0yMy44OTMzMzMtNTMuMzMzMzMzLTUzLjMzMzMzNC01My4zMzMzMzNIMjAyLjY2NjY2N3oiIHAtaWQ9IjIyNzQiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE1MTk1NDAxOTM2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTQwMCAtNDAwIDE4MjQgMTgyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9Ijc4ODgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMTcwLjY2NjY2NyAxNzAuNjY2NjY3YTg1LjMzMzMzMyA4NS4zMzMzMzMgMCAwIDEgODUuMzMzMzMzLTg1LjMzMzMzNGgzNDEuMzMzMzMzYTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDEgMzAuMTY1MzM0IDEyLjUwMTMzNGwyMTMuMzMzMzMzIDIxMy4zMzMzMzNBNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDAgMSA4NTMuMzMzMzMzIDM0MS4zMzMzMzN2NTEyYTg1LjMzMzMzMyA4NS4zMzMzMzMgMCAwIDEtODUuMzMzMzMzIDg1LjMzMzMzNEgyNTZhODUuMzMzMzMzIDg1LjMzMzMzMyAwIDAgMS04NS4zMzMzMzMtODUuMzMzMzM0VjE3MC42NjY2Njd6IG01NzkuNjY5MzMzIDE3MC42NjY2NjZMNTk3LjMzMzMzMyAxODguMzMwNjY3VjM0MS4zMzMzMzNoMTUzLjAwMjY2N3pNNTEyIDE3MC42NjY2NjdIMjU2djY4Mi42NjY2NjZoNTEyVjQyNi42NjY2NjdoLTIxMy4zMzMzMzNhNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDAgMS00Mi42NjY2NjctNDIuNjY2NjY3VjE3MC42NjY2Njd6IG0xNTguMTY1MzMzIDM1My44MzQ2NjZhNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDAgMSAwIDYwLjMzMDY2N2wtMTcwLjY2NjY2NiAxNzAuNjY2NjY3YTQyLjY2NjY2NyA0Mi42NjY2NjcgMCAwIDEtNjAuMzMwNjY3IDBsLTg1LjMzMzMzMy04NS4zMzMzMzRhNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDEgMSA2MC4zMzA2NjYtNjAuMzMwNjY2TDQ2OS4zMzMzMzMgNjY1LjAwMjY2N2wxNDAuNTAxMzM0LTE0MC41MDEzMzRhNDIuNjY2NjY3IDQyLjY2NjY2NyAwIDAgMSA2MC4zMzA2NjYgMHoiIGZpbGw9IiMwRDBEMEQiIHAtaWQ9Ijc4ODkiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE1MjU1MzMzMDc3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTIwMCAtMjAwIDE0MjQgMTQyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIxMTYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDQ0Mi43MDkzMzNhNjkuMjkwNjY3IDY5LjI5MDY2NyAwIDEgMSAwIDEzOC41ODEzMzQgNjkuMjkwNjY3IDY5LjI5MDY2NyAwIDAgMSAwLTEzOC41ODEzMzR6IG0yNTYgMGE2OS4yOTA2NjcgNjkuMjkwNjY3IDAgMSAxIDAgMTM4LjU4MTMzNCA2OS4yOTA2NjcgNjkuMjkwNjY3IDAgMCAxIDAtMTM4LjU4MTMzNHogbS01MTIgMGE2OS4yOTA2NjcgNjkuMjkwNjY3IDAgMSAxIDAgMTM4LjU4MTMzNCA2OS4yOTA2NjcgNjkuMjkwNjY3IDAgMCAxIDAtMTM4LjU4MTMzNHoiIHAtaWQ9IjIxMTciPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE3OTYwMzExOTQ0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTIwMCAtMjAwIDE0MjQgMTQyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjYwNzUiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUwNy44MTQgMTI3Ljk5OHEtMTU0LjE4MiAwLTI2My4yNzMgMTA5LjA5MS0xMDkuMDkxIDEwOS4wOTEtMTA5LjA5MSAyNjMuMjczIDAgMTU0LjE4MiAxMDkuMDkxIDI2My4yNzMgMTA5LjA5MSAxMDkuMDkxIDI2My4yNzMgMTA5LjA5MSAxNTQuMTgyIDAgMjYzLjI3My0xMDkuMDkxIDEwOS4wOTEtMTA5LjA5MSAxMDkuMDkxLTI2My4yNzMgMC0xNTQuMTgyLTEwOS4wOTEtMjYzLjI3My0xMDkuMDkxLTEwOS4wOTEtMjYzLjI3My0xMDkuMDkxek01MDcuODE0IDg0Mi45MDdxLTY5LjgxOCAwLTEzMy4wOTEtMjYuOTA5LTYzLjI3My0yNy42MzYtMTA5LjA5MS03My40NTUtNDUuODE4LTQ1LjgxOC03My40NTUtMTA5LjA5MS0yNi45MDktNjMuMjczLTI2LjkwOS0xMzMuMDkxIDAtNjkuODE4IDI2LjkwOS0xMzMuMDkxIDI3LjYzNi02My4yNzMgNzMuNDU1LTEwOS4wOTEgNDUuODE4LTQ1LjgxOCAxMDkuMDkxLTczLjQ1NSA2My4yNzMtMjYuOTA5IDEzMy4wOTEtMjYuOTA5IDY5LjgxOCAwIDEzMy4wOTEgMjYuOTA5IDYzLjI3MyAyNy42MzYgMTA5LjA5MSA3My40NTUgNDUuODE4IDQ1LjgxOCA3My40NTUgMTA5LjA5MSAyNi45MDkgNjMuMjczIDI2LjkwOSAxMzMuMDkxIDAgNjkuODE4LTI2LjkwOSAxMzMuMDkxLTI3LjYzNiA2My4yNzMtNzMuNDU1IDEwOS4wOTEtNDUuODE4IDQ1LjgxOC0xMDkuMDkxIDczLjQ1NS02My4yNzMgMjYuOTA5LTEzMy4wOTEgMjYuOTA5ek01MDkuOTk1IDY2MC4zNjJxLTEzLjA5MSAwLTIxLjgxOCA4LjcyNy04LjcyNyA5LjQ1NS04LjcyNyAyMi41NDUgMCAxMy4wOTEgOC43MjcgMjEuODE4IDguNzI3IDguNzI3IDIxLjgxOCA4LjcyNyAxMy4wOTEgMCAyMi41NDUtOC43MjcgOC43MjctOC43MjcgOC43MjctMjEuODE4IDAtMTMuMDkxLTguNzI3LTIyLjU0NS05LjQ1NS04LjcyNy0yMi41NDUtOC43Mjd6TTUwNy44MTQgMjc4LjU0M3EtNDcuMjczIDAtODEuNDU1IDMyLjcyNy0zNC4xODIgMzMuNDU1LTM0LjE4MiA4MS40NTUgMCA5LjQ1NSA2LjU0NSAxNiA3LjI3MyA3LjI3MyAxNy40NTUgNy4yNzMgOS40NTUgMCAxNi03LjI3MyA3LjI3My02LjU0NSA3LjI3My0xNiAwLTI5LjA5MSAxOS42MzYtNDguNzI3IDIwLjM2NC0xOS42MzYgNTAuMTgyLTE5LjYzNiAyOC4zNjQgMCA0OC43MjcgMjAuMzY0IDIwLjM2NCAyMC4zNjQgMjAuMzY0IDQ4LjcyNyAwIDcuMjczLTYuNTQ1IDE2LjcyNy02LjU0NSAxMC4xODItMTMuMDkxIDE3LjQ1NS01LjgxOCA2LjU0NS0xOC45MDkgMTkuNjM2LTE2LjcyNyAxNi43MjctMjYuMTgyIDI2LjkwOS04LjcyNyAxMC4xODItMTguOTA5IDI5LjA5MS05LjQ1NSAxOC4xODItOS40NTUgMzUuNjM2IDAgMTcuNDU1IDAgNTMuMDkxIDAgOS40NTUgNi41NDUgMTYuNzI3IDcuMjczIDcuMjczIDE3LjQ1NSA3LjI3MyA5LjQ1NSAwIDE2LTYuNTQ1IDcuMjczLTcuMjczIDcuMjczLTE3LjQ1NSAwLTE3LjQ1NSAwLTUzLjA5MSAwLTguNzI3IDYuNTQ1LTIwLjM2NCA3LjI3My0xMC45MDkgMTMuODE4LTE4LjE4MiA3LjI3My04IDIwLjM2NC0yMS4wOTEgMTYuNzI3LTE2LjcyNyAyNS40NTUtMjYuMTgyIDguNzI3LTkuNDU1IDE2LjcyNy0yNi4xODIgOC43MjctMTcuNDU1IDguNzI3LTMzLjQ1NS0wLjcyNy00OC0zNC45MDktODEuNDU1LTM0LjE4Mi0zMy40NTUtODEuNDU1LTMzLjQ1NXoiIHAtaWQ9IjYwNzYiPjwvcGF0aD48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHQ9IjE2MTgxOTY3NjMwNDciIGNsYXNzPSJpY29uIiB2aWV3Qm94PSItMjAwIC0yNTAgMTQyNCAxNDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMjE5MCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiI+CjxkZWZzPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgo8L3N0eWxlPgo8L2RlZnM+CjxwYXRoIGZpbGw9JyM1NTU1NTUnIGQ9Ik05NTQuNzU2OTYzIDI5MS40NzM0MjFjLTMuNjEwMjI0LTMuNjg0OTI2LTguMDQxMTQtNS41ODMxNTktMTMuMTY3OTA0LTUuNjQxNDg3LTEyLjUxNTAzNS0wLjE0MTIxNi0yNi41MDg3NDcgMTAuOTQyMjEzLTM2LjAzNTcyOCAyMC4yNTUzMjNMNTY0LjY0MDkxNyA2MzcuMjYzOTM1Yy0xMi41MDA3MDkgMTIuMjI4NTA5LTU4LjUxNTcxOCA4Ni45NjU2NzctNjAuNDY4MTg3IDkwLjE0MzA0M2wtNy40NTE3MTYgMTIuMTIxMDYyIDEyLjEzNTM4OC03LjQyODE4YzMuMjE3Mjc1LTEuOTY3ODE4IDc4Ljk2MzQyMy00OC4zNzM3MzEgOTEuNDM3NTI1LTYwLjU2OTQ5NGwzNDAuOTExMzktMzMxLjE3NzcwMkM5NTYuMzU2MzkgMzI1LjUzNzIzOCA5NjcuODc2NzcyIDMwNC45MTY1OTUgOTU0Ljc1Njk2MyAyOTEuNDczNDIxTDk1NC43NTY5NjMgMjkxLjQ3MzQyMXoiIHAtaWQ9IjIxOTEiPjwvcGF0aD4KPHBhdGggZmlsbD0nIzU1NTU1NScgZD0iTTc0MS45ODcwNDUgMzk0LjQ3ODRjMCAyNy42MDg4MDEtMjIuNDA3MzM2IDUwLjAxNTExNC01MC4wMTUxMTQgNTAuMDE1MTE0LTI3LjYxMjg5NCAwLTUwLjAyMTI1NC0yMi40MDYzMTMtNTAuMDIxMjU0LTUwLjAxNTExNCAwLTI3LjYwOTgyNSAyMi40MDgzNTktNTAuMDE4MTg0IDUwLjAyMTI1NC01MC4wMTgxODRDNzE5LjU3OTcwOSAzNDQuNDYwMjE2IDc0MS45ODcwNDUgMzY2Ljg2ODU3NSA3NDEuOTg3MDQ1IDM5NC40Nzg0TDc0MS45ODcwNDUgMzk0LjQ3ODR6IiBwLWlkPSIyMTkyIj48L3BhdGg+CjxwYXRoIGZpbGw9JyM1NTU1NTUnIGQ9Ik0yMTYuODExOTc3IDU2OS41MzEyOThjLTI3LjYwOTgyNSAwLTUwLjAxNjEzNy0yMi40MDMyNDMtNTAuMDE2MTM3LTUwLjAxMjA0NCAwLTI3LjYxMTg3MSAyMi40MDYzMTMtNTAuMDIwMjMgNTAuMDE2MTM3LTUwLjAyMDIzIDI3LjYwNzc3OCAwIDUwLjAxNzE2IDIyLjQwODM1OSA1MC4wMTcxNiA1MC4wMjAyM0MyNjYuODI5MTM4IDU0Ny4xMjgwNTUgMjQ0LjQxOTc1NSA1NjkuNTMxMjk4IDIxNi44MTE5NzcgNTY5LjUzMTI5OEwyMTYuODExOTc3IDU2OS41MzEyOTh6IiBwLWlkPSIyMTkzIj48L3BhdGg+CjxwYXRoIGZpbGw9JyM1NTU1NTUnIGQ9Ik0yOTEuODM3NzE4IDM5NC40Nzg0YzAtMjcuNjA5ODI1IDIyLjQwODM1OS01MC4wMTgxODQgNTAuMDE1MTE0LTUwLjAxODE4NCAyNy42MDk4MjUgMCA1MC4wMTgxODQgMjIuNDA4MzU5IDUwLjAxODE4NCA1MC4wMTgxODQgMCAyNy42MDg4MDEtMjIuNDA3MzM2IDUwLjAxNTExNC01MC4wMTgxODQgNTAuMDE1MTE0QzMxNC4yNDQwMzEgNDQ0LjQ5MzUxMyAyOTEuODM3NzE4IDQyMi4xMTE3NiAyOTEuODM3NzE4IDM5NC40Nzg0TDI5MS44Mzc3MTggMzk0LjQ3ODR6IiBwLWlkPSIyMTk0Ij48L3BhdGg+CjxwYXRoIGZpbGw9JyM1NTU1NTUnIGQ9Ik00NjYuODk1NzMzIDM0NC40NjAyMTZjMC0yNy42MDg4MDEgMjIuNDA2MzEzLTUwLjAxNTExNCA1MC4wMTUxMTQtNTAuMDE1MTE0IDI3LjYxMTg3MSAwIDUwLjAxOTIwNyAyMi40MDYzMTMgNTAuMDE5MjA3IDUwLjAxNTExNCAwIDI3LjYwODgwMS0yMi40MDgzNTkgNTAuMDE4MTg0LTUwLjAxOTIwNyA1MC4wMTgxODRDNDg5LjMwMjA0NSAzOTQuNDc4NCA0NjYuODk1NzMzIDM3Mi4wOTM1NzcgNDY2Ljg5NTczMyAzNDQuNDYwMjE2TDQ2Ni44OTU3MzMgMzQ0LjQ2MDIxNnoiIHAtaWQ9IjIxOTUiPjwvcGF0aD4KPHBhdGggZmlsbD0nIzU1NTU1NScgZD0iTTg1My43NDAyNjggNTE0LjA4NDQ3NWMtMjIuOTg4NTc0IDE0OC45NjY3NzctMTU4LjczMjE4OCAyOTkuOTQyMzAzLTM1MS45NDY3MjQgMjk5Ljk0MjMwMy0zNi43ODE3MTggMC03NS45OTg5MDUtNy4yNzQ2ODQtMTA3LjU5NzU3Ny0xOS45NTg1NjQtMzMuNjA3NDIyLTEzLjQ5MDI0Ni00OC44NTA1OTEtMjkuMzUzNTM4LTUxLjkwNzIwNy0zOS42OTMwMjQtMS41OTQzMTEtNS4zOTc5NC0zLjA5MjQzMS0xMS4yOTYyNzctNC42Nzk1NzktMTcuNTQxNTE1LTQuNjQ5OTAzLTE4LjMwMTgzMS05LjkyMTk3Ny0zOS4wNDUyNzEtMjAuMjUyMjUzLTU2LjI1OTMyOC0xOC4zNzU1MDktMzAuNjE4MzQ1LTQ0LjgxNDY3Mi0zNy4wNDQ3MDgtNjMuNzYwMTYzLTM3LjA0NDcwOC03LjE2NjIxMyAwLTE0Ljc5ODAzMSAwLjkxMzgxMi0yMi42NzU0NDIgMi43MTE3NjEtMTIuODY1MDA2IDIuOTM1ODY1LTI1LjM2MjY0NCA0LjQyMzc1My0zNy4xNDA4OTggNC40MjM3NTMtMjUuMTIzMTkgMC02Ny40NjM1MDgtNi42NjQ3OTMtNjguNzY1MTUzLTUxLjMwNzU0OS02LjU5MDA5Mi0yMjcuOTQyNDc5IDE4MC43MzQyOTQtMzUxLjc0ODIwMyAzNjkuMjk3OTA0LTM3My4zMjU2MzcgMTMuMzM2NzUtMS41MjQ3MjYgMjcuNjAyNjYxLTIuMjk2Mjk5IDQyLjQwMjczOS0yLjI5NjI5OSA1My4xMjM5MTggMCAxMTEuNTQzNDQ2IDEwLjAwMDc3MSAxNTIuNDYzNDE0IDI2LjA5OTQyNSA5LjI0NzYxOCAzLjYzNzg1NCAxNC4zNzU0MDUgNi4wMTYwMTcgMzkuMjAzODg0IDE4LjE4NDE1MSAyNS42NTMyNjMgMTIuNTcwMjkzIDQ2LjM0NzU4NCAzMC40MzIxMDMgNjIuODk3NTE1IDQ3LjY0MjA2N2wzMC4xNTc4NTctNTMuMDc0Nzk5Yy0xOC4wMjY1NjItMTcuMDEzNDg5LTQwLjMzMzYxNC0zNC40MDY2MjQtNjcuMTAyMjgxLTQ3LjUyNTQxLTI0Ljg4OTg3Ny0xMi4xOTY3ODctMzEuODkzMzg0LTE1LjUxNDM0NS00My41NjUyMTUtMjAuMTA1OTItNDcuMzM5MTY4LTE4LjYyMzE1LTExNC4wMzMxNS0zMC4xOTM2NzMtMTc0LjA1MzEyOC0zMC4xOTM2NzMtMTcuMDI2NzkyIDAtMzMuNTQ1IDAuOTAwNTA5LTQ5LjEwMjMyNSAyLjY3Nzk5Mi0xMTUuNTEzODc0IDEzLjIyMDA5My0yMjAuNjg3MjM4IDU5LjA1NzA0Ny0yOTYuMTQyNzY3IDEyOS4wNzQ3MjctODUuNTA3NDY2IDc5LjM0MjA0Ni0xMjguODcyMTEzIDE4NC42NTM1NTctMTI1LjQwNTE1MSAzMDQuNTU1MzY3IDEuMDA0ODg3IDM0LjQ3MDA2OSAxNS4xMTczMDIgNjMuMDE3MjQyIDQwLjgxMDQ3NCA4Mi41NTYyNTEgMjIuMzgwNzMgMTcuMDE5NjI5IDUyLjQzMTE0IDI2LjAxNDQ5IDg2LjkwMzI1NiAyNi4wMTQ0OSAxNi4xODY2NTcgMCAzMy4wOTY3OTItMS45ODUyMTQgNTAuMjY3ODctNS45MDM0NTMgMy41ODE1NzItMC44MTc2MjIgNi43OTM3My0xLjIzMjA2MSA5LjU0ODQ3LTEuMjMyMDYxIDExLjQ2OTIxNiAwIDE2Ljk4OTk1MyAxMC4wNDM3NSAyNi44NTI1NzggNDguODUzNjYxIDEuNjUzNjYzIDYuNTA5MjUxIDMuMzY0NjMxIDEzLjI0MDU1OSA1LjI4MTI4MyAxOS43MzAzNjcgOS40MzM4NiAzMS45MTE4MDQgMzkuMzQzMDUzIDU4Ljc4MzgyNSA4Ni40OTQ5NTYgNzcuNzEwODk2IDM4LjMxODcyNCAxNS4zODIzMzkgODUuNTQ0MzA1IDI0LjIwMzIzOCAxMjkuNTY2OTM4IDI0LjIwMzIzOCA1NC4xMDQyNDUgMCAxMDYuNDczOTg3LTEwLjEzNDgyNSAxNTUuNjU5MTk5LTMwLjEyMzA2NSA0Ni4yNDExNi0xOC43OTMwMTggODguNTAxNjYtNDUuNzYzMjc2IDEyNS42MDY3NDMtODAuMTY0Nzg0IDM1Ljc0NDA4Ni0zMy4xNDA3OTUgNjUuMjcwNTYzLTcxLjc5MTA3IDg3Ljc1NjY5My0xMTQuODgzNTE3IDIyLjUyNjAzOS00My4xNjMwNTUgMzYuODg4MTQyLTg4LjY2NjQxMiA0Mi42OTEzMTEtMTM1LjI2ODggMC4yNjE5NjYtMi4xMTcyMjEgMC41MDg1ODMtNC4zMjE0MjIgMC43MzE2NjQtNi41NDgxMzZsMC4xNDgzNzktMS40Njk0NjggMC0wLjA1NzMwNWMwLjIyMjA1Ny0yLjMzNjIwOCAwLjQwNDIwNi00LjY5NDkyOSAwLjU3MTAwNS03LjA2NDkwNkw4NTMuNzQwMjY4IDUxNC4wODQ0NzUgODUzLjc0MDI2OCA1MTQuMDg0NDc1eiIgcC1pZD0iMjE5NiI+PC9wYXRoPgo8L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHQ9IjE2MTgxOTgyMDg1MDEiIGNsYXNzPSJpY29uIiB2aWV3Qm94PSItMjAwIDAgMTQyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iMTYxMzciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPgo8ZGVmcz4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPgo8L2RlZnM+CjxwYXRoIGZpbGw9JyM1NTU1NTUnIGQ9Ik05NTEuNDUzIDQ3Ni44NDRINTIzLjY3MmExMzEuODM2IDEzMS44MzYgMCAwIDAtMjU0LjE4IDBINzIuNTQ3djcwLjMxMmgxOTYuOTQ1YTEzMS44MzYgMTMxLjgzNiAwIDAgMCAyNTQuMTggMGg0MjcuNzgxeiIgcC1pZD0iMTYxMzgiPjwvcGF0aD4KPC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE4ODEwMTI5OTgxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTMwMCAtMzAwIDE2MjQgMTYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMzNjMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTAgMGgyNTZ2MjU2SDB6IiBmaWxsPSIjMTYxNzE5IiBwLWlkPSIzMzY0Ij48L3BhdGg+PHBhdGggZD0iTTI1NiAwaDI1NnYyNTZIMjU2eiIgZmlsbD0iI0ZGRkZGRiIgcC1pZD0iMzM2NSI+PC9wYXRoPjxwYXRoIGQ9Ik0wIDUxMmgyNTZ2MjU2SDB6IiBmaWxsPSIjMTYxNzE5IiBwLWlkPSIzMzY2Ij48L3BhdGg+PHBhdGggZD0iTTI1NiA1MTJoMjU2djI1NkgyNTZ6IiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzMzY3Ij48L3BhdGg+PHBhdGggZD0iTTI1NiAyNTZoMjU2djI1NkgyNTZ6IiBmaWxsPSIjNzA3OTdGIiBwLWlkPSIzMzY4Ij48L3BhdGg+PHBhdGggZD0iTTUxMiAyNTZoMjU2djI1Nkg1MTJ6IiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzMzY5Ij48L3BhdGg+PHBhdGggZD0iTTI1NiA3NjhoMjU2djI1NkgyNTZ6IiBmaWxsPSIjNzA3OTdGIiBwLWlkPSIzMzcwIj48L3BhdGg+PHBhdGggZD0iTTUxMiA3NjhoMjU2djI1Nkg1MTJ6IiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzMzcxIj48L3BhdGg+PHBhdGggZD0iTTUxMiAwaDI1NnYyNTZINTEyeiIgZmlsbD0iI0E4QUZCNCIgcC1pZD0iMzM3MiI+PC9wYXRoPjxwYXRoIGQ9Ik03NjggMGgyNTZ2MjU2aC0yNTZ6IiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzMzczIj48L3BhdGg+PHBhdGggZD0iTTUxMiA1MTJoMjU2djI1Nkg1MTJ6IiBmaWxsPSIjQThBRkI0IiBwLWlkPSIzMzc0Ij48L3BhdGg+PHBhdGggZD0iTTc2OCA1MTJoMjU2djI1NmgtMjU2eiIgZmlsbD0iI0ZGRkZGRiIgcC1pZD0iMzM3NSI+PC9wYXRoPjxwYXRoIGQ9Ik03NjggMjU2aDI1NnYyNTZoLTI1NnpNNzY4IDc2OGgyNTZ2MjU2aC0yNTZ6IiBmaWxsPSIjQ0ZENURBIiBwLWlkPSIzMzc2Ij48L3BhdGg+PHBhdGggZD0iTTAgMjU2aDI1NnYyNTZIMHpNMCA3NjhoMjU2djI1NkgweiIgZmlsbD0iI0ZGRkZGRiIgcC1pZD0iMzM3NyI+PC9wYXRoPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDE0SDI4IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik0xMiAyMEwyMyAyMCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8cGF0aCBkPSJNMjUuNDggMTcuMzZMMjguNjggMTkuNzZDMjguODQgMTkuODggMjguODQgMjAuMTIgMjguNjggMjAuMjRMMjUuNDggMjIuNjRDMjUuMjgyMiAyMi43ODgzIDI1IDIyLjY0NzIgMjUgMjIuNFYxNy42QzI1IDE3LjM1MjggMjUuMjgyMiAxNy4yMTE3IDI1LjQ4IDE3LjM2WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyIDI2SDI4IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDE0SDI4IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik0xNyAyMEwyOCAyMCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8cGF0aCBkPSJNMTQuNTIgMTcuMzZMMTEuMzIgMTkuNzZDMTEuMTYgMTkuODggMTEuMTYgMjAuMTIgMTEuMzIgMjAuMjRMMTQuNTIgMjIuNjRDMTQuNzE3OCAyMi43ODgzIDE1IDIyLjY0NzIgMTUgMjIuNFYxNy42QzE1IDE3LjM1MjggMTQuNzE3OCAxNy4yMTE3IDE0LjUyIDE3LjM2WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyIDI2SDI4IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHQ9IjE2MTQ2Nzc0MjY3MTYiIGNsYXNzPSJpY29uIiB2aWV3Qm94PSItMzAwIC0zMDAgMTYyNCAxNjI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iNjE4MyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj4KPGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz4KPHBhdGggZmlsbD0iIzMzN0VGRiIgZD0iTTg1My4zMzMzMzMgOTU1LjczMzMzM0g1MTJhMTcuMDY2NjY3IDE3LjA2NjY2NyAwIDEgMSAwLTM0LjEzMzMzM2g2OC4yNjY2Njd2LTUxLjJoLTY4LjI2NjY2N2MtNjYuMDMwOTMzIDAtMTAyLjQtMzYuMzY5MDY3LTEwMi40LTEwMi40VjUyOS4wNjY2NjdoLTE1My42Yy02Ni4wMzA5MzMgMC0xMDIuNC0zNi4zNjkwNjctMTAyLjQtMTAyLjRWMTcwLjY2NjY2N2MwLTY2LjAzMDkzMyAzNi4zNjkwNjctMTAyLjQgMTAyLjQtMTAyLjRoMzQxLjMzMzMzM2M2Ni4wMzA5MzMgMCAxMDIuNCAzNi4zNjkwNjcgMTAyLjQgMTAyLjR2MjM4LjkzMzMzM2gxNTMuNmM2Ni4wMzA5MzMgMCAxMDIuNCAzNi4zNjkwNjcgMTAyLjQgMTAyLjR2MjU2YzAgNjYuMDMwOTMzLTM2LjM2OTA2NyAxMDIuNC0xMDIuNCAxMDIuNGgtNjguMjY2NjY2djUxLjJoNjguMjY2NjY2YTE3LjA2NjY2NyAxNy4wNjY2NjcgMCAxIDEgMCAzNC4xMzMzMzN6IG0tMjM4LjkzMzMzMy0zNC4xMzMzMzNoMTM2LjUzMzMzM3YtNTEuMmgtMTM2LjUzMzMzM3Y1MS4yeiBtMTUzLjYtODUuMzMzMzMzaDg1LjMzMzMzM2M0MS4wNzk0NjcgMCA2Mi4zNjE2LTE1Ljk1NzMzMyA2Ny4yMDg1MzQtNTEuMkg0NDQuODA4NTMzYzQuODI5ODY3IDM1LjI0MjY2NyAyNi4xMTIgNTEuMiA2Ny4xOTE0NjcgNTEuMmgyNTZ6IG0tMzI0LjI2NjY2Ny04NS4zMzMzMzRoNDc3Ljg2NjY2N1Y1MTJjMC00Ny4yMjM0NjctMjEuMDQzMi02OC4yNjY2NjctNjguMjY2NjY3LTY4LjI2NjY2N0g1MTJjLTQ3LjIyMzQ2NyAwLTY4LjI2NjY2NyAyMS4wNDMyLTY4LjI2NjY2NyA2OC4yNjY2Njd2MjM4LjkzMzMzM3pNMjU2IDEwMi40Yy00Ny4yMjM0NjcgMC02OC4yNjY2NjcgMjEuMDQzMi02OC4yNjY2NjcgNjguMjY2NjY3djI1NmMwIDQ3LjIyMzQ2NyAyMS4wNDMyIDY4LjI2NjY2NyA2OC4yNjY2NjcgNjguMjY2NjY2aDE1NC40NzA0YzUuODg4LTU1LjIxMDY2NyA0MS40MjA4LTg1LjMzMzMzMyAxMDEuNTI5Ni04NS4zMzMzMzNoMTUzLjZWMTcwLjY2NjY2N2MwLTQ3LjIyMzQ2Ny0yMS4wNDMyLTY4LjI2NjY2Ny02OC4yNjY2NjctNjguMjY2NjY3SDI1NnoiIHAtaWQ9IjYxODQiPgo8L3BhdGg+CjxwYXRoIGZpbGw9IiMzMzdFRkYiIGQ9Ik0zNDIuMTg2NjY3IDU2My4ySDQyNi42NjY2Njd2NjguMjY2NjY3aC04NC40OHoiIHAtaWQ9IjYxODUiPjwvcGF0aD4KPHBhdGggZmlsbD0iIzMzN0VGRiIgZD0iTTM0Mi4xODY2NjcgNjMxLjQ2NjY2N0g4NS4zMzMzMzNhMzQuMTMzMzMzIDM0LjEzMzMzMyAwIDAgMSAwLTY4LjI2NjY2N2gyNTYuODUzMzM0YTM0LjEzMzMzMyAzNC4xMzMzMzMgMCAwIDEgMCA2OC4yNjY2Njd6IiBwLWlkPSI2MTg2Ij48L3BhdGg+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHQ9IjE2MTQ2Nzc0MjY3MTYiIGNsYXNzPSJpY29uIiB2aWV3Qm94PSItMzAwIC0zMDAgMTYyNCAxNjI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iNjE4MyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj4KPGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz4KPHBhdGggZD0iTTg1My4zMzMzMzMgOTU1LjczMzMzM0g1MTJhMTcuMDY2NjY3IDE3LjA2NjY2NyAwIDEgMSAwLTM0LjEzMzMzM2g2OC4yNjY2Njd2LTUxLjJoLTY4LjI2NjY2N2MtNjYuMDMwOTMzIDAtMTAyLjQtMzYuMzY5MDY3LTEwMi40LTEwMi40VjUyOS4wNjY2NjdoLTE1My42Yy02Ni4wMzA5MzMgMC0xMDIuNC0zNi4zNjkwNjctMTAyLjQtMTAyLjRWMTcwLjY2NjY2N2MwLTY2LjAzMDkzMyAzNi4zNjkwNjctMTAyLjQgMTAyLjQtMTAyLjRoMzQxLjMzMzMzM2M2Ni4wMzA5MzMgMCAxMDIuNCAzNi4zNjkwNjcgMTAyLjQgMTAyLjR2MjM4LjkzMzMzM2gxNTMuNmM2Ni4wMzA5MzMgMCAxMDIuNCAzNi4zNjkwNjcgMTAyLjQgMTAyLjR2MjU2YzAgNjYuMDMwOTMzLTM2LjM2OTA2NyAxMDIuNC0xMDIuNCAxMDIuNGgtNjguMjY2NjY2djUxLjJoNjguMjY2NjY2YTE3LjA2NjY2NyAxNy4wNjY2NjcgMCAxIDEgMCAzNC4xMzMzMzN6IG0tMjM4LjkzMzMzMy0zNC4xMzMzMzNoMTM2LjUzMzMzM3YtNTEuMmgtMTM2LjUzMzMzM3Y1MS4yeiBtMTUzLjYtODUuMzMzMzMzaDg1LjMzMzMzM2M0MS4wNzk0NjcgMCA2Mi4zNjE2LTE1Ljk1NzMzMyA2Ny4yMDg1MzQtNTEuMkg0NDQuODA4NTMzYzQuODI5ODY3IDM1LjI0MjY2NyAyNi4xMTIgNTEuMiA2Ny4xOTE0NjcgNTEuMmgyNTZ6IG0tMzI0LjI2NjY2Ny04NS4zMzMzMzRoNDc3Ljg2NjY2N1Y1MTJjMC00Ny4yMjM0NjctMjEuMDQzMi02OC4yNjY2NjctNjguMjY2NjY3LTY4LjI2NjY2N0g1MTJjLTQ3LjIyMzQ2NyAwLTY4LjI2NjY2NyAyMS4wNDMyLTY4LjI2NjY2NyA2OC4yNjY2Njd2MjM4LjkzMzMzM3pNMjU2IDEwMi40Yy00Ny4yMjM0NjcgMC02OC4yNjY2NjcgMjEuMDQzMi02OC4yNjY2NjcgNjguMjY2NjY3djI1NmMwIDQ3LjIyMzQ2NyAyMS4wNDMyIDY4LjI2NjY2NyA2OC4yNjY2NjcgNjguMjY2NjY2aDE1NC40NzA0YzUuODg4LTU1LjIxMDY2NyA0MS40MjA4LTg1LjMzMzMzMyAxMDEuNTI5Ni04NS4zMzMzMzNoMTUzLjZWMTcwLjY2NjY2N2MwLTQ3LjIyMzQ2Ny0yMS4wNDMyLTY4LjI2NjY2Ny02OC4yNjY2NjctNjguMjY2NjY3SDI1NnoiIHAtaWQ9IjYxODQiPgo8L3BhdGg+CjxwYXRoIGQ9Ik0zNDIuMTg2NjY3IDU2My4ySDQyNi42NjY2Njd2NjguMjY2NjY3aC04NC40OHoiIHAtaWQ9IjYxODUiPjwvcGF0aD4KPHBhdGggZD0iTTM0Mi4xODY2NjcgNjMxLjQ2NjY2N0g4NS4zMzMzMzNhMzQuMTMzMzMzIDM0LjEzMzMzMyAwIDAgMSAwLTY4LjI2NjY2N2gyNTYuODUzMzM0YTM0LjEzMzMzMyAzNC4xMzMzMzMgMCAwIDEgMCA2OC4yNjY2Njd6IiBwLWlkPSI2MTg2Ij48L3BhdGg+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0OTIzMzI5NjM3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTMwMCAtMzAwIDE2MjQgMTYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEyNjE4IiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTg0Mi42NjY2NjcgMzg0aC03NC42NjY2NjdWMjc3LjMzMzMzM2EyMzQuNjY2NjY3IDIzNC42NjY2NjcgMCAxIDAtNDY5LjMzMzMzMyAwdjEwNi42NjY2NjdIMjI0YTUzLjM5MzMzMyA1My4zOTMzMzMgMCAwIDAtNTMuMzMzMzMzIDUzLjMzMzMzM3Y0OTAuNjY2NjY3YTUzLjM5MzMzMyA1My4zOTMzMzMgMCAwIDAgNTMuMzMzMzMzIDUzLjMzMzMzM2g2MTguNjY2NjY3YTUzLjM5MzMzMyA1My4zOTMzMzMgMCAwIDAgNTMuMzMzMzMzLTUzLjMzMzMzM1Y0MzcuMzMzMzMzYTUzLjM5MzMzMyA1My4zOTMzMzMgMCAwIDAtNTMuMzMzMzMzLTUzLjMzMzMzM3pNMzQxLjMzMzMzMyAyNzcuMzMzMzMzYzAtMTA1Ljg2NjY2NyA4Ni4xMzMzMzMtMTkyIDE5Mi0xOTJzMTkyIDg2LjEzMzMzMyAxOTIgMTkydjEwNi42NjY2NjdIMzQxLjMzMzMzM3ogbTUxMiA2NTAuNjY2NjY3YTEwLjY2NjY2NyAxMC42NjY2NjcgMCAwIDEtMTAuNjY2NjY2IDEwLjY2NjY2N0gyMjRhMTAuNjY2NjY3IDEwLjY2NjY2NyAwIDAgMS0xMC42NjY2NjctMTAuNjY2NjY3VjQzNy4zMzMzMzNhMTAuNjY2NjY3IDEwLjY2NjY2NyAwIDAgMSAxMC42NjY2NjctMTAuNjY2NjY2aDYxOC42NjY2NjdhMTAuNjY2NjY3IDEwLjY2NjY2NyAwIDAgMSAxMC42NjY2NjYgMTAuNjY2NjY2ek01MzMuMzMzMzMzIDU1NC42NjY2NjdhNjQgNjQgMCAwIDAtMjEuMzMzMzMzIDEyNC4zNFY3ODkuMzMzMzMzYTIxLjMzMzMzMyAyMS4zMzMzMzMgMCAwIDAgNDIuNjY2NjY3IDB2LTExMC4zMjY2NjZBNjQgNjQgMCAwIDAgNTMzLjMzMzMzMyA1NTQuNjY2NjY3eiBtMCA4NS4zMzMzMzNhMjEuMzMzMzMzIDIxLjMzMzMzMyAwIDEgMSAyMS4zMzMzMzQtMjEuMzMzMzMzIDIxLjMzMzMzMyAyMS4zMzMzMzMgMCAwIDEtMjEuMzMzMzM0IDIxLjMzMzMzM3oiIGZpbGw9IiM1QzVDNjYiIHAtaWQ9IjEyNjE5Ij48L3BhdGg+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjE0OTIzMzM5ODYwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iLTMwMCAtMzAwIDE2MjQgMTYyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEyNzU5IiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTEwMDUuNTUzMzMzIDE4NkEyMzQuNjY2NjY3IDIzNC42NjY2NjcgMCAwIDAgNTU0LjY2NjY2NyAyNzcuMzMzMzMzdjEwNi42NjY2NjdINTMuMzMzMzMzYTUzLjM5MzMzMyA1My4zOTMzMzMgMCAwIDAtNTMuMzMzMzMzIDUzLjMzMzMzM3Y0OTAuNjY2NjY3YTUzLjM5MzMzMyA1My4zOTMzMzMgMCAwIDAgNTMuMzMzMzMzIDUzLjMzMzMzM2g2MTguNjY2NjY3YTUzLjM5MzMzMyA1My4zOTMzMzMgMCAwIDAgNTMuMzMzMzMzLTUzLjMzMzMzM1Y0MzcuMzMzMzMzYTUzLjM5MzMzMyA1My4zOTMzMzMgMCAwIDAtNTMuMzMzMzMzLTUzLjMzMzMzM0g1OTcuMzMzMzMzVjI3Ny4zMzMzMzNjMC0xMDUuODY2NjY3IDg2LjEzMzMzMy0xOTIgMTkyLTE5MnMxOTIgODYuMTMzMzMzIDE5MiAxOTJ2MTI4YTIxLjMzMzMzMyAyMS4zMzMzMzMgMCAwIDAgNDIuNjY2NjY3IDBWMjc3LjMzMzMzM2EyMzMuMjIgMjMzLjIyIDAgMCAwLTE4LjQ0NjY2Ny05MS4zMzMzMzN6TTY4Mi42NjY2NjcgNDM3LjMzMzMzM3Y0OTAuNjY2NjY3YTEwLjY2NjY2NyAxMC42NjY2NjcgMCAwIDEtMTAuNjY2NjY3IDEwLjY2NjY2N0g1My4zMzMzMzNhMTAuNjY2NjY3IDEwLjY2NjY2NyAwIDAgMS0xMC42NjY2NjYtMTAuNjY2NjY3VjQzNy4zMzMzMzNhMTAuNjY2NjY3IDEwLjY2NjY2NyAwIDAgMSAxMC42NjY2NjYtMTAuNjY2NjY2aDYxOC42NjY2NjdhMTAuNjY2NjY3IDEwLjY2NjY2NyAwIDAgMSAxMC42NjY2NjcgMTAuNjY2NjY2ek0zNjIuNjY2NjY3IDU1NC42NjY2NjdhNjQgNjQgMCAwIDAtMjEuMzMzMzM0IDEyNC4zNFY3ODkuMzMzMzMzYTIxLjMzMzMzMyAyMS4zMzMzMzMgMCAwIDAgNDIuNjY2NjY3IDB2LTExMC4zMjY2NjZBNjQgNjQgMCAwIDAgMzYyLjY2NjY2NyA1NTQuNjY2NjY3eiBtMCA4NS4zMzMzMzNhMjEuMzMzMzMzIDIxLjMzMzMzMyAwIDEgMSAyMS4zMzMzMzMtMjEuMzMzMzMzIDIxLjMzMzMzMyAyMS4zMzMzMzMgMCAwIDEtMjEuMzMzMzMzIDIxLjMzMzMzM3oiIGZpbGw9IiM1QzVDNjYiIHAtaWQ9IjEyNzYwIj48L3BhdGg+PC9zdmc+"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=h(r(5)),i=h(r(2)),o=h(r(0)),a=h(r(1)),s=h(r(3)),c=h(r(4)),u=r(7),l=h(u);r(592);var d=h(r(595)),p=h(r(596)),f=h(r(597));function h(e){return e&&e.__esModule?e:{default:e}}var m=void 0,g=function(e){function t(){(0,o.default)(this,t);var e=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments));return e.topMargin=16,e.bottomMargin=16,e.state={previewBoxHeight:130},e.checkVisibleBoxes=function(){clearTimeout(m),m=setTimeout((function(){try{var t=[],r=document.getElementById("preview-box-list");if(!r)return;var n=r.getBoundingClientRect();if(n.left>=window.innerWidth||n.right<=0||n.top>=window.innerHeight||n.bottom<=0)return;for(var i=document.getElementsByClassName("preview-box"),o=0;o<i.length;o++){var a=i[o].getBoundingClientRect();a.top>=n.bottom||a.bottom<=n.top||a.left>=n.right||a.right<=n.left||t.push(o)}t.length>0&&e.props.store.handler.preparePreview(t)}catch(e){console.error("err",e)}}),300)},e.bindPreviewContainer=function(t){clearTimeout(e.bindContainerTimer),e.bindContainerTimer=setTimeout((function(){var r=document.getElementsByClassName("preview-box"),i=e.props.store,o=i.handler,a=i.currBoard,s=i.pageNames;if(r.length===s.length){var c=s.map((function(e,t){var n=r[t];return{pageIndex:e,boardName:a,container:n,id:n.id}}));e.lastBoard=a,e.lastPageNames=s.join(","),o.bindPreviewContainer((0,n.default)({previewContainerSettings:c},t))}}),0)},e._updateBoxHeight=function(){var t=Math.min(window.innerHeight/5,130);e.setState({previewBoxHeight:t}),e.bindPreviewContainer({reset:!0,keepPrevContainer:!1})},e.handleGotoPage=function(t){e.props.store.handler.gotoPage(t)},e.handleAddPage=function(t){var r=e.props.store,n=r.pageNames,i=r.handler;n.length<100&&i.addPage(t)},e.handlePreviewModeChange=function(){var t=e.props.store,r=t.previewMode,n=t.handler;"fitContainer"===r?n.setAppConfig({previewMode:"fitDoc"}):n.setAppConfig({previewMode:"fitContainer"})},e.handleDeletePage=function(t){var r=e.props.store,n=r.pageNames,i=r.handler;n.length>1&&e.props.store.popupAlert("确定要删除页面吗?删除后不可恢复",(function(){i.deletePage(t)}))},e}return(0,c.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this._updateBoxHeight(),this.updateMargin(this.props),this.bindPreviewContainer(),window.addEventListener("resize",this._updateBoxHeight),window.addEventListener("scroll",this.checkVisibleBoxes,!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._updateBoxHeight),window.removeEventListener("scroll",this.checkVisibleBoxes,!0)}},{key:"componentWillReceiveProps",value:function(e){this.updateMargin(e)}},{key:"componentDidUpdate",value:function(){(this.props.store.currBoard!==this.lastBoard||this.props.store.pageNames.join(",")!==this.lastPageNames)&&this.bindPreviewContainer(),this.checkVisibleBoxes()}},{key:"updateMargin",value:function(e){var t=16,r=16;e.store.containerOptions.forEach((function(n){"bottomLeft"===n.position&&"left"===e.position?r=70:"topLeft"===n.position&&"left"===e.position?t=70:"bottomRight"===n.position&&"right"===e.position?r=70:"topRight"===n.position&&"right"===e.position&&(t=70)})),this.topMargin=t,this.bottomMargin=r}},{key:"render",value:function(){var e="preview-"+this.props.state+" "+this.props.position,t=32+this.state.previewBoxHeight*(1920/1080),r={top:this.topMargin,bottom:this.bottomMargin,width:t,left:"left"===this.props.position?"-"+t+"px":"unset",right:"right"===this.props.position?"-"+t+"px":"unset"};return l.default.createElement("div",{className:"page-preview-container "+e,style:r},this.renderPreivewOfBoard(),this.renderFooter())}},{key:"renderPreivewOfBoard",value:function(){var e=this,t=this.props.store,r=t.currPageIndex,n=t.pageNames,i=t.currBoard,o=n.length>1;return l.default.createElement("div",{className:"preview-box-list",id:"preview-box-list"},n.map((function(t,n){var a="board-"+i+"page-"+t;return l.default.createElement("div",{key:a,id:a,className:"preview-box"+(r===n?" active":""),style:{height:e.state.previewBoxHeight+"px",width:e.state.previewBoxHeight*(1920/1080)+"px",position:"relative",overflow:"hidden"},onClick:function(t){t.stopPropagation(),e.handleGotoPage(n)}},l.default.createElement("span",{className:"page-index"},n+1),o&&l.default.createElement("div",{className:"preview-delete btn",onClick:function(t){t.stopPropagation(),e.handleDeletePage(n)}}))})))}},{key:"renderFooter",value:function(){var e=this,t=this.props.store,r=t.currPageIndex,n=t.previewMode,i="fitContainer"===n?"文档预览":"白板预览",o="fitContainer"===n?p.default:f.default,a=this.props.store.handler.hasDoc();return l.default.createElement("div",{className:"footer"},a&&l.default.createElement("div",null,l.default.createElement("div",{className:"left",onClick:function(t){t.stopPropagation(),e.handleAddPage(r)}},l.default.createElement("img",{className:"icon",src:d.default}),l.default.createElement("span",{className:"text"},"添加页面")),l.default.createElement("div",{className:"right",onClick:function(t){t.stopPropagation(),e.handlePreviewModeChange()}},l.default.createElement("img",{className:"icon",src:o}),l.default.createElement("span",{className:"text"},i))),!a&&l.default.createElement("div",{className:"center",onClick:function(t){t.stopPropagation(),e.handleAddPage(r)}},l.default.createElement("img",{className:"icon",src:d.default}),l.default.createElement("span",{className:"text"},"添加页面")))}}]),t}(u.Component);t.default=g},function(e,t,r){var n=r(593);"string"==typeof n&&(n=[[e.i,n,""]]),r(25)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){t=e.exports=r(24)(!1);var n=r(97)(r(594));t.push([e.i,".page-preview-container {\n    position: absolute;\n    border-radius: 4px;\n    background: #FFFFFF;\n    box-shadow: 0 8px 24px -4px rgba(0,0,0,0.1)\n}\n\n.page-preview-container.right.preview-open {\n            -webkit-animation: slide-in-right .5s both ease-in;\n                    animation: slide-in-right .5s both ease-in;;\n        }\n\n.page-preview-container.right.preview-close {\n            -webkit-animation: slide-out-right .5s both ease-in;\n                    animation: slide-out-right .5s both ease-in;;\n        }\n\n.page-preview-container.left.preview-open {\n            -webkit-animation: slide-in-left .5s both ease-in;\n                    animation: slide-in-left .5s both ease-in;;\n        }\n\n.page-preview-container.left.preview-close {\n            -webkit-animation: slide-out-left .5s both ease-in;\n                    animation: slide-out-left .5s both ease-in;;\n        }\n\n.page-preview-container {\n\n    @-webkit-keyframes slide-in-left {\n        0% { transform: translateX(0%); }\n        100% { transform: translateX(100%); }\n    }\n  \n    @-webkit-keyframes slide-out-left {\n        0% { transform: translateX(100%); }\n        100% { transform: translateX(0%); }\n    } \n\n    @-webkit-keyframes slide-in-right {\n        0% { transform: translateX(0%); }\n        100% { transform: translateX(-100%); }\n    }\n  \n    @-webkit-keyframes slide-out-right {\n        0% { transform: translateX(-100%); }\n        100% { transform: translateX(0%); }\n    }\n}\n\n@-webkit-keyframes slide-in-left {\n        0% { transform: translateX(0%); }\n        100% { transform: translateX(100%); }\n    }\n\n@keyframes slide-in-left {\n        0% { transform: translateX(0%); }\n        100% { transform: translateX(100%); }\n    }\n\n@-webkit-keyframes slide-out-left {\n        0% { transform: translateX(100%); }\n        100% { transform: translateX(0%); }\n    }\n\n@keyframes slide-out-left {\n        0% { transform: translateX(100%); }\n        100% { transform: translateX(0%); }\n    }\n\n@-webkit-keyframes slide-in-right {\n        0% { transform: translateX(0%); }\n        100% { transform: translateX(-100%); }\n    }\n\n@keyframes slide-in-right {\n        0% { transform: translateX(0%); }\n        100% { transform: translateX(-100%); }\n    }\n\n@-webkit-keyframes slide-out-right {\n        0% { transform: translateX(-100%); }\n        100% { transform: translateX(0%); }\n    }\n\n@keyframes slide-out-right {\n        0% { transform: translateX(-100%); }\n        100% { transform: translateX(0%); }\n    }\n\n.page-preview-container.preview-default {\n        transform: translateX(0%);\n    }\n\n.page-preview-container .preview-box-list {\n        scroll-behavior: auto;\n        overflow: auto;\n        height: calc(100% - 40px);\n        box-sizing: border-box;\n        padding: 16px;\n        flex-direction: row;\n        flex-wrap: wrap;\n        justify-content: center;\n        \n        /* Works on Chrome/Edge/Safari */\n    }\n\n.page-preview-container .preview-box-list .preview-box {\n            flex-basis: 150px;\n            flex-grow: 1;\n            border: 1px solid #ccc;\n            border-radius: 2px;\n            position: relative;\n            margin-bottom: 16px;\n        }\n\n.page-preview-container .preview-box-list .preview-box .page-index {\n                position: absolute;\n                left: 8px;\n                top: 4px;\n                z-index: 999;\n            }\n\n.page-preview-container .preview-box-list .preview-box img {\n                display: inline-block;\n                width: 100%;\n                height: 100%;\n                -o-object-fit: contain;\n                   object-fit: contain;\n            }\n\n@media (hover: none) {\n                .page-preview-container .preview-box-list .preview-box .preview-delete {\n                    display: inline-block !important;\n                }\n            }\n\n.page-preview-container .preview-box-list .preview-box:hover {\n                cursor: pointer;\n                border: 1px solid #337eee\n            }\n\n.page-preview-container .preview-box-list .preview-box:hover .preview-delete {\n                    display: inline-block;\n                }\n\n.page-preview-container .preview-box-list .preview-box .preview-delete {\n                position: absolute;\n                right: 8px;\n                top: 8px;\n                z-index: 999;\n\n                width: 16px;\n                height: 16px;\n                display: none;\n                background-size: cover;\n            }\n\n.page-preview-container .preview-box-list .preview-box .preview-delete:hover {\n                    cursor: pointer;\n                }\n\n.page-preview-container .preview-box-list .preview-box .preview-delete {\n    \n                background-image: url("+n+");\n            }\n\n.page-preview-container .preview-box-list .preview-box.active {\n            border: 1px solid #337eee;\n        }\n\n.page-preview-container .preview-box-list .preview-button-group{\n            display: flex;\n            flex-direction: row;\n            justify-content: flex-end;\n            margin-bottom: 12px;\n        }\n\n.page-preview-container .preview-box-list .preview-button-group .btn {\n                width: 28px;\n                height: 28px;\n                display: inline-block;\n                background-size: cover\n            }\n\n.page-preview-container .preview-box-list .preview-button-group .btn:hover {\n                    cursor: pointer;\n                }\n\n.page-preview-container .preview-box-list {\n    \n        scrollbar-width: thin;\n        scrollbar-color: black white\n}\n\n.page-preview-container .preview-box-list::-webkit-scrollbar {\n            width: 12px;\n        }\n\n.page-preview-container .preview-box-list::-webkit-scrollbar-track {\n            background: white;\n        }\n\n.page-preview-container .preview-box-list::-webkit-scrollbar-thumb {\n            background-color: #d9d9de;\n            border-radius: 20px;\n            border: 3px solid white;\n        }\n\n.page-preview-container .footer {\n        padding: 8px 16px;\n        position: relative;\n        border-top: 1px solid #e6e7eb;\n        color: #337eff;\n    }\n\n.page-preview-container .footer .left {\n            left: 16px;\n        }\n\n.page-preview-container .footer .right {\n            right: 16px;\n        }\n\n.page-preview-container .footer .center {\n            left: 50%;\n            transform: translateX(-50%);\n        }\n\n.page-preview-container .footer .left, .page-preview-container .footer .right, .page-preview-container .footer .center {\n            position: absolute;\n            height: 20px;\n            width: -webkit-fit-content;\n            width: -moz-fit-content;\n            width: fit-content\n        }\n\n.page-preview-container .footer .left:hover, .page-preview-container .footer .right:hover, .page-preview-container .footer .center:hover {\n                cursor: pointer;\n            }\n\n.page-preview-container .footer .left .icon, .page-preview-container .footer .right .icon, .page-preview-container .footer .center .icon {\n            width: 20px;\n            height: 20px;\n        }\n\n.page-preview-container .footer .left .text, .page-preview-container .footer .right .text, .page-preview-container .footer .center .text {\n            height: 20px;\n            line-height: 20px;\n            vertical-align: top;\n            margin-left: 4px;\n        }",""])},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjQgNCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDE1SDI4IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik0xNiAxMkgyNCIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8cGF0aCBkPSJNMTQgMTVWMjdDMTQgMjcuNTUyMyAxNC40NDc3IDI4IDE1IDI4SDI1QzI1LjU1MjMgMjggMjYgMjcuNTUyMyAyNiAyN1YxNSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxLjIiLz4KPHBhdGggZD0iTTE4LjYgMThDMTguNiAxNy42Njg2IDE4LjMzMTQgMTcuNCAxOCAxNy40QzE3LjY2ODYgMTcuNCAxNy40IDE3LjY2ODYgMTcuNCAxOEgxOC42Wk0xNy40IDI1QzE3LjQgMjUuMzMxNCAxNy42Njg2IDI1LjYgMTggMjUuNkMxOC4zMzE0IDI1LjYgMTguNiAyNS4zMzE0IDE4LjYgMjVIMTcuNFpNMTcuNCAxOFYyNUgxOC42VjE4SDE3LjRaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMjIuNiAxOEMyMi42IDE3LjY2ODYgMjIuMzMxNCAxNy40IDIyIDE3LjRDMjEuNjY4NiAxNy40IDIxLjQgMTcuNjY4NiAyMS40IDE4SDIyLjZaTTIxLjQgMjVDMjEuNCAyNS4zMzE0IDIxLjY2ODYgMjUuNiAyMiAyNS42QzIyLjMzMTQgMjUuNiAyMi42IDI1LjMzMTQgMjIuNiAyNUgyMS40Wk0yMS40IDE4VjI1SDIyLjZWMThIMjEuNFoiIGZpbGw9ImJsYWNrIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggNEM4LjI3NjE0IDQgOC41IDQuMjIzODYgOC41IDQuNVY3LjVIMTEuNUMxMS43NzYxIDcuNSAxMiA3LjcyMzg2IDEyIDhDMTIgOC4yNzYxNCAxMS43NzYxIDguNSAxMS41IDguNUg4LjVWMTEuNUM4LjUgMTEuNzc2MSA4LjI3NjE0IDEyIDggMTJDNy43MjM4NiAxMiA3LjUgMTEuNzc2MSA3LjUgMTEuNVY4LjVINC41QzQuMjIzODYgOC41IDQgOC4yNzYxNCA0IDhDNCA3LjcyMzg2IDQuMjIzODYgNy41IDQuNSA3LjVINy41VjQuNUM3LjUgNC4yMjM4NiA3LjcyMzg2IDQgOCA0WiIgZmlsbD0iIzREODJGNyIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMgMUMxLjg5NTQzIDEgMSAxLjg5NTQzIDEgM1YxM0MxIDE0LjEwNDYgMS44OTU0MyAxNSAzIDE1SDEzQzE0LjEwNDYgMTUgMTUgMTQuMTA0NiAxNSAxM1YzQzE1IDEuODk1NDMgMTQuMTA0NiAxIDEzIDFIM1pNMTMgMkMxMy41NTIzIDIgMTQgMi40NDc3MiAxNCAzVjEzQzE0IDEzLjU1MjMgMTMuNTUyMyAxNCAxMyAxNEgzQzIuNDQ3NzIgMTQgMiAxMy41NTIzIDIgMTNWM0MyIDIuNDQ3NzIgMi40NDc3MiAyIDMgMkgxM1oiIGZpbGw9IiM0RDgyRjciLz4KPC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjQ5NDEgNC4xMzYzOUw5Ljc1MDIgMS40MDg3MUM5LjYyODYxIDEuMjg1MzcgOS40ODM2MSAxLjE4NzU1IDkuMzIzNzEgMS4xMjFDOS4xNjM4MSAxLjA1NDQ0IDguOTkyMjMgMS4wMjA0OSA4LjgxOTA0IDEuMDIxMTNMMi43NDUzMyAxQzEuNzc3NiAxLjAyMTEzIDEgMS43OTQ2NiAxIDIuNzU3NTJWMTMuMjQxN0MxIDE0LjIxMSAxLjc5MjIyIDE1IDIuNzY4MDggMTVIOC45MzAzNUM4LjYxNTUzIDE0Ljc2MTIgOC4zMzE5MSAxNC40ODM5IDguMDg2MTMgMTQuMTc0NUgyLjc0NTMzQzIuNDk1NjQgMTQuMTczMiAyLjI1NjQ2IDE0LjA3MzggMi4wNzkzOCAxMy44OTc4QzEuOTAyMjkgMTMuNzIxOCAxLjgwMTQ5IDEzLjQ4MzIgMS43OTg3MiAxMy4yMzM1VjIuNzU3NTJDMS43OTg3MiAyLjIzOTkzIDIuMjI0NDkgMS44MTY2IDIuNzE2MDggMS44MTY2QzIuNzU5OTUgMS44MTY2IDcuNzExNTUgMS44MTY2IDguOTc5OTIgMS44Mzg1NEw5LjA3NDk5IDEuOTExNjdWMy43MjExOEM5LjA3NDk5IDQuMzA1NCA5LjU1MTk1IDQuNzc5MTEgMTAuMTM4NiA0Ljc3OTExSDExLjk4MDZMMTIuMDU0NiA0Ljg1MjIzVjcuMTU4MjFDMTIuMzQwNiA3LjE4NjY1IDEyLjYxMiA3LjI0NTE1IDEyLjg4MzMgNy4zMzI5MVY1LjA3MDgxQzEyLjg4NTIgNC44OTY4MSAxMi44NTE2IDQuNzI0MjUgMTIuNzg0NyA0LjU2MzYyQzEyLjcxNzggNC40MDI5OSAxMi42MTkgNC4yNTc2NCAxMi40OTQxIDQuMTM2MzlaIiBmaWxsPSIjNEQ4MkY3Ii8+CjxwYXRoIGQ9Ik00LjA2NTcgMTAuNjM3NUMzLjk0NzYgMTAuNjM3NSAzLjgzNDMgMTAuNjg0MiAzLjc1MDU2IDEwLjc2NzVDMy42NjY4MiAxMC44NTA4IDMuNjE5NDUgMTAuOTYzOSAzLjYxODggMTEuMDgyQzMuNjE4OCAxMS4zMTUyIDMuODA4OTQgMTEuNTI3MiA0LjA2NTcgMTEuNTI3Mkg3LjE2MTQ2VjExLjQ5OEM3LjE2MTQ2IDExLjIwNjMgNy4xOTA3MSAxMC45MTM4IDcuMjQ5MjIgMTAuNjM3NUg0LjA2NTdaTTExLjU2MyAxMC40MzI3QzExLjAyMDIgMTAuNDMyNyAxMC42MDkxIDEwLjg3OCAxMC42MDkxIDExLjQ3NkMxMC42MDkxIDEyLjA2NzYgMTEuMDIwMiAxMi41MTkzIDExLjU2MyAxMi41MTkzQzEyLjEwNTcgMTIuNTE5MyAxMi41MTY5IDEyLjA3MzMgMTIuNTE2OSAxMS40NzZDMTIuNTM4OCAxMC45MDczIDEyLjEwNTcgMTAuNDMyNyAxMS41NjMgMTAuNDMyN1oiIGZpbGw9IiM0RDgyRjciLz4KPHBhdGggZD0iTTExLjU2MyA4Ljg3OTE2QzkuOTcxMjIgOC44NzkxNiA4LjU4NDIyIDkuOTY1NTIgOC4wNDIyNiAxMS41MDUzQzguNTg1MDMgMTMuMDM2OSA5Ljk0OTI4IDE0LjEzMTQgMTEuNTYzIDE0LjEzMTRDMTMuMTc2NyAxNC4xMzE0IDE0LjU0MDkgMTMuMDE0MiAxNS4wODQ1IDExLjQ4MjVDMTQuNTMzNiA5Ljk2NTUyIDEzLjE3NjcgOC44NzkxNiAxMS41NjMgOC44NzkxNlpNMTEuNTYzIDEzLjIzMzVDMTAuNjc1NyAxMy4yMzM1IDkuOTcxMjIgMTIuNDY4MSA5Ljk3MTIyIDExLjQ5NzJDOS45NzEyMiAxMC41MjYyIDEwLjY3NTcgOS43NjA3NiAxMS41NjMgOS43NjA3NkMxMi40NTAzIDkuNzYwNzYgMTMuMTU0NyAxMC41MjYyIDEzLjE1NDcgMTEuNDk3MkMxMy4xNzY3IDEyLjQ2ODEgMTIuNDcyMiAxMy4yMzM1IDExLjU2MyAxMy4yMzM1Wk0xMC4yNjQ1IDYuMjUzMDRDMTAuMjQyNiA2LjAxOTAzIDEwLjA1MTcgNS44MDc3NyA5Ljc5NDkgNS44MDc3N0g0LjA3MzgzQzMuOTU1NTEgNS44MDc3NyAzLjg0MiA1Ljg1NDYxIDMuNzU4MTEgNS45MzgwNEMzLjY3NDIyIDYuMDIxNDggMy42MjY3NyA2LjEzNDczIDMuNjI2MTIgNi4yNTMwNEMzLjYyNjEyIDYuNDg2MjQgMy44MTcwNyA2LjY5ODMxIDQuMDczODMgNi42OTgzMUg5LjgxNzY1QzkuODc2MzIgNi42OTg3NCA5LjkzNDQ5IDYuNjg3NTMgOS45ODg4IDYuNjY1MzNDMTAuMDQzMSA2LjY0MzEyIDEwLjA5MjUgNi42MTAzNyAxMC4xMzQgNi41Njg5NkMxMC4xNzU2IDYuNTI3NTQgMTAuMjA4NSA2LjQ3ODMgMTAuMjMwOSA2LjQyNDA3QzEwLjI1MzMgNi4zNjk4NSAxMC4yNjQ4IDYuMzExNzIgMTAuMjY0NSA2LjI1MzA0Wk04LjY1ODE2IDguMjIxODJINC4wNzM4M0MzLjk1NTUxIDguMjIxODIgMy44NDIgOC4yNjg2NSAzLjc1ODExIDguMzUyMDlDMy42NzQyMiA4LjQzNTUyIDMuNjI2NzcgOC41NDg3NyAzLjYyNjEyIDguNjY3MDlDMy42MjYxMiA4LjkyMTQxIDMuODE3MDcgOS4xMTIzNiA0LjA3MzgzIDkuMTEyMzZINy44ODEzN0M3Ljg4MDU2IDkuMTEyMzYgOC4yNDcwMiA4LjUyODE1IDguNjU4MTYgOC4yMjE4MloiIGZpbGw9IiM0RDgyRjciLz4KPC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTYuOTk4MTggOS43NDkyNEw5LjIxMDQzIDUuOTY1MTNDOS4yOTc3NiA1LjgwOTg5IDkuNDYyNyA1LjcyMjU2IDkuNjM3MzYgNS43MjI1NkM5LjgxMjAxIDUuNzIyNTYgOS45NzY5NiA1LjgxOTU5IDEwLjA2NDMgNS45NjUxM0wxMi44MDA1IDEwLjY0MTlDMTIuODg3OCAxMC43OTcxIDEyLjg4NzggMTAuOTgxNSAxMi44MDA1IDExLjEzNjdDMTIuNzEzMiAxMS4yOTIgMTIuNTQ4MiAxMS4zNzkzIDEyLjM3MzYgMTEuMzc5M0g0LjQ5NDg1QzQuMjIzMTcgMTEuMzc5MyA0IDExLjE1NjIgNCAxMC44ODQ1QzQgMTAuNzk3MSA0LjAxOTQxIDEwLjcwOTggNC4wNjc5MiAxMC42MzIyTDUuMzY4MSA4LjQxMDI1QzUuNTAzOTQgOC4xNzczOCA1LjgwNDczIDguMDk5NzYgNi4wMzc2IDguMjM1NkM2LjExNTIyIDguMjc0NDEgNi4xNzM0NCA4LjM0MjMzIDYuMjEyMjUgOC40MTAyNUw2Ljk5ODE4IDkuNzQ5MjRaTTYuMDM3NiA2Ljk2NDUyQzUuMzc3OCA2Ljk2NDUyIDQuODQ0MTUgNi40MTE0NiA0Ljg0NDE1IDUuNzMyMjZDNC44NDQxNSA1LjA1MzA2IDUuMzc3OCA0LjUgNi4wMzc2IDQuNUM2LjY5NzM5IDQuNSA3LjIzMTA1IDUuMDUzMDYgNy4yMzEwNSA1LjczMjI2QzcuMjMxMDUgNi40MTE0NiA2LjY5NzM5IDYuOTY0NTIgNi4wMzc2IDYuOTY0NTJaTTEuOTMxNDcgMS45NjA1OEg0LjQxOTY1QzQuNjg0OTEgMS45NjA1OCA0Ljg5OTk0IDEuNzQ1NTUgNC44OTk5NCAxLjQ4MDI5VjEuNDgwMjlDNC44OTk5NCAxLjIxNTAzIDQuNjg0OTEgMSA0LjQxOTY1IDFIMS44OTI2NkMxLjM5NzgyIDEgMSAxLjM5NzgyIDEgMS44OTI2NlY0LjI4OTI3QzEgNC41NDY0OSAxLjIwODUyIDQuNzU1IDEuNDY1NzQgNC43NTVWNC43NTVDMS43MjI5NiA0Ljc1NSAxLjkzMTQ3IDQuNTQ2NDkgMS45MzE0NyA0LjI4OTI3VjEuOTYwNThaTTEuOTMxNDcgMTQuMDM5NFYxMS4wNDEyQzEuOTMxNDcgMTAuNzg0IDEuNzIyOTYgMTAuNTc1NSAxLjQ2NTc0IDEwLjU3NTVWMTAuNTc1NUMxLjIwODUyIDEwLjU3NTUgMSAxMC43ODQgMSAxMS4wNDEyVjE0LjEwNzNDMSAxNC42MDIyIDEuMzk3ODIgMTUgMS44OTI2NiAxNUg0LjQxOTY1QzQuNjg0OTEgMTUgNC44OTk5NCAxNC43ODUgNC44OTk5NCAxNC41MTk3VjE0LjUxOTdDNC44OTk5NCAxNC4yNTQ1IDQuNjg0OTEgMTQuMDM5NCA0LjQxOTY1IDE0LjAzOTRIMS45MzE0N1pNMTQuMDU4OCAxLjk2MDU4VjQuMjg0NDFDMTQuMDU4OCA0LjU0NDMxIDE0LjI2OTUgNC43NTUgMTQuNTI5NCA0Ljc1NVY0Ljc1NUMxNC43ODkzIDQuNzU1IDE1IDQuNTQ0MzEgMTUgNC4yODQ0MlYxLjg5MjY2QzE1IDEuMzk3ODIgMTQuNjAyMiAxIDE0LjEwNzMgMUgxMi4wMjY3QzExLjc2MTQgMSAxMS41NDY0IDEuMjE1MDMgMTEuNTQ2NCAxLjQ4MDI5VjEuNDgwMjlDMTEuNTQ2NCAxLjc0NTU1IDExLjc2MTQgMS45NjA1OCAxMi4wMjY3IDEuOTYwNThIMTQuMDU4OFpNMTQuMDU4OCAxNC4wMzk0SDEyLjAyNjdDMTEuNzYxNCAxNC4wMzk0IDExLjU0NjQgMTQuMjU0NSAxMS41NDY0IDE0LjUxOTdWMTQuNTE5N0MxMS41NDY0IDE0Ljc4NSAxMS43NjE0IDE1IDEyLjAyNjcgMTVIMTQuMTA3M0MxNC42MDIyIDE1IDE1IDE0LjYwMjIgMTUgMTQuMTA3M1YxMS4wNDYxQzE1IDEwLjc4NjIgMTQuNzg5MyAxMC41NzU1IDE0LjUyOTQgMTAuNTc1NVYxMC41NzU1QzE0LjI2OTUgMTAuNTc1NSAxNC4wNTg4IDEwLjc4NjIgMTQuMDU4OCAxMS4wNDYxVjE0LjAzOTRaIiBmaWxsPSIjNDk3RkY3Ii8+Cjwvc3ZnPgo="},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.IDoubleWidthTool=["zoomLevel","pageInfo"],t.IFiveWidthTool=["pageBoardInfo"],t.IEightWidthTool=["docSelect"]}]).default},module.exports=e()})(ToolCollection_v3_7_7);var ToolCollection=getDefaultExportFromCjs(ToolCollection_v3_7_7.exports),NERTC$1={exports:{}};(function(module,exports){var t;t=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default={INVALID_PARAMETER:41e3,NOT_SUPPORT:41001,NO_SERVER_ADDRESS:41002,SOCKET_ERROR:41003,NO_SIGNALLING:41004,NO_STATS:41005,NO_MEDIASERVER:41006,NO_MEETINGS:41007,NO_LOCALSTREAM:41008,INVALID_OPERATION:41009,REPEAT_JOIN:41010,USER_NOT_IN_CHANNEL:41011,NOT_SUPPORTED_YET:41012,UNKNOWN_TYPE:41013,NOT_ALLOWED:41014,STATE_ERROR:41015,NO_FILE:41016,DECODE_FAILED:41017,ADD_TASK_FAILED:41018,DELETE_TASK_FAILED:41019,UPDATE_TASKS_FAILED:41020,RECORD_API_ERROR:41021,NO_RECORDER_FOUND:41022,NOT_DEFINED:41023,NOT_AVALIABLE:41024,NO_MEDIAHELPER:41025,NO_PLAY:41026,NO_RECORD:41027,NOT_FOUND:41028,APPDATA_ERROR:41029,AUTO_PLAY_NOT_ALLOWED:41030,NO_MEDIA:41031,MEDIA_OPEN_BANNED_BY_SERVER:41032,PROXY_SERVER_ERROR:41033,UNKNOWN:99999}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(0));class o extends Error{constructor(e){let t=e.url?e.url:"https://dev.yunxin.163.com/docs/interface/NERTC_SDK/Latest/Web/api/index.html#errorCode";super(e.message+` <${function(e){for(let t in i.default)if(i.default[t]===e)return t;return"UNKNOWN"}(e.code)} ${e.code.toString()}> `+t),this.code_=e.code,this.message_=e.message,this.extraCode_=e.extraCode}get code(){return this.code_}get message(){return this.message_}getCode(){return this.code_}getMessage(){return this.message_}getExtraCode(){return this.extraCode_}}t.default=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getParameters=void 0;const n=r(26);let i={tracks:{audio:[],video:[]},shimVideoOrientation:"never",shimCanvas:"ios151",clients:[],localStreams:[],videoLowDefaultConstraints:{width:{max:320},height:{max:180}},screenLowDefaultConstraints:{width:{max:320},height:{max:180}},controlOnPaused:!0,hideControlOnResume:!0,maxTransportRebuildCnt:Number.MAX_SAFE_INTEGER,logLevel:n.loglevels.INFO,forceListenDeviceChange:!0,codecOptions:{audio:{opusStereo:!0,opusDtx:!0},video:{high:{videoGoogleStartBitrate:1e3},low:{videoGoogleStartBitrate:500}},screen:{high:{videoGoogleStartBitrate:2e3},low:{videoGoogleStartBitrate:500}}},screenFocus:!0,allowEmptyMedia:!1,keepLocalstreamOnLeave:!1,joinFirstTimeout:2e3,joinMaxRetry:3,reconnectionFirstTimeout:2e3,reconnectionMaxRetry:3,leaveOnUnload:!0,trustOnOnline:!1,h264Wait:1e3,encoderWatermarkLimit:1,encoderWatermarkFontFamily:"Verdana",forceEncodedInsertableStreams:!1,forceCustomEncryptionOff:!1,h264StrictHigh:!1,enableTcpCandidate:!0,enableUdpCandidate:!0,maxEventLoopLagWarning:3,shimLocalCanvas:"safari"};t.getParameters=()=>i},function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),s.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e,t){var r=i?i+e:e,n=this._events[r];if(t)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var o=0,a=n.length,s=new Array(a);o<a;o++)s[o]=n[o].fn;return s},s.prototype.emit=function(e,t,r,n,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,o),!0;case 6:return l.fn.call(l.context,t,r,n,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,n);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,r){var n=new a(t,r||this),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},s.prototype.once=function(e,t,r){var n=new a(t,r||this,!0),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},s.prototype.removeListener=function(e,t,r,n){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return 0==--this._eventsCount?this._events=new o:delete this._events[a],this;var s=this._events[a];if(s.fn)s.fn!==t||n&&!s.once||r&&s.context!==r||(0==--this._eventsCount?this._events=new o:delete this._events[a]);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||n&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[a]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new o:delete this._events[a]}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new o:delete this._events[t])):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=i,s.EventEmitter=s,e.exports=s},function(e,t,r){var n,i,o=e.exports=r(10),a=r(135);o.codegen=r(248),o.fetch=r(249),o.path=r(250),o.fs=o.inquire("fs"),o.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},o.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var s=/\\/g,c=/"/g;o.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},o.safeProp=function(e){return!/^[$\w_]+$/.test(e)||o.isReserved(e)?'["'+e.replace(s,"\\\\").replace(c,'\\"')+'"]':"."+e},o.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;o.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,(function(e,t){return t.toUpperCase()}))},o.compareFieldsById=function(e,t){return e.id-t.id},o.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(o.decorateRoot.remove(e.$type),e.$type.name=t,o.decorateRoot.add(e.$type)),e.$type;n||(n=r(81));var i=new n(t||e.name);return o.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var l=0;o.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=r(8));var t=new i("Enum"+l++,e);return o.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},o.setProperty=function(e,t,r){if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return function e(t,r,n){var i=r.shift();if(r.length>0)t[i]=e(t[i]||{},r,n);else{var o=t[i];o&&(n=[].concat(o).concat(n)),t[i]=n}return t}(e,t=t.split("."),r)},Object.defineProperty(o,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(r(86)))}})},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){var n=r(70)("wks"),i=r(50),o=r(5).Symbol,a="function"==typeof o;(e.exports=function(e){return n[e]||(n[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=r(2),i=r(26),o=r(12),a=r(31),s="mediasoup-client";t.Logger={debug(e,...t){const r=e?`${s}:${e}`:""+s;t=Array.prototype.slice.call(arguments),this.formatArgs("DEBUG",t,r),n.getParameters().logLevel<=i.loglevels.DEBUG&&console.debug.apply(console,t),window.logUpload&&window.wsTransport.sendLog(t)},warn(e,...t){const r=e?`${s}:${e}`:""+s;t=Array.prototype.slice.call(arguments),this.formatArgs("WARN",t,r),n.getParameters().logLevel<=i.loglevels.WARNING&&console.warn.apply(console,t),window.logUpload&&window.wsTransport.sendLog(t)},error(e,...t){const r=e?`${s}:${e}`:""+s;t=Array.prototype.slice.call(arguments),this.formatArgs("ERROR",t,r),n.getParameters().logLevel<=i.loglevels.ERROR&&console.error.apply(console,t),window.logUpload&&window.wsTransport.sendLog(t)},formatArgs(e,t,r){let n=new Date,i=this.formatTimeUnit(""+(n.getMonth()+1))+"-"+this.formatTimeUnit(""+n.getDate())+" "+this.formatTimeUnit(""+n.getHours())+":"+this.formatTimeUnit(""+n.getMinutes())+":"+this.formatTimeUnit(""+n.getSeconds())+":"+this.formatTimeUnit(""+n.getMilliseconds(),3),s=`[NERTC:${e}:${o.updateLogIndex()} ${i} ${r.toUpperCase()}]  `;for(let e=t.length-1;e>=0;e--)t[e]=a.formatSingleArg(t[e]);return t.unshift(s),t},formatTimeUnit(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r}}},function(e,t,r){e.exports=a;var n=r(29);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=r(43),o=r(4);function a(e,t,r,i,o){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=o||{},this.reserved=void 0,t)for(var a=Object.keys(t),s=0;s<a.length;++s)"number"==typeof t[a[s]]&&(this.valuesById[this.values[a[s]]=t[a[s]]]=a[s])}a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r){if(!o.isString(e))throw TypeError("name must be a string");if(!o.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!o.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},function(e,t){var r=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=r)},function(e,t,r){(function(e){var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(132),n.base64=r(239),n.EventEmitter=r(240),n.float=r(241),n.inquire=r(133),n.utf8=r(242),n.pool=r(243),n.LongBits=r(244),n.isNode=Boolean(void 0!==e&&e&&e.process&&e.process.versions&&e.process.versions.node),n.global=n.isNode&&e||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=o,n.ProtocolError=o("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,r(60))},function(e,t,r){var n;!function(i){var o,a=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,s=Math.ceil,c=Math.floor,u="[BigNumber Error] ",l=u+"Number primitive has more than 15 significant digits: ",d=1e14,p=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],f=1e9;function h(e){var t=0|e;return e>0||e===t?t:t-1}function m(e){for(var t,r,n=1,i=e.length,o=e[0]+"";n<i;){for(r=14-(t=e[n++]+"").length;r--;t="0"+t);o+=t}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function g(e,t){var r,n,i=e.c,o=t.c,a=e.s,s=t.s,c=e.e,u=t.e;if(!a||!s)return null;if(r=i&&!i[0],n=o&&!o[0],r||n)return r?n?0:-s:a;if(a!=s)return a;if(r=a<0,n=c==u,!i||!o)return n?0:!i^r?1:-1;if(!n)return c>u^r?1:-1;for(s=(c=i.length)<(u=o.length)?c:u,a=0;a<s;a++)if(i[a]!=o[a])return i[a]>o[a]^r?1:-1;return c==u?0:c>u^r?1:-1}function v(e,t,r,n){if(e<t||e>r||e!==c(e))throw Error(u+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function y(e){var t=e.c.length-1;return h(e.e/14)==t&&e.c[t]%2!=0}function b(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function S(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(++t>(n=e.length)){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}(o=function e(t){var r,n,i,o,_,M,T,w,x,I=U.prototype={constructor:U,toString:null,valueOf:null},E=new U(1),A=20,C=4,k=-7,O=21,N=-1e7,R=1e7,P=!1,D=1,j=0,L={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},z="0123456789abcdefghijklmnopqrstuvwxyz";function U(e,t){var r,o,s,u,d,p,f,h,m=this;if(!(m instanceof U))return new U(e,t);if(null==t){if(e&&!0===e._isBigNumber)return m.s=e.s,void(!e.c||e.e>R?m.c=m.e=null:e.e<N?m.c=[m.e=0]:(m.e=e.e,m.c=e.c.slice()));if((p="number"==typeof e)&&0*e==0){if(m.s=1/e<0?(e=-e,-1):1,e===~~e){for(u=0,d=e;d>=10;d/=10,u++);return void(u>R?m.c=m.e=null:(m.e=u,m.c=[e]))}h=String(e)}else{if(!a.test(h=String(e)))return i(m,h,p);m.s=45==h.charCodeAt(0)?(h=h.slice(1),-1):1}(u=h.indexOf("."))>-1&&(h=h.replace(".","")),(d=h.search(/e/i))>0?(u<0&&(u=d),u+=+h.slice(d+1),h=h.substring(0,d)):u<0&&(u=h.length)}else{if(v(t,2,z.length,"Base"),10==t)return H(m=new U(e),A+m.e+1,C);if(h=String(e),p="number"==typeof e){if(0*e!=0)return i(m,h,p,t);if(m.s=1/e<0?(h=h.slice(1),-1):1,U.DEBUG&&h.replace(/^0\.0*|\./,"").length>15)throw Error(l+e)}else m.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1;for(r=z.slice(0,t),u=d=0,f=h.length;d<f;d++)if(r.indexOf(o=h.charAt(d))<0){if("."==o){if(d>u){u=f;continue}}else if(!s&&(h==h.toUpperCase()&&(h=h.toLowerCase())||h==h.toLowerCase()&&(h=h.toUpperCase()))){s=!0,d=-1,u=0;continue}return i(m,String(e),p,t)}p=!1,(u=(h=n(h,t,10,m.s)).indexOf("."))>-1?h=h.replace(".",""):u=h.length}for(d=0;48===h.charCodeAt(d);d++);for(f=h.length;48===h.charCodeAt(--f););if(h=h.slice(d,++f)){if(f-=d,p&&U.DEBUG&&f>15&&(e>9007199254740991||e!==c(e)))throw Error(l+m.s*e);if((u=u-d-1)>R)m.c=m.e=null;else if(u<N)m.c=[m.e=0];else{if(m.e=u,m.c=[],d=(u+1)%14,u<0&&(d+=14),d<f){for(d&&m.c.push(+h.slice(0,d)),f-=14;d<f;)m.c.push(+h.slice(d,d+=14));d=14-(h=h.slice(d)).length}else d-=f;for(;d--;h+="0");m.c.push(+h)}}else m.c=[m.e=0]}function B(e,t,r,n){var i,o,a,s,c;if(null==r?r=C:v(r,0,8),!e.c)return e.toString();if(i=e.c[0],a=e.e,null==t)c=m(e.c),c=1==n||2==n&&(a<=k||a>=O)?b(c,a):S(c,a,"0");else if(o=(e=H(new U(e),t,r)).e,s=(c=m(e.c)).length,1==n||2==n&&(t<=o||o<=k)){for(;s<t;c+="0",s++);c=b(c,o)}else if(t-=a,c=S(c,o,"0"),o+1>s){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=o-s)>0)for(o+1==s&&(c+=".");t--;c+="0");return e.s<0&&i?"-"+c:c}function F(e,t){for(var r,n=1,i=new U(e[0]);n<e.length;n++){if(!(r=new U(e[n])).s){i=r;break}t.call(i,r)&&(i=r)}return i}function V(e,t,r){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(r=n+14*r-1)>R?e.c=e.e=null:r<N?e.c=[e.e=0]:(e.e=r,e.c=t),e}function H(e,t,r,n){var i,o,a,u,l,f,h,m=e.c,g=p;if(m){e:{for(i=1,u=m[0];u>=10;u/=10,i++);if((o=t-i)<0)o+=14,a=t,h=(l=m[f=0])/g[i-a-1]%10|0;else if((f=s((o+1)/14))>=m.length){if(!n)break e;for(;m.length<=f;m.push(0));l=h=0,i=1,a=(o%=14)-14+1}else{for(l=u=m[f],i=1;u>=10;u/=10,i++);h=(a=(o%=14)-14+i)<0?0:l/g[i-a-1]%10|0}if(n=n||t<0||null!=m[f+1]||(a<0?l:l%g[i-a-1]),n=r<4?(h||n)&&(0==r||r==(e.s<0?3:2)):h>5||5==h&&(4==r||n||6==r&&(o>0?a>0?l/g[i-a]:0:m[f-1])%10&1||r==(e.s<0?8:7)),t<1||!m[0])return m.length=0,n?(t-=e.e+1,m[0]=g[(14-t%14)%14],e.e=-t||0):m[0]=e.e=0,e;if(0==o?(m.length=f,u=1,f--):(m.length=f+1,u=g[14-o],m[f]=a>0?c(l/g[i-a]%g[a])*u:0),n)for(;;){if(0==f){for(o=1,a=m[0];a>=10;a/=10,o++);for(a=m[0]+=u,u=1;a>=10;a/=10,u++);o!=u&&(e.e++,m[0]==d&&(m[0]=1));break}if(m[f]+=u,m[f]!=d)break;m[f--]=0,u=1}for(o=m.length;0===m[--o];m.pop());}e.e>R?e.c=e.e=null:e.e<N&&(e.c=[e.e=0])}return e}function $(e){var t,r=e.e;return null===r?e.toString():(t=m(e.c),t=r<=k||r>=O?b(t,r):S(t,r,"0"),e.s<0?"-"+t:t)}return U.clone=e,U.ROUND_UP=0,U.ROUND_DOWN=1,U.ROUND_CEIL=2,U.ROUND_FLOOR=3,U.ROUND_HALF_UP=4,U.ROUND_HALF_DOWN=5,U.ROUND_HALF_EVEN=6,U.ROUND_HALF_CEIL=7,U.ROUND_HALF_FLOOR=8,U.EUCLID=9,U.config=U.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(u+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(v(r=e[t],0,f,t),A=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(v(r=e[t],0,8,t),C=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(v(r[0],-f,0,t),v(r[1],0,f,t),k=r[0],O=r[1]):(v(r,-f,f,t),k=-(O=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)v(r[0],-f,-1,t),v(r[1],1,f,t),N=r[0],R=r[1];else{if(v(r,-f,f,t),!r)throw Error(u+t+" cannot be zero: "+r);N=-(R=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(u+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw P=!r,Error(u+"crypto unavailable");P=r}else P=r}if(e.hasOwnProperty(t="MODULO_MODE")&&(v(r=e[t],0,9,t),D=r),e.hasOwnProperty(t="POW_PRECISION")&&(v(r=e[t],0,f,t),j=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(u+t+" not an object: "+r);L=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(u+t+" invalid: "+r);z=r}}return{DECIMAL_PLACES:A,ROUNDING_MODE:C,EXPONENTIAL_AT:[k,O],RANGE:[N,R],CRYPTO:P,MODULO_MODE:D,POW_PRECISION:j,FORMAT:L,ALPHABET:z}},U.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!U.DEBUG)return!0;var t,r,n=e.c,i=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===o||-1===o)&&i>=-f&&i<=f&&i===c(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%14)<1&&(t+=14),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=d||r!==c(r))break e;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(u+"Invalid BigNumber: "+e)},U.maximum=U.max=function(){return F(arguments,I.lt)},U.minimum=U.min=function(){return F(arguments,I.gt)},U.random=(o=9007199254740992*Math.random()&2097151?function(){return c(9007199254740992*Math.random())}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,i,a,l=0,d=[],h=new U(E);if(null==e?e=A:v(e,0,f),i=s(e/14),P)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(i*=2));l<i;)(a=131072*t[l]+(t[l+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[l]=r[0],t[l+1]=r[1]):(d.push(a%1e14),l+=2);l=i/2}else{if(!crypto.randomBytes)throw P=!1,Error(u+"crypto unavailable");for(t=crypto.randomBytes(i*=7);l<i;)(a=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(d.push(a%1e14),l+=7);l=i/7}if(!P)for(;l<i;)(a=o())<9e15&&(d[l++]=a%1e14);for(e%=14,(i=d[--l])&&e&&(a=p[14-e],d[l]=c(i/a)*a);0===d[l];d.pop(),l--);if(l<0)d=[n=0];else{for(n=-1;0===d[0];d.splice(0,1),n-=14);for(l=1,a=d[0];a>=10;a/=10,l++);l<14&&(n-=14-l)}return h.e=n,h.c=d,h}),U.sum=function(){for(var e=1,t=arguments,r=new U(t[0]);e<t.length;)r=r.plus(t[e++]);return r},n=function(){function e(e,t,r,n){for(var i,o,a=[0],s=0,c=e.length;s<c;){for(o=a.length;o--;a[o]*=t);for(a[0]+=n.indexOf(e.charAt(s++)),i=0;i<a.length;i++)a[i]>r-1&&(null==a[i+1]&&(a[i+1]=0),a[i+1]+=a[i]/r|0,a[i]%=r)}return a.reverse()}return function(t,n,i,o,a){var s,c,u,l,d,p,f,h,g=t.indexOf("."),v=A,y=C;for(g>=0&&(l=j,j=0,t=t.replace(".",""),p=(h=new U(n)).pow(t.length-g),j=l,h.c=e(S(m(p.c),p.e,"0"),10,i,"0123456789"),h.e=h.c.length),u=l=(f=e(t,n,i,a?(s=z,"0123456789"):(s="0123456789",z))).length;0==f[--l];f.pop());if(!f[0])return s.charAt(0);if(g<0?--u:(p.c=f,p.e=u,p.s=o,f=(p=r(p,h,v,y,i)).c,d=p.r,u=p.e),g=f[c=u+v+1],l=i/2,d=d||c<0||null!=f[c+1],d=y<4?(null!=g||d)&&(0==y||y==(p.s<0?3:2)):g>l||g==l&&(4==y||d||6==y&&1&f[c-1]||y==(p.s<0?8:7)),c<1||!f[0])t=d?S(s.charAt(1),-v,s.charAt(0)):s.charAt(0);else{if(f.length=c,d)for(--i;++f[--c]>i;)f[c]=0,c||(++u,f=[1].concat(f));for(l=f.length;!f[--l];);for(g=0,t="";g<=l;t+=s.charAt(f[g++]));t=S(t,u,s.charAt(0))}return t}}(),r=function(){function e(e,t,r){var n,i,o,a,s=0,c=e.length,u=t%1e7,l=t/1e7|0;for(e=e.slice();c--;)s=((i=u*(o=e[c]%1e7)+(n=l*o+(a=e[c]/1e7|0)*u)%1e7*1e7+s)/r|0)+(n/1e7|0)+l*a,e[c]=i%r;return s&&(e=[s].concat(e)),e}function t(e,t,r,n){var i,o;if(r!=n)o=r>n?1:-1;else for(i=o=0;i<r;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,o,a,s){var u,l,p,f,m,g,v,y,b,S,_,M,T,w,x,I,E,A=n.s==i.s?1:-1,C=n.c,k=i.c;if(!(C&&C[0]&&k&&k[0]))return new U(n.s&&i.s&&(C?!k||C[0]!=k[0]:k)?C&&0==C[0]||!k?0*A:A/0:NaN);for(b=(y=new U(A)).c=[],A=o+(l=n.e-i.e)+1,s||(s=d,l=h(n.e/14)-h(i.e/14),A=A/14|0),p=0;k[p]==(C[p]||0);p++);if(k[p]>(C[p]||0)&&l--,A<0)b.push(1),f=!0;else{for(w=C.length,I=k.length,p=0,A+=2,(m=c(s/(k[0]+1)))>1&&(k=e(k,m,s),C=e(C,m,s),I=k.length,w=C.length),T=I,_=(S=C.slice(0,I)).length;_<I;S[_++]=0);E=k.slice(),E=[0].concat(E),x=k[0],k[1]>=s/2&&x++;do{if(m=0,(u=t(k,S,I,_))<0){if(M=S[0],I!=_&&(M=M*s+(S[1]||0)),(m=c(M/x))>1)for(m>=s&&(m=s-1),v=(g=e(k,m,s)).length,_=S.length;1==t(g,S,v,_);)m--,r(g,I<v?E:k,v,s),v=g.length,u=1;else 0==m&&(u=m=1),v=(g=k.slice()).length;if(v<_&&(g=[0].concat(g)),r(S,g,_,s),_=S.length,-1==u)for(;t(k,S,I,_)<1;)m++,r(S,I<_?E:k,_,s),_=S.length}else 0===u&&(m++,S=[0]);b[p++]=m,S[0]?S[_++]=C[T]||0:(S=[C[T]],_=1)}while((T++<w||null!=S[0])&&A--);f=null!=S[0],b[0]||b.splice(0,1)}if(s==d){for(p=1,A=b[0];A>=10;A/=10,p++);H(y,o+(y.e=p+14*l-1)+1,a,f)}else y.e=l,y.r=+f;return y}}(),_=/^(-?)0([xbo])(?=\w[\w.]*$)/i,M=/^([^.]+)\.$/,T=/^\.([^.]+)$/,w=/^-?(Infinity|NaN)$/,x=/^\s*\+(?=[\w.])|^\s+|\s+$/g,i=function(e,t,r,n){var i,o=r?t:t.replace(x,"");if(w.test(o))e.s=isNaN(o)?null:o<0?-1:1;else{if(!r&&(o=o.replace(_,(function(e,t,r){return i="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=i?e:t})),n&&(i=n,o=o.replace(M,"$1").replace(T,"0.$1")),t!=o))return new U(o,i);if(U.DEBUG)throw Error(u+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},I.absoluteValue=I.abs=function(){var e=new U(this);return e.s<0&&(e.s=1),e},I.comparedTo=function(e,t){return g(this,new U(e,t))},I.decimalPlaces=I.dp=function(e,t){var r,n,i,o=this;if(null!=e)return v(e,0,f),null==t?t=C:v(t,0,8),H(new U(o),e+o.e+1,t);if(!(r=o.c))return null;if(n=14*((i=r.length-1)-h(this.e/14)),i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},I.dividedBy=I.div=function(e,t){return r(this,new U(e,t),A,C)},I.dividedToIntegerBy=I.idiv=function(e,t){return r(this,new U(e,t),0,1)},I.exponentiatedBy=I.pow=function(e,t){var r,n,i,o,a,l,d,p,f=this;if((e=new U(e)).c&&!e.isInteger())throw Error(u+"Exponent not an integer: "+$(e));if(null!=t&&(t=new U(t)),a=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return p=new U(Math.pow(+$(f),a?2-y(e):+$(e))),t?p.mod(t):p;if(l=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new U(NaN);(n=!l&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||a&&f.c[1]>=24e7:f.c[0]<8e13||a&&f.c[0]<=9999975e7)))return o=f.s<0&&y(e)?-0:0,f.e>-1&&(o=1/o),new U(l?1/o:o);j&&(o=s(j/14+2))}for(a?(r=new U(.5),l&&(e.s=1),d=y(e)):d=(i=Math.abs(+$(e)))%2,p=new U(E);;){if(d){if(!(p=p.times(f)).c)break;o?p.c.length>o&&(p.c.length=o):n&&(p=p.mod(t))}if(i){if(0===(i=c(i/2)))break;d=i%2}else if(H(e=e.times(r),e.e+1,1),e.e>14)d=y(e);else{if(0==(i=+$(e)))break;d=i%2}f=f.times(f),o?f.c&&f.c.length>o&&(f.c.length=o):n&&(f=f.mod(t))}return n?p:(l&&(p=E.div(p)),t?p.mod(t):o?H(p,j,C,void 0):p)},I.integerValue=function(e){var t=new U(this);return null==e?e=C:v(e,0,8),H(t,t.e+1,e)},I.isEqualTo=I.eq=function(e,t){return 0===g(this,new U(e,t))},I.isFinite=function(){return!!this.c},I.isGreaterThan=I.gt=function(e,t){return g(this,new U(e,t))>0},I.isGreaterThanOrEqualTo=I.gte=function(e,t){return 1===(t=g(this,new U(e,t)))||0===t},I.isInteger=function(){return!!this.c&&h(this.e/14)>this.c.length-2},I.isLessThan=I.lt=function(e,t){return g(this,new U(e,t))<0},I.isLessThanOrEqualTo=I.lte=function(e,t){return-1===(t=g(this,new U(e,t)))||0===t},I.isNaN=function(){return!this.s},I.isNegative=function(){return this.s<0},I.isPositive=function(){return this.s>0},I.isZero=function(){return!!this.c&&0==this.c[0]},I.minus=function(e,t){var r,n,i,o,a=this,s=a.s;if(t=(e=new U(e,t)).s,!s||!t)return new U(NaN);if(s!=t)return e.s=-t,a.plus(e);var c=a.e/14,u=e.e/14,l=a.c,p=e.c;if(!c||!u){if(!l||!p)return l?(e.s=-t,e):new U(p?a:NaN);if(!l[0]||!p[0])return p[0]?(e.s=-t,e):new U(l[0]?a:3==C?-0:0)}if(c=h(c),u=h(u),l=l.slice(),s=c-u){for((o=s<0)?(s=-s,i=l):(u=c,i=p),i.reverse(),t=s;t--;i.push(0));i.reverse()}else for(n=(o=(s=l.length)<(t=p.length))?s:t,s=t=0;t<n;t++)if(l[t]!=p[t]){o=l[t]<p[t];break}if(o&&(i=l,l=p,p=i,e.s=-e.s),(t=(n=p.length)-(r=l.length))>0)for(;t--;l[r++]=0);for(t=d-1;n>s;){if(l[--n]<p[n]){for(r=n;r&&!l[--r];l[r]=t);--l[r],l[n]+=d}l[n]-=p[n]}for(;0==l[0];l.splice(0,1),--u);return l[0]?V(e,l,u):(e.s=3==C?-1:1,e.c=[e.e=0],e)},I.modulo=I.mod=function(e,t){var n,i,o=this;return e=new U(e,t),!o.c||!e.s||e.c&&!e.c[0]?new U(NaN):!e.c||o.c&&!o.c[0]?new U(o):(9==D?(i=e.s,e.s=1,n=r(o,e,0,3),e.s=i,n.s*=i):n=r(o,e,0,D),(e=o.minus(n.times(e))).c[0]||1!=D||(e.s=o.s),e)},I.multipliedBy=I.times=function(e,t){var r,n,i,o,a,s,c,u,l,p,f,m,g,v,y=this,b=y.c,S=(e=new U(e,t)).c;if(!(b&&S&&b[0]&&S[0]))return!y.s||!e.s||b&&!b[0]&&!S||S&&!S[0]&&!b?e.c=e.e=e.s=null:(e.s*=y.s,b&&S?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=h(y.e/14)+h(e.e/14),e.s*=y.s,(c=b.length)<(p=S.length)&&(g=b,b=S,S=g,i=c,c=p,p=i),i=c+p,g=[];i--;g.push(0));for(v=d,i=p;--i>=0;){for(r=0,f=S[i]%1e7,m=S[i]/1e7|0,o=i+(a=c);o>i;)r=((u=f*(u=b[--a]%1e7)+(s=m*u+(l=b[a]/1e7|0)*f)%1e7*1e7+g[o]+r)/v|0)+(s/1e7|0)+m*l,g[o--]=u%v;g[o]=r}return r?++n:g.splice(0,1),V(e,g,n)},I.negated=function(){var e=new U(this);return e.s=-e.s||null,e},I.plus=function(e,t){var r,n=this,i=n.s;if(t=(e=new U(e,t)).s,!i||!t)return new U(NaN);if(i!=t)return e.s=-t,n.minus(e);var o=n.e/14,a=e.e/14,s=n.c,c=e.c;if(!o||!a){if(!s||!c)return new U(i/0);if(!s[0]||!c[0])return c[0]?e:new U(s[0]?n:0*i)}if(o=h(o),a=h(a),s=s.slice(),i=o-a){for(i>0?(a=o,r=c):(i=-i,r=s),r.reverse();i--;r.push(0));r.reverse()}for((i=s.length)-(t=c.length)<0&&(r=c,c=s,s=r,t=i),i=0;t;)i=(s[--t]=s[t]+c[t]+i)/d|0,s[t]=d===s[t]?0:s[t]%d;return i&&(s=[i].concat(s),++a),V(e,s,a)},I.precision=I.sd=function(e,t){var r,n,i,o=this;if(null!=e&&e!==!!e)return v(e,1,f),null==t?t=C:v(t,0,8),H(new U(o),e,t);if(!(r=o.c))return null;if(n=14*(i=r.length-1)+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return e&&o.e+1>n&&(n=o.e+1),n},I.shiftedBy=function(e){return v(e,-9007199254740991,9007199254740991),this.times("1e"+e)},I.squareRoot=I.sqrt=function(){var e,t,n,i,o,a=this,s=a.c,c=a.s,u=a.e,l=A+4,d=new U("0.5");if(1!==c||!s||!s[0])return new U(!c||c<0&&(!s||s[0])?NaN:s?a:1/0);if(0==(c=Math.sqrt(+$(a)))||c==1/0?(((t=m(s)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=h((u+1)/2)-(u<0||u%2),n=new U(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):n=new U(c+""),n.c[0])for((c=(u=n.e)+l)<3&&(c=0);;)if(o=n,n=d.times(o.plus(r(a,o,l,1))),m(o.c).slice(0,c)===(t=m(n.c)).slice(0,c)){if(n.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(H(n,n.e+A+2,1),e=!n.times(n).eq(a));break}if(!i&&(H(o,o.e+A+2,0),o.times(o).eq(a))){n=o;break}l+=4,c+=4,i=1}return H(n,n.e+A+1,C,e)},I.toExponential=function(e,t){return null!=e&&(v(e,0,f),e++),B(this,e,t,1)},I.toFixed=function(e,t){return null!=e&&(v(e,0,f),e=e+this.e+1),B(this,e,t)},I.toFormat=function(e,t,r){var n,i=this;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=L;else if("object"!=typeof r)throw Error(u+"Argument not an object: "+r);if(n=i.toFixed(e,t),i.c){var o,a=n.split("."),s=+r.groupSize,c=+r.secondaryGroupSize,l=r.groupSeparator||"",d=a[0],p=a[1],f=i.s<0,h=f?d.slice(1):d,m=h.length;if(c&&(o=s,s=c,c=o,m-=o),s>0&&m>0){for(o=m%s||s,d=h.substr(0,o);o<m;o+=s)d+=l+h.substr(o,s);c>0&&(d+=l+h.slice(o)),f&&(d="-"+d)}n=p?d+(r.decimalSeparator||"")+((c=+r.fractionGroupSize)?p.replace(new RegExp("\\d{"+c+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):p):d}return(r.prefix||"")+n+(r.suffix||"")},I.toFraction=function(e){var t,n,i,o,a,s,c,l,d,f,h,g,v=this,y=v.c;if(null!=e&&(!(c=new U(e)).isInteger()&&(c.c||1!==c.s)||c.lt(E)))throw Error(u+"Argument "+(c.isInteger()?"out of range: ":"not an integer: ")+$(c));if(!y)return new U(v);for(t=new U(E),d=n=new U(E),i=l=new U(E),g=m(y),a=t.e=g.length-v.e-1,t.c[0]=p[(s=a%14)<0?14+s:s],e=!e||c.comparedTo(t)>0?a>0?t:d:c,s=R,R=1/0,c=new U(g),l.c[0]=0;f=r(c,t,0,1),1!=(o=n.plus(f.times(i))).comparedTo(e);)n=i,i=o,d=l.plus(f.times(o=d)),l=o,t=c.minus(f.times(o=t)),c=o;return o=r(e.minus(n),i,0,1),l=l.plus(o.times(d)),n=n.plus(o.times(i)),l.s=d.s=v.s,h=r(d,i,a*=2,C).minus(v).abs().comparedTo(r(l,n,a,C).minus(v).abs())<1?[d,i]:[l,n],R=s,h},I.toNumber=function(){return+$(this)},I.toPrecision=function(e,t){return null!=e&&v(e,1,f),B(this,e,t,2)},I.toString=function(e){var t,r=this,i=r.s,o=r.e;return null===o?i?(t="Infinity",i<0&&(t="-"+t)):t="NaN":(null==e?t=o<=k||o>=O?b(m(r.c),o):S(m(r.c),o,"0"):10===e?t=S(m((r=H(new U(r),A+o+1,C)).c),r.e,"0"):(v(e,2,z.length,"Base"),t=n(S(m(r.c),o,"0"),10,e,i,!0)),i<0&&r.c[0]&&(t="-"+t)),t},I.valueOf=I.toJSON=function(){return $(this)},I._isBigNumber=!0,null!=t&&U.set(t),U}()).default=o.BigNumber=o,void 0===(n=function(){return o}.call(t,r,t,e))||(e.exports=n)}()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.updateLogIndex=void 0;const n=r(33),i=r(157),o=r(2),a=r(26),s=r(31);let c=0;function u(){return c++,(""+c).padStart(4,"0")}t.updateLogIndex=u;class l{constructor(e){this.style="color:#1cb977;",this.options=e,this.api="log",this.tagGen=e.tagGen,e.isSavedLogs&&(this.logHelper=new i.logHelper(e)),this.supportedBrowsers=["Chrome","Safari","Firefox","Chrome Mobile","Electron"],this.cs=console}getChild(e){const t=Object.assign({},this.options),r=new l(t);return r.tagGen=e,r.parent=this,r}debug(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("DEBUG",[].slice.call(arguments,0));o.getParameters().logLevel<=a.loglevels.DEBUG&&this._log("debug",e),window.logUpload&&window.wsTransport.sendLog(e)}log(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("LOG",[].slice.call(arguments,0));if(-1!==this.supportedBrowsers.indexOf(n.platform.name)&&"string"==typeof e[0]){e[0]="%c"+e[0],e.splice(1,0,this.style);for(let t=2;t<e.length&&"string"==typeof e[t];t++)e[0]+="%c"+e[t],e[t]=""}o.getParameters().logLevel<=a.loglevels.INFO&&this._log("log",e),window.logUpload&&window.wsTransport.sendLog(e)}info(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("INFO",[].slice.call(arguments,0));-1!==this.supportedBrowsers.indexOf(n.platform.name)&&"string"==typeof e[0]&&(e[0]="%c"+e[0],e.splice(1,0,this.style)),o.getParameters().logLevel<=a.loglevels.INFO&&this._log("info",e),window.logUpload&&window.wsTransport.sendLog(e)}warn(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("WARN",[].slice.call(arguments,0));-1!==this.supportedBrowsers.indexOf(n.platform.name)&&"string"==typeof e[0]&&(e[0]="%c"+e[0],e.splice(1,0,this.style)),o.getParameters().logLevel<=a.loglevels.WARNING&&this._log("warn",e),window.logUpload&&window.wsTransport.sendLog(e)}error(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("ERROR",[].slice.call(arguments,0));-1!==this.supportedBrowsers.indexOf(n.platform.name)&&"string"==typeof e[0]&&(e[0]="%c"+e[0],e.splice(1,0,this.style)),o.getParameters().logLevel<=a.loglevels.ERROR&&this._log("error",e),window.logUpload&&window.wsTransport.sendLog(e)}_log(e,t){let r=this.options.logFunc,n=null;if(r&&(r[e]&&(n=r[e]),"function"==typeof n))n.apply(r,t);else if(this.cs[e])try{this.cs[e].apply?this.chrome(e,t):this.ie(e,t)}catch(e){}}chrome(e,t){n.platform.name,this.cs[e]?this.cs[e].apply(this.cs,t):this.cs.log?this.cs.log.apply(this.cs,t):this.ie(e,t)}ie(e,t){var r=this;t.forEach((function(t){r.cs[e](JSON.stringify(t,null,4))}))}formatArgs(e,t){var r=new Date,n=d(""+(r.getMonth()+1))+"-"+d(""+r.getDate())+" "+d(""+r.getHours())+":"+d(""+r.getMinutes())+":"+d(""+r.getSeconds())+":"+d(""+r.getMilliseconds(),3);let i=this,o="";for(let e=0;e<3&&(i.tagGen&&(o=`[${i.tagGen()}]`+o),i.parent);e++)i=i.parent;return o=`[NERTC:${e}:${u()} ${n}]${o}`,t.splice(0,0,o),t.forEach((function(e,r){e=s.formatSingleArg(e),t[r]="object"==typeof e?function e(t,r=[]){if(!(t=s.formatSingleArg(t))||"object"!=typeof t)return t;let n={};for(let i in t)t.hasOwnProperty&&!t.hasOwnProperty(i)||(t[i]&&"object"==typeof t[i]?-1!==r.indexOf(t[i])?n[i]="[Circular obj]":(r.push(t[i]),n[i]=e(t[i],r)):n[i]=t[i]);return n}(e):e})),t}}t.Logger=l;var d=function(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.IS_SAMSUNGBROWSER=t.HUAWEI_VERSION=t.IS_HUAWEIBROWSER=t.MI_VERSION=t.IS_MIBROWSER=t.IS_ELECTRON=t.IS_UCBROWSER=t.IS_WX=t.IS_LINUX=t.IS_MAC=t.IS_WIN=t.IPADQQB_VERSION=t.IS_IPADQQB=t.MACQQB_VERSION=t.IS_MACQQB=t.WQQB_VERSION=t.IS_WQQB=t.MQQB_VERSION=t.IS_MQQB=t.IS_X5MQQB=t.WECHAT_MAJOR_VERSION=t.WECHAT_VERSION=t.IS_WECHAT=t.IE_VERSION=t.IS_IE=t.IS_IE8=t.XWEB_VERSION=t.IS_XWEB=t.TBS_VERSION=t.IS_TBS=t.SOGOU_VERSION=t.IS_SOGOU=t.SOGOUM_VERSION=t.IS_SOGOUM=t.EDG_VERSION=t.EDG_MAJOR_VERSION=t.IS_EDG=t.EDGE_VERSION=t.IS_EDGE=t.FIREFOX_MAJOR_VERSION=t.FIREFOX_VERSION=t.IS_FIREFOX=t.ANDROID_VERSION=t.IS_ANDROID=t.IOS_VERSION=t.IS_IOS=t.IS_IPOD=t.IS_IPHONE=t.IS_IPAD=t.USER_AGENT=void 0,t.IS_LOCAL=t.IS_IOS_SAFARI=t.IS_MAC_SAFARI=t.SAFARI_VERSION=t.SAFARI_MAJOR_VERSION=t.IS_ANY_SAFARI=t.IS_SAFARI=t.CHROME_VERSION=t.CHROME_MAJOR_VERSION=t.IS_CHROME=t.IS_CHROME_ONLY=t.VIVO_VERSION=t.IS_VIVOBROWSER=t.OPPO_VERSION=t.IS_OPPOBROWSER=t.SAMSUNG_VERSION=void 0,t.USER_AGENT=window.navigator&&window.navigator.userAgent||"",t.IS_IPAD=/iPad/i.test(t.USER_AGENT),t.IS_IPHONE=/iPhone/i.test(t.USER_AGENT)&&!t.IS_IPAD,t.IS_IPOD=/iPod/i.test(t.USER_AGENT),t.IS_IOS=t.IS_IPHONE||t.IS_IPAD||t.IS_IPOD,t.IOS_VERSION=t.IS_IOS&&function(){const e=t.USER_AGENT.match(/\b[0-9]+_[0-9]+(?:_[0-9]+)?\b/)||[""];return e&&e[0]?parseFloat(e[0].replace(/_/g,".")):null}(),t.IS_ANDROID=/Android/i.test(t.USER_AGENT),t.ANDROID_VERSION=t.IS_ANDROID&&function(){const e=t.USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const r=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return r&&n?parseFloat(e[1]+"."+e[2]):r||null}(),t.IS_FIREFOX=/Firefox/i.test(t.USER_AGENT),t.FIREFOX_VERSION=t.IS_FIREFOX&&function(){const e=navigator.userAgent.match(/Firefox\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.FIREFOX_MAJOR_VERSION=t.IS_FIREFOX&&function(){const e=t.USER_AGENT.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_EDGE=/Edge\//i.test(t.USER_AGENT),t.EDGE_VERSION=t.IS_EDGE&&function(){var e=t.USER_AGENT.match(/Edge\/(\d+)/i);if(e&&e[1])return e[1]}(),t.IS_EDG=/Edg\//i.test(t.USER_AGENT),t.EDG_MAJOR_VERSION=t.IS_EDG&&function(){const e=t.USER_AGENT.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.EDG_VERSION=t.IS_EDG&&function(){const e=t.USER_AGENT.match(/Edg\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_SOGOUM=/SogouMobileBrowser\//i.test(t.USER_AGENT),t.SOGOUM_VERSION=t.IS_SOGOUM&&function(){const e=t.USER_AGENT.match(/SogouMobileBrowser\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_SOGOU=/MetaSr\s/i.test(t.USER_AGENT),t.SOGOU_VERSION=t.IS_SOGOU&&function(){const e=t.USER_AGENT.match(/MetaSr(\s\d+(\.\d+)+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_TBS=/TBS\/\d+/i.test(t.USER_AGENT),t.TBS_VERSION=t.IS_TBS&&function(){var e=t.USER_AGENT.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),t.IS_XWEB=/XWEB\/\d+/i.test(t.USER_AGENT),t.XWEB_VERSION=t.IS_XWEB&&function(){var e=t.USER_AGENT.match(/XWEB\/(\d+)/i);if(e&&e[1])return e[1]}(),t.IS_IE8=/MSIE\s8\.0/.test(t.USER_AGENT),t.IS_IE=/MSIE\/\d+/i.test(t.USER_AGENT),t.IE_VERSION=t.IS_IE&&function(){const e=/MSIE\s(\d+)\.\d/.exec(t.USER_AGENT);let r=e&&parseFloat(e[1]);return!r&&/Trident\/7.0/i.test(t.USER_AGENT)&&/rv:11.0/.test(t.USER_AGENT)&&(r=11),r}(),t.IS_WECHAT=/(micromessenger|webbrowser)/i.test(t.USER_AGENT),t.WECHAT_VERSION=t.IS_WECHAT&&function(){var e=navigator.userAgent.match(/MicroMessenger\/([\d.]+)/);if(e&&e[1])return e[1]}(),t.WECHAT_MAJOR_VERSION=t.IS_WECHAT&&function(){var e=t.USER_AGENT.match(/MicroMessenger\/(\d+)/i);if(e&&e[1])return parseFloat(e[1])}(),t.IS_X5MQQB=!t.IS_TBS&&/MQQBrowser\/\d+/i.test(t.USER_AGENT)&&/COVC\/\d+/i.test(t.USER_AGENT),t.IS_MQQB=!t.IS_TBS&&/MQQBrowser\/\d+/i.test(t.USER_AGENT)&&!/COVC\/\d+/i.test(t.USER_AGENT),t.MQQB_VERSION=(t.IS_MQQB||t.IS_X5MQQB)&&function(){const e=t.USER_AGENT.match(/ MQQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_WQQB=!t.IS_TBS&&/ QQBrowser\/\d+/i.test(t.USER_AGENT),t.WQQB_VERSION=t.IS_WQQB&&function(){const e=t.USER_AGENT.match(/ QQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_MACQQB=!t.IS_TBS&&/QQBrowserLite\/\d+/i.test(t.USER_AGENT),t.MACQQB_VERSION=t.IS_MACQQB&&function(){const e=t.USER_AGENT.match(/QQBrowserLite\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_IPADQQB=!t.IS_TBS&&/MQBHD\/\d+/i.test(t.USER_AGENT),t.IPADQQB_VERSION=t.IS_IPADQQB&&function(){const e=t.USER_AGENT.match(/MQBHD\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_WIN=/Windows/i.test(t.USER_AGENT),t.IS_MAC=!t.IS_IOS&&/MAC OS X/i.test(t.USER_AGENT),t.IS_LINUX=!t.IS_ANDROID&&/Linux/i.test(t.USER_AGENT),t.IS_WX=/MicroMessenger/i.test(t.USER_AGENT),t.IS_UCBROWSER=/UCBrowser/i.test(t.USER_AGENT),t.IS_ELECTRON=/Electron/i.test(t.USER_AGENT),t.IS_MIBROWSER=/MiuiBrowser/i.test(t.USER_AGENT),t.MI_VERSION=t.IS_MIBROWSER&&function(){const e=t.USER_AGENT.match(/MiuiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_HUAWEIBROWSER=/HuaweiBrowser/i.test(t.USER_AGENT),t.HUAWEI_VERSION=t.IS_HUAWEIBROWSER&&function(){const e=t.USER_AGENT.match(/HuaweiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_SAMSUNGBROWSER=/SamsungBrowser/i.test(t.USER_AGENT),t.SAMSUNG_VERSION=t.IS_SAMSUNGBROWSER&&function(){const e=t.USER_AGENT.match(/SamsungBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_OPPOBROWSER=/HeyTapBrowser/i.test(t.USER_AGENT),t.OPPO_VERSION=t.IS_OPPOBROWSER&&function(){const e=t.USER_AGENT.match(/HeyTapBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_VIVOBROWSER=/VivoBrowser/i.test(t.USER_AGENT),t.VIVO_VERSION=t.IS_VIVOBROWSER&&function(){const e=t.USER_AGENT.match(/VivoBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_CHROME_ONLY=/Chrome/i.test(t.USER_AGENT),t.IS_CHROME=!t.IS_EDGE&&!t.IS_SOGOU&&!t.IS_SOGOUM&&!t.IS_TBS&&!t.IS_XWEB&&!t.IS_EDG&&!t.IS_WQQB&&!t.IS_MIBROWSER&&!t.IS_HUAWEIBROWSER&&!t.IS_SAMSUNGBROWSER&&!t.IS_OPPOBROWSER&&!t.IS_VIVOBROWSER&&/Chrome/i.test(t.USER_AGENT),t.CHROME_MAJOR_VERSION=t.IS_CHROME&&function(){const e=t.USER_AGENT.match(/Chrome\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.CHROME_VERSION=t.IS_CHROME&&function(){const e=t.USER_AGENT.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_SAFARI=!t.IS_CHROME_ONLY&&!t.IS_MQQB&&!t.IS_X5MQQB&&!t.IS_MACQQB&&!t.IS_IPADQQB&&/Safari/i.test(t.USER_AGENT),t.IS_ANY_SAFARI=t.IS_SAFARI||t.IS_IOS,t.SAFARI_MAJOR_VERSION=t.IS_SAFARI&&function(){const e=t.USER_AGENT.match(/Version\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.SAFARI_VERSION=t.IS_SAFARI&&function(){const e=t.USER_AGENT.match(/Version\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_MAC_SAFARI=t.IS_SAFARI&&t.IS_MAC,t.IS_IOS_SAFARI=t.IS_SAFARI&&t.IS_IOS,t.IS_LOCAL="file:"===window.location.protocol||"localhost"===window.location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(window.location.hostname)},function(e,t,r){var n=r(20);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkExists=t.isExistOptions=t.checkValidBoolean=t.checkValidString=t.checkValidFloat=t.checkValidInteger=void 0;const i=n(r(1)),o=n(r(0));t.checkValidInteger=e=>{const t=(e=>Number.isInteger(e.value)?"number"==typeof e.min&&e.value<e.min?{result:!1,msg:"参数小于最小值"+e.min}:"number"==typeof e.max&&e.value>e.max?{result:!1,msg:"参数大于最大值"+e.max}:{result:!0}:{result:!1,msg:"参数不是整数"})(e);if(!t.result)throw new i.default({code:o.default.INVALID_PARAMETER,message:`参数错误 ${e.tag}:${t.msg}`})},t.checkValidBoolean=e=>{const t=(e=>"boolean"!=typeof e.value?{result:!1,msg:"参数不是布尔类型"}:{result:!0})(e);if(!t.result)throw new i.default({code:o.default.INVALID_PARAMETER,message:`参数错误 ${e.tag}:${t.msg}`})},t.checkValidString=e=>{const t=(e=>"string"!=typeof e.value?{result:!1,msg:"参数不是字符串"}:"number"==typeof e.min&&e.value.length<e.min?{result:!1,msg:"参数长度最小值"+e.min}:"number"==typeof e.max&&e.value.length>e.max?{result:!1,msg:"参数长度大于最大值"+e.max}:{result:!0})(e);if(!t.result)throw new i.default({code:o.default.INVALID_PARAMETER,message:`参数错误 ${e.tag}:${t.msg}`})},t.checkValidFloat=e=>{const t=(e=>Number.isFinite(e.value)?"number"==typeof e.min&&e.value<e.min?{result:!1,msg:"参数小于最小值"+e.min}:"number"==typeof e.max&&e.value>e.max?{result:!1,msg:"参数大于最大值"+e.max}:{result:!0}:{result:!1,msg:"参数不是float类型"})(e);if(!t.result)throw new i.default({code:o.default.INVALID_PARAMETER,message:`参数错误 ${e.tag}:${t.msg}`})};const a=e=>void 0===e.value||null===e.value?{result:!1,msg:"未填必选参数"}:{result:!0};t.isExistOptions=a,t.checkExists=e=>{const t=a(e);if(!t.result)throw new i.default({code:o.default.INVALID_PARAMETER,message:`参数错误：${e.tag} ${t.msg}`})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RtcSystem=void 0;const n={},i=window.navigator.userAgent.toLowerCase(),o=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","pov_tv","hbbtv","ce-html"];function a(e,t){return-1!==e.indexOf(t)}function s(e){return a(i,e)}function c(e){for(let t=0;t<e.length;t++)if(n[e[t]]())return e[t];return"unknown"}function u(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}n.macos=function(){return s("mac")},n.ios=function(){return n.iphone()||n.ipod()||n.ipad()},n.iphone=function(){return!n.windows()&&s("iphone")},n.ipod=function(){return s("ipod")},n.ipad=function(){return s("ipad")},n.android=function(){return!n.windows()&&s("android")},n.androidPhone=function(){return n.android()&&s("mobile")},n.androidTablet=function(){return n.android()&&!s("mobile")},n.blackberry=function(){return s("blackberry")||s("bb10")||s("rim")},n.blackberryPhone=function(){return n.blackberry()&&!s("tablet")},n.blackberryTablet=function(){return n.blackberry()&&s("tablet")},n.windows=function(){return s("windows")},n.windowsPhone=function(){return n.windows()&&s("phone")},n.windowsTablet=function(){return n.windows()&&s("touch")&&!n.windowsPhone()},n.fxos=function(){return(s("(mobile")||s("(tablet"))&&s(" rv:")},n.fxosPhone=function(){return n.fxos()&&s("mobile")},n.fxosTablet=function(){return n.fxos()&&s("tablet")},n.meego=function(){return s("meego")},n.cordova=function(){return window.cordova&&"file:"===location.protocol},n.nodeWebkit=function(){return"object"==typeof window.process},n.mobile=function(){return n.androidPhone()||n.iphone()||n.ipod()||n.windowsPhone()||n.blackberryPhone()||n.fxosPhone()||n.meego()},n.tablet=function(){return n.ipad()||n.androidTablet()||n.blackberryTablet()||n.windowsTablet()||n.fxosTablet()},n.weixin=function(){return s("micromessenger")},n.h5=function(){return n.tablet()||n.mobile()||n.weixin()},n.desktop=function(){return!n.tablet()&&!n.mobile()},n.television=function(){let e=0;for(;e<o.length;){if(s(o[e]))return!0;e++}return!1},n.portrait=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?a(screen.orientation.type,"portrait"):window.innerHeight/window.innerWidth>1},n.landscape=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?a(screen.orientation.type,"landscape"):window.innerHeight/window.innerWidth<1},n.type=c(["mobile","tablet","desktop"]),n.os=c(["ios","iphone","ipad","ipod","android","blackberry","macos","windows","fxos","meego","television"]),n.browser=function(){var e=window&&window.navigator,t={ua:null,version:null,UIVersion:null};if("undefined"==typeof window||!window.navigator)return t.ua="Not a browser.",t;if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))t.ua="edge",t.version=u(e.userAgent,/Edge\/(\d+).(\d+)$/,2),t.UIVersion=e.userAgent.match(/Edge\/([\d.]+)/)[1];else if(e.mozGetUserMedia)t.ua="firefox",t.version=u(e.userAgent,/Firefox\/(\d+)\./,1),t.UIVersion=e.userAgent.match(/Firefox\/([\d.]+)/)[1];else if(e.webkitGetUserMedia&&window.webkitRTCPeerConnection)if(/micromessenger/.test(i))t.ua="weixin",t.version=u(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2),t.UIVersion=e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)&&e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/).length>1&&e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)[2];else if(e.userAgent.match(/(OPR|Opera).([\d.]+)/))t.ua="opera",t.version=u(e.userAgent,/O(PR|pera)\/(\d+)\./,2),t.UIVersion=e.userAgent.match(/O(PR|pera)\/([\d.]+)/)[2];else{if(!/Chrome/gi.test(e.userAgent))return t.ua="unknown",t;t.ua="chrome",t.version=u(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2),t.UIVersion=e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)&&e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/).length>1&&e.userAgent.match(/Chrom(e|ium)\/([\d.]+)/)[2]}else{if(!(!e.webkitGetUserMedia&&e.userAgent.match(/AppleWebKit\/([0-9]+)\./)||e.webkitGetUserMedia&&!e.webkitRTCPeerConnection))return t.ua="unknown",t;if(/micromessenger/.test(i))t.ua="weixin",t.version=u(i,/micromessenger\/(\d+)\./,2),t.UIVersion=7;else{if(!e.userAgent.match(/Version\/(\d+).(\d+)/))return t.ua="unknown",t;t.ua="safari",t.version=e.userAgent.match(/Version\/([\d]+)/)[1],t.UIVersion=e.userAgent.match(/Version\/([\d.]+)/)[1]}}return t}(),n.browser.greaterThanOrEqualToSafari_12_1_1=function(){if("safari"!==n.browser.ua||!n.browser.UIVersion)return!1;const e=n.browser.UIVersion.split(".");return 1===e.length?!(e[0]<12):2===e.length?e[0]>12||!(e[0]<12)&&!(e[1]<1):e[0]>12||e[0]<12||!(e[1]<1)&&!(e[2]<1)},n.browser.lessThanSafari_13=function(){if("safari"!==n.browser.ua||!n.browser.UIVersion)return!0;const e=n.browser.UIVersion.split(".");return!(e.length<1||e[0]<13)},n.browser.lessThanSafari_12_1_1=function(){return!("safari"!==n.browser.ua||!n.browser.UIVersion||n.browser.greaterThanOrEqualToSafari_12_1_1())},n.browser.safari_12_1=function(){if("safari"!==n.browser.ua||!n.browser.UIVersion)return!1;const e=n.browser.UIVersion.split(".");return 2==e.length&&12==e[0]&&1==e[1]},n.browser.safari_12_0_1=function(){if("safari"!==n.browser.ua||!n.browser.UIVersion)return!1;const e=n.browser.UIVersion.split(".");return!(e.length<3)&&12===e[0]&&0===e[1]&&1===e[2]},n.orientation=c(["portrait","landscape"]);const l=n;t.RtcSystem=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.reduceCodecs=t.getSupportedCodecs=t.VideoCodecList=void 0;const n=r(2);function i(e){const t={video:[],audio:[]};return e.match(/ H264/i)&&t.video.push("H264"),e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ opus/i)&&t.audio.push("OPUS"),t}function o(e,t,r){const i={video:[],audio:[]};if(t&&t.codecs&&t.codecs.length)for(let r=0;r<t.codecs.length;r++){const o=t.codecs[r];"video/H264"==o.mimeType&&-1===i.video.indexOf("H264")&&("recv"===e&&o.sdpFmtpLine&&o.sdpFmtpLine.indexOf("profile-level-id")>-1?n.getParameters().h264StrictHigh?o.sdpFmtpLine.indexOf("profile-level-id=64")>-1&&i.video.push("H264"):i.video.push("H264"):-1===i.video.indexOf("H264")&&i.video.push("H264")),"video/VP8"==o.mimeType&&-1===i.video.indexOf("VP8")&&i.video.push("VP8")}if(r&&r.codecs&&r.codecs.length)for(let e=0;e<r.codecs.length;e++)"audio/opus"==r.codecs[e].mimeType&&i.audio.push("OPUS");return i}t.VideoCodecList=["H264","VP8"],t.getSupportedCodecs=async function(e="recv",t=RTCPeerConnection){if("recv"===e){if("undefined"!=typeof RTCRtpReceiver&&RTCRtpReceiver.getCapabilities)return o(e,RTCRtpReceiver.getCapabilities("video"),RTCRtpReceiver.getCapabilities("audio"));{const e=new t({});e.addTransceiver("audio",{direction:"recvonly"}),e.addTransceiver("video",{direction:"recvonly"});const r=await e.createOffer({});return e.close(),!!r.sdp&&i(r.sdp)}}if("undefined"!=typeof RTCRtpSender&&RTCRtpSender.getCapabilities)return o(e,RTCRtpSender.getCapabilities("video"),RTCRtpSender.getCapabilities("audio"));{const e=new t({});let r=document.createElement("canvas");r.getContext("2d");const n=r.captureStream(0);e.addTrack(n.getVideoTracks()[0],n);const o=await e.createOffer({});return e.close(),!!o.sdp&&i(o.sdp)}},t.reduceCodecs=function(e,r){const n=[];for(let i=0;i<e.length;i++)e[i].mimeType&&r&&t.VideoCodecList.indexOf(e[i].mimeType.split("/")[1])>-1&&e[i].mimeType!==r.mimeType?i++:n.push(e[i]);return n}},function(e,t,r){var n=r(19),i=r(49);e.exports=r(21)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(14),i=r(102),o=r(67),a=Object.defineProperty;t.f=r(21)?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){e.exports=!r(48)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e,t={}){return void 0===e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){e.exports=u;var n=r(29);((u.prototype=Object.create(n.prototype)).constructor=u).className="Field";var i,o=r(8),a=r(30),s=r(4),c=/^required|optional|repeated$/;function u(e,t,r,i,o,u,l){if(s.isObject(i)?(l=o,u=i,i=o=void 0):s.isObject(o)&&(l=u,u=o,o=void 0),n.call(this,e,u),!s.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!s.isString(r))throw TypeError("type must be a string");if(void 0!==i&&!c.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==o&&!s.isString(o))throw TypeError("extend must be a string");"proto3_optional"===i&&(i="optional"),this.rule=i&&"optional"!==i?i:void 0,this.type=r,this.id=t,this.extend=o||void 0,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!s.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=l}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,r){return"packed"===e&&(this._packed=null),n.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return s.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof o&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof o)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=s.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;s.base64.test(this.typeDefault)?s.base64.decode(this.typeDefault,e=s.newBuffer(s.base64.length(this.typeDefault)),0):s.utf8.write(this.typeDefault,e=s.newBuffer(s.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=s.emptyObject:this.repeated?this.defaultValue=s.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),n.prototype.resolve.call(this)},u.d=function(e,t,r,n){return"function"==typeof t?t=s.decorateType(t).name:t&&"object"==typeof t&&(t=s.decorateEnum(t).name),function(i,o){s.decorateType(i.constructor).add(new u(o,e,t,r,{default:n}))}},u._configure=function(e){i=e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getCloudProxyInfoUrl=t.roomsTaskUrl=t.getChannelInfoUrl=t.createChannelUrl=t.checkSumUrl=t.ENV=t.BUILD=t.ENGINE_VERSION=t.SDK_VERSION=void 0,t.SDK_VERSION="4.6.11",t.ENGINE_VERSION="4.6.11.0",t.BUILD="v4.6.11-0-g814afc75";const n=r(149);Object.defineProperty(t,"ENV",{enumerable:!0,get:function(){return n.ENV}});const i=n.Config.checkSumUrl;t.checkSumUrl=i;const o=n.Config.createChannelUrl;t.createChannelUrl=o;const a=n.Config.getChannelInfoUrl;t.getChannelInfoUrl=a;const s=n.Config.roomsTaskUrl;t.roomsTaskUrl=s;const c=n.Config.getCloudProxyInfoUrl;t.getCloudProxyInfoUrl=c},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.loglevelMap=t.loglevels=void 0;const a=o(r(154)),s=r(2);!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.NONE=4]="NONE"}(t.loglevels||(t.loglevels={})),t.loglevelMap={0:"DEBUG",1:"INFO",2:"WARNING",3:"ERROR",4:"NONE"};const c={setLogLevel(e){s.getParameters().logLevel!==e&&(a.info(`NERTC LogLevel was changed: ${t.loglevelMap[s.getParameters().logLevel]} => ${t.loglevelMap[e]}`),s.getParameters().logLevel=e)},enableLogUpload(){window.logUpload=!0},disableLogUpload(){window.logUpload=!1}};c.disableLogUpload(),a.setLevel("INFO"),t.default=c},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=void 0;const i=r(3),o=n(r(1)),a=n(r(0)),s=r(12),c=r(2);class u extends i.EventEmitter{constructor(){super(),this.deviceChangeDetectionTimer=null,this.deviceInited=!1,this.hasPerm={audioIn:!1,video:!1,audioOut:!1},this.deviceHistory={audioIn:[],video:[],audioOut:[]},this.userGestureUI=null,this.onUserGestureNeeded=null,this.logger=new s.Logger({tagGen:()=>`Device m${this.deviceHistory.audioIn.length}c${this.deviceHistory.video.length}s${this.deviceHistory.audioOut.length}`}),this.handleDeviceChange=this.detectDeviceChange.bind(this),this.onUserGestureNeeded=this.defaultHandleUserGestureNeeded.bind(this)}async getDevices(e){if(!navigator.mediaDevices)throw this.logger.error("navigator.mediaDevices is "+navigator.mediaDevices),new o.default({code:a.default.NOT_SUPPORT,message:"mediaDevices is not support in your browser",url:"https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"});if(!navigator.mediaDevices.enumerateDevices)throw this.logger.error("navigator.mediaDevices is "+navigator.mediaDevices.enumerateDevices),new o.default({code:a.default.NOT_SUPPORT,message:"enumerateDevices is not support in your browser",url:"https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"});let t={video:[],audioIn:[],audioOut:[]},r=await navigator.mediaDevices.enumerateDevices(),n=null;if(e.requestPerm){const t=r.find((t=>e.audioinput&&"audioinput"==t.kind&&!t.label)),i=r.find((t=>e.videoinput&&"videoinput"==t.kind&&!t.label));if(t||i)try{n=await navigator.mediaDevices.getUserMedia({audio:t,video:i})}catch(e){this.logger.error(e.name,e.message,e.stack)}}return r=await navigator.mediaDevices.enumerateDevices(),r.forEach((function(r){if(e.videoinput&&"videoinput"===r.kind){let n={deviceId:r.deviceId,label:r.label||(e.noFillLabel?r.label:"camera "+(t.video.length+1))};e.groupId&&(n.groupId=r.groupId),t.video.push(n)}else if(e.audioinput&&"audioinput"===r.kind){let n={deviceId:r.deviceId,label:r.label||(e.noFillLabel?r.label:"microphone "+(t.audioIn.length+1))};e.groupId&&(n.groupId=r.groupId),t.audioIn.push(n)}else if(e.audiooutput&&"audiooutput"===r.kind){let n={deviceId:r.deviceId,label:r.label||(e.noFillLabel?r.label:"speaker "+(t.audioOut.length+1))};e.groupId&&(n.groupId=r.groupId),t.audioOut.push(n)}n&&n.getTracks().forEach((e=>{e.stop()}))})),t}async getCameras(e){const t=await this.getDevices({videoinput:!0,requestPerm:e});return t?t.video:[]}async getMicrophones(e){const t=await this.getDevices({audioinput:!0,requestPerm:e});return t?t.audioIn:[]}async getSpeakers(e){const t=await this.getDevices({audioinput:!0,audiooutput:!0,requestPerm:e});return t?t.audioOut:[]}async detectDeviceChange(){let e={audioIn:{added:[],changed:[],removed:[]},video:{added:[],changed:[],removed:[]},audioOut:{added:[],changed:[],removed:[]}};const t=await this.getDevices({audioinput:!0,audiooutput:!0,videoinput:!0,requestPerm:!1,groupId:!0,noFillLabel:!0});["audioIn","video","audioOut"].forEach((r=>{if(this.deviceInited){const n=t[r].find((e=>e.deviceId&&e.label));n?this.hasPerm[r]?(t[r].forEach((t=>{const n=this.deviceHistory[r].find((e=>e.deviceId===t.deviceId||""===e.deviceId&&"default"===t.deviceId));if(n){if(n.label!==t.label||n.groupId!==t.groupId){let i=`检测到设备改变：${r}: deviceId ${t.deviceId}`;n.label!==t.label?i+=`【Label ${n.label} => ${t.label}】`:i+=" Label "+t.label,n.groupId!==t.groupId&&(i+="【groupId changed】"),this.logger.log(i),e[r].changed.push(t)}}else this.logger.log(`检测到设备新增：${r}: deviceId ${t.deviceId} 【${t.label}】`),e[r].added.push(t)})),this.deviceHistory[r].forEach((n=>{t[r].find((e=>n.deviceId===e.deviceId||""===n.deviceId&&"default"===e.deviceId))||(this.logger.log(`检测到设备拔出：${r}: deviceId ${n.deviceId} 【${n.label}】`),e[r].removed.push(n))})),this.deviceHistory[r]=t[r],e[r].added.forEach((e=>{"audioIn"===r?this.emit("recording-device-changed",{device:e,state:"ACTIVE"}):"video"===r?this.emit("camera-changed",{device:e,state:"ACTIVE"}):"audioOut"===r&&this.emit("playout-device-changed",{device:e,state:"ACTIVE"})})),e[r].changed.forEach((e=>{"audioIn"===r?this.emit("recording-device-changed",{device:e,state:"CHANGED"}):"video"===r?this.emit("camera-changed",{device:e,state:"CHANGED"}):"audioOut"===r&&this.emit("playout-device-changed",{device:e,state:"CHANGED"})})),e[r].removed.forEach((e=>{"audioIn"===r?this.emit("recording-device-changed",{device:e,state:"INACTIVE"}):"video"===r?this.emit("camera-changed",{device:e,state:"INACTIVE"}):"audioOut"===r&&this.emit("playout-device-changed",{device:e,state:"INACTIVE"})}))):(this.hasPerm[r]=!0,this.deviceHistory[r]=t[r],"audioIn"===r?(this.logger.log(`麦克风设备：${n.deviceId}【${n.label}】`),this.emit("recording-device-init")):"video"===r?(this.logger.log(`摄像头设备：【${t[r].map((e=>e.label)).join("】【")}】`),this.emit("camera-init")):"audioOut"===r&&(this.logger.log(`扬声器设备：${n.deviceId}【${n.label}】`),this.emit("playout-device-init"))):this.deviceHistory[r]=t[r]}else this.deviceHistory[r]=t[r]})),this.deviceInited||(this.deviceInited=!0,t.audioIn.length||this.logger.error("未侦测到可用麦克风"),t.video.length||this.logger.error("未侦测到可用摄像头"))}async startDeviceChangeDetection(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(this.deviceChangeDetectionTimer&&clearInterval(this.deviceChangeDetectionTimer),await this.handleDeviceChange(),navigator.mediaDevices.ondevicechange?navigator.mediaDevices.ondevicechange===this.handleDeviceChange||(c.getParameters().forceListenDeviceChange?navigator.mediaDevices.ondevicechange=this.handleDeviceChange:this.logger.warn("系统设备枚举回调已被占用，设备枚举实效性将受到影响")):navigator.mediaDevices.ondevicechange=this.handleDeviceChange,this.deviceChangeDetectionTimer=setInterval(this.handleDeviceChange,1e3)):this.logger.warn("当前环境不支持设备枚举")}stopDeviceChangeDetection(){this.logger.log("停止监听浏览器设备变化"),this.deviceChangeDetectionTimer&&(clearInterval(this.deviceChangeDetectionTimer),this.deviceChangeDetectionTimer=null),navigator.mediaDevices&&navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=null),this.deviceInited=!1,this.deviceHistory.audioIn=[],this.deviceHistory.audioOut=[],this.deviceHistory.video=[],this.hasPerm.audioIn=!1,this.hasPerm.video=!1,this.hasPerm.audioOut=!1}defaultHandleUserGestureNeeded(e){this.userGestureUI||(this.userGestureUI=document.createElement("div"),this.userGestureUI.style.fontSize="20px",this.userGestureUI.style.position="fixed",this.userGestureUI.style.background="yellow",this.userGestureUI.style.margin="auto",this.userGestureUI.style.width="100%",this.userGestureUI.style.zIndex="9999",this.userGestureUI.style.top="0",this.userGestureUI.onclick=()=>{var e;this.userGestureUI&&(null===(e=this.userGestureUI.parentNode)||void 0===e||e.removeChild(this.userGestureUI)),this.emit("user-gesture-fired")}),this.userGestureUI.style.display="block",this.userGestureUI.innerHTML=`由于浏览器限制，该操作需手势触发。<br/>点击此处以继续<br/>详细信息：${e.name}<br/>${e.message}`,document.body.appendChild(this.userGestureUI)}clean(){}}const l=new u;t.Device=l},function(e,t,r){var n=r(174),i=r(65);e.exports=function(e){return n(i(e))}},function(e,t,r){e.exports=o,o.className="ReflectionObject";var n,i=r(4);function o(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(o.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof n&&t._handleAdd(this)},o.prototype.onRemove=function(e){var t=e.root;t instanceof n&&t._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof n&&(this.resolved=!0),this},o.prototype.getOption=function(e){if(this.options)return this.options[e]},o.prototype.setOption=function(e,t,r){return r&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},o.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var o=n.find((function(t){return Object.prototype.hasOwnProperty.call(t,e)}));if(o){var a=o[e];i.setProperty(a,r,t)}else(o={})[e]=i.setProperty({},r,t),n.push(o)}else{var s={};s[e]=t,n.push(s)}return this},o.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},o.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},o._configure=function(e){n=e}},function(e,t,r){var n=t,i=r(4),o=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[o[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},function(e,t,r){function n(e){if(e instanceof RTCRtpSender)return`[RTCRtpSender track: ${n(e.track)}]`;if(e instanceof MediaStreamTrack){const t=e;return`[MediaStreamTrack kind:${t.kind} label:${t.label} readyState:${t.readyState} id: ${t.id} enabled:${t.enabled} muted: ${t.muted}]`}if(e instanceof HTMLElement){const t=e;return`[${t.tagName}.${t.className} ${t.clientWidth}x${t.clientHeight}]`}if(e instanceof MediaStream){const t=e;return`[MediaStream active:${t.active} a:${t.getAudioTracks().length} v:${t.getVideoTracks().length}]`}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.getDomInfo=t.makePrintable=t.formatSingleArg=t.deepCopy=void 0,t.deepCopy=function e(t){var r=Array.isArray(t)?[]:{};for(var n in t)t.hasOwnProperty(n)&&("object"==typeof t[n]&&null!==t[n]?r[n]=e(t[n]):r[n]=t[n]);return r},t.formatSingleArg=n,t.makePrintable=function e(t,r,i=[]){if("object"!=typeof t||!(null==t?void 0:t.hasOwnProperty))return t;var o=Array.isArray(t)?[]:{};for(var a in t)if(t.hasOwnProperty(a)){const s=n(t[a]);s&&("client"===a&&s.adapterRef||["adapterRef","sdkRef","logger","_events"].indexOf(a)>-1||(s&&"object"==typeof s?i.indexOf(s)>-1?o[a]="[Circular obj]":(i.push(o[a]),r>=1?o[a]=e(s,r-1,i):(null==s?void 0:s.toString)?o[a]=s.toString():o[a]=typeof s):o[a]=s))}return o},t.getDomInfo=function(e){if(!e)return""+e;let t=e.tagName;return e.id&&(t+="#"+e.id),e.className&&(t+="."+e.className),(e.offsetWidth||e.offsetHeight)&&(t+=` ${e.offsetWidth}x${e.offsetHeight}`),t}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getScreenStream=t.getStream=t.emptyStreamWith=t.watchTrack=void 0;const n=r(2),i=r(12),o=r(27),a=r(158),s=new i.Logger({tagGen:()=>"GUM"});t.getStream=async function(e,t){t.log("getLocalStream constraint:",JSON.stringify(e));try{const r=await navigator.mediaDevices.getUserMedia(e);return t.log("获取到媒体流: ",r.id),r.getTracks().forEach((e=>{if(d(e),"video"===e.kind&&a.canShimCanvas()){t.warn("使用canvas track取代videoTrack",e.label);const n=a.shimCanvas(e);d(n),r.removeTrack(e),r.addTrack(n)}})),r}catch(e){return t.error("媒体设备获取失败: ",e.name,e.message),Promise.reject(e)}},t.getScreenStream=async function(e,t){var r;let i;t.log("getScreenStream constraint:",JSON.stringify(e,null," ")),navigator.getDisplayMedia||navigator.mediaDevices.getDisplayMedia;try{i=await navigator.mediaDevices.getDisplayMedia(e)}catch(n){if(!((null===(r=null==n?void 0:n.message)||void 0===r?void 0:r.indexOf("user gesture"))>-1&&o.Device.onUserGestureNeeded))throw t.error("屏幕共享获取失败: ",n.name,n.message),n;t.warn("荧幕共享获取中断，需要手势触发。"),o.Device.onUserGestureNeeded(n);try{i=await new Promise(((t,r)=>{o.Device.once("user-gesture-fired",(()=>{navigator.mediaDevices.getDisplayMedia(e).then(t).catch(r)}))}))}catch(e){throw t.error("第二次屏幕共享获取失败: ",e.name,e.message),e}}return(e=>{t.log("获取到屏幕共享流: ",e.id),e.getTracks().forEach((e=>{d(e),"video"===e.kind&&n.getParameters().screenFocus&&(e.focus?(t.log("屏幕共享不跳转到被共享页面"),e.focus("no-focus-change")):t.warn("当前浏览器不支持屏幕共享跳转控制"))})),Promise.resolve(e)})(i),i};let c=Date.now(),u=0;const l=()=>{const e=n.getParameters().tracks.video,t=n.getParameters().tracks.audio,r=Date.now();if(r-c>5e3&&u<n.getParameters().maxEventLoopLagWarning){let e=`侦测到主线程事件循环从卡死中恢复。卡顿时间：${r-c-1e3}毫秒。`;e+="这可能是由于页面切往后台、设备休眠、频繁的dom操作、阻塞性代码引起的。",e+=`当前页面页面是否隐藏：${document.hidden}，可见性：${document.visibilityState}，网络状态：${navigator.onLine}。`,u+=1,u===n.getParameters().maxEventLoopLagWarning&&(e+="今后不再提示。"),s.warn(e)}c=r,e.forEach(((e,t)=>{if(e&&!e.endedAt&&"ended"===e.readyState){s.log(`VIDEOTRACK#${t} 已停止：【${e.label}】`),e.endedAt=r;const n=new CustomEvent("neTrackEnded");e.dispatchEvent(n)}})),t.forEach(((e,t)=>{if(e&&!e.endedAt&&"ended"===e.readyState){s.log(`AUDIOTRACK#${t} 已停止：【${e.label}】`),e.endedAt=r;const n=new CustomEvent("neTrackEnded");e.dispatchEvent(n)}}))};function d(e){if(e)if("ended"===e.readyState&&s.error("注意：输入的track已经停止：",e),"audio"===e.kind){const t=n.getParameters().tracks.audio;s.log("获取到的设备类型: AUDIOTRACK#"+t.length,e.kind,e.label,e.id,JSON.stringify(e.getSettings()));const r=t.findIndex((t=>e===t));r>-1?(s.warn(`注意：AUDIOTRACK#${t.length} 与 AUDIOTRACK#${r} 相同`),t.push(null)):(e.addEventListener("ended",l),t.push(e))}else{const t=n.getParameters().tracks.video;s.log("获取到的设备类型: VIDEOTRACK#"+t.length,e.kind,e.label,e.id,JSON.stringify(e.getSettings()));const r=t.findIndex((t=>e===t));r>-1?(s.warn(`注意：AUDIOTRACK#${t.length} 与 VIDEOTRACK#${r} 相同`),t.push(null)):(e.addEventListener("ended",l),t.push(e))}}setInterval(l,1e3),t.watchTrack=d,t.emptyStreamWith=function(e,t){let r=!1;e.getTracks().forEach((n=>{n!==t?(e.removeTrack(n),e.onremovetrack&&e.onremovetrack({track:n})):r=!0})),!r&&t&&(e.addTrack(t),e.onaddtrack&&e.onaddtrack({track:t}))}},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.platform=void 0;const r=function(){var t="object"==typeof e?e:window,r=Math.pow(2,53)-1,n=/\bOpera/,i=Object.prototype,o=i.hasOwnProperty,a=i.toString;function s(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function c(e){return e=f(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:s(e)}function u(e,t){for(var r in e)o.call(e,r)&&t(e[r],r,e)}function l(e){return null==e?s(e):a.call(e).slice(8,-1)}function d(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function p(e,t){var n=null;return function(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=r)for(;++n<i;)t(e[n],n);else u(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function f(e){return String(e).replace(/^ +| +$/g,"")}return function e(r){var i=t,o=r&&"object"==typeof r&&"String"!=l(r);o&&(i=r,r="");var s=i.navigator||{},h=s.userAgent||"";r||(r=h);var m,g,v,y,b,S=o?!!s.likeChrome:/\bChrome\b/.test(r)&&!/internal|\n/i.test(a.toString()),_=o?"Object":"ScriptBridgingProxyObject",M=o?"Object":"Environment",T=o&&i.java?"JavaPackage":l(i.java),w=o?"Object":"RuntimeObject",x=/\bJava/.test(T)&&i.java,I=x&&l(i.environment)==M,E=x?"a":"α",A=x?"b":"β",C=i.document||{},k=i.operamini||i.opera,O=n.test(O=o&&k?k["[[Class]]"]:l(k))?O:k=null,N=r,R=[],P=null,D=r==h,j=D&&k&&"function"==typeof k.version&&k.version(),L=p([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,t){return e||RegExp("\\b"+(t.pattern||d(t))+"\\b","i").exec(r)&&(t.label||t)})),z=p(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],(function(e,t){return e||RegExp("\\b"+(t.pattern||d(t))+"\\b","i").exec(r)&&(t.label||t)})),U=V([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),B=p({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},(function(e,t,n){return e||(t[U]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+d(n)+"(?:\\b|\\w*\\d)","i").exec(r))&&n})),F=p(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],(function(e,t){var n=t.pattern||d(t);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(r))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),c(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,t.label||t)),e}));function V(e){return p(e,(function(e,t){var n=t.pattern||d(t);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(r)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(r)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(r))&&((e=String(t.label&&!RegExp(n,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=c(e[0].replace(RegExp(n,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}if(L&&(L=[L]),B&&!U&&(U=V([B])),(m=/\bGoogle TV\b/.exec(U))&&(U=m[0]),/\bSimulator\b/i.test(r)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==z&&/\bOPiOS\b/.test(r)&&R.push("running in Turbo/Uncompressed mode"),"IE"==z&&/\blike iPhone OS\b/.test(r)?(B=(m=e(r.replace(/like iPhone OS/,""))).manufacturer,U=m.product):/^iP/.test(U)?(z||(z="Safari"),F="iOS"+((m=/ OS ([\d_]+)/i.exec(r))?" "+m[1].replace(/_/g,"."):"")):"Konqueror"!=z||/buntu/i.test(F)?B&&"Google"!=B&&(/Chrome/.test(z)&&!/\bMobile Safari\b/i.test(r)||/\bVita\b/.test(U))||/\bAndroid\b/.test(F)&&/^Chrome/.test(z)&&/\bVersion\//i.test(r)?(z="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==z?(/\bMobi/i.test(r)||(F="Android",R.unshift("desktop mode")),/Accelerated *= *true/i.test(r)&&R.unshift("accelerated")):"PaleMoon"==z&&(m=/\bFirefox\/([\d.]+)\b/.exec(r))?R.push("identifying as Firefox "+m[1]):"Firefox"==z&&(m=/\b(Mobile|Tablet|TV)\b/i.exec(r))?(F||(F="Firefox OS"),U||(U=m[1])):!z||(m=!/\bMinefield\b/i.test(r)&&/\b(?:Firefox|Safari)\b/.exec(z))?(z&&!U&&/[\/,]|^[^(]+?\)/.test(r.slice(r.indexOf(m+"/")+8))&&(z=null),(m=U||B||F)&&(U||B||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(z=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:m)+" Browser")):"Electron"==z&&(m=(/\bChrome\/([\d.]+)\b/.exec(r)||0)[1])&&R.push("Chromium "+m):F="Kubuntu",j||(j=p(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",d(z),"(?:Firefox|Minefield|NetFront)"],(function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(r)||0)[1]||null}))),(m=("iCab"==L&&parseFloat(j)>3?"WebKit":/\bOpera\b/.test(z)&&(/\bOPR\b/.test(r)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(r)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(r)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(z)&&"NetFront")&&(L=[m]),"IE"==z&&(m=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(r)||0)[1])?(z+=" Mobile",F="Windows Phone "+(/\+$/.test(m)?m:m+".x"),R.unshift("desktop mode")):/\bWPDesktop\b/i.test(r)?(z="IE Mobile",F="Windows Phone 8.x",R.unshift("desktop mode"),j||(j=(/\brv:([\d.]+)/.exec(r)||0)[1])):"IE"!=z&&"Trident"==L&&(m=/\brv:([\d.]+)/.exec(r))&&(z&&R.push("identifying as "+z+(j?" "+j:"")),z="IE",j=m[1]),D){if(y="global",b=null!=(v=i)?typeof v[y]:"number",/^(?:boolean|number|string|undefined)$/.test(b)||"object"==b&&!v[y])l(m=i.runtime)==_?(z="Adobe AIR",F=m.flash.system.Capabilities.os):l(m=i.phantom)==w?(z="PhantomJS",j=(m=m.version||null)&&m.major+"."+m.minor+"."+m.patch):"number"==typeof C.documentMode&&(m=/\bTrident\/(\d+)/i.exec(r))?(j=[j,C.documentMode],(m=+m[1]+4)!=j[1]&&(R.push("IE "+j[1]+" mode"),L&&(L[1]=""),j[1]=m),j="IE"==z?String(j[1].toFixed(1)):j[0]):"number"==typeof C.documentMode&&/^(?:Chrome|Firefox)\b/.test(z)&&(R.push("masking as "+z+" "+j),z="IE",j="11.0",L=["Trident"],F="Windows");else if(x&&(N=(m=x.lang.System).getProperty("os.arch"),F=F||m.getProperty("os.name")+" "+m.getProperty("os.version")),I){try{j=i.require("ringo/engine").version.join("."),z="RingoJS"}catch(e){(m=i.system)&&m.global.system==i.system&&(z="Narwhal",F||(F=m[0].os||null))}z||(z="Rhino")}else"object"==typeof i.process&&!i.process.browser&&(m=i.process)&&("object"==typeof m.versions&&("string"==typeof m.versions.electron?(R.push("Node "+m.versions.node),z="Electron",j=m.versions.electron):"string"==typeof m.versions.nw&&(R.push("Chromium "+j,"Node "+m.versions.node),z="NW.js",j=m.versions.nw)),z||(z="Node.js",N=m.arch,F=m.platform,j=(j=/[\d.]+/.exec(m.version))?j[0]:null));F=F&&c(F)}if(j&&(m=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j)||/(?:alpha|beta)(?: ?\d)?/i.exec(r+";"+(D&&s.appMinorVersion))||/\bMinefield\b/i.test(r)&&"a")&&(P=/b/i.test(m)?"beta":"alpha",j=j.replace(RegExp(m+"\\+?$"),"")+("beta"==P?A:E)+(/\d+\+?/.exec(m)||"")),"Fennec"==z||"Firefox"==z&&/\b(?:Android|Firefox OS)\b/.test(F))z="Firefox Mobile";else if("Maxthon"==z&&j)j=j.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(F=null),"Xbox 360"==U&&/\bIEMobile\b/.test(r)&&R.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(z)&&(!z||U||/Browser|Mobi/.test(z))||"Windows CE"!=F&&!/Mobi/i.test(r))if("IE"==z&&D)try{null===i.external&&R.unshift("platform preview")}catch(e){R.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(r))&&(m=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(r)||0)[1]||j)?(F=((m=[m,/BB10/.test(r)])[1]?(U=null,B="BlackBerry"):"Device Software")+" "+m[0],j=null):this!=u&&"Wii"!=U&&(D&&k||/Opera/.test(z)&&/\b(?:MSIE|Firefox)\b/i.test(r)||"Firefox"==z&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==z&&(F&&!/^Win/.test(F)&&j>5.5||/\bWindows XP\b/.test(F)&&j>8||8==j&&!/\bTrident\b/.test(r)))&&!n.test(m=e.call(u,r.replace(n,"")+";"))&&m.name&&(m="ing as "+m.name+((m=m.version)?" "+m:""),n.test(z)?(/\bIE\b/.test(m)&&"Mac OS"==F&&(F=null),m="identify"+m):(m="mask"+m,z=O?c(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(m)&&(F=null),D||(j=null)),L=["Presto"],R.push(m));else z+=" Mobile";(m=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(r)||0)[1])&&(m=[parseFloat(m.replace(/\.(\d)$/,".0$1")),m],"Safari"==z&&"+"==m[1].slice(-1)?(z="WebKit Nightly",P="alpha",j=m[1].slice(0,-1)):j!=m[1]&&j!=(m[2]=(/\bSafari\/([\d.]+\+?)/i.exec(r)||0)[1])||(j=null),m[1]=(/\bChrome\/([\d.]+)/i.exec(r)||0)[1],537.36==m[0]&&537.36==m[2]&&parseFloat(m[1])>=28&&"WebKit"==L&&(L=["Blink"]),D&&(S||m[1])?(L&&(L[1]="like Chrome"),m=m[1]||((m=m[0])<530?1:m<532?2:m<532.05?3:m<533?4:m<534.03?5:m<534.07?6:m<534.1?7:m<534.13?8:m<534.16?9:m<534.24?10:m<534.3?11:m<535.01?12:m<535.02?"13+":m<535.07?15:m<535.11?16:m<535.19?17:m<536.05?18:m<536.1?19:m<537.01?20:m<537.11?"21+":m<537.13?23:m<537.18?24:m<537.24?25:m<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),m=(m=m[0])<400?1:m<500?2:m<526?3:m<533?4:m<534?"4+":m<535?5:m<537?6:m<538?7:m<601?8:"8"),L&&(L[1]+=" "+(m+="number"==typeof m?".x":/[.+]/.test(m)?"":"+")),"Safari"==z&&(!j||parseInt(j)>45)&&(j=m)),"Opera"==z&&(m=/\bzbov|zvav$/.exec(F))?(z+=" ",R.unshift("desktop mode"),"zvav"==m?(z+="Mini",j=null):z+="Mobile",F=F.replace(RegExp(" *"+m+"$"),"")):"Safari"==z&&/\bChrome\b/.exec(L&&L[1])&&(R.unshift("desktop mode"),z="Chrome Mobile",j=null,/\bOS X\b/.test(F)?(B="Apple",F="iOS 4.3+"):F=null),j&&0==j.indexOf(m=/[\d.]+$/.exec(F))&&r.indexOf("/"+m+"-")>-1&&(F=f(F.replace(m,""))),L&&!/\b(?:Avant|Nook)\b/.test(z)&&(/Browser|Lunascape|Maxthon/.test(z)||"Safari"!=z&&/^iOS/.test(F)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(z)&&L[1])&&(m=L[L.length-1])&&R.push(m),R.length&&(R=["("+R.join("; ")+")"]),B&&U&&U.indexOf(B)<0&&R.push("on "+B),U&&R.push((/^on /.test(R[R.length-1])?"":"on ")+U),F&&(m=/ ([\d.+]+)$/.exec(F),g=m&&"/"==F.charAt(F.length-m[0].length-1),F={architecture:32,family:m&&!g?F.replace(m[0],""):F,version:m?m[1]:null,toString:function(){var e=this.version;return this.family+(e&&!g?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(m=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+m),"")),z&&(/\bWOW64\b/i.test(r)||D&&/\w(?:86|32)$/.test(s.cpuClass||s.platform)&&!/\bWin64; x64\b/i.test(r))&&R.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==z&&parseFloat(j)>=39&&(F.architecture=64),r||(r="");var H={};return H.description=r,H.layout=L&&L[0],H.manufacturer=B,H.name=z,H.prerelease=P,H.product=U,H.ua=r,H.version=z&&j,H.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}},H.parse=e,H.toString=function(){return this.description||""},H.version&&R.unshift(j),H.name&&R.unshift(z),F&&z&&(F!=String(F).split(" ")[0]||F!=z.split(" ")[0]&&!U)&&R.push(U?"("+F+")":"on "+F),R.length&&(H.description=R.join(" ")),H}()}();t.platform=r}).call(this,r(60))},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserInfo=t.getOSName=t.isHttpProtocol=t.checkRTCCompatibility=t.isBrowserSupported=t.isScreenShareSupport=t.isMediaDevicesSupported=t.isWebRTCSupported=t.RtcSupport=void 0;const a=r(27),s=r(16),c=r(33),u=o(r(13)),l=r(17);let d={result:!1,detail:{isBrowserSupported:!1,isWebRTCSupported:!1,isMediaDevicesSupported:!1,isH264EncodeSupported:!1,isVp8EncodeSupported:!1,isH264DecodeSupported:!1,isVp8DecodeSupported:!1}};var p=null;s.RtcSystem.ios()&&"weixin"===s.RtcSystem.browser.ua||(p=navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia);var f=window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,h=window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,m=window.MediaStream=window.MediaStream||window.webkitMediaStream;function g(e){let t;return t||(t=document.createElement("video")),!!t.canPlayType({ogg:'video/ogg; codecs="theora"',h264:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8, vorbis"',vp9:'video/webm; codecs="vp9"',hls:'application/x-mpegURL; codecs="avc1.42E01E"'}[e]||e)}const v={WebRTC:!!h&&!!m,RTCPeerConnection:!!h,Vp8:g("webm"),Vp9:g("vp9"),H264:g("h264"),GetUserMedia:!!p&&!!navigator.mediaDevices,DataChannel:!!(h&&RTCDataChannel&&h.prototype&&h.prototype.createDataChannel),WebAudio:!(!f||!f.prototype.createMediaStreamSource),MediaStream:!!m};function y(){let e=c.platform&&c.platform.name,t=c.platform&&c.platform.version;return t=t&&t.match(/\d+/)[0],{prefix:e,version:t}}const b={checkWebRtc:()=>v,checkWebAudio:()=>({WebAudio:v.WebAudio,MediaStream:v.MediaStream}),checkCompatibility(){let e=Object.assign(y(),{system:c.platform&&c.platform.os.family+" "+c.platform.os.version,browser:c.platform&&c.platform.name,version:c.platform&&c.platform.version});return new Promise((function(t,r){(async()=>{const r=Object.assign(e,v,{ScreenSharing:!1}),n=await a.Device.getDevices({audiooutput:!0,audioinput:!0,videoinput:!0,requestPerm:!0}).catch((e=>t(r)));r.MicrophoneList=n&&n.audioIn||[],r.CameraList=n&&n.video||[],r.Microphone=n&&n.audioIn&&n.audioIn.length>0||!1,r.Camera=n&&n.video&&n.video.length>0||!1,t(r)})()}))},checkVersion:()=>y()};t.RtcSupport=b,t.isWebRTCSupported=function(){return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].filter((e=>e in window)).length>0},t.isMediaDevicesSupported=function(){if(!navigator.mediaDevices)return!1;const e=["getUserMedia","enumerateDevices"];return e.filter((e=>e in navigator.mediaDevices)).length===e.length},t.isScreenShareSupport=function(){if(u.IS_ELECTRON)return!0;{let e=navigator.mediaDevices;return!(!e||!e.getDisplayMedia)}},t.isBrowserSupported=function(){return!(!(u.IS_CHROME&&u.CHROME_MAJOR_VERSION>=72)&&!(u.IS_MAC_SAFARI&&u.SAFARI_MAJOR_VERSION>=12)&&(!(u.IS_IOS_SAFARI&&u.SAFARI_MAJOR_VERSION>=13)||u.IS_WECHAT)&&!(u.IS_EDG&&u.EDG_MAJOR_VERSION>=80)&&!(u.IS_FIREFOX&&u.FIREFOX_MAJOR_VERSION>=66)&&(!u.IS_IOS||!u.IS_MQQB)&&!(u.IS_IOS&&u.IOS_VERSION>=14.3&&u.IS_WECHAT&&u.WECHAT_VERSION>=6.5)&&(!u.IS_ANDROID||!u.IS_TBS&&!u.IS_XWEB))},t.checkRTCCompatibility=async function(){if(d.result)return d;const e=t.isBrowserSupported(),r=t.isWebRTCSupported(),n=t.isMediaDevicesSupported(),i=await l.getSupportedCodecs("send"),o=await l.getSupportedCodecs("recv");return d.detail.isBrowserSupported=e,d.detail.isWebRTCSupported=r,d.detail.isMediaDevicesSupported=n,d.detail.isH264EncodeSupported=i.video.indexOf("H264")>-1,d.detail.isVp8EncodeSupported=i.video.indexOf("VP8")>-1,d.detail.isH264DecodeSupported=o.video.indexOf("H264")>-1,d.detail.isVp8DecodeSupported=o.video.indexOf("VP8")>-1,d.result=e&&r&&n&&(d.detail.isH264EncodeSupported||d.detail.isVp8EncodeSupported)&&(d.detail.isH264EncodeSupported||d.detail.isVp8EncodeSupported),d};const S="file:"===location.protocol||"localhost"===location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(location.hostname);t.isHttpProtocol=function(){return"http:"===location.protocol&&!S};const _=new Map([[u.IS_ANDROID,"Android"],[u.IS_IOS,"iOS"],[u.IS_WIN,"Windows"],[u.IS_MAC,"MacOS"],[u.IS_LINUX,"Linux"]]);t.getOSName=function(){let e=c.platform.os.family;return _.get(!0)&&(e=_.get(!0)),e};const M=new Map([[u.IS_FIREFOX,["Firefox",u.FIREFOX_VERSION]],[u.IS_EDG,["Edg",u.EDG_VERSION]],[u.IS_CHROME,["Chrome",u.CHROME_VERSION]],[u.IS_SAFARI,["Safari",u.SAFARI_VERSION]],[u.IS_WECHAT,["WeChat",u.WECHAT_VERSION]],[u.IS_WQQB,["QQ(Win)",u.WQQB_VERSION]],[u.IS_MQQB,["QQ(Mobile)",u.MQQB_VERSION]],[u.IS_X5MQQB,["QQ(Mobile X5)",u.MQQB_VERSION]],[u.IS_MACQQB,["QQ(Mac)",u.MACQQB_VERSION]],[u.IS_IPADQQB,["QQ(iPad)",u.IPADQQB_VERSION]],[u.IS_MIBROWSER,["MI",u.MI_VERSION]],[u.IS_HUAWEIBROWSER,["HW",u.HUAWEI_VERSION]],[u.IS_SAMSUNGBROWSER,["Samsung",u.SAMSUNG_VERSION]],[u.IS_OPPOBROWSER,["OPPO",u.OPPO_VERSION]],[u.IS_VIVOBROWSER,["VIVO",u.VIVO_VERSION]],[u.IS_EDGE,["EDGE",u.EDGE_VERSION]],[u.IS_SOGOUM,["SogouMobile",u.SOGOUM_VERSION]],[u.IS_SOGOU,["Sogou",u.SOGOU_VERSION]]]);t.getBrowserInfo=function(){let e=c.platform.name,t=c.platform.version;return M.get(!0)&&(e=M.get(!0)[0],t=M.get(!0)[1]),{browserName:e,browserVersion:t}}},function(e,t){e.exports=!0},function(e,t,r){var n=r(5),i=r(9),o=r(46),a=r(18),s=r(22),c=function(e,t,r){var u,l,d,p=e&c.F,f=e&c.G,h=e&c.S,m=e&c.P,g=e&c.B,v=e&c.W,y=f?i:i[t]||(i[t]={}),b=y.prototype,S=f?n:h?n[t]:(n[t]||{}).prototype;for(u in f&&(r=t),r)(l=!p&&S&&void 0!==S[u])&&s(y,u)||(d=l?S[u]:r[u],y[u]=f&&"function"!=typeof S[u]?r[u]:g&&l?o(d,n):v&&S[u]==d?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):m&&"function"==typeof d?o(Function.call,d):d,m&&((y.virtual||(y.virtual={}))[u]=d,e&c.R&&b&&!b[u]&&a(b,u,d)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t){e.exports={}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;const n=r(118),i=r(7),o="EnhancedEventEmitter";class a extends n.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(t){return i.Logger.error(o,"safeEmit() | event listener threw an error [event:%s]:%o",e,t),Boolean(r)}}async safeEmitAsPromise(e,...t){return new Promise(((r,n)=>{try{this.emit(e,...t,r,n)}catch(t){i.Logger.error(o,"safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,t),n(t)}}))}}t.EnhancedEventEmitter=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;class n extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,n):this.stack=new Error(e).stack}}t.UnsupportedError=n;class i extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,i):this.stack=new Error(e).stack}}t.InvalidStateError=i},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;const a=o(r(216)),s=o(r(23));function c(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)u(t)}function u(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function l(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(e.kind&&"string"==typeof e.kind||(e.kind=""),""!==e.kind&&"audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function d(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)p(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)f(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)h(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),m(e.rtcp)}function p(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)u(t)}function f(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function h(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function m(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function g(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function v(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function y(e,t,{strict:r=!1,modify:n=!1}={}){const i=e.mimeType.toLowerCase();if(i!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(i){case"video/h264":if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(r){if(!a.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=a.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}n&&(r?e.parameters["profile-level-id"]=r:delete e.parameters["profile-level-id"])}break;case"video/vp9":if(r&&(e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}return!0}function b(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function S(e,t){const r=[];for(const n of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find((e=>e.type===n.type&&(e.parameter===n.parameter||!e.parameter&&!n.parameter)));e&&r.push(e)}return r}t.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)c(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)l(t)},t.validateRtpCodecCapability=c,t.validateRtcpFeedback=u,t.validateRtpHeaderExtension=l,t.validateRtpParameters=d,t.validateRtpCodecParameters=p,t.validateRtpHeaderExtensionParameters=f,t.validateRtpEncodingParameters=h,t.validateRtcpParameters=m,t.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");g(e.numStreams)},t.validateNumSctpStreams=g,t.validateSctpParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const n of t.codecs||[]){if(v(n))continue;const t=(e.codecs||[]).find((e=>y(e,n,{strict:!0,modify:!0})));if(!t)continue;const i={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:n.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:n.parameters,rtcpFeedback:S(t,n)};r.codecs.push(i)}for(const n of r.codecs){const r=e.codecs.find((e=>v(e)&&e.parameters.apt===n.localPayloadType)),i=t.codecs.find((e=>v(e)&&e.parameters.apt===n.remotePayloadType));r&&i&&(n.localRtxPayloadType=r.preferredPayloadType,n.remoteRtxPayloadType=i.preferredPayloadType)}for(const n of t.headerExtensions){const t=e.headerExtensions.find((e=>b(e,n)));if(!t)continue;const i={kind:n.kind,uri:n.uri,sendId:t.preferredId,recvId:n.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(n.direction){case"sendrecv":i.direction="sendrecv";break;case"recvonly":i.direction="sendonly";break;case"sendonly":i.direction="recvonly";break;case"inactive":i.direction="inactive"}r.headerExtensions.push(i)}return r},t.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.localRtxPayloadType)continue;const n={mimeType:r.kind+"/rtx",kind:r.kind,preferredPayloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};t.codecs.push(n)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.sendId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t},t.getSendingRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:n.kind+"/rtx",payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}return r},t.getSendingRemoteRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.remoteParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:n.kind+"/rtx",payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return r},t.reduceCodecs=function(e,t){const r=[];if(t){for(let n=0;n<e.length;++n)if(y(e[n],t)){r.push(e[n]),v(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),v(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e,t){d(e=s.clone(e,{}));const r={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:t}],rtcp:{cname:"probator"}};return r.codecs.push(e.codecs[0]),r.codecs[0].payloadType=127,r.headerExtensions=e.headerExtensions,r},t.canSend=function(e,t){return t.codecs.some((t=>t.kind===e))},t.canReceive=function(e,t){if(d(e),0===e.codecs.length)return!1;for(let r in e.codecs)if("video/rtx"!==e.codecs[r].mimeType)for(let n in t.codecs)if(t.codecs[n].localPayloadType===e.codecs[r].payloadType)return!0;return!1}},function(e,t,r){var n=r(219),i=r(220);t.write=i,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){e.exports=d;var n=r(29);((d.prototype=Object.create(n.prototype)).constructor=d).className="Namespace";var i,o,a,s=r(24),c=r(44),u=r(4);function l(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function d(e,t){n.call(this,e,t),this.nested=void 0,this._nestedArray=null}function p(e){return e._nestedArray=null,e}d.fromJSON=function(e,t){return new d(e,t.options).addJSON(t.nested)},d.arrayToJSON=l,d.isReservedId=function(e,t){if(e)for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0;return!1},d.isReservedName=function(e,t){if(e)for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1},Object.defineProperty(d.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=u.toArray(this.nested))}}),d.prototype.toJSON=function(e){return u.toObject(["options",this.options,"nested",l(this.nestedArray,e)])},d.prototype.addJSON=function(e){if(e)for(var t,r=Object.keys(e),n=0;n<r.length;++n)t=e[r[n]],this.add((void 0!==t.fields?i.fromJSON:void 0!==t.values?a.fromJSON:void 0!==t.methods?o.fromJSON:void 0!==t.id?s.fromJSON:d.fromJSON)(r[n],t));return this},d.prototype.get=function(e){return this.nested&&this.nested[e]||null},d.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof a)return this.nested[e].values;throw Error("no such enum: "+e)},d.prototype.add=function(e){if(!(e instanceof s&&void 0!==e.extend||e instanceof i||e instanceof a||e instanceof o||e instanceof d||e instanceof c))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof d&&e instanceof d)||t instanceof i||t instanceof o)throw Error("duplicate name '"+e.name+"' in "+this);for(var r=t.nestedArray,n=0;n<r.length;++n)e.add(r[n]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),p(this)},d.prototype.remove=function(e){if(!(e instanceof n))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),p(this)},d.prototype.define=function(e,t){if(u.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof d))throw Error("path conflicts with non-namespace objects")}else r.add(r=new d(n))}return t&&r.addJSON(t),r},d.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof d?e[t++].resolveAll():e[t++].resolve();return this.resolve()},d.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),u.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var n=this.get(e[0]);if(n){if(1===e.length){if(!t||t.indexOf(n.constructor)>-1)return n}else if(n instanceof d&&(n=n.lookup(e.slice(1),t,!0)))return n}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof d&&(n=this._nestedArray[i].lookup(e,t,!0)))return n;return null===this.parent||r?null:this.parent.lookup(e,t)},d.prototype.lookupType=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such type: "+e);return t},d.prototype.lookupEnum=function(e){var t=this.lookup(e,[a]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},d.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[i,a]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},d.prototype.lookupService=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},d._configure=function(e,t,r){i=e,o=t,a=r}},function(e,t,r){e.exports=a;var n=r(29);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=r(24),o=r(4);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),void 0!==t&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function s(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,s(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var r=e.get(this.oneof[t]);r&&!r.partOf&&(r.partOf=this,this.fieldsArray.push(r))}s(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},a.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){o.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:o.oneOfGetter(e),set:o.oneOfSetter(e)})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.STREAM_TYPE=t.NERTC_VIDEO_QUALITY_REV=t.NERTC_VIDEO_QUALITY=t.NERTC_VIDEO_QUALITY_ENUM=t.NERTC_RECORD_VIDEO_FRAME_RATE=t.NERTC_RECORD_VIDEO_QUALITY=t.VIDEO_FRAME_RATE=t.VIDEO_FRAME_RATE_ENUM=void 0,function(e){e[e.CHAT_VIDEO_FRAME_RATE_NORMAL=0]="CHAT_VIDEO_FRAME_RATE_NORMAL",e[e.CHAT_VIDEO_FRAME_RATE_5=1]="CHAT_VIDEO_FRAME_RATE_5",e[e.CHAT_VIDEO_FRAME_RATE_10=2]="CHAT_VIDEO_FRAME_RATE_10",e[e.CHAT_VIDEO_FRAME_RATE_15=3]="CHAT_VIDEO_FRAME_RATE_15",e[e.CHAT_VIDEO_FRAME_RATE_20=4]="CHAT_VIDEO_FRAME_RATE_20",e[e.CHAT_VIDEO_FRAME_RATE_25=5]="CHAT_VIDEO_FRAME_RATE_25"}(t.VIDEO_FRAME_RATE_ENUM||(t.VIDEO_FRAME_RATE_ENUM={})),t.VIDEO_FRAME_RATE={CHAT_VIDEO_FRAME_RATE_NORMAL:0,CHAT_VIDEO_FRAME_RATE_5:1,CHAT_VIDEO_FRAME_RATE_10:2,CHAT_VIDEO_FRAME_RATE_15:3,CHAT_VIDEO_FRAME_RATE_20:4,CHAT_VIDEO_FRAME_RATE_25:5},t.NERTC_RECORD_VIDEO_QUALITY={RECORD_VIDEO_QUALITY_360p:360,RECORD_VIDEO_QUALITY_480p:480,RECORD_VIDEO_QUALITY_720p:720},t.NERTC_RECORD_VIDEO_FRAME_RATE={RECORD_VIDEO_FRAME_RATE_15:15,RECORD_VIDEO_FRAME_RATE_30:30},function(e){e[e.VIDEO_QUALITY_180p=2]="VIDEO_QUALITY_180p",e[e.VIDEO_QUALITY_480p=4]="VIDEO_QUALITY_480p",e[e.VIDEO_QUALITY_720p=8]="VIDEO_QUALITY_720p",e[e.VIDEO_QUALITY_1080p=16]="VIDEO_QUALITY_1080p"}(t.NERTC_VIDEO_QUALITY_ENUM||(t.NERTC_VIDEO_QUALITY_ENUM={})),t.NERTC_VIDEO_QUALITY={VIDEO_QUALITY_180p:2,VIDEO_QUALITY_480p:4,VIDEO_QUALITY_720p:8,VIDEO_QUALITY_1080p:16},t.NERTC_VIDEO_QUALITY_REV={[t.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_180p]:"320x180",[t.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p]:"640x480",[t.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_720p]:"1280x720",[t.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p]:"1920x1080"},t.STREAM_TYPE={HIGH:0,LOW:1}},function(e,t,r){var n=r(47);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(19).f,i=r(22),o=r(6)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){var n=r(2),i=r(26),o=r(12);r(115),e.exports=class{constructor(e){this.formatTimeUnit=function(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r},this.prefix=e?"protoo-client:"+e:"protoo-client"}debug(){var e=Array.prototype.slice.call(arguments);this.formatArgs(e),(0,n.getParameters)().logLevel<=i.loglevels.DEBUG&&console.debug.apply(console,e),window.logUpload&&window.wsTransport&&window.wsTransport.sendLog(e)}warn(){var e=Array.prototype.slice.call(arguments);this.formatArgs(e),(0,n.getParameters)().logLevel<=i.loglevels.WARNING&&console.warn.apply(console,e),window.logUpload&&window.wsTransport&&window.wsTransport.sendLog(e)}error(){var e=Array.prototype.slice.call(arguments);this.formatArgs(e),(0,n.getParameters)().logLevel<=i.loglevels.ERROR&&console.error.apply(console,e),window.logUpload&&window.wsTransport&&window.wsTransport.sendLog(e)}formatArgs(e){var t=new Date,r=this.formatTimeUnit(""+(t.getMonth()+1))+"-"+this.formatTimeUnit(""+t.getDate())+" "+this.formatTimeUnit(""+t.getHours())+":"+this.formatTimeUnit(""+t.getMinutes())+":"+this.formatTimeUnit(""+t.getSeconds())+":"+this.formatTimeUnit(""+t.getMilliseconds(),3),n="[NERTC:LOG:"+(0,o.updateLogIndex)()+" "+r+" "+this.prefix.toUpperCase()+"]";return e.unshift(n),e}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;const n=r(39);class i extends n.EnhancedEventEmitter{constructor(){super()}}t.HandlerInterface=i},function(e,t,r){function n(e,t){return{ARRAY_BUFFER:e.ARRAY_BUFFER,ELEMENT_ARRAY_BUFFER:e.ELEMENT_ARRAY_BUFFER}[null!=t?t:"ARRAY_BUFFER"]}function i(e,t){return{STATIC_DRAW:e.STATIC_DRAW,DYNAMIC_DRAW:e.DYNAMIC_DRAW,STREAM_DRAW:e.STREAM_DRAW}[null!=t?t:"STATIC_DRAW"]}function o(e,t){const r={Int8Array:e.BYTE,Uint8Array:e.UNSIGNED_BYTE,Int16Array:e.SHORT,Uint16Array:e.UNSIGNED_SHORT,Int32Array:e.INT,Uint32Array:e.UNSIGNED_INT,Float32Array:e.FLOAT}[Object.prototype.toString.call(t).replace(/object|\[|\]|\s/g,"")];return void 0===r?(console.warn("attribute buffer type error.\n legal type may << Int8Array、Uint8Array、Int16Array、Uint16Array、Float32Array."),e.FLOAT):r}Object.defineProperty(t,"__esModule",{value:!0}),t.parseAttributes=t.createAttributeBuffer=void 0,t.createAttributeBuffer=function(e,t,r,a,s,c,u,l,d){const p=e.createBuffer();if(!p)return console.error("buffer created failed."),null;const f=r.length;return{type:o(e,r),buffer:p,name:t,typedArray:r,itemSize:null!=a?a:1,count:f/(null!=a?a:1)>>0,normalized:null!=u&&u,target:n(e,s),usage:i(e,c),stride:null!=l?l:0,offset:null!=d?d:0}},t.parseAttributes=function(e,t){const r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a={};for(let s=0;s<r;s++){const r=e.getActiveAttrib(t,s);if(r){const{name:s}=r,c=e.getAttribLocation(t,s);if(null!==c){const t={type:e.FLOAT,buffer:null,typedArray:null,itemSize:1,count:0,normalized:!1,target:n(e),usage:i(e),stride:0,offset:0,setter:r=>{const{buffer:n}=t;if(!n)return void console.error(`buffer of attribute:[${s}] is not initialized.`);const{type:i}=t;if(o(e,r)!==i)return void console.error(`typedArray's type of attribute:[${s}] is inconsistent.`);const{itemSize:a,normalized:u,target:l,usage:d,stride:p,offset:f}=t;e.bindBuffer(l,n),e.bufferData(l,r,d),e.enableVertexAttribArray(c),e.vertexAttribPointer(c,a,i,u,p,f),t.typedArray=r},bufferSetter:e=>{if(e){const{name:r}=e;r===s&&(t.type=e.type,t.buffer=e.buffer,t.itemSize=e.itemSize,t.count=e.count,t.normalized=e.normalized,t.target=e.target,t.usage=e.usage,t.stride=e.stride,t.offset=e.offset,t.setter(e.typedArray))}},get attributeBuffer(){return null===t.buffer?null:{type:t.type,buffer:t.buffer,name:s,typedArray:t.typedArray,itemSize:t.itemSize,count:t.count,normalized:t.normalized,target:t.target,usage:t.usage,stride:t.stride,offset:t.offset}}};a[s]=t}else console.warn(`attribute:[${s}] is null.`)}}return a}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=t.createTexture=void 0,t.createTexture=function(e,t,r){const n=e.createTexture();if(!n)return console.error(`texture:[${t}] created error.`),null;const i={glTexture:n,source:t,refresh(){const{source:t,glTexture:r,opts:n}=i,o=e.TEXTURE_2D;e.bindTexture(o,r);const{flipY:a}=n;a?e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0):e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST),"width"in n&&"height"in n?e.texImage2D(o,0,e.RGB,n.width,n.height,0,e.RGB,e.UNSIGNED_BYTE,t):null!==t&&e.texImage2D(o,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,t)},opts:Object.assign({flipY:!0},r)};return i.refresh(),i},t.loadImage=function(e,t){fetch(e+"?rdn="+Date.now()).then((e=>e.arrayBuffer())).then((r=>{const n=new Blob([r],{type:"image/*"}),i=new Image;new URL(e,window.location.href).origin!==window.location.origin&&(i.crossOrigin="anonymous"),i.onload=()=>{t(i)},i.src=URL.createObjectURL(n)})).catch((e=>{console.log("image load error",e)}))}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ajax=void 0;const i=n(r(1)),o=n(r(0));var a=r(57);t.ajax=function(e){if(!e||!e.url)return Promise.reject(new i.default({code:o.default.INVALID_PARAMETER,message:"could not send request due to invalid parameter"}));e.dataType=e.dataType||"json";var t=new XMLHttpRequest;t.open(e.type||"GET",e.url,!0),t.responseType=""+e.dataType;const r=e.contentType||"application/json;charset=UTF-8";return t.setRequestHeader("Content-type",r),e.header&&Object.keys(e.header).map((r=>{e.header&&e.header[r]&&t.setRequestHeader(r,e.header[r])})),new Promise(((n,s)=>{var c;t.onload=function(){if(t.status>400)return Promise.reject(new i.default({code:o.default.INVALID_PARAMETER,message:"could not send request due to invalid parameter"}));var e=t.response;n(e)},t.onerror=function(e){s(e)},t.ontimeout=function(t){s({code:456,desc:"ERR_TIMED_OUT "+e.url})},r.indexOf("x-www-form-urlencoded")>=0?e.data?t.send((c=e.data,Object.keys(c).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(/Object/i.test(c[e])?JSON.stringify(c[e]):c[e]))).join("&"))):t.send():e.data?e.header&&"gzip"===e.header["Content-Encoding"]?t.send(e.data):t.send(a.stringify(e.data)):t.send()}))}},function(e,t,r){var n=r(147).stringify,i=r(148);e.exports=function(e){return{parse:i(e),stringify:n}},e.exports.parse=i(),e.exports.stringify=n},function(e,t,r){var n,i,o,a,s;n=r(150),i=r(91).utf8,o=r(151),a=r(91).bin,(s=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?a.stringToBytes(e):i.stringToBytes(e):o(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var r=n.bytesToWords(e),c=8*e.length,u=1732584193,l=-271733879,d=-1732584194,p=271733878,f=0;f<r.length;f++)r[f]=16711935&(r[f]<<8|r[f]>>>24)|4278255360&(r[f]<<24|r[f]>>>8);r[c>>>5]|=128<<c%32,r[14+(c+64>>>9<<4)]=c;var h=s._ff,m=s._gg,g=s._hh,v=s._ii;for(f=0;f<r.length;f+=16){var y=u,b=l,S=d,_=p;u=h(u,l,d,p,r[f+0],7,-680876936),p=h(p,u,l,d,r[f+1],12,-389564586),d=h(d,p,u,l,r[f+2],17,606105819),l=h(l,d,p,u,r[f+3],22,-1044525330),u=h(u,l,d,p,r[f+4],7,-176418897),p=h(p,u,l,d,r[f+5],12,1200080426),d=h(d,p,u,l,r[f+6],17,-1473231341),l=h(l,d,p,u,r[f+7],22,-45705983),u=h(u,l,d,p,r[f+8],7,1770035416),p=h(p,u,l,d,r[f+9],12,-1958414417),d=h(d,p,u,l,r[f+10],17,-42063),l=h(l,d,p,u,r[f+11],22,-1990404162),u=h(u,l,d,p,r[f+12],7,1804603682),p=h(p,u,l,d,r[f+13],12,-40341101),d=h(d,p,u,l,r[f+14],17,-1502002290),u=m(u,l=h(l,d,p,u,r[f+15],22,1236535329),d,p,r[f+1],5,-165796510),p=m(p,u,l,d,r[f+6],9,-1069501632),d=m(d,p,u,l,r[f+11],14,643717713),l=m(l,d,p,u,r[f+0],20,-373897302),u=m(u,l,d,p,r[f+5],5,-701558691),p=m(p,u,l,d,r[f+10],9,38016083),d=m(d,p,u,l,r[f+15],14,-660478335),l=m(l,d,p,u,r[f+4],20,-405537848),u=m(u,l,d,p,r[f+9],5,568446438),p=m(p,u,l,d,r[f+14],9,-1019803690),d=m(d,p,u,l,r[f+3],14,-187363961),l=m(l,d,p,u,r[f+8],20,1163531501),u=m(u,l,d,p,r[f+13],5,-1444681467),p=m(p,u,l,d,r[f+2],9,-51403784),d=m(d,p,u,l,r[f+7],14,1735328473),u=g(u,l=m(l,d,p,u,r[f+12],20,-1926607734),d,p,r[f+5],4,-378558),p=g(p,u,l,d,r[f+8],11,-2022574463),d=g(d,p,u,l,r[f+11],16,1839030562),l=g(l,d,p,u,r[f+14],23,-35309556),u=g(u,l,d,p,r[f+1],4,-1530992060),p=g(p,u,l,d,r[f+4],11,1272893353),d=g(d,p,u,l,r[f+7],16,-155497632),l=g(l,d,p,u,r[f+10],23,-1094730640),u=g(u,l,d,p,r[f+13],4,681279174),p=g(p,u,l,d,r[f+0],11,-358537222),d=g(d,p,u,l,r[f+3],16,-722521979),l=g(l,d,p,u,r[f+6],23,76029189),u=g(u,l,d,p,r[f+9],4,-640364487),p=g(p,u,l,d,r[f+12],11,-421815835),d=g(d,p,u,l,r[f+15],16,530742520),u=v(u,l=g(l,d,p,u,r[f+2],23,-995338651),d,p,r[f+0],6,-198630844),p=v(p,u,l,d,r[f+7],10,1126891415),d=v(d,p,u,l,r[f+14],15,-1416354905),l=v(l,d,p,u,r[f+5],21,-57434055),u=v(u,l,d,p,r[f+12],6,1700485571),p=v(p,u,l,d,r[f+3],10,-1894986606),d=v(d,p,u,l,r[f+10],15,-1051523),l=v(l,d,p,u,r[f+1],21,-2054922799),u=v(u,l,d,p,r[f+8],6,1873313359),p=v(p,u,l,d,r[f+15],10,-30611744),d=v(d,p,u,l,r[f+6],15,-1560198380),l=v(l,d,p,u,r[f+13],21,1309151649),u=v(u,l,d,p,r[f+4],6,-145523070),p=v(p,u,l,d,r[f+11],10,-1120210379),d=v(d,p,u,l,r[f+2],15,718787259),l=v(l,d,p,u,r[f+9],21,-343485551),u=u+y>>>0,l=l+b>>>0,d=d+S>>>0,p=p+_>>>0}return n.endian([u,l,d,p])})._ff=function(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._gg=function(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._hh=function(e,t,r,n,i,o,a){var s=e+(t^r^n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._ii=function(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._blocksize=16,s._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=n.wordsToBytes(s(e,t));return t&&t.asBytes?r:t&&t.asString?a.bytesToString(r):n.bytesToHex(r)}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Record=void 0;const i=r(3),o=n(r(1)),a=n(r(0)),s=r(16);class c extends i.EventEmitter{constructor(e){super(),this._status={recordedChunks:[],isRecording:!1,stream:null,option:null,contentTypes:[],mimeType:"",audioController:null,opStream:null,state:"init",timer:null,fileName:null,recordId:0,recordStatus:"init",recordUrl:null,startTime:null,endTime:null},this._recorder=null,this.logger=e.logger.getChild((()=>"recorder "+this._status.recordStatus)),this._reset(),this.client=e.client}async start(e){const{stream:t=null,uid:r="0",type:n="video",reset:i=!1,recordName:c}=e;this.logger.log("开始本地录制: ",JSON.stringify(e,null,""));let u=null;if(window.MediaRecorder&&MediaRecorder.isTypeSupported&&"chrome"===s.RtcSystem.browser.ua||(this.logger.log("浏览器不支持本地录制"),u="RecordBrowserNotSupport"),this._status.isRecording&&(this.logger.log("当前正在录制中"),u="RecordInRecording"),this._status.recordUrl&&"downloaded"!==this._status.recordStatus&&(e.reset?(this.logger.warn("MediaRecordHelper: start: 存在未下载视频，强制清除..."),await this.clean()):(this.logger.log("MediaRecordHelper: start : 请先下载或重置上一段录制文件"),u="RecordFileExsit")),u)throw this.client.apiFrequencyControl({name:"startMediaRecording",code:-1,param:JSON.stringify({reason:u,uid:r,mediaType:n,recordName:""},null," ")}),new o.default({code:a.default.INVALID_OPERATION,message:"浏览器不支持本地录制"});this._status.stream=t,this._status.option=e,this._status.fileName=this._getFilename(c),this._status.startTime=this._getTimeStamp();let l=["video/mp4;codecs=opus","video/webm","video/webm;codecs=h264","video/x-matroska;codecs=opus","video/invalid"];if("audio"===e.type&&(l=["audio/wav","audio/ogg","audio/pcm","audio/webm"]),!(this._status.mimeType=this._validation(l)[0]))return"RecordBrowserNotSupport";try{await this._format(),await this._start(),this.client.apiFrequencyControl({name:"startMediaRecording",code:0,param:JSON.stringify({uid:r,mediaType:n,recordName:""},null," ")})}catch(e){return this.logger.error("录制start error： ",e.name,e.message,e),this.client.apiFrequencyControl({name:"startMediaRecording",code:-1,param:JSON.stringify({reason:"录制接口 error",uid:r,mediaType:n,recordName:""},null," ")}),Promise.reject(new o.default({code:a.default.RECORD_API_ERROR,message:"record api error"}))}}stop(e){let t=null;return this._status.isRecording&&this._recorder||(this.logger.log("当前没有进行录制"),t="RecordNotExist"),this._recorder&&"started"!==this._status.state&&(this.logger.warn("MediaRecordHelper: record stopping when "+this._recorder.state),t="RecordStateError"),t?(e&&!1===e.isUser||this.client.apiFrequencyControl({name:"stopMediaRecording",code:-1,param:""}),Promise.resolve()):(this._status.state="stopped",this._status.recordStatus="stopping",new Promise(((t,r)=>{if(!this._recorder)return r(new o.default({code:a.default.NO_RECORDER_FOUND,message:"no record found"}));this._status.fileName=this._status.fileName,this._recorder.onstop=()=>{this._onStop(t)},this._recorder.stop(),this.client.apiFrequencyControl({name:"stopMediaRecording",code:0,param:""}),e&&e.isUser&&this.client.apiFrequencyControl({name:"stopMediaRecording",code:-1,param:""})})))}play(e){return"stopped"!==this._status.state?(this.client.apiFrequencyControl({name:"playMediaRecording",code:-1,param:JSON.stringify({reason:"RecordStateError"},null," ")}),this.logger.warn("MediaRecordHelper: record stopping when "+(this._recorder&&this._recorder.state)),Promise.resolve()):(this.client.apiFrequencyControl({name:"playMediaRecording",code:0,param:JSON.stringify({recordId:""},null," ")}),this._play(e))}download(e=!0){return Promise.resolve().then((()=>this._status.isRecording?(this.logger.log("MediaRecordHelper: download: 正在录制中，立即停止..."),this.stop({isUser:!1})):Promise.resolve())).then((()=>{if(console.warn("下载录制： ",this._status),this._status.recordUrl){const e=document.createElement("a");document.body.appendChild(e),e.style.display="none",e.href=this._status.recordUrl,e.download=(this._status.fileName||this._getTimeStamp())+".webm",e.click(),this._status.recordStatus="downloaded"}else this.logger.log("MediaRecordHelper: download: cannot download media without url ...");return e&&this.client.apiFrequencyControl({name:"downloadMediaRecording",code:0,param:""}),Promise.resolve(this._status)}))}async clean(){this.client.apiFrequencyControl({name:"cleanMediaRecording",code:0,param:""}),this._status.isRecording&&this._recorder&&await this.stop(),this._status.recordUrl&&(window.URL.revokeObjectURL(this._status.recordUrl),this._status.recordUrl=null),this._destroy(),this._status.recordStatus="init"}leave(e={uid:0}){if(!this._status.isRecording||!this._recorder)return Promise.resolve();const{uid:t}=e;return t&&this._status.option?t===+this._status.option.uid?this.stop():void 0:Promise.resolve()}pause(){this._recorder&&this._recorder.pause()}resume(){this._recorder&&this._recorder.resume()}_reset(){this._recorder=null,Object.assign(this._status,{recordedChunks:[],isRecording:!1,stream:null,option:null,contentTypes:[],mimeType:"",audioController:null,opStream:null,state:"init",timer:null,fileName:null,recordId:0,recordStatus:"init",recordUrl:null,startTime:null,endTime:null})}_getTimeStamp(){return Math.floor(Date.now()/1e3)}_getFilename(e){let t="";e&&(t+=e+"_");const r=new Date;return t+=`${r.getFullYear()}${(r.getMonth()+1).toString().padStart(2,"0")}${r.getDate().toString().padStart(2,"0")}`,t+=`${r.getHours().toString().padStart(2,"0")}${r.getMinutes().toString().padStart(2,"0")}${r.getSeconds().toString().padStart(2,"0")}${r.getMilliseconds().toString().padStart(3,"0")}`,t}_validation(e){return e.filter((e=>MediaRecorder.isTypeSupported(e)))}_format(){let e=this._status.stream;return this._status.option,new Promise(((t,r)=>{let n=new MediaStream;if(!e)return r(new o.default({code:a.default.NOT_DEFINED,message:"stream not defined"}));if(this._matchLocalStreamConstructor(e.constructor.toString())&&(e=[e]),Array.isArray(e)){if(e.forEach((e=>{e&&this._matchLocalStreamConstructor(e.constructor.toString())&&e.getTracks().forEach((e=>{n.addTrack(e)}))})),0===n.getTracks().length)return this.logger.error("_format: No tracks available"),t(n);this._status.opStream=n,t(n)}}))}_matchLocalStreamConstructor(e){return/(LocalMediaStream|MediaStream)/.test(e)}_start(){let e={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:this._status.mimeType};if(!this._status.opStream)return Promise.reject(new o.default({code:a.default.NOT_AVALIABLE,message:"no stream avaliable"}));const t=this._status.opStream.getAudioTracks();let r;r=t.length>1?new MediaStream([t[0]]):this._status.opStream;let n=this._recorder=new MediaRecorder(r,e);return n.ondataavailable=this._onDataAvailable.bind(this),n.onstop=()=>{this.logger.log("MediaRecordHelper: _start: record stop automatically ..."),this._onStop()},this._status.recordUrl&&(window.URL.revokeObjectURL(this._status.recordUrl),this._status.recordUrl=null),this._status.recordedChunks=[],this._status.isRecording=!0,this._status.state="started",this._status.recordId+=1,this._status.recordStatus="starting",this._recorder.start(),this._clearTimer(),this._startTimer(),Promise.resolve(this._status.recordId)}_startTimer(){this._status.timer||(this._status.timer=setInterval((()=>{this.logger.log(`MediaRecordHelper: startTimer: ${(new Date).toLocaleString()} --\x3e MediaRecorder status: ${this._recorder&&this._recorder.state}`)}),5e3))}_onStop(e){this.logger.log("MediaRecordHelper: _onStop: record stoped !!!"),this._clearTimer(),this._status.recordStatus="stopped",this._status.isRecording=!1,this._status.endTime=this._getTimeStamp();let t=new Blob(this._status.recordedChunks,{type:this._status.mimeType});this._status.recordUrl=URL.createObjectURL(t),this.emit("media-recording-stopped",this.getRecordStatus()),e&&e(this._status.fileName)}_play(e){let t=null;if(-1!=this._status.mimeType.indexOf("audio"))t=document.createElement("audio");else{if(-1==this._status.mimeType.indexOf("video"))return Promise.reject(new o.default({code:a.default.NOT_SUPPORT,message:"Unsupported MIME type "+this._status.mimeType}));t=document.createElement("video"),t.autoplay=!0}return this._status.recordUrl?(e.appendChild(t),t.srcObject=null,t.src=this._status.recordUrl,t.controls=!1,t.play(),Promise.resolve(this._status.option)):Promise.reject(new o.default({code:a.default.NOT_DEFINED,message:"record url is unfefined"}))}async _destroy(){this._status.audioController&&this._status.audioController.destroy(),this._status.isRecording&&await this.stop({isUser:!1}),this._clearTimer(),this._recorder=null,Object.assign(this._status,{stream:null,recordedChunks:[],isRecording:!1,audioController:null,status:"init"})}_clearTimer(){this._status.timer&&(clearInterval(this._status.timer),this._status.timer=null)}_onDataAvailable(e){if(this._status.recordStatus="recording",this.logger.log("MediaRecordHelper: ondataavailable: data received"),!(e.data.size>0))return this.logger.warn("MediaRecordHelper: ondataavailable: no data"),void this.stop();this._status.recordedChunks.push(e.data)}checkIsRecording(){return this._status.isRecording}getRecordStatus(){const e=Object.assign({id:this._status.recordId,type:this._status.mimeType,name:this._status.fileName,status:this._status.recordStatus,isRecording:this._status.isRecording,startTime:this._status.startTime,endTime:this._status.endTime},this._status.option);return this.client.apiFrequencyControl({name:"listMediaRecording",code:0,param:""}),e}destroy(){this._destroy()}}t.Record=c},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.encryptionModeToInt=t.EncryptionModes=t.Encryption=void 0;const i=r(3),o=n(r(58)),a={none:-1,"sm4-128-ecb":0};t.EncryptionModes=a,t.encryptionModeToInt=function(e){return"none"===e||"sm4-128-ecb"===e?a[e]:void 0};class s extends i.EventEmitter{constructor(e){super(),this.encryptionMode="none",this.encryptionSecret="",this.encodedInsertableStreams=!1,this.adapterRef=e}setEncryptionMode(e){this.encryptionMode=e}setEncryptionSecret(e){this.encryptionSecret=o.default(e)}handleUpstreamTransform(e,t,r){e.index++,1===e.index&&this.adapterRef.logger.log("生成第一帧上行自定义加密（明文）。长度:",t.data.byteLength,e.mediaType,e.streamType),this.adapterRef.instance.safeEmit("sender-transform",{uid:this.adapterRef.channelInfo.uid,mediaType:e.mediaType,streamType:e.streamType,encodedFrame:t,controller:r})}handleDownstreamTransform(e,t,r){e.index++,1===e.index&&this.adapterRef.logger.log("收到第一帧下行自定义加密（密文）。长度:",t.data.byteLength,e.uid,e.mediaType),this.adapterRef.instance.safeEmit("receiver-transform",{uid:e.uid,mediaType:e.mediaType,encodedFrame:t,controller:r})}}t.Encryption=s},function(e,t,r){e.exports=r(167)},function(e,t,r){t.__esModule=!0;var n,i=(n=r(169))&&n.__esModule?n:{default:n};t.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,r){return function n(o,a){try{var s=t[o](a),c=s.value}catch(e){return void r(e)}if(!s.done)return i.default.resolve(c).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(c)}("next")}))}}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(20),i=r(5).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,r){var n=r(20);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(105),i=r(71);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=r(70)("keys"),i=r(50);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var n=r(9),i=r(5),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(35)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(47);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){t.f=r(6)},function(e,t,r){var n=r(5),i=r(9),o=r(35),a=r(73),s=r(19).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;const s=o(r(42)),c=a(r(1)),u=a(r(0));t.extractRtpCapabilities=function({sdpObject:e}){const t=new Map,r=[];let n=!1,i=!1;for(const o of e.media){const e=o.type;switch(e){case"audio":if(n)continue;n=!0;break;case"video":if(i)continue;i=!0;break;default:continue}for(const r of o.rtp){const n={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(n.preferredPayloadType,n)}for(const e of o.fmtp||[]){const r=s.parseParams(e.config),n=t.get(e.payload);n&&(r&&r.hasOwnProperty("profile-level-id")&&(r["profile-level-id"]=String(r["profile-level-id"])),n.parameters=r)}for(const e of o.rtcpFb||[]){const r=t.get(e.payload);if(!r)continue;const n={type:e.type,parameter:e.subtype};n.parameter||delete n.parameter,r.rtcpFeedback.push(n)}for(const t of o.ext||[]){if(t["encrypt-uri"])continue;const n={kind:e,uri:t.uri,preferredId:t.value};r.push(n)}}return{codecs:Array.from(t.values()),headerExtensions:r}},t.extractDtlsParameters=function({sdpObject:e}){const t=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!t)throw new c.default({code:u.default.NOT_FOUND,message:"no active media section found"});const r=t.fingerprint||e.fingerprint;let n;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}},t.getCname=function({offerMediaObject:e}){const t=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""},t.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e)continue;if(!(t.rtp||[]).find((e=>e.payload===r.payloadType)))continue;t.fmtp=t.fmtp||[];let n=t.fmtp.find((e=>e.payload===r.payloadType));n||(n={payload:r.payloadType,config:""},t.fmtp.push(n));const i=s.parseParams(n.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(i.stereo=e?1:0);break}}n.config="";for(const e of Object.keys(i))n.config&&(n.config+=";"),n.config+=`${e}=${i[e]}`}}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0;const i=n(r(1)),o=n(r(0));t.getRtpEncodings=function({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new i.default({code:o.default.NOT_FOUND,message:"no a=ssrc lines found"});const r=new Map;for(const n of e.ssrcGroups||[]){if("FID"!==n.semantics)continue;let[e,i]=n.ssrcs.split(/\s+/);e=Number(e),i=Number(i),t.has(e)&&(t.delete(e),t.delete(i),r.set(e,i))}for(const e of t)r.set(e,null);const n=[];for(const[e,t]of r){const r={ssrc:e};t&&(r.rtx={ssrc:t}),n.push(r)}return n},t.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!r)throw new i.default({code:o.default.NOT_FOUND,message:"a=ssrc line with msid information not found"});const[n,a]=r.value.split(" "),s=r.id;let c;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===s&&(c=Number(t[1]),!0)}));const u=e.ssrcs.find((e=>"cname"===e.attribute));if(!u)throw new i.default({code:o.default.NOT_FOUND,message:"a=ssrc line with cname information not found"});const l=u.value,d=[],p=[];for(let e=0;e<t;++e)d.push(s+e),c&&p.push(c+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let t=0;t<d.length;++t){const r=d[t];e.ssrcs.push({id:r,attribute:"cname",value:l}),e.ssrcs.push({id:r,attribute:"msid",value:`${n} ${a}`})}for(let t=0;t<p.length;++t){const r=d[t],i=p[t];e.ssrcs.push({id:i,attribute:"cname",value:l}),e.ssrcs.push({id:i,attribute:"msid",value:`${n} ${a}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${i}`})}}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;const s=o(r(42)),c=r(7),u=r(221),l=a(r(1)),d=a(r(0));t.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:o=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=n,this._plainRtpParameters=i,this._planB=o,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}i&&(this._sdpObject.origin.address=i.ip,this._sdpObject.origin.ipVer=i.ipVersion)}updateIceParameters(e){c.Logger.debug("RemoteSdp","updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){c.Logger.debug("RemoteSdp","updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObjectArr:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:n,codecOptions:i,extmapAllowMixed:o=!1}){e.length&&e.forEach(((e,a)=>{if(!e)return;const s=new u.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:n,codecOptions:i?i[a]:void 0,extmapAllowMixed:o});t?this._replaceMediaSection(s,t):this._addMediaSection(s)}))}receive({mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:i,reuseMid:o=null}){const a=this._midToIndex.get(e);let s;void 0!==a&&(s=this._mediaSections[a]),s?(s=new u.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:i}),this._replaceMediaSection(s,e)):(s=new u.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:i}),null===o?this._addMediaSection(s):this._replaceMediaSection(s,o))}disableMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new l.default({code:d.default.NOT_FOUND,message:`no media section found with mid '${e}'`});this._mediaSections[t].disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new l.default({code:d.default.NOT_FOUND,message:`no media section found with mid '${e}'`});const r=this._mediaSections[t];e===this._firstMid&&c.Logger.debug("RemoteSdp","closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),r.close()}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._midToIndex.get(e);if(void 0===r)throw new l.default({code:d.default.NOT_FOUND,message:`no media section found with mid '${e}'`});const n=this._mediaSections[r];n.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(n)}sendSctpAssociation({offerMediaObject:e}){const t=new u.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new u.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,this._sdpObject.media.sort((function(e,t){return e.mid-t.mid})),s.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new l.default({code:d.default.NOT_FOUND,message:`no media section found for reuseMid '${t}'`});const n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new l.default({code:d.default.NOT_FOUND,message:`no media section found with mid '${e.mid}'`});this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}},function(e,t,r){e.exports=d;var n,i=r(10),o=i.LongBits,a=i.base64,s=i.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var p=function(){return i.Buffer?function(){return(d.create=function(){return new n})()}:function(){return new d}};function f(e,t,r){t[r]=255&e}function h(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function g(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=p(),d.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},h.prototype=Object.create(c.prototype),h.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new h((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(m,10,o.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){var t=o.from(e);return this._push(m,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(m,t.length(),t)},d.prototype.bool=function(e){return this._push(f,1,e?1:0)},d.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){var t=o.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var r=d.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},d.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(f,1,0)},d.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d._configure=function(e){n=e,d.create=p(),n._configure()}},function(e,t,r){e.exports=c;var n,i=r(10),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},d=function(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new n(e):l(e)})(e)}:l};function p(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function f(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function h(){if(this.pos+8>this.len)throw s(this,8);return new o(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}c.create=d(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return f(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|f(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=d(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return p.call(this)[t](!1)},uint64:function(){return p.call(this)[t](!0)},sint64:function(){return p.call(this).zzDecode()[t](!1)},fixed64:function(){return h.call(this)[t](!0)},sfixed64:function(){return h.call(this)[t](!1)}})}},function(e,t,r){e.exports=y;var n=r(43);((y.prototype=Object.create(n.prototype)).constructor=y).className="Type";var i=r(8),o=r(44),a=r(24),s=r(82),c=r(83),u=r(85),l=r(80),d=r(79),p=r(4),f=r(136),h=r(137),m=r(138),g=r(139),v=r(140);function y(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(y.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=p.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=p.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=y.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,p.merge(e.prototype,t)),e.$type=e.prototype.$type=this,p.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:p.oneOfGetter(this._oneofsArray[r].oneof),set:p.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),y.generateConstructor=function(e){for(var t,r=p.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",p.safeProp(t.name)):t.repeated&&r("this%s=[]",p.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},y.fromJSON=function(e,t){var r=new y(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),l=0;l<u.length;++l)r.add((void 0!==t.fields[u[l]].keyType?s.fromJSON:a.fromJSON)(u[l],t.fields[u[l]]));if(t.oneofs)for(u=Object.keys(t.oneofs),l=0;l<u.length;++l)r.add(o.fromJSON(u[l],t.oneofs[u[l]]));if(t.nested)for(u=Object.keys(t.nested),l=0;l<u.length;++l){var d=t.nested[u[l]];r.add((void 0!==d.id?a.fromJSON:void 0!==d.fields?y.fromJSON:void 0!==d.values?i.fromJSON:void 0!==d.methods?c.fromJSON:n.fromJSON)(u[l],d))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r},y.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&Boolean(e.keepComments);return p.toObject(["options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},y.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return n.prototype.resolveAll.call(this)},y.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},y.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof o?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},y.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof o){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},y.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},y.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},y.prototype.create=function(e){return new this.ctor(e)},y.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=f(this)({Writer:d,types:t,util:p}),this.decode=h(this)({Reader:l,types:t,util:p}),this.verify=m(this)({types:t,util:p}),this.fromObject=g.fromObject(this)({types:t,util:p}),this.toObject=g.toObject(this)({types:t,util:p});var n=v[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},y.prototype.encode=function(e,t){return this.setup().encode(e,t)},y.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},y.prototype.decode=function(e,t){return this.setup().decode(e,t)},y.prototype.decodeDelimited=function(e){return e instanceof l||(e=l.create(e)),this.decode(e,e.uint32())},y.prototype.verify=function(e){return this.setup().verify(e)},y.prototype.fromObject=function(e){return this.setup().fromObject(e)},y.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},y.d=function(e){return function(t){p.decorateType(t,e)}}},function(e,t,r){e.exports=a;var n=r(24);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=r(30),o=r(4);function a(e,t,r,i,a,s){if(n.call(this,e,t,i,void 0,void 0,a,s),!o.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=o.decorateType(r).name:r&&"object"==typeof r&&(r=o.decorateEnum(r).name),function(n,i){o.decorateType(n.constructor).add(new a(i,e,t,r))}}},function(e,t,r){e.exports=s;var n=r(43);((s.prototype=Object.create(n.prototype)).constructor=s).className="Service";var i=r(84),o=r(4),a=r(134);function s(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function c(e){return e._methodsArray=null,e}s.fromJSON=function(e,t){var r=new s(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),o=0;o<n.length;++o)r.add(i.fromJSON(n[o],t.methods[n[o]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r},s.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&Boolean(e.keepComments);return o.toObject(["options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(s.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=o.toArray(this.methods))}}),s.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},s.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return n.prototype.resolve.call(this)},s.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,c(this)):n.prototype.add.call(this,e)},s.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,c(this)}return n.prototype.remove.call(this,e)},s.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),s=0;s<this.methodsArray.length;++s){var c=o.lcFirst((n=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[c]=o.codegen(["r","c"],o.isReserved(c)?c+"_":c)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},function(e,t,r){e.exports=o;var n=r(29);((o.prototype=Object.create(n.prototype)).constructor=o).className="Method";var i=r(4);function o(e,t,r,o,a,s,c,u,l){if(i.isObject(a)?(c=a,a=s=void 0):i.isObject(s)&&(c=s,s=void 0),void 0!==t&&!i.isString(t))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(o))throw TypeError("responseType must be a string");n.call(this,e,c),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=o,this.responseStream=!!s||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=l}o.fromJSON=function(e,t){return new o(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},function(e,t,r){e.exports=i;var n=r(10);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},function(e,t,r){e.exports=d;var n=r(43);((d.prototype=Object.create(n.prototype)).constructor=d).className="Root";var i,o,a,s=r(24),c=r(8),u=r(44),l=r(4);function d(e){n.call(this,"",e),this.deferred=[],this.files=[]}function p(){}d.fromJSON=function(e,t){return t||(t=new d),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},d.prototype.resolvePath=l.path.resolve,d.prototype.fetch=l.fetch,d.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var i=this;if(!n)return l.asPromise(e,i,t,r);var s=n===p;function c(e,t){if(n){var r=n;if(n=null,s)throw e;r(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in a)return r}return null}function d(e,t){try{if(l.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),l.isString(t)){o.filename=e;var n,a=o(t,i,r),d=0;if(a.imports)for(;d<a.imports.length;++d)(n=u(a.imports[d])||i.resolvePath(e,a.imports[d]))&&f(n);if(a.weakImports)for(d=0;d<a.weakImports.length;++d)(n=u(a.weakImports[d])||i.resolvePath(e,a.weakImports[d]))&&f(n,!0)}else i.setOptions(t.options).addJSON(t.nested)}catch(e){c(e)}s||h||c(null,i)}function f(e,t){if(!(i.files.indexOf(e)>-1))if(i.files.push(e),e in a)s?d(e,a[e]):(++h,setTimeout((function(){--h,d(e,a[e])})));else if(s){var r;try{r=l.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||c(e))}d(e,r)}else++h,i.fetch(e,(function(r,o){--h,n&&(r?t?h||c(null,i):c(r):d(e,o))}))}var h=0;l.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=i.resolvePath("",t[g]))&&f(m);if(s)return i;h||c(null,i)},d.prototype.loadSync=function(e,t){if(!l.isNode)throw Error("not supported");return this.load(e,t,p)},d.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return n.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function h(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new s(t.fullName,t.id,t.type,t.rule,void 0,t.options);return n.declaringField=t,t.extensionField=n,r.add(n),!0}return!1}d.prototype._handleAdd=function(e){if(e instanceof s)void 0===e.extend||e.extensionField||h(0,e)||this.deferred.push(e);else if(e instanceof c)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof i)for(var t=0;t<this.deferred.length;)h(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);f.test(e.name)&&(e.parent[e.name]=e)}},d.prototype._handleRemove=function(e){if(e instanceof s){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof c)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof n){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);f.test(e.name)&&delete e.parent[e.name]}},d._configure=function(e,t,r){i=e,o=t,a=r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Program=void 0;const n=r(269),i=r(270),o=r(54),a=r(271);t.Program=class{constructor(e,t){this.shaders={},this.uniforms={},this.attributes={},this.gl=e,this.draw=t,this._program=e.createProgram(),this.setShader(a.defaultShader.vShader,"VERTEX"),this.setShader(a.defaultShader.fShader,"FRAGMENT")}get program(){return this._program||console.error("program create error."),this._program}parseUniforms(){const e=i.parseUniforms(this.gl,this.program);for(const t in e)t in this.uniforms&&e[t].setter(this.uniforms[t].value);this.uniforms=e}parseAttributes(){const e=this.gl,t=o.parseAttributes(this.gl,this.program);for(const r in this.attributes){const n=this.attributes[r];if(r in t){const e=n.attributeBuffer;e&&t[r].bufferSetter(e)}else e.deleteBuffer(n.buffer)}this.attributes=t}get count(){const e=this.attributes;let t=-1;for(const r in e){const n=e[r];-1!==t&&t!==n.count&&console.warn("inconsistent attribute length."),t=Math.max(t,n.count)}return t}setShader(e,t){const r=this.gl,i=this.program,o=n.createShader(r,e,t);if(o){const e=this.shaders[t];e&&(r.detachShader(i,e),r.deleteShader(e)),r.attachShader(i,o),this.shaders[t]=o,this.shaders.VERTEX&&this.shaders.FRAGMENT&&(r.linkProgram(i),this.parseUniforms(),this.parseAttributes())}else"VERTEX"===t?this.setShader(a.defaultShader.vShader,"VERTEX"):this.setShader(a.defaultShader.fShader,"FRAGMENT")}getUniform(e){var t;const r=null!==(t=this.uniforms[e])&&void 0!==t?t:null;return r||console.warn(`uniform:[${e}] does not exist.`),r}setUniform(e,t){var r;null===(r=this.getUniform(e))||void 0===r||r.setter(t)}updateUniform(e,t){var r;const n=this.getUniform(e);null==n||n.setter(null!==(r=t(n.value))&&void 0!==r?r:n.value)}setAttributeBuffer(e){var t;e&&(null===(t=this.getAttribute(e.name))||void 0===t||t.bufferSetter(e))}getAttribute(e){return this.attributes[e]||console.warn(`attribute:[${e}] does not exist.`),this.attributes[e]}setAttribute(e,t){var r;null===(r=this.getAttribute(e))||void 0===r||r.setter(t)}updateAttribute(e,t){var r;const n=this.getAttribute(e);null==n||n.setter(null!==(r=t(n.typedArray))&&void 0!==r?r:n.typedArray)}render(){const e=this.gl,t=this.program;e.useProgram(t);const r=this.uniforms;for(const e in r)r[e].setter();this.draw?this.draw.handler(...this.draw.args):e.drawArrays(e.TRIANGLE_STRIP,0,this.count)}destroy(){var e,t;const r=this.gl;for(const e in this.attributes){const t=this.attributes[e];t&&r.deleteBuffer(t.buffer)}r.deleteShader(null!==(e=this.shaders.VERTEX)&&void 0!==e?e:null),r.deleteShader(null!==(t=this.shaders.FRAGMENT)&&void 0!==t?t:null),r.deleteProgram(this.program)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.typedArray=void 0,t.typedArray={posArray:new Float32Array([-1,1,-1,-1,1,1,1,-1]),uvArray:new Float32Array([0,1,0,0,1,1,1,0])}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.baseTextureShader=void 0,t.baseTextureShader={vShader:"\n    attribute vec4 position;\n    attribute vec2 uv;\n    varying vec2 vuv;\n    void main() {\n        gl_Position = position;\n        vuv = uv;\n    }\n",fShader:"\n    precision mediump float;\n\n    uniform sampler2D map;\n    varying vec2 vuv;\n    void main() {\n        gl_FragColor = texture2D(map, vuv);\n    }\n"}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NERTC=void 0;const i=r(144),o=r(263),a=r(27),s=r(278),c=r(95),u=r(25),l=r(45),d=r(279),p=r(280),f=r(15),h=r(17),m=r(122),g=n(r(26)),v=n(r(1)),y=n(r(0)),b=r(2),S=r(34),_=r(281);let M;t.NERTC={Logger:{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,setLogLevel(e){M&&M.apiFrequencyControl({name:"setLogLevel",code:0,param:{clientUid:M.adapterRef.channelInfo.uid||"",level:e}}),g.default.setLogLevel(e)},enableLogUpload(){M&&M.apiFrequencyControl({name:"enableLogUpload",code:0,param:{clientUid:M.adapterRef.channelInfo.uid||""}}),g.default.enableLogUpload()},disableLogUpload(){M&&M.apiFrequencyControl({name:"disableLogUpload",code:0,param:{clientUid:M.adapterRef.channelInfo.uid||""}}),g.default.disableLogUpload()}},createClient(e){f.checkExists({tag:"createClient:ClientOptions",value:e}),f.checkExists({tag:"createClient:ClientOptions.appkey",value:e.appkey});const r=new i.Client(Object.assign(e,{apiList:[],ref:t.NERTC}));return b.getParameters().clients.push(r),M||(M=r),_.pluginManager.safeEmit("client-created",{client:r}),r},createStream(e){if(f.checkExists({tag:"createStream:options",value:e}),e.screenAudio&&!e.screen)throw new v.default({code:y.default.INVALID_OPERATION,message:"createStream:screenAudio要与screen一起开启"});if(!e.client&&M&&M.adapterRef.logger.warn("createStream: 未传入client参数。使用默认Client。"),M||e.client){const t=new o.LocalStream(Object.assign(e,{isRemote:!1,client:e.client||M}));return b.getParameters().localStreams.push(t),_.pluginManager.emit("stream-created",{localStream:t}),t}return s.clientNotYetUninitialized},Device:a.Device,getDevices:(e=!1)=>a.Device.getDevices({audioinput:!0,audiooutput:!0,videoinput:!0,requestPerm:e}),getCameras:(e=!1)=>a.Device.getCameras(e),getMicrophones:(e=!1)=>a.Device.getMicrophones(e),getSpeakers:(e=!1)=>a.Device.getSpeakers(e),checkSystemRequirements:()=>window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection?navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?window.WebSocket?!!S.isBrowserSupported()||(console.warn("checkSystemRequirements: 不支持的浏览器。当前的 UserAgent为 "+navigator.userAgent),!1):(console.warn("checkSystemRequirements: 没有 WebSocket 对象。"),!1):(console.warn("checkSystemRequirements: 没有 getUserMedia 方法。请检查https是否启用。"),!1):(console.warn("checkSystemRequirements: 没有 RTCPeerConnection 对象。"),!1),getSupportedCodec:async()=>await h.getSupportedCodecs(),getHandler:()=>m.detectDevice(),getParameters:b.getParameters,destroy(e){let t=e||M;t&&t.destroy(),e||(M=null)},pluginManager:_.pluginManager,PlatformTypeMap:c.PlatformTypeMap,CHAT_VIDEO_FRAME_RATE_NORMAL:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,CHAT_VIDEO_FRAME_RATE_5:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5,CHAT_VIDEO_FRAME_RATE_10:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_10,CHAT_VIDEO_FRAME_RATE_15:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_15,CHAT_VIDEO_FRAME_RATE_20:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_20,CHAT_VIDEO_FRAME_RATE_25:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25,VIDEO_QUALITY_180p:l.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_180p,VIDEO_QUALITY_480p:l.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p,VIDEO_QUALITY_720p:l.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_720p,VIDEO_QUALITY_1080p:l.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p,RECORD_VIDEO_QUALITY_360p:l.NERTC_RECORD_VIDEO_QUALITY.RECORD_VIDEO_QUALITY_360p,RECORD_VIDEO_QUALITY_480p:l.NERTC_RECORD_VIDEO_QUALITY.RECORD_VIDEO_QUALITY_480p,RECORD_VIDEO_QUALITY_720p:l.NERTC_RECORD_VIDEO_QUALITY.RECORD_VIDEO_QUALITY_720p,RECORD_VIDEO_FRAME_RATE_15:l.NERTC_RECORD_VIDEO_FRAME_RATE.RECORD_VIDEO_FRAME_RATE_15,RECORD_VIDEO_FRAME_RATE_30:l.NERTC_RECORD_VIDEO_FRAME_RATE.RECORD_VIDEO_FRAME_RATE_30,LIVE_STREAM_AUDIO_CODEC_PROFILE:d.LIVE_STREAM_AUDIO_CODEC_PROFILE,LIVE_STREAM_AUDIO_SAMPLE_RATE:d.LIVE_STREAM_AUDIO_SAMPLE_RATE,VIDEO_FRAME_RATE:l.VIDEO_FRAME_RATE,VIDEO_QUALITY:l.NERTC_VIDEO_QUALITY,NETWORK_STATUS:p.NETWORK_STATUS,STREAM_TYPE:l.STREAM_TYPE,VERSION:u.SDK_VERSION,BUILD:u.BUILD,ENV:u.ENV},e.exports=t.NERTC,window.WebRTC2=t.NERTC},function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Play=void 0;const i=r(3),o=n(r(1)),a=n(r(0)),s=r(2),c=r(31),u=r(155),l=r(156);class d extends i.EventEmitter{constructor(e){super(),this.videoSize={width:0,height:0},this.screenSize={width:0,height:0},this.mask={enabled:!1},this._reset(),this.stream=e.stream,this.logger=e.stream.logger.getChild((()=>{var e;let t="player";return(null===(e=this.audioDom)||void 0===e?void 0:e.paused)&&(t+=" audio_paused"),this.stream._play!==this&&(t+=" DETACHED"),t})),this.videoDom=null,this.screenDom=null,this.audioDom=null,this.videoContainerDom=null,this.screenContainerDom=null,this.videoView=null,this.screenView=null,this.volume=null,this.index=0,this.videoRenderMode={width:0,height:0,cut:!1},this.screenRenderMode={width:0,height:0,cut:!1},this.audioSinkId="",this.watermark={video:{canvasControl:u.createCanvasWatermarkControl(this.logger),encoderControl:l.createEncoderWatermarkControl(this.logger)},screen:{canvasControl:u.createCanvasWatermarkControl(this.logger),encoderControl:l.createEncoderWatermarkControl(this.logger)}},this.autoPlayType=0}_reset(){this.videoDom=null,this.screenDom=null,this.videoContainerDom=null,this.screenContainerDom=null,this.videoView=null,this.screenView=null,this.audioDom=null,this.volume=null,this.index=0,this.videoRenderMode={width:0,height:0,cut:!1},this.screenRenderMode={width:0,height:0,cut:!1}}_initNodeVideo(e){if(this._initVideoContainer(e),this._initVideo(),this.videoDom&&this.videoContainerDom){if(this.videoContainerDom==this.videoDom.parentNode)return void this.logger.log("Play: _initVideoNode: 节点已挂载，请勿重复挂载");this.videoContainerDom.appendChild(this.videoDom),this.logger.log("Play: _initVideoNode, videoContainerDom: ",this.videoContainerDom.outerHTML)}}_initNodeScreen(){if(this._initScreenContainer(),this._initScreen(),this.screenDom&&this.screenContainerDom){if(this.screenContainerDom==this.screenDom.parentNode)return void this.logger.log("Play: _initscreenNode: 节点已挂载，请勿重复挂载");this.screenContainerDom.appendChild(this.screenDom),this.logger.log("Play: _initscreenNode, screenContainerDom: ",this.screenContainerDom.outerHTML)}}_initVideoContainer(e){this.videoView&&(this.videoContainerDom||(this.videoContainerDom=document.createElement("div"),this.videoContainerDom.className="local"===e?"nertc-video-container-local":"nertc-video-container-remote",this.videoContainerDom.style.overflow="hidden",this.videoContainerDom.style.position="relative",this.videoContainerDom.style.width=this.videoView.clientWidth+"px",this.videoContainerDom.style.height=this.videoView.clientHeight+"px",this.videoContainerDom.style.display="inline-block"))}_initScreenContainer(){this.screenContainerDom||(this.screenContainerDom=document.createElement("div"),this.screenContainerDom.className="nertc-screen-container",this.screenContainerDom.style.overflow="hidden",this.screenContainerDom.style.position="relative",this.screenContainerDom.style.width=this.screenRenderMode.width+"px",this.screenContainerDom.style.height=this.screenRenderMode.height+"px",this.screenContainerDom.style.display="inline-block")}_initVideo(){this.videoDom||(this.videoDom=document.createElement("video"),this.videoDom.style.position="absolute",this.videoDom.style.left="50%",this.videoDom.style.top="50%",this.videoDom.style.transform="translate(-50%,-50%)",this.videoDom.setAttribute("x-webkit-airplay","x-webkit-airplay"),this.videoDom.setAttribute("playsinline","playsinline"),this.videoDom.setAttribute("webkit-playsinline","webkit-playsinline"),this.videoDom.preload="auto",this.videoDom.dataset.uid=""+this.stream.getId(),this.videoDom.autoplay=!0,this.videoDom.muted=!0,this.videoSize.width=0,this.videoSize.height=0,this.videoDom.addEventListener("resize",(e=>{if(!this.videoDom||this.videoDom!==e.target)return;const t=this.videoDom.videoWidth,r=this.videoDom.videoHeight;t===this.videoSize.width&&r===this.videoSize.height||(this.logger.log(`主流视频分辨率发生变化：${this.videoSize.width}x${this.videoSize.height} => ${t}x${r}。当前父节点：${c.getDomInfo(this.videoView)}`),t>r&&this.videoSize.width>this.videoSize.height||t<r&&this.videoSize.width<this.videoSize.height||this.setVideoRender(),this.videoSize.width=t,this.videoSize.height=r)})),s.getParameters().controlOnPaused&&(this.videoDom.addEventListener("pause",this.showControlIfVideoPause.bind(this)),this.videoDom.addEventListener("play",this.handleVideoScreenPlay.bind(this)),this.videoDom.addEventListener("click",this.handleVideoScreenClick.bind(this))))}showControlIfVideoPause(){this.videoDom&&this.videoDom.paused&&(this.logger.log("可能遇到了自动播放问题，展示默认控件:","video"),this.videoDom.setAttribute("controls","controls")),this.screenDom&&this.screenDom.paused&&(this.logger.log("可能遇到了自动播放问题，展示默认控件:","screen"),this.screenDom.setAttribute("controls","controls"))}handleVideoScreenClick(){this.audioDom&&this.audioDom.paused&&(this.logger.log("侦测到视频点击，尝试恢复音频播放"),this.audioDom.play())}handleVideoScreenPlay(){this.videoDom&&!this.videoDom.paused&&this.videoDom.hasAttribute("controls")&&(this.logger.log("侦测到视频播放，隐藏默认控件:"),this.videoDom.removeAttribute("controls")),this.screenDom&&!this.screenDom.paused&&this.screenDom.hasAttribute("controls")&&(this.logger.log("侦测到辅流播放，隐藏默认控件:"),this.screenDom.removeAttribute("controls"))}_initScreen(){this.screenDom||(this.screenDom=document.createElement("video"),this.screenDom.style.position="absolute",this.screenDom.style.left="50%",this.screenDom.style.top="50%",this.screenDom.style.transform="translate(-50%,-50%)",this.screenDom.setAttribute("x-webkit-airplay","x-webkit-airplay"),this.screenDom.setAttribute("playsinline","playsinline"),this.screenDom.setAttribute("webkit-playsinline","webkit-playsinline"),this.screenDom.preload="auto",this.screenDom.dataset.uid=""+this.stream.getId(),this.screenDom.autoplay=!0,this.screenDom.muted=!0,this.screenSize.width=0,this.screenSize.height=0,this.screenDom.addEventListener("resize",(e=>{if(!this.screenDom||this.screenDom!==e.target)return;const t=this.screenDom.videoWidth,r=this.screenDom.videoHeight;t===this.screenSize.width&&r===this.screenSize.height||(this.logger.log(`辅流视频分辨率发生变化：${this.screenSize.width}x${this.screenSize.height} => ${t}x${r}`),t>r&&this.screenSize.width>this.screenSize.height||t<r&&this.screenSize.width<this.screenSize.height||this.setScreenRender(),this.screenSize.width=t,this.screenSize.height=r)})),s.getParameters().controlOnPaused&&(this.screenDom.addEventListener("pause",this.showControlIfVideoPause.bind(this)),this.screenDom.addEventListener("play",this.handleVideoScreenPlay.bind(this)),this.screenDom.addEventListener("click",this.handleVideoScreenClick.bind(this))))}_removeUselessDom(){if(this.videoView)for(var e=this.videoView.children.length-1;e>=0;e--)this.videoView.children[e].outerHTML.indexOf("data-uid=")&&(this.logger.log("删除多余的节点: ",this.videoView.children[e].outerHTML),this.videoView.removeChild(this.videoView.children[e]))}_mountVideoToDom(){if(this.videoContainerDom){if(this.videoView==this.videoContainerDom.parentNode)return void this.logger.log("Play: _mountVideoToDom: 节点已挂载，请勿重复挂载");this.logger.log("Play: _mountVideoToDom: videoContainerDom: ",this.videoContainerDom.outerHTML),this.videoView&&(this.videoView.appendChild(this.videoContainerDom),this.logger.log("视频主流dom节点挂载成功。父节点："+c.getDomInfo(this.videoView)),this.watermark.video.canvasControl.watermarks.length?this.watermark.video.canvasControl.start(this.videoContainerDom):this.watermark.video.canvasControl.div=this.videoContainerDom)}}_mountScreenToDom(){if(this.screenContainerDom){if(this.screenView==this.screenContainerDom.parentNode)return void this.logger.log("Play: _mountScreenToDom: 节点已挂载，请勿重复挂载");this.logger.log("Play: _mountScreenToDom: screenContainerDom: ",this.screenContainerDom.outerHTML),this.screenView&&(this.screenView.appendChild(this.screenContainerDom),this.logger.log("视频辅流dom节点挂载成功。父节点："+c.getDomInfo(this.screenView)),this.watermark.screen.canvasControl.watermarks.length?this.watermark.screen.canvasControl.start(this.screenContainerDom):this.watermark.screen.canvasControl.div=this.screenContainerDom)}}async resume(){const e=this.audioDom&&this.audioDom.paused,t=this.videoDom&&this.videoDom.paused,r=this.screenDom&&this.screenDom.paused,n=[];this.audioDom&&this.audioDom.paused&&n.push(this.audioDom.play()),this.videoDom&&this.videoDom.paused&&n.push(this.videoDom.play()),this.screenDom&&this.screenDom.paused&&n.push(this.screenDom.play());try{await Promise.all(n)}catch(e){if(this.logger.error("恢复播放 出现问题:",e.name,e.message),"notAllowedError"===e.name||"NotAllowedError"===e.name)throw new o.default({code:a.default.AUTO_PLAY_NOT_ALLOWED,message:e.message})}e&&this.logger.log("恢复播放音频"+(this.audioDom&&!this.audioDom.paused?"成功":"失败")),t&&this.logger.log("恢复播放视频"+(this.videoDom&&!this.videoDom.paused?"成功":"失败")),r&&this.logger.log("恢复播放辅流"+(this.screenDom&&!this.screenDom.paused?"成功":"失败"))}async playAudioStream(e,t){if(e){if(this.audioDom||(this.audioDom=document.createElement("audio")),this.audioDom.muted=!!t,this.audioDom.srcObject=e,this.audioSinkId&&e.getAudioTracks().length)try{this.logger.log("音频尝试使用输出设备",this.audioSinkId),await this.audioDom.setSinkId(this.audioSinkId),this.logger.log("音频使用输出设备成功",this.audioSinkId)}catch(e){this.logger.error("音频输出设备切换失败",e.name,e.message,e)}if(e.active){await this.isPlayAudioStream()&&this.logger.log("音频播放正常");try{this.audioDom.muted=!1,await this.audioDom.play(),this.logger.log("播放音频完成，当前播放状态:",this.audioDom&&this.audioDom.played&&this.audioDom.played.length),this.stream.client.updateRecordingAudioStream()}catch(e){if(this.logger.warn("播放音频出现问题: ",e.name,e.message,e),"notAllowedError"===e.name||"NotAllowedError"===e.name)throw this.autoPlayType=1,new o.default({code:a.default.AUTO_PLAY_NOT_ALLOWED,message:e.toString(),url:"https://doc.yunxin.163.com/docs/jcyOTA0ODM/jM3NDE0NTI?platformId=50082"})}}}}async stopPlayAudioStream(){this.audioDom&&(this.audioDom.muted=!0)}setPlayVolume(e){this.volume=e,this.audioDom&&(this.audioDom.volume=e/255)}async isPlayAudioStream(){var e;const t=async e=>{if(e&&await new Promise((t=>{setTimeout(t,e)})),this.audioDom){let e=this.audioDom.played.length;return e>=1?this.audioDom.played.end(e-1):0}return 0};if(!(null===(e=this.audioDom)||void 0===e?void 0:e.srcObject)||this.audioDom.paused)return!1;const r=await t(0);if(!r)return!1;for(let e=0;e<3e3;e+=50)if(await t(50)>r)return!0;return!1}async isPlayVideoStream(){var e;const t=async e=>{var t;e&&await new Promise((t=>{setTimeout(t,e)}));const r=null===(t=this.videoDom)||void 0===t?void 0:t.getVideoPlaybackQuality();return r?r.totalVideoFrames:0};if(!(null===(e=this.videoDom)||void 0===e?void 0:e.srcObject)||this.videoDom.paused)return!1;const r=await t(0);if(!r)return!1;for(let e=0;e<3e3;e+=50)if(await t(50)>r)return!0;return!1}async isPlayScreenStream(){var e;const t=async e=>{var t;e&&await new Promise((t=>{setTimeout(t,e)}));const r=null===(t=this.screenDom)||void 0===t?void 0:t.getVideoPlaybackQuality();return r?r.totalVideoFrames:0};if(!(null===(e=this.screenDom)||void 0===e?void 0:e.srcObject)||this.screenDom.paused)return!1;const r=await t(0);if(!r)return!1;for(let e=0;e<3e3;e+=50)if(await t(50)>r)return!0;return!1}async isPlayStreamError(e){switch(e){case"audio":return this.isPlayAudioStream();case"video":return this.isPlayVideoStream();case"screen":return this.isPlayScreenStream();default:return!0}}async playVideoStream(e,t,r){var n;if(e&&t)if((null===(n=this.videoDom)||void 0===n?void 0:n.srcObject)!==e)if(this.videoView=t,this._initNodeVideo(r),this._mountVideoToDom(),this.videoDom){this.mask.enabled&&this.enableMask();try{const t=e.getVideoTracks()[0];t?this.logger.log(`开始加载主流播放视频源：视频参数 "${t.label}",enabled ${t.enabled} , ${JSON.stringify(t.getSettings())}`):this.logger.error("加载主流播放视频源失败：没有视频源"),this.videoDom.srcObject=e,this.videoDom.play().then((()=>{var e,t,r,n,i;this.logger.log(`成功加载主流播放视频源：当前视频实际分辨率${null===(e=this.videoDom)||void 0===e?void 0:e.videoWidth}x${null===(t=this.videoDom)||void 0===t?void 0:t.videoHeight}，显示宽高${null===(r=this.videoDom)||void 0===r?void 0:r.offsetWidth}x${null===(n=this.videoDom)||void 0===n?void 0:n.offsetHeight}`),(null===(i=this.videoDom)||void 0===i?void 0:i.paused)&&s.getParameters().controlOnPaused&&this.showControlIfVideoPause()})).catch((e=>{"AbortError"===e.name||console.error(e)}))}catch(e){if(this.logger.warn("播放视频出现问题:",e.name,e.message,e),"notAllowedError"===e.name||"NotAllowedError"===e.name)throw this.autoPlayType=2,new o.default({code:a.default.AUTO_PLAY_NOT_ALLOWED,message:e.toString(),url:"https://doc.yunxin.163.com/docs/jcyOTA0ODM/jM3NDE0NTI?platformId=50082"})}}else this.logger.error("没有视频源");else this.logger.log("playVideoStream：跳过重复的播放请求")}async playScreenStream(e,t){var r;if(e&&t)if((null===(r=this.screenDom)||void 0===r?void 0:r.srcObject)!==e)if(this.logger.log(`播放辅流视频, id: ${e.id}, active state: ${e.active}`),this.screenView=t,this._initNodeScreen(),this._mountScreenToDom(),this.screenDom){this.mask.enabled&&this.enableMask();try{const t=e.getVideoTracks()[0];t?this.logger.log(`开始加载辅流播放视频源：视频参数 "${t.label}",enabled ${t.enabled} , ${JSON.stringify(t.getSettings())}`):this.logger.error("加载主流播放视频源失败：没有视频源"),this.screenDom.srcObject=e,this.screenDom.play().then((()=>{var e,t,r,n,i;this.logger.log(`成功加载辅流播放视频源：当前视频实际分辨率${null===(e=this.screenDom)||void 0===e?void 0:e.videoWidth}x${null===(t=this.screenDom)||void 0===t?void 0:t.videoHeight}，显示宽高${null===(r=this.screenDom)||void 0===r?void 0:r.offsetWidth}x${null===(n=this.screenDom)||void 0===n?void 0:n.offsetHeight}`),(null===(i=this.screenDom)||void 0===i?void 0:i.paused)&&s.getParameters().controlOnPaused&&this.showControlIfVideoPause()}))}catch(e){this.logger.warn("播放辅流出现问题: ",e.name,e.message,e)}}else this.logger.error("辅流没有视频源");else this.logger.log("playScreenStream：跳过重复的播放请求")}async stopPlayVideoStream(){if(this.logger.log("stopPlayVideoStream 停止播发视频"),this.videoContainerDom&&this.videoDom){this.videoContainerDom==this.videoDom.parentNode?(this.logger.log("清除 videoDom"),this.videoContainerDom.removeChild(this.videoDom)):this.videoContainerDom.lastChild&&(this.logger.log("videoContainerDom 删除子节点"),this.videoContainerDom.removeChild(this.videoContainerDom.lastChild));try{this.videoDom.remove(),this.videoDom.srcObject=null,this.videoDom=null}catch(e){this.logger.log("stopPlayVideoStream e: ",e)}}this.videoView&&this.videoContainerDom&&(this.videoView==this.videoContainerDom.parentNode?(this.logger.log("清除 videoContainerDom"),this.videoView.removeChild(this.videoContainerDom)):this.videoView.lastChild&&(this.logger.log("videoView 删除子节点"),this.videoView.removeChild(this.videoView.lastChild),this.videoView.innerHTML=""),this.videoContainerDom=null,this.videoView=null)}async stopPlayScreenStream(){if(this.logger.log("stopPlayScreenStream: 停止播发屏幕共享"),this.screenContainerDom&&this.screenDom){this.screenContainerDom.removeChild(this.screenDom);try{this.screenDom.remove(),this.screenDom.srcObject=null,this.screenDom=null}catch(e){this.logger.log("stopPlayScreenStream: 停止播发屏幕共享",e.name,e.message)}}this.screenView&&this.screenContainerDom&&(this.screenView.removeChild(this.screenContainerDom),this.screenContainerDom=null,this.screenView=null)}setVideoRender(e){if(this.videoDom)return e?(this.logger.log("setVideoRender options: "+JSON.stringify(e)),this.videoRenderMode=Object.assign({},e)):(e=this.videoRenderMode,this.logger.log("setVideoRender: existing videoRenderMode: "+JSON.stringify(e))),this.videoContainerDom?(this.videoContainerDom.style.width=e.width+"px",this.videoContainerDom.style.height=e.height+"px"):this.logger.error("未找到videoContainerDom"),e.cut?void(this.videoDom.videoWidth/this.videoDom.videoHeight>e.width/e.height?(this.videoDom.style.width="auto",this.videoDom.style.height="100%"):(this.videoDom.style.width="100%",this.videoDom.style.height="auto")):(this.videoDom.style.height="100%",void(this.videoDom.style.width="100%"))}setScreenRender(e){if(this.screenDom)return e?(this.logger.log("setScreenRender: options: ",JSON.stringify(e,null," ")),this.screenRenderMode=Object.assign({},e)):(e=this.screenRenderMode,this.logger.log("setScreenRender, existing screenRenderMode: "+JSON.stringify(e))),this.screenRenderMode=e,this.screenContainerDom?(this.screenContainerDom.style.width=e.width+"px",this.screenContainerDom.style.height=e.height+"px"):this.logger.error("未找到screenContainerDom"),e.cut?void(this.screenDom.videoWidth/this.screenDom.videoHeight>e.width/e.height?(this.screenDom.style.width="auto",this.screenDom.style.height="100%"):(this.screenDom.style.width="100%",this.screenDom.style.height="auto")):(this.screenDom.style.height="100%",void(this.screenDom.style.width="100%"))}async setAudioOutput(e){var t,r;this.audioSinkId=e,(null===(t=this.audioDom)||void 0===t?void 0:t.srcObject)&&(null===(r=this.audioDom)||void 0===r?void 0:r.srcObject).getAudioTracks().length&&(await this.audioDom.setSinkId(e),this.logger.log("设置通话音频输出设备成功"))}async takeSnapshot(e,t){let r=!e.mediaType&&this.videoDom||"video"===e.mediaType,n=!e.mediaType&&this.screenDom||"screen"===e.mediaType,i=document.createElement("canvas"),s=i.getContext("2d");if(!s)throw new o.default({code:a.default.NOT_FOUND,message:"no context of canvas"});if(r){const r=e.name||(t||this.stream.getId())+"-"+this.index++;if(s.fillStyle="#ffffff",!this.videoDom)throw new o.default({code:a.default.NOT_FOUND,message:"no videoDom"});s.fillRect(0,0,this.videoDom.videoWidth,this.videoDom.videoHeight),i.width=this.videoDom.videoWidth,i.height=this.videoDom.videoHeight,s.drawImage(this.videoDom,0,0,this.videoDom.videoWidth,this.videoDom.videoHeight,0,0,this.videoDom.videoWidth,this.videoDom.videoHeight);const c=await new Promise(((e,t)=>{i.toBlob((t=>{this.logger.log("takeSnapshot, 获取到截图的blob: ",t);let n=URL.createObjectURL(t);this.logger.log("截图的url: ",n);let i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=n,i.download=r+".png",i.click(),window.URL.revokeObjectURL(n),e(r+".png")}))}));if(!n)return c}if(n){const r=e.name||(t||this.stream.getId())+"-"+this.index++;if(s.fillStyle="#ffffff",!this.screenDom)throw new o.default({code:a.default.NOT_FOUND,message:"no screenDom"});return s.fillRect(0,0,this.screenDom.videoWidth,this.screenDom.videoHeight),i.width=this.screenDom.videoWidth,i.height=this.screenDom.videoHeight,s.drawImage(this.screenDom,0,0,this.screenDom.videoWidth,this.screenDom.videoHeight,0,0,this.screenDom.videoWidth,this.screenDom.videoHeight),await new Promise(((e,t)=>{i.toBlob((t=>{this.logger.log("takeSnapshot, 获取到截图的blob: ",t);let n=URL.createObjectURL(t);this.logger.log("截图的url: ",n);let i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=n,i.download=r+".png",i.click(),window.URL.revokeObjectURL(n),e(r+".png")}))}))}}takeSnapshotBase64(e){let t=!e.mediaType&&this.videoDom||"video"===e.mediaType,r=!e.mediaType&&this.screenDom||"screen"===e.mediaType,n=document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new o.default({code:a.default.NOT_FOUND,message:"no context of canvas"});if(t){if(i.fillStyle="#ffffff",!this.videoDom)throw new o.default({code:a.default.NOT_FOUND,message:"no videoDom"});i.fillRect(0,0,this.videoDom.videoWidth,this.videoDom.videoHeight),n.width=this.videoDom.videoWidth,n.height=this.videoDom.videoHeight,i.drawImage(this.videoDom,0,0,this.videoDom.videoWidth,this.videoDom.videoHeight,0,0,this.videoDom.videoWidth,this.videoDom.videoHeight);const e=this.getBase64Image(n);if(!r)return e}if(r){if(i.fillStyle="#ffffff",!this.screenDom)throw new o.default({code:a.default.NOT_FOUND,message:"no screenDom"});return i.fillRect(0,0,this.screenDom.videoWidth,this.screenDom.videoHeight),n.width=this.screenDom.videoWidth,n.height=this.screenDom.videoHeight,i.drawImage(this.screenDom,0,0,this.screenDom.videoWidth,this.screenDom.videoHeight,0,0,this.screenDom.videoWidth,this.screenDom.videoHeight),this.getBase64Image(n)}}getBase64Image(e){return e.toDataURL("image/",1)}enableMask(){this.mask.enabled=!0,this.videoDom&&(this.videoDom.style.filter="blur(20px)")}disableMask(){this.mask.enabled=!1,this.videoDom&&(this.videoDom.style.filter=""),this.screenDom&&(this.screenDom.style.filter="")}destroy(){this.stopPlayAudioStream(),this.stopPlayVideoStream(),this.stopPlayScreenStream(),this._reset()}}t.Play=d},function(e,t,r){var n;!function(i){var o,a,s,c=(o=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|'[^']*'|'[^']*'/g,a=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,s=/[^-+\dA-Z]/g,function(e,t,r,n){if(1!==arguments.length||"string"!==p(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var i=(t=String(c.masks[t]||t||c.masks.default)).slice(0,4);"UTC:"!==i&&"GMT:"!==i||(t=t.slice(4),r=!0,"GMT:"===i&&(n=!0));var f=r?"getUTC":"get",h=e[f+"Date"](),m=e[f+"Day"](),g=e[f+"Month"](),v=e[f+"FullYear"](),y=e[f+"Hours"](),b=e[f+"Minutes"](),S=e[f+"Seconds"](),_=e[f+"Milliseconds"](),M=r?0:e.getTimezoneOffset(),T=l(e),w=d(e),x={d:h,dd:u(h),ddd:c.i18n.dayNames[m],dddd:c.i18n.dayNames[m+7],m:g+1,mm:u(g+1),mmm:c.i18n.monthNames[g],mmmm:c.i18n.monthNames[g+12],yy:String(v).slice(2),yyyy:v,h:y%12||12,hh:u(y%12||12),H:y,HH:u(y),M:b,MM:u(b),s:S,ss:u(S),l:u(_,3),L:u(Math.round(_/10)),t:y<12?"a":"p",tt:y<12?"am":"pm",T:y<12?"A":"P",TT:y<12?"AM":"PM",Z:n?"GMT":r?"UTC":(String(e).match(a)||[""]).pop().replace(s,""),o:(M>0?"-":"+")+u(100*Math.floor(Math.abs(M)/60)+Math.abs(M)%60,4),S:["th","st","nd","rd"][h%10>3?0:(h%100-h%10!=10)*h%10],W:T,N:w};return t.replace(o,(function(e){return e in x?x[e]:e.slice(1,e.length-1)}))});function u(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}function l(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=t.getTimezoneOffset()-r.getTimezoneOffset();t.setHours(t.getHours()-n);var i=(t-r)/6048e5;return 1+Math.floor(i)}function d(e){var t=e.getDay();return 0===t&&(t=7),t}function p(e){return null===e?"null":void 0===e?"undefined":"object"!=typeof e?typeof e:Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}c.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},c.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},void 0===(n=function(){return c}.call(t,r,t,e))||(e.exports=n)}()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.measureText=t.numberToRGBA=void 0,t.numberToRGBA=function(e){if(0===e)return"rgba(0,0,0,0)";let t,r,n,i;return n=e%256,r=(e=Math.floor(e/256))%256,t=(e=Math.floor(e/256))%256,i=(e=Math.floor(e/256))>0?(e%256/256).toFixed(2):1,`rgba(${t}, ${r}, ${n}, ${i})`},t.measureText=function(e,t,r){if(!e)return{width:0,height:0};let n=document.createElement("div"),i=document.createElement("span");i.innerText=e,i.style.fontSize=t,i.style.fontFamily=r,n.style.opacity="0",n.style.position="absolute",n.style.height=t,document.body.appendChild(n),n.appendChild(i);const o=n.clientHeight,a=i.offsetWidth;return n.remove(),{width:a,height:o}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformType=t.PlatformTypeMap=void 0,t.PlatformTypeMap={"-1":"unknown",1:"aos",2:"ios",4:"pc",8:"winphone",9:"mac",16:"web"},function(e){e[e.unknown=-1]="unknown",e[e.aos=1]="aos",e[e.ios=2]="ios",e[e.pc=4]="pc",e[e.winphone=8]="winphone",e[e.mac=9]="mac",e[e.web=16]="web"}(t.PlatformType||(t.PlatformType={}))},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHelper=void 0;const s=r(3),c=o(r(32)),u=r(97),l=r(16),d=r(98),p=r(56),f=r(15),h=r(32),m=a(r(1)),g=a(r(0)),v=r(2),y=r(27),b=r(7),S=r(33),_=r(159),M=r(13),T=r(161);class w extends s.EventEmitter{constructor(e){super(),this.audio={audioStream:new MediaStream,audioSourceStream:new MediaStream,musicStream:new MediaStream,micStream:new MediaStream,audioSource:null,micTrack:null,deviceInfo:{mic:{label:""}},webAudio:null,micConstraint:null,mixAudioConf:{index:0,audioBuffer:{},sounds:{}},audioRoutingEnabled:!1},this.video={videoStream:new MediaStream,renderStream:new MediaStream,videoTrackLow:null,cameraTrack:null,cameraConstraint:{video:{}},videoSource:null,preProcessingEnabled:!1,preProcessing:null,captureConfig:{high:{width:640,height:480,frameRate:15}},encoderConfig:{high:{maxBitrate:8e5,contentHint:null},low:{maxBitrate:1e5,contentHint:"motion"}}},this.screen={screenVideoStream:new MediaStream,renderStream:new MediaStream,screenVideoTrackLow:null,screenVideoTrack:null,screenVideoSource:null,preProcessingEnabled:!1,preProcessing:null,captureConfig:{high:{width:1920,height:1080,frameRate:5}},encoderConfig:{high:{maxBitrate:15e5,contentHint:null},low:{maxBitrate:2e5,contentHint:"motion"}}},this.screenAudio={screenAudioStream:new MediaStream,screenAudioTrack:null,screenAudioSource:null},this.listenToTrackEnded=e=>{e&&e.addEventListener("ended",(()=>{this.logger.log("Track ended",e.label,e.id),this.stream===this.stream.client.adapterRef.localStream&&(e!==this.audio.micTrack&&e!==this.audio.audioSource||(this.logger.warn("音频轨道已停止"),this.stream.client.safeEmit("audioTrackEnded")),e!==this.video.cameraTrack&&e!==this.video.videoSource||(this.logger.warn("视频轨道已停止"),this.stream.client.safeEmit("videoTrackEnded")),(e===this.screen.screenVideoTrack||e===this.screen.screenVideoSource||e.label.indexOf("screen")>-1||e.label.indexOf("window")>-1||e.label.indexOf("web-")>-1)&&(this.logger.warn("屏幕共享已停止"),this.stream.client.safeEmit("stopScreenSharing")),e===this.screenAudio.screenAudioTrack&&(this.logger.warn("屏幕共享音频已停止"),this.stream.client.safeEmit("stopScreenAudio")))}))},this.stream=e.stream,this.logger=e.stream.logger.getChild((()=>{var e;let t="mediaHelper";return this.audio.audioRoutingEnabled&&(t+=" WebAudio"),this.audio.webAudio&&(this.audio.webAudio.context&&"running"!==this.audio.webAudio.context.state&&(t+=" "+this.audio.webAudio.context.state),this.audio.webAudio.mixAudioConf.state!==d.AuidoMixingState.UNSTART&&(t+=" "+(null===(e=this.audio.webAudio)||void 0===e?void 0:e.mixAudioConf.state))),this.stream.mediaHelper!==this&&(t+="DETACHED"),t})),this.bindRenderStream(),y.Device.on("recording-device-changed",(e=>{this.audio.micTrack&&this.audio.deviceInfo.mic.deviceId===e.device.deviceId&&("INACTIVE"===e.state?(this.logger.error("当前使用的麦克风设备被移除，需重新启用设备",e.device),this.stream.emit("recording-device-changed",e)):y.Device.deviceHistory.audioIn.find((e=>{e.groupId,this.audio.deviceInfo.mic.groupId}))||(this.logger.error(`当前麦克风已由【${this.audio.deviceInfo.mic.label}】切换至【${e.device.label}】，可能会影响通话质量`),this.audio.deviceInfo.mic.label=e.device.label,this.audio.deviceInfo.mic.groupId=e.device.groupId,this.stream.emit("recording-device-changed",e)))}))}bindRenderStream(){M.IS_SAFARI&&"safari"===v.getParameters().shimLocalCanvas||"all"===v.getParameters().shimLocalCanvas?(this.video.videoStream.onaddtrack=async e=>{if("undefined"!=typeof CanvasCaptureMediaStreamTrack&&e.track instanceof CanvasCaptureMediaStreamTrack){const t=T.pcCloneTrack(e.track);h.watchTrack(t),this.logger.warn("renderStream cloned track for video:",e.track,t),h.emptyStreamWith(this.video.renderStream,t)}else h.emptyStreamWith(this.video.renderStream,e.track)},this.video.videoStream.onremovetrack=e=>{h.emptyStreamWith(this.video.renderStream,null)},this.screen.screenVideoStream.onaddtrack=async e=>{if("undefined"!=typeof CanvasCaptureMediaStreamTrack&&e.track instanceof CanvasCaptureMediaStreamTrack){const t=T.pcCloneTrack(e.track);h.watchTrack(t),this.logger.warn("renderStream cloned track for screen:",e.track,t),h.emptyStreamWith(this.screen.renderStream,t)}else h.emptyStreamWith(this.screen.renderStream,e.track)},this.screen.screenVideoStream.onremovetrack=e=>{h.emptyStreamWith(this.screen.renderStream,null)}):(this.video.renderStream=this.video.videoStream,this.screen.renderStream=this.screen.screenVideoStream)}assertLive(){if(!this.stream.isRemote&&this.stream.destroyed)throw this._reset(),new m.default({code:g.default.INVALID_OPERATION,message:"本地流已经被销毁"})}_reset(){this.stopAllEffects(),this.stream.isRemote||(this.audio.webAudio&&(this.audio.webAudio.off("audioFilePlaybackCompleted"),this.audio.webAudio.destroy()),this.audio.webAudio=null,this.audio.micConstraint=null,this.audio.audioRoutingEnabled=!1,this.audio.micTrack&&(this.audio.micTrack.stop(),this.audio.micTrack=null),this.video.videoTrackLow&&(this.video.videoTrackLow.stop(),this.video.videoTrackLow=null),this.video.videoSource=null,this.video.cameraTrack&&(this.video.cameraTrack.stop(),this.video.cameraTrack=null),this.screen.screenVideoTrack&&(this.screen.screenVideoTrack.stop(),this.screen.screenVideoTrack=null),this.screen.screenVideoTrackLow&&(this.screen.screenVideoTrackLow.stop(),this.screen.screenVideoTrackLow=null),this.video.cameraConstraint={video:{}},this.screenAudio.screenAudioTrack&&(this.screenAudio.screenAudioTrack.stop(),this.screenAudio.screenAudioTrack=null),this.audio.mixAudioConf={index:0,audioBuffer:{},sounds:{}}),h.emptyStreamWith(this.audio.audioStream,null),h.emptyStreamWith(this.audio.musicStream,null),h.emptyStreamWith(this.audio.micStream,null),h.emptyStreamWith(this.screenAudio.screenAudioStream,null),h.emptyStreamWith(this.video.videoStream,null),h.emptyStreamWith(this.screen.screenVideoStream,null),h.emptyStreamWith(this.screenAudio.screenAudioStream,null)}updateWebAudio(){var e,t;if(!this.audio.webAudio){this.audio.webAudio=new u.WebAudio({logger:this.logger}),this.audio.webAudio.on("audioFilePlaybackCompleted",this._audioFilePlaybackCompletedEvent.bind(this));const r=null===(t=null===(e=this.audio.webAudio)||void 0===e?void 0:e.musicDestination)||void 0===t?void 0:t.stream.getAudioTracks()[0];r&&h.emptyStreamWith(this.audio.musicStream,r)}this.audio.webAudio.updateTracks([{track:this.audio.micTrack||this.audio.audioSource,type:"microphone"},{track:this.screenAudio.screenAudioTrack||this.screenAudio.screenAudioSource,type:"screenAudio"}])}async getScreenSource(e){const{width:t,height:r,frameRate:n}=this.screen.captureConfig.high;try{return await c.getScreenStream({video:{width:{ideal:t},height:{ideal:r},frameRate:{ideal:n,max:n}}},this.logger)}catch(e){const t="screen";return e.message&&e.message.indexOf("ermission")>-1&&e.message.indexOf("denied")>-1?this.stream.client.safeEmit("accessDenied",t):e.message&&e.message.indexOf("not found")>-1?this.stream.client.safeEmit("notFound",t):e.message&&e.message.indexOf("not start video source")>-1?this.stream.client.safeEmit("beOccupied",t):this.stream.client.safeEmit("deviceError",t),this.stream.emit("device-error",{type:t,error:e}),Promise.reject(e)}}async getStream(e){let{audio:t=!1,audioDeviceId:r="",video:n=!1,videoDeviceId:i="",screen:o=!1,sourceId:a="",screenAudio:s=!1,facingMode:u="",audioSource:l=null,videoSource:d=null,screenAudioSource:p=null,screenVideoSource:f=null,deviceId:m=""}=e;if(l&&(t=!0),d&&(n=!0),f&&(o=!0),p&&(s=!0),t||n||o||s){if(l){if("ended"===l.readyState)return void this.logger.error("不应输入已经停止的轨道:",l.kind,l.label);h.watchTrack(l),this.audio.audioSource=l,h.emptyStreamWith(this.audio.audioSourceStream,l),this.updateWebAudio(),this.stream.client.updateRecordingAudioStream(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(h.emptyStreamWith(this.audio.audioStream,l),this.updateAudioSender(l))),t=!1}if(d){if("ended"===d.readyState)return void this.logger.error("不应输入已经停止的轨道:",d.kind,d.label);h.watchTrack(d),this.video.videoSource=d,h.emptyStreamWith(this.video.videoStream,d),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint),n=!1}if(p){if("ended"===p.readyState)return void this.logger.error("不应输入已经停止的轨道:",p.kind,p.label);h.watchTrack(p),this.screenAudio.screenAudioSource=p,h.emptyStreamWith(this.screenAudio.screenAudioStream,p),this.listenToTrackEnded(this.screenAudio.screenAudioSource),this.updateWebAudio(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(h.emptyStreamWith(this.audio.audioStream,p),this.updateAudioSender(p))),s=!1}if(f){if("ended"===f.readyState)return void this.logger.error("不应输入已经停止的轨道:",f.kind,f.label);h.watchTrack(f),this.screen.screenVideoSource=f,h.emptyStreamWith(this.screen.screenVideoStream,f),this.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.screen.encoderConfig.high.contentHint&&this.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.screen.encoderConfig.high.contentHint),this.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.screen.encoderConfig.high.contentHint),o=!1}try{if(o){if(this.stream.isRemote)return void this.logger.error("getStream: 远端流不能够调用getStream");const{width:e,height:r,frameRate:n}=this.screen.captureConfig.high;if(a){const t=(await c.getStream({video:{mandatory:{maxWidth:e,maxHeight:r,maxFrameRate:n,minFrameRate:5,chromeMediaSource:"desktop",chromeMediaSourceId:a}}},this.logger)).getTracks()[0];this.video.cameraTrack=t,h.emptyStreamWith(this.video.videoStream,t),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint)}else{let t=await c.getScreenStream({video:{width:{ideal:e},height:{ideal:r},frameRate:{ideal:n,max:n}},audio:s&&this.getAudioConstraints()?this.getAudioConstraints():s},this.logger);if(this.screen.screenVideoTrack=t.getVideoTracks()[0],this.listenToTrackEnded(this.screen.screenVideoTrack),h.emptyStreamWith(this.screen.screenVideoStream,this.screen.screenVideoTrack),this.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.screen.encoderConfig.high.contentHint&&this.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.screen.encoderConfig.high.contentHint),this.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.screen.encoderConfig.high.contentHint),s){const e=t.getAudioTracks()[0];e?(this.screenAudio.screenAudioTrack=e,h.emptyStreamWith(this.screenAudio.screenAudioStream,e),this.listenToTrackEnded(e),this.updateWebAudio(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(h.emptyStreamWith(this.audio.audioStream,e),this.updateAudioSender(e)))):(this.logger.warn("getStream screenAudio: 未获取到屏幕共享音频"),this.stream.screenAudio=!1,this.stream.client.emit("error","screenAudioNotAllowed"))}}if(this.stream.client.apiEventReport("setFunction",{name:"set_screen",oper:"1",value:"success"}),t){let e=await c.getStream({audio:!this.getAudioConstraints()||this.getAudioConstraints()},this.logger);this.audio.micTrack=e.getAudioTracks()[0],h.emptyStreamWith(this.audio.micStream,this.audio.micTrack),this.listenToTrackEnded(this.audio.micTrack),this.updateWebAudio(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(h.emptyStreamWith(this.audio.audioStream,this.audio.micTrack),this.updateAudioSender(this.audio.micTrack)));const t=this.audio.micTrack.getSettings();this.audio.deviceInfo.mic.label=this.audio.micTrack.label,this.audio.deviceInfo.mic.deviceId=t.deviceId,this.audio.deviceInfo.mic.groupId=t.groupId,this.stream.client.apiEventReport("setFunction",{name:"set_mic",oper:"1",value:"success"})}}else if(s)this.logger.error("无法单独获取屏幕共享音频");else if(t||n){if(this.stream.isRemote)return void this.logger.error("MediaHelper.getStream:远端流不能调用getStream");const{height:e,width:o,frameRate:a}=this.video.captureConfig.high;let s={audio:t&&this.getAudioConstraints()?this.getAudioConstraints():t,video:!!n&&{width:{ideal:o},height:{ideal:e},frameRate:{ideal:a||15}}};r&&t&&(!0===s.audio&&(s.audio={}),s.audio.deviceId={exact:r}),n&&(u?s.video.facingMode={exact:u}:i&&(s.video.deviceId={exact:i}));const l=await c.getStream(s,this.logger),d=l.getVideoTracks()[0],p=l.getAudioTracks()[0];if(p){this.audio.micTrack=p,this.listenToTrackEnded(this.audio.micTrack),h.emptyStreamWith(this.audio.micStream,this.audio.micTrack),this.updateWebAudio(),this.stream.client.updateRecordingAudioStream(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(h.emptyStreamWith(this.audio.audioStream,this.audio.micTrack),this.updateAudioSender(this.audio.micTrack)));const e=p.getSettings();this.audio.deviceInfo.mic.label=this.audio.micTrack.label,this.audio.deviceInfo.mic.deviceId=e.deviceId,this.audio.deviceInfo.mic.groupId=e.groupId,this.stream.client.apiEventReport("setFunction",{name:"set_mic",oper:"1",value:"success"}),"object"==typeof s.audio&&(this.audio.micConstraint={audio:s.audio})}d&&(this.video.cameraTrack=d,h.emptyStreamWith(this.video.videoStream,d),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint),this.listenToTrackEnded(this.video.cameraTrack),this.stream.client.apiEventReport("setFunction",{name:"set_camera",oper:"1",value:"success"}),"object"==typeof s.video&&(this.video.cameraConstraint={video:s.video}))}this.assertLive()}catch(e){this.logger.error("getStream error:",e.name,e.message);let r="audio";return t&&this.stream.client.apiEventReport("setFunction",{name:"set_mic",oper:"1",value:e.message}),n&&(r="video",this.stream.client.apiEventReport("setFunction",{name:"set_camera",oper:"1",value:e.message})),o&&(r="screen",this.stream.client.apiEventReport("setFunction",{name:"set_screen",oper:"1",value:e.message})),e.message&&e.message.indexOf("ermission")>-1&&e.message.indexOf("denied")>-1?this.stream.client.safeEmit("accessDenied",r):e.message&&e.message.indexOf("not found")>-1?this.stream.client.safeEmit("notFound",r):e.message&&e.message.indexOf("not start video source")>-1?this.stream.client.safeEmit("beOccupied",r):this.stream.client.safeEmit("deviceError",r),this.stream.emit("device-error",{type:r,error:e}),Promise.reject(e)}}else this.logger.error("getStream: 必须指定媒体类型")}async getSecondStream(e){var t,r;let{audio:n=!1,video:i=!1}=e;if(!n&&!i)return this.logger.error("getSecondStream:必须指定一个参数"),Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"getSecondStream: audio/video is invalid"}));if(this.stream.isRemote)throw new Error("getSecondStream:远端用户不能调用getSecondStream");try{const n=await c.getStream(e,this.logger),i=n.getAudioTracks()[0],o=n.getVideoTracks()[0];if(this.logger.log(`getSecondStream: ${i?i.label:""} ${o?o.label:""}`),i){"object"==typeof e.audio&&(this.audio.micConstraint={audio:e.audio}),this.audio.micTrack=i,this._stopTrack(this.audio.micStream),h.emptyStreamWith(this.audio.micStream,this.audio.micTrack),this.listenToTrackEnded(this.audio.micTrack),this.stream.client.updateRecordingAudioStream(),this.updateWebAudio(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(h.emptyStreamWith(this.audio.audioStream,this.audio.micTrack),this.updateAudioSender(this.audio.micTrack)));const t=i.getSettings();this.audio.deviceInfo.mic.label=this.audio.micTrack.label,this.audio.deviceInfo.mic.deviceId=t.deviceId,this.audio.deviceInfo.mic.groupId=t.groupId,this.stream.client.apiEventReport("setFunction",{name:"set_mic",oper:"1",value:"success"})}if(o){"object"==typeof e.video&&(this.video.cameraConstraint={video:e.video}),this.video.cameraTrack=o,this._stopTrack(this.video.videoStream),h.emptyStreamWith(this.video.videoStream,this.video.cameraTrack),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint),this.stream.client.apiEventReport("setFunction",{name:"set_camera",oper:"1",value:"success"});const n=null===(t=this.stream.Play)||void 0===t?void 0:t.videoView;n&&(await this.stream.play(n),"width"in this.stream.renderMode.local.video&&this.stream.setLocalRenderMode(this.stream.renderMode.local.video,"video"));const i=this.stream.getSender("video","high");(null==i?void 0:i.track)?i.replaceTrack(o):this.logger.warn("getSecondStream video: 此时未发布流");const a=this.stream.getSender("video","low"),s=this.video.videoTrackLow;null===(r=this.video.videoTrackLow)||void 0===r||r.stop(),this.video.videoTrackLow=null,(null==a?void 0:a.track)===s&&(await this.createTrackLow("video"),this.logger.log("getSecondStream 切换小流",this.video.videoTrackLow),a.replaceTrack(this.video.videoTrackLow))}}catch(e){this.logger.error("getStream error",e.message);const t=n?"set_mic":"set_camera";return this.stream.client.apiEventReport("setFunction",{name:t,oper:"1",value:e.message}),Promise.reject(e)}}async createTrackLow(e){let t,r;if("video"===e?(t=JSON.parse(JSON.stringify(v.getParameters().videoLowDefaultConstraints)),r=this.video.videoStream.getVideoTracks()[0]):(t=JSON.parse(JSON.stringify(v.getParameters().screenLowDefaultConstraints)),r=this.screen.screenVideoStream.getVideoTracks()[0]),!r)return this.logger.error("创建小流失败：当前没有大流"),this.stream.client.safeEmit("track-low-init-fail",{mediaType:e}),null;if("live"!==r.readyState)return this.logger.error("创建小流失败：大流已在停止状态",r.label),this.stream.client.safeEmit("track-low-init-fail",{mediaType:e}),null;const n=r.clone();this[e].encoderConfig.low.contentHint?(this.logger.log("创建小流",e,this[e].encoderConfig.low.contentHint,r.label,t),this.logger.log("应用 contentHint",e,"low",n.contentHint,"=>",this[e].encoderConfig.low.contentHint),n.contentHint=this[e].encoderConfig.low.contentHint):this.logger.log("创建小流",e,r.label,t);const i=r.getSettings();if("screen"===e&&"Safari"===S.platform.name)this.logger.log(`创建小流：${e} + ${S.platform.name} 使用与大流一样的分辨率 ${i.width}x${i.height}`);else if(i.width&&i.height){try{t.aspectRatio=i.width/i.height,await n.applyConstraints(t)}catch(e){this.logger.warn(`创建小流：无法应用配置。小流与大流使用一样的分辨率。${i.width}x${i.height}。${JSON.stringify(t)} ${e.name} ${e.message}`)}const o=r.getSettings();if(o.width!==i.width||o.height!==i.height)this.logger.warn(`创建小流：applyConstraints影响了大流宽高。${i.width}x${i.height} => ${o.width}x${o.height}。回滚大流配置，小流与大流使用一样的分辨率。`),await r.applyConstraints(i),await n.applyConstraints(i);else{const e=n.getSettings();this.logger.log(`创建小流成功。大流宽高：${i.width}x${i.height} 小流宽高：${e.width}x${e.height}`)}}else this.logger.warn("创建小流：无法获取原始视频宽高。大流和小流使用同样的分辨率。"+JSON.stringify(i));return h.watchTrack(n),"video"===e?this.video.videoTrackLow=n:this.screen.screenVideoTrackLow=n,this.stream.client.safeEmit("track-low-init-success",{mediaType:e}),n}convert(e){const t=e.resolution,r=e.frameRate;let n={width:640,height:480,frameRate:15};return 2===t?(n.width=320,n.height=180):4===t?(n.width=640,n.height=480):8===t||l.RtcSystem.ios()?(n.width=1280,n.height=720):16===t&&(n.width=1920,n.height=1080),0===r?n.frameRate=15:1===r?n.frameRate=5:2===r?n.frameRate=10:3===r?n.frameRate=15:4===r?n.frameRate=20:5===r&&(n.frameRate=25),n}getAudioConstraints(){if(this.stream.isRemote)return void this.logger.error("Remote Stream dont have audio constraints");const e=this.stream.audioProcessing;let t={};switch(e&&(void 0!==e.AEC&&(t.echoCancellation=e.AEC,t.googEchoCancellation=e.AEC,t.googEchoCancellation2=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,t.googNoiseSuppression=e.ANS,t.googNoiseSuppression2=e.ANS),void 0!==e.AGC&&(t.autoGainControl=e.AGC,t.googAutoGainControl=e.AGC,t.googAutoGainControl2=e.AGC)),this.stream.audioProfile){case"standard_stereo":case"high_quality_stereo":t.googAutoGainControl=!1,t.googAutoGainControl2=!1,t.echoCancellation=!1,t.googNoiseSuppression=!1,t.channelCount=2}return"{}"===JSON.stringify(t)?null:t}getTrackSettings(){const e={};try{this.audio.micTrack&&(e.mic={settings:this.audio.micTrack.getSettings(),label:this.audio.micTrack.label,readyState:this.audio.micTrack.readyState}),this.audio.audioSource&&(e.audioSource={settings:this.audio.audioSource.getSettings(),label:this.audio.audioSource.label,readyState:this.audio.audioSource.readyState}),this.video.cameraTrack&&(e.camera={settings:this.video.cameraTrack.getSettings(),label:this.video.cameraTrack.label,readyState:this.video.cameraTrack.readyState}),this.video.videoSource&&(e.videoSource={settings:this.video.videoSource.getSettings(),label:this.video.videoSource.label,readyState:this.video.videoSource.readyState}),this.screen.screenVideoTrack&&(e.screen={settings:this.screen.screenVideoTrack.getSettings(),label:this.screen.screenVideoTrack.label,readyState:this.screen.screenVideoTrack.readyState}),this.screen.screenVideoSource&&(e.screenVideoSource={settings:this.screen.screenVideoSource.getSettings(),label:this.screen.screenVideoSource.label,readyState:this.screen.screenVideoSource.readyState}),this.screenAudio.screenAudioTrack&&(e.screenAudio={settings:this.screenAudio.screenAudioTrack.getSettings(),label:this.screenAudio.screenAudioTrack.label,readyState:this.screenAudio.screenAudioTrack.readyState}),this.screenAudio.screenAudioSource&&(e.screenAudioSource={settings:this.screenAudio.screenAudioSource.getSettings(),label:this.screenAudio.screenAudioSource.label,readyState:this.screenAudio.screenAudioSource.readyState})}catch(t){e.errName=t.name,e.errMessage=t.message}return e}updateStream(e,t){var r,n,i;"audio"===e?(this.audio.micTrack=t,h.emptyStreamWith(this.audio.audioStream,t),(null===(r=this.stream._play)||void 0===r?void 0:r.audioDom)&&(this.stream._play.audioDom.srcObject=this.audio.audioStream)):"video"===e?(this.video.cameraTrack=t,h.emptyStreamWith(this.video.videoStream,t),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint),(null===(n=this.stream._play)||void 0===n?void 0:n.videoDom)&&(this.stream._play.videoDom.srcObject=this.video.renderStream)):"screen"===e&&(this.screen.screenVideoTrack=t,h.emptyStreamWith(this.screen.screenVideoStream,t),this.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.screen.encoderConfig.high.contentHint&&this.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.screen.encoderConfig.high.contentHint),this.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.screen.encoderConfig.high.contentHint),(null===(i=this.stream._play)||void 0===i?void 0:i.screenDom)&&(this.stream._play.screenDom.srcObject=this.screen.renderStream))}stopStream(e){var t,r,n,i;let o="set_mic";"audio"===e?(null===(t=this.audio.micTrack)||void 0===t||t.stop(),this.audio.micTrack=null,h.emptyStreamWith(this.audio.micStream,null),this.audio.audioSource=null,h.emptyStreamWith(this.audio.audioSourceStream,null),this.updateWebAudio(),this.canDisableAudioRouting()&&this.disableAudioRouting()):"screenAudio"===e?(null===(r=this.screenAudio.screenAudioTrack)||void 0===r||r.stop(),this.screenAudio.screenAudioTrack=null,this.screenAudio.screenAudioSource=null,h.emptyStreamWith(this.screenAudio.screenAudioStream,null),this.updateWebAudio(),this.canDisableAudioRouting()&&this.disableAudioRouting()):"video"===e?(o="set_camera",null===(n=this.video.cameraTrack)||void 0===n||n.stop(),this.video.cameraTrack=null,h.emptyStreamWith(this.video.videoStream,null)):"screen"===e&&(o="set_screen",null===(i=this.screen.screenVideoTrack)||void 0===i||i.stop(),this.screen.screenVideoTrack=null,h.emptyStreamWith(this.screen.screenVideoStream,null)),this.stream.client.apiEventReport("setFunction",{name:o,oper:"0",value:"success"})}_stopTrack(e){if(!e)return;if(this.stream.isRemote)return;this.logger.log("清除stream: ",e);const t=e.getTracks();this.logger.log("清除stream: ",...t),t&&0!==t.length&&t.forEach((t=>{if("audio"===t.kind){const e=v.getParameters().tracks.audio.findIndex((e=>t===e));b.Logger.warn(`Stopping AUDIOTRACK#${e} ${t.id}, ${t.label}, ${t.readyState}`)}else{const e=v.getParameters().tracks.video.findIndex((e=>t===e));b.Logger.warn(`Stopping VIDEOTRACK#${e} ${t.id}, ${t.label}, ${t.readyState}`)}t.stop(),e.removeTrack(t),this.audio.micTrack===t&&(this.audio.micTrack=null,this.audio.deviceInfo.mic={label:""},this.updateWebAudio()),this.screenAudio.screenAudioTrack===t&&(this.screenAudio.screenAudioTrack=null,this.updateWebAudio()),this.video.cameraTrack===t&&(this.video.cameraTrack=null,this.video.videoTrackLow&&(this.logger.log("停止视频小流:",this.video.videoTrackLow),this.video.videoTrackLow.stop(),this.video.videoTrackLow=null)),this.screen.screenVideoTrack===t&&(this.screen.screenVideoTrack=null,this.screen.screenVideoTrackLow&&(this.logger.log("停止辅流小流:",this.screen.screenVideoTrackLow),this.screen.screenVideoTrackLow.stop(),this.screen.screenVideoTrackLow=null))}))}getAudioTrack(){var e;return null===(e=this.audio)||void 0===e?void 0:e.audioStream.getAudioTracks()[0]}getVideoTrack(){var e;return null===(e=this.video)||void 0===e?void 0:e.videoStream.getVideoTracks()[0]}setGain(e,t){this.audio.webAudio?(this.logger.log("setGain",e),this.audio.webAudio.setGain(e,t),this.canDisableAudioRouting()&&this.disableAudioRouting()):this.logger.log("setGain: 缺失本地音频")}getGain(){var e;return(null===(e=this.audio.webAudio)||void 0===e?void 0:e.getVolumeData())||"0.0"}canDisableAudioRouting(){let e=!0;if(!this.audio.webAudio)return!1;this.audio.webAudio.mixAudioConf.state!==d.AuidoMixingState.PLAYED&&this.audio.webAudio.mixAudioConf.state!==d.AuidoMixingState.PAUSED||(e=!1),Object.values(this.audio.mixAudioConf.sounds).forEach((t=>{"STARTING"!==t.state&&"PLAYED"!==t.state&&"PAUSED"!==t.state||(e=!1)}));const t=this.audio.webAudio.getGainMin();return e&&1===t&&this.audio.webAudio.audioInArr.length<=1}_audioFilePlaybackCompletedEvent(){this.canDisableAudioRouting()&&this.disableAudioRouting()}startAudioMixing(e){this.logger.log("开始伴音:",JSON.stringify(e,null," ")),Object.assign(this.audio.mixAudioConf,e);let t=null;if(this.audio.mixAudioConf.audioFilePath?0!==this.getAudioInputTracks().length&&this.stream.pubStatus.audio.audio?this.audio.webAudio&&this.audio.webAudio.context||(this.logger.log("开始伴音: 不支持伴音功能"),t="BROWSER_NOT_SUPPORT"):(this.logger.log("开始伴音: 当前没有publish音频"),t="NOT_PUBLIST_AUDIO_YET"):(this.logger.log("开始伴音: 没有找到云端文件路径"),t="INVALID_ARGUMENTS"),t){if(this.stream.client.apiFrequencyControl({name:"startAudioMixing",code:-1,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:t}),null," ")}),"INVALID_ARGUMENTS"===t)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"file path not found"}));if("NOT_PUBLIST_AUDIO_YET"===t)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"audio source is not published"}));if("BROWSER_NOT_SUPPORT"===t)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"audio mixing is not supported in this browser"}))}return this.stream.client.apiFrequencyControl({name:"startAudioMixing",code:0,param:JSON.stringify(this.audio.mixAudioConf,null," ")}),this.audio.webAudio&&(this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource&&this.audio.webAudio.mixAudioConf.state===d.AuidoMixingState.PLAYED&&(this.logger.log("startAudioMixing: 当前已经开启伴音，先关闭之前的伴音"),this.stopAudioMixing()),this.audio.webAudio.mixAudioConf.state,d.AuidoMixingState.STARTING),this.audio.mixAudioConf.audioFilePath&&this.audio.mixAudioConf.audioBuffer[this.audio.mixAudioConf.audioFilePath]?(this.logger.log("开始伴音, 已经加载过云端音乐"),this.startMix(this.audio.mixAudioConf.index)):(this.logger.log("开始伴音, 先加载云端音乐"),this.loadRemoteAudioFile(this.audio.mixAudioConf.index))}loadRemoteAudioFile(e){if(this.audio.mixAudioConf.audioFilePath)return p.ajax({url:this.audio.mixAudioConf.audioFilePath,type:"GET",dataType:"arraybuffer"}).then((t=>(this.logger.log("loadRemoteAudioFile 加载云端音乐成功"),new Promise(((r,n)=>{this.audio.webAudio&&this.audio.webAudio.context?this.audio.webAudio.context.decodeAudioData(t,(t=>{this.logger.log("loadRemoteAudioFile 云端音乐解码成功"),this.audio.mixAudioConf.audioFilePath?(this.audio.mixAudioConf.audioBuffer[this.audio.mixAudioConf.audioFilePath]=t,this.startMix(e).then((e=>{r(e)}))):n(new m.default({code:g.default.STATE_ERROR,message:"state error"}))}),(e=>{this.logger.log("loadRemoteAudioFile 云端音乐解码失败：",e),n(new m.default({code:g.default.STATE_ERROR,message:"create buffersource failed"}))})):n(new m.default({code:g.default.NOT_SUPPORT,message:"webAudio lost"}))}))))).catch((e=>(this.logger.log("loadRemoteAudioFile 加载云端音乐失败: ",e.name,e.message,e),Promise.reject(new m.default({code:g.default.STATE_ERROR,message:"load audio failed"})))));this.logger.error("audioFilePath未设置")}startMix(e){if(!this.audio.webAudio)return this.logger.error("startMix:参数错误"),Promise.reject(new m.default({code:g.default.INVALID_PARAMETER,message:"startMix parameter error"}));if(this.logger.log("startMix 开始混音:",JSON.stringify(this.audio.mixAudioConf)),e!==this.audio.mixAudioConf.index)return this.logger.log("startMix: 该次伴音已经取消"),Promise.resolve();this.audio.audioRoutingEnabled||this.enableAudioRouting();const{audioFilePath:t="",loopback:r=!1,replace:n=!1,cycle:i=0,playStartTime:o=0,volume:a=255,auidoMixingEnd:s=null}=this.audio.mixAudioConf;return this.audio.webAudio.startMix({buffer:this.audio.mixAudioConf.audioBuffer[t],loopback:r,replace:n,cycle:i,playStartTime:o,volume:a,auidoMixingEnd:s})}pauseAudioMixing(){let e=null;if(this.audio.webAudio&&this.audio.webAudio.context?this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource&&this.audio.webAudio.mixAudioConf.state!==d.AuidoMixingState.PAUSED?this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource&&this.audio.webAudio.mixAudioConf.state===d.AuidoMixingState.PLAYED||(this.logger.log("pauseAudioMixing: 当前没有开启伴音"),e="NOT_PLAY"):(this.logger.log("pauseAudioMixing: 已经暂停"),e="PAUSED"):(this.logger.log("pauseAudioMixing: 不支持伴音功能"),e="BROWSER_NOT_SUPPORT"),e){if(this.stream.client.apiFrequencyControl({name:"pauseAudioMixing",code:-1,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:e}),null," ")}),"BROWSER_NOT_SUPPORT"===e)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"pauseAudioMixing: audio mixing is not supported in this browser"}));if("PAUSED"===e)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"pauseAudioMixing: has already been paused"}));if("NOT_PLAY"===e)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"pauseAudioMixing: audio mixing is not open"}))}return this.stream.client.apiFrequencyControl({name:"pauseAudioMixing",code:0,param:JSON.stringify(this.audio.mixAudioConf,null," ")}),this.audio.webAudio&&this.audio.webAudio.pauseAudioMixing()}resumeAudioMixing(){let e=null;if(this.audio.webAudio&&this.audio.webAudio.context?this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource?this.audio.webAudio.mixAudioConf.state!==d.AuidoMixingState.PAUSED&&(this.logger.log("resumeAudioMixing: 当前没有暂停伴音"),e="NOT_PAUSED"):(this.logger.log("resumeAudioMixing: 当前没有开启伴音"),e="NOT_OPEN"):(this.logger.log("resumeAudioMixing: 不支持伴音功能"),e="BROWSER_NOT_SUPPORT"),e){if(this.stream.client.apiFrequencyControl({name:"resumeAudioMixing",code:-1,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:e}),null," ")}),"BROWSER_NOT_SUPPORT"===e)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"resumeAudioMixing: audio mixing is not supported in this browser"}));if("NOT_OPEN"===e)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"resumeAudioMixing: audio mixing is not open"}));if("NOT_PAUSED"===e)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"resumeAudioMixing: audio mixing is not paused"}))}if(this.stream.client.apiFrequencyControl({name:"resumeAudioMixing",code:0,param:JSON.stringify(this.audio.mixAudioConf,null," ")}),!this.audio.webAudio)return;let{audioFilePath:t="",loopback:r=!1,replace:n=!1,cycle:i=0,playStartTime:o=0,auidoMixingEnd:a=null}=this.audio.mixAudioConf,s=(this.audio.webAudio.mixAudioConf.pauseTime-this.audio.webAudio.mixAudioConf.startTime)/1e3+this.audio.webAudio.mixAudioConf.playStartTime;return s>this.audio.webAudio.mixAudioConf.totalTime&&(this.logger.log("播发过的圈数 playedCycle: ",Math.floor(s/this.audio.webAudio.mixAudioConf.totalTime)),i-=Math.floor(s/this.audio.webAudio.mixAudioConf.totalTime),this.audio.mixAudioConf.cycle=i),this.audio.webAudio.mixAudioConf.setPlayStartTime?(this.logger.log("暂停期间，用户设置混音播发时间: ",this.audio.webAudio.mixAudioConf.setPlayStartTime),o=this.audio.webAudio.mixAudioConf.setPlayStartTime,this.audio.webAudio.mixAudioConf.setPlayStartTime=0):(this.logger.log("恢复混音:",JSON.stringify(this.audio.webAudio.mixAudioConf)),this.logger.log("已经播放的时间: ",s),s>this.audio.webAudio.mixAudioConf.totalTime&&(s%=this.audio.webAudio.mixAudioConf.totalTime),o=s),this.logger.log("回复重置的时间点：",o),this.audio.webAudio.resumeAudioMixing({buffer:this.audio.mixAudioConf.audioBuffer[t],loopback:r,replace:n,cycle:i,playStartTime:o,auidoMixingEnd:a})}stopAudioMixing(e=!0){let t=null;if(this.audio.webAudio&&this.audio.webAudio.context?this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource||(this.logger.log("stopAudioMixing: 当前没有开启伴音"),t="NOT_OPEN"):(this.logger.log("stopAudioMixing: 不支持伴音功能"),t="BROWSER_NOT_SUPPORT"),t){if(this.stream.client.apiFrequencyControl({name:"stopAudioMixing",code:-1,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:t}),null," ")}),"BROWSER_NOT_SUPPORT"===t)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"stopAudioMixing: audio mixing is not supported in this browser"}));if("NOT_OPEN"===t)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"stopAudioMixing: audio mixing is not open"}))}return this.stream.client.apiFrequencyControl({name:"stopAudioMixing",code:0,param:JSON.stringify(this.audio.mixAudioConf,null," ")}),this.audio.webAudio?this.audio.webAudio.stopAudioMixing(e):Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"webAudio is not supported in this browser"}))}setAudioMixingVolume(e){let t=null;if(this.audio.webAudio&&this.audio.webAudio.context?this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource?Number.isInteger(e)?(e<0||e>255)&&(this.logger.log("setAudioMixingVolume: volume范围（0 - 255）"),t="INVALID_ARGUMENTS"):(this.logger.log("setAudioMixingVolume: volume不是整数"),t="INVALID_ARGUMENTS"):(this.logger.log("setAudioMixingVolume: 当前没有开启伴音"),t="NOT_OPEN"):(this.logger.log("setAudioMixingVolume: 不支持伴音功能"),t="BROWSER_NOT_SUPPORT"),t){if(this.stream.client.apiFrequencyControl({name:"adjustAudioMixingVolume",code:-1,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:t,volume:e}),null," ")}),"BROWSER_NOT_SUPPORT"===t)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"setAudioMixingVolume: audio mixing is not supported in this browser"}));if("NOT_OPEN"===t)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"setAudioMixingVolume: audio mixing is not open"}));if("INVALID_ARGUMENTS"===t)return Promise.reject(new m.default({code:g.default.INVALID_PARAMETER,message:"setAudioMixingVolume: volume must be an integer with scope (0 - 255)"}))}return this.stream.client.apiFrequencyControl({name:"adjustAudioMixingVolume",code:0,param:JSON.stringify({volume:e},null," ")}),this.audio.webAudio&&this.audio.webAudio.setAudioMixingVolume(e)}setAudioMixingPlayTime(e){let t=null;if(this.audio.webAudio&&this.audio.webAudio.context)if(this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource){if(e<0)this.logger.log("setAudioMixingPlayTime: playStartTime小于0"),t="INVALID_ARGUMENTS";else if(e>=this.audio.webAudio.mixAudioConf.totalTime)this.logger.log("setAudioMixingPlayTime: playStartTime大于音频文件总时长了"),t="INVALID_ARGUMENTS";else if(this.audio.webAudio.mixAudioConf.state===d.AuidoMixingState.PAUSED)return this.audio.webAudio.mixAudioConf.setPlayStartTime=e,this.logger.log("setAudioMixingPlayTime: 当前正在暂停，记录设置的播发位置，在恢复伴音时，跳转到此次设置的播放位置"),Promise.resolve()}else this.logger.log("setAudioMixingPlayTime: 当前没有开启伴音"),t="INVALID_ARGUMENTS";else this.logger.log("setAudioMixingPlayTime: 不支持伴音功能"),t="BROWSER_NOT_SUPPORT";if(t){if(this.stream.client.apiFrequencyControl({name:"setAudioMixingPosition",code:-1,param:JSON.stringify({playTime:e,reason:t},null," ")}),"BROWSER_NOT_SUPPORT"===t)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"setAudioMixingPlayTime: audio mixing is not supported in this browser"}));if("NOT_OPEN"===t)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"setAudioMixingPlayTime: audio mixing is not open"}));if("INVALID_ARGUMENTS"===t)return Promise.reject(new m.default({code:g.default.INVALID_PARAMETER,message:"setAudioMixingPlayTime: playStartTime is invalid"}))}return new Promise(((t,r)=>{this.stopAudioMixing(!1).then((n=>{if(!this.audio.webAudio)return r("webAudio not supported"),Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"webAudio is not supported in this browser"}));this.audio.mixAudioConf.playStartTime=e;let{audioFilePath:i="",loopback:o=!1,replace:a=!1,cycle:s=0,playStartTime:c=0,auidoMixingEnd:u=null}=this.audio.mixAudioConf;this.logger.log("设置混音的播放位置:",this.audio.webAudio.mixAudioConf);let l=(Date.now()-this.audio.webAudio.mixAudioConf.startTime)/1e3+this.audio.webAudio.mixAudioConf.playStartTime;this.logger.log("已经播放的时间: ",l),l>this.audio.webAudio.mixAudioConf.totalTime&&(this.logger.log("播发过的圈数 playedCycle: ",Math.floor(l/this.audio.webAudio.mixAudioConf.totalTime)),s-=Math.floor(l/this.audio.webAudio.mixAudioConf.totalTime),this.audio.mixAudioConf.cycle=s),this.logger.log(`setAudioMixingPlayTime, playTime: ${e}, cycle: ${s}`),this.audio.webAudio.setAudioMixingPlayTime({buffer:this.audio.mixAudioConf.audioBuffer[i],loopback:o,replace:a,cycle:s,playStartTime:c,auidoMixingEnd:u}).then((r=>{this.stream.client.apiFrequencyControl({name:"setAudioMixingPosition",code:0,param:JSON.stringify({playTime:e},null," ")}),t(r)})).catch((t=>{this.stream.client.apiFrequencyControl({name:"setAudioMixingPosition",code:-1,param:JSON.stringify({playTime:e,reason:"重新播放伴音失败"},null," ")}),r(t)}))})).catch((t=>(this.stream.client.apiFrequencyControl({name:"setAudioMixingPosition",code:-1,param:JSON.stringify({playTime:e,reason:"暂停当前播放失败"},null," ")}),Promise.reject(t))))}))}getAudioMixingPlayedTime(){var e;return this.audio.webAudio&&this.audio.webAudio.context?this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource?(this.stream.client.apiFrequencyControl({name:"getAudioMixingPlayedTime",code:0,param:JSON.stringify({playTime:null===(e=this.audio.webAudio.getAudioMixingPlayedTime())||void 0===e?void 0:e.playedTime},null," ")}),this.audio.webAudio.getAudioMixingPlayedTime()):(this.logger.log("getAudioMixingPlayedTime: 当前没有开启伴音"),Promise.resolve()):(this.logger.log("getAudioMixingPlayedTime: 不支持伴音功能"),Promise.resolve())}getAudioMixingTotalTime(){var e;return this.audio.webAudio&&this.audio.webAudio.context?this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource?(this.stream.client.apiFrequencyControl({name:"getAudioMixingTotalTime",code:0,param:JSON.stringify({totalTime:null===(e=this.audio.webAudio.getAudioMixingTotalTime())||void 0===e?void 0:e.totalTime},null," ")}),this.audio.webAudio.getAudioMixingTotalTime()):(this.logger.log("getAudioMixingTotalTime: 当前没有开启伴音"),Promise.resolve()):(this.logger.log("startAudioMixing: 不支持伴音功能"),Promise.resolve())}isMixAuido(){return!!(this.audio.webAudio&&this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource)}_initSoundIfNotExists(e,t){this.audio.mixAudioConf.sounds[e]||(this.audio.mixAudioConf.sounds[e]={soundId:e,state:"UNSTART",filePath:t||"",volume:100,sourceNode:null,gainNode:null,cycle:1,playStartTime:0,playOverTime:0,pauseTime:0,startTime:0,totalTime:0,options:{}}),t&&(this.audio.mixAudioConf.sounds[e].filePath=t)}async playEffect(e,t){const{soundId:r,filePath:n,cycle:i=1}=e,o={tag:"Stream.playEffect:filePath",value:n};f.checkExists(o);const a={tag:"Stream.playEffect:soundId",value:r,min:1,max:1e4};f.isExistOptions(a).result&&f.checkValidInteger(a);const s={tag:"Stream.playEffect:cycle",value:i,min:1,max:1e4};if(f.isExistOptions(s).result&&f.checkValidInteger(s),this._initSoundIfNotExists(r,n),this.audio.audioRoutingEnabled||this.enableAudioRouting(),!this.audio.webAudio||!this.audio.webAudio.context)return this.logger.log("playEffect: 浏览器不支持"),Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"playEffect: not supported in this browser"}));if(this.audio.mixAudioConf.sounds[r]&&("STARTING"===this.audio.mixAudioConf.sounds[r].state||"PLAYED"===this.audio.mixAudioConf.sounds[r].state||"PAUSED"===this.audio.mixAudioConf.sounds[r].state)&&(this.logger.log(`pauseEffect: 该音效文件正处于: ${this.audio.mixAudioConf.sounds[r].state} 状态`),void 0===t))return Promise.reject(new m.default({code:g.default.INVALID_PARAMETER,message:"playEffect: parameter is invalid"}));this.audio.mixAudioConf.sounds[r].state="STARTING",this.audio.mixAudioConf.audioBuffer[n]?this.logger.log("playEffect: 已经 load 音效文件"):(this.logger.log("playEffect, 先 load 音效文件"),await this.preloadEffect(r,n));try{const o=this.audio.webAudio.createAudioBufferSource(this.audio.mixAudioConf.audioBuffer[n]);this.audio.mixAudioConf.sounds[r].sourceNode=o.sourceNode,o&&o.sourceNode&&(o.sourceNode.onended=e=>{this.stopEffect(r)}),this.audio.mixAudioConf.sounds[r].gainNode=o.gainNode,this.audio.mixAudioConf.sounds[r].totalTime=this.audio.mixAudioConf.audioBuffer[n]&&this.audio.mixAudioConf.audioBuffer[n].duration,this.audio.mixAudioConf.sounds[r].cycle=i;const a=this.audio.mixAudioConf.audioBuffer[n]&&this.audio.mixAudioConf.audioBuffer[n].duration;this.audio.mixAudioConf.sounds[r].playOverTime=a,i>1&&(this.audio.mixAudioConf.sounds[r].playOverTime=i*a-this.audio.mixAudioConf.sounds[r].playStartTime),this.audio.mixAudioConf.sounds[r].playStartTime=t||0,this.audio.webAudio.startAudioEffectMix(this.audio.mixAudioConf.sounds[r]),this.audio.mixAudioConf.sounds[r].state="PLAYED",this.audio.mixAudioConf.sounds[r].startTime=Date.now(),this.stream.client.apiFrequencyControl({name:"playEffect",code:0,param:JSON.stringify(e,null," ")})}catch(e){}}async stopEffect(e){const t={tag:"Stream.stopEffect:soundId",value:e};if(f.isExistOptions(t).result&&f.checkValidInteger(t),!this.audio.webAudio||!this.audio.webAudio.context)return this.logger.log("stopEffect: 浏览器不支持"),Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"stopEffect: not supported in this browser"}));this.audio.webAudio.stopAudioEffectMix(this.audio.mixAudioConf.sounds[e]),this.audio.mixAudioConf.sounds[e].state="STOPED",this._audioFilePlaybackCompletedEvent(),this.stream.client.apiFrequencyControl({name:"stopEffect",code:0,param:JSON.stringify(e,null," ")})}async pauseEffect(e){const t={tag:"Stream.pauseEffect:soundId",value:e};f.isExistOptions(t).result&&f.checkValidInteger(t);let r=null;if(this.audio.mixAudioConf.sounds[e]||(this.logger.log("pauseEffect: 没有该音效文件"),r="SOUND_NOT_EXISTS"),this.audio.webAudio&&this.audio.webAudio.context?"PAUSED"===this.audio.mixAudioConf.sounds[e].state?(this.logger.log("pauseEffect: 已经暂停"),r="PAUSED"):"PLAYED"!==this.audio.mixAudioConf.sounds[e].state&&(this.logger.log("pauseEffect: 当前没有开启该音效"),r="NOT_PLAYED"):(this.logger.log("pauseEffect: 不支持音效功能"),r="BROWSER_NOT_SUPPORT"),r){if("BROWSER_NOT_SUPPORT"===r)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"pauseEffect: audio effect is not supported in this browser"}));if("NOT_PLAYED"===r)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"pauseEffect: audio effect is not open"}));if("PAUSED"===r)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"pauseEffect: audio effect is not played"}));if("SOUND_NOT_EXISTS"===r)return Promise.reject(new m.default({code:g.default.NO_FILE,message:"pauseEffect: audio effect file is not found"}))}if(!this.audio.webAudio)return;this.audio.webAudio.stopAudioEffectMix(this.audio.mixAudioConf.sounds[e]),this.audio.mixAudioConf.sounds[e].pauseTime=Date.now(),this.audio.mixAudioConf.sounds[e].state="PAUSED";let n=(this.audio.mixAudioConf.sounds[e].pauseTime-this.audio.mixAudioConf.sounds[e].startTime)/1e3+this.audio.mixAudioConf.sounds[e].playStartTime;this.logger.log("pauseEffect 已经播放的时间: ",n),n>this.audio.mixAudioConf.sounds[e].totalTime&&(n%=this.audio.mixAudioConf.sounds[e].totalTime),this.logger.log("pauseEffect 暂停位置: ",n),this.stream.client.apiFrequencyControl({name:"pauseEffect",code:0,param:JSON.stringify(e,null," ")})}async resumeEffect(e){const t={tag:"Stream.resumeEffect:soundId",value:e};f.isExistOptions(t).result&&f.checkValidInteger(t);let r=null;if(this.audio.mixAudioConf.sounds[e]||(this.logger.log("resumeEffect: 没有该音效文件"),r="SOUND_NOT_EXISTS"),this.audio.webAudio&&this.audio.webAudio.context?"PAUSED"!==this.audio.mixAudioConf.sounds[e].state&&(this.logger.log("resumeEffect: 当前没有暂停该音效文件"),r="NOT_PAUSED"):(this.logger.log("resumeEffect: 不支持音效功能"),r="BROWSER_NOT_SUPPORT"),r){if("BROWSER_NOT_SUPPORT"===r)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"resumeEffect: audio effect is not supported in this browser"}));if("NOT_PAUSED"===r)return Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"resumeEffect: audio mixing is not paused"}));if("SOUND_NOT_EXISTS"===r)return Promise.reject(new m.default({code:g.default.NO_FILE,message:"resumeEffect: audio effect file is not found"}))}if(!this.audio.webAudio)return;let n=(this.audio.mixAudioConf.sounds[e].pauseTime-this.audio.mixAudioConf.sounds[e].startTime)/1e3+this.audio.mixAudioConf.sounds[e].playStartTime;if(this.logger.log("resumeEffect 已经播放的时间: ",n),n>this.audio.mixAudioConf.sounds[e].totalTime){const t=Math.floor(n/this.audio.mixAudioConf.sounds[e].totalTime);this.logger.log("播发过的圈数 playedCycle: ",t),n%=this.audio.mixAudioConf.sounds[e].totalTime,this.audio.mixAudioConf.sounds[e].cycle=this.audio.mixAudioConf.sounds[e].cycle-t}this.audio.mixAudioConf.sounds[e].playOverTime=this.audio.mixAudioConf.sounds[e].totalTime,this.audio.mixAudioConf.sounds[e].cycle>1&&(this.audio.mixAudioConf.sounds[e].playOverTime=this.audio.mixAudioConf.sounds[e].cycle*this.audio.mixAudioConf.sounds[e].totalTime-this.audio.mixAudioConf.sounds[e].playStartTime),n>this.audio.mixAudioConf.sounds[e].totalTime&&(n%=this.audio.mixAudioConf.sounds[e].totalTime),this.audio.mixAudioConf.sounds[e].playStartTime=n,this.logger.log("resumeEffect 回复重置的时间点：",n),this.playEffect({soundId:e,filePath:this.audio.mixAudioConf.sounds[e].filePath,cycle:this.audio.mixAudioConf.sounds[e].cycle},n),this.audio.mixAudioConf.sounds[e].state="PLAYED",this.audio.mixAudioConf.sounds[e].startTime=Date.now(),this.stream.client.apiFrequencyControl({name:"resumeEffect",code:0,param:JSON.stringify(e,null," ")})}async setVolumeOfEffect(e,t){var r;const n={tag:"Stream.setVolumeOfEffect:soundId",value:e,min:1};f.isExistOptions(n).result&&f.checkValidInteger(n);const i={tag:"Stream.setVolumeOfEffect:volume",value:t,min:0,max:100};f.isExistOptions(i).result&&f.checkValidInteger(i),this.logger.log(`setVolumeOfEffect 设置 ${e} 音效文件的音量: ${t}`),this._initSoundIfNotExists(e);let o=null;if(this.audio.webAudio&&this.audio.webAudio.context||(this.logger.log("setVolumeOfEffect: 不支持音效功能"),o="BROWSER_NOT_SUPPORT"),o)return Promise.reject(new m.default({code:g.default.NOT_SUPPORT,message:"setVolumeOfEffect: audio effect is not supported in this browser"}));const a=null===(r=this.audio.mixAudioConf.sounds[e])||void 0===r?void 0:r.gainNode;a?a.gain.value=t/100:this.logger.log("setVolumeOfEffect: no gainNode"),this.audio.mixAudioConf.sounds[e].volume=t,this.stream.client.apiFrequencyControl({name:"setVolumeOfEffect",code:0,param:JSON.stringify({soundId:e,volume:t},null," ")})}async preloadEffect(e,t){const r={tag:"Stream.preloadEffect:filePath",value:t};f.checkExists(r);const n={tag:"Stream.preloadEffect:soundId",value:e};if(f.isExistOptions(n).result&&f.checkValidInteger(n),this.logger.log(`preloadEffect 设置soundId: ${e}, 音效文件的filePath: ${t}`),this._initSoundIfNotExists(e,t),this.audio.audioRoutingEnabled||this.enableAudioRouting(),this.audio.mixAudioConf.audioBuffer[t])this.logger.log("preloadEffect: 已经 load 音效文件");else try{await this.loadAudioBuffer(t),this.stream.client.apiFrequencyControl({name:"preloadEffect",code:0,param:JSON.stringify({soundId:e,filePath:t},null," ")})}catch(e){this.logger.error("preloadEffect 错误: ",e.name,e.message,e),this.stream.client.apiFrequencyControl({name:"preloadEffect",code:-1,param:JSON.stringify({reason:e},null," ")})}}async unloadEffect(e){const t={tag:"Stream.unloadEffect:soundId",value:e,min:1};return f.isExistOptions(t).result&&f.checkValidInteger(t),this.logger.log(`unloadEffect： ${e} 音效文件`),this.audio.mixAudioConf.sounds[e]?"UNSTART"!==this.audio.mixAudioConf.sounds[e].state&&"STOPED"!==this.audio.mixAudioConf.sounds[e].state?(this.logger.log("unloadEffect: 该音效文件已经播放，请使用 stopEffect 方法"),Promise.reject(new m.default({code:g.default.INVALID_OPERATION,message:"unloadEffect: invalid operation"}))):(delete this.audio.mixAudioConf.audioBuffer[this.audio.mixAudioConf.sounds[e].filePath],delete this.audio.mixAudioConf.sounds[e],void this.stream.client.apiFrequencyControl({name:"unloadEffect",code:0,param:JSON.stringify({soundId:e},null," ")})):(this.logger.log("unloadEffect: 没有该音效文件"),Promise.reject(new m.default({code:g.default.NO_FILE,message:"unloadEffect: audio effect file is not found"})))}getEffectsVolume(){this.logger.log("getEffectsVolume");const e=new Array;return Object.values(this.audio.mixAudioConf.sounds).forEach((t=>{e.push({soundId:t.soundId,volume:t.volume})})),this.stream.client.apiFrequencyControl({name:"getEffectsVolume",code:0,param:JSON.stringify(e,null,2)}),e}setEffectsVolume(e){const t={tag:"Stream.setEffectsVolume:volume",value:e,min:0,max:100};f.isExistOptions(t).result&&f.checkValidInteger(t),this.logger.log("setEffectsVolume, 设置音量: "+e),Object.values(this.audio.mixAudioConf.sounds).forEach((t=>{this.setVolumeOfEffect(t.soundId,e)})),this.stream.client.apiFrequencyControl({name:"setEffectsVolume",code:0,param:JSON.stringify({volume:e},null,2)})}async stopAllEffects(){this.logger.log("stopAllEffects"),Object.values(this.audio.mixAudioConf.sounds).forEach((e=>{"PLAYED"!==e.state&&"PAUSED"!==e.state||this.stopEffect(e.soundId)})),this.stream.client.apiFrequencyControl({name:"stopAllEffects",code:0,param:JSON.stringify("stopAllEffects",null,2)})}async pauseAllEffects(){this.logger.log("pauseAllEffects"),Object.values(this.audio.mixAudioConf.sounds).forEach((e=>{"PLAYED"===e.state&&this.pauseEffect(e.soundId)})),this.stream.client.apiFrequencyControl({name:"pauseAllEffects",code:0,param:JSON.stringify("pauseAllEffects",null,2)})}async resumeAllEffects(){this.logger.log("resumeAllEffects"),Object.values(this.audio.mixAudioConf.sounds).forEach((e=>{"PAUSED"===e.state&&this.resumeEffect(e.soundId)})),this.stream.client.apiFrequencyControl({name:"resumeAllEffects",code:0,param:JSON.stringify("resumeAllEffects",null,2)})}getAudioEffectsTotalTime(e){const{soundId:t,filePath:r,cycle:n=1}=e;if(!this.audio.mixAudioConf||"{}"===JSON.stringify(this.audio.mixAudioConf.sounds))return this.logger.log("getAudioEffectsTotalTime: 当前没有音效文件"),Promise.resolve();let i;return this._initSoundIfNotExists(t,r),"PLAYED"===this.audio.mixAudioConf.sounds[t].state&&(i=this.audio.mixAudioConf.sounds[t].totalTime),this.stream.client.apiFrequencyControl({name:"getAudioMixingTotalTime",code:0,param:JSON.stringify({totalTime:i},null," ")}),i}getAudioEffectsPlayedTime(e){const{soundId:t,filePath:r,cycle:n=1}=e;if(!this.audio.mixAudioConf||"{}"===JSON.stringify(this.audio.mixAudioConf.sounds))return this.logger.log("getAudioEffectsTotalTime: 当前没有音效文件"),Promise.resolve();this._initSoundIfNotExists(t,r);let i=Date.now();"PAUSED"==this.audio.mixAudioConf.sounds[t].state&&(this.logger.log("当前是暂停状态"),i=this.audio.mixAudioConf.sounds[t].pauseTime);let o=(i-this.audio.mixAudioConf.sounds[t].startTime)/1e3+this.audio.mixAudioConf.sounds[t].playStartTime;return o>this.audio.mixAudioConf.sounds[t].totalTime&&(o%=this.audio.mixAudioConf.sounds[t].totalTime),this.stream.client.apiFrequencyControl({name:"getAudioMixingPlayedTime",code:0,param:JSON.stringify({playTime:o},null," ")}),{playedTime:o}}loadAudioBuffer(e){return p.ajax({url:e,type:"GET",dataType:"arraybuffer"}).then((t=>(this.logger.log("loadAudioBuffer 加载 audio file 成功"),new Promise(((r,n)=>{this.audio.webAudio&&this.audio.webAudio.context?this.audio.webAudio.context.decodeAudioData(t,(t=>{this.logger.log("loadAudioBuffer audio file 解码成功"),this.audio.mixAudioConf.audioBuffer[e]=t,r(t)}),(e=>{this.logger.log("loadRemoteAudioFile 云端音乐解码失败：",e),n(new m.default({code:g.default.DECODE_FAILED,message:"create buffersource failed"}))})):n(new m.default({code:g.default.STATE_ERROR,message:"webAudio lost"}))}))))).catch((e=>(this.logger.log("loadRemoteAudioFile 加载云端音乐失败: ",e),Promise.reject(new m.default({code:g.default.STATE_ERROR,message:"load audio failed"})))))}getAudioInputTracks(){var e,t,r,n;let i=[];return"live"===(null===(e=this.audio.audioSource)||void 0===e?void 0:e.readyState)&&i.push(this.audio.audioSource),"live"===(null===(t=this.audio.micTrack)||void 0===t?void 0:t.readyState)&&i.push(this.audio.micTrack),"live"===(null===(r=this.screenAudio.screenAudioTrack)||void 0===r?void 0:r.readyState)&&i.push(this.screenAudio.screenAudioTrack),"live"===(null===(n=this.screenAudio.screenAudioSource)||void 0===n?void 0:n.readyState)&&i.push(this.screenAudio.screenAudioSource),i}enableAudioRouting(){if(this.audio.webAudio&&this.audio.webAudio.destination){this.audio.audioRoutingEnabled=!0;const e=this.audio.webAudio.destination.stream.getAudioTracks()[0];this.logger.log("enableAudioRouting: ",e.label);const t=this.audio.audioStream.getAudioTracks()[0];t&&(e.enabled=t.enabled,t.enabled=!0),h.emptyStreamWith(this.audio.audioStream,e),this.stream.audioLevelHelper&&this.stream.audioLevelHelper.updateStream(this.audio.audioStream),this.updateAudioSender(e)}else this.logger.log("enableAudioRouting: 已替换为Destination")}disableAudioRouting(){const e=this.getAudioInputTracks();if(e.length){1===e.length?this.logger.log("disableAudioRouting: ",e[0].label):this.logger.warn("disableAudioRouting: 仍然有多于一个输入",...e);const t=this.audio.audioStream.getAudioTracks()[0];h.emptyStreamWith(this.audio.audioStream,e[0]),e[0].enabled=t.enabled,t.enabled=!0,this.updateAudioSender(e[0])}else this.logger.log("disableAudioRouting quiet."),h.emptyStreamWith(this.audio.audioStream,null);this.audio.audioRoutingEnabled=!1}updateAudioSender(e){var t,r,n,i,o,a,s,c,u,l,d,p,f,h,m,g,v;if(this.stream.isRemote)throw new Error("updateAudioSender only for localStream");if(null===(r=null===(t=this.stream.getAdapterRef())||void 0===t?void 0:t._mediasoup)||void 0===r?void 0:r._micProducer)if(null===(o=null===(i=null===(n=this.stream.getAdapterRef())||void 0===n?void 0:n._mediasoup)||void 0===i?void 0:i._micProducer)||void 0===o?void 0:o._rtpSender)this.logger.info("updateAudioSender: 替换当前_micProducer的track",e.label),null===(u=null===(c=null===(s=null===(a=this.stream.getAdapterRef())||void 0===a?void 0:a._mediasoup)||void 0===s?void 0:s._micProducer)||void 0===c?void 0:c._rtpSender)||void 0===u||u.replaceTrack(e);else if(null===(f=null===(p=null===(d=null===(l=this.stream.getAdapterRef())||void 0===l?void 0:l._mediasoup)||void 0===d?void 0:d._sendTransport)||void 0===p?void 0:p.handler)||void 0===f?void 0:f._pc){const t=null===(g=null===(m=null===(h=this.stream.getAdapterRef())||void 0===h?void 0:h._mediasoup)||void 0===m?void 0:m._sendTransport)||void 0===g?void 0:g.handler._pc.getSenders();if(t)for(var y in t){const r=t[y];"audio"===(null===(v=null==r?void 0:r.track)||void 0===v?void 0:v.kind)&&(this.logger.info("updateAudioSender: 替换audioSender",r.track.label),r.replaceTrack(e))}}}enablePreProcessing(e="video",t){_.enablePreProcessing(this,e,t)}disablePreProcessing(e,t=!1){_.disablePreProcessing(this,e,t)}canDisablePreProcessing(e){return _.canDisablePreProcessing(this,e)}getPreprocessingStats(e="video"){var t;const r=null===(t=this[e].preProcessing)||void 0===t?void 0:t.history;if(!(null==r?void 0:r.length))return null;const n=r[r.length-1].endTs-r[0].startTs,i={total:0};for(let e=0;e<r.length;e++){i.total+=r[e].endTs-r[e].startTs;for(let t of r[e].handlerTs)t.spent>0&&(i[t.name]||(i[t.name]=0),i[t.name]+=t.spent)}return{fps:1e3*r.length/n,load:i.total/n,delay:i.total/r.length,spent:i}}destroy(){this.logger.log("清除 meida"),this._reset()}}t.MediaHelper=w},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebAudio=t.getAudioContext=void 0;const i=r(3),o=r(34),a=r(98),s=n(r(1)),c=n(r(0)),u=o.RtcSupport.checkWebAudio();let l;class d{constructor(e){this.id=e.id,this.label=e.label,this.audioNode=e.audioNode,this.gainNode=e.context.createGain(),this.type=e.type,this.audioNode.connect(this.gainNode)}connect(e){this.gainNode.connect(e)}disconnect(){try{this.audioNode.disconnect(this.gainNode)}catch(e){}this.gainNode.disconnect()}}function p(){return l||(u.WebAudio&&u.MediaStream?(l=new window.AudioContext,l):null)}t.getAudioContext=p;class f extends i.EventEmitter{constructor(e){super();const{logger:t,isAnalyze:r=!1,isRemote:n=!1}=e;this.support=u.WebAudio&&u.MediaStream,this.gain=1,this.logger=t,this.audioInArr=[],this.isAnalyze=r,this.isRemote=n||!1,this.instant=0,this.slow=0,this.clip=0,this.mixAudioConf={state:a.AuidoMixingState.UNSTART,audioSource:null,gainFilter:null,replace:!1,cycle:0,pauseTime:0,startTime:0,totalTime:0,volume:1,playStartTime:0,setPlayStartTime:0,auidoMixingEnd:null},this.context=p(),this.context?(this.destination=this.createDestination(),this.musicDestination=this.createDestination(),this.analyzeDestination=this.createDestination()):(this.destination=null,this.musicDestination=null,this.analyzeDestination=null),this.support&&(this.resetMixConf(),this.init())}createDestination(){if(!this.context)throw new Error("AudioContextRequired");try{return new MediaStreamAudioDestinationNode(this.context)}catch(e){if("TypeError"===e.name)return this.context.createMediaStreamDestination();throw e}}createSource(e){if(!this.context)throw new Error("AudioContextRequired");try{return new MediaStreamAudioSourceNode(this.context,e)}catch(t){if("TypeError"===t.name)return this.context.createMediaStreamSource(e.mediaStream);throw t}}init(){this.isAnalyze&&this.initMonitor(),this.initWebAudio(),this.initAudioIn()}initMonitor(){var e=this;this.context?(this.script=this.context.createScriptProcessor(0,1,1)).onaudioprocess=function(t){var r,n=t.inputBuffer.getChannelData(0),i=0,o=0;for(r=0;r<n.length;++r)i+=Math.abs(n[r]),Math.abs(n[r])>.99&&(o+=1);e.instant=Math.sqrt(i/n.length),e.slow=.95*e.slow+.05*e.instant,e.clip=o/n.length;let a=t.inputBuffer,s=t.outputBuffer;s.copyToChannel&&s.copyToChannel(a.getChannelData(0),0,0)}:e.logger.error("initMonitor:参数不够")}initWebAudio(){this.context&&this.destination?(this.gainFilter=this.context.createGain(),this.gainFilter.gain.value=this.gain):this.logger.error("initMonitor:参数不够")}initAudioIn(){const e=this;if(!e.context||!e.gainFilter||!e.destination)return this.logger.error("initAudioIn:参数不够"),null;for(var t=0;t<e.audioInArr.length;t++)e.audioInArr[t].connect(e.gainFilter);e.mixAudioConf.state===a.AuidoMixingState.UNSTART&&(e.script&&e.analyzeDestination&&(e.gainFilter.connect(e.script),e.script.connect(e.analyzeDestination)),e.gainFilter.connect(e.destination)),this.logger.log("WebAudio: initAudioIn: 初始化音频 state: ",e.context.state),"running"!==e.context.state&&e.context.resume().then((()=>{this.context&&this.logger.log("WebAudio: addMs: 状态变更成功 state: ",this.context.state)})).catch((e=>{this.logger.log("WebAudio: addMs: 状态变更出错: ",e.name,e.message,e),this.context&&this.context.resume()}))}updateTracks(e){for(let t=this.audioInArr.length-1;t>=0;t--){const r=this.audioInArr[t];e.find((e=>e.track&&r&&e.track.id===r.id))||(this.logger.log("updateTracks，删除",r.label,r.id),this.audioInArr.splice(t,1),r.disconnect())}for(let t=e.length-1;t>=0;t--){const r=e[t];if(!this.audioInArr.find((e=>r.track&&r.track.id===e.id))&&r.track)if(this.context){const e=new MediaStream;e.addTrack(r.track);const t={context:this.context,id:r.track.id,label:r.track.label,audioNode:this.createSource({mediaStream:e}),type:r.type},n=new d(t);n.gainNode.gain.value=this.gain,this.audioInArr.push(n)}else this.logger.error("updateTracks：没有audioContext")}this.initAudioIn()}removeTrack(e){for(let t=this.audioInArr.length-1;t>=0;t--){const r=this.audioInArr[t];r.id===e.id&&(this.logger.log("removeTrack，删除track",e.id,e.label),this.audioInArr.splice(t,1),r.disconnect())}}setGain(e,t){for(let r=0;r<this.audioInArr.length;r++){const n=this.audioInArr[r];t&&t!==n.type||(this.logger.log("WebAudio.setGain",t,e,n.type,n.label,n.id),n.gainNode.gain.value=e)}t||(this.gain=e)}getGain(){if(this.gainFilter)return this.gain}getGainMin(){let e=1;for(let t=0;t<this.audioInArr.length;t++){const r=this.audioInArr[t];r.gainNode.gain.value<e&&(e=r.gainNode.gain.value)}return e}stop(){this.gainFilter&&(this.script?this.script.disconnect(0):this.gainFilter.disconnect(0),this.instant=0)}start(){this.gainFilter&&this.destination&&(this.script&&this.analyzeDestination&&(this.gainFilter.connect(this.script),this.script.connect(this.analyzeDestination)),this.gainFilter.connect(this.destination))}resetMixConf(){var e,t;if(null===(e=this.mixAudioConf.audioSource)||void 0===e||e.disconnect(0),null===(t=this.mixAudioConf.gainFilter)||void 0===t||t.disconnect(0),this.mixAudioConf.replace&&(this.logger.log("伴音停止了，恢复mic"),this.gainFilter&&this.destination)){for(var r=0;r<this.audioInArr.length;r++)this.audioInArr[r].gainNode.connect(this.gainFilter);this.script&&this.analyzeDestination&&(this.gainFilter.connect(this.script),this.script.connect(this.analyzeDestination)),this.gainFilter.connect(this.destination)}this.mixAudioConf={state:a.AuidoMixingState.UNSTART,audioSource:null,gainFilter:null,replace:!1,cycle:0,pauseTime:0,startTime:0,totalTime:0,volume:1,playStartTime:0,setPlayStartTime:0,auidoMixingEnd:null},this.gainFilter&&1===this.gainFilter.gain.value&&this.emit("audioFilePlaybackCompleted")}startMix(e){if(!this.context||!this.destination||!this.gainFilter)return this.logger.error("initMonitor:参数不够"),Promise.reject(new s.default({code:c.default.INVALID_PARAMETER,message:"initMonitor: invalid parameter"}));if(this.logger.log("开始混音: ",JSON.stringify(e)),this.mixAudioConf.audioSource=this.context.createBufferSource(),this.mixAudioConf.gainFilter=this.context.createGain(),this.mixAudioConf.audioSource.buffer=e.buffer,this.mixAudioConf.replace=e.replace,this.mixAudioConf.cycle=e.cycle,this.mixAudioConf.playStartTime=e.playStartTime,this.mixAudioConf.volume=e.volume?e.volume/255:1,this.mixAudioConf.auidoMixingEnd=e.auidoMixingEnd,this.mixAudioConf.audioSource.connect(this.mixAudioConf.gainFilter),this.mixAudioConf.gainFilter.connect(this.gainFilter),this.musicDestination&&this.mixAudioConf.gainFilter.connect(this.musicDestination),e.replace)for(var t=0;t<this.audioInArr.length;t++){const e=this.audioInArr[t];try{e.gainNode.disconnect(this.gainFilter),this.logger.log(`已断开音频：【${e.label}】`)}catch(t){"InvalidAccessError"===t.name?this.logger.log(`音频断开前未连接：【${e.label}】`):this.logger.error(`无法断开音频:【${e.label}】${t.name}`,t.message)}}if(this.mixAudioConf.audioSource.onended=e=>{this.audioEnd(e)},this.mixAudioConf.totalTime=e.buffer.duration,(this.mixAudioConf.playStartTime<0||this.mixAudioConf.playStartTime>=this.mixAudioConf.totalTime)&&(this.mixAudioConf.playStartTime=0),this.logger.log("设置音量:",this.mixAudioConf.volume),this.mixAudioConf.gainFilter.gain.value=this.mixAudioConf.volume,e.loopback&&e.cycle>1){this.mixAudioConf.audioSource.loop=e.loopback;const t=e.cycle*this.mixAudioConf.totalTime-this.mixAudioConf.playStartTime;this.logger.log("循环播放: options.playStartTime: ",this.mixAudioConf.playStartTime),this.logger.log("循环播放: totalTime: ",t),this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime,t-1)}else e.loopback&&1==e.cycle?(this.mixAudioConf.audioSource.loop=!1,this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime)):(this.logger.log("无限循环播放 loop: ",e.loopback),this.mixAudioConf.audioSource.loop=e.loopback,this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime));return this.mixAudioConf.state=a.AuidoMixingState.PLAYED,this.mixAudioConf.startTime=Date.now(),Promise.resolve()}pauseAudioMixing(){if(!this.mixAudioConf.audioSource||!this.mixAudioConf.gainFilter)return void this.logger.error("pauseAudioMixing:参数不够");this.logger.log("暂停混音"),this.mixAudioConf.audioSource.onended=null,this.mixAudioConf.audioSource.disconnect(0),this.mixAudioConf.gainFilter.disconnect(0),this.mixAudioConf.audioSource.stop(),this.mixAudioConf.pauseTime=Date.now(),this.mixAudioConf.state=a.AuidoMixingState.PAUSED;let e=(this.mixAudioConf.pauseTime-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return this.logger.log("已经播放的时间: ",e),e>this.mixAudioConf.totalTime&&(e%=this.mixAudioConf.totalTime),this.logger.log("暂停位置:",e),Promise.resolve()}resumeAudioMixing(e){return this.logger.log("恢复混音"),this.mixAudioConf.pauseTime=0,e.volume=255*this.mixAudioConf.volume,this.startMix(e)}stopAudioMixing(e=!0){return this.mixAudioConf.audioSource&&this.mixAudioConf.gainFilter?(this.logger.log("开始停止混音, isFinished: ",e),this.mixAudioConf.audioSource.onended=null,this.mixAudioConf.audioSource.disconnect(0),this.mixAudioConf.gainFilter.disconnect(0),this.mixAudioConf.audioSource.stop(),this.mixAudioConf.state=a.AuidoMixingState.STOPED,e&&this.resetMixConf(),this.logger.log("混音已停止"),Promise.resolve()):(this.logger.error("stopAudioMixing:参数不够"),Promise.reject(new s.default({code:c.default.INVALID_PARAMETER,message:"stopAudioMixing: invalid parameter"})))}audioEnd(e){if(this.mixAudioConf.state===a.AuidoMixingState.PLAYED){if(!(this.mixAudioConf.audioSource&&this.mixAudioConf.audioSource.loop&&this.mixAudioConf.cycle<=0))return this.logger.log("伴音播放完成: ",this.mixAudioConf),this.mixAudioConf.audioSource&&(this.mixAudioConf.audioSource.onended=null),this.mixAudioConf.auidoMixingEnd&&(this.mixAudioConf.auidoMixingEnd(e),this.mixAudioConf.auidoMixingEnd=null),this.resetMixConf(),Promise.resolve();this.logger.log("无限循环时，伴音播放完成event: ",e)}else this.logger.error("audioEnd:参数不够")}setAudioMixingVolume(e){if(this.mixAudioConf.gainFilter)return this.mixAudioConf.gainFilter.gain.value=e/255,this.mixAudioConf.volume=this.mixAudioConf.gainFilter.gain.value,Promise.resolve();this.logger.error("setAudioMixingVolume:参数不够")}setAudioMixingPlayTime(e){return this.mixAudioConf.state===a.AuidoMixingState.PLAYED&&(this.mixAudioConf.setPlayStartTime=e.playStartTime),e.volume=255*this.mixAudioConf.volume,this.startMix(e)}getAudioMixingPlayedTime(){let e=Date.now();this.mixAudioConf.state==a.AuidoMixingState.PAUSED&&this.mixAudioConf.pauseTime&&(this.logger.log("当前是暂停状态"),e=this.mixAudioConf.pauseTime);let t=(e-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return t>this.mixAudioConf.totalTime&&(t%=this.mixAudioConf.totalTime),{playedTime:t}}getAudioMixingTotalTime(){return{totalTime:this.mixAudioConf.totalTime}}createAudioBufferSource(e){if(!this.context||!this.destination||!this.gainFilter)throw this.logger.error("initMonitor:参数不够"),new s.default({code:c.default.INVALID_PARAMETER,message:"createAudioBufferSource: invalid parameter"});const t=this.context.createBufferSource();t.buffer=e;const r=this.context.createGain();return t.connect(r),{sourceNode:t,gainNode:r}}startAudioEffectMix(e){if(!this.context||!this.destination||!this.gainFilter)return this.logger.error("initMonitor:参数不够"),Promise.reject(new s.default({code:c.default.INVALID_PARAMETER,message:"initMonitor: invalid parameter"}));const{sourceNode:t,gainNode:r,playOverTime:n,playStartTime:i,volume:o,cycle:u}=e;r&&t&&(this.logger.log("startAudioEffectMix: ",JSON.stringify(e)),r.connect(this.gainFilter),this.musicDestination&&r.connect(this.musicDestination),r.gain.value=o/100,u>1?(t.loop=!0,t.start(0,i,n)):(t.loop=!1,t.start(0,i)),this.mixAudioConf.state=a.AuidoMixingState.PLAYED,this.mixAudioConf.startTime=Date.now())}stopAudioEffectMix(e){const{sourceNode:t,gainNode:r,playOverTime:n,playStartTime:i,volume:o,cycle:a}=e;if(!r||!t)return this.logger.error("stopAudioEffectMix: 参数不够"),Promise.reject(new s.default({code:c.default.INVALID_PARAMETER,message:"stopAudioEffectMix: invalid parameter"}));this.logger.log("stopAudioEffectMix: ",JSON.stringify(e)),t.onended=null,t.disconnect(0),r.disconnect(0),t.stop()}destroy(){this.logger.log("AudioContext 清除"),this.instant=0,this.slow=0,this.clip=0,this.gainFilter&&this.gainFilter.disconnect(0),this.script&&this.script.disconnect(0);for(let e=0;e<this.audioInArr.length;e++)this.audioInArr[e]&&this.audioInArr[e].disconnect();this.audioInArr=[]}getVolumeData(){return this.instant.toFixed(2)}}t.WebAudio=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AuidoMixingState=void 0,t.AuidoMixingState={UNSTART:"MIX_UNSTART",STARTING:"MIX_STARTING",PLAYED:"MIX_PLAYING",PAUSED:"MIX_PAUSED",STOPED:"MIX_STOPED"}},function(e,t){},function(e,t,r){var n=r(171)(!0);r(101)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(35),i=r(36),o=r(103),a=r(18),s=r(37),c=r(172),u=r(51),l=r(177),d=r(6)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,r,h,m,g,v){c(r,t,h);var y,b,S,_=function(e){if(!p&&e in x)return x[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},M=t+" Iterator",T="values"==m,w=!1,x=e.prototype,I=x[d]||x["@@iterator"]||m&&x[m],E=I||_(m),A=m?T?_("entries"):E:void 0,C="Array"==t&&x.entries||I;if(C&&(S=l(C.call(new e)))!==Object.prototype&&S.next&&(u(S,M,!0),n||"function"==typeof S[d]||a(S,d,f)),T&&I&&"values"!==I.name&&(w=!0,E=function(){return I.call(this)}),n&&!v||!p&&!w&&x[d]||a(x,d,E),s[t]=E,s[M]=f,m)if(y={values:T?E:_("values"),keys:g?E:_("keys"),entries:A},v)for(b in y)b in x||o(x,b,y[b]);else i(i.P+i.F*(p||w),t,y);return y}},function(e,t,r){e.exports=!r(21)&&!r(48)((function(){return 7!=Object.defineProperty(r(66)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){e.exports=r(18)},function(e,t,r){var n=r(14),i=r(173),o=r(71),a=r(69)("IE_PROTO"),s=function(){},c=function(){var e,t=r(66)("iframe"),n=o.length;for(t.style.display="none",r(107).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[o[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[a]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t,r){var n=r(22),i=r(28),o=r(175)(!1),a=r(69)("IE_PROTO");e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)r!=a&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){var n=r(64),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=r(5).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(65);e.exports=function(e){return Object(n(e))}},function(e,t,r){r(178);for(var n=r(5),i=r(18),o=r(37),a=r(6)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var u=s[c],l=n[u],d=l&&l.prototype;d&&!d[a]&&i(d,a,u),o[u]=o.Array}},function(e,t,r){var n=r(38),i=r(6)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:o?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,r){var n=r(14),i=r(47),o=r(6)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||null==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n,i,o,a=r(46),s=r(187),c=r(107),u=r(66),l=r(5),d=l.process,p=l.setImmediate,f=l.clearImmediate,h=l.MessageChannel,m=l.Dispatch,g=0,v={},y=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){y.call(e.data)};p&&f||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return v[++g]=function(){s("function"==typeof e?e:Function(e),t)},n(g),g},f=function(e){delete v[e]},"process"==r(38)(d)?n=function(e){d.nextTick(a(y,e,1))}:m&&m.now?n=function(e){m.now(a(y,e,1))}:h?(o=(i=new h).port2,i.port1.onmessage=b,n=a(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):n="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),y.call(e)}}:function(e){setTimeout(a(y,e,1),0)}),e.exports={set:p,clear:f}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(14),i=r(20),o=r(72);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){(function(n){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(195)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(116))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=s(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||l||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){var n=o(r(62)),i=o(r(63));function o(e){return e&&e.__esModule?e:{default:e}}var a=r(118).EventEmitter,s=r(52);e.exports=class extends a{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new s("EnhancedEventEmitter")}safeEmit(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}safeEmitAsPromise(e){for(var t=this,r=arguments.length,o=Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return(0,i.default)(n.default.mark((function r(){return n.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){t.safeEmit.apply(t,[e].concat(o,[r,n]))})));case 1:case"end":return r.stop()}}),r,t)})))()}}},function(e,t,r){var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}v(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,a,s;if(u(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=p.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function v(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,l=g(c,u);for(r=0;r<u;++r)o(l[r],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,o,a;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},s.prototype.listenerCount=m,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){var n,i=(n=r(197))&&n.__esModule?n:{default:n},o=r(52),a=r(210).generateRandomNumber,s=r(57),c=new o("Message");e.exports=class{static parse(e){var t=void 0,r={};try{t=s.parse(e)}catch(e){return void c.error("parse() | invalid JSONbig: %s",e)}if("object"===(void 0===t?"undefined":(0,i.default)(t))&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void c.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void c.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void c.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void c.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void c.error("parse() | missing/invalid method field");r.id=t.id,r.method=t.method,r.data=t.data||{}}return r}c.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:a(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(105),i=r(71).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.parseScalabilityMode=t.detectDevice=t.Device=t.version=t.types=void 0;const a=r(123);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return a.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return a.detectDevice}});const s=o(r(225));t.types=s,t.version="__MEDIASOUP_CLIENT_VERSION__";var c=r(228);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return c.parse}})},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;const a=o(r(124)),s=r(7),c=r(39),u=r(40),l=o(r(23)),d=o(r(41)),p=r(125),f=r(218),h=r(222),m=r(223),g="Device";function v(){if("object"==typeof navigator&&"string"==typeof navigator.userAgent){const e=navigator.userAgent,t=a.getParser(e);return t.getEngine(),t.satisfies({chrome:">=72",chromium:">=72"})?"Chrome74":t.satisfies({firefox:">=60"})?"Firefox60":t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")||"WeChat"===t.getBrowserName()&&t.getOS()&&"iOS"===t.getOS().name?"Safari12":(s.Logger.warn(g,"this._detectDevice() | browser not supported [name:%s, version:%s], using Chrome72 as default",t.getBrowserName(),t.getBrowserVersion()),"Chrome74")}return s.Logger.warn(g,"this._detectDevice() | unknown device, using Chrome 72 as default"),"Chrome74"}t.detectDevice=v,t.Device=class{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new c.EnhancedEventEmitter,s.Logger.debug(g,"constructor()"),r){if(s.Logger.warn(g,"constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)s.Logger.debug(g,"constructor() | handler given: %s",e);else{if(!(e=v()))throw new u.UnsupportedError("device not supported");s.Logger.debug(g,"constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=f.Chrome74.createFactory();break;case"Safari12":this._handlerFactory=m.Safari12.createFactory();break;case"Firefox60":this._handlerFactory=h.Firefox60.createFactory();break;default:console.error(`unknown handlerName "${e}, using Chrome 74 as default"`),this._handlerFactory=f.Chrome74.createFactory()}}const n=this._handlerFactory();this._handlerName=n.name,n.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new u.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new u.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;s.Logger.debug(g,"load() [routerRtpCapabilities:%o]",e),e=l.clone(e,void 0);try{if(this._loaded)throw new u.InvalidStateError("already loaded");d.validateRtpCapabilities(e),t=this._handlerFactory();const r=await t.getNativeRtpCapabilities();s.Logger.debug(g,"load() | got native RTP capabilities:%o",r),d.validateRtpCapabilities(r),this._extendedRtpCapabilities=d.getExtendedRtpCapabilities(r,e),s.Logger.debug(g,"load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=d.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=d.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=d.getRecvRtpCapabilities(this._extendedRtpCapabilities),d.validateRtpCapabilities(this._recvRtpCapabilities),s.Logger.debug(g,"load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),s.Logger.debug(g,"load() | got native SCTP capabilities:%o",this._sctpCapabilities),d.validateSctpCapabilities(this._sctpCapabilities),s.Logger.debug(g,"load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new u.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:u,appData:l={}}){return s.Logger.debug(g,"createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:u,appData:l})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:u,appData:l={}}){return s.Logger.debug(g,"createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:u,appData:l})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:l,appData:d={}}){if(!this._loaded)throw new u.InvalidStateError("not loaded");if(d&&"object"!=typeof d)throw new TypeError("if given, appData must be an object");const f=new p.Transport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:l,appData:d,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",f),f}}},function(e,t,r){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),o=e.getVersionPrecision(r),a=Math.max(i,o),s=0,c=e.map([t,r],(function(t){var r=a-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(s=a-Math.min(i,o)),a-=1;a>=s;){if(c[0][a]>c[1][a])return 1;if(c[0][a]===c[1][a]){if(a===s)return 0;a-=1}else if(c[0][a]<c[1][a])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[e].concat(o));var s=function(){var e=o[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=o.length;t<r;t+=1)s();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},o=r(18),a=function(){function e(){}var t;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},(t=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e,t),e}();t.default=a,e.exports=t.default},91:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=c(r(92)),i=c(r(93)),o=c(r(94)),a=c(r(95)),s=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=s.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=s.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=s.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=s.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return s.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},o=0;if(Object.keys(e).forEach((function(t){var a=e[t];"string"==typeof a?(i[t]=a,o+=1):"object"==typeof a&&(r[t]=a,n+=1)})),n>0){var a=Object.keys(r),c=s.default.find(a,(function(e){return t.isOS(e)}));if(c){var u=this.satisfies(r[c]);if(void 0!==u)return u}var l=s.default.find(a,(function(e){return t.isPlatform(e)}));if(l){var d=this.satisfies(r[l]);if(void 0!==d)return d}}if(o>0){var p=Object.keys(i),f=s.default.find(p,(function(e){return t.isBrowser(e,!0)}));if(void 0!==f)return this.compareVersion(i[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=s.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(s.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=u,e.exports=t.default},92:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},o=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=a,e.exports=t.default},93:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},o=r(18),a=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:o.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:o.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:o.OS_MAP.iOS},r=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:o.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:o.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:o.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:o.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.PlayStation4,version:t}}}];t.default=a,e.exports=t.default},94:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},o=r(18),a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];t.default=a,e.exports=t.default},95:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},o=r(18),a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:o.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:o.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:o.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:o.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:o.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:o.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=a,e.exports=t.default}})},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;const s=r(217),c=r(7),u=r(39),l=r(40),d=o(r(23)),p=o(r(41)),f=r(126),h=r(127),m=a(r(1)),g=a(r(0)),v="Transport";class y extends u.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:p,additionalSettings:f,proprietaryConstraints:h,appData:m,handlerFactory:g,extendedRtpCapabilities:y,canProduceByKind:b}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new s.AwaitQueue({ClosedErrorClass:l.InvalidStateError}),this._observer=new u.EnhancedEventEmitter,this.send=[],this.recv=[],c.Logger.debug(v,"constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=y,this._canProduceByKind=b,this._maxSctpMessageSize=o?o.maxMessageSize:null,delete(f=d.clone(f,{})).iceServers,delete f.iceTransportPolicy,delete f.bundlePolicy,delete f.rtcpMuxPolicy,delete f.sdpSemantics,this._handler=g(),this._handler.run({direction:e,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:p,additionalSettings:f,proprietaryConstraints:h,extendedRtpCapabilities:y,appData:m}),this._appData=m,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new m.default({code:g.default.APPDATA_ERROR,message:"cannot override appData object"})}get observer(){return this._observer}close(){if(!this._closed){c.Logger.debug(v,"close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new l.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(c.Logger.debug(v,"restartIce()"),this._closed)throw new l.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((async()=>this._handler.restartIce(e)),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(c.Logger.debug(v,"updateIceServers()"),this._closed)throw new l.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push((async()=>this._handler.updateIceServers(e)),"transport.updateIceServers()")}async produce({track:e,trackLow:t,encodings:r,codecOptions:n,codec:i,stopTracks:o=!1,disableTrackOnPause:a=!0,zeroRtpOnPause:s=!1,appData:u}){if(c.Logger.debug(v,"produce()"),!e)throw new TypeError("missing track");if("send"!==this._direction)throw new l.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new l.UnsupportedError("cannot produce "+e.kind);if("ended"===e.readyState)throw new l.InvalidStateError("track ended");if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(u&&"object"!=typeof u)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{let c;if(r&&!Array.isArray(r))throw TypeError("encodings must be an array");r&&0===r.length?c=void 0:r&&(c=r.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));const{localId:l,localIdLow:d,rtpParameters:h,rtpSender:m,rtpSenderLow:g,dtlsParameters:v,offer:y}=await this._handler.send({track:e,trackLow:t,encodings:c,codecOptions:n,appData:u,codec:i});m&&this.updateSenderInfo(m,"screenShare"===u.mediaType?"screen":u.mediaType,"high",l),g&&d&&this.updateSenderInfo(g,"screenShare"===u.mediaType?"screen":u.mediaType,"low",d);try{p.validateRtpParameters(h);const{id:r}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:h,track:e,trackLow:t,appData:u,localDtlsParameters:v,offer:y}),n=new f.Producer({id:r,localId:l,localIdLow:d,rtpSender:m,rtpSenderLow:g,track:e,trackLow:t,rtpParameters:h,stopTracks:o,disableTrackOnPause:a,zeroRtpOnPause:s,appData:u});return this._producers.set(n.id,n),this._handleProducer(n),this._observer.safeEmit("newproducer",n),n}catch(e){throw this._handler.stopSending(l,u.mediaType).catch((()=>{})),e}}),"transport.produce()").catch((e=>{throw e}))}async fillRemoteRecvSdp({kind:e,appData:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,sendingRtpParameters:a,codecOptions:s,offer:c,audioProfile:u,codec:l}){await this._handler.fillRemoteRecvSdp({kind:e,appData:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,sendingRtpParameters:a,codecOptions:s,offer:c,codec:l,audioProfile:u})}async prepareLocalSdp(e,t,r){try{const{dtlsParameters:n,rtpCapabilities:i,offer:o,mid:a,iceUfragReg:s}=await this._handler.prepareLocalSdp(e,r);if(!this._recvRtpCapabilities||!p.canSend("audio",this._recvRtpCapabilities)||!p.canSend("video",this._recvRtpCapabilities)){let e=p.getExtendedRtpCapabilities(i,t);this._recvRtpCapabilities=p.getRecvRtpCapabilities(e),p.validateRtpCapabilities(this._recvRtpCapabilities)}return{dtlsParameters:n,rtpCapabilities:this._recvRtpCapabilities,offer:o,mid:a,iceUfragReg:s}}catch(e){throw e}}async recoverLocalSdp(e,t,r){try{return void await this._handler.recoverTransceiver(e,t,r)}catch(e){throw e}}updateSenderInfo(e,t,r,n){let i=this.send.find((t=>t.sender===e));return i?(i.mediaType!==t||i.streamType||r||i.localId!==n)&&(c.Logger.debug(v,`Sender Change. mediaType:${i.mediaType} => ${t}, StreamType: ${i.streamType} => ${r}, LocalId: ${i.localId} => ${n} index: ${i.index}`),i.mediaType=t,i.streamType=r,i.localId=n,i.index=0):(i={sender:e,mediaType:t,streamType:r,localId:n,index:0},this.send.unshift(i)),i}updateReceiverInfo(e,t,r,n){let i=this.recv.find((t=>t.receiver===e));return i?i.uid===t&&i.mediaType===r&&i.localId===n||(c.Logger.debug(v,`Receiver Change. uid:${i.uid} => ${t}, mediaType:${i.mediaType} => ${r} localId: ${i.localId} => ${n} index: ${i.index}`),i.uid=t,i.mediaType=r,i.localId=n,i.index=0):(i={receiver:e,uid:t,mediaType:r,localId:n,index:0},this.recv.unshift(i)),i}async consume({id:e,producerId:t,kind:r,uid:n,mediaType:i,rtpParameters:o,appData:a={},offer:s,iceParameters:u,iceCandidates:f,dtlsParameters:m,sctpParameters:g,probeSSrc:y}){if(c.Logger.debug(v,"consume()"),o=d.clone(o,void 0),this._closed)throw new l.InvalidStateError("closed");if("recv"!==this._direction)throw new l.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(a&&"object"!=typeof a)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{p.canReceive(o,this._extendedRtpCapabilities);const{localId:c,rtpReceiver:l,track:d}=await this._handler.receive({iceParameters:u,iceCandidates:f,dtlsParameters:m,sctpParameters:g,trackId:e,kind:r,rtpParameters:o,offer:s,probeSSrc:y,remoteUid:a.remoteUid,extendedRtpCapabilities:this._extendedRtpCapabilities});l&&this.updateReceiverInfo(l,n,i,c);const v=new h.Consumer({id:e,localId:c,producerId:t,rtpReceiver:l,track:d,rtpParameters:o,appData:a});return this._consumers.set(v.id,v),this._handleConsumer(v),this._observer.safeEmit("newconsumer",v),v}),"transport.consume()")}_handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},t,r)=>{this._closed?r(new l.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(c.Logger.debug(v,"connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}_handleProducer(e){e.on("@close",(()=>{this._closed||(c.Logger.warn(v,"producer 关闭: ",e.localId),this._awaitQueue.push((async()=>this._handler.stopSending(e.localId,e.appData.mediaType))).catch((e=>c.Logger.warn(v,"producer.close() failed:%o",e))))})),e.on("@replacetrack",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.replaceTrack(e.localId,t)),"producer @replacetrack event").then(r).catch(n)})),e.on("@setmaxspatiallayer",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.setMaxSpatialLayer(e.localId,t)),"producer @setmaxspatiallayer event").then(r).catch(n)})),e.on("@setrtpencodingparameters",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.setRtpEncodingParameters(e.localId,t)),"producer @setrtpencodingparameters event").then(r).catch(n)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new l.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}_handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopReceiving(e.localId)),"consumer @close event").catch((()=>{}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new l.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}}t.Transport=y},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;const i=r(7),o=r(39),a=r(40),s=n(r(1)),c=n(r(0)),u=r(2),l="Producer";class d extends o.EnhancedEventEmitter{constructor({id:e,localId:t,localIdLow:r,rtpSender:n,rtpSenderLow:a,track:s,trackLow:c,rtpParameters:u,stopTracks:d,disableTrackOnPause:p,zeroRtpOnPause:f,appData:h}){super(),this._closed=!1,this._observer=new o.EnhancedEventEmitter,i.Logger.debug(l,"constructor()",t),this._id=e,this._localId=t,this._localIdLow=r,this._rtpSender=n,this._rtpSenderLow=a,this._track=s,this._trackLow=c,this._kind=s.kind,this._rtpParameters=u,this._paused=!!p&&!s.enabled,this._maxSpatialLayer=void 0,this._stopTracks=d,this._disableTrackOnPause=p,this._zeroRtpOnPause=f,this._appData=h,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new s.default({code:c.default.APPDATA_ERROR,message:"cannot override appData object"})}get observer(){return this._observer}close(){this._closed||(i.Logger.debug(l,"close()"),this._closed=!0,this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(i.Logger.debug(l,"transportClosed()"),this._closed=!0,this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new a.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){i.Logger.debug(l,"pause()"),this._closed?i.Logger.error(l,"pause() | Producer closed"):(this._paused=!0,this._disableTrackOnPause&&(this._track&&(this._track.enabled=!1),this._trackLow&&(this._trackLow.enabled=!1)),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){i.Logger.debug(l,"resume()"),this._closed?i.Logger.error(l,"resume() | Producer closed"):(this._paused=!1,this._disableTrackOnPause&&(this._track&&(this._track.enabled=!0),this._trackLow&&(this._trackLow.enabled=!0)),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch((()=>{})),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(i.Logger.debug(l,"replaceTrack()"),this._closed){if(e&&this._stopTracks)try{if("audio"===e.kind){const t=u.getParameters().tracks.audio.findIndex((t=>e===t));i.Logger.warn(`Stopping AUDIOTRACK#${t} ${e.id}, ${e.label}, ${e.readyState}`)}else{const t=u.getParameters().tracks.video.findIndex((t=>e===t));i.Logger.warn(`Stopping VIDEOTRACK#${t} ${e.id}, ${e.label}, ${e.readyState}`)}e.stop()}catch(e){}throw new a.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new a.InvalidStateError("track ended");e!==this._track?(this._zeroRtpOnPause&&this._paused||await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()):i.Logger.debug(l,"replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new a.InvalidStateError("closed");if("video"!==this._kind)throw new a.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new a.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){i.Logger.debug(l,'track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){this._track&&i.Logger.warn(l,"don not stop sender track")}}t.Producer=d},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;const i=r(7),o=r(39),a=r(40),s=n(r(1)),c=n(r(0)),u="Consumer";class l extends o.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:n,track:a,rtpParameters:s,appData:c}){super(),this._closed=!1,this._observer=new o.EnhancedEventEmitter,i.Logger.debug(u,"constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=n,this._track=a,this._rtpParameters=s,this._paused=!a.enabled,this._appData=c,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new s.default({code:c.default.APPDATA_ERROR,message:"cannot override appData object"})}get observer(){return this._observer}close(){this._closed||(i.Logger.debug(u,"close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(i.Logger.debug(u,"transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new a.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){i.Logger.debug(u,"pause()"),this._closed?i.Logger.error(u,"pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause"))}resume(){i.Logger.debug(u,"resume()"),this._closed?i.Logger.error(u,"resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume"))}_onTrackEnded(){i.Logger.debug(u,'track "ended" event, %o, %s',this.id,this.kind),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){i.Logger.warn(u,"don not stop receiver track")}}t.Consumer=l},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach((function(e){r[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DataReport=void 0;const n=r(56),i=r(25),o=r(13);let a="https://statistic.live.126.net/statics/report/common/form";t.DataReport=class{constructor(e){this.configs=e||{};const t=e.adapterRef;e.sdkRef,this.adapterRef=t;let r=t.instance,n=t.channelInfo||{};this.cid=n.cid||n.channelId||0,this.uid=n.uid||0;const i=r._params&&r._params.appkey;this.time=n.clientNtpTime-n.T4,this.common={name:"common",ver:"2.0",sdk_type:"nrtc2",session_id:this.adapterRef.deviceId,app_key:i},this.eventKeys=[],this.eventMap={},this.api=[],this.heartbeat=null}addEvent(e,t){return-1==this.eventKeys.indexOf(e)&&this.eventKeys.push(e),t.time?t.time=t.time+this.time:(this.adapterRef.logger.warn(`addEvent:事件${e}没有time属性。使用当前时间戳`),t.time=Date.now()),this.eventMap[e]=t,this}updateCommon(e){return Object.assign(this.common,e),this}setHeartbeat(e){this.heartbeat=e;const t=Object.keys(this.adapterRef.apiEvent),r=Object.keys(this.adapterRef.apiEvents),n=t.concat(r.filter((e=>!t.includes(e))));let i=[];for(let e in n){const t=n[e];this.adapterRef.apiEvents[t]&&this.adapterRef.apiEvents[t].length?(i=i.concat(this.adapterRef.apiEvents[t]),this.adapterRef.apiEvents[t]=[]):this.adapterRef.apiEvent[t]&&this.adapterRef.apiEvent[t].length&&(i=i.concat(this.adapterRef.apiEvent[t]),this.adapterRef.apiEvent[t]=[])}return this.api=this.api.concat(i),this}setNetworkChange(e){return this.addEvent("networkChange",e),this}setLogin(e){var t,r,n;e.sdk_ver=e.sdk_ver||i.SDK_VERSION,e.platform=e.platform||"Web",e.app_key=e.app_key||this.common.app_key,e.meeting_mode=e.meeting_mode||1,e.model=e.model,e.build=i.BUILD,e.supported_codec_send=null===(t=this.adapterRef.mediaCapability.supportedCodecSend)||void 0===t?void 0:t.join(","),e.supported_codec_recv=null===(r=this.adapterRef.mediaCapability.supportedCodecRecv)||void 0===r?void 0:r.join(","),e.preferred_codec_send=null===(n=this.adapterRef.mediaCapability.preferredCodecSend.video)||void 0===n?void 0:n.join(","),e.extra_info=JSON.stringify({userAgent:o.USER_AGENT}),this.addEvent("login",e)}setRelogin(e){this.addEvent("relogin",e)}setLogout(e){this.addEvent("logout",e)}deviceAbnormal(e){this.addEvent("deviceAbnormal",e)}setDisconnect(e){this.addEvent("disconnect",e)}setRecvFirstFrame(e){this.addEvent("recvFirstFrame",e)}setSendFirstPackage(e){this.addEvent("firstPacketSent",e)}setRecvFirstPackage(e){this.addEvent("recvFirstPackage",e)}setFunction(e){this.addEvent("function",e)}reset(){this.eventKeys=[],this.api=[],this.heartbeat=null}send(e){let t={common:this.common};if(e||(e=this.eventKeys),this.heartbeat&&(t.heartbeat=this.heartbeat,this.api.length&&(this.api.forEach((e=>{e.uid||(e.uid=this.adapterRef.channelInfo&&this.adapterRef.channelInfo.uid),e.cid||(e.cid=this.adapterRef.channelInfo&&this.adapterRef.channelInfo.cid),e.param&&"object"==typeof e.param&&void 0!==e.param.clientUid&&(e.param.clientUid=e.uid)})),t.event={apiEvent:this.api},this.api=[])),e){if(e.length){let r=0,n={};for(let t=e.length-1;t>=0;t--){const i=e[t];this.eventMap[i]&&(r++,n[i]=this.eventMap[i],delete this.eventMap[i],e.splice(t,1))}r&&(t.event=n)}}else if(!this.heartbeat)return this;return this.adapterRef.instance._params.neRtcServerAddresses.statisticsServer&&(a=this.adapterRef.instance._params.neRtcServerAddresses.statisticsServer),n.ajax({type:"post",url:a,data:t,header:{sdktype:this.common.sdk_type,appkey:this.common.app_key,platform:"web",sdkver:i.SDK_VERSION}}).then((t=>{e===this.eventKeys&&this.reset()})).catch((e=>{this.adapterRef.logger.log("dataReport, send error: ",e.name,e.message,e),this.reset()})),this}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.randomId=t.generateUUID=void 0,t.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},t.randomId=function(){return"xxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}},function(e,t,r){var n=e.exports=r(238);n.build="light",n.load=function(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)},n.loadSync=function(e,t){return t||(t=new n.Root),t.loadSync(e)},n.encoder=r(136),n.decoder=r(137),n.verifier=r(138),n.converter=r(139),n.ReflectionObject=r(29),n.Namespace=r(43),n.Root=r(86),n.Enum=r(8),n.Type=r(81),n.Field=r(24),n.OneOf=r(44),n.MapField=r(82),n.Service=r(83),n.Method=r(84),n.Message=r(85),n.wrappers=r(140),n.types=r(30),n.util=r(4),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},function(e,t,r){e.exports=function(e,t){for(var r=new Array(arguments.length-1),n=0,i=2,o=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,a){r[n]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,a(e))}}))}},function(module,exports,__webpack_require__){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){t.Service=r(247)},function(e,t,r){e.exports={}},function(e,t,r){e.exports=function(e){for(var t,r=o.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),s=e.fieldsArray.slice().sort(o.compareFieldsById),c=0;c<s.length;++c){var u=s[c].resolve(),l=e._fieldsArray.indexOf(u),d=u.resolvedType instanceof n?"int32":u.type,p=i.basic[d];t="m"+o.safeProp(u.name),u.map?(r("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",t,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===p?r("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",l,t):r(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|p,d,t),r("}")("}")):u.repeated?(r("if(%s!=null&&%s.length){",t,t),u.packed&&void 0!==i.packed[d]?r("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",d,t)("w.ldelim()"):(r("for(var i=0;i<%s.length;++i)",t),void 0===p?a(r,u,l,t+"[i]"):r("w.uint32(%i).%s(%s[i])",(u.id<<3|p)>>>0,d,t)),r("}")):(u.optional&&r("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",t,u.name),void 0===p?a(r,u,l,t):r("w.uint32(%i).%s(%s)",(u.id<<3|p)>>>0,d,t))}return r("return w")};var n=r(8),i=r(30),o=r(4);function a(e,t,r,n){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}},function(e,t,r){e.exports=function(e){var t=o.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var r=0;r<e.fieldsArray.length;++r){var s=e._fieldsArray[r].resolve(),c=s.resolvedType instanceof n?"int32":s.type,u="m"+o.safeProp(s.name);t("case %i:",s.id),s.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[s.keyType]?t("k=%j",i.defaults[s.keyType]):t("k=null"),void 0!==i.defaults[c]?t("value=%j",i.defaults[c]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",s.keyType)("case 2:"),void 0===i.basic[c]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",c),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[s.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',u):t("%s[k]=value",u)):s.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[c]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,c)("}else"),void 0===i.basic[c]?t(s.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,c)):void 0===i.basic[c]?t(s.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,c),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var l=e._fieldsArray[r];l.required&&t("if(!m.hasOwnProperty(%j))",l.name)("throw util.ProtocolError(%j,{instance:m})",a(l))}return t("return m")};var n=r(8),i=r(30),o=r(4);function a(e){return"missing required '"+e.name+"'"}},function(e,t,r){e.exports=function(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r={};e.oneofsArray.length&&t("var p={}");for(var n=0;n<e.fieldsArray.length;++n){var c=e._fieldsArray[n].resolve(),u="m"+i.safeProp(c.name);if(c.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map)t("if(!util.isObject(%s))",u)("return%j",o(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),s(t,c,"k[i]"),a(t,c,n,u+"[k[i]]")("}");else if(c.repeated)t("if(!Array.isArray(%s))",u)("return%j",o(c,"array"))("for(var i=0;i<%s.length;++i){",u),a(t,c,n,u+"[i]")("}");else{if(c.partOf){var l=i.safeProp(c.partOf.name);1===r[c.partOf.name]&&t("if(p%s===1)",l)("return%j",c.partOf.name+": multiple values"),r[c.partOf.name]=1,t("p%s=1",l)}a(t,c,n,u)}c.optional&&t("}")}return t("return null")};var n=r(8),i=r(4);function o(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",o(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),s=0;s<a.length;++s)e("case %i:",t.resolvedType.values[a[s]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",o(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",o(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",o(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",o(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",o(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",o(t,"buffer"))}return e}function s(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",o(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",o(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",o(t,"boolean key"))}return e}},function(e,t,r){var n=t,i=r(8),o=r(4);function a(e,t,r,n){if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var o=t.resolvedType.values,a=Object.keys(o),s=0;s<a.length;++s)t.repeated&&o[a[s]]===t.typeDefault&&e("default:"),e("case%j:",a[s])("case %i:",o[a[s]])("m%s=%j",n,o[a[s]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,c)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function s(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var o=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":o=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,o?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=o.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var s=t[n].resolve(),c=o.safeProp(s.name);s.map?(r("if(d%s){",c)('if(typeof d%s!=="object")',c)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",c)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",c),a(r,s,n,c+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",c)("if(!Array.isArray(d%s))",c)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",c)("for(var i=0;i<d%s.length;++i){",c),a(r,s,n,c+"[i]")("}")("}")):(s.resolvedType instanceof i||r("if(d%s!=null){",c),a(r,s,n,c),s.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(o.compareFieldsById);if(!t.length)return o.codegen()("return {}");for(var r=o.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],c=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?n:t[u].map?a:c).push(t[u]);if(n.length){for(r("if(o.arrays||o.defaults){"),u=0;u<n.length;++u)r("d%s=[]",o.safeProp(n[u].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),u=0;u<a.length;++u)r("d%s={}",o.safeProp(a[u].name));r("}")}if(c.length){for(r("if(o.defaults){"),u=0;u<c.length;++u){var l=c[u],d=o.safeProp(l.name);if(l.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",d,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var p="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",d,p)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else r("d%s=%j",d,l.typeDefault)}r("}")}var f=!1;for(u=0;u<t.length;++u){l=t[u];var h=e._fieldsArray.indexOf(l);d=o.safeProp(l.name),l.map?(f||(f=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),s(r,l,h,d+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),s(r,l,h,d+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",d,l.name),s(r,l,h,d),l.partOf&&r("if(o.oneofs)")("d%s=%j",o.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}},function(e,t,r){var n=t,i=r(85);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].substr(1):e["@type"];return-1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="",n="";if(t&&t.json&&e.type_url&&e.value){n=e.type_url.substring(e.type_url.lastIndexOf("/")+1),r=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var o=this.lookup(n);o&&(e=o.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var a=e.$type.toObject(e,t);return""===r&&(r="type.googleapis.com/"),n=r+("."===e.$type.fullName[0]?e.$type.fullName.substr(1):e.$type.fullName),a["@type"]=n,a}return this.toObject(e,t)}}},function(e,t,r){e.exports=f;var n=/[\s{}=;:[\],'"()<>]/g,i=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,o=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,a=/^ *[*/]+ */,s=/^\s*\*?\/*/,c=/\n/g,u=/\s/,l=/\\(.?)/g,d={0:"\0",r:"\r",n:"\n",t:"\t"};function p(e){return e.replace(l,(function(e,t){switch(t){case"\\":case"":return t;default:return d[t]||""}}))}function f(e,t){e=e.toString();var r=0,l=e.length,d=1,f=null,h=null,m=0,g=!1,v=!1,y=[],b=null;function S(e){return Error("illegal "+e+" (line "+d+")")}function _(t){return e.charAt(t)}function M(r,n,i){f=e.charAt(r++),m=d,g=!1,v=i;var o,u=r-(t?2:3);do{if(--u<0||"\n"===(o=e.charAt(u))){g=!0;break}}while(" "===o||"\t"===o);for(var l=e.substring(r,n).split(c),p=0;p<l.length;++p)l[p]=l[p].replace(t?s:a,"").trim();h=l.join("\n").trim()}function T(t){var r=w(t),n=e.substring(t,r);return/^\s*\/{1,2}/.test(n)}function w(e){for(var t=e;t<l&&"\n"!==_(t);)t++;return t}function x(){if(y.length>0)return y.shift();if(b)return function(){var t="'"===b?o:i;t.lastIndex=r-1;var n=t.exec(e);if(!n)throw S("string");return r=t.lastIndex,I(b),b=null,p(n[1])}();var a,s,c,f,h,m=0===r;do{if(r===l)return null;for(a=!1;u.test(c=_(r));)if("\n"===c&&(m=!0,++d),++r===l)return null;if("/"===_(r)){if(++r===l)throw S("comment");if("/"===_(r))if(t){if(f=r,h=!1,T(r)){h=!0;do{if((r=w(r))===l)break;r++}while(T(r))}else r=Math.min(l,w(r)+1);h&&M(f,r,m),d++,a=!0}else{for(h="/"===_(f=r+1);"\n"!==_(++r);)if(r===l)return null;++r,h&&M(f,r-1,m),++d,a=!0}else{if("*"!==(c=_(r)))return"/";f=r+1,h=t||"*"===_(f);do{if("\n"===c&&++d,++r===l)throw S("comment");s=c,c=_(r)}while("*"!==s||"/"!==c);++r,h&&M(f,r-2,m),a=!0}}}while(a);var g=r;if(n.lastIndex=0,!n.test(_(g++)))for(;g<l&&!n.test(_(g));)++g;var v=e.substring(r,r=g);return'"'!==v&&"'"!==v||(b=v),v}function I(e){y.push(e)}function E(){if(!y.length){var e=x();if(null===e)return null;I(e)}return y[0]}return Object.defineProperty({next:x,peek:E,push:I,skip:function(e,t){var r=E();if(r===e)return x(),!0;if(!t)throw S("token '"+r+"', '"+e+"' expected");return!1},cmnt:function(e){var r=null;return void 0===e?m===d-1&&(t||"*"===f||g)&&(r=v?h:null):(m<e&&E(),m!==e||g||!t&&"/"!==f||(r=v?null:h)),r}},"line",{get:function(){return d}})}f.unescape=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createFrameBuffer=void 0;const n=r(55);t.createFrameBuffer=function(e,t,r){const i=e.createFramebuffer();if(!i)return console.error("framebuffer created error."),null;const o=n.createTexture(e,null,{width:t,height:r});return o?(e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o.glTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null),{framebuffer:i,targetTexture:o,bind:t=>{t?e.bindFramebuffer(e.FRAMEBUFFER,null):e.bindFramebuffer(e.FRAMEBUFFER,i)}}):null}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.lutShader=void 0,t.lutShader={fShader:"\n    precision mediump float;\n\n    uniform sampler2D map;\n    uniform sampler2D lut;\n\n    // lut强度\n    uniform float intensity;\n\n    varying vec2 vuv;\n\n    void main() {\n        vec3 color = texture2D(map, vuv).rgb;\n\n        if(intensity > 0.0){\n            float blue = color.b * 63.0;\n            \n            vec2 q1;\n            float fb = floor(blue);\n            q1.y = floor(fb * 0.125);\n            q1.x = fb - (q1.y * 8.0);\n\n            vec2 q2;\n            float cb = ceil(blue);\n            q2.y = floor(cb * 0.125);\n            q2.x = cb - (q2.y * 8.0);\n\n            vec2 t = 0.123 * color.rg + vec2(0.000976563);\n            vec2 t1 = q1 * 0.125 + t;\n            vec3 p1 = texture2D(lut, t1).rgb;\n\n            vec2 t2 = q2 * 0.125 + t;\n            vec3 p2 = texture2D(lut, t2).rgb;\n\n            vec3 filter = mix(p1, p2, fract(blue));\n            color = mix(color, filter, intensity);\n        }\n        gl_FragColor = vec4(color, 1.0);\n    }"}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const i=r(145),o=r(15),a=r(61),s=n(r(1)),c=n(r(0)),u=r(25),l=r(45),d=r(27),p=r(260),f=r(261),h=r(97),m=r(2),g=r(262),v=r(59);r(11);class y extends i.Base{constructor(e){super(e),this.destroyed=!1,this.onJoinFinish=null,this.spatialManager=null,this.apiFrequencyControl({name:"createClient",code:0,param:{clientUid:"",debug:e.debug}}),this.operationQueue=new p.OperationQueue(this.logger),this.handlePageUnload=e=>{"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus||(this.logger.warn(`收到 ${null==e?void 0:e.type} 事件，当前状态：${this.adapterRef.channelStatus}，即将离开房间`),this.leave())},this.handleOnOnlineOffline=e=>{var t,r,n,i,o;"online"===(null==e?void 0:e.type)?"CONNECTING"===this.adapterRef.connectState.curState?(this.logger.warn("侦测到网络恢复，恢复重连过程"),this.resumeReconnection()):this.logger.warn("侦测到网络恢复"):"offline"===(null==e?void 0:e.type)&&("CONNECTED"===this.adapterRef.connectState.curState?(this.logger.warn("侦测到网络断开，主动断开连接"),this.pauseReconnection(),null===(r=null===(t=this.adapterRef._mediasoup)||void 0===t?void 0:t._sendTransport)||void 0===r||r.close(),null===(i=null===(n=this.adapterRef._mediasoup)||void 0===n?void 0:n._recvTransport)||void 0===i||i.close(),this.adapterRef.channelStatus="connectioning",null===(o=this.adapterRef._signalling)||void 0===o||o._reconnection()):this.logger.warn("侦测到网络断开"))},m.getParameters().leaveOnUnload&&(window.addEventListener("pagehide",this.handlePageUnload),window.addEventListener("beforeunload",this.handlePageUnload)),m.getParameters().trustOnOnline&&(window.addEventListener("online",this.handleOnOnlineOffline),window.addEventListener("offline",this.handleOnOnlineOffline)),this._roleInfo={userRole:0,audienceList:{}},this._init(e),this.logger.info(`NERTC ${u.SDK_VERSION} ${u.BUILD}: 客户端创建成功。`),this.on("connection-state-change",(e=>{var t,r;"CONNECTED"===e.prevState&&(null===(t=this.recordManager.record)||void 0===t?void 0:t._status.isRecording)&&"started"===(null===(r=this.recordManager.record)||void 0===r?void 0:r._status.state)&&(this.logger.log("自动停止客户端录制功能"),this.recordManager.record.download())}))}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this.logger.error(`Error on event ${e}: ${t.name} ${t.message}`,t.stack)}}_init(e){this.initWebSocket();const{appkey:t="",token:r}=e;if(!t)throw this.logger.error("Client: init error: 请传入appkey"),new s.default({code:c.default.INVALID_PARAMETER,message:"请传入appkey"});this._params.appkey=t,this._params.token=r,this._roleInfo={userRole:0,audienceList:{}},d.Device.deviceInited||d.Device.startDeviceChangeDetection(),d.Device.on("recording-device-changed",(e=>{this.destroyed||this.safeEmit("recording-device-changed",e)})),d.Device.on("camera-changed",(e=>{this.destroyed||this.safeEmit("camera-changed",e)})),d.Device.on("playout-device-changed",(e=>{this.destroyed||this.safeEmit("playout-device-changed",e)}));const n=()=>{this.onJoinFinish?(this.onJoinFinish(),this.onJoinFinish=null):this.logger.debug("孤立的join完成回调")};this.on("pairing-join-success",n),this.on("pairing-join-error",n)}getUid(){return this.adapterRef.channelInfo&&this.adapterRef.channelInfo.uid}getChannelInfo(){return this.apiFrequencyControl({name:"getChannelInfo",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||""}}),this.adapterRef.channelInfo||{}}startProxyServer(e){let t=null;if(this.adapterRef.logger.log("startProxyServer, type: ",e),"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus||(this.adapterRef.logger.error("startProxyServer: 请在加入房间前调用"),t="INVALID_OPERATION"),this.apiFrequencyControl({name:"startProxyServer",code:t?-1:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",reason:t}}),t)throw new s.default({code:c.default.INVALID_PARAMETER,message:"startProxyServer: 请在加入房间前调用"});this.adapterRef.proxyServer.enable=!0,e&&(this.adapterRef.proxyServer.type=e)}stopProxyServer(){this.adapterRef.logger.log("stopProxyServer"),this.adapterRef.proxyServer&&(this.adapterRef.proxyServer.enable=!1),this.apiFrequencyControl({name:"stopProxyServer",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",reason:""}})}setLocalMediaPriority(e){this.logger.log("setLocalMediaPriority, options: ",JSON.stringify(e));let t=null;"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus||(this.logger.error("setLocalMediaPriority: 请在加入房间前调用"),t="setLocalMediaPriority: 请在加入房间前调用");const{priority:r=100,preemtiveMode:n=!1}=e;if(("number"!=typeof r||isNaN(r))&&(t="setLocalMediaPriority: priority is not Number"),this.apiFrequencyControl({name:"setLocalMediaPriority",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",priority:r,preemtiveMode:n,reason:""}}),t)throw new s.default({code:c.default.INVALID_PARAMETER,message:"setLocalMediaPriority: priority is not Number"});this.adapterRef.userPriority=e}async join(e){this.logger.log("join() 加入频道, options: ",JSON.stringify(e,null," "));try{if(!e.channelName||""===e.channelName)throw new s.default({code:c.default.INVALID_PARAMETER,message:"join: 请填写房间名称"});if(e.joinChannelRecordConfig&&(o.checkValidBoolean({tag:"joinOptions.joinChannelRecordConfig.recordAudio should be boolean",value:e.joinChannelRecordConfig.recordAudio}),o.checkValidBoolean({tag:"joinOptions.joinChannelRecordConfig.recordVideo should be boolean",value:e.joinChannelRecordConfig.recordVideo})),"string"==typeof e.uid)this.logger.log("uid是string类型"),this.adapterRef.channelInfo.uidType="string";else{if("number"!=typeof e.uid)return this.logger.error("uid参数格式非法"),Promise.reject(new s.default({code:c.default.INVALID_PARAMETER,message:"join: uid is invalid"}));if(this.logger.log("uid是number类型"),this.adapterRef.channelInfo.uidType="number",e.uid>Number.MAX_SAFE_INTEGER)throw new s.default({code:c.default.INVALID_PARAMETER,message:"join: uid is exceeds the scope of Number"})}if(this.onJoinFinish=await this.operationQueue.enqueue({caller:this,method:"join",options:e}),this.emit("pairing-join-start"),this.adapterRef._statsReport||this.initWebSocket(),"join"===this.adapterRef.channelStatus||"connectioning"===this.adapterRef.channelStatus)return this.emit("pairing-join-error"),Promise.reject(new s.default({code:c.default.REPEAT_JOIN,message:"repeatedly join"}));if(this.adapterRef.connectState.curState="CONNECTING",this.adapterRef.connectState.prevState="DISCONNECTED",this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),e.spatial&&this.initSpatialManager(e.spatial),e.token&&(this._params.token=e.token),this._params.JoinChannelRequestParam4WebRTC2={startJoinTime:Date.now(),appkey:this._params.appkey,userRole:this._roleInfo.userRole,channelName:e.channelName,wssArr:e.wssArr,uid:e.uid,token:this._params.token,joinChannelLiveConfig:e.joinChannelLiveConfig||{liveEnable:!1},joinChannelRecordConfig:e.joinChannelRecordConfig||{recordAudio:!1,recordVideo:!1,recordType:0,isHostSpeaker:!1}},e.neRtcServerAddresses&&(this._params.neRtcServerAddresses={channelServer:e.neRtcServerAddresses.channelServer||"",statisticsServer:e.neRtcServerAddresses.statisticsServer||"",roomServer:e.neRtcServerAddresses.roomServer||"",webSocketProxyServer:e.neRtcServerAddresses.webSocketProxyServer||"",mediaProxyServer:e.neRtcServerAddresses.mediaProxyServer||""}),this.setStartSessionTime(),this.initMode(),!this.adapterRef.mediaCapability.supportedCodecRecv||!this.adapterRef.mediaCapability.supportedCodecSend)try{await this.adapterRef.mediaCapability.detect()}catch(e){this.logger.error("Failed to detect mediaCapability",e.name,e.message)}if(!this.adapterRef._meetings)throw this.emit("pairing-join-error"),new s.default({code:c.default.NO_MEETINGS,message:"meetings error"});const t=await this.adapterRef._meetings.joinChannel(this._params.JoinChannelRequestParam4WebRTC2);return this.emit("pairing-join-success"),this.apiFrequencyControl({name:"join",code:0,param:Object.assign({},e)}),t}catch(t){throw this.emit("pairing-join-error"),this.apiFrequencyControl({name:"join",code:-1,param:Object.assign(Object.assign({},e),{reason:t&&t.message})}),t}}async leave(){const e=await this.operationQueue.enqueue({caller:this,method:"leave",options:null});this.logger.log("leave() 离开频道"),"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus&&this.logger.log("房间状态: ",this.adapterRef.channelStatus),this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTING",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.setEndSessionTime(),this.adapterRef._meetings?this.adapterRef._meetings.leaveChannel().then(e):e(),this.apiFrequencyControl({name:"leave",code:0,param:{clientUid:this.getUid()}})}async leaveRts(){this.logger.log("离开频道"),"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus&&this.logger.log(" 状态: ",this.adapterRef.channelStatus),this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTING",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.setEndSessionTime(),this.adapterRef._meetings&&this.adapterRef._meetings.leaveChannel()}enableCustomTransform(e){var t;let r="";if("DISCONNECTED"!==this.adapterRef.connectState.curState?r="enableCustomTransform必须在加入频道前调用":"function"!=typeof window.TransformStream?r="浏览器不支持自定义加解密: 未找到TransformStream":"function"!=typeof(null===(t=window.RTCRtpReceiver)||void 0===t?void 0:t.prototype.createEncodedStreams)?r="浏览器不支持自定义加解密: 未找到createEncodedStreams":"none"!==this.adapterRef.encryption.encryptionMode&&(r="自定义加密功能与国密加密功能不兼容"),r)throw this.logger.error(r),new s.default({code:c.default.NOT_SUPPORT,message:r});!1===e?(this.adapterRef.encryption.encodedInsertableStreams=!1,this.logger.log("已关闭自定义加解密")):(this.adapterRef.encryption.encodedInsertableStreams=!0,this.logger.log("已开启自定义加解密")),this.apiFrequencyControl({name:"enableCustomTransform",code:0,param:JSON.stringify({enable:e})})}async publish(e){o.checkExists({tag:"client.publish:stream",value:e}),await this.doPublish(e)}async doPublish(e){const t=await this.operationQueue.enqueue({caller:this,method:"publish",options:e});let r="";const n=()=>{var n,i;t();const o={reason:r,pubStatus:e.pubStatus};(e.mediaHelper.video.cameraTrack||e.mediaHelper.video.videoSource)&&(o.webcamProducerCodec=null===(n=this.adapterRef._mediasoup)||void 0===n?void 0:n._webcamProducerCodec),(e.mediaHelper.screen.screenVideoTrack||e.mediaHelper.screen.screenVideoSource)&&(o.screenProducerCodec=null===(i=this.adapterRef._mediasoup)||void 0===i?void 0:i._screenProducerCodec),this.apiFrequencyControl({name:"publish",code:r?-1:0,param:JSON.stringify(o)}),this.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(e.mediaHelper.getTrackSettings())})};if(e&&(e.audio||e.video||e.screen||e.screenAudio)?1===this._roleInfo.userRole?(this.logger.error("publish：观众禁止Publish，请先使用setClientRole设为主播"),r="INVALID_OPERATION"):"CONNECTING"===this.adapterRef.connectState.curState?(this.logger.error("publish: 当前正在连接，将在连接成功后发布媒体流"),r="PUBLISH_ON_CONNECTING",this.bindLocalStream(e)):"CONNECTED"!==this.adapterRef.connectState.curState&&(this.logger.error("publish: 当前不在频道中，可能是没有加入频道或者是网络波动导致暂时断开连接"),r="INVALID_OPERATION"):e&&m.getParameters().allowEmptyMedia?this.logger.log("publish: 当前模式允许发布没有媒体流的localStream"):(this.logger.error("publish: 传入的 stream 格式非法，没有媒体数据"),r="INVALID_LOCAL_STREAM"),r)return"INVALID_OPERATION"===r?(n(),Promise.reject(new s.default({code:c.default.INVALID_OPERATION,message:"invalid operation"}))):"INVALID_LOCAL_STREAM"===r?(n(),Promise.reject(new s.default({code:c.default.NO_LOCALSTREAM,message:"no localStream"}))):void n();try{if(!this.adapterRef._mediasoup)throw n(),new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 4"});this.bindLocalStream(e),await this.adapterRef._mediasoup.createProduce(e,"all"),n()}catch(e){this.logger.error("API调用失败：Client:publish",e.name,e.message,e.stack,...arguments),r=e.message,n()}}async unpublish(e){o.checkExists({tag:"client.unpublish:stream",value:e});const t=await this.operationQueue.enqueue({caller:this,method:"unpublish",options:null});let r="";if("CONNECTING"===this.adapterRef.connectState.curState?(this.logger.error("unpublish: 当前正在连接，连接成功后将不再发送媒体流"),r="UNPUBLISH_ON_CONNECTING",this.adapterRef.localStream=null):"CONNECTED"!==this.adapterRef.connectState.curState&&(this.logger.error("unpublish: 当前不在频道中，可能是没有加入频道或者是网络波动导致暂时断开连接"),r="INVALID_OPERATION"),JSON.stringify({pubStatus:e&&e.pubStatus,reason:r},null," "),r)return this.apiFrequencyControl({name:"unpublish",code:-1,param:{clientUid:this.getUid(),pubStatus:e&&e.pubStatus,reason:r}}),"INVALID_OPERATION"===r?(t(),Promise.reject(new s.default({code:c.default.INVALID_OPERATION,message:"invalid operation"}))):"INVALID_LOCAL_STREAM"===r?(t(),Promise.reject(new s.default({code:c.default.NO_LOCALSTREAM,message:"no localStream"}))):void t();this.logger.log("开始取消发布本地流");try{if(!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 5"});await this.adapterRef._mediasoup.destroyProduce("audio"),await this.adapterRef._mediasoup.destroyProduce("video"),await this.adapterRef._mediasoup.destroyProduce("screen"),this.adapterRef.localStream=null,this.apiFrequencyControl({name:"unpublish",code:0,param:JSON.stringify({pubStatus:e&&e.pubStatus},null," ")}),t()}catch(r){this.logger.error("API调用失败：Client:unpublish",r,...arguments),t(),this.apiFrequencyControl({name:"unpublish",code:-1,param:JSON.stringify({reason:r.message,pubStatus:e&&e.pubStatus},null," ")})}}getSubStatus(e,t){let r={status:"unsubscribed",subscribable:!1};if("all"===t){const t=[this.getSubStatus(e,"audio"),this.getSubStatus(e,"video"),this.getSubStatus(e,"screen")];t.find((e=>"unsubscribing"===e.status))?r.status="unsubscribing":t.find((e=>"subscribing"===e.status))&&(r.status="subscribing"),t.find((e=>"subscribed"===e.status))&&(r.status="subscribed"),"subscribed"!==r.status&&"unsubscribed"!==r.status||t.find((e=>e.subscribable))&&(r.subscribable=!0)}else"start"===e.pubStatus[t].stopconsumerStatus?r.status="unsubscribing":"start"===e.pubStatus[t].consumerStatus?r.status="subscribing":e.pubStatus[t].consumerId?r.status="subscribed":"unsubscribed"===r.status&&e.pubStatus[t].producerId&&e.subConf[t]&&(r.subscribable=!0);return r}async subscribe(e){if(!this.spatialManager)return o.checkExists({tag:"client.subscribe:stream",value:e}),this.logger.log(`subscribe() [订阅远端: ${e.stringStreamID}]`),this.doSubscribe(e);this.logger.warn("subscribe() 已开启空间音频，跳过用户订阅步骤")}async doSubscribe(e){const t=e.getId();if(!t)throw new s.default({code:c.default.INVALID_PARAMETER,message:"No uid"});if(!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 6"});try{if(e.subConf.audio)e.pubStatus.audio.audio&&!e.pubStatus.audio.consumerId&&"start"!==e.pubStatus.audio.consumerStatus&&(this.logger.log(`subscribe() [开始订阅 ${e.getId()} 音频流]`),e.pubStatus.audio.consumerStatus="start",await this.adapterRef._mediasoup.createConsumer(t,"audio","audio",e.pubStatus.audio.producerId),e.pubStatus.audio.consumerStatus="end",this.logger.log(`subscribe() [订阅 ${e.getId()} 音频流完成]`));else if(e.pubStatus.audio.consumerId&&"start"!==e.pubStatus.audio.stopconsumerStatus){if(this.logger.log("开始取消订阅音频流"),e.pubStatus.audio.stopconsumerStatus="start",!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 7"});await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.audio.consumerId,e,"audio"),this.adapterRef.instance.removeSsrc(e.getId(),"audio"),e.pubStatus.audio.consumerId="",e.stop("audio"),e.pubStatus.audio.stopconsumerStatus="end",e.subStatus.audio=!1;const t=e.getId();if(t){delete this.adapterRef.remoteAudioStats[t];const e=this.adapterRef._statsReport&&this.adapterRef._statsReport.formativeStatsReport&&this.adapterRef._statsReport.formativeStatsReport.firstData.recvFirstData[t];e&&(e.recvFirstAudioFrame=!1,e.recvFirstAudioPackage=!1)}this.logger.log("取消订阅音频流完成")}if(e.subConf.video)if(e.pubStatus.video.video&&!e.pubStatus.video.consumerId)if(this.logger.log("应该订阅视频 stream.pubStatus.video.consumerStatus: ",e.pubStatus.video.consumerStatus),"start"!==e.pubStatus.video.consumerStatus){let r;this.logger.log(`subscribe() [开始订阅 ${e.getId()} 视频流]`),e.pubStatus.video.consumerStatus="start",r=e.subConf.highOrLow.video===l.STREAM_TYPE.LOW?0:1,await this.adapterRef._mediasoup.createConsumer(t,"video","video",e.pubStatus.video.producerId,r),e.pubStatus.video.consumerStatus="end",this.logger.log(`subscribe() [订阅 ${e.getId()} 视频流完成]`)}else this.logger.log("stream.pubStatus.video.consumerStatus: ",JSON.stringify(e.pubStatus.video.consumerStatus));else this.logger.log("stream.pubStatus.video: ",JSON.stringify(e.pubStatus.video));else if(e.pubStatus.video.consumerId&&"start"!==e.pubStatus.video.stopconsumerStatus){if(this.logger.log("开始取消订阅视频流"),e.pubStatus.video.stopconsumerStatus="start",!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 8"});await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.video.consumerId,e,"video"),this.adapterRef.instance.removeSsrc(e.getId(),"video"),e.pubStatus.video.consumerId="",e.stop("video"),e.pubStatus.video.stopconsumerStatus="end",e.subStatus.video=!1;const t=e.getId();if(t){delete this.adapterRef.remoteVideoStats[t];const e=this.adapterRef._statsReport&&this.adapterRef._statsReport.formativeStatsReport&&this.adapterRef._statsReport.formativeStatsReport.firstData.recvFirstData[t];e&&(e.recvFirstVideoFrame=!1,e.recvFirstVideoPackage=!1,e.videoTotalPlayDuration=0)}this.logger.log("取消订阅视频流完成")}if(e.subConf.screen){if(e.pubStatus.screen.screen&&!e.pubStatus.screen.consumerId&&"start"!==e.pubStatus.screen.consumerStatus){let r;this.logger.log(`subscribe() [开始订阅 ${e.getId()} 辅流]`),e.pubStatus.screen.consumerStatus="start",r=e.subConf.highOrLow.screen===l.STREAM_TYPE.LOW?0:1,await this.adapterRef._mediasoup.createConsumer(t,"video","screenShare",e.pubStatus.screen.producerId,r),e.pubStatus.screen.consumerStatus="end",this.logger.log(`subscribe() [订阅 ${e.getId()} 辅流完成]`)}}else if(e.pubStatus.screen.consumerId&&"start"!==e.pubStatus.screen.stopconsumerStatus){if(this.logger.log("开始取消订阅辅流"),e.pubStatus.screen.stopconsumerStatus="start",!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 9"});await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.screen.consumerId,e,"screen"),this.adapterRef.instance.removeSsrc(e.getId(),"screen"),e.pubStatus.screen.consumerId="",e.stop("screen"),e.pubStatus.screen.stopconsumerStatus="end",e.subStatus.screen=!1;const t=e.getId();if(t){delete this.adapterRef.remoteScreenStats[t];const e=this.adapterRef._statsReport&&this.adapterRef._statsReport.formativeStatsReport&&this.adapterRef._statsReport.formativeStatsReport.firstData.recvFirstData[t];e&&(e.recvFirstScreenFrame=!1,e.recvFirstScreenPackage=!1,e.screenTotalPlayDuration=0)}this.logger.log("取消订阅辅助流完成")}this.apiFrequencyControl({name:"subscribe",code:0,param:JSON.stringify({reason:"",subStatus:e.subStatus,subConf:e.subConf,pubStatus:e.pubStatus},null," ")})}catch(t){if("resetConsumeRequestStatus"===t)return void this.logger.warn("API调用被打断：Client:subscribe",t);this.logger.error("API调用失败：Client:subscribe",t,t.name,t.message,...arguments),this.apiFrequencyControl({name:"subscribe",code:-1,param:JSON.stringify({reason:t.message,subStatus:e.subStatus,subConf:e.subConf,pubStatus:e.pubStatus},null," ")})}}async unsubscribe(e){return o.checkExists({tag:"client.unsubscribe:stream",value:e}),this.doUnsubscribe(e)}async doUnsubscribe(e){this.logger.log("取消订阅远端音视频流: ",e);try{if(e.pubStatus.audio.consumerId&&"start"!==e.pubStatus.audio.stopconsumerStatus){if(this.logger.log("开始取消订阅音频流"),e.pubStatus.audio.stopconsumerStatus="start",!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 10"});await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.audio.consumerId,e,"audio"),this.adapterRef.instance.removeSsrc(e.getId(),"audio"),e.pubStatus.audio.consumerId="",e.stop("audio"),e.pubStatus.audio.stopconsumerStatus="end",e.subStatus.audio=!1;const t=e.getId();if(t){delete this.adapterRef.remoteAudioStats[t];const e=this.adapterRef._statsReport&&this.adapterRef._statsReport.formativeStatsReport&&this.adapterRef._statsReport.formativeStatsReport.firstData.recvFirstData[t];e&&(e.recvFirstAudioFrame=!1,e.recvFirstAudioPackage=!1)}this.logger.log("取消订阅音频流完成")}if(e.pubStatus.video.consumerId&&"start"!==e.pubStatus.video.stopconsumerStatus){if(this.logger.log("开始取消订阅视频流"),e.pubStatus.video.stopconsumerStatus="start",!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 11"});await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.video.consumerId,e,"video"),this.adapterRef.instance.removeSsrc(e.getId(),"video"),e.pubStatus.video.consumerId="",e.stop("video"),e.pubStatus.video.stopconsumerStatus="end",e.subStatus.video=!1;const t=e.getId();if(t){delete this.adapterRef.remoteVideoStats[t];const e=this.adapterRef._statsReport&&this.adapterRef._statsReport.formativeStatsReport&&this.adapterRef._statsReport.formativeStatsReport.firstData.recvFirstData[t];e&&(e.recvFirstVideoFrame=!1,e.recvFirstVideoPackage=!1,e.videoTotalPlayDuration=0)}this.logger.log("取消订阅视频流完成")}if(e.pubStatus.screen.consumerId&&"start"!==e.pubStatus.screen.stopconsumerStatus){if(this.logger.log("开始取消订阅辅流"),e.pubStatus.screen.stopconsumerStatus="start",!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 12"});await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.screen.consumerId,e,"screen"),this.adapterRef.instance.removeSsrc(e.getId(),"screen"),e.pubStatus.screen.consumerId="",e.stop("screen"),e.pubStatus.screen.stopconsumerStatus="end",e.subStatus.screen=!1;const t=e.getId();if(t){delete this.adapterRef.remoteScreenStats[t];const e=this.adapterRef._statsReport&&this.adapterRef._statsReport.formativeStatsReport&&this.adapterRef._statsReport.formativeStatsReport.firstData.recvFirstData[t];e&&(e.recvFirstScreenFrame=!1,e.recvFirstScreenPackage=!1,e.screenTotalPlayDuration=0)}this.logger.log("取消订阅辅助流完成")}this.apiFrequencyControl({name:"unsubscribe",code:0,param:JSON.stringify({clientUid:this.getUid(),streamId:e.stringStreamID,reason:"",subStatus:e.subStatus,subConf:e.subConf},null," ")})}catch(t){this.logger.error("API调用失败：Client:unsubscribe",t.name,t.message,t,...arguments),this.apiFrequencyControl({name:"unsubscribe",code:-1,param:JSON.stringify({clientUid:this.getUid(),streamId:e.stringStreamID,reason:t.message,subStatus:e.subStatus,subConf:e.subConf},null," ")})}}async setRemoteVideoStreamType(e,t){this.logger.log(`uid ${e.getId()} 订阅成员的${t?"小":"大"}流`,t);try{if(!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 13"});if(!e.getId())throw new s.default({code:c.default.INVALID_PARAMETER,message:"No stream Id"});await this.adapterRef._mediasoup.setConsumerPreferredLayer(e,t?0:1,"video"),e.subConf.highOrLow.video=t,this.apiFrequencyControl({name:"setRemoteVideoStreamType",param:JSON.stringify({clientUid:this.getUid(),streamId:e.stringStreamID,highOrLow:t},null," ")})}catch(r){this.logger.error("API调用失败：Client:setRemoteVideoStreamType",r.name,r.message,r,...arguments),this.apiFrequencyControl({name:"setRemoteVideoStreamType",code:-1,param:JSON.stringify({clientUid:this.getUid(),streamId:e.stringStreamID,reason:r.message,highOrLow:t},null," ")})}}async setRemoteStreamType(e,t,r){this.logger.log(`setRemoteStreamType: 订阅${e.getId()}成员的${t?"小":"大"}流`,r,t);try{if(!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 27"});if(!e.getId())throw new s.default({code:c.default.INVALID_PARAMETER,message:"No stream Id"});await this.adapterRef._mediasoup.setConsumerPreferredLayer(e,t?0:1,r),e.subConf.highOrLow[r]=t,this.apiFrequencyControl({name:"setRemoteStreamType",code:0,param:{highOrLow:t,mediaType:r,clientUid:this.getUid(),streamID:e.stringStreamID}})}catch(n){this.logger.error("API调用失败：Client:setRemoteStreamType",n,...arguments),this.apiFrequencyControl({name:"setRemoteVideoStreamType",code:-1,param:JSON.stringify({reason:n.message,highOrLow:t,mediaType:r,streamID:e.stringStreamID},null," ")})}}enableAudioVolumeIndicator(){this.logger.log("开启音量提醒")}enableDualStream(e={video:!0,screen:!1}){this.adapterRef.channelInfo.videoLow=e.video,this.adapterRef.channelInfo.screenLow=e.screen,this.logger.log("开启双流模式"),this.apiFrequencyControl({name:"enableDualStream",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",video:e.video,screen:e.screen,reason:""}})}disableDualStream(e={video:!1,screen:!1}){this.logger.log("关闭双流模式"),this.adapterRef.channelInfo.videoLow=!1,this.adapterRef.channelInfo.screenLow=!1,this.apiFrequencyControl({name:"disableDualStream",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",video:e.video,screen:e.screen,reason:""}})}async setClientRole(e){let t,r;if("host"===e||"broadcaster"===e?t=0:"audience"===e?t=1:(this.logger.error("setClientRole: 无法识别的角色："+e),r="INVALID_OPERATION",t=-1),!r){const n=this.adapterRef.channelInfo&&this.adapterRef.channelInfo.uid||"";if(t===this._roleInfo.userRole)this.logger.warn(`setClientRole: 用户${n}的角色已经是${e}了`);else switch(this.adapterRef.connectState.curState){case"CONNECTED":if(1===t&&this.adapterRef.localStream&&this.isPublished(this.adapterRef.localStream)&&(this.logger.info(`setClientRole：主播 ${n}将设为观众，自动Unpublish中`),await this.unpublish(this.adapterRef.localStream)),!this.adapterRef._mediasoup)throw new s.default({code:c.default.NO_MEDIASERVER,message:"media server error 14"});await this.adapterRef._mediasoup.updateUserRole(t),this._roleInfo.userRole!==t&&(this._roleInfo.userRole=t,this.logger.info(`setClientRole：本地用户${n} 设置角色为 ${e}`),this.safeEmit("client-role-changed",{role:e}));break;case"DISCONNECTED":this._roleInfo.userRole!==t&&(this._roleInfo.userRole=t,this.logger.info(`setClientRole：本地用户${n}设置角色为 ${e}`),this.safeEmit("client-role-changed",{role:e}));break;default:this.logger.error(`setClientRole: 本地用户${n}当前不在频道中，可能是网络波动导致暂时断开连接`),r="USER_NOT_IN_CHANNEL"}}if(this.apiFrequencyControl({name:"setClientRole",code:r?-1:0,param:{role:e,reason:r}}),r){if("INVALID_OPERATION"===r)return Promise.reject(new s.default({code:c.default.INVALID_OPERATION,message:"invalid operation"}));if("USER_NOT_IN_CHANNEL"===r)return Promise.reject(new s.default({code:c.default.NO_LOCALSTREAM,message:"user not in channel"}))}}bindLocalStream(e){this.adapterRef.localStream=e,e.client=this;const t=this.getUid();e.streamID!==t&&(this.logger.warn("localStream更换streamID",e.streamID,"=>",t),e.streamID=t,e.stringStreamID=t.toString())}getConnectionState(){return this.apiFrequencyControl({name:"getConnectionState",code:0,param:JSON.stringify({},null," ")}),this.adapterRef.connectState.curState}getSystemStats(){return navigator.getBattery?new Promise(((e,t)=>{navigator.getBattery().then((function(t){e(100*t.level)}))})):Promise.reject(new s.default({code:c.default.NOT_SUPPORTED_YET,message:"navigator.getBattery is not support in your browser",url:"https://developer.mozilla.org/en-US/docs/Web/API/Navigator/getBattery"}))}getSessionStats(){return new Promise(((e,t)=>{this.adapterRef.sessionStats.Duration=(Date.now()-this.adapterRef.state.startSessionTime)/1e3,this.adapterRef.sessionStats.UserCount=Object.keys(this.adapterRef.memberMap).length+1,e(this.adapterRef.sessionStats)}))}getTransportStats(){return new Promise(((e,t)=>{e(this.adapterRef.transportStats)}))}getLocalAudioStats(){return new Promise(((e,t)=>{e(this.adapterRef.localAudioStats)}))}getLocalVideoStats(e){let t=[];return e&&"video"!==e||(t=t.concat(this.adapterRef.localVideoStats)),e&&"screen"!==e||(t=t.concat(this.adapterRef.localScreenStats)),Promise.resolve(t)}getRemoteAudioStats(){return new Promise(((e,t)=>{e(this.adapterRef.remoteAudioStats)}))}getRemoteVideoStats(e){let t={};return e&&"screen"!==e||(t=Object.assign(t,this.adapterRef.remoteScreenStats)),e&&"video"!==e||(t=Object.assign(t,this.adapterRef.remoteVideoStats)),Promise.resolve(t)}setChannelProfile(e){let t=null;if(this.logger.log("setChannelProfile, options: ",JSON.stringify(e,null," ")),"DISCONNECTED"!==this.adapterRef.connectState.curState)this.logger.warn("setChannelProfile: 请在加入房间前调用"),t="setChannelProfile: 请在加入房间前调用";else{const t=e.mode||"rtc";this.adapterRef.localStream&&("live"===t?this.adapterRef.localStream.audioProfile="music_standard":"rtc"===t&&(this.adapterRef.localStream.audioProfile="speech_low_quality")),this._params.mode=t}if(this.apiFrequencyControl({name:"setChannelProfile",code:t?-1:0,param:{mode:e.mode,reason:t}}),t)throw new s.default({code:c.default.INVALID_OPERATION,message:t})}async addTasks(e){var t;this.logger.log("addTasks() 增加互动直播推流任务, options: ",JSON.stringify(e));let r=null;if(1===this._roleInfo.userRole&&(this.logger.error("addTasks: 观众不允许进行直播推流操作"),r="addTasks: 观众不允许进行直播推流操作"),this.adapterRef._meetings||(r="addTasks: 加入房间后进行直播推流操作"),r)throw this.adapterRef.instance.apiFrequencyControl({name:"addTasks",code:-1,param:{clientUid:this.getUid(),reason:r}}),new s.default({code:c.default.NO_MEETINGS,message:r});try{await(null===(t=this.adapterRef._meetings)||void 0===t?void 0:t.addTasks(e)),this.adapterRef.instance.apiFrequencyControl({name:"addTasks",code:0,param:{clientUid:this.getUid()}})}catch(e){throw this.adapterRef.instance.apiFrequencyControl({name:"addTasks",code:-1,param:{clientUid:this.getUid(),reason:e.message}}),e}}async deleteTasks(e){var t;this.logger.log("deleteTasks() 删除互动直播推流任务, options: ",e);let r=null;if(1===this._roleInfo.userRole&&(r="deleteTasks: 观众不允许进行直播推流操作"),this.adapterRef._meetings||(r="deleteTasks: 加入房间后进行直播推流操作"),r)throw this.logger.error(r),this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:-1,param:{clientUid:this.getUid(),reason:r}}),new s.default({code:c.default.NO_MEETINGS,message:r});try{await(null===(t=this.adapterRef._meetings)||void 0===t?void 0:t.deleteTasks(e)),this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:0,param:{clientUid:this.getUid()}})}catch(e){throw this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:-1,param:{clientUid:this.getUid(),reason:e.message}}),e}}async updateTasks(e){var t;this.logger.log("updateTasks() 更新互动直播推流任务, options: ",e);let r=null;if(1===this._roleInfo.userRole&&(r="updateTasks: 观众不允许进行直播推流操作"),this.adapterRef._meetings||(r="updateTasks: 加入房间后进行直播推流操作"),r)throw this.logger.error(r),this.adapterRef.instance.apiFrequencyControl({name:"updateTasks",code:-1,param:{clientUid:this.getUid(),reason:r}}),new s.default({code:c.default.NO_MEETINGS,message:r});try{await(null===(t=this.adapterRef._meetings)||void 0===t?void 0:t.updateTasks(e)),this.adapterRef.instance.apiFrequencyControl({name:"updateTasks",code:0,param:{clientUid:this.getUid()}})}catch(e){throw this.adapterRef.instance.apiFrequencyControl({name:"updateTasks",code:-1,param:{clientUid:this.getUid(),reason:e.message}}),e}}setEncryptionMode(e){if(o.checkValidInteger({tag:"Valid encryptionModes are: "+Object.keys(a.EncryptionModes).join(","),value:a.encryptionModeToInt(e)}),this.adapterRef.encryption.encodedInsertableStreams){const e="自定义加密功能与国密加密功能不兼容";throw this.logger.error(e),new s.default({code:c.default.NOT_SUPPORT,message:e})}this.logger.log("设置加密模式：",e),this.adapterRef.encryption.setEncryptionMode(e);const t={enable:"none"!==e,mode:a.encryptionModeToInt(e)};this.apiFrequencyControl({name:"setEncryptionMode",code:0,param:JSON.stringify(t,null," ")})}setEncryptionSecret(e){switch(this.adapterRef.encryption.encryptionMode){case"none":throw new s.default({code:c.default.INVALID_OPERATION,message:"Client.setEncryptionSecret: please set encryptionMode first"});case"sm4-128-ecb":o.checkValidString({tag:"client.setEncryptionSecret:encryptionSecret",value:e,min:1,max:128})}this.logger.log("设置加密密钥"),this.adapterRef.encryption.setEncryptionSecret(e),this.apiFrequencyControl({name:"setEncryptionSecret",code:0,param:JSON.stringify({encryptionSecret:e},null," ")})}async pauseReconnection(){this.logger.log("pauseReconnection：下一次重连行为会被暂停，直到调用resumeReconnection()方法");const e=await new Promise((e=>{this.adapterRef._signalling&&this.adapterRef._signalling.reconnectionControl.pausers.push(e)}));return this.logger.log("pauseReconnection：重连已被暂停："+JSON.stringify(e)),e}async resumeReconnection(){if(this.adapterRef._signalling){this.adapterRef._signalling.reconnectionControl.blocker?(this.logger.log("resumeReconnection：即将恢复重连过程"),this.adapterRef._signalling.reconnectionControl.blocker(),this.adapterRef._signalling.reconnectionControl.pausers.forEach((e=>e({reason:"reconnection-resume"}))),this.adapterRef._signalling.reconnectionControl.pausers=[]):this.adapterRef._signalling.reconnectionControl.pausers.length?(this.logger.log("resumeReconnection：取消之前的 pauseReconnection 操作。"),this.adapterRef._signalling.reconnectionControl.pausers.forEach((e=>e({reason:"cancelled"}))),this.adapterRef._signalling.reconnectionControl.pausers=[]):this.logger.warn("resumeReconnection：未发现pauseReconnection操作");const e=await new Promise((e=>{var t;null===(t=this.adapterRef._signalling)||void 0===t||t.reconnectionControl.resumers.push(e)}));return this.logger.log("resumeReconnection：恢复重连成功"+JSON.stringify(e)),e}}refreshRemoteEvents(){for(let e in this.adapterRef.remoteStreamMap){const t=this.adapterRef.remoteStreamMap[e];this.logger.warn("refreshRemoteEvents peer-online",e),this.safeEmit("peer-online",{uid:e}),["audio","video","screen"].forEach((r=>{t.pubStatus[r].producerId&&(this.logger.warn("refreshRemoteEvents stream-added",e,r),this.safeEmit("stream-added",{stream:t,mediaType:r}),t.muteStatus[r].send&&(this.logger.warn("refreshRemoteEvents mute-"+r,e,r),this.safeEmit("mute-"+r,{uid:t.getId()})))}))}}initSpatialManager(e){if(!this.spatialManager){const t=h.getAudioContext();if(!t)return void this.logger.error("当前环境不支持WebAudio");this.spatialManager=new f.SpatialManager({client:this,options:e,context:t})}this.spatialManager.init(),this.spatialManager.play()}syncUserList(){return this.adapterRef.memberMap}updateRecordingAudioStream(){if(!this.recordManager||!this.recordManager.formatMedia||!this.recordManager.formatMedia.destination)return;this.logger.log("updateRecordingAudioStream() [更新录制的音频]");const e=[];if(this.adapterRef.remoteStreamMap)for(var t in this.adapterRef.remoteStreamMap){const r=this.adapterRef.remoteStreamMap[t];e.push(r.mediaHelper.audio.audioStream)}this.adapterRef.localStream&&e.push(this.adapterRef.localStream.mediaHelper.audio.audioStream),this.recordManager.formatMedia.updateStream(e)}async startMediaRecording(e){const{recorder:t,recordConfig:r}=e;this.recordManager.record||(this.recordManager.record=new v.Record({logger:this.logger,client:this.adapterRef.instance}),this.recordManager.record.on("media-recording-stopped",(e=>{this.safeEmit("media-recording-stopped")}))),this.recordManager.formatMedia||(this.recordManager.formatMedia=new g.FormatMedia({adapterRef:this.adapterRef}));const n=[];if(this.adapterRef.localStream&&n.push(this.adapterRef.localStream.mediaHelper.audio.audioStream),"all"===t&&this.adapterRef.remoteStreamMap)for(var i in this.adapterRef.remoteStreamMap){const e=this.adapterRef.remoteStreamMap[i];n.push(e.mediaHelper.audio.audioStream)}const o=await this.recordManager.formatMedia.formatAudio(n),a=await this.recordManager.formatMedia.formatVideo(t,r),s=[];if(s.push(o,a),0!==s.length)return this.recordManager.record.start({uid:"",type:(null==r?void 0:r.recordType)||"video",recordName:null==r?void 0:r.recordName,reset:!0,stream:s});this.logger.log("没有没发现要录制的媒体流")}stopMediaRecording(e){if(!this.recordManager.record)throw new s.default({code:c.default.NO_RECORD,message:"操作非法：没有开始录制"});return this.recordManager.record.stop({})}cleanMediaRecording(){if(!this.recordManager.record)throw new s.default({code:c.default.NO_RECORD,message:"操作非法：没有开始录制"});return this.recordManager.record.clean()}downloadMediaRecording(){if(!this.recordManager.record)throw new s.default({code:c.default.NO_RECORD,message:"操作非法：没有开始录制"});return this.recordManager.record.download()}destroy(){this.logger&&this.logger.warn("清除 Client 实例中"),this._reset(),this.destroyed=!0,this.logger&&this.logger.warn("已清除 Client 实例")}}t.Client=y},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Base=void 0;const s=r(3),c=r(146),u=r(152),l=r(215),d=r(230),p=r(129),f=r(12),h=r(258),m=r(17),g=r(61),v=a(r(1)),y=a(r(0)),b=r(2),S=o(r(26)),_=r(58);let M=0;class T extends s.EventEmitter{constructor(e){super(),this.transportRebuildCnt=0,this.timeLast=Date.now(),this._params={appkey:"",mode:"rtc"},this.clientId=M++,this.adapterRef={channelInfo:{sessionConfig:{}},apiEvent:{},apiEvents:{},requestId:{},instance:this,deviceId:""},!0===e.debug?S.default.setLogLevel(S.loglevels.DEBUG):!1===e.debug&&b.getParameters().logLevel<=S.loglevels.WARNING&&S.default.setLogLevel(S.loglevels.WARNING),this.logger=new f.Logger({tagGen:()=>{let e="client"+(this.clientId||"");const t=this.getUid();return t&&(e+="#"+t),"CONNECTED"!==this.adapterRef.connectState.curState&&(e+=" "+this.adapterRef.connectState.curState),this.destroyed&&(e+=" DESTROYED"),e}}),this.adapterRef.logger=this.logger,this.recordManager={record:null,formatMedia:null},this._reset(),this.adapterRef.encryption=new g.Encryption(this.adapterRef),window.debugG2=!!e.debug,this.adapterRef.testConf={},this.sdkRef=e.ref}_reset(){this.sdkRef=null,this.adapterRef={channelInfo:{sessionConfig:{}},userPriority:{priority:100,preemtiveMode:!1},proxyServer:{enable:!1,type:3},apiEvent:{},apiEvents:{},requestId:{},instance:this,logger:this.logger,_enableRts:!1},this.adapterRef.mediaCapability=new h.MediaCapability(this.adapterRef),this.adapterRef.encryption=new g.Encryption(this.adapterRef),this._resetState(),this._destroyModule()}_getSupportedCodecs(){return m.getSupportedCodecs(...arguments)}initMode(){this.adapterRef._meetings||(this.adapterRef._meetings=new c.Meeting({sdkRef:this.sdkRef,adapterRef:this.adapterRef})),this.adapterRef._signalling||(this.adapterRef._signalling=new u.Signalling({adapterRef:this.adapterRef,logger:this.logger})),this.adapterRef._mediasoup||(this.adapterRef._mediasoup=new l.Mediasoup({adapterRef:this.adapterRef,logger:this.logger}))}initWebSocket(){this.adapterRef._statsReport||(this.adapterRef._statsReport=new d.StatsReport({sdkRef:this.sdkRef,adapterRef:this.adapterRef}),this.adapterRef._statsReport.start(),this.adapterRef._statsReport.startHeartbeat())}_destroyModule(){this.adapterRef._meetings&&(this.adapterRef._meetings.destroy(),this.adapterRef._meetings=null),this.adapterRef._signalling&&(this.adapterRef._signalling.destroy(),this.adapterRef._signalling=null),this.adapterRef._rtsTransport&&(this.adapterRef._rtsTransport.destroy(),this.adapterRef._rtsTransport=null),this.adapterRef._mediasoup&&(this.adapterRef._mediasoup.destroy(),this.adapterRef._mediasoup=null),this.adapterRef._statsReport&&(this.adapterRef._statsReport.destroy(),this.adapterRef._statsReport=null),this.recordManager.formatMedia&&(this.recordManager.formatMedia.destroy(),this.recordManager.formatMedia=null),this.recordManager.record&&(this.recordManager.record.destroy(),this.recordManager.record=null)}_resetState(){this._params.neRtcServerAddresses={},this.adapterRef.channelStatus="init",this.adapterRef.connectState={prevState:"DISCONNECTED",curState:"DISCONNECTED",reconnect:!1},this.adapterRef.networkQuality={},this.adapterRef.localStream=null,this.adapterRef.memberMap={},this.adapterRef.remoteStreamMap={},this.adapterRef.netStatusList=[],this.adapterRef.netStatusTimer&&(clearInterval(this.adapterRef.netStatusTimer),this.adapterRef.netStatusTimer=null),this.adapterRef.uid2SscrList={},this.adapterRef.state={lastDeviceStatus:{audio:{type:null,device:null},video:{type:null,device:null}},audioDeviceHasOpened:!1,videoDeviceHasOpened:!1,chromeScreenShareOpened:!1,startSessionTime:0,endSessionTime:0,startPubVideoTime:0,startPubScreenTime:0},Object.assign(this.adapterRef,{transportStats:{NetworkType:"unknown",OutgoingAvailableBandwidth:0,txRtt:0,rxRtt:0},sessionStats:{Duration:0,RecvBitrate:0,RecvBytes:0,SendBitrate:0,SendBytes:0,UserCount:0},localAudioStats:[],localVideoStats:[],localScreenStats:[],remoteAudioStats:{},remoteVideoStats:{},remoteScreenStats:{}})}setSessionConfig(e={}){this.adapterRef.channelInfo||(this.adapterRef.channelInfo={}),this.adapterRef.channelInfo.sessionConfig||(this.adapterRef.channelInfo.sessionConfig={}),this.adapterRef.channelInfo.sessionConfig=Object.assign(this.adapterRef.channelInfo.sessionConfig,e)}resetChannel(){this.adapterRef.networkQuality={},this.adapterRef.netStatusList=[];for(let e in this.adapterRef.remoteStreamMap){const t=this.adapterRef.remoteStreamMap[e];t.active&&(t.active=!1,t.stop(),t.clearRemotePubStatus(),this.adapterRef.instance.safeEmit("peer-leave",{uid:e}))}this.adapterRef.memberMap={},this.adapterRef.uid2SscrList={},this.adapterRef._mediasoup&&this.adapterRef._mediasoup.destroy()}async startSession(e=0){0===e?this.logger.log("开始音视频会话"):this.logger.log(`开始音视频会话：第${e}次`);let{wssArr:t,cid:r}=this.adapterRef.channelInfo;if(!t||0===t.length)throw this.logger.error("没有找到服务器地址: "+JSON.stringify(this.adapterRef.channelInfo)),this.adapterRef.channelStatus="leave",new v.default({code:y.default.NO_SERVER_ADDRESS,message:"no server address"});if(!r)throw this.logger.error("服务器没有分配cid"),this.adapterRef.channelStatus="leave",new v.default({code:y.default.INVALID_PARAMETER,message:"no cid"});if(this.logger.log(`开始连接服务器: ${this.adapterRef.channelInfo.wssArrIndex}, url:`,t),this.adapterRef.channelInfo.wssArrIndex>=t.length)throw this.logger.error("所有的服务器地址都连接失败"),this.adapterRef.channelInfo.wssArrIndex=0,this.adapterRef.channelStatus="leave",new v.default({code:y.default.SOCKET_ERROR,message:"socket error"});if(t[this.adapterRef.channelInfo.wssArrIndex],!this.adapterRef._signalling)throw new v.default({code:y.default.NO_SIGNALLING,message:"signalling error"});try{await this.adapterRef._signalling.init(!1,!1)}catch(e){throw this.adapterRef.channelStatus="leave",e}const n=t[this.adapterRef.channelInfo.wssArrIndex];if(t.splice(this.adapterRef.channelInfo.wssArrIndex,1),t.unshift(n),this.adapterRef.channelInfo.wssArrIndex=0,!this.adapterRef._statsReport)throw new v.default({code:y.default.NO_STATS,message:"no stats"});this.adapterRef._statsReport.statsStart()}stopSession(){this.logger.log("开始清除音视频会话"),this._destroyModule();const e=b.getParameters().localStreams.filter((e=>e.client===this&&!e.destroyed));e.length&&(b.getParameters().keepLocalstreamOnLeave?this.logger.log("当前模式下离开频道不会销毁localStream"):(this.logger.log(`即将销毁${e.length}个localStream`),e.forEach((e=>{e.destroy()})))),Object.values(this.adapterRef.remoteStreamMap).forEach((e=>{e.destroy()})),this.adapterRef.remoteStreamMap={},this.adapterRef.memberMap={},this.adapterRef.uid2SscrList={},this._resetState()}async clearMember(e){var t;this.logger.log(e+"离开房间");const r=this.adapterRef.remoteStreamMap[e];if(null==r?void 0:r.active){const n=["audio","video","screen"];for(let e of n)r.pubStatus[e].producerId&&this.adapterRef.instance.safeEmit("stream-removed",{stream:r,mediaType:e,reason:"onPeerLeave"});delete this.adapterRef.remoteStreamMap[e],delete this.adapterRef.memberMap[e],delete this.adapterRef.remoteAudioStats[e],delete this.adapterRef.remoteVideoStats[e],delete this.adapterRef.remoteScreenStats[e];for(let e of n)r.pubStatus[e].consumerId&&await(null===(t=this.adapterRef._mediasoup)||void 0===t?void 0:t.destroyConsumer(r.pubStatus[e].consumerId,r,e));r.active=!1,r.destroy();const i=this.adapterRef._statsReport&&this.adapterRef._statsReport.formativeStatsReport&&this.adapterRef._statsReport.formativeStatsReport.firstData.recvFirstData;i&&i[e]&&delete i[e]}this.adapterRef.netStatusList=this.adapterRef.netStatusList.filter(((t,r,n)=>t.uid!==e)),this.logger.log(e+" 离开房间 通知用户"),this.adapterRef._enableRts?this.adapterRef.instance.emit("rts-peer-leave",{uid:e}):this.adapterRef.instance.safeEmit("peer-leave",{uid:e})}setStartSessionTime(){this.adapterRef.state.startSessionTime=Date.now(),this.adapterRef.deviceId=_(this.adapterRef.channelInfo.cid+":"+this.adapterRef.channelInfo.uid+":"+this.adapterRef.state.startSessionTime)}setEndSessionTime(){if(!this.adapterRef.state.startSessionTime)return void this.logger.log("AbstractAdapter: setEndSessionTime: startSessionTime为空");this.adapterRef.state.endSessionTime=Date.now();const e=this.adapterRef.state.endSessionTime-this.adapterRef.state.startSessionTime;this.emit("sessionDuration",e),this.adapterRef.state.startSessionTime=0,this.adapterRef.state.endSessionTime=0}async reBuildRecvTransport(){if(this.transportRebuildCnt++,this.transportRebuildCnt>=b.getParameters().maxTransportRebuildCnt)return void this.logger.error("reBuildRecvTransport 达到最大重连次数："+this.transportRebuildCnt);if(this.logger.warn("下行通道异常，重新建立 #"+this.transportRebuildCnt),!this.adapterRef._mediasoup)throw new v.default({code:y.default.NO_MEDIASERVER,message:"media server error 3"});this.emit("pairing-reBuildRecvTransport-start"),this.adapterRef._mediasoup._recvTransport&&(this.adapterRef._mediasoup._recvTransport.close(),this.adapterRef._mediasoup.getIceStatus("recv"),this.adapterRef._mediasoup._recvTransport=null),this.adapterRef._mediasoup.init(),this.logger.log("下行通道异常, remoteStreamMap",this.adapterRef.remoteStreamMap),this.logger.log("this._eventQueue: ",this.adapterRef._mediasoup._eventQueue);let e=!1;for(const t in this.adapterRef.remoteStreamMap){const r=this.adapterRef.remoteStreamMap[t];if(r){r.pubStatus.audio.consumerStatus="init",r.pubStatus.video.consumerStatus="init",r.pubStatus.screen.consumerStatus="init",r.pubStatus.audio.consumerId="",r.pubStatus.video.consumerId="",r.pubStatus.screen.consumerId="",this.logger.log("重连逻辑订阅 start：",r.stringStreamID);try{await this.doSubscribe(r)}catch(t){this.logger.error("重连逻辑订阅 error: ",t,t.name,t.message),e=!0,this.emit("pairing-reBuildRecvTransport-error");break}this.logger.log("重连逻辑订阅 over: ",r.stringStreamID)}}e||this.emit("pairing-reBuildRecvTransport-success")}async rtsRequestKeyFrame(e){this.logger.log("请求关键帧: ",e.pubStatus.video.consumerId),this.adapterRef._signalling&&await this.adapterRef._signalling.rtsRequestKeyFrame(e.pubStatus.video.consumerId)}apiFrequencyControl(e){const{name:t,code:r,param:n}=e;if(!t)return;this.adapterRef.apiEvent[t]||(this.adapterRef.apiEvent[t]=[],this.adapterRef.apiEvents[t]=[],this.adapterRef.requestId[t]=0);let i=this.adapterRef.channelInfo.clientNtpTime-this.adapterRef.channelInfo.T4;i>0||(i=0);let o=Date.now()+i;if(o<=this.timeLast&&(o=this.timeLast+1),this.timeLast=o,this.adapterRef.apiEvent[t].length<10)this.adapterRef.apiEvent[t].push({cid:this.adapterRef.channelInfo&&this.adapterRef.channelInfo.cid,uid:this.adapterRef.channelInfo&&this.adapterRef.channelInfo.uid,code:r,name:t,time:o,param:n,request_id:this.adapterRef.requestId[t]++});else{if(!this.adapterRef.apiEvent||!this.adapterRef.apiEvent[t]||!this.adapterRef.apiEvent[t].length)throw new v.default({code:y.default.NOT_FOUND,message:"No apiEvent Named "+t});if(!this.adapterRef.apiEvent[t][0].time)throw new v.default({code:y.default.NOT_FOUND,message:"Invalid time for "});Date.now()-this.adapterRef.apiEvent[t][0].time<1e4?this.adapterRef.requestId[t]++:(this.adapterRef.apiEvents[t]=this.adapterRef.apiEvents[t].concat(this.adapterRef.apiEvent[t]),this.adapterRef.apiEvent[t]=[])}}apiEventReport(e,t){if(!e)return;let r=new p.DataReport({adapterRef:this.adapterRef,sdkRef:this.sdkRef});r[e](Object.assign({uid:""+this.adapterRef.channelInfo.uid,cid:""+this.adapterRef.channelInfo.cid,time:Date.now()},t)),r.send()}getUidAndKindBySsrc(e){var t,r;const n=["audio","video","screen"],i=["high","low"];for(let o of n)for(let n of i)if((null===(r=null===(t=this.adapterRef._mediasoup)||void 0===t?void 0:t.senderEncodingParameter[o][n])||void 0===r?void 0:r.ssrc)===e)return{uid:0,kind:o,streamType:n};for(let t in this.adapterRef.uid2SscrList){if(this.adapterRef.uid2SscrList[t].audio.ssrc==e)return{uid:t,kind:"audio",streamType:"high"};if(this.adapterRef.uid2SscrList[t].video&&this.adapterRef.uid2SscrList[t].video.ssrc==e)return{uid:t,kind:"video",streamType:"high"};if(this.adapterRef.uid2SscrList[t].screen&&this.adapterRef.uid2SscrList[t].screen.ssrc==e)return{uid:t,kind:"screen",streamType:"high"}}return{uid:0,kind:"",streamType:"high"}}getSsrcByUidAndKind(e,t){return this.adapterRef.uid2SscrList[e]&&this.adapterRef.uid2SscrList[e][t]}addSsrc(e,t,r){this.adapterRef.uid2SscrList[e]||(this.adapterRef.uid2SscrList[e]={audio:{ssrc:0},video:{ssrc:0},screen:{ssrc:0}}),this.adapterRef.uid2SscrList[e][t]?this.adapterRef.uid2SscrList[e][t].ssrc=r:this.adapterRef.uid2SscrList[e][t]={ssrc:r}}removeSsrc(e,t){this.adapterRef.uid2SscrList[e]&&(t?this.adapterRef.uid2SscrList[e][t]&&(this.adapterRef.uid2SscrList[e][t].ssrc=0):delete this.adapterRef.uid2SscrList[e])}isPublished(e){return e&&this.adapterRef.localStream===e&&(e.audio&&e.pubStatus.audio.audio||e.video&&e.pubStatus.video.video||e.screen&&e.pubStatus.screen.screen)}getPeer(e){return this.adapterRef._mediasoup?"send"==e?this.adapterRef._mediasoup._sendTransport&&this.adapterRef._mediasoup._sendTransport.handler._pc:"recv"==e?this.adapterRef._mediasoup._recvTransport&&this.adapterRef._mediasoup._recvTransport.handler._pc:null:null}destroy(){this.logger.log("base: destroy!"),this._reset()}}t.Base=T},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Meeting=void 0;const i=r(3),o=r(56),a=r(25),s=r(58),c=n(r(11)),u=n(r(1)),l=n(r(0));class d extends i.EventEmitter{constructor(e){super(),this.info={turn:!0,relay:!1,forward:!1,secure:!0},this._reset(),this.adapterRef=e.adapterRef,this.sdkRef=e.sdkRef,this.logger=e.adapterRef.logger.getChild((()=>{var t,r,n;let i="meeting";return this.info.secure||(i+=" INSECURE"),this.info.forward&&(i+=" FORWARD"),this.info.turn||(i+=" NOTURN"),(null===(n=null===(r=null===(t=e.adapterRef.instance)||void 0===t?void 0:t._params)||void 0===r?void 0:r.neRtcServerAddresses)||void 0===n?void 0:n.channelServer)&&(i+=" PRIVATE"),e.adapterRef._meetings!==this&&(i+=" DETACHED"),i}))}_reset(){}async getCloudProxyInfo(e){const{appkey:t,channelName:r,uid:n,token:i=""}=e;this.adapterRef.logger.log("getCloudProxyInfoUrl: ",a.getCloudProxyInfoUrl);let d=a.getCloudProxyInfoUrl;this.adapterRef.instance._params.neRtcServerAddresses.cloudProxyServer&&(d=this.adapterRef.instance._params.neRtcServerAddresses.cloudProxyServer,this.adapterRef.logger.log("私有化配置的 cloudProxyServer: ",d));let p=n;"string"===this.adapterRef.channelInfo.uidType&&(p=new c.default(p));let f=Date.parse(new Date)/1e3;try{const e=await o.ajax({url:d,type:"POST",data:{uid:p,appkey:t,channelName:r,secureType:i?"1":"2",osType:"4",version:a.SDK_VERSION+".0"||!1,curtime:""+f,checksum:s(t+"."+n+"."+f),proxy:"1",needIPV6:"0"}});if(this.adapterRef.logger.log("获取到云代理服务相关信息:",JSON.stringify(e)),this.adapterRef.instance.apiFrequencyControl({name:"setCloudProxyInfo",code:200===e.code?0:-1,param:{channelName:r,uid:n,appkey:t,token:i,reason:e.code}}),200===e.code){this.adapterRef.channelStatus="join";const{wsProxyArray:t,mediaProxyArray:r,mediaProxyToken:n,cname:i,curTime:o,uid:a}=e;this.adapterRef.instance._params.neRtcServerAddresses.webSocketProxyServer?(this.adapterRef.logger.warn("获取到云代理私有化 webSocketProxyServer:",this.adapterRef.instance._params.neRtcServerAddresses.webSocketProxyServer),this.adapterRef.proxyServer.wsProxyArray=[this.adapterRef.instance._params.neRtcServerAddresses.webSocketProxyServer]):this.adapterRef.proxyServer.wsProxyArray=t,this.adapterRef.instance._params.neRtcServerAddresses.mediaProxyServer?(this.adapterRef.logger.warn("获取到云代理私有化 mediaProxyServer:",this.adapterRef.instance._params.neRtcServerAddresses.mediaProxyServer),this.adapterRef.proxyServer.mediaProxyArray=[this.adapterRef.instance._params.neRtcServerAddresses.mediaProxyServer],this.adapterRef.proxyServer.mediaProxyToken="netease",this.adapterRef.proxyServer.credential="netease"):(this.adapterRef.proxyServer.mediaProxyArray=r,this.adapterRef.proxyServer.mediaProxyToken=n,this.adapterRef.proxyServer.credential=a+"/"+o)}else this.adapterRef.logger.log("获取到云代理服务相关信息, 回退")}catch(t){throw this.adapterRef.logger.log("获取到云代理服务相关信息发生错误:",t.name,t.message,t),this.adapterRef.channelStatus="leave",this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.emit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.apiFrequencyControl({name:"startProxyServer",code:-1,param:Object.assign(Object.assign({},e),{reason:t.message})}),new u.default({code:l.default.PROXY_SERVER_ERROR,message:"getCloudProxyInfo: "+t.message})}}async joinChannel(e){try{this.adapterRef.proxyServer.enable&&await this.getCloudProxyInfo(e)}catch(e){throw e}const{appkey:t,channelName:r,uid:n,wssArr:i=null,sessionMode:d="meeting",joinChannelRecordConfig:p,joinChannelLiveConfig:f,token:h=""}=e;let m=Date.now(),g=+new Date,v=a.getChannelInfoUrl;this.adapterRef.instance._params.neRtcServerAddresses.channelServer&&(v=this.adapterRef.instance._params.neRtcServerAddresses.channelServer,this.logger.log("私有化配置的 getChannelInfoUrl: ",v));let y=n;"string"===this.adapterRef.channelInfo.uidType&&(y=new c.default(y)),Object.assign(this.adapterRef.channelInfo,{uid:n,sessionMode:d,appkey:t});try{let c=await o.ajax({url:v,type:"POST",contentType:"application/x-www-form-urlencoded",header:{"X-Forwarded-For":this.adapterRef.testConf.ForwardedAddr||""},data:{uid:y,appkey:t,channelName:r,secureType:h?"1":"2",osType:"4",mode:2,netType:"0",version:a.SDK_VERSION+".0"||!1,curtime:g,checksum:h||s(t+"."+n+"."+g),webrtc:1,nrtcg2:1,t1:m}}),b=!("0"==n||"0"!=n&&!Boolean(n));if(this.info.secure=!!h,this.info.forward=!!this.adapterRef.testConf.ForwardedAddr,"string"==typeof c?(this.logger.warn("join 返回值类型为string，应为object。尝试进行强制类型转换。",c),c=JSON.parse(c)):this.logger.log("join 获取到房间信息:",JSON.stringify(c,null," ")),200===c.code){this.adapterRef.channelStatus="join";const{ips:o,time:a}=c;o&&o.uid||this.logger.warn("join 加入频道时服务端未返回uid");const s=c.config&&c.config.quality_level_limit||16;this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.startWssTime=Date.now();let u=o.webrtcarray&&o.webrtcarray.length&&o.webrtcarray[0];if(u&&this.adapterRef.proxyServer.wsProxyArray){const e=o.turnaddrs&&o.turnaddrs.length&&o.turnaddrs[0][0];let t=e.split(":").length>1?e.split(":")[1]:"",r=u.split("/").length>1?u.split("/")[1]:"";this.adapterRef.instance._params.neRtcServerAddresses.webSocketProxyServer&&(t=r.split(":")[1]),r&&t?this.adapterRef.proxyServer.wsProxyArray=this.adapterRef.proxyServer.wsProxyArray.map((e=>e+"/"+r.split(":")[0]+":"+t)):this.adapterRef.logger.log(`join 云代理无法获取到代理信息, serverurl: ${r}, port: ${t}`)}Object.assign(this.adapterRef.channelInfo,{cid:+c.cid,token:c.token,turnToken:o.token,channelName:r,wssArr:i||this.adapterRef.proxyServer.wsProxyArray||o.webrtcarray||[],relayaddrs:this.adapterRef.proxyServer.mediaProxyArray||o.relayaddrs||null,relaytoken:this.adapterRef.proxyServer.mediaProxyToken||o.relaytoken||null,wssArrIndex:0,maxVideoQuality:s,netDetect:!1},{uid:b?n:o.uid,sessionMode:d,appkey:t}),e.uid=e.uid?e.uid:this.adapterRef.channelInfo.uid,this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.token=c.token,this.adapterRef.channelInfo.T4=Date.now();let l=this.adapterRef.channelInfo.T4-a.t1-(a.t3-a.t2);return this.adapterRef.channelInfo.clientNtpTime=a.t3+Math.round(l/2),this.adapterRef.instance.setSessionConfig(Object.assign({maxVideoQuality:s},f,p)),this.info.relay=o.relayaddrs&&o.relayaddrs.length>0,this.info.turn=o.turnaddrs&&o.turnaddrs.length>0,this.adapterRef.instance.startSession()}{const e=c.desc&&""!==c.desc?"join: "+c.desc:"join: 服务器不允许加入房间, code "+c.code;return this.logger.warn(e),this.adapterRef.channelStatus="leave",this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.apiEventReport("setLogin",{a_record:p.recordAudio,v_record:p.recordVideo,record_type:p.recordType,host_speaker:p.isHostSpeaker,result:c.code,serverIp:c.ips&&c.ips.turnaddrs&&c.ips.turnaddrs.length&&c.ips.turnaddrs[0]}),Promise.reject(new u.default({code:c.code||l.default.NO_SERVER_ADDRESS,message:e}))}}catch(e){throw this.logger.log("joing 获取到房间信息错误:",e.name,e.message),this.adapterRef.channelStatus="leave",this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.apiEventReport("setLogin",{a_record:p.recordAudio,v_record:p.recordVideo,record_type:p.recordType,host_speaker:p.isHostSpeaker,result:"join() 语法错误: "+e.message,serverIp:""}),new u.default({code:l.default.UNKNOWN,message:"join() 异常: "+e.message})}}leaveChannel(){if(this.adapterRef.instance.apiEventReport("setLogout",{reason:this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason||0}),!this.adapterRef._signalling)throw new u.default({code:l.default.NO_SIGNALLING,message:"No _signalling"});return this.adapterRef._signalling.doSendLogout().then((()=>(this.adapterRef.channelStatus="leave",this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.stopSession())))}async addTasks(e){const{rtmpTasks:t=[]}=e;let r=null;if(this.adapterRef.channelInfo.cid?t&&Array.isArray(t)&&t.length||(r="addTasks: 参数格式错误，rtmpTasks为空，或者该数组长度为空"):r="addTasks: 请在加入房间后进行直播推流操作",r)throw this.logger.error(r),new u.default({code:l.default.INVALID_OPERATION,message:r});let n=a.roomsTaskUrl;this.adapterRef.instance._params.neRtcServerAddresses.roomServer&&(n=this.adapterRef.instance._params.neRtcServerAddresses.roomServer,this.logger.log("私有化配置的 roomsTaskUrl: ",n)),n=`${n}${this.adapterRef.channelInfo.cid}/tasks`;let i=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(i=new c.default(i));for(let r=0;r<t.length;r++){t[r].hostUid=i,t[r].version=1,this.logger.log("rtmpTask: ",JSON.stringify(t[r]));const a=t[r].layout;a.users.forEach((e=>{"string"==typeof e.uid&&(e.uid=new c.default(e.uid))}));try{const e=await o.ajax({url:n,type:"POST",contentType:"application/json;charset=utf-8",header:{Token:this.adapterRef.channelInfo.turnToken},data:{version:1,taskId:t[r].taskId,streamUrl:t[r].streamUrl,record:t[r].record,hostUid:t[r].hostUid,layout:a,config:t[r].config,extraInfo:t[r].extraInfo}});if(200!==e.code)return this.logger.error("添加推流任务失败: ",e),Promise.reject(new u.default({code:l.default.ADD_TASK_FAILED,message:"addTasks: 服务器反馈错误码 "+e.code}));this.logger.log("添加推流任务完成")}catch(e){return this.logger.error("addTasks: ",e.name,e.message),Promise.reject(new u.default({code:l.default.ADD_TASK_FAILED,message:"addTasks: 异常 "+e.name+", "+e.message}))}}}async deleteTasks(e){const{taskIds:t=[]}=e;if(!this.adapterRef.channelInfo.cid)return this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:-1,param:JSON.stringify({error:"请先加入房间",version:1,taskId:t.length?t[0]:""},null," ")}),this.logger.error("请先加入房间"),Promise.reject(new u.default({code:l.default.INVALID_OPERATION,message:"please join room first"}));if(!t||!Array.isArray(t)||!t.length)return this.logger.error("删除推流任务失败: 参数格式错误，taskIds为空，或者该数组长度为空"),Promise.reject(new u.default({code:l.default.INVALID_PARAMETER,message:"invalid parameter"}));let r=a.roomsTaskUrl;this.logger.log("roomsTaskUrl: ",a.roomsTaskUrl),this.adapterRef.instance._params.neRtcServerAddresses.roomServer&&(r=this.adapterRef.instance._params.neRtcServerAddresses.roomServer,this.logger.log("私有化配置的 roomsTaskUrl: ",r)),r=`${r}${this.adapterRef.channelInfo.cid}/tasks/delete`;for(let e=0;e<t.length;e++){this.logger.log("deleteTasks: ",t[e]);try{const n=await o.ajax({url:r,type:"POST",contentType:"application/json;charset=utf-8",header:{Token:this.adapterRef.channelInfo.turnToken},data:{taskId:t[e]}});return 200===n.code?(this.logger.log("删除推流任务完成"),this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:0,param:JSON.stringify({taskId:t[e]},null," ")}),Promise.resolve()):(this.logger.log("删除推流任务请求失败:",JSON.stringify(n)),this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:n.code,param:JSON.stringify({taskId:t[e]},null," ")}),Promise.reject(new u.default({code:l.default.DELETE_TASK_FAILED,message:"delete task failed"})))}catch(r){return this.logger.error("deleteTasks发生错误: ",r.name,r.message,r),this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:-1,param:JSON.stringify({error:"code error",taskId:t[e]},null," ")}),Promise.reject(new u.default({code:l.default.DELETE_TASK_FAILED,message:"delete task failed"}))}}}async updateTasks(e){const{rtmpTasks:t=[]}=e;if(!this.adapterRef.channelInfo.cid)return this.adapterRef.instance.apiFrequencyControl({name:"updateTasks",code:-1,param:JSON.stringify({error:"请先加入房间",version:1,taskId:t.length?t[0].taskId:""},null," ")}),this.logger.error("请先加入房间"),Promise.reject(new u.default({code:l.default.INVALID_OPERATION,message:"please join room first"}));if(!t||!Array.isArray(t)||!t.length)return this.logger.error("更新推流任务失败: 参数格式错误，rtmpTasks为空，或者该数组长度为空"),Promise.reject(new u.default({code:l.default.INVALID_PARAMETER,message:"invalid parameter"}));let r=a.roomsTaskUrl;this.logger.log("roomsTaskUrl: ",a.roomsTaskUrl),this.adapterRef.instance._params.neRtcServerAddresses.roomServer&&(r=this.adapterRef.instance._params.neRtcServerAddresses.roomServer,this.logger.log("私有化配置的 roomsTaskUrl: ",r)),r=`${r}${this.adapterRef.channelInfo.cid}/task/update`;let n=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(n=new c.default(n));for(let e=0;e<t.length;e++){const i=t[e].layout;i.users.forEach((e=>{"string"==typeof e.uid&&(e.uid=new c.default(e.uid))}));try{const a=await o.ajax({url:r,type:"POST",contentType:"application/json;charset=utf-8",header:{Token:this.adapterRef.channelInfo.turnToken},data:{version:1,taskId:t[e].taskId,streamUrl:t[e].streamUrl,record:t[e].record,hostUid:n,layout:i,config:t[e].config}});return 200===a.code?(this.logger.log("更新推流任务完成"),this.adapterRef.instance.apiFrequencyControl({name:"updateTasks",code:0,param:JSON.stringify({version:1,taskId:t[e].taskId,streamUrl:t[e].streamUrl,record:t[e].record,hostUid:parseInt(t[e].hostUid),layout:t[e].layout,config:t[e].config},null," ")}),Promise.resolve()):(this.logger.log("更新推流任务失败：",JSON.stringify(a)),this.adapterRef.instance.apiFrequencyControl({name:"updateTasks",code:a.code,param:JSON.stringify({version:1,taskId:t[e].taskId,streamUrl:t[e].streamUrl,record:t[e].record,hostUid:parseInt(t[e].hostUid),layout:t[e].layout,config:t[e].config},null," ")}),Promise.reject(new u.default({code:l.default.UPDATE_TASKS_FAILED,message:"update task failed"})))}catch(r){return this.logger.error("updateTasks 发生错误: ",r.name,r.message,r),this.adapterRef.instance.apiFrequencyControl({name:"updateTasks",code:-1,param:JSON.stringify({error:"code error",version:1,taskId:t[e].taskId,streamUrl:t[e].streamUrl,record:t[e].record,hostUid:parseInt(t[e].hostUid),layout:t[e].layout,config:t[e].config},null," ")}),Promise.reject(new u.default({code:l.default.UPDATE_TASKS_FAILED,message:"update task failed"}))}}}destroy(){this.logger.log("清除 meeting"),this._reset()}}t.Meeting=d},function(e,t,r){var n=r(11),i=e.exports;!function(){var e,t,r,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function s(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,(function(e){var t=a[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}"function"!=typeof i.stringify&&(i.stringify=function(i,o,a){var c;if(e="",t="","number"==typeof a)for(c=0;c<a;c+=1)t+=" ";else"string"==typeof a&&(t=a);if(r=o,o&&"function"!=typeof o&&("object"!=typeof o||"number"!=typeof o.length))throw new Error("JSON.stringify");return function i(o,a){var c,u,l,d,p,f=e,h=a[o],m=null!=h&&(h instanceof n||n.isBigNumber(h));switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(o)),"function"==typeof r&&(h=r.call(a,o,h)),typeof h){case"string":return m?h:s(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":case"bigint":return String(h);case"object":if(!h)return"null";if(e+=t,p=[],"[object Array]"===Object.prototype.toString.apply(h)){for(d=h.length,c=0;c<d;c+=1)p[c]=i(c,h)||"null";return l=0===p.length?"[]":e?"[\n"+e+p.join(",\n"+e)+"\n"+f+"]":"["+p.join(",")+"]",e=f,l}if(r&&"object"==typeof r)for(d=r.length,c=0;c<d;c+=1)"string"==typeof r[c]&&(l=i(u=r[c],h))&&p.push(s(u)+(e?": ":":")+l);else Object.keys(h).forEach((function(t){var r=i(t,h);r&&p.push(s(t)+(e?": ":":")+r)}));return l=0===p.length?"{}":e?"{\n"+e+p.join(",\n"+e)+"\n"+f+"}":"{"+p.join(",")+"}",e=f,l}}("",{"":i})})}()},function(e,t,r){var n=null;const i=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,o=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;e.exports=function(e){var t={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=e){if(!0===e.strict&&(t.strict=!0),!0===e.storeAsString&&(t.storeAsString=!0),t.alwaysParseAsBig=!0===e.alwaysParseAsBig&&e.alwaysParseAsBig,t.useNativeBigInt=!0===e.useNativeBigInt&&e.useNativeBigInt,void 0!==e.constructorAction){if("error"!==e.constructorAction&&"ignore"!==e.constructorAction&&"preserve"!==e.constructorAction)throw new Error('Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed '+e.constructorAction);t.constructorAction=e.constructorAction}if(void 0!==e.protoAction){if("error"!==e.protoAction&&"ignore"!==e.protoAction&&"preserve"!==e.protoAction)throw new Error('Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed '+e.protoAction);t.protoAction=e.protoAction}}var a,s,c,u,l={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},d=function(e){throw{name:"SyntaxError",message:e,at:a,text:c}},p=function(e){return e&&e!==s&&d("Expected '"+e+"' instead of '"+s+"'"),s=c.charAt(a),a+=1,s},f=function(){var e,i="";for("-"===s&&(i="-",p("-"));s>="0"&&s<="9";)i+=s,p();if("."===s)for(i+=".";p()&&s>="0"&&s<="9";)i+=s;if("e"===s||"E"===s)for(i+=s,p(),"-"!==s&&"+"!==s||(i+=s,p());s>="0"&&s<="9";)i+=s,p();if(e=+i,isFinite(e))return null==n&&(n=r(11)),i.length>15?t.storeAsString?i:t.useNativeBigInt?BigInt(i):new n(i):t.alwaysParseAsBig?t.useNativeBigInt?BigInt(e):new n(e):e;d("Bad number")},h=function(){var e,t,r,n="";if('"'===s)for(var i=a;p();){if('"'===s)return a-1>i&&(n+=c.substring(i,a-1)),p(),n;if("\\"===s){if(a-1>i&&(n+=c.substring(i,a-1)),p(),"u"===s){for(r=0,t=0;t<4&&(e=parseInt(p(),16),isFinite(e));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else{if("string"!=typeof l[s])break;n+=l[s]}i=a}}d("Bad string")},m=function(){for(;s&&s<=" ";)p()};return u=function(){switch(m(),s){case"{":return function(){var e,r=Object.create(null);if("{"===s){if(p("{"),m(),"}"===s)return p("}"),r;for(;s;){if(e=h(),m(),p(":"),!0===t.strict&&Object.hasOwnProperty.call(r,e)&&d('Duplicate key "'+e+'"'),!0===i.test(e)?"error"===t.protoAction?d("Object contains forbidden prototype property"):"ignore"===t.protoAction?u():r[e]=u():!0===o.test(e)?"error"===t.constructorAction?d("Object contains forbidden constructor property"):"ignore"===t.constructorAction?u():r[e]=u():r[e]=u(),m(),"}"===s)return p("}"),r;p(","),m()}}d("Bad object")}();case"[":return function(){var e=[];if("["===s){if(p("["),m(),"]"===s)return p("]"),e;for(;s;){if(e.push(u()),m(),"]"===s)return p("]"),e;p(","),m()}}d("Bad array")}();case'"':return h();case"-":return f();default:return s>="0"&&s<="9"?f():function(){switch(s){case"t":return p("t"),p("r"),p("u"),p("e"),!0;case"f":return p("f"),p("a"),p("l"),p("s"),p("e"),!1;case"n":return p("n"),p("u"),p("l"),p("l"),null}d("Unexpected '"+s+"'")}()}},function(e,t){var r;return c=e+"",a=0,s=" ",r=u(),m(),s&&d("Syntax error"),"function"==typeof t?function e(r,n){var i,o=r[n];return o&&"object"==typeof o&&Object.keys(o).forEach((function(t){void 0!==(i=e(o,t))?o[t]=i:delete o[t]})),t.call(r,n,o)}({"":r},""):r}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Config=t.ENV=void 0,t.Config={checkSumUrl:"https://nrtc.netease.im/demo/getChecksum.action",createChannelUrl:"https://nrtc.netease.im/nrtc/createChannel.action",getChannelInfoUrl:"https://nrtc.netease.im/nrtc/getChannelInfos.action",roomsTaskUrl:"https://roomserver.netease.im/v2/sdk/rooms/",getCloudProxyInfoUrl:"https://ap-prd-jd.netease.im/v1/g2/getCloudProxyInfo"},t.ENV="production"},function(e,t){var r,n;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],n=0;n<e.length;n+=3)for(var i=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?t.push(r.charAt(i>>>6*(3-o)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],n=0,i=0;n<e.length;i=++n%4)0!=i&&t.push((r.indexOf(e.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|r.indexOf(e.charAt(n))>>>6-2*i);return t}},e.exports=n},function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Signalling=void 0;const i=r(3),o=r(153),a=r(16),s=n(r(11)),c=r(25),u=r(32),l=r(61),d=r(162),p=r(163),f=n(r(1)),h=n(r(0)),m=r(34),g=r(2),v=r(165);class y extends i.EventEmitter{constructor(e){super(),this._reconnectionTimer=null,this._protoo=null,this._url=null,this._resolve=null,this._reject=null,this.consumers={},this.keepAliveTimer=null,this._reconnectionTimeout=3e4,this.reconnectionControl={current:null,next:null,copynext:null,blocker:null,pausers:[],resumers:[]},this.autoMask={timer:null,data:[]},this.logger=e.logger.getChild((()=>{var t;let r="signal";return this._protoo?(this._protoo.id&&(r+="#"+this._protoo.id+"_"+(null===(t=this._protoo._transport)||void 0===t?void 0:t.wsid)),this._protoo.connected||(r+="!connected")):r+=" PROTOO_UNINIT",e.adapterRef._signalling!==this&&(r+=" DETACHED"),r})),this._reset(),this.adapterRef=e.adapterRef,this.browserDevice=m.getOSName()+"-"+m.getBrowserInfo().browserName+"-"+m.getBrowserInfo().browserVersion}async _reset(){this._reconnectionTimer&&clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null,this._destroyProtoo(),this.reconnectionControl.current=null,this.reconnectionControl.next=null,this.reconnectionControl.copynext=null,this._reconnectionTimeout=3e4,this._resolve=null,this._reject=null}init(e,t){return this._reconnectionTimer?Promise.resolve():new Promise(((r,n)=>{e||(this._resolve=r),e||(this._reject=n),this.reconnectionControl.current;const i=this.reconnectionControl.next||{timeout:t?g.getParameters().reconnectionFirstTimeout:0,url:this.adapterRef.channelInfo.wssArr[0],serverIndex:0,times:t?1:0,isJoinRetry:e,isReconnection:t};this.adapterRef.channelInfo.wssArrIndex=i.serverIndex,e?t?this.adapterRef.logger.error(`Signalling 开始尝试第 ${i.serverIndex+1}/${this.adapterRef.channelInfo.wssArr.length} 台服务器的第 ${i.times}/${g.getParameters().reconnectionMaxRetry} 次重连，退避时间：${i.timeout}毫秒，服务器地址：${i.url}`):this.adapterRef.logger.error(`Join: 正在尝试第 ${i.serverIndex+1}/${this.adapterRef.channelInfo.wssArr.length} 台服务器的第 ${i.times}/${g.getParameters().joinMaxRetry} 次重连，退避时间：${i.timeout}毫秒，服务器地址：${i.url}`):this.adapterRef.logger.log(`Join: 正在尝试第 ${i.serverIndex+1} / ${this.adapterRef.channelInfo.wssArr.length} 个服务器的第 ${i.times} / ${g.getParameters().joinMaxRetry} 次连接`),this.reconnectionControl.current=i,this.reconnectionControl.next=null,this._init(i.url);let o=Object.assign({},i);i.times?o.serverIndex++:(o.times=1,o.serverIndex=1),o.serverIndex>=this.adapterRef.channelInfo.wssArr.length&&(o.times++,o.serverIndex=0),e?o.timeout=g.getParameters().joinFirstTimeout+2e3*(o.times-1):t&&(o.timeout=g.getParameters().reconnectionFirstTimeout+2e3*(o.times-1)),o.timeout=2e3*o.times,o.isJoinRetry=e,o.isReconnection=t,o.url=this.adapterRef.channelInfo.wssArr[o.serverIndex],this.reconnectionControl.next=this.reconnectionControl.copynext=o,this._reconnectionTimer&&clearTimeout(this._reconnectionTimer),this._reconnectionTimer=setTimeout((()=>{this._reconnectionTimer&&clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null,this._destroyProtoo(),t?(this.adapterRef.instance.emit("pairing-websocket-reconnection-error"),this._reconnection()):this._connection()}),o.timeout)}))}async _connection(){this._destroyProtoo();const e=this.reconnectionControl.current,t=this.reconnectionControl.next;t?!e||t.times<=g.getParameters().joinMaxRetry?this.init(!0,!1):(this.adapterRef.logger.error("所有的服务器地址都连接失败, 主动离开房间"),this.adapterRef.channelInfo.wssArrIndex=0,this.adapterRef.instance.leave(),this.adapterRef.instance.emit("error","SOCKET_ERROR"),this._reject&&this._reject("timeout")):this.adapterRef.logger.error("Join结束")}async _reconnection(){if(!this._reconnectionTimer){this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="CONNECTING",this.adapterRef.connectState.reconnect=!0,this.adapterRef.connectState.prevState!==this.adapterRef.connectState.curState&&this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.emit("pairing-websocket-reconnection-start"),this._destroyProtoo(),"CONNECTED"===this.adapterRef.connectState.prevState&&(this.adapterRef.netStatusList.forEach((e=>{e.uplinkNetworkQuality=0,e.downlinkNetworkQuality=0})),this.adapterRef.instance.safeEmit("network-quality",this.adapterRef.netStatusList)),this.reconnectionControl.pausers.length&&(this.logger.log("重连过程暂停"),this.reconnectionControl.pausers.forEach((e=>e({reason:"reconnection-start"}))),this.reconnectionControl.pausers=[],await new Promise((e=>{this.reconnectionControl.blocker=e})));for(let e in this.adapterRef.remoteStreamMap){const t=this.adapterRef.remoteStreamMap[e];t._play&&(this.logger.warn("Destroy Remote Player",e),t._play.destroy())}this.reconnectionControl.next&&this.reconnectionControl.next.times>g.getParameters().reconnectionMaxRetry?(this.adapterRef.instance.emit("pairing-websocket-reconnection-skip"),this.adapterRef.logger.error("所有的服务器地址都连接失败, 主动离开房间"),this.adapterRef.channelInfo.wssArrIndex=0,this.adapterRef.instance.leave(),this.adapterRef.instance.emit("error","SOCKET_ERROR")):this.init(!0,!0)}}_init(e){-1===e.indexOf("?")&&(e+="?"),this.logger.log("Signalling: init url=",e),this.adapterRef.channelInfo._protooUrl=e,this._url=`${-1===e.indexOf("://")?"wss://":""}${e}&cid=${this.adapterRef.channelInfo.cid}&uid=${this.adapterRef.channelInfo.uid}&deviceid=${this.adapterRef.deviceId}`,this.logger.log("连接的url: ",this._url);const t=new v.WebSocketTransport(this._url,{retry:{retries:0,factor:2,minTimeout:1e3,maxTimeout:2e3,forever:!1,maxRetryTime:2e3}});this._protoo=new v.Peer(t),this._bindEvent()}_bindEvent(){if(!this._protoo)throw new f.default({code:h.default.NOT_FOUND,message:"No this._protoo 1"});this._protoo.on("open",this.join.bind(this)),this._protoo.on("failed",this._handleFailed.bind(this)),this._protoo.on("notification",this._handleMessage.bind(this)),this._protoo.on("close",this._handleClose.bind(this)),this._protoo.on("disconnected",this._handleDisconnected.bind(this,this._protoo))}_destroyProtoo(){var e;if(this._protoo){this.logger.debug(`信令通道#${this._protoo.id}_${null===(e=this._protoo._transport)||void 0===e?void 0:e.wsid} 被主动关闭。`),this._protoo.removeAllListeners();try{this._protoo&&this._protoo.close()}catch(e){}this._protoo=null}}async _handleMessage(e){var t,r;switch(e.method){case"OnPeerJoin":{const{requestId:t,externData:r}=e.data;this.logger.log("收到OnPeerJoin成员加入消息 uid =",r.uid);let n=r.uid;"string"===this.adapterRef.channelInfo.uidType&&(n=new s.default(n),n=n.toString());let i=this.adapterRef.remoteStreamMap[n];i||(i=new o.RemoteStream({uid:n,audio:!1,video:!1,screen:!1,client:this.adapterRef.instance,platformType:r.platformType}),this.adapterRef.remoteStreamMap[n]=i,this.adapterRef.memberMap[n]=n),this.adapterRef.instance._roleInfo.audienceList[n]=!1,this.adapterRef.instance.safeEmit("peer-online",{uid:n});break}case"OnPeerLeave":{const{requestId:t,externData:r}=e.data;this.logger.log("OnPeerLeave externData =",r),r.userList&&r.userList.forEach((e=>{var t;let r=e.uid;"string"===this.adapterRef.channelInfo.uidType&&(r=new s.default(r),r=r.toString()),null===(t=this.adapterRef._mediasoup)||void 0===t||t.removeUselessConsumeRequest({uid:r}),this.adapterRef.instance.clearMember(r),this.adapterRef.instance.removeSsrc(r),delete this.adapterRef.instance._roleInfo.audienceList[r]}));break}case"OnNewProducer":{const{requestId:n,externData:i}=e.data;this.logger.log("收到OnNewProducer发布消息 externData =",JSON.stringify(i.producerInfo));let a,{uid:c,producerId:u,mediaType:l,mute:d,simulcastEnable:p}=i.producerInfo;switch("string"===this.adapterRef.channelInfo.uidType&&(c=new s.default(c),c=c.toString()),l){case"video":a="video";break;case"screenShare":a="screen";break;case"audio":a="audio";break;default:return void this.logger.warn(`OnNewProducer 不支持的媒体类型:${l}, uid ${c}`)}let f=this.adapterRef.remoteStreamMap[c];f||(f=new o.RemoteStream({uid:c,audio:"audio"===a,video:"video"===a,screen:"screen"===a,client:this.adapterRef.instance,platformType:i.platformType}),this.adapterRef.remoteStreamMap[c]=f,this.adapterRef.memberMap[c]=c),f.pubStatus[a].consumerId?null===(t=this.adapterRef._mediasoup)||void 0===t||t.destroyConsumer(f.pubStatus[a].consumerId,f,a):null===(r=this.adapterRef._mediasoup)||void 0===r||r.removeUselessConsumeRequest({producerId:f.pubStatus[a].producerId}),f[a]=!0,f.pubStatus[a][a]=!0,f.pubStatus[a].producerId=u,f.pubStatus[a].mute=d,f.pubStatus[a].simulcastEnable=p,f.pubStatus[a].consumerId="",this.adapterRef._enableRts&&this.adapterRef._rtsTransport?this.adapterRef.instance.emit("rts-stream-added",{stream:f,kind:l}):this.adapterRef.instance.safeEmit("stream-added",{stream:f,mediaType:a}),d&&this.adapterRef.instance.safeEmit("mute-"+a,{uid:c});break}case"OnProducerClose":{const{requestId:t,code:r,errMsg:n,externData:i}=e.data;let{uid:o,producerId:a,mediaType:c,cid:l}=i;"string"===this.adapterRef.channelInfo.uidType&&(o=new s.default(o),o=o.toString());let d,p=this.adapterRef.remoteStreamMap[o];if(!p)return void this.logger.warn(`收到OnProducerClose消息，但是当前没有该Producer： code = ${r}, errMsg = ${n}, uid = ${o}, mediaType = ${c}, producerId: ${a}`);switch(this.logger.log(`收到OnProducerClose消息 code = ${r}, errMsg = ${n}, uid = ${o}, mediaType = ${c}, producerId: ${a}`),c){case"video":d="video";break;case"screenShare":d="screen";break;case"audio":d="audio";break;default:return void this.logger.warn(`OnProducerClose 不支持的媒体类型 ${c} ${o}`)}if(p.pubStatus[d].producerId!==a)return void this.logger.log("该 producerId 已经无效，不处理");if(!this.adapterRef._mediasoup)throw new f.default({code:h.default.NO_MEDIASERVER,message:"media server error 22"});this.adapterRef._mediasoup.removeUselessConsumeRequest({producerId:a}),p.pubStatus[d].consumerId&&(this.adapterRef._mediasoup.destroyConsumer(p.pubStatus[d].consumerId,p,d),p.pubStatus[d].consumerId=""),this.adapterRef.instance.removeSsrc(o,d),p.subStatus[d]=!1,p.pubStatus[d][d]=!1,p[d]=!1,p.pubStatus[d].consumerId="",p.pubStatus[d].producerId="";const m=this.adapterRef._statsReport&&this.adapterRef._statsReport.formativeStatsReport&&this.adapterRef._statsReport.formativeStatsReport.firstData.recvFirstData[o];"audio"===d?(p.mediaHelper.audio.micTrack=null,u.emptyStreamWith(p.mediaHelper.audio.audioStream,null),delete this.adapterRef.remoteAudioStats[o],m&&(m.recvFirstAudioFrame=!1,m.recvFirstAudioPackage=!1)):"video"===d?(p.mediaHelper.video.cameraTrack=null,u.emptyStreamWith(p.mediaHelper.video.videoStream,null),delete this.adapterRef.remoteVideoStats[o],m&&(m.recvFirstVideoFrame=!1,m.recvFirstVideoPackage=!1,m.videoTotalPlayDuration=0)):"screen"===d&&(p.mediaHelper.screen.screenVideoTrack=null,u.emptyStreamWith(p.mediaHelper.screen.screenVideoStream,null),delete this.adapterRef.remoteScreenStats[o],m&&(m.recvFirstScreenFrame=!1,m.recvFirstScreenPackage=!1,m.screenTotalPlayDuration=0)),this.adapterRef._enableRts?this.adapterRef.instance.emit("rts-stream-removed",{stream:p}):this.adapterRef.instance.safeEmit("stream-removed",{stream:p,mediaType:d});break}case"OnConsumerClose":{const{requestId:t,code:r,errMsg:n,consumerId:i,producerId:o}=e.data;this.logger.log(`chence OnConsumerClose code = ${r} errMsg = ${n} producerId = ${o}`);const a=this.consumers[i];if(!a)break;a.close();break}case"consumerPaused":{const{consumerId:t}=e.data;if(!this.consumers[t])break;break}case"consumerResumed":case"consumerScore":case"activeSpeaker":break;case"OnTransportClose":{const{requestId:t,code:r,errMsg:n,transportId:i}=e.data;if(this.logger.warn(`chence OnTransportClose: code = ${r}, errMsg = ${n}, transportId = ${i}`),!this.adapterRef._mediasoup)throw new f.default({code:h.default.NO_MEDIASERVER,message:"media server error 23"});this.adapterRef._mediasoup._sendTransport&&(this.adapterRef._mediasoup._micProducer||this.adapterRef._mediasoup._webcamProducer)?(this.logger.warn("服务器媒体进程crash，上行媒体和下行媒体同时重连"),this.adapterRef.channelStatus="connectioning",this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"OnTransportClose"}),this._reconnection()):this.logger.warn("服务器发送了错误信息");break}case"OnConsumerClose":{const{requestId:t,code:r,errMsg:n,consumerId:i,producerId:o}=e.data;if(this.logger.warn(`chence OnConsumerClose: code = ${r}, errMsg = ${n} consumerId = ${i}, producerId = ${o}`),!this.adapterRef._mediasoup)throw new f.default({code:h.default.NO_MEDIASERVER,message:"media server error 24"});this.adapterRef._mediasoup._recvTransport?(this.logger.warn("下行媒体同时重连"),this.adapterRef.channelStatus="connectioning",this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"OnConsumerClose"}),this._reconnection()):this.logger.warn("服务器发送了错误信息");break}case"OnSignalRestart":{const{requestId:t,code:r,errMsg:n}=e.data;if(this.logger.warn(`chence OnSignalRestart code = ${r} errMsg = ${n}`),this.logger.warn("服务器信令进程crash，重连"),this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"OnSignalRestart"}),!this._protoo)throw new f.default({code:h.default.NOT_FOUND,message:"No this._protoo 2"});this._protoo.connected&&"CONNECTED"===this.adapterRef.connectState.curState||this._reconnection();break}case"OnPeerClose":this.logger.warn("相同UID在其他地方登录，您被提出房间"),this.adapterRef.instance.safeEmit("uid-duplicate"),this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=3e4,this.adapterRef.instance.leave();break;case"OnKickOff":{let{msg:t,reason:r}=e.data.externData;this._handleKickedNotify(r);break}case"OnUserData":{let{type:t,data:r}=e.data.externData;if("StreamStatus"===t)this._handleStreamStatusNotify(r);else if("NetStatus"===t)this._handleNetStatusNotify(r);else if("Mute"===t)this.logger.log("mute变更: ",JSON.stringify(r,null,"")),this._handleMuteNotify(r);else if("UserRole"===t)this.logger.log("UserRole变更: ",JSON.stringify(r,null,"")),this._handleUserRoleNotify(e.data.externData);else if("RtmpTaskStatus"===t)this.logger.log("RtmpTaskStatus变更: ",JSON.stringify(r,null,"")),this.adapterRef.instance.safeEmit("rtmp-state",r);else if("AutoMaskUid"===t){const e=r;this.logger.log("收到打码通知：",e.maskUid,"时长",e.duration,"秒"),e.maskUid&&e.duration&&(e.targetEndMs=Date.now()+1e3*e.duration,this.autoMask.data.push(e),this.updateMaskStatus())}else if("MediaCapability"===t){if(this.logger.warn("MediaCapability房间能力变更: ",JSON.stringify(r,null,"")),this.adapterRef.mediaCapability.parseRoom(r),this.adapterRef.instance.safeEmit("mediaCapabilityChange"),this.adapterRef._mediasoup&&this.adapterRef.mediaCapability.room.videoCodecType&&this.adapterRef.localStream){const e=this.adapterRef.mediaCapability.getCodecSend("video",this.adapterRef._mediasoup._sendTransport.handler._sendingRtpParametersByKind.video),t=this.adapterRef.mediaCapability.getCodecSend("screen",this.adapterRef._mediasoup._sendTransport.handler._sendingRtpParametersByKind.video),r=this.adapterRef._mediasoup._webcamProducerCodec&&this.adapterRef._mediasoup._webcamProducerCodec!==e.codecName;r&&this.logger.warn("将视频的Codec切走：",this.adapterRef._mediasoup._webcamProducerCodec,"=>",e.codecName);const n=this.adapterRef._mediasoup._screenProducerCodec&&this.adapterRef._mediasoup._screenProducerCodec!==e.codecName;n&&this.logger.error("将辅流的Codec切走：",this.adapterRef._mediasoup._screenProducerCodec,"=>",t.codecName),r||n?this._protoo&&this._protoo._transport&&this._protoo._transport._ws&&this._protoo._transport._ws.close():this.logger.log("Codec保持不动。video:",this.adapterRef._mediasoup._webcamProducerCodec,", screen:",this.adapterRef._mediasoup._screenProducerCodec)}}else if("Ability"===t)this._handleAbility(e.data.externData.data);else if("ChangeRight"===t){if(1===r.audioRight?window.isAudioBanned=!0:2===r.audioRight&&(window.isAudioBanned=!1),1===r.videoRight?window.isVideoBanned=!0:2===r.videoRight&&(window.isVideoBanned=!1),window.isAudioBanned&&window.isVideoBanned&&this.adapterRef.instance.apiEventReport("setFunction",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!0,isVideoBanned:!0}),!window.isAudioBanned&&window.isVideoBanned&&this.adapterRef.instance.apiEventReport("setFunction",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!1,isVideoBanned:!0}),window.isAudioBanned&&!window.isVideoBanned&&this.adapterRef.instance.apiEventReport("setFunction",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!0,isVideoBanned:!1}),window.isAudioBanned||window.isVideoBanned||this.adapterRef.instance.apiEventReport("setFunction",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!1,isVideoBanned:!1}),window.isAudioBanned){if(!this.adapterRef.localStream)return;let e=this.adapterRef.localStream.audio,t=this.adapterRef.localStream.screenAudio;e&&this.adapterRef.localStream.close({type:"audio"}),t&&this.adapterRef.localStream.close({type:"screenAudio"}),this.adapterRef.localStream.stopAllEffects();let r=this.adapterRef.localStream.mediaHelper.audio;r.webAudio&&r.webAudio.context&&r.webAudio.mixAudioConf&&r.webAudio.mixAudioConf.audioSource&&this.adapterRef.localStream.stopAudioMixing()}if(!this.adapterRef.localStream)return;if(window.isVideoBanned){let e=this.adapterRef.localStream.video,t=this.adapterRef.localStream.screen;e&&this.adapterRef.localStream.close({type:"video"}),t&&this.adapterRef.localStream.close({type:"screen"})}}else this.logger.error(`收到OnUserData通知消息 type = ${t}, data: `,r)}}}_handleFailed(){this.logger.log("Signalling:_handleFailed")}_handleClose(){}_handleDisconnected(e){var t,r,n,i;this.logger.log("Signalling:_handleDisconnected"),!this._reconnectionTimer||"connectioning"!==this.adapterRef.channelStatus&&"join"!==this.adapterRef.channelStatus?(this.logger.warn(`信令通道#${e.id}_${null===(i=e._transport)||void 0===i?void 0:i.wsid} 收到关闭信号，即将开始重连过程。`),this.adapterRef.channelStatus="connectioning",this._reconnection()):e.closed?this.logger.warn(`信令通道#${e.id}_${null===(t=e._transport)||void 0===t?void 0:t.wsid} 在建立过程中被关闭。当前正在重连中，等待下次重连过程。`):this.logger.warn(`信令通道#${e.id}_${null===(r=e._transport)||void 0===r?void 0:r.wsid} 在建立过程中被关闭。信令通道会自动重试。连接地址：${null===(n=e._transport)||void 0===n?void 0:n._url}`),this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"2"})}async join(){let e;e=!!this.adapterRef.encryption.encryptionSecret&&"none"!==this.adapterRef.encryption.encryptionMode;const t={method:"Join",requestId:""+Math.ceil(1e9*Math.random()),externData:{userName:""+this.adapterRef.channelInfo.uid,token:this.adapterRef.channelInfo.token,cname:""+this.adapterRef.channelInfo.channelName,subType:"select",role:"part",version:"2.0",sessionMode:"meeting",engineVersion:c.ENGINE_VERSION,userRole:this.adapterRef.instance._roleInfo.userRole,userType:3,platformType:16,rtmp:{support:this.adapterRef.channelInfo.sessionConfig.liveEnable},record:{host:this.adapterRef.channelInfo.sessionConfig.isHostSpeaker,supportVideo:this.adapterRef.channelInfo.sessionConfig.recordVideo,supportAuido:this.adapterRef.channelInfo.sessionConfig.recordAudio,recordType:this.adapterRef.channelInfo.sessionConfig.recordType-0},mediaCapabilitySet:this.adapterRef.mediaCapability.stringify(),browser:{name:a.RtcSystem.browser.ua,version:""+a.RtcSystem.browser.version},gmEnable:e,gmMode:l.encryptionModeToInt(this.adapterRef.encryption.encryptionMode),gmKey:this.adapterRef.encryption.encryptionSecret,customEncryption:!g.getParameters().forceCustomEncryptionOff&&this.adapterRef.encryption.encodedInsertableStreams,userPriority:this.adapterRef.userPriority}};if(this.logger.log("Signalling: 向edge的WebSocket连接已打开，开始放送Join请求 -> ",JSON.stringify(t,null,"")),!this._protoo)throw new f.default({code:h.default.NOT_FOUND,message:"No this._protoo 3"});this._protoo.clear();try{let r,n=this._protoo;try{r=await this._protoo.request("Join",{requestId:t.requestId,externData:t.externData})}catch(e){if(n!==this._protoo)return void this.logger.warn(`过期的信令通道消息：【${e.name}】`,e.message);throw e}if(this.logger.log("Signalling:加入房间 ack ->  ",JSON.stringify(r,((e,t)=>"edgeRtpCapabilities"===e?null:t))),200!=r.code){let e="Unknown Error";return r.externData?e=r.externData.errMsg:r.errMsg&&(e=r.errMsg),this.logger.error("Signalling: 加入房间失败, reason = ",r.code,e),this.adapterRef.instance.emit("pairing-websocket-reconnection-error"),void this._joinFailed(r.code,e)}if(1===r.externData.audioRight?window.isAudioBanned=!0:window.isAudioBanned=!1,1===r.externData.videoRight?window.isVideoBanned=!0:window.isVideoBanned=!1,window.isAudioBanned&&window.isVideoBanned&&this.adapterRef.instance.apiEventReport("setFunction",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!0,isVideoBanned:!0}),!window.isAudioBanned&&window.isVideoBanned&&this.adapterRef.instance.apiEventReport("setFunction",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!1,isVideoBanned:!0}),window.isAudioBanned&&!window.isVideoBanned&&this.adapterRef.instance.apiEventReport("setFunction",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!0,isVideoBanned:!1}),window.isAudioBanned||window.isVideoBanned||this.adapterRef.instance.apiEventReport("setFunction",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!1,isVideoBanned:!1}),this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null),this.reconnectionControl.next=null,this.logger.log("Signalling:加入房间成功"),this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="CONNECTED","connectioning"===this.adapterRef.channelStatus){if(this.adapterRef.connectState.reconnect=!0,this.logger.log("重连成功，清除之前的媒体的通道"),this.adapterRef.channelStatus="join",this.adapterRef.instance.apiEventReport("setRelogin",{a_record:this.adapterRef.channelInfo.sessionConfig.recordAudio,v_record:this.adapterRef.channelInfo.sessionConfig.recordVideo,record_type:this.adapterRef.channelInfo.sessionConfig.recordType,host_speaker:this.adapterRef.channelInfo.sessionConfig.isHostSpeaker,result:0,reason:1,server_ip:this.adapterRef.channelInfo._protooUrl}),this.adapterRef.instance.resetChannel(),!this.adapterRef._mediasoup)throw new f.default({code:h.default.NO_MEDIASERVER,message:"media server error 25"});this.adapterRef._mediasoup._edgeRtpCapabilities=r.edgeRtpCapabilities,this.adapterRef.mediaCapability.parseRoom(r.externData.roomCapability),this.adapterRef.instance.emit("mediaCapabilityChange"),await this.adapterRef._mediasoup.init(),this.adapterRef.localStream?this.adapterRef.localStream.audio||this.adapterRef.localStream.video||this.adapterRef.localStream.screen||this.adapterRef.localStream.screenAudio||g.getParameters().allowEmptyMedia?(this.logger.log(`重连成功，重新publish本端流:audio ${this.adapterRef.localStream.hasAudio()}, video ${this.adapterRef.localStream.hasVideo()}, screen ${this.adapterRef.localStream.hasScreen()}`),this.adapterRef.instance.doPublish(this.adapterRef.localStream)):this.logger.log("重连成功，当前没有媒体流，无需发布"):this.logger.log("重连成功，当前在未发布状态，无需发布")}else{this.adapterRef.connectState.reconnect=!1;const e=this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2,t=Date.now();if(this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.joinedSuccessedTime=t,this.adapterRef.instance.apiEventReport("setLogin",{a_record:this.adapterRef.channelInfo.sessionConfig.recordAudio,v_record:this.adapterRef.channelInfo.sessionConfig.recordVideo,record_type:this.adapterRef.channelInfo.sessionConfig.recordType,host_speaker:this.adapterRef.channelInfo.sessionConfig.isHostSpeaker,result:0,server_ip:this.adapterRef.channelInfo._protooUrl,signal_time_elapsed:e.startWssTime-e.startJoinTime,time_elapsed:t-e.startJoinTime,model:this.browserDevice}),!this.adapterRef._mediasoup)throw new f.default({code:h.default.NO_MEDIASERVER,message:"media server error 26"});this.adapterRef._mediasoup._edgeRtpCapabilities=r.edgeRtpCapabilities,this.adapterRef.mediaCapability.parseRoom(r.externData.roomCapability),this.adapterRef.instance.emit("mediaCapabilityChange"),await this.adapterRef._mediasoup.init()}if(this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef._enableRts&&(await this.createRTSTransport(),this.adapterRef.instance.emit("connected")),this.logger.log("加入房间成功, 查看房间其他人的发布信息: ",JSON.stringify(r.externData.userList)),void 0!==r.externData&&r.externData.userList&&r.externData.userList.length){let e=this;for(const t of r.externData.userList){let r=t.uid;"string"===this.adapterRef.channelInfo.uidType&&(r=new s.default(r),r=r.toString());let n=this.adapterRef.remoteStreamMap[r];if(n?(n.active=!0,this.adapterRef.memberMap[r]=""+r,this.adapterRef.instance.safeEmit("peer-online",{uid:r})):(n=new o.RemoteStream({uid:r,audio:!1,video:!1,screen:!1,client:this.adapterRef.instance,platformType:t.platformType}),this.adapterRef.remoteStreamMap[r]=n,this.adapterRef.memberMap[r]=""+r,this.adapterRef.instance.safeEmit("peer-online",{uid:r})),t.producerInfoList)for(const i of t.producerInfoList){const{mediaType:t,producerId:o,mute:a,simulcastEnable:s}=i;let c;switch(t){case"video":c="video";break;case"screenShare":c="screen";break;case"audio":c="audio";break;default:this.logger.warn(`join: 不支持的媒体类型 ${t} ${r}`);continue}n[c]=!0,n.pubStatus[c][c]=!0,n.pubStatus[c].producerId=o,n.pubStatus[c].mute=a,n.muteStatus[c].send=a,n.pubStatus[c].simulcastEnable=s,setTimeout((()=>{e.logger.log("通知房间成员发布信息: ",JSON.stringify(n.pubStatus)),e.adapterRef._enableRts&&e.adapterRef._rtsTransport?e.adapterRef.instance.emit("rts-stream-added",{stream:n,kind:c}):(n.pubStatus.audio.audio||n.pubStatus.video.video||n.pubStatus.screen.screen)&&e.adapterRef.instance.safeEmit("stream-added",{stream:n,mediaType:c}),a&&e.adapterRef.instance.safeEmit("mute-"+c,{uid:n.getId()})}),0)}}for(let e in this.adapterRef.remoteStreamMap)this.adapterRef.remoteStreamMap[e].active||(this.logger.warn("重连期间远端流停止发布："+e),delete this.adapterRef.remoteStreamMap[e])}this._resolve?(this.logger.log("加入房间成功, 反馈通知"),this._resolve(r),this._resolve=null,this._reject=null):(this.adapterRef.instance.emit("pairing-websocket-reconnection-success"),this.reconnectionControl.resumers.length&&(this.reconnectionControl.resumers.forEach((e=>e({reason:"reconnection-success"}))),this.reconnectionControl.resumers=[])),this.doSendKeepAliveTask()}catch(e){this.logger.error("join() 登录失败, "+e.name+": "+e.message),this._joinFailed(-1,"LOGIN_ERROR")}}_joinFailed(e,t){this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.channelStatus="init",this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),4009===e&&this.adapterRef.instance.safeEmit("crypt-error",{cryptType:this.adapterRef.encryption.encryptionMode});const r=Date.now(),n=this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2;this.adapterRef.instance.apiEventReport("setLogin",{a_record:this.adapterRef.channelInfo.sessionConfig.recordAudio,v_record:this.adapterRef.channelInfo.sessionConfig.recordVideo,record_type:this.adapterRef.channelInfo.sessionConfig.recordType,host_speaker:this.adapterRef.channelInfo.sessionConfig.isHostSpeaker,result:e,server_ip:this.adapterRef.channelInfo._protooUrl,signal_time_elapsed:n.startWssTime-n.startJoinTime,time_elapsed:r-n.startJoinTime,model:this.browserDevice}),this._reject?(this.logger.error("加入房间失败, 反馈通知"),this._reject(t),this._resolve=null,this._reject=null,this.keepAliveTimer&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=null),this.adapterRef.channelStatus="leave",this.adapterRef.instance.stopSession()):("room not found"===t?this.logger.error("网络重连时，加入房间失败，主动离开。重连失败原因：",t,"，这通常是因为房间内其他人都已离开，房间关闭引起的"):this.logger.error("网络重连时，加入房间失败，主动离开。重连失败原因：",t),this.logger.error("网络重连时，加入房间失败，主动离开。重连失败原因：",t),this.adapterRef.instance.emit("error","RELOGIN_ERROR"),this.adapterRef.instance.leave())}doSendKeepAliveTask(){this.keepAliveTimer&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=null),this.keepAliveTimer=setInterval((()=>{this.doSendKeepAlive()}),6e3)}async doSendKeepAlive(){var e,t;if(!(null===(e=this._protoo)||void 0===e?void 0:e.connected))return;const r=`#${this._protoo.id}_${null===(t=this._protoo._transport)||void 0===t?void 0:t.wsid}`;try{await this._protoo.request("Heartbeat")}catch(e){this.logger.error("信令包保活失败",r,e.name,e.message),this.keepAliveTimer&&(this._handleDisconnected(this._protoo),clearInterval(this.keepAliveTimer),this.keepAliveTimer=null)}}async createRTSTransport(){if(this.logger.log("createRTSTransport()"),!this._protoo)throw new f.default({code:h.default.NOT_FOUND,message:"createRTSTransport: _protoo is null"});if(!this._url)throw new f.default({code:h.default.NOT_FOUND,message:"createRTSTransport: _url is null"});try{const e=await this._protoo.request("CreateWsTrasnport");this.logger.warn("CreateWsTrasnport response: ",JSON.stringify(e,null,""));const{code:t,errMsg:r,transportId:n,wsPort:i="6666"}=e;200==t?(this.adapterRef._rtsTransport&&(this.logger.log("CreateWsTrasnport: 需要更新"),this.adapterRef._rtsTransport.destroy()),this.logger.log("CreateWsTrasnport: 开始创建"),this.adapterRef._rtsTransport=new d.RTSTransport({url:this._url.replace(/:\d+/,":"+i)+"&transportId="+n,transportId:n,port:i,adapterRef:this.adapterRef})):this.logger.error(`createWsTrasnport failed, code: ${t}, reason: ${r}`)}catch(e){throw this.logger.error("createRTSTransport failed:",e.name,e.message),e}}async rtsRequestKeyFrame(e){if(this.logger.log("rtsRequestKeyFrame(): ",e),!this._protoo)throw new f.default({code:h.default.NOT_FOUND,message:"rtsRequestKeyFrame: no _proto"});if(!e)throw new f.default({code:h.default.NOT_FOUND,message:"rtsRequestKeyFrame: no consumerId"});try{const t=await this._protoo.request("RequestKeyFrame",{consumerId:e});this.logger.warn("rtsRequestKeyFrame response: ",t);let{code:r,errMsg:n}=t;200==r?this.logger.log("RTS 关键帧请求完成"):this.logger.error(`RTS 关键帧请求失败, code: ${r}, reason: ${n}`)}catch(e){throw this.logger.error("rtsRequestKeyFrame failed:",e),e}}updateMaskStatus(){var e,t,r;let n=Date.now();for(let r=this.autoMask.data.length-1;r>=0;r--){let i=this.autoMask.data[r];if(n>=i.targetEndMs){if(this.adapterRef.channelInfo.uid===i.maskUid&&this.adapterRef.localStream)this.logger.log("updateMaskStatus 本地用户去除打码",i.maskUid),null===(e=this.adapterRef.localStream._play)||void 0===e||e.disableMask();else{const e=this.adapterRef.remoteStreamMap[i.maskUid];e&&(null===(t=e._play)||void 0===t?void 0:t.mask.enabled)&&(this.logger.log("updateMaskStatus 远端用户去除打码",i.maskUid),e._play.disableMask())}this.autoMask.data.splice(r,1)}}let i=Number.MAX_SAFE_INTEGER;for(let e=0;e<this.autoMask.data.length;e++){let t=this.autoMask.data[e];if(i=Math.min(i,t.targetEndMs),this.adapterRef.channelInfo.uid==t.maskUid&&this.adapterRef.localStream)this.logger.log("updateMaskStatus 本地用户增加打码",t.maskUid),null===(r=this.adapterRef.localStream._play)||void 0===r||r.enableMask();else{const e=this.adapterRef.remoteStreamMap[t.maskUid];e?e._play&&!e._play.mask.enabled&&(this.logger.log("updateMaskStatus 远端用户增加打码",t.maskUid,"打码时长",t.duration,"秒"),e._play.enableMask()):this.logger.log("updateMaskStatus 远端用户不在频道中",t.maskUid,"打码时长",t.duration,"秒")}}this.autoMask.timer&&clearTimeout(this.autoMask.timer),this.autoMask.timer=setTimeout((()=>{this.updateMaskStatus()}),i-n)}async doSendLogout(){if(this.logger.log("doSendLogout begin"),this.keepAliveTimer&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=null),!this._protoo||!this._protoo.connected)return;let e={requestId:""+Math.ceil(1e9*Math.random()),externData:{reason:0}};this._protoo.notify("Leave",e),this.logger.log("doSendLogout success")}_handleStreamStatusNotify(e){}_handleNetStatusNotify(e){const t=e.netStatusList;let r=p.parseBase64(t).toString(),n=[],i=r.substr(2,2)+r.substr(0,2);i=parseInt(i,16),r=r.substr(4);for(let e=0;e<i;e++){let e=r.substr(0,16);e=o(e);const t=r.substr(16,2),i=r.substr(18,2);let s=0;if("00"!=r.substr(20,2)){const e=r.substr(22,2);s=parseInt(e,16),r.substr(24,s),s++}const c={uid:"string"===this.adapterRef.channelInfo.uidType?a(e):parseInt(e,16),downlinkNetworkQuality:parseInt(t,16),uplinkNetworkQuality:parseInt(i,16),receiveTs:Date.now()};n.push(c),r=r.substr(22+s)}function o(e){let t=[];for(var r=e.length;r>=1;r-=2)t.push(e[r-2],e[r-1]);return t.join("")}function a(e){const t=e.length;let r,n=new Array(t),i=new s.default(0);for(let i=0;i<t;i++)r=e.charCodeAt(i),48<=r&&r<58?r-=48:r=(223&r)-65+10,n[i]=r;for(let e=0;e<n.length;e++){const t=n[e];i=u(c(i,16),t)}return i.toString()}function c(e,t){if(0==e.toNumber())return e;const r=e.multipliedBy(t);return s.default("7e+500").times(t),e.multipliedBy("-a",16),r}function u(e,t){return t=e.plus(t),s.default(.7).plus(e).plus(t),e.plus("0.1",8),t}let l=!0,d=[];n=n.filter((e=>0!=e.uid)),this.adapterRef.netStatusList.map((e=>{l=!0,n.map((t=>{e.uid!=t.uid&&0!=t.uid||(l=!1)})),l&&d.push(e)}));let f=d.concat(n);f=f.filter((e=>this.adapterRef.memberMap[e.uid]||e.uid==this.adapterRef.channelInfo.uid)),this.adapterRef.netStatusList=f,this.adapterRef.instance.safeEmit("network-quality",this.adapterRef.netStatusList)}_handleMuteNotify(e){const t=e.producerId,r=e.mute;Object.values(this.adapterRef.remoteStreamMap).forEach((e=>{["audio","video","screen"].forEach((n=>{e.pubStatus[n].producerId===t&&(e.muteStatus[n].send=r,r?this.adapterRef.instance.safeEmit("mute-"+n,{uid:e.getId()}):this.adapterRef.instance.safeEmit("unmute-"+n,{uid:e.getId()}))}))}))}_handleUserRoleNotify(e){let t=e.uid;"string"===this.adapterRef.channelInfo.uidType&&(t=new s.default(t),t=t.toString());const r=e.data&&e.data.userRole;if(this.logger.warn(`用户${t}角色变为${r?"观众":"主播"}`),t&&1===r&&(this.adapterRef.instance.clearMember(t),this.adapterRef.instance.removeSsrc(t),this.adapterRef.instance._roleInfo.audienceList[t]=!0),t&&0===r){this.adapterRef.instance.safeEmit("peer-online",{uid:t});let r=this.adapterRef.remoteStreamMap[t];r||(r=new o.RemoteStream({uid:t,audio:!1,video:!1,screen:!1,client:this.adapterRef.instance,platformType:e.platformType}),this.adapterRef.remoteStreamMap[t]=r,this.adapterRef.memberMap[t]=t),this.adapterRef.instance._roleInfo.audienceList[t]=!1}}_handleAbility(e){this.adapterRef.instance.emit("warning",{code:e.code,msg:e.msg})}_handleKickedNotify(e,t=this.adapterRef.channelInfo.uid){"string"===this.adapterRef.channelInfo.uidType&&(t=(t=new s.default(t)).toString()),1==e?(this.logger.warn("房间被关闭"),this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=30207,this.adapterRef.instance.leave(),this.adapterRef.instance.safeEmit("channel-closed",{})):2==e&&(this.logger.warn(t+"被提出房间"),t.toString()==this.adapterRef.channelInfo.uid.toString()&&(this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=30206,this.adapterRef.instance.leave()),this.adapterRef.instance.safeEmit("client-banned",{uid:t}))}destroy(){this.logger.log("清除 Signalling"),this._destroyProtoo(),this._reset()}}t.Signalling=y},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteStream=void 0;const i=r(3),o=r(45),a=r(92),s=r(59),c=r(95),u=r(96),l=r(15),d=n(r(1)),p=n(r(0)),f=n(r(11));let h=0;class m extends i.EventEmitter{constructor(e){if(super(),this.audioLevelHelper=null,this.platformType=c.PlatformType.unknown,this.pubStatus={audio:{audio:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},video:{video:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},screen:{screen:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1}},this.subStatus={audio:!1,video:!1,screen:!1},this.muteStatus={audio:{send:!1,recv:!1},video:{send:!1,recv:!1},screen:{send:!1,recv:!1}},this.isRemote=!0,this.active=!0,this.spatialPosition={x:0,y:0},this.remoteStreamId=h++,this.streamID=e.uid,this.stringStreamID=this.streamID.toString(),this.platformType=e.platformType,this.logger=e.client.adapterRef.logger.getChild((()=>{let t="remote#"+this.stringStreamID;return c.PlatformTypeMap[this.platformType]&&(t+=" "+c.PlatformTypeMap[this.platformType]),t+=this.remoteStreamId,this.pubStatus.audio.consumerId?t+="M":this.pubStatus.audio.producerId&&(t+="m"),this.pubStatus.video.consumerId?t+="C":this.pubStatus.video.producerId&&(t+="c"),this.pubStatus.screen.consumerId?t+="S":this.pubStatus.screen.producerId&&(t+="s"),e.client.adapterRef.remoteStreamMap[this.streamID]!==this&&(t+=" DETACHED"),t})),"string"==typeof e.uid||f.default.isBigNumber(e.uid))this.logger.log("uid是string类型"),e.client.adapterRef.channelInfo.uidType="string";else{if("number"!=typeof e.uid)throw this.logger.error("uid参数格式非法"),new d.default({code:p.default.INVALID_PARAMETER,message:"uid is invalid"});if(this.logger.log("uid是number类型"),e.client.adapterRef.channelInfo.uidType="number",e.uid>Number.MAX_SAFE_INTEGER)throw new d.default({code:p.default.INVALID_PARAMETER,message:"uid is exceeds the scope of Number"})}this.videoView=null,this.screenView=null,this.renderMode={remote:{video:{},screen:{}}},this.consumerId=null,this.producerId=null,this.audioPlay_=!1,this.videoPlay_=!1,this.screenPlay_=!1,this.subConf={audio:!0,video:!0,screen:!0,highOrLow:{video:o.STREAM_TYPE.HIGH,screen:o.STREAM_TYPE.HIGH}},this.renderMode={remote:{video:{},screen:{}}},this._reset(),this.streamID=e.uid,this.stringStreamID=this.streamID.toString(),this.audio=e.audio,this.video=e.video||!1,this.screen=e.screen||!1,this.client=e.client,this.mediaHelper=new u.MediaHelper({stream:this}),this._play=new a.Play({stream:this}),this._record=new s.Record({logger:this.logger,client:this.client}),this.logger.log("创建远端Stream: ",JSON.stringify({streamID:this.stringStreamID,audio:e.audio,video:e.video})),this.client.apiFrequencyControl({name:"createRemoteStream",code:0,param:{streamID:this.stringStreamID,clientUid:this.client.adapterRef.channelInfo.uid||""}})}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this.logger.error(`Error on event ${e}: ${t.name} ${t.message}`,t.stack)}}_reset(){this.audio=!1,this.video=!1,this.screen=!1,this.videoView=null,this.screenView=null,this.renderMode={remote:{video:{},screen:{}}},this.consumerId=null,this.producerId=null,this.pubStatus={audio:{audio:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},video:{video:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},screen:{screen:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1}},this.subConf={audio:!0,video:!0,screen:!0,highOrLow:{video:o.STREAM_TYPE.HIGH,screen:o.STREAM_TYPE.HIGH}},this.subStatus={audio:!1,video:!1,screen:!1},this.muteStatus={audio:{send:!1,recv:!1},video:{send:!1,recv:!1},screen:{send:!1,recv:!1}},this.renderMode={remote:{video:{},screen:{}}},this.mediaHelper&&this.mediaHelper.destroy(),this._play&&this._play.destroy(),this._play=null,this._record&&this._record.destroy(),this._record=null}get Play(){return this._play}get Record(){return this._record}getId(){return"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID}async getStats(){let e=this.client.adapterRef&&this.client.adapterRef._mediasoup&&this.client.adapterRef._mediasoup._recvTransport&&this.client.adapterRef._mediasoup._recvTransport._handler._pc;if(this.logger.log("获取音视频连接数据, uid: "+this.stringStreamID),e){const t={accessDelay:"0",audioReceiveBytes:"0",audioReceivePackets:"0",audioReceivePacketsLost:"0",endToEndDelay:"0",videoReceiveBytes:"0",videoReceiveDecodeFrameRate:"0",videoReceiveFrameRate:"0",videoReceivePackets:"0",videoReceivePacketsLost:"0",videoReceiveResolutionHeight:"0",videoReceiveResolutionWidth:"0"};try{(await e.getStats()).forEach((e=>{"inbound-rtp"===e.type?"video"===e.mediaType?(t.videoReceiveBytes=e.bytesReceived.toString(),t.videoReceivePackets=e.packetsReceived.toString(),t.videoReceivePacketsLost=e.packetsLost.toString(),t.videoReceiveFrameRate=e.framesPerSecond.toString(),t.videoReceiveDecodeFrameRate=e.framesPerSecond.toString()):"audio"===e.mediaType&&(t.audioReceiveBytes=e.bytesReceived.toString(),t.audioReceivePackets=e.packetsReceived.toString(),t.audioReceivePacketsLost=e.packetsLost.toString()):"candidate-pair"===e.type?("number"==typeof e.currentRoundTripTime&&(t.accessDelay=(1e3*e.currentRoundTripTime).toString()),"number"==typeof e.totalRoundTripTime&&(t.endToEndDelay=Math.round(100*e.totalRoundTripTime).toString())):"track"===e.type&&void 0!==e.frameWidth&&(t.videoReceiveResolutionWidth=e.frameWidth.toString(),t.videoReceiveResolutionHeight=e.frameHeight.toString())}))}catch(e){this.logger.error("failed to get remoteStats",e.name,e.message)}return t}}setSubscribeConfig(e){if(this.logger.log("设置订阅规则：",JSON.stringify(e)),"number"==typeof e.highOrLow&&(this.subConf.highOrLow.video=e.highOrLow,this.subConf.highOrLow.screen=e.highOrLow),"boolean"==typeof e.audio&&(this.subConf.audio=e.audio),"boolean"==typeof e.video?this.subConf.video=e.video:"high"===e.video?(this.subConf.video=!0,this.subConf.highOrLow.video=o.STREAM_TYPE.HIGH):"low"===e.video&&(this.subConf.video=!0,this.subConf.highOrLow.video=o.STREAM_TYPE.LOW),"boolean"==typeof e.screen?this.subConf.screen=e.screen:"high"===e.screen?(this.subConf.screen=!0,this.subConf.highOrLow.screen=o.STREAM_TYPE.HIGH):"low"===e.screen&&(this.subConf.screen=!0,this.subConf.highOrLow.screen=o.STREAM_TYPE.LOW),this.pubStatus.audio.audio&&this.subConf.audio?(this.subConf.audio=!0,this.audio=!0):this.subConf.audio=!1,this.pubStatus.video.video&&this.subConf.video?(this.subConf.video=!0,this.video=!0):this.subConf.video=!1,this.pubStatus.screen.screen&&this.subConf.screen?(this.subConf.screen=!0,this.screen=!0):this.subConf.screen=!1,this.logger.log("订阅规则：",JSON.stringify(this.subConf)),this.client.apiFrequencyControl({name:"setSubscribeConfig",code:0,param:{streamID:this.stringStreamID,conf:Object.assign({},this.subConf)}}),this.pubStatus.screen.screen){const e={uid:"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID,subscribe:this.subConf.screen};this.client.apiFrequencyControl({name:"subscribeRemoteSubStreamVideo",code:0,param:JSON.stringify(e,null," ")})}}getAudioStream(){return this.client.apiFrequencyControl({name:"setExternalAudioRender",code:0,param:JSON.stringify({},null," ")}),this.mediaHelper.audio.audioStream}getAudioTrack(){return this.mediaHelper.audio.audioStream.getAudioTracks()[0]||null}getVideoTrack(){return this.mediaHelper.video.videoStream.getVideoTracks()[0]||null}async play(e,t={}){if(l.isExistOptions({tag:"Stream.playOptions.audio",value:t.audio}).result||(t.audio=!0),l.isExistOptions({tag:"Stream.playOptions.video",value:t.video}).result||(t.video=!0),l.isExistOptions({tag:"Stream.playOptions.screen",value:t.screen}).result||(t.screen=!0),this.logger.log(`uid ${this.stringStreamID} Stream.play::`,JSON.stringify(t)),t.audio&&this._play&&this.mediaHelper.audio.audioStream.getTracks().length)if(this.client.spatialManager)this.logger.log("启用了空间音频，跳过本地音频播放。");else{this.logger.log(`uid ${this.stringStreamID} 开始播放远端音频`);try{await this._play.playAudioStream(this.mediaHelper.audio.audioStream,t.muted),this.audioPlay_=!0}catch(e){this.audioPlay_=!1;let t={error:e,uid:this.stringStreamID};this.client.emit("notAllowedError",t),this.client.emit("NotAllowedError",t),this.safeEmit("notAllowedError",e)}}let r;if(r="string"==typeof e?document.getElementById(e):e||null,r){if(t.video&&(this.videoView=r,this._play&&this.mediaHelper.video.videoStream.getVideoTracks().length)){this.logger.log(`uid ${this.stringStreamID} 开始启动视频播放 主流 远端`);try{let e="remote";await this._play.playVideoStream(this.mediaHelper.video.renderStream,r,e),"width"in this.renderMode.remote.video&&this._play.setVideoRender(this.renderMode.remote.video),this.videoPlay_=!0}catch(e){this.videoPlay_=!1;let t={error:e,uid:this.stringStreamID};this.client.emit("notAllowedError",t),this.client.emit("NotAllowedError",t),this.safeEmit("notAllowedError",e)}}if(t.screen&&(this.screenView=r,this._play&&this.mediaHelper&&this.mediaHelper.screen.screenVideoStream.getVideoTracks().length)){this.logger.log(`uid ${this.stringStreamID} 开始启动视频播放 辅流 远端`);try{await this._play.playScreenStream(this.mediaHelper.screen.renderStream,r),"width"in this.renderMode.remote.screen&&this._play.setScreenRender(this.renderMode.remote.screen),this.screenPlay_=!1}catch(e){this.screenPlay_=!1;let t={error:e,uid:this.stringStreamID};this.client.emit("notAllowedError",t),this.client.emit("NotAllowedError",t),this.safeEmit("notAllowedError",e)}}}this.client.apiFrequencyControl({name:"play",code:0,param:JSON.stringify({streamID:this.stringStreamID,playOptions:t,isRemote:!0},null," ")})}async resume(){this._play&&(await this._play.resume(),this._play.audioDom&&!this._play.audioDom.paused&&(this.audioPlay_=!0),this._play.videoDom&&!this._play.videoDom.paused&&(this.videoPlay_=!0),this._play.screenDom&&!this._play.screenDom.paused&&(this.screenPlay_=!0)),this.client.apiFrequencyControl({name:"resume",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0},null," ")})}setRemoteRenderMode(e,t){e&&e.width-0&&e.height-0||(this.logger.warn("setRemoteRenderMode 参数错误"),this.client.apiFrequencyControl({name:"setRemoteRenderMode",code:-1,param:Object.assign({streamID:this.stringStreamID,mediaType:t},e)})),this.client&&this._play&&(this.logger.log(`uid ${this.stringStreamID} 设置远端视频播放窗口大小: `,t||"video+screen",JSON.stringify(e)),t&&"video"!==t||(this._play&&this._play.setVideoRender(e),this.renderMode.remote.video=e),t&&"screen"!==t||(this.renderMode.remote.screen=e,this._play&&this._play.setScreenRender(e)),this.client.apiFrequencyControl({name:"setRemoteRenderMode",code:0,param:Object.assign(Object.assign({},e),{mediaType:t,streamID:this.stringStreamID})}))}stop(e){this.logger.log(`uid ${this.stringStreamID} Stream.stop: 停止播放 ${e||"音视频流"}`),this._play&&("audio"===e?(this._play.stopPlayAudioStream(),this.audioPlay_=!1):"video"===e?(this._play.stopPlayVideoStream(),this.videoPlay_=!1):"screen"===e?(this._play.stopPlayScreenStream(),this.screenPlay_=!1):(this._play.audioDom&&(this._play.stopPlayAudioStream(),this.audioPlay_=!1),this._play.videoDom&&(this._play.stopPlayVideoStream(),this.videoPlay_=!1),this._play.screenDom&&(this._play.stopPlayScreenStream(),this.screenPlay_=!1)),this.client.apiFrequencyControl({name:"stop",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,audio:this.audio,video:this.video,screen:this.screen,type:e},null," ")}))}async isPlaying(e){let t=!1;if(this._play)if("audio"===e)t=await this._play.isPlayAudioStream();else if("video"===e)t=await this._play.isPlayVideoStream();else{if("screen"!==e)return this.logger.warn("isPlaying: unknown type"),Promise.reject(new d.default({code:p.default.UNKNOWN_TYPE,message:"unknown type"}));t=await this._play.isPlayScreenStream()}return this.client.apiFrequencyControl({name:"isPlaying",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,type:e},null," ")}),this.logger.log(`检查${this.stringStreamID}的${e}播放状态: ${t}`),t}async unmuteAudio(){this.logger.log("启用音频轨道: ",this.stringStreamID);try{if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});this.muteStatus.audio.recv=!0,this.mediaHelper.audio.audioStream.getAudioTracks().length&&(this.mediaHelper.audio.audioStream.getAudioTracks()[0].enabled=!0),this._play.playAudioStream(this.mediaHelper.audio.audioStream,!1),this.client.apiFrequencyControl({name:"unmuteAudio",code:0,param:JSON.stringify({streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("API调用失败：Stream:unmuteAudio",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteAudio",code:-1,param:JSON.stringify({streamID:this.stringStreamID,reason:e},null," ")})}}async muteAudio(){this.logger.log("禁用音频轨道: ",this.stringStreamID);try{if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});this.muteStatus.audio.recv=!0,this.mediaHelper.audio.audioStream.getAudioTracks().length&&(this.mediaHelper.audio.audioStream.getAudioTracks()[0].enabled=!1),this._play.stopPlayAudioStream(),this.client.apiFrequencyControl({name:"muteAudio",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0},null," ")})}catch(e){this.logger.error("API调用失败：Stream:muteAudio",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteAudio",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,reason:e.message},null," ")})}}hasAudio(){return this.mediaHelper.audio.audioStream.getAudioTracks().length>0}setAudioVolume(e=100){let t=null;if(Number.isInteger(e)?e<0?e=0:e>100?e=255:e*=2.55:(this.logger.log("volume 为 0 - 100 的整数"),t="INVALID_ARGUMENTS"),this.logger.log(`调节${this.stringStreamID}的音量大小: ${e}`),this.audio){if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});this._play.setPlayVolume(e)}else this.logger.log("没有音频流，请检查是否有发布过音频"),t="INVALID_OPERATION";if(t)return this.client.apiFrequencyControl({name:"setAudioVolume",code:-1,param:{streamID:this.stringStreamID,volume:e,isRemote:!0,reason:t}}),t;this.client.apiFrequencyControl({name:"setAudioVolume",code:0,param:{streamID:this.stringStreamID,volume:e,isRemote:!0}})}async setAudioOutput(e,t){if(this._play){try{await this._play.setAudioOutput(e)}catch(e){throw t&&setTimeout((()=>{t(e)}),0),this.logger.error("设置输出设备失败",e.name,e.message),e}t&&setTimeout(t,0)}this.client.apiFrequencyControl({name:"setAudioOutput",code:0,param:JSON.stringify({streamID:this.stringStreamID,deviceId:e,isRemote:!0},null," ")})}async unmuteVideo(){this.logger.log(`启用 ${this.stringStreamID} 的视频轨道`);try{if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});if(!this.videoView)throw new d.default({code:p.default.NO_MEDIAHELPER,message:"no this.view"});this.muteStatus.video.recv=!1,this.mediaHelper&&this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!0),this.client.apiFrequencyControl({name:"unmuteVideo",code:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("API调用失败：Stream:unmuteVideo",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteVideo",code:-1,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:e.message},null," ")})}}async muteVideo(){this.logger.log(`禁用 ${this.stringStreamID} 的视频轨道`);try{if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});this.muteStatus.video.recv=!0,this.mediaHelper&&this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!1),this.client.apiFrequencyControl({name:"muteVideo",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0},null," ")})}catch(e){this.logger.error("API调用失败：Stream:muteVideo",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteVideo",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,reason:e.message},null," ")})}}async unmuteScreen(){this.logger.log(`启用 ${this.stringStreamID} 的视频轨道`);try{if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});if(!this.screenView)throw new d.default({code:p.default.NO_MEDIAHELPER,message:"no this.screenView"});this.muteStatus.screen.recv=!1,this.mediaHelper&&this.mediaHelper.screen.screenVideoTrack&&(this.mediaHelper.screen.screenVideoTrack.enabled=!0),this.client.apiFrequencyControl({name:"unmuteScreen",code:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("API调用失败：Stream:unmuteScreen",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteScreen",code:-1,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:e.message},null," ")})}}async muteScreen(){this.logger.log(`禁用 ${this.stringStreamID} 的视频轨道`);try{if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});this.mediaHelper&&this.mediaHelper.screen.screenVideoTrack&&(this.mediaHelper.screen.screenVideoTrack.enabled=!1),this.muteStatus.screen.recv=!0,this.client.apiFrequencyControl({name:"muteScreen",code:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("API调用失败：Stream:muteScreen",e,...arguments),this.client.apiFrequencyControl({name:"muteScreen",code:-1,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:e.message},null," ")})}}hasVideo(){this.logger.log("获取视频 flag"),this.mediaHelper.video.videoStream.getVideoTracks().length}hasScreen(){this.mediaHelper.screen.screenVideoStream.getVideoTracks().length}async takeSnapshot(e){if(!this.video&&!this.screen)return this.logger.log("没有视频流，请检查是否有 订阅 过视频"),this.client.apiFrequencyControl({name:"takeSnapshot",code:-1,param:JSON.stringify(Object.assign(Object.assign({streamID:this.stringStreamID,isRemote:!1},e),{reason:"没有视频流，请检查是否有 订阅 过视频"}),null," ")}),"INVALID_OPERATION";if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});await this._play.takeSnapshot(e,this.streamID),this.client.apiFrequencyControl({name:"takeSnapshot",code:0,param:Object.assign(Object.assign({},e),{streamID:this.stringStreamID,isRemote:!0})})}takeSnapshotBase64(e){if(this.video||this.screen){if(!this._play)throw new d.default({code:p.default.NO_PLAY,message:"no play"});let t=this._play.takeSnapshotBase64(e);return this.client.apiFrequencyControl({name:"takeSnapshotBase64",code:0,param:Object.assign({streamID:this.stringStreamID,isRemote:!1},e)}),t}return this.logger.log("没有视频流，请检查是否有 发布 过视频"),this.client.apiFrequencyControl({name:"takeSnapshotBase64",code:-1,param:JSON.stringify(Object.assign(Object.assign({streamID:this.stringStreamID,isRemote:!1},e),{reason:"没有视频流，请检查是否有 发布 过视频"}),null," ")}),"INVALID_OPERATION"}async startMediaRecording(e){const t=[];if(!this.mediaHelper)throw new d.default({code:p.default.NO_MEDIAHELPER,message:"no media helper"});switch(e.type){case"screen":t.push(this.mediaHelper.screen.screenVideoStream),t.push(this.mediaHelper.audio.audioStream);break;case"camera":case"video":t.push(this.mediaHelper.video.videoStream),t.push(this.mediaHelper.audio.audioStream);break;case"audio":t.push(this.mediaHelper.audio.audioStream)}if(0!==t.length){if(!this._record||!this.streamID||!t)throw new d.default({code:p.default.INVALID_PARAMETER,message:"startMediaRecording: invalid parameter"});return this._record&&this._record.start({uid:"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID,type:e.type,reset:e.reset,stream:t})}this.logger.log("没有没发现要录制的媒体流")}stopMediaRecording(e){if(!this._record)throw new d.default({code:p.default.NO_RECORD,message:"no record"});return this._record.stop({})}playMediaRecording(e){if(!this._record)throw new d.default({code:p.default.NO_RECORD,message:"no record"});return this._record.play(e.view)}listMediaRecording(){let e=[];if(!this._record)throw new d.default({code:p.default.NO_RECORD,message:"no record"});const t=this._record.getRecordStatus();return"init"!==t.status&&e.push(t),e}cleanMediaRecording(e){if(!this._record)throw new d.default({code:p.default.NO_RECORD,message:"no record"});return this._record.clean()}downloadMediaRecording(e){if(!this._record)throw new d.default({code:p.default.NO_RECORD,message:"no record"});return this._record.download()}clearRemotePubStatus(){let e=["audio","video","screen"];for(let t of e)this[t]=!1,this.pubStatus[t][t]=!1,this.pubStatus[t].producerId="",this.pubStatus[t].consumerId="",this.pubStatus[t].consumerStatus="init",this.pubStatus[t].stopconsumerStatus="init"}setCanvasWatermarkConfigs(e){if(this._play){let t=null;if(e.mediaType&&"video"!==e.mediaType?"screen"===e.mediaType&&(t=this._play.watermark.screen.canvasControl):t=this._play.watermark.video.canvasControl,!t)return void this.logger.error("setCanvasWatermarkConfigs：播放器未初始化",e.mediaType);const r={TEXT:10,TIMESTAMP:1,IMAGE:4};if(e.textWatermarks&&e.textWatermarks.length>r.TEXT)throw this.logger.error(`目前的文字水印数量：${e.textWatermarks.length}。允许的数量：${r.TEXT}`),new d.default({code:p.default.INVALID_PARAMETER,message:"watermark exceeds limit"});if(e.imageWatermarks&&e.imageWatermarks.length>r.IMAGE)throw this.logger.error(`目前的图片水印数量：${e.imageWatermarks.length}。允许的数量：${r.IMAGE}`),new d.default({code:p.default.INVALID_PARAMETER,message:"watermark exceeds limit"});t.checkWatermarkParams(e),t.updateWatermarks(e),Object.assign({uid:this.stringStreamID},e),this.client.apiFrequencyControl({name:"setRemoteCanvasWatermarkConfigs",code:0,param:{isRemote:!1,streamID:this.stringStreamID,mediaType:e.mediaType}})}else this.logger.error("setCanvasWatermarkConfigs：播放器未初始化")}getMuteStatus(e){return"audio"===e?{send:this.muteStatus.audio.send,recv:this.muteStatus.audio.recv,muted:this.muteStatus.audio.send||this.muteStatus.audio.recv}:"video"===e?{send:this.muteStatus.video.send,recv:this.muteStatus.video.recv,muted:this.muteStatus.video.send||this.muteStatus.video.recv}:{send:this.muteStatus.screen.send,recv:this.muteStatus.screen.recv,muted:this.muteStatus.screen.send||this.muteStatus.screen.recv}}getAdapterRef(){return this.client.adapterRef.remoteStreamMap[this.streamID]===this?this.client.adapterRef:null}destroy(){this.client&&(this.client.apiFrequencyControl({name:"destroy",code:0,param:{streamID:this.stringStreamID,isRemote:!0}}),this.logger.log(`uid ${this.stringStreamID} 销毁 Stream 实例`),this.stop(),this._reset())}}t.RemoteStream=m},function(e,t,r){var n,i;void 0===(i="function"==typeof(n=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function n(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(r){return"debug"===r&&(r="log"),"undefined"!=typeof console&&("trace"===r&&t?i:void 0!==console[r]?n(console,r):void 0!==console.log?n(console,"log"):e)}function a(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function s(e,t,r){return function(){"undefined"!=typeof console&&(a.call(this,t,r),this[e].apply(this,arguments))}}function c(e,t,r){return o(e)||s.apply(this,arguments)}function u(e,t,n){var i,o=this,s="loglevel";function u(){var e;if("undefined"!=typeof window&&s){try{e=window.localStorage[s]}catch(e){}if(void 0===e)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(s)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?s+=":"+e:"symbol"==typeof e&&(s=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=n||c,o.getLevel=function(){return i},o.setLevel=function(t,n){if("string"==typeof t&&void 0!==o.levels[t.toUpperCase()]&&(t=o.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(i=t,!1!==n&&function(e){var t=(r[e]||"silent").toUpperCase();if("undefined"!=typeof window&&s){try{return void(window.localStorage[s]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(s)+"="+t+";"}catch(e){}}}(t),a.call(o,t,e),"undefined"==typeof console&&t<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){u()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var l=u();null==l&&(l=null==t?"WARN":t),o.setLevel(l,!1)}var l=new u,d={};l.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new u(e,l.getLevel(),l.methodFactory)),t};var p="undefined"!=typeof window?window.log:void 0;return l.noConflict=function(){return"undefined"!=typeof window&&window.log===l&&(window.log=p),l},l.getLoggers=function(){return d},l.default=l,l})?n.call(t,r,t,e):n)||(e.exports=i)},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createCanvasWatermarkControl=t.CanvasWatermarkControl=void 0;const i=r(3),o=n(r(93)),a=r(15),s=r(94);class c extends i.EventEmitter{constructor(e){super(),this.logger=e,this.settings={defaultStyle:{background:"rgba(128,128,128, 0.5)",overflow:"hidden","white-space":"break-spaces",position:"absolute",wordBreak:"break-all",color:"white",fontSize:"10pt"}},this.watermarks=[],this.div=null}checkWatermarkParams(e){e.textWatermarks&&e.textWatermarks.forEach((e=>{const t={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.fontSize",value:e.fontSize,min:1};a.isExistOptions(t).result&&a.checkValidInteger(t);const r={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.fontColor",value:e.fontColor,min:0};a.isExistOptions(r).result&&a.checkValidInteger(r);const n={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.wmWidth",value:e.wmWidth,min:0};a.isExistOptions(n).result&&a.checkValidInteger(n);const i={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.wmHeight",value:e.wmHeight,min:0};a.isExistOptions(i).result&&a.checkValidInteger(i);const o={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.offsetX",value:e.offsetX};a.isExistOptions(o).result&&a.checkValidInteger(o);const s={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.offsetY",value:e.offsetY};a.isExistOptions(s).result&&a.checkValidInteger(s)})),e.timestampWatermarks&&[e.timestampWatermarks].forEach((e=>{const t={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.fontSize",value:e.fontSize,min:1};a.isExistOptions(t).result&&a.checkValidInteger(t);const r={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.fontColor",value:e.fontColor,min:0};a.isExistOptions(r).result&&a.checkValidInteger(r);const n={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.wmWidth",value:e.wmWidth,min:0};a.isExistOptions(n).result&&a.checkValidInteger(n);const i={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.wmHeight",value:e.wmHeight,min:0};a.isExistOptions(i).result&&a.checkValidInteger(i);const o={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.offsetX",value:e.offsetX};a.isExistOptions(o).result&&a.checkValidInteger(o);const s={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.offsetY",value:e.offsetY};a.isExistOptions(s).result&&a.checkValidInteger(s)})),e.imageWatermarks&&e.imageWatermarks.forEach((e=>{const t={tag:"Stream.setCanvasWatermarkConfigs.imageWatermarks.wmWidth",value:e.wmWidth,min:0};a.isExistOptions(t).result&&a.checkValidInteger(t);const r={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.wmHeight",value:e.wmHeight,min:0};a.isExistOptions(r).result&&a.checkValidInteger(r);const n={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.offsetX",value:e.offsetX};a.isExistOptions(n).result&&a.checkValidInteger(n);const i={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.offsetY",value:e.offsetY};a.isExistOptions(i).result&&a.checkValidInteger(i);const o={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.imageUrls",value:e.imageUrls};a.checkExists(o);const s={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.imageUrls.length",value:e.imageUrls.length,min:1};a.checkValidInteger(s);const c={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.fps",value:e.fps,min:0};a.isExistOptions(c).result&&a.checkValidFloat(c)}))}updateWatermarks(e){this.clear(),this.watermarks=[],e.imageWatermarks&&e.imageWatermarks.forEach((e=>{const t=Object.assign({},this.settings.defaultStyle,{background:"none"});let r;"number"==typeof e.offsetX?t.left=e.offsetX+"px":e.offsetX&&"string"==typeof e.offsetX&&(t.left=e.offsetX),"number"==typeof e.offsetY?t.top=e.offsetY+"px":e.offsetY&&"string"==typeof e.offsetY&&(t.top=e.offsetY),0!==e.wmWidth&&0!==e.wmHeight||(delete e.wmWidth,delete e.wmHeight),e.wmWidth&&("number"==typeof e.wmWidth?t.width=e.wmWidth+"px":"string"==typeof e.wmWidth&&(t.width=e.wmWidth)),e.wmHeight&&("number"==typeof e.wmHeight?t.height=e.wmHeight+"px":"string"==typeof e.wmHeight&&(t.height=e.wmHeight)),"number"==typeof e.wmHeight?t.height=e.wmHeight+"px":e.wmHeight&&"string"==typeof e.wmHeight&&(t.height=e.wmHeight),r=e.fps?{type:"image",content:"",imageUrls:e.imageUrls,loop:!(!1===e.loop),loopIndex:0,interval:1e3/(e.fps||1),elem:null,style:t}:{type:"image",content:"",imageUrls:[e.imageUrls[e.imageUrls.length-1]],loop:!1,loopIndex:0,interval:0,elem:null,style:t},this.watermarks.push(r)})),e.textWatermarks&&e.textWatermarks.forEach((e=>{let t=e.content||"";const r=Object.assign({},this.settings.defaultStyle);"number"==typeof e.fontColor?r.color=s.numberToRGBA(e.fontColor):e.fontColor&&"string"==typeof e.fontColor&&(r.color=e.fontColor),"number"==typeof e.fontSize?r.fontSize=e.fontSize+"pt":e.fontSize&&"string"==typeof e.fontSize&&(r.fontSize=e.fontSize),"number"==typeof e.offsetX?r.left=e.offsetX+"px":e.offsetX&&"string"==typeof e.offsetX&&(r.left=e.offsetX),"number"==typeof e.offsetY?r.top=e.offsetY+"px":e.offsetY&&"string"==typeof e.offsetY&&(r.top=e.offsetY),!e.wmWidth&&!e.wmHeight||0===e.wmWidth||0===e.wmHeight?r.background="":"number"==typeof e.wmColor?r.background=s.numberToRGBA(e.wmColor):e.wmColor&&"string"==typeof e.wmColor&&(r.background=e.wmColor),e.wmWidth,"number"==typeof e.wmWidth?e.wmWidth>0&&(r.width=e.wmWidth+"px"):"string"==typeof e.wmWidth&&(r.width=e.wmWidth),e.wmHeight&&("number"==typeof e.wmHeight?(e.wmHeight>0&&(r.wmHeight=e.wmWidth+"px"),r.height=e.wmHeight+"px"):"string"==typeof e.wmHeight&&(r.height=e.wmHeight));const n={type:"text",content:t,loop:!1,elem:null,loopIndex:0,style:r};this.watermarks.push(n)})),e.timestampWatermarks&&[e.timestampWatermarks].forEach((e=>{const t=Object.assign({},this.settings.defaultStyle);"number"==typeof e.fontColor?t.color=s.numberToRGBA(e.fontColor):e.fontColor&&"string"==typeof e.fontColor&&(t.color=e.fontColor),"number"==typeof e.fontSize?t.fontSize=e.fontSize+"pt":e.fontSize&&"string"==typeof e.fontSize&&(t.fontSize=e.fontSize),"number"==typeof e.offsetX?t.left=e.offsetX+"px":e.offsetX&&"string"==typeof e.offsetX&&(t.left=e.offsetX),"number"==typeof e.offsetY?t.top=e.offsetY+"px":e.offsetY&&"string"==typeof e.offsetY&&(t.top=e.offsetY),!e.wmWidth&&!e.wmHeight||0===e.wmWidth||0===e.wmHeight?t.background="":"number"==typeof e.wmColor?t.background=s.numberToRGBA(e.wmColor):e.wmColor&&"string"==typeof e.wmColor&&(t.background=e.wmColor),e.wmWidth&&("number"==typeof e.wmWidth?t.width=e.wmWidth+"px":"string"==typeof e.wmWidth&&(t.width=e.wmWidth)),e.wmHeight&&("number"==typeof e.wmHeight?t.height=e.wmHeight+"px":"string"==typeof e.wmHeight&&(t.height=e.wmHeight));const r={type:"timestamp",content:"yyyy-mm-dd HH:MM:ss",loop:!1,loopIndex:0,elem:null,style:t};this.watermarks.push(r)})),this.div&&this.start(this.div)}start(e){this.clear(),this.div=e,this.watermarks.forEach((t=>{let r;switch(t.type){case"text":r=document.createElement("pre"),r.className="nim-watermark nim-watermark-text",r.innerText=t.content||"",Object.assign(r.style,t.style);break;case"timestamp":r=document.createElement("pre"),r.className="nim-watermark nim-watermark-timestamp",r.innerText="",Object.assign(r.style,t.style);break;case"image":!t.imageUrls&&t.content&&(t.imageUrls=[t.content]),r=document.createElement("div"),r.className="nim-watermark nim-watermark-image-container",t.imgElems=[],t.imageUrls&&t.imageUrls.length&&t.imageUrls.forEach(((e,n)=>{const i=document.createElement("img");i.className="nim-watermark nim-watermark-image nim-watermark-image-"+n,i.src=e,i.style.width="100%",t.style.height&&(i.style.height="100%"),i.style.overflow="hidden",t.imgElems&&t.imgElems.push(i),r.appendChild(i),n>0&&(i.style.display="none")})),t.loopIndex=-1;const e=()=>{if(!t.interval&&t.imgElems&&t.loopIndex>=0)t.imgElems[t.loopIndex].style.display="";else{if(t.imgElems&&t.imgElems[t.loopIndex]&&(t.imgElems[t.loopIndex].style.display="none"),t.loopIndex++,t.imgElems&&t.loopIndex>=t.imgElems.length){if(!t.loop)return void(t.loopTimer&&clearInterval(t.loopTimer));t.loopIndex=0}t.imgElems&&(t.imgElems[t.loopIndex].style.display="")}};e(),t.interval&&(t.loopTimer=setInterval(e,t.interval)),Object.assign(r.style,t.style)}t.elem=r,e.appendChild(t.elem)}))}clear(){this.div&&this.watermarks.forEach((e=>{e.elem&&(e.elem.remove(),e.elem=null),e.loopTimer&&clearTimeout(e.loopTimer)}))}}t.CanvasWatermarkControl=c;const u=new class{constructor(){this.controls=[],this.timer=setInterval((()=>{this.updateTimestamps()}),1e3)}updateTimestamps(){this.controls.forEach((e=>{e.watermarks.filter((e=>"timestamp"===e.type)).forEach((e=>{e.elem&&(e.elem.innerText=o.default(new Date,e.content||"yyyy-mm-dd HH:MM:ss"))}))}))}};t.createCanvasWatermarkControl=function(e){const t=new c(e);return u.controls.push(t),t}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createEncoderWatermarkControl=t.EncoderWatermarkControl=void 0;const i=r(3),o=n(r(93)),a=r(15),s=r(94),c=r(2);class u extends i.EventEmitter{constructor(e){super(),this.logger=e,this.settings={defaultStyle:{left:0,top:0,textWidth:0,textHeight:0,fontSize:"15pt",fontFamily:c.getParameters().encoderWatermarkFontFamily,fillStyle:"white",textBaseline:"hanging",bgWidth:-1,bgHeight:-1,bgFillStyle:"rgba(136, 136, 136, 0.5)"}},this.watermarks=[],this.handler={name:"watermark",enabled:!1,func:this.handleFrame.bind(this)}}handleFrame(e,t,r){this.watermarks.forEach((e=>{if("text"===e.type||"timestamp"===e.type){let t="";t="timestamp"===e.type?o.default(new Date,e.content||"yyyy-mm-dd HH:MM:ss"):e.content||"",r.canvasCtx.font=`${e.style.fontSize} ${e.style.fontFamily}`,r.canvasCtx.textBaseline=e.style.textBaseline,e.content,-1===e.style.bgWidth&&-1===e.style.bgHeight&&(e.style.bgWidth=e.style.textWidth,e.style.bgHeight=e.style.textHeight),e.style.bgWidth&&e.style.bgHeight&&(r.canvasCtx.fillStyle=e.style.bgFillStyle,r.canvasCtx.fillRect(e.style.left,e.style.top,e.style.bgWidth,e.style.bgHeight)),r.canvasCtx.fillStyle=e.style.fillStyle,r.canvasCtx.fillText(t,e.style.left,e.style.top)}if("image"===e.type&&e.imgElems){let t;if(e.interval){if(e.startMs&&e.interval){const r=Date.now()-e.startMs,n=Math.floor(r/e.interval);for(let r=n;r<n+e.imgElems.length;r++){const n=e.imgElems[e.loop?r%e.imgElems.length:r];if(n&&n.complete&&n.naturalWidth&&n.naturalHeight){t=n;break}}}}else e.imgElems[0].complete&&e.imgElems[0].naturalWidth&&e.imgElems[0].naturalHeight&&(t=e.imgElems[0]);if(t){let n,i;e.style.bgWidth>0&&e.style.bgHeight>0?(n=e.style.bgWidth,i=e.style.bgHeight):(n=t.naturalWidth,i=t.naturalHeight),r.canvasCtx.drawImage(t,e.style.left,e.style.top,n,i)}}}))}checkWatermarkParams(e){var t,r;const n={tag:"Stream.setEncoderWatermarkConfigs:watermarks.count",value:((null===(t=e.textWatermarks)||void 0===t?void 0:t.length)||0)+(e.timestampWatermarks?1:0)+((null===(r=e.imageWatermarks)||void 0===r?void 0:r.length)||0),max:c.getParameters().encoderWatermarkLimit};a.checkValidInteger(n),e.textWatermarks&&e.textWatermarks.forEach((e=>{const t={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.fontSize",value:e.fontSize,min:1,max:128};a.isExistOptions(t).result&&a.checkValidInteger(t);const r={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.fontColor",value:e.fontColor,min:0,max:4294967295};a.isExistOptions(r).result&&a.checkValidInteger(r);const n={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.wmWidth",value:e.wmWidth,min:0};a.isExistOptions(n).result&&a.checkValidInteger(n);const i={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.wmHeight",value:e.wmHeight,min:0};a.isExistOptions(i).result&&a.checkValidInteger(i);const o={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.offsetX",value:e.offsetX};a.isExistOptions(o).result&&a.checkValidInteger(o);const s={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.offsetY",value:e.offsetY};a.isExistOptions(s).result&&a.checkValidInteger(s)})),e.timestampWatermarks&&[e.timestampWatermarks].forEach((e=>{const t={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.fontSize",value:e.fontSize,min:1,max:128};a.isExistOptions(t).result&&a.checkValidInteger(t);const r={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.fontColor",value:e.fontColor,min:0,max:4294967295};a.isExistOptions(r).result&&a.checkValidInteger(r);const n={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.wmWidth",value:e.wmWidth,min:0};a.isExistOptions(n).result&&a.checkValidInteger(n);const i={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.wmHeight",value:e.wmHeight,min:0};a.isExistOptions(i).result&&a.checkValidInteger(i);const o={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.offsetX",value:e.offsetX};a.isExistOptions(o).result&&a.checkValidInteger(o);const s={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.offsetY",value:e.offsetY};a.isExistOptions(s).result&&a.checkValidInteger(s)})),e.imageWatermarks&&e.imageWatermarks.forEach((e=>{const t={tag:"Stream.setEncoderWatermarkConfigs.imageWatermarks.wmWidth",value:e.wmWidth,min:0};a.isExistOptions(t).result&&a.checkValidInteger(t);const r={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.wmHeight",value:e.wmHeight,min:0};a.isExistOptions(r).result&&a.checkValidInteger(r);const n={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.offsetX",value:e.offsetX};a.isExistOptions(n).result&&a.checkValidInteger(n);const i={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.offsetY",value:e.offsetY};a.isExistOptions(i).result&&a.checkValidInteger(i);const o={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.imageUrls",value:e.imageUrls};a.checkExists(o);const s={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.imageUrls.length",value:e.imageUrls.length,min:1,max:10};a.checkValidInteger(s);const c={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.fps",value:e.fps,min:0,max:30};a.isExistOptions(c).result&&a.checkValidFloat(c)}))}updateWatermarks(e){this.watermarks=[],e.imageWatermarks&&e.imageWatermarks.forEach((e=>{const t=Object.assign({},this.settings.defaultStyle,{background:"none"});let r;if("number"==typeof e.offsetX?t.left=e.offsetX:e.offsetX,"number"==typeof e.offsetY?t.top=e.offsetY:e.offsetY,0!==e.wmWidth&&0!==e.wmHeight||(delete e.wmWidth,delete e.wmHeight),e.wmWidth&&"number"==typeof e.wmWidth&&(t.bgWidth=e.wmWidth),e.wmHeight&&"number"==typeof e.wmHeight&&(t.bgHeight=e.wmHeight),!1!==e.loop&&(e.loop=!0),r=e.fps?{type:"image",content:"",imageUrls:e.imageUrls,loop:!(!1===e.loop),loopIndex:0,interval:1e3/(e.fps||1),style:t}:{type:"image",content:"",imageUrls:[e.imageUrls[e.imageUrls.length-1]],loop:!1,loopIndex:0,interval:0,style:t},r.startMs=Date.now(),r.imgElems=[],r.imageUrls)for(let e=0;e<r.imageUrls.length;e++){const t=new Image;t.src=r.imageUrls[e],r.imgElems.push(t)}this.watermarks.push(r)})),e.textWatermarks&&e.textWatermarks.forEach((e=>{let t=e.content||"";const r=Object.assign({},this.settings.defaultStyle);"number"==typeof e.fontColor?r.fillStyle=s.numberToRGBA(e.fontColor):e.fontColor&&"string"==typeof e.fontColor&&(r.fillStyle=e.fontColor),"number"==typeof e.fontSize?r.fontSize=e.fontSize+"pt":e.fontSize&&"string"==typeof e.fontSize&&(r.fontSize=e.fontSize);const n=s.measureText(e.content,r.fontSize,r.fontFamily);r.textWidth=n.width,r.textHeight=n.height,e.offsetX&&(r.left=e.offsetX),e.offsetY&&(r.top=e.offsetY),e.wmColor,e.wmWidth>=0&&(r.bgWidth=e.wmWidth),e.wmHeight>=0&&(r.bgHeight=e.wmHeight),"number"==typeof e.wmColor?r.bgFillStyle=s.numberToRGBA(e.wmColor):e.wmColor&&"string"==typeof e.wmColor&&(r.bgFillStyle=e.wmColor);const i={type:"text",content:t,loop:!1,loopIndex:0,style:r};this.watermarks.push(i)})),e.timestampWatermarks&&[e.timestampWatermarks].forEach((e=>{const t=Object.assign({},this.settings.defaultStyle);"number"==typeof e.fontColor?t.fillStyle=s.numberToRGBA(e.fontColor):e.fontColor&&"string"==typeof e.fontColor&&(t.fillStyle=e.fontColor),"number"==typeof e.fontSize?t.fontSize=e.fontSize+"pt":e.fontSize&&"string"==typeof e.fontSize&&(t.fontSize=e.fontSize);const r=s.measureText("yyyy-mm-dd HH:MM:ss",t.fontSize,t.fontFamily);t.textWidth=r.width,t.textHeight=r.height,e.offsetX&&(t.left=e.offsetX),e.offsetY&&(t.top=e.offsetY),e.wmWidth>=0&&(t.bgWidth=e.wmWidth),e.wmHeight>=0&&(t.bgHeight=e.wmHeight),"number"==typeof e.wmColor?t.bgFillStyle=s.numberToRGBA(e.wmColor):e.wmColor&&"string"===e.wmColor&&(t.bgFillStyle=e.wmColor);const n={type:"timestamp",content:"yyyy-mm-dd HH:MM:ss",loop:!1,loopIndex:0,style:t};this.watermarks.push(n)}))}start(e){e.enablePreProcessing()}}t.EncoderWatermarkControl=u,t.createEncoderWatermarkControl=function(e){return new u(e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.logHelper=void 0,t.logHelper=class{constructor(e){if(e.maxLogsLines&&"number"==typeof e.maxLogsLines&&!isNaN(e.maxLogsLines)?this.maxLogsLines=e.maxLogsLines:this.maxLogsLines=5e3,e.logFilename&&(e.logFilename=e.logFilename+".txt"),this.useTimestamps=e.useTimestamps||!1,this.useLocalStorage=e.useLocalStorage||!1,this.autoTrim=!0,this.maxLines=e.maxLogsLines||5e3,this.tailNumLines=100,this.logFilename=e.logFilename||"nimWebRtcLog.txt",this.maxDepth=5,this.depth=0,this.parentSizes=[0],this.currentResult="",this.startTime=new Date,this.output="",this.useLocalStorage){var t=window.localStorage.getItem("nimWebRtcLog");if(t){var r=JSON.parse(t);this.output=r.log;var n=new Date(r.startTime),i=new Date(r.lastLog);this.output+="\n---- Session end: "+r.lastLog+" ----\n",this.output+=this.formatSessionDuration(n.getTime(),i.getTime()),this.output+="\n\n"}}this.output+="---- Session started: "+this.startTime+" ----\n\n"}getLog(){var e=new Date;if(this.useLocalStorage){var t=window.localStorage.getItem("nimWebRtcLog");if(t){var r=JSON.parse(t);this.startTime=new Date(r.startTime),this.output=r.log,e=new Date(r.lastLog)}}return this.output+"\n---- Log retrieved: "+e+" ----\n"+this.formatSessionDuration(this.startTime.getTime(),e.getTime())}tail(e){return e=e||this.tailNumLines,this.trimLog(this.getLog(),e)}search(e){for(var t=this.output.split("\n"),r=new RegExp(e),n=[],i=0;i<t.length;i++){var o="["+i+"] ";t[i].match(r)&&n.push(o+t[i])}var a=n.join("\n");return 0==a.length&&(a='Nothing found for "'+e+'".'),a}getSlice(e,t){return this.output.split("\n").slice(e,e+t).join("\n")}downloadLog(){var e=this.getLog(),t=new Blob([e],{type:"data:text/plain;charset=utf-8"}),r=document.createElement("a");r.href=window.URL.createObjectURL(t),r.target="_blank",r.download=this.logFilename,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(r.href)}clear(){var e=new Date;if(this.output="---- Log cleared: "+e+" ----\n",this.useLocalStorage){var t={startTime:this.startTime,log:this.output,lastLog:e},r=JSON.stringify(t);window.localStorage.setItem("nimWebRtcLog",r)}}log(e){var t=this.determineType(e);if(null!=t){var r=this.formatType(t,e);if(this.useTimestamps){var n=new Date;this.output+=this.formatTimestamp(n)}if(this.output+=r+"\n",this.autoTrim&&(this.output=this.trimLog(this.output,this.maxLines)),this.useLocalStorage){var i=new Date,o={startTime:this.startTime,log:this.output,lastLog:i},a=JSON.stringify(o);window.localStorage.setItem("nimWebRtcLog",a)}}this.depth=0,this.parentSizes=[0],this.currentResult=""}determineType(e){if(null!=e){var t=typeof e;return"object"==t?null==e.length?"function"==typeof e.getTime?"Date":"function"==typeof e.test?"RegExp":"Object":"Array":t}return"null"}formatType(e,t){if(this.maxDepth&&this.depth>=this.maxDepth)return"... (max-depth reached)";switch(e){case"Object":this.currentResult+="{\n",this.depth++,this.parentSizes.push(this.objectSize(t));var r=0;for(var n in t){this.currentResult+=this.indentsForDepth(this.depth),this.currentResult+=n+": ";var i=this.determineType(t[n]);(o=this.formatType(i,t[n]))?("function"!==i&&(this.currentResult+=o),r!=this.parentSizes[this.depth]-1&&(this.currentResult+=","),this.currentResult+="\n"):(r!=this.parentSizes[this.depth]-1&&(this.currentResult+=","),this.currentResult+="\n"),r++}if(this.depth--,this.parentSizes.pop(),this.currentResult+=this.indentsForDepth(this.depth),this.currentResult+="}",0==this.depth)return this.currentResult;break;case"Array":for(this.currentResult+="[",this.depth++,this.parentSizes.push(t.length),r=0;r<t.length;r++){var o;"Object"!=(i=this.determineType(t[r]))&&"Array"!=i||(this.currentResult+="\n"+this.indentsForDepth(this.depth)),(o=this.formatType(i,t[r]))?(this.currentResult+=o,r!=this.parentSizes[this.depth]-1&&(this.currentResult+=", "),"Array"==i&&(this.currentResult+="\n")):(r!=this.parentSizes[this.depth]-1&&(this.currentResult+=", "),("Object"!=i||r==this.parentSizes[this.depth]-1)&&(this.currentResult+="\n"))}if(this.depth--,this.parentSizes.pop(),this.currentResult+="]",0==this.depth)return this.currentResult;break;case"function":var a=(t+="").split("\n");for(r=0;r<a.length;r++)a[r].match(/\}/)&&this.depth--,this.currentResult+=this.indentsForDepth(this.depth),a[r].match(/\{/)&&this.depth++,this.currentResult+=a[r]+"\n";return this.currentResult;case"RegExp":return"/"+t.source+"/";case"Date":case"string":return this.depth>0||0==t.length?'"'+t+'"':t;case"boolean":return t?"true":"false";case"number":return t+""}}indentsForDepth(e){for(var t="",r=0;r<e;r++)t+="\t";return t}trimLog(e,t){var r=e.split("\n");return r.length>t&&(r=r.slice(r.length-t)),r.join("\n")}lines(){return this.output.split("\n").length}formatSessionDuration(e,t){var r=t-e,n=Math.floor(r/1e3/60/60),i=("0"+n).slice(-2);r-=1e3*n*60*60;var o=Math.floor(r/1e3/60),a=("0"+o).slice(-2);r-=1e3*o*60;var s=Math.floor(r/1e3);return r-=1e3*s,"---- Session duration: "+i+":"+a+":"+("0"+s).slice(-2)+" ----"}formatTimestamp(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"]: "}objectSize(e){var t,r=0;for(t in e)e.hasOwnProperty&&e.hasOwnProperty(t)&&r++;return r}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.shimCanvas=t.canShimCanvas=void 0;const n=r(2),i=r(16);t.canShimCanvas=function(){let e=!1;if("never"===n.getParameters().shimCanvas)e=!1;else if("always"===n.getParameters().shimCanvas)e=!0;else if("ios151"===n.getParameters().shimCanvas)return!!(i.RtcSystem.ios()&&navigator.userAgent.indexOf(" OS 15_1")>-1);return e},t.shimCanvas=function(e){const t=document.createElement("canvas"),r=document.createElement("video");let n=e.getSettings().frameRate||15;const i=t.getContext("2d"),o=new MediaStream([e]);if(r.srcObject=o,r.setAttribute("playsinline","playsinline"),r.setAttribute("muted","muted"),r.setAttribute("autoplay","autoplay"),r.className="nertc-ios-shim",r.style.display="none",r.onresize=()=>{r.videoWidth&&r.videoHeight&&(t.width=r.videoWidth,t.height=r.videoHeight)},i){const o=t.captureStream(n).getVideoTracks()[0];Object.defineProperty(o,"enabled",{get:()=>e.enabled,set(t){console.warn("Delegate cameraTrack enabled",t),e.enabled=t}});const a=setInterval((()=>{r.paused?(console.log("play"),r.play()):"ended"===o.readyState?("live"===e.readyState&&(console.warn("canvasTrack已停止，回收videoTrack中"),e.stop()),clearInterval(a),document.body.removeChild(r)):i.drawImage(r,0,0)}),1e3/n);return document.body.appendChild(r),o}throw new Error("Ctx not supported")}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.preProcessingPureColor=t.preProcessingCopy=t.preProcessingSyncState=t.disablePreProcessing=t.canDisablePreProcessing=t.enablePreProcessing=void 0;const n=r(32),i=r(160);function o(e,t,r){r.videoTrack&&r.videoTrack.enabled!==r.canvasTrack.enabled&&(e.logger.log(`preProcessingCopy: 更改mute状态 ${t} ${r.canvasTrack.enabled} => ${r.videoTrack.enabled}`),r.canvasTrack.enabled=r.videoTrack.enabled)}function a(e,t,r){r.videoTrack&&r.videoTrack.enabled!==r.canvasTrack.enabled&&(e.logger.log(`preProcessingCopy: 更改mute状态 ${t} ${r.canvasTrack.enabled} => ${r.videoTrack.enabled}`),r.canvasTrack.enabled=r.videoTrack.enabled),r.canvasCtx.drawImage(r.videoElem,0,0)}t.enablePreProcessing=async function(e,t="video",r){var s;r||(r=e[t].captureConfig.high.frameRate);let c,u,l,d,p=e[t].preProcessing;if(!p){e.logger.log("enablePreProcessing:初始化 mediaType "+t);const r=document.createElement("video"),n=document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new Error("无法创建canvasCtx 2d");const c=n.captureStream();r.onresize=()=>{n.width=r.videoWidth,n.height=r.videoHeight,r.play()};const u=c.getVideoTracks()[0];p={canvasTrack:u,canvasCtx:i,videoTrack:null,videoElem:r,canvasElem:n,handlers:[{name:"syncState",enabled:!0,func:o},{name:"copy",enabled:!0,func:a},{name:"mirror",enabled:!1,func:()=>{}},null===(s=e.stream._play)||void 0===s?void 0:s.watermark[t].encoderControl.handler],history:[],timer:null},e[t].preProcessing=p}if("video"===t?(c=e.video.cameraTrack||e.video.videoSource,u=e.video.videoTrackLow,n.emptyStreamWith(e.video.videoStream,p.canvasTrack)):(c=e.screen.screenVideoTrack||e.screen.screenVideoSource,u=e.video.videoTrackLow,n.emptyStreamWith(e.screen.screenVideoStream,p.canvasTrack)),c?p.videoElem.srcObject=new MediaStream([c]):(e.logger.warn("enablePreProcessing：当前没有视频输入 "+t),p.videoElem.srcObject=new MediaStream([])),p.videoTrack=c,e.stream.isRemote||(l=e.stream.getSender(t,"high"),d=e.stream.getSender(t,"low")),l&&(l.replaceTrack(p.canvasTrack),e.logger.log(`enablePreProcessing ${t} 成功替换上行`)),d&&u){const r=await e.createTrackLow(t);r&&(d.replaceTrack(r),u.stop(),e.logger.log(`enablePreProcessing ${t} 成功替换上行小流`))}const f=async()=>{if(p)if(p.videoElem.videoWidth&&p.videoElem.videoHeight&&(p.videoElem.videoWidth===p.canvasElem.width&&p.videoElem.videoHeight===p.canvasElem.height||(e.logger.warn(`前处理宽高变化 ${t} ${p.canvasElem.width}x${p.canvasElem.height} => ${p.videoElem.videoWidth}x${p.videoElem.videoHeight}`),p.canvasElem.width=p.videoElem.videoWidth,p.canvasElem.height=p.videoElem.videoHeight)),p.handlers.length){const r=Date.now(),n=[];for(let i of p.handlers)if(i&&i.enabled){const o=r;await i.func(e,t,p);const a=Date.now()-o;n.push({name:i.name,spent:a})}const i=Date.now();let o=0;for(;o<p.history.length&&i-p.history[o].endTs>5e3;o++);p.history.splice(0,o),p.history.push({startTs:r,endTs:i,handlerTs:n})}else a(e,t,p)};p.timer&&clearInterval(p.timer);const h=Math.floor(1e3/r);try{f()}catch(t){e.logger.error("drawFrame",t.name,t.message,t.stack)}p.timer=i.getRTCTimer().setInterval(f,h),e[t].preProcessingEnabled=!0},t.canDisablePreProcessing=function(e,t){const r=e[t].preProcessing;return!(!r||!r.timer)&&0===r.handlers.filter((e=>e&&e.enabled&&"syncState"!==e.name&&"copy"!==e.name)).length},t.disablePreProcessing=async function(e,t="video",r=!1){e.logger.log("disablePreProcessing "+t);const o=e[t].preProcessing;if(!o)return void e.logger.warn(`disablePreProcessing ${t}:当前没有前处理配置`);let a,s,c,u;if(o.canvasCtx.clearRect(0,0,o.canvasElem.width,o.canvasElem.height),(null==o?void 0:o.timer)&&(i.getRTCTimer().clearInterval(o.timer),o.timer=null),"video"===t?(a=e.video.cameraTrack||e.video.videoSource,s=e.video.videoTrackLow,n.emptyStreamWith(e.video.videoStream,a)):(a=e.screen.screenVideoTrack||e.screen.screenVideoSource,s=e.screen.screenVideoTrackLow,n.emptyStreamWith(e.screen.screenVideoStream,a)),o.videoElem.srcObject&&(o.videoElem.srcObject=null),e.stream.isRemote||(c=e.stream.getSender(t,"high"),u=e.stream.getSender(t,"low")),c&&("live"===(null==a?void 0:a.readyState)?(c.replaceTrack(a),e.logger.log(`disablePreProcessing ${t} 成功替换上行为【${a.label}】`)):(c.replaceTrack(null),e.logger.warn("disablePreProcessing 删除上行"))),u&&s)if("live"===(null==a?void 0:a.readyState)){const r=await e.createTrackLow(t);r&&(u.replaceTrack(r),s.stop(),e.logger.log(`disablePreProcessing ${t} 成功替换上行小流`))}else u.replaceTrack(null),e.logger.warn("disablePreProcessing 删除上行小流");r||(e[t].preProcessingEnabled=!1)},t.preProcessingSyncState=o,t.preProcessingCopy=a,t.preProcessingPureColor=function(e,t,r){r.canvasCtx.fillStyle="green",r.canvasCtx.fillRect(0,0,r.canvasElem.width,r.canvasElem.height)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getRTCTimer=t.getWorkerBlobUrl=void 0;let n=null;function i(){if(!n){const e=new Blob(['setInterval(()=>{self.postMessage("RTCTimer")}, 8)'],{type:"text/js-worker"});n=URL.createObjectURL(e)}return n}t.getWorkerBlobUrl=i;class o{constructor(e={from:{native:!0,worker:!0,webAudio:!0},minInterval:8}){this.history=[],this.timers=[void 0],this.worker=null,this.options=e;const t=e=>{const t={source:e,ts:Date.now()},r=this.history[this.history.length-1];if(!(r&&t.ts-r.ts<this.options.minInterval)){this.history.push(t),this.history.length>1e3&&this.history.shift();for(let r=0;r<this.timers.length;r++){const n=this.timers[r];if(n&&!(n.cntMax<=n.cnt||t.ts-n.lastCalledAt<n.interval-1)){n.cnt++,n.lastCalledAt=t.ts;try{n.handler()}catch(e){console.error(e)}}}}};e.from.native&&(this.nativeTimer=setInterval((()=>{t("native")}),this.options.minInterval)),e.from.worker&&void 0!==typeof Worker&&(this.worker=new Worker(i()),this.worker.onmessage=()=>{t("worker")})}setInterval(e,t){const r={handler:e,id:this.timers.length,interval:t,lastCalledAt:Date.now(),cnt:0,cntMax:Number.MAX_SAFE_INTEGER};return this.timers.push(r),r.id}clearInterval(e){if(!e)return;const t=this.timers[e];t&&(t.id===e?delete this.timers[e]:console.error("timer错位",e,t))}}let a=null;t.getRTCTimer=function(){return a||(a=new o),a}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.pcCloneTrack=void 0,t.pcCloneTrack=function(e){const t=new RTCPeerConnection,r=new RTCPeerConnection;window.pcLocal=t,window.pcRemote=r,t.onicecandidate=e=>{e.candidate&&r.addIceCandidate(e.candidate)},t.onnegotiationneeded=async e=>{const n=await t.createOffer();await t.setLocalDescription(n),await r.setRemoteDescription(n);const i=await r.createAnswer();await r.setLocalDescription(i),await t.setRemoteDescription(i)};const n=t.addTransceiver("video",{direction:"recvonly"});return r.addTrack(e),e.addEventListener("neTrackEnded",(()=>{r.close(),n.receiver.track.stop()})),n.receiver.track}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTSTransport=void 0;const i=r(3),o=n(r(1)),a=n(r(0));class s extends i.EventEmitter{constructor(e){super(),this._reset(),this.adapterRef=e.adapterRef,this._url=e.url,this._port=e.port,this._transportId=e.transportId,this._ws=null,this.initSocket()}get transportId(){return this._transportId}_reset(){this._url="",this._port=0,this._ws=null}initSocket(){if(this.adapterRef.logger.log("RTSTransport建立连接, url: ",this._url),!this._url)throw new o.default({code:a.default.NOT_FOUND,message:"RTSTransport: No _url"});this._ws=new WebSocket(this._url,["protoo"]),this._ws.binaryType="arraybuffer";const e=this._ws;e.onopen=this._onOpen.bind(this),e.onmessage=this._onMessage.bind(this),e.onclose=this._onClose.bind(this),e.onerror=this._onError.bind(this)}_onOpen(e){this.adapterRef.logger.log("RTSTransport:_onOpen"),this.emit("open",e)}_onMessage(e){this.adapterRef.instance.emit("rts-stream-data",e)}_onClose(e){this.adapterRef.logger.log("RTSTransport:onClose <- ",e),this.emit("close",e)}_onError(e){this.adapterRef.logger.log("RTSTransport:onError <- ",e),this.emit("error",e)}send(e){this._ws&&this._ws.readyState===WebSocket.OPEN?this._ws.send(JSON.stringify(e)):this.adapterRef.logger.log("RTSTransport:send: 当前不能发送，等待ws连接成功之后发送")}_close(){this.adapterRef.logger.log("RTSTransport:close"),this._ws&&(this._ws.onclose=null,this._ws.onerror=null,this._ws.onopen=null,this._ws.onmessage=null,this._ws.close(),this._ws=null)}destroy(){this.adapterRef.logger.log("WSTransport:destroy"),this._close(),this._url=null}}t.RTSTransport=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parseBase64=void 0;const n=r(164);let i;t.parseBase64=function(e){var t=e.length,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(!i){i=[];for(var o=0;o<r.length;o++)i[r.charCodeAt(o)]=o}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,r){for(var i=[],o=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;i[o>>>2]|=s<<24-o%4*8,o++}return new n.WordArray(i,o)}(e,t,i)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.WordArray=t.Hex=void 0,t.Hex={stringify(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")}},t.WordArray=class{constructor(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length}toString(e){return(e||t.Hex).stringify(this)}concat(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this}clamp(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}}},function(e,t,r){var n=r(166),i=r(211);t.Peer=n,t.WebSocketTransport=i},function(e,t,r){var n=o(r(62)),i=o(r(63));function o(e){return e&&e.__esModule?e:{default:e}}var a=r(52),s=r(117),c=r(119),u=new a("Peer"),l=0;e.exports=class extends s{constructor(e){super(u),u.debug("constructor()"),this._closed=!1,this.id=l++,this._transport=e,this._connected=!1,this._data={createTs:Date.now()},this._sents=new Map,this._notificationId=0,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){u.debug("close()"),this._closed=!0,this._connected=!1,this._notificationId=0,this._transport.close(),this._transport=null;var e=!0,t=!1,r=void 0;try{for(var n,i=this._sents.values()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0)n.value.close()}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}this._sents.clear()}}clear(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._sents.values()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0)n.value.close()}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}this._sents.clear()}request(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return(0,i.default)(n.default.mark((function i(){var o;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=c.createRequest(e,r),"Heartbeat"!=e&&t._logger.debug("request() [method:%s, id:%s]",e,o.id),n.next=4,t._transport.send(o);case 4:return n.abrupt("return",new Promise((function(e,r){var n={id:o.id,method:o.method,startTs:Date.now(),resolve:function(r){t._sents.delete(o.id)&&(t._closed||(clearTimeout(n.timer),e(r)))},reject:function(e){t._sents.delete(o.id)&&(clearTimeout(n.timer),r(e))},timer:setTimeout((function(){t._sents.delete(o.id)&&r(new Error("request timeout"))}),6e3),close:function(){return console.error("主动关闭了 sent: ",n),clearTimeout(n.timer),console.log("向edge的 "+n.method+" 请求, id "+n.id+" 被取消：连接 #"+t.id+" 已被关闭。连接建立时间："+(t._data.openTs-t._data.createTs)+"ms, 请求时间："+(Date.now()-n.startTs)+"ms"),e({})}};t._sents.set(o.id,n)})));case 5:case"end":return n.stop()}}),i,t)})))()}notify(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return(0,i.default)(n.default.mark((function i(){var o;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=c.createNotification(e,r),t._logger.debug("notify() [method:%s]",e),n.next=4,t._transport.send(o);case 4:case"end":return n.stop()}}),i,t)})))()}_handleTransport(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){e._closed||(e._connected=!1,e.safeEmit("close"))}));this._transport.on("open",(function(){e._closed||(u.debug('emit "open"'),e._connected=!0,e._data.openTs=Date.now(),e.safeEmit("open"))})),this._transport.on("disconnected",(function(){e._closed||(u.debug('emit "disconnected"'),e._connected=!1,e.safeEmit("disconnected"))})),this._transport.on("failed",(function(t){e._closed||(u.debug('emit "failed" [currentAttempt:%s]',t),e._connected=!1,e.safeEmit("failed",t))})),this._transport.on("close",(function(){e._closed||(e._closed=!0,u.debug('emit "close"'),e._connected=!1,e.safeEmit("close"))})),this._transport.on("message",(function(t){t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t)}))}_handleRequest(e){var t=this;try{this.emit("request",e,(function(r){var n=c.createSuccessResponse(e,r);t._transport.send(n).catch((function(){}))}),(function(r,n){r instanceof Error?(r=500,n=String(r)):"number"==typeof r&&n instanceof Error&&(n=String(n));var i=c.createErrorResponse(e,r,n);t._transport.send(i).catch((function(){}))}))}catch(t){var r=c.createErrorResponse(e,500,String(t));this._transport.send(r).catch((function(){}))}}_handleResponse(e){var t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else u.error("received response does not match any sent request",e.id,e)}_handleNotification(e){if(this._handleNotification>e.id)u.warn("忽略重复的通知消息: ",JSON.stringify(e,null," "));else{this._notificationId=e.id;var t=c.createSuccessResponse(e,{});this._transport.send(t).catch((function(){})),this.safeEmit("notification",e)}}}},function(e,t,r){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(168),i)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){var r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=m;var l={},d={};d[o]=function(){return this};var p=Object.getPrototypeOf,f=p&&p(p(I([])));f&&f!==r&&n.call(f,o)&&(d=f);var h=b.prototype=v.prototype=Object.create(d);y.prototype=h.constructor=b,b.constructor=y,b[s]=y.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(h),e},u.awrap=function(e){return{__await:e}},S(_.prototype),_.prototype[a]=function(){return this},u.AsyncIterator=_,u.async=function(e,t,r,n){var i=new _(m(e,t,r,n));return u.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(h),h[s]="Generator",h[o]=function(){return this},h.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},u.values=I,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;w(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}}}function m(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),a=new x(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=M(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=g(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function g(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function v(){}function y(){}function b(){}function S(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(r,i){function o(){return new Promise((function(t,o){!function t(r,i,o,a){var s=g(e[r],e,i);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(u).then((function(e){c.value=e,o(c)}),a)}a(s.arg)}(r,i,t,o)}))}return t=t?t.then(o,o):o()}}function M(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=g(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function I(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,r){e.exports={default:r(170),__esModule:!0}},function(e,t,r){r(99),r(100),r(109),r(181),r(193),r(194),e.exports=r(9).Promise},function(e,t,r){var n=r(64),i=r(65);e.exports=function(e){return function(t,r){var o,a,s=String(i(t)),c=n(r),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},function(e,t,r){var n=r(104),i=r(49),o=r(51),a={};r(18)(a,r(6)("iterator"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n(a,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t,r){var n=r(19),i=r(14),o=r(68);e.exports=r(21)?Object.defineProperties:function(e,t){i(e);for(var r,a=o(t),s=a.length,c=0;s>c;)n.f(e,r=a[c++],t[r]);return e}},function(e,t,r){var n=r(38);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(28),i=r(106),o=r(176);e.exports=function(e){return function(t,r,a){var s,c=n(t),u=i(c.length),l=o(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}}},function(e,t,r){var n=r(64),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},function(e,t,r){var n=r(22),i=r(108),o=r(69)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,r){var n=r(179),i=r(180),o=r(37),a=r(28);e.exports=r(101)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n,i,o,a,s=r(35),c=r(5),u=r(46),l=r(110),d=r(36),p=r(20),f=r(47),h=r(182),m=r(183),g=r(111),v=r(112).set,y=r(188)(),b=r(72),S=r(113),_=r(189),M=r(114),T=c.TypeError,w=c.process,x=w&&w.versions,I=x&&x.v8||"",E=c.Promise,A="process"==l(w),C=function(){},k=i=b.f,O=!!function(){try{var e=E.resolve(1),t=(e.constructor={})[r(6)("species")]=function(e){e(C,C)};return(A||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t&&0!==I.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),N=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},R=function(e,t){if(!e._n){e._n=!0;var r=e._c;y((function(){for(var n=e._v,i=1==e._s,o=0,a=function(t){var r,o,a,s=i?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{s?(i||(2==e._h&&j(e),e._h=1),!0===s?r=n:(l&&l.enter(),r=s(n),l&&(l.exit(),a=!0)),r===t.promise?u(T("Promise-chain cycle")):(o=N(r))?o.call(r,c,u):c(r)):u(n)}catch(e){l&&!a&&l.exit(),u(e)}};r.length>o;)a(r[o++]);e._c=[],e._n=!1,t&&!e._h&&P(e)}))}},P=function(e){v.call(c,(function(){var t,r,n,i=e._v,o=D(e);if(o&&(t=S((function(){A?w.emit("unhandledRejection",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=A||D(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},j=function(e){v.call(c,(function(){var t;A?w.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},L=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),R(t,!0))},z=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw T("Promise can't be resolved itself");(t=N(e))?y((function(){var n={_w:r,_d:!1};try{t.call(e,u(z,n,1),u(L,n,1))}catch(e){L.call(n,e)}})):(r._v=e,r._s=1,R(r,!1))}catch(e){L.call({_w:r,_d:!1},e)}}};O||(E=function(e){h(this,E,"Promise","_h"),f(e),n.call(this);try{e(u(z,this,1),u(L,this,1))}catch(e){L.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(190)(E.prototype,{then:function(e,t){var r=k(g(this,E));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=A?w.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&R(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n;this.promise=e,this.resolve=u(z,e,1),this.reject=u(L,e,1)},b.f=k=function(e){return e===E||e===a?new o(e):i(e)}),d(d.G+d.W+d.F*!O,{Promise:E}),r(51)(E,"Promise"),r(191)("Promise"),a=r(9).Promise,d(d.S+d.F*!O,"Promise",{reject:function(e){var t=k(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!O),"Promise",{resolve:function(e){return M(s&&this===a?E:this,e)}}),d(d.S+d.F*!(O&&r(192)((function(e){E.all(e).catch(C)}))),"Promise",{all:function(e){var t=this,r=k(t),n=r.resolve,i=r.reject,o=S((function(){var r=[],o=0,a=1;m(e,!1,(function(e){var s=o++,c=!1;r.push(void 0),a++,t.resolve(e).then((function(e){c||(c=!0,r[s]=e,--a||n(r))}),i)})),--a||n(r)}));return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=k(t),n=r.reject,i=S((function(){m(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(46),i=r(184),o=r(185),a=r(14),s=r(106),c=r(186),u={},l={};(t=e.exports=function(e,t,r,d,p){var f,h,m,g,v=p?function(){return e}:c(e),y=n(r,d,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(f=s(e.length);f>b;b++)if((g=t?y(a(h=e[b])[0],h[1]):y(e[b]))===u||g===l)return g}else for(m=v.call(e);!(h=m.next()).done;)if((g=i(m,y,h.value,t))===u||g===l)return g}).BREAK=u,t.RETURN=l},function(e,t,r){var n=r(14);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},function(e,t,r){var n=r(37),i=r(6)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){var n=r(110),i=r(6)("iterator"),o=r(37);e.exports=r(9).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(5),i=r(112).set,o=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,c="process"==r(38)(a);e.exports=function(){var e,t,r,u=function(){var n,i;for(c&&(n=a.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){a.nextTick(u)};else if(!o||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var l=s.resolve(void 0);r=function(){l.then(u)}}else r=function(){i.call(n,u)};else{var d=!0,p=document.createTextNode("");new o(u).observe(p,{characterData:!0}),r=function(){p.data=d=!d}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){var n=r(5).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(18);e.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},function(e,t,r){var n=r(5),i=r(9),o=r(19),a=r(21),s=r(6)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];a&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(6)("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:r=!0}},o[n]=function(){return a},e(o)}catch(e){}return r}},function(e,t,r){var n=r(36),i=r(9),o=r(5),a=r(111),s=r(114);n(n.P+n.R,"Promise",{finally:function(e){var t=a(this,i.Promise||o.Promise),r="function"==typeof e;return this.then(r?function(r){return s(t,e()).then((function(){return r}))}:e,r?function(r){return s(t,e()).then((function(){throw r}))}:e)}})},function(e,t,r){var n=r(36),i=r(72),o=r(113);n(n.S,"Promise",{try:function(e){var t=i.f(this),r=o(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){e.exports=function(e){function t(e){let r,i=null;function o(...e){if(!o.enabled)return;const n=o,i=Number(new Date),a=i-(r||i);n.diff=a,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";s++;const o=t.formatters[i];if("function"==typeof o){const t=e[s];r=o.call(n,t),e.splice(s,1),s--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null===i?t.enabled(e):i,set:e=>{i=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(196),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},function(e,t){var r=1e3,n=6e4,i=60*n,o=24*i;function a(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=o?a(e,t,o,"day"):t>=i?a(e,t,i,"hour"):t>=n?a(e,t,n,"minute"):t>=r?a(e,t,r,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=o?Math.round(e/o)+"d":t>=i?Math.round(e/i)+"h":t>=n?Math.round(e/n)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){t.__esModule=!0;var n=a(r(198)),i=a(r(200)),o="function"==typeof i.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===o(n.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}},function(e,t,r){e.exports={default:r(199),__esModule:!0}},function(e,t,r){r(100),r(109),e.exports=r(73).f("iterator")},function(e,t,r){e.exports={default:r(201),__esModule:!0}},function(e,t,r){r(202),r(99),r(208),r(209),e.exports=r(9).Symbol},function(e,t,r){var n=r(5),i=r(22),o=r(21),a=r(36),s=r(103),c=r(203).KEY,u=r(48),l=r(70),d=r(51),p=r(50),f=r(6),h=r(73),m=r(74),g=r(204),v=r(205),y=r(14),b=r(20),S=r(108),_=r(28),M=r(67),T=r(49),w=r(104),x=r(206),I=r(207),E=r(120),A=r(19),C=r(68),k=I.f,O=A.f,N=x.f,R=n.Symbol,P=n.JSON,D=P&&P.stringify,j=f("_hidden"),L=f("toPrimitive"),z={}.propertyIsEnumerable,U=l("symbol-registry"),B=l("symbols"),F=l("op-symbols"),V=Object.prototype,H="function"==typeof R&&!!E.f,$=n.QObject,W=!$||!$.prototype||!$.prototype.findChild,Y=o&&u((function(){return 7!=w(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=k(V,t);n&&delete V[t],O(e,t,r),n&&e!==V&&O(V,t,n)}:O,G=function(e){var t=B[e]=w(R.prototype);return t._k=e,t},Q=H&&"symbol"==typeof R.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof R},q=function(e,t,r){return e===V&&q(F,t,r),y(e),t=M(t,!0),y(r),i(B,t)?(r.enumerable?(i(e,j)&&e[j][t]&&(e[j][t]=!1),r=w(r,{enumerable:T(0,!1)})):(i(e,j)||O(e,j,T(1,{})),e[j][t]=!0),Y(e,t,r)):O(e,t,r)},J=function(e,t){y(e);for(var r,n=g(t=_(t)),i=0,o=n.length;o>i;)q(e,r=n[i++],t[r]);return e},Z=function(e){var t=z.call(this,e=M(e,!0));return!(this===V&&i(B,e)&&!i(F,e))&&(!(t||!i(this,e)||!i(B,e)||i(this,j)&&this[j][e])||t)},K=function(e,t){if(e=_(e),t=M(t,!0),e!==V||!i(B,t)||i(F,t)){var r=k(e,t);return!r||!i(B,t)||i(e,j)&&e[j][t]||(r.enumerable=!0),r}},X=function(e){for(var t,r=N(_(e)),n=[],o=0;r.length>o;)i(B,t=r[o++])||t==j||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===V,n=N(r?F:_(e)),o=[],a=0;n.length>a;)!i(B,t=n[a++])||r&&!i(V,t)||o.push(B[t]);return o};H||(s((R=function(){if(this instanceof R)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===V&&t.call(F,r),i(this,j)&&i(this[j],e)&&(this[j][e]=!1),Y(this,e,T(1,r))};return o&&W&&Y(V,e,{configurable:!0,set:t}),G(e)}).prototype,"toString",(function(){return this._k})),I.f=K,A.f=q,r(121).f=x.f=X,r(75).f=Z,E.f=ee,o&&!r(35)&&s(V,"propertyIsEnumerable",Z,!0),h.f=function(e){return G(f(e))}),a(a.G+a.W+a.F*!H,{Symbol:R});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)f(te[re++]);for(var ne=C(f.store),ie=0;ne.length>ie;)m(ne[ie++]);a(a.S+a.F*!H,"Symbol",{for:function(e){return i(U,e+="")?U[e]:U[e]=R(e)},keyFor:function(e){if(!Q(e))throw TypeError(e+" is not a symbol!");for(var t in U)if(U[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),a(a.S+a.F*!H,"Object",{create:function(e,t){return void 0===t?w(e):J(w(e),t)},defineProperty:q,defineProperties:J,getOwnPropertyDescriptor:K,getOwnPropertyNames:X,getOwnPropertySymbols:ee});var oe=u((function(){E.f(1)}));a(a.S+a.F*oe,"Object",{getOwnPropertySymbols:function(e){return E.f(S(e))}}),P&&a(a.S+a.F*(!H||u((function(){var e=R();return"[null]"!=D([e])||"{}"!=D({a:e})||"{}"!=D(Object(e))}))),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(b(t)||void 0!==e)&&!Q(e))return v(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Q(t))return t}),n[1]=t,D.apply(P,n)}}),R.prototype[L]||r(18)(R.prototype,L,R.prototype.valueOf),d(R,"Symbol"),d(Math,"Math",!0),d(n.JSON,"JSON",!0)},function(e,t,r){var n=r(50)("meta"),i=r(20),o=r(22),a=r(19).f,s=0,c=Object.isExtensible||function(){return!0},u=!r(48)((function(){return c(Object.preventExtensions({}))})),l=function(e){a(e,n,{value:{i:"O"+ ++s,w:{}}})},d=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[n].i},getWeak:function(e,t){if(!o(e,n)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[n].w},onFreeze:function(e){return u&&d.NEED&&c(e)&&!o(e,n)&&l(e),e}}},function(e,t,r){var n=r(68),i=r(120),o=r(75);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var a,s=r(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,r){var n=r(38);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(28),i=r(121).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},function(e,t,r){var n=r(75),i=r(49),o=r(28),a=r(67),s=r(22),c=r(102),u=Object.getOwnPropertyDescriptor;t.f=r(21)?u:function(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){r(74)("asyncIterator")},function(e,t,r){r(74)("observable")},function(e,t,r){t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){var n=o(r(62)),i=o(r(63));function o(e){return e&&e.__esModule?e:{default:e}}var a=r(212),s=r(52),c=r(117),u=r(119),l=r(57),d={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},p=new s("WebSocketTransport"),f=0;e.exports=class extends c{constructor(e,t){super(p),p.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this.wsid=0,this.skipReconnection=!1,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){p.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){p.error("close() | error closing the WebSocket: %o",e)}}}send(e){var t=this;return(0,i.default)(n.default.mark((function r(){return n.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t._closed){r.next=2;break}throw new Error("transport closed");case 2:r.prev=2,t._ws.send(l.stringify(e)),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),p.warn("send() failed:",r.t0.name,r.t0.message),r.t0;case 10:case"end":return r.stop()}}),r,t,[[2,6]])})))()}_runWebSocket(){var e=this,t=a.operation(this._options.retry||d),r=!1;t.attempt((function(n){e._closed?t.stop():(p.debug("_runWebSocket() [currentAttempt:%s]",n),e._ws=new WebSocket(e._url,["protoo"]),f++,e.wsid=f,e._ws.onopen=function(){e._closed||(r=!0,e.safeEmit("open"))},e._ws.onclose=function(i){if(!e._closed)if(p.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',i.wasClean,i.code,i.reason),r){if(t.stop(),e.safeEmit("disconnected"),e._closed||e.skipReconnection)return;e._runWebSocket()}else e.safeEmit("failed",n),e._closed||t.retry(!0)||(e._closed=!0,e.safeEmit("close"))},e._ws.onerror=function(){e._closed||p.error('WebSocket "error" event')},e._ws.onmessage=function(t){if(!e._closed){var r=u.parse(t.data);r&&(0!==e.listenerCount("message")?e.safeEmit("message",r):p.error('no listeners for WebSocket "message" event, ignoring received message'))}})}))}}},function(e,t,r){e.exports=r(213)},function(e,t,r){var n=r(214);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var o=0;o<n.length;o++){var a=n[o],s=e[a];e[a]=function(n){var i=t.operation(r),o=Array.prototype.slice.call(arguments,1),a=o.pop();o.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),a.apply(this,arguments))})),i.attempt((function(){n.apply(e,o)}))}.bind(e,s),e[a].options=r}}},function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,i=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&i.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,a=(e[o]||0)+1;e[o]=a,a>=r&&(t=i,r=a)}return t}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Mediasoup=void 0;const s=r(3),c=o(r(122)),u=r(229),l=a(r(11)),d=a(r(1)),p=a(r(0)),f=r(2),h=r(16);class m extends s.EventEmitter{constructor(e){super(),this._consumers={},this._timeout=6e4,this._edgeRtpCapabilities=null,this._mediasoupDevice=null,this._sendTransportIceParameters=null,this._recvTransportIceParameters=null,this._micProducer=null,this._micProducerId=null,this._webcamProducer=null,this._webcamProducerId=null,this._screenProducer=null,this._screenProducerId=null,this._webcamProducerCodec=null,this._screenProducerCodec=null,this._sendTransport=null,this._recvTransport=null,this._sendTransportTimeoutTimer=null,this._recvTransportTimeoutTimer=null,this._eventQueue=[],this._protoo=null,this.senderEncodingParameter={ssrcList:[],audio:{high:null,low:null},video:{high:null,low:null},screen:{high:null,low:null}},this.unsupportedProducers={},this.iceStatusHistory={send:{promises:[],status:{info:""}},recv:{promises:[],status:{info:""}}},this.adapterRef=e.adapterRef,this.logger=e.logger,this.loggerSend=e.logger.getChild((()=>{var e;let t="MediaSend";if(this._sendTransport)if(null===(e=this._sendTransport._handler)||void 0===e?void 0:e._pc){const e=this._sendTransport._handler._pc;e.connectionState&&"connected"!==e.connectionState&&(t+=" "+e.connectionState),"stable"!==e.signalingState&&(t+=" "+e.signalingState)}else t+=" NOTRANSPORT";else t+=" UNINIT";return this.adapterRef._mediasoup!==this&&(t+=" DETACHED"),t})),this.loggerRecv=e.logger.getChild((()=>{var e;let t="MediaRecv";if(this._recvTransport)if(null===(e=this._recvTransport._handler)||void 0===e?void 0:e._pc){const e=this._recvTransport._handler._pc;e.connectionState&&"connected"!==e.connectionState&&(t+=" "+e.connectionState),"stable"!==e.signalingState&&(t+=" "+e.signalingState)}else t+=" NOTRANSPORT";else t+=" UNINIT";return this.adapterRef._mediasoup!==this&&(t+=" DETACHED"),t})),this._reset()}get consumers(){return this._consumers}_reset(){this._edgeRtpCapabilities=null,this._mediasoupDevice=null,this._sendTransportIceParameters=null,this._recvTransportIceParameters=null,this._micProducer=null,this._micProducerId=null,this._webcamProducer=null,this._webcamProducerId=null,this._screenProducer=null,this._screenProducerId=null,this._consumers={},this._sendTransportTimeoutTimer&&clearTimeout(this._sendTransportTimeoutTimer),this._sendTransportTimeoutTimer=null,this._recvTransportTimeoutTimer&&clearTimeout(this._recvTransportTimeoutTimer),this._recvTransportTimeoutTimer=null,this._sendTransport&&(this._sendTransport.close(),this.getIceStatus("send")),this._sendTransport=null,this._recvTransport&&(this._recvTransport.close(),this.getIceStatus("recv")),this._recvTransport=null,this.resetConsumeRequestStatus()}async init(){if(this.logger.log("初始化 devices、transport"),this.adapterRef._enableRts)return;this._mediasoupDevice||(this._mediasoupDevice=new c.Device,this._mediasoupDevice&&await this._mediasoupDevice.load({routerRtpCapabilities:this._edgeRtpCapabilities}));let e=[],t="all";if(this.adapterRef.channelInfo.relaytoken&&this.adapterRef.channelInfo.relayaddrs&&(this.adapterRef.channelInfo.relayaddrs.forEach((t=>{e.push({urls:"turn:"+t,credential:this.adapterRef.proxyServer.credential||this.adapterRef.channelInfo.uid+"/"+this.adapterRef.channelInfo.cid,username:this.adapterRef.channelInfo.relaytoken})})),"firefox"!==h.RtcSystem.browser.ua&&(t="relay")),this.adapterRef.testConf.turnAddr&&(e.length=0,e.push({urls:this.adapterRef.testConf.turnAddr,credential:this.adapterRef.channelInfo.uid+"/"+this.adapterRef.channelInfo.cid,username:this.adapterRef.testConf.relaytoken||"123456"}),t="relay"),this.adapterRef.testConf.iceServers&&(e=this.adapterRef.testConf.iceServers,t=this.adapterRef.testConf.iceTransportPolicy||"relay"),e.length&&this.logger.log("iceTransportPolicy ",t," iceServers ",JSON.stringify(e)),!this._sendTransport&&this._mediasoupDevice&&(this._sendTransport=this._mediasoupDevice.createSendTransport({id:this.adapterRef.channelInfo.uid,iceParameters:void 0,iceCandidates:void 0,dtlsParameters:void 0,sctpParameters:void 0,iceServers:e,iceTransportPolicy:t,proprietaryConstraints:{optional:[{googDscp:!0},{googIPv6:!1}]},appData:{cid:this.adapterRef.channelInfo.cid,uid:this.adapterRef.channelInfo.uid,encodedInsertableStreams:this.adapterRef.encryption.encodedInsertableStreams}}),this.senderEncodingParameter={ssrcList:[],audio:{high:null,low:null},video:{high:null,low:null},screen:{high:null,low:null}},this._sendTransport.on("connectionstatechange",this._sendTransportConnectionstatechange.bind(this,this._sendTransport)),this._sendTransport.handler._pc.addEventListener("iceconnectionstatechange",(()=>{this.getIceStatus("send")}))),!this._recvTransport){const r=this._mediasoupDevice.createRecvTransport({id:this.adapterRef.channelInfo.uid,iceParameters:void 0,iceCandidates:void 0,dtlsParameters:void 0,sctpParameters:void 0,iceServers:e,iceTransportPolicy:t,proprietaryConstraints:{optional:[{googDscp:!0}]},appData:{cid:this.adapterRef.channelInfo.cid,uid:this.adapterRef.channelInfo.uid,encodedInsertableStreams:this.adapterRef.encryption.encodedInsertableStreams}});this._recvTransport=r,r.on("connectionstatechange",this._recvTransportConnectionstatechange.bind(this,r)),r.handler._pc.addEventListener("iceconnectionstatechange",(()=>{this.getIceStatus("recv")}))}let r=setInterval((()=>{this.getIceStatus(),this._mediasoupDevice?this.getIceStatus():clearInterval(r)}),1e3);this.emit("transportReady")}async _sendTransportConnectionstatechange(e,t){if(this._sendTransport===e)if(this.loggerSend.log(`send connection #${e._handler._pc.pcid} state  changed to ${t}`),this.emit("upstream-state-change",{connectionState:t}),"failed"===t)try{this._sendTransport&&(this._sendTransportTimeoutTimer||(this._sendTransportTimeoutTimer=setTimeout((()=>{this._reconnectTransportConnectTimeout()}),this._timeout))),this._sendTransportConnectTimeout()}catch(e){this.loggerSend.error("reconnectSendTransportConnect() | failed:",e,name,e.message)}else"connected"===t&&this._sendTransportTimeoutTimer&&(clearTimeout(this._sendTransportTimeoutTimer),this._sendTransportTimeoutTimer=null);else this.loggerSend.error("_sendTransportConnectionstatechange：出现了_sendTransport绑定不一致的状况。")}async _recvTransportConnectionstatechange(e,t){if(this._recvTransport===e)if(this.loggerRecv.log(`recv connection ${e._handler._pc.pcid} state changed to ${t}`),this.emit("downstream-state-change",{connectionState:t}),"failed"===t){try{this._recvTransport&&(this._recvTransportTimeoutTimer||(this._recvTransportTimeoutTimer=setTimeout((()=>{this._reconnectTransportConnectTimeout()}),this._timeout)))}catch(e){this.loggerRecv.error("reconnectRecvTransportConnect() | failed:",e.name,e.message)}this._recvTransportConnectTimeout()}else"connected"===t&&this._recvTransportTimeoutTimer&&(clearTimeout(this._recvTransportTimeoutTimer),this._recvTransportTimeoutTimer=null);else this.loggerRecv.error("_recvTransportConnectionstatechange：出现了_recvTransport绑定不一致的状况。")}async _sendTransportConnectTimeout(){this.loggerSend.warn("媒体上行传输通道连接失败"),this.adapterRef._signalling&&("CONNECTED"===this.adapterRef.connectState.curState?(this.loggerSend.log("媒体上行传输通道连接失败，尝试整体重连"),this.adapterRef.channelStatus="connectioning",this.adapterRef._signalling.reconnectionControl.next=this.adapterRef._signalling.reconnectionControl.copynext,this.adapterRef._signalling._reconnection()):(this.loggerSend.error("媒体上行传输通道建立失败，抛错错误"),this.adapterRef.instance.emit("error","SOCKET_ERROR")))}async _recvTransportConnectTimeout(){this.loggerRecv.warn("媒体下行传输通道建立失败"),this.adapterRef._signalling&&("CONNECTED"===this.adapterRef.connectState.curState?(this.loggerRecv.error("媒体下行传输通道连接失败，尝试整体重连"),this.adapterRef.channelStatus="connectioning",this.adapterRef._signalling.reconnectionControl.next=this.adapterRef._signalling.reconnectionControl.copynext,this.adapterRef._signalling._reconnection()):(this.loggerRecv.error("媒体下行传输通道建立失败，抛错错误"),this.adapterRef.instance.emit("error","SOCKET_ERROR")))}async _reconnectTransportConnectTimeout(){this.loggerRecv.error("媒体传输通道一直重连失败，主动退出房间"),this.adapterRef.instance.emit("error","MEDIA_TRANSPORT_DISCONNECT"),this.adapterRef.instance.leave()}async createProduce(e,t){var r,n;if(this.loggerSend.log("发布音视频: ",e.getId(),t),!this._sendTransport)throw new d.default({code:p.default.NOT_FOUND,message:"No send trasnport 1"});if(0===this._sendTransport.listenerCount("produce")&&this._sendTransport.on("produce",(async({kind:e,rtpParameters:t,appData:r,localDtlsParameters:n,offer:i},o,a)=>{if(this.loggerSend.log(`produce 反馈 [kind= ${e}, appData= ${JSON.stringify(r)}]`),!this._sendTransport)throw new d.default({code:p.default.NOT_FOUND,message:"No send trasnport 2"});const s="screenShare"==r.mediaType?"screen":r.mediaType;let c=!1;("video"===s&&this.adapterRef.channelInfo.videoLow||"screen"===s&&this.adapterRef.channelInfo.screenLow)&&(c=!0);const u=i.sdp.match(/a=ice-ufrag:([0-9a-zA-Z#=+-_\/\\\\]+)/);u||(this.adapterRef.logger.error(i.sdp),this.adapterRef.logger.error("找不到 iceUfragRegLocal"));try{let a=Object.assign({requestId:""+Math.ceil(1e9*Math.random()),kind:e,rtpParameters:t,iceUfrag:u[1],externData:{producerInfo:{mediaType:r.mediaType,subStream:"screenShare"===r.mediaType,simulcastEnable:c,spatialLayerCount:c?2:1,mute:!1}},appData:{enableTcpCandidate:!0}},r),l=this.senderEncodingParameter[s].high,h=this.senderEncodingParameter[s].low,m=i.sdp.indexOf(r.deviceId),g=i.sdp.indexOf(r.deviceIdLow);if(!l){if(t.encodings&&(l=t.encodings[0],l&&this.senderEncodingParameter.ssrcList.indexOf(l.ssrc)>-1&&(l=null),t.encodings[1]&&(h=t.encodings[1],h&&this.senderEncodingParameter.ssrcList.indexOf(h.ssrc)>-1&&(l=null))),!l&&r.deviceId&&m>-1){const e=i.sdp.substring(m).match(/a=ssrc-group:FID (\d+) (\d+)/);if(e&&(l={ssrc:parseInt(e[1]),rtx:{ssrc:parseInt(e[2])}}),l&&this.senderEncodingParameter.ssrcList.indexOf(l.ssrc)>-1&&(l=null),!h&&r.deviceIdLow&&g>-1){const e=i.sdp.substring(g).match(/a=ssrc-group:FID (\d+) (\d+)/);e&&(h={ssrc:parseInt(e[1]),rtx:{ssrc:parseInt(e[2])}}),h&&this.senderEncodingParameter.ssrcList.indexOf(h.ssrc)>-1&&(h=null)}}l||(this.loggerSend.log("使用sdp中第一个ssrc"),l={ssrc:parseInt(i.sdp.match(/a=ssrc:(\d+)/)[1]),dtx:!1}),this.senderEncodingParameter[s].high=l,this.senderEncodingParameter.ssrcList.push(l.ssrc),h?(this.senderEncodingParameter[s].low=h,this.senderEncodingParameter.ssrcList.push(h.ssrc)):this.senderEncodingParameter[s].low=null}if(t.encodings=[this.senderEncodingParameter[s].high],this.senderEncodingParameter[s].low&&t.encodings.unshift(this.senderEncodingParameter[s].low),"video"!==r.mediaType&&"screenShare"!==r.mediaType||(a.mediaProfile=[],h&&a.mediaProfile.push({ssrc:h.ssrc,res:"160*160",fps:"1",spatialLayer:0,maxBitrate:100}),a.mediaProfile.push({ssrc:l.ssrc,res:"640*480",fps:"15",spatialLayer:a.mediaProfile.length,maxBitrate:1e3})),void 0===n?a.transportId=this._sendTransport.id:a.dtlsParameters=n,!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 2"});const{code:v,transportId:y,iceParameters:b,iceCandidates:S,dtlsParameters:_,producerId:M}=await this.adapterRef._signalling._protoo.request("Produce",a);void 0!==y&&(this._sendTransport._id=y),this.loggerSend.log(`produce请求反馈结果, code: ${v}, kind: ${e}, producerId:`,M);let T={codecParam:null,codecName:null};if("audio"===r.mediaType?this._micProducerId=M:"video"===r.mediaType?(this._webcamProducerId=M,T=this.adapterRef.mediaCapability.getCodecSend("video",this._sendTransport.handler._sendingRtpParametersByKind.video),this._webcamProducerCodec=T.codecName):"screenShare"===r.mediaType&&(this._screenProducerId=M,T=this.adapterRef.mediaCapability.getCodecSend("screen",this._sendTransport.handler._sendingRtpParametersByKind.video),this._screenProducerCodec=T.codecName),b&&(this._sendTransportIceParameters=b),!this.adapterRef.localStream)throw new d.default({code:p.default.NO_LOCALSTREAM,message:"localStream not found"});let w=[];"audio"===r.mediaType?w.push(Object.assign({},f.getParameters().codecOptions.audio)):"video"===r.mediaType?(t.encodings.length>=2&&w.push(Object.assign({},f.getParameters().codecOptions.video.low)),w.push(Object.assign({},f.getParameters().codecOptions.video.high))):"screenShare"===r.mediaType&&(t.encodings.length>=2&&w.push(Object.assign({},f.getParameters().codecOptions.screen.low)),w.push(Object.assign({},f.getParameters().codecOptions.screen.high))),this.logger.log(`codecOptions for producer ${r.mediaType}: ${JSON.stringify(w)}`),await this._sendTransport.fillRemoteRecvSdp({kind:e,appData:r,iceParameters:b,iceCandidates:S,dtlsParameters:_,sctpParameters:void 0,sendingRtpParameters:t,codecOptions:w,offer:i,codec:T.codecParam,audioProfile:this.adapterRef.localStream.audioProfile}),"video"!==s&&"screen"!==s||(this.adapterRef.localStream.applyEncoderConfig(s,"high"),t.encodings.length>=2&&this.adapterRef.localStream.applyEncoderConfig(s,"low")),o({id:M})}catch(e){a(e)}})),"audio"===t||"all"===t)if(this._micProducer)this.loggerSend.log("音频已经publish，跳过");else{const t=e.mediaHelper.audio.audioStream.getAudioTracks()[0];t&&(this.loggerSend.log("发布 audioTrack: ",t.id,t.label),e.pubStatus.audio.audio=!0,this._micProducer=await this._sendTransport.produce({track:t,trackLow:null,codecOptions:{opusStereo:!0,opusDtx:!0},appData:{deviceId:t.id,deviceIdLow:null,mediaType:"audio"}}),this.watchProducerState(this._micProducer,"_micProducer"),this.adapterRef.encryption.encodedInsertableStreams&&this._micProducer._rtpSender&&this.enableSendTransform(this._micProducer._rtpSender,"audio","high"))}if("video"===t||"all"===t)if(this._webcamProducer)this.loggerSend.log("视频已经publish，跳过");else if(e.mediaHelper.video.videoStream.getVideoTracks().length){this.adapterRef.channelInfo.videoLow?e.mediaHelper.video.videoTrackLow&&"ended"!==e.mediaHelper.video.videoTrackLow.readyState||await e.mediaHelper.createTrackLow("video"):("live"===(null===(r=e.mediaHelper.video.videoTrackLow)||void 0===r?void 0:r.readyState)&&e.mediaHelper.video.videoTrackLow.stop(),e.mediaHelper.video.videoTrackLow=null,this.senderEncodingParameter.video.low=null);const t=e.mediaHelper.video.videoStream.getVideoTracks()[0];this.loggerSend.log("发布 videoTrack: ",t.id,t.label),e.pubStatus.video.video=!0;const n=this.adapterRef.mediaCapability.getCodecSend("video",this._sendTransport.handler._sendingRtpParametersByKind.video);this._webcamProducer=await this._sendTransport.produce({track:t,trackLow:e.mediaHelper.video.videoTrackLow,codec:n.codecParam,codecOptions:{videoGoogleStartBitrate:1e3},appData:{deviceId:t.id,deviceIdLow:e.mediaHelper.video.videoTrackLow?e.mediaHelper.video.videoTrackLow.id:null,mediaType:"video"}}),this.watchProducerState(this._webcamProducer,"_webcamProducer"),this.adapterRef.encryption.encodedInsertableStreams&&(this._webcamProducer._rtpSender&&this.enableSendTransform(this._webcamProducer._rtpSender,"video","high"),this._webcamProducer._rtpSenderLow&&this.enableSendTransform(this._webcamProducer._rtpSenderLow,"video","low")),this.adapterRef.state.startPubVideoTime||(this.adapterRef.state.startPubVideoTime=Date.now())}if("screen"===t||"all"===t)if(this._screenProducer)this.loggerSend.log("屏幕共享已经publish，跳过");else if(e.mediaHelper.screen.screenVideoStream.getVideoTracks().length){this.adapterRef.channelInfo.screenLow?e.mediaHelper.screen.screenVideoTrackLow&&"ended"!==e.mediaHelper.screen.screenVideoTrackLow.readyState||await e.mediaHelper.createTrackLow("screen"):("live"===(null===(n=e.mediaHelper.screen.screenVideoTrackLow)||void 0===n?void 0:n.readyState)&&e.mediaHelper.screen.screenVideoTrackLow.stop(),e.mediaHelper.screen.screenVideoTrackLow=null,this.senderEncodingParameter.screen.low=null);const t=e.mediaHelper.screen.screenVideoStream.getVideoTracks()[0];this.loggerSend.log("发布 screenTrack: ",t.id,t.label),e.pubStatus.screen.screen=!0;const r=this.adapterRef.mediaCapability.getCodecSend("screen",this._sendTransport.handler._sendingRtpParametersByKind.video);this._screenProducer=await this._sendTransport.produce({track:t,trackLow:e.mediaHelper.screen.screenVideoTrackLow,codec:r.codecParam,codecOptions:{videoGoogleStartBitrate:1e3},appData:{deviceId:t.id,deviceIdLow:e.mediaHelper.screen.screenVideoTrackLow?e.mediaHelper.screen.screenVideoTrackLow.id:null,mediaType:"screenShare"}}),this.watchProducerState(this._screenProducer,"_screenProducer"),this.adapterRef.encryption.encodedInsertableStreams&&(this._screenProducer._rtpSender&&this.enableSendTransform(this._screenProducer._rtpSender,"screen","high"),this._screenProducer._rtpSenderLow&&this.enableSendTransform(this._screenProducer._rtpSenderLow,"screen","low")),this.adapterRef.state.startPubScreenTime||(this.adapterRef.state.startPubScreenTime=Date.now())}}enableSendTransform(e,t,r){var n;const i=null===(n=this._sendTransport)||void 0===n?void 0:n.send.find((t=>t.sender===e));if(i)if(i.encodedStreams)this.loggerRecv.log(`发送端自定义加密，复用之前的通道。 ${i.mediaType} ${i.streamType}`);else{const t=e.createEncodedStreams(),r=new TransformStream({transform:this.adapterRef.encryption.handleUpstreamTransform.bind(this.adapterRef.encryption,i)});t.readable.pipeThrough(r).pipeTo(t.writable),i.encodedStreams=t,i.transformStream=r,this.loggerRecv.log(`发送端自定义加密，成功启动。 ${i.mediaType} ${i.streamType}`)}else this.loggerRecv.error("未找到匹配的Sender",t,r)}enableRecvTransform(e,t,r){var n;const i=null===(n=this._recvTransport)||void 0===n?void 0:n.recv.find((t=>t.receiver===e));if(i)if(i.encodedStreams)this.loggerRecv.log(`接收端自定义解密，复用之前的通道。uid:${i.uid}, mediaType: ${i.mediaType}`);else{const t=e.createEncodedStreams(),r=new TransformStream({transform:this.adapterRef.encryption.handleDownstreamTransform.bind(this.adapterRef.encryption,i)});t.readable.pipeThrough(r).pipeTo(t.writable),i.encodedStreams=t,i.transformStream=r,this.loggerRecv.log(`接收端自定义解密，成功启动。uid:${i.uid}, mediaType: ${i.mediaType}`)}else this.loggerRecv.error("未找到匹配的Receiver",t,r)}watchProducerState(e,t){var r;if(null===(r=e.rtpSender)||void 0===r?void 0:r.transport){const r=e.rtpSender.transport;"failed"===r.state?this.logger.error(`Producer state ${t} ${r.state}`):(this.logger.log(`Producer state ${t} ${r.state}`),e.rtpSender.transport.addEventListener("statechange",(()=>{switch(r.state){case"failed":this.logger.error(`Producer state changed: ${t} ${r.state}`);break;case"connected":case"new":case"connecting":this.logger.log(`Producer state changed: ${t} ${r.state}`)}})))}else this.logger.log("Producer state: transport is null")}async destroyProduce(e){var t;let r=null,n=null;if("audio"===e){if(r=this._micProducer,n=this._micProducerId,this._micProducer=this._micProducerId=null,!this.adapterRef.localStream)throw new d.default({code:p.default.NO_LOCALSTREAM,message:"localStream not found"});this.adapterRef.localStream.pubStatus.audio.audio=!1}else if("video"===e){if(r=this._webcamProducer,n=this._webcamProducerId,this._webcamProducer=this._webcamProducerId=null,!this.adapterRef.localStream)throw new d.default({code:p.default.NO_LOCALSTREAM,message:"localStream not found"});this.adapterRef.localStream.pubStatus.video.video=!1}else if("screen"===e){if(r=this._screenProducer,n=this._screenProducerId,this._screenProducer=this._screenProducerId=null,!this.adapterRef.localStream)throw new d.default({code:p.default.NO_LOCALSTREAM,message:"localStream not found"});this.adapterRef.localStream.pubStatus.screen.screen=!1}try{if(this.loggerSend.log(`停止发布 destroyProduce ${e} producerId=`,n),!r)return;r.close(),(null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)?this.adapterRef._signalling._protoo.request("CloseProducer",{requestId:""+Math.ceil(1e9*Math.random()),producerId:n}).catch((e=>{this.logger.error("destroyProduce Failed:",e.name,e.stack,e)})):this.logger.warn("destroyProduce：当前信令中断，不发信令包",e,n)}catch(e){this.loggerSend.error("_destroyProducer() | failed:",e.name,e.message)}}async createConsumer(e,t,r,n,i=0){return this.adapterRef.instance.emit("pairing-createConsumer-start"),new Promise(((o,a)=>{this._eventQueue.push({uid:e,kind:t,id:n,mediaType:r,preferredSpatialLayer:i,resolve:o,reject:a}),this._eventQueue.length>1||(this.adapterRef._enableRts?this._createConsumerRts(this._eventQueue[0]):this._createConsumer(this._eventQueue[0]))}))}async setConsumerPreferredLayer(e,t,r){if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo"});return this.loggerSend.log("setConsumerPreferredLayer() [切换大小流]layer：",t,1===t?"大流":"小流",r),await this.adapterRef._signalling._protoo.request("SetConsumerPreferredLayer",{requestId:""+Math.ceil(1e9*Math.random()),uid:e.streamID,producerId:e.pubStatus[r].producerId,consumerId:e.pubStatus[r].consumerId,spatialLayer:t})}async resetConsumeRequestStatus(){const e=this._eventQueue;this._eventQueue=[];for(let t=0;t<e.length;t++){const r=e[t];this.loggerRecv.log(`resetConsumeRequestStatus：uid ${r.uid}, uid ${r.uid}, kind ${r.kind}, id ${r.id}`),r.reject("resetConsumeRequestStatus")}}removeUselessConsumeRequest(e){const{producerId:t,uid:r}=e;if(t&&r){this.loggerRecv.log(`removeUselessConsumeRequest：producerId ${t}, uid ${r}`);for(let e=0;e<this._eventQueue.length;e++){const n=this._eventQueue[e];this.loggerRecv.log(`removeUselessConsumeRequest：uid ${n.uid}, uid ${n.uid}, kind ${n.kind}, id ${n.id}`),n.id!==t&&n.uid!==r||(this._eventQueue.splice(e,1),e++)}}}checkConsumerList(e){return this._eventQueue.shift(),e.resolve(null),this.loggerRecv.log("查看事件队列, _eventQueue: ",this._eventQueue.length),this._eventQueue.forEach((e=>{this.loggerRecv.log(`consumerList, uid: ${e.uid}, kind: ${e.kind}, mediaType: ${e.mediaType}, id: ${e.id}`)})),this._eventQueue.length>0&&(this.adapterRef._enableRts?this._createConsumerRts(this._eventQueue[0]):this._createConsumer(this._eventQueue[0])),"checkConsumerList"}async _createConsumer(e){const{uid:t,kind:r,mediaType:n,id:i,preferredSpatialLayer:o=0}=e,a="screenShare"===n?"screen":n;if(this.loggerRecv.log(`开始订阅 ${t} 的 ${a} 媒体: ${i} 大小流: `,o),!i)return this.adapterRef.instance.emit("pairing-createConsumer-error"),this.checkConsumerList(e);if(this.unsupportedProducers[i])return this.loggerRecv.warn("_createConsumer: 跳过不支持的Producer",i,JSON.stringify(this.unsupportedProducers[i])),this.checkConsumerList(e);const s=this.adapterRef.remoteStreamMap[t];if(!s||!s.pubStatus[a][a]||!s.pubStatus[a].producerId)return this.adapterRef.instance.emit("pairing-createConsumer-error"),this.checkConsumerList(e);if(s.pubStatus[a].consumerId){this.loggerRecv.log("已经订阅过");let t=!0;if(s.Play&&(t=await s.Play.isPlayStreamError(a)),t)return this.loggerRecv.log("当前播放正常，直接返回"),this.adapterRef.instance.emit("pairing-createConsumer-skip"),this.checkConsumerList(e);if("start"!==s.pubStatus[a].stopconsumerStatus){this.loggerRecv.log("先停止之前的订阅");try{if(s.pubStatus[a].stopconsumerStatus="start",!this.adapterRef._mediasoup)throw new d.default({code:p.default.NO_MEDIASERVER,message:"media server error 21"});await this.destroyConsumer(s.pubStatus.audio.consumerId,null,null),this.adapterRef.instance.removeSsrc(s.getId(),a),s.pubStatus[a].consumerId="",s.stop(a),s.pubStatus[a].stopconsumerStatus="end"}catch(e){this.loggerRecv.error("停止之前的订阅出现错误: ",e.name,e.message)}}}let c=null;if("audio"===a&&(c={opusStereo:1}),this._mediasoupDevice&&this._mediasoupDevice.loaded||(this.loggerRecv.error("createConsumer：Waiting for Transport Ready"),await u.waitForEvent(this,"transportReady",3e3)),!this._recvTransport)throw this.adapterRef.instance.emit("pairing-createConsumer-error"),e.resolve(null),new d.default({code:p.default.NOT_FOUND,message:"No receive transport"});this.loggerRecv.log(`prepareLocalSdp [kind: ${r}, mediaTypeShort: ${a}, uid: ${t}]`),this._recvTransport.id===this.adapterRef.channelInfo.uid&&(this.loggerRecv.log("transporth还没有协商，需要dtls消息"),this._recvTransport._handler._transportReady=!1);const f=await this._recvTransport.prepareLocalSdp(r,this._edgeRtpCapabilities,t);this.adapterRef&&"DISCONNECTING"!=this.adapterRef.connectState.curState&&"DISCONNECTED"!=this.adapterRef.connectState.curState||this.checkConsumerList(e),this.loggerRecv.log("获取本地sdp，mid =",f.mid);let{rtpCapabilities:h,offer:m,iceUfragReg:g}=f,v=f.mid;const y=f.dtlsParameters;v="number"==typeof v&&v<0?void 0:""+v;const b=m.sdp.match(/a=ice-ufrag:([0-9a-zA-Z=#+-_\/\\\\]+)/);if(!b)throw new Error("iceUfragRegRemote is null");let S=t;"string"===this.adapterRef.channelInfo.uidType&&(S=new l.default(S));let _={requestId:""+Math.ceil(1e9*Math.random()),kind:r,rtpCapabilities:h,uid:S,producerId:i,preferredSpatialLayer:o,mid:v,pause:!1,iceUfrag:b[1],appData:{enableTcpCandidate:!0}};if(this.adapterRef.instance.apiEventReport("setFunction",{name:"set_video_sub",oper:"1",value:JSON.stringify(o)}),void 0===y?_.transportId=this._recvTransport.id:_.dtlsParameters=y,this.loggerRecv.log(`发送consume请求, uid: ${t}, kind: ${r}, mediaTypeShort: ${a}, producerId: ${_.producerId}, transportId: ${_.transportId}, requestId: ${_.requestId}`),!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw e.resolve(null),new d.default({code:p.default.NOT_FOUND,message:"No _protoo 4"});const M=await this.adapterRef._signalling._protoo.request("Consume",_);if(i!=s.pubStatus[a].producerId)return this.loggerRecv.warn(`收到consumeRes后Producer已经更新。触发重建下行。uid: ${s.streamID} mediaType: ${a} ProducerId: ${i} => ${s.pubStatus[a].producerId} ，Consume结果忽略：`,M),this.resetConsumeRequestStatus(),this._recvTransport&&await this.closeTransport(this._recvTransport),this.adapterRef.instance.reBuildRecvTransport(),this.checkConsumerList(e);let{transportId:T,iceParameters:w,iceCandidates:x,dtlsParameters:I,probeSSrc:E,rtpParameters:A,producerId:C,consumerId:k,code:O,errMsg:N}=M;if(200!==O)return this.loggerRecv.error(`consume请求失败，将Producer拉入黑名单:  uid: ${t}, mediaType: ${a}, producerId ${_.producerId} code: ${O}, errMsg: ${N}`,M),this.unsupportedProducers[_.producerId]={producerId:M.producerId,code:O,uid:t,mediaType:a,errMsg:N},this.checkConsumerList(e);if(this.loggerRecv.log(`consume反馈结果: code: ${O} uid: ${t}, mid: ${A&&A.mid}, kind: ${r}, producerId: ${C}, consumerId: ${k}, transportId: ${T}, requestId: ${M.requestId}, errMsg: ${N}`),!this._recvTransport)return this.loggerRecv.error("transport undefined，直接返回"),this.checkConsumerList(e);try{const n=M.uid;if(200!==O||!this.adapterRef.remoteStreamMap[t])return this.loggerRecv.warn("remoteStream.pubStatus: ",s.pubStatus),n&&t!=n&&(this.loggerRecv.log("peerId: ",n),this.loggerRecv.log("id 不匹配不处理")),s[a]&&s.pubStatus[a][a]&&s.pubStatus[a].producerId||this.loggerRecv.log(`${t} 的 ${a} 的媒体已经停止发布了，直接返回`),await this._recvTransport.recoverLocalSdp(t,v,r),this.loggerRecv.log("发送请求的 producerId: ",i),this.loggerRecv.log("当前的 producerId：",s.pubStatus[a].producerId),s.pubStatus[a].producerId&&i!=s.pubStatus[a].producerId?(this.loggerRecv.log("此前的订阅已经失效，重新订阅"),this.adapterRef.instance.doSubscribe(s).then((()=>{this.adapterRef.instance.emit("pairing-createConsumer-success")})).catch((()=>{this.adapterRef.instance.emit("pairing-createConsumer-error")}))):this.adapterRef.instance.emit("pairing-createConsumer-skip"),this.checkConsumerList(e);A&&A.encodings&&A.encodings.length&&A.encodings[0].ssrc&&this.adapterRef.instance.addSsrc(t,a,A.encodings[0].ssrc),void 0!==T&&(this._recvTransport._id=T),void 0!==E&&(this._probeSSrc=E),w&&(this._recvTransportIceParameters=w);let o={};null!=A.mid&&(A.mid=A.mid+"");const u=await this._recvTransport.consume({id:k,producerId:C,kind:r,mediaType:a,uid:t||n,rtpParameters:A,codecOptions:c,appData:Object.assign(Object.assign({},o),{peerId:n,remoteUid:t}),offer:m,iceParameters:w,iceCandidates:x,dtlsParameters:I,sctpParameters:void 0,probeSSrc:this._probeSSrc});if(this.adapterRef.encryption.encodedInsertableStreams&&u.rtpReceiver&&this.enableRecvTransform(u.rtpReceiver,t,a),this._consumers[u.id]=u,u.on("transportclose",(()=>{this._consumers&&delete this._consumers[u.id]})),this.loggerRecv.log("订阅consume完成 peerId =",n),s&&s.pubStatus[a].producerId){if(s.subStatus[a]=!0,s.pubStatus[a][a]=!0,s.pubStatus[a].consumerId=k,s.pubStatus[a].producerId=C,s.getMuteStatus(a).muted){this.loggerRecv.log(`远端流处于mute状态：uid ${s.getId()}, ${a}, ${JSON.stringify(s.getMuteStatus(a))}`);const e=s.getMuteStatus(a);e.send&&this.loggerRecv.log(`远端流把自己mute了：uid ${s.getId()}, ${a}, ${JSON.stringify(e)}`),e.recv&&(this.loggerRecv.log(`本端把远端流mute了：uid ${s.getId()}, ${a}, ${JSON.stringify(e)}`),u.track.enabled=!1)}if(!s.mediaHelper)throw new d.default({code:p.default.NO_MEDIAHELPER,message:"No remoteStream.mediaHelper"});s.mediaHelper.updateStream(a,u.track),this.adapterRef.instance.emit("pairing-createConsumer-success"),this.adapterRef.instance.safeEmit("stream-subscribed",{stream:s,mediaType:a})}else this.adapterRef.instance.emit("pairing-createConsumer-error"),this.loggerRecv.log("该次consume状态错误： ",JSON.stringify(s.pubStatus,null,""));return this.checkConsumerList(e)}catch(n){return this.adapterRef&&this.loggerRecv.error(`订阅 ${t} 的 ${r} 媒体失败, error name: ${n.name}, error.message: ${n.message}`),"peer closed"===n.name?(this.loggerRecv.log("订阅 ${uid} 的 ${kind} 媒体失败，信令通道已经销毁，忽略改成请求"),this.checkConsumerList(e)):(this.loggerRecv.error(`订阅 ${t} 的 ${r} 媒体失败，做容错处理: 重新建立下行连接`),this.resetConsumeRequestStatus(),this._recvTransport&&await this.closeTransport(this._recvTransport),this.adapterRef.instance.reBuildRecvTransport(),this.checkConsumerList(e))}}async _createConsumerRts(e){const{uid:t,kind:r,id:n,mediaType:i,preferredSpatialLayer:o=0}=e,a="screenShare"===i?"screen":i;if(this.loggerRecv.log(`开始订阅 ${t} 的 ${a} 媒体: ${n} 大小流: ${o}`),!this.adapterRef._rtsTransport)throw new d.default({code:p.default.NOT_FOUND,message:"_createConsumerRts: _rtsTransport is null"});if(!(this.adapterRef._signalling&&this.adapterRef._signalling._protoo&&this.adapterRef._signalling._protoo.request))throw new d.default({code:p.default.NOT_FOUND,message:"_createConsumerRts: _protoo is null"});if("audio"!==a&&"video"!==a&&"screen"!==a)throw new d.default({code:p.default.UNKNOWN_TYPE,message:"_createConsumerRts: mediaType type error"});if(!n)return this.adapterRef.instance.emit("pairing-createConsumer-error"),this.checkConsumerList(e);let s=this.adapterRef.remoteStreamMap[t];if(!s||!s.pubStatus[a][a]||!s.pubStatus[a].producerId)return this.adapterRef.instance.emit("pairing-createConsumer-error"),this.checkConsumerList(e);if(s.pubStatus[a].consumerId)return this.loggerRecv.log("已经订阅过，返回"),this.adapterRef.instance.emit("pairing-createConsumer-skip"),this.checkConsumerList(e);const c={requestId:""+Math.ceil(1e9*Math.random()),transportId:this.adapterRef._rtsTransport.transportId,uid:t,producerId:n,preferredSpatialLayer:o,pause:!1,rtsCapabilities:{codecs:[{kind:a,codec:"video"==a||"screen"==a?"h264":"opus",payloadType:"video"==a||"screen"==a?2:1}]}};if(this.adapterRef.instance.apiEventReport("setFunction",{name:"set_video_sub",oper:"1",value:JSON.stringify(o)}),this.loggerRecv.log("发送consume请求 =",JSON.stringify(c)),!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw e.resolve(null),new d.default({code:p.default.NOT_FOUND,message:"No _protoo 5"});const u=await this.adapterRef._signalling._protoo.request("WsConsume",c);this.loggerRecv.log("consume反馈结果 =",JSON.stringify(u));let{transportId:l,rtpParameters:f,producerId:h,consumerId:m,code:g,errMsg:v}=u;try{const n=u.uid;return 200===g&&this.adapterRef.remoteStreamMap[t]?(this._consumers[m]={producerId:h,close:function(){return Promise.resolve()}},this.loggerRecv.log("订阅consume完成 peerId =",n),s=this.adapterRef.remoteStreamMap[t],s&&s.pubStatus[a].producerId?(s.subStatus[a]=!0,s.pubStatus[a][a]=!0,s.pubStatus[a].consumerId=m,s.pubStatus[a].producerId=h,this.adapterRef.instance.emit("pairing-createConsumer-success")):(this.loggerRecv.log("该次consume状态错误： ",JSON.stringify(s.pubStatus,null,"")),this.adapterRef.instance.emit("pairing-createConsumer-error")),this.checkConsumerList(e)):(this.loggerRecv.error(`订阅 ${t} 的 ${r} 媒体失败, errcode: ${g}, reason: ${v} ，做容错处理: 重新建立下行连接`),this._eventQueue.length=0,void(this._recvTransport=null))}catch(e){return this.adapterRef&&this.loggerRecv.error('"newConsumer" request failed:',e.name,e.message,e),this.loggerRecv.error(`订阅 ${t} 的 ${a} 媒体失败，做容错处理: 重新建立下行连接`),this.adapterRef.instance.reBuildRecvTransport()}}async destroyConsumer(e,t,r){var n,i;if(e)try{const o=this._consumers[e];if(!o)return void this.loggerRecv.log("跳过停止订阅 destroyConsumer consumerId=",e,null==t?void 0:t.streamID);this.loggerRecv.log("停止订阅 destroyConsumer consumerId=",e,null==t?void 0:t.streamID),delete this._consumers[e];try{await(null===(i=null===(n=this.adapterRef._signalling)||void 0===n?void 0:n._protoo)||void 0===i?void 0:i.request("CloseConsumer",{requestId:""+Math.ceil(1e9*Math.random()),consumerId:e,producerId:o.producerId})),await o.close(),t&&r&&this.adapterRef.instance.safeEmit("stream-unsubscribed",{stream:t,mediaType:r})}catch(e){this.logger.error("CloseConsumer失败",e.name,e.message,e)}}catch(e){this.loggerRecv.error("destroyConsumer() | failed:",e.name,e.message,e.stack)}}async closeTransport(e){if(e&&e.id)try{if(this.logger.log(`closeTransport() [停止通道 transportId= ${e.id}]`),!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 7"});const t=await this.adapterRef._signalling._protoo.request("CloseTransport",{requestId:""+Math.ceil(1e9*Math.random()),transportId:e.id});this.logger.log(`closeTransport() [停止通道反馈结果 result=${JSON.stringify(t,null," ")}]`),e.close()}catch(e){this.logger.error("closeTransport() | failed:",e.name,e.message,e)}}async muteAudio(){if(this.loggerSend.log("mute音频"),!this._micProducer)throw new d.default({code:p.default.NOT_FOUND,message:"No _micProducer"});this._micProducer.pause();try{if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 8"});let e=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(e=new l.default(e)),await this.adapterRef._signalling._protoo.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:e,data:{producerId:this._micProducer.id,mute:!0}}})}catch(e){this.loggerSend.error("muteMic() | failed:",e.name,e.message,e)}}async unmuteAudio(){if(this.loggerSend.log("resume音频"),!this._micProducer)throw new d.default({code:p.default.NOT_FOUND,message:"No _micProducer"});this._micProducer.resume();try{if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 9"});let e=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(e=new l.default(e)),await this.adapterRef._signalling._protoo.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:e,data:{producerId:this._micProducer.id,mute:!1}}})}catch(e){return this.loggerSend.error("muteMic() | failed: ",e.name,e.message,e),Promise.reject(e)}}async muteVideo(){if(this.loggerSend.log("mute视频"),!this._webcamProducer)throw new d.default({code:p.default.NOT_FOUND,message:"No _webcamProducer"});this._webcamProducer.pause();try{if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 10"});let e=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(e=new l.default(e)),await this.adapterRef._signalling._protoo.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:e,data:{producerId:this._webcamProducer.id,mute:!0}}})}catch(e){this.loggerSend.error("muteMic() | failed:",e.name,e.message,e)}}async unmuteVideo(){if(this.loggerSend.log("resume视频"),!this._webcamProducer)throw new d.default({code:p.default.NOT_FOUND,message:"No _webcamProducer"});this._webcamProducer.resume();try{if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 11"});let e=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(e=new l.default(e)),await this.adapterRef._signalling._protoo.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:e,data:{producerId:this._webcamProducer.id,mute:!1}}})}catch(e){this.loggerSend.error("muteMic() | failed:",e.name,e.message,e)}}async muteScreen(){if(this.loggerSend.log("mute视频"),!this._screenProducer)throw new d.default({code:p.default.NOT_FOUND,message:"No _screenProducer 1"});this._screenProducer.pause();try{if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 12"});let e=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(e=new l.default(e)),await this.adapterRef._signalling._protoo.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:e,data:{producerId:this._screenProducer.id,mute:!0}}})}catch(e){this.loggerSend.error("muteScreen() | failed: ",e.name,e.message,e)}}async unmuteScreen(){if(this.loggerSend.log("resume视频"),!this._screenProducer)throw new d.default({code:p.default.NOT_FOUND,message:"No _screenProducer 2"});this._screenProducer.resume();try{if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 13"});let e=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(e=new l.default(e)),await this.adapterRef._signalling._protoo.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:e,data:{producerId:this._screenProducer.id,mute:!1}}})}catch(e){this.loggerSend.error("muteMic() | failed:",e.name,e.message,e)}}async updateUserRole(e){this.loggerSend.log("updateUserRole:更新用户角色为"+e);try{if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new d.default({code:p.default.NOT_FOUND,message:"No _protoo 14"});let t=this.adapterRef.channelInfo.uid;"string"===this.adapterRef.channelInfo.uidType&&(t=new l.default(t)),await this.adapterRef._signalling._protoo.request("SendUserData",{externData:{type:"UserRole",cid:this.adapterRef.channelInfo.cid,uid:t,data:{userRole:e}}})}catch(e){throw this.loggerSend.error("updateUserRole failed:",e.name,e.message,e),e}}async getIceStatus(e="send"){var t,r,n,i;const o=Date.now(),a={direction:e,iceConnectionState:"uninit",info:"",elapse:-1};let s;if(s="send"===e?null===(r=null===(t=this._sendTransport)||void 0===t?void 0:t._handler)||void 0===r?void 0:r._pc:null===(i=null===(n=this._recvTransport)||void 0===n?void 0:n._handler)||void 0===i?void 0:i._pc,s){if(a.info+="#"+s.pcid,a.iceConnectionState=s.iceConnectionState,a.info+="|iceConnectoinState "+s.iceConnectionState,s.iceStartedAt&&(a.elapse=o-s.iceStartedAt),this.iceStatusHistory[e].promises[0]&&(this.iceStatusHistory[e].promises[0](null),this.iceStatusHistory[e].promises=[]),"checking"===s.iceConnectionState){if(s.iceStartedAt||(s.iceStartedAt=o),await new Promise((t=>{this.iceStatusHistory[e].promises=[t],setTimeout(t,3e3)})),"checking"!==s.iceConnectionState)return a;a.elapse=Date.now()-s.iceStartedAt}"connected"!==s.iceConnectionState&&"completed"!==s.iceConnectionState||(s.iceConnectedAt||(s.iceConnectedAt=o),await new Promise((t=>{this.iceStatusHistory[e].promises=[t],setTimeout(t,100)})));const t=await s.getStats(null),r=[],n=[];t.forEach(((e,t)=>{r.push(e),"transport"===e.type&&n.push(e)})),n.length||(a.info+="|no transport stats"),n.forEach((e=>{const t=r.find((t=>t.id===e.selectedCandidatePairId));if(t){const e=r.find((e=>e.id===t.localCandidateId));e?(a.info+=`|local:${e.protocol} `,a.info+=`${e.address||"NOADDRESS"}:${e.port||"NOPORT"} ${e.candidateType} ${e.networkType||""}`,a.networkType=e.networkType,a.protocol=e.protocol,a.relayProtocol=e.relayProtocol,a.ip=e.ip,a.address=e.address):a.info+="|无法找到localCandidate "+t.localCandidateId;const n=r.find((e=>e.id===t.remoteCandidateId));n?(a.info+=`|remote:${n.protocol} `,a.info+=`${n.address||"NOADDRESS"}:${n.port||"NOPORT"} ${n.candidateType}`):a.info+="|无法找到remoteCandidate "+t.remoteCandidateId}else a.info+="无法找到candidatePair "+e.selectedCandidatePairId}))}else a.info="no_pc_"+e;if(this.iceStatusHistory[e].status.info!==a.info&&"new"!==a.iceConnectionState&&this._mediasoupDevice){const t={new:1,checking:2,connected:3,completed:4,failed:-1,disconnected:-2,closed:-3}[a.iceConnectionState||0]||0;t>0?this.adapterRef.logger.log("iceConnectionStateChanged",e,a.info):this.adapterRef.logger.warn("iceConnectionStateChanged",e,a.info),this.adapterRef.instance.apiFrequencyControl({name:"_iceStateChange_"+e,code:t,param:JSON.stringify(a)}),this.adapterRef.instance.safeEmit("ice-change",a)}return this.iceStatusHistory[e].status=a,a}destroy(){this.logger.log("清除 meidasoup"),this._reset()}}t.Mediasoup=m},function(e,t,r){const n=r(115)("h264-profile-level-id");n.log=console.info.bind(console),t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5,t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;class i{constructor(e,t){this.profile=e,this.level=t}}t.ProfileLevelId=i;const o=new i(1,31);class a{constructor(e){this._mask=~u("x",e),this._maskedValue=u("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class s{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const c=[new s(66,new a("x1xx0000"),1),new s(77,new a("1xxx0000"),1),new s(88,new a("11xx0000"),1),new s(66,new a("x0xx0000"),2),new s(88,new a("10xx0000"),2),new s(77,new a("0x0x0000"),3),new s(100,new a("00000000"),5),new s(100,new a("00001100"),4)];function u(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function l(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const t=parseInt(e,16);if(0===t)return null;const r=255&t,o=t>>8&255,a=t>>16&255;let s;switch(r){case 11:s=0!=(16&o)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:s=r;break;default:return n("parseProfileLevelId() | unrecognized level_idc:%s",r),null}for(const e of c)if(a===e.profile_idc&&e.profile_iop.isMatch(o))return new i(e.profile,s);return n("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return n("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return n("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r="0"+r),`${t}${r}`},t.parseSdpProfileLevelId=function(e={}){const r=e["profile-level-id"];return r?t.parseProfileLevelId(r):o},t.isSameProfile=function(e={},r={}){const n=t.parseSdpProfileLevelId(e),i=t.parseSdpProfileLevelId(r);return Boolean(n&&i&&n.profile===i.profile)},t.generateProfileLevelIdForAnswer=function(e={},r={}){if(!e["profile-level-id"]&&!r["profile-level-id"])return n("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const o=t.parseSdpProfileLevelId(e),a=t.parseSdpProfileLevelId(r);if(!o)throw new TypeError("invalid local_profile_level_id");if(!a)throw new TypeError("invalid remote_profile_level_id");if(o.profile!==a.profile)throw new TypeError("H264 Profile mismatch");const s=l(e)&&l(r),c=o.level,u=function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(d=c,p=a.level)?d:p;var d,p;const f=s?c:u;return n("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",o.profile,f),t.profileLevelIdToString(new i(o.profile,f))}},function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=class{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(e,t){return n(this,void 0,void 0,(function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof e)throw new TypeError("given task is not a function");if(!e.name&&t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,n)=>{const i={task:e,name:t,resolve:r,reject:n,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(i),1===this.pendingTasks.length&&this.next()}))}))}stop(){if(!this.closed){for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const e=new Date;return this.pendingTasks.map((t=>({task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0})))}next(){return n(this,void 0,void 0,(function*(){const e=this.pendingTasks[0];e&&(yield this.executeTask(e),this.pendingTasks.shift(),this.next())}))}executeTask(e){return n(this,void 0,void 0,(function*(){if(!e.stopped){e.executedAt=new Date;try{const t=yield e.task();if(e.stopped)return;e.resolve(t)}catch(t){if(e.stopped)return;e.reject(t)}}}))}}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;const s=o(r(42)),c=r(7),u=o(r(23)),l=o(r(41)),d=o(r(76)),p=o(r(77)),f=r(53),h=r(78),m=r(17),g=a(r(1)),v=a(r(0)),y=r(2),b="Chrome74",S={OS:1024,MIS:1024};let _=0;class M extends f.HandlerInterface{constructor(){super(),this._sendingRemoteRtpParametersByKind={},this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._transportReady=!1,this._appData={}}static createFactory(){return()=>new M}get name(){return"Chrome74"}close(){if(c.Logger.debug(b,"close()"),this._pc)try{this._pc.onconnectionstatechange=null,this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){c.Logger.debug(b,"getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();t.sdp=t.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack");try{e.close()}catch(e){}const r=s.parse(t.sdp);return d.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return c.Logger.debug(b,"getNativeSctpCapabilities()"),{numStreams:S}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:a,additionalSettings:s,proprietaryConstraints:u,extendedRtpCapabilities:d,appData:p}){c.Logger.debug(b,"run()",p),this._appData=p,this._direction=e,this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},c.Logger.debug(b,"iceServers: %o",o);const f={iceServers:o||[],iceTransportPolicy:a||"all",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"};p.encodedInsertableStreams&&(f.encodedInsertableStreams=!0),this._pc=new RTCPeerConnection(f,u),this._pc.pcid=_++,this._pc.onconnectionstatechange=()=>{switch(this._pc.connectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}},this._pc.onicecandidate=e=>{},this._pc.onicecandidateerror=e=>{console.error("地址收集失败: ",e)}}async updateIceServers(e){c.Logger.debug(b,"updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(c.Logger.debug(b,"restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if(this._direction){const e=await this._pc.createOffer({iceRestart:!0});let t=s.parse(e.sdp);t.media.forEach((e=>{"audio"===e.type&&"send"===this._direction&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),e.sdp=s.write(t),c.Logger.debug(b,"restartIce() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(e);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();c.Logger.debug(b,"restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,trackLow:t,encodings:r,codecOptions:n,codec:i,appData:o}){this._assertSendDirection(),c.Logger.debug(b,"send() [kind:%s, track.id:%s]",e.kind,e.id,r,o),r&&r.length>1&&r.forEach(((e,t)=>{e.rid="r"+t}));const a=u.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=m.reduceCodecs(a.codecs,i);let l={},f={};const h=new MediaStream;"audio"===o.mediaType&&this._pc.audioSender?(c.Logger.debug(b,"audioSender更新track: ",this._pc.audioSender.track,"=>",e),this._pc.audioSender.replaceTrack(e)):"video"===o.mediaType&&this._pc.videoSender?(c.Logger.debug(b,"videoSender更新track: ",this._pc.videoSender.track,"=>",e),this._pc.videoSender.replaceTrack(e),this._pc.videoSenderLow&&t&&(c.Logger.debug(b,"videoSenderLow更新track: ",this._pc.videoSenderLow),this._pc.videoSenderLow.replaceTrack(t))):"screenShare"===o.mediaType&&this._pc.screenSender?(c.Logger.debug(b,"screenSender更新track: ",this._pc.screenSender.track,"=>",e),this._pc.screenSender.replaceTrack(e),this._pc.screenSenderLow&&t&&(c.Logger.debug(b,"screenSenderLow更新track: ",this._pc.screenSenderLow),this._pc.screenSenderLow.replaceTrack(t))):(h.addTrack(e),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[h],sendEncodings:r}),t&&(f=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r})),"audio"!==o.mediaType||this._pc.audioSender?"video"!==o.mediaType||this._pc.videoSender?"screenShare"!==o.mediaType||this._pc.screenSender||(this._pc.screenSender=l.sender,this._pc.screenSenderLow=f.sender):(this._pc.videoSender=l.sender,this._pc.videoSenderLow=f.sender):this._pc.audioSender=l.sender),c.Logger.debug(b,"send() | [transceivers:%d]",this._pc.getTransceivers().length);let y,S,_,M=await this._pc.createOffer(),T=s.parse(M.sdp);const w=T.media.filter((r=>{const n=this._mapMidTransceiver.get(""+r.mid);return!(r.type!==e.kind||n&&n.sender&&n.sender.track&&(n.sender.track.id===e.id?(y=r,1):t&&n.sender.track.id===t.id&&(S=r,1)))}));if(y||(y=w.pop()),t&&!S&&(S=w.pop()),!y)throw new g.default({code:v.default.NOT_FOUND,message:"offerMediaObject with track id not found: "+e.id});this._transportReady||(_=await this._setupTransport({localDtlsRole:"server",localSdpObject:T}));let x=y.mid;if("number"==typeof x&&(x=""+x),!x)throw new g.default({code:v.default.NOT_FOUND,message:"No localId"});let I=null;if(S&&(I=""+S.mid),a.mid=x,c.Logger.debug(b,"要检查M行: ",y),a.rtcp.cname=d.getCname({offerMediaObject:y}),r)if(1===r.length){let e=p.getRtpEncodings({offerMediaObject:y});Object.assign(e[0],r[0]),a.encodings=e}else a.encodings=r;else a.encodings=[],S&&(a.encodings=a.encodings.concat(p.getRtpEncodings({offerMediaObject:S}))),a.encodings=a.encodings.concat(p.getRtpEncodings({offerMediaObject:y}));return a.encodings.length>1&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase())&&T.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),M.sdp=s.write(T),this._mapMidTransceiver.set(x,l),I&&this._mapMidTransceiver.set(I,f),{localId:x,localIdLow:I,rtpParameters:a,rtpSender:l.sender,rtpSenderLow:f.sender||null,dtlsParameters:_,offer:M}}async fillRemoteRecvSdp({kind:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,sendingRtpParameters:o,codecOptions:a,offer:l,audioProfile:d,codec:p}){c.Logger.debug(b,"fillRemoteRecvSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(l),this._remoteSdp||(this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._remoteSdp.updateDtlsRole("client"));const f=u.clone(this._sendingRemoteRtpParametersByKind[e]);f.codecs=m.reduceCodecs(f.codecs,p);let g=s.parse(this._pc.localDescription.sdp);const v=this._remoteSdp.getNextMediaSectionIdx();let S=g.media[v.idx],_=null;o.encodings&&o.encodings.length>1&&(_=g.media[v.idx+1]),this._remoteSdp.send({offerMediaObjectArr:[S,_],reuseMid:v.reuseMid,offerRtpParameters:o,answerRtpParameters:f,codecOptions:a,extmapAllowMixed:!0});const M={type:"answer",sdp:this._remoteSdp.getSdp()};if(c.Logger.debug(b,"audioProfile设置为: ",d),d){let e=null;switch(d){case"speech_low_quality":e="maxplaybackrate=16000;sprop-maxcapturerate=16000;maxaveragebitrate=32000";break;case"speech_standard":e="maxplaybackrate=32000;sprop-maxcapturerate=32000;maxaveragebitrate=36000";break;case"music_standard":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;";break;case"standard_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=56000";break;case"high_quality":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=128000";break;case"high_quality_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=192000"}M.sdp.indexOf("a=fmtp:111")&&(M.sdp=M.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;useinbandfec=1;"+e)),M.sdp=M.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=maxptime:60")}c.Logger.debug(b,"fillRemoteRecvSdp() | calling pc.setRemoteDescription() [answer]: ",M.sdp),y.getParameters().enableUdpCandidate||(M.sdp=M.sdp.replace(/\r\na=candidate:udpcandidate[^\r]+/g,"")),y.getParameters().enableTcpCandidate||(M.sdp=M.sdp.replace(/\r\na=candidate:tcpcandidate[^\r]+/g,"")),await this._pc.setRemoteDescription(M)}async stopSending(e,t){var r,n;this._assertSendDirection(),c.Logger.debug(b,"stopSending() [localId:%s]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});"audio"===t?this._pc.audioSender.replaceTrack(null):"video"===t?(this._pc.videoSender.replaceTrack(null),this._pc.videoSenderLow&&(null===(r=this._pc.videoSenderLow.track)||void 0===r||r.stop(),this._pc.videoSenderLow.replaceTrack(null))):"screenShare"===t?(this._pc.screenSender.replaceTrack(null),this._pc.screenSenderLow&&(null===(n=this._pc.screenSenderLow.track)||void 0===n||n.stop(),this._pc.screenSenderLow.replaceTrack(null))):i.sender.replaceTrack(null);const o=await this._pc.createOffer();let a=s.parse(o.sdp);a.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),o.sdp=s.write(a),c.Logger.debug(b,"stopSending() | calling pc.setLocalDescription()");try{await this._pc.setLocalDescription(o)}catch(e){c.Logger.debug(b,"setLocalDescription error = %o",e)}const u={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"stopSending() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async replaceTrack(e,t){this._assertSendDirection(),t?c.Logger.debug(b,"replaceTrack() [localId:%s, track.id:%s]",e,t.id):c.Logger.debug(b,"replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),c.Logger.debug(b,"setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),c.Logger.debug(b,"setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});return t.sender.getStats()}async recoverTransceiver(e,t,r){c.Logger.debug(b,"recoverTransceiver() [kind:%s, remoteUid:%s, mid: %s]",r,e,t);const n=this._mapMidTransceiver.get(t);n?n.isUseless=!0:c.Logger.debug(b,"recoverTransceiver() transceiver undefined")}async prepareLocalSdp(e,t){c.Logger.debug(b,"prepareLocalSdp() [kind:%s, remoteUid:%s]",e,t);let r=-1;for(const t of this._mapMidTransceiver.keys()){const n=this._mapMidTransceiver.get(t);if(!n)continue;const i=n.receiver&&n.receiver.track&&n.receiver.track.kind||e;if(c.Logger.debug(b,"prepareLocalSdp() transceiver M行信息 [mid: %s, mediaType: %s, isUseless: %s]",n.mid||t,i,n.isUseless),n.isUseless&&i===e){r=t-0,n.isUseless=!1;break}}let n=this._pc.localDescription,i=null;-1===r&&(c.Logger.debug(b,"prepareLocalSdp() 添加一个M行"),i=this._pc.addTransceiver(e,{direction:"recvonly"}),n=await this._pc.createOffer(),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),n.sdp.indexOf("a=fmtp:111")&&(n.sdp=n.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z-]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1")),c.Logger.debug(b,"prepareLocalSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(n));const o=s.parse(n.sdp);let a;this._transportReady||(a=await this._setupTransport({localDtlsRole:"server",localSdpObject:o}));const u=d.extractRtpCapabilities({sdpObject:o});return-1===r&&(r=o.media.length-1,this._mapMidTransceiver.set(""+r,i)),{dtlsParameters:a,rtpCapabilities:u,offer:n,mid:r,iceUfragReg:""}}async receive({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,trackId:i,kind:o,rtpParameters:a,offer:u,probeSSrc:l=-1,remoteUid:d,extendedRtpCapabilities:p}){this._assertRecvDirection(),c.Logger.debug(b,"receive() [trackId: %s, kind: %s, remoteUid: %s]",i,o,d),this._remoteSdp||(this._remoteSdp=new h.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n}),this._remoteSdp.updateDtlsRole("client"));const f=a.mid;if(c.Logger.debug(b,"处理对端的M行 mid: ",f),!f)throw new g.default({code:v.default.NOT_FOUND,message:"No localId"});const m=this._pc.getTransceivers().length,S=this._remoteSdp._mediaSections.length+1;if(c.Logger.debug(b,`offerMediaSessionLength: ${m}，answerMediaSessionLength: ${S}`),m<S);else if(m>S){c.Logger.debug(b,"mediaSession 不匹配, 兼容处理");const e=[];s.parse(u.sdp).media.forEach((t=>{let r=!1;this._remoteSdp._mediaSections.forEach((e=>{t.mid!=e.mid||(r=!0)})),r||e.push({mid:t.mid,kind:t.type})})),c.Logger.debug(b,"receive() 检索出来了缺失的media Session: ",e),e.forEach((e=>{const t=[];p.codecs.forEach((r=>{if(r.kind===e.kind){const e=Object.assign({},r);e.parameters=e.parameters||e.localParameters,e.payloadType=e.payloadType||e.localPayloadType,t.push(e)}}));const r={mid:""+e.mid,kind:e.kind,offerRtpParameters:{codecs:t,encodings:[{ssrc:0}],headerExtensions:[],rtcp:{},mid:""+e.mid}};this._remoteSdp.receive(r),this._remoteSdp.disableMediaSection(""+e.mid)}))}u.sdp=u.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),u.sdp.indexOf("a=fmtp:111")&&(u.sdp=u.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1")),this._remoteSdp.receive({mid:f,kind:o,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:i,reuseMid:null});const _={type:"answer",sdp:this._remoteSdp.getSdp()};_.sdp.indexOf("a=fmtp:111")&&(_.sdp=_.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1")),c.Logger.debug(b,"receive() | calling pc.setRemoteDescription() [answer]: ",_.sdp),"stable"===this._pc.signalingState&&(await this._pc.setLocalDescription(u),c.Logger.debug(b,"receive() | calling pc.setLocalDescription()")),y.getParameters().enableUdpCandidate||(_.sdp=_.sdp.replace(/\r\na=candidate:udpcandidate[^\r]+/g,"")),y.getParameters().enableTcpCandidate||(_.sdp=_.sdp.replace(/\r\na=candidate:tcpcandidate[^\r]+/g,"")),await this._pc.setRemoteDescription(_);const M=this._pc.getTransceivers().find((e=>e.mid===f));if(!M)throw new g.default({code:v.default.NOT_FOUND,message:"new RTCRtpTransceiver not found"});return this._mapMidTransceiver.set(f,M),{localId:f,track:M.receiver.track,rtpReceiver:M.receiver}}async stopReceiving(e){this._assertRecvDirection(),c.Logger.debug(b,"stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t||!t.mid)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});t.receiver&&t.receiver.track&&t.receiver.track&&"audio"===t.receiver.track.kind||(t.isUseless=!0),this._remoteSdp.disableMediaSection(t.mid);const r=this._pc.localDescription;c.Logger.debug(b,"stopReceiving() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"stopReceiving() | calling pc.setRemoteDescription() [answer:%s]",n.sdp),await this._pc.setRemoteDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});return t.receiver.getStats()}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});return r.role=e,this._transportReady=!0,r}_assertSendDirection(){if("send"!==this._direction)throw new g.default({code:v.default.INVALID_OPERATION,message:'method can just be called for handlers with "send" direction'})}_assertRecvDirection(){if("recv"!==this._direction)throw new g.default({code:v.default.INVALID_OPERATION,message:'method can just be called for handlers with "recv" direction'})}}t.Chrome74=M},function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=n(e[o+1]))}(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=r(128),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach((function(e){var t=e[0],a=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return i(c,n,a)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){var n=r(128),i=/%[sdv%]/g,o=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},a=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return o.apply(null,n)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||s,i=t.innerOrder||c,o=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(a(t,r,e))}))}))})),e.media.forEach((function(e){o.push(a("m",n.m[0],e)),i.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(a(t,r,e))}))}))}))})),o.join("\r\n")+"\r\n"}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;const a=o(r(23));class s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:n=!1}){if(this._mediaObject={},this._planB=n,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}function c(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.MediaSection=s,t.AnswerMediaSection=class extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:o=!1,offerMediaObject:s,offerRtpParameters:u,answerRtpParameters:l,codecOptions:d,extmapAllowMixed:p=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:o}),this._mediaObject.mid=String(s.mid),this._mediaObject.type=s.type,this._mediaObject.protocol=s.protocol,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),s.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of l.codecs){const t={payload:e.payloadType,codec:c(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=a.clone(e.parameters,{});if(d){const{opusStereo:t,opusFec:n,opusDtx:i,opusMaxPlaybackRate:o,opusPtime:a,videoGoogleStartBitrate:s,videoGoogleMaxBitrate:c,videoGoogleMinBitrate:l}=d,p=u.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==t&&(p.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==n&&(p.parameters.useinbandfec=n?1:0,r.useinbandfec=n?1:0),void 0!==i&&(p.parameters.usedtx=i?1:0,r.usedtx=i?1:0),void 0!==o&&(r.maxplaybackrate=o),void 0!==a&&(p.parameters.ptime=a,r.ptime=a);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==s&&(r["x-google-start-bitrate"]=s),void 0!==c&&(r["x-google-max-bitrate"]=c),void 0!==l&&(r["x-google-min-bitrate"]=l)}}const n={payload:e.payloadType,config:""};for(const e of Object.keys(r))n.config&&(n.config+=";"),n.config+=`${e}=${r[e]}`;n.config&&this._mediaObject.fmtp.push(n);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=l.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of l.headerExtensions)(s.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id});if(p&&"extmap-allow-mixed"===s.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),s.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:s.simulcast.list1},this._mediaObject.rids=[];for(const e of s.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(s.simulcast_03){this._mediaObject.simulcast_03={value:s.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of s.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof s.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize):s.sctpmap&&(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}},t.OfferMediaSection=class extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:o=!1,mid:a,kind:s,offerRtpParameters:u,streamId:l,trackId:d,oldDataChannelSpec:p=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:o}),this._mediaObject.mid=String(a),this._mediaObject.type=s,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=n?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),s){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${l||"-"} ${d}`);for(const e of u.codecs){const t={payload:e.payloadType||e.localPayloadType||125,codec:c(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType||e.localPayloadType||125,config:""},n=e.parameters||e.localParameters||{};for(const e of Object.keys(n))r.config&&(r.config+=";"),r.config+=`${e}=${n[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=u.codecs.map((e=>e.payloadType||e.localPayloadType||125)).join(" "),this._mediaObject.ext=[];for(const e of u.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=u.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],u.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:u.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${l||"-"} ${d}`}),r&&(u.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:u.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${l||"-"} ${d}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":p?(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize)}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const n=e.encodings[0],i=n.ssrc,o=n.rtx&&n.rtx.ssrc?n.rtx.ssrc:void 0;e.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${t||"-"} ${r}`}),o&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${i} ${o}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==n)),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${n}`)))}}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;const s=o(r(42)),c=r(7),u=o(r(23)),l=o(r(41)),d=o(r(76)),p=o(r(77)),f=r(53),h=r(78),m=r(17),g=a(r(1)),v=a(r(0)),y="Firefox60",b={OS:1024,MIS:1024};class S extends f.HandlerInterface{constructor(){super(),this._sendingRemoteRtpParametersByKind={},this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._transportReady=!1,this._appData={}}static createFactory(){return()=>new S}get name(){return"Firefox60"}close(){if(c.Logger.debug(y,"close()"),this._pc)try{this._pc.onconnectionstatechange=null,this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){c.Logger.debug(y,"getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();t.sdp=t.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack");try{e.close()}catch(e){}const r=s.parse(t.sdp);return d.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return c.Logger.debug(y,"getNativeSctpCapabilities()"),{numStreams:b}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:a,additionalSettings:s,proprietaryConstraints:u,extendedRtpCapabilities:d,appData:p}){c.Logger.debug(y,"run()",p),this._appData=p,this._direction=e,this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},c.Logger.debug(y,"iceServers: %o",o);const f={iceServers:o||[],iceTransportPolicy:a||"all",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"};p.encodedInsertableStreams&&(f.encodedInsertableStreams=!0),this._pc=new RTCPeerConnection(f,u),this._pc.onconnectionstatechange=()=>{switch(this._pc.connectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}},this._pc.onicecandidate=e=>{},this._pc.onicecandidateerror=e=>{console.error("地址收集失败: ",e)}}async updateIceServers(e){c.Logger.debug(y,"updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(c.Logger.debug(y,"restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if(this._direction){const e=await this._pc.createOffer({iceRestart:!0});e.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(e.sdp=e.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-_\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#${this._direction}`));let t=s.parse(e.sdp);t.media.forEach((e=>{"audio"===e.type&&"send"===this._direction&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),e.sdp=s.write(t),c.Logger.debug(y,"restartIce() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(e);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(y,"restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(y,"restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();c.Logger.debug(y,"restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,trackLow:t,encodings:r,codecOptions:n,codec:i,appData:o}){this._assertSendDirection(),c.Logger.debug(y,"send() [kind:%s, track.id:%s]",e.kind,e.id,r,o),r&&r.length>1&&r.forEach(((e,t)=>{e.rid="r"+t}));const a=u.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=m.reduceCodecs(a.codecs,i);let l={},f={};const h=new MediaStream;"audio"===o.mediaType&&this._pc.audioSender?(c.Logger.debug(y,"audioSender更新track: ",this._pc.audioSender),this._pc.audioSender.replaceTrack(e)):"video"===o.mediaType&&this._pc.videoSender?(c.Logger.debug(y,"videoSender更新track: ",this._pc.videoSender),this._pc.videoSender.replaceTrack(e),this._pc.videoSenderLow&&t&&(c.Logger.debug(y,"videoSenderLow更新track: ",this._pc.videoSenderLow),this._pc.videoSenderLow.replaceTrack(t))):"screenShare"===o.mediaType&&this._pc.screenSender?(c.Logger.debug(y,"screenSender更新track: ",this._pc.screenSender),this._pc.screenSender.replaceTrack(e),this._pc.screenSenderLow&&t&&(c.Logger.debug(y,"screenSenderLow更新track: ",this._pc.screenSenderLow),this._pc.screenSenderLow.replaceTrack(t))):(h.addTrack(e),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[h],sendEncodings:r}),t&&(f=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r})),"audio"!==o.mediaType||this._pc.audioSender?"video"!==o.mediaType||this._pc.videoSender?"screenShare"!==o.mediaType||this._pc.screenSender||(this._pc.screenSender=l.sender,this._pc.screenSenderLow=f.sender):(this._pc.videoSender=l.sender,this._pc.videoSenderLow=f.sender):this._pc.audioSender=l.sender),c.Logger.debug(y,"send() | [transceivers:%d]",this._pc.getTransceivers().length);let b=await this._pc.createOffer();b.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(b.sdp=b.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-_\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#send`));let S,_,M,T=s.parse(b.sdp);const w=T.media.filter((r=>{const n=this._mapMidTransceiver.get(""+r.mid);return!(r.type!==e.kind||n&&n.sender&&n.sender.track&&(n.sender.track.id===e.id?(S=r,1):t&&n.sender.track.id===t.id&&(_=r,1)))}));if(S||(S=w.pop()),t&&!_&&(_=w.pop()),!S)throw new g.default({code:v.default.NOT_FOUND,message:"offerMediaObject with track id not found: "+e.id});this._transportReady||(M=await this._setupTransport({localDtlsRole:"server",localSdpObject:T}));let x=S.mid;if("number"==typeof x&&(x=""+x),!x)throw new g.default({code:v.default.NOT_FOUND,message:"No localId"});let I=null;if(_&&(I=""+_.mid),a.mid=x,c.Logger.debug(y,"要检查M行: ",S),a.rtcp.cname=d.getCname({offerMediaObject:S}),r)if(1===r.length){let e=p.getRtpEncodings({offerMediaObject:S});Object.assign(e[0],r[0]),a.encodings=e}else a.encodings=r;else a.encodings=[],_&&(a.encodings=a.encodings.concat(p.getRtpEncodings({offerMediaObject:_}))),a.encodings=a.encodings.concat(p.getRtpEncodings({offerMediaObject:S}));return a.encodings.length>1&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase())&&T.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),b.sdp=s.write(T),this._mapMidTransceiver.set(x,l),I&&this._mapMidTransceiver.set(I,f),{localId:x,localIdLow:I,rtpParameters:a,rtpSender:l.sender,rtpSenderLow:f.sender||null,dtlsParameters:M,offer:b}}async fillRemoteRecvSdp({kind:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,sendingRtpParameters:o,codecOptions:a,offer:l,audioProfile:d,codec:p}){c.Logger.debug(y,"fillRemoteRecvSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(l),this._remoteSdp||(this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._remoteSdp.updateDtlsRole("client"));const f=u.clone(this._sendingRemoteRtpParametersByKind[e]);f.codecs=m.reduceCodecs(f.codecs,p);let g=s.parse(this._pc.localDescription.sdp);const v=this._remoteSdp.getNextMediaSectionIdx();let b=g.media[v.idx],S=null;o.encodings&&o.encodings.length>1&&(S=g.media[v.idx+1]),this._remoteSdp.send({offerMediaObjectArr:[b,S],reuseMid:v.reuseMid,offerRtpParameters:o,answerRtpParameters:f,codecOptions:a,extmapAllowMixed:!0});const _={type:"answer",sdp:this._remoteSdp.getSdp()};if(c.Logger.debug(y,"audioProfile设置为: ",d),d){let e=null;switch(d){case"speech_low_quality":e="maxplaybackrate=16000;sprop-maxcapturerate=16000;maxaveragebitrate=32000";break;case"speech_standard":e="maxplaybackrate=32000;sprop-maxcapturerate=32000;maxaveragebitrate=36000";break;case"music_standard":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;";break;case"standard_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=56000";break;case"high_quality":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=128000";break;case"high_quality_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=192000"}_.sdp.indexOf("a=fmtp:111")&&(_.sdp=_.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;useinbandfec=1;"+e)),_.sdp=_.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=maxptime:60")}c.Logger.debug(y,"fillRemoteRecvSdp() | calling pc.setRemoteDescription() [answer]: ",_.sdp),await this._pc.setRemoteDescription(_)}async stopSending(e,t){var r,n;this._assertSendDirection(),c.Logger.debug(y,"stopSending() [localId:%s]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});"audio"===t?this._pc.audioSender.replaceTrack(null):"video"===t?(this._pc.videoSender.replaceTrack(null),this._pc.videoSenderLow&&(null===(r=this._pc.videoSenderLow.track)||void 0===r||r.stop(),this._pc.videoSenderLow.replaceTrack(null))):"screenShare"===t?(this._pc.screenSender.replaceTrack(null),this._pc.screenSenderLow&&(null===(n=this._pc.screenSenderLow.track)||void 0===n||n.stop(),this._pc.screenSenderLow.replaceTrack(null))):i.sender.replaceTrack(null);const o=await this._pc.createOffer();o.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(o.sdp=o.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#send`));let a=s.parse(o.sdp);a.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),o.sdp=s.write(a),c.Logger.debug(y,"stopSending() | calling pc.setLocalDescription()");try{await this._pc.setLocalDescription(o)}catch(e){c.Logger.debug(y,"setLocalDescription error = %o",e)}const u={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(y,"stopSending() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async replaceTrack(e,t){this._assertSendDirection(),t?c.Logger.debug(y,"replaceTrack() [localId:%s, track.id:%s]",e,t.id):c.Logger.debug(y,"replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),c.Logger.debug(y,"setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),c.Logger.debug(y,"setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});return t.sender.getStats()}async recoverTransceiver(e,t,r){c.Logger.debug(y,"recoverTransceiver() [kind:%s, remoteUid:%s, mid: %s]",r,e,t);const n=this._mapMidTransceiver.get(t);n?n.isUseless=!0:c.Logger.debug(y,"recoverTransceiver() transceiver undefined")}async prepareLocalSdp(e,t){c.Logger.debug(y,"prepareLocalSdp() [kind:%s, remoteUid:%s]",e,t);let r=-1;for(const t of this._mapMidTransceiver.keys()){const n=this._mapMidTransceiver.get(t);if(!n)continue;const i=n.receiver&&n.receiver.track&&n.receiver.track.kind||e;if(c.Logger.debug(y,"prepareLocalSdp() transceiver M行信息 [mid: %s, mediaType: %s, isUseless: %s]",n.mid||t,i,n.isUseless),n.isUseless&&i===e){r=t-0,n.isUseless=!1;break}}let n=this._pc.localDescription,i=null;-1===r&&(c.Logger.debug(y,"prepareLocalSdp() 添加一个M行"),i=this._pc.addTransceiver(e,{direction:"recvonly"}),n=await this._pc.createOffer(),n.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(n.sdp=n.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-_\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#recv`),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack")),c.Logger.debug(y,"prepareLocalSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(n));const o=s.parse(n.sdp);let a;this._transportReady||(a=await this._setupTransport({localDtlsRole:"server",localSdpObject:o}));const u=d.extractRtpCapabilities({sdpObject:o});return-1===r&&(r=o.media.length-1,this._mapMidTransceiver.set(""+r,i)),{dtlsParameters:a,rtpCapabilities:u,offer:n,mid:r,iceUfragReg:""}}async receive({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,trackId:i,kind:o,rtpParameters:a,offer:u,probeSSrc:l=-1,remoteUid:d,extendedRtpCapabilities:p}){this._assertRecvDirection(),c.Logger.debug(y,"receive() [trackId: %s, kind: %s, remoteUid: %s]",i,o,d),this._remoteSdp||(this._remoteSdp=new h.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n}),this._remoteSdp.updateDtlsRole("client"));const f=a.mid;if(c.Logger.debug(y,"处理对端的M行 mid: ",f),!f)throw new g.default({code:v.default.NOT_FOUND,message:"No localId"});const m=this._pc.getTransceivers().length,b=this._remoteSdp._mediaSections.length+1;if(c.Logger.debug(y,`offerMediaSessionLength: ${m}，answerMediaSessionLength: ${b}`),m<b);else if(m>b){c.Logger.debug(y,"mediaSession 不匹配, 兼容处理");const e=[];s.parse(u.sdp).media.forEach((t=>{let r=!1;this._remoteSdp._mediaSections.forEach((e=>{t.mid!=e.mid||(r=!0)})),r||e.push({mid:t.mid,kind:t.type})})),c.Logger.debug(y,"receive() 检索出来了缺失的media Session: ",e),e.forEach((e=>{const t=[];p.codecs.forEach((r=>{if(r.kind===e.kind){const e=Object.assign({},r);e.parameters=e.parameters||e.localParameters,e.payloadType=e.payloadType||e.localPayloadType,t.push(e)}}));const r={mid:""+e.mid,kind:e.kind,offerRtpParameters:{codecs:t,encodings:[{ssrc:0}],headerExtensions:[],rtcp:{},mid:""+e.mid}};this._remoteSdp.receive(r),this._remoteSdp.disableMediaSection(""+e.mid)}))}u.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(u.sdp=u.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-_\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#recv`),u.sdp=u.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack")),this._remoteSdp.receive({mid:f,kind:o,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:i,reuseMid:null});const S={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(y,"receive() | calling pc.setRemoteDescription() [answer]: ",S.sdp),"stable"===this._pc.signalingState&&(await this._pc.createOffer(),await this._pc.setLocalDescription(u),c.Logger.debug(y,"receive() | calling pc.setLocalDescription()")),await this._pc.setRemoteDescription(S);const _=this._pc.getTransceivers().find((e=>e.mid===f));if(!_)throw new g.default({code:v.default.NOT_FOUND,message:"new RTCRtpTransceiver not found"});return this._mapMidTransceiver.set(f,_),{localId:f,track:_.receiver.track,rtpReceiver:_.receiver}}async stopReceiving(e){this._assertRecvDirection(),c.Logger.debug(y,"stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t||!t.mid)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});t.receiver&&t.receiver.track&&t.receiver.track&&"audio"===t.receiver.track.kind||(t.isUseless=!0),this._remoteSdp.disableMediaSection(t.mid);const r=this._pc.localDescription;r.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(r.sdp=r.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-_\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#recv`)),c.Logger.debug(y,"stopReceiving() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(y,"stopReceiving() | calling pc.setRemoteDescription() [answer:%s]",n.sdp),await this._pc.setRemoteDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});return t.receiver.getStats()}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});return r.role=e,this._transportReady=!0,r}_assertSendDirection(){if("send"!==this._direction)throw new g.default({code:v.default.INVALID_OPERATION,message:'method can just be called for handlers with "send" direction'})}_assertRecvDirection(){if("recv"!==this._direction)throw new g.default({code:v.default.INVALID_OPERATION,message:'method can just be called for handlers with "recv" direction'})}}t.Firefox60=S},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;const s=o(r(42)),c=r(7),u=o(r(23)),l=o(r(41)),d=o(r(76)),p=o(r(77)),f=r(53),h=r(78),m=r(17),g=a(r(1)),v=a(r(0)),y=r(224),b="Safari12",S={OS:1024,MIS:1024};let _=0;class M extends f.HandlerInterface{constructor(){super(),this._sendingRemoteRtpParametersByKind={},this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._transportReady=!1,this._appData={}}static createFactory(){return()=>new M}get name(){return"Safari12"}close(){if(c.Logger.debug(b,"close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){c.Logger.debug(b,"getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();t.sdp=t.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack");try{e.close()}catch(e){}const r=s.parse(t.sdp);return d.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return c.Logger.debug(b,"getNativeSctpCapabilities()"),{numStreams:S}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:a,additionalSettings:s,proprietaryConstraints:u,extendedRtpCapabilities:d,appData:p}){c.Logger.debug(b,"run()"),this._direction=e,this._appData=p,this._sendingRtpParametersByKind={audio:l.getSendingRtpParameters("audio",d),video:l.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:l.getSendingRemoteRtpParameters("audio",d),video:l.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection(Object.assign({iceServers:o||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},s),u),this._pc.pcid=_++,this._pc.onconnectionstatechange=()=>{switch(this._pc.connectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}}async updateIceServers(e){c.Logger.debug(b,"updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(c.Logger.debug(b,"restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if(this._direction){const e=await this._pc.createOffer({iceRestart:!0});let t=s.parse(e.sdp);t.media.forEach((e=>{"audio"===e.type&&"send"===this._direction&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),e.sdp=s.write(t),c.Logger.debug(b,"restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const r={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();c.Logger.debug(b,"restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,trackLow:t,encodings:r,codecOptions:n,codec:i,appData:o}){this._assertSendDirection(),c.Logger.debug(b,"send() [kind:%s, track.id:%s]",e.kind,e.id,r,o);const a=u.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=m.reduceCodecs(a.codecs,i);let l={},f={};const h=new MediaStream;"audio"===o.mediaType&&this._pc.audioSender?(c.Logger.warn(b,"audioSender更新track: ",this._pc.audioSender.track,"=>",e),this._pc.audioSender.replaceTrack(e)):"video"===o.mediaType&&this._pc.videoSender?(c.Logger.warn(b,"videoSender更新track: ",this._pc.videoSender.track,"=>",e),this._pc.videoSender.replaceTrack(e),this._pc.videoSenderLow&&t&&(c.Logger.debug(b,"videoSenderLow更新track: ",this._pc.videoSenderLow),this._pc.videoSenderLow.replaceTrack(t))):"screenShare"===o.mediaType&&this._pc.screenSender?(c.Logger.warn(b,"screenSender更新track: ",this._pc.screenSender.track,"=>",e),this._pc.screenSender.replaceTrack(e),this._pc.screenSenderLow&&t&&(c.Logger.debug(b,"screenSenderLow更新track: ",this._pc.screenSenderLow),this._pc.screenSenderLow.replaceTrack(t))):(h.addTrack(e),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[h],sendEncodings:r}),t&&(f=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r})),"audio"!==o.mediaType||this._pc.audioSender?"video"!==o.mediaType||this._pc.videoSender?"screenShare"!==o.mediaType||this._pc.screenSender||(this._pc.screenSender=l.sender,this._pc.screenSenderLow=f.sender):(this._pc.videoSender=l.sender,this._pc.videoSenderLow=f.sender):this._pc.audioSender=l.sender),"audio"!==o.mediaType||this._pc.audioSender?"video"!==o.mediaType||this._pc.videoSender?"screenShare"!==o.mediaType||this._pc.screenSender||(this._pc.screenSender=l.sender):this._pc.videoSender=l.sender:this._pc.audioSender=l.sender,c.Logger.debug(b,"send() | [transceivers:%d]",this._pc.getTransceivers().length);let y,S,_,M=await this._pc.createOffer(),T=s.parse(M.sdp);const w=T.media.filter((r=>{const n=this._mapMidTransceiver.get(""+r.mid);return!(r.type!==e.kind||n&&n.sender&&n.sender.track&&(n.sender.track.id===e.id?(y=r,1):t&&n.sender.track.id===t.id&&(S=r,1)))}));if(y||(y=w.pop()),t&&!S&&(S=w.pop()),!y)throw new g.default({code:v.default.NOT_FOUND,message:"offerMediaObject with track id not found: "+e.id});this._transportReady||(_=await this._setupTransport({localDtlsRole:"server",localSdpObject:T}));let x=y.mid;if("number"==typeof x&&(x=""+x),!x)throw new g.default({code:v.default.NOT_FOUND,message:"No localId"});let I=null;if(S&&(I=""+S.mid),a.mid=x,c.Logger.debug(b,"要检查M行: ",y),a.rtcp.cname=d.getCname({offerMediaObject:y}),r)if(1===r.length){let e=p.getRtpEncodings({offerMediaObject:y});Object.assign(e[0],r[0]),a.encodings=e}else a.encodings=r;else a.encodings=[],S&&(a.encodings=a.encodings.concat(p.getRtpEncodings({offerMediaObject:S}))),a.encodings=a.encodings.concat(p.getRtpEncodings({offerMediaObject:y}));return a.encodings.length>1&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase())&&T.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),M.sdp=s.write(T),this._mapMidTransceiver.set(x,l),I&&this._mapMidTransceiver.set(I,f),{localId:x,localIdLow:I,rtpParameters:a,rtpSender:l.sender,rtpSenderLow:f.sender||null,dtlsParameters:_,offer:M}}async fillRemoteRecvSdp({kind:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,sendingRtpParameters:o,codecOptions:a,offer:l,audioProfile:d,codec:p}){let f=s.parse(l.sdp);f.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),l.sdp=s.write(f),c.Logger.debug(b,"fillRemoteRecvSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(l),this._remoteSdp||(this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._remoteSdp.updateDtlsRole("client"));const g=u.clone(this._sendingRemoteRtpParametersByKind[e]);g.codecs=m.reduceCodecs(g.codecs,p);let v=s.parse(this._pc.localDescription.sdp);const S=this._remoteSdp.getNextMediaSectionIdx();let _=v.media[S.idx],M=null;o.encodings&&o.encodings.length>1&&(M=v.media[S.idx+1]),this._remoteSdp.send({offerMediaObjectArr:[_,M],reuseMid:S.reuseMid,offerRtpParameters:o,answerRtpParameters:g,codecOptions:a,extmapAllowMixed:!0});const T={type:"answer",sdp:this._remoteSdp.getSdp()};if(c.Logger.debug(b,"audioProfile设置为: ",d),d){let e=null;switch(d){case"speech_low_quality":e="maxplaybackrate=16000;sprop-maxcapturerate=16000;maxaveragebitrate=32000";break;case"speech_standard":e="maxplaybackrate=32000;sprop-maxcapturerate=32000;maxaveragebitrate=36000";break;case"music_standard":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;";break;case"standard_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=56000";break;case"high_quality":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=128000";break;case"high_quality_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=192000"}T.sdp.indexOf("a=fmtp:111")&&(T.sdp=T.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;useinbandfec=1;"+e)),T.sdp=T.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=maxptime:60")}y.canShimVideoOrientation(l,T)&&y.shimVideoOrientation(l,T),c.Logger.debug(b,"fillRemoteRecvSdp() | calling pc.setRemoteDescription() [answer:%o]",T.sdp),await this._pc.setRemoteDescription(T)}async stopSending(e,t){var r,n;this._assertSendDirection(),c.Logger.debug(b,"stopSending() [localId:%s]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});"audio"===t?(this._pc.audioSender.replaceTrack(null),c.Logger.debug(b,"删除发送的audio track: ",this._pc.audioSender)):"video"===t?(this._pc.videoSenderLow&&(null===(r=this._pc.videoSenderLow.track)||void 0===r||r.stop(),this._pc.videoSenderLow.replaceTrack(null)),this._pc.videoSender.replaceTrack(null),c.Logger.debug(b,"删除发送的video track: ",this._pc.videoSender)):"screenShare"===t?(this._pc.screenSender.replaceTrack(null),this._pc.screenSenderLow&&(null===(n=this._pc.screenSenderLow.track)||void 0===n||n.stop(),this._pc.screenSenderLow.replaceTrack(null)),c.Logger.debug(b,"删除发送的screen track: ",this._pc.screenSender)):i.sender.replaceTrack(null);const o=await this._pc.createOffer();let a=s.parse(o.sdp);a.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),o.sdp=s.write(a),c.Logger.debug(b,"stopSending() | calling pc.setLocalDescription() [offer:%o]",o.sdp),await this._pc.setLocalDescription(o);const u={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"stopSending() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async replaceTrack(e,t){this._assertSendDirection(),t?c.Logger.debug(b,"replaceTrack() [localId:%s, track.id:%s]",e,t.id):c.Logger.debug(b,"replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),c.Logger.debug(b,"setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),c.Logger.debug(b,"setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});return t.sender.getStats()}async recoverTransceiver(e,t,r){c.Logger.debug(b,"recoverTransceiver() [kind:%s, remoteUid:%s, mid: %s]",r,e,t);const n=this._mapMidTransceiver.get(t);n?n.isUseless=!0:c.Logger.debug(b,"recoverTransceiver() transceiver undefined")}async prepareLocalSdp(e,t){c.Logger.debug(b,"prepareLocalSdp() [kind:%s, remoteUid:%s]",e,t);let r=-1;for(const t of this._mapMidTransceiver.keys()){const n=this._mapMidTransceiver.get(t);if(!n)continue;const i=n.receiver&&n.receiver.track&&n.receiver.track.kind||e;if(c.Logger.debug(b,"prepareLocalSdp() transceiver M行信息 [mid: %s, mediaType: %s, isUseless: %s]",n.mid||t,i,n.isUseless),n.isUseless&&i===e){r=t-0,n.isUseless=!1;break}}let n=this._pc.localDescription,i=null;-1===r&&(c.Logger.debug(b,"prepareLocalSdp() 添加一个M行"),i=this._pc.addTransceiver(e,{direction:"recvonly"}),n=await this._pc.createOffer(),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),c.Logger.debug(b,"prepareLocalSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(n));const o=s.parse(n.sdp);let a;this._transportReady||(a=await this._setupTransport({localDtlsRole:"server",localSdpObject:o}));const u=d.extractRtpCapabilities({sdpObject:o});return-1===r&&(r=o.media.length-1,this._mapMidTransceiver.set(""+r,i)),{dtlsParameters:a,rtpCapabilities:u,offer:n,mid:r,iceUfragReg:""}}async receive({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,trackId:i,kind:o,rtpParameters:a,offer:u,probeSSrc:l=-1,remoteUid:d,extendedRtpCapabilities:p}){if(this._assertRecvDirection(),!a.mid)throw new g.default({code:v.default.NOT_FOUND,message:"No rtpParameters.mid"});c.Logger.debug(b,"receive() [trackId: %s, kind: %s, remoteUid: %s]",i,o,d),this._remoteSdp||(this._remoteSdp=new h.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n}),this._remoteSdp.updateDtlsRole("client"));const f=a.mid;c.Logger.debug(b,"处理对端的M行 mid: ",f);const m=this._pc.getTransceivers().length,y=this._remoteSdp._mediaSections.length+1;if(c.Logger.debug(b,`offerMediaSessionLength: ${m}，answerMediaSessionLength: ${y}`),m<y);else if(m>y){c.Logger.debug(b,"mediaSession 不匹配, 兼容处理");const e=[];s.parse(u.sdp).media.forEach((t=>{let r=!1;this._remoteSdp._mediaSections.forEach((e=>{t.mid!=e.mid||(r=!0)})),r||e.push({mid:t.mid,kind:t.type})})),c.Logger.debug(b,"receive() 检索出来了缺失的media Session: ",e),e.forEach((e=>{const t=[];p.codecs.forEach((r=>{if(r.kind===e.kind){const e=Object.assign({},r);e.parameters=e.parameters||e.localParameters,e.payloadType=e.payloadType||e.localPayloadType,t.push(e)}}));const r={mid:""+e.mid,kind:e.kind,offerRtpParameters:{codecs:t,encodings:[{ssrc:0}],headerExtensions:[],rtcp:{},mid:""+e.mid}};this._remoteSdp.receive(r),this._remoteSdp.disableMediaSection(""+e.mid)}))}u.sdp=u.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),this._remoteSdp.receive({mid:a.mid,kind:o,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:i});const S={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"receive() | calling pc.setRemoteDescription() [answer]: ",S.sdp),"stable"===this._pc.signalingState&&(await this._pc.setLocalDescription(u),c.Logger.debug(b,"receive() | calling pc.setLocalDescription()")),await this._pc.setRemoteDescription(S);const _=this._pc.getTransceivers().find((e=>e.mid===f));if(!_)throw new g.default({code:v.default.NOT_FOUND,message:"new RTCRtpTransceiver not found"});return this._mapMidTransceiver.set(f,_),{localId:f,track:_.receiver.track,rtpReceiver:_.receiver}}async stopReceiving(e){this._assertRecvDirection(),c.Logger.debug(b,"stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t||!t.mid)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});c.Logger.debug(b,"transceiver: ",t),t.receiver&&t.receiver.track&&t.receiver.track&&"audio"===t.receiver.track.kind||(t.isUseless=!0),this._remoteSdp.disableMediaSection(t.mid);const r=this._pc.localDescription;c.Logger.debug(b,"stopReceiving() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};c.Logger.debug(b,"stopReceiving() | calling pc.setRemoteDescription() [answer:%o]",n.sdp),await this._pc.setRemoteDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new g.default({code:v.default.NOT_FOUND,message:"associated RTCRtpTransceiver not found"});return t.receiver.getStats()}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});return r.role=e,this._transportReady=!0,r}_assertSendDirection(){if("send"!==this._direction)throw new g.default({code:v.default.INVALID_OPERATION,message:'method can just be called for handlers with "send" direction'})}_assertRecvDirection(){if("recv"!==this._direction)throw new g.default({code:v.default.INVALID_OPERATION,message:'method can just be called for handlers with "recv" direction'})}}t.Safari12=M},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.shimVideoOrientation=t.canShimVideoOrientation=void 0;const n=r(16),i=r(2),o="a=extmap:4 ";t.canShimVideoOrientation=function(e,t){var r,a,s;if("never"===i.getParameters().shimVideoOrientation)return!1;if("ios151"===i.getParameters().shimVideoOrientation){if(!n.RtcSystem.ios())return!1;if("safari"===(null===(r=n.RtcSystem.browser)||void 0===r?void 0:r.ua)){if(parseFloat(null===(a=n.RtcSystem.browser)||void 0===a?void 0:a.UIVersion)<15.1)return!1}else{if("weixin"!==(null===(s=n.RtcSystem.browser)||void 0===s?void 0:s.ua))return!1;if(!navigator.userAgent.match(/OS 15_[1-9]/))return!1}}if(-1===t.sdp.indexOf("H264")||-1===t.sdp.indexOf("m=video"))return!1;const c=e.sdp.match(/\r\n(.*3gpp\:video-orientation.*)\r\n/);return!!(c&&e.sdp.indexOf(o)>-1&&-1===t.sdp.indexOf(c[1]))},t.shimVideoOrientation=function(e,t){var r;if(-1===t.sdp.indexOf("H264")||-1===t.sdp.indexOf("m=video"))return;const i=e.sdp.match(/\r\n(.*3gpp\:video-orientation.*)\r\n/);if(i&&e.sdp.indexOf(o)>-1&&-1===t.sdp.indexOf(i[1])){const e=i[1];console.log(`shimVideoOrientation for ${n.RtcSystem.browser.ua} ${null===(r=n.RtcSystem.browser)||void 0===r?void 0:r.UIVersion} ${e}`),t.sdp=t.sdp.split(o).join(e+"\r\n"+o)}else console.error("Failed to shimVideoOrientation",i,e.sdp.indexOf(o),i&&t.sdp.indexOf(i[1]))}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(123),t),i(r(125),t),i(r(126),t),i(r(127),t),i(r(226),t),i(r(227),t),i(r(53),t),i(r(40),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;const n=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){const t=n.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.waitForEvent=void 0,t.waitForEvent=async function(e,t,r){return new Promise(((n,i)=>{let o;const a=e=>{o&&clearTimeout(o),n(e)};r&&(o=setTimeout((()=>{e.removeListener(t,a),i(`timed out after ${r}ms:${t}`)}),r)),e.once(t,a)}))}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StatsReport=void 0;const s=r(3),c=r(231),u=r(232),l=a(r(233)),d=a(r(234)),p=o(r(13)),f=r(25),h=r(130),m=a(r(255)),g=r(256),v=h.generateUUID(),y=(new Date).getTime();class b extends s.EventEmitter{constructor(e){super(),this._reset(),this.heartbeat_=-1,this.wsTransport_=null,this.sdkRef=e.sdkRef,this.adapterRef=e.adapterRef,this.prevStats_={},this.appKey=this.adapterRef.instance._params.appkey||this.adapterRef.channelInfo&&this.adapterRef.channelInfo.appKey||"",this.isStartGetStats=!1,this.stats=new c.GetStats({adapterRef:this.adapterRef,interval:1e3}),this.stats.on("stats",((e,t)=>{this.formativeStatsReport&&this.formativeStatsReport.update(e,t)})),this.formativeStatsReport=new u.FormativeStatsReport({adapterRef:this.adapterRef,sdkRef:this.sdkRef,appkey:this.appKey})}_reset(){this.stats&&this.stats.destroy(),this.stats=null,this.formativeStatsReport&&this.formativeStatsReport.destroy(),this.formativeStatsReport=null,this.stopHeartbeat()}stop(){this.stats&&this.stats.stop(),this.formativeStatsReport&&this.formativeStatsReport.stop()}statsStart(){this.formativeStatsReport&&(this.isStartGetStats=!0,this.formativeStatsReport.start())}start(){let e=g(`0${y}${f.SDK_VERSION}webwebrtc${v}40f5a1a1871e46089e1e5139a779dd77`),t=`wss://statistic.live.126.net/lps-websocket/websocket/collect?deviceId=${v}&isTest=0&sdkVer=${f.SDK_VERSION}&sdktype=webrtc&timestamp=${y}&platform=web&checkSum=${e}`;this.wsTransport_=window.wsTransport=new d.default({url:t,adapterRef:this.adapterRef}),this.wsTransport_.init()}startHeartbeat(){if(-1===this.heartbeat_){const e=2e3;this.adapterRef.logger.log("startHeartbeat..."),this.heartbeat_=l.default.setInterval(this.doHeartbeat.bind(this),e)}}stopHeartbeat(){-1!==this.heartbeat_&&(l.default.clearInterval(this.heartbeat_),this.heartbeat_=-1)}async doHeartbeat(){var e;try{if(this.isStartGetStats){let t=await(null===(e=this.stats)||void 0===e?void 0:e.getAllStats()),r=this.calculateReport(t);p.IS_ELECTRON||this.wsTransport_.sendPB(r)}}catch(e){this.adapterRef.logger.error("getStats失败：",e)}}calculateReport(e){if(p.IS_CHROME||p.IS_EDG){let s=e.local.audio_ssrc?e.local.audio_ssrc:[],c=e.local.video_ssrc?e.local.video_ssrc:[],u=e.local.screen_ssrc?e.local.screen_ssrc:[],l=e.remote.audio_ssrc?e.remote.audio_ssrc:[],d=e.remote.video_ssrc?e.remote.video_ssrc:[],p=e.remote.screen_ssrc?e.remote.screen_ssrc:[];if(!m.default(this.prevStats_))var t=this.prevStats_.local.audio_ssrc?this.prevStats_.local.audio_ssrc:[],r=this.prevStats_.local.video_ssrc?this.prevStats_.local.video_ssrc:[],n=this.prevStats_.local.screen_ssrc?this.prevStats_.local.screen_ssrc:[],i=this.prevStats_.remote.audio_ssrc?this.prevStats_.remote.audio_ssrc:[],o=this.prevStats_.remote.video_ssrc?this.prevStats_.remote.video_ssrc:[],a=this.prevStats_.remote.screen_ssrc?this.prevStats_.remote.screen_ssrc:[];if(m.default(this.prevStats_)||s.length!==t.length||c.length!==r.length||u.length!==n.length||l.length!==i.length||d.length!==o.length||p.length!==a.length){this.prevStats_=e,Object.keys(this.prevStats_.local).length&&(this.prevStats_.local.audio_ssrc&&(this.prevStats_.local.audio_ssrc[0].bytesSentPerSecond=this.prevStats_.local.audio_ssrc[0].bytesSent),this.prevStats_.local.video_ssrc&&(this.prevStats_.local.video_ssrc[0].bytesSentPerSecond=this.prevStats_.local.video_ssrc[0].bytesSent),this.prevStats_.local.video_ssrc&&(this.prevStats_.local.video_ssrc[0].framesEncodedPerSecond=this.prevStats_.local.video_ssrc[0].framesEncoded),this.prevStats_.local.screen_ssrc&&(this.prevStats_.local.screen_ssrc[0].bytesSentPerSecond=this.prevStats_.local.screen_ssrc[0].bytesSent),this.prevStats_.local.screen_ssrc&&(this.prevStats_.local.screen_ssrc[0].framesEncodedPerSecond=this.prevStats_.local.screen_ssrc[0].framesEncoded));for(let e in this.prevStats_.remote)if(e.indexOf("ssrc")>-1)for(let t=0;t<this.prevStats_.remote[e].length;t++)this.prevStats_.remote[e][t].bytesReceivedPerSecond=this.prevStats_.remote[e][t].bytesReceived,this.prevStats_.remote[e][t].packetsLostPerSecond=this.prevStats_.remote[e][t].packetsLost,"video"===this.prevStats_.remote[e][t].mediaType&&(this.prevStats_.remote[e][t].framesDecodedPerSecond=Math.round(this.prevStats_.remote[e][t].framesDecoded))}else{let t=e.local,r=this.prevStats_.local,n=e.remote,i=this.prevStats_.remote;Object.keys(t).length&&(t.audio_ssrc&&(t.audio_ssrc[0].bytesSent-0>0&&t.audio_ssrc[0].bytesSent-0-r.audio_ssrc[0].bytesSent>0?t.audio_ssrc[0].bytesSentPerSecond=(t.audio_ssrc[0].bytesSent-0-r.audio_ssrc[0].bytesSent)/2:t.audio_ssrc[0].bytesSentPerSecond=0),t.video_ssrc&&(t.video_ssrc[0].bytesSent-0>0&&t.video_ssrc[0].bytesSent-0-r.video_ssrc[0].bytesSent>0?t.video_ssrc[0].bytesSentPerSecond=(t.video_ssrc[0].bytesSent-0-r.video_ssrc[0].bytesSent)/2:t.video_ssrc[0].bytesSentPerSecond=0,t.video_ssrc[0].framesEncoded-0>0&&t.video_ssrc[0].framesEncoded-0-r.video_ssrc[0].framesEncoded>0?t.video_ssrc[0].framesEncodedPerSecond=(t.video_ssrc[0].framesEncoded-0-r.video_ssrc[0].framesEncoded)/2:t.video_ssrc[0].framesEncodedPerSecond=0),t.screen_ssrc&&(t.screen_ssrc[0].bytesSent-0>0&&t.screen_ssrc[0].bytesSent-0-r.screen_ssrc[0].bytesSent>0?t.screen_ssrc[0].bytesSentPerSecond=(t.screen_ssrc[0].bytesSent-0-r.screen_ssrc[0].bytesSent)/2:t.screen_ssrc[0].bytesSentPerSecond=0,t.screen_ssrc[0].framesEncoded-0>0&&t.screen_ssrc[0].framesEncoded-0-r.screen_ssrc[0].framesEncoded>0?t.screen_ssrc[0].framesEncodedPerSecond=(t.screen_ssrc[0].framesEncoded-0-r.screen_ssrc[0].framesEncoded)/2:t.screen_ssrc[0].framesEncodedPerSecond=0));for(let e in n)if(e.indexOf("ssrc")>-1)for(let t=0;t<n[e].length;t++)n[e][t].bytesReceived-0>0&&n[e][t].bytesReceived-0-i[e][t].bytesReceived>0?n[e][t].bytesReceivedPerSecond=(n[e][t].bytesReceived-0-i[e][t].bytesReceived)/2:n[e][t].bytesReceivedPerSecond=0,n[e][t].packetsLost-0>0&&n[e][t].packetsLost-0-i[e][t].packetsLost>0?n[e][t].packetsLostPerSecond=(n[e][t].packetsLost-0-i[e][t].packetsLost)/2:n[e][t].packetsLostPerSecond=0,"video"===this.prevStats_.remote[e][t].mediaType&&(n[e][t].framesDecoded-0>0&&Math.round((n[e][t].framesDecoded-0-i[e][t].framesDecoded)/2)>0?n[e][t].framesDecodedPerSecond=Math.round((n[e][t].framesDecoded-0-i[e][t].framesDecoded)/2):n[e][t].framesDecodedPerSecond=0)}}else if(p.IS_SAFARI){let t=e.local.audio_outbound_rtp?e.local.audio_outbound_rtp:[],r=e.local.video_outbound_rtp?e.local.video_outbound_rtp:[],n=e.local.video_track?e.local.video_track:[],i=e.remote.audio_inbound_rtp?e.remote.audio_inbound_rtp:[],o=e.remote.video_inbound_rtp?e.remote.video_inbound_rtp:[],a=e.remote.video_track?e.remote.video_track:[];if(!m.default(this.prevStats_))var s=this.prevStats_.local.audio_outbound_rtp?this.prevStats_.local.audio_outbound_rtp:[],c=this.prevStats_.local.video_outbound_rtp?this.prevStats_.local.video_outbound_rtp:[],u=this.prevStats_.local.video_track?this.prevStats_.local.video_track:[],l=this.prevStats_.remote.audio_inbound_rtp?this.prevStats_.remote.audio_inbound_rtp:[],d=this.prevStats_.remote.video_inbound_rtp?this.prevStats_.remote.video_inbound_rtp:[],f=this.prevStats_.remote.video_track?this.prevStats_.remote.video_track:[];if(m.default(this.prevStats_)||t.length!==s.length||r.length!==c.length||n.length!==u.length||i.length!==l.length||o.length!==d.length||a.length!==f.length){this.prevStats_=e,Object.keys(this.prevStats_.local).length&&(this.prevStats_.local.audio_outbound_rtp&&(this.prevStats_.local.audio_outbound_rtp[0].bytesSentPerSecond=this.prevStats_.local.audio_outbound_rtp[0].bytesSent),this.prevStats_.local.video_outbound_rtp&&(this.prevStats_.local.video_outbound_rtp[0].bytesSentPerSecond=this.prevStats_.local.video_outbound_rtp[0].bytesSent),this.prevStats_.local.video_outbound_rtp&&(this.prevStats_.local.video_outbound_rtp[0].framesEncodedPerSecond=this.prevStats_.local.video_outbound_rtp[0].framesEncoded),this.prevStats_.local.video_track&&(this.prevStats_.local.video_track[0].framesSentPerSecond=this.prevStats_.local.video_track[0].framesSent));for(let e in this.prevStats_.remote)if(e.indexOf("inbound_rtp")>-1)for(let t=0;t<this.prevStats_.remote[e].length;t++)this.prevStats_.remote[e][t].bytesReceivedPerSecond=this.prevStats_.remote[e][t].bytesReceived,this.prevStats_.remote[e][t].packetsLostPerSecond=this.prevStats_.remote[e][t].packetsLost,"video"===this.prevStats_.remote[e][t].mediaType&&(this.prevStats_.remote[e][t].framesDecodedPerSecond=Math.round(this.prevStats_.remote[e][t].framesDecoded))}else{let t=e.local,r=this.prevStats_.local,n=e.remote,i=this.prevStats_.remote;Object.keys(t).length&&(t.audio_outbound_rtp&&(t.audio_outbound_rtp[0].bytesSent-0>0&&t.audio_outbound_rtp[0].bytesSent-0-r.audio_outbound_rtp[0].bytesSent>0?t.audio_outbound_rtp[0].bytesSentPerSecond=(t.audio_outbound_rtp[0].bytesSent-0-r.audio_outbound_rtp[0].bytesSent)/2:t.audio_outbound_rtp[0].bytesSentPerSecond=0),t.video_outbound_rtp&&(t.video_outbound_rtp[0].bytesSent-0>0&&t.video_outbound_rtp[0].bytesSent-0-r.video_outbound_rtp[0].bytesSent>0?t.video_outbound_rtp[0].bytesSentPerSecond=(t.video_outbound_rtp[0].bytesSent-0-r.video_outbound_rtp[0].bytesSent)/2:t.video_outbound_rtp[0].bytesSentPerSecond=0,t.video_outbound_rtp[0].framesEncoded-0>0&&t.video_outbound_rtp[0].framesEncoded-0-r.video_outbound_rtp[0].framesEncoded>0?t.video_outbound_rtp[0].framesEncodedPerSecond=(t.video_outbound_rtp[0].framesEncoded-0-r.video_outbound_rtp[0].framesEncoded)/2:t.video_outbound_rtp[0].framesEncodedPerSecond=0),t.video_track&&(t.video_track[0].framesSent-0>0&&Math.round(t.video_track[0].framesSent-0-r.video_track[0].framesSent)>0?t.video_track[0].framesSentPerSecond=Math.round((t.video_track[0].framesSent-0-r.video_track[0].framesSent)/2):t.video_track[0].framesSentPerSecond=0));for(let e in n)if(e.indexOf("inbound_rtp")>-1)for(let t=0;t<n[e].length;t++)n[e][t].bytesReceived-0>0&&n[e][t].bytesReceived-0-i[e][t].bytesReceived>0?n[e][t].bytesReceivedPerSecond=(n[e][t].bytesReceived-0-i[e][t].bytesReceived)/2:n[e][t].bytesReceivedPerSecond=0,n[e][t].packetsLost-0>0&&n[e][t].packetsLost-0-i[e][t].packetsLost>0&&(n[e][t].packetsLostPerSecond=(n[e][t].packetsLost-0-i[e][t].packetsLost)/2),"video"===this.prevStats_.remote[e][t].mediaType&&n[e][t].framesDecoded-0>0&&Math.round(n[e][t].framesDecoded-0-i[e][t].framesDecoded)>0&&(n[e][t].framesDecodedPerSecond=Math.round((n[e][t].framesDecoded-0-i[e][t].framesDecoded)/2))}}else if(p.IS_FIREFOX){let s=e.local.audio_outbound_rtp?e.local.audio_outbound_rtp:[],c=e.local.video_outbound_rtp?e.local.video_outbound_rtp:[],u=e.local.screen_outbound_rtp?e.local.screen_outbound_rtp:[],l=e.remote.audio_inbound_rtp?e.remote.audio_inbound_rtp:[],d=e.remote.video_inbound_rtp?e.remote.video_inbound_rtp:[],p=e.remote.screen_inbound_rtp?e.remote.screen_inbound_rtp:[];if(m.default(this.prevStats_)||(t=this.prevStats_.local.audio_outbound_rtp?this.prevStats_.local.audio_outbound_rtp:[],r=this.prevStats_.local.video_outbound_rtp?this.prevStats_.local.video_outbound_rtp:[],n=this.prevStats_.local.screen_outbound_rtp?this.prevStats_.local.screen_outbound_rtp:[],i=this.prevStats_.remote.audio_inbound_rtp?this.prevStats_.remote.audio_inbound_rtp:[],o=this.prevStats_.remote.video_inbound_rtp?this.prevStats_.remote.video_inbound_rtp:[],a=this.prevStats_.remote.screen_inbound_rtp?this.prevStats_.remote.screen_inbound_rtp:[]),m.default(this.prevStats_)||s.length!==t.length||c.length!==r.length||u.length!==n.length||l.length!==i.length||d.length!==o.length||p.length!==a.length){this.prevStats_=e,Object.keys(this.prevStats_.local).length&&(this.prevStats_.local.audio_outbound_rtp&&(this.prevStats_.local.audio_outbound_rtp[0].bytesSentPerSecond=this.prevStats_.local.audio_outbound_rtp[0].bytesSent),this.prevStats_.local.audio_outbound_rtp&&(this.prevStats_.local.audio_outbound_rtp[0].packetsSentPerSecond=this.prevStats_.local.audio_outbound_rtp[0].packetsSent),this.prevStats_.local.video_outbound_rtp&&(this.prevStats_.local.video_outbound_rtp[0].bytesSentPerSecond=this.prevStats_.local.video_outbound_rtp[0].bytesSent),this.prevStats_.local.video_outbound_rtp&&(this.prevStats_.local.video_outbound_rtp[0].framesEncodedPerSecond=this.prevStats_.local.video_outbound_rtp[0].framesEncoded),this.prevStats_.local.video_outbound_rtp&&(this.prevStats_.local.video_outbound_rtp[0].packetsSentPerSecond=this.prevStats_.local.video_outbound_rtp[0].packetsSent),this.prevStats_.local.screen_outbound_rtp&&(this.prevStats_.local.screen_outbound_rtp[0].bytesSentPerSecond=this.prevStats_.local.screen_outbound_rtp[0].bytesSent),this.prevStats_.local.screen_outbound_rtp&&(this.prevStats_.local.screen_outbound_rtp[0].framesEncodedPerSecond=this.prevStats_.local.screen_outbound_rtp[0].framesEncoded),this.prevStats_.local.screen_outbound_rtp&&(this.prevStats_.local.screen_outbound_rtp[0].packetsSentPerSecond=this.prevStats_.local.screen_outbound_rtp[0].packetsSent));for(let e in this.prevStats_.remote)if(e.indexOf("_inbound_rtp")>-1)for(let t=0;t<this.prevStats_.remote[e].length;t++)this.prevStats_.remote[e][t].bytesReceivedPerSecond=this.prevStats_.remote[e][t].bytesReceived,this.prevStats_.remote[e][t].packetsLostPerSecond=this.prevStats_.remote[e][t].packetsLost,this.prevStats_.remote[e][t].packetsReceivedPerSecond=this.prevStats_.remote[e][t].packetsReceived,this.prevStats_.remote[e][t].recvPacketLoss=this.prevStats_.remote[e][t].packetsLost/this.prevStats_.remote[e][t].packetsReceived,"video"!==this.prevStats_.remote[e][t].mediaType&&"screen"!==this.prevStats_.remote[e][t].mediaType||(this.prevStats_.remote[e][t].framesDecodedPerSecond=Math.round(this.prevStats_.remote[e][t].framesDecoded))}else{let t=e.local,r=this.prevStats_.local,n=e.remote,i=this.prevStats_.remote;Object.keys(t).length&&(t.audio_outbound_rtp&&(t.audio_outbound_rtp[0].bytesSent-0>0&&t.audio_outbound_rtp[0].bytesSent-0-r.audio_outbound_rtp[0].bytesSent>0?t.audio_outbound_rtp[0].bytesSentPerSecond=(t.audio_outbound_rtp[0].bytesSent-0-r.audio_outbound_rtp[0].bytesSent)/2:t.audio_outbound_rtp[0].bytesSentPerSecond=0,t.audio_outbound_rtp[0].packetsSent-0>0&&t.audio_outbound_rtp[0].packetsSent-0-r.audio_outbound_rtp[0].packetsSent>0?t.audio_outbound_rtp[0].packetsSentPerSecond=(t.audio_outbound_rtp[0].packetsSent-0-r.audio_outbound_rtp[0].packetsSent)/2:t.audio_outbound_rtp[0].packetsSentPerSecond=0),t.video_outbound_rtp&&(t.video_outbound_rtp[0].bytesSent-0>0&&t.video_outbound_rtp[0].bytesSent-0-r.video_outbound_rtp[0].bytesSent>0?t.video_outbound_rtp[0].bytesSentPerSecond=(t.video_outbound_rtp[0].bytesSent-0-r.video_outbound_rtp[0].bytesSent)/2:t.video_outbound_rtp[0].bytesSentPerSecond=0,t.video_outbound_rtp[0].framesEncoded-0>0&&t.video_outbound_rtp[0].framesEncoded-0-r.video_outbound_rtp[0].framesEncoded>0?t.video_outbound_rtp[0].framesEncodedPerSecond=(t.video_outbound_rtp[0].framesEncoded-0-r.video_outbound_rtp[0].framesEncoded)/2:t.video_outbound_rtp[0].framesEncodedPerSecond=0,t.video_outbound_rtp[0].packetsSent-0>0&&t.video_outbound_rtp[0].packetsSent-0-r.video_outbound_rtp[0].packetsSent>0?t.video_outbound_rtp[0].packetsSentPerSecond=(t.video_outbound_rtp[0].packetsSent-0-r.video_outbound_rtp[0].packetsSent)/2:t.video_outbound_rtp[0].packetsSentPerSecond=0),t.screen_outbound_rtp&&(t.screen_outbound_rtp[0].bytesSent-0>0&&t.screen_outbound_rtp[0].bytesSent-0-r.screen_outbound_rtp[0].bytesSent>0?t.screen_outbound_rtp[0].bytesSentPerSecond=(t.screen_outbound_rtp[0].bytesSent-0-r.screen_outbound_rtp[0].bytesSent)/2:t.screen_outbound_rtp[0].bytesSentPerSecond=0,t.screen_outbound_rtp[0].framesEncoded-0>0&&t.screen_outbound_rtp[0].framesEncoded-0-r.screen_outbound_rtp[0].framesEncoded>0?t.screen_outbound_rtp[0].framesEncodedPerSecond=(t.screen_outbound_rtp[0].framesEncoded-0-r.screen_outbound_rtp[0].framesEncoded)/2:t.screen_outbound_rtp[0].framesEncodedPerSecond=0,t.screen_outbound_rtp[0].packetsSent-0>0&&t.screen_outbound_rtp[0].packetsSent-0-r.screen_outbound_rtp[0].packetsSent>0?t.screen_outbound_rtp[0].packetsSentPerSecond=(t.screen_outbound_rtp[0].packetsSent-0-r.screen_outbound_rtp[0].packetsSent)/2:t.screen_outbound_rtp[0].packetsSentPerSecond=0));for(let e in n)if(e.indexOf("_inbound_rtp")>-1)for(let t=0;t<n[e].length;t++)n[e][t].bytesReceived-0>0&&n[e][t].bytesReceived-0-i[e][t].bytesReceived>0?n[e][t].bytesReceivedPerSecond=(n[e][t].bytesReceived-0-i[e][t].bytesReceived)/2:n[e][t].bytesReceivedPerSecond=0,n[e][t].packetsLost-0>0&&n[e][t].packetsLost-0-i[e][t].packetsLost>0?n[e][t].packetsLostPerSecond=(n[e][t].packetsLost-0-i[e][t].packetsLost)/2:n[e][t].packetsLostPerSecond=0,n[e][t].packetsReceived-0>0&&n[e][t].packetsReceived-0-i[e][t].packetsReceived>0?n[e][t].packetsReceivedPerSecond=(n[e][t].packetsReceived-0-i[e][t].packetsReceived)/2:n[e][t].packetsReceivedPerSecond=0,n[e][t].packetsLost/n[e][t].packetsReceived-0>0&&n[e][t].packetsLost/n[e][t].packetsReceived-0-i[e][t].packetsLost/i[e][t].packetsReceived>0?n[e][t].recvPacketLoss=(n[e][t].packetsLost/n[e][t].packetsReceived-0-i[e][t].packetsLost/i[e][t].packetsReceived)/2:n[e][t].recvPacketLoss=0,"video"!==this.prevStats_.remote[e][t].mediaType&&"screen"!==this.prevStats_.remote[e][t].mediaType||(n[e][t].framesDecoded-0>0&&Math.round(n[e][t].framesDecoded-0-i[e][t].framesDecoded)>0?n[e][t].framesDecodedPerSecond=Math.round((n[e][t].framesDecoded-0-i[e][t].framesDecoded)/2):n[e][t].framesDecodedPerSecond=0)}}return this.prevStats_=e,this.prevStats_}destroy(){this.stop(),this._reset(),this.wsTransport_&&this.wsTransport_.close()}}t.StatsReport=b},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.GetStats=void 0;const a=r(3),s=o(r(124)),c=r(33),u=o(r(13));class l extends a.EventEmitter{constructor(e){super(),this.adapterRef=e.adapterRef,this.interval=e.interval||1e3,this.times=0,this.browser="chrome",this.KeyTransform={K:{googAvailableSendBandwidth:1,googTargetEncBitrate:1,googActualEncBitrate:1,googRetransmitBitrate:1,googTransmitBitrate:1},T:{}},this._reset()}_reset(){this.times=0,this.browser="chrome";const e=navigator.userAgent,t=s.getParser(e);t.satisfies({chrome:">=72",chromium:">=72"})?this.browser="chrome":t.satisfies({safari:">=12.0"})?this.browser="safari":t.satisfies({firefox:">60"})?this.browser="firefox":"WeChat"===t.getBrowser().name&&"iOS"===t.getOS().name||"QQ Browser"===t.getBrowser().name&&"iOS"===t.getOS().name?this.browser="safari":"QQ Browser"===t.getBrowser().name&&"Android"===t.getOS().name&&(this.browser="chrome"),this.KeyTransform={K:{googAvailableSendBandwidth:1,googTargetEncBitrate:1,googActualEncBitrate:1,googRetransmitBitrate:1,googTransmitBitrate:1},T:{}}}async getAllStats(){let e=this.adapterRef&&this.adapterRef._mediasoup&&this.adapterRef._mediasoup._sendTransport&&this.adapterRef._mediasoup._sendTransport._handler._pc,t=this.adapterRef&&this.adapterRef._mediasoup&&this.adapterRef._mediasoup._recvTransport&&this.adapterRef._mediasoup._recvTransport._handler._pc;if(!e&&!t)return;let r={local:e?await this.getLocalStats(e):null,remote:t?await this.getRemoteStats(t):null};return this.times=(this.times||0)+1,this.emit("stats",r,this.times),this.reviseData(r,this.browser)}reviseData(e,t){var r,n,i;let o=new Map,a=new Map;if("chrome"===t){let t=new Map([["candidate-pair",[]],["local-candidate",[]],["media-source",[]],["outbound-rtp",[]],["remote-candidate",[]],["remote-inbound-rtp",[]],["ssrc",[]],["VideoBwe",[]],["track",[]],["transport",[]]]),r=new Map([["candidate-pair",[]],["inbound-rtp",[]],["local-candidate",[]],["remote-candidate",[]],["ssrc",[]],["track",[]],["transport",[]]]),n=e.local,i=e.remote;for(let e in n)if(t.has(n[e].type))if(e.indexOf("ssrc")>-1){let t;e.indexOf("audio")>0||e.indexOf("video")>0?t=n[e].mediaType+"_ssrc":e.indexOf("screen")>0&&(t="screen_ssrc",n[e].mediaType="screen"),o.has(t)||o.set(t,[]),o.get(t).push(n[e])}else o.set(n[e].type,[]),o.get(n[e].type).push(n[e]);let s=Object.create(null);for(let[e,t]of o)s[e]=t;e.local=s;for(let e in i)if(r.has(i[e].type))if("ssrc"===i[e].type){let t;e.indexOf("audio")>0||e.indexOf("video")>0?t=`${i[e].mediaType}_${i[e].type}`:e.indexOf("screen")>0&&(t="screen_"+i[e].type,i[e].mediaType="screen"),a.has(t)||a.set(t,[]),a.get(t).push(i[e])}else{let t=i[e].type;a.has(t)||a.set(t,[]),a.get(t).push(i[e])}let c=Object.create(null);for(let[e,t]of a)c[e]=t;e.remote=c}else if("safari"===t){let t=e.local,r=e.remote,n=new Map([["outbound-rtp",[]],["track",[]]]);for(let e in t)if(n.has(t[e].type)){let r=`${t[e].mediaType}_${t[e].type}`;o.has(r)||o.set(r,[]),o.get(r).push(t[e])}let i=Object.create(null);for(let[e,t]of o)i[e]=t;e.local=i;let s=new Map([["inbound-rtp",[]],["track",[]]]);for(let e in r)if(s.has(r[e].type)){let t=`${r[e].mediaType}_${r[e].type}`;a.has(t)||a.set(t,[]),a.get(t).push(r[e])}let c=Object.create(null);for(let[e,t]of a)c[e]=t;e.remote=c}else if("firefox"===t){let t=e.local,r=e.remote,n=new Map([["candidate-pair",[]],["local-candidate",[]],["outbound-rtp",[]],["remote-candidate",[]]]);for(let e in t)if(n.has(t[e].type)){let r;r=e.indexOf("-outbound-rtp")>-1?`${t[e].mediaType}_${t[e].type}`:""+t[e].type,o.has(r)||o.set(r,[]),o.get(r).push(t[e])}let i=Object.create(null);for(let[e,t]of o)i[e]=t;e.local=i;let s=new Map([["candidate-pair",[]],["inbound-rtp",[]],["local-candidate",[]],["remote-candidate",[]]]);for(let e in r)if(s.has(r[e].type)){let t;t=e.indexOf("-inbound-rtp")>-1?`${r[e].mediaType}_${r[e].type}`:""+r[e].type,a.has(t)||a.set(t,[]),a.get(t).push(r[e])}let c=Object.create(null);for(let[e,t]of a)c[e]=t;e.remote=c}let s={"candidate-pair":"candidate_pair","local-candidate":"local_candidate","media-source":"media_source","outbound-rtp":"outbound_rtp","remote-candidate":"remote_candidate","remote-inbound-rtp":"remote_inbound_rtp",VideoBwe:"video_bwe","inbound-rtp":"inbound_rtp","audio_outbound-rtp":"audio_outbound_rtp","video_outbound-rtp":"video_outbound_rtp","audio_inbound-rtp":"audio_inbound_rtp","video_inbound-rtp":"video_inbound_rtp","screen_outbound-rtp":"screen_outbound_rtp","screen_inbound-rtp":"screen_inbound_rtp"};for(let t in e.local){let r=s[t];r&&(e.local[r]=e.local[t],delete e.local[t])}for(let t in e.remote){let r=s[t];r&&(e.remote[r]=e.remote[t],delete e.remote[t])}return e.timestamp=(new Date).getTime(),e.appkey=null===(r=this.adapterRef)||void 0===r?void 0:r.channelInfo.appkey,e.cid=null===(n=this.adapterRef)||void 0===n?void 0:n.channelInfo.cid,e.uid=null===(i=this.adapterRef)||void 0===i?void 0:i.channelInfo.uid,u.IS_EDG?e.browser="Edge-"+c.platform.version:e.browser=c.platform.name+"-"+c.platform.version,e.platform=c.platform.os.family,e}async getLocalStats(e){return!e||/(failed|closed|new)/gi.test(e.iceConnectionState)?{}:await this[this.browser](e,"send")}async getRemoteStats(e){return!e||/(failed|closed|new)/gi.test(e.iceConnectionState)?{}:await this[this.browser](e,"recv")}async chrome(e,t){const r=await(()=>new Promise(((r,n)=>{e.getStats((n=>{let i={};n.result().forEach((function(e){const t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i[t.id]=t})),e.lastStats=e.lastStats||{},i=this.formatChromeNonStandardStats(e,i,t),r(i)}))})))(),n=await(async()=>{if(!e.getTransceivers)return{};let r={};const n=e.getTransceivers();for(let e=0;e<n.length;e++){let i=null;const o=n[e];"sendonly"===o.direction?o.sender&&o.sender.getStats&&(i=await o.sender.getStats(),i=this.formatChromeStandardizedStats(i,t,0),Object.assign(r,i)):"recvonly"===o.direction&&o.receiver&&o.receiver.getStats&&(i=await o.receiver.getStats(),i=this.formatChromeStandardizedStats(i,t,0),Object.assign(r,i))}return r})();return Object.assign(r,n)}formatChromeNonStandardStats(e,t,r){const n={};return Object.values(t).forEach((t=>{if("recv"===r&&!/^ssrc_/i.test(t.id))return n;if("send"===r&&!/^(bweforvideo|Conn-0-1-0|ssrc_)/i.test(t.id))return n;"bweforvideo"===t.id&&(t=this.formatData(t));const i=("send"===r?/ssrc_(\d+)_send/i:/ssrc_(\d+)_recv/i).exec(t.id),o=t.id;if(n[o]=t,!i||!i[1])return n;const a=i[1];if(!this.adapterRef)return void console.error("getStats行为没有client关联");const s=this.adapterRef.instance.getUidAndKindBySsrc(parseInt(a));let c,u=s.uid;if(c=s.kind?s.kind:"screen"===t.googContentType?"screen":t.mediaType,!u&&"recv"===r)return n;t.id=this.stringifyItemId("ssrc",r,"recv"===r?""+u:"0",c,s.streamType),t.localuid=this.adapterRef.channelInfo.uid,t.remoteuid=u,-1==(t=this.computeData(e,t)).googInterframeDelayMax&&(t.googInterframeDelayMax=0),n[t.id]=t,delete n[o]})),n}stringifyItemId(e,t,r,n,i){var o,a,s;let c;return c="send"===t?"high"===i?`${e}_${null===(o=this.adapterRef)||void 0===o?void 0:o.channelInfo.uid}_send_0_${n}`:`${e}_${null===(a=this.adapterRef)||void 0===a?void 0:a.channelInfo.uid}_send_0_${n}_${i}`:`${e}_${null===(s=this.adapterRef)||void 0===s?void 0:s.channelInfo.uid}_${t}_${r}_${n}`,c}parseItemId(e){const t=e.match(/([a-zA-Z\-])+_\d+_send_0_([a-zA-Z]+)/),r=e.match(/([a-zA-Z\-])+_\d+_send_0_([a-zA-Z]+)_([a-zA-Z]+)/),n=e.match(/([a-zA-Z\-])+_\d+_recv_(\d+)_([a-zA-Z]+)/);let i;return i=t?{type:t[1],direction:"send",remoteUid:"0",mediaType:t[2],streamType:"high"}:r?{type:r[1],direction:"send",remoteUid:"0",mediaType:r[2],streamType:r[3]}:n?{type:n[1],direction:"recv",remoteUid:n[2],mediaType:n[3]}:null,i}formatChromeStandardizedStats(e,t,r){let n={};if(e.forEach((e=>{"inbound-rtp"==e.type&&this.adapterRef&&this.adapterRef.instance&&(r=this.adapterRef.instance.getUidAndKindBySsrc(e.ssrc).uid)})),r||!(t.indexOf("recv")>-1))return e.forEach((e=>{"local-candidate"!=e.type&&"remote-candidate"!=e.type&&"track"!=e.type&&"outbound-rtp"!=e.type&&"remote-inbound-rtp"!=e.type&&"candidate-pair"!=e.type&&"media-source"!=e.type&&"inbound-rtp"!=e.type&&"transport"!=e.type||(n[`${e.type}_${this.adapterRef&&this.adapterRef.channelInfo.uid}_${t}_${r}`]=e)})),n}async safari(e,t){const r=await(async()=>{const r=await e.getStats();return e.lastStats=e.lastStats||{},this.formatSafariNonStandardStats(e,r,t)})(),n=await(async()=>{if(!e.getTransceivers)return{};let r={};const n=e.getTransceivers();for(let e=0;e<n.length;e++){let i=null;const o=n[e];"sendonly"===o.direction?o.sender&&o.sender.getStats&&(i=await o.sender.getStats(),i&&(i=this.formatSafariStandardizedStats(i,t)||{},Object.assign(r,i))):"recvonly"===o.direction&&o.receiver&&o.receiver.getStats&&(i=await o.receiver.getStats(),i&&(i=this.formatSafariStandardizedStats(i,t)||{},Object.assign(r,i)))}return r})();return Object.assign(r,n)}formatSafariNonStandardStats(e,t,r){let n={},i=new Map;return t.forEach((e=>{if("outbound-rtp"==e.type||"inbound-rtp"==e.type){const t=this.adapterRef?this.adapterRef.instance.getUidAndKindBySsrc(e.ssrc).uid:0;return i.set(e.trackId,{uid:t.toString(),ssrc:e.ssrc}),void(e.remoteuid=t.toString())}})),t.forEach((t=>{"track"==t.type?(t.ssrc=i.get(t.id.toString()).ssrc,t.remoteuid=t.uid=i.get(t.id.toString()).uid,t.framesSent||t.framesReceived?(t=this.computeData(e,t),n[`_video_${t.type}_${this.adapterRef&&this.adapterRef.channelInfo.uid}_${r}_${t.uid}`]=t,t.mediaType="video"):(n[`_audio_${t.type}_${this.adapterRef&&this.adapterRef.channelInfo.uid}_${r}_${t.uid}`]=t,t.mediaType="audio")):"outbound-rtp"!=t.type&&"inbound-rtp"!=t.type||(t=this.computeData(e,t),n[`${t.mediaType}_${t.type}_${this.adapterRef&&this.adapterRef.channelInfo.uid}_${r}_${t.uid}`]=t)})),n}formatSafariStandardizedStats(e,t){let r,n={};return e.forEach((e=>{"inbound-rtp"==e.type&&(r=this.adapterRef?this.adapterRef.instance.getUidAndKindBySsrc(e.ssrc).uid:r)})),e.forEach((e=>{"local-candidate"!=e.type&&"remote-candidate"!=e.type&&"track"!=e.type&&"outbound-rtp"!=e.type&&"remote-inbound-rtp"!=e.type&&"candidate-pair"!=e.type&&"media-source"!=e.type&&"inbound-rtp"!=e.type&&"transport"!=e.type||(n[`${e.type}_${this.adapterRef&&this.adapterRef.channelInfo.uid}_${t}_${r}`]=e)})),n}async firefox(e,t){const r=await(async()=>{let t=await e.getStats(),r={};return t.forEach((e=>{r[e.type]=e})),r})(),n=await(async()=>{if(!e.getTransceivers)return{};let r={};const n=e.getTransceivers();for(let e=0;e<n.length;e++){let i=null;const o=n[e];"sendonly"===o.direction?o.sender&&o.sender.getStats&&(i=await o.sender.getStats(),i=this.formatFirefoxStandardizedStats(i,t,0,o.mid),Object.assign(r,i)):"recvonly"===o.direction&&o.receiver&&o.receiver.getStats&&(i=await o.receiver.getStats(),i=this.formatFirefoxStandardizedStats(i,t,0),Object.assign(r,i))}return r})();return Object.assign(r,n)}formatFirefoxStandardizedStats(e,t,r,n){let i={};return e.forEach((e=>{if("inbound-rtp"==e.type&&this.adapterRef&&this.adapterRef.instance){const t=this.adapterRef.instance.getUidAndKindBySsrc(e.ssrc);e.remoteuid=t.uid,r=t.uid,"video"===e.kind&&(e.mediaType=t.kind?t.kind:"screen")}})),e.forEach((e=>{"outbound-rtp"==e.type&&"2"==n&&(e.mediaType="screen")})),e.forEach((e=>{"local-candidate"==e.type||"remote-candidate"==e.type||"remote-inbound-rtp"==e.type||"candidate-pair"==e.type?i[`${e.type}_${this.adapterRef&&this.adapterRef.channelInfo.uid}_${t}_${r}`]=e:"outbound-rtp"!=e.type&&"inbound-rtp"!=e.type||(i[`${e.mediaType}-${e.type}_${this.adapterRef&&this.adapterRef.channelInfo.uid}_${t}_${r}`]=e)})),i}formatData(e){return Object.keys(e).map((t=>{this.KeyTransform.K[t]&&(e[t]=(e[t]/1024).toFixed(2)),this.KeyTransform.T[t]&&(e[t]=(e[t]/1024/1024).toFixed(2))})),e}computeData(e,t){const r={pc:e,ssrcKey:t.ssrc,currentItem:t};return t.bytesSent&&(t.bitsSentPerSecond=this.getLastStats(Object.assign({},r,{firstKey:"bytesSent"}))),t.packetsSent&&(t.packetsSentPerSecond=this.getLastStats(Object.assign({},r,{firstKey:"packetsSent"}))),t.bytesReceived&&(t.bitsReceivedPerSecond=this.getLastStats(Object.assign({},r,{firstKey:"bytesReceived"}))),t.packetsReceived&&(t.packetsReceivedPerSecond=this.getLastStats(Object.assign({},r,{firstKey:"packetsReceived"}))),t.packetsSent&&t.packetsLost&&(t.sendPacketLoss=this.getLastStats(Object.assign({},r,{firstKey:"packetsSent",secondKey:"packetsLost"}))),t.packetsReceived&&t.packetsLost&&(t.recvPacketLoss=this.getLastStats(Object.assign({},r,{firstKey:"packetsReceived",secondKey:"packetsLost"}))),t.framesSent&&(t.frameRateSent=this.getLastStats(Object.assign({},r,{firstKey:"framesSent"}))),t}getLastStats(e={}){const{pc:t,ssrcKey:r,firstKey:n,secondKey:i=null,currentItem:o}=e;let a=0,s=0;if(t.lastStats[r]&&t.lastStats[r][n]){if(!(o[n]-t.lastStats[r][n]>0))return a;a=(o[n]-t.lastStats[r][n])/2,i&&(s=(o[i]-t.lastStats[r][i])/2)}else t.lastStats[r]||(t.lastStats[r]={}),a=o[n],i&&(s=o[i]);return a=/bytes/gi.test(n)?Math.round(8*a/1e3):i?n.indexOf("send")>-1?Math.floor(s/a*1e4)/100:s/(s+s)*1e4/100:a,t.lastStats[r][n]=o[n],i&&(t.lastStats[r][i]=o[i]),a}stop(){this._reset()}destroy(){this._reset()}}t.GetStats=l},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormativeStatsReport=void 0;const s=r(129),c=r(33),u=a(r(1)),l=a(r(0)),d=o(r(13));t.FormativeStatsReport=class{constructor(e){this._reset(),this.adapterRef=e.adapterRef,this.webrtcStats=[],this.publicIP="",this._audioLevel=[],this.infos={interval:0},this.infos2={},this.paramSecond={upAudioCache:{},upVideoCache:{},upScreenCache:{},downAudioCache:{},downVideoCache:{},downScreenCache:{}},this.firstData={recvFirstData:{},sendFirstAudioPackage:!1,sendFirstVideoPackage:!1,sendFirstScreenPackage:!1},this.network="",this.LocalAudioEnable=!1,this.localVideoEnable=!1,this.localScreenEnable=!1,this.init(this.adapterRef.channelInfo.appkey),this.resetStatus()}_reset(){this._audioLevel=[],this.infos={interval:0}}init(e){return this.infos={ver:2,device:-1,isp:-1,platform:p.convertPlatform(c.platform.os.family)+"-"+c.platform.os.version+"- webrtc",browser:c.platform.name+"-"+c.platform.version,sdk_ver:"3.6.0",appkey:e,interval:60,samples:30,time:Date.now(),qos_algorithm:-1,fec_algorithm:-1,qos_scene:-1,qos_strategy:-1},this.infos}resetStatus(){this.infos=Object.assign(this.infos,{uid:null,cid:null,push_url:null,turn_ip:null,proxy_ip:null,meeting:!1,live:!1}),this.firstData={recvFirstData:{},sendFirstAudioPackage:!1,sendFirstVideoPackage:!1,sendFirstScreenPackage:!1},this._audioLevel&&(this._audioLevel.length=0),this.clearInfoData()}initInfoData(e){let t={uid:e,cid:this.adapterRef.channelInfo.cid||0,push_url:"",turn_ip:this.adapterRef&&this.adapterRef.channelInfo.wssArr&&this.adapterRef.channelInfo.wssArr[0]||"",proxy_ip:this.adapterRef&&this.adapterRef.channelInfo.wssArr&&this.adapterRef.channelInfo.wssArr[0]||"",meeting:!0,live:this.adapterRef.channelInfo&&this.adapterRef.channelInfo.sessionConfig.liveEnable||!1,p2p:!1,isp:-1,net:-1,connect_state:200,signalling_time:(this.adapterRef.channelInfo&&this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.startWssTime||0)-(this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.startJoinTime||0),connect_time:(this.adapterRef.channelInfo&&this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.joinedSuccessedTime||0)-(this.adapterRef.channelInfo&&this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.startWssTime||0)};this.infos=Object.assign(this.infos,t)}clearInfoData(){this.infos2={rx2:[],tx2:[{v_fps:[],v_res:[],v_plis:[],v_rtt:[],v_simulcast:[],v_bw_kbps:[],v_tar_kbps:[],v_rel_kbps:[],v_tx_kbps:[],v_retx_kbps:[],v_delay:[],s_fps:[],s_res:[],s_plis:[],s_rtt:[],s_simulcast:[],s_bw_kbps:[],s_tar_kbps:[],s_rel_kbps:[],s_tx_kbps:[],s_retx_kbps:[],s_delay:[],a_cap_volume:[],a_rtt:[]}],sys:{cpu_total:[],cpu_idle:[],mem_total:[],mem_workingSet:[],mem_load:[]}}}start(){this.infos.appkey=this.adapterRef.channelInfo.appkey,this.infos.cid=this.adapterRef.channelInfo.cid,this.infos.uid=this.adapterRef.channelInfo.uid,this.clearSecond(),this.initInfoData(this.infos.uid)}stop(){this.send(),this.resetStatus()}clearSecond(){this.paramSecond={upAudioCache:{},upVideoCache:{},upScreenCache:{},downAudioCache:{},downVideoCache:{},downScreenCache:{}}}getPacketLossRate(e,t,r=!1){if(!e||!t)return 0;let n=parseInt(e.packetsLost)||0,i=parseInt(t.packetsLost)||0;if(i<=n)return 0;let o=r?e.packetsSent:e.packetsReceived,a=r?t.packetsSent:t.packetsReceived,s=parseInt(o||"")||0,c=parseInt(a||"")||0;return c<=s?0:r?parseFloat(((i-n)/(c-s)*100).toFixed(1)):parseFloat(((i-n)/(i-n+(c-s))*100).toFixed(1))}update(e,t){e=Object.assign({},e.local,e.remote);let r=[],n=[],i=[],o=[],a=[],s=[];2==this.webrtcStats.length&&this.webrtcStats.shift(),this.webrtcStats.push(e);let c=0,u=0;this._audioLevel&&(this._audioLevel.length=0);for(let t in e){let l;if(l=d.IS_SAFARI?t.split("_")[5]||"":t.split("_")[3]||"","0"===l&&(l=t.split("_")[1]||""),-1!==t.indexOf("_send_")&&-1!==t.indexOf("_audio"))!this.firstData.sendFirstAudioPackage&&e[t].packetsSent>0&&(this.firstData.sendFirstAudioPackage=!0,this.adapterRef.instance.apiEventReport("setSendFirstPackage",{media_type:0})),this.paramSecond.upAudioCache[l]&&(this.paramSecond.upAudioCache[l].packetsLost,this.paramSecond.upAudioCache[l].packetsSent,e[t].alr=this.getPacketLossRate(this.paramSecond.upAudioCache[l],e[t],!0),this.dispatchExceptionEventSendAudio(this.paramSecond.upAudioCache[l],e[t],l)),u+=parseInt(e[t].bytesSent),this.paramSecond.upAudioCache[l]=e[t],this.adapterRef.channelInfo.uid,e[t].packetsLost,e[t].packetsSent,e[t].googRtt,e[t].googJitterReceived,r.push(e[t]);else if(-1!==t.indexOf("_send_")&&-1!==t.indexOf("_video")){!this.firstData.sendFirstVideoPackage&&e[t].packetsSent>0&&(this.firstData.sendFirstVideoPackage=!0,this.adapterRef.instance.apiEventReport("setSendFirstPackage",{media_type:1})),this.paramSecond.upVideoCache[l]&&(this.paramSecond.upVideoCache[l].packetsLost,this.paramSecond.upVideoCache[l].packetsSent,e[t].vlr=this.getPacketLossRate(this.paramSecond.upVideoCache[l],e[t],!0),this.dispatchExceptionEventSendVideo(this.paramSecond.upVideoCache[l],e[t],l));let r=this.getLocalVideoFreezeStats(e[t],l);e[t].freezeTime=r.freezeTime,e[t].totalFreezeTime=r.totalFreezeTime,e[t]=Object.assign({},e.bweforvideo,e[t]),u+=parseInt(e[t].bytesSent),this.paramSecond.upVideoCache[l]=e[t],this.adapterRef.channelInfo.uid,e[t].packetsLost,e[t].packetsSent,e[t].googRtt,e[t].googJitterReceived,n.push(e[t])}else if(-1!==t.indexOf("_send_")&&-1!==t.indexOf("_screen")){!this.firstData.sendFirstScreenPackage&&e[t].packetsSent>0&&(this.firstData.sendFirstScreenPackage=!0,this.adapterRef.instance.apiEventReport("setSendFirstPackage",{media_type:2})),this.paramSecond.upScreenCache[l]&&(this.paramSecond.upScreenCache[l].packetsLost,this.paramSecond.upScreenCache[l].packetsSent,e[t].vlr=this.getPacketLossRate(this.paramSecond.upScreenCache[l],e[t],!0));let r=this.getLocalScreenFreezeStats(e[t],l);e[t].freezeTime=r.freezeTime,e[t].totalFreezeTime=r.totalFreezeTime,Object.assign(e[t],e.bweforvideo),u+=parseInt(e[t].bytesSent),this.paramSecond.upScreenCache[l]=e[t],this.adapterRef.channelInfo.uid,e[t].packetsLost,e[t].packetsSent,e[t].googRtt,e[t].googJitterReceived,i.push(e[t])}else if(-1!==t.indexOf("_recv_")&&-1!==t.indexOf("_audio")){this.firstData.recvFirstData[l]||(this.firstData.recvFirstData[l]={recvFirstAudioFrame:!1,recvFirstVideoFrame:!1,recvFirstScreenFrame:!1,recvFirstAudioPackage:!1,recvFirstVideoPackage:!1,recvFirstScreenPackage:!1,videoTotalPlayDuration:0,screenTotalPlayDuration:0}),!this.firstData.recvFirstData[l].recvFirstAudioFrame&&parseInt(e[t].googDecodingNormal)>0&&(this.firstData.recvFirstData[l].recvFirstAudioFrame=!0,this.adapterRef.instance.apiEventReport("setRecvFirstFrame",{media_type:0,pull_uid:l})),!this.firstData.recvFirstData[l].recvFirstAudioPackage&&parseInt(e[t].packetsReceived)>0&&(this.firstData.recvFirstData[l].recvFirstAudioPackage=!0,this.adapterRef.instance.apiEventReport("setRecvFirstPackage",{media_type:0,pull_uid:l})),this.paramSecond.downAudioCache[l]&&(this.paramSecond.downAudioCache[l].packetsLost,this.paramSecond.downAudioCache[l].packetsReceived,e[t].alr=this.getPacketLossRate(this.paramSecond.downAudioCache[l],e[t]));let r=this.getRemoteAudioFreezeStats(this.paramSecond.downAudioCache[l],e[t],l);e[t].freezeTime=r.freezeTime,e[t].totalFreezeTime=r.totalFreezeTime,c+=parseInt(e[t].bytesReceived),this.dispatchExceptionEventRecvAudio(this.paramSecond.downAudioCache[l],e[t],l),this.paramSecond.downAudioCache[l]=e[t],e[t].packetsLost,e[t].packetsReceived,o.push(e[t]);let n=0;e[t].audioOutputLevel>=0?n=e[t].audioOutputLevel:e[t].audioLevel>=0&&(n=Math.floor(32768*e[t].audioLevel)),this._audioLevel.push({uid:l,level:+n||0})}else if(-1!==t.indexOf("_recv_")&&-1!==t.indexOf("_video")){this.firstData.recvFirstData[l]||(this.firstData.recvFirstData[l]={recvFirstAudioFrame:!1,recvFirstVideoFrame:!1,recvFirstScreenFrame:!1,recvFirstAudioPackage:!1,recvFirstVideoPackage:!1,recvFirstScreenPackage:!1,videoTotalPlayDuration:0,screenTotalPlayDuration:0}),!this.firstData.recvFirstData[l].recvFirstVideoFrame&&e[t].framesDecoded>0?(this.firstData.recvFirstData[l].recvFirstVideoFrame=!0,this.adapterRef.instance.apiEventReport("setRecvFirstFrame",{media_type:1,pull_uid:l})):e[t].framesDecoded>0&&this.firstData.recvFirstData[l].videoTotalPlayDuration++,!this.firstData.recvFirstData[l].recvFirstVideoPackage&&e[t].packetsReceived>0&&(this.firstData.recvFirstData[l].recvFirstVideoPackage=!0,this.adapterRef.instance.apiEventReport("setRecvFirstPackage",{media_type:1,pull_uid:l})),this.paramSecond.downVideoCache[l]&&(this.paramSecond.downVideoCache[l].packetsLost,this.paramSecond.downVideoCache[l].packetsReceived,e[t].vlr=this.getPacketLossRate(this.paramSecond.downVideoCache[l],e[t]));let r=this.getRemoteVideoFreezeStats(this.paramSecond.downVideoCache[l],e[t],l);e[t].freezeTime=r.freezeTime,e[t].totalFreezeTime=r.totalFreezeTime,this.dispatchExceptionEventRecvVideo(this.paramSecond.downVideoCache[l],e[t],l),c+=parseInt(e[t].bytesReceived),this.paramSecond.downVideoCache[l]=e[t],e[t].packetsLost,e[t].packetsReceived,a.push(e[t])}else if(-1!==t.indexOf("_recv_")&&-1!==t.indexOf("_screen")){this.firstData.recvFirstData[l]||(this.firstData.recvFirstData[l]={recvFirstAudioFrame:!1,recvFirstVideoFrame:!1,recvFirstScreenFrame:!1,recvFirstAudioPackage:!1,recvFirstVideoPackage:!1,recvFirstScreenPackage:!1,videoTotalPlayDuration:0,screenTotalPlayDuration:0}),!this.firstData.recvFirstData[l].recvFirstScreenFrame&&e[t].framesDecoded>0?(this.firstData.recvFirstData[l].recvFirstScreenFrame=!0,this.adapterRef.instance.apiEventReport("setRecvFirstFrame",{media_type:2,pull_uid:l})):e[t].framesDecoded>0&&this.firstData.recvFirstData[l].screenTotalPlayDuration++,!this.firstData.recvFirstData[l].recvFirstScreenPackage&&e[t].packetsReceived>0&&(this.firstData.recvFirstData[l].recvFirstScreenPackage=!0,this.adapterRef.instance.apiEventReport("setRecvFirstPackage",{media_type:2,pull_uid:l})),this.paramSecond.downScreenCache[l]&&(this.paramSecond.downScreenCache[l].packetsLost,this.paramSecond.downScreenCache[l].packetsReceived,e[t].vlr=this.getPacketLossRate(this.paramSecond.downScreenCache[l],e[t]));let r=this.getRemoteScreenFreezeStats(this.paramSecond.downScreenCache[l],e[t],l);e[t].freezeTime=r.freezeTime,e[t].totalFreezeTime=r.totalFreezeTime,this.dispatchExceptionEventRecvScreen(this.paramSecond.downScreenCache[l],e[t],l),c+=parseInt(e[t].bytesReceived),this.paramSecond.downScreenCache[l]=e[t],e[t].packetsLost,e[t].packetsReceived,s.push(e[t])}else if(-1!==t.indexOf("Conn-")){this.publicIP=e[t]&&e[t].googLocalAddress.match(/([0-9\.]+)/)[1];let r="0"==e[t].googRtt?"1":e[t].googRtt;this.adapterRef.transportStats.txRtt=r,this.adapterRef.transportStats.rxRtt=r}else-1!==t.indexOf("local-candidate")?e[t].networkType&&(this.adapterRef.transportStats.NetworkType=e[t].networkType):-1!==t.indexOf("candidate-pair")&&-1!==t.indexOf("send")?t.split("_")[1]==this.adapterRef.channelInfo.uid&&(this.adapterRef.transportStats.OutgoingAvailableBandwidth=e[t].availableOutgoingBitrate/1e3):this.network=e[t]&&e[t].network}this.adapterRef.sessionStats.RecvBytes=c,this.adapterRef.sessionStats.SendBytes=u,1!==t&&(this._audioLevel.sort(p.compare("level")),this._audioLevel.length>0&&this._audioLevel[0].level>0&&this.adapterRef.instance.safeEmit("active-speaker",this._audioLevel[0]),t%2==0)&&(this.adapterRef.instance.safeEmit("volume-indicator",this._audioLevel),this.updateTxMediaInfo(r,n,i),this.updateRxMediaInfo(o,a,s),(this.infos2.tx2&&this.infos2.tx2[0].v_res.length)===this.infos.interval/2&&this.send())}updateOnce(){this.initInfoData(),this.send()}updateRxMediaInfo(e,t,r){let n={uid:[],a_p_volume:[],a_d_nor:[],a_d_plc:[],a_d_plccng:[],a_stuck:[],a_bps:[],a_p_lost_r:[],a_delay:[],a_acc_r:[]},i={v_res:[],v_fps:[],v_plis:[],v_stuck:[],v_bw_kbps:[],v_bps:[],v_p_lost_r:[],v_dec_ms:[],v_delay:[]},o={v_res:[],v_fps:[],v_plis:[],v_stuck:[],v_bw_kbps:[],v_bps:[],v_p_lost_r:[],v_dec_ms:[],v_delay:[]},a=0;e.map((e=>{let t="0";e.id&&(t=e.id.split("_")[3]),this.adapterRef.remoteAudioStats[t]&&(this.adapterRef.remoteAudioStats[t]={TotalFreezeTime:0});const r=this.adapterRef.remoteStreamMap[t];this.adapterRef.remoteAudioStats[t]={CodecType:"Opus",End2EndDelay:(parseInt(e.googCurrentDelayMs)||0)+(parseInt(e.googJitterBufferMs)||0),MuteState:r&&(r.muteStatus.audio.send||r.muteStatus.audio.recv),PacketLossRate:e.alr||0,RecvBitrate:e.bitsReceivedPerSecond||0,RecvLevel:parseInt(e.audioOutputLevel)||+e.audioLevel||0,TotalFreezeTime:e.totalFreezeTime||0,TotalPlayDuration:parseInt(e.totalSamplesDuration)||0,TransportDelay:parseInt(e.googCurrentDelayMs)||0},a+=e.bitsReceivedPerSecond,n.uid.push(t),n.a_p_volume.push(+(e.audioOutputLevel||e.audioLevel)||0),n.a_d_nor.push(parseInt(e.googDecodingNormal)||0),n.a_d_plc.push(parseInt(e.googDecodingPLC)||0),n.a_d_plccng.push(parseInt(e.googDecodingPLCCNG)||0),n.a_stuck.push(e.freezeTime||0),n.a_bps.push(e.bitsReceivedPerSecond||0),n.a_p_lost_r.push(e.alr||0),n.a_delay.push(parseInt(e.googJitterBufferMs)||0),n.a_acc_r.push(0)})),t.map((e=>{let t="0";e.id&&(t=e.id.split("_")[3]);const r=this.adapterRef.remoteStreamMap[t];this.adapterRef.remoteVideoStats[t]&&(this.adapterRef.remoteVideoStats[t]={TotalFreezeTime:0});const n=r&&r.Play&&r.Play.videoDom;this.adapterRef.remoteVideoStats[t]={LayerType:1,CodecName:e.googCodecName,End2EndDelay:(parseInt(e.googCurrentDelayMs)||0)+(parseInt(e.googJitterBufferMs)||0)+(parseInt(e.googRenderDelayMs)||0),MuteState:r&&(r.muteStatus.video.send||r.muteStatus.video.recv),PacketLossRate:e.vlr||0,RecvBitrate:e.bitsReceivedPerSecond||0,RecvResolutionHeight:parseInt(e.googFrameHeightReceived)||0,RecvResolutionWidth:parseInt(e.googFrameWidthReceived)||0,RenderFrameRate:parseInt(e.googFrameRateOutput)||0,RenderResolutionHeight:n?n.videoHeight:0,RenderResolutionWidth:n?n.videoWidth:0,TotalFreezeTime:e.totalFreezeTime||0,TotalPlayDuration:this.firstData.recvFirstData[t]&&this.firstData.recvFirstData[t].videoTotalPlayDuration||(n&&n.played&&n.played.length?n.played.end(0):0),TransportDelay:parseInt(e.googCurrentDelayMs)||0},a+=e.bitsReceivedPerSecond,i.v_res.push((e.googFrameWidthReceived||0)+"x"+(e.googFrameHeightReceived||0)),i.v_fps.push(parseInt(e.googFrameRateOutput)),i.v_plis.push(parseInt(e.googPlisSent)),i.v_stuck.push(e.freezeTime||0),i.v_bw_kbps.push(0),i.v_bps.push(e.bitsReceivedPerSecond||0),i.v_p_lost_r.push(e.vlr||0),i.v_dec_ms.push(parseInt(e.googDecodeMs)||0),i.v_delay.push(parseInt(e.googJitterBufferMs))})),r.map((e=>{let t=0;e.id&&(t=+e.id.split("_")[3]);const r=this.adapterRef.remoteStreamMap[t];this.adapterRef.remoteScreenStats[t]&&(this.adapterRef.remoteScreenStats[t]={TotalFreezeTime:0});const n=r&&r.Play&&r.Play.screenDom;this.adapterRef.remoteScreenStats[t]={LayerType:2,CodecName:e.googCodecName,End2EndDelay:(parseInt(e.googCurrentDelayMs)||0)+(parseInt(e.googJitterBufferMs)||0)+(parseInt(e.googRenderDelayMs)||0),MuteState:r&&(r.muteStatus.screen.send||r.muteStatus.screen.recv),PacketLossRate:e.vlr||0,RecvBitrate:e.bitsReceivedPerSecond||0,RecvResolutionHeight:parseInt(e.googFrameHeightReceived)||0,RecvResolutionWidth:parseInt(e.googFrameWidthReceived)||0,RenderFrameRate:parseInt(e.googFrameRateOutput)||0,RenderResolutionHeight:n?n.videoHeight:0,RenderResolutionWidth:n?n.videoWidth:0,TotalFreezeTime:e.totalFreezeTime||0,TotalPlayDuration:this.firstData.recvFirstData[t]&&this.firstData.recvFirstData[t].screenTotalPlayDuration||(n&&n.played&&n.played.length?n.played.end(0):0),TransportDelay:parseInt(e.googCurrentDelayMs)||0},a+=e.bitsReceivedPerSecond,o.v_res.push((e.googFrameWidthReceived||0)+"x"+(e.googFrameHeightReceived||0)),o.v_fps.push(parseInt(e.googFrameRateOutput)),o.v_plis.push(parseInt(e.googPlisSent)),o.v_stuck.push(e.freezeTime||0),o.v_bw_kbps.push(0),o.v_bps.push(e.bitsReceivedPerSecond||0),o.v_p_lost_r.push(e.vlr||0),o.v_dec_ms.push(parseInt(e.googDecodeMs)||0),o.v_delay.push(parseInt(e.googJitterBufferMs))})),this.adapterRef.sessionStats.RecvBitrate=a,this.infos2.rx2.push({uid:n.uid,a_p_volume:n.a_p_volume,a_d_nor:n.a_d_nor,a_d_plc:n.a_d_plc,a_d_plccng:n.a_d_plccng,a_stuck:n.a_stuck,a_bps:n.a_bps,a_p_lost_r:n.a_p_lost_r,a_delay:n.a_delay,a_acc_r:n.a_acc_r,v_res:i.v_res,v_fps:i.v_fps,v_plis:i.v_plis,v_stuck:i.v_stuck,v_bw_kbps:i.v_bw_kbps,v_bps:i.v_bps,v_p_lost_r:i.v_p_lost_r,v_dec_ms:i.v_dec_ms,v_delay:i.v_delay,s_res:o.v_res,s_fps:o.v_fps,s_plis:o.v_plis,s_stuck:o.v_stuck,s_bw_kbps:o.v_bw_kbps,s_bps:o.v_bps,s_p_lost_r:o.v_p_lost_r,s_dec_ms:o.v_dec_ms,s_delay:o.v_delay})}getLocalMediaStats(e,t,r){let n={a_lost:e[0]&&e[0].alr||0,v_lost:t[0]&&t[0].vlr||0,s_lost:r[0]&&r[0].vlr||0,rtt:parseInt(t[0]&&t[0].googRtt)||0,rtt_mdev:-1,set_v_fps:parseInt(this.adapterRef.channelInfo.sessionConfig.frameRate)||0,v_cap_fps:parseInt(t[0]&&t[0].googFrameRateInput)||0,s_cap_fps:parseInt(r[0]&&r[0].googFrameRateInput)||0,qos_v_fps:parseInt(t[0]&&t[0].googFrameRateInput)||0,qos_s_fps:parseInt(r[0]&&r[0].googFrameRateInput)||0,v_fps:parseInt(t[0]&&t[0].googFrameRateSent)||0,s_fps:parseInt(r[0]&&r[0].googFrameRateSent)||0,set_v_quality:this.adapterRef.channelInfo.sessionConfig.videoQuality,real_v_res:(t[0]&&t[0].googFrameWidthSent||0)+"x"+(t[0]&&t[0].googFrameHeightSent||0),real_s_res:(r[0]&&r[0].googFrameWidthSent||0)+"x"+(r[0]&&r[0].googFrameHeightSent||0),real_v_kbps:parseFloat(t[0]&&t[0].googActualEncBitrate)||0,real_s_kbps:parseFloat(r[0]&&r[0].googActualEncBitrate)||0,real_v_kbps_n:parseFloat(t[0]&&t[0].googTransmitBitrate)||0,real_s_kbps_n:parseFloat(r[0]&&r[0].googTransmitBitrate)||0,real_a_kbps:-1,real_a_kbps_n:e[0]?e[0].bitsSentPerSecond:0,set_v_kbps:-1,qos_v_kbps:-1,a_volume:parseInt(e[0]&&e[0].audioInputLevel)||0,a_cap_volume:this.adapterRef.localStream&&Math.round(32768*this.adapterRef.localStream.getAudioLevel())||0,a_codec:e[0]&&e[0].googCodecName||"opus",a_stream_ended:this.LocalAudioEnable||!1,a_ssrc:e[0]&&e[0].ssrc||"",v_codec:t[0]&&t[0].googCodecName||"h264",s_codec:r[0]&&r[0].googCodecName||"h264",v_stream_ended:this.localVideoEnable||!1,s_stream_ended:this.localScreenEnable||!1,v_ssrc:t[0]&&t[0].ssrc||"",s_ssrc:r[0]&&r[0].ssrc||""},i=48;if(this.adapterRef.localStream&&"speech_low_quality"==this.adapterRef.localStream.audioProfile?i=16:this.adapterRef.localStream&&"speech_standard"==this.adapterRef.localStream.audioProfile&&(i=32),this.adapterRef.sessionStats.SendBitrate=n.real_v_kbps_n+n.real_a_kbps_n,!this.adapterRef.localStream)throw new u.default({code:l.default.NO_LOCALSTREAM,message:"No localStream"});return this.adapterRef.localAudioStats[0]={CodecType:"Opus",MuteState:this.adapterRef.localStream.muteStatus.audio.send,RecordingLevel:n.a_volume,SamplingRate:i,SendBitrate:n.real_a_kbps_n,SendLevel:n.a_volume},this.adapterRef.localVideoStats[0]={LayerType:1,CodecName:t[0]&&t[0].googCodecName,CaptureFrameRate:n.v_cap_fps,CaptureResolutionHeight:parseInt(t[0]&&t[0].googFrameHeightInput)||0,CaptureResolutionWidth:parseInt(t[0]&&t[0].googFrameWidthInput)||0,EncodeDelay:parseInt(t[0]&&t[0].googAvgEncodeMs)||0,MuteState:this.adapterRef.localStream.muteStatus.video.send,SendBitrate:n.real_v_kbps_n,SendFrameRate:n.v_fps,SendResolutionHeight:parseInt(t[0]&&t[0].googFrameHeightSent)||0,SendResolutionWidth:parseInt(t[0]&&t[0].googFrameWidthSent)||0,TargetSendBitrate:parseInt(t[0]&&t[0].googTargetEncBitrate)||0,TotalDuration:this.adapterRef.state.startPubVideoTime?(Date.now()-this.adapterRef.state.startPubVideoTime)/1e3:0,TotalFreezeTime:t[0]?t[0].totalFreezeTime:0},this.adapterRef.localScreenStats[0]={LayerType:2,CodecName:r[0]&&r[0].googCodecName,CaptureFrameRate:n.s_cap_fps,CaptureResolutionHeight:parseInt(r[0]&&r[0].googFrameHeightInput)||0,CaptureResolutionWidth:parseInt(r[0]&&r[0].googFrameWidthInput)||0,EncodeDelay:parseInt(r[0]&&r[0].googAvgEncodeMs)||0,MuteState:this.adapterRef.localStream.muteStatus.screen.send,SendBitrate:n.real_s_kbps_n,SendFrameRate:n.s_fps,SendResolutionHeight:parseInt(r[0]&&r[0].googFrameHeightSent)||0,SendResolutionWidth:parseInt(r[0]&&r[0].googFrameWidthSent)||0,TargetSendBitrate:parseInt(r[0]&&r[0].googTargetEncBitrate)||0,TotalDuration:this.adapterRef.state.startPubScreenTime?(Date.now()-this.adapterRef.state.startPubScreenTime)/1e3:0,TotalFreezeTime:r[0]?r[0].totalFreezeTime:0},this.infos2.tx2[0].v_res.push(n.real_v_res),this.infos2.tx2[0].v_fps.push(n.v_fps),this.infos2.tx2[0].v_plis.push(t[0]&&t[0].googPlisReceived),this.infos2.tx2[0].v_rtt.push(n.rtt),this.infos2.tx2[0].v_simulcast.push(0),this.infos2.tx2[0].v_bw_kbps.push(t[0]&&t[0].googAvailableSendBandwidth),this.infos2.tx2[0].v_tar_kbps.push(t[0]&&t[0].googTargetEncBitrate),this.infos2.tx2[0].v_rel_kbps.push(t[0]&&t[0].googActualEncBitrate),this.infos2.tx2[0].v_tx_kbps.push(t[0]&&t[0].googTransmitBitrate),this.infos2.tx2[0].v_retx_kbps.push(t[0]&&t[0].googRetransmitBitrate),this.infos2.tx2[0].v_delay.push(0),this.infos2.tx2[0].s_res.push(n.real_s_res),this.infos2.tx2[0].s_fps.push(n.s_fps),this.infos2.tx2[0].s_plis.push(r[0]&&r[0].googPlisReceived),this.infos2.tx2[0].s_rtt.push(n.rtt),this.infos2.tx2[0].s_simulcast.push(0),this.infos2.tx2[0].s_bw_kbps.push(r[0]&&r[0].googAvailableSendBandwidth),this.infos2.tx2[0].s_tar_kbps.push(r[0]&&r[0].googTargetEncBitrate),this.infos2.tx2[0].s_rel_kbps.push(r[0]&&r[0].googActualEncBitrate),this.infos2.tx2[0].s_tx_kbps.push(r[0]&&r[0].googTransmitBitrate),this.infos2.tx2[0].s_retx_kbps.push(r[0]&&r[0].googRetransmitBitrate),this.infos2.tx2[0].s_delay.push(0),this.infos2.tx2[0].a_cap_volume.push(n.a_cap_volume),this.infos2.tx2[0].a_rtt.push(e[0]&&e[0].googRtt),n}updateTxMediaInfo(e,t,r){if(!this.adapterRef.localStream)return;this.getLocalMediaStats(e,t,r);let n=((navigator.connection||{}).type||"unknown").toString().toLowerCase();this.infos.net=p.convertNetwork(this.network||n)}dispatchExceptionEventSendAudio(e,t,r){var n,i;if(!e||!t)return;const o=null===(n=this.adapterRef.localStream)||void 0===n?void 0:n.muteStatus.audio.send,a=null===(i=this.adapterRef.localStream)||void 0===i?void 0:i.pubStatus.audio.audio;!0!==o&&!1!==a&&(0===parseInt(t.audioInputLevel)&&this.adapterRef.instance.emit("exception",{msg:"AUDIO_INPUT_LEVEL_TOO_LOW",code:2001,uid:r}),0==parseInt(t.bytesSent)-parseInt(e.bytesSent)&&this.adapterRef.instance.emit("exception",{msg:"SEND_AUDIO_BITRATE_TOO_LOW",code:2003,uid:r}))}dispatchExceptionEventSendVideo(e,t,r){var n,i;if(!e||!t)return;const o=null===(n=this.adapterRef.localStream)||void 0===n?void 0:n.muteStatus.video.send,a=null===(i=this.adapterRef.localStream)||void 0===i?void 0:i.pubStatus.video.video;!0!==o&&!1!==a&&(parseInt(t.googFrameRateInput)>5&&parseInt(t.googFrameRateSent)<=1&&this.adapterRef.instance.emit("exception",{msg:"FRAMERATE_SENT_TOO_LOW",code:1002,uid:r}),0==parseInt(t.bytesSent)-parseInt(e.bytesSent)&&this.adapterRef.instance.emit("exception",{msg:"FRAMERATE_VIDEO_BITRATE_TOO_LOW",code:1003,uid:r}))}dispatchExceptionEventRecvAudio(e,t,r){if(!e||!t)return;const n=this.adapterRef.remoteStreamMap[r],i=n&&(n.muteStatus.audio.send||n.muteStatus.audio.recv);if(n&&i)return;let o=parseInt(t.bytesReceived)-parseInt(e.bytesReceived),a=parseInt(t.googDecodingNormal)-parseInt(e.googDecodingNormal);if(o>0&&0===a&&this.adapterRef.instance.emit("exception",{msg:"RECV_AUDIO_DECODE_FAILED",code:2005,uid:r}),o>0&&a>0&&0==+(t.audioOutputLevel||t.audioLevel)){const e=n&&n.Play&&n.Play.audioDom&&n.Play.audioDom.volume;e&&e>0&&this.adapterRef.instance.emit("exception",{msg:"AUDIO_OUTPUT_LEVEL_TOO_LOW",code:2002,uid:r})}}dispatchExceptionEventRecvVideo(e,t,r){if(!e||!t)return;const n=this.adapterRef.remoteStreamMap[r],i=n&&(n.muteStatus.video.send||n.muteStatus.video.recv);n&&i||parseInt(t.bytesReceived)-parseInt(e.bytesReceived)>0&&0===parseInt(t.googFrameRateDecoded)&&this.adapterRef.instance.emit("exception",{msg:"RECV_VIDEO_DECODE_FAILED",code:1005,uid:r})}dispatchExceptionEventRecvScreen(e,t,r){if(!e||!t)return;const n=this.adapterRef.remoteStreamMap[r],i=n&&(n.muteStatus.screen.send||n.muteStatus.screen.recv);n&&i||parseInt(t.bytesReceived)-parseInt(e.bytesReceived)>0&&0===parseInt(t.googFrameRateDecoded)&&this.adapterRef.instance.emit("exception",{msg:"RECV_SCREEN_DECODE_FAILED",code:1005,uid:r})}getRemoteAudioFreezeStats(e,t,r){if(!e||!t)return{totalFreezeTime:0,freezeTime:0};let n=parseInt(e.googDecodingPLC)+parseInt(e.googDecodingCNG)+parseInt(e.googDecodingPLCCNG),i=parseInt(e.googDecodingCTN),o=parseInt(t.googDecodingPLC)+parseInt(t.googDecodingCNG)+parseInt(t.googDecodingPLCCNG),a=parseInt(t.googDecodingCTN);if(a<=n)return{totalFreezeTime:0,freezeTime:0};let s=(o-n)/(a-i);return{totalFreezeTime:parseInt(1e3*s),freezeTime:10*s>1?parseInt(10*s):s>0?1:0}}getLocalVideoFreezeStats(e,t){let r=0;if(!e)return{totalFreezeTime:r,freezeTime:0};let n=parseInt(e.googFrameRateInput),i=parseInt(e.googFrameRateSent),o=Math.abs(n-i-2);r=parseInt(o/n*2e3);let a=0;return r<300?(r=0,a=0):a=r>1500?6:parseInt(r/300),{totalFreezeTime:r,freezeTime:a}}getLocalScreenFreezeStats(e,t){let r=0;if(!e)return{totalFreezeTime:r,freezeTime:0};let n=parseInt(e.googFrameRateInput),i=parseInt(e.googFrameRateSent),o=Math.abs(n-i-2);r=parseInt(o/n*2e3);let a=0;return r<300?(r=0,a=0):a=r>1500?6:parseInt(r/300),{totalFreezeTime:r,freezeTime:a}}getRemoteVideoFreezeStats(e,t,r){let n=0;if(!t||0==t.framesDecoded)return{totalFreezeTime:n,freezeTime:0};if(t&&"0"==t.googFrameRateDecoded&&t.framesDecoded)return{totalFreezeTime:2e3,freezeTime:6};let i=parseInt(t.googFrameRateReceived)||0,o=parseInt(t.googFrameRateDecoded),a=Math.abs(o-i-2);if(i>15)return{totalFreezeTime:0,freezeTime:0};a=Math.abs(15-i),n=parseInt(a/15*2e3),n>2e3&&(n=2e3);let s=0;return n<300?(n=0,s=0):s=n>1500?6:parseInt(n/300),{totalFreezeTime:n,freezeTime:s}}getRemoteScreenFreezeStats(e,t,r){let n=0;if(!t)return{totalFreezeTime:n,freezeTime:0};let i=parseInt(t.googFrameRateReceived),o=parseInt(t.googFrameRateDecoded),a=Math.abs(o-i-2);n=parseInt(a/o*2e3)||0;let s=0;return n<300?(n=0,s=0):s=n>1500?6:parseInt(n/300),{totalFreezeTime:n,freezeTime:s}}send(){if(!this.infos.uid||!this.infos.cid)return;if(!1===navigator.onLine)return void console.warn("侦测到网络不在线，暂停上报");let e=new s.DataReport({adapterRef:this.adapterRef});e.setHeartbeat({name:"setHeartbeat",uid:""+this.adapterRef.channelInfo.uid,cid:""+this.adapterRef.channelInfo.cid}),e.send(),this.clearInfoData()}destroy(){this.resetStatus(),this._reset()}};let p={convertNetwork:e=>({wlan:"wifi",lan:"ethernet"}[e]||"unknown"),convertPlatform(e){let t;return t=/Windows/i.test(e)?"Win":e,t=/OS X/i.test(t)?"Mac":t,t},compare:e=>function(t,r){var n=t[e],i=r[e];return 0===i||i?0===n||n?i-n:1:-1}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(130),i=new class{constructor(){this.intervalMap_=new Map}setInterval(e,t,r=!0){const i=n.generateUUID();let o=Date.now(),a=o;this.intervalMap_.set(i,{rafId:null,timeoutId:null,onVisibilityChange:null});const s=()=>{if(r&&document.hidden){e();const r=setTimeout(s,t);this.setTimeoutId(i,r),o=Date.now(),a=o}else{a=Date.now(),a-o>=t&&(o=a,e());const r=requestAnimationFrame(s);this.setRafId(i,r)}},c=requestAnimationFrame(s);if(this.setRafId(i,c),r){const e=()=>{if(document.hidden){const e=Date.now()-o;if(e>=t)s();else{const r=setTimeout(s,t-e);this.setTimeoutId(i,r)}}};document.addEventListener("visibilitychange",e),this.setOnVisibilityChange(i,e)}return i}clearInterval(e){if(this.intervalMap_.has(e)){const{rafId:t,timeoutId:r,onVisibilityChange:n}=this.intervalMap_.get(e);cancelAnimationFrame(t),clearTimeout(r),document.removeEventListener("visibilitychange",n),this.intervalMap_.delete(e)}}setTimeoutId(e,t){if(this.intervalMap_.has(e)){const r=this.intervalMap_.get(e);r.timeoutId&&clearTimeout(r.timeoutId),r.timeoutId=t}}setRafId(e,t){if(this.intervalMap_.has(e)){const r=this.intervalMap_.get(e);r.rafId&&cancelAnimationFrame(r.rafId),r.rafId=t}}setOnVisibilityChange(e,t){this.intervalMap_.has(e)&&(this.intervalMap_.get(e).onVisibilityChange=t)}};t.default=i},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const a=r(3),s=r(235),c=o(r(236)),u=r(253);let l=new Uint8Array(1);l[0]=10;const d=l;t.default=class{constructor(e){this.lastLogTime=0,this.cachedLogs=[],this.textEncoder=new TextEncoder,this.url_=e.url,this.socket_=null,this.isConnected_=!1,this.isConnecting_=!1,this.pingPongTimeoutId_=-1,this.pingTimeoutId_=-1,this.reconnectionTimer_=-1,this.reconnectionCount_=0,this.emitter_=new a.EventEmitter,this.adapterRef=e.adapterRef,this.logger=this.adapterRef.logger.getChild((()=>"wsTransport"))}init(){this.logger.log("connect to url: "+this.url_),this.socket_=new WebSocket(this.url_),this.bindSocket(this.socket_)}bindSocket(e){e.onopen=this.onopen.bind(this),e.onclose=this.onclose.bind(this),e.onerror=this.onerror.bind(this),e.onmessage=this.onmessage.bind(this)}unbindSocket(e){e.onopen=()=>{},e.onclose=()=>{},e.onerror=()=>{},e.onmessage=()=>{}}onopen(e){if(this.isConnected_)return;this.isConnected_=!0,this.isConnecting_=!1;const t=e.target.url;this.logger.log(`websocket[${t}] is connected`),this.startPingPong()}onclose(e){const t=e.target.url,r=e.target===this.socket_;this.logger.log(`websocket[${t} InUse: ${r}] is closed with code: ${e.code}`),this.socket_&&e.target===this.socket_&&(this.isConnected_=!1,e.wasClean&&1e3===e.code?this.close():(this.logger.warn(`onclose code:${e.code} reason:${e.reason}`),this.socket_.onclose=()=>{},this.socket_.close(4001),this.socket_=null,this.reconnect()))}onerror(e){const t=e.target.url;this.logger.warn(`websocket[${t}] error observed`),this.isConnected_?e.target===this.socket_&&(this.isConnected_=!1,this.socket_=null,this.reconnect()):this.reconnect(),this.isConnecting_=!1,this.isConnected_=!1}onmessage(e){this.isConnected_&&e&&e.data&&(11===JSON.parse(e.data).action&&this.emit(11,e),this.clearReconnectionTimer())}isConnected(){return this.isConnected_}sendPB(e){var t;if(this.isConnected_){const r=this.createPBMessage(e);1===(null===(t=this.socket_)||void 0===t?void 0:t.readyState)&&this.socket_.send(r)}}sendPing(e){var t;this.isConnected_&&1===(null===(t=this.socket_)||void 0===t?void 0:t.readyState)&&this.socket_.send(e)}sendLog(e){var t,r;const n=Math.max(this.lastLogTime+1,Date.now());this.lastLogTime=n;try{this.cachedLogs.length&&this.cachedLogs[this.cachedLogs.length-1].data[0].replace("[NERTC","[缓存][NERTC")}catch(e){}if(this.cachedLogs.push({time:n,data:e}),this.cachedLogs.length>50&&this.cachedLogs.shift(),this.isConnected_&&1===(null===(t=this.socket_)||void 0===t?void 0:t.readyState)&&(null===(r=this.adapterRef.channelInfo)||void 0===r?void 0:r.cid)){const t=this.cachedLogs;this.cachedLogs=[];for(let r of t){const t=Object.assign({uid:this.adapterRef.channelInfo.uid,cid:this.adapterRef.channelInfo.cid},r);try{const e=this.textEncoder.encode(JSON.stringify(t));let r=[5,1,1,1,2,0,0,0],n=Uint8Array.from(r.concat(Array.from(e)));this.socket_.send(n)}catch(e){}}}}createPBMessage(e){let t=c.Root.fromJSON(u).lookupType("WebrtcStats"),r=t.create(e),n=t.encode(r).finish();return Uint8Array.from([4,1,1,1,1,0,0,0].concat(Array.from(n)))}async startPingPong(){try{if(-1!==this.pingPongTimeoutId_)return;await this.ping(),this.pingPongTimeoutId_=setTimeout((()=>{this.pingPongTimeoutId_=-1,this.startPingPong()}),1e4)}catch(e){this.logger.log("ping-pong failed, start reconnection"),this.clearSocket(),this.reconnect()}}stopPingPong(){this.logger.log("stop ping pong"),clearTimeout(this.pingTimeoutId_),clearTimeout(this.pingPongTimeoutId_),this.pingTimeoutId_=-1,this.pingPongTimeoutId_=-1}ping(){return new Promise(((e,t)=>{if(-1!==this.pingTimeoutId_)return e();this.sendPing(d),this.once(11,(()=>{clearTimeout(this.pingTimeoutId_),this.pingTimeoutId_=-1,e()})),this.pingTimeoutId_=setTimeout((()=>{this.pingTimeoutId_=-1,t()}),1e4)}))}reconnect(){if(this.isConnecting_||-1!==this.reconnectionTimer_)return void this.logger.log("websocket is reconnecting");this.isConnecting_=!0,this.reconnectionCount_++,this.socket_=new WebSocket(this.url_),this.bindSocket(this.socket_);const e=s.getReconnectionTimeout(this.reconnectionCount_);this.reconnectionTimer_=setTimeout((()=>{this.isConnecting_=!1,this.clearReconnectionTimer(),this.socket_&&this.unbindSocket(this.socket_),this.socket_=null,this.reconnect()}),e)}clearReconnectionTimer(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}once(e,t,r){this.emitter_.once(e,t,r)}emit(e,t,r){this.emitter_.emit(e,t,r)}clearSocket(){this.socket_&&this.unbindSocket(this.socket_),this.isConnected_=!1,this.isConnecting_=!1,this.socket_=null}close(){var e;this.logger.log("close websocket"),this.clearReconnectionTimer(),this.stopPingPong(),null===(e=this.socket_)||void 0===e||e.close(),this.clearSocket()}}},function(e,t,r){function n(e,t=1,r=1){return e<=1?r:n(e-1,r,t+r)}Object.defineProperty(t,"__esModule",{value:!0}),t.getReconnectionTimeout=t.fibonacci=void 0,t.fibonacci=n,t.getReconnectionTimeout=function(e){const t=Math.round(e/2)+1;return t>6?13e3:1e3*n(t)}},function(e,t,r){e.exports=r(237)},function(e,t,r){var n=e.exports=r(131);n.build="full",n.tokenize=r(141),n.parse=r(251),n.common=r(252),n.Root._configure(n.Type,n.parse,n.common)},function(e,t,r){var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(79),n.BufferWriter=r(245),n.Reader=r(80),n.BufferReader=r(246),n.util=r(10),n.rpc=r(134),n.roots=r(135),n.configure=i,i()},function(e,t,r){var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=new Array(64),o=new Array(123),a=0;a<64;)o[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,r){for(var n,o=null,a=[],s=0,c=0;t<r;){var u=e[t++];switch(c){case 0:a[s++]=i[u>>2],n=(3&u)<<4,c=1;break;case 1:a[s++]=i[n|u>>4],n=(15&u)<<2,c=2;break;case 2:a[s++]=i[n|u>>6],a[s++]=i[63&u],c=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=i[n],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},n.decode=function(e,t,r){for(var n,i=r,a=0,s=0;s<e.length;){var c=e.charCodeAt(s++);if(61===c&&a>1)break;if(void 0===(c=o[c]))throw Error("invalid encoding");switch(a){case 0:n=c,a=1;break;case 1:t[r++]=n<<2|(48&c)>>4,n=c,a=2;break;case 2:t[r++]=(15&n)<<4|(60&c)>>2,n=c,a=3;break;case 3:t[r++]=(3&n)<<6|c,a=0}}if(1===a)throw Error("invalid encoding");return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,r){function n(){this._listeners={}}e.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},function(e,t,r){function n(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function s(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?a:s,e.readFloatBE=n?s:a}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,a=8388607&n;return 255===o?a?NaN:i*(1/0):0===o?1401298464324817e-60*i*a:i*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function s(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?a:s,e.readDoubleBE=n?s:a}():function(){function t(e,t,r,n,i,o){var a=n<0?1:0;if(a&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>17976931348623157e292)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+r);else{var s;if(n<22250738585072014e-324)e((s=n/5e-324)>>>0,i,o+t),e((a<<31|s/4294967296)>>>0,i,o+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(s=n*Math.pow(2,-c))>>>0,i,o+t),e((a<<31|c+1023<<20|1048576*s&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),a=e(n,i+r),s=2*(a>>31)+1,c=a>>>20&2047,u=4294967296*(1048575&a)+o;return 2047===c?u?NaN:s*(1/0):0===c?5e-324*s*u:s*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,s,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=n(n)},function(e,t,r){var n=t;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],a=0;t<r;)(n=e[t++])<128?o[a++]=n:n>191&&n<224?o[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(n>>10),o[a++]=56320+(1023&n)):o[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},n.write=function(e,t,r){for(var n,i,o=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}},function(e,t,r){e.exports=function(e,t,r){var n=r||8192,i=n>>>1,o=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(o=e(n),a=0);var s=t.call(o,a,a+=r);return 7&a&&(a=1+(7|a)),s}}},function(e,t,r){e.exports=i;var n=r(10);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?o:new i((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){e.exports=o;var n=r(79);(o.prototype=Object.create(n.prototype)).constructor=o;var i=r(10);function o(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}o._configure=function(){o.alloc=i._Buffer_allocUnsafe,o.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},o.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},o._configure()},function(e,t,r){e.exports=o;var n=r(80);(o.prototype=Object.create(n.prototype)).constructor=o;var i=r(10);function o(e){n.call(this,e)}o._configure=function(){i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()},function(e,t,r){e.exports=i;var n=r(10);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return n.asPromise(e,s,t,r,i,o);if(s.rpcImpl)try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return s.emit("error",e,t),a(e);if(null!==r){if(!(r instanceof i))try{r=i[s.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return s.emit("error",e,t),a(e)}return s.emit("data",r,t),a(null,r)}s.end(!0)}))}catch(e){return s.emit("error",e,t),void setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){function n(e,t){"string"==typeof e&&(t=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var t=o();if(n.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var a=Object.keys(e),s=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)s[u]=a[u],c[u]=e[a[u++]];return s[u]=t,Function.apply(null,s).apply(null,c)}return Function(t)()}for(var l=new Array(arguments.length-1),d=0;d<l.length;)l[d]=arguments[++d];if(d=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var r=l[d++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"})),d!==l.length)throw Error("parameter count mismatch");return r.push(e),i}function o(n){return"function "+(n||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=o,i}e.exports=n,n.verbose=!1},function(e,t,r){e.exports=o;var n=r(132),i=r(133)("fs");function o(e,t,r){return"function"==typeof t?(r=t,t={}):t||(t={}),r?!t.xhr&&i&&i.readFile?i.readFile(e,(function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?o.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))})):o.xhr(e,t,r):n(o,this,e,t)}o.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},function(e,t,r){var n=t,i=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},o=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=i(e),n="";r&&(n=t.shift()+"/");for(var o=0;o<t.length;)".."===t[o]?o>0&&".."!==t[o-1]?t.splice(--o,2):r?t.splice(o,1):++o:"."===t[o]?t.splice(o,1):++o;return n+t.join("/")};n.resolve=function(e,t,r){return r||(t=o(t)),i(t)?t:(r||(e=o(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?o(e+"/"+t):t)}},function(e,t,r){e.exports=w,w.filename=null,w.defaults={keepCase:!1};var n=r(141),i=r(86),o=r(81),a=r(24),s=r(82),c=r(44),u=r(8),l=r(83),d=r(84),p=r(30),f=r(4),h=/^[1-9][0-9]*$/,m=/^-?[1-9][0-9]*$/,g=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,y=/^0[0-7]+$/,b=/^-?0[0-7]+$/,S=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,_=/^[a-zA-Z_][a-zA-Z_0-9]*$/,M=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,T=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function w(e,t,r){t instanceof i||(r=t,t=new i),r||(r=w.defaults);var x,I,E,A,C,k=r.preferTrailingComment||!1,O=n(e,r.alternateCommentMode||!1),N=O.next,R=O.push,P=O.peek,D=O.skip,j=O.cmnt,L=!0,z=!1,U=t,B=r.keepCase?function(e){return e}:f.camelCase;function F(e,t,r){var n=w.filename;return r||(w.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+O.line+")")}function V(){var e,t=[];do{if('"'!==(e=N())&&"'"!==e)throw F(e);t.push(N()),D(e),e=P()}while('"'===e||"'"===e);return t.join("")}function H(e){var t=N();switch(t){case"'":case'"':return R(t),V();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return r*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(h.test(e))return r*parseInt(e,10);if(g.test(e))return r*parseInt(e,16);if(y.test(e))return r*parseInt(e,8);if(S.test(e))return r*parseFloat(e);throw F(e,"number",!0)}(t)}catch(r){if(e&&M.test(t))return t;throw F(t,"value")}}function $(e,t){var r,n;do{!t||'"'!==(r=P())&&"'"!==r?e.push([n=W(N()),D("to",!0)?W(N()):n]):e.push(V())}while(D(",",!0));D(";")}function W(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw F(e,"id");if(m.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(b.test(e))return parseInt(e,8);throw F(e,"id")}function Y(){if(void 0!==x)throw F("package");if(x=N(),!M.test(x))throw F(x,"name");U=U.define(x),D(";")}function G(){var e,t=P();switch(t){case"weak":e=E||(E=[]),N();break;case"public":N();default:e=I||(I=[])}t=V(),D(";"),e.push(t)}function Q(){if(D("="),A=V(),!(z="proto3"===A)&&"proto2"!==A)throw F(A,"syntax");D(";")}function q(e,t){switch(t){case"option":return K(e,t),D(";"),!0;case"message":return function(e,t){if(!_.test(t=N()))throw F(t,"type name");var r=new o(t);J(r,(function(e){if(!q(r,e))switch(e){case"map":!function(e){D("<");var t=N();if(void 0===p.mapKey[t])throw F(t,"type");D(",");var r=N();if(!M.test(r))throw F(r,"type");D(">");var n=N();if(!_.test(n))throw F(n,"name");D("=");var i=new s(B(n),W(N()),t,r);J(i,(function(e){if("option"!==e)throw F(e);K(i,e),D(";")}),(function(){te(i)})),e.add(i)}(r);break;case"required":case"repeated":Z(r,e);break;case"optional":Z(r,z?"proto3_optional":"optional");break;case"oneof":!function(e,t){if(!_.test(t=N()))throw F(t,"name");var r=new c(B(t));J(r,(function(e){"option"===e?(K(r,e),D(";")):(R(e),Z(r,"optional"))})),e.add(r)}(r,e);break;case"extensions":$(r.extensions||(r.extensions=[]));break;case"reserved":$(r.reserved||(r.reserved=[]),!0);break;default:if(!z||!M.test(e))throw F(e);R(e),Z(r,"optional")}})),e.add(r)}(e,t),!0;case"enum":return function(e,t){if(!_.test(t=N()))throw F(t,"name");var r=new u(t);J(r,(function(e){switch(e){case"option":K(r,e),D(";");break;case"reserved":$(r.reserved||(r.reserved=[]),!0);break;default:!function(e,t){if(!_.test(t))throw F(t,"name");D("=");var r=W(N(),!0),n={};J(n,(function(e){if("option"!==e)throw F(e);K(n,e),D(";")}),(function(){te(n)})),e.add(t,r,n.comment)}(r,e)}})),e.add(r)}(e,t),!0;case"service":return function(e,t){if(!_.test(t=N()))throw F(t,"service name");var r=new l(t);J(r,(function(e){if(!q(r,e)){if("rpc"!==e)throw F(e);!function(e,t){var r=j(),n=t;if(!_.test(t=N()))throw F(t,"name");var i,o,a,s,c=t;if(D("("),D("stream",!0)&&(o=!0),!M.test(t=N()))throw F(t);if(i=t,D(")"),D("returns"),D("("),D("stream",!0)&&(s=!0),!M.test(t=N()))throw F(t);a=t,D(")");var u=new d(c,n,i,a,o,s);u.comment=r,J(u,(function(e){if("option"!==e)throw F(e);K(u,e),D(";")})),e.add(u)}(r,e)}})),e.add(r)}(e,t),!0;case"extend":return function(e,t){if(!M.test(t=N()))throw F(t,"reference");var r=t;J(null,(function(t){switch(t){case"required":case"repeated":Z(e,t,r);break;case"optional":Z(e,z?"proto3_optional":"optional",r);break;default:if(!z||!M.test(t))throw F(t);R(t),Z(e,"optional",r)}}))}(e,t),!0}return!1}function J(e,t,r){var n=O.line;if(e&&("string"!=typeof e.comment&&(e.comment=j()),e.filename=w.filename),D("{",!0)){for(var i;"}"!==(i=N());)t(i);D(";",!0)}else r&&r(),D(";"),e&&("string"!=typeof e.comment||k)&&(e.comment=j(n)||e.comment)}function Z(e,t,r){var n=N();if("group"!==n){if(!M.test(n))throw F(n,"type");var i=N();if(!_.test(i))throw F(i,"name");i=B(i),D("=");var s=new a(i,W(N()),n,t,r);if(J(s,(function(e){if("option"!==e)throw F(e);K(s,e),D(";")}),(function(){te(s)})),"proto3_optional"===t){var u=new c("_"+i);s.setOption("proto3_optional",!0),u.add(s),e.add(u)}else e.add(s);z||!s.repeated||void 0===p.packed[n]&&void 0!==p.basic[n]||s.setOption("packed",!1,!0)}else!function(e,t){var r=N();if(!_.test(r))throw F(r,"name");var n=f.lcFirst(r);r===n&&(r=f.ucFirst(r)),D("=");var i=W(N()),s=new o(r);s.group=!0;var c=new a(n,i,r,t);c.filename=w.filename,J(s,(function(e){switch(e){case"option":K(s,e),D(";");break;case"required":case"repeated":Z(s,e);break;case"optional":Z(s,z?"proto3_optional":"optional");break;default:throw F(e)}})),e.add(s).add(c)}(e,t)}function K(e,t){var r=D("(",!0);if(!M.test(t=N()))throw F(t,"name");var n,i=t,o=i;r&&(D(")"),o=i="("+i+")",t=P(),T.test(t)&&(n=t.substr(1),i+=t,N())),D("="),function(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}(e,o,X(e,i),n)}function X(e,t){if(D("{",!0)){for(var r={};!D("}",!0);){if(!_.test(C=N()))throw F(C,"name");var n,i=C;"{"===P()?n=X(e,t+"."+C):(D(":"),"{"===P()?n=X(e,t+"."+C):(n=H(!0),ee(e,t+"."+C,n)));var o=r[i];o&&(n=[].concat(o).concat(n)),r[i]=n,D(",",!0)}return r}var a=H(!0);return ee(e,t,a),a}function ee(e,t,r){e.setOption&&e.setOption(t,r)}function te(e){if(D("[",!0)){do{K(e,"option")}while(D(",",!0));D("]")}return e}for(;null!==(C=N());)switch(C){case"package":if(!L)throw F(C);Y();break;case"import":if(!L)throw F(C);G();break;case"syntax":if(!L)throw F(C);Q();break;case"option":K(U,C),D(";");break;default:if(q(U,C)){L=!1;continue}throw F(C)}return w.filename=null,{package:x,imports:I,weakImports:E,syntax:A,root:t}}},function(e,t,r){e.exports=o;var n,i=/\/|\./;function o(e,t){i.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),o[e]=t}o("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),o("duration",{Duration:n={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),o("timestamp",{Timestamp:n}),o("empty",{Empty:{fields:{}}}),o("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),o("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),o("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),o.get=function(e){return o[e]||null}},function(e,t,r){var n=r(254),i=(n.roots.default||(n.roots.default=new n.Root)).addJSON({WebrtcStats:{fields:{local:{type:"local_obj",id:1},remote:{type:"remote_obj",id:2},timestamp:{type:"int64",id:3},appkey:{type:"string",id:4},cid:{type:"int64",id:5},uid:{type:"int64",id:6},browser:{type:"string",id:7},platform:{type:"string",id:8}},nested:{local_obj:{fields:{video_bwe:{rule:"repeated",type:"video_bwe_obj",id:1},audio_ssrc:{rule:"repeated",type:"audio_ssrc_obj",id:2},video_ssrc:{rule:"repeated",type:"video_ssrc_obj",id:3},media_source:{rule:"repeated",type:"media_source_obj",id:4},candidate_pair:{rule:"repeated",type:"candidate_pair_obj",id:5},local_candidate:{rule:"repeated",type:"local_candidate_obj",id:6},remote_candidate:{rule:"repeated",type:"remote_candidate_obj",id:7},track:{rule:"repeated",type:"track_obj",id:8},outbound_rtp:{rule:"repeated",type:"outbound_rtp_obj",id:9},remote_inbound_rtp:{rule:"repeated",type:"remote_inbound_rtp_obj",id:10},transport:{rule:"repeated",type:"transport_obj",id:11},audio_track:{rule:"repeated",type:"audio_track_obj",id:12},video_track:{rule:"repeated",type:"video_track_obj",id:13},audio_outbound_rtp:{rule:"repeated",type:"audio_outbound_rtp_obj",id:14},video_outbound_rtp:{rule:"repeated",type:"video_outbound_rtp_obj",id:15},screen_ssrc:{rule:"repeated",type:"screen_ssrc_obj",id:16},screen_outbound_rtp:{rule:"repeated",type:"screen_outbound_rtp_obj",id:17}},nested:{video_bwe_obj:{fields:{googActualEncBitrate:{type:"string",id:1},googAvailableSendBandwidth:{type:"string",id:2},googRetransmitBitrate:{type:"string",id:3},googAvailableReceiveBandwidth:{type:"string",id:4},googTargetEncBitrate:{type:"string",id:5},googBucketDelay:{type:"string",id:6},googTransmitBitrate:{type:"string",id:7},id:{type:"string",id:8},type:{type:"string",id:9},timestamp:{type:"string",id:10}}},audio_ssrc_obj:{fields:{audioInputLevel:{type:"string",id:1},packetsLost:{type:"string",id:2},googRtt:{type:"string",id:3},totalSamplesDuration:{type:"string",id:4},googEchoCancellationReturnLossEnhancement:{type:"string",id:5},googTrackId:{type:"string",id:6},totalAudioEnergy:{type:"string",id:7},transportId:{type:"string",id:8},mediaType:{type:"string",id:9},googEchoCancellationReturnLoss:{type:"string",id:10},googCodecName:{type:"string",id:11},ssrc:{type:"string",id:12},googJitterReceived:{type:"string",id:13},googTypingNoiseState:{type:"string",id:14},packetsSent:{type:"string",id:15},bytesSent:{type:"string",id:16},id:{type:"string",id:17},type:{type:"string",id:18},timestamp:{type:"string",id:19},localuid:{type:"int64",id:20},remoteuid:{type:"int64",id:21},bitsSentPerSecond:{type:"int64",id:22},packetsSentPerSecond:{type:"int64",id:23},sendPacketLoss:{type:"int64",id:24},bytesSentPerSecond:{type:"int64",id:25},alr:{type:"int64",id:26}}},video_ssrc_obj:{fields:{googContentType:{type:"string",id:1},googFrameWidthInput:{type:"string",id:2},googFrameWidthSent:{type:"string",id:3},packetsLost:{type:"string",id:4},googRtt:{type:"string",id:5},googHasEnteredLowResolution:{type:"string",id:6},googEncodeUsagePercent:{type:"string",id:7},googCpuLimitedResolution:{type:"string",id:8},googNacksReceived:{type:"string",id:9},googBandwidthLimitedResolution:{type:"string",id:10},googFrameHeightInput:{type:"string",id:11},googAvgEncodeMs:{type:"string",id:12},googTrackId:{type:"string",id:13},googFrameRateInput:{type:"string",id:14},framesEncoded:{type:"string",id:15},codecImplementationName:{type:"string",id:16},transportId:{type:"string",id:17},mediaType:{type:"string",id:18},googFrameHeightSent:{type:"string",id:19},googFrameRateSent:{type:"string",id:20},googCodecName:{type:"string",id:21},hugeFramesSent:{type:"string",id:22},qpSum:{type:"string",id:23},googPlisReceived:{type:"string",id:24},googAdaptationChanges:{type:"string",id:25},ssrc:{type:"string",id:26},googFirsReceived:{type:"string",id:27},packetsSent:{type:"string",id:28},bytesSent:{type:"string",id:29},id:{type:"string",id:30},type:{type:"string",id:31},timestamp:{type:"string",id:32},localuid:{type:"int64",id:33},remoteuid:{type:"int64",id:34},bitsSentPerSecond:{type:"int64",id:35},packetsSentPerSecond:{type:"int64",id:36},sendPacketLoss:{type:"int64",id:37},freezeTime:{type:"int64",id:38},totalFreezeTime:{type:"int64",id:39},bytesSentPerSecond:{type:"int64",id:40},framesEncodedPerSecond:{type:"int64",id:41},googActualEncBitrate:{type:"string",id:42},googAvailableSendBandwidth:{type:"string",id:43},googRetransmitBitrate:{type:"string",id:44},googAvailableReceiveBandwidth:{type:"string",id:45},googTargetEncBitrate:{type:"string",id:46},googBucketDelay:{type:"string",id:47},googTransmitBitrate:{type:"string",id:48},vlr:{type:"int64",id:49}}},screen_ssrc_obj:{fields:{googContentType:{type:"string",id:1},googFrameWidthInput:{type:"string",id:2},googFrameWidthSent:{type:"string",id:3},packetsLost:{type:"string",id:4},googRtt:{type:"string",id:5},googHasEnteredLowResolution:{type:"string",id:6},googEncodeUsagePercent:{type:"string",id:7},googCpuLimitedResolution:{type:"string",id:8},googNacksReceived:{type:"string",id:9},googBandwidthLimitedResolution:{type:"string",id:10},googFrameHeightInput:{type:"string",id:11},googAvgEncodeMs:{type:"string",id:12},googTrackId:{type:"string",id:13},googFrameRateInput:{type:"string",id:14},framesEncoded:{type:"string",id:15},codecImplementationName:{type:"string",id:16},transportId:{type:"string",id:17},mediaType:{type:"string",id:18},googFrameHeightSent:{type:"string",id:19},googFrameRateSent:{type:"string",id:20},googCodecName:{type:"string",id:21},hugeFramesSent:{type:"string",id:22},qpSum:{type:"string",id:23},googPlisReceived:{type:"string",id:24},googAdaptationChanges:{type:"string",id:25},ssrc:{type:"string",id:26},googFirsReceived:{type:"string",id:27},packetsSent:{type:"string",id:28},bytesSent:{type:"string",id:29},id:{type:"string",id:30},type:{type:"string",id:31},timestamp:{type:"string",id:32},localuid:{type:"int64",id:33},remoteuid:{type:"int64",id:34},bitsSentPerSecond:{type:"int64",id:35},packetsSentPerSecond:{type:"int64",id:36},sendPacketLoss:{type:"int64",id:37},freezeTime:{type:"int64",id:38},totalFreezeTime:{type:"int64",id:39},bytesSentPerSecond:{type:"int64",id:40},framesEncodedPerSecond:{type:"int64",id:41},googActualEncBitrate:{type:"string",id:42},googAvailableSendBandwidth:{type:"string",id:43},googRetransmitBitrate:{type:"string",id:44},googAvailableReceiveBandwidth:{type:"string",id:45},googTargetEncBitrate:{type:"string",id:46},googBucketDelay:{type:"string",id:47},googTransmitBitrate:{type:"string",id:48},vlr:{type:"int64",id:49}}},media_source_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},trackIdentifier:{type:"string",id:4},kind:{type:"string",id:5},width:{type:"int64",id:6},height:{type:"int64",id:7},framesPerSecond:{type:"int64",id:8},frames:{type:"int64",id:9}}},candidate_pair_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},transportId:{type:"string",id:4},localCandidateId:{type:"string",id:5},remoteCandidateId:{type:"string",id:6},state:{type:"string",id:7},priority:{type:"int64",id:8},nominated:{type:"bool",id:9},writable:{type:"bool",id:10},bytesSent:{type:"int64",id:11},bytesReceived:{type:"int64",id:12},totalRoundTripTime:{type:"double",id:13},currentRoundTripTime:{type:"double",id:14},availableOutgoingBitrate:{type:"int64",id:15},requestsReceived:{type:"int64",id:16},requestsSent:{type:"int64",id:17},responsesReceived:{type:"int64",id:18},responsesSent:{type:"int64",id:19},consentRequestsSent:{type:"int64",id:20},lastPacketReceivedTimestamp:{type:"int64",id:21},lastPacketSentTimestamp:{type:"int64",id:22},readable:{type:"bool",id:23},selected:{type:"bool",id:24}}},local_candidate_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},transportId:{type:"string",id:4},isRemote:{type:"bool",id:5},networkType:{type:"string",id:6},ip:{type:"string",id:7},port:{type:"int64",id:8},protocol:{type:"string",id:9},candidateType:{type:"string",id:10},priority:{type:"int64",id:11},deleted:{type:"bool",id:12},address:{type:"string",id:13}}},remote_candidate_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},transportId:{type:"string",id:4},isRemote:{type:"bool",id:5},ip:{type:"string",id:6},port:{type:"int64",id:7},protocol:{type:"string",id:8},candidateType:{type:"string",id:9},priority:{type:"int64",id:10},deleted:{type:"bool",id:11},address:{type:"string",id:12}}},track_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},trackIdentifier:{type:"string",id:4},mediaSourceId:{type:"string",id:5},remoteSource:{type:"bool",id:6},ended:{type:"bool",id:7},detached:{type:"bool",id:8},kind:{type:"string",id:9},frameWidth:{type:"int64",id:10},frameHeight:{type:"int64",id:11},framesSent:{type:"int64",id:12},hugeFramesSent:{type:"int64",id:13}}},outbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},ssrc:{type:"int64",id:4},isRemote:{type:"bool",id:5},mediaType:{type:"string",id:6},kind:{type:"string",id:7},trackId:{type:"string",id:8},transportId:{type:"string",id:9},codecId:{type:"string",id:10},firCount:{type:"int64",id:11},pliCount:{type:"int64",id:12},nackCount:{type:"int64",id:13},qpSum:{type:"int64",id:14},mediaSourceId:{type:"string",id:15},remoteId:{type:"string",id:16},packetsSent:{type:"int64",id:17},retransmittedPacketsSent:{type:"int64",id:18},bytesSent:{type:"int64",id:19},headerBytesSent:{type:"int64",id:20},retransmittedBytesSent:{type:"int64",id:21},framesEncoded:{type:"int64",id:22},keyFramesEncoded:{type:"int64",id:23},totalEncodeTime:{type:"double",id:24},totalEncodedBytesTarget:{type:"int64",id:25},frameWidth:{type:"int64",id:26},frameHeight:{type:"int64",id:27},framesPerSecond:{type:"int64",id:28},framesSent:{type:"int64",id:29},hugeFramesSent:{type:"int64",id:30},totalPacketSendDelay:{type:"double",id:31},qualityLimitationReason:{type:"string",id:32},qualityLimitationResolutionChanges:{type:"int64",id:33},encoderImplementation:{type:"string",id:34},contentType:{type:"string",id:35},bitrateMean:{type:"double",id:36},bitrateStdDev:{type:"double",id:37},droppedFrames:{type:"int64",id:38},framerateMean:{type:"double",id:39},framerateStdDev:{type:"double",id:40},quality_limitation_durations:{rule:"repeated",type:"quality_limitation_durations_obj",id:41}},nested:{quality_limitation_durations_obj:{fields:{other:{type:"int64",id:1},cpu:{type:"int64",id:2},bandwidth:{type:"int64",id:3},none:{type:"int64",id:4}}}}},remote_inbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},ssrc:{type:"int64",id:4},kind:{type:"string",id:5},transportId:{type:"string",id:6},codecId:{type:"string",id:7},packetsLost:{type:"int64",id:8},jitter:{type:"double",id:9},localId:{type:"string",id:10},roundTripTime:{type:"double",id:11},fractionLost:{type:"double",id:12},totalRoundTripTime:{type:"double",id:13},roundTripTimeMeasurements:{type:"double",id:14}}},transport_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},bytesSent:{type:"int64",id:4},packetsSent:{type:"int64",id:5},bytesReceived:{type:"int64",id:6},packetsReceived:{type:"int64",id:7},dtlsState:{type:"string",id:8},selectedCandidatePairId:{type:"string",id:9},localCertificateId:{type:"string",id:10},remoteCertificateId:{type:"string",id:11},tlsVersion:{type:"string",id:12},dtlsCipher:{type:"string",id:13},srtpCipher:{type:"string",id:14},selectedCandidatePairChanges:{type:"int64",id:15}}},audio_track_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},detached:{type:"bool",id:4},ended:{type:"bool",id:5},remoteSource:{type:"bool",id:6},trackIdentifier:{type:"string",id:7},mediaType:{type:"string",id:8},ssrc:{type:"int64",id:9},uid:{type:"string",id:10}}},video_track_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},detached:{type:"bool",id:4},ended:{type:"bool",id:5},frameHeight:{type:"int64",id:6},frameWidth:{type:"int64",id:7},framesSent:{type:"int64",id:8},remoteSource:{type:"bool",id:9},trackIdentifier:{type:"string",id:10},ssrc:{type:"int64",id:11},frameRateSent:{type:"int64",id:12},mediaType:{type:"string",id:13},framesSentPerSecond:{type:"int64",id:14},uid:{type:"string",id:15}}},audio_outbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},codecId:{type:"string",id:4},kind:{type:"string",id:5},mediaType:{type:"string",id:6},ssrc:{type:"int64",id:7},transportId:{type:"string",id:8},bytesSent:{type:"int64",id:9},packetsSent:{type:"int64",id:10},headerBytesSent:{type:"int64",id:11},mediaSourceId:{type:"string",id:12},remoteId:{type:"string",id:13},retransmittedBytesSent:{type:"int64",id:14},retransmittedPacketsSent:{type:"int64",id:15},trackId:{type:"string",id:16},bitsSentPerSecond:{type:"int64",id:17},packetsSentPerSecond:{type:"int64",id:18},bytesSentPerSecond:{type:"int64",id:19},nackCount:{type:"int64",id:20},isRemote:{type:"bool",id:21},qpSum:{type:"int64",id:22},uid:{type:"string",id:23}}},video_outbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},codecId:{type:"string",id:4},kind:{type:"string",id:5},mediaType:{type:"string",id:6},ssrc:{type:"int64",id:7},transportId:{type:"string",id:8},bytesSent:{type:"int64",id:9},packetsSent:{type:"int64",id:10},firCount:{type:"int64",id:11},frameHeight:{type:"int64",id:12},frameWidth:{type:"int64",id:13},framesEncoded:{type:"int64",id:14},framesPerSecond:{type:"int64",id:15},framesSent:{type:"int64",id:16},headerBytesSent:{type:"int64",id:17},hugeFramesSent:{type:"int64",id:18},keyFramesEncoded:{type:"int64",id:19},mediaSourceId:{type:"string",id:20},nackCount:{type:"int64",id:21},pliCount:{type:"int64",id:22},qpSum:{type:"int64",id:23},qualityLimitationResolutionChanges:{type:"int64",id:24},remoteId:{type:"string",id:25},retransmittedBytesSent:{type:"int64",id:26},retransmittedPacketsSent:{type:"int64",id:27},totalEncodeTime:{type:"double",id:28},totalEncodedBytesTarget:{type:"int64",id:29},totalPacketSendDelay:{type:"double",id:30},trackId:{type:"string",id:31},bitsSentPerSecond:{type:"int64",id:32},packetsSentPerSecond:{type:"int64",id:33},frameRateSent:{type:"int64",id:34},bytesSentPerSecond:{type:"int64",id:35},framesEncodedPerSecond:{type:"int64",id:36},bitrateMean:{type:"int64",id:37},bitrateStdDev:{type:"int64",id:38},droppedFrames:{type:"int64",id:39},framerateMean:{type:"int64",id:40},framerateStdDev:{type:"int64",id:41},isRemote:{type:"bool",id:42},uid:{type:"string",id:43}}},screen_outbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},kind:{type:"string",id:4},mediaType:{type:"string",id:5},ssrc:{type:"int64",id:6},bytesSent:{type:"int64",id:7},packetsSent:{type:"int64",id:8},bitrateMean:{type:"double",id:9},bitrateStdDev:{type:"double",id:10},droppedFrames:{type:"int64",id:11},firCount:{type:"int64",id:12},framerateMean:{type:"int64",id:13},framerateStdDev:{type:"int64",id:14},framesEncoded:{type:"int64",id:15},nackCount:{type:"int64",id:16},pliCount:{type:"int64",id:17},bytesSentPerSecond:{type:"int64",id:18},framesEncodedPerSecond:{type:"int64",id:19},packetsSentPerSecond:{type:"int64",id:20},remoteId:{type:"string",id:21}}}}},remote_obj:{fields:{video_ssrc:{rule:"repeated",type:"video_ssrc_obj",id:1},audio_ssrc:{rule:"repeated",type:"audio_ssrc_obj",id:2},candidate_pair:{rule:"repeated",type:"candidate_pair_obj",id:3},remote_candidate:{rule:"repeated",type:"remote_candidate_obj",id:4},local_candidate:{rule:"repeated",type:"local_candidate_obj",id:5},inbound_rtp:{rule:"repeated",type:"inbound_rtp_obj",id:6},track:{rule:"repeated",type:"track_obj",id:7},transport:{rule:"repeated",type:"transport_obj",id:8},audio_inbound_rtp:{rule:"repeated",type:"audio_inbound_rtp_obj",id:9},video_inbound_rtp:{rule:"repeated",type:"video_inbound_rtp_obj",id:10},audio_track:{rule:"repeated",type:"audio_track_obj",id:11},video_track:{rule:"repeated",type:"video_track_obj",id:12},screen_ssrc:{rule:"repeated",type:"screen_ssrc_obj",id:13},screen_inbound_rtp:{rule:"repeated",type:"screen_inbound_rtp_obj",id:14}},nested:{video_ssrc_obj:{fields:{googContentType:{type:"string",id:1},googCaptureStartNtpTimeMs:{type:"string",id:2},googTargetDelayMs:{type:"string",id:3},packetsLost:{type:"string",id:4},googDecodeMs:{type:"string",id:5},googFrameHeightReceived:{type:"string",id:6},googFrameRateOutput:{type:"string",id:7},packetsReceived:{type:"string",id:8},ssrc:{type:"string",id:9},googRenderDelayMs:{type:"string",id:10},googMaxDecodeMs:{type:"string",id:11},googTrackId:{type:"string",id:12},googFrameWidthReceived:{type:"string",id:13},codecImplementationName:{type:"string",id:14},transportId:{type:"string",id:15},mediaType:{type:"string",id:16},googInterframeDelayMax:{type:"string",id:17},googCodecName:{type:"string",id:18},googFrameRateReceived:{type:"string",id:19},framesDecoded:{type:"string",id:20},googNacksSent:{type:"string",id:21},googFirsSent:{type:"string",id:22},bytesReceived:{type:"string",id:23},googFirstFrameReceivedToDecodedMs:{type:"string",id:24},googCurrentDelayMs:{type:"string",id:25},googMinPlayoutDelayMs:{type:"string",id:26},googFrameRateDecoded:{type:"string",id:27},googJitterBufferMs:{type:"string",id:28},googPlisSent:{type:"string",id:29},id:{type:"string",id:30},type:{type:"string",id:31},timestamp:{type:"string",id:32},localuid:{type:"int64",id:33},remoteuid:{type:"string",id:34},bitsReceivedPerSecond:{type:"int64",id:35},packetsReceivedPerSecond:{type:"int64",id:36},recvPacketLoss:{type:"int64",id:37},freezeTime:{type:"int64",id:38},totalFreezeTime:{type:"int64",id:39},bytesReceivedPerSecond:{type:"int64",id:40},framesDecodedPerSecond:{type:"int64",id:41},packetsLostRate:{type:"double",id:42}}},audio_ssrc_obj:{fields:{googDecodingCTN:{type:"string",id:1},packetsLost:{type:"string",id:2},googSecondaryDecodedRate:{type:"string",id:3},googDecodingPLC:{type:"string",id:4},packetsReceived:{type:"string",id:5},googJitterReceived:{type:"string",id:6},googDecodingCNG:{type:"string",id:7},ssrc:{type:"string",id:8},googPreferredJitterBufferMs:{type:"string",id:9},googSpeechExpandRate:{type:"string",id:10},totalSamplesDuration:{type:"string",id:11},totalAudioEnergy:{type:"string",id:12},transportId:{type:"string",id:13},mediaType:{type:"string",id:14},googDecodingPLCCNG:{type:"string",id:15},googCodecName:{type:"string",id:16},googSecondaryDiscardedRate:{type:"string",id:17},googDecodingNormal:{type:"string",id:18},googTrackId:{type:"string",id:19},audioOutputLevel:{type:"string",id:20},googAccelerateRate:{type:"string",id:21},bytesReceived:{type:"string",id:22},googCurrentDelayMs:{type:"string",id:23},googDecodingCTSG:{type:"string",id:24},googExpandRate:{type:"string",id:25},googPreemptiveExpandRate:{type:"string",id:26},googJitterBufferMs:{type:"string",id:27},googDecodingMuted:{type:"string",id:28},id:{type:"string",id:29},type:{type:"string",id:30},timestamp:{type:"string",id:31},localuid:{type:"int64",id:32},remoteuid:{type:"string",id:33},bitsReceivedPerSecond:{type:"int64",id:34},packetsReceivedPerSecond:{type:"int64",id:35},recvPacketLoss:{type:"int64",id:36},freezeTime:{type:"int64",id:37},totalFreezeTime:{type:"int64",id:38},bytesReceivedPerSecond:{type:"int64",id:39},packetsLostRate:{type:"double",id:40},packetsLostPerSecond:{type:"double",id:41},alr:{type:"double",id:42}}},candidate_pair_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},transportId:{type:"string",id:4},localCandidateId:{type:"string",id:5},remoteCandidateId:{type:"string",id:6},state:{type:"string",id:7},priority:{type:"int64",id:8},nominated:{type:"bool",id:9},writable:{type:"bool",id:10},bytesSent:{type:"int64",id:11},bytesReceived:{type:"int64",id:12},totalRoundTripTime:{type:"double",id:13},currentRoundTripTime:{type:"double",id:14},availableOutgoingBitrate:{type:"int64",id:15},requestsReceived:{type:"int64",id:16},requestsSent:{type:"int64",id:17},responsesReceived:{type:"int64",id:18},responsesSent:{type:"int64",id:19},consentRequestsSent:{type:"int64",id:20},lastPacketReceivedTimestamp:{type:"int64",id:21},lastPacketSentTimestamp:{type:"int64",id:22},readable:{type:"bool",id:23},selected:{type:"bool",id:24}}},remote_candidate_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},transportId:{type:"string",id:4},isRemote:{type:"bool",id:5},ip:{type:"string",id:6},port:{type:"int64",id:7},protocol:{type:"string",id:8},candidateType:{type:"string",id:9},priority:{type:"int64",id:10},deleted:{type:"bool",id:11},address:{type:"string",id:12}}},local_candidate_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},transportId:{type:"string",id:4},isRemote:{type:"bool",id:5},networkType:{type:"string",id:6},ip:{type:"string",id:7},port:{type:"int64",id:8},protocol:{type:"string",id:9},candidateType:{type:"string",id:10},priority:{type:"int64",id:11},deleted:{type:"bool",id:12},address:{type:"string",id:13}}},inbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},ssrc:{type:"int64",id:4},isRemote:{type:"bool",id:5},mediaType:{type:"string",id:6},kind:{type:"string",id:7},trackId:{type:"string",id:8},transportId:{type:"string",id:9},codecId:{type:"string",id:10},packetsReceived:{type:"int64",id:11},fecPacketsReceived:{type:"int64",id:12},fecPacketsDiscarded:{type:"int64",id:13},bytesReceived:{type:"int64",id:14},headerBytesReceived:{type:"int64",id:15},packetsLost:{type:"int64",id:16},lastPacketReceivedTimestamp:{type:"double",id:17},jitter:{type:"double",id:18},jitterBufferDelay:{type:"double",id:19},jitterBufferEmittedCount:{type:"int64",id:20},totalSamplesReceived:{type:"int64",id:21},concealedSamples:{type:"int64",id:22},silentConcealedSamples:{type:"int64",id:23},concealmentEvents:{type:"int64",id:24},insertedSamplesForDeceleration:{type:"int64",id:25},removedSamplesForAcceleration:{type:"int64",id:26},audioLevel:{type:"double",id:27},totalAudioEnergy:{type:"double",id:28},totalSamplesDuration:{type:"double",id:29},estimatedPlayoutTimestamp:{type:"int64",id:30},decoderImplementation:{type:"string",id:31},discardedPackets:{type:"int64",id:32},bitrateMean:{type:"int64",id:33},bitrateStdDev:{type:"int64",id:34},framerateMean:{type:"int64",id:35},framerateStdDev:{type:"int64",id:36}}},track_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},trackIdentifier:{type:"string",id:4},remoteSource:{type:"bool",id:5},ended:{type:"bool",id:6},detached:{type:"bool",id:7},kind:{type:"string",id:8},jitterBufferDelay:{type:"double",id:9},jitterBufferEmittedCount:{type:"int64",id:10},audioLevel:{type:"double",id:11},totalAudioEnergy:{type:"double",id:12},totalSamplesReceived:{type:"int64",id:13},totalSamplesDuration:{type:"double",id:14},concealedSamples:{type:"int64",id:15},silentConcealedSamples:{type:"int64",id:16},concealmentEvents:{type:"int64",id:17},insertedSamplesForDeceleration:{type:"int64",id:18},removedSamplesForAcceleration:{type:"int64",id:19},frameWidth:{type:"int64",id:20},frameHeight:{type:"int64",id:21},framesReceived:{type:"int64",id:22},framesDecoded:{type:"int64",id:23},framesDropped:{type:"int64",id:24}}},transport_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"double",id:2},type:{type:"string",id:3},bytesSent:{type:"int64",id:4},packetsSent:{type:"int64",id:5},bytesReceived:{type:"int64",id:6},packetsReceived:{type:"int64",id:7},dtlsState:{type:"string",id:8},selectedCandidatePairId:{type:"string",id:9},localCertificateId:{type:"string",id:10},remoteCertificateId:{type:"string",id:11},tlsVersion:{type:"string",id:12},dtlsCipher:{type:"string",id:13},srtpCipher:{type:"string",id:14},selectedCandidatePairChanges:{type:"int64",id:15}}},audio_inbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},codecId:{type:"string",id:4},kind:{type:"string",id:5},mediaType:{type:"string",id:6},ssrc:{type:"int64",id:7},transportId:{type:"string",id:8},jitter:{type:"double",id:9},packetsLost:{type:"int64",id:10},packetsReceived:{type:"int64",id:11},audioLevel:{type:"int64",id:12},bytesReceived:{type:"int64",id:13},concealedSamples:{type:"int64",id:14},concealmentEvents:{type:"int64",id:15},estimatedPlayoutTimestamp:{type:"int64",id:16},fecPacketsDiscarded:{type:"int64",id:17},fecPacketsReceived:{type:"int64",id:18},headerBytesReceived:{type:"int64",id:19},insertedSamplesForDeceleration:{type:"int64",id:20},jitterBufferDelay:{type:"double",id:21},jitterBufferEmittedCount:{type:"int64",id:22},lastPacketReceivedTimestamp:{type:"double",id:23},removedSamplesForAcceleration:{type:"int64",id:24},silentConcealedSamples:{type:"int64",id:25},totalAudioEnergy:{type:"double",id:26},totalSamplesDuration:{type:"double",id:27},totalSamplesReceived:{type:"int64",id:28},trackId:{type:"string",id:29},bitsReceivedPerSecond:{type:"int64",id:30},packetsReceivedPerSecond:{type:"int64",id:31},uid:{type:"string",id:32},bytesReceivedPerSecond:{type:"int64",id:33},packetsLostRate:{type:"double",id:34},recvPacketLoss:{type:"int64",id:35},remoteuid:{type:"string",id:36},isRemote:{type:"bool",id:37},packetsLostPerSecond:{type:"int64",id:38},qpSum:{type:"int64",id:39}}},video_inbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},codecId:{type:"string",id:4},kind:{type:"string",id:5},mediaType:{type:"string",id:6},ssrc:{type:"int64",id:7},transportId:{type:"string",id:8},packetsLost:{type:"int64",id:9},packetsReceived:{type:"int64",id:10},bytesReceived:{type:"int64",id:11},estimatedPlayoutTimestamp:{type:"int64",id:12},firCount:{type:"int64",id:13},frameHeight:{type:"int64",id:14},frameWidth:{type:"int64",id:15},framesDecoded:{type:"int64",id:16},framesPerSecond:{type:"int64",id:17},framesReceived:{type:"int64",id:18},headerBytesReceived:{type:"int64",id:19},keyFramesDecoded:{type:"int64",id:20},lastPacketReceivedTimestamp:{type:"int64",id:21},nackCount:{type:"int64",id:22},pliCount:{type:"int64",id:23},totalDecodeTime:{type:"double",id:24},totalInterFrameDelay:{type:"double",id:25},totalSquaredInterFrameDelay:{type:"double",id:26},trackId:{type:"string",id:27},bitsReceivedPerSecond:{type:"int64",id:28},packetsReceivedPerSecond:{type:"int64",id:29},uid:{type:"string",id:30},bytesReceivedPerSecond:{type:"int64",id:31},packetsLostRate:{type:"double",id:32},framesDecodedPerSecond:{type:"double",id:33},recvPacketLoss:{type:"int64",id:34},remoteuid:{type:"string",id:35},isRemote:{type:"bool",id:36},qpSum:{type:"int64",id:37}}},screen_inbound_rtp_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},kind:{type:"string",id:4},mediaType:{type:"string",id:5},ssrc:{type:"int64",id:6},discardedPackets:{type:"int64",id:7},jitter:{type:"double",id:8},packetsLost:{type:"int64",id:9},packetsReceived:{type:"int64",id:10},bitrateMean:{type:"double",id:11},bitrateStdDev:{type:"double",id:12},bytesReceived:{type:"int64",id:13},firCount:{type:"int64",id:14},framerateMean:{type:"double",id:15},framerateStdDev:{type:"double",id:16},framesDecoded:{type:"int64",id:17},nackCount:{type:"int64",id:18},pliCount:{type:"int64",id:19},remoteId:{type:"string",id:20},targetUid:{type:"string",id:21},bytesReceivedPerSecond:{type:"int64",id:22},packetsLostPerSecond:{type:"int64",id:23},framesDecodedPerSecond:{type:"int64",id:24},recvPacketLoss:{type:"int64",id:25},packetsReceivedPerSecond:{type:"int64",id:26},remoteuid:{type:"string",id:27}}},audio_track_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},audioLevel:{type:"double",id:4},detached:{type:"bool",id:5},ended:{type:"bool",id:6},jitterBufferFlushes:{type:"int64",id:7},remoteSource:{type:"bool",id:8},trackIdentifier:{type:"string",id:9},mediaType:{type:"string",id:10},ssrc:{type:"int64",id:11},uid:{type:"string",id:12}}},video_track_obj:{fields:{id:{type:"string",id:1},timestamp:{type:"int64",id:2},type:{type:"string",id:3},detached:{type:"bool",id:4},ended:{type:"bool",id:5},frameHeight:{type:"int64",id:6},frameWidth:{type:"int64",id:7},framesDecoded:{type:"int64",id:8},framesDropped:{type:"int64",id:9},framesReceived:{type:"int64",id:10},freezeCount:{type:"int64",id:11},pauseCount:{type:"int64",id:12},remoteSource:{type:"bool",id:13},sumOfSquaredFramesDuration:{type:"double",id:14},totalFramesDuration:{type:"double",id:15},totalFreezesDuration:{type:"double",id:16},totalPausesDuration:{type:"int64",id:17},trackIdentifier:{type:"string",id:18},ssrc:{type:"int64",id:19},mediaType:{type:"string",id:20},uid:{type:"string",id:21}}},screen_ssrc_obj:{fields:{googContentType:{type:"string",id:1},googCaptureStartNtpTimeMs:{type:"string",id:2},googTargetDelayMs:{type:"string",id:3},packetsLost:{type:"string",id:4},googDecodeMs:{type:"string",id:5},googFrameHeightReceived:{type:"string",id:6},googFrameRateOutput:{type:"string",id:7},packetsReceived:{type:"string",id:8},ssrc:{type:"string",id:9},googRenderDelayMs:{type:"string",id:10},googMaxDecodeMs:{type:"string",id:11},googTrackId:{type:"string",id:12},googFrameWidthReceived:{type:"string",id:13},codecImplementationName:{type:"string",id:14},transportId:{type:"string",id:15},mediaType:{type:"string",id:16},googInterframeDelayMax:{type:"string",id:17},googCodecName:{type:"string",id:18},googFrameRateReceived:{type:"string",id:19},framesDecoded:{type:"string",id:20},googNacksSent:{type:"string",id:21},googFirsSent:{type:"string",id:22},bytesReceived:{type:"string",id:23},googFirstFrameReceivedToDecodedMs:{type:"string",id:24},googCurrentDelayMs:{type:"string",id:25},googMinPlayoutDelayMs:{type:"string",id:26},googFrameRateDecoded:{type:"string",id:27},googJitterBufferMs:{type:"string",id:28},googPlisSent:{type:"string",id:29},id:{type:"string",id:30},type:{type:"string",id:31},timestamp:{type:"string",id:32},localuid:{type:"int64",id:33},remoteuid:{type:"string",id:34},bitsReceivedPerSecond:{type:"int64",id:35},packetsReceivedPerSecond:{type:"int64",id:36},recvPacketLoss:{type:"int64",id:37},freezeTime:{type:"int64",id:38},totalFreezeTime:{type:"int64",id:39},bytesReceivedPerSecond:{type:"int64",id:40},framesDecodedPerSecond:{type:"int64",id:41},packetsLostRate:{type:"double",id:42},packetsLostPerSecond:{type:"double",id:43},vlr:{type:"int64",id:44}}}}}}}});e.exports=i},function(e,t,r){e.exports=r(131)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.prototype.hasOwnProperty;t.default=function(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(function(e){if(!e||"object"!=typeof e||"[object Object]"!=Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Function.prototype.toString.call(r)===Function.prototype.toString.call(Object)}(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(var t in e)if(n.call(e,t))return!1;return!0}return!1}},function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;!function(){var root="object"==typeof window?window:{},NODE_JS=!root.JS_SHA1_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS&&(root=global);var COMMON_JS=!root.JS_SHA1_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__(257),HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[],createOutputMethod=function(e){return function(t){return new Sha1(!0).update(t)[e]()}},createMethod=function(){var e=createOutputMethod("hex");NODE_JS&&(e=nodeWrap(e)),e.create=function(){return new Sha1},e.update=function(t){return e.create().update(t)};for(var t=0;t<OUTPUT_TYPES.length;++t){var r=OUTPUT_TYPES[t];e[r]=createOutputMethod(r)}return e},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("sha1").update(e,"utf8").digest("hex");if(e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(void 0===e.length)return method(e);return crypto.createHash("sha1").update(new Buffer(e)).digest("hex")};return nodeMethod};function Sha1(e){e?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===root.ArrayBuffer&&(e=new Uint8Array(e));for(var r,n,i=0,o=e.length||0,a=this.blocks;i<o;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)for(n=this.start;i<o&&n<64;++i)a[n>>2]|=e[i]<<SHIFT[3&n++];else for(n=this.start;i<o&&n<64;++i)(r=e.charCodeAt(i))<128?a[n>>2]|=r<<SHIFT[3&n++]:r<2048?(a[n>>2]|=(192|r>>6)<<SHIFT[3&n++],a[n>>2]|=(128|63&r)<<SHIFT[3&n++]):r<55296||r>=57344?(a[n>>2]|=(224|r>>12)<<SHIFT[3&n++],a[n>>2]|=(128|r>>6&63)<<SHIFT[3&n++],a[n>>2]|=(128|63&r)<<SHIFT[3&n++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++i)),a[n>>2]|=(240|r>>18)<<SHIFT[3&n++],a[n>>2]|=(128|r>>12&63)<<SHIFT[3&n++],a[n>>2]|=(128|r>>6&63)<<SHIFT[3&n++],a[n>>2]|=(128|63&r)<<SHIFT[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=a[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha1.prototype.hash=function(){var e,t,r=this.h0,n=this.h1,i=this.h2,o=this.h3,a=this.h4,s=this.blocks;for(e=16;e<80;++e)t=s[e-3]^s[e-8]^s[e-14]^s[e-16],s[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)r=(t=(n=(t=(i=(t=(o=(t=(a=(t=r<<5|r>>>27)+(n&i|~n&o)+a+1518500249+s[e]<<0)<<5|a>>>27)+(r&(n=n<<30|n>>>2)|~r&i)+o+1518500249+s[e+1]<<0)<<5|o>>>27)+(a&(r=r<<30|r>>>2)|~a&n)+i+1518500249+s[e+2]<<0)<<5|i>>>27)+(o&(a=a<<30|a>>>2)|~o&r)+n+1518500249+s[e+3]<<0)<<5|n>>>27)+(i&(o=o<<30|o>>>2)|~i&a)+r+1518500249+s[e+4]<<0,i=i<<30|i>>>2;for(;e<40;e+=5)r=(t=(n=(t=(i=(t=(o=(t=(a=(t=r<<5|r>>>27)+(n^i^o)+a+1859775393+s[e]<<0)<<5|a>>>27)+(r^(n=n<<30|n>>>2)^i)+o+1859775393+s[e+1]<<0)<<5|o>>>27)+(a^(r=r<<30|r>>>2)^n)+i+1859775393+s[e+2]<<0)<<5|i>>>27)+(o^(a=a<<30|a>>>2)^r)+n+1859775393+s[e+3]<<0)<<5|n>>>27)+(i^(o=o<<30|o>>>2)^a)+r+1859775393+s[e+4]<<0,i=i<<30|i>>>2;for(;e<60;e+=5)r=(t=(n=(t=(i=(t=(o=(t=(a=(t=r<<5|r>>>27)+(n&i|n&o|i&o)+a-1894007588+s[e]<<0)<<5|a>>>27)+(r&(n=n<<30|n>>>2)|r&i|n&i)+o-1894007588+s[e+1]<<0)<<5|o>>>27)+(a&(r=r<<30|r>>>2)|a&n|r&n)+i-1894007588+s[e+2]<<0)<<5|i>>>27)+(o&(a=a<<30|a>>>2)|o&r|a&r)+n-1894007588+s[e+3]<<0)<<5|n>>>27)+(i&(o=o<<30|o>>>2)|i&a|o&a)+r-1894007588+s[e+4]<<0,i=i<<30|i>>>2;for(;e<80;e+=5)r=(t=(n=(t=(i=(t=(o=(t=(a=(t=r<<5|r>>>27)+(n^i^o)+a-899497514+s[e]<<0)<<5|a>>>27)+(r^(n=n<<30|n>>>2)^i)+o-899497514+s[e+1]<<0)<<5|o>>>27)+(a^(r=r<<30|r>>>2)^n)+i-899497514+s[e+2]<<0)<<5|i>>>27)+(o^(a=a<<30|a>>>2)^r)+n-899497514+s[e+3]<<0)<<5|n>>>27)+(i^(o=o<<30|o>>>2)^a)+r-899497514+s[e+4]<<0,i=i<<30|i>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+n<<0,this.h2=this.h2+i<<0,this.h3=this.h3+o<<0,this.h4=this.h4+a<<0},Sha1.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,i=this.h4;return HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,i=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,i>>24&255,i>>16&255,i>>8&255,255&i]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};var exports=createMethod();COMMON_JS?module.exports=exports:(root.sha1=exports,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()}).call(this,__webpack_require__(116),__webpack_require__(60))},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaCapability=void 0;const n=r(259),i=r(17),o=r(2);t.MediaCapability=class{constructor(e){this.logger=e.logger.getChild((()=>{let t="codec"+this.room.videoCodecType.join(",");return this.supportedCodecSend&&2===this.supportedCodecSend.length&&this.supportedCodecRecv&&2===this.supportedCodecRecv.length||(t+=`/${this.supportedCodecSend}/${this.supportedCodecRecv}`),e.mediaCapability!==this&&(t+=" DETACHED"),t})),this.supportedCodecRecv=null,this.supportedCodecSend=null,this.preferredCodecSend={video:["H264","VP8"],screen:["H264","VP8"]},this.room={videoCodecType:[]}}async detect(){const e=Date.now();let t=await i.getSupportedCodecs("recv")||{video:[],audio:["OPUS"]},r=await i.getSupportedCodecs("send")||{video:[],audio:["OPUS"]};if(o.getParameters().h264Wait){if(-1===t.video.indexOf("H264"))for(this.logger.warn(`当前浏览器不支持H264解码。这可能会触发频道内编码协商。最多等待 ${o.getParameters().h264Wait} 毫秒以避免编码器尚未加载。`);Date.now()-e<o.getParameters().h264Wait;){if(t=await i.getSupportedCodecs("recv")||{video:[],audio:["OPUS"]},-1!==t.video.indexOf("H264")){this.logger.log(`H264解码器加载完成！用时 ${Date.now()-e} 毫秒`);break}await new Promise((e=>{setTimeout(e,100)}))}-1===t.video.indexOf("H264")&&this.logger.warn("H264解码器加载失败！")}this.supportedCodecRecv=t.video,this.supportedCodecSend=r.video,this.logger.log("detect supportedCodecRecv",JSON.stringify(this.supportedCodecRecv),"supportedCodecSend",JSON.stringify(this.supportedCodecSend),"Preferred codec:",JSON.stringify(this.preferredCodecSend))}getCodecCapability(){if(this.supportedCodecRecv&&this.supportedCodecSend){const e=[];for(let t of i.VideoCodecList)this.supportedCodecRecv.indexOf(t)>-1&&this.supportedCodecSend.indexOf(t)>-1&&e.push(t);return e}return this.logger.error("getCodecCapability: call detect first"),[]}stringify(){let e={256:[]};for(let t of this.getCodecCapability())n.VideoCodecStr2Int[t]>-1?e[256].push(n.VideoCodecStr2Int[t]):this.logger.error("MediaCapability:Unknown VideoCodecStr2Int",t);return 0===e[256].length&&this.logger.warn("MediaCapability:No Local Suitable codec available"),JSON.stringify(e)}getCodecSend(e,t){let r={codecName:null},n={codecName:null};for(let i=0;i<this.preferredCodecSend[e].length;i++){const o=this.preferredCodecSend[e][i];if(t.codecs||!t.codecs.length)for(let e=0;e<t.codecs.length;e++){const i=t.codecs[e];i.mimeType&&i.mimeType.toLowerCase().indexOf(o.toLowerCase())>-1&&(this.room.videoCodecType.indexOf(o)>-1?r.codecName||(r={codecParam:i,codecName:o}):n.codecName||(n={codecParam:i,codecName:o}))}}return r.codecName?(this.logger.log("MediaCapability：发送的Codec为:",r.codecName,JSON.stringify(r.codecParam)),r):(this.logger.warn("MediaCapability：未找到合适的发送Codec。发送的Codec使用:",n.codecName,n.codecParam),n)}parseRoom(e){if(!e.mediaCapabilitySet)return;const t=JSON.parse(e.mediaCapabilitySet);if(t[256]){const r=this.room.videoCodecType;this.room.videoCodecType=[];for(const r of t[256]){let t=n.VideoCodecInt2Str[r];t?this.room.videoCodecType.push(t):this.logger.error("Unknown Video Codec Type",r,e)}r.length?this.logger.log("Room videoCodecType发生变更。new:",this.room.videoCodecType,"old:",r):this.logger.log("Room videoCodecType:",JSON.stringify(this.room.videoCodecType))}}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.VideoCodecInt2Str=t.VideoCodecStr2Int=t.SignalChannelMode=void 0,function(e){e[e.CHANNEL_MODE_P2P=1]="CHANNEL_MODE_P2P",e[e.CHANNEL_MODE_MEETING=2]="CHANNEL_MODE_MEETING",e[e.CHANNEL_MODE_1V1=3]="CHANNEL_MODE_1V1"}(t.SignalChannelMode||(t.SignalChannelMode={})),t.VideoCodecStr2Int={H264:0,H265:1,VP8:2,NEVC:3},t.VideoCodecInt2Str={0:"H264",1:"H265",2:"VP8",3:"NEVC"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.OperationQueue=void 0;const n=r(31);t.OperationQueue=class{constructor(e){this.cnt=0,this.current=null,this.history=null,this.queue=[],this.logger=e.getChild((()=>{let e="oper";return this.current?e+=` ${this.current.args.method}#${this.current.id}`:this.history&&(e+=` ${this.history.args.method}#${this.history.id} FINISHED`),this.queue.forEach((t=>{e+=`|${t.args.method}#${t.id}`})),e})),setInterval((()=>{if(this.current&&Date.now()-this.current.enqueueTs>5e3){if(this.queue.length){const e=this.queue[0];this.logger.error(`当前操作已执行了${Date.now()-this.current.enqueueTs}ms，放开锁限制：${this.current.args.method}#${this.current.id}。即将进行下一个操作：${e.args.method}#${e.id}`)}else this.logger.log(`当前操作已执行了${Date.now()-this.current.enqueueTs}ms，放开锁限制：${this.current.args.method}#${this.current.id}`);this.current.status="timeout",this.history=this.current,this.current=null,this.fire("timer")}}),5e3)}enqueue(e){return new Promise(((t,r)=>{this.queue.push({id:++this.cnt,enqueueTs:Date.now(),args:e,resolve:t,reject:r,status:"pending"}),this.current?this.logger.log(`操作等位中，目前有其他操作。前面还有${this.queue.length}位：${e.method}#${this.cnt}。参数：`,e.options):this.fire("instant")}))}fire(e){if(!this.current){const t=this.queue.shift();t&&(this.history=this.current,this.current=t,this.current.status="live","instant"===e?this.logger.log(`开始执行操作：${t.args.method}。参数：`,n.makePrintable(t.args.options,4)):this.logger.log(`开始执行队列中的操作：${t.args.method}#${t.id}，等待时间：${Date.now()-t.enqueueTs}ms。参数：`,t.args.options),t.startTs=Date.now(),t.resolve((()=>{this.current===t?(this.current.status="finished",this.history=this.current,this.current=null,this.logger.log(`执行操作结束：${t.args.method}。花费 ${t.startTs?Date.now()-t.startTs:null}ms`),this.fire("functionEnd")):"timeout"===t.status?this.logger.log(`执行操作结束：${t.args.method}。花费 ${t.startTs?Date.now()-t.startTs:null}ms。该操作超时，但未阻塞执行队列。`):this.logger.error(`操作收到多次返回：${t.args.method}#${t.id}。花费 ${t.startTs?Date.now()-t.startTs:null}ms`)})))}}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.SpatialManager=void 0;const n=r(27);t.SpatialManager=class{constructor(e){this.elem=document.createElement("audio"),this.fakeElem=document.createElement("audio"),this.data={},this.context=e.context,this.client=e.client,this.options=e.options,this.logger=e.client.adapterRef.logger.getChild((()=>"spatial"));try{this.destination=new MediaStreamAudioDestinationNode(this.context)}catch(e){if("TypeError"!==e.name)throw e;this.destination=this.context.createMediaStreamDestination()}this.elem.setAttribute("playsinline","playsinline"),this.elem.setAttribute("autoplay","autoplay"),this.elem.className="nertc-panner-manager",this.elem.srcObject=this.destination.stream,this.fakeElem.muted=!0,this.fakeElem.volume=0,this.fakeElem.autoplay=!0,this.fakeElem.controls=!0}getUserData(e){const t=""+e;""+parseInt(t)!==t&&this.logger.warn("getUserData:异常的uid：",e);let r=this.data[t];return r||(r={position:{x:0,y:0}},this.data[t]=r),r}shouldSubscribe(e){const t=this.getUserData(e);return Math.abs(t.position.x)<=64&&Math.abs(t.position.y)<=64}async updatePosition(e,t){const r=this.getUserData(e),n=this.client.adapterRef.remoteStreamMap[e];if(n){const i=this.client.getSubStatus(n,"all");if(this.shouldSubscribe(e))if(i.subscribable)this.logger.log(`[remote#${e} status:${i.status}]界内，【即将订阅】: (${r.position.x}, ${r.position.y}) => (${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y,await this.client.doSubscribe(n),this.updatePosition(e,r.position);else{if(r.position.x===t.x&&r.position.y===t.y)return;this.logger.log(`[remote#${e} status:${i.status}]界内，即将更新remoteStream位置: (${r.position.x}, ${r.position.y}) => (${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y,r.audioNodes&&(r.audioNodes.pannerNode.positionX.value=t.x,r.audioNodes.pannerNode.positionY.value=t.y)}else if("subscribed"===i.status)this.logger.log(`[remote#${e} status:${i.status}]界外，【即将取消订阅】:  (${r.position.x}, ${r.position.y}) => (${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y,await this.client.doUnsubscribe(n),this.updatePosition(e,r.position);else{if(r.position.x===t.x&&r.position.y===t.y)return;this.logger.log(`[remote#${e} status:${i.status}]界外，即将更新remoteStream位置:  (${r.position.x}, ${r.position.y}) => (${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y,r.audioNodes&&(r.audioNodes.pannerNode.positionX.value=t.x,r.audioNodes.pannerNode.positionY.value=t.y)}}else this.logger.log(`updatePosition: 更新未到的stream: ${e} ( ${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y}init(){this.client.on("stream-added",(e=>{const t=this.getUserData(e.stream.getId());e.stream.setSubscribeConfig(this.options.subConfig),this.updatePosition(e.stream.getId(),t.position)})),this.client.on("stream-unsubscribed",(e=>{const t=this.getUserData(e.stream.getId());this.updatePosition(e.stream.getId(),t.position)})),this.client.on("stream-subscribed",(async e=>{this.logger.log("Subscribed to",e.stream.streamID,e.mediaType);const t=this.getUserData(e.stream.getId());"audio"===e.mediaType&&(t.audioNodes&&(t.audioNodes.pannerNode.disconnect(),t.audioNodes.source.disconnect(),t.audioNodes.gainNode.disconnect()),t.audioNodes={source:this.context.createMediaStreamSource(e.stream.mediaHelper.audio.audioStream),gainNode:this.context.createGain(),pannerNode:new PannerNode(this.context,{panningModel:"HRTF",distanceModel:"linear",rolloffFactor:1,coneInnerAngle:360,positionX:t.position.x,positionY:t.position.y,positionZ:0,maxDistance:100})},t.audioNodes.source.connect(t.audioNodes.gainNode),t.audioNodes.gainNode.connect(t.audioNodes.pannerNode),t.audioNodes.pannerNode.connect(this.destination),this.fakeElem.srcObject=e.stream.mediaHelper.audio.audioStream,this.fakeElem.play().catch((e=>{n.Device.onUserGestureNeeded&&(n.Device.onUserGestureNeeded(e),n.Device.once("user-gesture-fired",(()=>{this.fakeElem.play()})))})),this.logger.log("Connected",e.stream.getId,e.stream.mediaHelper.audio.audioStream.getAudioTracks()[0])),this.updatePosition(e.stream.getId(),t.position)}))}play(){this.elem.controls=!0,"suspended"===this.context.state&&n.Device.onUserGestureNeeded&&(n.Device.onUserGestureNeeded(new Error("恢复AudioContext")),n.Device.once("user-gesture-fired",(()=>{this.context.resume()}))),this.elem.play().catch((e=>{n.Device.onUserGestureNeeded&&(n.Device.onUserGestureNeeded(e),n.Device.once("user-gesture-fired",(()=>{this.elem.play()})))}))}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FormatMedia=void 0;const n=r(3);class i extends n.EventEmitter{constructor(e){super(),this.adapterRef=e.adapterRef,this.logger=e.adapterRef.logger,this.audioContext=null,this.destination=null,this.audioStreams=[],this.canvas=null,this.canvasContext=null,this.canvasTimer=null}async formatAudio(e){this.logger.log("formatAudio() [混音: ]",e);try{return this.audioContext||(this.audioContext=new window.AudioContext),this.destination=this.audioContext.createMediaStreamDestination(),await this.initAudioIn(e),this.destination.stream}catch(e){return this.logger.error("媒体设备获取失败: ",e.name,e.message),Promise.reject(e)}}initAudioIn(e){if(this.audioContext&&this.destination){for(var t=0;t<e.length;t++){const r=e[t].getAudioTracks()[0];if("live"!==(null==r?void 0:r.readyState))continue;const n=this.audioContext.createMediaStreamSource(e[t]);n.connect(this.destination),this.audioStreams.push(n)}this.logger.log(`initAudioIn() [初始化音频 state: ${this.audioContext.state}]`),"running"!==this.audioContext.state&&this.audioContext.resume().then((()=>{this.audioContext&&this.logger.log(`initAudioIn(): [audioContext 状态变更成功 state: ${this.audioContext.state}]`)})).catch((e=>{this.logger.warn(`initAudioIn(): [audioContext 状态变更发生错误, errorName: ${e.name}, erroMessage: ${e.message}]`),this.audioContext&&this.audioContext.resume()}))}else this.logger.error("initAudioIn:参数不够")}async updateStream(e){this.logger.log("updateStream() [更新混频的音频数据: ]",e),this.audioStreams.forEach((e=>{e.disconnect(0)})),this.audioStreams.length=0,this.initAudioIn(e)}stopFormatAudio(){this.logger.log("stopFormatAudio() [结束混音]"),this.audioStreams.forEach((e=>{e.disconnect(0)})),this.audioContext&&this.audioContext.close(),this.audioContext=null,this.destination=null}async formatVideo(e,t){this.logger.log("formatVideo() 混频 recorder: ",e,"recordConfig: ",t);let r=640,n=360;const i=(null==t?void 0:t.recordVideoFrame)||15;switch(null==t?void 0:t.recordVideoQuality){case 360:r=640,n=360;break;case 480:r=640,n=480;break;case 720:r=1280,n=720}this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d")),this.canvas.width=r,this.canvas.height=n,this.canvasTimer&&(clearInterval(this.canvasTimer),this.canvasTimer=null);const o=Math.floor(r/2),a=Math.floor(n/2),s=Math.floor(r/3),c=Math.floor(n/3);return this.canvasContext&&(this.canvasContext.fillStyle="black",this.canvasContext.fillRect(0,0,r,n)),this.canvasTimer&&clearInterval(this.canvasTimer),this.canvasTimer=setInterval((()=>{var i,u,l,d,p,f,h,m;this.canvasContext&&(this.canvasContext.fillStyle="black",this.canvasContext.fillRect(0,0,r,n));let g=[];if("video"===(null==t?void 0:t.recordType)&&(this.adapterRef.localStream&&(null===(i=this.adapterRef.localStream.Play)||void 0===i?void 0:i.videoDom)?g.push(null===(u=this.adapterRef.localStream.Play)||void 0===u?void 0:u.videoDom):g.push(document.createElement("video")),this.adapterRef.localStream&&(null===(l=this.adapterRef.localStream.Play)||void 0===l?void 0:l.screenDom)&&g.push(null===(d=this.adapterRef.localStream.Play)||void 0===d?void 0:d.screenDom),"all"===e&&this.adapterRef.remoteStreamMap))for(var v in this.adapterRef.remoteStreamMap){const e=this.adapterRef.remoteStreamMap[v];(null===(p=e.Play)||void 0===p?void 0:p.videoDom)&&g.push(null===(f=e.Play)||void 0===f?void 0:f.videoDom),(null===(h=e.Play)||void 0===h?void 0:h.screenDom)&&g.push(null===(m=e.Play)||void 0===m?void 0:m.screenDom)}switch(g.length>9&&(g=g.filter((e=>4===e.readyState))),g.length){case 0:break;case 1:this.drawSingleVideo(g[0],0,0,r,n);break;case 2:this.drawSingleVideo(g[0],0,0,o,n),this.drawSingleVideo(g[1],o,0,o,n);break;case 3:case 4:this.drawSingleVideo(g[0],0,0,o,a),this.drawSingleVideo(g[1],o,0,o,a),this.drawSingleVideo(g[2],0,a,o,a),this.drawSingleVideo(g[3],o,a,o,a);break;default:this.drawSingleVideo(g[0],0,0,s,c),this.drawSingleVideo(g[1],s,0,s,c),this.drawSingleVideo(g[2],2*s,0,s,c),this.drawSingleVideo(g[3],0,c,s,c),this.drawSingleVideo(g[4],s,c,s,c),this.drawSingleVideo(g[5],2*s,c,s,c),this.drawSingleVideo(g[6],0,2*c,s,c),this.drawSingleVideo(g[7],s,2*c,s,c),this.drawSingleVideo(g[8],2*s,2*c,s,c)}}),Math.floor(1e3/i)),this.canvas.captureStream()}drawSingleVideo(e,t,r,n,i){var o;if(!e)return;const a=Math.min(n/e.videoWidth,i/e.videoHeight);let s=e.videoWidth*a,c=e.videoHeight*a,u=t+(n-s)/2,l=r+(i-c)/2;null===(o=this.canvasContext)||void 0===o||o.drawImage(e,u,l,s,c)}async stopFormatVideo(){this.logger.log("stopFormatAudio() [结束混频]"),this.canvasTimer&&(clearInterval(this.canvasTimer),this.canvasTimer=null),this.canvasContext=this.canvas=null}destroy(){this.logger.log("destroy()"),this.stopFormatAudio(),this.stopFormatVideo()}}t.FormatMedia=i},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStream=void 0;const s=r(3),c=r(45),u=r(92),l=r(59),d=r(96),p=r(15),f=r(264),h=a(r(1)),m=a(r(0)),g=a(r(11)),v=r(34),y=r(32),b=r(2),S=r(31),_=r(265),M=o(r(13));let T=0;class w extends s.EventEmitter{constructor(e){if(super(),this.audioLevelHelper=null,this.videoProfile={frameRate:c.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,resolution:c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p},this.screenProfile={frameRate:c.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5,resolution:c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p},this.state="UNINIT",this.videoView=null,this.screenView=null,this.renderMode={local:{video:{},screen:{}}},this.inSwitchDevice={audio:!1,video:!1},this.pubStatus={audio:{audio:!1},video:{video:!1},screen:{screen:!1}},this.muteStatus={audio:{send:!1},video:{send:!1},screen:{send:!1}},this.isRemote=!1,this.audioPlay_=!1,this.videoPlay_=!1,this.screenPlay_=!1,this.active=!0,this.destroyed=!1,this.isBeautyTrack=!1,this.localStreamId=T++,this.logger=e.client.adapterRef.logger.getChild((()=>{let e=this.localStreamId?"local"+this.localStreamId:"localStream";if(this.mediaHelper){let t="";this.mediaHelper.audio.micTrack&&(t+="m"),this.mediaHelper.video.cameraTrack&&(t+="c"),this.mediaHelper.screen.screenVideoTrack&&(t+="s"),this.mediaHelper.screenAudio.screenAudioTrack&&(t+="t"),t&&(e+=" "+t)}return"INITED"!==this.state&&(e+=" "+this.state),"INITED"===this.state&&this.client&&this.client.adapterRef.localStream!==this&&(e+=" DETACHED"),this.destroyed&&(e+=" DESTROYED"),e})),e.uid)if("string"==typeof e.uid||g.default.isBigNumber(e.uid))this.logger.log("uid是string类型"),e.client.adapterRef.channelInfo.uidType="string";else{if("number"!=typeof e.uid)throw this.logger.error("uid参数格式非法"),new h.default({code:m.default.INVALID_PARAMETER,message:"uid is invalid"});if(this.logger.log("uid是number类型"),e.client.adapterRef.channelInfo.uidType="number",e.uid>Number.MAX_SAFE_INTEGER)throw new h.default({code:m.default.INVALID_PARAMETER,message:"uid is exceeds the scope of Number"})}else e.uid="local_"+this.localStreamId;this._reset(),this.streamID=e.uid,this.stringStreamID=this.streamID.toString(),this.audio=e.audio,this.audioProcessing=e.audioProcessing||null,this.microphoneId=e.microphoneId||"",this.cameraId=e.cameraId||"",this.video=e.video||!1,this.screen=e.screen||!1,this.screenAudio=e.screenAudio||!1,this.sourceId=e.sourceId||"",this.facingMode=e.facingMode||"",this.client=e.client,this.audioSource=e.audioSource||null,this.videoSource=e.videoSource||null,this.screenAudioSource=e.screenAudioSource||null,this.screenVideoSource=e.screenVideoSource||null,this._cameraTrack=null,this._transformedTrack=null,this.mediaHelper=new d.MediaHelper({stream:this}),this._play=new u.Play({stream:this}),this._record=new l.Record({logger:this.logger,client:this.client}),this.client._params&&"live"===this.client._params.mode?this.audioProfile="music_standard":this.audioProfile="speech_low_quality",this.logger.log("创建 本地 Stream: ",JSON.stringify({streamID:this.stringStreamID,audio:e.audio,video:e.video})),this.client.apiFrequencyControl({name:"createLocalStream",code:0,param:{streamID:this.stringStreamID,videoProfile:this.videoProfile,audio:this.audio,audioProfile:this.audioProfile,video:this.video,screen:this.screen,screenProfile:this.screenProfile}})}getAdapterRef(){return this.client.adapterRef.localStream===this?this.client.adapterRef:null}_reset(){this.streamID="",this.stringStreamID="",this.state="UNINIT",this.videoProfile={frameRate:c.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,resolution:c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p},this.audioProfile="speech_low_quality",this.screenProfile={frameRate:c.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5,resolution:c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p},this.audio=!1,this.microphoneId="",this.video=!1,this.cameraId="",this.screen=!1,this.screenAudio=!1,this.sourceId="",this.facingMode="",this.videoView=null,this.screenView=null,this.renderMode={local:{video:{},screen:{}}},this.inSwitchDevice={audio:!1,video:!1},this.pubStatus={audio:{audio:!1},video:{video:!1},screen:{screen:!1}},this.muteStatus={audio:{send:!1},video:{send:!1},screen:{send:!1}},this.renderMode={local:{video:{},screen:{}}},this.mediaHelper&&this.mediaHelper.destroy(),this._play&&this._play.destroy(),this._play=null,this._record&&this._record.destroy(),this._record=null,this.audioLevelHelper&&this.audioLevelHelper.destroy(),this.audioLevelHelper=null}get Play(){return this._play}get Record(){return this._record}getId(){return"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID}async getStats(){var e,t,r;let n=null===(r=null===(t=null===(e=this.getAdapterRef())||void 0===e?void 0:e._mediasoup)||void 0===t?void 0:t._sendTransport)||void 0===r?void 0:r._handler._pc;if(this.logger.log("获取音视频连接数据, uid: "+this.stringStreamID),n){const t={accessDelay:"0",audioSendBytes:"0",audioSendPackets:"0",audioSendPacketsLost:"0",videoSendBytes:"0",videoSendFrameRate:"0",videoSendPackets:"0",videoSendPacketsLost:"0",videoSendResolutionHeight:"0",videoSendResolutionWidth:"0"};try{(await n.getStats()).forEach((e=>{"outbound-rtp"===e.type?"video"===e.mediaType?(t.videoSendBytes=e.bytesSent.toString(),t.videoSendPackets=e.packetsSent.toString(),t.videoSendFrameRate=e.framesPerSecond.toString()):"audio"===e.mediaType&&(t.audioSendBytes=e.bytesSent.toString(),t.audioSendPackets=e.packetsSent.toString()):"candidate-pair"===e.type?"number"==typeof e.currentRoundTripTime&&(t.accessDelay=(1e3*e.currentRoundTripTime).toString()):"track"===e.type?void 0!==e.frameWidth&&(t.videoSendResolutionWidth=e.frameWidth.toString(),t.videoSendResolutionHeight=e.frameHeight.toString()):"remote-inbound-rtp"===e.type&&("audio"===e.kind?t.audioSendPacketsLost=e.packetsLost.toString():"video"===e.kind&&(t.videoSendPacketsLost=e.packetsLost.toString()))}))}catch(e){this.logger.error("failed to get localStats",e.name,e.message)}return t}}getAudioStream(){return this.mediaHelper?(this.client.apiFrequencyControl({name:"setExternalAudioRender",code:0,param:JSON.stringify({},null," ")}),this.mediaHelper.audio.audioStream):null}async init(){v.isHttpProtocol()&&this.logger.warn("The current protocol is HTTP");const e=await this.client.operationQueue.enqueue({caller:this,method:"init",options:null}),t=()=>{e();const t={audio:this.audio,video:this.video,screen:this.screen,screenAudio:this.screenAudio};(this.audio||this.screenAudio)&&(t.audioProfile=this.audioProfile,t.audioProcessing=this.audioProcessing),this.video&&(t.videoProfile=this.mediaHelper.video.captureConfig.high,t.videoEncoder=this.mediaHelper.video.encoderConfig.high),this.screen&&(t.screenProfile=this.mediaHelper.screen.captureConfig.high,t.screenEncoder=this.mediaHelper.screen.encoderConfig.high),this.client.apiFrequencyControl({name:"init",code:0,param:Object.assign({streamID:this.stringStreamID},t)}),this.client.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(this.mediaHelper.getTrackSettings())})};let r=null;if(this.state="INITING",this.logger.log("初始化音视频流对象"),this.client.adapterRef.channelInfo.sessionConfig.maxVideoQuality=c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p,this.videoProfile&&(this.client.adapterRef.channelInfo.sessionConfig.videoQuality=this.videoProfile.resolution,this.client.adapterRef.channelInfo.sessionConfig.videoFrameRate=this.videoProfile.frameRate),!window.isAudioBanned||!window.isVideoBanned){if(window.isAudioBanned){const e="服务器禁止发送音频流";this.logger.error(e),this.client.apiFrequencyControl({name:"open",code:-1,param:JSON.stringify({reason:e},null," ")}),this.audio=!1,this.screenAudio=!1}if(window.isVideoBanned){const e="服务器禁止发送视频流";this.logger.error(e),this.client.apiFrequencyControl({name:"open",code:-1,param:JSON.stringify({reason:e},null," ")}),this.video=!1,this.screen=!1}try{this.audio&&await this.mediaHelper.getStream({audio:this.audio,audioDeviceId:this.microphoneId,audioSource:this.audioSource})}catch(e){this.logger.log("打开mic失败: ",e.name,e.message),r=e,this.audio=!1}try{this.video&&(await this.mediaHelper.getStream({video:this.video,videoSource:this.videoSource,videoDeviceId:this.cameraId,facingMode:this.facingMode}),this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("video"))}catch(e){this.logger.log("打开camera失败: ",e.name,e.message),r=e,this.video=!1}try{if(this.screen){const e={sourceId:this.sourceId,screen:this.screen,screenVideoSource:this.screenVideoSource,screenAudio:this.screenAudio,screenAudioSource:this.screenAudioSource};await this.mediaHelper.getStream(e),this.mediaHelper.screen.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("screen")}}catch(e){this.logger.log("打开屏幕共享失败: ",e.name,e.message),r=e,this.screen=!0}if(this.audio||this.video||this.screen)this.state="INITED";else{if(r)throw this.state="UNINIT",this.logger.error("localStream.init失败:",r.name,r.message,r),t(),r;if(!b.getParameters().allowEmptyMedia)throw this.state="UNINIT",this.logger.error("localStream不允许初始化时无任何音视频"),t(),new h.default({code:m.default.NO_MEDIA,messsage:"localStream不允许初始化时无任何音视频"});this.logger.log("当前模式下localStream允许初始化时无任何音视频"),this.state="INITED"}t()}}getAudioTrack(){return this.mediaHelper.getAudioInputTracks()[0]||null}getVideoTrack(){if(this.mediaHelper)return this.mediaHelper.video.cameraTrack||this.mediaHelper.screen.screenVideoTrack||this.mediaHelper.video.videoSource}async play(e,t={}){p.isExistOptions({tag:"Stream.playOptions.audio",value:t.audio}).result||(t.audio=!1),t.audio&&!t.audioType&&(t.audioType="mixing"),p.isExistOptions({tag:"Stream.playOptions.video",value:t.video}).result||(t.video=!0),p.isExistOptions({tag:"Stream.playOptions.screen",value:t.screen}).result||(t.screen=!0),this.logger.log(`uid ${this.stringStreamID} Stream.play::`,JSON.stringify(t)),t.audio&&this._play&&this.mediaHelper.getAudioInputTracks().length>0&&(this.logger.log(`uid ${this.stringStreamID} 开始播放本地音频: `,t.audioType),"voice"===t.audioType?(this._play.playAudioStream(this.mediaHelper.audio.micStream,t.muted),this.audioPlay_=!0):"music"===t.audioType?(this._play.playAudioStream(this.mediaHelper.audio.musicStream,t.muted),this.audioPlay_=!0):"mixing"===t.audioType&&(this._play.playAudioStream(this.mediaHelper.audio.audioStream,t.muted),this.audioPlay_=!0));let r=null;if("string"==typeof e?r=document.getElementById(e):e&&(r=e),r){if(t.video&&(this.videoView=r,this._play&&this.mediaHelper.video.videoStream.getVideoTracks().length)){this.logger.log(`uid ${this.stringStreamID} 开始启动视频播放 主流 本地`);try{let e="local";await this._play.playVideoStream(this.mediaHelper.video.renderStream,r,e),"width"in this.renderMode.local.video&&this._play.setVideoRender(this.renderMode.local.video),this.videoPlay_=!0}catch(e){this.videoPlay_=!1,this.logger.log("localStream play video error ",e)}}if(t.screen&&(this.screenView=r,this._play&&this.mediaHelper.screen.screenVideoStream.getVideoTracks().length)){this.logger.log(`uid ${this.stringStreamID} 开始启动视频播放 辅流 本地`);try{await this._play.playScreenStream(this.mediaHelper.screen.renderStream,r),"width"in this.renderMode.local.screen&&this._play.setScreenRender(this.renderMode.local.screen),this.screenPlay_=!1}catch(e){this.screenPlay_=!1,this.logger.log("localStream play screen error ",e)}}}if(t.audio){let e;e=window.isAudioBanned?{enable:!1}:{enable:!0},this.client.apiFrequencyControl({name:"enableEarback",code:e.enable?0:1,param:JSON.stringify(e,null," ")})}this.client.apiFrequencyControl({name:"play",code:0,param:JSON.stringify({streamID:this.stringStreamID,playOptions:t,isRemote:!1},null," ")})}async resume(){this._play&&(await this._play.resume(),this._play.audioDom&&!this._play.audioDom.paused&&(this.audioPlay_=!0),this._play.videoDom&&!this._play.videoDom.paused&&(this.videoPlay_=!0),this._play.screenDom&&!this._play.screenDom.paused&&(this.screenPlay_=!0)),this.client.apiFrequencyControl({name:"resume",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}setLocalRenderMode(e,t){const r={options:e,mediaType:t};if(!(e&&e.width-0&&e.height-0))return this.logger.warn("setLocalRenderMode 参数错误"),this.client.apiFrequencyControl({name:"setLocalRenderMode",code:-1,param:JSON.stringify(r,null," ")}),"INVALID_ARGUMENTS";this.logger.log(`uid ${this.stringStreamID} 设置本地视频播放窗口大小: `,t||"video+screen",JSON.stringify(e)),t&&"video"!==t||(this._play&&this._play.setVideoRender(e),this.renderMode.local.video=e),t&&"screen"!==t||(this.renderMode.local.screen=e,this._play&&this._play.setScreenRender(e)),this.client.apiFrequencyControl({name:"setLocalRenderMode",code:0,param:Object.assign({streamID:this.stringStreamID,mediaType:t},r)})}stop(e){this.logger.log(`uid ${this.stringStreamID} Stream.stop: 停止播放 ${e||"音视频流"}`),this._play&&("audio"===e?(this._play.stopPlayAudioStream(),this.audioPlay_=!1):"video"===e?(this._play.stopPlayVideoStream(),this.videoPlay_=!1):"screen"===e?(this._play.stopPlayScreenStream(),this.screenPlay_=!1):(this._play.audioDom&&(this._play.stopPlayAudioStream(),this.audioPlay_=!1),this._play.videoDom&&(this._play.stopPlayVideoStream(),this.videoPlay_=!1),this._play.screenDom&&(this._play.stopPlayScreenStream(),this.screenPlay_=!1)),this.client.apiFrequencyControl({name:"stop",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,audio:this.audio,video:this.video,screen:this.screen,type:e},null," ")}))}async isPlaying(e){let t=!1;if(this._play)if("audio"===e)t=await this._play.isPlayAudioStream();else if("video"===e)t=await this._play.isPlayVideoStream();else{if("screen"!==e)return this.logger.warn("isPlaying: unknown type"),Promise.reject(new h.default({code:m.default.UNKNOWN_TYPE,message:"unknown type"}));t=await this._play.isPlayScreenStream()}return this.client.apiFrequencyControl({name:"isPlaying",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,type:e},null," ")}),this.logger.log(`检查${this.stringStreamID}的${e}播放状态: ${t}`),t}async open(e){var t,r,n,i;let{type:o,deviceId:a,sourceId:s,facingMode:c,screenAudio:u,audioSource:l,videoSource:d,screenAudioSource:p,screenVideoSource:f}=e;const g=await this.client.operationQueue.enqueue({caller:this,method:"open",options:e}),v=t=>{g();const r=S.makePrintable(Object.assign({},e,t.param),4);this.client.apiFrequencyControl({name:"open",code:t.code,param:Object.assign({streamID:this.stringStreamID},r)}),this.client.apiFrequencyControl({name:"_trackSettings",code:t.code,param:JSON.stringify(this.mediaHelper.getTrackSettings())})};if(1===this.client._roleInfo.userRole){const e="观众不允许打开设备";return this.logger.error(e),v({code:-1,param:{reason:e,type:o}}),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"audience is not allowed to open"}))}try{switch(o){case"audio":if(window.isAudioBanned){const e="服务器禁止发送音频流";return this.logger.error(e),v({code:-1,param:{reason:e,type:o}}),Promise.reject(new h.default({code:m.default.MEDIA_OPEN_BANNED_BY_SERVER,message:"audio is banned by server"}))}if(this.logger.log("open(): 开启 "+(l?l.label:"mic设备")),this.mediaHelper.audio.micTrack||this.mediaHelper.audio.audioSource)return this.logger.warn("请先关闭麦克风"),v({code:-1,param:{reason:"请先关闭麦克风",type:o}}),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"please close mic first"}));if(this.audio=!0,this.mediaHelper){const e={audio:!0,audioDeviceId:a,audioSource:l};await this.mediaHelper.getStream(e),this.audioLevelHelper&&this.mediaHelper.audio.audioStream&&this.audioLevelHelper.updateStream(this.mediaHelper.audio.audioStream),a&&(this.microphoneId=a),this.getAdapterRef()?"CONNECTED"!==this.client.adapterRef.connectState.curState?this.logger.log("Stream.open:client不在频道中，无需发布。",e):(this.logger.log("Stream.open:开始发布",e),await(null===(t=this.client.adapterRef._mediasoup)||void 0===t?void 0:t.createProduce(this,"audio"))):this.logger.log("Stream.open:localStream未发布，无需发布",o,e)}break;case"screenAudio":if(window.isAudioBanned){const e="服务器禁止发送音频流";return this.logger.error(e),v({code:-1,param:{reason:e,type:o}}),Promise.reject(new h.default({code:m.default.MEDIA_OPEN_BANNED_BY_SERVER,message:"audio is banned by server"}))}if(!p)return void this.logger.error("open(): 不允许单独开启屏幕共享音频功能。");if(this.logger.log("open(): 开启自定义屏幕共享音频 "+p.label),this.mediaHelper.screenAudio.screenAudioTrack||this.mediaHelper.screenAudio.screenAudioSource)return this.logger.error("请先关闭屏幕共享音频"),v({code:-1,param:{reason:"请先关闭屏幕共享音频",type:o}}),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"please close screenAudio first"}));if(this.screenAudio=!0,this.mediaHelper){const e={screenAudio:!0,screenAudioSource:p};await this.mediaHelper.getStream(e),this.getAdapterRef()?"CONNECTED"!==this.client.adapterRef.connectState.curState?this.logger.log("Stream.open:client不在频道中，无需发布。",e):(this.logger.log("Stream.open:开始发布",e),await(null===(r=this.client.adapterRef._mediasoup)||void 0===r?void 0:r.createProduce(this,"audio"))):this.logger.log("Stream.open:localStream未发布，无需发布",o,e)}break;case"video":case"screen":if(window.isVideoBanned){const e="服务器禁止发送视频流";return this.logger.error(e),v({code:-1,param:{reason:e,type:o}}),Promise.reject(new h.default({code:m.default.MEDIA_OPEN_BANNED_BY_SERVER,message:"video is banned by server"}))}if(e.screenAudio&&window.isAudioBanned){const t="服务器禁止发送音频流";return this.logger.error(t),v({code:-1,param:{reason:t,type:o,screenAudio:e.screenAudio}}),Promise.reject(new h.default({code:m.default.MEDIA_OPEN_BANNED_BY_SERVER,message:"audio is banned by server"}))}if(this.logger.log(`开启${"video"===o?"camera":"screen"}设备`),this[o])return"video"===o?(this.logger.warn("请先关闭摄像头"),v({code:-1,param:{reason:"请先关闭摄像头",type:o}}),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"please close video first"}))):(this.logger.warn("请先关闭屏幕共享"),this.client.apiFrequencyControl({name:"open",code:-1,param:JSON.stringify({reason:"请先关闭屏幕共享",type:o},null," ")}),v({code:-1,param:{reason:"请先关闭屏幕共享",type:o}}),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"please close screen-sharing first"})));if(e.screenAudio&&(this.mediaHelper.screenAudio.screenAudioTrack||this.mediaHelper.screenAudio.screenAudioSource))return this.logger.warn("请先关闭屏幕共享音频"),v({code:-1,param:{reason:"请先关闭屏幕共享音频",type:o}}),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"please close screenAudio first"}));this[o]=!0;const u={videoDeviceId:a,sourceId:s,videoSource:d,screenAudioSource:p,screenVideoSource:f,facingMode:c};u[o]=!0,"screen"===o&&e.screenAudio&&(u.screenAudio=!0,this.screenAudio=!0),await this.mediaHelper.getStream(u),this.screenAudio&&this.audioLevelHelper&&this.mediaHelper.audio.audioStream&&this.audioLevelHelper.updateStream(this.mediaHelper.audio.audioStream),"video"===o&&this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("video"),"screen"===o&&this.mediaHelper.screen.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("screen"),a&&"video"===o&&(this.cameraId=a),this.getAdapterRef()?"CONNECTED"!==this.client.adapterRef.connectState.curState?this.logger.log("Stream.open:client不在频道中，无需发布。",u):(this.logger.log("Stream.open:开始发布",u),await(null===(n=this.client.adapterRef._mediasoup)||void 0===n?void 0:n.createProduce(this,o)),e.screenAudio&&await(null===(i=this.client.adapterRef._mediasoup)||void 0===i?void 0:i.createProduce(this,"audio"))):this.logger.log("Stream.open:localStream未发布，无需发布",o,u);break;default:this.logger.error("非法参数")}v({code:0,param:{type:o}})}catch(t){return["audio","video","screen"].indexOf(o)>-1&&(this[o]=!1,"screen"===o&&e.screenAudio&&(this.screenAudio=!1)),this.logger.log(o+" 开启失败: ",t.name,t.message),v({code:-1,param:{type:o,reason:t.message}}),t.message&&t.message.indexOf("ermission")>-1&&t.message.indexOf("denied")>-1?Promise.reject(new h.default({code:m.default.NOT_ALLOWED,message:t.message})):Promise.reject(t)}}async switchScreenStream(e){var t,r;let n=null,i=!1,o=null,a="";"video"===(null===(t=e.screenVideoSource)||void 0===t?void 0:t.kind)?(n=e.screenVideoSource,i=!0):n=(await this.mediaHelper.getScreenSource({screen:this.screen})).getVideoTracks()[0],n?(o=await this.replaceTrack({mediaType:"screen",track:n,external:i}),o?(this.client.adapterRef.logger.log(`switchScreenStream: 已从 ${o.external?"自定义辅流":"屏幕共享"} 切换到 ${i?"自定义辅流":"屏幕共享"}`),o.external||o.oldTrack.stop(),null===(r=o.oldTrackLow)||void 0===r||r.stop()):(a="当前没有screen流",this.client.adapterRef.logger.error(`switchScreenStream: 无法切换到${i?"自定义辅流":"屏幕共享"}: ${a}`))):(a="无法获得新的screenVideoTrack",this.client.adapterRef.logger.error("switchScreenStream: ",a)),this.client.adapterRef.instance.apiEventReport("setFunction",{name:"switch_to_custom_screen",oper:"1",value:a||"success"}),this.client.apiFrequencyControl({name:"switchScreenStream",code:a?-1:0,param:JSON.stringify({external:i,reason:a},null," ")})}async close(e){var t,r,n,i;e||(e={type:"all"});const o=await this.client.operationQueue.enqueue({caller:this,method:"close",options:e});let a=e.type,s=null;switch(a){case"audio":if(this.logger.log("关闭mic设备"),!this.audio){this.logger.log("没有开启过麦克风"),s="NOT_OPEN_MIC_YET";break}this.audio=!1,this.mediaHelper.stopStream("audio"),this.getAdapterRef()?this.mediaHelper.getAudioInputTracks().length>0?this.logger.log("Stream.close:关闭音频，保留发布：",a):(this.logger.log("Stream.close:停止发布音频"),await(null===(t=this.client.adapterRef._mediasoup)||void 0===t?void 0:t.destroyProduce("audio"))):this.logger.log("Stream.close:未发布音频，无需停止发布");break;case"screenAudio":if(this.logger.log("关闭屏幕共享音频"),!this.screenAudio){this.logger.log("没有开启过屏幕共享音频"),s="NOT_OPEN_SCREENAUDIO_YET";break}this.screenAudio=!1,this.mediaHelper.stopStream("screenAudio"),this.getAdapterRef()?this.mediaHelper.getAudioInputTracks().length>0?this.logger.log("Stream.close:关闭音频，保留发布：",a):(this.logger.log("Stream.close:停止发布音频"),await(null===(r=this.client.adapterRef._mediasoup)||void 0===r?void 0:r.destroyProduce("audio"))):this.logger.log("Stream.close:未发布音频，无需停止发布");break;case"video":if(this.logger.log("关闭camera设备"),!this.video){this.logger.log("没有开启过摄像头"),s="NOT_OPEN_CAMERA_YET";break}if(this._transformedTrack&&this._cameraTrack&&(this._cameraTrack.stop(),this._cameraTrack=null),this._transformedTrack&&(this._transformedTrack.stop(),this._transformedTrack=null),this.video=!1,this.mediaHelper.stopStream("video"),this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.disablePreProcessing("video",!0),!this._play)throw o(),new h.default({code:m.default.NO_PLAY,message:"no play"});this._play.stopPlayVideoStream(),this.getAdapterRef()?(this.logger.log("Stream.close:停止发布视频"),await(null===(n=this.client.adapterRef._mediasoup)||void 0===n?void 0:n.destroyProduce("video"))):this.logger.log("Stream.close:未发布视频，无需停止发布");break;case"screen":if(this.logger.log("关闭屏幕共享"),!this.screen){this.logger.log("没有开启过屏幕共享"),s="NOT_OPEN_SCREEN_YET";break}if(this.screen=!1,this.mediaHelper.screen.preProcessingEnabled&&this.mediaHelper.disablePreProcessing("screen",!0),this.mediaHelper.stopStream("screen"),!this._play)throw new h.default({code:m.default.NO_PLAY,message:"no play"});this._play.stopPlayScreenStream(),this.getAdapterRef()?(this.logger.log("Stream.close:停止发布辅流"),await(null===(i=this.client.adapterRef._mediasoup)||void 0===i?void 0:i.destroyProduce("screen"))):this.logger.log("Stream.close:未发布辅流，无需停止发布");break;case"all":this.logger.log(`Stream.close:关闭所有设备：audio ${this.audio}, video ${this.video}, screen ${this.screen}, screenAudio ${this.screenAudio}`),this.audio&&await this.close({type:"audio"}),this.video&&await this.close({type:"video"}),this.screen&&await this.close({type:"screen"}),this.screenAudio&&await this.close({type:"screenAudio"}),this.logger.log(`Stream.close:关闭所有设备成功：audio ${this.audio}, video ${this.video}, screen ${this.screen}, screenAudio ${this.screenAudio}`);break;default:this.logger.log("不能识别type"),s="INVALID_ARGUMENTS"}return s?(this.client.apiFrequencyControl({name:"close",code:-1,param:JSON.stringify({reason:s,streamID:this.stringStreamID,audio:this.audio,video:this.video,screen:this.screen,type:e.type},null," ")}),"NOT_OPEN_MIC_YET"===s?(o(),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"mic is not open"}))):"NOT_OPEN_CAMERA_YET"===s?(o(),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"camera is not open"}))):"NOT_OPEN_SCREEN_YET"===s?(o(),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"screen-sharing is not open"}))):(o(),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:s})))):(o(),void this.client.apiFrequencyControl({name:"close",code:0,param:JSON.stringify({reason:s,streamID:this.stringStreamID,audio:this.audio,video:this.video,screen:this.screen,screenAudio:this.screenAudio,type:e.type},null," ")}))}async unmuteAudio(){var e,t;this.logger.log("启用音频轨道: ",this.stringStreamID);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.unmuteAudio());const r=this.mediaHelper.audio.audioStream.getAudioTracks();r&&r.length&&r.forEach((e=>{e.enabled=!0})),this.mediaHelper.getAudioInputTracks().forEach((e=>{e.enabled=!0})),(null===(t=this.mediaHelper.audio.webAudio)||void 0===t?void 0:t.gainFilter)&&(this.mediaHelper.audio.webAudio.gainFilter.gain.value=1),this.muteStatus.audio.send=!1,this.client.apiFrequencyControl({name:"unmuteAudio",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("API调用失败：Stream:unmuteAudio",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteAudio",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}async muteAudio(){var e,t;this.logger.log("禁用音频轨道: ",this.stringStreamID);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.muteAudio());const r=this.mediaHelper.audio.audioStream.getAudioTracks();r&&r.length&&r.forEach((e=>{e.enabled=!1})),this.mediaHelper.getAudioInputTracks().forEach((e=>{e.enabled=!1})),(null===(t=this.mediaHelper.audio.webAudio)||void 0===t?void 0:t.gainFilter)&&(this.mediaHelper.audio.webAudio.gainFilter.gain.value=0),this.muteStatus.audio.send=!0,this.client.apiFrequencyControl({name:"muteAudio",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("API调用失败：Stream:muteAudio",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteAudio",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}hasAudio(){return this.mediaHelper.getAudioInputTracks().length>0}getAudioLevel(){var e;return!this.audioLevelHelper&&this.mediaHelper.getAudioTrack()&&(this.audioLevelHelper=new f.AudioLevel({adapterRef:this.client.adapterRef,stream:this.mediaHelper.audio.audioStream})),(null===(e=this.audioLevelHelper)||void 0===e?void 0:e.getAudioLevel())||0}setAudioProfile(e){this.logger.log("设置音频属性: ",e),this.audioProfile=e,this.client.apiFrequencyControl({name:"setAudioProfile",code:0,param:{streamID:this.stringStreamID,profile:e}})}setAudioVolume(e=100){let t=null;if(Number.isInteger(e)?e<0?e=0:e>100?e=255:e*=2.55:(this.logger.log("volume 为 0 - 100 的整数"),t="INVALID_ARGUMENTS"),this.logger.log(`调节${this.stringStreamID}的音量大小: ${e}`),this.audio){if(!this._play)throw new h.default({code:m.default.NO_PLAY,message:"no play"});this._play.setPlayVolume(e)}else this.logger.log("没有音频流，请检查是否有发布过音频"),t="INVALID_OPERATION";if(t)return this.client.apiFrequencyControl({name:"setAudioVolume",code:-1,param:{streamID:this.stringStreamID,isRemote:!1,volume:e,reason:t}}),t;this.client.apiFrequencyControl({name:"setAudioVolume",code:0,param:{streamID:this.stringStreamID,isRemote:!1,volume:e}})}setCaptureVolume(e,t){let r=null;if(Number.isInteger(e)?e<0?e=0:e>100&&(e=100):(this.logger.log("volume 为 0 - 100 的整数"),r="INVALID_ARGUMENTS"),this.logger.log(`调节${this.stringStreamID}的音量大小: ${e}`),this.mediaHelper.audio.audioRoutingEnabled||this.mediaHelper.enableAudioRouting(),this.mediaHelper.setGain(e/100,t),r)return this.client.apiFrequencyControl({name:"setCaptureVolume",code:-1,param:JSON.stringify({streamID:this.stringStreamID,volume:e,audioType:t,reason:r},null," ")}),r;this.client.apiFrequencyControl({name:"setCaptureVolume",code:0,param:JSON.stringify({streamID:this.stringStreamID,audioType:t,volume:e},null," ")})}async setAudioOutput(e,t){if(this._play){try{await this._play.setAudioOutput(e)}catch(e){throw t&&setTimeout((()=>{t(e)}),0),this.logger.error("设置输出设备失败",e.name,e.message),e}t&&setTimeout(t,0)}this.client.apiFrequencyControl({name:"setAudioOutput",code:0,param:JSON.stringify({streamID:this.stringStreamID,deviceId:e,isRemote:!1},null," ")})}async switchDevice(e,t){this.logger.log(`切换媒体输入设备: ${e}, deviceId: ${t}`);let r={};if(this.inSwitchDevice[e])return this.logger.error("switchDevice：正在切换中，重复",e),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"switching "+e}));if(this.inSwitchDevice[e]=!0,"audio"===e){if(window.isAudioBanned)return Promise.reject(new h.default({code:m.default.MEDIA_OPEN_BANNED_BY_SERVER,message:"audio is banned by server"}));const n=this.mediaHelper.audio.micTrack;if("live"===(null==n?void 0:n.readyState)&&(null==n?void 0:n.getSettings().deviceId)===t)return this.logger.log("切换相同的麦克风设备，不处理"),this.inSwitchDevice[e]=!1,Promise.resolve();if(!this.hasAudio())return this.logger.log("当前没有开启音频输入设备，无法切换"),this.inSwitchDevice[e]=!1,Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"no audio input device"}));if(this.audioSource)return this.logger.log("自定义音频输入不支持，无法切换"),this.inSwitchDevice[e]=!1,Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"cannot switch user-defined audio input"}));this.mediaHelper.audio.micConstraint&&this.mediaHelper.audio.micConstraint.audio?this.mediaHelper.audio.micConstraint.audio.deviceId={exact:t}:this.mediaHelper.audio.micConstraint?(this.mediaHelper.audio.micConstraint.audio={},this.mediaHelper.audio.micConstraint.audio.deviceId={exact:t}):this.mediaHelper.audio.micConstraint={audio:{deviceId:{exact:t}}},r=this.mediaHelper.audio.micConstraint,this.microphoneId=t}else{if("video"!==e)return this.logger.error("switchDevice: unknown type "+e),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"switchDevice: unknown type "+e}));{if(window.isVideoBanned)return Promise.reject(new h.default({code:m.default.MEDIA_OPEN_BANNED_BY_SERVER,message:"video is banned by server"}));const n=this.mediaHelper.video.cameraTrack;if(this._transformedTrack&&(this._transformedTrack.stop(),this._transformedTrack=null),"live"===(null==n?void 0:n.readyState)&&(null==n?void 0:n.getSettings().deviceId)===t)return this.logger.log("切换相同的摄像头设备，不处理"),this.inSwitchDevice[e]=!1,Promise.resolve();if(!this.hasVideo())return this.logger.log("当前没有开启视频输入设备，无法切换"),this.inSwitchDevice[e]=!1,this.client.apiFrequencyControl({name:"switchDevice",code:-1,param:{reason:"INVALID_OPERATION: 当前没有开启视频输入设备，无法切换",type:e,deviceId:t,streamID:this.stringStreamID}}),this.client.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(this.mediaHelper.getTrackSettings())}),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"no video input device"}));if(this.videoSource)return this.logger.log("自定义视频输入不支持，无法切换"),this.inSwitchDevice[e]=!1,this.client.apiFrequencyControl({name:"switchDevice",code:-1,param:{reason:"INVALID_OPERATION: 自定义视频输入不支持，无法切换",type:e,deviceId:t,streamID:this.stringStreamID}}),this.client.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(this.mediaHelper.getTrackSettings())}),Promise.reject(new h.default({code:m.default.INVALID_OPERATION,message:"cannot switch user-defined video input"}));this.mediaHelper.video.cameraConstraint&&this.mediaHelper.video.cameraConstraint.video&&(this.mediaHelper.video.cameraConstraint.video.deviceId={exact:t},r=this.mediaHelper.video.cameraConstraint),this.cameraId=t}}try{const n=this.mediaHelper.video.preProcessingEnabled;n&&this.mediaHelper.disablePreProcessing("video"),await this.mediaHelper.getSecondStream(r),this.inSwitchDevice[e]=!1,n&&this.mediaHelper.enablePreProcessing("video"),"video"===e&&this.client.apiFrequencyControl({name:"switchDevice",code:0,param:{type:e,deviceId:t,streamID:this.stringStreamID}}),this.client.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(this.mediaHelper.getTrackSettings())})}catch(r){return this.logger.error("API调用失败：Stream:switchDevice",r.name,r.message,r),this.inSwitchDevice[e]=!1,"video"===e&&this.client.apiFrequencyControl({name:"switchDevice",code:-1,param:{reason:r.message,type:e,deviceId:t,streamID:this.stringStreamID}}),this.client.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(this.mediaHelper.getTrackSettings())}),Promise.reject(r)}}async unmuteVideo(){var e;this.logger.log(`启用 ${this.stringStreamID} 的视频轨道`);try{this.getAdapterRef()&&(null===(e=this.client.adapterRef._mediasoup)||void 0===e||e.unmuteVideo()),this.mediaHelper.video.videoSource&&(this.mediaHelper.video.videoSource.enabled=!0),this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!0),this.muteStatus.video.send=!1,this.client.apiFrequencyControl({name:"unmuteVideo",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("API调用失败：Stream:unmuteVideo",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteVideo",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}async muteVideo(){var e;this.logger.log(`禁用 ${this.stringStreamID} 的视频轨道`);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.muteVideo()),this.mediaHelper.video.videoSource&&(this.mediaHelper.video.videoSource.enabled=!1),this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!1),this.muteStatus.video.send=!0,this.client.apiFrequencyControl({name:"muteVideo",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("API调用失败：Stream:muteVideo",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteVideo",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}async unmuteScreen(){var e;this.logger.log(`启用 ${this.stringStreamID} 的视频轨道`);try{this.getAdapterRef()&&(null===(e=this.client.adapterRef._mediasoup)||void 0===e||e.unmuteScreen()),this.mediaHelper.screen.screenVideoTrack&&(this.mediaHelper.screen.screenVideoTrack.enabled=!0),this.mediaHelper.screen.screenVideoSource&&(this.mediaHelper.screen.screenVideoSource.enabled=!0),this.muteStatus.screen.send=!1,this.client.apiFrequencyControl({name:"unmuteScreen",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("API调用失败：Stream:unmuteScreen",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteScreen",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}async muteScreen(){var e;this.logger.log(`禁用 ${this.stringStreamID} 的辅流轨道`);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.muteScreen()),this.mediaHelper.screen.screenVideoSource&&(this.mediaHelper.screen.screenVideoSource.enabled=!1),this.mediaHelper.screen.screenVideoTrack&&(this.mediaHelper.screen.screenVideoTrack.enabled=!1),this.muteStatus.screen.send=!0,this.client.apiFrequencyControl({name:"muteScreen",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("API调用失败：Stream:muteScreen",e,...arguments),this.client.apiFrequencyControl({name:"muteScreen",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}hasVideo(){return this.logger.log("获取视频 flag"),this.mediaHelper.video.videoStream.getVideoTracks().length>0}setVideoProfile(e){Object.assign(this.videoProfile,e),this.mediaHelper.video.captureConfig.high=this.mediaHelper.convert(this.videoProfile),this.mediaHelper.video.encoderConfig.high.maxBitrate=this.getVideoBW(),this.logger.log(`setVideoProfile ${JSON.stringify(e)} 视频采集参数 ${JSON.stringify(this.mediaHelper.video.captureConfig.high)} 编码参数 ${JSON.stringify(this.mediaHelper.video.encoderConfig.high)}`),this.client.adapterRef.channelInfo.sessionConfig.maxVideoQuality=c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p,this.client.adapterRef.channelInfo.sessionConfig.videoQuality=this.videoProfile.resolution,this.client.adapterRef.channelInfo.sessionConfig.videoFrameRate=this.videoProfile.frameRate,this.client.apiFrequencyControl({name:"setVideoProfile",code:0,param:Object.assign({streamID:this.stringStreamID},e)})}setVideoEncoderConfiguration(e){if(e.mediaType=e.mediaType||"video",e.streamType=e.streamType||"high",this.logger.log("自定义视频编码配置",e),this.mediaHelper[e.mediaType].encoderConfig[e.streamType]){if(e.maxBitrate){const t=1e3*e.maxBitrate;this.logger.log(`setVideoEncoderConfiguration:设置maxBitrate ${e.mediaType} ${e.streamType} ${this.mediaHelper[e.mediaType].encoderConfig[e.streamType].maxBitrate} => ${t}`),this.mediaHelper[e.mediaType].encoderConfig[e.streamType].maxBitrate=t}else this.logger.log("setVideoEncoderConfiguration:未设定maxBitrate。保留目前的值：",e.mediaType,e.streamType,this.mediaHelper[e.mediaType].encoderConfig[e.streamType].maxBitrate);"string"==typeof e.contentHint?(this.logger.log(`setVideoEncoderConfiguration: 应用 contentHint ${e.mediaType} ${e.streamType} ${this.mediaHelper[e.mediaType].encoderConfig[e.streamType].contentHint} => ${e.contentHint}`),this.mediaHelper[e.mediaType].encoderConfig[e.streamType].contentHint=e.contentHint):this.logger.log("setVideoEncoderConfiguration: 未设定 contentHint。保留目前的值：",e.mediaType,e.streamType,this.mediaHelper[e.mediaType].encoderConfig[e.streamType].contentHint)}else this.logger.error("无法识别的媒体类型：",e.mediaType,e.streamType);this.getSender(e.mediaType,e.streamType)&&this.applyEncoderConfig(e.mediaType,e.streamType)}async replaceTrack(e){let t,r,n=!1,i=!1,o="video";if("screen"===e.mediaType)i=this.mediaHelper.screen.preProcessingEnabled,o=e.mediaType,i&&this.mediaHelper.disablePreProcessing("screen"),this.mediaHelper.screen.screenVideoTrack?(t=this.mediaHelper.screen.screenVideoTrack,this.mediaHelper.screen.screenVideoTrack=null):this.mediaHelper.screen.screenVideoSource&&(n=!0,t=this.mediaHelper.screen.screenVideoSource,this.mediaHelper.screen.screenVideoSource=null),t&&(e.external?this.mediaHelper.screen.screenVideoSource=e.track:this.mediaHelper.screen.screenVideoTrack=e.track,y.emptyStreamWith(this.mediaHelper.screen.screenVideoStream,e.track),y.emptyStreamWith(this.mediaHelper.screen.renderStream,e.track),this.mediaHelper.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.mediaHelper.screen.encoderConfig.high.contentHint&&this.mediaHelper.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.mediaHelper.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.mediaHelper.screen.encoderConfig.high.contentHint),this.mediaHelper.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.mediaHelper.screen.encoderConfig.high.contentHint),r=this.mediaHelper.screen.screenVideoTrackLow,this.mediaHelper.screen.screenVideoTrackLow=null);else if("video"===e.mediaType){const i=this.mediaHelper.video.preProcessingEnabled;o=e.mediaType,i&&this.mediaHelper.disablePreProcessing("video"),this.mediaHelper.video.cameraTrack?(t=this.mediaHelper.video.cameraTrack,this.mediaHelper.video.cameraTrack=null):this.mediaHelper.video.videoSource&&(n=!0,t=this.mediaHelper.video.videoSource,this.mediaHelper.video.videoSource=null),t&&(e.external?this.mediaHelper.video.videoSource=e.track:this.mediaHelper.video.cameraTrack=e.track,y.emptyStreamWith(this.mediaHelper.video.videoStream,e.track),y.emptyStreamWith(this.mediaHelper.video.renderStream,e.track),this.mediaHelper.video.videoStream.getVideoTracks().length&&"string"==typeof this.mediaHelper.video.encoderConfig.high.contentHint&&this.mediaHelper.video.videoStream.getVideoTracks()[0].contentHint!==this.mediaHelper.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.mediaHelper.video.encoderConfig.high.contentHint),this.mediaHelper.video.videoStream.getVideoTracks()[0].contentHint=this.mediaHelper.video.encoderConfig.high.contentHint),r=this.mediaHelper.video.videoTrackLow,this.mediaHelper.video.videoTrackLow=null,this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("video"))}if(!t)return this.logger.error(`replaceTrack ${e.mediaType} 当前没有可替换的流`),null;if(this.logger.log(`replaceTrack ${e.mediaType} dual:${!!r}【external: ${n} ${t.label}】=>【external: ${e.external} ${e.track.label}】`),y.watchTrack(e.track),this.mediaHelper.listenToTrackEnded(e.track),i)this.mediaHelper.enablePreProcessing(o);else{const t=this.getSender(e.mediaType,"high"),n=this.getSender(e.mediaType,"low");if(t&&(t.replaceTrack(e.track),this.logger.log(`replaceTrack ${e.mediaType} 成功替换上行`)),n&&r){const t=await this.mediaHelper.createTrackLow(e.mediaType);t&&(n.replaceTrack(t),this.logger.log(`replaceTrack ${e.mediaType} 成功替换上行小流`))}}return{oldTrack:t,oldTrackLow:r,external:n}}hasScreen(){return this.mediaHelper.screen.screenVideoStream.getVideoTracks().length>0}setScreenProfile(e){Object.assign(this.screenProfile,e),this.mediaHelper.screen.captureConfig.high=this.mediaHelper.convert(this.screenProfile),this.mediaHelper.screen.encoderConfig.high.maxBitrate=this.getScreenBW(),this.logger.log(`setScreenProfile ${JSON.stringify(e)} 屏幕共享采集参数 ${JSON.stringify(this.mediaHelper.screen.captureConfig.high)} 编码参数 ${JSON.stringify(this.mediaHelper.screen.encoderConfig.high)}`),this.client.adapterRef.channelInfo.sessionConfig.screenQuality=e,this.client.apiFrequencyControl({name:"setScreenProfile",code:0,param:Object.assign({streamID:this.stringStreamID},e)})}getSender(e,t){var r,n,i;const o=null===(i=null===(n=null===(r=this.getAdapterRef())||void 0===r?void 0:r._mediasoup)||void 0===n?void 0:n._sendTransport)||void 0===i?void 0:i.handler._pc;let a=null;return o&&("audio"===e&&(a="high"===t?o.audioSender:null),"video"===e?a="high"===t?o.videoSender:o.videoSenderLow:"screen"===e&&(a="high"===t?o.screenSender:o.screenSenderLow)),a||null}applyEncoderConfig(e,t){let r=this.mediaHelper[e].encoderConfig[t].maxBitrate;if(!r)return;let n=this.getSender(e,t);if(!n)return void this.logger.error("localStream.applyEncoderConfig: cannot find sender for ",e,t);let i=this.mediaHelper[e].encoderConfig[t].contentHint;"string"==typeof i&&n.track&&n.track.contentHint!==i&&(this.logger.log(`applyEncoderConfig 应用 contentHint：${e} ${t} ${n.track.contentHint} => ${i}`),n.track.contentHint=i);const o=n.getParameters();let a;o.encodings&&o.encodings.length?(a=o.encodings[0].maxBitrate,o.encodings[0].maxBitrate=r):o.encodings=[{maxBitrate:r}],n.setParameters(o).then((()=>{this.logger.log(`最大编码码率：${e} ${t} ${a?a+"=>":""}${r}`)})).catch((n=>{this.logger.error(`应用最大编码码率失败：${e} ${t} ${r}`,o,n.name,n.message,n)}))}getVideoBW(){if(!this.videoProfile)throw new h.default({code:m.default.NOT_FOUND,message:"no this.videoProfile"});return this.videoProfile.resolution==c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_180p?3e5:this.videoProfile.resolution==c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p?8e5:this.videoProfile.resolution==c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_720p?12e5:this.videoProfile.resolution==c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p?15e5:0}getScreenBW(){if(!this.screenProfile)throw new h.default({code:m.default.NOT_FOUND,message:"no this.screenProfile"});return this.screenProfile.resolution==c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_180p?3e5:this.screenProfile.resolution==c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p?8e5:this.screenProfile.resolution==c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_720p?12e5:this.screenProfile.resolution==c.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p?15e5:0}async takeSnapshot(e){if(!this.video&&!this.screen)return this.logger.log("没有视频流，请检查是否有 发布 过视频"),this.client.apiFrequencyControl({name:"takeSnapshot",code:-1,param:JSON.stringify(Object.assign(Object.assign({streamID:this.stringStreamID,isRemote:!1},e),{reason:"没有视频流，请检查是否有 发布 过视频"}),null," ")}),"INVALID_OPERATION";if(!this._play)throw new h.default({code:m.default.NO_PLAY,message:"no play"});await this._play.takeSnapshot(e,this.streamID),this.client.apiFrequencyControl({name:"takeSnapshot",code:0,param:Object.assign({streamID:this.stringStreamID,isRemote:!1},e)})}takeSnapshotBase64(e){if(this.video||this.screen){if(!this._play)throw new h.default({code:m.default.NO_PLAY,message:"no play"});let t=this._play.takeSnapshotBase64(e);return this.client.apiFrequencyControl({name:"takeSnapshotBase64",code:0,param:Object.assign({streamID:this.stringStreamID,isRemote:!1},e)}),t}return this.logger.log("没有视频流，请检查是否有 发布 过视频"),this.client.apiFrequencyControl({name:"takeSnapshotBase64",code:-1,param:JSON.stringify(Object.assign(Object.assign({streamID:this.stringStreamID,isRemote:!1},e),{reason:"没有视频流，请检查是否有 发布 过视频"}),null," ")}),"INVALID_OPERATION"}async startMediaRecording(e){const t=[];switch(e.type){case"screen":t.push(this.mediaHelper.screen.screenVideoStream),t.push(this.mediaHelper.audio.audioStream);break;case"camera":case"video":t.push(this.mediaHelper.video.videoStream),t.push(this.mediaHelper.audio.audioStream);break;case"audio":if(t.push(this.mediaHelper.audio.audioStream),this.client.adapterRef.remoteStreamMap)for(var r in this.client.adapterRef.remoteStreamMap){const e=this.client.adapterRef.remoteStreamMap[r];t.push(e.mediaHelper.audio.audioStream)}}if(0!==t.length){if(!this._record||!this.streamID||!t)throw new h.default({code:m.default.INVALID_PARAMETER,message:"startMediaRecording: invalid parameter"});return this._record&&this._record.start({uid:"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID,type:e.type,reset:e.reset,stream:t})}this.logger.log("没有没发现要录制的媒体流")}stopMediaRecording(e){if(!this._record)throw new h.default({code:m.default.NO_RECORD,message:"no record"});return this._record.stop({})}playMediaRecording(e){if(!this._record)throw new h.default({code:m.default.NO_RECORD,message:"no record"});return this._record.play(e.view)}listMediaRecording(){let e=[];if(!this._record)throw new h.default({code:m.default.NO_RECORD,message:"no record"});const t=this._record.getRecordStatus();return"init"!==t.status&&e.push(t),e}cleanMediaRecording(e){if(!this._record)throw new h.default({code:m.default.NO_RECORD,message:"no record"});return this._record.clean()}downloadMediaRecording(e){if(!this._record)throw new h.default({code:m.default.NO_RECORD,message:"no record"});return this._record.download()}startAudioMixing(e){return window.isAudioBanned?Promise.reject(new h.default({code:m.default.MEDIA_OPEN_BANNED_BY_SERVER,message:"audio is banned by server"})):(this.logger.log("开始伴音"),this.mediaHelper.startAudioMixing(e))}stopAudioMixing(){return this.logger.log("停止伴音"),this.mediaHelper.stopAudioMixing()}pauseAudioMixing(){return this.logger.log("暂停伴音"),this.mediaHelper.pauseAudioMixing()}resumeAudioMixing(){return this.logger.log("恢复伴音"),this.mediaHelper.resumeAudioMixing()}adjustAudioMixingVolume(e){return this.logger.log("调节伴音音量:",e),this.mediaHelper.setAudioMixingVolume(e)}getAudioMixingDuration(){return this.logger.log("获取伴音总时长"),this.mediaHelper.getAudioMixingTotalTime()}getAudioMixingCurrentPosition(){return this.mediaHelper.getAudioMixingPlayedTime()}setAudioMixingPosition(e){return this.logger.log("设置伴音音频文件的播放位置:",e),this.mediaHelper.setAudioMixingPlayTime(e)}async playEffect(e){return window.isAudioBanned?Promise.reject(new h.default({code:m.default.MEDIA_OPEN_BANNED_BY_SERVER,message:"audio is banned by server"})):(this.logger.log("开始播放音效: ",JSON.stringify(e,null," ")),this.mediaHelper.playEffect(e))}async stopEffect(e){return this.logger.log("停止播放音效: ",e),this.mediaHelper.stopEffect(e)}async pauseEffect(e){return this.logger.log("暂停播放音效：",e),this.mediaHelper.pauseEffect(e)}async resumeEffect(e){return this.logger.log("恢复播放音效文件: ",e),this.mediaHelper.resumeEffect(e)}async setVolumeOfEffect(e,t){return this.logger.log(`调节 ${e} 音效文件音量为: ${t}`),this.mediaHelper.setVolumeOfEffect(e,t)}async preloadEffect(e,t){return this.logger.log(`预加载 ${e} 音效文件地址: ${t}`),this.mediaHelper.preloadEffect(e,t)}async unloadEffect(e){return this.logger.log("释放指定音效文件 "+e),this.mediaHelper.unloadEffect(e)}getEffectsVolume(){return this.logger.log("获取所有音效文件播放音量"),this.mediaHelper.getEffectsVolume()}setEffectsVolume(e){return this.logger.log("设置所有音效文件播放音量:",e),this.mediaHelper.setEffectsVolume(e)}async stopAllEffects(){return this.logger.log("停止播放所有音效文件"),this.mediaHelper.stopAllEffects()}async pauseAllEffects(){return this.logger.log("暂停播放所有音效文件"),this.mediaHelper.pauseAllEffects()}async resumeAllEffects(){return this.logger.log("恢复播放所有音效文件"),this.mediaHelper.resumeAllEffects()}getAudioEffectsDuration(e){return this.logger.log("获取音效总时长"),this.mediaHelper.getAudioEffectsTotalTime(e)}getAudioEffectsCurrentPosition(e){return this.mediaHelper.getAudioEffectsPlayedTime(e)}setCanvasWatermarkConfigs(e){if(this._play){let t=null;if(e.mediaType&&"video"!==e.mediaType?"screen"===e.mediaType&&(t=this._play.watermark.screen.canvasControl):t=this._play.watermark.video.canvasControl,!t)return void this.logger.error("setCanvasWatermarkConfigs：播放器未初始化",e.mediaType);const r={TEXT:10,TIMESTAMP:1,IMAGE:4};if(e.textWatermarks&&e.textWatermarks.length>r.TEXT)throw this.logger.error(`目前的文字水印数量：${e.textWatermarks.length}。允许的数量：${r.TEXT}`),new h.default({code:m.default.INVALID_PARAMETER,message:"watermark exceeds limit"});if(e.imageWatermarks&&e.imageWatermarks.length>r.IMAGE)throw this.logger.error(`目前的图片水印数量：${e.imageWatermarks.length}。允许的数量：${r.IMAGE}`),new h.default({code:m.default.INVALID_PARAMETER,message:"watermark exceeds limit"});t.checkWatermarkParams(e),t.updateWatermarks(e),this.client.apiFrequencyControl({name:"setLocalCanvasWatermarkConfigs",code:0,param:{streamID:this.stringStreamID,isRemote:!1,mediaType:e.mediaType}})}else this.logger.error("setCanvasWatermarkConfigs：播放器未初始化")}setEncoderWatermarkConfigs(e){if(this._play&&this._play){let t=null;if(e.mediaType&&"video"!==e.mediaType?"screen"===e.mediaType&&(t=this._play.watermark.screen.encoderControl,this._play.watermark.screen.encoderControl.handler.enabled=!0,this.mediaHelper.screen.preProcessingEnabled||this.mediaHelper.enablePreProcessing("screen")):(t=this._play.watermark.video.encoderControl,this._play.watermark.video.encoderControl.handler.enabled=!0,this.mediaHelper.video.preProcessingEnabled||this.mediaHelper.enablePreProcessing("video")),!t)return void this.logger.error("setEncoderWatermarkConfigs：播放器未初始化",e.mediaType);const r={TEXT:10,TIMESTAMP:1,IMAGE:4};if(e.textWatermarks&&e.textWatermarks.length>r.TEXT)throw this.logger.error(`目前的文字水印数量：${e.textWatermarks.length}。允许的数量：${r.TEXT}`),new h.default({code:m.default.INVALID_PARAMETER,message:"watermark exceeds limit"});if(e.imageWatermarks&&e.imageWatermarks.length>r.IMAGE)throw this.logger.error(`目前的图片水印数量：${e.imageWatermarks.length}。允许的数量：${r.IMAGE}`),new h.default({code:m.default.INVALID_PARAMETER,message:"watermark exceeds limit"});t.checkWatermarkParams(e),t.updateWatermarks(e),this.client.apiFrequencyControl({name:"setEncoderWatermarkConfigs",code:0,param:JSON.stringify(e,null,2)})}else this.logger.error("setEncoderWatermarkConfigs：播放器未初始化")}getMuteStatus(e){return"audio"===e?{muted:this.muteStatus.audio.send}:"video"===e?{muted:this.muteStatus.video.send}:{muted:this.muteStatus.screen.send}}setBeautyEffectOptions(e){this.isBeautyTrack&&(this.lastEffects=e,this.logger.log("setBeautyEffectOptions() 设置美颜效果",e),_.startBeauty(!0,e))}async setBeautyEffect(e){e&&this._transformedTrack?this.logger.log("美颜已经开启"):(await this.startBeautyEffect(e),this.logger.log("setBeautyEffect()",e))}async startBeautyEffect(e){if(this.mediaHelper&&this.mediaHelper.video.cameraTrack)if(e){let e;this.logger.log("startBeautyEffect() 开启美颜"),this.isBeautyTrack=!0,e=this.lastEffects?this.lastEffects:{brightnessLevel:0,rednessLevel:0,smoothnessLevel:0},this._cameraTrack=this.mediaHelper.video.cameraTrack,this._transformedTrack=_.transformTrack(this._cameraTrack);const t=this.mediaHelper.video.videoTrackLow;await this.replaceTrack({mediaType:"video",track:this._transformedTrack,external:!1}),t&&t.stop(),_.startBeauty(!0,e),M.IS_ANY_SAFARI&&(document.getElementsByClassName("nertc-video-container-local")[0].querySelector("video").style.display="none")}else{if(!this.isBeautyTrack)return;this.logger.log("startBeautyEffect() 关闭美颜");const e=this.mediaHelper.video.videoTrackLow;await this.replaceTrack({mediaType:"video",track:this._cameraTrack,external:!1}),e&&e.stop(),this._transformedTrack&&(this._transformedTrack.stop(),this._transformedTrack=null),this.isBeautyTrack=!1,_.closeBeauty(),M.IS_ANY_SAFARI&&(document.getElementsByClassName("nertc-video-container-local")[0].querySelector("video").style.display="block")}else this.logger.log("beautyTrack() 此时还没有有视频track")}setFilter(e,t){this.logger.log("setFilter() set beauty filter",e,t),_.setBeautyFilter(e,t)}destroy(){this.client&&(this.client.apiFrequencyControl({name:"destroy",code:0,param:{streamID:this.stringStreamID,isRemote:!1}}),this.logger.log(`uid ${this.stringStreamID} 销毁 Stream 实例`),this.stop(),this._reset(),this.destroyed=!0,this.lastEffects=null)}}t.LocalStream=w},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioLevel=void 0;const i=r(3),o=r(34),a=n(r(1)),s=n(r(0)),c=o.RtcSupport.checkWebAudio(),u=window.AudioContext||window.webkitAudioContext;class l extends i.EventEmitter{constructor(e){super(),this.support=c.WebAudio&&c.MediaStream,this.level=0,this.letfvolume=0,this.rightVolume=0,this.stream=e.stream,this.adapterRef=e.adapterRef,this.context=new u,this.analyserNode=this.sourceNode=null,this.audioWorkletNode=null,this.timeDomainData=new Uint8Array(1024),this.support&&this.init(),this.connect()}_reset(){this.disconnect(),this.analyserNode&&(this.analyserNode=null),this.audioWorkletNode&&(this.audioWorkletNode=null),this.context&&(this.context=null)}init(){this.context&&(this.adapterRef.logger.log("AudioLevel: init() 初始化音频 state: ",this.context.state),"running"!==this.context.state&&this.context.resume().then((()=>{this.adapterRef.logger.log("AudioLevel: init() 状态变更成功 state: ",this.context&&this.context.state)})).catch((e=>{this.adapterRef.logger.log("AudioLevel: init() 状态变更出错: ",e.name,e.message,e),this.context&&this.context.resume()})))}async connect(){this.context&&(this.stream&&(this.sourceNode=this.createSource({mediaStream:this.stream})),await this.initAudioWorkletNode(),this.sourceNode&&this.audioWorkletNode?this.sourceNode.connect(this.audioWorkletNode):this.adapterRef.logger.warn("AudioLevel: connect() 缺乏audioWorkletNode、sourceNode"))}disconnect(){this.sourceNode&&(this.sourceNode.disconnect(0),this.sourceNode=null),this.audioWorkletNode&&(this.audioWorkletNode.disconnect(0),this.audioWorkletNode=null),this.stream=null,this.level=0}createSource(e){if(this.context)try{return this.context.createMediaStreamSource(e.mediaStream)}catch(t){if("TypeError"===t.name)return new MediaStreamAudioSourceNode(this.context,e);throw new a.default({code:s.default.INVALID_PARAMETER,message:"[AudioLevel] createSource: "+t.message})}}async initAudioWorkletNode(){if(this.context){if(!this.audioWorkletNode)try{await this.context.audioWorklet.addModule("https://yx-web-nosdn.netease.im/sdk-release/volumeProcessorUglify.js"),this.audioWorkletNode=new AudioWorkletNode(this.context,"vumeter"),this.audioWorkletNode.port.onmessage=e=>{e.data.volume&&(this.letfvolume=e.data.letfvolume,this.rightVolume=e.data.rightVolume)}}catch(e){this.adapterRef.logger.error("音量采集模块加载失败: ",e)}}else this.adapterRef.logger.warn("initAudioWorkletNode:参数不够")}updateStream(e){this.adapterRef.logger.log("AudioLevel updateStream()"),this.sourceNode&&(this.sourceNode.disconnect(0),this.sourceNode=null),this.stream=e,this.connect()}calculateAudioLevel(){if(this.analyserNode){this.analyserNode.getByteTimeDomainData(this.timeDomainData);let e=0;for(let t=0;t<this.timeDomainData.length;t++)e=Math.max(e,Math.abs(this.timeDomainData[t]-128));this.level=e/128}else this.adapterRef.logger.warn("AudioLevel: 缺乏analyserNode"),this.level=0;return this.level+""}getAudioLevel(){return this.level=+((this.letfvolume+this.letfvolume)/2).toFixed(5),this.level}destroy(){this.adapterRef.logger.log("destroy() AudioLevel模块"),this._reset()}}t.AudioLevel=l},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.destroyBeauty=t.closeBeauty=t.transformTrack=t.startBeauty=t.setBeautyFilter=void 0;const s=o(r(13)),c=r(12),u=r(266),l=a(r(277)),d=new c.Logger({tagGen:()=>"Beauty"});let p,f,h=null;const m=new u.Filters;t.setBeautyFilter=function(e,t){let r;t&&"number"!=typeof t&&d.warn("滤镜参数格式错误:",t),"number"==typeof t?1<t||t<0?d.warn("滤镜参数越界:",t):r=t:e&&!t&&(r=m.lut.lutImgs[e].intensity),d.log("设置滤镜:",e,r),m.lut.setlut(e,r)},t.startBeauty=function(e,t){if(!e)return void d.warn("请先开启美颜功能");let r,n,i;r=t.brightnessLevel||0,n=t.rednessLevel||0,i=t.smoothnessLevel||0,d.log("设置美颜参数:",t),void 0!==t.brightnessLevel&&"number"==typeof r&&(0<=r&&r<=1?m.beauty.whiten=r:d.warn("美颜参数越界:",r)),void 0!==t.rednessLevel&&"number"==typeof n&&(0<=n&&n<=1?m.beauty.redden=n:d.warn("美颜参数越界:",n)),void 0!==t.smoothnessLevel&&"number"==typeof i&&(0<=i&&i<=1?m.beauty.smooth=i:d.warn("美颜参数越界:",i))};const g=()=>{m.update(),h=l.default.setTimeout((()=>{g()}),1e3/p)};t.transformTrack=function(e){d.log("beauty track transform"),m.beauty.setLutsSrc({whiten:"https://yx-web-nosdn.netease.im/common/cab8e4f0696d3d8e29ee10d6dccc1204/meibai.png",redden:"https://yx-web-nosdn.netease.im/common/c614e2af82da88807067926d7ff3be3d/hongrun.png"}),m.lut.setLutsSrc({ziran:{src:"https://yx-web-nosdn.netease.im/common/c89328281947fceabdc71d5fa08b2345/ziran.png",intensity:1},baixi:{src:"https://yx-web-nosdn.netease.im/common/3a22a55384b0bd5b07fca3509bfc981a/baixi.png",intensity:.5},fennen:{src:"https://yx-web-nosdn.netease.im/common/db5befdae1f46dad2e5a6d702bad19ea/fennen.png",intensity:.5},weimei:{src:"https://yx-web-nosdn.netease.im/common/cf8bfec70d7998bb0033757276c6559a/weimei.png",intensity:.5},langman:{src:"https://yx-web-nosdn.netease.im/common/1c50a14532bfa3ad503a82ddd13f0ec8/langman.png",intensity:.5},rixi:{src:"https://yx-web-nosdn.netease.im/common/c414819383913b5db0d9b686276e3d57/rixi.png",intensity:.5},landiao:{src:"https://yx-web-nosdn.netease.im/common/4c77522852dc14448603be21abc571c8/landiao.png",intensity:.5},qingliang:{src:"https://yx-web-nosdn.netease.im/common/1150e94f831d24148239001588a7ca7d/qingliang.png",intensity:.5},huaijiu:{src:"https://yx-web-nosdn.netease.im/common/6a38caeab164d1b5cc086391d6a11a74/huaijiu.png",intensity:.5},qingcheng:{src:"https://yx-web-nosdn.netease.im/common/3b3332c5ae4306312b6f3c4c552a464a/qingcheng.png",intensity:1},wuhou:{src:"https://yx-web-nosdn.netease.im/common/200fc7a12177774f4eb23f55d72643ee/wuhou.png",intensity:1},zhigan:{src:"https://yx-web-nosdn.netease.im/common/848bd44506cf8e10ecabf564e3d74809/zhigan.png",intensity:1},mopian:{src:"https://yx-web-nosdn.netease.im/common/c454efa119520f0793ce51327951ed0a/mopian.png",intensity:1},dianying:{src:"https://yx-web-nosdn.netease.im/common/3a6a22adad29c5844fc829f4f889a79f/dianying.png",intensity:1},heibai:{src:"https://yx-web-nosdn.netease.im/common/941270f2948218ea19f2d79db5e7d349/heibai.png",intensity:1}}),e.getConstraints();const t=e.getSettings();p=t.frameRate||30,f=document.createElement("video");const r=new MediaStream([e]);return f.srcObject=r,t&&(f.width=t.width,f.height=t.height,m.setSize(f.width,f.height)),window.oscillatorRunning=!0,s.IS_ANY_SAFARI&&(f.style.visibility="hidden",m.canvas.style.height="100%",m.canvas.style.width="auto",m.canvas.setAttribute("id","beautyCanvas"),m.canvas.style.position="absolute",m.canvas.style.left="50%",m.canvas.style.top="50%",m.canvas.style.transform="translate(-50%,-50%)",document.getElementsByClassName("nertc-video-container-local")[0].appendChild(m.canvas),s.SAFARI_MAJOR_VERSION<14&&(f.style.height="0px",f.style.width="0px",document.body.appendChild(f))),f.onloadedmetadata=()=>{f.play().then((()=>{const{width:e,height:t}=f;m.mapSource=f,m.setSize(e,t),s.IS_ANY_SAFARI&&(m.canvas.style.height=t,m.canvas.style.width=e),g()})).catch((e=>{d.error("video element play error",e)}))},f.onresize=()=>{f.width&&f.height&&(s.IS_ANY_SAFARI&&(m.canvas.style.height=f.height,m.canvas.style.width=f.width),m.setSize(f.width,f.height))},m.canvas.captureStream(p).getVideoTracks()[0]},t.closeBeauty=function(){d.warn("关闭美颜"),window.oscillatorRunning=!1,null!=h&&(l.default.clearTimeout(h),h=null),m.canvas&&(m.canvas.remove(),f.remove())},t.destroyBeauty=function(){d.warn("销毁美颜"),window.oscillatorRunning=!1,m.destroy()}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Filters=void 0;const n=r(267),i=r(268),o=r(275),a=r(276),s=r(55),c=new(r(12).Logger)({tagGen:()=>"Filter"});t.Filters=class{constructor(){this._alive=!0,this._renderer=new n.Renderer,this.map=s.createTexture(this._renderer.gl,null),this.beauty=new i.BeautyFilter(this._renderer,this.map),this.lut=new a.LutFilter(this._renderer,this.map),this.normal=new o.NormalFilter(this._renderer,this.map)}get filters(){return[this.beauty,this.lut,this.normal]}get canvas(){return this._renderer.canvas}set mapSource(e){if(e&&"readyState"in e&&e.readyState<2)return c.warn("media source not ready"),void setTimeout((()=>{this.mapSource=e}),0);const t=this.map;t&&(t.source=e,t.refresh())}get isAlive(){return this._alive}setSize(e,t){this._renderer.setSize(e,t),this.filters.forEach((e=>{e.updateSize&&e.updateSize()}))}render(){const e=this.filters;e[0].map=this.map,e[0].render();for(let t=1;t<e.length;t++)e[t].map=e[t-1].output,e[t].render()}update(){var e;this._alive&&(null===(e=this.map)||void 0===e||e.refresh(),this.render())}destroy(){this._alive=!1;const e=this._renderer.gl;this.filters.forEach((e=>{e.destroy()})),null==e||e.deleteTexture(this.map.glTexture)}}},function(e,t,r){var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0,t.Renderer=class{constructor(e){this._gl=null,this._pixelRatio=1,this._viewport={x:0,y:0,width:512,height:512};const t=Object.assign({preserveDrawingBuffer:!0,powerPreference:"high-performance"},e),{canvas:r=document.createElement("canvas"),width:i=512,height:o=512}=t,a=n(t,["canvas","width","height"]);this._canvas=r,this._gl=r.getContext("webgl",a);const s=this.setSize(i,o);this.setViewport(0,0,s.width,s.height),this._gl||console.error("The current runtime environment does not support webgl.")}get canvas(){return this._canvas}get gl(){return this._gl}getPixelRatio(){var e;return null!==(e=this._pixelRatio)&&void 0!==e?e:1}setPixelRatio(e){const t=this.getPixelRatio();if(t===e)return;const r=this.getSize();r.width/=t,r.height/=t,this._pixelRatio=e,this.setSize(r.width,r.height)}getSize(){return{width:this.canvas.width,height:this.canvas.height}}setSize(e,t,r=!1){const n=this.canvas,i=this.getPixelRatio();return n.width=e*i,r&&(n.style.width=e+"px"),n.height=t*i,r&&(n.style.height=t+"px"),this.getSize()}getViewport(){return this._viewport}setViewport(e,t,r,n){var i;this._viewport={x:e,y:t,width:r,height:n},null===(i=this.gl)||void 0===i||i.viewport(e,t,r,n)}resize(e,t,r,n){const i=this.setSize(e,t);r&&this.setPixelRatio(r),n?this.setViewport(n.x,n.y,n.width,n.height):this.setViewport(0,0,i.width,i.height)}render(e){const t=this.gl;t.enable(t.CULL_FACE),null==e||e.render()}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.BeautyFilter=void 0;const n=r(87),i=r(54),o=r(55),a=r(142),s=r(88),c=r(89),u=r(272),l=r(273),d=r(274),p=r(143);t.BeautyFilter=class{constructor(e,t){this._smooth=0,this._whiten=0,this._redden=0,this.renderer=e,this._map=t,this.whitenMap=o.createTexture(e.gl,null,{flipY:!1}),this.reddenMap=o.createTexture(e.gl,null,{flipY:!1});const{programs:r,framebuffers:n}=this.initProgramsBuffers();this.programs=r,this.framebuffers=n,this.initUniforms()}initProgramsBuffers(){const e=this.renderer.gl,{posArray:t,uvArray:r}=s.typedArray,o=this.renderer.getSize(),f={},h={},m={blurX:{vShader:u.beautyBlurShader.vShader,fShader:u.beautyBlurShader.fShader,size:{width:o.width>>2,height:o.height>>2}},blurY:{vShader:u.beautyBlurShader.vShader,fShader:u.beautyBlurShader.fShader,size:{width:o.width>>2,height:o.height>>2}},highPass:{vShader:c.baseTextureShader.vShader,fShader:l.beautyHighPassShader.fShader,size:o},hBlurX:{vShader:u.beautyBlurShader.vShader,fShader:u.beautyBlurShader.fShader,size:o},hBlurY:{vShader:u.beautyBlurShader.vShader,fShader:u.beautyBlurShader.fShader,size:o},beauty:{vShader:c.baseTextureShader.vShader,fShader:d.beautyShader.fShader,size:o},whiten:{vShader:c.baseTextureShader.vShader,fShader:p.lutShader.fShader,size:o},redden:{vShader:c.baseTextureShader.vShader,fShader:p.lutShader.fShader,size:o}};for(const o in m){const{vShader:s,fShader:c,size:u}=m[o],l=new n.Program(e);l.setShader(s,"VERTEX"),l.setShader(c,"FRAGMENT"),l.setAttributeBuffer(i.createAttributeBuffer(e,"position",t,2)),l.setAttributeBuffer(i.createAttributeBuffer(e,"uv",r,2)),f[o]=l;const d=a.createFrameBuffer(e,u.width,u.height);h[o]=d}return{programs:f,framebuffers:h}}initUniforms(){const e=this.programs,t=this.framebuffers,r=this.map,{width:n,height:i}=this.renderer.getSize(),o=[n,i],a=[n>>2,i>>2];e.blurX.setUniform("map",r),e.blurX.setUniform("size",a),e.blurY.setUniform("map",t.blurX.targetTexture),e.blurY.setUniform("size",a),e.blurY.setUniform("isVertical",1),e.highPass.setUniform("map",r),e.highPass.setUniform("blurMap",t.blurY.targetTexture),e.hBlurX.setUniform("map",t.highPass.targetTexture),e.hBlurX.setUniform("size",o),e.hBlurY.setUniform("map",t.hBlurX.targetTexture),e.hBlurY.setUniform("size",o),e.hBlurY.setUniform("isVertical",1),e.beauty.setUniform("size",o),e.beauty.setUniform("map",r),e.beauty.setUniform("blurMap",t.blurY.targetTexture),e.beauty.setUniform("highPassMap",t.hBlurY.targetTexture),e.beauty.setUniform("intensity",0),e.whiten.setUniform("map",r),e.whiten.setUniform("lut",this.whitenMap),e.whiten.setUniform("intensity",0),e.redden.setUniform("map",r),e.redden.setUniform("lut",this.reddenMap),e.redden.setUniform("intensity",0)}get map(){return this._map}set map(e){e!==this._map&&(this._map=e,["blurX","highPass","beauty"].forEach((e=>{this.programs[e].setUniform("map",this._map)})))}setLutsSrc(e){const{whiten:t,redden:r}=e;t&&o.loadImage(t,(e=>{this.whitenMap.source=e,this.whitenMap.refresh()})),r&&o.loadImage(r,(e=>{this.reddenMap.source=e,this.reddenMap.refresh()}))}get smooth(){return this._smooth}set smooth(e){this._smooth!==e&&(0===e?(this.programs.whiten.setUniform("map",this.map),this.programs.redden.setUniform("map",this.whiten?this.framebuffers.whiten.targetTexture:this.map)):0===this._smooth&&(this.programs.whiten.setUniform("map",this.framebuffers.beauty.targetTexture),this.programs.redden.setUniform("map",this.whiten?this.framebuffers.whiten.targetTexture:this.framebuffers.beauty.targetTexture)),this._smooth=e,this.programs.beauty.setUniform("intensity",this._smooth))}get whiten(){return this._whiten}set whiten(e){this._whiten!==e&&(0===e?this.programs.redden.setUniform("map",this.smooth?this.framebuffers.beauty.targetTexture:this.map):0===this._whiten&&this.programs.redden.setUniform("map",this.framebuffers.whiten.targetTexture),this._whiten=e,this.programs.whiten.setUniform("intensity",this._whiten))}get redden(){return this._redden}set redden(e){this._redden!==e&&(this._redden=e,this.programs.redden.setUniform("intensity",this._redden))}get output(){return this.redden?this.framebuffers.redden.targetTexture:this.whiten?this.framebuffers.whiten.targetTexture:this.smooth?this.framebuffers.beauty.targetTexture:this.map}updateSize(){const e=this.renderer.getSize(),t=[e.width,e.height],r=[e.width>>2,e.height>>2];["blurX","blurY"].forEach((e=>{const t=this.framebuffers[e];t.targetTexture.opts.width=r[0],t.targetTexture.opts.height=r[1],t.targetTexture.refresh(),this.programs[e].setUniform("size",r)})),["highPass","hBlurX","hBlurY","beauty","whiten","redden"].forEach((e=>{const r=this.framebuffers[e];r.targetTexture.opts.width=t[0],r.targetTexture.opts.height=t[1],r.targetTexture.refresh(),["highPass","whiten","redden"].indexOf(e)<0&&this.programs[e].setUniform("size",t)}))}render(){const e=this.renderer,{width:t,height:r}=e.getSize(),n=this.programs,i=this.framebuffers;this.smooth&&(e.setViewport(0,0,t>>2,r>>2),i.blurX.bind(),e.render(n.blurX),i.blurY.bind(),e.render(n.blurY),e.setViewport(0,0,t,r),i.highPass.bind(),e.render(n.highPass),i.hBlurX.bind(),e.render(n.hBlurX),i.hBlurY.bind(),e.render(n.hBlurY),i.beauty.bind(),e.render(n.beauty)),this.whiten&&(i.whiten.bind(),e.render(n.whiten)),this.redden&&(i.redden.bind(),e.render(n.redden))}destroy(){var e;const t=this.renderer.gl;for(const r in this.programs){const n=this.framebuffers[r];null==t||t.deleteFramebuffer(null!==(e=n.frameBuffer)&&void 0!==e?e:null),this.programs[r].destroy()}null==t||t.deleteTexture(this.whitenMap.glTexture),null==t||t.deleteTexture(this.reddenMap.glTexture)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createShader=void 0,t.createShader=function(e,t,r){const n=e.createShader({VERTEX:e.VERTEX_SHADER,FRAGMENT:e.FRAGMENT_SHADER}[r]);if(!n)return console.error(r+"Shader was not created successfully."),null;if(e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))return n;const i=t.split("\n").map(((e,t)=>`${t+1}${e}`)).join("\n");return console.error(`${e.getShaderInfoLog(n)}\n%cshader source code\n${i}\n`,"color: #008040"),e.deleteShader(n),null}},function(e,t,r){function n(e,t,r,n,i,o){var a;if(r===e.FLOAT)return n?r=>e.uniform1fv(t,r):r=>e.uniform1f(t,r);const s={[e.FLOAT_VEC2]:r=>e.uniform2fv(t,r),[e.FLOAT_VEC3]:r=>e.uniform3fv(t,r),[e.FLOAT_VEC4]:r=>e.uniform4fv(t,r)}[r];if(s)return s;if(r===e.INT||r===e.BOOL)return n?r=>e.uniform1iv(t,r):r=>e.uniform1i(t,r);const c={[e.BOOL_VEC2]:e.INT_VEC2,[e.BOOL_VEC3]:e.INT_VEC3,[e.BOOL_VEC4]:e.INT_VEC4},u={[e.INT_VEC2]:r=>e.uniform2iv(t,r),[e.INT_VEC3]:r=>e.uniform3iv(t,r),[e.INT_VEC4]:r=>e.uniform4iv(t,r)}[null!==(a=c[r])&&void 0!==a?a:r];if(u)return u;const l={[e.FLOAT_MAT2]:r=>e.uniformMatrix2fv(t,!1,r),[e.FLOAT_MAT3]:r=>e.uniformMatrix3fv(t,!1,r),[e.FLOAT_MAT4]:r=>e.uniformMatrix4fv(t,!1,r)}[r];if(l)return l;if(r===e.SAMPLER_2D||r===e.SAMPLER_CUBE){const a=r===e.SAMPLER_2D?e.TEXTURE_2D:e.TEXTURE_CUBE_MAP;if(n){const r=[];for(let e=0;e<i;e++)r.push(o.value++);return n=>{e.uniform1iv(t,r),n.forEach(((t,n)=>{var i;e.activeTexture(e.TEXTURE0+r[n]),e.bindTexture(a,null!==(i=null==t?void 0:t.glTexture)&&void 0!==i?i:null)}))}}{const r=o.value++;return n=>{var i;e.uniform1i(t,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(a,null!==(i=null==n?void 0:n.glTexture)&&void 0!==i?i:null)}}}return()=>{console.warn("no matching uniform setter.")}}Object.defineProperty(t,"__esModule",{value:!0}),t.parseUniforms=void 0,t.parseUniforms=function(e,t){const r={value:0},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o={};for(let a=0;a<i;a++){const i=e.getActiveUniform(t,a);if(i){const a=i.size>1,s=a?i.name.replace("[0]",""):i.name,c=i.type,u=e.getUniformLocation(t,s);if(null!==u){const t=n(e,u,c,a,i.size,r);o[s]={type:c,size:i.size,value:null,setter:e=>{void 0!==e?o[s].value=e:t(o[s].value)}}}else console.warn(`uniform:[${s}] is null.`)}}return o}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultShader=void 0,t.defaultShader={vShader:"\n    attribute vec4 position;\n    void main() {\n        gl_Position = position;\n    }\n",fShader:"\n    precision mediump float;\n\n    void main() {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.beautyBlurShader=void 0,t.beautyBlurShader={vShader:"\n    uniform vec2 size;\n    uniform float isVertical;\n\n    attribute vec4 position;\n    attribute vec2 uv;\n\n    varying vec2 vuv;\n    varying vec4 vTextureShift1;\n\tvarying vec4 vTextureShift2;\n\tvarying vec4 vTextureShift3;\n\tvarying vec4 vTextureShift4;\n\n    void main() {\n        gl_Position = position;\n        vuv = uv;\n        // 偏移步距\n        vec2 stepOffset = 1.0 / size;\n        if(isVertical> 0.5){\n            stepOffset.x = 0.0;\n        }else{\n            stepOffset.y = 0.0;\n        }\n\n        vTextureShift1 = vec4(uv - stepOffset, uv + stepOffset);\n\t\tvTextureShift2 = vec4(uv- 2.0 * stepOffset, uv + 2.0 * stepOffset);\n\t\tvTextureShift3 = vec4(uv - 3.0 * stepOffset, uv + 3.0 * stepOffset);\n\t\tvTextureShift4 = vec4(uv - 4.0 * stepOffset, uv + 4.0 * stepOffset);\n    }\n",fShader:"\n    precision mediump float;\n\n    uniform sampler2D map;\n\n    varying vec2 vuv;\n    varying vec4 vTextureShift1;\n\tvarying vec4 vTextureShift2;\n\tvarying vec4 vTextureShift3;\n\tvarying vec4 vTextureShift4;\n\n    void main() {\n        vec4 color = texture2D(map, vuv);\n\n        vec3 sum = color.rgb;\n        sum += texture2D(map, vTextureShift1.xy).rgb;\n\t\tsum += texture2D(map, vTextureShift1.zw).rgb;\n\t\tsum += texture2D(map, vTextureShift2.xy).rgb;\n\t\tsum += texture2D(map, vTextureShift2.zw).rgb;\n\t\tsum += texture2D(map, vTextureShift3.xy).rgb;\n\t\tsum += texture2D(map, vTextureShift3.zw).rgb;\n\t\tsum += texture2D(map, vTextureShift4.xy).rgb;\n\t\tsum += texture2D(map, vTextureShift4.zw).rgb;\n\n        gl_FragColor = vec4(sum * 0.1111, 1.0);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.beautyHighPassShader=void 0,t.beautyHighPassShader={fShader:"\n    precision mediump float;\n\n    uniform sampler2D map;\n    uniform sampler2D blurMap;\n\n    varying vec2 vuv;\n\n    void main() {\n        vec4 color = texture2D(map, vuv);\n        vec4 blurColor = texture2D(blurMap, vuv);\n        vec3 diffColor = (color.rgb - blurColor.rgb) * 6.0;\n        diffColor = diffColor * diffColor;\n        diffColor = min(diffColor, 1.0);\n        gl_FragColor = vec4(diffColor, 1.0);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.beautyShader=void 0,t.beautyShader={fShader:"\n    precision mediump float;\n\n    uniform vec2 size;\n\n    uniform sampler2D map;\n    uniform sampler2D blurMap;\n    uniform sampler2D highPassMap;\n\n    // 磨皮度\n    uniform float intensity;\n\n    varying vec2 vuv;\n    \n    void main() {\n        vec4 originColor = texture2D(map, vuv);\n        if(intensity > 0.0){\n            vec2 stepOffset = 1.0 / size;\n            float uOffsetX = stepOffset.x;\n            float uOffsetY = stepOffset.y;\n            float strength = intensity * 1.5;\n    \n            vec4 meanColor = texture2D(blurMap, vuv);\n            vec4 varColor = texture2D(highPassMap, vuv);\n    \n            float value = clamp((min(originColor.r, meanColor.r - 0.1) - 0.2) * 4.0, 0.0, 1.0);\n            float meanValue = (varColor.r + varColor.g + varColor.b) / 3.0;\n            float currentIntensity = (1.0 - meanValue / (meanValue + 0.1)) * value * strength;\n            vec3 resultColor = mix(originColor.rgb, meanColor.rgb, currentIntensity);\n            float sum = 0.25*originColor.g;\n            sum += 0.125 *texture2D(map,vec2(vuv.x-uOffsetX, vuv.y)).g;\n            sum += 0.125 *texture2D(map,vec2(vuv.x+uOffsetX, vuv.y)).g;\n            sum += 0.125 *texture2D(map,vec2(vuv.x, vuv.y-uOffsetY)).g;\n            sum += 0.125 *texture2D(map,vec2(vuv.x, vuv.y+uOffsetY)).g;\n            sum += 0.0625*texture2D(map,vec2(vuv.x+uOffsetX, vuv.y+uOffsetY)).g;\n            sum += 0.0625*texture2D(map,vec2(vuv.x+uOffsetX, vuv.y-uOffsetY)).g;\n            sum += 0.0625*texture2D(map,vec2(vuv.x-uOffsetX, vuv.y+uOffsetY)).g;\n            sum += 0.0625*texture2D(map,vec2(vuv.x-uOffsetX, vuv.y-uOffsetY)).g;\n    \n            float hPass = originColor.g - sum + 0.5;\n            float flag = step(0.5, hPass);\n            vec3 color = mix(max(vec3(0.0), (2.0*hPass + resultColor - 1.0)), min(vec3(1.0), (resultColor + 2.0*hPass - 1.0)), flag);\n            \n            gl_FragColor = vec4(mix(resultColor.rgb, color.rgb, intensity), 1.0);\n        }else{\n            gl_FragColor = originColor;\n        }\n    }"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.NormalFilter=void 0;const n=r(87),i=r(54),o=r(88),a=r(89);t.NormalFilter=class{constructor(e,t){this.renderer=e,this._map=t,this.program=this.initProgram()}initProgram(){const e=this.renderer.gl,{posArray:t,uvArray:r}=o.typedArray,s=new n.Program(e);return s.setShader(a.baseTextureShader.vShader,"VERTEX"),s.setShader(a.baseTextureShader.fShader,"FRAGMENT"),s.setAttributeBuffer(i.createAttributeBuffer(e,"position",t,2)),s.setAttributeBuffer(i.createAttributeBuffer(e,"uv",r,2)),s.setUniform("map",this._map),s}get map(){return this._map}set map(e){this._map!==e&&(this._map=e,this.program.setUniform("map",this._map))}get output(){return null}render(){const e=this.renderer,{width:t,height:r}=e.getSize(),n=e.gl;e.setViewport(0,0,t,r),n.bindFramebuffer(n.FRAMEBUFFER,null),e.render(this.program)}destroy(){this.program.destroy()}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.LutFilter=void 0;const n=r(87),i=r(54),o=r(55),a=r(142),s=r(88),c=r(89),u=r(143);t.LutFilter=class{constructor(e,t){this.lutImgs={},this.curLutName=null,this.renderer=e,this._map=t,this.lutMap=o.createTexture(e.gl,null,{flipY:!1});const{program:r,framebuffer:n}=this.initProgramBuffer();this.program=r,this.framebuffer=n}initProgramBuffer(){const e=this.renderer.gl,{posArray:t,uvArray:r}=s.typedArray,o=this.renderer.getSize(),l=new n.Program(e);l.setShader(c.baseTextureShader.vShader,"VERTEX"),l.setShader(u.lutShader.fShader,"FRAGMENT"),l.setAttributeBuffer(i.createAttributeBuffer(e,"position",t,2)),l.setAttributeBuffer(i.createAttributeBuffer(e,"uv",r,2));const d=a.createFrameBuffer(e,o.width,o.height);return l.setUniform("map",this.map),l.setUniform("lut",this.lutMap),l.setUniform("intensity",0),{program:l,framebuffer:d}}getLutImg(e){var t;return e&&null!==(t=this.lutImgs[e])&&void 0!==t?t:null}get map(){return this._map}set map(e){this._map!==e&&(this._map=e,this.program.setUniform("map",this._map))}setLutsSrc(e){for(const t in e){const{src:r,intensity:n=.5}=e[t];o.loadImage(r,(e=>{this.lutImgs[t]={img:e,intensity:n}}))}}get output(){return this.intensity?this.framebuffer.targetTexture:this.map}updateSize(){const e=this.renderer.getSize();this.framebuffer.targetTexture.opts.width=e.width,this.framebuffer.targetTexture.opts.height=e.height,this.framebuffer.targetTexture.refresh()}setlut(e,t){this.curLutName=e;const r=this.getLutImg(this.curLutName);r&&(this.lutMap.source=r.img,this.lutMap.refresh()),t=null!=t?t:this.intensity,this.intensity=t}get intensity(){const e=this.getLutImg(this.curLutName);return e?e.intensity:0}set intensity(e){const t=this.getLutImg(this.curLutName);t?(t.intensity=e,this.program.setUniform("intensity",this.intensity)):this.program.setUniform("intensity",0)}render(){this.intensity&&(this.framebuffer.bind(),this.renderer.render(this.program))}destroy(){const e=this.renderer.gl;null==e||e.deleteFramebuffer(this.framebuffer.framebuffer),this.program.destroy(),null==e||e.deleteTexture(this.lutMap.glTexture)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=URL.createObjectURL(new Blob(["(",function(){const e={},t={};self.onmessage=function(r){switch(r.data.command){case"interval:start":const n=setInterval((function(){postMessage({message:"interval:tick",id:r.data.id})}),r.data.interval);postMessage({message:"interval:started",id:r.data.id}),e[r.data.id]=n;break;case"interval:clear":clearInterval(e[r.data.id]),postMessage({message:"interval:cleared",id:r.data.id}),delete e[r.data.id];break;case"timeout:start":const i=this.setTimeout((function(){postMessage({message:"timeout:tick",id:r.data.id})}),r.data.timeout);postMessage({message:"timeout:started",id:r.data.id}),t[r.data.id]=i;break;case"timeout:clear":clearTimeout(t[r.data.id]),postMessage({message:"timeout:cleared",id:r.data.id}),delete t[r.data.id]}}}.toString(),")()"],{type:"application/javascript"})),i=new Worker(n);URL.revokeObjectURL(n);const o={id:0,callbacks:{},setInterval:function(e,t,r){this.id++;const n=this.id;return this.callbacks[n]={fn:e,context:r},i.postMessage({command:"interval:start",interval:t,id:n}),n},setTimeout:function(e,t,r){this.id++;const n=this.id;return this.callbacks[n]={fn:e,context:r},i.postMessage({command:"timeout:start",timeout:t,id:n}),n},onMessage:function(e){switch(e.data.message){case"interval:tick":case"timeout:tick":{const t=this.callbacks[e.data.id];t&&t.fn&&t.fn.apply(t.context);break}case"interval:cleared":case"timeout:cleared":delete this.callbacks[e.data.id]}},clearInterval:function(e){i.postMessage({command:"interval:clear",id:e})},clearTimeout:function(e){i.postMessage({command:"timeout:clear",id:e})}};i.onmessage=o.onMessage.bind(o),t.default=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.serverError=t.clientNotYetPublished=t.STREAM_HAS_NO_MEDIA_ATTRIBUTES=t.clientNotYetUninitialized=t.invalidArguments=t.ok=void 0,t.ok={name:"OK",code:200,desc:"success"},t.invalidArguments={name:"invalid arguments",code:1,desc:"请检查参数的有效性"},t.clientNotYetUninitialized={name:"client not yet uninitialized",code:2,desc:"请先调用createClient创建Client"},t.STREAM_HAS_NO_MEDIA_ATTRIBUTES={name:"STREAM_HAS_NO_MEDIA_ATTRIBUTES",code:10,desc:"stream不合法，没有audio、video或者screen属性"},t.clientNotYetPublished={name:"client not yet published",code:11,desc:"请先publish"},t.serverError={name:"server error code",code:414,desc:""}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.LIVE_STREAM_AUDIO_CODEC_PROFILE=t.LIVE_STREAM_AUDIO_SAMPLE_RATE=void 0,t.LIVE_STREAM_AUDIO_SAMPLE_RATE={SAMPLE_RATE_32000:32e3,SAMPLE_RATE_44100:44100,SAMPLE_RATE_48000:48e3},t.LIVE_STREAM_AUDIO_CODEC_PROFILE={LC_AAC:0,HE_AAC:1}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.NETWORK_STATUS=void 0,t.NETWORK_STATUS={0:"UNKNOWN",1:"EXCELLENT",2:"GOOD",3:"POOR",4:"BAD",5:"VERYBAD",6:"DOWN"}},function(module,exports,__webpack_require__){Object.defineProperty(exports,"__esModule",{value:!0}),exports.pluginManager=void 0;const eventemitter3_1=__webpack_require__(3),webrtcLogger_1=__webpack_require__(12),parameters_1=__webpack_require__(2),netcall_webrtc2_1=__webpack_require__(90);class PluginManager extends eventemitter3_1.EventEmitter{constructor(){super(),this.plugins={},this.lastImported=null,this.logger=new webrtcLogger_1.Logger({tagGen:()=>"pluginManager"}),this.on("client-created",(async e=>{const t=e.client;for(let r in this.plugins){const n=this.plugins[r];if(n&&n.installed&&n.module.extendClient)try{const e=Date.now();await n.module.extendClient(t),t.logger.log(`成功加载插件 client-created ${n.module.name}@${n.module.version}。花费 ${Date.now()-e}`)}catch(e){t.logger.error(`插件无法加载 client-created ${n.module.name} ${e.name} ${e.message}`)}}})),this.on("stream-created",(async e=>{const t=e.localStream;for(let r in this.plugins){const n=this.plugins[r];if(n&&n.installed&&n.module.extendLocalStream)try{const e=Date.now();await n.module.extendLocalStream(t),t.logger.log(`成功加载插件 stream-created ${n.module.name}。花费 ${Date.now()-e}`)}catch(e){t.logger.error(`插件无法加载 stream-created ${n.module.name} ${e.name} ${e.message}`)}}}))}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this.logger.error(`Error on event ${e}: ${t.name} ${t.message}`,t.stack)}}async import(pathToPlugin,install=!0){if(this.plugins[pathToPlugin]){const e=this.plugins[pathToPlugin];this.logger.log(`import:找到已下载插件 ${e.module.name}@${e.module.version}【${e.module.description}】 ${pathToPlugin}`)}else{let nePlugin=null;try{this.logger.log("import:开始下载插件 "+pathToPlugin),this.lastImported=null,await eval(`import('${pathToPlugin}')`),nePlugin=this.lastImported,this.lastImported=null}catch(e){throw this.logger.error("import:无法下载插件 "+pathToPlugin,e.name,e.message),e}if(!nePlugin)throw new Error("import:插件下载出现未知错误");this.plugins[pathToPlugin]={module:nePlugin,installed:!1}}const plugin=this.plugins[pathToPlugin];return install&&!plugin.installed?(this.logger.log(`import:成功下载插件 ${plugin.module.name}@${plugin.module.version}【${plugin.module.description}】开始安装。。。`),await this.install(pathToPlugin,netcall_webrtc2_1.NERTC),plugin.module):plugin.module}async install(e,t){const r=this.plugins[e];if(!r)throw new Error("install:尚未下载插件 "+e);if(r.installed)return this.logger.warn(`install:找到已安装的插件 ${r.module.name}@${r.module.version}`),r.module;try{await r.module.install(t),r.installed=!0,this.logger.log(`成功安装插件 ${r.module.name}@${r.module.version}【${r.module.description}】`)}catch(e){throw this.logger.error(`无法安装插件 ${r.module.name}@${r.module.version}【${r.module.description}`,e.name,e.message,e.stack),e}return parameters_1.getParameters().clients.forEach((e=>{r.module.extendClient&&r.module.extendClient(e)})),parameters_1.getParameters().localStreams.forEach((e=>{r.module.extendLocalStream&&r.module.extendLocalStream(e)})),r.module}async uninstall(e){const t=this.plugins[e];t?(await t.module.uninstall(),t.installed=!1,this.logger.log(`已成功卸载${t.module.name}(${e})`)):this.logger.error("卸载插件：尚未安装插件"+e)}}exports.pluginManager=new PluginManager}])},module.exports=t()})(NERTC$1);var WebRTC2=getDefaultExportFromCjs(NERTC$1.exports),VIDEO_FRAME_RATE_MAP={10:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_10,15:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_15,20:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_20,25:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25,5:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5},VIDEO_QUALITY_MAP={1080:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_1080p,180:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_180p,480:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_480p,720:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p},NERTC=function(e){function t(t){var r=e.call(this,{logger:t.logger,emitter:t.emitter,debug:t.debug})||this;return r._neRtcServerAddresses=void 0,r._playOutVolume=0,r._isLocalCut=!1,r._isLocalSubCut=!1,r._remoteCanvasMap=new Map,r._remoteSubCanvasMap=new Map,r._microphones=null,r._cameras=null,r._speakers=null,r._gatherMediaParams={audio:!0,video:!0,screen:!0},r._profile={videoProfile:{resolution:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},screenProfile:{resolution:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_1080p,frameRate:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5},audioProfile:"music_standard"},r._deviceIds={micId:"",speakerId:"",cameraId:""},r}return __extends(t,e),t.prototype.setUid=function(e){this._uid=e},t.prototype.setMediaParams=function(e){this._gatherMediaParams=Object.assign(this._gatherMediaParams,e)},t.prototype.close=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),this.logger.log(t.TAG_NAME,"close"),this._gatherMediaParams[e]=!1,this.localStream?[4,this.localStream.close({type:e})]:[3,3];case 1:return r.sent(),"screen"===e&&this.localStream.screenAudio?[4,this.localStream.close({type:"screenAudio"})]:[3,3];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:throw r.sent();case 5:return[2]}}))}))},t.prototype.setupRemoteStreamContext=function(e){throw new Error("Method not implemented.")},t.prototype.destroy=function(){this.debug=!1,this.nrtcAppKey="",this._neRtcServerAddresses=void 0,this._resetState(),this._removeRtcListener(),this._client&&this._client.destroy(),this._client=void 0},t.prototype.getAudioLevel=function(){return this.localStream?100*Number(this.localStream.getAudioLevel()):-1},t.prototype.getCameraId=function(){return this._deviceIds.cameraId},t.prototype.getLocalStream=function(){return this.localStream},t.prototype.getMicId=function(){return this._deviceIds.micId},t.prototype.getOutVolume=function(){return 0},t.prototype.getSpeakerId=function(){return this._deviceIds.speakerId},t.prototype.init=function(e){this._neRtcServerAddresses=e.neRtcServerAddresses,WebRTC2.Logger.enableLogUpload(),this._client=WebRTC2.createClient({appkey:e.nrtcAppKey,debug:!0}),this._addRtcListener(),WebRTC2.getParameters().controlOnPaused=!1,WebRTC2.getParameters().hideControlOnResume=!1},t.prototype.joinRtcChannel=function(e,r){return __awaiter(this,void 0,void 0,(function(){var n,i,o,a,s,c;return __generator(this,(function(u){switch(u.label){case 0:if(u.trys.push([0,9,,10]),this._uid=e.uid,!this._client)throw new Error("client is not init");return this.logger.debug(t.TAG_NAME,"joinRtcChannel"),[4,this._client.join({channelName:e.channelName,uid:e.uid,token:e.token,neRtcServerAddresses:this._neRtcServerAddresses||{},joinChannelRecordConfig:(null==r?void 0:r.noCloudRecord)?void 0:{isHostSpeaker:!1,recordAudio:!0,recordVideo:!0,recordType:0}})];case 1:return n=u.sent(),[4,this._getDefaultDevice("camera")];case 2:return(i=u.sent())&&(this._deviceIds.cameraId=i.deviceId),[4,this._getDefaultDevice("microphone")];case 3:return(o=u.sent())&&(this._deviceIds.micId=o.deviceId),[4,this._getDefaultDevice("speaker")];case 4:return(a=u.sent())&&(this._deviceIds.speakerId=a.deviceId),r?(this._gatherMediaParams.audio=!r.noAudio,this._gatherMediaParams.video=!r.noVideo):(this._gatherMediaParams.audio=!1,this._gatherMediaParams.video=!1),this._gatherMediaParams.screen=!1,this._gatherMediaParams.audio||this._gatherMediaParams.video?(s=this._gatherMediaParams.video?"video":"audio",[4,this._initLocalStream()]):[3,8];case 5:return u.sent(),[4,this.playLocalStream(s,{audio:!1,video:this._gatherMediaParams.video,screen:!1})];case 6:return u.sent(),[4,this._client.publish(this.localStream)];case 7:u.sent(),u.label=8;case 8:return[2,n];case 9:throw c=u.sent(),this.logger.error(t.TAG_NAME,"joinRtc fail: ",c),c;case 10:return[2]}}))}))},t.prototype.leaveRtcChannel=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,4,5]),this.logger.log(t.TAG_NAME,"leaveRtc"),this._client?[4,this._client.leave()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:throw e=r.sent(),this.logger.error(t.TAG_NAME,"leaveRtc fail: ",e),e;case 4:return this._resetState(),[7];case 5:return[2]}}))}))},t.prototype.open=function(e,r,n){return void 0===r&&(r=!0),__awaiter(this,void 0,void 0,(function(){var i;return __generator(this,(function(o){switch(o.label){case 0:if(o.trys.push([0,15,,16]),!this._localView&&"audio"!=e)throw Error("localView is null");return this.logger.log(t.TAG_NAME,"open"),this.localStream?[3,8]:(console.log("开始初始化stream"),this._gatherMediaParams[e]=!0,[4,this._initLocalStream()]);case 1:return o.sent(),"video"!==e?[3,3]:[4,this.playLocalStream(e)];case 2:return o.sent(),[3,5];case 3:return"screen"!==e?[3,5]:[4,this.playLocalSubStream()];case 4:o.sent(),o.label=5;case 5:return r?[4,this._client.publish(this.localStream)]:[3,7];case 6:o.sent(),o.label=7;case 7:return[3,14];case 8:if(!this.localStream)throw Error("localStream is null");return[4,this.localStream.open({type:e,screenAudio:!0,deviceId:"video"===e?n||this._deviceIds.cameraId:"audio"===e?this._deviceIds.micId:void 0,videoSource:this.enableExternalVideo?this.externalVideoSource:void 0})];case 9:return o.sent(),"screen"!==e?[3,11]:[4,this.playLocalSubStream()];case 10:return o.sent(),[3,13];case 11:return[4,this.playLocalStream(e)];case 12:o.sent(),o.label=13;case 13:"video"===e&&n&&(this._deviceIds.cameraId=n),o.label=14;case 14:return[3,16];case 15:throw i=o.sent(),this.logger.error(t.TAG_NAME,"open fail: ",i),i;case 16:return[2]}}))}))},t.prototype.muteAudio=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.muteAudio()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.muteVideo=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.muteVideo()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.muteScreen=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.muteScreen()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.unmuteVideo=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.unmuteVideo()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.unmuteAudio=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.unmuteVideo()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.unmuteScreen=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.unmuteScreen()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.playLocalSubStream=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),!this._localSubView)throw Error("localSubView is null");if(!this.localStream)throw Error("localStream is null");return[4,this.localStream.play(this._localSubView,{audio:!1,video:!1,screen:!0})];case 1:return r.sent(),this.localStream.setLocalRenderMode({width:this._localSubView.clientWidth,height:this._localSubView.clientHeight,cut:this._isLocalSubCut},"screen"),[3,3];case 2:throw e=r.sent(),this.logger.error(t.TAG_NAME,"playLocalSubStream fail: ",e),e;case 3:return[2]}}))}))},t.prototype.stopLocalStream=function(e){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.localStream.stop(e)];case 1:return n.sent(),[3,3];case 2:throw r=n.sent(),this.logger.error(t.TAG_NAME,"stopLocalStream fail: ",r),r;case 3:return[2]}}))}))},t.prototype.playLocalStream=function(e,r){return void 0===r&&(r={audio:!1,video:!0,screen:!1}),__awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this._localView)throw Error("localView is null");return this.localStream?(r.video&&"video"===e&&this.localStream.stop("video"),this._setMediaProfile(),[4,this.localStream.play(this._localView,r)]):(this.logger.warn("localStream is null"),[2]);case 1:return i.sent(),this.localStream.setLocalRenderMode({width:this._localView.clientWidth,height:this._localView.clientHeight,cut:this._isLocalCut}),[3,3];case 2:throw n=i.sent(),this.logger.error(t.TAG_NAME,"playLocalStream fail: ",n),n;case 3:return[2]}}))}))},t.prototype.playLocalVideo=function(e){return __awaiter(this,void 0,void 0,(function(){var r,n,i,o,a;return __generator(this,(function(s){switch(s.label){case 0:return s.trys.push([0,9,,10]),this.logger.log(t.TAG_NAME,"playLocalVideo",e),r=e.view,n=e.cut,i=void 0!==n&&n,o=e.subView,this.localStream?[3,2]:[4,this._initLocalStream()];case 1:s.sent(),s.label=2;case 2:return this._isLocalCut=i,this._localView=r,[4,this.playLocalStream("video")];case 3:return s.sent(),o?(this._isLocalSubCut=i,this._localSubView=r,[4,this.playLocalSubStream()]):[3,5];case 4:s.sent(),s.label=5;case 5:return this._client&&this.localStream?[4,this._client.publish(this.localStream)]:[3,7];case 6:return s.sent(),[3,8];case 7:throw Error("client or localStream is null");case 8:return[3,10];case 9:throw a=s.sent(),this.logger.error(t.TAG_NAME,"playLocalVideo fail: ",a),a;case 10:return[2]}}))}))},t.prototype.setupLocalVideoCanvas=function(e){var t;if(!(t=e&&"[object String]"==Object.prototype.toString.call(e)?document.querySelector(e)||void 0:e))throw new Error("view is not exit");this._localView=t,this._localSubView=t},t.prototype.setupRemoteVideoCanvas=function(e,t){this._remoteCanvasMap.set(t,e)},t.prototype.setupRemoteSubStreamVideoCanvas=function(e,t){this._remoteSubCanvasMap.set(t,e)},t.prototype.stopPlayingRemoteStream=function(e,t){t&&t.stop(e)},t.prototype.playRemoteStream=function(e){return __awaiter(this,void 0,void 0,(function(){var r,n,i,o,a,s,c,u,l;return __generator(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,3,,4]),this.logger.log(t.TAG_NAME,"playRemoteVideo",e),r=e.stream,n=e.cut,i=void 0!==n&&n,o=e.type,a=this._remoteCanvasMap.get(e.uid),s=this._remoteSubCanvasMap.get(e.uid),r.video&&!a&&"video"===o)throw new Error("view is null");if("screen"===o&&!s)throw new Error("subview is null");return u=(c="screen"===o)?s:a,"audio"===o&&(u=u||""),console.log("订阅view",o,u),"audio"!==o&&r.stop(c?"screen":"video"),[4,r.play(u,{audio:!0,video:!c,screen:c})];case 1:return d.sent(),[4,r.setRemoteRenderMode({width:u?u.clientWidth:0,height:u?u.clientHeight:0,cut:i},c?"screen":"video")];case 2:return d.sent(),[3,4];case 3:throw l=d.sent(),this.logger.error(t.TAG_NAME,"playRemoteVideo fail: ",l),l;case 4:return[2]}}))}))},t.prototype.setCaptureVolume=function(e){this.localStream&&this.localStream.setCaptureVolume(e)},t.prototype.setOutVolume=function(e){if(!this.localStream)throw new Error("localStream is null");this.localStream.setAudioVolume(e),this._playOutVolume=e},t.prototype.setProfile=function(e){var t={resolution:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},r={resolution:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},n=e.audioProfile||AudioProfile.music_standard;e.videoProfile&&(t.resolution=VIDEO_QUALITY_MAP[e.videoProfile.resolution]||WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,t.frameRate=VIDEO_FRAME_RATE_MAP[e.videoProfile.frameRate]||WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25),e.screenProfile&&(r.resolution=VIDEO_QUALITY_MAP[e.screenProfile.resolution]||WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,r.frameRate=VIDEO_FRAME_RATE_MAP[e.screenProfile.frameRate]||WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25),this._profile=__assign(__assign({},this._profile),{videoProfile:t,audioProfile:n,screenProfile:r})},t.prototype.subscribe=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return this._client?(t&&e.setSubscribeConfig(t),[4,this._client.subscribe(e)]):[3,2];case 1:return r.sent(),[3,3];case 2:throw new Error("client is null");case 3:return[2]}}))}))},t.prototype.switchDevice=function(e){var t;return __awaiter(this,void 0,void 0,(function(){var r,n,i;return __generator(this,(function(o){switch(o.label){case 0:r=e.type,n=e.deviceId,this.logger.log("switchDevice",JSON.stringify({type:r,deviceId:n})),o.label=1;case 1:switch(o.trys.push([1,13,,14]),r){case"camera":return[3,2];case"microphone":return[3,6];case"speaker":return[3,10]}return[3,11];case 2:return this.localStream&&this.localStream.hasVideo()?[3,3]:(this._deviceIds.cameraId=n,[3,5]);case 3:return[4,this.localStream.switchDevice("video",n)];case 4:o.sent(),this._deviceIds.cameraId=n,o.label=5;case 5:return[3,12];case 6:return this.localStream&&this.localStream.hasAudio()?[3,7]:(this._deviceIds.micId=n,[3,9]);case 7:return[4,this.localStream.switchDevice("audio",n)];case 8:o.sent(),this._deviceIds.micId=n,o.label=9;case 9:return[3,12];case 10:if(!this._client)throw new Error("client is not init");return Object.values(this._client.adapterRef.remoteStreamMap).forEach((function(e){e.setAudioOutput(n)})),this._deviceIds.speakerId=n,[3,12];case 11:return[3,12];case 12:return this.logger.log("switchDevice success",{type:r,deviceId:n}),[2,{type:r,deviceId:n}];case 13:if(i=o.sent(),1008===(null===(t=null==i?void 0:i.getCode)||void 0===t?void 0:t.call(i)))return[2,Promise.resolve({type:r,deviceId:n})];throw this.logger.error("switchDevice fail: ",i),i;case 14:return[2]}}))}))},t.prototype.takeSnapshot=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this.localStream?[4,this.localStream.takeSnapshot(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.unsubscribe=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this._client?[4,this._client.unsubscribe(e)]:[3,2];case 1:return t.sent(),[3,3];case 2:throw new Error("client is null");case 3:return[2]}}))}))},t.prototype.setupRemoteSubVideoCanvas=function(e,t){this._remoteSubCanvasMap.set(t,e)},t.prototype.checkSystemRequirements=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=Boolean,[4,WebRTC2.checkSystemRequirements()];case 1:return[2,e.apply(void 0,[r.sent()])];case 2:throw t=r.sent(),new Error(t);case 3:return[2]}}))}))},t.prototype.createClient=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){return t=e.appkey,r=e.debug,[2,WebRTC2.createClient({appkey:t,debug:r})]}))}))},t.prototype.getMicrophones=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this,[4,WebRTC2.getMicrophones()];case 1:return e._microphones=r.sent(),[2,JSON.parse(JSON.stringify(this._microphones))];case 2:throw t=r.sent(),new Error(t);case 3:return[2]}}))}))},t.prototype.getCameras=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,WebRTC2.getCameras()];case 1:return e=r.sent(),this._cameras=__spreadArray([],__read(e),!1),[2,JSON.parse(JSON.stringify(this._cameras))];case 2:throw t=r.sent(),new Error(t);case 3:return[2]}}))}))},t.prototype.getSpeakers=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this,[4,WebRTC2.getSpeakers()];case 1:return e._speakers=r.sent(),[2,JSON.parse(JSON.stringify(this._speakers))];case 2:throw t=r.sent(),new Error(t);case 3:return[2]}}))}))},t.prototype.getDeviceListData=function(){return __awaiter(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,c,u,l,d;return __generator(this,(function(p){switch(p.label){case 0:return p.trys.push([0,6,,7]),this.localStream?[3,2]:[4,this._initLocalStream()];case 1:p.sent(),p.label=2;case 2:return this.logger.log(t.TAG_NAME,"getDeviceListData--start--"),[4,this.getMicrophones()];case 3:return e=p.sent(),[4,this.getCameras()];case 4:return r=p.sent(),[4,this.getSpeakers()];case 5:return n=p.sent(),i=null==r?void 0:r.find((function(e){return"default"===e.deviceId})),o=null==e?void 0:e.find((function(e){return"default"===e.deviceId})),a=null==n?void 0:n.find((function(e){return"default"===e.deviceId})),s=(null==i?void 0:i.deviceId)||this._deviceIds.cameraId||(r[0]?r[0].deviceId:""),c=(null==o?void 0:o.deviceId)||this._deviceIds.micId||(e[0]?e[0].deviceId:""),u=(null==a?void 0:a.deviceId)||this._deviceIds.speakerId||(n[0]?n[0].deviceId:""),l={microphones:e,cameras:r,speakers:n,speakerSelect:u,microphoneSelect:c,cameraSelect:s},this.logger.log(t.TAG_NAME,"getDeviceListData success",l),[2,l];case 6:throw d=p.sent(),this.logger.log(t.TAG_NAME,"getDeviceListData fail",d),new Error(d);case 7:return[2]}}))}))},t.prototype.unpublish=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._client.unpublish(this.localStream)];case 1:return t.sent(),[3,3];case 2:throw e=t.sent(),new Error(e);case 3:return[2]}}))}))},t.prototype.setVideoProfile=function(e,r){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){try{this.logger.log(t.TAG_NAME,"setVideoProfile",e,r),e=VIDEO_QUALITY_MAP[e]||WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,r=VIDEO_FRAME_RATE_MAP[r]||WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25,this._profile.videoProfile={frameRate:r,resolution:e},this.localStream&&(this.logger.log(t.TAG_NAME,"localStream",this.localStream),this.localStream.setVideoProfile({resolution:e,frameRate:r}))}catch(e){throw new Error(e)}return[2]}))}))},t.prototype.setScreenProfile=function(e,r){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){try{this.logger.log(t.TAG_NAME,"setScreenProfile",e,r),e=VIDEO_QUALITY_MAP[e]||WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,r=VIDEO_FRAME_RATE_MAP[r]||WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25,this._profile.screenProfile={frameRate:r,resolution:e},this.localStream&&(this.logger.log(t.TAG_NAME,"localStream",this.localStream),this.localStream.setScreenProfile({resolution:e,frameRate:r}))}catch(e){throw new Error(e)}return[2]}))}))},t.prototype.setAudioProfile=function(e){var r;return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),this.logger.log(t.TAG_NAME,"setAudioProfile--start--",e),this._profile.audioProfile=AudioProfile[e]||AudioProfile.music_standard,this.localStream?[3,2]:[4,this._initLocalStream()];case 1:return i.sent(),[3,3];case 2:null===(r=this.localStream)||void 0===r||r.setAudioProfile(e),i.label=3;case 3:return[3,5];case 4:throw n=i.sent(),new Error(n);case 5:return[2]}}))}))},t.prototype.getLocalAudioStats=function(){return this._client?this._client.getLocalAudioStats():(this.logger.warn("client not exited"),[])},t.prototype.addTasks=function(e){return this._client.addTasks(e)},t.prototype.updateTasks=function(e){return this._client.updateTasks(e)},t.prototype.deleteTasks=function(e){return this._client.deleteTasks(e)},t.prototype.playEffect=function(e){return this.localStream.playEffect(e)},t.prototype.stopEffect=function(e){return this.localStream.stopEffect(e)},t.prototype.stopAllEffects=function(){return this.localStream.stopAllEffects()},t.prototype.setEffectsVolume=function(e){this.localStream.setEffectsVolume(e)},t.prototype.startAudioMixing=function(e){return this.localStream.startAudioMixing(e)},t.prototype.stopAudioMixing=function(){return this.localStream.stopAudioMixing()},t.prototype.adjustAudioMixingVolume=function(e){return this.localStream.adjustAudioMixingVolume(e)},t.prototype.getLocalVideoStats=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this._client?[2,this._client.getLocalVideoStats()]:(this.logger.warn("client not exited"),[2,{}])}))}))},t.prototype.getRemoteAudioStats=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this._client?[2,this._client.getRemoteAudioStats()]:(this.logger.warn("client not exited"),[2,{}])}))}))},t.prototype.getRemoteVideoStats=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this._client?[2,this._client.getRemoteVideoStats(e)]:(this.logger.warn("client not exited"),[2,{}])}))}))},t.prototype.getSessionStats=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this._client?[2,this._client.getSessionStats()]:(this.logger.warn("client not exited"),[2,{}])}))}))},t.prototype._addRtcListener=function(){var e=this;this._client&&(this._client.on("stream-added",(function(t){e.emit(RTC_EVENT.STREAM_ADDED,t)})),this._client.on("stream-removed",(function(t){e.emit(RTC_EVENT.STREAM_REMOVED,t)})),this._client.on("stream-subscribed",(function(t){e.emit(RTC_EVENT.STREAM_SUBSCRIBED,t)})),this._client.on("stopScreenSharing",(function(t){e.emit(RTC_EVENT.STOP_SCREEN_SHARE,t)})),this._client.on("peer-online",(function(t){console.log("peer-online",t),e.emit(RTC_EVENT.PEER_ONLINE,t)})),this._client.on("peer-leave",(function(t){e.emit(RTC_EVENT.PEER_LEAVE,t)})),this._client.on("volume-indicator",(function(t){e.emit(RTC_EVENT.VOLUME_INDICATOR,t)})),this._client.on("active-speaker",(function(t){e.emit(RTC_EVENT.ACTIVE_SPEAKER,t)})),this._client.on(RTC_EVENT.RECORD_DEVICES_CHANGE,(function(t){"CHANGED"===t.state&&(e._deviceIds.micId=t.device.deviceId),e.emit(RTC_EVENT.RECORD_DEVICES_CHANGE,t)})),this._client.on(RTC_EVENT.CAMERA_DEVICE_CHANGE,(function(t){"CHANGED"===t.state&&(e._deviceIds.cameraId=t.device.deviceId),e.emit(RTC_EVENT.CAMERA_DEVICE_CHANGE,t)})),this._client.on(RTC_EVENT.SPEAKER_DEVICE_CHANGE,(function(t){"CHANGED"===t.state&&(e._deviceIds.speakerId=t.device.deviceId),e.emit(RTC_EVENT.SPEAKER_DEVICE_CHANGE,t)})),this._client.on(RTC_EVENT.CONNECTION_STATE_CHANGE,(function(t){e.emit(RTC_EVENT.CONNECTION_STATE_CHANGE,t)})),this._client.on(RTC_EVENT.VIDEO_TRACK_ENDED,(function(){e.emit(RTC_EVENT.VIDEO_TRACK_ENDED)})),this._client.on(RTC_EVENT.ERROR,(function(t){e.emit(RTC_EVENT.ERROR,t)})),this._client.on(RTC_EVENT.NETWORK_QUALITY,(function(t){e.emit(RTC_EVENT.NETWORK_QUALITY,t)})))},t.prototype._removeRtcListener=function(){this._client&&(this._client.off("peer-online"),this._client.off("peer-leave"),this._client.off("stream-added"),this._client.off("stream-removed"),this._client.off("stream-subscribed"),this._client.off("network-quality"),this._client.off("client-banned"),this._client.off("channel-closed"),this._client.off("connection-state-change"),this._client.off("stopScreenSharing"),this._client.off("recording-device-changed"))},t.prototype._getDefaultDevice=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:switch(t=[],e){case"camera":return[3,1];case"microphone":return[3,3];case"speaker":return[3,5]}return[3,7];case 1:return[4,this.getCameras()];case 2:case 4:case 6:return t=r.sent(),[3,7];case 3:return[4,this.getMicrophones()];case 5:return[4,this.getSpeakers()];case 7:return t.length?[2,t.find((function(e){return"default"===e.deviceId}))||t[0]]:[2,void 0]}}))}))},t.prototype._initLocalStream=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,3,,4]),!this._uid)throw Error("no uid, please joinRtc first.");return this._gatherMediaParams.audio||this._gatherMediaParams.video||this._gatherMediaParams.screen?(this.localStream=WebRTC2.createStream({audio:this._gatherMediaParams.audio,video:this._gatherMediaParams.video,screen:this._gatherMediaParams.screen,uid:this._uid,client:this._client,microphoneId:this._deviceIds.micId,cameraId:this._deviceIds.cameraId,videoSource:this.enableExternalVideo?this.externalVideoSource:void 0}),this._setMediaProfile(),this.localStream.setAudioProfile(this._profile.audioProfile),[4,this.localStream.init()]):[3,2];case 1:r.sent(),r.label=2;case 2:return[3,4];case 3:throw e=r.sent(),this.logger.error(t.TAG_NAME,"initLocalStream fail: ",e),e;case 4:return[2]}}))}))},t.prototype._setMediaProfile=function(){if(this.localStream){var e=this._profile.videoProfile,t=this._profile.screenProfile;this.localStream.setVideoProfile({resolution:e.resolution,frameRate:e.frameRate}),this.localStream.setScreenProfile({resolution:t.resolution,frameRate:t.frameRate}),this.localStream.setAudioProfile(this._profile.audioProfile)}},t.prototype._resetState=function(){this._uid=void 0,this._deviceIds={micId:"",speakerId:"",cameraId:""},this._profile={videoProfile:{resolution:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},screenProfile:{resolution:WebRTC2.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:WebRTC2.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},audioProfile:"music_standard"},this._localView=void 0,this._localSubView=void 0,this._isLocalCut=!1,this._isLocalSubCut=!1,this._gatherMediaParams={audio:!0,video:!0,screen:!0},this._playOutVolume=0,this.localStream&&(this.localStream.destroy(),this.localStream=void 0)},t.TAG_NAME="NERTC",t}(RTC),LogDebug=function(){function e(e){var t=e.level,r=e.appName,n=void 0===r?"":r,i=e.version,o=void 0===i?"":i;this._genUserAgent=function(){var e=String(navigator.userAgent).toLocaleLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/)||[];return{browser:e[1]?e[1].replace(/version/,"safari"):"unknow",ver:e[2]?e[2]:"unknow"}},this.level=LevelMap[t],this.appName=n,this.version=o}return e.prototype.setLevel=function(e){this.level=LevelMap[e]},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print.apply(this,__spreadArray(["log"],__read(e),!1))},e.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print.apply(this,__spreadArray(["trace"],__read(e),!1))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print.apply(this,__spreadArray(["debug"],__read(e),!1))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print.apply(this,__spreadArray(["info"],__read(e),!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print.apply(this,__spreadArray(["warn"],__read(e),!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._print.apply(this,__spreadArray(["error"],__read(e),!1))},e.prototype._print=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(LevelMap[e]>=this.level&&console[e])if("roomkit-wx"===this.appName)console[e].apply(console,__spreadArray(["[ ".concat(this.appName," ").concat(this.version," :").concat(this._genTime()," ]")],__read(t),!1));else{var n=this._genUserAgent();console[e].apply(console,__spreadArray(["[ ".concat(this.appName," ").concat(this.version," ").concat(n.browser,":").concat(n.ver," ").concat(this._genTime()," ]")],__read(t),!1))}},e.prototype._genTime=function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours()<10?"0".concat(e.getHours()):e.getHours(),o=e.getMinutes()<10?"0".concat(e.getMinutes()):e.getMinutes(),a=e.getSeconds()<10?"0".concat(e.getSeconds()):e.getSeconds();return"".concat(t,"-").concat(r,"-").concat(n," ").concat(i,":").concat(o,":").concat(a)},e}(),IM=function(){function e(e){var t=e.logger,r=e.debug,n=e.emitter,i=e.deviceId,o=e.version,a=e.clientType,s=e.reuseIM;this.nim=null,this.debug=!1,this.appKey="",this.token="",this.account="",this.roomAppKey="",this.roomAccountId="",this.roomAccountToken="",this.deviceId="",this.imPrivateConf=void 0,this.isReuseIM=!1,this.logger=t,this.debug=r,this.emitter=n,this.deviceId=i,this.version=o,this.clientType=a,this.isReuseIM=!!s,this.isReuseIM&&(this.nim=s)}return e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];(t=this.emitter).emit.apply(t,__spreadArray([e],__read(r),!1))},e}(),NIM_Web_SDK_v8_11_3={exports:{}};(function(module,exports){var t;t=function(__WEBPACK_EXTERNAL_MODULE__597__){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=620)}([function(e,t,r){var n=r(112),i=r(113),o=r(80),a=r(59),s=r(60),c=r(61),u=r(62),l=r(50),d=r(63),p=r(3),f=r(6),h=r(16),m=r(9),g=r(114),v=r(77),y=r(104),b=r(29),S=r(10),_=r(8),M=r(11),T=r(118),w=r(106),x=r(24),I=r(19),E=r(334),A=r(4),C=r(28);function k(e,t){var r=m(e);if(a){var n=a(e);t&&(n=I(n).call(n,(function(t){return s(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(b(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return N(e,t);var i=h(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?N(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,s=function(){};return{s:s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){l=!0,c=e},f:function(){try{u||null==r.return||r.return()}finally{if(l)throw c}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var R=r(190),P=r(149);function D(e){"object"===C(e)?(this.callFunc=e.callFunc||null,this.message=e.message||"UNKNOW ERROR"):this.message=e,this.time=new Date,this.timetag=+this.time}r(367);var j,L,z=r(43),U=z.getGlobal(),B=/\s+/;z.deduplicate=function(e){var t=[];return p(e).call(e,(function(e){-1===f(t).call(t,e)&&t.push(e)})),t},z.capFirstLetter=function(e){return e?h(e=""+e).call(e,0,1).toUpperCase()+h(e).call(e,1):""},z.guid=(j=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return j()+j()+j()+j()+j()+j()+j()+j()}),z.extend=function(e,t,r){for(var n in t)void 0!==e[n]&&!0!==r||(e[n]=t[n])},z.filterObj=function(e,t){var r={};return z.isString(t)&&(t=t.split(B)),p(t).call(t,(function(t){e.hasOwnProperty(t)&&(r[t]=e[t])})),r},z.copy=function(e,t){var r;return t=t||{},e?(p(r=m(e)).call(r,(function(r){z.exist(e[r])&&(t[r]=e[r])})),t):t},z.copyWithNull=function(e,t){var r;return t=t||{},e?(p(r=m(e)).call(r,(function(r){(z.exist(e[r])||z.isnull(e[r]))&&(t[r]=e[r])})),t):t},z.findObjIndexInArray=function(e,t){e=e||[];var r=t.keyPath||"id",n=-1;return g(e).call(e,(function(e,i){if(P(e,r)===t.value)return n=i,!0})),n},z.findObjInArray=function(e,t){var r=z.findObjIndexInArray(e,t);return-1===r?null:e[r]},z.mergeObjArray=function(){var e=[],t=h([]).call(arguments,0,-1),r=arguments[arguments.length-1];z.isArray(r)&&(t.push(r),r={});var n,i=r.keyPath=r.keyPath||"id";for(r.sortPath=r.sortPath||i;!e.length&&t.length;)e=t.shift()||[],e=h(e).call(e,0);return p(t).call(t,(function(t){t&&p(t).call(t,(function(t){-1!==(n=z.findObjIndexInArray(e,{keyPath:i,value:P(t,i)}))?e[n]=z.merge({},e[n],t):e.push(t)}))})),r.notSort||(e=z.sortObjArray(e,r)),e},z.cutObjArray=function(e){var t=h(e).call(e,0),r=arguments.length,n=h([]).call(arguments,1,r-1),i=arguments[r-1];z.isObject(i)||(n.push(i),i={});var o,a=i.keyPath=i.keyPath||"id";return p(n).call(n,(function(e){z.isArray(e)||(e=[e]),p(e).call(e,(function(e){e&&(i.value=P(e,a),-1!==(o=z.findObjIndexInArray(t,i))&&v(t).call(t,o,1))}))})),t},z.sortObjArray=function(e,t){var r=(t=t||{}).sortPath||"id";R.insensitive=!!t.insensitive;var n,i,o,a=!!t.desc;return o=z.isFunction(t.compare)?t.compare:function(e,t){return n=P(e,r),i=P(t,r),a?R(i,n):R(n,i)},y(e).call(e,o)},z.emptyFunc=function(){},z.isEmptyFunc=function(e){return e===z.emptyFunc},z.notEmptyFunc=function(e){return e!==z.emptyFunc},z.splice=function(e,t,r){return v([]).call(e,t,r)},z.reshape2d=function(e,t){if(b(e)){z.verifyParamType("type",t,"number","util::reshape2d");var r=e.length;if(r<=t)return[e];for(var n=Math.ceil(r/t),i=[],o=0;o<n;o++)i.push(h(e).call(e,o*t,(o+1)*t));return i}return e},z.flatten2d=function(e){if(b(e)){var t=[];return p(e).call(e,(function(e){t=S(t).call(t,e)})),t}return e},z.dropArrayDuplicates=function(e){if(b(e)){for(var t={},r=[];e.length>0;)t[e.shift()]=!0;for(var n in t)!0===t[n]&&r.push(n);return r}return e},z.onError=function(e){throw new D(e)},z.verifyParamPresent=function(e,t,r,n){r=r||"";var i=!1;switch(z.typeOf(t)){case"undefined":case"null":i=!0;break;case"string":""===t&&(i=!0);break;case"StrStrMap":case"object":m(t).length||(i=!0);break;case"array":t.length?g(t).call(t,(function(e){if(z.notexist(e))return i=!0,!0})):i=!0}i&&z.onParamAbsent(r+e,n)},z.onParamAbsent=function(e,t){z.onParamError("缺少参数 ".concat(e,", 请确保参数不是 空字符串、空对象、空数组、null或undefined, 或数组的内容不是 null/undefined"),t)},z.verifyParamAbsent=function(e,t,r,n){r=r||"",void 0!==t&&z.onParamPresent(r+e,n)},z.onParamPresent=function(e,t){z.onParamError("多余的参数 ".concat(e),t)},z.verifyParamType=function(e,t,r,n){var i=z.typeOf(t).toLowerCase();z.isArray(r)||(r=[r]),r=_(r).call(r,(function(e){return e.toLowerCase()}));var o=!0;switch(-1===f(r).call(r,i)&&(o=!1),i){case"number":isNaN(t)&&(o=!1);break;case"string":"numeric or numeric string"===r.join("")&&(o=!!/^[0-9]+$/.test(t))}o||z.onParamInvalidType(e,r,"",n)},z.onParamInvalidType=function(e,t,r,n){r=r||"",t=z.isArray(t)?(t=_(t).call(t,(function(e){return'"'+e+'"'}))).join(", "):'"'+t+'"',z.onParamError('参数"'+r+e+'"类型错误, 合法的类型包括: ['+t+"]",n)},z.verifyParamValid=function(e,t,r,n){z.isArray(r)||(r=[r]),-1===f(r).call(r,t)&&z.onParamInvalidValue(e,r,n)},z.onParamInvalidValue=function(e,t,r){var n;z.isArray(t)||(t=[t]),t=_(t).call(t,(function(e){return'"'+e+'"'})),z.isArray(t)&&(t=t.join(", ")),z.onParamError(S(n="参数 ".concat(e,"值错误, 合法的值包括: [")).call(n,M(t),"]"),r)},z.verifyParamMin=function(e,t,r,n){t<r&&z.onParamError("参数"+e+"的值不能小于"+r,n)},z.verifyParamMax=function(e,t,r,n){t>r&&z.onParamError("参数"+e+"的值不能大于"+r,n)},z.verifyArrayMax=function(e,t,r,n){t.length>r&&z.onParamError("参数"+e+"的长度不能大于"+r,n)},z.verifyEmail=(L=/^\S+@\S+$/,function(e,t,r){L.test(t)||z.onParamError("参数"+e+"邮箱格式错误, 合法格式必须包含@符号, @符号前后至少要各有一个字符",r)}),z.verifyTel=function(){var e=/^[+\-()\d]+$/;return function(t,r,n){e.test(r)||z.onParamError("参数"+t+"电话号码格式错误, 合法字符包括+、-、英文括号和数字",n)}}(),z.verifyBirth=function(){var e=/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/;return function(t,r,n){e.test(r)||z.onParamError("参数"+t+'生日格式错误, 合法为"yyyy-MM-dd"',n)}}(),z.onParamError=function(e,t){z.onError({message:e,callFunc:t})},z.verifyOptions=function(e,t,r,n,i){if(e=e||{},t&&(z.isString(t)&&(t=t.split(B)),z.isArray(t))){"boolean"!=typeof r&&(i=r||null,r=!0,n="");var o=r?z.verifyParamPresent:z.verifyParamAbsent;p(t).call(t,(function(t){o.call(z,t,e[t],n,i)}))}return e},z.verifyParamAtLeastPresentOne=function(e,t,r){t&&(z.isString(t)&&(t=t.split(B)),z.isArray(t)&&(g(t).call(t,(function(t){return z.exist(e[t])}))||z.onParamError("以下参数["+t.join(", ")+"]至少需要传入一个",r)))},z.verifyParamPresentJustOne=function(e,t,r){t&&(z.isString(t)&&(t=t.split(B)),z.isArray(t)&&1!==T(t).call(t,(function(t,r){return z.exist(e[r])&&t++,t}),0)&&z.onParamError("以下参数["+t.join(", ")+"]必须且只能传入一个",r))},z.verifyBooleanWithDefault=function(e,t,r,n,i){z.undef(r)&&(r=!0),B.test(t)&&(t=t.split(B)),z.isArray(t)?p(t).call(t,(function(t){z.verifyBooleanWithDefault(e,t,r,n,i)})):void 0===e[t]?e[t]=r:z.isBoolean(e[t])||z.onParamInvalidType(t,"boolean",n,i)},z.verifyFileInput=function(e,t){var r;return z.verifyParamPresent("fileInput",e,"",t),z.isString(e)&&((e="undefined"==typeof document?void 0:document.getElementById(e))||z.onParamError("找不到要上传的文件对应的input, 请检查fileInput id ".concat(e),t)),e.tagName&&"input"===e.tagName.toLowerCase()&&"file"===e.type.toLowerCase()||z.onParamError(S(r="请提供正确的 fileInput, 必须为 file 类型的 input 节点 tagname:".concat(e.tagName,", filetype:")).call(r,e.type),t),e},z.verifyFileType=function(e,t){z.verifyParamValid("type",e,z.validFileTypes,t)},z.verifyCallback=function(e,t,r){B.test(t)&&(t=t.split(B)),z.isArray(t)?p(t).call(t,(function(t){z.verifyCallback(e,t,r)})):e[t]?z.isFunction(e[t])||z.onParamInvalidType(t,"function","",r):e[t]=z.emptyFunc},z.verifyFileUploadCallback=function(e,t){z.verifyCallback(e,"uploadprogress uploaddone uploaderror uploadcancel",t)},z.validFileTypes=["image","audio","video","file"],z.validFileExts={image:["bmp","gif","jpg","jpeg","jng","png","webp"],audio:["mp3","wav","aac","wma","wmv","amr","mp2","flac","vorbis","ac3"],video:["mp4","rm","rmvb","wmv","avi","mpg","mpeg","mov"]},z.filterFiles=function(e,t){var r,n,i="file"===(t=t.toLowerCase()),o=[];return p([]).call(e,(function(e){var a,s;if(i)o.push(e);else if(r=h(a=e.name).call(a,w(s=e.name).call(s,".")+1),(n=e.type.split("/"))[0]&&n[1]){var c;(n[0].toLowerCase()===t||-1!==f(c=z.validFileExts[t]).call(c,r))&&o.push(e)}})),o};var F,V,H=z.supportFormData=z.notundef(U.FormData);z.getFileName=function(e){return e=z.verifyFileInput(e),H?e.files[0].name:h(t=e.value).call(t,w(r=e.value).call(r,"\\")+1);var t,r},z.getFileInfo=(F={ppt:1,pptx:2,pdf:3,doc:6,docx:7},function(e){var t={};if(!(e=z.verifyFileInput(e)).files)return t;var r=e.files[0];return H&&(t.name=r.name,t.size=r.size,t.type=r.name.match(/\.(\w+)$/),t.type=t.type&&t.type[1].toLowerCase(),t.transcodeType=F[t.type]||0),t}),z.sizeText=(V=["B","KB","MB","GB","TB","PB","EB","ZB","BB"],function(e){var t,r=0;do{t=(e=Math.floor(100*e)/100)+V[r],e/=1024,r++}while(e>1);return t}),z.promises2cmds=function(e){return _(e).call(e,(function(e){return e.cmd}))},z.objs2accounts=function(e){return _(e).call(e,(function(e){return e.account}))},z.teams2ids=function(e){return _(e).call(e,(function(e){return e.teamId}))},z.objs2ids=function(e){return _(e).call(e,(function(e){return e.id}))},z.getMaxUpdateTime=function(e){var t=_(e).call(e,(function(e){return+e.updateTime}));return Math.max.apply(Math,t)},z.genCheckUniqueFunc=function(e,t){return e=e||"id",function(t){this.uniqueSet=this.uniqueSet||{},this.uniqueSet[e]=this.uniqueSet[e]||{};var r=this.uniqueSet[e],n=t[e];return!r[n]&&(r[n]=!0,!0)}},z.fillPropertyWithDefault=function(e,t,r){return!!z.undef(e[t])&&(e[t]=r,!0)},z.throttle=function(e,t,r,n){var i,o,a=null,s=0;r||(r={});var c=function(){s=!1===r.leading?0:(new Date).getTime(),a=null,e.apply(i,o),a||(i=o=null)};return function(){var u=(new Date).getTime();s||!1!==r.leading||(s=u);var l=t-(u-s);return i=this,o=arguments,l<=0||l>t?(clearTimeout(a),a=null,s=u,e.apply(i,o),a||(i=o=null)):a||!1===r.trailing?a&&n&&n.apply(i,o):(a=x(c,l),n&&n.apply(i,o)),a}},z.get=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=e,o=O(t.replace(/\[(\d+)\]/g,".$1").split("."));try{for(o.s();!(r=o.n()).done;){var a=r.value;if(void 0===(i=Object(i)[a]))return n}}catch(e){o.e(e)}finally{o.f()}return i},z.pickAsString=function(e,t){var r;return e?_(r=I(t).call(t,(function(t){return void 0!==e[t]}))).call(r,(function(t){var r;return S(r="".concat(t,"=")).call(r,e[t])})).join(","):""},z.omitAsString=function(e,t){var r,n;if(!e)return"";var i={};return p(t).call(t,(function(e){i[e]=!0})),_(r=I(n=m(e)).call(n,(function(e){return!i[e]}))).call(r,(function(t){var r;return S(r="".concat(t,"=")).call(r,e[t])})).join(",")};var $={session:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)p(r=k(Object(n),!0)).call(r,(function(t){d(e,t,n[t])}));else if(c)u(e,c(n));else{var i;p(i=k(Object(n))).call(i,(function(t){l(e,t,s(n,t))}))}}return e}({},e),r=["topCustom","localCustom","extra"];return p(r).call(r,(function(e){t[e]&&(t[e]="***")})),t.lastMsg&&(t.lastMsg={idServer:t.lastMsg.idServer,idClient:t.lastMsg.idClient}),t}};z.secureOutput=function(e,t){b(t)||(t=[t]);var r=$[e];return 1===(t=_(t).call(t,(function(e){return r(e)}))).length?t[0]:t};var W={string:function(e,t,r){var n=r.required,i=r.allowEmpty,o=e[t];return!1===n&&void 0===o||"string"==typeof o&&!(!i&&""===o)},number:function(e,t,r){var n=r.required,i=r.min,o=e[t];return!1===n&&void 0===o||"number"==typeof o&&!(o<i)},enum:function(e,t,r){var n=r.required,i=E(r),o=e[t];return!1===n&&void 0===o||f(i).call(i,o)>-1},array:function(e,t,r){var n=r.required,i=e[t];return!1===n&&void 0===i||!!b(i)}};z.validate=function(e,t,r){var n,i={};return p(n=m(e)).call(n,(function(n){var o,a=e[n].type,s=W[a];s&&!s(t,n,e[n])?z.onError({message:S(o="Error in parameter verification, ".concat(n," expected value is ")).call(o,M(e[n])),callFunc:r}):i[n]=t[n]})),i},z.asyncPool=function(e,t,r){if("number"!=typeof e||"function"!=typeof r||!t||!t.length)return A.resolve();var n=0,i=[],o=[];return function a(){if(n===t.length)return A.resolve();var s=t[n++],c=A.resolve().then((function(){return r(s,t)}));i.push(c);var u=A.resolve();if(e<=t.length){var l=c.then((function(){return v(o).call(o,f(o).call(o,l),1)}));o.push(l),o.length>=e&&(u=A.race(o))}return u.then((function(){return a()}))}().then((function(){return A.all(i)}))},e.exports=z},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,r(49))},function(e,t,r){var n=r(1),i=r(56),o=r(7),a=r(21),s=r(66).f,c=r(161),u=r(12),l=r(70),d=r(46),p=r(25),f=function(e){var t=function(r,n,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,o)}return i(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,i,h,m,g,v,y,b,S=e.target,_=e.global,M=e.stat,T=e.proto,w=_?n:M?n[S]:(n[S]||{}).prototype,x=_?u:u[S]||d(u,S,{})[S],I=x.prototype;for(h in t)r=!c(_?h:S+(M?".":"#")+h,e.forced)&&w&&p(w,h),g=x[h],r&&(v=e.noTargetGet?(b=s(w,h))&&b.value:w[h]),m=r&&v?v:t[h],r&&typeof g==typeof m||(y=e.bind&&r?l(m,n):e.wrap&&r?f(m):T&&a(m)?o(m):m,(e.sham||m&&m.sham||g&&g.sham)&&d(y,"sham",!0),d(x,h,y),T&&(p(u,i=S+"Prototype")||d(u,i,{}),d(u[i],h,m),e.real&&I&&!I[h]&&d(I,h,m)))}},function(e,t,r){e.exports=r(284)},function(e,t,r){e.exports=r(213)},function(e,t,r){e.exports=r(424)},function(e,t,r){e.exports=r(158)},function(e,t){var r=Function.prototype,n=r.bind,i=r.call,o=n&&n.bind(i);e.exports=n?function(e){return e&&o(i,e)}:function(e){return e&&function(){return i.apply(e,arguments)}}},function(e,t,r){e.exports=r(312)},function(e,t,r){e.exports=r(182)},function(e,t,r){e.exports=r(236)},function(e,t,r){e.exports=r(316)},function(e,t){e.exports={}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){e.exports=r(375)},function(e,t,r){var n=r(7);e.exports=n({}.isPrototypeOf)},function(e,t,r){e.exports=r(181)},function(e,t,r){var n=r(6),i=r(10),o=(r(0),!1);try{"function"==typeof localStorage.setItem&&"function"==typeof localStorage.getItem&&(localStorage.setItem("nim_localstorage_exist_test","1"),o="1"===localStorage.getItem("nim_localstorage_exist_test"),localStorage.removeItem("nim_localstorage_exist_test"))}catch(e){o=!1}var a={nodeEnv:"production",info:{hash:"6d9191152b2457ea1efa6208dd181c811ea26cf9",shortHash:"6d91911",version:"8.11.3",sdkVersion:"253",sdkHumanVersion:"8.11.3",protocolVersion:1},lbsUrl:"https://lbs.netease.im/lbs/webconf.jsp",roomserver:"roomserver.netease.im",connectTimeout:8e3,xhrTimeout:8e3,socketTimeout:8e3,reconnectionDelay:1600,reconnectionDelayMax:8e3,reconnectionJitter:.01,reconnectiontimer:null,heartbeatInterval:3e4,cmdTimeout:8e3,hbCmdTimeout:5e3,defaultReportUrl:"https://dr.netease.im/1.gif",isWeixinApp:!1,isNodejs:!1,isRN:!1,ipVersion:0,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,PushPermissionAsked:!1,iosPushConfig:null,androidPushConfig:null,netDetectAddr:"https://roomserver-dev.netease.im/v1/sdk/detect/local",optionDefaultLinkUrl:"",defaultLinkUrl:"weblink.netease.im",ipv6DefaultLinkUrl:"weblink.netease.im",optionIpv6DefaultLinkUrl:"",wxDefaultLinkUrl:"wlnimsc0.netease.im",serverNosConfig:o?{cdnDomain:localStorage.getItem("nim_cdn_domain")||"",objectPrefix:localStorage.getItem("nim_object_prefix")||""}:{},hasLocalStorage:o,getDefaultLinkUrl:function(e){var t,r;1===a.ipVersion?(t=a.optionIpv6DefaultLinkUrl,r=a.ipv6DefaultLinkUrl):(t=a.optionDefaultLinkUrl,r=a.defaultLinkUrl);var i=t||(a.isWeixinApp?a.wxDefaultLinkUrl:r);if(!i)return!1;var o=e?"https":"http",s=e?"443":"80",c=i;return-1===n(i).call(i,"http")&&(c=o+"://"+c),-1===n(i).call(i,":")&&(c=c+":"+s),c},ipProbeAddr:{ipv4:"https://detect4.netease.im/test/",ipv6:"https://detect6.netease.im/test/"},formatSocketUrl:function(e){var t=e.url,r=e.secure?"https":"http";return-1===n(t).call(t,"http")?r+"://"+t:t},uploadUrl:"https://nos.netease.com",chunkUploadUrl:"https://wanproxy-web.127.net",commonMaxSize:104857600,chunkSize:4194304,chunkMaxSize:4194304e4,replaceUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHost:"nos.netease.com",downloadHostList:["nos.netease.com"],downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",nosCdnEnable:!0,httpsEnabled:!1,threshold:0,nosLbsUrls:["http://wanproxy.127.net/lbs","http://wanproxy-bj.127.net/lbs","http://wanproxy-hz.127.net/lbs","http://wanproxy-oversea.127.net/lbs"],genUploadUrl:function(e){return a.uploadUrl+"/"+e},genChunkUploadUrl:function(e){return a.chunkUploadUrl?a.chunkUploadUrl+"/"+e.bucket+"/"+e.objectName:""},genDownloadUrl:function(e,t,r){var n,o,s,c,u,l=e.bucket,d=(e.tag,e.expireSec),p=+new Date,f=d?"&survivalTime=".concat(d):"";if(r)return i(s=i(c=i(u="https://".concat(r,"/")).call(u,t,"?createTime=")).call(c,p)).call(s,f);var h=i(n=i(o="".concat(a.replaceUrl,"?createTime=")).call(o,p)).call(n,f);return(h=a.genNosProtocolUrl(h)).replace("{bucket}",l).replace("{object}",t)},genFileUrl:function(e){var t=e.bucket,r=e.objectName;return a.genNosProtocolUrl(a.replaceUrl).replace("{bucket}",t).replace("{object}",r)},genNosProtocolUrl:function(e){return/^http/.test(e)?a.httpsEnabled&&0!==n(e).call(e,"https://")&&(e=e.replace("http","https")):e=a.httpsEnabled?"https://".concat(e):"http://".concat(e),e}};e.exports=a},function(e,t,r){var n=r(1),i=r(123),o=r(25),a=r(125),s=r(121),c=r(159),u=i("wks"),l=n.Symbol,d=l&&l.for,p=c?l:l&&l.withoutSetter||a;e.exports=function(e){if(!o(u,e)||!s&&"string"!=typeof u[e]){var t="Symbol."+e;s&&o(l,e)?u[e]=l[e]:u[e]=c&&d?d(t):p(t)}return u[e]}},function(e,t,r){e.exports=r(330)},function(e,t,r){var n=r(12),i=r(25),o=r(137),a=r(41).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||a(t,e,{value:o.f(e)})}},function(e,t){e.exports=function(e){return"function"==typeof e}},function(e,t,r){var n=r(12);e.exports=function(e){return n[e+"Prototype"]}},function(e,t,r){e.exports=r(405)},function(e,t,r){e.exports=r(329)},function(e,t,r){var n=r(7),i=r(37),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},function(e,t,r){var n=r(13);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var n=r(21);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},function(e,t,r){var n=r(138),i=r(363);function o(t){return"function"==typeof n&&"symbol"==typeof i?(e.exports=o=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=o=function(e){return e&&"function"==typeof n&&e.constructor===n&&e!==n.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),o(t)}e.exports=o,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(183)},function(e,t,r){var n=r(14),i=r(23),o=r(4),a=r(52),s=r(64),c=r(17),u=r(0),l=u.undef,d=r(222),p=r(110),f=r(117),h=r(510);function m(e){var t=this;u.verifyOptions(e,"appKey account token","protocol::IMProtocol"),u.verifyCallback(e,["onconnect","onerror","onwillreconnect","ondisconnect","onloginportschange","onmyinfo","onblacklist","onmutelist","onfriends","onusers","onrobots","onteams","onSuperTeams","onsessions","onSessionsWithMoreRoaming","onStickTopSessions","onroamingmsgs","onofflinemsgs","onofflinefiltermsgs","onroamingsysmsgs","onofflinesysmsgs","onofflinefiltersysmsgs","onofflinecustomsysmsgs","onofflinefiltercustomsysmsgs","onbroadcastmsg","onbroadcastmsgs","onsysmsgunread","onsyncdone","onteammembers","onsyncteammembersdone","onmsg","onsysmsg","oncustomsysmsg","onupdatemyinfo","onupdateuser","onSyncUpdateServerSession","onUpdateSuperTeamMember","onCreateSuperTeam","onUpdateSuperTeam","onAddSuperTeamMembers","onRemoveSuperTeamMembers","onUpdateSuperTeamManagers","onDismissSuperTeam","onTransferSuperTeam","onUpdateSuperTeamMembersMute","onupdateteammember","onCreateTeam","onUpdateTeam","onAddTeamMembers","onRemoveTeamMembers","onUpdateTeamManagers","onDismissTeam","onTransferTeam","onUpdateTeamMembersMute","onTeamMsgReceipt","onupdatesession","onQuickComment","onDeleteQuickComment","onPinMsgChange","onupdatesysmsgunread","onupdatesysmsg","onsynccreateteam","onsyncsupercreateteam","onsyncmarkinblacklist","onsyncmarkinmutelist","onsyncfriendaction","shouldIgnoreNotification","shouldIgnoreMsg","onDeleteMsgSelf","shouldCountNotifyUnread","onPushNotificationMultiportConfig","onPushNotificationMultiportConfigUpdate","onpushevents"],"protocol::IMProtocol"),t.db=e.api.db=new a({logger:e.logger,notifyError:function(e){t.notifyError&&t.notifyError("DB error",e)}}),s.call(t,e)}var g=s.fn,v=m.fn=m.prototype=n(g);v.init=function(){var e,t;g.init.call(this),p.IM.setProtocol(this),this.parser=p.IM,i(e=this.sendCmd).call(e,this),this.socketUrls=[],this.syncing=!0,this.hasSynced=!1,this.hasSyncedTeamMembers=!1,this.syncPromiseArray=[],this.syncResult={},this.syncTeamMembersPromiseArray=[],this.syncSuperTeamMembersPromiseArray=[],this.syncTeamMembersResult={},this.timetags={},this.superTeamMembersData={},this.saveAck={},this.sysMsgUnread=f.completeUnread({}),this.resetUnsettledMsgs(),this.resetUnsettledSysMsgs(),this.msgPromise=o.resolve(),this.sysMsgPromise=o.resolve(),this.msgDelayArr=[],this.msgDelayTimer=null,this.msgStatEnable=!1,this.nosCdnHostTimer=null,this.relativeServerTime=0,this.sessionSet={},this.msgReceiptTasks={},this.userSet={},this.pushNotificationMultiportConfig=d.getDefaultConfig(),this.msgAckBufferManager=new h({processFn:i(t=this.handleMsgsAck).call(t,this),throttleTime:500})},v.reset=function(){g.reset.call(this);var e=this.options;this.db.reset(e.db),l(e.lbsUrl)&&(e.lbsUrl=c.lbsUrl),l(e.thumbnailToStatic)&&(e.thumbnailToStatic=!0),this.autoconnect=!!e.autoconnect,this.resetAutoMarkRead()},v.resetAutoMarkRead=function(){var e=this.options;u.verifyBooleanWithDefault(e,"autoMarkRead",!0,"","protocol::resetAutoMarkRead")},v.resetUnsettledMsgs=function(){this.unhandledMsgs=[],this.unupdatedMsgs=[]},v.resetUnsettledSysMsgs=function(){this.unhandledSysMsgs=[],this.unupdatedSysMsgs=[]},v.packetFromSync=function(e){return!e.obj||!!e.obj.sync},e.exports=m,r(513),r(514),r(515),r(526),r(528),r(529),r(530),r(531),r(532),r(533),r(534),r(539),r(540),r(548),r(549),r(550),r(551),r(552),r(553),r(554)},function(e,t){var r=Function.prototype.call;e.exports=r.bind?r.bind(r):function(){return r.apply(r,arguments)}},function(e,t,r){var n=r(14),i=r(44),o=r(30),a=r(17),s=r(555),c=r(110).IM;function u(e){return this.subType="im",this.nosScene=e.nosScene||"im",this.nosSurvivalTime=e.nosSurvivalTime,e.Protocol=o,e.Message=s,e.constructor=u,this.init(e)}u.Protocol=o,u.parser=c,u.use=i.use,u.getInstance=i.getInstance,u.rmAllInstances=i.rmAllInstances,u.genInstanceName=function(e){return"NIM-account-"+e.account};var l=u.fn=u.prototype=n(i.prototype);u.info=l.info=a.info,e.exports=u,r(566),r(567),r(568),r(569),r(570),r(571),r(572),r(573),r(574),r(575),r(580),r(581),r(582),r(583),r(584),r(585),r(586),r(587),r(588),r(591)},function(e,t,r){var n=r(14),i=r(3),o=r(28);function a(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.message=e||r.message||"","object"===o(t)?(this.event=t,this.code="Other_Error"):void 0!==t&&(this.code=t),this.timetag=+new Date,void 0!==r&&(this.event=r),this.event&&(this.callFunc=this.event.callFunc||null,delete this.event.callFunc)}a.prototype=n(Error.prototype),a.prototype.name="NIMError";var s={201:"客户端版本不对, 需升级sdk",302:"用户名或密码错误, 请检查appKey和token是否有效, account和token是否匹配",403:"非法操作或没有权限",404:"对象(用户/群/聊天室)不存在",405:"参数长度过长",408:"客户端请求超时",414:"参数错误",415:"服务不可用/没有聊天室服务器可分配",416:"频率控制",417:"重复操作",422:"帐号被禁用",500:"服务器内部错误",501:"数据库操作失败",503:"服务器繁忙",508:"删除有效期过了",509:"已失效",7101:"被拉黑",700:"批量操作部分失败",801:"群人数达到上限",802:"没有权限",803:"群不存在或未发生变化",804:"用户不在群里面",805:"群类型不匹配",806:"创建群数量达到限制",807:"群成员状态不对",809:"已经在群里",811:"强推列表中帐号数量超限",812:"群被禁言",813:"因群数量限制，部分拉人成功",814:"禁止使用群组消息已读服务",815:"群管理员人数上限",816:"批量操作部分失败",997:"协议已失效",998:"解包错误",999:"打包错误",9102:"通道失效",9103:"已经在其他端接听/拒绝过这通电话",11001:"对方离线, 通话不可送达",13002:"聊天室状态异常",13003:"在黑名单中",13004:"在禁言名单中",13006:"聊天室处于整体禁言状态,只有管理员能发言",Connect_Failed:"无法建立连接, 请确保能 ping/telnet 到云信服务器; 如果是IE8/9, 请确保项目部署在 HTTPS 环境下",Error_Internet_Disconnected:"网断了",Error_Connection_is_not_Established:"连接未建立",Error_Connection_Socket_State_not_Match:"socket状态不对",Error_Timeout:"超时",Param_Error:"参数错误",No_File_Selected:"请选择文件",Wrong_File_Type:"文件类型错误",File_Too_Large:"文件过大",Cross_Origin_Iframe:"不能获取跨域Iframe的内容",Not_Support:"不支持",NO_DB:"无数据库",DB:"数据库错误",Still_In_Team:"还在群里",Session_Exist:"会话已存在",Session_Not_Exist:"会话不存在",Error_Unknown:"未知错误",Operation_Canceled:"操作取消"},c=[200,406,808,810];i(c).call(c,(function(e){s[e]=null})),a.genError=function(e){var t=s[e];return void 0===t&&(t="操作失败"),null===t?null:new a(t,e)},a.multiInstance=function(e){return new a("不允许初始化多个实例","Not_Allow_Multi_Instance",e)},a.newNetworkError=function(e){var t="Error_Internet_Disconnected";return new a(s[t],t,e)},a.newConnectError=function(e){var t="Connect_Failed";return new a(s[t]||null,t,e)},a.newConnectionError=function(e){var t="Error_Connection_is_not_Established";return new a(s[t],t,e)},a.newSocketStateError=function(e){var t="Error_Connection_Socket_State_not_Match";return new a(s[t],t,e)},a.newTimeoutError=function(e){var t="Error_Timeout";return new a(s[t],t,e)},a.newFrequencyControlError=function(e){var t=new a(s[416],416,e);return t.from="local",t},a.newParamError=function(e,t){return new a(e||s.Param_Error,"Param_Error",t)},a.newNoFileError=function(e,t){var r="No_File_Selected";return new a(e||s[r],r,t)},a.newWrongFileTypeError=function(e,t){var r="Wrong_File_Type";return new a(e||s[r],r,t)},a.newFileTooLargeError=function(e,t){var r="File_Too_Large";return new a(e||s[r],r,t)},a.newCORSIframeError=function(e){var t="Cross_Origin_Iframe";return new a(s[t],t,e)},a.newSupportError=function(e,t,r){return new a("不支持"+e,"Not_Support_"+t,r)},a.newSupportDBError=function(e){return a.newSupportError("数据库","DB",e)},a.noDBError=function(e){return new a(s.NO_DB,"NO_DB",e)},a.newDBError=function(e){return new a(s.DB,"DB",e)},a.newUnknownError=function(e){var t="Error_Unknown";return new a(s[t],t,e)},a.stillInTeamError=function(e){var t="Still_In_Team";return new a(s[t],t,e)},a.sessionExist=function(e){var t="Session_Exist";return new a(s[t],t,e)},a.sessionNotExist=function(e){var t="Session_Not_Exist";return new a(s[t],t,e)},a.cancel=function(e){var t="Operation_Canceled";return new a(s[t],t,e)},a.customError=function(e,t){e=e||"Other_Error";var r="";return(t=t||{}).message||(r=s[e]||e),"object"!==o(e)?new a(r,e,t):new a(r,"Other_Error",void 0===t?e:t)},e.exports=a},function(e,t,r){var n=r(1),i=r(27),o=n.String,a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not an object")}},function(e,t,r){var n=r(94),i=r(83);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(12),i=r(1),o=r(21),a=function(e){return o(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?a(n[e])||a(i[e]):n[e]&&n[e][t]||i[e]&&i[e][t]}},function(e,t,r){var n=r(1),i=r(83),o=n.Object;e.exports=function(e){return o(i(e))}},function(e,t,r){var n=r(235);e.exports=function(e){return n(e.length)}},function(e,t,r){var n=r(1),i=r(21),o=r(96),a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not a function")}},function(e,t,r){var n=r(0),i={init:function(){i.deviceId=n.guid()}};i.init(),i.clientTypeMap={1:"Android",2:"iOS",4:"PC",8:"WindowsPhone",16:"Web",32:"Server",64:"Mac"},i.db={open:function(){}},i.rnfs=null,e.exports=i},function(e,t,r){var n=r(1),i=r(26),o=r(160),a=r(34),s=r(95),c=n.TypeError,u=Object.defineProperty;t.f=i?u:function(e,t,r){if(a(e),t=s(t),a(r),o)try{return u(e,t,r)}catch(e){}if("get"in r||"set"in r)throw c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(1),i=r(47),o=n.String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},function(e,t,r){(function(t){var n=r(112),i=r(113),o=r(80),a=r(29),s=r(59),c=r(60),u=r(61),l=r(62),d=r(50),p=r(150),f=r(63),h=r(28),m=r(16),g=r(24),v=r(6),y=r(106),b=r(11),S=r(3),_=r(9),M=r(104),T=r(8),w=r(19);function x(e,t){var r=_(e);if(s){var n=s(e);t&&(n=w(n).call(n,(function(t){return c(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)S(r=x(Object(n),!0)).call(r,(function(t){f(e,t,n[t])}));else if(u)l(e,u(n));else{var i;S(i=x(Object(n))).call(i,(function(t){d(e,t,c(n,t))}))}}return e}function E(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(a(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return A(e,t);var i=m(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0,c=function(){};return{s:c,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){d=!0,u=e},f:function(){try{l||null==r.return||r.return()}finally{if(d)throw u}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C(){return"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}}function k(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r}function O(e){return""+e.getFullYear()}function N(e){return k(e.getMonth()+1)}function R(e){return k(e.getDate())}function P(e){return k(e.getHours())}function D(e){return k(e.getMinutes())}function j(e){return k(e.getSeconds())}function L(e){return k(e.getMilliseconds(),3)}var z,U,B=(z=/yyyy|MM|dd|hh|mm|ss|SSS/g,U={yyyy:O,MM:N,dd:R,hh:P,mm:D,ss:j,SSS:L},function(e,t){return e=new Date(e),isNaN(+e)?"invalid date":(t=t||"yyyy-MM-dd").replace(z,(function(t){return U[t](e)}))});function F(e){var t;return m(t=Object.prototype.toString.call(e)).call(t,8,-1)}function V(e){return F(e).toLowerCase()}function H(e){return"string"===V(e)}function $(e){return"number"===V(e)}function W(e){return"array"===V(e)}function Y(e){return"function"==typeof e}function G(e){return"date"===V(e)}function Q(e){return null===e}function q(e){return null!==e}function J(e){return void 0===e}function Z(e){return void 0!==e}function K(e){return Z(e)&&q(e)}function X(e){return J(e)||Q(e)}function ee(e){return K(e)&&"object"===V(e)}var te=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},re=te,ne=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)},ie=ne;function oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2?arguments[2]:void 0;for(var n in e)e.hasOwnProperty(n)&&t.call(r,n,e[n])}function ae(e,t){oe(t,(function(t,r){e[t]=r}))}var se,ce=(se=0,function(){return""+se++});function ue(e){return H(e)&&0===v(e).call(e,"{")&&y(e).call(e,"}")===e.length-1}function le(e,t,r){if(!e)return"";var n=[];return oe(e,(function(e,t){Y(t)||(G(t)?t=t.getTime():W(t)?t=t.join(","):ee(t)&&(t=b(t)),r&&(t=encodeURIComponent(t)),n.push(encodeURIComponent(e)+"="+t))})),n.join(t||",")}var de=function(){var e=/^([\w]+?:\/\/.*?(?=\/|$))/i;return function(t){return e.test(t||"")?RegExp.$1.toLowerCase():""}}();function pe(e){var t=C();return e.tagName&&"INPUT"===e.tagName.toUpperCase()||t.Blob&&e instanceof t.Blob}e.exports={o:{},emptyObj:{},f:function(){},emptyFunc:function(){},regBlank:/\s+/gi,regWhiteSpace:/\s+/gi,getGlobal:C,detectCSSFeature:function(e){var t=!1,r="Webkit Moz ms O".split(" ");if("undefined"!=typeof document){var n=document.createElement("div"),i=null;if(e=e.toLowerCase(),void 0!==n.style[e]&&(t=!0),!1===t){i=e.charAt(0).toUpperCase()+e.substr(1);for(var o=0;o<r.length;o++)if(void 0!==n.style[r[o]+i]){t=!0;break}}return t}},fix:k,getYearStr:O,getMonthStr:N,getDayStr:R,getHourStr:P,getMinuteStr:D,getSecondStr:j,getMillisecondStr:L,format:B,dateFromDateTimeLocal:function(e){return e=""+e,new Date(e.replace(/-/g,"/").replace("T"," "))},getClass:F,typeOf:V,isString:H,isNumber:$,isInt:function(e){return $(e)&&e%1==0},isBoolean:function(e){return"boolean"===V(e)},isArray:W,isFunction:Y,isDate:G,isRegExp:function(e){return"regexp"===V(e)},isError:function(e){return"error"===V(e)},isnull:Q,notnull:q,undef:J,notundef:Z,exist:K,notexist:X,isObject:ee,isEmpty:function(e){return X(e)||(H(e)||W(e))&&0===e.length},containsNode:function(e,t){if(e===t)return!0;for(;t.parentNode;){if(t.parentNode===e)return!0;t=t.parentNode}return!1},calcHeight:function(e){var t=e.parentNode||("undefined"==typeof document?null:document.body);if(!t)return 0;(e=e.cloneNode(!0)).style.display="block",e.style.opacity=0,e.style.height="auto",t.appendChild(e);var r=e.offsetHeight;return t.removeChild(e),r},remove:function(e){e.parentNode&&e.parentNode.removeChild(e)},dataset:function(e,t,r){if(!K(r))return e.getAttribute("data-"+t);e.setAttribute("data-"+t,r)},addEventListener:te,on:re,removeEventListener:ne,off:ie,target:function(e){return e.target||e.srcElement},createIframe:function(e){if("undefined"!=typeof document){var t;if((e=e||{}).name)try{(t=document.createElement('<iframe name="'+e.name+'"></iframe>')).frameBorder=0}catch(r){(t=document.createElement("iframe")).name=e.name}else t=document.createElement("iframe");e.visible||(t.style.display="none"),Y(e.onload)&&re(t,"load",(function r(n){t.src&&(e.multi||ie(t,"load",r),e.onload(n))})),(e.parent||document.body).appendChild(t);var r=e.src||"about:blank";return g((function(){t.src=r}),0),t}},html2node:function(e){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML=e;var r,n,i=[];if(t.children)for(r=0,n=t.children.length;r<n;r++)i.push(t.children[r]);else for(r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];1===o.nodeType&&i.push(o)}return i.length>1?t:i[0]}},scrollTop:function(e){return"undefined"!=typeof document&&K(e)&&(document.documentElement.scrollTop=document.body.scrollTop=e),window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},forOwn:oe,mixin:ae,uniqueID:ce,isJSON:ue,parseJSON:function e(t){try{ue(t)&&(t=JSON.parse(t)),ee(t)&&oe(t,(function(r,n){switch(V(n)){case"string":case"object":t[r]=e(n)}}))}catch(e){}return t},simpleClone:function(e){var t=[],r=b(e,(function(e,r){if("object"===h(r)&&null!==r){if(-1!==v(t).call(t,r))return;t.push(r)}return r}));return JSON.parse(r)},merge:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return S(r).call(r,(function(t){ae(e,t)})),e},fillUndef:function(e,t){return oe(t,(function(t,r){J(e[t])&&(e[t]=r)})),e},checkWithDefault:function(e,t,r){var n=e[t]||e[t.toLowerCase()];return X(n)&&(n=r,e[t]=n),n},fetch:function(e,t){return oe(e,(function(r,n){K(t[r])&&(e[r]=t[r])})),e},string2object:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n={};return S(e=t.split(r)).call(e,(function(e){var t=e.split("="),r=t.shift();r&&(n[decodeURIComponent(r)]=decodeURIComponent(t.join("=")))})),n},object2string:le,genUrlSep:function(e){return v(e).call(e,"?")<0?"?":"&"},object2query:function(e){return le(e,"&",!0)},url2origin:de,isFileInput:pe,getKeys:function(e,t){var r=_(e);return t&&M(r).call(r,(function(t,r){var n=pe(e[t]);return n===pe(e[r])?0:n?1:-1})),r},_get:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=e,o=E(t.replace(/\[(\d+)\]/g,".$1").split("."));try{for(o.s();!(r=o.n()).done;){var a=r.value;if(void 0===(i=Object(i)[a]))return n}}catch(e){o.e(e)}finally{o.f()}return i},getLastSeveralItems:function(e,t){for(var r=e.length,n=[],i=function(t){var r=e[t],i=T(r).call(r,(function(e){return I(I({},e),{},{flag:"sort_flag_".concat(t)})}));n.push.apply(n,p(i))},o=0;o<r;o++)i(o);M(n).call(n,(function(e,t){return e.startTime-t.startTime}));for(var a=[],s=function(e){var t;a[e]=T(t=w(n).call(n,(function(t){return t.flag==="sort_flag_".concat(e)}))).call(t,(function(e){return I(I({},e),{},{flag:void 0})}))},c=0;c<r;c++)s(c);return a}}}).call(this,r(49))},function(e,t,r){var n=r(28),i=r(14),o=r(3),a=r(378),s=r(6),c=r(4),u=r(382),l=r(0),d=l.notundef,p=r(195),f=r(17),h=r(54);function m(){}var g={};m.getInstance=function(e){e=y(e),l.verifyOptions(e,"account","api::Base.getInstance");var t=this.genInstanceName(e),r=g[t];return r?m.updateInstance(r,e):r=g[t]=new this(e),r},m.updateInstance=function(e,t){e.setOptions(t),e.connect()};var v=m.fn=m.prototype=i(new u),y=function(e){return e.nosSurvivalTime?(l.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance"),l.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")):e.nosSurvivalTime=1/0,e};v.updatePrivateConf=function(e){if(e&&"object"===n(e.privateConf)){var t=e.privateConf;"string"==typeof t.lbs_web&&(e.lbsUrl=t.lbs_web),"boolean"==typeof t.link_ssl_web&&(e.secure=t.link_ssl_web),"boolean"==typeof t.https_enabled&&(e.httpsEnabled=t.https_enabled),e.uploadUrl=t.nos_uploader_web?t.nos_uploader_web:null,e.chunkUploadUrl=t.nos_uploader_web?t.nos_uploader_web:null,e.replaceUrl=t.nos_downloader?t.nos_downloader:null,e.downloadUrl=t.nos_accelerate?t.nos_accelerate:null,e.downloadHost=t.nos_accelerate_host?t.nos_accelerate_host:null,e.downloadHostList=t.nos_accelerate_host_list||[],e.downloadHost&&e.downloadHostList.push(e.downloadHost),e.nosCdnEnable=!1!==t.nos_cdn_enable,e.ntServerAddress=t.nt_server||null,e.kibanaServer=t.kibana_server,e.statisticServer=t.statistic_server,e.reportGlobalServer=t.report_global_server,e.ipVersion=t.ip_protocol_version,e.defaultLink=t.link_web||e.defaultLink,e.ipv6DefaultLink=t.link_ipv6_web||e.ipv6DefaultLink,"string"==typeof t.nos_lbs?e.nosLbsUrls=[t.nos_lbs]:e.nosLbsUrls=[]}return null===e.ntServerAddress||""===e.ntServerAddress?f.ntServerAddress=null:f.ntServerAddress=e.ntServerAddress||f.defaultReportUrl,f.uploadUrl=e.uploadUrl||f.uploadUrl,f.chunkUploadUrl=e.chunkUploadUrl||f.chunkUploadUrl,f.downloadUrl=e.downloadUrl||f.downloadUrl,f.downloadHost=e.downloadHost||f.downloadHost,f.downloadHostList=e.downloadHostList&&e.downloadHostList.length>0?e.downloadHostList:f.downloadHostList,f.nosCdnEnable=!1!==e.nosCdnEnable,f.replaceUrl=e.replaceUrl||f.replaceUrl,f.httpsEnabled=e.httpsEnabled||f.httpsEnabled,e.probe_ipv4_url&&(f.ipProbeAddr.ipv4=e.probe_ipv4_url),e.probe_ipv6_url&&(f.ipProbeAddr.ipv6=e.probe_ipv6_url),e},v.init=function(e){l.verifyOptions(e,"account","api::Base.init"),e=this.updatePrivateConf(e),l.verifyBooleanWithDefault(e,"exifOrientation",!0,"","api::Base.init"),e.lbsBackup=void 0===e.lbsBackup||e.lbsBackup;var t=this.account=e.account=e.account+"",r=e.constructor.genInstanceName(e),n=g[r];if(e._disableSingleton&&(n=null),n)return m.updateInstance(n,e),n;this.name=r,g[r]=this,this.logger=e.logger=new p({debug:e.debug,logFunc:e.logFunc,prefix:this.subType,dbLog:!1!==e.dbLog,account:e.account,expire:e.expire}),e.api=this;var i=this.protocol=new e.Protocol(e);return i.name="Protocol-"+r,i.account=t,i.api=this,i.message=this.message=new e.Message({account:t}),this.options=l.copy(e),this},v.destroy=function(e){var t,r=this;e=e||{};var n=this.name;this.logger.warn("destroy::start"),n?(this.protocol&&(t=this.protocol.connectTimer),this.protocol&&this.protocol.resetPush&&this.protocol.resetPush(),this.disconnect({done:function(i){var c,u;r.logger.warn("ApiBase::destroy: instance destroyed ..."),h.destroy(),o(c=a(r.options)).call(c,(function(e){0===s(e).call(e,"on")&&(r.options[e]=function(){},r.protocol.options[e]=function(){},r.protocol.api.options[e]=function(){})})),r.logger.setLogDisabled(),o(u=a(r)).call(u,(function(e){r[e]=void 0})),g&&(g[n]=null,clearTimeout(t)),e.done instanceof Function&&e.done(i)}})):this.logger&&this.logger.warn&&this.logger.warn("destroy::no instanceName")},v.setOptions=function(e){this.protocol.setOptions(e)},v.processCallback=function(e,t){b(e,t)},v.processCallbackPromise=function(e,t){return new c((function(r,n){b(e,t,!0,r,n)}))};var b=function(e,t,r,n,i){var o="api::processCallback";r&&(o="api::processCallbackPromise"),l.verifyCallback(e,"done",o),e.callback=function(a,s,c){var u=e.callback.options;if(s=s||u,t&&(s=u),l.isFunction(e.cbaop)){var p=e.cbaop(a,s);d(p)&&(s=p)}var f=e.done;l.isObject(s)&&(delete s.done,delete s.cb,delete s.callback),r?a?i({message:"生成接口回调错误",callFunc:o,event:a}):n(s):f(a,s,c)},e.callback.options=l.copy(e)};v.processPs=function(e){l.notexist(e.ps)&&(e.ps=""),l.verifyArrayMax("ps",e.ps,5e3)},v.processCustom=function(e){l.notexist(e.custom)&&(e.custom="")},v.sendCmd=function(){this.protocol.sendCmd.apply(this.protocol,arguments)},v.sendCmdWithResp=function(e,t,r){this.sendCmd(e,t,(function(e,t,n){l.isFunction(r)&&(e?r(e,t):r(null,n))}))},v.cbAndSendCmd=function(e,t){var r=this.processCallbackPromise(t);return this.sendCmd(e,t),r},v.sendCmdUsePromise=function(e,t){var r=this;return new c((function(n,i){r.sendCmd(e,t,(function(e,t,r){if(e)i(e);else{var o=l.merge({},t,r);n(o)}}))}))},m.use=function(e,t){e&&e.install&&l.isFunction(e.install)&&e.install(this,t)},m.rmAllInstances=function(){for(var e in g)g[e].destroy();g={}},v.logout=function(e){e=e||{},this.protocol.shouldReconnect=!1,this.protocol.doLogout=!0,this.processCallback(e),this.sendCmd("logout",e,e.callback)},e.exports=m,r(422),r(423),r(430),r(431),r(441),r(445),r(446)},function(e,t,r){var n=r(36);e.exports=n("navigator","userAgent")||""},function(e,t,r){var n=r(26),i=r(41),o=r(57);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(1),i=r(129),o=r(21),a=r(67),s=r(18)("toStringTag"),c=n.Object,u="Arguments"==a(function(){return arguments}());e.exports=i?a:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=c(e),s))?r:u?a(t):"Object"==(n=a(t))&&o(t.callee)?"Arguments":n}},function(e,t,r){e.exports=r(447)},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){e.exports=r(180)},function(e,t,r){e.exports=r(388)},function(e,t,r){var n=r(497);n.fn=n.prototype,e.exports=n,r(499),r(500),r(501),r(502),r(503),r(504),r(505),r(506),r(507),r(508),r(509)},function(e,t,r){(function(t){var n=r(16),i=r(6),o=r(383),a=r(51),s=r(28),c=function(){var e="object"===(void 0===t?"undefined":s(t))?t:window,r=Math.pow(2,53)-1,c=/\bOpera/,u=Object.prototype,l=u.hasOwnProperty,d=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+n(e).call(e,1)}function f(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function h(e,t){for(var r in e)l.call(e,r)&&t(e[r],r,e)}function m(e){var t;return null==e?p(e):n(t=d.call(e)).call(t,8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function v(e,t){var n=null;return function(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=r)for(;++n<i;)t(e[n],n);else h(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function y(e){return String(e).replace(/^ +| +$/g,"")}return function t(r){var u=e,l=r&&"object"===s(r)&&"String"!=m(r);l&&(u=r,r=null);var p=u.navigator||{},b=p.userAgent||"";r||(r=b);var S,_,M,T,w,x,I,E=l?!!p.likeChrome:/\bChrome\b/.test(r)&&!/internal|\n/i.test(d.toString()),A=l?"Object":"ScriptBridgingProxyObject",C=l?"Object":"Environment",k=l&&u.java?"JavaPackage":m(u.java),O=l?"Object":"RuntimeObject",N=/\bJava/.test(k)&&u.java,R=N&&m(u.environment)==C,P=N?"a":"α",D=N?"b":"β",j=u.document||{},L=u.operamini||u.opera,z=c.test(z=l&&L?L["[[Class]]"]:m(L))?z:L=null,U=r,B=[],F=null,V=r==b,H=V&&L&&"function"==typeof L.version&&L.version(),$=v([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,t){return e||RegExp("\\b"+(t.pattern||g(t))+"\\b","i").exec(r)&&(t.label||t)})),W=v(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],(function(e,t){return e||RegExp("\\b"+(t.pattern||g(t))+"\\b","i").exec(r)&&(t.label||t)})),Y=q([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),G=v({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},(function(e,t,n){return e||(t[Y]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Y)]||RegExp("\\b"+g(n)+"(?:\\b|\\w*\\d)","i").exec(r))&&n})),Q=v(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],(function(e,t){var n=t.pattern||g(t);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(r))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),f(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,t.label||t)),e}));function q(e){return v(e,(function(e,t){var n=t.pattern||g(t);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(r)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(r)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(r))&&((e=String(t.label&&!RegExp(n,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=f(e[0].replace(RegExp(n,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}if($&&($=[$]),G&&!Y&&(Y=q([G])),(S=/\bGoogle TV\b/.exec(Y))&&(Y=S[0]),/\bSimulator\b/i.test(r)&&(Y=(Y?Y+" ":"")+"Simulator"),"Opera Mini"==W&&/\bOPiOS\b/.test(r)&&B.push("running in Turbo/Uncompressed mode"),"IE"==W&&/\blike iPhone OS\b/.test(r)?(G=(S=t(r.replace(/like iPhone OS/,""))).manufacturer,Y=S.product):/^iP/.test(Y)?(W||(W="Safari"),Q="iOS"+((S=/ OS ([\d_]+)/i.exec(r))?" "+S[1].replace(/_/g,"."):"")):"Konqueror"!=W||/buntu/i.test(Q)?G&&"Google"!=G&&(/Chrome/.test(W)&&!/\bMobile Safari\b/i.test(r)||/\bVita\b/.test(Y))||/\bAndroid\b/.test(Q)&&/^Chrome/.test(W)&&/\bVersion\//i.test(r)?(W="Android Browser",Q=/\bAndroid\b/.test(Q)?Q:"Android"):"Silk"==W?(/\bMobi/i.test(r)||(Q="Android",B.unshift("desktop mode")),/Accelerated *= *true/i.test(r)&&B.unshift("accelerated")):"PaleMoon"==W&&(S=/\bFirefox\/([\d.]+)\b/.exec(r))?B.push("identifying as Firefox "+S[1]):"Firefox"==W&&(S=/\b(Mobile|Tablet|TV)\b/i.exec(r))?(Q||(Q="Firefox OS"),Y||(Y=S[1])):!W||(S=!/\bMinefield\b/i.test(r)&&/\b(?:Firefox|Safari)\b/.exec(W))?(W&&!Y&&/[\/,]|^[^(]+?\)/.test(n(r).call(r,i(r).call(r,S+"/")+8))&&(W=null),(S=Y||G||Q)&&(Y||G||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(Q))&&(W=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(Q)?Q:S)+" Browser")):"Electron"==W&&(S=(/\bChrome\/([\d.]+)\b/.exec(r)||0)[1])&&B.push("Chromium "+S):Q="Kubuntu",H||(H=v(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version","HeadlessChrome",g(W),"(?:Firefox|Minefield|NetFront)"],(function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(r)||0)[1]||null}))),(S=("iCab"==$&&o(H)>3?"WebKit":/\bOpera\b/.test(W)&&(/\bOPR\b/.test(r)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(r)&&!/^(?:Trident|EdgeHTML)$/.test($)&&"WebKit"||!$&&/\bMSIE\b/i.test(r)&&("Mac OS"==Q?"Tasman":"Trident")||"WebKit"==$&&/\bPlayStation\b(?! Vita\b)/i.test(W)&&"NetFront")&&($=[S]),"IE"==W&&(S=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(r)||0)[1])?(W+=" Mobile",Q="Windows Phone "+(/\+$/.test(S)?S:S+".x"),B.unshift("desktop mode")):/\bWPDesktop\b/i.test(r)?(W="IE Mobile",Q="Windows Phone 8.x",B.unshift("desktop mode"),H||(H=(/\brv:([\d.]+)/.exec(r)||0)[1])):"IE"!=W&&"Trident"==$&&(S=/\brv:([\d.]+)/.exec(r))&&(W&&B.push("identifying as "+W+(H?" "+H:"")),W="IE",H=S[1]),V){if(T="global",w=null!=(M=u)?s(M[T]):"number",/^(?:boolean|number|string|undefined)$/.test(w)||"object"==w&&!M[T])m(S=u.runtime)==A?(W="Adobe AIR",Q=S.flash.system.Capabilities.os):m(S=u.phantom)==O?(W="PhantomJS",H=(S=S.version||null)&&S.major+"."+S.minor+"."+S.patch):"number"==typeof j.documentMode&&(S=/\bTrident\/(\d+)/i.exec(r))?(H=[H,j.documentMode],(S=+S[1]+4)!=H[1]&&(B.push("IE "+H[1]+" mode"),$&&($[1]=""),H[1]=S),H="IE"==W?String(H[1].toFixed(1)):H[0]):"number"==typeof j.documentMode&&/^(?:Chrome|Firefox)\b/.test(W)&&(B.push("masking as "+W+" "+H),W="IE",H="11.0",$=["Trident"],Q="Windows");else if(N&&(U=(S=N.lang.System).getProperty("os.arch"),Q=Q||S.getProperty("os.name")+" "+S.getProperty("os.version")),R){try{H=u.require("ringo/engine").version.join("."),W="RingoJS"}catch(e){(S=u.system)&&S.global.system==u.system&&(W="Narwhal",Q||(Q=S[0].os||null))}W||(W="Rhino")}else"object"===s(u.process)&&!u.process.browser&&(S=u.process)&&("object"===s(S.versions)&&("string"==typeof S.versions.electron?(B.push("Node "+S.versions.node),W="Electron",H=S.versions.electron):"string"==typeof S.versions.nw&&(B.push("Chromium "+H,"Node "+S.versions.node),W="NW.js",H=S.versions.nw)),W||(W="Node.js",U=S.arch,Q=S.platform,H=(H=/[\d.]+/.exec(S.version))?H[0]:null));Q=Q&&f(Q)}if(H&&(S=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(H)||/(?:alpha|beta)(?: ?\d)?/i.exec(r+";"+(V&&p.appMinorVersion))||/\bMinefield\b/i.test(r)&&"a")&&(F=/b/i.test(S)?"beta":"alpha",H=H.replace(RegExp(S+"\\+?$"),"")+("beta"==F?D:P)+(/\d+\+?/.exec(S)||"")),"Fennec"==W||"Firefox"==W&&/\b(?:Android|Firefox OS)\b/.test(Q))W="Firefox Mobile";else if("Maxthon"==W&&H)H=H.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Y))"Xbox 360"==Y&&(Q=null),"Xbox 360"==Y&&/\bIEMobile\b/.test(r)&&B.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(W)&&(!W||Y||/Browser|Mobi/.test(W))||"Windows CE"!=Q&&!/Mobi/i.test(r))if("IE"==W&&V)try{null===u.external&&B.unshift("platform preview")}catch(e){B.unshift("embedded")}else(/\bBlackBerry\b/.test(Y)||/\bBB10\b/.test(r))&&(S=(RegExp(Y.replace(/ +/g," *")+"/([.\\d]+)","i").exec(r)||0)[1]||H)?(Q=((S=[S,/BB10/.test(r)])[1]?(Y=null,G="BlackBerry"):"Device Software")+" "+S[0],H=null):this!=h&&"Wii"!=Y&&(V&&L||/Opera/.test(W)&&/\b(?:MSIE|Firefox)\b/i.test(r)||"Firefox"==W&&/\bOS X (?:\d+\.){2,}/.test(Q)||"IE"==W&&(Q&&!/^Win/.test(Q)&&H>5.5||/\bWindows XP\b/.test(Q)&&H>8||8==H&&!/\bTrident\b/.test(r)))&&!c.test(S=t.call(h,r.replace(c,"")+";"))&&S.name&&(S="ing as "+S.name+((S=S.version)?" "+S:""),c.test(W)?(/\bIE\b/.test(S)&&"Mac OS"==Q&&(Q=null),S="identify"+S):(S="mask"+S,W=z?f(z.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(S)&&(Q=null),V||(H=null)),$=["Presto"],B.push(S));else W+=" Mobile";(S=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(r)||0)[1])&&(S=[o(S.replace(/\.(\d)$/,".0$1")),S],"Safari"==W&&"+"==n(x=S[1]).call(x,-1)?(W="WebKit Nightly",F="alpha",H=n(I=S[1]).call(I,0,-1)):H!=S[1]&&H!=(S[2]=(/\bSafari\/([\d.]+\+?)/i.exec(r)||0)[1])||(H=null),S[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(r)||0)[1],537.36==S[0]&&537.36==S[2]&&o(S[1])>=28&&"WebKit"==$&&($=["Blink"]),V&&(E||S[1])?($&&($[1]="like Chrome"),S=S[1]||((S=S[0])<530?1:S<532?2:S<532.05?3:S<533?4:S<534.03?5:S<534.07?6:S<534.1?7:S<534.13?8:S<534.16?9:S<534.24?10:S<534.3?11:S<535.01?12:S<535.02?"13+":S<535.07?15:S<535.11?16:S<535.19?17:S<536.05?18:S<536.1?19:S<537.01?20:S<537.11?"21+":S<537.13?23:S<537.18?24:S<537.24?25:S<537.36?26:"Blink"!=$?"27":"28")):($&&($[1]="like Safari"),S=(S=S[0])<400?1:S<500?2:S<526?3:S<533?4:S<534?"4+":S<535?5:S<537?6:S<538?7:S<601?8:"8"),$&&($[1]+=" "+(S+="number"==typeof S?".x":/[.+]/.test(S)?"":"+")),"Safari"==W&&(!H||a(H)>45)&&(H=S)),"Opera"==W&&(S=/\bzbov|zvav$/.exec(Q))?(W+=" ",B.unshift("desktop mode"),"zvav"==S?(W+="Mini",H=null):W+="Mobile",Q=Q.replace(RegExp(" *"+S+"$"),"")):"Safari"==W&&/\bChrome\b/.exec($&&$[1])&&(B.unshift("desktop mode"),W="Chrome Mobile",H=null,/\bOS X\b/.test(Q)?(G="Apple",Q="iOS 4.3+"):Q=null),H&&0==i(H).call(H,S=/[\d.]+$/.exec(Q))&&i(r).call(r,"/"+S+"-")>-1&&(Q=y(Q.replace(S,""))),$&&!/\b(?:Avant|Nook)\b/.test(W)&&(/Browser|Lunascape|Maxthon/.test(W)||"Safari"!=W&&/^iOS/.test(Q)&&/\bSafari\b/.test($[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(W)&&$[1])&&(S=$[$.length-1])&&B.push(S),B.length&&(B=["("+B.join("; ")+")"]),G&&Y&&i(Y).call(Y,G)<0&&B.push("on "+G),Y&&B.push((/^on /.test(B[B.length-1])?"":"on ")+Y),Q&&(S=/ ([\d.+]+)$/.exec(Q),_=S&&"/"==Q.charAt(Q.length-S[0].length-1),Q={architecture:32,family:S&&!_?Q.replace(S[0],""):Q,version:S?S[1]:null,toString:function(){var e=this.version;return this.family+(e&&!_?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(S=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(U))&&!/\bi686\b/i.test(U)?(Q&&(Q.architecture=64,Q.family=Q.family.replace(RegExp(" *"+S),"")),W&&(/\bWOW64\b/i.test(r)||V&&/\w(?:86|32)$/.test(p.cpuClass||p.platform)&&!/\bWin64; x64\b/i.test(r))&&B.unshift("32-bit")):Q&&/^OS X/.test(Q.family)&&"Chrome"==W&&o(H)>=39&&(Q.architecture=64),r||(r=null);var J={};return J.description=r,J.layout=$&&$[0],J.manufacturer=G,J.name=W,J.prerelease=F,J.product=Y,J.ua=r,J.version=W&&H,J.os=Q||{architecture:null,family:null,version:null,toString:function(){return"null"}},J.parse=t,J.toString=function(){return this.description||""},J.version&&B.unshift(H),J.name&&B.unshift(W),Q&&W&&(Q!=String(Q).split(" ")[0]||Q!=W.split(" ")[0]&&!Y)&&B.push(Y?"("+Q+")":"on "+Q),B.length&&(J.description=B.join(" ")),J}()}();e.exports=c}).call(this,r(49))},function(e,t,r){var n,i=r(150),o=r(151),a=r(119),s=r(3),c=r(9),u=r(11),l=r(10),d=r(93),p=r(29),f=r(118),h=r(19),m=r(23),g=["operation_type","code","target"],v=["operation_type","code","target"],y=r(55),b=r(53),S=r(0),_=r(40),M=r(17),T=r(43),w="https://statistic.live.126.net/statics/report/common/form",x="nimErrEvent",I={sdktype:"IM",platform:"Web",deviceId:_.deviceId,sdk_ver:M.info.version,manufactor:b.manufacturer,env:"online"},E={login:"nimLoginErrEvent",nos:"nimNosErrEvent"},A={login:null,nos:null},C={maxInterval:30,maxSize:100,minInterval:10,maxDelay:100,turnOn:!1},k=null,O=!1,N={reportErrEventUrl:w,localKey:x,reportErrEvent:function(e){try{var t,r=localStorage.getItem(x);if(!r)return;r=JSON.parse(r);var n=[];s(t=c(r)).call(t,(function(e){n.push(r[e])}));var i={app_key:e.appKey,sdk_ver:e.sdk_ver,platform:"Web",os_ver:b.os.family+" "+b.os.version,manufacturer:b.manufacturer,model:b.name};y(w,{method:"POST",timeout:2e3,headers:{"Content-Type":"application/json"},data:u({common:{device_id:e.deviceId,sdk_type:"IM"},event:{logReport:n,deviceinfo:i}}),onload:function(){localStorage.removeItem(x)},onerror:function(e){}})}catch(e){}},saveErrEvent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.code&&e.module)try{var t=localStorage.getItem(x)||"{}";t=JSON.parse(t);var r=e.code+e.module+e.accid;t[r]?t[r].count++:t[r]={errorCode:e.code,module:e.module,accid:e.accid,timestamp:(new Date).getTime(),count:1},localStorage.setItem(x,u(t))}catch(e){}},initUniErrReport:function(){var e,t,r,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I.appkey=i.appKey,y(l(e=l(t=l(r=l(n="".concat("https://statistic.live.126.net","/dispatcher/req?deviceId=").concat(I.deviceId,"&sdktype=")).call(n,I.sdktype,"&sdkVer=")).call(r,I.sdk_ver,"&platform=")).call(t,I.platform,"&appkey=")).call(e,I.appkey),{method:"get",onload:function(e){var t=null;try{t=JSON.parse(e)}catch(e){}t&&t.code&&200===t.code&&((C=t.data).maxInterval=C.maxInterval>1e4?1e4:C.maxInterval,C.maxInterval=C.maxInterval<10?10:C.maxInterval,C.maxSize=C.maxSize>1e3?1e3:C.maxSize,C.minInterval=C.minInterval<2?2:C.minInterval,C.maxDelay=C.maxDelay>600?600:C.maxDelay,200===t.code&&(C.turnOn=!0,k=d((function(){N.checkUniErrCache(!0)}),1e3*C.maxInterval)))},onerror:function(e){}})},startUniErrCache:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(A.hasOwnProperty(e)&&!A[e]&&t.user_id&&t.action){var r=(new Date).valueOf();A[e]={user_id:t.user_id,action:t.action,start_time:r,extension:[]}}},updateUniErrCache:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(A.hasOwnProperty(e)&&A[e]&&A[e].extension&&p(A[e].extension)){var n=r.operation_type,i=r.code,o=r.target,s=a(r,g),c=f(t=A[e].extension).call(t,(function(e,t){return e+t.duration}),0),l=(new Date).getTime()-c-A[e].start_time;r.error&&r.error.code&&(i=r.error.code),A[e].extension.push({operation_type:n,code:i,succeed:!1,target:o,duration:l,description:u(s)})}},updateUniSuccCache:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(A.hasOwnProperty(e)&&A[e]&&A[e].extension&&p(A[e].extension)){var n=r.operation_type,i=(r.code,r.target),o=a(r,v),s=f(t=A[e].extension).call(t,(function(e,t){return e+t.duration}),0),c=(new Date).getTime()-s-A[e].start_time;A[e].extension.push({operation_type:n,code:200,succeed:!0,target:i,duration:c,description:u(o)})}},concludeUniErrCache:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(A.hasOwnProperty(e)&&A[e])if("nos"!==e||0!==t){var r=(new Date).valueOf();A[e].succeed=!t,A[e].duration=r-A[e].start_time;var n=S.copy(A[e]);A[e]=null;try{var i=localStorage.getItem(E[e])||"[]",o=JSON.parse(i);o.push(n),localStorage.setItem(E[e],u(o)),C.turnOn&&N.checkUniErrCache()}catch(e){}}else A[e]=null},checkUniErrCache:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!O){var t=(new Date).valueOf();try{var r=localStorage.getItem(E.login)||"[]",n=localStorage.getItem(E.nos)||"[]",a=JSON.parse(r),s=JSON.parse(n),c=h(a).call(a,(function(e){return t-e.start_time<1e3*C.maxDelay})),l=h(s).call(s,(function(e){return t-e.start_time<1e3*C.maxDelay})),p=T.getLastSeveralItems([c,l],C.maxSize),f=o(p,2),m=f[0],g=f[1];if(m.length+g.length===C.maxSize||e){if(m.length+g.length===0)return;var v={common:{app_key:I.appkey,platform:I.platform,sdk_ver:I.sdk_ver,manufactor:I.manufactor,env:I.env},event:{login:i(m),nos:i(g)}};y(w,{method:"POST",timeout:2e3,headers:{"Content-Type":"application/json",sdktype:I.sdktype},data:u(v),onload:function(){for(var e in E)if(Object.hasOwnProperty.call(E,e)){var t=E[e];localStorage.setItem(t,"[]")}clearInterval(k),k=d((function(){N.checkUniErrCache(!0)}),1e3*C.maxInterval),O=!1},onerror:function(){O=!1}}),O=!0}}catch(e){O=!1}}},pause:function(){I.turnOn=!1},restore:function(){I.turnOn=!0},destroy:function(){k&&clearInterval(k),N.concludeUniErrCache("login",1),N.concludeUniErrCache("nos",1),I.turnOn=!1,O=!1}};N.sendBeacon=navigator&&navigator.sendBeacon&&m(n=navigator.sendBeacon).call(n,navigator)||function(e,t){var r=new XMLHttpRequest;r.open("POST",e,!0),r.send(t)},e.exports=N},function(e,t,r){var n=r(109),i=r(419),o=r(420),a=r(421);n.json=i,n.upload=o,n.chunkUpload=a,e.exports=n},function(e,t){var r=Function.prototype,n=r.apply,i=r.bind,o=r.call;e.exports="object"==typeof Reflect&&Reflect.apply||(i?o.bind(n):function(){return o.apply(n,arguments)})},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){r(76);var n=r(267),i=r(1),o=r(47),a=r(46),s=r(75),c=r(18)("toStringTag");for(var u in n){var l=i[u],d=l&&l.prototype;d&&o(d)!==c&&a(d,c,u),s[u]=s.Array}},function(e,t,r){e.exports=r(178)},function(e,t,r){e.exports=r(272)},function(e,t,r){e.exports=r(275)},function(e,t,r){e.exports=r(278)},function(e,t,r){var n=r(212);e.exports=function(e,t,r){return t in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(78),i=r(29),o=r(9),a=r(6),s=r(77),c=r(3),u=r(11),l=r(24),d=r(153),p=r(10),f=r(23),h=r(0),m=r(17),g=r(54),v=r(33);function y(e){h.undef(e.secure)&&(e.secure=!0),this.options=h.copy(e),this.keepNosSafeUrl=this.options.keepNosSafeUrl||!1;var t=e.defaultLink||e.defaultLinkUrl;h.notundef(t)&&h.isString(t)&&(m.optionDefaultLinkUrl=n(t).call(t)),h.notundef(e.ipv6DefaultLink)&&h.isString(e.ipv6DefaultLink)&&(m.optionIpv6DefaultLinkUrl=e.ipv6DefaultLink),"number"==typeof e.heartbeatInterval&&(m.heartbeatInterval=e.heartbeatInterval),i(e.nosLbsUrls)&&(m.nosLbsUrls=e.nosLbsUrls),this.init(),this.connect()}var b=y.fn=y.prototype;b.init=function(){this.logger=this.options.logger,this.getNosOriginUrlReqNum=0,this.checkNosReqNum=0,this.cmdTaskArray=[],this.timerMap={},this.cmdCallbackMap={},this.cmdContentMap={},this.initConnect(),this.reset()},b.reset=function(){this.resetConnect()},b.setOptions=function(e){var t=this.options,r=o(t),n=a(r).call(r,"account");this.logger.info("setOptions::",h.omitAsString(e,["appKey","token","loginExt","customTag"])),-1!==n&&s(r).call(r,n,1),e=h.filterObj(e,r),this.options=h.merge(t,e),this.reset()},b.sendCmd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;this.heartbeat();var n,i=e,a=(e=this.parser.createCmd(e,t)).SER;t=t||{},this.cmdContentMap[a]=t,t.single&&(delete t.single,1===(n=o(t)).length&&(this.cmdContentMap[a]=t[n[0]])),t.NOTSTORE&&(n=t.NOTSTORE.split(" "),c(n).call(n,(function(e){delete t[e]})),delete t.NOTSTORE),(r=r||t.callback)&&(this.cmdCallbackMap[a]=r),this.cmdTaskArray.push({cmdName:i,cmd:u(e)}),this.startCmdTaskTimer()},b.startCmdTaskTimer=function(){var e=this;e.cmdTaskTimer||(e.cmdTaskTimer=l((function(){var t=e.cmdTaskArray.shift();e.cmdTaskTimer=null,t&&e.executeCmdTask(t),e.cmdTaskArray.length&&e.startCmdTaskTimer()}),0))},b.executeCmdTask=function(e){var t=e.cmdName,r=e.cmd,n=(r=JSON.parse(r)).SER;this.isFrequencyControlled(t)?(this.logger.warn("protocol::executeCmdTask: ".concat(t," hit freq control")),this.markCallbackInvalid(n,v.newFrequencyControlError({callFunc:"protocol::executeCmdTask",message:"".concat(t," hit freq control")}))):this.hasLogin?("heartbeat"!==t&&this.logger.log("protocol::sendCmd: ".concat(t)),this.doSendCmd(r)):"login"===t&&this.isConnected()?(this.logger.info("protocol::sendCmd: ".concat(t)),this.doSendCmd(r)):(this.logger.warn("protocol::executeCmdTask: ".concat(t," not connected or login")),this.markCallbackInvalid(n,v.newSocketStateError({callFunc:"protocol::executeCmdTask",message:"".concat(t," not connected or not login")})))},b.isFrequencyControlled=function(e){var t=this.frequencyControlMap&&this.frequencyControlMap[e];if(t){if(d()<t.from+t.duration)return!0;delete this.frequencyControlMap[e]}},b.doSendCmd=function(e){var t=this,r=e.SER,n=0===r?m.hbCmdTimeout:m.cmdTimeout;function i(){t.markCallbackInvalid(r,v.newSocketStateError({callFunc:"protocol::doSendCmd",message:"ser ".concat(r," socketSendJson Error")})),t.onDisconnect("protocol::doSendCmd:socketSendJson")}t.timerMap[r]=l((function(){t.markCallbackInvalid(r,v.newTimeoutError({callFunc:"protocol::doSendCmd",message:"ser ".concat(r," Timeout Error")}))}),n);try{t.socket&&t.socket.send?t.socket.send(u(e)):i()}catch(e){i()}},b.getObjWithSer=function(e){var t=this.cmdContentMap[e];return t&&!t.isImSyncDataObj&&delete this.cmdContentMap[e],t&&h.copy(t)},b.getCallbackWithSer=function(e){var t=this.cmdCallbackMap[e];return t&&!t.isImSyncDataCb&&delete this.cmdCallbackMap[e],t},b.getTimerWithSer=function(e){var t=this.timerMap[e];return delete this.timerMap[e],t},b.clearTimerWithSer=function(e){var t=this.getTimerWithSer(e);t&&clearTimeout(t)},b.markCallbackInvalid=function(e,t){this.getObjWithSer(e),this.clearTimerWithSer(e);var r=this.getCallbackWithSer(e);if(r){var n=r.options;l((function(){r(t||v.newUnknownError({ser:e}),n)}),0)}},b.markAllCallbackInvalid=function(e){var t,r=this;c(t=o(this.cmdCallbackMap)).call(t,(function(t){r.markCallbackInvalid(t,e)})),r.cmdTaskArray=[]},b.getPacketObj=function(e){var t=null;if(e&&e.raw){var r=e.raw.ser;h.notundef(r)&&(t=this.getObjWithSer(r))}return t},b.callPacketAckCallback=function(e){var t=this;if(e&&e.raw){var r=e.raw.ser;if(h.notundef(r)){t.clearTimerWithSer(r);var n,i=t.getCallbackWithSer(r);i&&(i.originUrl&&e.obj&&e.obj.file&&(e.obj.file._url_safe=e.obj.file.url,e.obj.file.url=i.originUrl,"audio"===e.obj.type&&(e.obj.file.mp3Url=i.originUrl+(~a(n=i.originUrl).call(n,"?")?"&":"?")+"audioTrans&type=mp3")),e.promise?e.promise.then((function(){i(e.error,e.obj)}),(function(n){var o;n.callFunc="protocol::callPacketAckCallback",n.message=p(o="Resp Promoise Error: cmd: ".concat(e.cmd,", ser: ")).call(o,r);var a=v.customError("CALLBACK_ACK_ERR",n);t.logger.error("protocol::callPacketAckCallback: promise error ".concat(u(n))),i(a,e.obj,e.content)})):i(e.error,e.obj,e.content))}}},b.onMessage=function(e){var t=this;t.heartbeat(),t.parser.parseResponse(e).then((function(e){if(e.notFound&&t.logger.warn("protocol::onMessage: packet not found ".concat(u(e))),e.error){var r,n;e.error.message=p(r="".concat(e.cmd," error: ")).call(r,e.error.message),t.logger.error(p(n="protocol::onMessage: packet error ".concat(u(e.error),"，raw cmd ")).call(n,e.rawStr));var i=e.raw||{};408!==i.code&&415!==i.code&&500!==i.code||g.saveErrEvent({code:i.code,module:e.cmd,accid:t.account})}e.frequencyControlDuration&&(t.logger.error("protocol::onMessage: server freq control ".concat(u(e.cmd))),t.frequencyControlMap=t.frequencyControlMap||{},t.frequencyControlMap[e.cmd]={from:+new Date,duration:e.frequencyControlDuration}),e.obj=t.getPacketObj(e),"heartbeat"!==e.cmd&&t.logger.log("protocol::recvCmd: ".concat(e.cmd));var o="process"+h.capFirstLetter(e.service);if(t[o])if("syncDone"===e.cmd){if(t.cmdCallbackMap[e.raw.ser]&&t.cmdCallbackMap[e.raw.ser].isImSyncDataCb){var a;t.cmdCallbackMap[e.raw.ser].isImSyncDataCb=!1;var s=f(a=function(e,t){this.checkNosReqNum++,this.getNosOriginUrlReqNum<=0||this.checkNosReqNum>=20?this[e](t):l(s,300)}).call(a,t,o,e);l((function(){s.call(t,o,e)}),10)}}else t[o](e);else t.logger.warn("protocol::onMessage: ".concat(o," not found"));t.callPacketAckCallback(e)}))},b.onMiscError=function(e,t,r){t&&this.notifyError(e,t,r)},b.onCustomError=function(e,t){var r=v.customError(e,t),n=t.message||"未知错误";this.onMiscError(n,r)},b.notifyError=function(e,t,r){var n;this.isConnected()&&(this.logger.error(p(n="".concat(e||""," ")).call(n,this.name),t,r),this.options.onerror(t,r))},b.emitAPI=function(e){var t=e.type,r=e.obj;this.api.emit(t,r)},e.exports=y,r(454),r(457),r(458),r(459),r(460)},function(e,t,r){(function(t){var n;e.exports=(n=n||function(e,n){var i;if("undefined"!=typeof window&&window.crypto&&(i=window.crypto),"undefined"!=typeof self&&self.crypto&&(i=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!=typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&void 0!==t&&t.crypto&&(i=t.crypto),!i)try{i=r(597)}catch(e){}var o=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),s={},c=s.lib={},u=c.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=c.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||p).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(o());return new l.init(t,e)}}),d=s.enc={},p=d.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new l.init(r,t/2)}},f=d.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new l.init(r,t)}},h=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},m=c.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,a=this.blockSize,s=o/(4*a),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,u=e.min(4*c,o);if(c){for(var d=0;d<c;d+=a)this._doProcessBlock(i,d);r=i.splice(0,c),n.sigBytes-=u}return new l.init(r,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(c.Hasher=m.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}}),s.algo={});return s}(Math),n)}).call(this,r(49))},function(e,t,r){var n=r(26),i=r(31),o=r(111),a=r(57),s=r(35),c=r(95),u=r(25),l=r(160),d=Object.getOwnPropertyDescriptor;t.f=n?d:function(e,t){if(e=s(e),t=c(t),l)try{return d(e,t)}catch(e){}if(u(e,t))return a(!i(o.f,e,t),e[t])}},function(e,t,r){var n=r(7),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},function(e,t,r){var n,i,o=r(1),a=r(45),s=o.process,c=o.Deno,u=s&&s.versions||c&&c.version,l=u&&u.v8;l&&(i=(n=l.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},function(e,t){e.exports=!0},function(e,t,r){var n=r(7),i=r(39),o=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?o(e,t):function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(13);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},function(e,t,r){var n=r(67);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(95),i=r(41),o=r(57);e.exports=function(e,t,r){var a=n(t);a in e?i.f(e,a,o(0,r)):e[a]=r}},function(e,t,r){var n=r(46);e.exports=function(e,t,r,i){i&&i.enumerable?e[t]=r:n(e,t,r)}},function(e,t){e.exports={}},function(e,t,r){var n=r(35),i=r(148),o=r(75),a=r(100),s=r(164),c=a.set,u=a.getterFor("Array Iterator");e.exports=s(Array,"Array",(function(e,t){c(this,{type:"Array Iterator",target:n(e),index:0,kind:t})}),(function(){var e=u(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t,r){e.exports=r(298)},function(e,t,r){e.exports=r(413)},function(e,t,r){var n=r(70),i=r(7),o=r(94),a=r(37),s=r(38),c=r(128),u=i([].push),l=function(e){var t=1==e,r=2==e,i=3==e,l=4==e,d=6==e,p=7==e,f=5==e||d;return function(h,m,g,v){for(var y,b,S=a(h),_=o(S),M=n(m,g),T=s(_),w=0,x=v||c,I=t?x(h,T):r||p?x(h,0):void 0;T>w;w++)if((f||w in _)&&(b=M(y=_[w],w,S),e))if(t)I[w]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return w;case 2:u(I,y)}else switch(e){case 4:return!1;case 7:u(I,y)}return d?-1:i||l?l:I}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},function(e,t,r){e.exports=r(268)},function(e,t,r){var n=r(28),i=r(9),o=r(11),a=r(19),s=r(3),c=r(16),u=r(0),l=u.undef,d=u.notundef,p=u.exist,f=r(143),h=r(203),m="#%@all@%#",g={p2p:0,team:1,superTeam:5},v={0:"p2p",1:"team",5:"superTeam"},y=i(g),b=h.typeMap,S=h.validTypes;function _(e){u.verifyOptions(e,"scene to type","msg::Message"),u.verifyParamValid("scene",e.scene,y,"msg::Message"),this.scene=g[e.scene],this.to=""+e.to,this.type=b[e.type],this.resend=e.resend?1:0,e.resend?(u.verifyOptions(e,"idClient","msg::Message"),this.idClient=e.idClient):this.idClient=u.guid(),d(e.subType)&&(u.isInt(+e.subType)&&+e.subType>0?this.subType=+e.subType:u.onParamError("subType只能是大于0的整数","msg::Message"));var t=e.replyMsg;t&&t.idServer&&t.from&&t.to&&t.time&&(this.replyMsgFromAccount=t.from,this.replyMsgToAccount=t.to,this.replyMsgTime=t.time,this.replyMsgIdServer=t.idServer,this.replyMsgIdClient=t.idClient,t.threadMsgFromAccount&&t.threadMsgIdServer&&t.threadMsgTime&&t.threadMsgToAccount?(this.threadMsgFromAccount=t.threadMsgFromAccount,this.threadMsgToAccount=t.threadMsgToAccount,this.threadMsgTime=t.threadMsgTime,this.threadMsgIdServer=t.threadMsgIdServer,this.threadMsgIdClient=t.threadMsgIdClient):(this.threadMsgFromAccount=t.from,this.threadMsgToAccount=t.to,this.threadMsgTime=t.time,this.threadMsgIdServer=t.idServer,this.threadMsgIdClient=t.idClient)),d(e.text)&&(this.body=""+e.text),d(e.custom)&&("object"===n(e.custom)?this.custom=o(e.custom):this.custom=""+e.custom),d(e.body)&&(this.body=""+e.body),d(e.pushContent)&&(this.pushContent=""+e.pushContent),d(e.pushPayload)&&(this.pushPayload=""+e.pushPayload);var r=e.apns;if(d(r)&&"team"===e.scene){var i=r.accounts;d(i)&&u.verifyParamType("apns.accounts",i,"array","msg::Message"),this.apnsAccounts=i?o(i):m,this.apnsContent=r.content||e.pushContent||"",u.verifyBooleanWithDefault(r,"forcePush",!0,"options.apns","msg::Message"),this.apnsForcePush=r.forcePush?1:0}d(e.isHistoryable)&&(this.isHistoryable=e.isHistoryable?1:0),d(e.isRoamingable)&&(this.isRoamingable=e.isRoamingable?1:0),d(e.isSyncable)&&(this.isSyncable=e.isSyncable?1:0),d(e.cc)&&(this.cc=e.cc?1:0),d(e.env)&&(this.env=e.env),d(e.isPushable)&&(this.isPushable=e.isPushable?1:0),d(e.isOfflinable)&&(this.isOfflinable=e.isOfflinable?1:0),d(e.isUnreadable)&&(this.isUnreadable=e.isUnreadable?1:0),d(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0),d(e.needMsgReceipt)&&(this.needMsgReceipt=e.needMsgReceipt?1:0),d(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),d(e.needUpdateSession)&&(this.needUpdateSession=!1===e.needUpdateSession?0:1),d(e.antiSpamUsingYidun)&&(this.antiSpamUsingYidun=e.antiSpamUsingYidun?1:0),d(e.clientAntiSpam)&&(this.clientAntiSpam=e.clientAntiSpam?1:0),d(e.antiSpamContent)&&("object"===n(e.antiSpamContent)?this.antiSpamContent=o(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),d(e.antiSpamBusinessId)&&("object"===n(e.antiSpamBusinessId)?this.antiSpamBusinessId=o(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId),d(e.yidunAntiCheating)&&(this.yidunAntiCheating=e.yidunAntiCheating),d(e.yidunAntiSpamExt)&&(this.yidunAntiSpamExt=e.yidunAntiSpamExt)}u.merge(_.prototype,h.prototype),_.prototype.getScene=function(){return v[this.scene]},_.getType=h.getType,_.reverse=function(e){var t,r=v[e.scene];if(t="1"===e.delete?{delete:!0,scene:r||e.scene,from:e.from,time:+e.time,to:""+e.to}:{scene:r||e.scene,from:e.from,fromNick:e.fromNick,fromClientType:f.reverseType(e.fromClientType),fromDeviceId:e.fromDeviceId,to:""+e.to,time:+e.time,type:_.getType(e),text:p(e.body)?e.body:e.text||"",isHistoryable:l(e.isHistoryable)||1==+e.isHistoryable,isRoamingable:l(e.isRoamingable)||1==+e.isRoamingable,isSyncable:l(e.isSyncable)||1==+e.isSyncable,cc:l(e.cc)||1==+e.cc,isPushable:l(e.isPushable)||1==+e.isPushable,isOfflinable:l(e.isOfflinable)||1==+e.isOfflinable,isUnreadable:l(e.isUnreadable)||1==+e.isUnreadable,isReplyMsg:l(e.isReplyMsg)||1==+e.isReplyMsg,needPushNick:l(e.needPushNick)||1==+e.needPushNick,needMsgReceipt:1==+e.needMsgReceipt,isLocal:!1},e.isInBlackList&&(t.isInBlackList=1==+e.isInBlackList,t.isInBlackList&&(e.status="fail")),d(e.isMuted)&&(t.isMuted=1==+e.isMuted),d(e.resend)&&(t.resend=1==+e.resend),d(e.idClient)&&(t.idClient=e.idClient),d(e.idServer)&&(t.idServer=""+e.idServer),d(e.userUpdateTime)&&(t.userUpdateTime=+e.userUpdateTime),d(e.custom)&&(t.custom=e.custom),d(e.callbackExt)&&(t.callbackExt=e.callbackExt),d(e.subType)&&(t.subType=+e.subType),d(e.pushContent)&&(t.pushContent=e.pushContent),d(e.pushPayload)&&(t.pushPayload=e.pushPayload),d(e.tempTeamMemberCount)&&(t.tempTeamMemberCount=+e.tempTeamMemberCount),d(e.yidunAntiSpamRes)&&(t.yidunAntiSpamRes=e.yidunAntiSpamRes),d(e.apnsAccounts)){if(t.apns={},e.apnsAccounts!==m){var n=e.apnsAccounts;try{t.apns.accounts=JSON.parse(n)}catch(e){t.apns.accounts=[]}}t.apns.content=e.apnsContent||"",t.apns.forcePush=1==+e.apnsForcePush}if(t.status=e.status||"success",d(a(e))&&(t.filter=a(e)),e.replyMsgIdServer&&e.threadMsgIdServer){var i=["replyMsgFromAccount","replyMsgToAccount","replyMsgTime","replyMsgIdServer","replyMsgIdClient","threadMsgFromAccount","threadMsgToAccount","threadMsgTime","threadMsgIdServer","threadMsgIdClient"];s(i).call(i,(function(r){t[r]=e[r]})),t.replyMsgTime=+t.replyMsgTime,t.threadMsgTime=+t.threadMsgTime}return t},_.setExtra=function(e,t){e.target=_.getMsgTarget(e,t),e.sessionId=e.scene+"-"+e.target,h.setFlow(e,t)},_.getMsgTarget=function(e,t){return"p2p"===e.scene?e.to===t?e.from:e.to:"team"===e.scene||"superTeam"===e.scene?e.to:void 0},_.deduplication=function(e){var t,r={},n=[];return s(e).call(e,(function(e){t=e.idClient,r[t]||(r[t]=!0,n.push(e))})),n},_.sortMsgs=function(e){return e=c(e).call(e,0),u.sortObjArray(e,{sortPath:"time"}),e},_.getLastMsg=function(e){return(e=_.sortMsgs(e))[e.length-1]},_.getLastNotIgnoredMsg=function(e){for(var t=null,r=(e=_.sortMsgs(e)).length-1;r>=0;r--)if(!(t=e[r]).ignore)return t;return null},_.getMaxTimetag=function(e){return _.getLastMsg(e).time},_.validScenes=y,_.validTypes=S,_.sceneMap=g,_.sceneReverseMap=v,e.exports=_},function(e,t,r){var n=r(112),i=r(113),o=r(80),a=r(29),s=r(6),c=r(16),u=r(3),l=r(10),d=r(218),p=r(19);function f(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(a(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return h(e,t);var i=c(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0,u=function(){};return{s:u,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,d=!0,p=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return d=e.done,e},e:function(e){p=!0,l=e},f:function(){try{d||null==r.return||r.return()}finally{if(p)throw l}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m=r(17),g={genUrlSep:function(e){return-1===s(e=""+e).call(e,"?")?"?imageView&":"&"},urlQuery2Object:function(e){if("[object String]"!==Object.prototype.toString.call(e)||""===e)return{};var t=s(e).call(e,"?");if(-1!==t){var r=c(e).call(e,t+1).split("&"),n={};return u(r).call(r,(function(e){if(~s(e).call(e,"=")){var t=e.split("=");n[t[0]]=decodeURIComponent(t[1])}else n[e]=""})),n}},url2object:function(e){"[object String]"!==Object.prototype.toString.call(e)&&(e="");var t=s(e=e||"").call(e,"https")>=0?"https://":"http://",r=e.replace(t,"");s(r).call(r,"?")>=0&&(r=r.substring(0,s(r).call(r,"?")));var n=r.split("/");r=n[0];var i="";if(n.length>0&&(i=c(n).call(n,1).join("/")),-1===s(e).call(e,"?"))return{protocol:t,hostname:r,path:i,query:{}};var o=e.substr(s(e).call(e,"?")+1).split("&"),a={};return u(o).call(o,(function(e){if(s(e).call(e,"=")>0){var t=e.split("=");a[t[0]]=decodeURIComponent(t[1])}else a[e]=""})),{protocol:t,hostname:r,path:i,query:a}},object2url:function(e){var t,r=e.protocol,n=e.hostname,i=e.path,o=e.query;r=r||"http://",n=n||"",i&&(n=l(t="".concat(n,"/")).call(t,i)),o=o||{};var a,s,c,u=[];for(var d in o){var p;"imageView"!==d&&u.push(l(p="".concat(d,"=")).call(p,encodeURIComponent(o[d])))}return u.length>0?l(a=l(s="".concat(r)).call(s,n,"?imageView&")).call(a,u.join("&")):l(c="".concat(r)).call(c,n)},genPrivateUrl:function(e,t,r){if(t&&t.length){var n,i=f(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(s(e).call(e,o)>=0)return o!==r&&(e=e.replace(o,r)),e;if(s(e).call(e,o)>=0&&o===r)return e}}catch(e){i.e(e)}finally{i.f()}}var a,u,h=g.url2object(e),v=h.hostname,y=h.path,b=m.downloadUrl,S=m.downloadHostList,_=m.nosCdnEnable,M=m.serverNosConfig.cdnDomain,T=decodeURIComponent(m.serverNosConfig.objectPrefix),w=decodeURIComponent(y),x=s(w).call(w,T);if(M&&x>-1&&_)return l(a=l(u="".concat(h.protocol)).call(u,M,"/")).call(a,c(w).call(w,x));if(d(S).call(S,v)&&d(y).call(y,"/")){var I=s(y).call(y,"/"),E=y.substring(0,I),A=y.substring(I+1);return b.replace("{bucket}",E).replace("{object}",A)}var C=p(S).call(S,(function(e){return"string"==typeof v&&d(v).call(v,e)}))[0],k=C?v.replace(C,"").replace(/\W/g,""):null;return k?b.replace("{bucket}",k).replace("{object}",y):e}};e.exports=g},function(e,t,r){var n=r(1).TypeError;e.exports=function(e){if(null==e)throw n("Can't call method on "+e);return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){var t=+e;return t!=t||0===t?0:(t>0?n:r)(t)}},function(e,t,r){var n=r(13),i=r(18),o=r(68),a=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,r){var n,i=r(34),o=r(167),a=r(131),s=r(102),c=r(169),u=r(126),l=r(101)("IE_PROTO"),d=function(){},p=function(e){return"<script>"+e+"<\/script>"},f=function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t},h=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t;h="undefined"!=typeof document?document.domain&&n?f(n):((t=u("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):f(n);for(var r=a.length;r--;)delete h.prototype[a[r]];return h()};s[l]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(d.prototype=i(e),r=new d,d.prototype=null,r[l]=e):r=h(),void 0===t?r:o(r,t)}},function(e,t,r){var n=r(129),i=r(41).f,o=r(46),a=r(25),s=r(245),c=r(18)("toStringTag");e.exports=function(e,t,r,u){if(e){var l=r?e:e.prototype;a(l,c)||i(l,c,{configurable:!0,value:t}),u&&!n&&o(l,"toString",s)}}},function(e,t){},function(e,t,r){var n=r(7);e.exports=n([].slice)},function(e,t,r){var n=r(11),i=r(28),o=r(82).genPrivateUrl,a=r(0),s=a.notundef,c=a.exist,u=r(143),l=r(203),d=l.typeMap;function p(e){e.resend?(a.verifyOptions(e,"idClient","msg::Message"),this.idClient=e.idClient):this.idClient=a.guid(),this.type=d[e.type],this.resend=e.resend?1:0,s(e.subType)&&(a.isInt(+e.subType)&&+e.subType>0?this.subType=+e.subType:a.onParamError("subType只能是大于0的整数","msg::Message")),s(e.custom)&&("object"===i(e.custom)?this.custom=n(e.custom):this.custom=""+e.custom),s(e.text)&&(this.body=""+e.text),s(e.body)&&(this.body=""+e.body),s(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),s(e.antiSpamUsingYidun)&&(this.antiSpamUsingYidun=e.antiSpamUsingYidun?1:0),s(e.antiSpamContent)&&("object"===i(e.antiSpamContent)?this.antiSpamContent=n(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),s(e.antiSpamBusinessId)&&("object"===i(e.antiSpamBusinessId)?this.antiSpamBusinessId=n(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId),s(e.yidunAntiCheating)&&(this.yidunAntiCheating=e.yidunAntiCheating+""),s(e.skipHistory)&&(this.skipHistory=e.skipHistory?1:0),s(e.highPriority)&&(this.highPriority=e.highPriority?1:0),s(e.clientAntiSpam)&&(this.clientAntiSpam=e.clientAntiSpam?1:0),s(e.env)&&(this.env=e.env),s(e.notifyTargetTags)&&(this.notifyTargetTags=e.notifyTargetTags),s(e.yidunAntiSpamExt)&&(this.yidunAntiSpamExt=e.yidunAntiSpamExt),(s(e.loc_x)||s(e.loc_y)||s(e.loc_z))&&(this.loc_x=e.loc_x,this.loc_y=e.loc_y,this.loc_z=e.loc_z)}p.validTypes=l.validTypes,a.merge(p.prototype,l.prototype),p.getType=l.getType,p.reverse=function(e){var t=a.filterObj(e,"chatroomId idClient from fromNick fromAvatar _fromAvatar_safe fromCustom userUpdateTime custom status notifyTargetTags");return s(t.fromAvatar)&&(t.fromAvatar=o(t.fromAvatar)),t=a.merge(t,{fromClientType:u.reverseType(e.fromClientType),time:+e.time,type:p.getType(e),text:c(e.body)?e.body:e.text||"",resend:1==+e.resend}),s(t.userUpdateTime)&&(t.userUpdateTime=+t.userUpdateTime),s(e.callbackExt)&&(t.callbackExt=e.callbackExt),s(e.subType)&&(t.subType=+e.subType),s(e.yidunAntiSpamRes)&&(t.yidunAntiSpamRes=e.yidunAntiSpamRes),s(e.toAccids)&&(t.toAccids=e.toAccids),t.status=t.status||"success",t},p.setExtra=function(e,t){l.setFlow(e,t)},e.exports=p},function(e,t,r){var n=r(168),i=r(131);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=r(39),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},function(e,t,r){e.exports=r(404)},function(e,t,r){var n=r(1),i=r(7),o=r(13),a=r(67),s=n.Object,c=i("".split);e.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"==a(e)?c(e,""):s(e)}:s},function(e,t,r){var n=r(232),i=r(120);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},function(e,t,r){var n=r(1).String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},function(e,t,r){var n=r(84),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},function(e,t,r){var n=r(7),i=r(13),o=r(21),a=r(47),s=r(36),c=r(130),u=function(){},l=[],d=s("Reflect","construct"),p=/^\s*(?:class|function)\b/,f=n(p.exec),h=!p.exec(u),m=function(e){if(!o(e))return!1;try{return d(u,l,e),!0}catch(e){return!1}};e.exports=!d||i((function(){var e;return m(m.call)||!m(Object)||!m((function(){e=!0}))||e}))?function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return h||!!f(p,c(e))}:m},function(e,t,r){var n=r(241).charAt,i=r(42),o=r(100),a=r(164),s=o.set,c=o.getterFor("String Iterator");a(String,"String",(function(e){s(this,{type:"String Iterator",string:i(e),index:0})}),(function(){var e,t=c(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){var n,i,o,a=r(242),s=r(1),c=r(7),u=r(27),l=r(46),d=r(25),p=r(124),f=r(101),h=r(102),m=s.TypeError,g=s.WeakMap;if(a||p.state){var v=p.state||(p.state=new g),y=c(v.get),b=c(v.has),S=c(v.set);n=function(e,t){if(b(v,e))throw new m("Object already initialized");return t.facade=e,S(v,e,t),t},i=function(e){return y(v,e)||{}},o=function(e){return b(v,e)}}else{var _=f("state");h[_]=!0,n=function(e,t){if(d(e,_))throw new m("Object already initialized");return t.facade=e,l(e,_,t),t},i=function(e){return d(e,_)?e[_]:{}},o=function(e){return d(e,_)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw m("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(123),i=r(125),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t){e.exports={}},function(e,t,r){var n=r(47),i=r(122),o=r(75),a=r(18)("iterator");e.exports=function(e){if(null!=e)return i(e,a)||i(e,"@@iterator")||o[n(e)]}},function(e,t,r){e.exports=r(302)},function(e,t,r){var n=r(67),i=r(1);e.exports="process"==n(i.process)},function(e,t,r){e.exports=r(324)},function(e,t,r){var n=r(1),i=r(70),o=r(31),a=r(34),s=r(96),c=r(171),u=r(38),l=r(15),d=r(172),p=r(103),f=r(170),h=n.TypeError,m=function(e,t){this.stopped=e,this.result=t},g=m.prototype;e.exports=function(e,t,r){var n,v,y,b,S,_,M,T=r&&r.that,w=!(!r||!r.AS_ENTRIES),x=!(!r||!r.IS_ITERATOR),I=!(!r||!r.INTERRUPTED),E=i(t,T),A=function(e){return n&&f(n,"normal",e),new m(!0,e)},C=function(e){return w?(a(e),I?E(e[0],e[1],A):E(e[0],e[1])):I?E(e,A):E(e)};if(x)n=e;else{if(!(v=p(e)))throw h(s(e)+" is not iterable");if(c(v)){for(y=0,b=u(e);b>y;y++)if((S=C(e[y]))&&l(g,S))return S;return new m(!1)}n=d(e,v)}for(_=n.next;!(M=o(_,n)).done;){try{S=C(M.value)}catch(e){f(n,"throw",e)}if("object"==typeof S&&S&&l(g,S))return S}return new m(!1)}},function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(e,t,r){var n=r(23),i=r(43),o=r(410),a=r(412),s=r(418),c={},u=i.f;function l(e){var t=e.upload="multipart/form-data"===(e.headers||i.o)["Content-Type"],r=!1;try{r=(location.protocol+"//"+location.host).toLowerCase()!==i.url2origin(e.url)}catch(e){}return e.cors=r,t||r||e.mode?function(e){var t=e.mode,r=o,n=i.getGlobal();return!n.FormData&&n.document&&(t="iframe"),"iframe"===t&&(r=e.upload?a:s),new r(e)}(e):new o(e)}function d(e,t,r){var n=c[e];if(n){"onload"===t&&n.result&&(r=function(e,t){t={data:t};var r=e.result.headers;return r&&(t.headers=e.req.header(r)),t}(n,r)),function(e){var t=c[e];t&&(t.req.destroy(),delete c[e])}(e);var i={type:t,result:r};u(i),i.stopped||n[t](i.result)}}function p(e,t){d(e,"onload",t)}function f(e,t){d(e,"onerror",t)}function h(e,t){var r=i.genUrlSep(e);return t=t||"",i.isObject(t)&&(t=i.object2query(t)),t&&(e+=r+t),e}function m(e,t){t=t||{};var r=i.uniqueID(),o={result:t.result,onload:t.onload||i.f,onerror:t.onerror||i.f};c[r]=o,t.onload=n(p).call(p,null,r),t.onerror=n(f).call(f,null,r),t.query&&(e=h(e,t.query));var a=t.method||"";return a&&!/get/i.test(a)||!t.data||(e=h(e,t.data),t.data=null),t.url=e,o.req=l(t),r}m.filter=function(e){i.isFunction(e)&&(u=e)},m.abort=function(e){var t=c[e];t&&t.req&&t.req.abort()},e.exports=m},function(e,t,r){var n,i=r(14),o=r(3),a=r(8),s=r(4),c=r(10),u=r(6),l=r(23),d=r(11),p=r(82).urlQuery2Object,f=r(0),h=r(33),m=r(223),g=r(461),v=r(462),y=r(463),b=r(464),S=r(465);function _(e){this.mixin(e)}_.prototype=i(function(){}.prototype,{protocol:{value:null,writable:!0,enumerable:!0,configurable:!0}}),_.prototype.setProtocol=function(e){this.protocol=e},_.prototype.mixin=function(e){var t,r,n=this;this.configMap=this.configMap||{},o(t=["idMap","cmdConfig","packetConfig"]).call(t,(function(t){n.configMap[t]=f.merge({},n.configMap[t],e.configMap&&e.configMap[t])})),o(r=["serializeMap","unserializeMap"]).call(r,(function(t){n[t]=f.merge({},n[t],e[t])}))},_.prototype.createCmd=(n=1,function(e,t){var r,i=this,s=this.configMap.cmdConfig[e],c="heartbeat"===e?0:n++;return c>32767&&(c=1,n=2),e={SID:s.sid,CID:s.cid,SER:c},s.params&&(e.Q=[],o(r=s.params).call(r,(function(r){var n=r.type,o=r.name,s=r.entity,c=t[o];if(!f.undef(c)){switch(n){case"PropertyArray":n="ArrayMable",c=a(c).call(c,(function(e){return{t:"Property",v:i.serialize(e,s)}}));break;case"Property":c=i.serialize(c,o);break;case"bool":c=c?"true":"false"}e.Q.push({t:n,v:c})}}))),e}),_.prototype.parseResponse=function(e){var t=this;return new s((function(r,n){var i=JSON.parse(e),a={raw:i,rawStr:e,error:h.genError(i.code)},d=t.configMap.packetConfig[i.sid+"_"+i.cid];if(!d)return a.notFound={sid:i.sid,cid:i.cid},void r(a);var p=i.r,m="notify"===d.service&&!d.cmd;if(a.isNotify=m,m){var g=i.r[1].headerPacket;if(d=t.configMap.packetConfig[g.sid+"_"+g.cid],p=i.r[1].body,!d)return a.notFound={sid:g.sid,cid:g.cid},void r(a)}if(a.service=d.service,a.cmd=d.cmd,a.error){var v,y,b=c(v="".concat(i.sid,"_")).call(v,i.cid);if(m&&(b=c(y="".concat(g.sid,"_")).call(y,g.cid)),a.error.cmd=a.cmd,a.error.callFunc="protocol::parseResponse: ".concat(b),416===a.error.code){var S=p[0];S&&(a.frequencyControlDuration=1e3*S)}}var _,M=!1;a.error&&d.trivialErrorCodes&&(M=-1!==u(_=d.trivialErrorCodes).call(_,a.error.code));var T=[];if((!a.error||M)&&d.response){var w;a.content={};var x=function(e,t,r,n){if(e&&"msg"===n||"sysMsg"===n){var i=r.content[n];f.isObject(i)&&!i.idServer&&(i.idServer=""+t.r[0])}};o(w=d.response).call(w,(function(e,r){var n,s=p[r];if(!f.undef(s)){var c=e.type,u=e.name,d=e.entity||u;switch(c){case"Property":T.push(t.unserialize(s,d).then(l(n=function(e,t,r,n,i){r.content[n]=i,x(e,t,r,n)}).call(n,this,m,i,a,u)));break;case"PropertyArray":a.content[u]=[],o(s).call(s,(function(e,r){var n;T.push(t.unserialize(e,d).then(l(n=function(e,t,n){e.content[t][r]=n}).call(n,this,a,u)))}));break;case"KVArray":default:a.content[u]=s,x(m,i,a,u);break;case"long":case"Long":case"byte":case"Byte":case"Number":a.content[u]=+s}}}))}s.all(T).then((function(){r(a)}))}))},_.prototype.serialize=function(e,t){var r=this.serializeMap[t],n={};for(var i in r)e.hasOwnProperty(i)&&(n[r[i]]=e[i]);return n},_.prototype.matchNosSafeUrl=function(e){if(!f.isString(e)||!~u(e).call(e,"_im_url=1"))return!1;var t=p(e);return!(!t||!t._im_url||1!=t._im_url)},_.prototype.getOneNosOriginUrl=function(e,t,r){var n=this;return new s((function(i,o){n.protocol.getNosOriginUrlReqNum++,n.protocol.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e}},(function(e,o,a){n.protocol.getNosOriginUrlReqNum--,e?n.protocol.logger.warn("error: get nos originUrl failed",e):(t["_"+r+"_safe"]=t[r],t[r]=a.nosFileUrlTag&&a.nosFileUrlTag.originUrl),i()}))}))},_.prototype.checkObjSafeUrl=function(e,t,r){var n=this;for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];if(f.isString(a)){if(this.matchNosSafeUrl(a)){var s=this.getOneNosOriginUrl(a,e,i);t.push(s),r.push(s)}}else f.isObject(a)?this.checkObjSafeUrl(a,t,r):f.isArray(a)&&o(a).call(a,(function(e){f.isObject(e)&&n.checkObjSafeUrl(e,t,r)}))}};var M=["url","avatar","fromAvatar","chatroomAvatar"];_.prototype.unserialize=function(e,t){var r=this;return new s((function(n,i){var o=r.unserializeMap[t],a={},c=[];if(e)for(var p in o){var f,h=[];if(e.hasOwnProperty(p)&&(a[o[p]]=e[p],!r.protocol.keepNosSafeUrl))if("attach"===o[p]&&e[p]&&u(e[p])&&~u(f=e[p]).call(f,"_im_url=1"))try{var m,g=JSON.parse(e[p]);g.isS3||r.checkObjSafeUrl(g,h,c),s.all(h).then(l(m=function(e,t){e.attach=d(t)}).call(m,r,a,g))}catch(e){r.logger.warn("unserialize",e&&e.message)}else~u(M).call(M,o[p])&&e[p]&&r.matchNosSafeUrl(e[p])&&c.push(r.getOneNosOriginUrl(e[p],a,o[p]))}s.all(c).then((function(e){n(a)}))}))},_.prototype.syncUnserialize=function(e,t){var r=this.unserializeMap[t],n={};if(e)for(var i in r)e.hasOwnProperty(i)&&(n[r[i]]=e[i]);return n};var T=new _({configMap:m,serializeMap:g,unserializeMap:v}),w=new _({configMap:y,serializeMap:b,unserializeMap:S});e.exports={IM:T,Chatroom:w}},function(e,t,r){var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!n.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},function(e,t,r){e.exports=r(163)},function(e,t,r){e.exports=r(174)},function(e,t,r){e.exports=r(294)},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,r){var n=r(8),i=r(5),o=r(0),a=o.notundef,s=o.fillPropertyWithDefault,c={0:"normal",1:"owner",2:"manager"};function u(e){o.verifyOptions(e,"teamId","team::TeamMember"),o.verifyParamAtLeastPresentOne(e,"nickInTeam muteTeam muteNotiType custom","team::TeamMember"),this.teamId=e.teamId,a(e.account)&&(this.account=e.account),a(e.nickInTeam)&&(this.nickInTeam=e.nickInTeam),a(e.muteNotiType)?this.bits=e.muteNotiType:a(e.muteTeam)&&(this.bits=0,e.muteTeam&&(this.bits+=1)),a(e.mute)&&(this.mute=e.mute?1:0),a(e.custom)&&(this.custom=""+e.custom)}u.reverse=function(e){var t=o.copy(e);if(a(t.teamId)&&(t.teamId=""+t.teamId),a(t.type)&&(t.type=c[t.type]),a(t.active)&&(t.active=1==+t.active),a(t.valid)&&(t.valid=1==+t.valid),a(t.mute)&&(t.mute=1==+t.mute),a(t.joinTime)&&(t.joinTime=+t.joinTime),a(t.updateTime)&&(t.updateTime=+t.updateTime),a(t.bits)){var r=t.bits;delete t.bits,t.muteTeam=!!(1&r),t.muteNotiType=r}return a(t.teamId)&&a(t.account)&&(t.id=u.genId(t.teamId,t.account)),t},u.reverseMembers=function(e){return n(e).call(e,(function(e){return i(u).call(u,e)}))},u.fillProperties=function(e){var t=s(e,"mute",!1),r=s(e,"custom","");return t||r},u.genId=function(e,t){return e+"-"+t},u.accounts2ids=function(e,t){return n(t).call(t,(function(t){return u.genId(e,t)}))},u.assembleMembers=function(e,t){return o.isArray(t)||(t=[t]),n(t).call(t,(function(t){return u.assembleMember(e,t)}))},u.assembleMember=function(e,t){return{id:u.genId(e.teamId,t),account:t,teamId:e.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0,invitorAccid:""}},u.assembleOwner=function(e){var t=u.assembleMember(e,e.owner);return t.type="owner",t},e.exports=u},function(e,t,r){var n,i=r(28),o=r(6),a=r(11),s=r(10),c=r(9),u=r(16),l=r(5),d=r(19),p=r(8),f=r(3),h=r(0),m=h.undef,g=h.notundef,v=r(110).IM,y=r(142),b=r(116),S={customP2p:100,customTeam:101,customSuperTeam:103,deleteMsgP2p:7,deleteMsgTeam:8,deleteMsgSuperTeam:12,deleteOnewayMsgP2p:13,deleteOnewayMsgTeam:14},_={0:"applyTeam",1:"rejectTeamApply",2:"teamInvite",3:"rejectTeamInvite",5:"friendRequest",6:"deleteFriend",7:"deleteMsgP2p",8:"deleteMsgTeam",12:"deleteMsgSuperTeam",13:"deleteMsgP2pOneWay",14:"deleteMsgTeamOneWay",15:"applySuperTeam",16:"rejectSuperTeamApply",17:"superTeamInvite",18:"rejectSuperTeamInvite",100:"customP2p",101:"customTeam",103:"customSuperTeam",102:"customP2p"},M={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},T=["team","superTeam","friend","msg"],w={applyTeam:"team",rejectTeamApply:"team",teamInvite:"team",rejectTeamInvite:"team",applySuperTeam:"superTeam",rejectSuperTeamApply:"superTeam",superTeamInvite:"superTeam",rejectSuperTeamInvite:"superTeam",addFriend:"friend",applyFriend:"friend",passFriendApply:"friend",rejectFriendApply:"friend",deleteFriend:"friend",deleteMsg:"msg"};function x(e){var t,r;h.verifyOptions(e,"type to","sysmsg::SystemMessage"),h.verifyParamValid("type",e.type,x.validTypes,"sysmsg::SystemMessage"),-1!==o(t=e.type).call(t,"custom")&&(h.verifyOptions(e,"content","sysmsg::SystemMessage"),this.attach=e.content,g(e.apnsText)&&(this.apnsText=""+e.apnsText),g(e.pushPayload)&&("object"===i(e.pushPayload)?this.pushPayload=a(e.pushPayload):this.pushPayload=""+e.pushPayload),g(e.sendToOnlineUsersOnly)&&(this.sendToOnlineUsersOnly=e.sendToOnlineUsersOnly?0:1),g(e.cc)&&(this.cc=e.cc?1:0),g(e.isPushable)&&(this.isPushable=e.isPushable?1:0),g(e.isUnreadable)&&(this.isUnreadable=e.isUnreadable?1:0),g(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0)),0===o(r=e.type).call(r,"deleteMsg")&&(e.apnsText&&(this.apnsText=e.apnsText),e.pushPayload&&(this.pushPayload=e.pushPayload),e.attach&&(this.attach=e.attach)),this.time=e.time||+new Date,this.type=S[e.type],this.to=e.to,g(e.from)&&(this.from=e.from),g(e.ps)&&(this.ps=e.ps),g(e.deletedIdClient)&&(this.deletedIdClient=e.deletedIdClient),g(e.deletedIdServer)&&(this.deletedIdServer=e.deletedIdServer),g(e.opeAccount)&&(this.opeAccount=e.opeAccount),g(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),g(e.antiSpamContent)&&("object"===i(e.antiSpamContent)?this.antiSpamContent=a(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),g(e.antiSpamBusinessId)&&("object"===i(e.antiSpamBusinessId)?this.antiSpamBusinessId=a(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId),g(e.env)&&(this.env=e.env),this.idClient=e.idClient||h.guid()}x.validTypes=s(n=c(S)).call(n,c(w)),x.validCategories=["team","friend"],x.isCustom=function(e){return"custom"===e.type},x.reverse=function(e){var t,r,n={time:+e.time,to:e.to,type:_[e.type]};if(g(e.from)&&(n.from=e.from),g(e.idServer)&&(n.idServer=""+e.idServer),g(e.deletedIdClient)&&(n.deletedIdClient=e.deletedIdClient),g(e.deletedIdServer)&&(n.deletedIdServer=""+e.deletedIdServer),g(e.deletedMsgTime)&&(n.deletedMsgTime=+e.deletedMsgTime),g(e.deletedMsgFromNick)&&(n.deletedMsgFromNick=""+e.deletedMsgFromNick),g(e.opeAccount)&&(n.opeAccount=e.opeAccount),g(e.ps)&&(n.ps=e.ps),g(e.callbackExt)&&(n.callbackExt=e.callbackExt),e.attach=e.attach?""+e.attach:"","customP2p"===n.type||"customTeam"===n.type||"customSuperTeam"===n.type)n.content=e.attach,g(e.apnsText)&&(n.apnsText=e.apnsText),g(e.pushPayload)&&(n.pushPayload=e.pushPayload),h.merge(n,{sendToOnlineUsersOnly:m(e.sendToOnlineUsersOnly)||0==+e.sendToOnlineUsersOnly,cc:m(e.cc)||1==+e.cc,isPushable:m(e.isPushable)||1==+e.isPushable,isUnreadable:m(e.isUnreadable)||1==+e.isUnreadable,needPushNick:g(e.needPushNick)&&1==+e.needPushNick}),n.scene=u(r=n.type).call(r,6).toLowerCase(),n.type="custom";else if(0===o(t=n.type).call(t,"deleteMsg")){e.apnsText&&(n.apnsText=e.apnsText),e.pushPayload&&(n.pushPayload=e.pushPayload),e.attach&&(n.attach=e.attach);var i=n.type.toLowerCase();o(i).call(i,"p2p")>-1?n.scene="p2p":o(i).call(i,"superteam")>-1?n.scene="superTeam":o(i).call(i,"team")>-1&&(n.scene="team"),n.type="deleteMsg"}else{if(e.attach){n.attach={};var a=JSON.parse(e.attach);g(a.vt)?(n.type=M[a.vt],a.serverex&&1===a.serverex[0]&&(n.serverex=a.serverex[1]),delete n.attach):(g(a.tinfo)&&(n.attach.team=l(y).call(y,v.syncUnserialize(a.tinfo,"team"))),g(a.tlist)&&(n.attach.member=l(b).call(b,v.syncUnserialize(a.tlist,"teamMember"))),g(a.attach)&&(n.attach.custom=a.attach))}n.category=w[n.type],n.read=!1,n.state="init"}return g(e.cc)&&(n.cc=1==+e.cc),n.status=e.status||"success",g(d(e))&&(n.filter=d(e)),n},x.reverseSysMsgs=function(e,t){var r=(t=t||{}).mapper,n=h.isFunction(r);return p(e).call(e,(function(e){return e=l(x).call(x,e),n&&(e=r(e)),e}))},x.completeUnread=function(e){var t,r;return e=e||{},f(T).call(T,(function(t){delete e[t]})),f(t=c(w)).call(t,(function(t){e[t]=e[t]||0,e[t]<0&&(e[t]=0),e[r=w[t]]=e[r]||0,e[r]=e[r]+e[t]})),e.total=0,f(T).call(T,(function(t){e.total+=e[t]})),e},e.exports=x},function(e,t,r){e.exports=r(319)},function(e,t,r){var n=r(398),i=r(196),o=r(401);e.exports=function(e,t){if(null==e)return{};var r,a,s=o(e,t);if(n){var c=n(e);for(a=0;a<c.length;a++)r=c[a],i(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(1),i=r(36),o=r(21),a=r(15),s=r(159),c=n.Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return o(t)&&a(t.prototype,c(e))}},function(e,t,r){var n=r(68),i=r(13);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(e,t,r){var n=r(39);e.exports=function(e,t){var r=e[t];return null==r?void 0:n(r)}},function(e,t,r){var n=r(69),i=r(124);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.19.2",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(1),i=r(234),o=n["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,r){var n=r(7),i=0,o=Math.random(),a=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+o,36)}},function(e,t,r){var n=r(1),i=r(27),o=n.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,r){var n=r(35),i=r(97),o=r(38),a=function(e){return function(t,r,a){var s,c=n(t),u=o(c),l=i(a,u);if(e&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,r){var n=r(239);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},function(e,t,r){var n={};n[r(18)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){var n=r(7),i=r(21),o=r(124),a=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){var n=r(1),i=r(25),o=r(21),a=r(37),s=r(101),c=r(244),u=s("IE_PROTO"),l=n.Object,d=l.prototype;e.exports=c?l.getPrototypeOf:function(e){var t=a(e);if(i(t,u))return t[u];var r=t.constructor;return o(r)&&t instanceof r?r.prototype:t instanceof l?d:null}},function(e,t,r){var n=r(7),i=r(34),o=r(246);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),t?e(r,n):r.__proto__=n,r}}():void 0)},function(e,t,r){var n=r(168),i=r(131).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(1),i=r(97),o=r(38),a=r(73),s=n.Array,c=Math.max;e.exports=function(e,t,r){for(var n=o(e),u=i(t,n),l=i(void 0===r?n:r,n),d=s(c(l-u,0)),p=0;u<l;u++,p++)a(d,p,e[u]);return d.length=p,d}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(18);t.f=n},function(e,t,r){e.exports=r(355)},function(e,t,r){var n=r(7),i=r(83),o=r(42),a=r(108),s=n("".replace),c="["+a+"]",u=RegExp("^"+c+c+"*"),l=RegExp(c+c+"*$"),d=function(e){return function(t){var r=o(i(t));return 1&e&&(r=s(r,u,"")),2&e&&(r=s(r,l,"")),r}};e.exports={start:d(1),end:d(2),trim:d(3)}},function(e,t,r){var n=r(14),i=r(24),o=r(6),a=r(3),s=r(43),c=s.f,u=r(411);function l(e){e.onload&&this.once("load",e.onload),e.onerror&&this.once("error",e.onerror),e.onbeforesend&&this.once("beforesend",e.onbeforesend),e.onaftersend&&this.once("aftersend",e.onaftersend);var t=(e=this.options=s.fetch({method:"GET",url:"",sync:!1,data:null,headers:{},cookie:!1,timeout:6e4,type:"text",form:null,input:null,putFileAtEnd:!1,proxyUrl:""},e)).headers;s.notexist(t["Content-Type"])&&(t["Content-Type"]="application/x-www-form-urlencoded"),this.send()}var d=l.prototype=n(u.prototype);d.send=function(){var e=this,t=e.options;i((function(){try{try{e.emit("beforesend",t)}catch(e){}e.doSend()}catch(t){e.onError("serverError","请求失败:"+t.message)}}),0)},d.doSend=c,d.afterSend=function(){var e=this;i((function(){e.emit("aftersend",e.options)}),0)},d.onLoad=function(e){var t,r=this.options,n=e.status,i=e.result;if("number"!=typeof n||0!==n)if(0===o(t=""+n).call(t,"2")){if("json"===r.type)try{i=JSON.parse(i)}catch(e){return void this.onError("parseError",i)}this.emit("load",i)}else this.onError("serverError","服务器返回异常状态",{status:n,result:i,date:e.date});else this.onError("netError","网络错误")},d.onError=function(e,t,r){var n=s.isObject(r)?r:{};n.code=e||"error",n.message=t||"发生错误",this.emit("error",n)},d.onTimeout=function(){this.onError("timeout","请求超时")},d.abort=function(){this.onError("abort","客户端中止")},d.header=function(e){var t=this;if(!s.isArray(e))return t.getResponseHeader(e||"");var r={};return a(e).call(e,(function(e){r[e]=t.header(e)})),r},d.getResponseHeader=c,d.destroy=c,e.exports=l},function(e,t){var r={link:{id:1,heartbeat:2,negotiateTransport:5,initTransport:6},sync:{id:5,sync:1,syncTeamMembers:2},misc:{id:6,getSimpleNosToken:1,getNosToken:2,notifyUploadLog:3,uploadSdkLogUrl:4,audioToText:5,processImage:6,getNosTokenTrans:7,notifyTransLog:8,fetchFile:9,fetchFileList:10,removeFile:11,getClientAntispam:17,fileQuickTransfer:18,getNosOriginUrl:22,getServerTime:23,getNosAccessToken:24,deleteNosAccessToken:25,getNosCdnHost:26,getGrayscaleConfig:27,getMixStorePolicy:28,getMixStoreToken:29,getBackSourceToken:30},avSignal:{id:15,signalingCreate:1,signalingDelay:2,signalingClose:3,signalingJoin:4,signalingLeave:5,signalingInvite:6,signalingCancel:7,signalingReject:8,signalingAccept:9,signalingControl:10,signalingNotify:11,signalingMutilClientSyncNotify:12,signalingUnreadMessageSyncNotify:13,signalingChannelsSyncNotify:14,signalingGetChannelInfo:15}},n={heartbeat:{sid:r.link.id,cid:r.link.heartbeat},negotiateTransport:{sid:r.link.id,cid:r.link.negotiateTransport,params:[{type:"int",name:"sdkVersion"},{type:"Property",name:"negotiateTransportTag"}]},initTransport:{sid:r.link.id,cid:r.link.initTransport,params:[{type:"Property",name:"initTransportTag"}]},getGrayscaleConfig:{sid:r.misc.id,cid:r.misc.getGrayscaleConfig,params:[{type:"Property",name:"providers"}]},getMixStorePolicy:{sid:r.misc.id,cid:r.misc.getMixStorePolicy,params:[{type:"LongArray",name:"providers"}]},getMixStoreToken:{sid:r.misc.id,cid:r.misc.getMixStoreToken,params:[{type:"Property",name:"mixTokenReq"}]},getBackSourceToken:{sid:r.misc.id,cid:r.misc.getBackSourceToken,params:[{type:"Property",name:"mixAuthTokenReq"}]},getSimpleNosToken:{sid:r.misc.id,cid:r.misc.getSimpleNosToken,params:[{type:"int",name:"num"}]},getNosToken:{sid:r.misc.id,cid:r.misc.getNosToken,params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken"}]},uploadSdkLogUrl:{sid:r.misc.id,cid:r.misc.uploadSdkLogUrl,params:[{type:"string",name:"url"}]},audioToText:{sid:r.misc.id,cid:r.misc.audioToText,params:[{type:"Property",name:"audioToText"}]},processImage:{sid:r.misc.id,cid:r.misc.processImage,params:[{type:"String",name:"url"},{type:"PropertyArray",name:"imageOps",entity:"imageOp"}]},getClientAntispam:{sid:r.misc.id,cid:r.misc.getClientAntispam,params:[{type:"Property",name:"clientAntispam"}]},fileQuickTransfer:{sid:r.misc.id,cid:r.misc.fileQuickTransfer,params:[{type:"Property",name:"fileQuickTransfer"}]},getNosOriginUrl:{sid:r.misc.id,cid:r.misc.getNosOriginUrl,params:[{type:"Property",name:"nosFileUrlTag"}]},getServerTime:{sid:r.misc.id,cid:r.misc.getServerTime,params:[]},getNosAccessToken:{sid:r.misc.id,cid:r.misc.getNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},deleteNosAccessToken:{sid:r.misc.id,cid:r.misc.deleteNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},getNosTokenTrans:{sid:r.misc.id,cid:r.misc.getNosTokenTrans,params:[{type:"Property",name:"transToken"}]},fetchFile:{sid:r.misc.id,cid:r.misc.fetchFile,params:[{type:"String",name:"docId"}]},fetchFileList:{sid:r.misc.id,cid:r.misc.fetchFileList,params:[{type:"Property",name:"fileListParam"}]},removeFile:{sid:r.misc.id,cid:r.misc.removeFile,params:[{type:"String",name:"docId"}]},getNosCdnHost:{sid:r.misc.id,cid:r.misc.getNosCdnHost,params:[]},signalingCreate:{sid:r.avSignal.id,cid:r.avSignal.signalingCreate,params:[{type:"Property",name:"avSignalTag"}]},signalingDelay:{sid:r.avSignal.id,cid:r.avSignal.signalingDelay,params:[{type:"Property",name:"avSignalTag"}]},signalingClose:{sid:r.avSignal.id,cid:r.avSignal.signalingClose,params:[{type:"Property",name:"avSignalTag"}]},signalingJoin:{sid:r.avSignal.id,cid:r.avSignal.signalingJoin,params:[{type:"Property",name:"avSignalTag"}]},signalingLeave:{sid:r.avSignal.id,cid:r.avSignal.signalingLeave,params:[{type:"Property",name:"avSignalTag"}]},signalingInvite:{sid:r.avSignal.id,cid:r.avSignal.signalingInvite,params:[{type:"Property",name:"avSignalTag"}]},signalingCancel:{sid:r.avSignal.id,cid:r.avSignal.signalingCancel,params:[{type:"Property",name:"avSignalTag"}]},signalingReject:{sid:r.avSignal.id,cid:r.avSignal.signalingReject,params:[{type:"Property",name:"avSignalTag"}]},signalingAccept:{sid:r.avSignal.id,cid:r.avSignal.signalingAccept,params:[{type:"Property",name:"avSignalTag"}]},signalingControl:{sid:r.avSignal.id,cid:r.avSignal.signalingControl,params:[{type:"Property",name:"avSignalTag"}]},signalingGetChannelInfo:{sid:r.avSignal.id,cid:r.avSignal.signalingGetChannelInfo,params:[{type:"Property",name:"avSignalTag"}]}};e.exports={idMap:r,cmdConfig:n,packetConfig:{"1_2":{service:"link",cmd:"heartbeat"},"1_5":{service:"link",cmd:"negotiateTransport",response:[{type:"Property",name:"negotiateTransportTag"}]},"1_6":{service:"link",cmd:"initTransport",response:[{type:"Property",name:"initTransportTag"}]},"6_1":{service:"misc",cmd:"getSimpleNosToken",response:[{type:"PropertyArray",name:"nosTokens",entity:"nosToken"}]},"6_2":{service:"misc",cmd:"getNosToken",response:[{type:"Property",name:"nosToken"}]},"6_3":{service:"misc",cmd:"notifyUploadLog"},"6_4":{service:"misc",cmd:"uploadSdkLogUrl"},"6_5":{service:"misc",cmd:"audioToText",response:[{type:"String",name:"text"}]},"6_6":{service:"misc",cmd:"processImage",response:[{type:"String",name:"url"}]},"6_7":{service:"misc",cmd:"getNosTokenTrans",response:[{type:"Property",name:"nosToken"},{type:"String",name:"docId"}]},"6_8":{service:"misc",cmd:"notifyTransLog",response:[{type:"Property",name:"transInfo"}]},"6_9":{service:"misc",cmd:"fetchFile",response:[{type:"Property",name:"info",entity:"transInfo"}]},"6_10":{service:"misc",cmd:"fetchFileList",response:[{type:"PropertyArray",name:"list",entity:"transInfo"},{type:"Number",name:"totalCount"}]},"6_11":{service:"misc",cmd:"removeFile",response:[{type:"String",name:"res"}]},"6_17":{service:"misc",cmd:"getClientAntispam",response:[{type:"Property",name:"clientAntispam"}]},"6_18":{service:"misc",cmd:"fileQuickTransfer",response:[{type:"Property",name:"fileQuickTransfer"}]},"6_22":{service:"misc",cmd:"getNosOriginUrl",response:[{type:"Property",name:"nosFileUrlTag"}]},"6_23":{service:"misc",cmd:"getServerTime",response:[{type:"Number",name:"time"}]},"6_24":{service:"misc",cmd:"getNosAccessToken",response:[{type:"Property",name:"nosAccessTokenTag"}]},"6_25":{service:"misc",cmd:"deleteNosAccessToken"},"6_26":{service:"misc",cmd:"getNosCdnHost",response:[{type:"Property",name:"nosConfigTag"}]},"6_27":{service:"misc",cmd:"getGrayscaleConfig",response:[{type:"Property",name:"appGrayConfigTag"}]},"6_28":{service:"misc",cmd:"getMixStorePolicy",response:[{type:"Property",name:"mixStorePolicyTag"}]},"6_29":{service:"misc",cmd:"getMixStoreToken",response:[{type:"Property",name:"mixStoreTokenTag"}]},"6_30":{service:"misc",cmd:"getBackSourceToken",response:[{type:"Property",name:"backSourceTokenTag"}]},"15_1":{service:"avSignal",cmd:"signalingCreate",response:[{type:"Property",name:"avSignalTag"}]},"15_2":{service:"avSignal",cmd:"signalingDelay",response:[{type:"Property",name:"avSignalTag"}]},"15_3":{service:"avSignal",cmd:"signalingClose",response:[{type:"Property",name:"avSignalTag"}]},"15_4":{service:"avSignal",cmd:"signalingJoin",response:[{type:"Property",name:"avSignalTag"}]},"15_5":{service:"avSignal",cmd:"signalingLeave",response:[]},"15_6":{service:"avSignal",cmd:"signalingInvite",response:[]},"15_7":{service:"avSignal",cmd:"signalingCancel",response:[]},"15_8":{service:"avSignal",cmd:"signalingReject",response:[]},"15_9":{service:"avSignal",cmd:"signalingAccept",response:[]},"15_10":{service:"avSignal",cmd:"signalingControl",response:[]},"15_11":{service:"avSignal",cmd:"signalingNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_12":{service:"avSignal",cmd:"signalingMutilClientSyncNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_13":{service:"avSignal",cmd:"signalingUnreadMessageSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_14":{service:"avSignal",cmd:"signalingChannelsSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_15":{service:"avSignal",cmd:"signalingGetChannelInfo",response:[{type:"Property",name:"avSignalTag"}]}}}},function(e,t,r){var n=r(9),i=r(3),o=r(23),a=r(0),s=a.notundef,c=a.fillPropertyWithDefault,u=n,l={},d={},p=[],f={},h={normal:0,advanced:1},m={0:"normal",1:"advanced"},g=u(h),v=l.joinMode={noVerify:0,needVerify:1,rejectAll:2};d.joinMode={0:"noVerify",1:"needVerify",2:"rejectAll"},p.push("join"),f.joinMode=u(v);var y=l.beInviteMode={needVerify:0,noVerify:1};d.beInviteMode={0:"needVerify",1:"noVerify"},p.push("beInvite"),f.beInviteMode=u(y);var b=l.inviteMode={manager:0,all:1};d.inviteMode={0:"manager",1:"all"},p.push("invite"),f.inviteMode=u(b);var S=l.updateTeamMode={manager:0,all:1};d.updateTeamMode={0:"manager",1:"all"},p.push("updateTeam"),f.updateTeamMode=u(S);var _=l.updateCustomMode={manager:0,all:1};function M(e){var t;switch(a.verifyOptions(e,"action","team::Team"),e.action){case"create":a.verifyOptions(e,"teamId",!1,"team::Team"),a.verifyOptions(e,"type name","team::Team"),a.verifyParamValid("type",e.type,g,"team::Team"),s(e.level)&&(a.verifyParamType("level",e.level,"number","team::Team"),this.level=e.level);break;case"update":a.verifyOptions(e,"teamId","team::Team"),a.verifyOptions(e,"type",!1,"team::Team")}s(e.teamId)&&(this.teamId=e.teamId),s(e.type)&&(this.type=h[e.type]),s(e.avatar)&&(this.avatar=""+e.avatar),s(e.name)&&(this.name=""+e.name),s(e.intro)&&(this.intro=""+e.intro),s(e.announcement)&&(this.announcement=""+e.announcement),i(p).call(p,o(t=this.setMode).call(t,this,e)),s(e.custom)&&(this.custom=""+e.custom)}function T(e,t){s(e[t+="Mode"])&&(e[t]=d[t][e[t]])}d.updateCustomMode={0:"manager",1:"all"},p.push("updateCustom"),f.updateCustomMode=u(_),M.prototype.setMode=function(e,t){s(e[t+="Mode"])&&(a.verifyParamValid(t,e[t],f[t],"team::Team"),this[t]=l[t][e[t]])},M.reverse=function(e,t){var r=a.copy(e);if(s(r.teamId)&&(r.teamId=""+r.teamId),s(r.type)&&(r.type=m[r.type]),s(r.level)&&(r.level=+r.level),s(r.valid)&&(r.valid=1==+r.valid),s(r.memberNum)&&(r.memberNum=+r.memberNum),s(r.memberUpdateTime)&&(r.memberUpdateTime=+r.memberUpdateTime),s(r.createTime)&&(r.createTime=+r.createTime),s(r.updateTime)&&(r.updateTime=+r.updateTime),s(r.validToCurrentUser)&&(r.validToCurrentUser="1"===r.validToCurrentUser),s(r.mute)&&(r.mute="1"===r.mute),s(r.muteType))switch(r.muteType){case"0":r.mute=!1,r.muteType="none";break;case"1":r.mute=!0,r.muteType="normal";break;case"3":r.mute=!0,r.muteType="all"}else s(r.mute)&&(1===r.mute?(r.mute=!0,r.muteType="normal"):(r.mute=!1,r.muteType="none"));return i(p).call(p,o(T).call(T,null,r)),delete r.bits,t||M.fillProperties(r),r},M.fillProperties=function(e){var t=c(e,"beInviteMode","needVerify"),r=c(e,"inviteMode","manager"),n=c(e,"updateTeamMode","manager"),i=c(e,"updateCustomMode","manager"),o=c(e,"avatar","");return t||r||n||i||o},e.exports=M},function(e,t,r){var n=r(40).clientTypeMap;function i(){}i.reverse=function(e){var t=e;return t.type=n[t.type],t},i.reverseType=function(e){return n[e]||e},e.exports=i},function(e,t,r){var n=r(0);function i(){}i.parse=function(e){var t=e.split("|");return{scene:t[0],to:t[1]}},i.genSessionByMsg=function(e){return{id:e.sessionId,scene:e.scene,to:e.target,updateTime:e.time,lastMsg:e}},i.appendLastMsg=function(e){var t=e.lastMsg;e["last"+n.capFirstLetter(t.type)+"Msg"]=t,e["last"+n.capFirstLetter(t.flow)+"Msg"]=t},i.genSessionByMsgs=function(e,t){var r=e.getLastNotIgnoredMsg(t);return r?i.genSessionByMsg(r):null},i.trim=function(e){delete e.msgReceiptSendTime,delete e.msgReceiptServerTime,delete e.ack,delete e.unreadMsgs,e.isDeleted||delete e.isDeleted},i.isComplete=function(e){return e.id&&e.scene&&e.to},e.exports=i},function(e,t,r){var n=r(477);e.exports=Function.prototype.bind||n},function(e,t,r){var n=Function.prototype.toString,i=/^\s*class\b/,o=function(e){try{var t=n.call(e);return i.test(t)}catch(e){return!1}},a=Object.prototype.toString,s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(s)return function(e){try{return!o(e)&&(n.call(e),!0)}catch(e){return!1}}(e);if(o(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},function(e,t,r){var n=r(14),i=r(23),o=r(8),a=r(16),s=r(5),c=r(64),u=r(0),l=u.undef,d=u.notundef,p=r(17),f=r(110),h=r(493),m=r(225);function g(e){u.verifyOptions(e,"appKey account chatroomId chatroomAddresses","protocol::ChatroomProtocol"),e.isAnonymous||u.verifyOptions(e,"token","protocol::ChatroomProtocol"),u.verifyParamType("chatroomAddresses",e.chatroomAddresses,"array","protocol::ChatroomProtocol"),u.verifyCallback(e,"onconnect onerror onwillreconnect ondisconnect onmsg onmsgs onrobots","protocol::ChatroomProtocol"),c.call(this,e)}var v=c.fn,y=g.fn=g.prototype=n(v);y.init=function(){var e;v.init.call(this),f.Chatroom.setProtocol(this),this.parser=f.Chatroom,i(e=this.sendCmd).call(e,this),this.syncResult={},this.timetags={},this.msgBuffer=[]},y.reset=function(){var e=this;v.reset.call(e);var t,r,n=e.options;l(n.msgBufferInterval)&&(n.msgBufferInterval=300),u.verifyParamType("msgBufferInterval",n.msgBufferInterval,"number","protocol::ChatroomProtocol.reset"),l(n.msgBufferSize)&&(n.msgBufferSize=500),u.verifyParamType("msgBufferSize",n.msgBufferSize,"number","protocol::ChatroomProtocol.reset"),d(n.chatroomAddresses)&&(e.socketUrls=o(t=n.chatroomAddresses).call(t,(function(t){return p.formatSocketUrl({url:t,secure:e.options.secure})})),e.socketUrlsBackup=a(r=e.socketUrls).call(r,0))},y.processChatroom=function(e){switch(e.cmd){case"login":e.error||(e.obj={chatroom:s(h).call(h,e.content.chatroom),member:s(m).call(m,e.content.chatroomMember)},this.cdnInfo={},this.initCdnData(),clearTimeout(this.queryCdnTimer),this.onCdnMsgInfo(e.content.chatroomCdnInfo));break;case"kicked":this.onKicked(e);break;case"logout":case"closeChatroom":case"updateChatroom":case"kickChatroomMember":case"updateChatroomMemberTempMute":break;case"sendMsg":this.onSendMsg(e);break;case"msg":this.onMsg(e),this.cdnInfo&&this.cdnInfo.enable&&this.correctCdnTime(+e.content.msg.time);break;case"getChatroomMembers":case"getChatroomMembersByTag":this.onChatroomMembers(e);break;case"getChatroomMemberCountByTag":this.onGetChatroomMemberCountByTag(e);break;case"getHistoryMsgs":this.onHistoryMsgs(e);break;case"markChatroomMember":this.onMarkChatroomMember(e);break;case"getChatroom":this.onChatroom(e);break;case"updateMyChatroomMemberInfo":delete e.obj.chatroomMember;break;case"getChatroomMembersInfo":this.onChatroomMembersInfo(e);break;case"queueList":e.error||(e.obj=e.content);break;case"syncRobot":this.onSyncRobot(e);break;case"notifyCdnInfo":this.onCdnMsgInfo(e.content&&e.content.chatroomCdnInfo)}},y.onChatroom=function(e){e.error||(e.obj.chatroom=s(h).call(h,e.content.chatroom))},e.exports=g,r(593),r(594),r(595),r(604)},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){for(var r=t.split(".");r.length;){var n=r.shift(),i=!1;if("?"==n[n.length-1]&&(n=n.slice(0,-1),i=!0),!(e=e[n])&&i)return e}return e}},function(e,t,r){var n=r(368),i=r(370),o=r(194),a=r(374);e.exports=function(e){return n(e)||i(e)||o(e)||a()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(395),i=r(396),o=r(194),a=r(397);e.exports=function(e,t){return n(e)||i(e,t)||o(e,t)||a()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(8),i=r(5),o=r(0),a=o.notundef,s=o.fillPropertyWithDefault,c={0:"normal",1:"owner",2:"manager"};function u(e){o.verifyOptions(e,"teamId","superTeam::TeamMember"),o.verifyParamAtLeastPresentOne(e,"nickInTeam muteTeam custom","superTeam::SuperTeamMember"),this.teamId=e.teamId,a(e.account)&&(this.account=e.account),a(e.nickInTeam)&&(this.nickInTeam=e.nickInTeam),a(e.muteTeam)&&(this.bits=0,e.muteTeam&&(this.bits+=1)),a(e.mute)&&(this.mute=e.mute?1:0),a(e.custom)&&(this.custom=""+e.custom)}u.reverse=function(e){var t=o.copy(e);if(a(t.teamId)&&(t.teamId=""+t.teamId),a(t.type)&&(t.type=c[t.type]),a(t.active)&&(t.active=1==+t.active),a(t.valid)&&(t.valid=1==+t.valid),a(t.mute)&&(t.mute=1==+t.mute),a(t.joinTime)&&(t.joinTime=+t.joinTime),a(t.updateTime)&&(t.updateTime=+t.updateTime),a(t.bits)){var r=t.bits;delete t.bits,t.muteTeam=!!(1&r)}return a(t.teamId)&&a(t.account)&&(t.id=u.genId(t.teamId,t.account)),t},u.reverseMembers=function(e){return n(e).call(e,(function(e){return i(u).call(u,e)}))},u.fillProperties=function(e){var t=s(e,"mute",!1),r=s(e,"custom","");return t||r},u.genId=function(e,t){return e+"-"+t},u.accounts2ids=function(e,t){return n(t).call(t,(function(t){return u.genId(e,t)}))},u.assembleMembers=function(e,t){return o.isArray(t)||(t=[t]),n(t).call(t,(function(t){return u.assembleMember(e,t)}))},u.assembleMember=function(e,t){return{id:u.genId(e.teamId,t),account:t,teamId:e.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}},u.assembleOwner=function(e){var t=u.assembleMember(e,e.owner);return t.type="owner",t},e.exports=u},function(e,t,r){e.exports=r(451)},function(e,t,r){var n=r(8),i=r(5),o=r(9),a=r(82).genPrivateUrl,s=r(0),c={unknown:0,male:1,female:2},u={0:"unknown",1:"male",2:"female"};function l(e){s.merge(this,e),s.notundef(this.gender)&&(s.verifyParamValid("gender",this.gender,l.validGenders,"user::User"),this.gender=c[this.gender]),s.notundef(this.email)&&""!==this.email&&s.verifyEmail("email",this.email,"user::User"),s.notundef(this.birth)&&""!==this.birth&&s.verifyBirth("birth",this.birth,"user::User"),s.notundef(this.tel)&&""!==this.tel&&s.verifyTel("tel",this.tel,"user::User")}l.reverse=function(e,t,r){var n=s.filterObj(e,"account nick avatar _avatar_safe sign gender email birth tel custom createTime updateTime");return s.notundef(n.avatar)&&(n.avatar=a(n.avatar,t,r)),s.notundef(n.gender)&&(n.gender=u[n.gender]),s.notundef(n.createTime)&&(n.createTime=+n.createTime),s.notundef(n.updateTime)&&(n.updateTime=+n.updateTime),n},l.reverseUsers=function(e){return n(e).call(e,(function(e){return i(l).call(l,e)}))},l.validGenders=o(c),e.exports=l},function(e,t,r){var n=r(11),i=r(14),o=r(5),a=r(6),s=r(82).genPrivateUrl,c=r(81),u=r(0),l=r(17);function d(e){switch(u.notundef(e.type)?u.verifyFileType(e.type,"msg::FileMessage"):e.type="file",u.verifyOptions(e,"file","msg::FileMessage"),u.verifyOptions(e.file,"url ext size",!0,"file.","msg::FileMessage"),e.type){case"image":p.verifyFile(e.file,"msg::FileMessage");break;case"audio":f.verifyFile(e.file,"msg::FileMessage");break;case"video":h.verifyFile(e.file,"msg::FileMessage")}c.call(this,e),this.attach=n(e.file)}d.prototype=i(c.prototype),d.reverse=function(e){var t,r,n=o(c).call(c,e);return e.attach=e.attach?""+e.attach:"",n.file=e.attach?JSON.parse(e.attach):{},n.file.isS3||(n.file.url=s(n.file.url)),"audio"!==n.type||n.file.mp3Url||(n.file.mp3Url=n.file.url+(~a(r=n.file.url).call(r,"?")?"&":"?")+"audioTrans&type=mp3"),l.httpsEnabled&&0!==a(t=n.file.url).call(t,"https://")&&(n.file.url=n.file.url.replace("http","https")),n},e.exports=d;var p=r(557),f=r(558),h=r(559)},function(e,t,r){var n=r(14),i=r(48),o=r(11),a=r(44),s=r(147),c=r(17),u=r(493),l=r(605),d=r(0),p=d.verifyOptions,f=d.verifyParamType,h=r(110).Chatroom;function m(e){return this.subType="chatroom",this.nosScene=e.nosScene||"chatroom",this.nosSurvivalTime=e.nosSurvivalTime,e.Protocol=s,e.Message=l,e.constructor=m,e.isAnonymous&&(e.account=e.account||"nimanon_".concat(d.guid()),e.isAnonymous=1,d.verifyOptions(e,"chatroomNick","api::Chatroom"),e.chatroomAvatar=e.chatroomAvatar||" "),this.init(e)}m.Protocol=s,m.parser=h,m.use=a.use,m.getInstance=function(e){return e.isAnonymous&&(e.account=e.account||"nimanon_".concat(d.guid()),e.isAnonymous=1,d.verifyOptions(e,"chatroomNick","api::Chatroom.getInstance"),e.chatroomAvatar=e.chatroomAvatar||" "),a.getInstance.call(this,e)},m.genInstanceName=function(e){return d.verifyOptions(e,"chatroomId","api::Chatroom.genInstanceName"),"Chatroom-account-"+e.account+"-chatroomId-"+e.chatroomId};var g=m.fn=m.prototype=n(a.prototype);m.info=g.info=c.info,g.getChatroom=function(e){this.processCallback(e),this.sendCmd("getChatroom",e)},g.updateChatroom=function(e){p(e,"chatroom needNotify","api::updateChatroom"),f("needNotify",e.needNotify,"boolean"),this.processCustom(e),this.processCallback(e),e.chatroom=new u(e.chatroom),e.antispamTag={antiSpamBusinessId:e.antiSpamBusinessId},this.sendCmd("updateChatroom",e)},g.closeChatroom=function(e){this.processCustom(e),this.processCallback(e),this.sendCmd("closeChatroom",e)},g.updateTags=function(e){d.validate({tags:{type:"array",required:!1},notifyTargetTags:{type:"string",allowEmpty:!0,required:!1},needNotify:{type:"boolean",required:!1}},e,"chatroom::updateTags");var t=i({},e);this.processCallback(t),t.tags&&(t.tags=o(t.tags)),t.needNotify&&(t.needNotify=t.needNotify?1:0),this.sendCmd("updateChatroomTags",{chatRoomTagsUpdateTag:t},t.done)},e.exports=m,r(615),r(616),r(617)},function(e,t,r){var n=r(11),i=r(14),o=r(5),a=r(6),s=r(82).genPrivateUrl,c=r(90),u=r(0),l=r(17);function d(e){switch(u.notundef(e.type)?u.verifyFileType(e.type,"msg::FileMessage"):e.type="file",u.verifyOptions(e,"file","msg::FileMessage"),u.verifyOptions(e.file,"url ext size",!0,"file.","msg::FileMessage"),e.type){case"image":p.verifyFile(e.file,"msg::FileMessage");break;case"audio":f.verifyFile(e.file,"msg::FileMessage");break;case"video":h.verifyFile(e.file,"msg::FileMessage")}c.call(this,e),this.attach=n(e.file)}d.prototype=i(c.prototype),d.reverse=function(e){var t,r,n=o(c).call(c,e);return e.attach=e.attach?""+e.attach:"",n.file=e.attach?JSON.parse(e.attach):{},n.file.url=s(n.file.url),"audio"!==n.type||n.file.mp3Url||(n.file.mp3Url=n.file.url+(~a(r=n.file.url).call(r,"?")?"&":"?")+"audioTrans&type=mp3"),l.httpsEnabled&&0!==a(t=n.file.url).call(t,"https://")&&(n.file.url=n.file.url.replace("http","https")),n},e.exports=d;var p=r(607),f=r(608),h=r(609)},function(e,t,r){var n=r(229);e.exports=n},function(e,t,r){var n=r(121);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n=r(26),i=r(13),o=r(126);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(13),i=r(21),o=/#|\.prototype\./,a=function(e,t){var r=c[s(e)];return r==l||r!=u&&(i(t)?n(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=a.data={},u=a.NATIVE="N",l=a.POLYFILL="P";e.exports=a},function(e,t,r){var n=r(2),i=r(1),o=r(13),a=r(72),s=r(27),c=r(37),u=r(38),l=r(73),d=r(128),p=r(85),f=r(18),h=r(68),m=f("isConcatSpreadable"),g=i.TypeError,v=h>=51||!o((function(){var e=[];return e[m]=!1,e.concat()[0]!==e})),y=p("concat"),b=function(e){if(!s(e))return!1;var t=e[m];return void 0!==t?!!t:a(e)};n({target:"Array",proto:!0,forced:!v||!y},{concat:function(e){var t,r,n,i,o,a=c(this),s=d(a,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(b(o=-1===t?a:arguments[t])){if(p+(i=u(o))>9007199254740991)throw g("Maximum allowed index exceeded");for(r=0;r<i;r++,p++)r in o&&l(s,p,o[r])}else{if(p>=9007199254740991)throw g("Maximum allowed index exceeded");l(s,p++,o)}return s.length=p,s}})},function(e,t,r){var n=r(240);e.exports=n},function(e,t,r){var n=r(2),i=r(31),o=r(69),a=r(165),s=r(21),c=r(243),u=r(132),l=r(133),d=r(87),p=r(46),f=r(74),h=r(18),m=r(75),g=r(166),v=a.PROPER,y=a.CONFIGURABLE,b=g.IteratorPrototype,S=g.BUGGY_SAFARI_ITERATORS,_=h("iterator"),M=function(){return this};e.exports=function(e,t,r,a,h,g,T){c(r,t,a);var w,x,I,E=function(e){if(e===h&&N)return N;if(!S&&e in k)return k[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},A=t+" Iterator",C=!1,k=e.prototype,O=k[_]||k["@@iterator"]||h&&k[h],N=!S&&O||E(h),R="Array"==t&&k.entries||O;if(R&&(w=u(R.call(new e)))!==Object.prototype&&w.next&&(o||u(w)===b||(l?l(w,b):s(w[_])||f(w,_,M)),d(w,A,!0,!0),o&&(m[A]=M)),v&&"values"==h&&O&&"values"!==O.name&&(!o&&y?p(k,"name","values"):(C=!0,N=function(){return i(O,this)})),h)if(x={values:E("values"),keys:g?N:E("keys"),entries:E("entries")},T)for(I in x)!S&&!C&&I in k||f(k,I,x[I]);else n({target:t,proto:!0,forced:S||C},x);return o&&!T||k[_]===N||f(k,_,N,{name:h}),m[t]=N,x}},function(e,t,r){var n=r(26),i=r(25),o=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,s=i(o,"name"),c=s&&"something"===function(){}.name,u=s&&(!n||n&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:c,CONFIGURABLE:u}},function(e,t,r){var n,i,o,a=r(13),s=r(21),c=r(86),u=r(132),l=r(74),d=r(18),p=r(69),f=d("iterator"),h=!1;[].keys&&("next"in(o=[].keys())?(i=u(u(o)))!==Object.prototype&&(n=i):h=!0),null==n||a((function(){var e={};return n[f].call(e)!==e}))?n={}:p&&(n=c(n)),s(n[f])||l(n,f,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:h}},function(e,t,r){var n=r(26),i=r(41),o=r(34),a=r(35),s=r(91);e.exports=n?Object.defineProperties:function(e,t){o(e);for(var r,n=a(t),c=s(t),u=c.length,l=0;u>l;)i.f(e,r=c[l++],n[r]);return e}},function(e,t,r){var n=r(7),i=r(25),o=r(35),a=r(127).indexOf,s=r(102),c=n([].push);e.exports=function(e,t){var r,n=o(e),u=0,l=[];for(r in n)!i(s,r)&&i(n,r)&&c(l,r);for(;t.length>u;)i(n,r=t[u++])&&(~a(l,r)||c(l,r));return l}},function(e,t,r){var n=r(36);e.exports=n("document","documentElement")},function(e,t,r){var n=r(31),i=r(34),o=r(122);e.exports=function(e,t,r){var a,s;i(e);try{if(!(a=o(e,"return"))){if("throw"===t)throw r;return r}a=n(a,e)}catch(e){s=!0,a=e}if("throw"===t)throw r;if(s)throw a;return i(a),r}},function(e,t,r){var n=r(18),i=r(75),o=n("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[o]===e)}},function(e,t,r){var n=r(1),i=r(31),o=r(39),a=r(34),s=r(96),c=r(103),u=n.TypeError;e.exports=function(e,t){var r=arguments.length<2?c(e):t;if(o(r))return a(i(r,e));throw u(s(e)+" is not iterable")}},function(e,t,r){var n=r(18)("iterator"),i=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){i=!0}};a[n]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},function(e,t,r){var n=r(250);r(58),e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(36),a=r(56),s=r(31),c=r(7),u=r(69),l=r(26),d=r(121),p=r(13),f=r(25),h=r(72),m=r(21),g=r(27),v=r(15),y=r(120),b=r(34),S=r(37),_=r(35),M=r(95),T=r(42),w=r(57),x=r(86),I=r(91),E=r(134),A=r(176),C=r(136),k=r(66),O=r(41),N=r(111),R=r(89),P=r(74),D=r(123),j=r(101),L=r(102),z=r(125),U=r(18),B=r(137),F=r(20),V=r(87),H=r(100),$=r(79).forEach,W=j("hidden"),Y=U("toPrimitive"),G=H.set,Q=H.getterFor("Symbol"),q=Object.prototype,J=i.Symbol,Z=J&&J.prototype,K=i.TypeError,X=i.QObject,ee=o("JSON","stringify"),te=k.f,re=O.f,ne=A.f,ie=N.f,oe=c([].push),ae=D("symbols"),se=D("op-symbols"),ce=D("string-to-symbol-registry"),ue=D("symbol-to-string-registry"),le=D("wks"),de=!X||!X.prototype||!X.prototype.findChild,pe=l&&p((function(){return 7!=x(re({},"a",{get:function(){return re(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=te(q,t);n&&delete q[t],re(e,t,r),n&&e!==q&&re(q,t,n)}:re,fe=function(e,t){var r=ae[e]=x(Z);return G(r,{type:"Symbol",tag:e,description:t}),l||(r.description=t),r},he=function(e,t,r){e===q&&he(se,t,r),b(e);var n=M(t);return b(r),f(ae,n)?(r.enumerable?(f(e,W)&&e[W][n]&&(e[W][n]=!1),r=x(r,{enumerable:w(0,!1)})):(f(e,W)||re(e,W,w(1,{})),e[W][n]=!0),pe(e,n,r)):re(e,n,r)},me=function(e,t){b(e);var r=_(t),n=I(r).concat(be(r));return $(n,(function(t){l&&!s(ge,r,t)||he(e,t,r[t])})),e},ge=function(e){var t=M(e),r=s(ie,this,t);return!(this===q&&f(ae,t)&&!f(se,t))&&(!(r||!f(this,t)||!f(ae,t)||f(this,W)&&this[W][t])||r)},ve=function(e,t){var r=_(e),n=M(t);if(r!==q||!f(ae,n)||f(se,n)){var i=te(r,n);return!i||!f(ae,n)||f(r,W)&&r[W][n]||(i.enumerable=!0),i}},ye=function(e){var t=ne(_(e)),r=[];return $(t,(function(e){f(ae,e)||f(L,e)||oe(r,e)})),r},be=function(e){var t=e===q,r=ne(t?se:_(e)),n=[];return $(r,(function(e){!f(ae,e)||t&&!f(q,e)||oe(n,ae[e])})),n};if(d||(P(Z=(J=function(){if(v(Z,this))throw K("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?T(arguments[0]):void 0,t=z(e),r=function(e){this===q&&s(r,se,e),f(this,W)&&f(this[W],t)&&(this[W][t]=!1),pe(this,t,w(1,e))};return l&&de&&pe(q,t,{configurable:!0,set:r}),fe(t,e)}).prototype,"toString",(function(){return Q(this).tag})),P(J,"withoutSetter",(function(e){return fe(z(e),e)})),N.f=ge,O.f=he,k.f=ve,E.f=A.f=ye,C.f=be,B.f=function(e){return fe(U(e),e)},l&&(re(Z,"description",{configurable:!0,get:function(){return Q(this).description}}),u||P(q,"propertyIsEnumerable",ge,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:J}),$(I(le),(function(e){F(e)})),n({target:"Symbol",stat:!0,forced:!d},{for:function(e){var t=T(e);if(f(ce,t))return ce[t];var r=J(t);return ce[t]=r,ue[r]=t,r},keyFor:function(e){if(!y(e))throw K(e+" is not a symbol");if(f(ue,e))return ue[e]},useSetter:function(){de=!0},useSimple:function(){de=!1}}),n({target:"Object",stat:!0,forced:!d,sham:!l},{create:function(e,t){return void 0===t?x(e):me(x(e),t)},defineProperty:he,defineProperties:me,getOwnPropertyDescriptor:ve}),n({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:ye,getOwnPropertySymbols:be}),n({target:"Object",stat:!0,forced:p((function(){C.f(1)}))},{getOwnPropertySymbols:function(e){return C.f(S(e))}}),ee&&n({target:"JSON",stat:!0,forced:!d||p((function(){var e=J();return"[null]"!=ee([e])||"{}"!=ee({a:e})||"{}"!=ee(Object(e))}))},{stringify:function(e,t,r){var n=R(arguments),i=t;if((g(t)||void 0!==e)&&!y(e))return h(t)||(t=function(e,t){if(m(i)&&(t=s(i,this,e,t)),!y(t))return t}),n[1]=t,a(ee,null,n)}}),!Z[Y]){var Se=Z.valueOf;P(Z,Y,(function(e){return s(Se,this)}))}V(J,"Symbol"),L[W]=!0},function(e,t,r){var n=r(67),i=r(35),o=r(134).f,a=r(135),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"Window"==n(e)?function(e){try{return o(e)}catch(e){return a(s)}}(e):o(i(e))}},function(e,t,r){r(20)("iterator")},function(e,t,r){var n=r(271);e.exports=n},function(e,t,r){var n=r(36),i=r(7),o=r(134),a=r(136),s=r(34),c=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?c(t,r(e)):t}},function(e,t,r){var n=r(281);e.exports=n},function(e,t,r){var n=r(289);e.exports=n},function(e,t,r){var n=r(292);e.exports=n},function(e,t,r){var n=r(310);e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(56),a=r(21),s=r(45),c=r(89),u=/MSIE .\./.test(s),l=i.Function,d=function(e){return function(t,r){var n=arguments.length>2,i=n?c(arguments,2):void 0;return e(n?function(){o(a(t)?t:l(t),this,i)}:t,r)}};n({global:!0,bind:!0,forced:u},{setTimeout:d(i.setTimeout),setInterval:d(i.setInterval)})},function(e,t,r){var n=r(1);e.exports=n.Promise},function(e,t,r){var n=r(34),i=r(348),o=r(18)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||null==(r=n(a)[o])?t:i(r)}},function(e,t,r){var n,i,o,a,s=r(1),c=r(56),u=r(70),l=r(21),d=r(25),p=r(13),f=r(169),h=r(89),m=r(126),g=r(188),v=r(105),y=s.setImmediate,b=s.clearImmediate,S=s.process,_=s.Dispatch,M=s.Function,T=s.MessageChannel,w=s.String,x=0,I={};try{n=s.location}catch(e){}var E=function(e){if(d(I,e)){var t=I[e];delete I[e],t()}},A=function(e){return function(){E(e)}},C=function(e){E(e.data)},k=function(e){s.postMessage(w(e),n.protocol+"//"+n.host)};y&&b||(y=function(e){var t=h(arguments,1);return I[++x]=function(){c(l(e)?e:M(e),void 0,t)},i(x),x},b=function(e){delete I[e]},v?i=function(e){S.nextTick(A(e))}:_&&_.now?i=function(e){_.now(A(e))}:T&&!g?(a=(o=new T).port2,o.port1.onmessage=C,i=u(a.postMessage,a)):s.addEventListener&&l(s.postMessage)&&!s.importScripts&&n&&"file:"!==n.protocol&&!p(k)?(i=k,s.addEventListener("message",C,!1)):i="onreadystatechange"in m("script")?function(e){f.appendChild(m("script")).onreadystatechange=function(){f.removeChild(this),E(e)}}:function(e){setTimeout(A(e),0)}),e.exports={set:y,clear:b}},function(e,t,r){var n=r(45);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},function(e,t,r){var n=r(34),i=r(27),o=r(92);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t){e.exports=function e(t,r){var n,i,o=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,a=/(^[ ]*|[ ]*$)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,u=/^0/,l=function(t){return e.insensitive&&(""+t).toLowerCase()||""+t},d=l(t).replace(a,"")||"",p=l(r).replace(a,"")||"",f=d.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=p.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=parseInt(d.match(c),16)||1!==f.length&&d.match(s)&&Date.parse(d),g=parseInt(p.match(c),16)||m&&p.match(s)&&Date.parse(p)||null;if(g){if(m<g)return-1;if(m>g)return 1}for(var v=0,y=Math.max(f.length,h.length);v<y;v++){if(n=!(f[v]||"").match(u)&&parseFloat(f[v])||f[v]||0,i=!(h[v]||"").match(u)&&parseFloat(h[v])||h[v]||0,isNaN(n)!==isNaN(i))return isNaN(n)?1:-1;if(typeof n!=typeof i&&(n+="",i+=""),n<i)return-1;if(n>i)return 1}return 0}},function(e,t,r){e.exports=r(369)},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(371)},function(e,t,r){var n=r(372),i=r(193),o=r(192);e.exports=function(e,t){var r;if(e){if("string"==typeof e)return o(e,t);var a=n(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?i(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(6),i=r(77),o=r(3),a=r(11),s=r(16),c=r(10),u=r(4),l=r(53),d=r(0),p=r(17),f=r(40),h=r(392);function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d.merge(this,{options:e,debug:!1,api:"log",style:"color:blue;",log:d.emptyFunc,info:d.emptyFunc,warn:d.emptyFunc,error:d.emptyFunc}),this.prefix=e.prefix||"",this.localEnable=h.enable&&e.dbLog&&e.account,this.setDebug(e.debug),this.localEnable&&(this._local=new h(e.account,e.expire),this._local.logError=this.error)}var g=m.prototype,v=["Chrome","Safari","Firefox"];g.setDebug=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;if(t.debug=e,e.style&&(t.style=e.style),d.exist(console))if(t.debug){var r=console;t.debug=function(){var e=t.formatArgsAndSave(arguments,"debug");-1!==n(v).call(v,l.name)&&d.isString(e[0])&&(e[0]="%c"+e[0],i(e).call(e,1,0,t.style)),t._log("debug",e)},t.log=function(){var e=t.formatArgsAndSave(arguments,"log");-1!==n(v).call(v,l.name)&&d.isString(e[0])&&(e[0]="%c"+e[0],i(e).call(e,1,0,t.style)),t._log("log",e)},t.info=function(){var e=t.formatArgsAndSave(arguments,"info");-1!==n(v).call(v,l.name)&&d.isString(e[0])&&(e[0]="%c"+e[0],i(e).call(e,1,0,t.style)),t._log("info",e)},t.warn=function(){var e=t.formatArgsAndSave(arguments,"warn");-1!==n(v).call(v,l.name)&&d.isString(e[0])&&(e[0]="%c"+e[0],i(e).call(e,1,0,t.style)),t._log("warn",e)},t.error=function(){var e=t.formatArgsAndSave(arguments,"error");-1!==n(v).call(v,l.name)&&d.isString(e[0])&&(e[0]="%c"+e[0],i(e).call(e,1,0,t.style)),t._log("error",e)},t.options.logFunc?t._log=function(){}:t._log=function(e,n){if(r[e])try{r[e].apply?t.chrome(e,n):t.ie(e,n)}catch(e){}},t.chrome=function(e,i){-1!==n(v).call(v,l.name)?r[e].apply(r,i):t.ie(e,i)},t.ie=function(e,t){o(t).call(t,(function(t){r[e](a(t,null,4))}))}}else if(p.isRN||this.localEnable||this.options.logFunc){var s=!p.isRN&&!this.localEnable;t.log=function(){t.formatArgsAndSave(arguments,"log",s)},t.info=function(){t.formatArgsAndSave(arguments,"info",s)},t.warn=function(){t.formatArgsAndSave(arguments,"warn",s)},t.error=function(){t.formatArgsAndSave(arguments,"error",s)}}},g.setLogDisabled=function(){this.localEnable=!1,this.log=function(){},this.info=function(){},this.warn=function(){},this.error=function(){}},g.formatArgsAndSave=function(e,t,r){var n;e=s([]).call(e,0);var u=new Date,l=y(u.getMonth()+1)+"-"+y(u.getDate())+" "+y(u.getHours())+":"+y(u.getMinutes())+":"+y(u.getSeconds())+":"+y(u.getMilliseconds(),3),p=c(n="[NIM LOG ".concat(l," ")).call(n,this.prefix.toUpperCase(),"]  "),f="";d.isString(e[0])?e[0]=p+e[0]:i(e).call(e,0,0,p),o(e).call(e,(function(t,r){d.isArray(t)||d.isObject(t)?(e[r]=d.simpleClone(t),f+=a(e[r])+" "):f+=t+" "}));var h=this.options.logFunc;return h&&d.isFunction(h[t])&&h[t].apply(h,e),!r&&this.writeLocalLog(f,t,+u),e},g.writeLocalLog=p.isRN?function(e,t){if(f.rnfs&&f.rnfs.writeFile&&f.rnfs.appendFile&&f.rnfs.DocumentDirectoryPath&&/error|warn|info/.test(t)){var r,n=f.rnfs,i=n.size/2-256;e+="\r\n",n.nimPromise=n.nimPromise.then((function(){return r=o(n.nimIndex),n.exists(r)})).then((function(t){return t?n.appendFile(r,e):n.writeFile(r,e)})).then((function(){return n.stat(r)})).then((function(e){if(e.size>i)return n.nimIndex++,n.nimIndex>1&&(n.nimIndex=n.nimIndex%2),n.unlink(o(n.nimIndex)).catch((function(e){return u.resolve()}))})).catch((function(){}))}function o(e){return f.rnfs.DocumentDirectoryPath+"/nimlog_"+e+".log"}}:p.isBrowser?function(e,t,r){this._local&&this._local.saveLog({log:e,level:t,time:r})}:function(){};var y=function(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r};e.exports=m},function(e,t,r){e.exports=r(400)},function(e,t,r){var n=r(78),i=r(6),o=r(77),a=r(93),s=r(11),c=r(43),u=c.getGlobal(),l={},d=u.name||"_parent",p=[],f=[];l.addMsgListener=function(e){p.push(e)};var h,m,g,v,y=(h=/^([\w]+?:\/\/.*?(?=\/|$))/i,function(e){return e=e||"",h.test(e)?RegExp.$1:"*"}),b=function(){var e,t,r=n(e=unescape(u.name||"")).call(e);if(r&&0===i(r).call(r,"MSG|")){u.name="";var o=c.string2object(r.replace("MSG|",""),"|"),a=(o.origin||"").toLowerCase();a&&"*"!==a&&0!==i(t=location.href.toLowerCase()).call(t,a)||function(e){for(var t=0,r=p.length;t<r;t++)try{p[t].call(null,e)}catch(e){}}({data:JSON.parse(o.data||"null"),source:u.frames[o.self]||o.self,origin:y(o.ref||("undefined"==typeof document?"":document.referrer))})}},S=(g=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return!0;return!1},function(){if(f.length){m=[];for(var e,t=f.length-1;t>=0;t--)e=f[t],g(m,e.w)||(m.push(e.w),o(f).call(f,t,1),e.w.name=e.d);m=null}}),_=l.startTimer=(v=!1,function(){v||(v=!0,u.postMessage||(a(S,100),a(b,20)))});l.postMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(c.fillUndef(t,{origin:"*",source:d}),u.postMessage){var r=t.data;u.FormData||(r=s(r)),e.postMessage(r,t.origin)}else{if(_(),c.isObject(t)){var n={};n.origin=t.origin||"",n.ref=location.href,n.self=t.source,n.data=s(t.data),t="MSG|"+c.object2string(n,"|",!0)}f.unshift({w:e,d:escape(t)})}},e.exports=l},function(e,t,r){var n=r(0),i={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},o={genResponseBody:function(e){return i[e=e||"file"]},parseResponse:function(e,t){n.notundef(e.size)&&(e.size=+e.size),n.notundef(e.w)&&(e.w=+e.w),n.notundef(e.h)&&(e.h=+e.h),n.notundef(e.dur)&&(e.dur=+e.dur);var r=e.orientation;if(n.notundef(r)&&(delete e.orientation,t&&("right, top"===r||"left, bottom"===r))){var i=e.w;e.w=e.h,e.h=i}return e}};e.exports=o},function(e,t,r){var n=r(6),i=r(0),o={fromDataURL:function(e){var t,r,o=i.getGlobal();r=n(t=e.split(",")[0]).call(t,"base64")>=0?o.atob(e.split(",")[1]):o.decodeURIComponent(e.split(",")[1]);for(var a=e.split(",")[0].split(":")[1].split(";")[0],s=new Uint8Array(r.length),c=0;c<r.length;c++)s[c]=r.charCodeAt(c);return new o.Blob([s],{type:a})}};e.exports=o},function(e,t,r){var n=r(9),i=r(8),o=r(5),a=r(0),s={stripmeta:0,blur:2,quality:3,crop:4,rotate:5,thumbnail:7,interlace:9},c={0:"stripmeta",1:"type",2:"blur",3:"quality",4:"crop",5:"rotate",6:"pixel",7:"thumbnail",8:"watermark",9:"interlace",10:"tmp"};function u(e){a.verifyOptions(e,"type","image::ImageOp"),a.verifyParamValid("type",e.type,u.validTypes,"image::ImageOp"),a.merge(this,e),this.type=s[e.type]}u.validTypes=n(s),u.reverse=function(e){var t=a.copy(e);return t.type=c[t.type],t},u.reverseImageOps=function(e){return i(e).call(e,(function(e){return o(u).call(u,e)}))},e.exports=u},function(e,t,r){var n=r(3),i=r(9),o={1:"ROOM_CLOSE",2:"ROOM_JOIN",3:"INVITE",4:"CANCEL_INVITE",5:"REJECT",6:"ACCEPT",7:"LEAVE",8:"CONTROL"},a={1:"accid",2:"uid",3:"createTime",4:"expireTime",5:"web_uid"},s={10404:"ROOM_NOT_EXISTS",10405:"ROOM_HAS_EXISTS",10406:"ROOM_MEMBER_NOT_EXISTS",10407:"ROOM_MEMBER_HAS_EXISTS",10408:"INVITE_NOT_EXISTS",10409:"INVITE_HAS_REJECT",10410:"INVITE_HAS_ACCEPT",10201:"PEER_NIM_OFFLINE",10202:"PEER_PUSH_OFFLINE",10419:"ROOM_MEMBER_EXCEED",10420:"ROOM_MEMBER_HAS_EXISTS_OTHER_CLIENT",10417:"UID_CONFLICT"};e.exports={parseAvSignalType:function(e){return o[e]||e},parseAvSignalMember:function(e){var t,r={};return n(t=i(e)).call(t,(function(t){r[a[t]]=e[t]})),r},parseAvSignalError:function(e){return e.message=s[e.code]||e.message||e,e}}},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;function getGlobal(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==global?global:{}}var root=getGlobal(),io=module.exports;void 0===root.location&&(root.location=null),root.io?module&&(module.exports=io=root.io):root.io=io,function(){var e,t,n;e=module.exports,t=root,n=e,n.version="0.9.11",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i,o,a=n.util.parseUri(e);t&&t.location&&(a.protocol=a.protocol||t.location.protocol.slice(0,-1),a.host=a.host||(t.document?t.document.domain:t.location.hostname),a.port=a.port||t.location.port),i=n.util.uniqueUri(a);var s={host:a.ipv6uri?"["+a.host+"]":a.host,secure:"https"===a.protocol,port:a.port||("https"===a.protocol?443:80),query:a.query||""};return n.util.merge(s,r),!s["force new connection"]&&n.sockets[i]||(o=new n.Socket(s)),!s["force new connection"]&&o&&(n.sockets[i]=o),(o=o||n.sockets[i]).of(a.path.length>1?a.path:"")},function(e,t){var r=e.util={},n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];r.parseUri=function(e){var t=e,r=e.indexOf("["),o=e.indexOf("]");-1!=r&&-1!=o&&(e=e.substring(0,r)+e.substring(r,o).replace(/:/g,";")+e.substring(o,e.length));for(var a=n.exec(e||""),s={},c=14;c--;)s[i[c]]=a[c]||"";return-1!=r&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s},r.uniqueUri=function(e){var r=e.protocol,n=e.host,i=e.port;return"document"in t&&t.document?(n=n||document.domain,i=i||("https"==r&&"https:"!==document.location.protocol?443:document.location.port)):(n=n||"localhost",i||"https"!=r||(i=443)),(r||"http")+"://"+n+":"+(i||80)},r.query=function(e,t){var n=r.chunkQuery(e||""),i=[];for(var o in r.merge(n,r.chunkQuery(t||"")),n)n.hasOwnProperty(o)&&i.push(o+"="+n[o]);return i.length?"?"+i.join("&"):""},r.chunkQuery=function(e){for(var t,r={},n=e.split("&"),i=0,o=n.length;i<o;++i)(t=n[i].split("="))[0]&&(r[t[0]]=t[1]);return r};var o=!1;r.load=function(e){if("undefined"!=typeof document&&document&&"complete"===document.readyState||o)return e();r.on(t,"load",e,!1)},r.on=function(e,t,r,n){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener&&e.addEventListener(t,r,n)},r.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!r.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||r.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(root[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},void 0!==root&&r.load((function(){o=!0})),r.defer=function(e){if(!r.ua.webkit||"undefined"!=typeof importScripts)return e();r.load((function(){setTimeout(e,100)}))},r.merge=function(e,t,n,i){var o,a=i||[],s=void 0===n?2:n;for(o in t)t.hasOwnProperty(o)&&r.indexOf(a,o)<0&&("object"==typeof e[o]&&s?r.merge(e[o],t[o],s-1,a):(e[o]=t[o],a.push(t[o])));return e},r.mixin=function(e,t){r.merge(e.prototype,t.prototype)},r.inherit=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.intersect=function(e,t){for(var n=[],i=e.length>t.length?e:t,o=e.length>t.length?t:e,a=0,s=o.length;a<s;a++)~r.indexOf(i,o[a])&&n.push(o[a]);return n},r.indexOf=function(e,t,r){var n=e.length;for(r=r<0?r+n<0?0:r+n:r||0;r<n&&e[r]!==t;r++);return n<=r?-1:r},r.toArray=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(e[r]);return t},r.ua={},r.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),r.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),r.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,root),function(e,t){function r(){}e.EventEmitter=r,r.prototype.on=function(e,r){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(r):this.$events[e]=[this.$events[e],r]:this.$events[e]=r,this},r.prototype.addListener=r.prototype.on,r.prototype.once=function(e,t){var r=this;function n(){r.removeListener(e,n),t.apply(this,arguments)}return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,r){if(this.$events&&this.$events[e]){var n=this.$events[e];if(t.util.isArray(n)){for(var i=-1,o=0,a=n.length;o<a;o++)if(n[o]===r||n[o].listener&&n[o].listener===r){i=o;break}if(i<0)return this;n.splice(i,1),n.length||delete this.$events[e]}else(n===r||n.listener&&n.listener===r)&&delete this.$events[e]}return this},r.prototype.removeAllListeners=function(e){return void 0===e?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},r.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},r.prototype.emit=function(e){if(!this.$events)return!1;var r=this.$events[e];if(!r)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof r)r.apply(this,n);else{if(!t.util.isArray(r))return!1;for(var i=r.slice(),o=0,a=i.length;o<a;o++)i[o].apply(this,n)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={};function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,(function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function str(e,t){var r,n,i,o,a,s=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,r=0;r<o;r+=1)a[r]=str(r,c)||"null";return i=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,i}if(rep&&"object"==typeof rep)for(o=rep.length,r=0;r<o;r+=1)"string"==typeof rep[r]&&(i=str(n=rep[r],c))&&a.push(quote(n)+(gap?": ":":")+i);else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(i=str(n,c))&&a.push(quote(n)+(gap?": ":":")+i);return i=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,i}}JSON.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;n<r;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("socket.io:: replacer cannot JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){var j;function walk(e,t){var r,n,i=e[t];if(i&&"object"==typeof i)for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(void 0!==(n=walk(i,r))?i[r]=n:delete i[r]);return reviver.call(e,t,i)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("socket.io:: reviver cannot JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var r=e.parser={},n=r.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=r.reasons=["transport not supported","client not handshaken","unauthorized"],o=r.advice=["reconnect"],a=t.JSON,s=t.util.indexOf;r.encodePacket=function(e){var t=s(n,e.type),r=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var d=e.reason?s(i,e.reason):"",p=e.advice?s(o,e.advice):"";""===d&&""===p||(l=d+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var f={name:e.name};e.args&&e.args.length&&(f.args=e.args),l=a.stringify(f);break;case"json":l=a.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+a.stringify(e.args):"")}var h=[t,r+("data"==u?"+":""),c];return null!=l&&h.push(l),h.join(":")},r.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var r=0,n=e.length;r<n;r++)t+="�"+e[r].length+"�"+e[r];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;r.decodePacket=function(e){if(!(s=e.match(c)))return{};var t=s[2]||"",r=(e=s[5]||"",{type:n[s[1]],endpoint:s[4]||""});switch(t&&(r.id=t,s[3]?r.ack="data":r.ack=!0),r.type){case"error":var s=e.split("+");r.reason=i[s[0]]||"",r.advice=o[s[1]]||"";break;case"message":r.data=e||"";break;case"event":try{var u=a.parse(e);r.name=u.name,r.args=u.args}catch(e){}r.args=r.args||[];break;case"json":try{r.data=a.parse(e)}catch(e){}break;case"connect":r.qs=e||"";break;case"ack":if((s=e.match(/^([0-9]+)(\+)?(.*)/))&&(r.ackId=s[1],r.args=[],s[3]))try{r.args=s[3]?a.parse(s[3]):[]}catch(e){}}return r},r.decodePayload=function(e){var t=function(e,t){for(var r=0,n=e;n<t.length;n++){if("�"==t.charAt(n))return r;r++}return r};if("�"==e.charAt(0)){for(var n=[],i=1,o="";i<e.length;i++)if("�"==e.charAt(i)){var a=e.substr(i+1).substr(0,o);if("�"!=e.charAt(i+1+Number(o))&&i+1+Number(o)!=e.length){var s=Number(o);l=t(i+s+1,e),a=e.substr(i+1).substr(0,s+l),i+=l}n.push(r.decodePacket(a)),i+=Number(o)+1,o=""}else o+=e.charAt(i);return n}return[r.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function r(e,t){this.socket=e,this.sessid=t}e.Transport=r,t.util.mixin(r,t.EventEmitter),r.prototype.heartbeats=function(){return!0},r.prototype.onData=function(e){if(this!==this.socket.transport)return this;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var r=t.parser.decodePayload(e);if(r&&r.length)for(var n=0,i=r.length;n<i;n++)this.onPacket(r[n])}return this},r.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},r.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout((function(){e.onDisconnect()}),this.socket.closeTimeout)}},r.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket?(this.socket.transport===this?this.socket.onDisconnect():this.socket.setBuffer(!1),this):this},r.prototype.onConnect=function(){return this.socket.onConnect(),this},r.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},r.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},r.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},r.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},r.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},r.prototype.onClose=function(){this.isOpen=!1,this.socket.transport===this?this.socket.onClose():this.socket.setBuffer(!1),this.onDisconnect(),this.onDisconnectDone instanceof Function&&this.onDisconnectDone(null),this.onConnectionOver instanceof Function&&this.onConnectionOver(null)},r.prototype.onDisconnectDone=function(){},r.prototype.onConnectionOver=function(){},r.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},r.prototype.ready=function(e,t){t.call(this)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,r){function n(e){if(this.options={port:80,secure:!1,document:"document"in r&&document,resource:"socket.io",transports:e.transports||t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var n=this;t.util.on(r,"beforeunload",(function(){n.disconnectSync()}),!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=n,t.util.mixin(n,t.EventEmitter),n.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},n.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},n.prototype.handshake=function(e){var r=this,n=this.options;function o(t){t instanceof Error?(r.connecting=!1,r.onError(t.message)):e.apply(null,t.split(":"))}var a=["http"+(n.secure?"s":"")+":/",n.host+":"+n.port,n.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS&&"undefined"!=typeof document&&document){var s=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=a+"&jsonp="+t.j.length,c.onreadystatechange=function(){"loaded"==this.readyState&&c.parentNode&&(c.parentNode.removeChild(c),r.connecting=!1,!r.reconnecting&&r.onError("Server down or port not open"),r.publish("handshake_failed"))},s.parentNode.insertBefore(c,s),t.j.push((function(e){o(e),c.parentNode.removeChild(c)}))}else{var u=t.util.request();u.open("GET",a,!0),u.timeout=1e4,this.isXDomain()&&(u.withCredentials=!0),u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=i,200==u.status?o(u.responseText):403==u.status?(r.connecting=!1,r.onError(u.responseText),r.publish("handshake_failed")):(r.connecting=!1,!r.reconnecting&&r.onError(u.responseText),r.publish("handshake_failed")))},u.ontimeout=function(e){r.connecting=!1,!r.reconnecting&&r.onError(u.responseText),r.publish("handshake_failed")},u.send(null)}},n.prototype.connect=function(e){if(this.connecting)return this;var r=this;return r.connecting=!0,this.handshake((function(n,i,o,a){r.sessionid=n,r.closeTimeout=1e3*o,r.heartbeatTimeout=1e3*i,r.transports||(r.transports=r.origTransports=a?t.util.intersect(a.split(","),r.options.transports):r.options.transports),r.setHeartbeatTimeout(),r.once("connect",(function(){clearTimeout(r.connectTimeoutTimer),r.connectTimeoutTimer=null,e&&"function"==typeof e&&e()})),r.doConnect()})),this},n.prototype.doConnect=function(){var e=this;if(e.transport&&e.transport.clearTimeouts(),e.transport=e.getTransport(e.transports),!e.transport)return e.publish("connect_failed");e.transport.ready(e,(function(){e.connecting=!0,e.publish("connecting",e.transport.name),e.transport.open(),e.options["connect timeout"]&&(e.connectTimeoutTimer&&clearTimeout(e.connectTimeoutTimer),e.connectTimeoutTimer=setTimeout(e.tryNextTransport.bind(e),e.options["connect timeout"]))}))},n.prototype.getTransport=function(e){for(var r,n=e||this.transports,i=0;r=n[i];i++)if(t.Transport[r]&&t.Transport[r].check(this)&&(!this.isXDomain()||t.Transport[r].xdomainCheck(this)))return new t.Transport[r](this,this.sessionid);return null},n.prototype.tryNextTransport=function(){if(!this.connected&&(this.connecting=!1,this.options["try multiple transports"])){for(var e=this.transports;e.length>0&&e.splice(0,1)[0]!=this.transport.name;);e.length?this.doConnect():this.publish("connect_failed")}},n.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout((function(){e.transport&&e.transport.onClose()}),this.heartbeatTimeout)}},n.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},n.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},n.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},n.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},n.prototype.disconnectSync=function(){var e=t.util.request(),r=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",r,!1),e.send(null),this.onDisconnect("booted")},n.prototype.isXDomain=function(){var e=r&&r.location||{},t=e.port||("https:"==e.protocol?443:80);return this.options.host!==e.hostname||this.options.port!=t},n.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},n.prototype.onOpen=function(){this.open=!0},n.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},n.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},n.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},n.prototype.onDisconnect=function(e){var t=this.connected,r=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||r)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()),r&&(this.connectTimeoutTimer&&clearTimeout(this.connectTimeoutTimer),this.tryNextTransport()))},n.prototype.reconnect=function(){this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],r=this.options["try multiple transports"],n=this.options["reconnection limit"];function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer),e.removeListener("connect_failed",o),e.removeListener("connect",o),e.reconnecting=!1,delete e.reconnectionAttempts,delete e.reconnectionDelay,delete e.reconnectionTimer,delete e.redoTransports,e.options["try multiple transports"]=r}function o(){if(e.reconnecting)return e.connected?i():e.connecting&&e.reconnecting?e.reconnectionTimer=setTimeout(o,1e3):void(e.reconnectionAttempts++>=t?e.redoTransports?(e.publish("reconnect_failed"),i()):(e.on("connect_failed",o),e.options["try multiple transports"]=!0,e.transports=e.origTransports,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<n&&(e.reconnectionDelay*=2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(o,e.reconnectionDelay)))}this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(o,this.reconnectionDelay),this.on("connect",o)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t){function r(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}function n(e,t){this.namespace=e,this.name=t}e.SocketNamespace=r,t.util.mixin(r,t.EventEmitter),r.prototype.$emit=t.EventEmitter.prototype.emit,r.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},r.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},r.prototype.send=function(e,t){var r={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(r.id=++this.ackPackets,r.ack=!0,this.acks[r.id]=t),this.packet(r)},r.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),r=t[t.length-1],n={type:"event",name:e};return"function"==typeof r&&(n.id=++this.ackPackets,n.ack="data",this.acks[n.id]=r,t=t.slice(0,t.length-1)),n.args=t,this.packet(n)},r.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},r.prototype.onPacket=function(e){var r=this;function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":i=[e.name].concat(e.args),"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":console.error("SocketIO on packet error: ",e),e.advice?this.socket.onError(e):"unauthorized"===e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,r){function n(e){t.Transport.apply(this,arguments)}e.websocket=n,t.util.inherit(n,t.Transport),n.prototype.name="websocket",n.prototype.open=function(){var e,n=t.util.query(this.socket.options.query),i=this;return e||(e=r.MozWebSocket||r.WebSocket),this.websocket=new e(this.prepareUrl()+n),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.socket.setBuffer(!0),i.onClose()},this.websocket.onerror=function(e){i.onError(e)},this},t.util.ua.iDevice?n.prototype.send=function(e){var t=this;return setTimeout((function(){t.websocket.send(e)}),0),this}:n.prototype.send=function(e){return this.websocket.send(e),this},n.prototype.payload=function(e){for(var t=0,r=e.length;t<r;t++)this.packet(e[t]);return this},n.prototype.close=function(){return this.websocket.close(),this},n.prototype.onError=function(e){this.socket.onError(e)},n.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},n.check=function(){return"WebSocket"in r&&!("__addTask"in WebSocket)||"MozWebSocket"in r},n.xdomainCheck=function(){return!0},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t,r){function n(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=n,t.util.inherit(n,t.Transport),n.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},n.prototype.payload=function(e){for(var r=[],n=0,i=e.length;n<i;n++)r.push(t.parser.encodePacket(e[n]));this.send(t.parser.encodePayload(r))},n.prototype.send=function(e){return this.post(e),this},n.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),r.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=i,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,t.posting=!1,200==this.status?t.socket.setBuffer(!1):t.onClose())},this.sendXHR.send(e)},n.prototype.close=function(){return this.onClose(),this},n.prototype.request=function(e){var r=t.util.request(this.socket.isXDomain()),n=t.util.query(this.socket.options.query,"t="+ +new Date);if(r.open(e||"GET",this.prepareUrl()+n,!0),"POST"==e)try{r.setRequestHeader?r.setRequestHeader("Content-type","text/plain;charset=UTF-8"):r.contentType="text/plain"}catch(e){}return r},n.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},n.check=function(e,n){try{var i=t.util.request(n),o=r.XDomainRequest&&i instanceof XDomainRequest,a=e&&e.options&&e.options.secure?"https:":"http:",s=r.location&&a!=r.location.protocol;if(i&&(!o||!s))return!0}catch(e){}return!1},n.xdomainCheck=function(e){return n.check(e,!0)}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t,r){function n(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=n,t.util.inherit(n,t.Transport.XHR),t.util.merge(n,t.Transport.XHR),n.prototype.name="xhr-polling",n.prototype.heartbeats=function(){return!1},n.prototype.open=function(){return t.Transport.XHR.prototype.open.call(this),!1},n.prototype.get=function(){if(this.isOpen){var e=this;this.xhr=this.request(),r.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){this.onload=i,this.onerror=i,e.retryCounter=1,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.retryCounter++,!e.retryCounter||e.retryCounter>3?e.onClose():e.get()}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(e.onData(this.responseText),e.get()):e.onClose())},this.xhr.send(null)}},n.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},n.prototype.ready=function(e,r){var n=this;t.util.defer((function(){r.call(n)}))},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return io}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}).call(this,__webpack_require__(49),__webpack_require__(456)(module))},function(e,t,r){var n=r(9),i=r(40);function o(){}o.typeMap={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,g2:12,custom:100};var a=o.typeReverseMap={0:"text",1:"image",2:"audio",3:"video",4:"geo",5:"notification",6:"file",10:"tip",11:"robot",12:"g2",100:"custom"};o.validTypes=n(o.typeMap),o.setFlow=function(e,t){var r=t===e.from;r&&t===e.to&&(r=i.deviceId===e.fromDeviceId),e.flow=r?"out":"in","robot"===e.type&&e.content&&e.content.msgOut&&(e.flow="in")},o.getType=function(e){var t=e.type;return a[t]||t},e.exports=o},function(e,t,r){var n=r(478),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,a=Array.prototype.concat,s=Object.defineProperty,c=s&&function(){var e={};try{for(var t in s(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),u=function(e,t,r,n){var i;t in e&&("function"!=typeof(i=n)||"[object Function]"!==o.call(i)||!n())||(c?s(e,t,{configurable:!0,enumerable:!1,value:r,writable:!0}):e[t]=r)},l=function(e,t){var r=arguments.length>2?arguments[2]:{},o=n(t);i&&(o=a.call(o,Object.getOwnPropertySymbols(t)));for(var s=0;s<o.length;s+=1)u(e,o[s],t[o[s]],r[o[s]])};l.supportsDescriptors=!!c,e.exports=l},function(e,t,r){var n=Object.prototype.toString;e.exports=function(e){var t=n.call(e),r="[object Arguments]"===t;return r||(r="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===n.call(e.callee)),r}},function(e,t,r){var n=r(145),i=r(480),o=n.call(Function.call,String.prototype.replace),a=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,s=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;e.exports=function(){var e=i.ToString(i.CheckObjectCoercible(this));return o(o(e,a,""),s,"")}},function(e,t,r){var n=Object.getOwnPropertyDescriptor?function(){return Object.getOwnPropertyDescriptor(arguments,"callee").get}():function(){throw new TypeError},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,o=Object.getPrototypeOf||function(e){return e.__proto__},a="undefined"==typeof Uint8Array?void 0:o(Uint8Array),s={"$ %Array%":Array,"$ %ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"$ %ArrayBufferPrototype%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer.prototype,"$ %ArrayIteratorPrototype%":i?o([][Symbol.iterator]()):void 0,"$ %ArrayPrototype%":Array.prototype,"$ %ArrayProto_entries%":Array.prototype.entries,"$ %ArrayProto_forEach%":Array.prototype.forEach,"$ %ArrayProto_keys%":Array.prototype.keys,"$ %ArrayProto_values%":Array.prototype.values,"$ %AsyncFromSyncIteratorPrototype%":void 0,"$ %AsyncFunction%":void 0,"$ %AsyncFunctionPrototype%":void 0,"$ %AsyncGenerator%":void 0,"$ %AsyncGeneratorFunction%":void 0,"$ %AsyncGeneratorPrototype%":void 0,"$ %AsyncIteratorPrototype%":void 0,"$ %Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"$ %Boolean%":Boolean,"$ %BooleanPrototype%":Boolean.prototype,"$ %DataView%":"undefined"==typeof DataView?void 0:DataView,"$ %DataViewPrototype%":"undefined"==typeof DataView?void 0:DataView.prototype,"$ %Date%":Date,"$ %DatePrototype%":Date.prototype,"$ %decodeURI%":decodeURI,"$ %decodeURIComponent%":decodeURIComponent,"$ %encodeURI%":encodeURI,"$ %encodeURIComponent%":encodeURIComponent,"$ %Error%":Error,"$ %ErrorPrototype%":Error.prototype,"$ %eval%":eval,"$ %EvalError%":EvalError,"$ %EvalErrorPrototype%":EvalError.prototype,"$ %Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"$ %Float32ArrayPrototype%":"undefined"==typeof Float32Array?void 0:Float32Array.prototype,"$ %Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"$ %Float64ArrayPrototype%":"undefined"==typeof Float64Array?void 0:Float64Array.prototype,"$ %Function%":Function,"$ %FunctionPrototype%":Function.prototype,"$ %Generator%":void 0,"$ %GeneratorFunction%":void 0,"$ %GeneratorPrototype%":void 0,"$ %Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"$ %Int8ArrayPrototype%":"undefined"==typeof Int8Array?void 0:Int8Array.prototype,"$ %Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"$ %Int16ArrayPrototype%":"undefined"==typeof Int16Array?void 0:Int8Array.prototype,"$ %Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"$ %Int32ArrayPrototype%":"undefined"==typeof Int32Array?void 0:Int32Array.prototype,"$ %isFinite%":isFinite,"$ %isNaN%":isNaN,"$ %IteratorPrototype%":i?o(o([][Symbol.iterator]())):void 0,"$ %JSON%":JSON,"$ %JSONParse%":JSON.parse,"$ %Map%":"undefined"==typeof Map?void 0:Map,"$ %MapIteratorPrototype%":"undefined"!=typeof Map&&i?o((new Map)[Symbol.iterator]()):void 0,"$ %MapPrototype%":"undefined"==typeof Map?void 0:Map.prototype,"$ %Math%":Math,"$ %Number%":Number,"$ %NumberPrototype%":Number.prototype,"$ %Object%":Object,"$ %ObjectPrototype%":Object.prototype,"$ %ObjProto_toString%":Object.prototype.toString,"$ %ObjProto_valueOf%":Object.prototype.valueOf,"$ %parseFloat%":parseFloat,"$ %parseInt%":parseInt,"$ %Promise%":"undefined"==typeof Promise?void 0:Promise,"$ %PromisePrototype%":"undefined"==typeof Promise?void 0:Promise.prototype,"$ %PromiseProto_then%":"undefined"==typeof Promise?void 0:Promise.prototype.then,"$ %Promise_all%":"undefined"==typeof Promise?void 0:Promise.all,"$ %Promise_reject%":"undefined"==typeof Promise?void 0:Promise.reject,"$ %Promise_resolve%":"undefined"==typeof Promise?void 0:Promise.resolve,"$ %Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"$ %RangeError%":RangeError,"$ %RangeErrorPrototype%":RangeError.prototype,"$ %ReferenceError%":ReferenceError,"$ %ReferenceErrorPrototype%":ReferenceError.prototype,"$ %Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"$ %RegExp%":RegExp,"$ %RegExpPrototype%":RegExp.prototype,"$ %Set%":"undefined"==typeof Set?void 0:Set,"$ %SetIteratorPrototype%":"undefined"!=typeof Set&&i?o((new Set)[Symbol.iterator]()):void 0,"$ %SetPrototype%":"undefined"==typeof Set?void 0:Set.prototype,"$ %SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"$ %SharedArrayBufferPrototype%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer.prototype,"$ %String%":String,"$ %StringIteratorPrototype%":i?o(""[Symbol.iterator]()):void 0,"$ %StringPrototype%":String.prototype,"$ %Symbol%":i?Symbol:void 0,"$ %SymbolPrototype%":i?Symbol.prototype:void 0,"$ %SyntaxError%":SyntaxError,"$ %SyntaxErrorPrototype%":SyntaxError.prototype,"$ %ThrowTypeError%":n,"$ %TypedArray%":a,"$ %TypedArrayPrototype%":a?a.prototype:void 0,"$ %TypeError%":TypeError,"$ %TypeErrorPrototype%":TypeError.prototype,"$ %Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"$ %Uint8ArrayPrototype%":"undefined"==typeof Uint8Array?void 0:Uint8Array.prototype,"$ %Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"$ %Uint8ClampedArrayPrototype%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray.prototype,"$ %Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"$ %Uint16ArrayPrototype%":"undefined"==typeof Uint16Array?void 0:Uint16Array.prototype,"$ %Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"$ %Uint32ArrayPrototype%":"undefined"==typeof Uint32Array?void 0:Uint32Array.prototype,"$ %URIError%":URIError,"$ %URIErrorPrototype%":URIError.prototype,"$ %WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"$ %WeakMapPrototype%":"undefined"==typeof WeakMap?void 0:WeakMap.prototype,"$ %WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet,"$ %WeakSetPrototype%":"undefined"==typeof WeakSet?void 0:WeakSet.prototype};e.exports=function(e,t){if(arguments.length>1&&"boolean"!=typeof t)throw new TypeError('"allowMissing" argument must be a boolean');var r="$ "+e;if(!(r in s))throw new SyntaxError("intrinsic "+e+" does not exist!");if(void 0===s[r]&&!t)throw new TypeError("intrinsic "+e+" exists, but is not available. Please file an issue!");return s[r]}},function(e,t,r){var n=r(145);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},function(e,t,r){var n=r(206);e.exports=function(){return String.prototype.trim&&"​"==="​".trim()?String.prototype.trim:n}},function(e,t,r){e.exports=function(e,t,r,n){var i=self||window;try{try{var o;try{o=new i.Blob([e])}catch(t){(o=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),o=o.getBlob()}var a=i.URL||i.webkitURL,s=a.createObjectURL(o),c=new i[t](s,r);return a.revokeObjectURL(s),c}catch(n){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),r)}}catch(e){if(!n)throw Error("Inline worker is not supported");return new i[t](n,r)}}},function(e,t,r){r(227).polyfill(),r(17).isBrowser=!0},function(e,t,r){e.exports=r(283)},function(e,t,r){var n=r(338);r(58),e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(15),a=r(132),s=r(133),c=r(339),u=r(86),l=r(46),d=r(57),p=r(340),f=r(341),h=r(107),m=r(342),g=r(18),v=r(343),y=g("toStringTag"),b=i.Error,S=[].push,_=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=o(M,this);s?r=s(new b(void 0),i?a(this):M):(r=i?this:u(M),l(r,y,"Error")),l(r,"message",m(t,"")),v&&l(r,"stack",p(r.stack,1)),f(r,n);var c=[];return h(e,S,{that:c}),l(r,"errors",c),r};s?s(_,b):c(_,b);var M=_.prototype=u(b.prototype,{constructor:d(1,_),message:d(1,""),name:d(1,"AggregateError")});n({global:!0},{AggregateError:_})},function(e,t,r){var n=r(2),i=r(31),o=r(39),a=r(92),s=r(115),c=r(107);n({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=a.f(t),n=r.resolve,u=r.reject,l=s((function(){var r=o(t.resolve),a=[],s=0,u=1;c(e,(function(e){var o=s++,c=!1;u++,i(r,t,e).then((function(e){c||(c=!0,a[o]={status:"fulfilled",value:e},--u||n(a))}),(function(e){c||(c=!0,a[o]={status:"rejected",reason:e},--u||n(a))}))})),--u||n(a)}));return l.error&&u(l.value),r.promise}})},function(e,t,r){var n=r(2),i=r(39),o=r(36),a=r(31),s=r(92),c=r(115),u=r(107);n({target:"Promise",stat:!0},{any:function(e){var t=this,r=o("AggregateError"),n=s.f(t),l=n.resolve,d=n.reject,p=c((function(){var n=i(t.resolve),o=[],s=0,c=1,p=!1;u(e,(function(e){var i=s++,u=!1;c++,a(n,t,e).then((function(e){u||p||(p=!0,l(e))}),(function(e){u||p||(u=!0,o[i]=e,--c||d(new r(o,"No one promise resolved")))}))})),--c||d(new r(o,"No one promise resolved"))}));return p.error&&d(p.value),n.promise}})},function(e,t,r){(function(n){var i,o,a,s,c,u,l,d,p,f,h,m,g,v,y,b,S,_=r(28),M=r(16),T=r(29),w=r(4),x=r(3),I=r(50),E=r(10),A=r(9),C=r(19);c=(o=void 0!==(o=void 0)?o:"undefined"!=typeof self?self:void 0!==n?n:{}).IDBKeyRange||o.webkitIDBKeyRange,u="readwrite",l=Object.prototype.hasOwnProperty,d=function(){if(!s&&!(s=o.indexedDB||o.webkitIndexedDB||o.mozIndexedDB||o.oIndexedDB||o.msIndexedDB||(null===o.indexedDB&&o.shimIndexedDB?o.shimIndexedDB:a)))throw"IndexedDB required";return s},p=function(e){return e},f=function(e){var t;return M(t=Object.prototype.toString.call(e)).call(t,8,-1).toLowerCase()},h=function(e){return"function"==typeof e},m=function(e){return e===a},g=function(e,t){var r=this,n=!1;this.name=t,this.getIndexedDB=function(){return e},this.add=function(t){if(n)throw"Database has been closed";for(var i=[],o=0,a=0;a<arguments.length-1;a++)if(T(arguments[a+1]))for(var s=0;s<arguments[a+1].length;s++)i[o]=arguments[a+1][s],o++;else i[o]=arguments[a+1],o++;var c=e.transaction(t,u),l=c.objectStore(t);return new w((function(e,t){x(i).call(i,(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=l.add(e,r)}else t=l.add(e);t.onsuccess=function(t){var r=t.target,n=r.source.keyPath;null===n&&(n="__id__"),I(e,n,{value:r.result,enumerable:!0})}})),c.oncomplete=function(){e(i,r)},c.onerror=function(e){e.preventDefault(),t(e)},c.onabort=function(e){t(e)}}))},this.updateAndDelete=function(t,r,i){if(n)throw"Database has been closed";var o=e.transaction(t,u),a=o.objectStore(t),s=a.keyPath;return new w((function(e,t){x(r).call(r,(function(e){if(e.item&&e.key){var t=e.key;e=e.item,a.put(e,t)}else a.put(e)})),x(i).call(i,(function(e){a.delete(e[s])})),o.oncomplete=function(){e([r,i])},o.onerror=function(e){t(e)}}))},this.update=function(t){if(n)throw"Database has been closed";for(var i,o=[],a=1;a<arguments.length;a++)T(i=arguments[a])?o=E(o).call(o,i):o.push(i);var s=e.transaction(t,u),c=s.objectStore(t);return c.keyPath,new w((function(e,t){x(o).call(o,(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=c.put(e,r)}else t=c.put(e);t.onsuccess=function(e){},t.onerror=function(e){}})),s.oncomplete=function(){e(o,r)},s.onerror=function(e){t(e)},s.onabort=function(e){t(e)}}))},this.remove=function(t,r,i,o,s,l,d){if(n)throw"Database has been closed";var p=e.transaction(t,u),f=p.objectStore(t);return new w((function(e,t){function n(e){return e===a||null===e}var u;n(o)&&(o=-1/0),n(s)&&(s=1/0),null===r||T(r)||(r=[r]),n(i)?null!==r?x(r).call(r,(function(e){f.delete(e)})):f.delete(range=c.bound(o,s,l,d)):(u=null!==r?c.only(r[0]):c.bound(o,s,l,d),f.index(i).openCursor(u).onsuccess=function(e){var t=e.target.result;t&&(t.delete(),t.continue())}),p.oncomplete=function(){e()},p.onerror=function(e){t(e)},p.onabort=function(e){t(e)}}))},this.clear=function(t){if(n)throw"Database has been closed";var r=e.transaction(t,u);return r.objectStore(t).clear(),new w((function(e,t){r.oncomplete=function(){e()},r.onerror=function(e){t(e)}}))},this.close=function(){n||(e.close(),n=!0,delete b[t])},this.get=function(t,r){if(n)throw"Database has been closed";var i=e.transaction(t),o=i.objectStore(t).get(r);return new w((function(e,t){o.onsuccess=function(t){e(t.target.result)},i.onerror=function(e){t(e)}}))},this.query=function(t,r){if(n)throw"Database has been closed";return new v(t,e,r)},this.count=function(t,r){if(n)throw"Database has been closed";e.transaction(t).objectStore(t)};for(var i=0,o=e.objectStoreNames.length;i<o;i++)!function(e){for(var t in r[e]={},r)l.call(r,t)&&"close"!==t&&(r[e][t]=function(t){return function(){var n,i=E(n=[e]).call(n,M([]).call(arguments,0));return r[t].apply(r,i)}}(t))}(e.objectStoreNames[i])},v=function(e,t,r){var n,i=this,o=!1,s=!1,l=function(n,i,l,d,p,f,m){return new w((function(g,v){var y=o||s?u:"readonly",b=t.transaction(e,y),S=b.objectStore(e),M=r?S.index(r):S,T=n?c[n].apply(null,i):null,w=[],I=[T],E=0;p=p||null,f=f||[],"count"!==l&&I.push(d||"next");var C=!!o&&A(o);M[l].apply(M,I).onsuccess=function(e){var t=e.target.result;if(_(t)===_(0))w=t;else if(t)if(null!==p&&p[0]>E)E=p[0],t.advance(p[0]);else if(null!==p&&E>=p[0]+p[1]);else{var r=!0,n="value"in t?t.value:t.key;x(f).call(f,(function(e){e&&e.length&&(2===e.length?r=r&&n[e[0]]===e[1]:h(e[0])&&(r=r&&e[0].apply(a,[n])))})),r&&(E++,w.push(m(n)),s?t.delete():o&&(n=function(e){for(var t=0;t<C.length;t++){var r=C[t],n=o[r];n instanceof Function&&(n=n(e)),e[r]=n}return e}(n),t.update(n))),t.continue()}},b.oncomplete=function(){g(w)},b.onerror=function(e){v(e)},b.onabort=function(e){v(e)}}))},d=function(e,t){var r="next",n="openCursor",i=[],a=null,c=p,u=!1,d=function(){return l(e,t,n,u?r+"unique":r,a,i,c)},g=function(){return r=null,n="count",{execute:d}},v=function e(){return 1==(a="array"===f(arguments[0])?arguments[0]:M(Array.prototype).call(arguments,0,2)).length&&a.unshift(0),function(e){return"number"===f(e)}(a[1])||(a=null),{execute:d,count:g,keys:y,filter:b,asc:S,desc:_,distinct:T,modify:w,limit:e,map:x,remove:I}},y=function e(t){return(t=!!m(t)||!!t)&&(n="openKeyCursor"),{execute:d,keys:e,filter:b,asc:S,desc:_,distinct:T,modify:w,limit:v,map:x,remove:I}},b=function e(){return i.push(M(Array.prototype).call(arguments,0,2)),{execute:d,count:g,keys:y,filter:e,asc:S,desc:_,distinct:T,modify:w,limit:v,map:x,remove:I}},S=function e(t){return t=!!m(t)||!!t,r=t?"next":"prev",{execute:d,count:g,keys:y,filter:b,asc:e,desc:_,distinct:T,modify:w,limit:v,map:x,remove:I}},_=function e(t){return t=!!m(t)||!!t,r=t?"prev":"next",{execute:d,count:g,keys:y,filter:b,asc:S,desc:e,distinct:T,modify:w,limit:v,map:x,remove:I}},T=function e(t){return t=!!m(t)||!!t,u=t,{execute:d,count:g,keys:y,filter:b,asc:S,desc:_,distinct:e,modify:w,limit:v,map:x,remove:I}},w=function e(t){return o=t,{execute:d,count:g,keys:y,filter:b,asc:S,desc:_,distinct:T,modify:e,limit:v,map:x,remove:I}},x=function e(t){return h(t)&&(c=t),{execute:d,count:g,keys:y,filter:b,asc:S,desc:_,distinct:T,modify:w,limit:v,map:e,remove:I}},I=function e(t){return t=!!m(t)||!!t,s=t,{execute:d,count:g,keys:y,filter:b,asc:S,desc:_,distinct:T,modify:w,limit:v,map:x,remove:e}};return{execute:d,count:g,keys:y,filter:b,asc:S,desc:_,distinct:T,modify:w,limit:v,map:x,remove:I}};x(n="only bound upperBound lowerBound".split(" ")).call(n,(function(e){i[e]=function(){return new d(e,arguments)}})),this.filter=function(){var e=new d(null,null);return C(e).apply(e,arguments)},this.all=function(){return C(this).call(this)}},y=function(e,t,r,n){var i=e.target.result,o=new g(i,t);return b[t]=i,w.resolve(o)},b={},S={version:"0.10.2",open:function(e){var t;return new w((function(r,n){if(b[e.server])y({target:{result:b[e.server]}},e.server,e.version,e.schema).then(r,n);else{try{t=d().open(e.server,e.version)}catch(e){n(e)}t.onsuccess=function(t){y(t,e.server,e.version,e.schema).then(r,n)},t.onupgradeneeded=function(t){!function(e,t,r){for(var n in"function"==typeof t&&(t=t()),t){var i,o=t[n];for(var a in i=!l.call(t,n)||r.objectStoreNames.contains(n)?e.currentTarget.transaction.objectStore(n):r.createObjectStore(n,o.key),o.indexes){var s=o.indexes[a];try{i.index(a)}catch(e){i.createIndex(a,s.key||a,A(s).length?s:{unique:!1})}}}}(t,e.schema,t.target.result)},t.onerror=function(e){n(e)}}}))},remove:function(e){return new w((function(t,r){if(!e)return t();var n,i;_(e)===g&&(e=e.name),"string"==typeof e&&(n=b[e]),n&&"function"==typeof n.close&&n.close();try{i=d().deleteDatabase(e)}catch(e){r(e)}i.onsuccess=function(r){delete b[e],t(e)},i.onerror=function(e){r(e)},i.onblocked=function(e){r(e)}}))}},void 0!==e.exports?e.exports=S:(i=function(){return S}.call(t,r,t,e))===a||(e.exports=i)}).call(this,r(49))},function(e,t,r){e.exports=r(432)},function(e,t,r){e.exports=r(442)},function(e,t){var r={set:function(e,t,n){r[e]=t,n&&(n.support=t)}};e.exports=r},function(e,t,r){var n=r(9),i=r(3),o=r(23),a=r(0),s=a.notundef,c=a.fillPropertyWithDefault,u=n,l={},d={},p={},f=[],h={normal:0,advanced:1},m={0:"normal",1:"advanced"},g=l.joinMode={noVerify:0,needVerify:1,rejectAll:2};d.joinMode={0:"noVerify",1:"needVerify",2:"rejectAll"},p.joinMode=u(g),f.push("join");var v=l.beInviteMode={needVerify:0,noVerify:1};function y(e){var t;a.verifyOptions(e,"action","superTeam::SuperTeam"),a.verifyOptions(e,"teamId","superTeam::SuperTeam"),s(e.teamId)&&(this.teamId=e.teamId),s(e.type)&&(this.type=h[e.type]),s(e.avatar)&&(this.avatar=""+e.avatar),s(e.name)&&(this.name=""+e.name),s(e.intro)&&(this.intro=""+e.intro),s(e.announcement)&&(this.announcement=""+e.announcement),s(e.custom)&&(this.custom=""+e.custom),i(f).call(f,o(t=this.setMode).call(t,this,e))}function b(e,t){s(e[t+="Mode"])&&(e[t]=d[t][e[t]])}d.beInviteMode={0:"needVerify",1:"noVerify"},f.push("beInvite"),p.beInviteMode=u(v),y.prototype.setMode=function(e,t){s(e[t+="Mode"])&&(a.verifyParamValid(t,e[t],p[t],"Superteam::Team"),this[t]=l[t][e[t]])},y.reverse=function(e,t){var r=a.copy(e);if(s(r.teamId)&&(r.teamId=""+r.teamId),s(r.type)&&(r.type=m[r.type]),s(r.level)&&(r.level=+r.level),s(r.valid)&&(r.valid=1==+r.valid),s(r.memberNum)&&(r.memberNum=+r.memberNum),s(r.memberUpdateTime)&&(r.memberUpdateTime=+r.memberUpdateTime),s(r.createTime)&&(r.createTime=+r.createTime),s(r.updateTime)&&(r.updateTime=+r.updateTime),s(r.validToCurrentUser)&&(r.validToCurrentUser="1"===r.validToCurrentUser),s(r.mute)&&(r.mute="1"===r.mute),s(r.muteType))switch(r.muteType){case"0":r.mute=!1,r.muteType="none";break;case"1":r.mute=!0,r.muteType="normal";break;case"3":r.mute=!0,r.muteType="all"}else s(r.mute)&&(1===r.mute?(r.mute=!0,r.muteType="normal"):(r.mute=!1,r.muteType="none"));return i(f).call(f,o(b).call(b,null,r)),delete r.bits,t||y.fillProperties(r),r},y.fillProperties=function(e){return c(e,"avatar","")},e.exports=y},function(e,t,r){var n=r(0).notundef;function i(e){n(e.shouldPushNotificationWhenPCOnline)&&(this.open=e.shouldPushNotificationWhenPCOnline?2:1)}i.getDefaultConfig=function(){return{shouldPushNotificationWhenPCOnline:!0}},i.reverse=function(e){return{shouldPushNotificationWhenPCOnline:1!=+e.open}},e.exports=i},function(e,t,r){var n=r(19),i=r(0),o=r(141),a=i.merge({},o.idMap,{auth:{id:2,login:3,kicked:5,logout:6,multiPortLogin:7,kick:8},user:{id:3,updatePushToken:1,appBackground:2,markInBlacklist:3,getBlacklist:4,markInMutelist:5,getMutelist:6,getRelations:8,getUsers:7,updateMyInfo:10,updateDonnop:15,syncMyInfo:109,syncUpdateMyInfo:110},notify:{id:4,markRead:3,syncOfflineMsgs:4,batchMarkRead:5,syncOfflineSysMsgs:6,syncOfflineNetcallMsgs:8,syncRoamingMsgs:9,syncMsgReceipts:12,syncRobots:15,syncBroadcastMsgs:16,syncSuperTeamRoamingMsgs:17,syncOfflineSuperTeamSysMsgs:18,syncDeleteSuperTeamMsgOfflineRoaming:19,syncDeleteMsgSelf:21,syncSessionsWithMoreRoaming:22,syncStickTopSessions:23,syncSessionHistoryMsgsDelete:24},sync:{id:5,sync:1,syncTeamMembers:2,syncSuperTeamMembers:3},msg:{id:7,sendMsg:1,msg:2,sysMsg:3,getHistoryMsgs:6,sendCustomSysMsg:7,searchHistoryMsgs:8,deleteSessions:9,getSessions:10,syncSendMsg:101,sendMsgReceipt:11,msgReceipt:12,deleteMsg:13,msgDeleted:14,markSessionAck:16,markSessionAckBatch:25,broadcastMsg:17,clearServerHistoryMsgs:18,getServerSessions:19,getServerSession:20,updateServerSession:21,deleteServerSessions:22,deleteMsgSelf:23,deleteMsgSelfBatch:24,msgFtsInServer:26,msgFtsInServerByTiming:27,onClearServerHistoryMsgs:118,syncUpdateServerSession:121,onDeleteMsgSelf:123,onDeleteMsgSelfBatch:124},msgExtend:{id:23,getThreadMsgs:1,getMsgsByIdServer:2,addQuickComment:3,deleteQuickComment:4,onQuickComment:5,onDeleteQuickComment:6,getQuickComments:7,addCollect:8,deleteCollects:9,updateCollect:10,getCollects:11,addStickTopSession:12,deleteStickTopSession:13,updateStickTopSession:14,addMsgPin:15,updateMsgPin:16,deleteMsgPin:17,onAddMsgPin:18,onUpdateMsgPin:19,onDeleteMsgPin:20,getMsgPins:21,syncAddQuickComment:103,syncDeleteQuickComment:104,syncAddStickTopSession:112,syncDeleteStickTopSession:113,syncUpdateStickTopSession:114,syncAddMsgPin:115,syncUpdateMsgPin:116,syncDeleteMsgPin:117},team:{id:8,createTeam:1,sendTeamMsg:2,teamMsg:3,teamMsgs:4,addTeamMembers:5,removeTeamMembers:6,updateTeam:7,leaveTeam:8,getTeam:9,getTeams:10,getTeamMembers:11,dismissTeam:12,applyTeam:13,passTeamApply:14,rejectTeamApply:15,addTeamManagers:16,removeTeamManagers:17,transferTeam:18,updateInfoInTeam:19,updateNickInTeam:20,acceptTeamInvite:21,rejectTeamInvite:22,getTeamHistoryMsgs:23,searchTeamHistoryMsgs:24,updateMuteStateInTeam:25,getMyTeamMembers:26,getMutedTeamMembers:27,sendTeamMsgReceipt:28,getTeamMsgReads:29,getTeamMsgReadAccounts:30,notifyTeamMsgReads:31,muteTeamAll:32,getTeamMemberInvitorAccid:33,getTeamsById:34,syncMyTeamMembers:126,syncTeams:109,syncTeamMembers:111,syncCreateTeam:101,syncSendTeamMsg:102,syncUpdateTeamMember:119},superTeam:{id:21,sendSuperTeamMsg:2,superTeamMsg:3,addSuperTeamMembers:5,removeSuperTeamMembers:6,leaveSuperTeam:7,updateSuperTeam:8,getSuperTeam:9,getSuperTeams:12,updateInfoInSuperTeam:10,getMySuperTeamMembers:11,getSuperTeamMembers:13,getSuperTeamHistoryMsgs:14,getSuperTeamMembersByJoinTime:15,sendSuperTeamCustomSysMsg:16,deleteSuperTeamMsg:17,superTeamMsgDelete:18,superTeamCustomSysMsg:19,applySuperTeam:20,passSuperTeamApply:21,rejectSuperTeamApply:22,acceptSuperTeamInvite:23,rejectSuperTeamInvite:24,markSuperTeamSessionAck:25,addSuperTeamManagers:26,removeSuperTeamManagers:27,updateSuperTeamMute:28,updateSuperTeamMembersMute:29,updateNickInSuperTeam:30,transferSuperTeam:31,markSuperTeamSessionsAck:32,getSuperTeamMembersByAccounts:33,getMutedSuperTeamMembers:34,syncMySuperTeamMembers:111,syncSuperTeams:109,syncSuperTeamMembers:113,syncCreateSuperTeam:101,syncSendSuperTeamMsg:102,syncUpdateSuperTeamMember:110,syncDeleteSuperTeamMsg:117},friend:{id:12,friendRequest:1,syncFriendRequest:101,deleteFriend:2,syncDeleteFriend:102,updateFriend:3,syncUpdateFriend:103,getFriends:4},chatroom:{id:13,getChatroomAddress:1},filter:{id:101,sendFilterMsg:1,filterMsg:2,filterSysMsg:3,sendFilterCustomSysMsg:7},eventService:{id:14,publishEvent:1,pushEvent:2,subscribeEvent:3,unSubscribeEventsByAccounts:4,unSubscribeEventsByType:5,querySubscribeEventsByAccounts:6,querySubscribeEventsByType:7,pushEvents:9},proxyService:{id:22,httpProxy:1,onProxyMsg:2}}),s=i.merge({},o.cmdConfig,{login:{sid:a.auth.id,cid:a.auth.login,params:[{type:"Property",name:"login"}]},logout:{sid:a.auth.id,cid:a.auth.logout},kick:{sid:a.auth.id,cid:a.auth.kick,params:[{type:"StrArray",name:"deviceIds"}]},updatePushToken:{sid:a.user.id,cid:a.user.updatePushToken,params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"int",name:"pushkit"}]},appBackground:{sid:a.user.id,cid:a.user.appBackground,params:[{type:"bool",name:"isBackground"},{type:"Int",name:"badge"}]},markInBlacklist:{sid:a.user.id,cid:a.user.markInBlacklist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getBlacklist:{sid:a.user.id,cid:a.user.getBlacklist,params:[{type:"long",name:"time"}]},markInMutelist:{sid:a.user.id,cid:a.user.markInMutelist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getMutelist:{sid:a.user.id,cid:a.user.getMutelist,params:[{type:"long",name:"time"}]},getRelations:{sid:a.user.id,cid:a.user.getRelations,params:[{type:"long",name:"timetag"}]},getUsers:{sid:a.user.id,cid:a.user.getUsers,params:[{type:"StrArray",name:"accounts"}]},updateMyInfo:{sid:a.user.id,cid:a.user.updateMyInfo,params:[{type:"Property",name:"user"},{type:"Property",name:"antispamTag"}]},updateDonnop:{sid:a.user.id,cid:a.user.updateDonnop,params:[{type:"Property",name:"donnop"}]},markRead:{sid:a.notify.id,cid:a.notify.markRead,params:[{type:"long",name:"id"},{type:"ph",name:"ph"}]},batchMarkRead:{sid:a.notify.id,cid:a.notify.batchMarkRead,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},sync:{sid:a.sync.id,cid:a.sync.sync,params:[{type:"Property",name:"sync"}]},syncTeamMembers:{sid:a.sync.id,cid:a.sync.syncTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},syncSuperTeamMembers:{sid:a.sync.id,cid:a.sync.syncSuperTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},sendMsg:{sid:a.msg.id,cid:a.msg.sendMsg,params:[{type:"Property",name:"msg"}]},getHistoryMsgs:{sid:a.msg.id,cid:a.msg.getHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},sendCustomSysMsg:{sid:a.msg.id,cid:a.msg.sendCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},searchHistoryMsgs:{sid:a.msg.id,cid:a.msg.searchHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSessions:{sid:a.msg.id,cid:a.msg.getSessions,params:[{type:"long",name:"time"}]},deleteSessions:{sid:a.msg.id,cid:a.msg.deleteSessions,params:[{type:"StrArray",name:"sessions"}]},sendMsgReceipt:{sid:a.msg.id,cid:a.msg.sendMsgReceipt,params:[{type:"Property",name:"msgReceipt"}]},deleteMsg:{sid:a.msg.id,cid:a.msg.deleteMsg,params:[{type:"Property",name:"sysMsg"}]},markSessionAck:{sid:a.msg.id,cid:a.msg.markSessionAck,params:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},markSessionAckBatch:{sid:a.msg.id,cid:a.msg.markSessionAckBatch,params:[{type:"PropertyArray",name:"sessionAckTags",entity:"sessionAckTag"}]},clearServerHistoryMsgs:{sid:a.msg.id,cid:a.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParams"}]},clearServerHistoryMsgsWithSync:{sid:a.msg.id,cid:a.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParamsWithSync"}]},msgFtsInServer:{sid:a.msg.id,cid:a.msg.msgFtsInServer,params:[{type:"Property",name:"msgFullSearchRequestTag"}]},msgFtsInServerByTiming:{sid:a.msg.id,cid:a.msg.msgFtsInServerByTiming,params:[{type:"Property",name:"msgTimingFullSearchRequestTag"}]},onClearServerHistoryMsgs:{sid:a.msg.id,cid:a.msg.clearServerHistoryMsgs},getServerSessions:{sid:a.msg.id,cid:a.msg.getServerSessions,params:[{type:"Property",name:"sessionReqTag"}]},getServerSession:{sid:a.msg.id,cid:a.msg.getServerSession,params:[{type:"Property",name:"session"}]},updateServerSession:{sid:a.msg.id,cid:a.msg.updateServerSession,params:[{type:"Property",name:"session"}]},deleteServerSessions:{sid:a.msg.id,cid:a.msg.deleteServerSessions,params:[{type:"PropertyArray",name:"sessions",entity:"session"}]},deleteMsgSelf:{sid:a.msg.id,cid:a.msg.deleteMsgSelf,params:[{type:"Property",name:"deleteMsgSelfTag"}]},deleteMsgSelfBatch:{sid:a.msg.id,cid:a.msg.deleteMsgSelfBatch,params:[{type:"PropertyArray",name:"deleteMsgSelfTags",entity:"deleteMsgSelfTag"}]},onDeleteMsgSelf:{sid:a.msg.id,cid:a.msg.onDeleteMsgSelf},onDeleteMsgSelfBatch:{sid:a.msg.id,cid:a.msg.onDeleteMsgSelfBatch},sendSuperTeamMsg:{sid:a.superTeam.id,cid:a.superTeam.sendSuperTeamMsg,params:[{type:"Property",name:"msg"}]},addSuperTeamMembers:{sid:a.superTeam.id,cid:a.superTeam.addSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}]},removeSuperTeamMembers:{sid:a.superTeam.id,cid:a.superTeam.removeSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},leaveSuperTeam:{sid:a.superTeam.id,cid:a.superTeam.leaveSuperTeam,params:[{type:"long",name:"teamId"}]},updateSuperTeam:{sid:a.superTeam.id,cid:a.superTeam.updateSuperTeam,params:[{type:"Property",name:"team"},{type:"Property",name:"antispamTag"}]},getSuperTeam:{sid:a.superTeam.id,cid:a.superTeam.getSuperTeam,params:[{type:"long",name:"teamId"}]},getSuperTeams:{sid:a.superTeam.id,cid:a.superTeam.getSuperTeams,params:[{type:"long",name:"timetag"}]},getSuperTeamMembers:{sid:a.superTeam.id,cid:a.superTeam.getSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},updateInfoInSuperTeam:{sid:a.superTeam.id,cid:a.superTeam.updateInfoInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},getSuperTeamHistoryMsgs:{sid:a.superTeam.id,cid:a.superTeam.getSuperTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},applySuperTeam:{sid:a.superTeam.id,cid:a.superTeam.applySuperTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passSuperTeamApply:{sid:a.superTeam.id,cid:a.superTeam.passSuperTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:a.superTeam.id,cid:a.superTeam.rejectSuperTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:a.superTeam.id,cid:a.superTeam.acceptSuperTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:a.superTeam.id,cid:a.superTeam.rejectSuperTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},markSuperTeamSessionAck:{sid:a.superTeam.id,cid:a.superTeam.markSuperTeamSessionAck,params:[{type:"long",name:"to"},{type:"long",name:"timetag"}]},addSuperTeamManagers:{sid:a.superTeam.id,cid:a.superTeam.addSuperTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:a.superTeam.id,cid:a.superTeam.removeSuperTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateSuperTeamMute:{sid:a.superTeam.id,cid:a.superTeam.updateSuperTeamMute,params:[{type:"long",name:"teamId"},{type:"int",name:"mute"}]},updateSuperTeamMembersMute:{sid:a.superTeam.id,cid:a.superTeam.updateSuperTeamMembersMute,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"int",name:"mute"}]},updateNickInSuperTeam:{sid:a.superTeam.id,cid:a.superTeam.updateNickInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},transferSuperTeam:{sid:a.superTeam.id,cid:a.superTeam.transferSuperTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},markSuperTeamSessionsAck:{sid:a.superTeam.id,cid:a.superTeam.markSuperTeamSessionsAck,params:[{type:"PropertyArray",name:"sessionAckTags",entity:"sessionAckTag"}]},getSuperTeamMembersByJoinTime:{sid:a.superTeam.id,cid:a.superTeam.getSuperTeamMembersByJoinTime,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSuperTeamMembersByAccounts:{sid:a.superTeam.id,cid:a.superTeam.getSuperTeamMembersByAccounts,params:[{type:"StrArray",name:"memberIds"}]},getMutedSuperTeamMembers:{sid:a.superTeam.id,cid:a.superTeam.getMutedSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},sendSuperTeamCustomSysMsg:{sid:a.superTeam.id,cid:a.superTeam.sendSuperTeamCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},deleteSuperTeamMsg:{sid:a.superTeam.id,cid:a.superTeam.deleteSuperTeamMsg,params:[{type:"Property",name:"sysMsg"}]},getMySuperTeamMembers:{sid:a.superTeam.id,cid:a.superTeam.getMySuperTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},createTeam:{sid:a.team.id,cid:a.team.createTeam,params:[{type:"Property",name:"team"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"Property",name:"antispamTag"}]},sendTeamMsg:{sid:a.team.id,cid:a.team.sendTeamMsg,params:[{type:"Property",name:"msg"}]},addTeamMembers:{sid:a.team.id,cid:a.team.addTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}]},removeTeamMembers:{sid:a.team.id,cid:a.team.removeTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateTeam:{sid:a.team.id,cid:a.team.updateTeam,params:[{type:"Property",name:"team"},{type:"Property",name:"antispamTag"}]},leaveTeam:{sid:a.team.id,cid:a.team.leaveTeam,params:[{type:"long",name:"teamId"}]},getTeam:{sid:a.team.id,cid:a.team.getTeam,params:[{type:"long",name:"teamId"}]},getTeams:{sid:a.team.id,cid:a.team.getTeams,params:[{type:"long",name:"timetag"}]},getTeamsById:{sid:a.team.id,cid:a.team.getTeamsById,params:[{type:"longArray",name:"teamIds"}]},getTeamMembers:{sid:a.team.id,cid:a.team.getTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},dismissTeam:{sid:a.team.id,cid:a.team.dismissTeam,params:[{type:"long",name:"teamId"}]},applyTeam:{sid:a.team.id,cid:a.team.applyTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passTeamApply:{sid:a.team.id,cid:a.team.passTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:a.team.id,cid:a.team.rejectTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},addTeamManagers:{sid:a.team.id,cid:a.team.addTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:a.team.id,cid:a.team.removeTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},transferTeam:{sid:a.team.id,cid:a.team.transferTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},updateInfoInTeam:{sid:a.team.id,cid:a.team.updateInfoInTeam,params:[{type:"Property",name:"teamMember"}]},updateNickInTeam:{sid:a.team.id,cid:a.team.updateNickInTeam,params:[{type:"Property",name:"teamMember"}]},acceptTeamInvite:{sid:a.team.id,cid:a.team.acceptTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:a.team.id,cid:a.team.rejectTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},getTeamHistoryMsgs:{sid:a.team.id,cid:a.team.getTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},searchTeamHistoryMsgs:{sid:a.team.id,cid:a.team.searchTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},updateMuteStateInTeam:{sid:a.team.id,cid:a.team.updateMuteStateInTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"int",name:"mute"}]},getMyTeamMembers:{sid:a.team.id,cid:a.team.getMyTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},getMutedTeamMembers:{sid:a.team.id,cid:a.team.getMutedTeamMembers,params:[{type:"long",name:"teamId"}]},sendTeamMsgReceipt:{sid:a.team.id,cid:a.team.sendTeamMsgReceipt,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReads:{sid:a.team.id,cid:a.team.getTeamMsgReads,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReadAccounts:{sid:a.team.id,cid:a.team.getTeamMsgReadAccounts,params:[{type:"Property",name:"teamMsgReceipt"}]},muteTeamAll:{sid:a.team.id,cid:a.team.muteTeamAll,params:[{type:"long",name:"teamId"},{type:"int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:a.team.id,cid:a.team.getTeamMemberInvitorAccid,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},friendRequest:{sid:a.friend.id,cid:a.friend.friendRequest,params:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:a.friend.id,cid:a.friend.deleteFriend,params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams"}]},updateFriend:{sid:a.friend.id,cid:a.friend.updateFriend,params:[{type:"Property",name:"friend"}]},getFriends:{sid:a.friend.id,cid:a.friend.getFriends,params:[{type:"long",name:"timetag"}]},getChatroomAddress:{sid:a.chatroom.id,cid:a.chatroom.getChatroomAddress,params:[{type:"long",name:"chatroomId"},{type:"bool",name:"isWeixinApp"},{type:"number",name:"type"}]},sendFilterMsg:{sid:n(a).id,cid:n(a).sendFilterMsg,params:[{type:"Property",name:"msg"}]},sendFilterCustomSysMsg:{sid:n(a).id,cid:n(a).sendFilterCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},publishEvent:{sid:a.eventService.id,cid:a.eventService.publishEvent,params:[{type:"Property",name:"msgEvent"}]},pushEvent:{sid:a.eventService.id,cid:a.eventService.pushEvent},subscribeEvent:{sid:a.eventService.id,cid:a.eventService.subscribeEvent,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:a.eventService.id,cid:a.eventService.unSubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:a.eventService.id,cid:a.eventService.unSubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},querySubscribeEventsByAccounts:{sid:a.eventService.id,cid:a.eventService.querySubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},querySubscribeEventsByType:{sid:a.eventService.id,cid:a.eventService.querySubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},pushEvents:{sid:a.eventService.id,cid:a.eventService.pushEvents},getThreadMsgs:{sid:a.msgExtend.id,cid:a.msgExtend.getThreadMsgs,params:[{type:"Property",name:"msg"},{type:"Property",name:"threadMsgReq"}]},getMsgsByIdServer:{sid:a.msgExtend.id,cid:a.msgExtend.getMsgsByIdServer,params:[{type:"PropertyArray",name:"reqMsgs",entity:"msg"}]},addQuickComment:{sid:a.msgExtend.id,cid:a.msgExtend.addQuickComment,params:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},deleteQuickComment:{sid:a.msgExtend.id,cid:a.msgExtend.deleteQuickComment,params:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},getQuickComments:{sid:a.msgExtend.id,cid:a.msgExtend.getQuickComments,params:[{type:"PropertyArray",name:"commentReq",entity:"commentReq"}]},addCollect:{sid:a.msgExtend.id,cid:a.msgExtend.addCollect,params:[{type:"Property",name:"collect"}]},deleteCollects:{sid:a.msgExtend.id,cid:a.msgExtend.deleteCollects,params:[{type:"PropertyArray",name:"collectList",entity:"collect"}]},updateCollect:{sid:a.msgExtend.id,cid:a.msgExtend.updateCollect,params:[{type:"Property",name:"collect"}]},getCollects:{sid:a.msgExtend.id,cid:a.msgExtend.getCollects,params:[{type:"Property",name:"collectQuery"}]},addStickTopSession:{sid:a.msgExtend.id,cid:a.msgExtend.addStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},updateStickTopSession:{sid:a.msgExtend.id,cid:a.msgExtend.updateStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},deleteStickTopSession:{sid:a.msgExtend.id,cid:a.msgExtend.deleteStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},addMsgPin:{sid:a.msgExtend.id,cid:a.msgExtend.addMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},updateMsgPin:{sid:a.msgExtend.id,cid:a.msgExtend.updateMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},deleteMsgPin:{sid:a.msgExtend.id,cid:a.msgExtend.deleteMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},getMsgPins:{sid:a.msgExtend.id,cid:a.msgExtend.getMsgPins,params:[{type:"Property",name:"msgPinReq"}]},httpProxy:{sid:a.proxyService.id,cid:a.proxyService.httpProxy,params:[{type:"Property",name:"proxyTag"}]}}),c=i.merge({},o.packetConfig,{"2_3":{service:"auth",cmd:"login",response:[{type:"Property",name:"loginRes"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"},{type:"Property",name:"aosPushInfo"}]},"2_5":{service:"auth",cmd:"kicked",response:[{type:"Number",name:"from"},{type:"Number",name:"reason"},{type:"String",name:"custom"},{type:"Number",name:"customClientType"}]},"2_6":{service:"auth",cmd:"logout"},"2_7":{service:"auth",cmd:"multiPortLogin",response:[{type:"Number",name:"state"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"}]},"2_8":{service:"auth",cmd:"kick",response:[{type:"StrArray",name:"deviceIds"}]},"3_1":{service:"user",cmd:"updatePushToken"},"3_2":{service:"user",cmd:"appBackground"},"3_3":{service:"user",cmd:"markInBlacklist"},"3_103":{service:"user",cmd:"syncMarkInBlacklist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_4":{service:"user",cmd:"getBlacklist",response:[{type:"StrArray",name:"blacklist"}]},"3_5":{service:"user",cmd:"markInMutelist"},"3_105":{service:"user",cmd:"syncMarkInMutelist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_6":{service:"user",cmd:"getMutelist",response:[{type:"StrArray",name:"mutelist"}]},"3_8":{service:"user",cmd:"getRelations",response:[{type:"PropertyArray",name:"specialRelations",entity:"specialRelation"},{type:"Number",name:"timetag"}]},"3_7":{service:"user",cmd:"getUsers",response:[{type:"PropertyArray",name:"users",entity:"user"}]},"3_10":{service:"user",cmd:"updateMyInfo",response:[{type:"Number",name:"timetag"}]},"3_15":{service:"user",cmd:"updateDonnop",response:[{type:"Number",name:"timetag"}]},"3_115":{service:"user",cmd:"syncUpdateDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"3_109":{service:"user",cmd:"syncMyInfo",response:[{type:"Property",name:"user"},{type:"Number",name:"timetag"}]},"3_110":{service:"user",cmd:"syncUpdateMyInfo",response:[{type:"Property",name:"user"}]},"4_1":{service:"notify"},"4_2":{service:"notify"},"4_3":{service:"notify",cmd:"markRead"},"4_4":{service:"notify",cmd:"syncOfflineMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_5":{service:"notify",cmd:"batchMarkRead"},"4_6":{service:"notify",cmd:"syncOfflineSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_8":{service:"notify",cmd:"syncOfflineNetcallMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_9":{service:"notify",cmd:"syncRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_12":{service:"notify",cmd:"syncMsgReceipts",response:[{type:"PropertyArray",name:"msgReceipts",entity:"msgReceipt"},{type:"Number",name:"timetag"}]},"4_13":{service:"notify",cmd:"syncDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"4_14":{service:"notify",cmd:"syncSessionAck",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Number",name:"timetag"}]},"4_15":{service:"notify",cmd:"syncRobots",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"4_16":{service:"notify",cmd:"syncBroadcastMsgs",response:[{type:"PropertyArray",name:"broadcastMsgs",entity:"broadcastMsg"}]},"4_17":{service:"notify",cmd:"syncSuperTeamRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_18":{service:"notify",cmd:"syncOfflineSuperTeamSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_19":{service:"notify",cmd:"syncDeleteSuperTeamMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"4_20":{service:"notify",cmd:"syncSuperTeamSessionAck",response:[{type:"LongLongMap",name:"superTeam"},{type:"Number",name:"timetag"}]},"4_21":{service:"notify",cmd:"syncDeleteMsgSelf",response:[{type:"PropertyArray",name:"deletedMsgs",entity:"deleteMsgSelfTag"}]},"4_22":{service:"notify",cmd:"syncSessionsWithMoreRoaming",response:[{type:"PropertyArray",name:"sessions",entity:"msg"}]},"4_23":{service:"notify",cmd:"syncStickTopSessions",response:[{type:"Number",name:"timetag"},{type:"boolean",name:"modify"},{type:"PropertyArray",name:"sessions",entity:"stickTopSession"}]},"4_24":{service:"notify",cmd:"syncSessionHistoryMsgsDelete",response:[{type:"PropertyArray",name:"sessionHistoryMsgsDeleteTags",entity:"clearMsgsParamsWithSync"}]},"4_100":{service:"notify",cmd:"syncOfflineFilterMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_101":{service:"notify",cmd:"syncOfflineFilterSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"5_1":{service:"sync",cmd:"syncDone",response:[{type:"Number",name:"timetag"}]},"5_2":{service:"sync",cmd:"syncTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"5_3":{service:"sync",cmd:"syncSuperTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"7_1":{service:"msg",cmd:"sendMsg",response:[{type:"Property",name:"msg"}],trivialErrorCodes:[7101]},"7_2":{service:"msg",cmd:"msg",response:[{type:"Property",name:"msg"}]},"7_3":{service:"msg",cmd:"sysMsg",response:[{type:"Property",name:"sysMsg"}]},"7_6":{service:"msg",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_7":{service:"msg",cmd:"sendCustomSysMsg",trivialErrorCodes:[7101]},"7_8":{service:"msg",cmd:"searchHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_9":{service:"msg",cmd:"deleteSessions"},"7_10":{service:"msg",cmd:"getSessions",response:[{type:"StrArray",name:"sessions"}]},"7_101":{service:"msg",cmd:"syncSendMsg",response:[{type:"Property",name:"msg"}]},"7_11":{service:"msg",cmd:"sendMsgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_12":{service:"msg",cmd:"msgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_13":{service:"msg",cmd:"onDeleteMsg"},"7_14":{service:"msg",cmd:"onMsgDeleted",response:[{type:"Property",name:"sysMsg"}]},"7_15":{service:"msg",cmd:"onDeleteMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"7_16":{service:"msg",cmd:"onMarkSessionAck"},"7_17":{service:"msg",cmd:"broadcastMsg",response:[{type:"Property",name:"broadcastMsg"}]},"7_18":{service:"msg",cmd:"clearServerHistoryMsgs",response:[{type:"Long",name:"timetag"}]},"7_19":{service:"session",cmd:"getServerSessions",response:[{type:"Property",name:"sessionReqTag"},{type:"PropertyArray",name:"sessionList",entity:"session"}]},"7_20":{service:"session",cmd:"getServerSession",response:[{type:"Property",name:"session"}]},"7_21":{service:"session",cmd:"updateServerSession"},"7_22":{service:"session",cmd:"deleteServerSessions"},"7_23":{service:"msg",cmd:"deleteMsgSelf",response:[{type:"Long",name:"timetag"}]},"7_24":{service:"msg",cmd:"deleteMsgSelfBatch",response:[{type:"Long",name:"timetag"}]},"7_25":{service:"msg",cmd:"onMarkSessionAckBatch"},"7_26":{service:"msg",cmd:"msgFtsInServer",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_27":{service:"msg",cmd:"msgFtsInServerByTiming",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_118":{service:"msg",cmd:"onClearServerHistoryMsgs",response:[{type:"Property",name:"sessionHistoryMsgsDeleteTag",entity:"clearMsgsParamsWithSync"}]},"7_123":{service:"msg",cmd:"onDeleteMsgSelf",response:[{type:"Property",name:"deleteMsgSelfTag"}]},"7_124":{service:"msg",cmd:"onDeleteMsgSelfBatch",response:[{type:"PropertyArray",name:"deleteMsgSelfTags",entity:"deleteMsgSelfTag"}]},"7_116":{service:"msg",cmd:"syncMarkSessionAck",response:[{type:"Number",name:"scene"},{type:"String",name:"to"},{type:"Number",name:"timetag"}]},"7_121":{service:"msg",cmd:"syncUpdateServerSession",response:[{type:"Property",name:"session"}]},"23_1":{service:"msgExtend",cmd:"getThreadMsgs",response:[{type:"Property",name:"threadMsg",entity:"msg"},{type:"Property",name:"threadMsgsMeta"},{type:"PropertyArray",name:"msgs",entity:"msg"}]},"23_2":{service:"msgExtend",cmd:"getMsgsByIdServer",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"23_3":{service:"msgExtend",cmd:"addQuickComment",response:[{type:"Number",name:"timetag"}]},"23_4":{service:"msgExtend",cmd:"deleteQuickComment",response:[{type:"Number",name:"timetag"}]},"23_5":{service:"msgExtend",cmd:"onQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_6":{service:"msgExtend",cmd:"onDeleteQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_7":{service:"msgExtend",cmd:"getQuickComments",response:[{type:"PropertyArray",name:"commentRes",entity:"commentRes"}]},"23_8":{service:"msgExtend",cmd:"addCollect",response:[{type:"Property",name:"collect"}]},"23_9":{service:"msgExtend",cmd:"deleteCollects",response:[{type:"Number",name:"deleteNum"}]},"23_10":{service:"msgExtend",cmd:"updateCollect",response:[{type:"Property",name:"collect"}]},"23_11":{service:"msgExtend",cmd:"getCollects",response:[{type:"Number",name:"total"},{type:"PropertyArray",name:"collectList",entity:"collect"}]},"23_12":{service:"msgExtend",cmd:"addStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_13":{service:"msgExtend",cmd:"deleteStickTopSession",response:[{type:"Number",name:"timetag"}]},"23_14":{service:"msgExtend",cmd:"updateStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_15":{service:"msgExtend",cmd:"addMsgPin",response:[{type:"Number",name:"timetag"}]},"23_16":{service:"msgExtend",cmd:"updateMsgPin",response:[{type:"Number",name:"timetag"}]},"23_17":{service:"msgExtend",cmd:"deleteMsgPin",response:[{type:"Number",name:"timetag"}]},"23_18":{service:"msgExtend",cmd:"onAddMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_19":{service:"msgExtend",cmd:"onUpdateMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_20":{service:"msgExtend",cmd:"onDeleteMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_21":{service:"msgExtend",cmd:"getMsgPins",response:[{type:"Number",name:"timetag"},{type:"Boolean",name:"modify"},{type:"PropertyArray",name:"pins",entity:"msgPinRes"}]},"23_103":{service:"msgExtend",cmd:"syncAddQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_104":{service:"msgExtend",cmd:"syncDeleteQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_112":{service:"msgExtend",cmd:"syncAddStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_113":{service:"msgExtend",cmd:"syncDeleteStickTopSession",response:[{type:"Number",name:"timetag"},{type:"Property",name:"stickTopSession"}]},"23_114":{service:"msgExtend",cmd:"syncUpdateStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_115":{service:"msgExtend",cmd:"syncAddMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_116":{service:"msgExtend",cmd:"syncUpdateMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_117":{service:"msgExtend",cmd:"syncDeleteMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"21_2":{service:"superTeam",cmd:"sendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_3":{service:"superTeam",cmd:"superTeamMsg",response:[{type:"Property",name:"msg"}]},"21_5":{service:"superTeam",cmd:"addSuperTeamMembers",response:[{type:"StrArray",name:"abortedAccidList"},{type:"long",name:"timetag"}]},"21_6":{service:"superTeam",cmd:"removeSuperTeamMembers"},"21_7":{service:"superTeam",cmd:"leaveSuperTeam"},"21_8":{service:"superTeam",cmd:"updateSuperTeam",response:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},"21_9":{service:"superTeam",cmd:"getSuperTeam",response:[{type:"Property",name:"team"}]},"21_12":{service:"superTeam",cmd:"getSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_10":{service:"superTeam",cmd:"updateInfoInSuperTeam"},"21_13":{service:"superTeam",cmd:"getSuperTeamMembers",response:[{type:"long",name:"timetag"}]},"21_11":{service:"superTeam",cmd:"getMySuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_14":{service:"superTeam",cmd:"getSuperTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"21_15":{service:"superTeam",cmd:"getSuperTeamMembersByJoinTime",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_16":{service:"superTeam",cmd:"sendSuperTeamCustomSysMsg",trivialErrorCodes:[7101]},"21_17":{service:"superTeam",cmd:"onDeleteSuperTeamMsg"},"21_18":{service:"superTeam",cmd:"onSuperTeamMsgDelete",response:[{type:"Property",name:"sysMsg"}]},"21_19":{service:"superTeam",cmd:"superTeamCustomSysMsg",response:[{type:"Property",name:"sysMsg"}]},"21_20":{service:"superTeam",cmd:"applySuperTeam",response:[{type:"Property",name:"team"}]},"21_21":{service:"superTeam",cmd:"passSuperTeamApply"},"21_22":{service:"superTeam",cmd:"rejectSuperTeamApply"},"21_23":{service:"superTeam",cmd:"acceptSuperTeamInvite",response:[{type:"Property",name:"team"}]},"21_24":{service:"superTeam",cmd:"rejectSuperTeamInvite"},"21_25":{service:"superTeam",cmd:"onMarkSuperTeamSessionAck"},"21_26":{service:"superTeam",cmd:"addSuperTeamManagers"},"21_27":{service:"superTeam",cmd:"removeSuperTeamManagers"},"21_28":{service:"superTeam",cmd:"updateSuperTeamMute"},"21_29":{service:"superTeam",cmd:"updateSuperTeamMembersMute",response:[{type:"long",name:"timetag"}]},"21_30":{service:"superTeam",cmd:"updateNickInSuperTeam"},"21_31":{service:"superTeam",cmd:"transferSuperTeam"},"21_32":{service:"superTeam",cmd:"onMarkSuperTeamSessionsAck"},"21_33":{service:"superTeam",cmd:"getSuperTeamMembersByAccounts",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_34":{service:"superTeam",cmd:"getMutedSuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_113":{service:"superTeam",cmd:"syncSuperTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"superTeamMember"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_111":{service:"superTeam",cmd:"syncMySuperTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"superTeamMember"},{type:"long",name:"timetag"}]},"21_109":{service:"superTeam",cmd:"syncSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_101":{service:"superTeam",cmd:"syncCreateSuperTeam",response:[{type:"Property",name:"team"}]},"21_102":{service:"superTeam",cmd:"syncSendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_110":{service:"superTeam",cmd:"syncUpdateSuperTeamMember",response:[{type:"Property",name:"teamMember",entity:"superTeamMember"}]},"21_117":{service:"superTeam",cmd:"syncDeleteSuperTeamMsg",response:[{type:"Property",name:"sysMsg"}]},"21_125":{service:"superTeam",cmd:"syncMarkSuperTeamSessionAck",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},"8_1":{service:"team",cmd:"createTeam",response:[{type:"Property",name:"team"},{type:"StrArray",name:"abortedAccidList"}]},"8_2":{service:"team",cmd:"sendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_3":{service:"team",cmd:"teamMsg",response:[{type:"Property",name:"msg"}]},"8_4":{service:"team",cmd:"teamMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_5":{service:"team",cmd:"addTeamMembers",response:[{type:"long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},"8_6":{service:"team",cmd:"removeTeamMembers"},"8_7":{service:"team",cmd:"updateTeam",response:[{type:"Number",name:"id"},{type:"Number",name:"time"}]},"8_8":{service:"team",cmd:"leaveTeam"},"8_9":{service:"team",cmd:"getTeam",response:[{type:"Property",name:"team"}]},"8_10":{service:"team",cmd:"getTeams",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"Number",name:"timetag"}]},"8_11":{service:"team",cmd:"getTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_12":{service:"team",cmd:"dismissTeam"},"8_13":{service:"team",cmd:"applyTeam",response:[{type:"Property",name:"team"}]},"8_14":{service:"team",cmd:"passTeamApply"},"8_15":{service:"team",cmd:"rejectTeamApply"},"8_16":{service:"team",cmd:"addTeamManagers"},"8_17":{service:"team",cmd:"removeTeamManagers"},"8_18":{service:"team",cmd:"transferTeam"},"8_19":{service:"team",cmd:"updateInfoInTeam"},"8_20":{service:"team",cmd:"updateNickInTeam"},"8_21":{service:"team",cmd:"acceptTeamInvite",response:[{type:"Property",name:"team"}]},"8_22":{service:"team",cmd:"rejectTeamInvite"},"8_23":{service:"team",cmd:"getTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_24":{service:"team",cmd:"searchTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_25":{service:"team",cmd:"updateMuteStateInTeam"},"8_26":{service:"team",cmd:"getMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_27":{service:"team",cmd:"getMutedTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_28":{service:"team",cmd:"sendTeamMsgReceipt",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_29":{service:"team",cmd:"getTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_30":{service:"team",cmd:"getTeamMsgReadAccounts",response:[{type:"Property",name:"teamMsgReceipt"},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},"8_31":{service:"team",cmd:"notifyTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_32":{service:"team",cmd:"muteTeamAll",response:[]},"8_33":{service:"team",cmd:"getTeamMemberInvitorAccid",response:[{type:"object",name:"accountsMap"}]},"8_34":{service:"team",cmd:"getTeamsById",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"StrArray",name:"tids"}],trivialErrorCodes:[816]},"8_126":{service:"team",cmd:"syncMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_109":{service:"team",cmd:"syncTeams",response:[{type:"Number",name:"timetag"},{type:"PropertyArray",name:"teams",entity:"team"}]},"8_111":{service:"team",cmd:"syncTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_101":{service:"team",cmd:"syncCreateTeam",response:[{type:"Property",name:"team"}]},"8_102":{service:"team",cmd:"syncSendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_119":{service:"team",cmd:"syncUpdateTeamMember",response:[{type:"Property",name:"teamMember"}]},"12_1":{service:"friend",cmd:"friendRequest"},"12_101":{service:"friend",cmd:"syncFriendRequest",response:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}]},"12_2":{service:"friend",cmd:"deleteFriend"},"12_102":{service:"friend",cmd:"syncDeleteFriend",response:[{type:"String",name:"account"}]},"12_3":{service:"friend",cmd:"updateFriend"},"12_103":{service:"friend",cmd:"syncUpdateFriend",response:[{type:"Property",name:"friend"}]},"12_4":{service:"friend",cmd:"getFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_5":{service:"friend",cmd:"syncFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_6":{service:"friend",cmd:"syncFriendUsers",response:[{type:"PropertyArray",name:"users",entity:"user"},{type:"Number",name:"timetag"}]},"13_1":{service:"chatroom",cmd:"getChatroomAddress",response:[{type:"StrArray",name:"address"}]},"14_1":{service:"eventService",cmd:"publishEvent",response:[{type:"Property",name:"msgEvent"}]},"14_2":{service:"eventService",cmd:"pushEvent",response:[{type:"Property",name:"msgEvent"}]},"14_3":{service:"eventService",cmd:"subscribeEvent",response:[{type:"StrArray",name:"accounts"}]},"14_4":{service:"eventService",cmd:"unSubscribeEventsByAccounts",response:[{type:"StrArray",name:"accounts"}]},"14_5":{service:"eventService",cmd:"unSubscribeEventsByType"},"14_6":{service:"eventService",cmd:"querySubscribeEventsByAccounts",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_7":{service:"eventService",cmd:"querySubscribeEventsByType",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_9":{service:"eventService",cmd:"pushEvents",response:[{type:"PropertyArray",name:"msgEvents",entity:"msgEvent"}]},"22_1":{service:"proxyService",cmd:"httpProxy",response:[{type:"Property",name:"proxyTag"}]},"22_2":{service:"proxyService",cmd:"onProxyMsg",response:[{type:"Property",name:"proxyMsg",entity:"proxyMsgTag"}]},"101_1":{service:"filter",cmd:"sendFilterMsg",response:[{type:"Property",name:"msg"}]},"101_2":{service:"filter",cmd:"filterMsg",response:[{type:"Property",name:"msg"}]},"101_3":{service:"filter",cmd:"filterSysMsg",response:[{type:"Property",name:"sysMsg"}]},"101_7":{service:"filter",cmd:"sendFilterCustomSysMsg"}});e.exports={idMap:a,cmdConfig:s,packetConfig:c}},function(e,t,r){var n=r(53),i=r(472),o=r(202),a=r(190),s=r(149),c=r(0),u=r(220),l=r(199),d=r(55),p=r(491),f=r(492);e.exports=function(e){c.merge(e,{platform:n,xhr:i,io:o,naturalSort:a,deepAccess:s,util:c,support:u,blob:l,ajax:d,LoggerPlugin:p,usePlugin:f})}},function(e,t,r){var n=r(8),i=r(5),o=r(9),a=r(82).genPrivateUrl,s=r(0),c=s.notundef,u={"-2":"unset","-1":"restricted",0:"common",1:"owner",2:"manager",3:"guest",4:"anonymous"};function l(e){c(e.nick)&&(this.nick=""+e.nick),c(e.avatar)&&(this.avatar=""+e.avatar),c(e.custom)&&(this.custom=""+e.custom)}l.reverse=function(e){var t=s.copy(e);return c(t.chatroomId)&&(t.chatroomId=""+t.chatroomId),c(t.avatar)&&(t.avatar=a(t.avatar)),c(t.type)&&(t.type=u[t.type]),c(t.level)&&(t.level=+t.level),c(t.online)&&(t.online=1==+t.online),c(t.enterTime)&&(t.enterTime=+t.enterTime),c(t.guest)&&(t.guest=1==+t.guest),c(t.blacked)&&(t.blacked=1==+t.blacked),c(t.gaged)&&(t.gaged=1==+t.gaged),c(t.valid)&&(t.valid=1==+t.valid),c(t.updateTime)&&(t.updateTime=+t.updateTime),c(t.tempMuted)?t.tempMuted=1==+t.tempMuted:t.tempMuted=!1,c(t.tempMuteDuration)?t.tempMuteDuration=+t.tempMuteDuration:t.tempMuteDuration=0,t.online||delete t.enterTime,t.guest&&(t.type="guest",delete t.valid),"common"!==t.type&&delete t.level,delete t.guest,t},l.reverseMembers=function(e){return n(e).call(e,(function(e){return i(l).call(l,e)}))},l.validTypes=o(u),l.typeReverseMap=u,e.exports=l},function(e,t,r){var n;e.exports=(n=r(65),r(495),void(n.lib.Cipher||function(e){var t=n,r=t.lib,i=r.Base,o=r.WordArray,a=r.BufferedBlockAlgorithm,s=t.enc,c=(s.Utf8,s.Base64),u=t.algo.EvpKDF,l=r.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?b:v}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()}),d=(r.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),p=r.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=d.CBC=function(){var e=p.extend();function t(e,t,r){var n,i=this._iv;i?(n=i,this._iv=void 0):n=this._prevBlock;for(var o=0;o<r;o++)e[t+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i),n.encryptBlock(e,r),this._prevBlock=e.slice(r,r+i)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=e.slice(r,r+i);n.decryptBlock(e,r),t.call(this,e,r,i),this._prevBlock=o}}),e}(),h=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(i);var c=o.create(a,n);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},m=(r.BlockCipher=l.extend({cfg:l.cfg.extend({mode:f,padding:h}),reset:function(){var e;l.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?o.create([1398893684,1701076831]).concat(r).concat(t):t).toString(c)},parse:function(e){var t,r=c.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=o.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),m.create({ciphertext:r,salt:t})}},v=r.SerializableCipher=i.extend({cfg:i.extend({format:g}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),a=i.cfg;return m.create({ciphertext:o,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),y=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){n||(n=o.random(8));var i=u.create({keySize:t+r}).compute(e,n),a=o.create(i.words.slice(t),4*r);return i.sigBytes=4*t,m.create({key:i,iv:a,salt:n})}},b=r.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:y}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=v.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=i.iv,v.decrypt.call(this,e,t,i.key,n)}})}()))},function(e,t,r){(function(t,r){var n;n=function(){function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,o=void 0,a=void 0,s=function(e,t){h[i]=e,h[i+1]=t,2===(i+=2)&&(a?a(m):S())},c="undefined"!=typeof window?window:void 0,u=c||{},l=u.MutationObserver||u.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(m,1)}}var h=new Array(1e3);function m(){for(var e=0;e<i;e+=2)(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0;i=0}var g,v,y,b,S=void 0;function _(e,t){var r=this,n=new this.constructor(w);void 0===n[T]&&D(n);var i=r._state;if(i){var o=arguments[i-1];s((function(){return R(i,n,o,r._result)}))}else O(r,n,e,t);return n}function M(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(w);return E(t,e),t}d?S=function(){return t.nextTick(m)}:l?(v=0,y=new l(m),b=document.createTextNode(""),y.observe(b,{characterData:!0}),S=function(){b.data=v=++v%2}):p?((g=new MessageChannel).port1.onmessage=m,S=function(){return g.port2.postMessage(0)}):S=void 0===c?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(m)}:f()}catch(e){return f()}}():f();var T=Math.random().toString(36).substring(2);function w(){}var x=void 0;function I(t,r,n){r.constructor===t.constructor&&n===_&&r.constructor.resolve===M?function(e,t){1===t._state?C(e,t._result):2===t._state?k(e,t._result):O(t,void 0,(function(t){return E(e,t)}),(function(t){return k(e,t)}))}(t,r):void 0===n?C(t,r):e(n)?function(e,t,r){s((function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,(function(r){n||(n=!0,t!==r?E(e,r):C(e,r))}),(function(t){n||(n=!0,k(e,t))}),e._label);!n&&i&&(n=!0,k(e,i))}),e)}(t,r,n):C(t,r)}function E(e,t){if(e===t)k(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)C(e,t);else{var r=void 0;try{r=t.then}catch(t){return void k(e,t)}I(e,t,r)}var n,i}function A(e){e._onerror&&e._onerror(e._result),N(e)}function C(e,t){e._state===x&&(e._result=t,e._state=1,0!==e._subscribers.length&&s(N,e))}function k(e,t){e._state===x&&(e._state=2,e._result=t,s(A,e))}function O(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+1]=r,i[o+2]=n,0===o&&e._state&&s(N,e)}function N(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)n=t[a],i=t[a+r],n?R(r,n,i,o):i(o);e._subscribers.length=0}}function R(t,r,n,i){var o=e(n),a=void 0,s=void 0,c=!0;if(o){try{a=n(i)}catch(e){c=!1,s=e}if(r===a)return void k(r,new TypeError("A promises callback cannot return that same promise."))}else a=i;r._state!==x||(o&&c?E(r,a):!1===c?k(r,s):1===t?C(r,a):2===t&&k(r,a))}var P=0;function D(e){e[T]=P++,e._state=void 0,e._result=void 0,e._subscribers=[]}var j=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(w),this.promise[T]||D(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&C(this.promise,this._result))):k(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===x&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===M){var i=void 0,o=void 0,a=!1;try{i=e.then}catch(e){a=!0,o=e}if(i===_&&e._state!==x)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===L){var s=new r(w);a?k(s,o):I(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===x&&(this._remaining--,2===e?k(n,r):this._result[t]=r),0===this._remaining&&C(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;O(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))},e}(),L=function(){function t(e){this[T]=P++,this._result=this._state=void 0,this._subscribers=[],w!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){E(e,t)}),(function(t){k(e,t)}))}catch(t){k(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this.constructor;return e(t)?this.then((function(e){return r.resolve(t()).then((function(){return e}))}),(function(e){return r.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return L.prototype.then=_,L.all=function(e){return new j(this,e).promise},L.race=function(e){var t=this;return n(e)?new t((function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},L.resolve=M,L.reject=function(e){var t=new this(w);return k(t,e),t},L._setScheduler=function(e){a=e},L._setAsap=function(e){s=e},L._asap=s,L.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=L},L.Promise=L,L},e.exports=n()}).call(this,r(228),r(49))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=s(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||l||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){var n=r(15),i=r(230),o=Array.prototype;e.exports=function(e){var t=e.indexOf;return e===o||n(o,e)&&t===o.indexOf?i:t}},function(e,t,r){r(231);var n=r(22);e.exports=n("Array").indexOf},function(e,t,r){var n=r(2),i=r(7),o=r(127).indexOf,a=r(71),s=i([].indexOf),c=!!s&&1/s([1],1,-0)<0,u=a("indexOf");n({target:"Array",proto:!0,forced:c||!u},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return c?s(this,e,t)||0:o(this,e,t)}})},function(e,t,r){var n=r(1),i=r(31),o=r(27),a=r(120),s=r(122),c=r(233),u=r(18),l=n.TypeError,d=u("toPrimitive");e.exports=function(e,t){if(!o(e)||a(e))return e;var r,n=s(e,d);if(n){if(void 0===t&&(t="default"),r=i(n,e,t),!o(r)||a(r))return r;throw l("Can't convert object to primitive value")}return void 0===t&&(t="number"),c(e,t)}},function(e,t,r){var n=r(1),i=r(31),o=r(21),a=r(27),s=n.TypeError;e.exports=function(e,t){var r,n;if("string"===t&&o(r=e.toString)&&!a(n=i(r,e)))return n;if(o(r=e.valueOf)&&!a(n=i(r,e)))return n;if("string"!==t&&o(r=e.toString)&&!a(n=i(r,e)))return n;throw s("Can't convert object to primitive value")}},function(e,t,r){var n=r(1),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(84),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=r(237);e.exports=n},function(e,t,r){var n=r(15),i=r(238),o=Array.prototype;e.exports=function(e){var t=e.concat;return e===o||n(o,e)&&t===o.concat?i:t}},function(e,t,r){r(162);var n=r(22);e.exports=n("Array").concat},function(e,t,r){var n=r(1),i=r(72),o=r(98),a=r(27),s=r(18)("species"),c=n.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===c||i(t.prototype))||a(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?c:t}},function(e,t,r){r(99),r(247);var n=r(12);e.exports=n.Array.from},function(e,t,r){var n=r(7),i=r(84),o=r(42),a=r(83),s=n("".charAt),c=n("".charCodeAt),u=n("".slice),l=function(e){return function(t,r){var n,l,d=o(a(t)),p=i(r),f=d.length;return p<0||p>=f?e?"":void 0:(n=c(d,p))<55296||n>56319||p+1===f||(l=c(d,p+1))<56320||l>57343?e?s(d,p):n:e?u(d,p,p+2):l-56320+(n-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}},function(e,t,r){var n=r(1),i=r(21),o=r(130),a=n.WeakMap;e.exports=i(a)&&/native code/.test(o(a))},function(e,t,r){var n=r(166).IteratorPrototype,i=r(86),o=r(57),a=r(87),s=r(75),c=function(){return this};e.exports=function(e,t,r){var u=t+" Iterator";return e.prototype=i(n,{next:o(1,r)}),a(e,u,!1,!0),s[u]=c,e}},function(e,t,r){var n=r(13);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var n=r(129),i=r(47);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,r){var n=r(1),i=r(21),o=n.String,a=n.TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw a("Can't set "+o(e)+" as a prototype")}},function(e,t,r){var n=r(2),i=r(248);n({target:"Array",stat:!0,forced:!r(173)((function(e){Array.from(e)}))},{from:i})},function(e,t,r){var n=r(1),i=r(70),o=r(31),a=r(37),s=r(249),c=r(171),u=r(98),l=r(38),d=r(73),p=r(172),f=r(103),h=n.Array;e.exports=function(e){var t=a(e),r=u(this),n=arguments.length,m=n>1?arguments[1]:void 0,g=void 0!==m;g&&(m=i(m,n>2?arguments[2]:void 0));var v,y,b,S,_,M,T=f(t),w=0;if(!T||this==h&&c(T))for(v=l(t),y=r?new this(v):h(v);v>w;w++)M=g?m(t[w],w):t[w],d(y,w,M);else for(_=(S=p(t,T)).next,y=r?new this:[];!(b=o(_,S)).done;w++)M=g?s(S,m,[b.value,w],!0):b.value,d(y,w,M);return y.length=w,y}},function(e,t,r){var n=r(34),i=r(170);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},function(e,t,r){r(162),r(88),r(175),r(251),r(252),r(253),r(254),r(177),r(255),r(256),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(266);var n=r(12);e.exports=n.Symbol},function(e,t,r){r(20)("asyncIterator")},function(e,t){},function(e,t,r){r(20)("hasInstance")},function(e,t,r){r(20)("isConcatSpreadable")},function(e,t,r){r(20)("match")},function(e,t,r){r(20)("matchAll")},function(e,t,r){r(20)("replace")},function(e,t,r){r(20)("search")},function(e,t,r){r(20)("species")},function(e,t,r){r(20)("split")},function(e,t,r){r(20)("toPrimitive")},function(e,t,r){r(20)("toStringTag")},function(e,t,r){r(20)("unscopables")},function(e,t,r){var n=r(1);r(87)(n.JSON,"JSON",!0)},function(e,t){},function(e,t){},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){var n=r(269);e.exports=n},function(e,t,r){var n=r(270);r(58),e.exports=n},function(e,t,r){r(76),r(99);var n=r(103);e.exports=n},function(e,t,r){r(175);var n=r(12);e.exports=n.Object.getOwnPropertySymbols},function(e,t,r){var n=r(273);e.exports=n},function(e,t,r){r(274);var n=r(12).Object,i=e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)};n.getOwnPropertyDescriptor.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(13),o=r(35),a=r(66).f,s=r(26),c=i((function(){a(1)}));n({target:"Object",stat:!0,forced:!s||c,sham:!s},{getOwnPropertyDescriptor:function(e,t){return a(o(e),t)}})},function(e,t,r){var n=r(276);e.exports=n},function(e,t,r){r(277);var n=r(12);e.exports=n.Object.getOwnPropertyDescriptors},function(e,t,r){var n=r(2),i=r(26),o=r(179),a=r(35),s=r(66),c=r(73);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=a(e),i=s.f,u=o(n),l={},d=0;u.length>d;)void 0!==(r=i(n,t=u[d++]))&&c(l,t,r);return l}})},function(e,t,r){var n=r(279);e.exports=n},function(e,t,r){r(280);var n=r(12).Object,i=e.exports=function(e,t){return n.defineProperties(e,t)};n.defineProperties.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(26);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperties:r(167)})},function(e,t,r){r(282);var n=r(12).Object,i=e.exports=function(e,t,r){return n.defineProperty(e,t,r)};n.defineProperty.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(26);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperty:r(41).f})},function(e,t,r){var n=r(180);e.exports=n},function(e,t,r){r(58);var n=r(47),i=r(25),o=r(15),a=r(285),s=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===s||o(s,e)&&t===s.forEach||i(c,n(e))?a:t}},function(e,t,r){var n=r(286);e.exports=n},function(e,t,r){r(287);var n=r(22);e.exports=n("Array").forEach},function(e,t,r){var n=r(2),i=r(288);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},function(e,t,r){var n=r(79).forEach,i=r(71)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){var n=r(15),i=r(290),o=Array.prototype;e.exports=function(e){var t=e.slice;return e===o||n(o,e)&&t===o.slice?i:t}},function(e,t,r){r(291);var n=r(22);e.exports=n("Array").slice},function(e,t,r){var n=r(2),i=r(1),o=r(72),a=r(98),s=r(27),c=r(97),u=r(38),l=r(35),d=r(73),p=r(18),f=r(85),h=r(89),m=f("slice"),g=p("species"),v=i.Array,y=Math.max;n({target:"Array",proto:!0,forced:!m},{slice:function(e,t){var r,n,i,p=l(this),f=u(p),m=c(e,f),b=c(void 0===t?f:t,f);if(o(p)&&(r=p.constructor,(a(r)&&(r===v||o(r.prototype))||s(r)&&null===(r=r[g]))&&(r=void 0),r===v||void 0===r))return h(p,m,b);for(n=new(void 0===r?v:r)(y(b-m,0)),i=0;m<b;m++,i++)m in p&&d(n,i,p[m]);return n.length=i,n}})},function(e,t,r){r(293);var n=r(12);e.exports=n.Object.keys},function(e,t,r){var n=r(2),i=r(37),o=r(91);n({target:"Object",stat:!0,forced:r(13)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},function(e,t,r){var n=r(295);e.exports=n},function(e,t,r){var n=r(15),i=r(296),o=Array.prototype;e.exports=function(e){var t=e.some;return e===o||n(o,e)&&t===o.some?i:t}},function(e,t,r){r(297);var n=r(22);e.exports=n("Array").some},function(e,t,r){var n=r(2),i=r(79).some;n({target:"Array",proto:!0,forced:!r(71)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(299);e.exports=n},function(e,t,r){var n=r(15),i=r(300),o=Array.prototype;e.exports=function(e){var t=e.splice;return e===o||n(o,e)&&t===o.splice?i:t}},function(e,t,r){r(301);var n=r(22);e.exports=n("Array").splice},function(e,t,r){var n=r(2),i=r(1),o=r(97),a=r(84),s=r(38),c=r(37),u=r(128),l=r(73),d=r(85)("splice"),p=i.TypeError,f=Math.max,h=Math.min;n({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var r,n,i,d,m,g,v=c(this),y=s(v),b=o(e,y),S=arguments.length;if(0===S?r=n=0:1===S?(r=0,n=y-b):(r=S-2,n=h(f(a(t),0),y-b)),y+r-n>9007199254740991)throw p("Maximum allowed length exceeded");for(i=u(v,n),d=0;d<n;d++)(m=b+d)in v&&l(i,d,v[m]);if(i.length=n,r<n){for(d=b;d<y-n;d++)g=d+r,(m=d+n)in v?v[g]=v[m]:delete v[g];for(d=y;d>y-n+r;d--)delete v[d-1]}else if(r>n)for(d=y-n;d>b;d--)g=d+r-1,(m=d+n-1)in v?v[g]=v[m]:delete v[g];for(d=0;d<r;d++)v[d+b]=arguments[d+2];return v.length=y-n+r,i}})},function(e,t,r){var n=r(303);e.exports=n},function(e,t,r){var n=r(15),i=r(304),o=Array.prototype;e.exports=function(e){var t=e.sort;return e===o||n(o,e)&&t===o.sort?i:t}},function(e,t,r){r(305);var n=r(22);e.exports=n("Array").sort},function(e,t,r){var n=r(2),i=r(7),o=r(39),a=r(37),s=r(38),c=r(42),u=r(13),l=r(306),d=r(71),p=r(307),f=r(308),h=r(68),m=r(309),g=[],v=i(g.sort),y=i(g.push),b=u((function(){g.sort(void 0)})),S=u((function(){g.sort(null)})),_=d("sort"),M=!u((function(){if(h)return h<70;if(!(p&&p>3)){if(f)return!0;if(m)return m<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)g.push({k:t+n,v:r})}for(g.sort((function(e,t){return t.v-e.v})),n=0;n<g.length;n++)t=g[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));n({target:"Array",proto:!0,forced:b||!S||!_||!M},{sort:function(e){void 0!==e&&o(e);var t=a(this);if(M)return void 0===e?v(t):v(t,e);var r,n,i=[],u=s(t);for(n=0;n<u;n++)n in t&&y(i,t[n]);for(l(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:c(t)>c(r)?1:-1}}(e)),r=i.length,n=0;n<r;)t[n]=i[n++];for(;n<u;)delete t[n++];return t}})},function(e,t,r){var n=r(135),i=Math.floor,o=function(e,t){var r=e.length,c=i(r/2);return r<8?a(e,t):s(e,o(n(e,0,c),t),o(n(e,c),t),t)},a=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},s=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e};e.exports=o},function(e,t,r){var n=r(45).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},function(e,t,r){var n=r(45);e.exports=/MSIE|Trident/.test(n)},function(e,t,r){var n=r(45).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},function(e,t,r){r(311);var n=r(12);e.exports=n.Array.isArray},function(e,t,r){r(2)({target:"Array",stat:!0},{isArray:r(72)})},function(e,t,r){var n=r(313);e.exports=n},function(e,t,r){var n=r(15),i=r(314),o=Array.prototype;e.exports=function(e){var t=e.map;return e===o||n(o,e)&&t===o.map?i:t}},function(e,t,r){r(315);var n=r(22);e.exports=n("Array").map},function(e,t,r){var n=r(2),i=r(79).map;n({target:"Array",proto:!0,forced:!r(85)("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(317);e.exports=n},function(e,t,r){r(318);var n=r(12),i=r(56);n.JSON||(n.JSON={stringify:JSON.stringify}),e.exports=function(e,t,r){return i(n.JSON.stringify,null,arguments)}},function(e,t,r){var n=r(2),i=r(1),o=r(36),a=r(56),s=r(7),c=r(13),u=i.Array,l=o("JSON","stringify"),d=s(/./.exec),p=s("".charAt),f=s("".charCodeAt),h=s("".replace),m=s(1..toString),g=/[\uD800-\uDFFF]/g,v=/^[\uD800-\uDBFF]$/,y=/^[\uDC00-\uDFFF]$/,b=function(e,t,r){var n=p(r,t-1),i=p(r,t+1);return d(v,e)&&!d(y,i)||d(y,e)&&!d(v,n)?"\\u"+m(f(e,0),16):e},S=c((function(){return'"\\udf06\\ud834"'!==l("\udf06\ud834")||'"\\udead"'!==l("\udead")}));l&&n({target:"JSON",stat:!0,forced:S},{stringify:function(e,t,r){for(var n=0,i=arguments.length,o=u(i);n<i;n++)o[n]=arguments[n];var s=a(l,null,o);return"string"==typeof s?h(s,g,b):s}})},function(e,t,r){var n=r(320);e.exports=n},function(e,t,r){var n=r(15),i=r(321),o=Array.prototype;e.exports=function(e){var t=e.reduce;return e===o||n(o,e)&&t===o.reduce?i:t}},function(e,t,r){r(322);var n=r(22);e.exports=n("Array").reduce},function(e,t,r){var n=r(2),i=r(323).left,o=r(71),a=r(68),s=r(105);n({target:"Array",proto:!0,forced:!o("reduce")||!s&&a>79&&a<83},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(1),i=r(39),o=r(37),a=r(94),s=r(38),c=n.TypeError,u=function(e){return function(t,r,n,u){i(r);var l=o(t),d=a(l),p=s(l),f=e?p-1:0,h=e?-1:1;if(n<2)for(;;){if(f in d){u=d[f],f+=h;break}if(f+=h,e?f<0:p<=f)throw c("Reduce of empty array with no initial value")}for(;e?f>=0:p>f;f+=h)f in d&&(u=r(u,d[f],f,l));return u}};e.exports={left:u(!1),right:u(!0)}},function(e,t,r){var n=r(325);e.exports=n},function(e,t,r){var n=r(15),i=r(326),o=Array.prototype;e.exports=function(e){var t=e.lastIndexOf;return e===o||n(o,e)&&t===o.lastIndexOf?i:t}},function(e,t,r){r(327);var n=r(22);e.exports=n("Array").lastIndexOf},function(e,t,r){var n=r(2),i=r(328);n({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},function(e,t,r){var n=r(56),i=r(35),o=r(84),a=r(38),s=r(71),c=Math.min,u=[].lastIndexOf,l=!!u&&1/[1].lastIndexOf(1,-0)<0,d=s("lastIndexOf"),p=l||!d;e.exports=p?function(e){if(l)return n(u,this,arguments)||0;var t=i(this),r=a(t),s=r-1;for(arguments.length>1&&(s=c(s,o(arguments[1]))),s<0&&(s=r+s);s>=0;s--)if(s in t&&t[s]===e)return s||0;return-1}:u},function(e,t,r){r(184);var n=r(12);e.exports=n.setTimeout},function(e,t,r){var n=r(331);e.exports=n},function(e,t,r){var n=r(15),i=r(332),o=Array.prototype;e.exports=function(e){var t=e.filter;return e===o||n(o,e)&&t===o.filter?i:t}},function(e,t,r){r(333);var n=r(22);e.exports=n("Array").filter},function(e,t,r){var n=r(2),i=r(79).filter;n({target:"Array",proto:!0,forced:!r(85)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(335)},function(e,t,r){r(58);var n=r(47),i=r(25),o=r(15),a=r(336),s=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.values;return e===s||o(s,e)&&t===s.values||i(c,n(e))?a:t}},function(e,t,r){var n=r(337);e.exports=n},function(e,t,r){r(76),r(88);var n=r(22);e.exports=n("Array").values},function(e,t,r){r(214),r(76),r(88),r(344),r(215),r(216),r(354),r(99);var n=r(12);e.exports=n.Promise},function(e,t,r){var n=r(25),i=r(179),o=r(66),a=r(41);e.exports=function(e,t){for(var r=i(t),s=a.f,c=o.f,u=0;u<r.length;u++){var l=r[u];n(e,l)||s(e,l,c(t,l))}}},function(e,t,r){var n=r(7),i=r(135),o=n("".replace),a=n("".split),s=n([].join),c=String(Error("zxcasd").stack),u=/\n\s*at [^:]*:[^\n]*/,l=u.test(c),d=/@[^\n]*\n/.test(c)&&!/zxcasd/.test(c);e.exports=function(e,t){if("string"!=typeof e)return e;if(l)for(;t--;)e=o(e,u,"");else if(d)return s(i(a(e,"\n"),t),"\n");return e}},function(e,t,r){var n=r(27),i=r(46);e.exports=function(e,t){n(t)&&"cause"in t&&i(e,"cause",t.cause)}},function(e,t,r){var n=r(42);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},function(e,t,r){var n=r(13),i=r(57);e.exports=!n((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)}))},function(e,t,r){var n,i,o,a,s=r(2),c=r(69),u=r(1),l=r(36),d=r(31),p=r(185),f=r(74),h=r(345),m=r(133),g=r(87),v=r(346),y=r(39),b=r(21),S=r(27),_=r(347),M=r(130),T=r(107),w=r(173),x=r(186),I=r(187).set,E=r(349),A=r(189),C=r(352),k=r(92),O=r(115),N=r(100),R=r(161),P=r(18),D=r(353),j=r(105),L=r(68),z=P("species"),U=N.get,B=N.set,F=N.getterFor("Promise"),V=p&&p.prototype,H=p,$=V,W=u.TypeError,Y=u.document,G=u.process,Q=k.f,q=Q,J=!!(Y&&Y.createEvent&&u.dispatchEvent),Z=b(u.PromiseRejectionEvent),K=!1,X=R("Promise",(function(){var e=M(H),t=e!==String(H);if(!t&&66===L)return!0;if(c&&!$.finally)return!0;if(L>=51&&/native code/.test(e))return!1;var r=new H((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[z]=n,!(K=r.then((function(){}))instanceof n)||!t&&D&&!Z})),ee=X||!w((function(e){H.all(e).catch((function(){}))})),te=function(e){var t;return!(!S(e)||!b(t=e.then))&&t},re=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;E((function(){for(var n=e.value,i=1==e.state,o=0;r.length>o;){var a,s,c,u=r[o++],l=i?u.ok:u.fail,p=u.resolve,f=u.reject,h=u.domain;try{l?(i||(2===e.rejection&&ae(e),e.rejection=1),!0===l?a=n:(h&&h.enter(),a=l(n),h&&(h.exit(),c=!0)),a===u.promise?f(W("Promise-chain cycle")):(s=te(a))?d(s,a,p,f):p(a)):f(n)}catch(e){h&&!c&&h.exit(),f(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&ie(e)}))}},ne=function(e,t,r){var n,i;J?((n=Y.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!Z&&(i=u["on"+e])?i(n):"unhandledrejection"===e&&C("Unhandled promise rejection",r)},ie=function(e){d(I,u,(function(){var t,r=e.facade,n=e.value;if(oe(e)&&(t=O((function(){j?G.emit("unhandledRejection",n,r):ne("unhandledrejection",r,n)})),e.rejection=j||oe(e)?2:1,t.error))throw t.value}))},oe=function(e){return 1!==e.rejection&&!e.parent},ae=function(e){d(I,u,(function(){var t=e.facade;j?G.emit("rejectionHandled",t):ne("rejectionhandled",t,e.value)}))},se=function(e,t,r){return function(n){e(t,n,r)}},ce=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,re(e,!0))},ue=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw W("Promise can't be resolved itself");var n=te(t);n?E((function(){var r={done:!1};try{d(n,t,se(ue,r,e),se(ce,r,e))}catch(t){ce(r,t,e)}})):(e.value=t,e.state=1,re(e,!1))}catch(t){ce({done:!1},t,e)}}};if(X&&($=(H=function(e){_(this,$),y(e),d(n,this);var t=U(this);try{e(se(ue,t),se(ce,t))}catch(e){ce(t,e)}}).prototype,(n=function(e){B(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=h($,{then:function(e,t){var r=F(this),n=r.reactions,i=Q(x(this,H));return i.ok=!b(e)||e,i.fail=b(t)&&t,i.domain=j?G.domain:void 0,r.parent=!0,n[n.length]=i,0!=r.state&&re(r,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=U(e);this.promise=e,this.resolve=se(ue,t),this.reject=se(ce,t)},k.f=Q=function(e){return e===H||e===o?new i(e):q(e)},!c&&b(p)&&V!==Object.prototype)){a=V.then,K||(f(V,"then",(function(e,t){var r=this;return new H((function(e,t){d(a,r,e,t)})).then(e,t)}),{unsafe:!0}),f(V,"catch",$.catch,{unsafe:!0}));try{delete V.constructor}catch(e){}m&&m(V,$)}s({global:!0,wrap:!0,forced:X},{Promise:H}),g(H,"Promise",!1,!0),v("Promise"),o=l("Promise"),s({target:"Promise",stat:!0,forced:X},{reject:function(e){var t=Q(this);return d(t.reject,void 0,e),t.promise}}),s({target:"Promise",stat:!0,forced:c||X},{resolve:function(e){return A(c&&this===o?H:this,e)}}),s({target:"Promise",stat:!0,forced:ee},{all:function(e){var t=this,r=Q(t),n=r.resolve,i=r.reject,o=O((function(){var r=y(t.resolve),o=[],a=0,s=1;T(e,(function(e){var c=a++,u=!1;s++,d(r,t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=Q(t),n=r.reject,i=O((function(){var i=y(t.resolve);T(e,(function(e){d(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},function(e,t,r){var n=r(74);e.exports=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:n(e,i,t[i],r);return e}},function(e,t,r){var n=r(36),i=r(41),o=r(18),a=r(26),s=o("species");e.exports=function(e){var t=n(e),r=i.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(1),i=r(15),o=n.TypeError;e.exports=function(e,t){if(i(t,e))return e;throw o("Incorrect invocation")}},function(e,t,r){var n=r(1),i=r(98),o=r(96),a=n.TypeError;e.exports=function(e){if(i(e))return e;throw a(o(e)+" is not a constructor")}},function(e,t,r){var n,i,o,a,s,c,u,l,d=r(1),p=r(70),f=r(66).f,h=r(187).set,m=r(188),g=r(350),v=r(351),y=r(105),b=d.MutationObserver||d.WebKitMutationObserver,S=d.document,_=d.process,M=d.Promise,T=f(d,"queueMicrotask"),w=T&&T.value;w||(n=function(){var e,t;for(y&&(e=_.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():o=void 0,e}}o=void 0,e&&e.enter()},m||y||v||!b||!S?!g&&M&&M.resolve?((u=M.resolve(void 0)).constructor=M,l=p(u.then,u),a=function(){l(n)}):y?a=function(){_.nextTick(n)}:(h=p(h,d),a=function(){h(n)}):(s=!0,c=S.createTextNode(""),new b(n).observe(c,{characterData:!0}),a=function(){c.data=s=!s})),e.exports=w||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,a()),o=t}},function(e,t,r){var n=r(45),i=r(1);e.exports=/ipad|iphone|ipod/i.test(n)&&void 0!==i.Pebble},function(e,t,r){var n=r(45);e.exports=/web0s(?!.*chrome)/i.test(n)},function(e,t,r){var n=r(1);e.exports=function(e,t){var r=n.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}},function(e,t){e.exports="object"==typeof window},function(e,t,r){var n=r(2),i=r(69),o=r(185),a=r(13),s=r(36),c=r(21),u=r(186),l=r(189),d=r(74);if(n({target:"Promise",proto:!0,real:!0,forced:!!o&&a((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=u(this,s("Promise")),r=c(e);return this.then(r?function(r){return l(t,e()).then((function(){return r}))}:e,r?function(r){return l(t,e()).then((function(){throw r}))}:e)}}),!i&&c(o)){var p=s("Promise").prototype.finally;o.prototype.finally!==p&&d(o.prototype,"finally",p,{unsafe:!0})}},function(e,t,r){var n=r(174);r(356),r(357),r(358),r(359),r(360),r(361),r(362),e.exports=n},function(e,t,r){r(20)("asyncDispose")},function(e,t,r){r(20)("dispose")},function(e,t,r){r(20)("matcher")},function(e,t,r){r(20)("metadata")},function(e,t,r){r(20)("observable")},function(e,t,r){r(20)("patternMatch")},function(e,t,r){r(20)("replaceAll")},function(e,t,r){e.exports=r(364)},function(e,t,r){var n=r(365);e.exports=n},function(e,t,r){var n=r(366);r(58),e.exports=n},function(e,t,r){r(76),r(88),r(99),r(177);var n=r(137);e.exports=n.f("iterator")},function(e,t,r){var n=r(17);"undefined"!=typeof window&&(window.console||n.isWeixinApp||(window.console={log:function(){},info:function(){},warn:function(){},error:function(){}}))},function(e,t,r){var n=r(191),i=r(192);e.exports=function(e){if(n(e))return i(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(183);e.exports=n},function(e,t,r){var n=r(138),i=r(80),o=r(193);e.exports=function(e){if(void 0!==n&&null!=i(e)||null!=e["@@iterator"])return o(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(163);e.exports=n},function(e,t,r){e.exports=r(373)},function(e,t,r){var n=r(181);e.exports=n},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(376);e.exports=n},function(e,t,r){r(377);var n=r(12).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){r(2)({target:"Object",stat:!0,sham:!r(26)},{create:r(86)})},function(e,t,r){e.exports=r(379)},function(e,t,r){var n=r(380);e.exports=n},function(e,t,r){r(381);var n=r(12).Object;e.exports=function(e){return n.getOwnPropertyNames(e)}},function(e,t,r){var n=r(2),i=r(13),o=r(176).f;n({target:"Object",stat:!0,forced:i((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:o})},function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),s.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e,t){var r=i?i+e:e,n=this._events[r];if(t)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var o=0,a=n.length,s=new Array(a);o<a;o++)s[o]=n[o].fn;return s},s.prototype.emit=function(e,t,r,n,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,o),!0;case 6:return l.fn.call(l.context,t,r,n,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,n);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,r){var n=new a(t,r||this),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},s.prototype.once=function(e,t,r){var n=new a(t,r||this,!0),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},s.prototype.removeListener=function(e,t,r,n){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return 0==--this._eventsCount?this._events=new o:delete this._events[a],this;var s=this._events[a];if(s.fn)s.fn!==t||n&&!s.once||r&&s.context!==r||(0==--this._eventsCount?this._events=new o:delete this._events[a]);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||n&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[a]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new o:delete this._events[a]}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new o:delete this._events[t])):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=i,s.EventEmitter=s,e.exports=s},function(e,t,r){e.exports=r(384)},function(e,t,r){var n=r(385);e.exports=n},function(e,t,r){r(386);var n=r(12);e.exports=n.parseFloat},function(e,t,r){var n=r(2),i=r(387);n({global:!0,forced:parseFloat!=i},{parseFloat:i})},function(e,t,r){var n=r(1),i=r(13),o=r(7),a=r(42),s=r(139).trim,c=r(108),u=o("".charAt),l=n.parseFloat,d=n.Symbol,p=d&&d.iterator,f=1/l(c+"-0")!=-1/0||p&&!i((function(){l(Object(p))}));e.exports=f?function(e){var t=s(a(e)),r=l(t);return 0===r&&"-"==u(t,0)?-0:r}:l},function(e,t,r){var n=r(389);e.exports=n},function(e,t,r){r(390);var n=r(12);e.exports=n.parseInt},function(e,t,r){var n=r(2),i=r(391);n({global:!0,forced:parseInt!=i},{parseInt:i})},function(e,t,r){var n=r(1),i=r(13),o=r(7),a=r(42),s=r(139).trim,c=r(108),u=n.parseInt,l=n.Symbol,d=l&&l.iterator,p=/^[+-]?0x/i,f=o(p.exec),h=8!==u(c+"08")||22!==u(c+"0x16")||d&&!i((function(){u(Object(d))}));e.exports=h?function(e,t){var r=s(a(e));return u(r,t>>>0||(f(p,r)?16:10))}:u},function(e,t,r){var n=r(16),i=r(4),o=r(393),a=r(394),s=r(0).getGlobal(),c=r(53).name,u="function"==typeof o,l=s.indexedDB&&!/^(IE)$/.test(c);function d(e,t){this.logWorker=null,this.db=null,this.logQueue=[],this.callbackList=[],this.preTime=null,this.lastTime=+new Date,this.initLogLocal({name:e,expire:t})}var p=d.prototype;d.enable=!0,p.saveLog=function(e){var t,r=this.logQueue.length,i=this.logQueue[r-1];e.time!==this.preTime?((this.logQueue.length>50||e.time-this.lastTime>6e4&&this.logQueue.length>0)&&(this.doSaveLog(n(t=this.logQueue).call(t,0)),this.lastTime=i.time,this.logQueue=[]),this.logQueue.push(e),this.preTime=e.time):i.log+="\r\n"+e.log},p.doSaveLog=function(){},p.initLogLocal=function(){},p.fetchLog=function(){},p.deleteLogs=function(e){},p.logError=function(){},l?u?(p.doSaveLog=function(e){this.logWorker.postMessage(e)},p.initLogLocal=function(e){var t=this;this.logWorker=new o({}),this.logWorker.onmessage=function(e){var r=e.data||{};switch(r.type){case"fetchDone":t.fetchLogDone(r.code,r.msg);break;case"error":t.logError(r.msg)}},this.logWorker.postMessage({type:"init",msg:e})},p.fetchLog=function(){var e=this;return new i((function(t,r){0===e.callbackList.length&&e.logWorker.postMessage({type:"fetch"}),e.callbackList.push(t),e.callbackList.push(r)}))},p.fetchLogDone=function(e,t){for(var r=200===e?0:1,n=0;n<this.callbackList.length/2;n++)this.callbackList[2*n+r](t);this.callbackList=[]},p.deleteLogs=function(e){return this.logWorker.postMessage({type:"delete",msg:e}),i.resolve()}):(p.doSaveLog=function(e){var t=this;this.db.putLog(e).catch((function(e){t.logError({msg:"putLog error",error:e})}))},p.initLogLocal=function(e){var t=this;this.db=new a(e),this.db.init().catch((function(e){t.logError({msg:"dbLog init error",error:e})}))},p.fetchLog=function(){return this.db.getAllLogs()},p.deleteLogs=function(e){return this.db.deleteLogs(e)}):d.enable=!1,e.exports=d},function(e,t,r){r.r(t),r.d(t,"default",(function(){return o}));var n=r(210),i=r.n(n);function o(){return i()('!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=96)}([function(t,n,e){(function(n){var e=function(t){return t&&t.Math==Math&&t};t.exports=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof n&&n)||function(){return this}()||Function("return this")()}).call(this,e(73))},function(t,n,e){var r=e(14),o=e(7),i=e(71),c=e(15).f;t.exports=function(t){var n=r.Symbol||(r.Symbol={});o(n,t)||c(n,t,{value:i.f(t)})}},function(t,n,e){var r=e(0),o=e(51),i=e(7),c=e(53),u=e(49),a=e(76),s=o("wks"),f=r.Symbol,p=f&&f.for,l=a?f:f&&f.withoutSetter||c;t.exports=function(t){if(!i(s,t)||!u&&"string"!=typeof s[t]){var n="Symbol."+t;u&&i(f,t)?s[t]=f[t]:s[t]=a&&p?p(n):l(n)}return s[t]}},function(t,n){t.exports=function(t){return"function"==typeof t}},function(t,n){var e=Function.prototype,r=e.bind,o=e.call,i=r&&r.bind(o);t.exports=r?function(t){return t&&i(o,t)}:function(t){return t&&function(){return o.apply(t,arguments)}}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){"use strict";var r=e(0),o=e(46),i=e(4),c=e(3),u=e(31).f,a=e(78),s=e(14),f=e(27),p=e(17),l=e(7),v=function(t){var n=function(e,r,i){if(this instanceof n){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,i)}return o(t,this,arguments)};return n.prototype=t.prototype,n};t.exports=function(t,n){var e,o,d,h,y,m,g,x,b=t.target,w=t.global,S=t.stat,j=t.proto,O=w?r:S?r[b]:(r[b]||{}).prototype,P=w?s:s[b]||p(s,b,{})[b],A=P.prototype;for(d in n)e=!a(w?d:b+(S?".":"#")+d,t.forced)&&O&&l(O,d),y=P[d],e&&(m=t.noTargetGet?(x=u(O,d))&&x.value:O[d]),h=e&&m?m:n[d],e&&typeof y==typeof h||(g=t.bind&&e?f(h,r):t.wrap&&e?v(h):j&&c(h)?i(h):h,(t.sham||h&&h.sham||y&&y.sham)&&p(g,"sham",!0),p(P,d,g),j&&(l(s,o=b+"Prototype")||p(s,o,{}),p(s[o],d,h),t.real&&A&&!A[d]&&p(A,d,h)))}},function(t,n,e){var r=e(4),o=e(21),i=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,n){return i(o(t),n)}},function(t,n,e){var r=e(3);t.exports=function(t){return"object"==typeof t?null!==t:r(t)}},function(t,n){var e=Function.prototype.call;t.exports=e.bind?e.bind(e):function(){return e.apply(e,arguments)}},function(t,n,e){var r=e(0),o=e(8),i=r.String,c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not an object")}},function(t,n,e){var r=e(14),o=e(0),i=e(3),c=function(t){return i(t)?t:void 0};t.exports=function(t,n){return arguments.length<2?c(r[t])||c(o[t]):r[t]&&r[t][n]||o[t]&&o[t][n]}},function(t,n,e){var r=e(4);t.exports=r({}.isPrototypeOf)},function(t,n,e){var r=e(5);t.exports=!r(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},function(t,n){t.exports={}},function(t,n,e){var r=e(0),o=e(13),i=e(77),c=e(10),u=e(32),a=r.TypeError,s=Object.defineProperty;n.f=o?s:function(t,n,e){if(c(t),n=u(n),c(e),i)try{return s(t,n,e)}catch(t){}if("get"in e||"set"in e)throw a("Accessors not supported");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(75),o=e(47);t.exports=function(t){return r(o(t))}},function(t,n,e){var r=e(13),o=e(15),i=e(18);t.exports=r?function(t,n,e){return o.f(t,n,i(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,e){var r=e(0),o=e(3),i=e(35),c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not a function")}},function(t,n){t.exports=!0},function(t,n,e){var r=e(0),o=e(47),i=r.Object;t.exports=function(t){return i(o(t))}},function(t,n,e){var r=e(109);t.exports=function(t){return r(t.length)}},function(t,n){t.exports={}},function(t,n,e){var r=e(0),o=e(63),i=e(3),c=e(26),u=e(2)("toStringTag"),a=r.Object,s="Arguments"==c(function(){return arguments}());t.exports=o?c:function(t){var n,e,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,n){try{return t[n]}catch(t){}}(n=a(t),u))?e:s?c(n):"Object"==(r=c(n))&&i(n.callee)?"Arguments":r}},function(t,n,e){var r=e(17);t.exports=function(t,n,e,o){o&&o.enumerable?t[n]=e:r(t,n,e)}},function(t,n,e){var r=e(4),o=r({}.toString),i=r("".slice);t.exports=function(t){return i(o(t),8,-1)}},function(t,n,e){var r=e(4),o=e(19),i=r(r.bind);t.exports=function(t,n){return o(t),void 0===n?t:i?i(t,n):function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(63),o=e(15).f,i=e(17),c=e(7),u=e(122),a=e(2)("toStringTag");t.exports=function(t,n,e,s){if(t){var f=e?t:t.prototype;c(f,a)||o(f,a,{configurable:!0,value:n}),s&&!r&&i(f,"toString",u)}}},function(t,n,e){var r=e(26);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){var r=e(14);t.exports=function(t){return r[t+"Prototype"]}},function(t,n,e){var r=e(13),o=e(9),i=e(74),c=e(18),u=e(16),a=e(32),s=e(7),f=e(77),p=Object.getOwnPropertyDescriptor;n.f=r?p:function(t,n){if(t=u(t),n=a(n),f)try{return p(t,n)}catch(t){}if(s(t,n))return c(!o(i.f,t,n),t[n])}},function(t,n,e){var r=e(101),o=e(48);t.exports=function(t){var n=r(t,"string");return o(n)?n:n+""}},function(t,n,e){var r,o,i=e(0),c=e(34),u=i.process,a=i.Deno,s=u&&u.versions||a&&a.version,f=s&&s.v8;f&&(o=(r=f.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!o&&c&&(!(r=c.match(/Edge\\/(\\d+)/))||r[1]>=74)&&(r=c.match(/Chrome\\/(\\d+)/))&&(o=+r[1]),t.exports=o},function(t,n,e){var r=e(11);t.exports=r("navigator","userAgent")||""},function(t,n,e){var r=e(0).String;t.exports=function(t){try{return r(t)}catch(t){return"Object"}}},function(t,n,e){var r=e(51),o=e(53),i=r("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},function(t,n){t.exports={}},function(t,n,e){var r,o=e(10),i=e(110),c=e(60),u=e(37),a=e(81),s=e(54),f=e(36),p=f("IE_PROTO"),l=function(){},v=function(t){return"<script>"+t+"<\\/script>"},d=function(t){t.write(v("")),t.close();var n=t.parentWindow.Object;return t=null,n},h=function(){try{r=new ActiveXObject("htmlfile")}catch(t){}var t,n;h="undefined"!=typeof document?document.domain&&r?d(r):((n=s("iframe")).style.display="none",a.appendChild(n),n.src=String("javascript:"),(t=n.contentWindow.document).open(),t.write(v("document.F=Object")),t.close(),t.F):d(r);for(var e=c.length;e--;)delete h.prototype[c[e]];return h()};u[p]=!0,t.exports=Object.create||function(t,n){var e;return null!==t?(l.prototype=o(t),e=new l,l.prototype=null,e[p]=t):e=h(),void 0===n?e:i(e,n)}},function(t,n,e){var r=e(0),o=e(27),i=e(9),c=e(10),u=e(35),a=e(113),s=e(22),f=e(12),p=e(114),l=e(83),v=e(115),d=r.TypeError,h=function(t,n){this.stopped=t,this.result=n},y=h.prototype;t.exports=function(t,n,e){var r,m,g,x,b,w,S,j=e&&e.that,O=!(!e||!e.AS_ENTRIES),P=!(!e||!e.IS_ITERATOR),A=!(!e||!e.INTERRUPTED),E=o(n,j),k=function(t){return r&&v(r,"normal",t),new h(!0,t)},T=function(t){return O?(c(t),A?E(t[0],t[1],k):E(t[0],t[1])):A?E(t,k):E(t)};if(P)r=t;else{if(!(m=l(t)))throw d(u(t)+" is not iterable");if(a(m)){for(g=0,x=s(t);x>g;g++)if((b=T(t[g]))&&f(y,b))return b;return new h(!1)}r=p(t,m)}for(w=r.next;!(S=i(w,r)).done;){try{b=T(S.value)}catch(t){v(r,"throw",t)}if("object"==typeof b&&b&&f(y,b))return b}return new h(!1)}},function(t,n,e){var r=e(0),o=e(24),i=r.String;t.exports=function(t){if("Symbol"===o(t))throw TypeError("Cannot convert a Symbol value to a string");return i(t)}},function(t,n,e){var r,o,i,c=e(119),u=e(0),a=e(4),s=e(8),f=e(17),p=e(7),l=e(52),v=e(36),d=e(37),h=u.TypeError,y=u.WeakMap;if(c||l.state){var m=l.state||(l.state=new y),g=a(m.get),x=a(m.has),b=a(m.set);r=function(t,n){if(x(m,t))throw new h("Object already initialized");return n.facade=t,b(m,t,n),n},o=function(t){return g(m,t)||{}},i=function(t){return x(m,t)}}else{var w=v("state");d[w]=!0,r=function(t,n){if(p(t,w))throw new h("Object already initialized");return n.facade=t,f(t,w,n),n},o=function(t){return p(t,w)?t[w]:{}},i=function(t){return p(t,w)}}t.exports={set:r,get:o,has:i,enforce:function(t){return i(t)?o(t):r(t,{})},getterFor:function(t){return function(n){var e;if(!s(n)||(e=o(n)).type!==t)throw h("Incompatible receiver, "+t+" required");return e}}}},function(t,n,e){"use strict";var r=e(19),o=function(t){var n,e;this.promise=new t(function(t,r){if(void 0!==n||void 0!==e)throw TypeError("Bad Promise constructor");n=t,e=r}),this.resolve=r(n),this.reject=r(e)};t.exports.f=function(t){return new o(t)}},function(t,n,e){e(64);var r=e(138),o=e(0),i=e(24),c=e(17),u=e(23),a=e(2)("toStringTag");for(var s in r){var f=o[s],p=f&&f.prototype;p&&i(p)!==a&&c(p,a,s),u[s]=u.Array}},function(t,n,e){var r=e(5),o=e(2),i=e(33),c=o("species");t.exports=function(t){return i>=51||!r(function(){var n=[];return(n.constructor={})[c]=function(){return{foo:1}},1!==n[t](Boolean).foo})}},function(t,n,e){var r=e(27),o=e(4),i=e(75),c=e(21),u=e(22),a=e(93),s=o([].push),f=function(t){var n=1==t,e=2==t,o=3==t,f=4==t,p=6==t,l=7==t,v=5==t||p;return function(d,h,y,m){for(var g,x,b=c(d),w=i(b),S=r(h,y),j=u(w),O=0,P=m||a,A=n?P(d,j):e||l?P(d,0):void 0;j>O;O++)if((v||O in w)&&(x=S(g=w[O],O,b),t))if(n)A[O]=x;else if(x)switch(t){case 3:return!0;case 5:return g;case 6:return O;case 2:s(A,g)}else switch(t){case 4:return!1;case 7:s(A,g)}return p?-1:o||f?f:A}};t.exports={forEach:f(0),map:f(1),filter:f(2),some:f(3),every:f(4),find:f(5),findIndex:f(6),filterReject:f(7)}},function(t,n){var e=Function.prototype,r=e.apply,o=e.bind,i=e.call;t.exports="object"==typeof Reflect&&Reflect.apply||(o?i.bind(r):function(){return i.apply(r,arguments)})},function(t,n,e){var r=e(0).TypeError;t.exports=function(t){if(null==t)throw r("Can\'t call method on "+t);return t}},function(t,n,e){var r=e(0),o=e(11),i=e(3),c=e(12),u=e(76),a=r.Object;t.exports=u?function(t){return"symbol"==typeof t}:function(t){var n=o("Symbol");return i(n)&&c(n.prototype,a(t))}},function(t,n,e){var r=e(33),o=e(5);t.exports=!!Object.getOwnPropertySymbols&&!o(function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41})},function(t,n,e){var r=e(19);t.exports=function(t,n){var e=t[n];return null==e?void 0:r(e)}},function(t,n,e){var r=e(20),o=e(52);(t.exports=function(t,n){return o[t]||(o[t]=void 0!==n?n:{})})("versions",[]).push({version:"3.19.2",mode:r?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(t,n,e){var r=e(0),o=e(103),i=r["__core-js_shared__"]||o("__core-js_shared__",{});t.exports=i},function(t,n,e){var r=e(4),o=0,i=Math.random(),c=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+c(++o+i,36)}},function(t,n,e){var r=e(0),o=e(8),i=r.document,c=o(i)&&o(i.createElement);t.exports=function(t){return c?i.createElement(t):{}}},function(t,n,e){var r=e(0),o=e(7),i=e(3),c=e(21),u=e(36),a=e(104),s=u("IE_PROTO"),f=r.Object,p=f.prototype;t.exports=a?f.getPrototypeOf:function(t){var n=c(t);if(o(n,s))return n[s];var e=n.constructor;return i(e)&&n instanceof e?e.prototype:n instanceof f?p:null}},function(t,n,e){var r=e(4),o=e(10),i=e(105);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,n=!1,e={};try{(t=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(e,[]),n=e instanceof Array}catch(t){}return function(e,r){return o(e),i(r),n?t(e,r):e.__proto__=r,e}}():void 0)},function(t,n,e){var r=e(79),o=e(60).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n,e){var r=e(59),o=Math.max,i=Math.min;t.exports=function(t,n){var e=r(t);return e<0?o(e+n,0):i(e,n)}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){var n=+t;return n!=n||0===n?0:(n>0?r:e)(n)}},function(t,n){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,n,e){var r=e(79),o=e(60);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){"use strict";var r=e(32),o=e(15),i=e(18);t.exports=function(t,n,e){var c=r(n);c in t?o.f(t,c,i(0,e)):t[c]=e}},function(t,n,e){var r={};r[e(2)("toStringTag")]="z",t.exports="[object z]"===String(r)},function(t,n,e){"use strict";var r=e(16),o=e(118),i=e(23),c=e(41),u=e(84),a=c.set,s=c.getterFor("Array Iterator");t.exports=u(Array,"Array",function(t,n){a(this,{type:"Array Iterator",target:r(t),index:0,kind:n})},function(){var t=s(this),n=t.target,e=t.kind,r=t.index++;return!n||r>=n.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==e?{value:r,done:!1}:"values"==e?{value:n[r],done:!1}:{value:[r,n[r]],done:!1}},"values"),i.Arguments=i.Array,o("keys"),o("values"),o("entries")},function(t,n,e){var r=e(4),o=e(3),i=e(52),c=r(Function.toString);o(i.inspectSource)||(i.inspectSource=function(t){return c(t)}),t.exports=i.inspectSource},function(t,n){},function(t,n,e){var r=e(4),o=e(5),i=e(3),c=e(24),u=e(11),a=e(65),s=function(){},f=[],p=u("Reflect","construct"),l=/^\\s*(?:class|function)\\b/,v=r(l.exec),d=!l.exec(s),h=function(t){if(!i(t))return!1;try{return p(s,f,t),!0}catch(t){return!1}};t.exports=!p||o(function(){var t;return h(h.call)||!h(Object)||!h(function(){t=!0})||t})?function(t){if(!i(t))return!1;switch(c(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return d||!!v(l,a(t))}:h},function(t,n,e){var r=e(4);t.exports=r([].slice)},function(t,n,e){var r=e(26),o=e(0);t.exports="process"==r(o.process)},function(t,n){t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},function(t,n,e){var r=e(2);n.f=r},function(t,n,e){t.exports=e(98)},function(t,n){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n,e){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);n.f=i?function(t){var n=o(this,t);return!!n&&n.enumerable}:r},function(t,n,e){var r=e(0),o=e(4),i=e(5),c=e(26),u=r.Object,a=o("".split);t.exports=i(function(){return!u("z").propertyIsEnumerable(0)})?function(t){return"String"==c(t)?a(t,""):u(t)}:u},function(t,n,e){var r=e(49);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,n,e){var r=e(13),o=e(5),i=e(54);t.exports=!r&&!o(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a})},function(t,n,e){var r=e(5),o=e(3),i=/#|\\.prototype\\./,c=function(t,n){var e=a[u(t)];return e==f||e!=s&&(o(n)?r(n):!!n)},u=c.normalize=function(t){return String(t).replace(i,".").toLowerCase()},a=c.data={},s=c.NATIVE="N",f=c.POLYFILL="P";t.exports=c},function(t,n,e){var r=e(4),o=e(7),i=e(16),c=e(108).indexOf,u=e(37),a=r([].push);t.exports=function(t,n){var e,r=i(t),s=0,f=[];for(e in r)!o(u,e)&&o(r,e)&&a(f,e);for(;n.length>s;)o(r,e=n[s++])&&(~c(f,e)||a(f,e));return f}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(11);t.exports=r("document","documentElement")},function(t,n,e){var r=e(0),o=e(58),i=e(22),c=e(62),u=r.Array,a=Math.max;t.exports=function(t,n,e){for(var r=i(t),s=o(n,r),f=o(void 0===e?r:e,r),p=u(a(f-s,0)),l=0;s<f;s++,l++)c(p,l,t[s]);return p.length=l,p}},function(t,n,e){var r=e(24),o=e(50),i=e(23),c=e(2)("iterator");t.exports=function(t){if(null!=t)return o(t,c)||o(t,"@@iterator")||i[r(t)]}},function(t,n,e){"use strict";var r=e(6),o=e(9),i=e(20),c=e(120),u=e(3),a=e(121),s=e(55),f=e(56),p=e(28),l=e(17),v=e(25),d=e(2),h=e(23),y=e(85),m=c.PROPER,g=c.CONFIGURABLE,x=y.IteratorPrototype,b=y.BUGGY_SAFARI_ITERATORS,w=d("iterator"),S=function(){return this};t.exports=function(t,n,e,c,d,y,j){a(e,n,c);var O,P,A,E=function(t){if(t===d&&_)return _;if(!b&&t in L)return L[t];switch(t){case"keys":case"values":case"entries":return function(){return new e(this,t)}}return function(){return new e(this)}},k=n+" Iterator",T=!1,L=t.prototype,I=L[w]||L["@@iterator"]||d&&L[d],_=!b&&I||E(d),M="Array"==n&&L.entries||I;if(M&&(O=s(M.call(new t)))!==Object.prototype&&O.next&&(i||s(O)===x||(f?f(O,x):u(O[w])||v(O,w,S)),p(O,k,!0,!0),i&&(h[k]=S)),m&&"values"==d&&I&&"values"!==I.name&&(!i&&g?l(L,"name","values"):(T=!0,_=function(){return o(I,this)})),d)if(P={values:E("values"),keys:y?_:E("keys"),entries:E("entries")},j)for(A in P)!b&&!T&&A in L||v(L,A,P[A]);else r({target:n,proto:!0,forced:b||T},P);return i&&!j||L[w]===_||v(L,w,_,{name:d}),h[n]=_,P}},function(t,n,e){"use strict";var r,o,i,c=e(5),u=e(3),a=e(38),s=e(55),f=e(25),p=e(2),l=e(20),v=p("iterator"),d=!1;[].keys&&("next"in(i=[].keys())?(o=s(s(i)))!==Object.prototype&&(r=o):d=!0),null==r||c(function(){var t={};return r[v].call(t)!==t})?r={}:l&&(r=a(r)),u(r[v])||f(r,v,function(){return this}),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:d}},function(t,n,e){var r=e(0);t.exports=r.Promise},function(t,n,e){var r=e(10),o=e(128),i=e(2)("species");t.exports=function(t,n){var e,c=r(t).constructor;return void 0===c||null==(e=r(c)[i])?n:o(e)}},function(t,n,e){var r,o,i,c,u=e(0),a=e(46),s=e(27),f=e(3),p=e(7),l=e(5),v=e(81),d=e(68),h=e(54),y=e(89),m=e(69),g=u.setImmediate,x=u.clearImmediate,b=u.process,w=u.Dispatch,S=u.Function,j=u.MessageChannel,O=u.String,P=0,A={};try{r=u.location}catch(t){}var E=function(t){if(p(A,t)){var n=A[t];delete A[t],n()}},k=function(t){return function(){E(t)}},T=function(t){E(t.data)},L=function(t){u.postMessage(O(t),r.protocol+"//"+r.host)};g&&x||(g=function(t){var n=d(arguments,1);return A[++P]=function(){a(f(t)?t:S(t),void 0,n)},o(P),P},x=function(t){delete A[t]},m?o=function(t){b.nextTick(k(t))}:w&&w.now?o=function(t){w.now(k(t))}:j&&!y?(c=(i=new j).port2,i.port1.onmessage=T,o=s(c.postMessage,c)):u.addEventListener&&f(u.postMessage)&&!u.importScripts&&r&&"file:"!==r.protocol&&!l(L)?(o=L,u.addEventListener("message",T,!1)):o="onreadystatechange"in h("script")?function(t){v.appendChild(h("script")).onreadystatechange=function(){v.removeChild(this),E(t)}}:function(t){setTimeout(k(t),0)}),t.exports={set:g,clear:x}},function(t,n,e){var r=e(34);t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},function(t,n,e){var r=e(10),o=e(8),i=e(42);t.exports=function(t,n){if(r(t),o(n)&&n.constructor===t)return n;var e=i.f(t);return(0,e.resolve)(n),e.promise}},function(t,n,e){"use strict";var r=e(137).charAt,o=e(40),i=e(41),c=e(84),u=i.set,a=i.getterFor("String Iterator");c(String,"String",function(t){u(this,{type:"String Iterator",string:o(t),index:0})},function(){var t,n=a(this),e=n.string,o=n.index;return o>=e.length?{value:void 0,done:!0}:(t=r(e,o),n.index+=t.length,{value:t,done:!1})})},function(t,n,e){t.exports=e(139)},function(t,n,e){var r=e(148);t.exports=function(t,n){return new(r(t))(0===n?0:n)}},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(5),c=e(29),u=e(8),a=e(21),s=e(22),f=e(62),p=e(93),l=e(44),v=e(2),d=e(33),h=v("isConcatSpreadable"),y=o.TypeError,m=d>=51||!i(function(){var t=[];return t[h]=!1,t.concat()[0]!==t}),g=l("concat"),x=function(t){if(!u(t))return!1;var n=t[h];return void 0!==n?!!n:c(t)};r({target:"Array",proto:!0,forced:!m||!g},{concat:function(t){var n,e,r,o,i,c=a(this),u=p(c,0),l=0;for(n=-1,r=arguments.length;n<r;n++)if(i=-1===n?c:arguments[n],x(i)){if(l+(o=s(i))>9007199254740991)throw y("Maximum allowed index exceeded");for(e=0;e<o;e++,l++)e in i&&f(u,l,i[e])}else{if(l>=9007199254740991)throw y("Maximum allowed index exceeded");f(u,l++,i)}return u.length=l,u}})},function(t,n,e){e(1)("iterator")},function(t,n,e){const r=e(97);let o=null;function i(t){return t&&"string"!=typeof t?t.message?t.message:t.target&&t.target.error?t.target.error.message:"unknown error":t}self.onmessage=function(t){switch(t.data.type){case"init":e=t.data.msg,(o=new r(e)).init().catch(t=>{postMessage({type:"error",msg:{msg:"dbLog init error",error:i(t)}})});break;case"fetch":o.getAllLogs().then(t=>{postMessage({type:"fetchDone",code:200,msg:t})}).catch(t=>{postMessage({type:"fetchDone",code:500,msg:i(t)})});break;case"delete":o.deleteLogs(n).catch(t=>{postMessage({type:"deleteLogs",code:500,msg:i(t)})});break;default:!function(t){if(!o)return;o.putLog(t).then(t=>{postMessage(200)}).catch(t=>{postMessage({type:"error",msg:{msg:"putLog error",error:i(t)}})})}(t.data)}var n,e}},function(t,n,e){var r=e(72),o=e(92),i=e(143),c=e(149),u={log:{key:{keyPath:"time"},indexes:{level:{unique:!1},time:{unique:!0}}}};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.server=null,this.expire=t.expire||72,this.name=t.name}var s=a.prototype;s.init=function(){var t=this;if(!this.server)return c.open({server:"nim-log-"+this.name,version:1,schema:u}).then(function(n){t.server=n})},s.putLog=function(t){var n=this;if(!this.server)return r.reject("no db server");var e=o(t).call(t,-1)[0].time-36e5*this.expire;return this.deleteLogs(e).then(function(){return n.server.add("log",t)})},s.getAllLogs=function(){return this.server?this.server.query("log","time").all().execute().then(function(t){var n={},e=o(t).call(t,-1)[0];return n.logs=i(t).call(t,function(t){return t.log}).join("\\r\\n"),n.time=e&&e.time,n}):r.reject("no db server")},s.deleteLogs=function(t){return this.server?this.server.remove("log",null,"time",0,t):r.reject("no db server")},t.exports=a},function(t,n,e){var r=e(99);e(43),t.exports=r},function(t,n,e){e(100),e(64),e(66),e(123),e(134),e(135),e(136),e(91);var r=e(14);t.exports=r.Promise},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(12),c=e(55),u=e(56),a=e(106),s=e(38),f=e(17),p=e(18),l=e(111),v=e(112),d=e(39),h=e(116),y=e(2),m=e(117),g=y("toStringTag"),x=o.Error,b=[].push,w=function(t,n){var e,r=arguments.length>2?arguments[2]:void 0,o=i(S,this);u?e=u(new x(void 0),o?c(this):S):(e=o?this:s(S),f(e,g,"Error")),f(e,"message",h(n,"")),m&&f(e,"stack",l(e.stack,1)),v(e,r);var a=[];return d(t,b,{that:a}),f(e,"errors",a),e};u?u(w,x):a(w,x);var S=w.prototype=s(x.prototype,{constructor:p(1,w),message:p(1,""),name:p(1,"AggregateError")});r({global:!0},{AggregateError:w})},function(t,n,e){var r=e(0),o=e(9),i=e(8),c=e(48),u=e(50),a=e(102),s=e(2),f=r.TypeError,p=s("toPrimitive");t.exports=function(t,n){if(!i(t)||c(t))return t;var e,r=u(t,p);if(r){if(void 0===n&&(n="default"),e=o(r,t,n),!i(e)||c(e))return e;throw f("Can\'t convert object to primitive value")}return void 0===n&&(n="number"),a(t,n)}},function(t,n,e){var r=e(0),o=e(9),i=e(3),c=e(8),u=r.TypeError;t.exports=function(t,n){var e,r;if("string"===n&&i(e=t.toString)&&!c(r=o(e,t)))return r;if(i(e=t.valueOf)&&!c(r=o(e,t)))return r;if("string"!==n&&i(e=t.toString)&&!c(r=o(e,t)))return r;throw u("Can\'t convert object to primitive value")}},function(t,n,e){var r=e(0),o=Object.defineProperty;t.exports=function(t,n){try{o(r,t,{value:n,configurable:!0,writable:!0})}catch(e){r[t]=n}return n}},function(t,n,e){var r=e(5);t.exports=!r(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},function(t,n,e){var r=e(0),o=e(3),i=r.String,c=r.TypeError;t.exports=function(t){if("object"==typeof t||o(t))return t;throw c("Can\'t set "+i(t)+" as a prototype")}},function(t,n,e){var r=e(7),o=e(107),i=e(31),c=e(15);t.exports=function(t,n){for(var e=o(n),u=c.f,a=i.f,s=0;s<e.length;s++){var f=e[s];r(t,f)||u(t,f,a(n,f))}}},function(t,n,e){var r=e(11),o=e(4),i=e(57),c=e(80),u=e(10),a=o([].concat);t.exports=r("Reflect","ownKeys")||function(t){var n=i.f(u(t)),e=c.f;return e?a(n,e(t)):n}},function(t,n,e){var r=e(16),o=e(58),i=e(22),c=function(t){return function(n,e,c){var u,a=r(n),s=i(a),f=o(c,s);if(t&&e!=e){for(;s>f;)if((u=a[f++])!=u)return!0}else for(;s>f;f++)if((t||f in a)&&a[f]===e)return t||f||0;return!t&&-1}};t.exports={includes:c(!0),indexOf:c(!1)}},function(t,n,e){var r=e(59),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){var r=e(13),o=e(15),i=e(10),c=e(16),u=e(61);t.exports=r?Object.defineProperties:function(t,n){i(t);for(var e,r=c(n),a=u(n),s=a.length,f=0;s>f;)o.f(t,e=a[f++],r[e]);return t}},function(t,n,e){var r=e(4),o=e(82),i=r("".replace),c=r("".split),u=r([].join),a=String(Error("zxcasd").stack),s=/\\n\\s*at [^:]*:[^\\n]*/,f=s.test(a),p=/@[^\\n]*\\n/.test(a)&&!/zxcasd/.test(a);t.exports=function(t,n){if("string"!=typeof t)return t;if(f)for(;n--;)t=i(t,s,"");else if(p)return u(o(c(t,"\\n"),n),"\\n");return t}},function(t,n,e){var r=e(8),o=e(17);t.exports=function(t,n){r(n)&&"cause"in n&&o(t,"cause",n.cause)}},function(t,n,e){var r=e(2),o=e(23),i=r("iterator"),c=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||c[i]===t)}},function(t,n,e){var r=e(0),o=e(9),i=e(19),c=e(10),u=e(35),a=e(83),s=r.TypeError;t.exports=function(t,n){var e=arguments.length<2?a(t):n;if(i(e))return c(o(e,t));throw s(u(t)+" is not iterable")}},function(t,n,e){var r=e(9),o=e(10),i=e(50);t.exports=function(t,n,e){var c,u;o(t);try{if(!(c=i(t,"return"))){if("throw"===n)throw e;return e}c=r(c,t)}catch(t){u=!0,c=t}if("throw"===n)throw e;if(u)throw c;return o(c),e}},function(t,n,e){var r=e(40);t.exports=function(t,n){return void 0===t?arguments.length<2?"":n:r(t)}},function(t,n,e){var r=e(5),o=e(18);t.exports=!r(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",o(1,7)),7!==t.stack)})},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(0),o=e(3),i=e(65),c=r.WeakMap;t.exports=o(c)&&/native code/.test(i(c))},function(t,n,e){var r=e(13),o=e(7),i=Function.prototype,c=r&&Object.getOwnPropertyDescriptor,u=o(i,"name"),a=u&&"something"===function(){}.name,s=u&&(!r||r&&c(i,"name").configurable);t.exports={EXISTS:u,PROPER:a,CONFIGURABLE:s}},function(t,n,e){"use strict";var r=e(85).IteratorPrototype,o=e(38),i=e(18),c=e(28),u=e(23),a=function(){return this};t.exports=function(t,n,e){var s=n+" Iterator";return t.prototype=o(r,{next:i(1,e)}),c(t,s,!1,!0),u[s]=a,t}},function(t,n,e){"use strict";var r=e(63),o=e(24);t.exports=r?{}.toString:function(){return"[object "+o(this)+"]"}},function(t,n,e){"use strict";var r,o,i,c,u=e(6),a=e(20),s=e(0),f=e(11),p=e(9),l=e(86),v=e(25),d=e(124),h=e(56),y=e(28),m=e(125),g=e(19),x=e(3),b=e(8),w=e(126),S=e(65),j=e(39),O=e(127),P=e(87),A=e(88).set,E=e(129),k=e(90),T=e(132),L=e(42),I=e(70),_=e(41),M=e(78),D=e(2),R=e(133),C=e(69),F=e(33),N=D("species"),B=_.get,G=_.set,q=_.getterFor("Promise"),z=l&&l.prototype,V=l,U=z,W=s.TypeError,H=s.document,K=s.process,J=L.f,Y=J,X=!!(H&&H.createEvent&&s.dispatchEvent),Q=x(s.PromiseRejectionEvent),Z=!1,$=M("Promise",function(){var t=S(V),n=t!==String(V);if(!n&&66===F)return!0;if(a&&!U.finally)return!0;if(F>=51&&/native code/.test(t))return!1;var e=new V(function(t){t(1)}),r=function(t){t(function(){},function(){})};return(e.constructor={})[N]=r,!(Z=e.then(function(){})instanceof r)||!n&&R&&!Q}),tt=$||!O(function(t){V.all(t).catch(function(){})}),nt=function(t){var n;return!(!b(t)||!x(n=t.then))&&n},et=function(t,n){if(!t.notified){t.notified=!0;var e=t.reactions;E(function(){for(var r=t.value,o=1==t.state,i=0;e.length>i;){var c,u,a,s=e[i++],f=o?s.ok:s.fail,l=s.resolve,v=s.reject,d=s.domain;try{f?(o||(2===t.rejection&&ct(t),t.rejection=1),!0===f?c=r:(d&&d.enter(),c=f(r),d&&(d.exit(),a=!0)),c===s.promise?v(W("Promise-chain cycle")):(u=nt(c))?p(u,c,l,v):l(c)):v(r)}catch(t){d&&!a&&d.exit(),v(t)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&ot(t)})}},rt=function(t,n,e){var r,o;X?((r=H.createEvent("Event")).promise=n,r.reason=e,r.initEvent(t,!1,!0),s.dispatchEvent(r)):r={promise:n,reason:e},!Q&&(o=s["on"+t])?o(r):"unhandledrejection"===t&&T("Unhandled promise rejection",e)},ot=function(t){p(A,s,function(){var n,e=t.facade,r=t.value;if(it(t)&&(n=I(function(){C?K.emit("unhandledRejection",r,e):rt("unhandledrejection",e,r)}),t.rejection=C||it(t)?2:1,n.error))throw n.value})},it=function(t){return 1!==t.rejection&&!t.parent},ct=function(t){p(A,s,function(){var n=t.facade;C?K.emit("rejectionHandled",n):rt("rejectionhandled",n,t.value)})},ut=function(t,n,e){return function(r){t(n,r,e)}},at=function(t,n,e){t.done||(t.done=!0,e&&(t=e),t.value=n,t.state=2,et(t,!0))},st=function(t,n,e){if(!t.done){t.done=!0,e&&(t=e);try{if(t.facade===n)throw W("Promise can\'t be resolved itself");var r=nt(n);r?E(function(){var e={done:!1};try{p(r,n,ut(st,e,t),ut(at,e,t))}catch(n){at(e,n,t)}}):(t.value=n,t.state=1,et(t,!1))}catch(n){at({done:!1},n,t)}}};if($&&(U=(V=function(t){w(this,U),g(t),p(r,this);var n=B(this);try{t(ut(st,n),ut(at,n))}catch(t){at(n,t)}}).prototype,(r=function(t){G(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=d(U,{then:function(t,n){var e=q(this),r=e.reactions,o=J(P(this,V));return o.ok=!x(t)||t,o.fail=x(n)&&n,o.domain=C?K.domain:void 0,e.parent=!0,r[r.length]=o,0!=e.state&&et(e,!1),o.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new r,n=B(t);this.promise=t,this.resolve=ut(st,n),this.reject=ut(at,n)},L.f=J=function(t){return t===V||t===i?new o(t):Y(t)},!a&&x(l)&&z!==Object.prototype)){c=z.then,Z||(v(z,"then",function(t,n){var e=this;return new V(function(t,n){p(c,e,t,n)}).then(t,n)},{unsafe:!0}),v(z,"catch",U.catch,{unsafe:!0}));try{delete z.constructor}catch(t){}h&&h(z,U)}u({global:!0,wrap:!0,forced:$},{Promise:V}),y(V,"Promise",!1,!0),m("Promise"),i=f("Promise"),u({target:"Promise",stat:!0,forced:$},{reject:function(t){var n=J(this);return p(n.reject,void 0,t),n.promise}}),u({target:"Promise",stat:!0,forced:a||$},{resolve:function(t){return k(a&&this===i?V:this,t)}}),u({target:"Promise",stat:!0,forced:tt},{all:function(t){var n=this,e=J(n),r=e.resolve,o=e.reject,i=I(function(){var e=g(n.resolve),i=[],c=0,u=1;j(t,function(t){var a=c++,s=!1;u++,p(e,n,t).then(function(t){s||(s=!0,i[a]=t,--u||r(i))},o)}),--u||r(i)});return i.error&&o(i.value),e.promise},race:function(t){var n=this,e=J(n),r=e.reject,o=I(function(){var o=g(n.resolve);j(t,function(t){p(o,n,t).then(e.resolve,r)})});return o.error&&r(o.value),e.promise}})},function(t,n,e){var r=e(25);t.exports=function(t,n,e){for(var o in n)e&&e.unsafe&&t[o]?t[o]=n[o]:r(t,o,n[o],e);return t}},function(t,n,e){"use strict";var r=e(11),o=e(15),i=e(2),c=e(13),u=i("species");t.exports=function(t){var n=r(t),e=o.f;c&&n&&!n[u]&&e(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,e){var r=e(0),o=e(12),i=r.TypeError;t.exports=function(t,n){if(o(n,t))return t;throw i("Incorrect invocation")}},function(t,n,e){var r=e(2)("iterator"),o=!1;try{var i=0,c={next:function(){return{done:!!i++}},return:function(){o=!0}};c[r]=function(){return this},Array.from(c,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!o)return!1;var e=!1;try{var i={};i[r]=function(){return{next:function(){return{done:e=!0}}}},t(i)}catch(t){}return e}},function(t,n,e){var r=e(0),o=e(67),i=e(35),c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not a constructor")}},function(t,n,e){var r,o,i,c,u,a,s,f,p=e(0),l=e(27),v=e(31).f,d=e(88).set,h=e(89),y=e(130),m=e(131),g=e(69),x=p.MutationObserver||p.WebKitMutationObserver,b=p.document,w=p.process,S=p.Promise,j=v(p,"queueMicrotask"),O=j&&j.value;O||(r=function(){var t,n;for(g&&(t=w.domain)&&t.exit();o;){n=o.fn,o=o.next;try{n()}catch(t){throw o?c():i=void 0,t}}i=void 0,t&&t.enter()},h||g||m||!x||!b?!y&&S&&S.resolve?((s=S.resolve(void 0)).constructor=S,f=l(s.then,s),c=function(){f(r)}):g?c=function(){w.nextTick(r)}:(d=l(d,p),c=function(){d(r)}):(u=!0,a=b.createTextNode(""),new x(r).observe(a,{characterData:!0}),c=function(){a.data=u=!u})),t.exports=O||function(t){var n={fn:t,next:void 0};i&&(i.next=n),o||(o=n,c()),i=n}},function(t,n,e){var r=e(34),o=e(0);t.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==o.Pebble},function(t,n,e){var r=e(34);t.exports=/web0s(?!.*chrome)/i.test(r)},function(t,n,e){var r=e(0);t.exports=function(t,n){var e=r.console;e&&e.error&&(1==arguments.length?e.error(t):e.error(t,n))}},function(t,n){t.exports="object"==typeof window},function(t,n,e){"use strict";var r=e(6),o=e(9),i=e(19),c=e(42),u=e(70),a=e(39);r({target:"Promise",stat:!0},{allSettled:function(t){var n=this,e=c.f(n),r=e.resolve,s=e.reject,f=u(function(){var e=i(n.resolve),c=[],u=0,s=1;a(t,function(t){var i=u++,a=!1;s++,o(e,n,t).then(function(t){a||(a=!0,c[i]={status:"fulfilled",value:t},--s||r(c))},function(t){a||(a=!0,c[i]={status:"rejected",reason:t},--s||r(c))})}),--s||r(c)});return f.error&&s(f.value),e.promise}})},function(t,n,e){"use strict";var r=e(6),o=e(19),i=e(11),c=e(9),u=e(42),a=e(70),s=e(39);r({target:"Promise",stat:!0},{any:function(t){var n=this,e=i("AggregateError"),r=u.f(n),f=r.resolve,p=r.reject,l=a(function(){var r=o(n.resolve),i=[],u=0,a=1,l=!1;s(t,function(t){var o=u++,s=!1;a++,c(r,n,t).then(function(t){s||l||(l=!0,f(t))},function(t){s||l||(s=!0,i[o]=t,--a||p(new e(i,"No one promise resolved")))})}),--a||p(new e(i,"No one promise resolved"))});return l.error&&p(l.value),r.promise}})},function(t,n,e){"use strict";var r=e(6),o=e(20),i=e(86),c=e(5),u=e(11),a=e(3),s=e(87),f=e(90),p=e(25);if(r({target:"Promise",proto:!0,real:!0,forced:!!i&&c(function(){i.prototype.finally.call({then:function(){}},function(){})})},{finally:function(t){var n=s(this,u("Promise")),e=a(t);return this.then(e?function(e){return f(n,t()).then(function(){return e})}:t,e?function(e){return f(n,t()).then(function(){throw e})}:t)}}),!o&&a(i)){var l=u("Promise").prototype.finally;i.prototype.finally!==l&&p(i.prototype,"finally",l,{unsafe:!0})}},function(t,n,e){var r=e(4),o=e(59),i=e(40),c=e(47),u=r("".charAt),a=r("".charCodeAt),s=r("".slice),f=function(t){return function(n,e){var r,f,p=i(c(n)),l=o(e),v=p.length;return l<0||l>=v?t?"":void 0:(r=a(p,l))<55296||r>56319||l+1===v||(f=a(p,l+1))<56320||f>57343?t?u(p,l):r:t?s(p,l,l+2):f-56320+(r-55296<<10)+65536}};t.exports={codeAt:f(!1),charAt:f(!0)}},function(t,n){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(t,n,e){var r=e(140);t.exports=r},function(t,n,e){var r=e(12),o=e(141),i=Array.prototype;t.exports=function(t){var n=t.slice;return t===i||r(i,t)&&n===i.slice?o:n}},function(t,n,e){e(142);var r=e(30);t.exports=r("Array").slice},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(29),c=e(67),u=e(8),a=e(58),s=e(22),f=e(16),p=e(62),l=e(2),v=e(44),d=e(68),h=v("slice"),y=l("species"),m=o.Array,g=Math.max;r({target:"Array",proto:!0,forced:!h},{slice:function(t,n){var e,r,o,l=f(this),v=s(l),h=a(t,v),x=a(void 0===n?v:n,v);if(i(l)&&(e=l.constructor,c(e)&&(e===m||i(e.prototype))?e=void 0:u(e)&&null===(e=e[y])&&(e=void 0),e===m||void 0===e))return d(l,h,x);for(r=new(void 0===e?m:e)(g(x-h,0)),o=0;h<x;h++,o++)h in l&&p(r,o,l[h]);return r.length=o,r}})},function(t,n,e){t.exports=e(144)},function(t,n,e){var r=e(145);t.exports=r},function(t,n,e){var r=e(12),o=e(146),i=Array.prototype;t.exports=function(t){var n=t.map;return t===i||r(i,t)&&n===i.map?o:n}},function(t,n,e){e(147);var r=e(30);t.exports=r("Array").map},function(t,n,e){"use strict";var r=e(6),o=e(45).map;r({target:"Array",proto:!0,forced:!e(44)("map")},{map:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,e){var r=e(0),o=e(29),i=e(67),c=e(8),u=e(2)("species"),a=r.Array;t.exports=function(t){var n;return o(t)&&(n=t.constructor,i(n)&&(n===a||o(n.prototype))?n=void 0:c(n)&&null===(n=n[u])&&(n=void 0)),void 0===n?a:n}},function(t,n,e){(function(r){var o,i=e(150),c=e(92),u=e(184),a=e(72),s=e(188),f=e(195),p=e(199),l=e(203),v=e(207);!function(d,h){"use strict";var y,m=(d=void 0!==d?d:"undefined"!=typeof self?self:void 0!==r?r:{}).IDBKeyRange||d.webkitIDBKeyRange,g="readonly",x="readwrite",b=Object.prototype.hasOwnProperty,w=function(){if(!y&&!(y=d.indexedDB||d.webkitIndexedDB||d.mozIndexedDB||d.oIndexedDB||d.msIndexedDB||(null===d.indexedDB&&d.shimIndexedDB?d.shimIndexedDB:h)))throw"IndexedDB required";return y},S=function(t){return t},j=function(t){var n;return c(n=Object.prototype.toString.call(t)).call(n,8,-1).toLowerCase()},O=function(t){return"function"==typeof t},P=function(t){return t===h},A=function(t,n){var e=this,r=!1;this.name=n,this.getIndexedDB=function(){return t},this.add=function(n){if(r)throw"Database has been closed";for(var o=[],i=0,c=0;c<arguments.length-1;c++)if(u(arguments[c+1]))for(var p=0;p<arguments[c+1].length;p++)o[i]=arguments[c+1][p],i++;else o[i]=arguments[c+1],i++;var l=t.transaction(n,x),v=l.objectStore(n);return new a(function(t,n){s(o).call(o,function(t){var n;if(t.item&&t.key){var e=t.key;t=t.item,n=v.add(t,e)}else n=v.add(t);n.onsuccess=function(n){var e=n.target,r=e.source.keyPath;null===r&&(r="__id__"),f(t,r,{value:e.result,enumerable:!0})}}),l.oncomplete=function(){t(o,e)},l.onerror=function(t){t.preventDefault(),n(t)},l.onabort=function(t){n(t)}})},this.updateAndDelete=function(n,e,o){if(r)throw"Database has been closed";var i=t.transaction(n,x),c=i.objectStore(n),u=c.keyPath;return new a(function(t,n){s(e).call(e,function(t){if(t.item&&t.key){var n=t.key;t=t.item,c.put(t,n)}else c.put(t)}),s(o).call(o,function(t){c.delete(t[u])}),i.oncomplete=function(){t([e,o])},i.onerror=function(t){n(t)}})},this.update=function(n){if(r)throw"Database has been closed";for(var o,i=[],c=1;c<arguments.length;c++)o=arguments[c],u(o)?i=p(i).call(i,o):i.push(o);var f=t.transaction(n,x),l=f.objectStore(n);l.keyPath;return new a(function(t,n){s(i).call(i,function(t){var n;if(t.item&&t.key){var e=t.key;t=t.item,n=l.put(t,e)}else n=l.put(t);n.onsuccess=function(t){},n.onerror=function(t){}}),f.oncomplete=function(){t(i,e)},f.onerror=function(t){n(t)},f.onabort=function(t){n(t)}})},this.remove=function(n,e,o,i,c,f,p){if(r)throw"Database has been closed";var l=t.transaction(n,x),v=l.objectStore(n);return new a(function(t,n){function r(t){return t===h||null===t}var a;(r(i)&&(i=-1/0),r(c)&&(c=1/0),null===e||u(e)||(e=[e]),r(o))?null!==e?s(e).call(e,function(t){v.delete(t)}):v.delete(range=m.bound(i,c,f,p)):(a=null!==e?m.only(e[0]):m.bound(i,c,f,p),v.index(o).openCursor(a).onsuccess=function(t){var n=t.target.result;n&&(n.delete(),n.continue())});l.oncomplete=function(){t()},l.onerror=function(t){n(t)},l.onabort=function(t){n(t)}})},this.clear=function(n){if(r)throw"Database has been closed";var e=t.transaction(n,x);e.objectStore(n).clear();return new a(function(t,n){e.oncomplete=function(){t()},e.onerror=function(t){n(t)}})},this.close=function(){r||(t.close(),r=!0,delete T[n])},this.get=function(n,e){if(r)throw"Database has been closed";var o=t.transaction(n),i=o.objectStore(n).get(e);return new a(function(t,n){i.onsuccess=function(n){t(n.target.result)},o.onerror=function(t){n(t)}})},this.query=function(n,e){if(r)throw"Database has been closed";return new E(n,t,e)},this.count=function(n,e){if(r)throw"Database has been closed";t.transaction(n).objectStore(n)};for(var o=0,i=t.objectStoreNames.length;o<i;o++)!function(t){for(var n in e[t]={},e)b.call(e,n)&&"close"!==n&&(e[t][n]=function(n){return function(){var r,o=p(r=[t]).call(r,c([]).call(arguments,0));return e[n].apply(e,o)}}(n))}(t.objectStoreNames[o])},E=function(t,n,e){var r,o=this,u=!1,f=!1,p=function(r,o,c,p,v,d,y){return new a(function(a,b){var w=u||f?x:g,S=n.transaction(t,w),j=S.objectStore(t),P=e?j.index(e):j,A=r?m[r].apply(null,o):null,E=[],k=[A],T=0;v=v||null,d=d||[],"count"!==c&&k.push(p||"next");var L=!!u&&l(u);P[c].apply(P,k).onsuccess=function(t){var n=t.target.result;if(i(n)===i(0))E=n;else if(n)if(null!==v&&v[0]>T)T=v[0],n.advance(v[0]);else if(null!==v&&T>=v[0]+v[1]);else{var e=!0,r="value"in n?n.value:n.key;s(d).call(d,function(t){t&&t.length&&(2===t.length?e=e&&r[t[0]]===t[1]:O(t[0])&&(e=e&&t[0].apply(h,[r])))}),e&&(T++,E.push(y(r)),f?n.delete():u&&(r=function(t){for(var n=0;n<L.length;n++){var e=L[n],r=u[e];r instanceof Function&&(r=r(t)),t[e]=r}return t}(r),n.update(r))),n.continue()}},S.oncomplete=function(){a(E)},S.onerror=function(t){b(t)},S.onabort=function(t){b(t)}})},d=function(t,n){var e="next",r="openCursor",o=[],i=null,a=S,s=!1,l=function(){return p(t,n,r,s?e+"unique":e,i,o,a)},v=function(){return e=null,r="count",{execute:l}},d=function t(){var n;return n=arguments[0],1==(i="array"===j(n)?arguments[0]:c(Array.prototype).call(arguments,0,2)).length&&i.unshift(0),function(t){return"number"===j(t)}(i[1])||(i=null),{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:t,map:w,remove:A}},h=function t(n){return(n=!!P(n)||!!n)&&(r="openKeyCursor"),{execute:l,keys:t,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:A}},y=function t(){return o.push(c(Array.prototype).call(arguments,0,2)),{execute:l,count:v,keys:h,filter:t,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:A}},m=function t(n){return n=!!P(n)||!!n,e=n?"next":"prev",{execute:l,count:v,keys:h,filter:y,asc:t,desc:g,distinct:x,modify:b,limit:d,map:w,remove:A}},g=function t(n){return n=!!P(n)||!!n,e=n?"prev":"next",{execute:l,count:v,keys:h,filter:y,asc:m,desc:t,distinct:x,modify:b,limit:d,map:w,remove:A}},x=function t(n){return n=!!P(n)||!!n,s=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:t,modify:b,limit:d,map:w,remove:A}},b=function t(n){return u=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:t,limit:d,map:w,remove:A}},w=function t(n){return O(n)&&(a=n),{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:t,remove:A}},A=function t(n){return n=!!P(n)||!!n,f=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:t}};return{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:A}};s(r="only bound upperBound lowerBound".split(" ")).call(r,function(t){o[t]=function(){return new d(t,arguments)}}),this.filter=function(){var t=new d(null,null);return v(t).apply(t,arguments)},this.all=function(){var t;return v(t=this).call(t)}},k=function(t,n,e,r){var o=t.target.result,i=new A(o,n);return T[n]=o,a.resolve(i)},T={},L={version:"0.10.2",open:function(t){var n;return new a(function(e,r){if(T[t.server])k({target:{result:T[t.server]}},t.server,t.version,t.schema).then(e,r);else{try{n=w().open(t.server,t.version)}catch(t){r(t)}n.onsuccess=function(n){k(n,t.server,t.version,t.schema).then(e,r)},n.onupgradeneeded=function(n){!function(t,n,e){for(var r in"function"==typeof n&&(n=n()),n){var o,i=n[r];for(var c in o=!b.call(n,r)||e.objectStoreNames.contains(r)?t.currentTarget.transaction.objectStore(r):e.createObjectStore(r,i.key),i.indexes){var u=i.indexes[c];try{o.index(c)}catch(t){o.createIndex(c,u.key||c,l(u).length?u:{unique:!1})}}}}(n,t.schema,n.target.result)},n.onerror=function(t){r(t)}}})},remove:function(t){return new a(function(n,e){if(!t)return n();var r,o;i(t)===A&&(t=t.name),"string"==typeof t&&(r=T[t]),r&&"function"==typeof r.close&&r.close();try{o=w().deleteDatabase(t)}catch(t){e(t)}o.onsuccess=function(e){delete T[t],n(t)},o.onerror=function(t){e(t)},o.onblocked=function(t){e(t)}})}};void 0!==t.exports?t.exports=L:(o=function(){return L}.call(n,e,n,t))===h||(t.exports=o)}(void 0)}).call(this,e(73))},function(t,n,e){var r=e(151),o=e(180);function i(n){return"function"==typeof r&&"symbol"==typeof o?(t.exports=i=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=i=function(t){return t&&"function"==typeof r&&t.constructor===r&&t!==r.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),i(n)}t.exports=i,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,n,e){t.exports=e(152)},function(t,n,e){var r=e(153);e(173),e(174),e(175),e(176),e(177),e(178),e(179),t.exports=r},function(t,n,e){var r=e(154);e(43),t.exports=r},function(t,n,e){e(94),e(66),e(155),e(157),e(158),e(159),e(160),e(95),e(161),e(162),e(163),e(164),e(165),e(166),e(167),e(168),e(169),e(170),e(171),e(172);var r=e(14);t.exports=r.Symbol},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(11),c=e(46),u=e(9),a=e(4),s=e(20),f=e(13),p=e(49),l=e(5),v=e(7),d=e(29),h=e(3),y=e(8),m=e(12),g=e(48),x=e(10),b=e(21),w=e(16),S=e(32),j=e(40),O=e(18),P=e(38),A=e(61),E=e(57),k=e(156),T=e(80),L=e(31),I=e(15),_=e(74),M=e(68),D=e(25),R=e(51),C=e(36),F=e(37),N=e(53),B=e(2),G=e(71),q=e(1),z=e(28),V=e(41),U=e(45).forEach,W=C("hidden"),H=B("toPrimitive"),K=V.set,J=V.getterFor("Symbol"),Y=Object.prototype,X=o.Symbol,Q=X&&X.prototype,Z=o.TypeError,$=o.QObject,tt=i("JSON","stringify"),nt=L.f,et=I.f,rt=k.f,ot=_.f,it=a([].push),ct=R("symbols"),ut=R("op-symbols"),at=R("string-to-symbol-registry"),st=R("symbol-to-string-registry"),ft=R("wks"),pt=!$||!$.prototype||!$.prototype.findChild,lt=f&&l(function(){return 7!=P(et({},"a",{get:function(){return et(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=nt(Y,n);r&&delete Y[n],et(t,n,e),r&&t!==Y&&et(Y,n,r)}:et,vt=function(t,n){var e=ct[t]=P(Q);return K(e,{type:"Symbol",tag:t,description:n}),f||(e.description=n),e},dt=function(t,n,e){t===Y&&dt(ut,n,e),x(t);var r=S(n);return x(e),v(ct,r)?(e.enumerable?(v(t,W)&&t[W][r]&&(t[W][r]=!1),e=P(e,{enumerable:O(0,!1)})):(v(t,W)||et(t,W,O(1,{})),t[W][r]=!0),lt(t,r,e)):et(t,r,e)},ht=function(t,n){x(t);var e=w(n),r=A(e).concat(xt(e));return U(r,function(n){f&&!u(yt,e,n)||dt(t,n,e[n])}),t},yt=function(t){var n=S(t),e=u(ot,this,n);return!(this===Y&&v(ct,n)&&!v(ut,n))&&(!(e||!v(this,n)||!v(ct,n)||v(this,W)&&this[W][n])||e)},mt=function(t,n){var e=w(t),r=S(n);if(e!==Y||!v(ct,r)||v(ut,r)){var o=nt(e,r);return!o||!v(ct,r)||v(e,W)&&e[W][r]||(o.enumerable=!0),o}},gt=function(t){var n=rt(w(t)),e=[];return U(n,function(t){v(ct,t)||v(F,t)||it(e,t)}),e},xt=function(t){var n=t===Y,e=rt(n?ut:w(t)),r=[];return U(e,function(t){!v(ct,t)||n&&!v(Y,t)||it(r,ct[t])}),r};(p||(D(Q=(X=function(){if(m(Q,this))throw Z("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?j(arguments[0]):void 0,n=N(t),e=function(t){this===Y&&u(e,ut,t),v(this,W)&&v(this[W],n)&&(this[W][n]=!1),lt(this,n,O(1,t))};return f&&pt&&lt(Y,n,{configurable:!0,set:e}),vt(n,t)}).prototype,"toString",function(){return J(this).tag}),D(X,"withoutSetter",function(t){return vt(N(t),t)}),_.f=yt,I.f=dt,L.f=mt,E.f=k.f=gt,T.f=xt,G.f=function(t){return vt(B(t),t)},f&&(et(Q,"description",{configurable:!0,get:function(){return J(this).description}}),s||D(Y,"propertyIsEnumerable",yt,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!p,sham:!p},{Symbol:X}),U(A(ft),function(t){q(t)}),r({target:"Symbol",stat:!0,forced:!p},{for:function(t){var n=j(t);if(v(at,n))return at[n];var e=X(n);return at[n]=e,st[e]=n,e},keyFor:function(t){if(!g(t))throw Z(t+" is not a symbol");if(v(st,t))return st[t]},useSetter:function(){pt=!0},useSimple:function(){pt=!1}}),r({target:"Object",stat:!0,forced:!p,sham:!f},{create:function(t,n){return void 0===n?P(t):ht(P(t),n)},defineProperty:dt,defineProperties:ht,getOwnPropertyDescriptor:mt}),r({target:"Object",stat:!0,forced:!p},{getOwnPropertyNames:gt,getOwnPropertySymbols:xt}),r({target:"Object",stat:!0,forced:l(function(){T.f(1)})},{getOwnPropertySymbols:function(t){return T.f(b(t))}}),tt)&&r({target:"JSON",stat:!0,forced:!p||l(function(){var t=X();return"[null]"!=tt([t])||"{}"!=tt({a:t})||"{}"!=tt(Object(t))})},{stringify:function(t,n,e){var r=M(arguments),o=n;if((y(n)||void 0!==t)&&!g(t))return d(n)||(n=function(t,n){if(h(o)&&(n=u(o,this,t,n)),!g(n))return n}),r[1]=n,c(tt,null,r)}});if(!Q[H]){var bt=Q.valueOf;D(Q,H,function(t){return u(bt,this)})}z(X,"Symbol"),F[W]=!0},function(t,n,e){var r=e(26),o=e(16),i=e(57).f,c=e(82),u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"Window"==r(t)?function(t){try{return i(t)}catch(t){return c(u)}}(t):i(o(t))}},function(t,n,e){e(1)("asyncIterator")},function(t,n){},function(t,n,e){e(1)("hasInstance")},function(t,n,e){e(1)("isConcatSpreadable")},function(t,n,e){e(1)("match")},function(t,n,e){e(1)("matchAll")},function(t,n,e){e(1)("replace")},function(t,n,e){e(1)("search")},function(t,n,e){e(1)("species")},function(t,n,e){e(1)("split")},function(t,n,e){e(1)("toPrimitive")},function(t,n,e){e(1)("toStringTag")},function(t,n,e){e(1)("unscopables")},function(t,n,e){var r=e(0);e(28)(r.JSON,"JSON",!0)},function(t,n){},function(t,n){},function(t,n,e){e(1)("asyncDispose")},function(t,n,e){e(1)("dispose")},function(t,n,e){e(1)("matcher")},function(t,n,e){e(1)("metadata")},function(t,n,e){e(1)("observable")},function(t,n,e){e(1)("patternMatch")},function(t,n,e){e(1)("replaceAll")},function(t,n,e){t.exports=e(181)},function(t,n,e){var r=e(182);t.exports=r},function(t,n,e){var r=e(183);e(43),t.exports=r},function(t,n,e){e(64),e(66),e(91),e(95);var r=e(71);t.exports=r.f("iterator")},function(t,n,e){t.exports=e(185)},function(t,n,e){var r=e(186);t.exports=r},function(t,n,e){e(187);var r=e(14);t.exports=r.Array.isArray},function(t,n,e){e(6)({target:"Array",stat:!0},{isArray:e(29)})},function(t,n,e){t.exports=e(189)},function(t,n,e){e(43);var r=e(24),o=e(7),i=e(12),c=e(190),u=Array.prototype,a={DOMTokenList:!0,NodeList:!0};t.exports=function(t){var n=t.forEach;return t===u||i(u,t)&&n===u.forEach||o(a,r(t))?c:n}},function(t,n,e){var r=e(191);t.exports=r},function(t,n,e){e(192);var r=e(30);t.exports=r("Array").forEach},function(t,n,e){"use strict";var r=e(6),o=e(193);r({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},function(t,n,e){"use strict";var r=e(45).forEach,o=e(194)("forEach");t.exports=o?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},function(t,n,e){"use strict";var r=e(5);t.exports=function(t,n){var e=[][t];return!!e&&r(function(){e.call(null,n||function(){throw 1},1)})}},function(t,n,e){t.exports=e(196)},function(t,n,e){var r=e(197);t.exports=r},function(t,n,e){e(198);var r=e(14).Object,o=t.exports=function(t,n,e){return r.defineProperty(t,n,e)};r.defineProperty.sham&&(o.sham=!0)},function(t,n,e){var r=e(6),o=e(13);r({target:"Object",stat:!0,forced:!o,sham:!o},{defineProperty:e(15).f})},function(t,n,e){t.exports=e(200)},function(t,n,e){var r=e(201);t.exports=r},function(t,n,e){var r=e(12),o=e(202),i=Array.prototype;t.exports=function(t){var n=t.concat;return t===i||r(i,t)&&n===i.concat?o:n}},function(t,n,e){e(94);var r=e(30);t.exports=r("Array").concat},function(t,n,e){t.exports=e(204)},function(t,n,e){var r=e(205);t.exports=r},function(t,n,e){e(206);var r=e(14);t.exports=r.Object.keys},function(t,n,e){var r=e(6),o=e(21),i=e(61);r({target:"Object",stat:!0,forced:e(5)(function(){i(1)})},{keys:function(t){return i(o(t))}})},function(t,n,e){t.exports=e(208)},function(t,n,e){var r=e(209);t.exports=r},function(t,n,e){var r=e(12),o=e(210),i=Array.prototype;t.exports=function(t){var n=t.filter;return t===i||r(i,t)&&n===i.filter?o:n}},function(t,n,e){e(211);var r=e(30);t.exports=r("Array").filter},function(t,n,e){"use strict";var r=e(6),o=e(45).filter;r({target:"Array",proto:!0,forced:!e(44)("filter")},{filter:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})}]);',"Worker",void 0,void 0)}},function(e,t,r){var n=r(4),i=r(16),o=r(8),a=r(217),s={log:{key:{keyPath:"time"},indexes:{level:{unique:!1},time:{unique:!0}}}};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.server=null,this.expire=e.expire||72,this.name=e.name}var u=c.prototype;u.init=function(){var e=this;if(!this.server)return a.open({server:"nim-log-"+this.name,version:1,schema:s}).then((function(t){e.server=t}))},u.putLog=function(e){var t=this;if(!this.server)return n.reject("no db server");var r=i(e).call(e,-1)[0].time-36e5*this.expire;return this.deleteLogs(r).then((function(){return t.server.add("log",e)}))},u.getAllLogs=function(){return this.server?this.server.query("log","time").all().execute().then((function(e){var t={},r=i(e).call(e,-1)[0];return t.logs=o(e).call(e,(function(e){return e.log})).join("\r\n"),t.time=r&&r.time,t})):n.reject("no db server")},u.deleteLogs=function(e){return this.server?this.server.remove("log",null,"time",0,e):n.reject("no db server")},e.exports=c},function(e,t,r){var n=r(191);e.exports=function(e){if(n(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(138),i=r(80);e.exports=function(e,t){var r=null==e?null:void 0!==n&&i(e)||e["@@iterator"];if(null!=r){var o,a,s=[],c=!0,u=!1;try{for(r=r.call(e);!(c=(o=r.next()).done)&&(s.push(o.value),!t||s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{c||null==r.return||r.return()}finally{if(u)throw a}}return s}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(399)},function(e,t,r){var n=r(178);e.exports=n},function(e,t,r){var n=r(158);e.exports=n},function(e,t,r){var n=r(402),i=r(196);e.exports=function(e,t){if(null==e)return{};var r,o,a={},s=n(e);for(o=0;o<s.length;o++)r=s[o],i(t).call(t,r)>=0||(a[r]=e[r]);return a},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(403)},function(e,t,r){var n=r(182);e.exports=n},function(e,t,r){r(184);var n=r(12);e.exports=n.setInterval},function(e,t,r){var n=r(406);e.exports=n},function(e,t,r){var n=r(15),i=r(407),o=Function.prototype;e.exports=function(e){var t=e.bind;return e===o||n(o,e)&&t===o.bind?i:t}},function(e,t,r){r(408);var n=r(22);e.exports=n("Function").bind},function(e,t,r){r(2)({target:"Function",proto:!0},{bind:r(409)})},function(e,t,r){var n=r(1),i=r(7),o=r(39),a=r(27),s=r(25),c=r(89),u=n.Function,l=i([].concat),d=i([].join),p={};e.exports=u.bind||function(e){var t=o(this),r=t.prototype,n=c(arguments,1),i=function(){var r=l(n,c(arguments));return this instanceof i?function(e,t,r){if(!s(p,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";p[t]=u("C,a","return new C("+d(n,",")+")")}return p[t](e,r)}(t,r.length,r):t.apply(e,r)};return a(r)&&(i.prototype=r),i}},function(e,t,r){var n=r(14),i=r(23),o=r(3),a=r(24),s=r(9),c=r(43),u=r(140);function l(e){e.onuploading&&this.on("uploading",e.onuploading),u.call(this,e)}var d=u.prototype,p=l.prototype=n(d);p.doSend=function(){var e,t,r,n=this.options,u=n.headers,l=this.xhr=new XMLHttpRequest;if("multipart/form-data"===u["Content-Type"]){var d,p;delete u["Content-Type"],l.upload.onprogress=i(d=this.onProgress).call(d,this),l.upload.onload=i(p=this.onProgress).call(p,this);var f,h=n.data;n.data=new window.FormData,h&&o(f=c.getKeys(h,n.putFileAtEnd)).call(f,(function(e){var t=h[e];t.tagName&&"INPUT"===t.tagName.toUpperCase()?"file"===t.type&&o([]).call(t.files,(function(e){n.data.append(c.dataset(t,"name")||t.name||e.name||"file-"+c.uniqueID(),e)})):n.data.append(e,t)}))}else if(u["x-nos-token"]){var m,g;l.upload.onprogress=i(m=this.onProgress).call(m,this),l.upload.onload=i(g=this.onProgress).call(g,this)}l.onreadystatechange=i(e=this.onStateChange).call(e,this),0!==n.timeout&&(this.timer=a(i(r=this.onTimeout).call(r,this),n.timeout)),l.open(n.method,n.url,!n.sync),o(t=s(u)).call(t,(function(e){l.setRequestHeader(e,u[e])})),n.cookie&&"withCredentials"in l&&(l.withCredentials=!0),l.send(n.data),this.afterSend()},p.onProgress=function(e){e.lengthComputable&&e.loaded<=e.total&&this.emit("uploading",e)},p.onStateChange=function(){var e,t=this.xhr;4===t.readyState&&(e={status:t.status,result:t.responseText||""},this.onLoad(e))},p.getResponseHeader=function(e){var t=this.xhr;return t?t.getResponseHeader(e):""},p.destroy=function(){clearTimeout(this.timer);try{this.xhr.onreadystatechange=c.f,this.xhr.abort()}catch(e){}d.destroy.call(this)},e.exports=l},function(e,t,r){var n;!function(t){function i(){}var o=i.prototype,a=t.EventEmitter;function s(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}o.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp)for(r in t={},n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r]);else t=n[e]||(n[e]=[]);return t},o.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},o.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},o.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var r,n=this.getListenersAsObject(e),i="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&-1===s(n[r],t)&&n[r].push(i?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var r,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(r=s(i[n],t))&&i[n].splice(r,1);return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):a.call(this,n,i));return this},o.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"===r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var r,n,i,o,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(r=a[o].slice(0),i=0;i<r.length;i++)!0===(n=r[i]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=a,i},void 0===(n=function(){return i}.call(t,r,t,e))||(e.exports=n)}("undefined"!=typeof window?window:this||{})},function(e,t,r){var n=r(14),i=r(6),o=r(3),a=r(23),s=r(78),c=r(43),u=r(140),l=r(197),d="NEJ-UPLOAD-RESULT:",p={};function f(e){this.init(),u.call(this,e)}var h=u.prototype,m=f.prototype=n(h);m.init=function(){var e=!1;function t(e){var t=e.data;if(0===i(t).call(t,d)){var r=(t=JSON.parse(t.replace(d,""))).key,n=p[r];n&&(delete p[r],t.result=decodeURIComponent(t.result||""),n.onLoad(t.result))}}return function(){!function(){if(!e){e=!0;var r=c.getGlobal();r.postMessage?c.on(r,"message",t):(l.addMsgListener(t),l.startTimer())}}()}}(),m.doSend=function(){var e=this,t=e.options,r=e.key="zoro-ajax-upload-iframe-"+c.uniqueID();p[r]=e;var n=e.form=c.html2node('<form style="display:none;"></form>');"undefined"==typeof document||document.body.appendChild(n),n.target=r,n.method="POST",n.enctype="multipart/form-data",n.encoding="multipart/form-data";var i=t.url,s=c.genUrlSep(i);n.action=i+s+"_proxy_=form";var u,l=t.data,d=[],f=[];function h(){o(d).call(d,(function(e,t){var r=f[t];r.parentNode&&(e.name=r.name,c.isFunction(e.setAttribute)&&e.setAttribute("form",r.getAttribute("form")),r.parentNode.replaceChild(e,r))}))}l&&o(u=c.getKeys(l,t.putFileAtEnd)).call(u,(function(e){var t=l[e];if(t.tagName&&"INPUT"===t.tagName.toUpperCase()){if("file"===t.type){var r=t,i=r.cloneNode(!0);r.parentNode.insertBefore(i,r);var o=c.dataset(r,"name");o&&(r.name=o),n.appendChild(r),c.isFunction(r.setAttribute)&&(r.setAttribute("form",""),r.removeAttribute("form")),d.push(t),f.push(i)}}else{var a=c.html2node('<input type="hidden"/>');a.name=e,a.value=t,n.appendChild(a)}}));var m=e.iframe=c.createIframe({name:r,onload:function(){var t;e.aborted?h():(c.on(m,"load",a(t=e.checkResult).call(t,e)),n.submit(),h(),e.afterSend())}})},m.checkResult=function(){var e,t;try{var r,n;if(e=this.iframe.contentWindow.document.body,t=s(r=e.innerText||e.textContent||"").call(r),i(t).call(t,d)>=0||i(n=e.innerHTML).call(n,d)>=0)return}catch(e){return}this.onLoad(t)},m.onLoad=function(e){h.onLoad.call(this,{status:200,result:e}),c.remove(this.form),c.remove(this.iframe),h.destroy.call(this)},m.destroy=function(){c.remove(this.iframe),c.remove(this.form)},m.abort=function(){this.aborted=!0,delete p[this.key],h.abort.call(this)},e.exports=f},function(e,t,r){var n=r(414);e.exports=n},function(e,t,r){var n=r(15),i=r(415),o=String.prototype;e.exports=function(e){var t=e.trim;return"string"==typeof e||e===o||n(o,e)&&t===o.trim?i:t}},function(e,t,r){r(416);var n=r(22);e.exports=n("String").trim},function(e,t,r){var n=r(2),i=r(139).trim;n({target:"String",proto:!0,forced:r(417)("trim")},{trim:function(){return i(this)}})},function(e,t,r){var n=r(165).PROPER,i=r(13),o=r(108);e.exports=function(e){return i((function(){return!!o[e]()||"​᠎"!=="​᠎"[e]()||n&&o[e].name!==e}))}},function(e,t,r){var n=r(14),i=r(6),o=r(23),a=r(3),s=r(43),c=r(197),u=r(140),l={};function d(e){this.init(),u.call(this,e)}var p=u.prototype,f=d.prototype=n(p);f.init=function(){var e="NEJ-AJAX-DATA:",t=!1;function r(t){var r=t.data;if(0===i(r).call(r,e)){var n=(r=JSON.parse(r.replace(e,""))).key,o=l[n];o&&(delete l[n],r.result=decodeURIComponent(r.result||""),o.onLoad(r))}}return function(){!function(){if(!t){t=!0;var e=s.getGlobal();e.postMessage?s.on(e,"message",r):c.addMsgListener(r)}}()}}(),f.doSend=function(){var e=this.options,t=s.url2origin(e.url),r=e.proxyUrl||t+"/res/nej_proxy_frame.html",n=l[r];if(s.isArray(n)){var i;n.push(o(i=this.doSend).call(i,this,e))}else{var u;if(!n)return l[r]=[o(u=this.doSend).call(u,this,e)],void s.createIframe({src:r,onload:function(e){var t=l[r];l[r]=s.target(e).contentWindow,a(t).call(t,(function(e){try{e()}catch(e){}}))}});if(!this.aborted){var d=this.key=s.uniqueID();l[d]=this;var p=s.fetch({method:"GET",url:"",data:null,headers:{},timeout:0},e);p.key=d,c.postMessage(n,{data:p}),this.afterSend()}}},f.abort=function(){this.aborted=!0,delete l[this.key],p.abort.call(this)},e.exports=d},function(e,t,r){var n,i,o=r(11),a=r(43),s=r(109),c=(n=/json/i,i=/post/i,function(e,t){var r=(t=t||{}).data=t.data||{},c=t.headers=t.headers||{},u=a.checkWithDefault(c,"Accept","application/json"),l=a.checkWithDefault(c,"Content-Type","application/json");return n.test(u)&&(t.type="json"),i.test(t.method)&&n.test(l)&&(t.data=o(r)),s(e,t)});e.exports=c},function(e,t,r){var n=r(109);e.exports=function(e,t){return t.method="POST",t.headers=t.headers||{},t.headers["Content-Type"]="multipart/form-data",t.timeout=0,t.type=t.type||"json",n(e,t)}},function(e,t,r){var n=r(16),i=r(51),o=r(6),a=r(4),s=r(17),c=s.chunkSize,u=r(109),l={mp4:"video/mp4",avi:"video/x-msvideo",wmv:"video/x-ms-wmv",mpeg:"video/mpeg",mov:"video/quicktime",aac:"audio/x-aac",wma:"audio/x-ms-wma",wav:"audio/x-wav",mp3:"audio/mp3"};e.exports=function e(t,r,d,p){var f,h={file:t.data[r],fileSize:t.data[r].size,fileUploadedSize:0,percentage:0},m=t.url;function g(e){var r=h.fileUploadedSize+e.loaded,n=Math.floor(1e4*r/h.fileSize)/100;if(i(n)>=100&&(n=100,g=function(){}),h.percentage!==n){h.percentage=n;var o={docId:t.docId,total:h.fileSize,loaded:r,percentage:n,percentageText:n+"%"};t.fileInput&&(o.fileInput=t.fileInput),t.blob&&(o.blob=t.blob),t.uploadprogress(o)}}function v(n){var i=n&&n.code;function o(){try{if(n.result)var e=JSON.parse(n.result);else e=n;d.onError(e)}catch(e){d.onError(e)}}0===h.fileUploadedSize&&t.nosLbsUrls&&t.nosLbsUrls.length>0&&"abort"!==i?t.edgeList?p<t.edgeList.length-1?e(t,r,d,p+1):o():function(e,t,r,n){return new a((function(i,o){function a(){u(r[e],{query:{version:"1.0",bucketname:t},method:"GET",onerror:s,onload:function(e){try{(e=JSON.parse(e))&&e.upload&&e.upload.length?i(e.upload):s()}catch(e){s()}}})}function s(){n.onLbsUrlFail(r[e]),e<r.length-1?(e++,a()):i([])}a()}))}(0,t.nosToken.bucket,t.nosLbsUrls,d).then((function(n){n.length>0?(t.edgeList=n,t.updateNosEdgeList&&t.updateNosEdgeList(n),e(t,r,d,p+1)):o()})):o()}"number"!=typeof p&&(p=-1),t.edgeList&&t.edgeList.length&&(p=p>0?p:0,m=t.edgeList[p]),m+="/"+t.nosToken.bucket+"/"+t.nosToken.objectName;var y=t.data.file&&t.data.file.type;if(!y||o(y).call(y,"/")<0){var b=(t.fileInputName||"").split(".").pop();"image"===t.type?y="image/"+("jpg"===b?"jpeg":b):"audio"!==t.type&&"video"!==t.type||(y=l[b])}var S={query:{offset:0,complete:c>=h.fileSize,version:"1.0"},headers:{"Content-Type":y||"application/octet-stream","x-nos-token":t.nosToken.token},method:"POST",timeout:0,onaftersend:function(){t.beginupload(d)},onuploading:g,onload:function e(r){try{r=JSON.parse(r)}catch(r){return void d.onError(r)}if(r.errMsg||r.errCode)d.onError(r);else if(r.offset<h.fileSize)delete S.onaftersend,h.fileUploadedSize=r.offset,d.sn=function(t,r,i,o){var a,s=t.offset,l=t.offset+c;return r.data=n(a=o.file).call(a,s,l),r.query.offset=t.offset,r.query.complete=l>=o.fileSize,r.query.context=t.context,r.onuploading=g,r.onload=e,r.onerror=v,u(m,r)}(r,S,0,h);else{var i=s.genFileUrl(t.nosToken);"image"===t.type?u(i+"?imageInfo",{onload:function(e){try{e=JSON.parse(e),t.uploaddone(null,{docId:r.docId,w:e.Width,h:e.Height,orientation:e.Orientation||"",type:e.Type,size:e.Size||h.fileSize})}catch(e){o(e)}},onerror:function(e){if("undefined"!=typeof Image){var n=new Image;n.src=i,n.onload=function(){t.uploaddone(null,{docId:r.docId,w:n.width,h:n.height,size:h.fileSize})},n.onerror=function(e){o(e)}}else o(e)}}):"video"===t.type||"audio"===t.type?u(i+"?vinfo",{onload:function(e){try{(e=JSON.parse(e)).GetVideoInfo&&e.GetVideoInfo.VideoInfo&&(e=e.GetVideoInfo.VideoInfo),t.uploaddone(null,{docId:r.docId,w:e.Width,h:e.Height,dur:e.Duration,orientation:e.Rotate,audioCodec:e.AudioCodec,videoCodec:e.VideoCodec,container:e.Container,size:e.Size||h.fileSize})}catch(e){o(e)}},onerror:o}):t.uploaddone(null,{docId:r.docId,size:h.fileSize})}function o(e){d.onError(e)}},onerror:v};return S.data=n(f=h.file).call(f,0,c),u(m,S)}},function(e,t,r){var n=r(44).fn;n.isConnected=function(){return!!this.protocol&&this.protocol.isConnected()},n.connect=function(){this.protocol.connect(!0)},n.disconnect=function(e){e=e||{},this.protocol.disconnect(e.done)}},function(e,t,r){var n=r(9),i=r(59),o=r(19),a=r(60),s=r(61),c=r(62),u=r(50),l=r(28),d=r(11),p=r(23),f=r(8),h=r(16),m=r(106),g=r(78),v=r(6),y=r(24),b=r(5),S=r(29),_=r(3),M=r(10),T=r(63),w=r(119),x=["loc_x","loc_y","loc_z"];function I(e,t){var r=n(e);if(i){var s=i(e);t&&(s=o(s).call(s,(function(t){return a(e,t).enumerable}))),r.push.apply(r,s)}return r}var E=r(44).fn,A=r(0),C=r(428),k=r(33),O=r(17),N=r(198),R=r(429),P=r(54),D=r(199);E.sendText=function(e){var t=e,r=t.loc_x,n=t.loc_y,i=t.loc_z,o=w(t,x);return void 0===r||void 0===n||void 0===i?e=function(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)_(r=I(Object(n),!0)).call(r,(function(t){T(e,t,n[t])}));else if(s)c(e,s(n));else{var i;_(i=I(Object(n))).call(i,(function(t){u(e,t,a(n,t))}))}}return e}({},o):("number"!=typeof e.loc_x&&(e.loc_x=0),"number"!=typeof e.loc_y&&(e.loc_y=0),"number"!=typeof e.loc_z&&(e.loc_z=0)),this.processCallback(e),e.msg=new this.message.TextMessage(e),this.sendMsg(e)},E.previewFile=function(e){var t,r=this,n=r.protocol.appGrayConfig;if(n&&n.grayConfig&&n.grayConfig.mixStoreEnable&&(e.mixEnable=!0),A.verifyOptions(e,"done","msg::previewFile"),e.type||(e.type="file"),A.verifyParamPresentJustOne(e,"dataURL blob fileInput filePath wxFilePath fileObject","msg::previewFile"),A.exist(e.maxSize)&&A.verifyParamType("maxSize",e.maxSize,"number","api::previewFile"),A.exist(e.commonUpload)&&A.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile"),e.nosSurvivalTime?(A.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance"),A.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")):e.nosSurvivalTime=this.nosSurvivalTime,e.filePath=e.filePath||e.wxFilePath,delete e.wxFilePath,e.dataURL)e.blob=D.fromDataURL(e.dataURL);else if(e.blob);else if(e.fileInput){if(e.fileInput=A.verifyFileInput(e.fileInput,"msg::previewFile"),e.fileInput.files){if(!e.fileInput.files.length)return void e.done(k.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::previewFile",fileInput:e.fileInput}),e);e.fileSize=e.fileInput.files[0].size}e.fileInputName=A.getFileName(e.fileInput)}this.processCallback(e);var i=d(N.genResponseBody(e.type)||{}).replace(/"/gi,'\\"'),o=null,a=e.transcode?"getNosTokenTrans":"getNosToken";if(e.transcode){A.verifyOptions(e,"fileInput","msg::previewFile");var s=A.getFileInfo(e.fileInput);o={transToken:{name:s.name,type:s.transcodeType,transType:"png"===e.transcode?11:10,size:s.size,body:i}}}else o=i;this[a]({responseBody:o,nosToken:{nosScene:e.nosScene||this.nosScene,nosSurvivalTime:e.nosSurvivalTime},callback:p(t=function(t,n){if(t)e.done(t);else if(e.transcode?(e.nosToken=n.nosToken,e.docId=n.docId):e.nosToken=n,e.mixEnable){var i,a;if(!this.protocol.mixStorePolicy)try{this.protocol.mixStorePolicy=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[this.options.appKey]}catch(e){r.logger.error("error:","get last mixStorePolicy failed",e)}if(!this.protocol.mixStorePolicy)return void r.logger.error("error:","get mixStorePolicy failed");e.providers=f(i=this.protocol.mixStorePolicy.providers||[]).call(i,(function(e){return Number(e)})),e.curProvider=e.providers[0]?Number(e.providers[0]):1,e.nosPolicy=this.protocol.mixStorePolicy.nosPolicy,e.s3Policy=this.protocol.mixStorePolicy.s3Policy,e.logger=r.logger,r.getMixStoreToken({curProvider:e.curProvider,responseBody:o,callback:p(a=function(t,n){t?e.done(t):(e.mixStoreToken=n,e.getMixStoreToken=function(t,n){r.getMixStoreToken({curProvider:t,responseBody:o,callback:function(t,r){t?e.done(t):n(r)}})},1===e.curProvider&&(e.nosToken=n),r._doPreviewFile(e))}).call(a,r)})}else this._doPreviewFile(e)}).call(t,this)})},E._doPreviewFile=function(e){var t=this;P.startUniErrCache("nos",{user_id:this.account,action:"upload"});var r=e.uploaddone,n=O.genUploadUrl(e.nosToken.bucket);e.mixEnable&&1===e.curProvider&&(n=O.genUploadUrl(e.mixStoreToken.bucket));var i,o=O.chunkUploadUrl;t.logger.info("_doPreviewFile: start upload"),e.commonUpload||!o||O.isWeixinApp||O.isNodejs||O.isRN?(e.commonUpload=!0,i=n):(this.logger.info("use chunkUrl: ",o,O.nosLbsUrls),i=o,e.nosLbsUrls=O.nosLbsUrls,t.edgeList?e.edgeList=t.edgeList:e.updateNosEdgeList=function(e){t.edgeList=e});var a=this.assembleUploadParams(e.nosToken);function s(n,i,o){if(t.logger.info("_doPreviewFile: upload done",n&&n.message),e.uploaddone=r,n)return P.updateUniErrCache("nos",{operation_type:"transfer",error:n&&n.message}),P.concludeUniErrCache("nos",1),void e.done(n,e.callback.options);if(P.concludeUniErrCache("nos",0),i=N.parseResponse(i,t.options.exifOrientation),o||i.isS3||(i.url=O.genDownloadUrl(e.nosToken,a.Object,O.serverNosConfig.cdnDomain),e.nosToken.shortUrl&&(i._url_safe=e.nosToken.shortUrl)),A.exist(e.fileInputName))i.name=e.fileInputName;else if(e.blob){var s=e.blob.name;if(i.name=s||"blob-"+i.md5,!s){var c=e.blob.type;i.ext=h(c).call(c,m(c).call(c,"/")+1)}}else e.filePath?i.name=e.filePath:e.fileObject&&(i.name=e.fileObject.fileName);if(!i.ext){var u,l,d=m(u=i.name).call(u,".");i.ext=-1===d?"unknown":h(l=i.name).call(l,d+1)}i.size=i.size||0,i.isS3&&i._url_safe?t.getNosOriginUrl({safeShortUrl:i._url_safe,done:function(r,n){r?t.logger.error("error:","getNosOriginUrl failed",r):(i.url=n,e.done(null,A.copy(i)))}}):e.done(null,A.copy(i))}if(e.mixEnable&&1===e.curProvider&&(a=this.assembleUploadParams(e.mixStoreToken)),O.isWeixinApp)A.verifyOptions(e,"filePath","msg::_doPreviewFile"),t.fileQuickTransfer(e,s,(function(){var r=wx.uploadFile({url:i,filePath:e.filePath,name:"file",formData:a,fail:function(e){s({code:"FAILED",msg:e}),t.logger.error("error:","api::msg:upload file failed",e)},success:function(e){if(200===e.statusCode)try{s(null,JSON.parse(e.data))}catch(r){t.logger.error("error:","parse wx upload file res error",r),s({code:"PARSE_WX_UPLOAD_FILE_RES_ERROR",str:e.data,msg:e.errMsg})}else s({code:e.statusCode,msg:e.errMsg})}});"function"==typeof e.uploadprogress&&r&&(t.logger.info("_doPreviewFile::mini uploadprogress"),r.onProgressUpdate((function(t){e.uploadprogress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percentage:t.progress,percentageText:t.progress+"%"})})))}));else if(O.isNodejs){var c={url:i,name:"file",formData:a,success:function(e){if(200===e.statusCode)try{s(null,JSON.parse(e.data))}catch(r){t.protocol.logger.error("error:","parse nodejs upload file res error",r),s({code:"PARSE_NODEJS_UPLOAD_FILE_RES_ERROR",str:e.data,msg:e.errMsg})}else s({code:e.statusCode,msg:e.errMsg})},fail:function(e){s({code:"FAILED",msg:e}),t.protocol.logger.error("error:","api::msg:upload file failed",e)}};if(e.filePath)c.filePath=e.filePath;else{if("object"!==l(e.fileObject))throw new k("Nodejs上传fileObject参数类型应如 {fileName:..,fileData:..} ");c.fileData=e.fileObject.fileData}t.fileQuickTransfer(e,s,(function(){R.uploadFile(c)}))}else if(O.isRN){var u={url:i,name:"file",formData:a,filePath:e.filePath,success:function(e){if(e.ok&&200===e.status)try{var r=f(e.headers)&&f(e.headers).etag;e.md5=r?"string"==typeof r?r:r[0]:"UNKNOWN",s(null,e)}catch(r){t.protocol.logger.error("error:","parse React Native upload file res error",r),s({code:"PARSE_React_Native_UPLOAD_FILE_RES_ERROR",res:e})}else s({code:e.status,msg:e.statusText})},fail:function(e){s({code:"FAILED",msg:e}),t.protocol.logger.error("error:","api::msg:upload file failed",e)}};t.fileQuickTransfer(e,s,(function(){R.uploadFile(u)}))}else e.uploaddone=s,e.url=i,e.params=a,e.fileName="file",t.fileQuickTransfer(e,s,(function(){return new R(e)}))},E.fileQuickTransfer=function(e,t,r){var n,i=this;e=e||{},t instanceof Function||(t=function(){}),r instanceof Function||(r=function(){});var o=e.fastPass;if(o)try{o=JSON.parse(o),e.fastPass=o}catch(e){i.protocol.logger.error("快传参数解析失败")}var a=e.fileInputName||e.name||e.blob&&e.blob.name||"",s=e.fileSize||e.size||e.blob&&e.blob.size||0,c=o?g(n=(o.md5||e.digest||"")+"").call(n):"",u=e.type||e.blob&&e.blob.type;if(c&&s>=O.threshold){var l=!0,d={name:a,md5:c,ext:h(a).call(a,m(a).call(a,".")+1),type:u};switch(u){case"image":o&&o.w&&o.h?(d.w=o.w,d.h=o.h):(l=!1,i.protocol.logger.error("快传 image 文件缺少参数 w 或 h"));break;case"video":o&&o.w&&o.h&&o.dur?(d.w=o.w,d.h=o.h,d.dur=o.dur):(l=!1,i.protocol.logger.error("快传 video 文件缺少参数 w 或 h 或 dur"));break;case"audio":o&&o.dur?d.dur=o.dur:(l=!1,i.protocol.logger.error("快传 audio 文件缺少参数 dur"))}if(!l)return void r();var p={fileQuickTransfer:{md5:c}};return s&&(p.fileQuickTransfer.size=s),this.protocol.sendCmd("fileQuickTransfer",p,(function(e,n,o){!e&&o&&o.fileQuickTransfer&&o.fileQuickTransfer.url||(i.protocol.logger.error("misc::fileQuickTransfer: not found",e,n),r()),o&&o.fileQuickTransfer&&o.fileQuickTransfer.threshold&&(O.threshold=o.fileQuickTransfer.threshold||0),o&&o.fileQuickTransfer&&o.fileQuickTransfer.url&&(d.size=s||o.fileQuickTransfer.size,d.url=o.fileQuickTransfer.url,o.fileQuickTransfer._url_safe&&(d._url_safe=o.fileQuickTransfer._url_safe),t(e,d,!0))}))}r()},E.sendFile=function(e){if(e.type||(e.type="file"),e=A.merge(e,this.options.providers),A.verifyParamPresentJustOne(e,"dataURL blob fileInput file filePath wxFilePath fileObject","msg::sendFile"),A.exist(e.maxSize)&&A.verifyParamType("maxSize",e.maxSize,"number","api::previewFile"),A.exist(e.commonUpload)&&A.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile"),this.processCallback(e),e.filePath=e.filePath||e.wxFilePath,delete e.wxFilePath,e.dataURL)this._previewAndSendFile(e);else if(e.blob)this._previewAndSendFile(e);else if(e.fileInput){if(e.fileInput=A.verifyFileInput(e.fileInput,"msg::sendFile"),e.fileInput.files&&!e.fileInput.files.length)return void e.done(k.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::sendFile",fileInput:e.fileInput}),e.callback.options);this._previewAndSendFile(e)}else if(e.filePath||e.fileObject)this._previewAndSendFile(e);else if(e.file){var t,r=e.file._url_safe;return r&&(t=e.file.url,e.file.url=r,delete e.file._url_safe),e.msg=new this.message.FileMessage(e),this.sendMsg(e,t)}},E._previewAndSendFile=function(e){var t=this;A.verifyCallback(e,"uploaddone beforesend","msg::_previewAndSendFile"),P.startUniErrCache("nos",{user_id:this.account,action:"upload"});var r=e.done;e.done=function(n,i){if(e.done=r,n)e.uploaddone(n,e.callback.options),e.done(n,e.callback.options);else{if(/chatroom/.test(e.scene))return;var o;e.uploaddone(null,A.copy(i));var a=i._url_safe;a&&!i.isS3&&(o=i.url,i.url=a,delete i._url_safe),e.file=i,e.msg=new t.message.FileMessage(e),e.beforesend(t.sendMsg(e,o))}},t.previewFile(e)},E.assembleUploadParams=function(e){return e?{Object:decodeURIComponent(e.objectName),"x-nos-token":e.token,"x-nos-entity-type":"json"}:null},E.deleteFile=function(e){A.verifyParamPresentJustOne(e,"docId","msg::deleteFile"),this.removeFile({docId:e.docId,callback:function(t,r){t?e.error&&e.error(t,r):e.success&&e.success(r)}})},E.getFile=function(e){A.verifyParamPresentJustOne(e,"docId","msg::getFile"),this.fetchFile({docId:e.docId,callback:function(t,r){t?e.error&&e.error(t,r):e.success&&e.success(r.info)}})},E.getFileList=function(e){var t=e.fromDocId,r=void 0===t?"":t,n=e.limit,i=void 0===n?10:n,o={limit:i};r&&(o.fromDocId=r),this.fetchFileList({fileListParam:o,callback:function(t,r){t?(i>30&&(t.message=t.message+"::文档条数超过限制:30"),e.error&&e.error(t,r)):e.success&&e.success(r)}})},E.sendGeo=function(e){return this.processCallback(e),e.msg=new this.message.GeoMessage(e),this.sendMsg(e)},E.sendTipMsg=function(e){return this.processCallback(e),e.msg=new this.message.TipMessage(e),this.sendMsg(e)},E.sendCustomMsg=function(e){return this.processCallback(e),e.msg=new this.message.CustomMessage(e),this.sendMsg(e)},E.sendRobotMsg=function(e){return this.processCallback(e),e.msg=new this.message.RobotMessage(e),this.sendMsg(e)},E.sendMsg=function(e,t){var r,n=this.protocol,i=e.msg,o={},a=!!e.isLocal;if(this.logger.warn("sendMsg::start: "+i.idClient),a&&(e.time&&(i.time=e.time),e.idClient&&(i.idClient=e.idClient),e.localFrom&&(r=e.localFrom+"")),e.resend&&("out"!==e.flow||"fail"!==e.status))return A.onError("只能重发发送失败的消息");e.callback.options.idClient=i.idClient,this.beforeSendMsg(e,o);var s=e.rtnMsg=this.formatReturnMsg(i,r);return t&&!this.options.keepNosSafeUrl&&s.file&&(s.file._url_safe=s.file.url,s.file.url=t,"audio"===s.type&&(s.file.mp3Url=t+(~v(t).call(t,"?")?"&":"?")+"audioTrans&type=mp3")),s.hasOwnProperty("chatroomId")&&!s.chatroomId?A.onError("聊天室未连接"):(a&&(s.status="success",s.isLocal=!0),n.storeSendMsg&&(o.promise=n.storeSendMsg(s)),e.cbaop=function(e){if(e)return 7101===e.code&&(s.isInBlackList=!0),"server"!==e.from?(s.status="fail",n.updateSendMsgError&&n.updateSendMsgError(s),s):void 0},a||(t&&!this.options.keepNosSafeUrl&&e.callback&&(e.callback.originUrl=t),e.toAccids&&e.toAccids.length&&(i.toAccids=d(e.toAccids)),o.msg=i,this.sendCmd(e.cmd,o,e.callback)),this.afterSendMsg(e),a&&y((function(){s=A.simpleClone(s),e.done(null,s)}),0),A.copy(s))},E.beforeSendMsg=function(){},E.afterSendMsg=function(){},E.formatReturnMsg=function(e,t){var r;return e=A.copy(e),this.protocol.completeMsg(e),e.status="sending",t&&(e.from=t),b(r=this.message).call(r,e)},E.resendMsg=function(e){return A.verifyOptions(e,"msg","msg::resendMsg"),this.trimMsgFlag(e),e.resend=!0,this._sendMsgByType(e)},E.forwardMsg=function(e){return A.verifyOptions(e,"msg","msg::forwardMsg"),this.trimMsgFlag(e),this.beforeForwardMsg(e),e.forward=!0,e.msg.idClient=A.guid(),this._sendMsgByType(e)},E.trimMsgFlag=function(e){e&&e.msg&&(e.msg=A.copy(e.msg),delete e.msg.resend,delete e.msg.forward)},E.beforeForwardMsg=function(){},E._sendMsgByType=function(e){switch(A.verifyOptions(e,"msg","msg::_sendMsgByType"),A.verifyParamValid("msg.type",e.msg.type,this.message.validTypes,"msg::_sendMsgByType"),A.merge(e,e.msg),e.type){case"text":return this.sendText(e);case"image":case"audio":case"video":case"file":return this.sendFile(e);case"geo":return this.sendGeo(e);case"custom":return this.sendCustomMsg(e);case"tip":return this.sendTipMsg(e);default:throw new k("不能发送类型为 "+e.type+" 的消息")}},E.parseRobotTemplate=function(e){if(/<template[^>/]+\/>/.test(e))return{raw:e,json:[{type:"text",name:"",text:""}]};if(!/<template[^>/]+>/.test(e))return{raw:e,json:[{type:"text",name:"",text:e}]};var t=new C({escapeMode:!1});e=e.replace(/<template [^>]+>/,"<template>");var r=t.xml2js(e);r=r.template.LinearLayout,S(r)||(r=[r]);var n=[];return r=_(r).call(r,(function(e){e.image&&(n=M(n).call(n,o(e))),e.text&&(n=M(n).call(n,i(e))),e.link&&(n=M(n).call(n,function(e){if(e.link){var t=e.link;S(t)||(t=[t]),t=f(t).call(t,(function(e){return e.image&&(e.image=o(e)),e.text&&(e.text=i(e)),"url"===e._type?(e.type="url",e.style=e._style||"",e.target=e._target,delete e._target,delete e._style):"block"===e._type&&(e.type="block",e.style=e._style||"",e.params=e._params||"",e.target=e._target,delete e._params,delete e._target,delete e._style),delete e._type,e})),e.link=t}return e.link}(e)))})),{raw:e,json:n};function i(e){var t;return S(e.text)||(e.text=[e.text]),e.text=f(t=e.text).call(t,(function(e){return{type:"text",name:e._name,text:e.__text}})),e.text}function o(e){var t;return S(e.image)||(e.image=[e.image]),e.image=f(t=e.image).call(t,(function(e){return{type:"image",name:e._name,url:e._url}})),e.image}}},function(e,t,r){var n=r(425);e.exports=n},function(e,t,r){var n=r(15),i=r(426),o=Array.prototype;e.exports=function(e){var t=e.reverse;return e===o||n(o,e)&&t===o.reverse?i:t}},function(e,t,r){r(427);var n=r(22);e.exports=n("Array").reverse},function(e,t,r){var n=r(2),i=r(7),o=r(72),a=i([].reverse),s=[1,2];n({target:"Array",proto:!0,forced:String(s)===String(s.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),a(this)}})},function(e,t,r){var n,i;void 0===(i="function"==typeof(n=function(e){return function(t){(t=t||{}).arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",t.jsAttributeFilter=t.jsAttributeFilter,t.jsAttributeConverter=t.jsAttributeConverter,t.attributeConverters=t.attributeConverters||[],t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[],t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],t.xmldomOptions=t.xmldomOptions||{},void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),void 0===t.useDoubleQuotes&&(t.useDoubleQuotes=!0),void 0===t.ignoreRoot&&(t.ignoreRoot=!1),void 0===t.escapeMode&&(t.escapeMode=!0),void 0===t.attributePrefix&&(t.attributePrefix="_"),void 0===t.selfClosingElements&&(t.selfClosingElements=!0),void 0===t.keepCData&&(t.keepCData=!1),void 0===t.jsDateUTC&&(t.jsDateUTC=!1),function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),"function"!=typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}();function r(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!==t||(t=e.nodeName),t}function n(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"):e}function i(e,r,n){if("property"===t.arrayAccessForm&&(e[r]instanceof Array?e[r+"_asArray"]=e[r]:e[r+"_asArray"]=[e[r]]),!(e[r]instanceof Array)&&t.arrayAccessFormPaths.length>0){for(var i=!1,o=0;o<t.arrayAccessFormPaths.length;o++){var a=t.arrayAccessFormPaths[o];if("string"==typeof a){if(a===n){i=!0;break}}else if(a instanceof RegExp){if(a.test(n)){i=!0;break}}else if("function"==typeof a&&a(r,n)){i=!0;break}}i&&(e[r]=[e[r]])}}function o(e){var t=e.split(/[-T:+Z]/g),r=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(r.setHours(t[3],t[4],n[0]),n.length>1&&r.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function a(e,n){return 9===e.nodeType?function(e){for(var n={},i=e.childNodes,o=0;o<i.length;o++){var s=i.item(o);if(1===s.nodeType){var c=r(s);t.ignoreRoot?n=a(s,c):n[c]=a(s,c)}}return n}(e):1===e.nodeType?function(e,n){for(var s={__cnt:0},c=e.childNodes,u=0;u<c.length;u++){var l=c.item(u),d=r(l);8!==l.nodeType&&(s.__cnt++,null==s[d]?(s[d]=a(l,n+"."+d),i(s,d,n+"."+d)):(s[d]instanceof Array||(s[d]=[s[d]],i(s,d,n+"."+d)),s[d][s[d].length]=a(l,n+"."+d)))}for(var p=0;p<e.attributes.length;p++){var f=e.attributes.item(p);s.__cnt++;for(var h=f.value,m=0;m<t.attributeConverters.length;m++){var g=t.attributeConverters[m];g.test.call(null,f.name,f.value)&&(h=g.convert.call(null,f.name,f.value))}s[t.attributePrefix+f.name]=h}var v=e.prefix;return v&&(s.__cnt++,s.__prefix=v),s["#text"]&&(s.__text=s["#text"],s.__text instanceof Array&&(s.__text=s.__text.join("\n")),t.escapeMode&&(s.__text=s.__text.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&")),t.stripWhitespaces&&(s.__text=s.__text.trim()),delete s["#text"],"property"===t.arrayAccessForm&&delete s["#text_asArray"],s.__text=function(e,r,n){if(t.datetimeAccessFormPaths.length>0)for(var i=n.split(".#")[0],a=0;a<t.datetimeAccessFormPaths.length;a++){var s=t.datetimeAccessFormPaths[a];if("string"==typeof s){if(s===i)return o(e)}else if(s instanceof RegExp){if(s.test(i))return o(e)}else if("function"==typeof s&&s(i))return o(e)}return e}(s.__text,0,n+".#text")),s.hasOwnProperty("#cdata-section")&&(s.__cdata=s["#cdata-section"],delete s["#cdata-section"],"property"===t.arrayAccessForm&&delete s["#cdata-section_asArray"]),1===s.__cnt&&s.__text?s=s.__text:0===s.__cnt&&"text"===t.emptyNodeForm?s="":s.__cnt>1&&void 0!==s.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""===s.__text||""===s.__text.trim())&&delete s.__text,delete s.__cnt,t.keepCData||s.hasOwnProperty("__text")||!s.hasOwnProperty("__cdata")||1!==Object.keys(s).length?(t.enableToStringFunc&&(s.__text||s.__cdata)&&(s.toString=function(){return(this.__text?this.__text:"")+(this.__cdata?this.__cdata:"")}),s):s.__cdata?s.__cdata:""}(e,n):3===e.nodeType||4===e.nodeType?e.nodeValue:null}function s(e,r,i,o){var a="<"+(e&&e.__prefix?e.__prefix+":":"")+r;if(i)for(var s=0;s<i.length;s++){var c=i[s],u=e[c];t.escapeMode&&(u=n(u)),a+=" "+c.substr(t.attributePrefix.length)+"=",t.useDoubleQuotes?a+='"'+u+'"':a+="'"+u+"'"}return a+(o?" />":">")}function c(e,t){return"</"+(e&&e.__prefix?e.__prefix+":":"")+t+">"}function u(e,r){return"property"===t.arrayAccessForm&&(i="_asArray",-1!==(n=r.toString()).indexOf(i,n.length-i.length))||0===r.toString().indexOf(t.attributePrefix)||0===r.toString().indexOf("__")||e[r]instanceof Function;var n,i}function l(e){var t=0;if(e instanceof Object)for(var r in e)u(e,r)||t++;return t}function d(e){var r=[];if(e instanceof Object)for(var n in e)-1===n.toString().indexOf("__")&&0===n.toString().indexOf(t.attributePrefix)&&r.push(n);return r}function p(e){var r="";return e instanceof Object?r+=function(e){var r="";return e.__cdata&&(r+="<![CDATA["+e.__cdata+"]]>"),(e.__text||"number"==typeof e.__text||"boolean"==typeof e.__text)&&(t.escapeMode?r+=n(e.__text):r+=e.__text),r}(e):null!==e&&(t.escapeMode?r+=n(e):r+=e),r}function f(e,r,n){var i="";return t.jsAttributeFilter&&t.jsAttributeFilter.call(null,r,e)||(t.jsAttributeConverter&&(e=t.jsAttributeConverter.call(null,r,e)),null!=e&&""!==e||!t.selfClosingElements?"object"==typeof e?"[object Array]"===Object.prototype.toString.call(e)?i+=function(e,t,r){var n="";if(0===e.length)n+=s(e,t,r,!0);else for(var i=0;i<e.length;i++)n+=f(e[i],t,d(e[i]));return n}(e,r,n):e instanceof Date?(i+=s(e,r,n,!1),i+=t.jsDateUTC?e.toUTCString():e.toISOString(),i+=c(e,r)):l(e)>0||"number"==typeof e.__text||"boolean"==typeof e.__text||e.__text||e.__cdata?(i+=s(e,r,n,!1),i+=h(e),i+=c(e,r)):t.selfClosingElements?i+=s(e,r,n,!0):(i+=s(e,r,n,!1),i+=c(e,r)):(i+=s(e,r,n,!1),i+=p(e),i+=c(e,r)):i+=s(e,r,n,!0)),i}function h(e){var t="";if(l(e)>0)for(var r in e)if(!u(e,r)){var n=e[r];t+=f(n,r,d(n))}return t+p(e)}function m(r){if(void 0===r)return null;if("string"!=typeof r)return null;var n=null,i=null;if(e)i=(n=new e(t.xmldomOptions)).parseFromString(r,"text/xml");else if(window&&window.DOMParser){n=new window.DOMParser;var o=null;if(!window.ActiveXObject&&!("ActiveXObject"in window))try{o=n.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(e){o=null}try{i=n.parseFromString(r,"text/xml"),null!==o&&i.getElementsByTagNameNS(o,"parsererror").length>0&&(i=null)}catch(e){i=null}}else 0===r.indexOf("<?")&&(r=r.substr(r.indexOf("?>")+2)),(i=new ActiveXObject("Microsoft.XMLDOM")).async="false",i.loadXML(r);return i}this.asArray=function(e){return null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?o(e):e},this.xml2dom=function(e){return m(e)},this.dom2js=function(e){return a(e,null)},this.js2dom=function(e){return m(this.js2xml(e))},this.xml2js=function(e){var t=m(e);return null!=t?this.dom2js(t):null},this.js2xml=function(e){return h(e)},this.getVersion=function(){return"3.1.1"}}})?n.apply(t,[]):n)||(e.exports=i)},function(e,t,r){var n=r(16),i=r(6),o=r(24),a=r(17),s=r(0),c=r(33),u=r(55).upload,l=r(54),d=r(55).chunkUpload,p=r(55).abort,f=(r(195),s.supportFormData);function h(e){var t=this;t.options=s.copy(e),s.verifyOptions(e,"url fileName"),s.verifyParamPresentJustOne(e,"blob fileInput"),s.verifyCallback(e,"beginupload uploadprogress uploaddone"),e.fileInput&&(e.fileInput=s.verifyFileInput(e.fileInput)),e.type&&s.verifyFileType(e.type),e.timeout?s.verifyParamType("timeout",e.timeout,"number"):e.timeout=6e5,s.verifyFileUploadCallback(e),e.data={},e.params&&s.merge(e.data,e.params);var r,o,p=e.fileName,h=e.fileInput;function m(){if(h){if(!(o=e.type?s.filterFiles(h.files,e.type):n([]).call(h.files,0))||!o.length)return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+e.type+"类型的文件"));e.data[p]=o[0],r=h.files[0].size}else if(e.blob){var u;if(e.data[p]=e.blob,"file"!==e.type&&e.blob.type&&-1===i(u=e.blob.type).call(u,e.type))return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保选择了"+e.type+"类型的文件"));r=e.blob.size}if(e.maxSize&&r>e.maxSize)e.uploaddone(c.newFileTooLargeError("上传文件大小超过".concat(e.maxSize,"限制")));else{if(!e.commonUpload)return r>a.chunkMaxSize?void e.uploaddone(c.newFileTooLargeError("直传文件大小超过".concat(a.chunkMaxSize,"限制"))):void(t.sn=d(e,p,t,-1));if(r>a.commonMaxSize)e.uploaddone(c.newFileTooLargeError("普通上传文件大小超过".concat(a.commonMaxSize,"限制")));else if(e.s3Policy&&e.s3Policy.uploadConfig&&e.s3Policy.uploadConfig.retryPolicy){var l=e.s3Policy.uploadConfig.retryPolicy,f={accessKeyId:e.mixStoreToken.accessKeyId,secretAccessKey:e.mixStoreToken.secretAccessKey,sessionToken:e.mixStoreToken.sessionToken,region:e.mixStoreToken.region,maxRetries:l.retry},m=new e.s3;m.config.update(f);var v=decodeURIComponent(e.mixStoreToken.bucket),y=decodeURIComponent(e.mixStoreToken.objectName),b=e.data[p],S=m.upload({Bucket:v,Key:y,Body:b,Metadata:{token:e.mixStoreToken.token},ContentType:b.type||"application/octet-stream"});S.on("httpUploadProgress",(function(t){var r=Math.floor(1e4*t.loaded/t.total)/100,n={docId:e.docId,total:t.total,loaded:t.loaded,percentage:r,percentageText:r+"%"};e.fileInput&&(n.fileInput=e.fileInput),e.blob&&(n.blob=e.blob),e.uploadprogress(n)})),S.send((function(r,n){if(e.docId&&(n.docId=e.docId),r){var o;e.logger.error("error:","api::s3:upload file failed",r);var a=e.providers[(i(o=e.providers).call(o,e.curProvider)+1)%e.providers.length];l.retryNext&&a?(t.addCircuitTimer(e,a),1===a&&e.getMixStoreToken(1,(function(t){e.mixStoreToken=t,g()}))):t.onError(n)}else{var s=t.options.s3Policy.cdnSchema;s=(s=s.replace("{cdnDomain}",t.options.s3Policy.dlcdn)).replace("{objectName}",n.Key),e.uploaddone(null,{size:b.size,name:b.name,url:s,ext:b.name.split(".")[1]||"unknown",_url_safe:e.mixStoreToken.shortUrl,isS3:!0})}}))}}}function g(){if(f){if(h){if(!(o=e.type?s.filterFiles(h.files,e.type):n([]).call(h.files,0))||!o.length)return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+e.type+"类型的文件"));e.data[p]=o[0],r=h.files[0].size}else if(e.blob){var g;if(e.data[p]=e.blob,"file"!==e.type&&e.blob.type&&-1===i(g=e.blob.type).call(g,e.type))return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保选择了"+e.type+"类型的文件"));r=e.blob.size}if(e.maxSize&&r>e.maxSize)return void e.uploaddone(c.newFileTooLargeError("上传文件大小超过".concat(e.maxSize,"限制")));if(!e.commonUpload)return r>a.chunkMaxSize?void e.uploaddone(c.newFileTooLargeError("直传文件大小超过".concat(a.chunkMaxSize,"限制"))):(t.onLbsUrlFail=function(t){l.startUniErrCache("nos",{user_id:e.account,action:"upload"}),l.updateUniErrCache("nos",{operation_type:"transfer",error:"lbs failed",target:t})},void(t.sn=d(e,p,t,-1)));if(r>a.commonMaxSize)return void e.uploaddone(c.newFileTooLargeError("普通上传文件大小超过".concat(a.commonMaxSize,"限制")))}else s.dataset(h,"name",p),e.data.input=h;var v={data:e.data,onaftersend:function(){e.beginupload(t)},onuploading:function(t){var r=Math.floor(1e4*t.loaded/t.total)/100,n={docId:e.docId,total:t.total,loaded:t.loaded,percentage:r,percentageText:r+"%"};e.fileInput&&(n.fileInput=e.fileInput),e.blob&&(n.blob=e.blob),e.uploadprogress(n)},onload:function(r){var n;if(e.docId&&(r.docId=e.docId),r.Error)if(e.mixEnable&&1===e.curProvider){var o=e.nosPolicy.uploadConfig.retryPolicy,a=e.providers[(i(n=e.providers).call(n,e.curProvider)+1)%e.providers.length];o.retryNext&&a?(t.addCircuitTimer(e,a),2===a&&e.getMixStoreToken(2,(function(t){e.mixStoreToken=t,m()}))):t.onError(r)}else t.onError(r);else e.uploaddone(null,r)},onerror:function(r){var n;if(e.mixEnable&&1===e.curProvider){var o,a=e.nosPolicy.uploadConfig.retryPolicy,s=e.providers[(i(o=e.providers).call(o,e.curProvider)+1)%e.providers.length];if(a.retryNext&&s)t.addCircuitTimer(e,s),2===s&&e.getMixStoreToken(2,(function(t){e.mixStoreToken=t,m()}));else try{n=r.result?JSON.parse(r.result):r,t.onError(n)}catch(n){e.uploaddone(new c(r.message,r.code),t.options)}}else try{n=r.result?JSON.parse(r.result):r,t.onError(n)}catch(n){e.uploaddone(new c(r.message,r.code),t.options)}}};f||(v.mode="iframe"),v.putFileAtEnd=!0,t.sn=u(e.url,v)}e.mixEnable&&2===e.curProvider?m():g()}h.prototype.addCircuitTimer=function(e,t){var r=this;if(e.curProvider=t,e.s3Policy&&e.nosPolicy){var n=e[1===e.curProvider?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!n||0===n)return;r.circuitTimer&&clearTimeout(r.circuitTimer),r.circuitTimer=o((function(){e.curProvider=e.providers[0],r.circuitTimer=void 0}),1e3*n)}},h.prototype.onError=function(e){var t,r,n,i=this.options;r=(t=(e=e||{}).Error||e||{}).Code||t.code||"unknown",n=t.Message||t.message||"未知错误",i.uploaddone(new c(r+"("+n+")",r))},h.prototype.abort=function(){p(this.sn)},e.exports=h},function(e,t,r){var n,i=r(106),o=r(6),a=r(11),s=r(23),c=r(8),u=r(16),l=r(9),d=r(0),p=r(44).fn,f=r(200),h=r(198),m=r(33);p.transDoc=function(e){var t;d.verifyOptions(e,"fileInput done","nos::transDoc");try{var r=e.fileInput.files[0],n=["ppt","pdf","pptx","doc","docx"],c=e.fileInputName=r.name,u={ppt:1,pptx:2,pdf:3,doc:6,docx:7},l=c.substring(i(c).call(c,".")+1);if(o(n).call(n,l)<0)return void e.done(m.newNoFileError("请上传正确格式的文件【ppt, pptx, pdf, doc, docx】",{callFunc:"nos: transDoc",fileInput:e.fileInput}),e)}catch(t){return void e.done(m.newNoFileError("请上传正确的文件节点",{callFunc:"msg::previewFile",fileInput:e.fileInput}),e)}var p=a(h.genResponseBody("file")||{}).replace(/"/gi,'\\"'),f={transToken:{name:c,type:u[l],transType:"png"===e.transcode?11:10,size:r.size,body:p}};this.getNosTokenTrans({responseBody:f,nosToken:{nosScene:e.nosScene||this.nosScene,nosSurvivalTime:e.nosSurvivalTime},callback:s(t=function(t,r){t?e.done(t):(e.nosToken=r.nosToken,e.docId=r.docId,this._doPreviewFile(e))}).call(t,this)})},p.getSimpleNosToken=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.num=1,d.verifyOptions(e),this.cbAndSendCmd("getSimpleNosToken",e)},p.getNosToken=function(e){var t=e.callback,r=e.nosToken,n=e.responseBody,i={tag:r.nosScene};r.nosSurvivalTime&&r.nosSurvivalTime!==1/0&&(i.expireSec=r.nosSurvivalTime),this.sendCmd("getNosToken",{responseBody:n,nosToken:i},t)},p.getNosTokenTrans=function(e){this.sendCmd("getNosTokenTrans",e.responseBody,e.callback)},p.getMixStoreToken=function(e){this.sendCmd("getMixStoreToken",{mixTokenReq:{provider:e.curProvider,tokenCount:e.tokenCount||1,tag:"im",returnBody:e.responseBody}},e.callback)},p.packFileDownloadName=function(e){d.verifyOptions(e,"url name",!0,"","nos::packFileDownloadName");var t=e.url;return t+d.genUrlSep(t)+"download="+encodeURIComponent(e.name)},p.audioToMp3=function(e){d.verifyOptions(e,"url","nos::audioToMp3");var t=e.url;return t+d.genUrlSep(t)+"audioTrans&type=mp3"},p.removeFile=function(e){this.sendCmd("removeFile",e,e.callback)},p.fetchFile=function(e){this.sendCmd("fetchFile",e,e.callback)},p.fetchFileList=function(e){this.sendCmd("fetchFileList",e,e.callback)},p.stripImageMeta=function(e){return this.beforeProcessImage(e,"stripmeta")},p.qualityImage=function(e){return this.beforeProcessImage(e,"quality")},p.interlaceImage=function(e){return this.beforeProcessImage(e,"interlace")},p.rotateImage=function(e){return this.beforeProcessImage(e,"rotate")},p.blurImage=function(e){return this.beforeProcessImage(e,"blur")},p.cropImage=function(e){return this.beforeProcessImage(e,"crop")},p.thumbnailImage=function(e){return this.beforeProcessImage(e,"thumbnail")},p.beforeProcessImage=function(e,t){var r=d.copy(e);return r.type=t,e.ops=[r],this.processImage(e)},p.processImage=function(e){var t,r=this;d.verifyOptions(e,"url ops",!0,"","nos::processImage"),d.verifyParamType("ops",e.ops,"array","nos::processImage");var n=c(t=e.ops).call(t,(function(e){var t,n;return d.verifyOptions(e,"type",!0,"","nos::processImage"),d.verifyParamValid("type",e.type,f.validTypes,"nos::processImage"),r["gen"+u(t=e.type).call(t,0,1).toUpperCase()+u(n=e.type).call(n,1)+"Op"](e)}));r.processCallback(e),r.sendCmd("processImage",{url:e.url,imageOps:n},e.callback)},p.genStripmetaOp=function(e){return new f({type:e.type,stripmeta:e.strip?1:0})},p.genQualityOp=function(e){d.verifyOptions(e,"quality",!0,"","nos::genQualityOp"),d.verifyParamType("quality",e.quality,"number","nos::genQualityOp"),d.verifyParamMin("quality",e.quality,0,"nos::genQualityOp"),d.verifyParamMax("quality",e.quality,100,"nos::genQualityOp");var t=Math.round(e.quality);return new f({type:e.type,qualityQuality:t})},p.genInterlaceOp=function(e){return new f({type:e.type})},p.genRotateOp=function(e){for(d.verifyOptions(e,"angle",!0,"","nos::genRotateOp"),d.verifyParamType("angle",e.angle,"number","nos::genRotateOp");e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t=Math.round(e.angle);return new f({type:e.type,rotateAngle:t})},p.genBlurOp=function(e){d.verifyOptions(e,"radius sigma","nos::genBlurOp"),d.verifyParamType("radius",e.radius,"number","nos::genBlurOp"),d.verifyParamMin("radius",e.radius,1,"nos::genBlurOp"),d.verifyParamMax("radius",e.radius,50,"nos::genBlurOp"),d.verifyParamType("sigma",e.sigma,"number","nos::genBlurOp"),d.verifyParamMin("sigma",e.sigma,0,"nos::genBlurOp");var t=Math.round(e.radius),r=Math.round(e.sigma);return new f({type:e.type,blurRadius:t,blurSigma:r})},p.genCropOp=function(e){d.verifyOptions(e,"x y width height","nos::genCropOp"),d.verifyParamType("x",e.x,"number","nos::genCropOp"),d.verifyParamMin("x",e.x,0,"nos::genCropOp"),d.verifyParamType("y",e.y,"number","nos::genCropOp"),d.verifyParamMin("y",e.y,0,"nos::genCropOp"),d.verifyParamType("width",e.width,"number","nos::genCropOp"),d.verifyParamMin("width",e.width,0,"nos::genCropOp"),d.verifyParamType("height",e.height,"number","nos::genCropOp"),d.verifyParamMin("height",e.height,0,"nos::genCropOp");var t=Math.round(e.x),r=Math.round(e.y),n=Math.round(e.width),i=Math.round(e.height);return new f({type:e.type,cropX:t,cropY:r,cropWidth:n,cropHeight:i})},p.genThumbnailOp=(n={cover:"z",contain:"x",crop:"y"},function(e){d.verifyOptions(e,"mode","nos::genThumbnailOp"),d.verifyParamValid("mode",e.mode,l(n),"nos::genThumbnailOp"),"contain"===e.mode?d.verifyParamAtLeastPresentOne(e,"width height","nos::genThumbnailOp"):d.verifyOptions(e,"width height","nos::genThumbnailOp"),d.undef(e.width)&&(e.width=0),d.undef(e.height)&&(e.height=0),d.verifyParamType("width",e.width,"number","nos::genThumbnailOp"),d.verifyParamMin("width",e.width,0,"nos::genThumbnailOp"),d.verifyParamType("height",e.height,"number","nos::genThumbnailOp"),d.verifyParamMin("height",e.height,0,"nos::genThumbnailOp");var t=Math.round(e.width),r=Math.round(e.height),i=new f({type:e.type,thumbnailMode:n[e.mode],thumbnailWidth:t,thumbnailHeight:r});if("crop"===e.mode&&d.notundef(e.axis)){d.undef(e.axis.x)&&(e.axis.x=5),d.undef(e.axis.y)&&(e.axis.y=5),d.verifyParamMin("axis.x",e.axis.x,0,"nos::genThumbnailOp"),d.verifyParamMax("axis.x",e.axis.x,10,"nos::genThumbnailOp"),d.verifyParamMin("axis.y",e.axis.y,0,"nos::genThumbnailOp"),d.verifyParamMax("axis.y",e.axis.y,10,"nos::genThumbnailOp");var o=Math.round(e.axis.x),a=Math.round(e.axis.y);i.thumbnailAxisX=o,i.thumbnailAxisY=a}return d.notundef(e.enlarge)&&(d.verifyParamType("enlarge",e.enlarge,"boolean","nos::genThumbnailOp"),e.enlarge&&(i.thumbnailEnlarge=1)),i.thumbnailToStatic=this.options.thumbnailToStatic?1:0,i}),p.getNosOriginUrl=function(e){var t;d.verifyOptions(e,"safeShortUrl",!0,"","nos::getNosOriginUrl"),d.verifyParamType("safeShortUrl",e.safeShortUrl,"string","nos::getNosOriginUrl"),/^http(s)?:/.test(e.safeShortUrl)&&~o(t=e.safeShortUrl).call(t,"im_url=1")?(this.processCallback(e),this.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e.safeShortUrl}},e.callback)):e.done(new m("参数 “safeShortUrl” 内容非文件安全短链",{callFunc:"nos: getNosOriginUrl"}),e)}},function(e,t,r){var n,i=r(10),o=r(6),a=r(9),s=r(28),c=r(82),u=c.genUrlSep,l=c.url2object,d=c.object2url,p=r(0),f=r(44).fn;f.viewImageSync=function(e){var t=this.options;p.verifyOptions(e,"url","nos::viewImageSync");var r=e.url,n=l(r),a=n.protocol,c=n.hostname,u=n.path,f=n.query;if("boolean"==typeof e.strip&&(f.stripmeta=e.strip?1:0),"number"==typeof e.quality&&(p.verifyParamMin("quality",e.quality,0,"nos::viewImageSync"),p.verifyParamMax("quality",e.quality,100,"nos::viewImageSync"),f.quality=Math.round(e.quality)),"boolean"==typeof e.interlace&&(f.interlace=e.interlace?1:0),"number"==typeof e.rotate&&(f.rotate=Math.round(e.rotate)),"object"===s(e.thumbnail)){var h=e.thumbnail.mode||"crop",m=e.thumbnail.width,g=e.thumbnail.height;if(m>=0&&g>=0&&m<4096&&g<4096&&(m>0||g>0)){var v,y;switch(h){case"crop":h="y";break;case"contain":default:h="x";break;case"cover":h="z"}f.thumbnail=i(v=i(y="".concat(m)).call(y,h)).call(v,g)}}if(t.downloadUrl){var b=l(e.url),S=t.downloadUrl,_=b.path,M=o(_).call(_,"/");if(-1!==M){var T=_.substring(0,M),w=_.substring(M+1);S=S.replace("{bucket}",T).replace("{object}",w)}var x=l(S);return d({protocol:x.protocol,hostname:x.hostname,path:x.path,query:p.merge(x.query,f)})}return d({protocol:a,hostname:c,path:u,query:f})},f.viewImageStripMeta=function(e){p.verifyOptions(e,"url strip","nos::viewImageStripMeta"),p.verifyParamType("strip",e.strip,"boolean","nos::viewImageStripMeta");var t="stripmeta="+(e.strip?1:0),r=u(e.url);return e.url+r+t},f.viewImageQuality=function(e){p.verifyOptions(e,"url quality","nos::viewImageQuality"),p.verifyParamType("quality",e.quality,"number","nos::viewImageQuality"),p.verifyParamMin("quality",e.quality,0,"nos::viewImageQuality"),p.verifyParamMax("quality",e.quality,100,"nos::viewImageQuality");var t="quality="+Math.round(e.quality),r=u(e.url);return e.url+r+t},f.viewImageInterlace=function(e){p.verifyOptions(e,"url","nos::viewImageInterlace");var t=u(e.url);return e.url+t+"interlace=1"},f.viewImageRotate=function(e){for(p.verifyOptions(e,"url angle","nos::viewImageRotate"),p.verifyParamType("angle",e.angle,"number","nos::viewImageRotate");e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t="rotate="+Math.round(e.angle),r=u(e.url);return e.url+r+t},f.viewImageBlur=function(e){p.verifyOptions(e,"url radius sigma","nos::viewImageBlur"),p.verifyParamType("radius",e.radius,"number","nos::viewImageBlur"),p.verifyParamMin("radius",e.radius,1,"nos::viewImageBlur"),p.verifyParamMax("radius",e.radius,50,"nos::viewImageBlur"),p.verifyParamType("sigma",e.sigma,"number","nos::viewImageBlur"),p.verifyParamMin("sigma",e.sigma,0,"nos::viewImageBlur");var t="blur="+Math.round(e.radius)+"x"+Math.round(e.sigma),r=u(e.url);return e.url+r+t},f.viewImageCrop=function(e){p.verifyOptions(e,"url x y width height","nos::viewImageCrop"),p.verifyParamType("x",e.x,"number","nos::viewImageCrop"),p.verifyParamMin("x",e.x,0,"nos::viewImageCrop"),p.verifyParamType("y",e.y,"number","nos::viewImageCrop"),p.verifyParamMin("y",e.y,0,"nos::viewImageCrop"),p.verifyParamType("width",e.width,"number","nos::viewImageCrop"),p.verifyParamMin("width",e.width,0,"nos::viewImageCrop"),p.verifyParamType("height",e.height,"number","nos::viewImageCrop"),p.verifyParamMin("height",e.height,0,"nos::viewImageCrop");var t="crop="+Math.round(e.x)+"_"+Math.round(e.y)+"_"+Math.round(e.width)+"_"+Math.round(e.height),r=u(e.url);return e.url+r+t},f.viewImageThumbnail=(n={cover:"z",contain:"x",crop:"y"},function(e){p.verifyOptions(e,"url mode","nos::viewImageThumbnail"),p.verifyParamValid("mode",e.mode,a(n),"nos::viewImageThumbnail"),"contain"===e.mode?p.verifyParamAtLeastPresentOne(e,"width height","nos::viewImageThumbnail"):p.verifyOptions(e,"width height","nos::viewImageThumbnail"),p.undef(e.width)&&(e.width=0),p.undef(e.height)&&(e.height=0),p.verifyParamType("width",e.width,"number","nos::viewImageThumbnail"),p.verifyParamMin("width",e.width,0,"nos::viewImageThumbnail"),p.verifyParamType("height",e.height,"number","nos::viewImageThumbnail"),p.verifyParamMin("height",e.height,0,"nos::viewImageThumbnail");var t=Math.round(e.width),r=Math.round(e.height),i="thumbnail="+t+n[e.mode]+r;"crop"===e.mode&&p.notundef(e.axis)&&(p.undef(e.axis.x)&&(e.axis.x=5),p.undef(e.axis.y)&&(e.axis.y=5),p.verifyParamMin("axis.x",e.axis.x,0,"nos::viewImageThumbnail"),p.verifyParamMax("axis.x",e.axis.x,10,"nos::viewImageThumbnail"),p.verifyParamMin("axis.y",e.axis.y,0,"nos::viewImageThumbnail"),p.verifyParamMax("axis.y",e.axis.y,10,"nos::viewImageThumbnail"),i=i+"&axis="+Math.round(e.axis.x)+"_"+Math.round(e.axis.y)),p.notundef(e.enlarge)&&(p.verifyParamType("enlarge",e.enlarge,"boolean","nos::viewImageThumbnail"),e.enlarge&&(i+="&enlarge=1"));var o=u(e.url);return e.url+o+i})},function(e,t,r){var n=r(433);e.exports=n},function(e,t,r){var n=r(15),i=r(434),o=r(436),a=Array.prototype,s=String.prototype;e.exports=function(e){var t=e.includes;return e===a||n(a,e)&&t===a.includes?i:"string"==typeof e||e===s||n(s,e)&&t===s.includes?o:t}},function(e,t,r){r(435);var n=r(22);e.exports=n("Array").includes},function(e,t,r){var n=r(2),i=r(127).includes,o=r(148);n({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(e,t,r){r(437);var n=r(22);e.exports=n("String").includes},function(e,t,r){var n=r(2),i=r(7),o=r(438),a=r(83),s=r(42),c=r(440),u=i("".indexOf);n({target:"String",proto:!0,forced:!c("includes")},{includes:function(e){return!!~u(s(a(this)),s(o(e)),arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(1),i=r(439),o=n.TypeError;e.exports=function(e){if(i(e))throw o("The method doesn't accept regular expressions");return e}},function(e,t,r){var n=r(27),i=r(67),o=r(18)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(18)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){var n=r(6),i=r(219),o=r(28),a=r(0),s=r(44).fn;function c(e,t,r,i){var o=!1,a="";if(1===r?n(e).call(e,t)>=0&&(o=!0,a=t):2===r&&(a=new RegExp(t,"g")).test(e)&&(o=!0),o&&""!==a)switch(i){case 1:return e.replace(a,"**");case 2:return{code:2};case 3:return{code:3}}return e}function u(e,t){for(var r=t.match,n=t.operate,a=e,s=0;s<i(t).length;s++){var u=i(t)[s],l=u.match||r,d=u.operate||n;try{if(a=c(a,u.key,l,d),"object"===o(a))return a}catch(e){this.logger.warn("misc::filterContent: js cannot parse this regexp ",e)}}return a}s.uploadSdkLogUrl=function(e){return a.verifyOptions(e,"url","misc::uploadSdkLogUrl"),this.cbAndSendCmd("uploadSdkLogUrl",e)},s.getClientAntispamLexicon=function(e){var t=this,r=(e=e||{}).done;r instanceof Function||(r=function(){}),e={clientAntispam:{version:0}};var n=this;return this.protocol.sendCmd("getClientAntispam",e,(function(e,i,o){e?(n.protocol.logger.error("misc::getClientAntispamLexicon:",e),r.call(t,e,{})):(n.antispamLexicon=o.clientAntispam||{},r.call(t,null,o))}))},s.filterClientAntispam=function(e){var t=e.content,r=e.antispamLexicon;if(!t)return{code:404,errmsg:"待反垃圾文本content不存在"};r=r||this.antispamLexicon||{};var n=this.antispamLexicon&&this.antispamLexicon.thesaurus;if(!n)return{code:404,errmsg:"没有反垃圾词库或者词库格式不合法"};try{n=JSON.parse(n).thesaurus}catch(e){return this.protocol.logger.error("misc::filterClientAntispam: parse thesaurus error"),{code:500,errmsg:"反垃圾词库格式不合法"}}for(var i=t,a=0;a<n.length;a++)if(i=u.call(this,i,n[a]),"object"===o(i)){if(2===i.code)return{code:200,type:2,errmsg:"建议拒绝发送",content:t,result:""};if(3===i.code)return{code:200,type:3,errmsg:"建议服务器处理反垃圾，发消息带上字段clientAntiSpam",content:t,result:t}}return i===t?{code:200,type:0,errmsg:"",content:t,result:i}:{code:200,type:1,errmsg:"已对特殊字符做了过滤",content:t,result:i}},s.getServerTime=function(e){this.processCallback(e),this.sendCmd("getServerTime",{},e.callback)},s.getNosAccessToken=function(e){a.verifyOptions(e,"url","misc::getNosAccessToken"),this.processCallback(e);var t={url:e.url};e.userAgent&&(t.userAgent=e.userAgentv),e.ext&&(t.ext=e.ext),this.sendCmd("getNosAccessToken",{nosAccessTokenTag:t},(function(t,r,i){var o=i&&i.nosAccessTokenTag&&i.nosAccessTokenTag.token,a=e.url,s=o?{token:o,resUrl:n(a).call(a,"?")?a+"&token="+o:a+"?token="+o}:{};e.done(t,s)}))},s.deleteNosAccessToken=function(e){a.verifyOptions(e,"token","misc::deleteNosAccessToken"),this.processCallback(e),this.sendCmd("deleteNosAccessToken",{nosAccessTokenTag:{token:e.token}},e.callback)}},function(e,t,r){r(58);var n=r(47),i=r(25),o=r(15),a=r(443),s=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.keys;return e===s||o(s,e)&&t===s.keys||i(c,n(e))?a:t}},function(e,t,r){var n=r(444);e.exports=n},function(e,t,r){r(76),r(88);var n=r(22);e.exports=n("Array").keys},function(e,t,r){var n=r(10),i=r(44).fn,o=r(0),a=r(55),s=r(17),c=r(53);(c=c||{}).name=c.name||"",c.version=c.version||"",i.reportLogs=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this,i=r.options,u=s.ntServerAddress;if(u){var l=s.info;t=o.merge(t,{appkey:i.appKey,uid:i.account,os:"web",session:r.protocol.sdkSession||"",ver:l.sdkVersion,type:r.subType,platform:n(e="".concat(c.name.toLowerCase())).call(e,c.version.replace(/(\.\d+)+$/,""))});var d=u+o.genUrlSep(u),p=[];for(var f in t){var h;p.push(n(h="".concat(f,"=")).call(h,t[f]))}d+=p.join("&"),a(d,{proxyUrl:o.url2origin(d)+"/lbs/res/cors/nej_proxy_frame.html",timeout:s.xhrTimeout,onload:function(){},onerror:function(e){r.logger.error("report::ajax report error",e)}})}}},function(e,t,r){var n=r(28),i=r(4),o=r(8),a=r(11),s=r(44).fn,c=r(0),u=r(141),l=r(201);s.signalingCreate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=e.channelName,n=e.ext;return c.verifyOptions(e,"type","api::signalling"),this.sendCmdUsePromise("signalingCreate",{avSignalTag:{type:t,channelName:r,ext:n}}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingDelay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingDelay",{avSignalTag:e}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingClose=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingClose",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingJoin=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingJoin",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingLeave=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingLeave",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingGetChannelInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.channelName;return c.verifyOptions(e,"channelName","api::signalling"),this.sendCmdUsePromise("signalingGetChannelInfo",{avSignalTag:{channelName:t}}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingInvite=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.offlineEnabled,o=e.pushInfo,s=void 0===o?{}:o;c.verifyOptions(e,"channelId requestId account","api::signalling"),"object"===n(s.pushPayload)&&(s.pushPayload=a(s.pushPayload));var u=c.merge(e,s,{to:t,isSave:!0===r?1:0,needPush:!0===s.needPush?1:0,needBadge:!1===s.needBadge?0:1});return this.sendCmdUsePromise("signalingInvite",{avSignalTag:u}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,t.needBadge=1===t.needBadge,t.needPush=1===t.needPush,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingCancel=function(e){var t=e.account,r=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingCancel",{avSignalTag:c.merge(e,{to:t,isSave:!0===r?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingCreateAndJoin=function(e){var t=this,r=e.channelName,n=e.uid,o=void 0===n?0:n,a=e.offlineEnabled,s=void 0===a||a,u=e.attachExt,l=void 0===u?"":u;return this.signalingCreate(e).catch((function(e){return 10405===e.code?(t.logger.warn("api::avSignal:signalingCall room already exists:",e),t.signalingGetChannelInfo({channelName:r})):i.reject(e)})).then((function(e){var r={channelId:e.channelId,offlineEnabled:s,attachExt:l};return o&&c.merge(r,{uid:o}),t.signalingJoin(r)}))},s.signalingCall=function(e){var t=this,r=e.account,n=e.offlineEnabled,i=e.requestId;c.verifyOptions(e,"type requestId account","api::signalling");var o="";return this.signalingCreateAndJoin(e).then((function(a){o=a.channelId||o,t.logger.info("api::avSignal:signalingCall join:",o);var s={channelId:o,account:r,requestId:i,offlineEnabled:n,attachExt:e.attachExt||"",pushInfo:e.pushInfo||{}};return t.signalingInvite(s)}))},s.signalingReject=function(e){var t=e.account,r=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingReject",{avSignalTag:c.merge(e,{to:t,isSave:!0===r?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingAccept=function(e){var t=this,r=e.account,n=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingAccept",{avSignalTag:c.merge(e,{to:r,isSave:!0===n?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))})).then((function(r){if(e.autoJoin){var n={channelId:e.channelId,offlineEnabled:e.offlineEnabled,attachExt:e.joinAttachExt,uid:e.uid};return t.signalingJoin(n)}return r}))},s.signalingControl=function(e){var t=e.account;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingControl",{avSignalTag:c.merge(e,t?{to:t}:{})}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingSync=function(){return this.sendCmdUsePromise("sync",{sync:{avSignal:0}}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},s.signalingMarkMsgRead=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c.verifyOptions(e,"msgid","api::signalling");var t,r=u.idMap.avSignal;return t="string"==typeof e.msgid?[e.msgid]:e.msgid,this.sendCmd("batchMarkRead",{sid:r.id,cid:r.signalingNotify,ids:t})}},function(e,t,r){var n=r(448);e.exports=n},function(e,t,r){r(449);var n=r(12);e.exports=n.Object.assign},function(e,t,r){var n=r(2),i=r(450);n({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},function(e,t,r){var n=r(26),i=r(7),o=r(31),a=r(13),s=r(91),c=r(136),u=r(111),l=r(37),d=r(94),p=Object.assign,f=Object.defineProperty,h=i([].concat);e.exports=!p||a((function(){if(n&&1!==p({b:1},p(f({},"a",{enumerable:!0,get:function(){f(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol();return e[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=p({},e)[r]||"abcdefghijklmnopqrst"!=s(p({},t)).join("")}))?function(e,t){for(var r=l(e),i=arguments.length,a=1,p=c.f,f=u.f;i>a;)for(var m,g=d(arguments[a++]),v=p?h(s(g),p(g)):s(g),y=v.length,b=0;y>b;)m=v[b++],n&&!o(f,g,m)||(r[m]=g[m]);return r}:p},function(e,t,r){var n=r(452);e.exports=n},function(e,t,r){r(453);var n=r(12);e.exports=n.Date.now},function(e,t,r){var n=r(2),i=r(1),o=r(7),a=i.Date,s=o(a.prototype.getTime);n({target:"Date",stat:!0},{now:function(){return s(new a)}})},function(e,t,r){var n=r(10),i=r(11),o=r(23),a=r(24),s=r(9),c=r(4),u=r(64).fn,l=r(33),d=r(455),p=r(202),f=r(17),h=r(54),m=r(0);function g(e){this.logger.log("offlineListener enter"),this.forceDisconnect(),this.options.ondisconnect&&this.options.ondisconnect({callFunc:"link::offlineListener",message:"offlineListener disconnect"}),this.onDisconnect("link::offlineListener")}function v(){var e=this;this.logger.log("onlineListener start"),this&&this.isConnected()&&!this.connecting?(this.stopHeartbeat(),this.sendCmd("heartbeat",null,(function(t){if(t){e.logger.info("onlineListener heartbeat detect error",t);try{e.forceDisconnect(),e.onDisconnect("link::onHeartbeat")}catch(t){e.logger.info("onlineListener heartbeat websocket.onclose",t)}}else e.logger.log("onlineListener heartbeat detect success")}))):this.logger.log("onlineListener disconnected or connecting",this&&this.isConnected(),this.connecting)}u.initConnect=function(){this.socket=null,this.retryCount=0,this.connecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.doLogout=!1,h.initUniErrReport({appKey:this.options.appKey})},u.resetConnect=function(){var e=this.options;m.notundef(e.needReconnect)?(m.verifyParamType("needReconnect",e.needReconnect,"boolean","link::resetConnect"),this.needReconnect=e.needReconnect):this.needReconnect=!0,this.logger.info("link::resetConnect: needReconnect ".concat(this.needReconnect)),m.notundef(e.reconnectionAttempts)&&m.verifyParamType("reconnectionAttempts",e.reconnectionAttempts,"number","link::resetConnect"),m.notundef(e.noCacheLinkUrl)&&m.verifyParamType("noCacheLinkUrl",e.noCacheLinkUrl,"boolean","link::resetConnect"),this.reconnectionAttempts="number"==typeof e.reconnectionAttempts?e.reconnectionAttempts:1/0,this.backoff=new d({min:f.reconnectionDelay,max:f.reconnectionDelayMax,jitter:f.reconnectionJitter})},u.connect=function(){if(clearTimeout(this.connectTimer),this.isConnected())this.logger.warn("link::connect: already connected");else if(this.connecting)this.logger.warn("link::connect: already connecting");else if(h.restore(),this.autoconnect||h.startUniErrCache("login",{user_id:this.options.account,action:"manual_login"}),this.connecting=!0,this.hasNotifyDisconnected=!1,this.shouldReconnect=!0,this.socket&&this.forceDisconnect(),this.logger.info("link::connect: connect to new socket, autoconnect is "+this.autoconnect),"string"==typeof this.options.socketUrl)this.connectToUrl(this.options.socketUrl);else{var e=this.getNextSocketUrl();e&&!this.options.noCacheLinkUrl?this.connectToUrl(e):this.refreshSocketUrl()}},u.getNextSocketUrl=function(){return this.socketUrls.shift()},u.isConnected=function(){return!!this.socket&&!!this.socket.socket&&this.socket.socket.connected},u.connectToUrl=function(e){var t,r,a,s,c,u,l=this;if(e=e||"",l.url=e,l.logger.info("link::connectToUrl: ".concat(e)),"undefined"==typeof window){var d=m.getGlobal(),h=e.split(":");d&&!d.location&&h.length>1&&(d.location={protocol:h.shift(),port:h.pop(),hostname:h.join("")}),this.options.transports=["websocket"]}var g=this.options.transports||["websocket","xhr-polling"];l.socket=p.connect(e,{transports:g,reconnect:!1,"force new connection":!0,"connect timeout":f.connectTimeout}),l.logger.info(n(t="link::connectToUrl: socket url: ".concat(e,", transports: ")).call(t,i(g))),l.handshakeUrl=e,l.socket.on("connect",o(r=l.onConnect).call(r,l)),l.socket.on("handshake_failed",o(a=l.onHandshakeFailed).call(a,l)),l.socket.on("connect_failed",o(s=l.onConnectFailed).call(s,l)),l.socket.on("error",o(c=l.onError).call(c,l)),l.socket.on("message",o(u=l.onMessage).call(u,l)),l.socket.on("disconnect",(function(t){l.logger.warn("link::connectToUrl: socket url: ".concat(e,", disconnected")),l.hasLogin=!1,l.doLogout?l.logout():l.onDisconnect("link::socketDisconnect")}))},u.disconnect=function(e){var t=this;function r(r){t.logger.info("link::disconnect: socket finally closed, ",r),clearTimeout(t.disconnectCallbackTimer),t.msgAckBufferManager&&t.msgAckBufferManager.clear(),e(r)}e instanceof Function||(e=function(){}),clearTimeout(t.connectTimer),t.disconnectCallbackTimer=a((function(){e.call(t,"mark disconnected due to timeout")}),1e4),t.mixStorePolicy=null,t.appGrayConfig=null,clearTimeout(t.mixStorePolicyClock),this.onlineListener&&"undefined"!=typeof window&&m.isFunction(window.removeEventListener)&&(window.removeEventListener("online",this.onlineListener),window.removeEventListener("offline",this.offlineListener)),t.socket&&t.socket.socket&&t.socket.socket.transport?t.socket.socket.transport.onDisconnectDone=function(e){r(e)}:r(null),t.isConnected()?(t.logger.warn("link::disconnect: start disconnecting"),t.logout()):t.connecting?(t.logger.warn("link::disconnect: abort connecting"),t.disconnectSocket()):(t.logger.warn("link::disconnect: start otherwise"),t.connecting=!1,t.shouldReconnect=!1,t.socket=null,t.autoconnect=!1,t.options.ondisconnect({callFunc:"link::disconnect",message:"manually disconnect status"}))},u.onConnect=function(){this.backoff&&this.backoff.reset(),this.retryCount=0,this.connecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.logger.info("link::onConnect: socket onconnected, start login"),h.updateUniSuccCache("login",{operation_type:"TCP",target:this.url}),this.login(),this.api.reportLogs({event:"ws_connected"})},u.onHandshakeFailed=function(){this.logger.warn("link::onHandshakeFailed: shandshake failed"),this.api.reportLogs({event:"ws_handshake_failed"}),h.updateUniErrCache("login",{operation_type:"TCP",error:"ws_handshake_failed",target:this.handshakeUrl}),this.onDisconnect("link::onHandshakeFailed")},u.onConnectFailed=function(){this.api.reportLogs({event:"ws_connect_failed"}),this.onDisconnect("link::onConnectFailed")},u.onError=function(){var e=arguments[0];if(e){if(h.updateUniErrCache("login",{operation_type:"TCP",error:"connect_timeout"}),this.api.reportLogs({event:"connect_timeout"}),void 0!==e.x5ImgDecodeStatus)return;if("[object Object]"===Object.prototype.toString.call(e)&&s(e).length<=0)return;this.onMiscError("连接错误",new l(e,"LINK_ERROR",{callFunc:"link::onError"}))}this.connecting=!1},u.onDisconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.logger.warn("socket::onDisconnect: "+e),this.connecting=!1,this.markAllCallbackInvalid(l.newNetworkError({callFunc:e})),this.msgAckBufferManager&&this.msgAckBufferManager.clear(),this.stopHeartbeat(),this.reconnect()},u.willReconnect=function(){return this.shouldReconnect&&this.needReconnect&&this.retryCount<this.reconnectionAttempts},u.reconnect=function(){this.willReconnect()?(h.startUniErrCache("login",{user_id:this.options.account,action:"auto_login"}),this.socket&&(this.logger.info("link::reconnect: try to force disconnect"),this.forceDisconnect()),this.doReconnect()):this.notifyDisconnect()},u.doReconnect=function(){var e,t=this;this.logger.warn("doReconnect"),t.socket=null,t.retryCount++,t.hasLogin=!1;var r=t.backoff.duration();t.logger.info(n(e="link::reconnect: will retry after ".concat(r,"ms, retryCount ")).call(e,t.retryCount));var i=t.options.onwillreconnect({retryCount:t.retryCount,duration:r});clearTimeout(t.connectTimer),t.connectTimer=a((function(){1==+t.options.authType&&i instanceof c?(t.logger.info("link::reconnect: wait onwillreconnect promise"),i.finally((function(){return t.connect()}))):t.connect()}),r)},u.notifyConnectError=function(e){var t=l.newConnectError({message:e,callFunc:"link::notifyConnectError"});this.logger.error("link::notifyConnectError:",t),this.options.onerror(t)},u.notifyDisconnect=function(e){this.hasNotifyDisconnected?this.logger.warn("notifyDisconnect:: already notified"):(this.hasNotifyDisconnected=!0,this.disconnectSocket(),this.forceDisconnect(),(e=e||new l).retryCount=this.retryCount,e.willReconnect=this.willReconnect(),this.backoff&&this.backoff.reset(),this.retryCount=0,this.autoconnect=!1,this.logger.info("link::notifyDisconnect: ondisconnected",e),this.options.ondisconnect(e),h.concludeUniErrCache("login",1),this.onWbNotifyHangup instanceof Function&&this.onWbNotifyHangup({content:{account:this.account,channelId:null,timetag:+Date()}}))},u.disconnectSocket=function(){if(this.isConnected()||this.connecting){this.connecting=!1,this.shouldReconnect=!1;try{this.socket.disconnect()}catch(e){this.socket&&"function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),this.logger.info("link::disconnectSocket: disconnect failed, error ",e)}}},u.initOnlineListener=function(e){this.needReconnect&&this.options&&this.options.quickReconnect?"undefined"!=typeof window&&m.isFunction(window.addEventListener)?this.onlineListener||(this.onlineListener=o(v).call(v,this),this.offlineListener=o(g).call(g,this),this.logger.info("initOnlineListener success"),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)):this.logger.warn("initOnlineListener no window.addEventListener"):this.logger.warn("initOnlineListener no quickReconnect")},u.forceDisconnect=function(){var e=this.socket||{};this.socket=null;try{"function"==typeof e.removeAllListeners&&e.removeAllListeners(),"function"==typeof e.disconnect&&e.disconnect()}catch(e){this.logger.error("forceDisconnect:: oldSocket error",e||e.message)}this.hasLogin=!1}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){var n=r(9),i=r(59),o=r(19),a=r(60),s=r(3),c=r(61),u=r(62),l=r(50),d=r(63),p=r(4),f=r(23),h=r(24);function m(e,t){var r=n(e);if(i){var s=i(e);t&&(s=o(s).call(s,(function(t){return a(e,t).enumerable}))),r.push.apply(r,s)}return r}var g,v=r(64).fn,y=r(33),b=r(53),S=r(143),_=r(40),M=r(17),T=r(54),w=r(0),x=w.notundef;v.login=function(){this.doLogin()},v.doLogin=function(){var e=this,t=this;p.resolve().then((function(){return t.assembleLogin()})).then((function(r){var n,i=e.socket&&e.socket.socket&&e.socket.socket.sessionid;if(i){if(e.socketIds||(e.socketIds={}),e.socketIds[i])return void e.logger.warn("onConnect::repeat login",i);e.socketIds[i]=!0}else e.logger.warn("onConnect:: no socketId ",e.socket&&e.socket.socket);e.logger.warn("link::doLogin: "+i+" appLogin is "+r.login.appLogin),t.sendCmd("login",function(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)s(r=m(Object(n),!0)).call(r,(function(t){d(e,t,n[t])}));else if(c)u(e,c(n));else{var i;s(i=m(Object(n))).call(i,(function(t){l(e,t,a(n,t))}))}}return e}({},r),f(n=t.onLogin).call(n,t))}))},v.genSessionKey=(g={},function(){var e=this.name;return g[e]=g[e]||w.guid()}),v.assembleIMLogin=function(){var e=this.options,t=e.account;this.sdkSession=this.genSessionKey();var r={appLogin:this.autoconnect?0:1,appKey:e.appKey,account:t,token:e.token,sdkVersion:M.info.sdkVersion,sdkHumanVersion:M.info.sdkHumanVersion,protocolVersion:M.info.protocolVersion,os:"[object Object]"===b.os.toString()?b.os.family:b.os.toString(),browser:b.name+" "+b.version,clientType:M.CLIENTTYPE||16,session:this.sdkSession,deviceId:_.deviceId,isReactNative:M.isRN?1:0,customTag:e.customTag||"",sdkType:0};return r.userAgent="Native/".concat(M.info.sdkHumanVersion),M.isBrowser?r.sdkType=0:M.isRN?r.sdkType=2:M.isWeixinApp&&(r.sdkType=6),e.customClientType&&(r.customClientType=+e.customClientType),e.authType&&(r.authType=+e.authType),e.loginExt&&(r.loginExt=e.loginExt),r},v.onLogin=function(e,t){var r=this,n=0;r.loginResult=t,e?t.chatroom||(T.updateUniErrCache("login",{operation_type:"protocol",error:e}),T.concludeUniErrCache("login",1),r.onAuthError(e,"link::onLogin")):(this.heartbeatFail=0,this.hasLogin=!0,this.autoconnect=!0,r.startHeartbeat(),r.afterLogin(t),r.initOnlineListener(),n=5e3,t.chatroom||(T.updateUniSuccCache("login",{operation_type:"protocol",target:"2-2"}),T.concludeUniErrCache("login",0))),!0===r.options.logReport&&h((function(){var e={appKey:r.options.appKey,sdk_ver:M.info.version,deviceId:_.deviceId};t.chatroom||T.reportErrEvent(e)}),n)},v.afterLogin=w.emptyFunc,v.notifyLogin=function(){var e=this.loginResult;this.logger.info("link::notifyLogin: on connect",e),this.options.onconnect(e)},v.logout=function(){T.pause();var e="done disconnect";if(this.doLogout)return this.doLogout=!1,e="done logout",void this.onAuthError(new y(e,"logout"),"link::logout");if(this.isConnected()){var t=new y(e,"logout");this.onAuthError(t,"link::logout")}},v.onKicked=function(e){var t=e.content,r=t.from,n=t.reason,i=t.custom,o=t.customClientType,a={reason:this.kickedReasons[n]||"unknown",message:this.kickedMessages[n]||"未知原因"};if(x(r)&&(a.from=S.reverseType(r)),x(i)&&(a.custom=i),+o>0&&(a.customClientType=o),this.logger.warn("link::onKicked:",a),"silentlyKick"!==a.reason){var s=new y("被踢了","kicked");w.merge(s,a),this.onAuthError(s,"link::onKicked")}else this.logger.warn("link::onKicked: silentlyKick"),this.forceDisconnect(),this.onDisconnect("link::onKicked")},v.onAuthError=function(e,t){var r=e&&e.code;if(this.logger.error("onAuthError ",t,r),/^(Error_Internet_Disconnected|Error_Timeout|Error_Connection_Socket_State_not_Match)$/.test(r))return this.forceDisconnect(),void this.onDisconnect("link::onAuthError::"+r);(e=e||y.newConnectionError({callFunc:t})).callFunc=e.callFunc||t||null,this.shouldReconnect=!1,this.markAllCallbackInvalid(e),this.notifyDisconnect(e)}},function(e,t,r){var n=r(24),i=r(23),o=r(64).fn,a=r(17);o.processLink=function(e){"heartbeat"===e.cmd&&this.startHeartbeat()},o.startHeartbeat=function(){var e=this;e.stopHeartbeat(),e.heartbeatTimer=n((function(){var t;e.sendCmd("heartbeat",null,i(t=e.onHeartbeat).call(t,e))}),a.heartbeatInterval)},o.stopHeartbeat=function(){this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},o.onHeartbeat=function(e,t){if(e){if(this.syncing)return this.logger.warn("onHeartbeat::ignore error in connecting"),void this.startHeartbeat();var r;e.callFunc="link::onHeartbeat",this.onCustomError("heartbeat error",e),this.heartbeatFail++,this.logger.warn("onHeartbeat::error ",e.code,e),"Error_Timeout"===e.code&&(this.getOnlineStatus()?this.heartbeatFail>1?(this.forceDisconnect(),this.onDisconnect("link::onHeartbeat")):this.sendCmd("heartbeat",null,i(r=this.onHeartbeat).call(r,this)):this.startHeartbeat())}else this.heartbeatFail=0},o.getOnlineStatus="undefined"!=typeof navigator&&"boolean"==typeof navigator.onLine?function(){return navigator.onLine}:function(){return!0},o.heartbeat=function(){}},function(e,t,r){var n=r(4),i=r(6),o=r(24),a=r(51),s=r(64).fn,c=r(200),u=r(17),l=(r(0),r(40));s.processMisc=function(e){switch(e.cmd){case"getSimpleNosToken":e.error||(e.obj=e.content.nosTokens[0]);break;case"getNosToken":e.error||(e.obj=e.content.nosToken);break;case"getGrayscaleConfig":e.error||(e.obj=e.content.appGrayConfigTag);break;case"getMixStorePolicy":e.error||(e.obj=e.content.mixStorePolicyTag);break;case"getMixStoreToken":e.error||(e.obj=e.content.mixStoreTokenTag);break;case"getBackSourceToken":e.error||(e.obj=e.content.backSourceTokenTag);break;case"uploadSdkLogUrl":e.error?this.logger.error("uploadSdkLogUrl::error",e.error):this.logger.info("uploadSdkLogUrl::success",e.obj&&e.obj.url);break;case"notifyUploadLog":e.error||(u.isRN?this.uploadLocalLogRN():u.isBrowser&&this.uploadLocalLogWeb(),this.emitAPI({type:"notifyUploadLog"}));break;case"audioToText":e.error||(e.obj.text=e.content.text);break;case"processImage":e.obj.imageOps=c.reverseImageOps(e.obj.imageOps),e.error||(e.obj={url:e.content.url});break;case"getNosTokenTrans":e.error||(e.obj={nosToken:e.content.nosToken,docId:e.content.docId});break;case"getNosOriginUrl":e.error||(e.obj=e.content.nosFileUrlTag.originUrl);break;case"notifyTransLog":e.error||this.emitAPI({type:"notifyTransLog",obj:e.content.transInfo});break;case"fetchFile":case"fetchFileList":case"removeFile":e.error||(e.obj=e.content);break;case"getServerTime":e.obj=e.content&&e.content.time;break;case"getNosCdnHost":this.getNosCdnHost(e)}},s.uploadLocalLogRN=function(e){if(u.isRN&&l.rnfs){var t=l.rnfs,r=this,o=t.nimIndex,a=(t.nimIndex+1)%2;t.nimPromise=t.nimPromise.then((function(){return n.all([t.exists(s(o)),t.exists(s(a))])})).then((function(e){return e&&(e[0]||e[1])?e[0]&&e[1]?t.copyFile(s(a),s(2)).then((function(){return t.readFile(s(o))})).then((function(e){return t.appendFile(s(2),e)})):e[0]?t.copyFile(s(o),s(2)):void(e[1]&&t.copyFile(s(a),s(2))):n.reject()})).then((function(e){return new n((function(e,o){r.api.previewFile({filePath:s(2),done:function(o,a){if(n.all([t.unlink(s(2)),t.unlink(s(1)),t.unlink(s(0))]).finally((function(){e()})),o)r.logger.error("nim::uploadLocalLogRN:previewFile:error",o);else{var c=a.url;i(c).call(c,"?")>0?c+="&":c+="?",c+="download="+(new Date).getTime()+"_rn.log",r.api.uploadSdkLogUrl({url:c})}}})}))})).catch((function(e){t.unlink(s(2)).catch((function(e){})),r.logger.error("nim::protocol::uploadLocalLogRN",e)}))}function s(e){return t.DocumentDirectoryPath+"/nimlog_"+e+".log"}},s.uploadLocalLogWeb=function(){var e=this;!1!==this.options.dbLog&&this.logger._local?this.logger._local.fetchLog().then((function(t){e.api.previewFile({blob:new Blob([t.logs],{type:"text/plain"}),done:function(r,n){if(r)e.logger.error("uploadLocalLogWeb::previewFile:error",r);else{e.logger.log("uploadLocalLogWeb::previewFile:success",n);var o=n.url;o+=(i(o).call(o,"?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log",e.api.uploadSdkLogUrl({url:o}),e.logger._local.deleteLogs(t.time).then((function(){e.logger.log("uploadLocalLogWeb::deleteLogs success")})).catch((function(t){return e.logger.error("uploadLocalLogWeb::deleteLogs:error ,",t)}))}}})})).catch((function(t){e.logger.error("uploadLocalLogWeb::fetchLog:error",t)})):this.logger.warn("uploadLocalLogWeb::no dbLog")},s.getNosCdnHost=function(e){var t=this,r=e.error;if(r&&(r.callFunc="events::getNosCdnHost",t.onCustomError("getNosCdnHost","EVENT_GET_NOS_CDN_HOST_ERROR",r)),e.content&&e.content.nosConfigTag){var n=e.content.nosConfigTag,i="",s="";0!==n.expire&&n.cdnDomain?-1===n.expire?(i=n.cdnDomain,s=n.objectNamePrefix):(i=n.cdnDomain,s=n.objectNamePrefix,t.nosCdnHostTimer&&clearTimeout(t.nosCdnHostTimer),t.nosCdnHostTimer=o((function(){t.sendCmd("getNosCdnHost",{})}),800*a(n.expire))):(i="",s=""),u.serverNosConfig.cdnDomain=i,u.serverNosConfig.objectPrefix=s,u.hasLocalStorage&&(localStorage.setItem("nim_cdn_domain",i),localStorage.setItem("nim_object_prefix",s))}}},function(e,t,r){var n=r(8),i=r(29),o=r(64).fn,a=r(0),s=r(201);o.processAvSignal=function(e){switch(e.cmd){case"signalingCreate":case"signalingDelay":case"signalingClose":case"signalingJoin":case"signalingLeave":case"signalingInvite":case"signalingCancel":case"signalingReject":case"signalingAccept":case"signalingControl":case"signalingSyncMsgRead":case"signalingGetChannelInfo":break;case"signalingNotify":this.onSignalingNotify(e);break;case"signalingMutilClientSyncNotify":this.onSignalingMutilClientSyncNotify(e);break;case"signalingUnreadMessageSyncNotify":this.onSignalingUnreadMessageSyncNotify(e);break;case"signalingChannelsSyncNotify":this.onSignalingMembersSyncNotify(e);break;default:this.logger.warn("avSignal::unhandled cmd:",e.cmd)}};var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.needPush&&(e.needPush="1"===e.needPush),e.needBadge&&(e.needBadge="1"===e.needBadge),e.channelInValid&&(e.channelInValid="1"===e.channelInValid),e.attach){var t=JSON.parse(e.attach);e.eventType=s.parseAvSignalType(t.type)}if(e.members){var r=JSON.parse(e.members);e.members=n(r).call(r,(function(e){return s.parseAvSignalMember(e)}))}return e};o.onSignalingNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{e.raw&&e.raw.r&&e.raw.r.length&&e.content&&e.content.avSignalTag&&(e.content.avSignalTag.msgid=e.raw.r[0]);var r=e.content.avSignalTag;r=i(r)?n(r).call(r,(function(e){return c(e)})):c(r),this.emitAPI({type:"signalingNotify",obj:r}),a.isFunction(this.options.onSignalingNotify)&&this.options.onSignalingNotify(r)}},o.onSignalingMutilClientSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingMutilClientSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;r=i(r)?n(r).call(r,(function(e){return c(e)})):c(r),this.emitAPI({type:"signalingMutilClientSyncNotify",obj:r}),a.isFunction(this.options.onSignalingMutilClientSyncNotify)&&this.options.onSignalingMutilClientSyncNotify(r)}},o.onSignalingUnreadMessageSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingUnreadMessageSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;i(r)&&(r=n(r).call(r,(function(e){return c(e)}))),this.emitAPI({type:"signalingUnreadMessageSyncNotify",obj:r}),a.isFunction(this.options.onSignalingUnreadMessageSyncNotify)&&this.options.onSignalingUnreadMessageSyncNotify(r)}},o.onSignalingMembersSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingMembersSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;i(r)||(r=[r]),r=n(r).call(r,(function(e){return c(e)})),this.emitAPI({type:"signalingChannelsSyncNotify",obj:r}),a.isFunction(this.options.onSignalingMembersSyncNotify)&&this.options.onSignalingMembersSyncNotify(r)}}},function(e,t){e.exports={negotiateTransportTag:{version:-1,serializeList:1,serialize:101},initTransportTag:{},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24},login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,sdkType:41,userAgent:42,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,connectionId:102,ip:103,time:109,customTag:38,customClientType:39},aosPushInfo:{pushType:110,hasTokenPreviously:111},sync:{myInfo:1,offlineMsgs:2,teams:3,netcallMsgs:6,roamingMsgs:7,relations:9,friends:11,sessions:12,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,deleteMsg:17,sessionAck:18,robots:19,broadcastMsgs:20,avSignal:21,superTeams:22,myInfoInSuperTeams:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteMsgSelf:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,filterMsgs:100},donnop:{open:1},sessionReqTag:{minTimestamp:1,maxTimestamp:2,needLastMsg:3,limit:4,hasMore:5},session:{id:1,updateTime:2,ext:3,lastMsg:4},superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,createTime:10,updateTime:11,custom:12,mute:13,invitoraccid:14,joinTime:15},team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,custom:12,mute:13,invitorAccid:14},msg:{scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resend:13,userUpdateTime:14,custom:15,pushPayload:16,pushContent:17,apnsAccounts:18,apnsContent:19,apnsForcePush:20,yidunEnable:21,antiSpamContent:22,antiSpamBusinessId:23,clientAntiSpam:24,antiSpamUsingYidun:25,needMsgReceipt:26,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,delete:39,callbackExt:40,subType:41,yidunAntiCheating:42,env:43,yidunAntiSpamExt:44,yidunAntiSpamRes:45,isHistoryable:100,isRoamingable:101,isSyncable:102,isMuted:104,cc:105,isInBlackList:106,isPushable:107,isOfflinable:108,isUnreadable:109,needPushNick:110,isReplyMsg:111,tempTeamMemberCount:112},threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2},comment:{from:1,body:2,time:3,custom:4,needPush:5,needBadge:6,pushTitle:7,apnsText:8,pushPayload:9},commentReq:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,timestamp:100},commentRes:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,detail:7,modify:8,timestamp:100},collect:{id:1,type:2,data:3,custom:4,uniqueId:5,createTime:6,updateTime:7},collectQuery:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5,type:6},stickTopSession:{id:1,topCustom:2,createTime:3,updateTime:4},pinTag:{pinFrom:1,pinCustom:2,createTime:3,updateTime:4},msgPinReq:{sessionId:1,timetag:2},msgPinRes:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,pinFrom:7,pinCustom:8},msgReceipt:{to:1,from:2,time:7,idClient:11},teamMsgReceipt:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},deleteMsgSelfTag:{scene:1,from:2,to:3,idServer:4,idClient:5,time:6,deletedTime:7,custom:8},sysMsg:{time:0,type:1,to:2,from:3,ps:4,attach:5,idServer:6,sendToOnlineUsersOnly:7,apnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,yidunEnable:12,antiSpamContent:13,deletedMsgTime:14,deletedMsgFromNick:15,opeAccount:16,env:21,callbackExt:22,cc:105,isPushable:107,isUnreadable:109,needPushNick:110},broadcastMsg:{broadcastId:1,fromAccid:2,fromUid:3,timestamp:4,body:5},friend:{account:4,flag:5,beflag:6,source:7,alias:8,bits:9,custom:10,createTime:11,updateTime:12,serverex:13},user:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,custom:10,createTime:12,updateTime:13},antispamTag:{antiSpamBusinessId:1},specialRelation:{account:0,isMuted:1,isBlacked:2,createTime:3,updateTime:4},msgType:{text:0,picture:1,audio:2,video:3,location:4,notification:5,file:6,netcall_audio:7,netcall_vedio:8,datatunnel_new:9,tips:10,robot:11,custom:100},msgEvent:{type:1,value:2,idClient:3,custom:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverCustom:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105},clearMsgsParams:{account:1,delRoam:2},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},msgFullSearchRequestTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msgLimit:5,order:6,p2pList:7,teamList:8,senderList:9,msgTypeList:10,msgSubTypeList:11},msgTimingFullSearchRequestTag:{keyword:1,fromTime:2,toTime:3,msgLimit:5,order:6,p2pList:7,teamList:8,senderList:9,msgTypeList:10,msgSubTypeList:11},delFriendParams:{delAlias:1},proxyTag:{zone:1,path:2,method:3,header:4,body:5},proxyMsgTag:{from:1,body:2,time:3},sessionAckTag:{scene:1,to:2,timetag:3},mixTokenReq:{provider:0,tokenCount:1,fileExpireSec:2,tag:3,returnBody:4},mixAuthTokenReq:{type:1,urls:2}}},function(e,t){e.exports={negotiateTransportTag:{"-1":"version",1:"serializeList",101:"serialize"},initTransportTag:{},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},nosAccessTokenTag:{0:"token",1:"url",2:"userAgent",3:"ext"},nosConfigTag:{1:"bucket",2:"cdnDomain",3:"expire",4:"objectNamePrefix"},appGrayConfigTag:{0:"grayConfig",1:"ttl"},mixStorePolicyTag:{0:"providers",1:"ttl",2:"mixEnable",3:"nosPolicy",4:"s3Policy"},mixStoreTokenTag:{0:"provider",1:"accessKeyId",2:"secretAccessKey",3:"sessionToken",4:"token",5:"expireAt",6:"bucket",7:"objectName",8:"fileExpireSec",9:"tag",10:"shortUrl",11:"region"},backSourceTokenTag:{1:"type",2:"tokens",3:"token",4:"ttl"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time"},login:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",39:"customClientType",40:"sdkHumanVersion",112:"isReactNative",115:"authType",116:"loginExt",1e3:"token"},loginRes:{17:"lastLoginDeviceId",38:"customTag",102:"connectionId",103:"ip",104:"port",106:"country",111:"hasXMPush"},loginPort:{3:"type",4:"os",5:"mac",13:"deviceId",19:"account",32:"deviceInfo",38:"customTag",39:"customClientType",102:"connectionId",103:"ip",109:"time"},aosPushInfo:{110:"pushType",111:"hasTokenPreviously"},sync:{1:"myInfo",2:"offlineMsgs",3:"teams",6:"netcallMsgs",7:"roamingMsgs",9:"relations",11:"friends",12:"sessions",13:"friendUsers",14:"msgReceipts",15:"myTeamMembers",16:"donnop",17:"deleteMsg",18:"sessionAck",19:"robots",20:"broadcastMsgs",21:"avSignal",22:"superTeams",23:"myInfoInSuperTeams",24:"superTeamRoamingMsgs",25:"deleteSuperTeamMsg",26:"superTeamSessionAck",27:"deleteMsgSelf",28:"stickTopSessions",29:"sessionHistoryMsgsDelete",100:"filterMsgs"},donnop:{1:"open"},sessionReqTag:{1:"minTimestamp",2:"maxTimestamp",3:"needLastMsg",4:"limit",5:"hasMore"},session:{1:"id",2:"updateTime",3:"ext",4:"lastMsg",5:"lastMsgType"},superTeam:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},superTeamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"createTime",11:"updateTime",12:"custom",13:"mute",14:"invitoraccid",15:"joinTime"},team:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},teamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"joinTime",11:"updateTime",12:"custom",13:"mute",14:"invitorAccid"},msg:{0:"scene",1:"to",2:"from",4:"fromClientType",5:"fromDeviceId",6:"fromNick",7:"time",8:"type",9:"body",10:"attach",11:"idClient",12:"idServer",13:"resend",14:"userUpdateTime",15:"custom",16:"pushPayload",17:"pushContent",18:"apnsAccounts",19:"apnsContent",20:"apnsForcePush",21:"yidunEnable",22:"antiSpamContent",23:"antiSpamBusinessId",24:"clientAntiSpam",25:"antiSpamUsingYidun",26:"needMsgReceipt",28:"needUpdateSession",29:"replyMsgFromAccount",30:"replyMsgToAccount",31:"replyMsgTime",32:"replyMsgIdServer",33:"replyMsgIdClient",34:"threadMsgFromAccount",35:"threadMsgToAccount",36:"threadMsgTime",37:"threadMsgIdServer",38:"threadMsgIdClient",39:"delete",40:"callbackExt",41:"subType",42:"yidunAntiCheating",43:"env",44:"yidunAntiSpamExt",45:"yidunAntiSpamRes",100:"isHistoryable",101:"isRoamingable",102:"isSyncable",104:"isMuted",105:"cc",106:"isInBlackList",107:"isPushable",108:"isOfflinable",109:"isUnreadable",110:"needPushNick",111:"isReplyMsg",112:"tempTeamMemberCount"},threadMsgReq:{1:"beginTime",2:"endTime",3:"lastMsgId",4:"limit",5:"reverse"},threadMsgsMeta:{1:"total",2:"lastMsgTime"},comment:{1:"from",2:"body",3:"time",4:"custom",5:"needPush",6:"needBadge",7:"pushTitle",8:"apnsText",9:"pushPayload"},commentReq:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",100:"timestamp"},commentRes:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",7:"detail",8:"modify",100:"timestamp"},collect:{1:"id",2:"type",3:"data",4:"custom",5:"uniqueId",6:"createTime",7:"updateTime"},collectQuery:{1:"beginTime",2:"endTime",3:"lastMsgId",4:"limit",5:"reverse",6:"type"},stickTopSession:{1:"id",2:"topCustom",3:"createTime",4:"updateTime"},pinTag:{1:"pinFrom",2:"pinCustom",3:"createTime",4:"updateTime"},msgPinReq:{1:"sessionId",2:"timetag"},msgPinRes:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",7:"pinFrom",8:"pinCustom"},msgReceipt:{1:"to",2:"from",7:"time",11:"idClient"},teamMsgReceipt:{0:"teamId",1:"idServer",100:"read",101:"unread",102:"idClient",103:"account"},deleteMsgSelfTag:{1:"scene",2:"from",3:"to",4:"idServer",5:"idClient",6:"time",7:"deletedTime",8:"custom"},sysMsg:{0:"time",1:"type",2:"to",3:"from",4:"ps",5:"attach",6:"idServer",7:"sendToOnlineUsersOnly",8:"apnsText",9:"pushPayload",10:"deletedIdClient",11:"deletedIdServer",12:"yidunEnable",13:"antiSpamContent",14:"deletedMsgTime",15:"deletedMsgFromNick",16:"opeAccount",21:"env",22:"callbackExt",105:"cc",107:"isPushable",109:"isUnreadable",110:"needPushNick"},broadcastMsg:{1:"broadcastId",2:"fromAccid",3:"fromUid",4:"timestamp",5:"body"},friend:{4:"account",5:"flag",6:"beflag",7:"source",8:"alias",9:"bits",10:"custom",11:"createTime",12:"updateTime",13:"serverex"},user:{1:"account",3:"nick",4:"avatar",5:"sign",6:"gender",7:"email",8:"birth",9:"tel",10:"custom",12:"createTime",13:"updateTime",_4_safe:"_avatar_safe"},antispamTag:{antiSpamBusinessId:1},specialRelation:{0:"account",1:"isMuted",2:"isBlacked",3:"createTime",4:"updateTime"},msgType:{0:"text",1:"picture",2:"audio",3:"video",4:"location",5:"notification",6:"file",7:"netcall_audio",8:"netcall_vedio",9:"datatunnel_new",10:"tips",11:"robot",100:"custom"},msgEvent:{1:"type",2:"value",3:"idClient",4:"custom",5:"validTime",6:"broadcastType",7:"sync",8:"validTimeType",9:"durable",10:"time",11:"idServer",12:"clientType",13:"serverConfig",14:"serverCustom",101:"appid",103:"account",104:"enableMultiClient",106:"consid"},msgEventSubscribe:{1:"type",2:"subscribeTime",3:"sync",102:"to",104:"from",105:"time"},clearMsgsParams:{1:"account",2:"delRoam"},clearMsgsParamsWithSync:{0:"type",1:"otherAccid",2:"delRoam",3:"toTid",4:"isSyncSelf",5:"fromAccid",6:"time",7:"ext"},msgFullSearchRequestTag:{1:"keyword",2:"fromTime",3:"toTime",4:"sessionLimit",5:"msgLimit",6:"order",7:"p2pList",8:"teamList",9:"senderList",10:"msgTypeList",11:"msgSubTypeList"},delFriendParams:{1:"delAlias"},proxyTag:{1:"zone",2:"path",3:"method",4:"header",5:"body"},proxyMsgTag:{1:"from",2:"body",3:"time"}}},function(e,t,r){var n=r(0),i=r(141),o=n.merge({},i.idMap,{chatroom:{id:13,login:2,kicked:3,logout:4,sendMsg:6,msg:7,getChatroomMembers:8,getHistoryMsgs:9,markChatroomMember:11,closeChatroom:12,getChatroom:13,updateChatroom:14,updateMyChatroomMemberInfo:15,getChatroomMembersInfo:16,kickChatroomMember:17,updateChatroomMemberTempMute:19,queueOffer:20,queuePoll:21,queueList:22,peak:23,queueDrop:24,queueInit:25,queueChange:26,updateTagMembersTempMute:30,getChatroomMembersByTag:31,getChatroomMemberCountByTag:32,updateCoordinate:33,updateChatroomTags:34,notifyCdnInfo:99},user:{id:3,syncRobot:16}}),a=n.merge({},i.cmdConfig,{login:{sid:o.chatroom.id,cid:o.chatroom.login,params:[{type:"byte",name:"type"},{type:"Property",name:"login"},{type:"Property",name:"imLogin"}]},logout:{sid:o.chatroom.id,cid:o.chatroom.logout},sendMsg:{sid:o.chatroom.id,cid:o.chatroom.sendMsg,params:[{type:"Property",name:"msg"}]},getChatroomMembers:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembers,params:[{type:"byte",name:"type"},{type:"long",name:"time"},{type:"int",name:"limit"}]},getHistoryMsgs:{sid:o.chatroom.id,cid:o.chatroom.getHistoryMsgs,params:[{type:"long",name:"timetag"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},markChatroomMember:{sid:o.chatroom.id,cid:o.chatroom.markChatroomMember,params:[{type:"string",name:"account"},{type:"int",name:"type"},{type:"bool",name:"isAdd"},{type:"int",name:"level"},{type:"string",name:"custom"}]},closeChatroom:{sid:o.chatroom.id,cid:o.chatroom.closeChatroom,params:[{type:"string",name:"custom"}]},getChatroom:{sid:o.chatroom.id,cid:o.chatroom.getChatroom},updateChatroom:{sid:o.chatroom.id,cid:o.chatroom.updateChatroom,params:[{type:"Property",name:"chatroom"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"Property",name:"antispamTag"}]},updateMyChatroomMemberInfo:{sid:o.chatroom.id,cid:o.chatroom.updateMyChatroomMemberInfo,params:[{type:"Property",name:"chatroomMember"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"bool",name:"needSave"},{type:"Property",name:"antispamTag"}]},getChatroomMembersInfo:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembersInfo,params:[{type:"StrArray",name:"accounts"}]},kickChatroomMember:{sid:o.chatroom.id,cid:o.chatroom.kickChatroomMember,params:[{type:"string",name:"account"},{type:"string",name:"custom"}]},updateChatroomMemberTempMute:{sid:o.chatroom.id,cid:o.chatroom.updateChatroomMemberTempMute,params:[{type:"String",name:"account"},{type:"long",name:"duration"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"}]},queueOffer:{sid:o.chatroom.id,cid:o.chatroom.queueOffer,params:[{type:"string",name:"elementKey"},{type:"string",name:"elementValue"},{type:"bool",name:"transient"},{type:"string",name:"elementAccount"}]},queuePoll:{sid:o.chatroom.id,cid:o.chatroom.queuePoll,params:[{type:"string",name:"elementKey"}]},queueList:{sid:o.chatroom.id,cid:o.chatroom.queueList},peak:{sid:o.chatroom.id,cid:o.chatroom.peak},queueDrop:{sid:o.chatroom.id,cid:o.chatroom.queueDrop},queueInit:{sid:o.chatroom.id,cid:o.chatroom.queueInit,params:[{type:"int",name:"limit"}]},queueChange:{sid:o.chatroom.id,cid:o.chatroom.queueChange,params:[{type:"StrStrMap",name:"elementMap"},{type:"bool",name:"needNotify"},{type:"string",name:"notifyExt"}]},updateTagMembersTempMute:{sid:o.chatroom.id,cid:o.chatroom.updateTagMembersTempMute,params:[{type:"Property",name:"tagMuteReq"}]},updateCoordinate:{sid:o.chatroom.id,cid:o.chatroom.updateCoordinate,params:[{type:"Property",name:"coordinateReq"}]},getChatroomMemberCountByTag:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMemberCountByTag,params:[{type:"String",name:"tag"}]},getChatroomMembersByTag:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembersByTag,params:[{type:"Property",name:"tagMemberReq"}]},updateChatroomTags:{sid:o.chatroom.id,cid:o.chatroom.updateChatroomTags,params:[{type:"Property",name:"chatRoomTagsUpdateTag"}]},notifyCdnInfo:{sid:o.chatroom.id,cid:o.chatroom.notifyCdnInfo},syncRobot:{sid:o.user.id,cid:o.user.syncRobot,params:[{type:"long",name:"timetag"}]}}),s=n.merge({},i.packetConfig,{"4_10":{service:"notify"},"4_11":{service:"notify"},"3_16":{service:"chatroom",cmd:"syncRobot",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"13_2":{service:"chatroom",cmd:"login",response:[{type:"Property",name:"chatroom"},{type:"Property",name:"chatroomMember"},{type:"Property",name:"chatroomCdnInfo"}]},"13_3":{service:"chatroom",cmd:"kicked",response:[{type:"Number",name:"reason"},{type:"String",name:"custom"}]},"13_4":{service:"chatroom",cmd:"logout"},"13_6":{service:"chatroom",cmd:"sendMsg",response:[{type:"Property",name:"msg"}]},"13_7":{service:"chatroom",cmd:"msg",response:[{type:"Property",name:"msg"}]},"13_8":{service:"chatroom",cmd:"getChatroomMembers",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_9":{service:"chatroom",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_11":{service:"chatroom",cmd:"markChatroomMember",response:[{type:"Property",name:"chatroomMember"}]},"13_12":{service:"chatroom",cmd:"closeChatroom"},"13_13":{service:"chatroom",cmd:"getChatroom",response:[{type:"Property",name:"chatroom"}]},"13_14":{service:"chatroom",cmd:"updateChatroom"},"13_15":{service:"chatroom",cmd:"updateMyChatroomMemberInfo"},"13_16":{service:"chatroom",cmd:"getChatroomMembersInfo",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_17":{service:"chatroom",cmd:"kickChatroomMember"},"13_19":{service:"chatroom",cmd:"updateChatroomMemberTempMute"},"13_20":{service:"chatroom",cmd:"queueOffer"},"13_21":{service:"chatroom",cmd:"queuePoll",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_22":{service:"chatroom",cmd:"queueList",response:[{type:"KVArray",name:"queueList"}]},"13_23":{service:"chatroom",cmd:"peak",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_24":{service:"chatroom",cmd:"queueDrop"},"13_25":{service:"chatroom",cmd:"queueInit"},"13_26":{service:"chatroom",cmd:"queueChange",response:[{type:"StrArray",name:"elementKeyArray"}]},"13_30":{service:"chatroom",cmd:"updateTagMembersTempMute"},"13_33":{service:"chatroom",cmd:"updateCoordinate"},"13_31":{service:"chatroom",cmd:"getChatroomMembersByTag",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_32":{service:"chatroom",cmd:"getChatroomMemberCountByTag",response:[{type:"long",name:"count"}]},"13_34":{service:"chatroom",cmd:"updateChatroomTags"},"13_99":{service:"chatroom",cmd:"notifyCdnInfo",response:[{type:"Property",name:"chatroomCdnInfo"}]}});e.exports={idMap:o,cmdConfig:a,packetConfig:s}},function(e,t){e.exports={imLogin:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,sdkType:41,userAgent:42,isReactNative:112,authType:115,loginExt:116,token:1e3,customTag:38},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24},login:{appKey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,chatroomCustom:22,chatroomEnterCustom:23,session:26,isAnonymous:38,tags:39,notifyTargetTags:40,loginAuthType:41,loginExt:42,loc_x:43,loc_y:44,loc_z:45,distance:46,antiSpamBusinessId:47},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,custom:12,createTime:14,updateTime:15,queuelevel:16,creator:100,onlineMemberNum:101,mute:102},msg:{idClient:1,type:2,attach:3,custom:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromCustom:9,yidunEnable:10,antiSpamContent:11,skipHistory:12,body:13,antiSpamBusinessId:14,clientAntiSpam:15,antiSpamUsingYidun:16,time:20,from:21,chatroomId:22,fromClientType:23,highPriority:25,callbackExt:27,subType:28,yidunAntiCheating:29,env:30,notifyTargetTags:31,yidunAntiSpamExt:32,yidunAntiSpamRes:33,loc_x:34,loc_y:35,loc_z:36,toAccids:37},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,custom:7,online:8,guest:9,enterTime:10,blacked:12,gaged:13,valid:14,updateTime:15,tempMuted:16,tempMuteDuration:17},antispamTag:{antiSpamBusinessId:1},chatroomCdnInfo:{enable:1,cdnUrls:2,timestamp:3,interval:4,decryptType:5,decryptKey:6,timeout:7},tagMemberReq:{tag:1,time:2,limit:3},tagMuteReq:{tag:1,duration:2,needNotify:3,custom:4,notifyTargetTags:5},coordinateReq:{x:1,y:2,z:3,distance:4},chatRoomTagsUpdateTag:{tags:1,notifyTargetTags:2,needNotify:3,ext:4}}},function(e,t){e.exports={imLogin:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",41:"sdkType",42:"userAgent",112:"isReactNative",1e3:"token"},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},nosAccessTokenTag:{0:"token",1:"url",2:"userAgent",3:"ext"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time"},login:{1:"appKey",2:"account",3:"deviceId",5:"chatroomId",8:"appLogin",20:"chatroomNick",21:"chatroomAvatar",22:"chatroomCustom",23:"chatroomEnterCustom",26:"session",38:"isAnonymous",39:"tags",40:"notifyTargetTags",41:"loginAuthType",42:"loginExt",43:"loc_x",44:"loc_y",45:"loc_z",46:"distance",47:"antiSpamBusinessId",_21_safe:"_chatroomAvatar_safe"},chatroom:{1:"id",3:"name",4:"announcement",5:"broadcastUrl",12:"custom",14:"createTime",15:"updateTime",16:"queuelevel",100:"creator",101:"onlineMemberNum",102:"mute"},msg:{1:"idClient",2:"type",3:"attach",4:"custom",5:"resend",6:"userUpdateTime",7:"fromNick",8:"fromAvatar",9:"fromCustom",10:"yidunEnable",11:"antiSpamContent",12:"skipHistory",13:"body",14:"antiSpamBusinessId",15:"clientAntiSpam",16:"antiSpamUsingYidun",20:"time",21:"from",22:"chatroomId",23:"fromClientType",25:"highPriority",27:"callbackExt",28:"subType",29:"yidunAntiCheating",30:"env",31:"notifyTargetTags",32:"yidunAntiSpamExt",33:"yidunAntiSpamRes",34:"loc_x",35:"loc_y",36:"loc_z",37:"toAccids",_8_safe:"_fromAvatar_safe"},chatroomMember:{1:"chatroomId",2:"account",3:"type",4:"level",5:"nick",6:"avatar",7:"custom",8:"online",9:"guest",10:"enterTime",12:"blacked",13:"gaged",14:"valid",15:"updateTime",16:"tempMuted",17:"tempMuteDuration",_6_safe:"_avatar_safe"},antispamTag:{antiSpamBusinessId:1},chatroomCdnInfo:{1:"enable",2:"cdnUrls",3:"timestamp",4:"interval",5:"decryptType",6:"decryptKey",7:"timeout"},nosConfigTag:{1:"bucket",2:"cdnDomain",3:"expire",4:"objectNamePrefix"}}},function(e,t,r){var n=r(9),i=r(48),o=r(0),a=o.notundef,s={addFriend:1,applyFriend:2,passFriendApply:3,rejectFriendApply:4},c={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};function u(e){o.verifyOptions(e,"account","friend::Friend"),o.verifyParamAtLeastPresentOne(e,"alias custom","friend::Friend"),this.account=e.account,a(e.alias)&&(this.alias=e.alias),a(e.custom)&&(this.custom=e.custom)}u.reverse=function(e){var t=o.filterObj(e,"account alias custom createTime updateTime serverex");return a(e.flag)&&(t.valid="1"===e.flag),a(t.createTime)&&(t.createTime=+t.createTime),a(t.updateTime)&&(t.updateTime=+t.updateTime),t},u.validTypes=function(){return n(s)},u.getByteFromType=function(e){return s[e]},u.getTypeFromByte=function(e){return c[e]},u.assembleFriend=function(e){var t=+new Date;return i({},e,{alias:"",createTime:t,custom:"",updateTime:t,valid:!0})},e.exports=u},function(e,t,r){var n=r(468),i=r(48),o=r(0),a=o.notundef;function s(e,t){n(e.body)||o.onParamError("body只能是整数",t),this.body=e.body,this.from=e.from||"",this.custom=e.custom||"",a(e.pushTitle)&&(this.pushTitle=e.pushTitle),a(e.apnsText)&&(this.apnsText=e.apnsText),a(e.pushPayload)&&(this.pushPayload=e.pushPayload),a(e.needPush)&&(this.needPush=!0===e.needPush?1:0),a(e.needBadge)&&(this.needBadge=!0===e.needBadge?1:0)}s.reverse=function(e){var t=i({},e);return a(e.needBadge)&&(t.needBadge=1==+e.needBadge),a(e.needPush)&&(t.needPush=1==+e.needPush),t.body=+e.body,t.time=+e.time,t},e.exports=s},function(e,t,r){e.exports=r(535)},function(e,t,r){var n=r(468),i=r(48),o=r(0);function a(e,t){n(e.type)||o.onParamError("Collect.type只能是整数",t),o.notundef(e.uniqueId)&&(this.uniqueId=e.uniqueId),this.type=e.type,this.data=e.data||"",this.custom=e.custom||""}a.reverse=function(e){var t=i({},e);return t.type=+t.type,t.createTime=+t.createTime,t.updateTime=+t.updateTime,t},e.exports=a},function(e,t,r){e.exports=r(541)},function(e,t,r){var n=r(542);function i(e,t,r,i,o,a,s){try{var c=e[a](s),u=c.value}catch(e){return void r(e)}c.done?t(u):n.resolve(u).then(i,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new n((function(n,o){var a=e.apply(t,r);function s(e){i(a,n,o,s,c,"next",e)}function c(e){i(a,n,o,s,c,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(473),i=r(474),o=r(475),a=r(490);function s(e,t,r){var n=e;return i(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=a(t,{uri:e}),n.callback=r,n}function c(e,t,r){return u(t=s(e,t,r))}function u(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,r=function(r,n,i){t||(t=!0,e.callback(r,n,i))};function n(){var e=void 0;if(e=l.response?l.response:l.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(l),v)try{e=JSON.parse(e)}catch(e){}return e}function i(e){return clearTimeout(d),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,r(e,y)}function a(){if(!u){var t;clearTimeout(d),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var i=y,a=null;return 0!==t?(i={body:n(),statusCode:t,method:f,headers:{},url:p,rawRequest:l},l.getAllResponseHeaders&&(i.headers=o(l.getAllResponseHeaders()))):a=new Error("Internal XMLHttpRequest Error"),r(a,i,i.body)}}var s,u,l=e.xhr||null;l||(l=e.cors||e.useXDR?new c.XDomainRequest:new c.XMLHttpRequest);var d,p=l.url=e.uri||e.url,f=l.method=e.method||"GET",h=e.body||e.data,m=l.headers=e.headers||{},g=!!e.sync,v=!1,y={body:void 0,headers:{},statusCode:0,method:f,url:p,rawRequest:l};if("json"in e&&!1!==e.json&&(v=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==f&&"HEAD"!==f&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),h=JSON.stringify(!0===e.json?h:e.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(a,0)},l.onload=a,l.onerror=i,l.onprogress=function(){},l.onabort=function(){u=!0},l.ontimeout=i,l.open(f,p,!g,e.username,e.password),g||(l.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(d=setTimeout((function(){if(!u){u=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",i(e)}}),e.timeout)),l.setRequestHeader)for(s in m)m.hasOwnProperty(s)&&l.setRequestHeader(s,m[s]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(h||null),l}e.exports=c,e.exports.default=c,c.XMLHttpRequest=n.XMLHttpRequest||function(){},c.XDomainRequest="withCredentials"in new c.XMLHttpRequest?c.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var r=0;r<e.length;r++)t(e[r])}(["get","put","post","patch","head","delete"],(function(e){c["delete"===e?"del":e]=function(t,r,n){return(r=s(t,r,n)).method=e.toUpperCase(),u(r)}}))},function(e,t,r){(function(t){var r;r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=r}).call(this,r(49))},function(e,t){e.exports=function(e){var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var r=Object.prototype.toString},function(e,t,r){var n=r(476),i=r(489);e.exports=function(e){if(!e)return{};var t={};return i(n(e).split("\n"),(function(e){var r,i=e.indexOf(":"),o=n(e.slice(0,i)).toLowerCase(),a=n(e.slice(i+1));void 0===t[o]?t[o]=a:(r=t[o],"[object Array]"===Object.prototype.toString.call(r)?t[o].push(a):t[o]=[t[o],a])})),t}},function(e,t,r){var n=r(145),i=r(204),o=r(206),a=r(209),s=r(488),c=n.call(Function.call,a());i(c,{getPolyfill:a,implementation:o,shim:s}),e.exports=c},function(e,t,r){var n=Array.prototype.slice,i=Object.prototype.toString;e.exports=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==i.call(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var r,o=n.call(arguments,1),a=Math.max(0,t.length-o.length),s=[],c=0;c<a;c++)s.push("$"+c);if(r=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof r){var i=t.apply(this,o.concat(n.call(arguments)));return Object(i)===i?i:this}return t.apply(e,o.concat(n.call(arguments)))})),t.prototype){var u=function(){};u.prototype=t.prototype,r.prototype=new u,u.prototype=null}return r}},function(e,t,r){var n=Array.prototype.slice,i=r(205),o=Object.keys,a=o?function(e){return o(e)}:r(479),s=Object.keys;a.shim=function(){return Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return i(e)?s(n.call(e)):s(e)}):Object.keys=a,Object.keys||a},e.exports=a},function(e,t,r){var n;if(!Object.keys){var i=Object.prototype.hasOwnProperty,o=Object.prototype.toString,a=r(205),s=Object.prototype.propertyIsEnumerable,c=!s.call({toString:null},"toString"),u=s.call((function(){}),"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(e){var t=e.constructor;return t&&t.prototype===e},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!p["$"+e]&&i.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{d(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();n=function(e){var t=null!==e&&"object"==typeof e,r="[object Function]"===o.call(e),n=a(e),s=t&&"[object String]"===o.call(e),p=[];if(!t&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var h=u&&r;if(s&&e.length>0&&!i.call(e,0))for(var m=0;m<e.length;++m)p.push(String(m));if(n&&e.length>0)for(var g=0;g<e.length;++g)p.push(String(g));else for(var v in e)h&&"prototype"===v||!i.call(e,v)||p.push(String(v));if(c)for(var y=function(e){if("undefined"==typeof window||!f)return d(e);try{return d(e)}catch(e){return!1}}(e),b=0;b<l.length;++b)y&&"constructor"===l[b]||!i.call(e,l[b])||p.push(l[b]);return p}}e.exports=n},function(e,t,r){var n=r(207),i=n("%Object%"),o=n("%TypeError%"),a=n("%String%"),s=r(481),c=r(482),u=r(483),l=r(484),d=r(485),p=r(146),f=r(486),h=r(208),m={ToPrimitive:f,ToBoolean:function(e){return!!e},ToNumber:function(e){return+e},ToInteger:function(e){var t=this.ToNumber(e);return c(t)?0:0!==t&&u(t)?l(t)*Math.floor(Math.abs(t)):t},ToInt32:function(e){return this.ToNumber(e)>>0},ToUint32:function(e){return this.ToNumber(e)>>>0},ToUint16:function(e){var t=this.ToNumber(e);if(c(t)||0===t||!u(t))return 0;var r=l(t)*Math.floor(Math.abs(t));return d(r,65536)},ToString:function(e){return a(e)},ToObject:function(e){return this.CheckObjectCoercible(e),i(e)},CheckObjectCoercible:function(e,t){if(null==e)throw new o(t||"Cannot call method on "+e);return e},IsCallable:p,SameValue:function(e,t){return e===t?0!==e||1/e==1/t:c(e)&&c(t)},Type:function(e){return null===e?"Null":void 0===e?"Undefined":"function"==typeof e||"object"==typeof e?"Object":"number"==typeof e?"Number":"boolean"==typeof e?"Boolean":"string"==typeof e?"String":void 0},IsPropertyDescriptor:function(e){if("Object"!==this.Type(e))return!1;var t={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var r in e)if(h(e,r)&&!t[r])return!1;var n=h(e,"[[Value]]"),i=h(e,"[[Get]]")||h(e,"[[Set]]");if(n&&i)throw new o("Property Descriptors may not be both accessor and data descriptors");return!0},IsAccessorDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!(!h(e,"[[Get]]")&&!h(e,"[[Set]]")))},IsDataDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!(!h(e,"[[Value]]")&&!h(e,"[[Writable]]")))},IsGenericDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!this.IsAccessorDescriptor(e)&&!this.IsDataDescriptor(e))},FromPropertyDescriptor:function(e){if(void 0===e)return e;if(s(this,"Property Descriptor","Desc",e),this.IsDataDescriptor(e))return{value:e["[[Value]]"],writable:!!e["[[Writable]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};if(this.IsAccessorDescriptor(e))return{get:e["[[Get]]"],set:e["[[Set]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};throw new o("FromPropertyDescriptor must be called with a fully populated Property Descriptor")},ToPropertyDescriptor:function(e){if("Object"!==this.Type(e))throw new o("ToPropertyDescriptor requires an object");var t={};if(h(e,"enumerable")&&(t["[[Enumerable]]"]=this.ToBoolean(e.enumerable)),h(e,"configurable")&&(t["[[Configurable]]"]=this.ToBoolean(e.configurable)),h(e,"value")&&(t["[[Value]]"]=e.value),h(e,"writable")&&(t["[[Writable]]"]=this.ToBoolean(e.writable)),h(e,"get")){var r=e.get;if(void 0!==r&&!this.IsCallable(r))throw new TypeError("getter must be a function");t["[[Get]]"]=r}if(h(e,"set")){var n=e.set;if(void 0!==n&&!this.IsCallable(n))throw new o("setter must be a function");t["[[Set]]"]=n}if((h(t,"[[Get]]")||h(t,"[[Set]]"))&&(h(t,"[[Value]]")||h(t,"[[Writable]]")))throw new o("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t}};e.exports=m},function(e,t,r){var n=r(207),i=n("%TypeError%"),o=n("%SyntaxError%"),a=r(208),s={"Property Descriptor":function(e,t){if("Object"!==e.Type(t))return!1;var r={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var n in t)if(a(t,n)&&!r[n])return!1;var o=a(t,"[[Value]]"),s=a(t,"[[Get]]")||a(t,"[[Set]]");if(o&&s)throw new i("Property Descriptors may not be both accessor and data descriptors");return!0}};e.exports=function(e,t,r,n){var a=s[t];if("function"!=typeof a)throw new o("unknown record type: "+t);if(!a(e,n))throw new i(r+" must be a "+t);console.log(a(e,n),n)}},function(e,t){e.exports=Number.isNaN||function(e){return e!=e}},function(e,t){var r=Number.isNaN||function(e){return e!=e};e.exports=Number.isFinite||function(e){return"number"==typeof e&&!r(e)&&e!==1/0&&e!==-1/0}},function(e,t){e.exports=function(e){return e>=0?1:-1}},function(e,t){e.exports=function(e,t){var r=e%t;return Math.floor(r>=0?r:r+t)}},function(e,t,r){var n=Object.prototype.toString,i=r(487),o=r(146),a=function(e){var t;if((t=arguments.length>1?arguments[1]:"[object Date]"===n.call(e)?String:Number)===String||t===Number){var r,a,s=t===String?["toString","valueOf"]:["valueOf","toString"];for(a=0;a<s.length;++a)if(o(e[s[a]])&&(r=e[s[a]](),i(r)))return r;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")};e.exports=function(e){return i(e)?e:arguments.length>1?a(e,arguments[1]):a(e)}},function(e,t){e.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},function(e,t,r){var n=r(204),i=r(209);e.exports=function(){var e=i();return n(String.prototype,{trim:e},{trim:function(){return String.prototype.trim!==e}}),e}},function(e,t,r){var n=r(146),i=Object.prototype.toString,o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){if(!n(t))throw new TypeError("iterator must be a function");var a;arguments.length>=3&&(a=r),"[object Array]"===i.call(e)?function(e,t,r){for(var n=0,i=e.length;n<i;n++)o.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))}(e,t,a):"string"==typeof e?function(e,t,r){for(var n=0,i=e.length;n<i;n++)null==r?t(e.charAt(n),n,e):t.call(r,e.charAt(n),n,e)}(e,t,a):function(e,t,r){for(var n in e)o.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))}(e,t,a)}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},function(e,t,r){var n=r(28),i=r(93),o=r(10),a=r(11);function s(e){var t=this,r=e.url||null;t.level={debug:0,log:1,info:2,warn:3,error:4}[e.level]||0,t.logCache=[],t.logNum=1,t.timeInterval=5e3,window.onerror=function(e,r,n,i,o){t.error(o)},i((function(){t.logCache.length>0&&r&&t.postLogs(r,t.logCache)}),t.timeInterval)}s.prototype.debug=function(){var e;this.level>0||(console.debug.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[degbug]"]).call(e,arguments)))},s.prototype.log=function(){var e;this.level>1||(console.log.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[log]"]).call(e,arguments)))},s.prototype.info=function(){var e;this.level>2||(console.info.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[info]"]).call(e,arguments)))},s.prototype.warn=function(){var e;this.level>3||(console.warn.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[warn]"]).call(e,arguments)))},s.prototype.error=function(){var e;this.level>4||(console.error.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[error]"]).call(e,arguments)))},s.prototype.cacheLogs=function(e,t){for(var r=[],i=0;i<t.length;i++){var o=t[i];"object"===n(o)?r.push(a(o)):r.push(o)}var s=this.logNum+++" "+e+" "+r.join("; ");this.logCache.push(s.replace("%c",""))},s.prototype.postLogs=function(e,t){var r=this,n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?(console.info("LoggerPlugin::日志上报完成"),r.logCache=[],r.timeInterval=5e3):r.timeInterval+=5e3)},n.open("POST",e),n.setRequestHeader("Content-Type","plain/text;charset=utf-8"),n.timeout=360,n.send(t.join("\n"))},e.exports=s},function(e,t,r){var n=r(4),i=r(40);e.exports=function(e){var t,r,o;e.db&&(i.db=e.db),e.rnfs&&(i.rnfs=e.rnfs,i.rnfs.size||(i.rnfs.size=1048576),i.rnfs.nimPromise=(t=i.rnfs,r=t.size/2-256,o=i.rnfs.DocumentDirectoryPath+"/nimlog_0.log",t.exists(o).then((function(e){return e?t.stat(o):n.reject(0)})).then((function(e){return e&&e.size>r?n.reject(1):n.reject(0)})).catch((function(e){return"number"==typeof e&&(t.nimIndex=e),n.resolve()}))))}},function(e,t,r){var n=r(51),i=r(0),o=i.notundef,a=i.undef;function s(e){o(e.name)&&(this.name=""+e.name),o(e.announcement)&&(this.announcement=""+e.announcement),o(e.broadcastUrl)&&(this.broadcastUrl=""+e.broadcastUrl),o(e.custom)&&(this.custom=""+e.custom),o(e.queuelevel)&&(this.queuelevel=n(e.queuelevel))}s.reverse=function(e){var t=i.copy(e);return a(t.announcement)&&(t.announcement=""),a(t.broadcastUrl)&&(t.broadcastUrl=""),a(t.custom)&&(t.custom=""),o(t.createTime)&&(t.createTime=+t.createTime),o(t.updateTime)&&(t.updateTime=+t.updateTime),o(t.onlineMemberNum)&&(t.onlineMemberNum=+t.onlineMemberNum),o(t.mute)&&(t.mute="1"===t.mute),t},e.exports=s},function(e,t,r){var n,i,o;e.exports=(n=r(65),o=(i=n).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<r;s++)i.push(n.charAt(a>>>6*(3-s)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,r){for(var n=[],i=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;n[i>>>2]|=s<<24-i%4*8,i++}return o.create(n,i)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},function(e,t,r){var n,i,o,a,s,c,u,l;e.exports=(n=r(65),r(599),r(600),a=(o=(i=n).lib).Base,s=o.WordArray,u=(c=i.algo).MD5,l=c.EvpKDF=a.extend({cfg:a.extend({keySize:4,hasher:u,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),o=s.create(),a=o.words,c=n.keySize,u=n.iterations;a.length<c;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var l=1;l<u;l++)r=i.finalize(r),i.reset();o.concat(r)}return o.sigBytes=4*c,o}}),i.EvpKDF=function(e,t,r){return l.create(r).compute(e,t)},n.EvpKDF)},function(e,t,r){r(211);var n=r(32);r(224)(n),e.exports=n},function(e,t,r){var n=r(4),i=r(16),o=r(3),a=r(10),s=r(219),c=r(8),u=r(19),l=r(53),d=r(149),p=r(217),f=r(498),h=r(0),m=r(220),g=r(33),v=g.newSupportDBError,y=g.noDBError,b=!1;function S(e){b=e,m.set("db",e,p)}function _(e){this.concurrency=0,this.pendingTasks=[],this.queue=n.resolve(),this.logger=e.logger,this.notifyError=e.notifyError}S(!!h.getGlobal().indexedDB),"IE"===l.name&&S(!1),"Microsoft Edge"===l.name&&S(!1),"Safari"===l.name&&S(!1);var M=_.prototype;M.reset=h.emptyFunc,b&&(M.reset=function(e){this.enable=!1!==e}),M.addTask=function(e){var t=this;return new n((function(r,n){function i(e){t.concurrency--;var r=t.pendingTasks.shift();r&&t.addTask(r),e()}if(t.concurrency<100)return t.concurrency++,e().then((function(t){i((function(){r(t),e.resolve&&e.resolve(t)}))}),(function(t){i((function(){var r={event:(t=t||{}).event||t,callFunc:t.callFunc||"db::addTask"};n(r),e.reject&&e.reject(r)}))}));e.resolve||(e.resolve=r,e.reject=n),t.pendingTasks.push(e)}))},M.init=function(e){var t=this;return t.addTask((function(){return t.enable?t.server?n.resolve():(t.name="nim-"+e,p.open({server:t.name,version:f.version,schema:f.schema}).then((function(e){t.logger.info("db::init: ".concat(t.name)),t.server=e}),(function(e){throw S(!1),t.server=null,t.name=null,e}))):n.reject(v({callFunc:"db::init"}))}))},M.destroy=function(){var e=this;return e.addTask((function(){return e.enable?e.server?p.remove(e.name).then((function(){e.logger.info("db::destroy: ".concat(e.name)),e.server=null,e.name=null})):n.resolve():n.reject(v({callFunc:"db::destroy"}))}))},M.clear=function(){var e=this;return e.addTask((function(){return e.enable?e.server?e.server.clear("timetag").then((function(){var t=i([]).call(e.server.getIndexedDB().objectStoreNames),r=[];if(o(t).call(t,(function(t){r.push(e.server.clear(t))})),r.length)return n.all(r).then((function(){e.logger.info("db::clear: ".concat(e.name))})).catch((function(t){return e.logger.error("db::clear: ",t),n.reject(t)}))})):n.resolve():n.reject(v({callFunc:"db::clear"}))}))},M.close=function(){this.server&&(this.server.close(),this.server=null,this.name=null)},M.remove=function(e,t,r,n,i,o,s){var c=this;return c.addTask((function(){return c.checkDB(),c.server.remove(e,t,r,n,i,o,s).then((function(){var n;c.logger.info(a(n="db::delete: ".concat(e," ")).call(n,t||r))})).catch((function(e){c.logger.error("db::remove::server.remove error",e)}))}))},M.put=function(e,t){var r=this;return r.addTask((function(){return r.checkDB(),h.isArray(t)||(t=[t]),r.server.update(e,t).then((function(t){var n=[e],i=f.keyPath(e),a=[];return i&&(o(t).call(t,(function(e){a.push(d(e,i))})),n.push(1===a.length?a[0]:a)),n.unshift("db::put:"),"timetag"===e&&n.push(t[0]),r.logger.log.apply(r.logger.log,n),t}))}))},M.get=function(e,t){var r=this;return r.addTask((function(){return r.checkDB(),r.server.get(e,t)}))},M.modifyOrPut=function(e){var t=this,r=e.table,n=h.copy(e.obj),i=e.key,o=e.modifyObjWhenPut,a=h.copy(n);return delete a[i],t.getOne(r,null,n[i],{modifyObj:a}).then((function(e){return e?(a.idClient?a={idClient:a.idClient,server:a.server,pinFrom:a.pinFrom}:(a.lastMsg=a.lastMsg&&a.lastMsg.idServer+"_"+a.lastMsg.idClient,a.localCustom=a.localCustom&&"***",a.topCustom=a.topCustom&&"***"),t.logger.log("db::modifyOrPut: update table ".concat(r),a),e):(n=h.merge(n,o),t.put(r,n).then((function(e){return e[0]})))}))},M.updateAndDelete=function(e,t,r){var n=this;return n.addTask((function(){return n.checkDB(),n.server.updateAndDelete(e,t,r)}))},M.getAll=function(e,t){var r=this;return r.addTask((function(){var n,i,o;return r.checkDB(),(t=t||{}).keys=!0===s(t),t.desc=!0===t.desc,t.distinct=!0===t.distinct,c(n=s(i=u(o=r.server.query(e,t.index)).call(o,u(t))).call(i,s(t)).desc(t.desc).limit(t.limit).distinct(t.distinct)).call(n,t.mapper).modify(t.modifyObj).execute()}))},M.getOnly=function(e,t,r,n){var i=this;return i.addTask((function(){var o,a,l;return i.checkDB(),(n=n||{}).keys=!0===s(n),n.desc=!0===n.desc,n.distinct=!0===n.distinct,n.remove=!0===n.remove,c(o=s(a=u(l=i.server.query(e,t).only(r)).call(l,u(n))).call(a,s(n)).desc(n.desc).limit(n.limit).distinct(n.distinct)).call(o,n.mapper).modify(n.modifyObj).remove(n.remove).execute()}))},M.getOne=function(){return this.getOnly.apply(this,arguments).then((function(e){return e[0]}))},M.clearTable=function(e){var t=this;return t.addTask((function(){return t.checkDB(),t.server.clear(e)}))},M.checkDB=function(){if(!this.enable)throw v({callFunc:"db::checkDB"});if(!this.server)throw y({callFunc:"db::checkDB"})},e.exports=_},function(e,t){var r={version:12},n={kv:{key:{keyPath:"key"}},timetag:{key:{keyPath:"name"}},sessionsWithMoreRoaming:{key:{keyPath:"id"}},msgReadDetail:{key:{keyPath:"idClient"}},blacklist:{key:{keyPath:"account"}},mutelist:{key:{keyPath:"account"}},friend:{key:{keyPath:"account"}},user:{key:{keyPath:"account"}},team:{key:{keyPath:"teamId"}},teamMember:{key:{keyPath:"id"},indexes:{teamId:{unique:!1},account:{unique:!1}}},superTeam:{key:{keyPath:"teamId"}},superTeamMember:{key:{keyPath:"id"},indexes:{teamId:{unique:!1},account:{unique:!1},id:{unique:!1}}},msg:{key:{autoIncrement:!0},indexes:{idClient:{unique:!0},sessionId:{unique:!1},time:{unique:!1},type:{unique:!1},sessionType:{unique:!1},status:{unique:!1},sessionTime:{key:["sessionId","time"],unique:!1}}},msg1:{key:{keyPath:"idClient"},indexes:{sessionId:{unique:!1},time:{unique:!1},status:{unique:!1},sessionTime:{key:["sessionId","time"],unique:!1}}},msgPin:{key:{keyPath:"idClient"},indexes:{sessionId:{unique:!1}}},broadcastMsg:{key:{keyPath:"broadcastId"},indexes:{time:{unique:!1}}},sysMsg:{key:{autoIncrement:!0},indexes:{idServer:{unique:!0},category:{unique:!1},type:{unique:!1}}},sysMsgUnread:{key:{keyPath:"type"}},session:{key:{keyPath:"id"},indexes:{updateTime:{unique:!1}}}};r.keyPath=function(e){return n[e].key.keyPath},r.schema=function(){return window._nimForceSyncIM=!0,n},e.exports=r},function(e,t,r){var n=r(52).fn;n.setKey=function(e,t){return this.put("kv",{key:e,value:t})},n.getKey=function(e){return this.get("kv",e).then((function(e){return e&&e.value}))},n.setDonnop=function(e){return this.setKey("donnop",e)},n.getDonnop=function(){return this.getKey("donnop")}},function(e,t,r){var n=r(6),i=r(51),o=r(52).fn;o.getTimetags=function(e){var t={};return this.getAll("timetag",{filter:e,mapper:function(e){var r;return-1!==n(r=e.name).call(r,"team-")?t[e.name]=0:t[e.name]=e.value,e}}).then((function(){return t}))},o.getTeamMemberTimetags=function(){return this.getTimetags((function(e){var t;return-1!==n(t=e.name).call(t,"team-")}))},o.getTimetag=function(e){return this.getOne("timetag",null,e).then((function(e){return(e=e||{value:0}).value}))},o.getTeamMemberTimetag=function(e){return 0},o.updateTimetag=function(e,t){var r=this,n={name:e,value:t};return this.put("timetag",n).catch((function(e){r.notifyError&&r.notifyError(e)}))},o.updateMyInfoTimetag=function(e){return this.updateTimetag("myInfo",e)},o.updateRelationTimetag=function(e){return this.updateTimetag("relations",e)},o.getRelationsTimetag=function(){return this.getTimetag("relations")},o.updateFriendTimetag=function(e){return this.updateTimetag("friends",e)},o.getFriendsTimetag=function(){return this.getTimetag("friends")},o.updateFriendUserTimetag=function(e){return this.updateTimetag("friendUsers",e)},o.updateTeamTimetag=function(e){return this.updateTimetag("teams",e)},o.getTeamsTimetag=function(){return this.getTimetag("teams")},o.updateSuperTeamTimetag=function(e){return this.updateTimetag("superTeams",e)},o.getSuperTeamsTimetag=function(){return this.getTimetag("superTeams")},o.updateTeamMemberTimetag=function(e,t){return this.updateTimetag("team-"+e,t)},o.getTeamMembersTimetag=function(e){return this.getTimetag("team-"+e)},o.updateSuperTeamMemberTimetag=function(e,t){return this.updateTimetag("superTeam-"+e,t)},o.getSuperTeamMembersTimetag=function(e){return this.getTimetag("superTeam-"+e)},o.updateMyTeamMembersTimetag=function(e){return this.updateTimetag("myTeamMembers",e)},o.getBroadcastMsgTimetag=function(e){return this.getTimetag("broadcastMsg")},o.updateBroadcastMsgTimetag=function(e){return this.updateTimetag("broadcastMsg",i(e))},o.updateRoamingMsgTimetag=function(e){return this.updateTimetag("roamingMsgs",e)},o.updateSuperTeamRoamingMsgTimetag=function(e){return this.updateTimetag("superTeamRoamingMsgs",e)},o.updateMsgReceiptsTimetag=function(e){return this.updateTimetag("msgReceipts",e)},o.updateDonnopTimetag=function(e){return this.updateTimetag("donnop",e)},o.updateSessionAck=function(e){return this.updateTimetag("sessionAck",e)},o.updateDeleteMsgSelf=function(e){return this.updateTimetag("deleteMsgSelf",e)},o.updateSuperTeamSessionAck=function(e){return this.updateTimetag("superTeamSessionAck",e)},o.deleteTimetag=function(e){return this.remove("timetag",e)},o.deleteTeamMemberTimetag=function(e){return this.deleteTimetag("team-"+e)},o.deleteSuperTeamMemberTimetag=function(e){return this.deleteTimetag("superTeam-"+e)}},function(e,t,r){var n=r(4),i=r(52).fn,o=r(0);i.mergeRelations=function(e,t,r,i,o){var a=this,s=a.updateAndDelete("blacklist",e,t),c=a.updateAndDelete("mutelist",r,i);return n.all([s,c]).then((function(){return a.logger.info("db::mergeRelations: timetag ".concat(o)),a.updateRelationTimetag(o),[e,t,r,i,o]}))},i.getRelations=function(){var e=this.getAll("blacklist"),t=this.getAll("mutelist");return n.all([e,t])},i.markInBlacklist=function(e){if((e=o.copy(e)).isAdd){var t=e.record;return this.put("blacklist",t)}var r=e.account;return this.remove("blacklist",r)},i.markInMutelist=function(e){if((e=o.copy(e)).isAdd){var t=e.record;return this.put("mutelist",t)}var r=e.account;return this.remove("mutelist",r)}},function(e,t,r){var n=r(8),i=r(4),o=r(52).fn,a=r(0);o.mergeFriends=function(e,t,r){var i=this;return i.updateAndDelete("friend",e,t).then((function(){return i.logger.log("db::mergeFriends: updateAndDelete done",e&&n(e).call(e,(function(e){return e.account})).join(",")),r&&i.updateFriendTimetag(r),[e,t,r]}))},o.putFriend=function(e){return this.put("friend",e)},o.updateFriend=function(e){var t=this,r=(e=a.copy(e)).account;return this.getOne("friend",null,r,{modifyObj:e}).then((function(e){return e?t.logger.log("db::updateFriend: ".concat(r)):t.logger.warn("db::updateFriend: no record ".concat(r)),e}))},o.deleteFriend=function(e){var t=this.remove("friend",e),r=this.deleteUser(e);return i.all([t,r])},o.getFriends=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getAll("friend",{filter:function(t){return void 0!==e.updateTime?t.valid&&t.updateTime>e.updateTime:t.valid}})},o.getFriend=function(e){return this.getOne("friend",null,e)},o.getUserFromBlackList=function(e){return this.getOne("blacklist",null,e)}},function(e,t,r){var n=r(4),i=r(3),o=r(10),a=r(8),s=r(52).fn,c=r(0),u=r(33),l=r(142),d=r(116);function p(e){return e.valid&&e.validToCurrentUser}function f(e){return e&&e.valid}function h(e){return e&&c.fillUndef(e,{mute:!1,custom:""}),e}s.mergeTeams=function(e,t,r){var i=this,o=i.put("team",e),a=i.leaveTeams(t,r);return n.all([o,a]).then((function(){return i.logger.log("db::mergeTeams:"),i.updateTeamTimetag(r),[e,t,r]}))},s.putTeam=function(e){if(e)return c.isArray(e)||(e=[e]),i(e).call(e,(function(e){e.validToCurrentUser=!0})),this.put("team",e)},s.updateTeam=function(e){var t=this,r=(e=c.copy(e)).teamId;return t.getOne("team",null,r,{modifyObj:e}).then((function(n){if(n)t.logger.log("db::updateTeam: ".concat(r));else if(t.logger.warn("db::updateTeam: no record ".concat(r)),e.validToCurrentUser)return t.putTeam(e);return n}))},s.transferTeam=function(e,t,r){var n=this,i=e.teamId,a=e.memberUpdateTime,s={teamId:i,account:t,type:"normal",updateTime:a},c={teamId:i,account:r,type:"owner",updateTime:a};return n.updateTeamMembers([s,c]).then((function(){return n.putTeam(e).then((function(){var i,a;return n.logger.info(o(i=o(a="db::transferTeam: ".concat(e.teamId," ")).call(a,t," -> ")).call(i,r)),[e,t,r]}))}))},s.leaveTeam=function(e){var t=this;return t.updateTeam({teamId:e,validToCurrentUser:!1}).then((function(){return t.removeAllTeamMembers(e)}))},s.dismissTeam=function(e,t){var r=this,n={teamId:e,valid:!1,validToCurrentUser:!1,updateTime:t};return r.updateTeam(n).then((function(){return r.removeAllTeamMembers(e)}))},s.leaveTeams=function(e,t){var r,o=this,a=[];return i(e).call(e,(function(e){r=o.leaveTeam(e.teamId,t),a.push(r)})),n.all(a)},s.getTeamsByTeamIds=function(e){var t,r=this,o=[];return i(e).call(e,(function(e){t=r.getTeam(e),o.push(t)})),n.all(o)},s.getTeam=function(e){e=""+e;var t=this;return t.getOne("team",null,e).then((function(e){return e?(t.updateTeamProperties([e]),e):null}))},s.getTeams=function(){var e=this;return e.getAll("team",{filter:p}).then((function(t){return e.updateTeamProperties(t),t}))},s.updateTeamProperties=function(e){i(e).call(e,(function(e){e&&l.fillProperties(e)}))},s.mergeTeamMembers=function(e,t,r,i){var o=this,a=o.putTeamMembers(t),s=o.updateTeamMembers(r);return n.all([a,s]).then((function(){return o.logger.log("db::mergeTeamMembers: ".concat(e)),o.updateTeamMemberTimetag(e,i)}))},s.putTeamMembers=function(e){return this.put("teamMember",e)},s.getTeamMembersByAccount=function(e){return this.getOnly("teamMember","account",e,{filter:f,mapper:h}).then()},s.getTeamMembers=function(e){var t=this;return e=""+e,t.getOnly("teamMember","teamId",e,{filter:function(e){return e.valid},mapper:h}).then((function(e){return t.updateTeamMemberProperties(e).then((function(){return e}))}))},s.updateTeamMemberProperties=function(e){var t,r=this,o=[];return i(e).call(e,(function(e){d.fillProperties(e)&&(t=r.updateTeamMember(e),o.push(t))})),n.all(o)},s.getInvalidTeamMembers=function(e,t){var r=this;e=""+e;var o,a=[];return i(t).call(t,(function(t){o=r.getOne("teamMember",null,d.genId(e,t)).then((function(e){return h(e)})),a.push(o)})),n.all(a)},s.updateTeamMember=function(e){var t=this,r=e.teamId,n=e.account,i=d.genId(r,n),a=c.filterObj(e,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne("teamMember",null,i,{modifyObj:a,mapper:h}).then((function(e){var i,s;return e?t.logger.log(o(i="db::updateTeamMember: ".concat(r," ")).call(i,n),c.pickAsString(a,["muteTeam","mute","updateTime","type","valid"])):t.logger.warn(o(s="db::updateTeam: no record ".concat(r," ")).call(s,n)),e}))},s.updateTeamMembers=function(e){var t=this;if(!e.length)return n.resolve();var r,o=[];return i(e).call(e,(function(e){r=t.updateTeamMember(e),o.push(r)})),n.all(o)},s.updateTeamManagers=function(e,t,r,n){var i=a(t).call(t,(function(t){return{teamId:e,account:t,type:r?"manager":"normal",updateTime:n}}));return this.updateTeamMembers(i)},s.removeTeamMembersByAccounts=function(e,t){var r=a(t).call(t,(function(t){return{teamId:e,account:t,valid:!1}}));return this.updateTeamMembers(r)},s.removeAllTeamMembers=function(e){var t=this;return t.getOnly("teamMember","teamId",e,{modifyObj:{valid:!1}}).then((function(){return t.logger.warn("db::removeAllTeamMembers: ".concat(e)),t.deleteTeamMemberTimetag(e)}))},s.deleteTeamMembers=function(e){var t=this;return t.getOnly("teamMember","teamId",e,{remove:!0}).then((function(){t.logger.warn("db::deleteTeamMembers: ".concat(e)),t.deleteTeamMemberTimetag(e)}))},s.deleteTeam=function(e){var t,r=this,o=[];return c.isArray(e)||(e=[e]),i(e).call(e,(function(e){e=""+e,t=r.get("team",e).then((function(t){if(t&&p(t))throw u.stillInTeamError({callFunc:"team::deleteTeam",team:t});var i=r.remove("team",e),o=r.deleteTeamMembers(e);return n.all([i,o])})),o.push(t)})),1===o.length?o[0]:n.all(o)}},function(e,t,r){var n=r(4),i=r(3),o=r(5),a=r(10),s=r(8),c=r(52).fn,u=r(0),l=r(33),d=r(221),p=r(152);function f(e){return e.valid&&e.validToCurrentUser}function h(e){return e&&u.fillUndef(e,{mute:!1,custom:""}),e}c.mergeSuperTeams=function(e,t,r){var i=this,o=i.put("superTeam",e),a=i.leaveTeams(t,r);return n.all([o,a]).then((function(){return i.logger.log("db::mergeSuperTeams:"),i.updateSuperTeamTimetag(r),[e,t,r]}))},c.putSuperTeam=function(e){if(e)return u.isArray(e)||(e=[e]),i(e).call(e,(function(e){e.validToCurrentUser=!0})),this.put("superTeam",e)},c.updateSuperTeam=function(e){var t=this,r=(e=u.copy(e)).teamId;return t.getOne("superTeam",null,r,{modifyObj:e}).then((function(n){return n?(t.logger.info("db::updateSuperTeam: ".concat(r)),n):(t.logger.warn("db::updateSuperTeam: no record ".concat(r)),t.putSuperTeam(e))}))},c.leaveSuperTeam=function(e){var t=this;return t.updateSuperTeam({teamId:e,validToCurrentUser:!1}).then((function(){return t.removeAllSuperTeamMembers(e)}))},c.dismissSuperTeam=function(e,t){var r=this,n={teamId:e,valid:!1,validToCurrentUser:!1,updateTime:t};return r.updateSuperTeam(n).then((function(){return r.removeAllSuperTeamMembers(e)}))},c.leaveSuperTeams=function(e,t){var r,o=this,a=[];return i(e).call(e,(function(e){r=o.leaveSuperTeam(e.teamId,t),a.push(r)})),n.all(a)},c.getSuperTeamsByTeamIds=function(e){var t,r=this,o=[];return i(e).call(e,(function(e){t=r.getSuperTeam(e),o.push(t)})),n.all(o)},c.getSuperTeam=function(e){e=""+e;var t=this;return t.getOne("superTeam",null,e).then((function(e){return e?(t.updateSuperTeamProperties([e]),e):null}))},c.getSuperTeams=function(){var e=this;return e.getAll("superTeam",{filter:f}).then((function(t){return e.updateSuperTeamProperties(t),t}))},c.updateSuperTeamProperties=function(e){i(e).call(e,(function(e){e&&d.fillProperties(e)}))},c.mergeSuperTeamMembers=function(e,t,r,i){var o=this,a=o.putSuperTeamMembers(t),s=o.updateSuperTeamMembers(r);return n.all([a,s]).then((function(){return o.logger.log("db::mergeSuperTeamMembers: ".concat(e)),null!=i?o.updateSuperTeamMemberTimetag(e,i):n.resolve()}))},c.putSuperTeamMembers=function(e){return this.put("superTeamMember",e)},c.getSuperTeamMemberById=function(e){return this.get("superTeamMember",e)},c.getSuperTeamMembers=function(e,t){var r=this;e=""+e;var n={filter:function(e){return e.valid},mapper:h};if(t){if("number"!=typeof t.joinTime)return void r.logger.error("db::getSuperTeamMembers::params.joinTime should be number, not ",t.joinTime);t.limit&&(n.limit=t.limit),o(t)?n.filter=function(e){return e.valid&&e.joinTime<=t.joinTime}:n.filter=function(e){return e.valid&&e.joinTime>=t.joinTime}}return r.getOnly("superTeamMember","teamId",e,n).then((function(e){return r.updateSuperTeamMemberProperties(e).then((function(){return e}))}))},c.updateSuperTeamMemberProperties=function(e){var t,r=this,o=[];return i(e).call(e,(function(e){p.fillProperties(e)&&(t=r.updateSuperTeamMember(e),o.push(t))})),n.all(o)},c.getInvalidSuperTeamMembers=function(e,t){var r=this;e=""+e;var o,a=[];return i(t).call(t,(function(t){o=r.getOne("superTeamMember","id",p.genId(e,t)).then((function(e){return h(e)})),a.push(o)})),n.all(a)},c.updateSuperTeamMember=function(e){var t=this,r=e.teamId,n=e.account,i=p.genId(r,n),o=u.filterObj(e,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne("superTeamMember","id",i,{modifyObj:o,mapper:h}).then((function(e){var i,s;return e?t.logger.log(a(i="db::updateSuperTeamMember: ".concat(r," ")).call(i,n),u.pickAsString(o,["muteTeam","mute","updateTime","type","valid"])):t.logger.warn(a(s="db::updateSuperTeam: no record ".concat(r," ")).call(s,n)),e}))},c.updateSuperTeamMembers=function(e){var t=this;if(!e.length)return n.resolve();var r,o=[];return i(e).call(e,(function(e){r=t.updateSuperTeamMember(e),o.push(r)})),n.all(o)},c.removeSuperTeamMembersByAccounts=function(e,t){var r=s(t).call(t,(function(t){return{teamId:e,account:t,valid:!1}}));return this.updateSuperTeamMembers(r)},c.removeAllSuperTeamMembers=function(e){var t=this;return t.getOnly("superTeamMember","teamId",e,{modifyObj:{valid:!1}}).then((function(){return t.logger.warn("db::removeAllSuperTeamMembers: ".concat(e)),t.deleteSuperTeamMemberTimetag(e)}))},c.deleteSuperTeamMembers=function(e){var t=this;return t.getOnly("superTeamMember","teamId",e,{remove:!0}).then((function(){t.logger.warn("db::deleteSuperTeamMembers: ".concat(e)),t.deleteSuperTeamMemberTimetag(e)}))},c.deleteSuperTeam=function(e){var t,r=this,o=[];return u.isArray(e)||(e=[e]),i(e).call(e,(function(e){e=""+e,t=r.get("superTeam",e).then((function(t){if(t&&f(t))throw l.stillInTeamError({callFunc:"team::deleteTeam",team:t});var i=r.remove("superTeam",e),o=r.deleteSuperTeamMembers(e);return n.all([i,o])})),o.push(t)})),1===o.length?o[0]:n.all(o)},c.transferSuperTeam=function(e,t,r){var n=this;return n.updateSuperTeamMembers([t,r]).then((function(){return n.putSuperTeam(e).then((function(){var i,o;return n.logger.info(a(i=a(o="db::transferSuperTeam: ".concat(e.teamId," ")).call(o,t.account," -> ")).call(i,r.account)),[e,t,r]}))}))}},function(e,t,r){var n=r(3),i=r(4),o=r(6),a=r(52).fn,s=r(0);a.mergeMyInfo=function(e,t){var r=this;return r.put("user",e).then((function(){return t?r.updateMyInfoTimetag(e.updateTime):e}))},a.mergeFriendUsers=function(e,t){var r=this;return r.putUsers(e).then((function(){r.updateFriendUserTimetag(t)}))},a.putUsers=function(e){return this.put("user",e)},a.putUser=function(e){return this.put("user",e)},a.updateUser=function(e){var t=this,r=(e=s.copy(e)).account;return this.getOne("user",null,r,{modifyObj:e}).then((function(e){return e?t.logger.log("db::updateUser: ".concat(r)):t.logger.warn("db::updateUser: no record ".concat(r)),e}))},a.putUsersIfIsFriend=function(e){var t,r=this,o=[],a=[];return n(e).call(e,(function(e){t=r.getFriend(e.account).then((function(n){return n&&(t=r.putUser(e),a.push(t)),n})),o.push(t)})),i.all(o).then((function(){return i.all(a).then((function(e){return e}))}))},a.deleteUser=function(e){return this.remove("user",e)},a.getUser=function(e){return this.getOne("user",null,e)},a.getUsers=function(e){return this.getAll("user",{filter:function(t){return-1!==o(e).call(e,t.account)}})},a.getAllUsers=function(){return this.getAll("user")}},function(e,t,r){var n=r(19),i=r(4),o=r(10),a=r(3),s=r(48),c=r(29),u=r(6),l=r(8),d=r(52).fn,p=r(0),f=r(17);d.putMsg=function(e){var t=this;return p.isArray(e)||(e=[e]),!e.length||n(e[0])?i.resolve():(e=n(e).call(e,(function(e){return!e.ignore})),t.put("msg1",e).catch((function(r){return t.notifyError&&t.notifyError(r),i.resolve(e,r)})))},d.putMsgReadDetail=function(e){var t=this;if(e.idClient)return this.put("msgReadDetail",e).catch((function(e){t.logger.error("putMsgReadDetail error",e)}))},d.getMsgReadDetail=function(e){return this.getOne("msgReadDetail",null,e)},d.updateMsg=function(e){var t=this;if(!n(e)){var r=e.idClient,a=p.filterObj(e,"resend status idServer time localCustom commentTimetag comments hasSendAck");return t.getOne("msg1",null,r,{modifyObj:a}).then((function(e){var n,i,s;return e?t.logger.info(o(n=o(i=o(s="db::updateMsg: ".concat(r,"，idServer: ")).call(s,a.idServer,"，status: ")).call(i,a.status,"，time: ")).call(n,a.time)):t.logger.warn("db::updateMsg: no record ".concat(r)),e})).catch((function(r){return t.notifyError&&t.notifyError(r),i.resolve(e)}))}},d.updateMsgBatch=function(e){var t=this;if(f.isRN)this.logger.warn("react native can not support updateMsgBatch");else{this.checkDB();var r=this.server.getIndexedDB().transaction(["msg1"],"readwrite").objectStore("msg1");a(e).call(e,(function(e){if(e.idClient){var n=r.get(e.idClient);n.onerror=function(e){t.logger.error("updateMsgBatch::store.get:error",e)},n.onsuccess=function(i){var o=n.result||e;r.put(s({},o,e)).onerror=function(e){t.logger.error("updateMsgBatch::store.put:error",e)}}}}))}},d.getMsgs=function(e){return f.isBrowser?this.getMsgsIndexedDB(e):f.isRN?this.getMsgsRN(e):i.resolve()},d.getMsgsRN=function(e){var t={};return"number"==typeof e.start&&(t.lowerBound=["time",e.start]),"number"==typeof e.end&&e.end!==1/0&&(t.upperBound=["time",e.end]),t.desc=!1,t.index="time","boolean"==typeof e.desc&&(t.desc=e.desc),"number"==typeof e.limit&&(t.limit=e.limit),t.searchIndex=[],e.sessionId&&t.searchIndex.push(["sessionId",e.sessionId]),"string"==typeof e.type&&t.searchIndex.push(["type",e.type]),this.getAll("msg1",t)},d.getMsgsIndexedDB=function(e){var t;this.checkDB();var r="time",i=!1,a=!1,s=(e=e||{}).sessionId||[],l=e.sessionIds||[];p.isString(s)?s=[s]:c(s)||(s=[]),p.isString(l)?l=[l]:c(l)||(l=[]);var d=o(s).call(s,l);1===d.length?(i=!0,r="sessionTime",s=d[0]):d.length>1&&(i=!0,a=!0,l=d);var f=e.start||0,h=e.end||1/0,m=f,g=h;i&&!a&&(m=[s,f],g=[s,h]);var v=!1!==e.desc,y=e.limit||100,b=!1,S=!1,_=e.type||[],M=e.types||[];p.isString(_)?_=[_]:c(_)||(_=[]),p.isString(M)?M=[M]:c(M)||(M=[]);var T=o(_).call(_,M);1===T.length?(b=!0,_=T[0]):T.length>1&&(b=!0,S=!0,M=T);var w,x=e.subTypes&&e.subTypes.length,I=e.keyword||"",E=e.filterFunc;return(a||b||I||x||p.isFunction(E))&&(w=function(t){var r;if(a&&-1===u(l).call(l,t.sessionId))return!1;if(b)if(S){if(-1===u(M).call(M,t.type))return!1}else if(_!==t.type)return!1;if(x&&-1===u(r=e.subTypes).call(r,t.subType))return!1;if(I){var n=t.text||t.tip||"";if(-1===u(n).call(n,I))return!1}return!E||E(t)}),n(t=this.server.query("msg1",r).bound(m,g,!0,!0).desc(v).limit(y)).call(t,w).execute()},d.getMsgCountAfterAck=function(e){return f.isBrowser?this.getMsgCountAfterAckIndexedDB(e):f.isRN?this.getMsgCountAfterAckRN(e):i.resolve()},d.getMsgCountAfterAckRN=function(e){var t=e=e||{},r=t.sessionId,o=t.ack;return this.checkDB(),this.getAll("msg1",{searchIndex:["sessionId",r],lowerBound:["time",o]}).then((function(t){var r=n(t).call(t,(function(t){return"out"!==t.flow&&!1!==t.isUnreadable&&("notification"!==t.type||e.shouldCountNotifyUnread(t))}));return i.resolve(r.length)}))},d.getMsgCountAfterAckIndexedDB=function(e){var t=(e=e||{}).sessionId;return this.checkDB(),this.server.query("msg1","sessionTime").bound([t,e.ack],[t,1/0],!0,!0).execute().then((function(t){var r=n(t).call(t,(function(t){return"out"!==t.flow&&!1!==t.isUnreadable&&("notification"!==t.type||e.shouldCountNotifyUnread(t))}));return i.resolve(r.length)}))},d.amendMsg=function(e){return e?(p.notexist(e.text)&&(e.text=""),e):null},d.getMsgByIdClient=function(e){var t=this;return t.getOne("msg1",null,e).then((function(e){return t.amendMsg(e)}))},d.getMsgsByIdClients=function(e){var t,r=this,n=[];return a(e).call(e,(function(e){t=r.getMsgByIdClient(e),n.push(t)})),i.all(n)},d.clearSendingMsgs=function(){var e=this;return e.getOnly("msg1","status","sending",{modifyObj:{status:"fail"}}).then((function(t){e.logger.info("db::clearSendingMsgs: msgs send failed",t&&l(t).call(t,(function(e){return e.idClient})).join(","))}))},d.deleteMsg=function(e){var t,r=this,n=[];return p.isArray(e)||(e=[e]),a(e).call(e,(function(e){t=r.getOne("msg1",null,e,{remove:!0}).then((function(e){return r.logger.info("db::deleteMsg:",e&&e.idClient),e})),n.push(t)})),1===n.length?n[0]:i.all(n)},d.deleteMsgsBySessionId=function(e){var t=this,r=null,n=e.start,i=e.end;return void 0!==n&&void 0!==i?r=function(e){return e>n&&e<i}:void 0!==n?r=function(e){return e>n}:void 0!==i&&(r=function(e){return e<i}),r?t.getOnly("msg1","sessionId",e.sessionId).then((function(e){var n=[];return l(e=e||[]).call(e,(function(e){r(e.time)&&n.push(e.idClient)})),t.logger.info("db::deleteMsgsBySessionId: session results",n),t.deleteMsg(n)})):t.getOnly("msg1","sessionId",e.sessionId,{remove:!0})},d.deleteMsgsByTime=function(e){return this.remove("msg1",null,"time",e.start,e.end,!0,!0)},d.deleteAllMsgs=function(){var e=this.clearTable("msg1"),t=this.clearTable("session");return i.all([e,t])},d.getMsgPins=function(e){return this.getOnly("msgPin","sessionId",e)},d.deleteMsgPins=function(e){return this.getOnly("msgPin","sessionId",e,{remove:!0})},d.putMsgPin=function(e){var t=this;return this.modifyOrPut({table:"msgPin",obj:e,key:"idClient"}).catch((function(e){t.notifyError&&t.notifyError(e)}))},d.putMsgPins=function(e){return this.put("msgPin",e)},d.deleteMsgPin=function(e){var t=this;return this.getOne("msgPin",null,e.idClient,{remove:!0}).then((function(e){return t.logger.info("db::deleteMsgPin:",e.idClient),e}))}},function(e,t,r){var n=r(4),i=r(19),o=r(3),a=r(5),s=r(9),c=r(52).fn,u=r(0),l=u.notundef;c.putSysMsg=function(e){var t=this;return new n((function(r){if(u.isArray(e)||(e=[e]),!i(e[0])){var n=[],a=e.length;o(e).call(e,(function(e){e=u.copy(e),t.put("sysMsg",e).then((function(e){n.push(e[0]),s()}),s)}))}function s(){0==--a&&r(n)}}))},c.getSysMsgs=function(e){var t=!a(e=e||{}),r=e.limit||100,n=null,i=null;e.category&&(n="category",i=e.category),e.type&&(n="type",i=e.type);var o,s=e.lastIdServer,c=!1,u=e.read;return(l(s)||l(u))&&(o=function(e){return l(s)?(s=""+s,c?t():(e.idServer===s&&(c=!0),!1)):t();function t(){return!l(u)||e.read===u}}),e={filter:o,desc:t,limit:r},n?this.getOnly("sysMsg",n,i,e):this.getAll("sysMsg",e)},c.getSysMsgByIdServer=function(e){return this.getOne("sysMsg","idServer",e)},c.updateSysMsg=function(e){var t=this;if(!i(e)){var r=""+e.idServer,n=u.filterObj(e,"read state error localCustom");return this.getOne("sysMsg","idServer",r,{modifyObj:n}).then((function(e){return e?t.logger.log("db::updateSysMsg: ".concat(r),u.pickAsString(n,["read","state","error"])):t.logger.warn("db::updateSession: ".concat(r)),e}))}},c.markSysMsgRead=function(e){var t=this;return new n((function(r,i){u.isArray(e)||(e=[e]);var a,s,c=[],l=[];o(e).call(e,(function(e){a=t.getSysMsgByIdServer(e.idServer).then((function(e){e&&!e.read&&(s=t.updateSysMsg({idServer:e.idServer,read:!0}),l.push(s))}),i),c.push(a)})),n.all(c).then((function(){n.all(l).then((function(e){r(e)}),i)}),i)}))},c.deleteSysMsg=function(e){var t,r=this,i=[];return u.isArray(e)||(e=[e]),o(e).call(e,(function(e){e=""+e,t=r.getOne("sysMsg","idServer",e,{remove:!0}),i.push(t)})),1===i.length?i[0]:n.all(i)},c.deleteAllSysMsgs=function(){var e=this.clearTable("sysMsg"),t=this.clearTable("sysMsgUnread");return n.all([e,t])},c.getSysMsgUnread=function(){return this.getAll("sysMsgUnread").then((function(e){var t={};return o(e).call(e,(function(e){t[e.type]=e.num})),t}))},c.updateSysMsgUnread=function(e){var t,r=this;e=u.copy(e);var n=[];return o(t=s(e)).call(t,(function(t){n.push({type:t,num:e[t]})})),this.put("sysMsgUnread",n).then((function(){return r.logger.info("db::updateSysMsgUnread: ",e),e}))}},function(e,t,r){var n=r(4),i=r(3),o=r(52).fn,a=r(0);a.notundef,o.putBroadcastMsg=function(e){var t=this;return new n((function(r){a.isArray(e)||(e=[e]);var n=[],o=e.length;function s(){0==--o&&r(n)}i(e).call(e,(function(e){e=a.copy(e),t.put("broadcastMsg",e).then((function(e){n.push(e[0]),s()}),s)}))}))},o.getBroadcastMsgs=function(e){return e=e||{},this.getAll("broadcastMsg",e)}},function(e,t,r){var n=r(4),i=r(5),o=r(10),a=r(29),s=r(3),c=r(52).fn,u=r(0),l=u.notundef;c.putSession=function(e){var t=this,r=e.unread;return void 0===(e=u.merge({},e)).updateTime&&e.lastMsg&&e.lastMsg.time&&(e.updateTime=e.lastMsg.time),(e.lastMsg||!e.ack&&!e.msgReceiptTime)&&(e.isDeleted=!1),delete e.unread,this.modifyOrPut({table:"session",obj:e,key:"id",modifyObjWhenPut:{unread:0}}).catch((function(i){return t.notifyError&&t.notifyError(i),e.unread=r,n.resolve(e)}))},c.getAllSessions=function(){return this.getAll("session",{index:"updateTime",desc:!0}).catch((function(e){self.notifyError&&self.notifyError(e)}))},c.getSessions=function(e){var t=!i(e=e||{}),r=e.limit||100,n=e.lastSessionId,o=e.sessionId,a=!1,s=this,c=function(){return!0},u=function(){return!0};return l(o)?this.getSession(o,e.isDeleted):(l(n)&&(c=function(e){return e.id===n&&(a=!0),a}),e.includeDeleted||(u=function(e){return!e.isDeleted}),this.getAll("session",{index:"updateTime",desc:t,limit:r,filter:function(e){return c(e)&&u(e)}}).catch((function(e){s.notifyError&&s.notifyError(e)})))},c.getSession=function(e,t){var r=this;return this.get("session",e).then((function(e){return n.resolve(!t&&e&&e.isDeleted?void 0:e)})).catch((function(e){r.notifyError&&r.notifyError(e)}))},c.updateSession=function(e){var t=this,r=e.id,n=u.filterObj(e,"ack unread lastMsg localCustom msgReceiptTime msgReceiptServerTime isTop topCustom isDeleted");return e.lastMsg&&(n.lastMsg=e.lastMsg),this.getOne("session",null,r,{modifyObj:n}).then((function(e){if(e){var i,a=o(i="db::updateSession: ".concat(r," ")).call(i,u.pickAsString(n,["ack","unread","msgReceiptTime","msgReceiptServerTime","isTop","isDeleted"]));a+=n.lastMsg?" lastMsg.idClient:".concat(u.get(n,"lastMsg.idClient")):"",t.logger.info(a)}else t.logger.warn("db::updateSession: no record ".concat(r));return e})).catch((function(e){t.notifyError&&t.notifyError(e)}))},c.getStickTopSessions=function(){var e=this;return this.getAll("session",{filter:function(e){return e&&e.isTop}}).catch((function(t){e.notifyError&&e.notifyError(t)}))},c.deleteSession=function(e){return this.remove("session",e)},c.deleteSessionLogic=function(e){var t=this;if(!a(e))return this.getOne("session",null,e,{modifyObj:{isDeleted:!0}});var r=[];return s(e).call(e,(function(e){r.push(t.getOne("session",null,e,{modifyObj:{isDeleted:!0}}))})),n.all(r)},c.putSessionsWithMoreRoaming=function(e){return this.put("sessionsWithMoreRoaming",e)},c.updateSessionsWithMoreRoaming=function(e){var t=e.id;return delete e.id,this.getOne("sessionsWithMoreRoaming",null,t,{modifyObj:e})},c.deleteSessionsWithMoreRoaming=function(e){return this.remove("sessionsWithMoreRoaming",e)},c.getSessionsWithMoreRoaming=function(e){return e?this.get("sessionsWithMoreRoaming",e):this.getAll("sessionsWithMoreRoaming")}},function(e,t,r){var n=r(10),i=r(511),o=r(512),a=r(0).throttle,s=function(){function e(t){i(this,e),this.arr=[],this.timer=null,this.maxLength=t.maxLength||100,this.throttleTime=t.throttleTime||5e3,this.processFn=t.processFn||function(){},this.throttleFn=t.processFn||function(){},t.processFn&&(this.throttleFn=a((function(e){t.processFn(e),e.length=0}),this.throttleTime,{leading:!1}))}return o(e,[{key:"add",value:function(e){var t;"[object Array]"===Object.prototype.toString.call(e)?this.arr=n(t=this.arr).call(t,e):this.arr.push(e),this.arr.length>=this.maxLength&&(this.processFn(this.arr),this.arr=[]),this.timer=this.throttleFn(this.arr)}},{key:"destroy",value:function(){this.arr=[],this.timer&&clearTimeout(this.timer),this.processFn=function(){},this.throttleFn=function(){}}},{key:"clear",value:function(){this.arr=[],this.timer&&clearTimeout(this.timer)}}]),e}();e.exports=s},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(212);function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),n(e,i.key,i)}}e.exports=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(24),i=r(10),o=r(16),a=r(4),s=r(23),c=r(3),u=r(6),l=r(11),d=r(51),p=r(118),f=r(114),h=r(93),m=r(30).fn,g=r(17),v=r(54),y=r(0),b=r(55);function S(e,t){var r,i,a,d=this;d.socketUrls=[],v.updateUniSuccCache("login",{operation_type:"HTTP",target:t}),d.msgStatEnable=!!e.common["msg.stat.enable"],d.msgStatEnable&&(d.msgDelayTimer=n(s(a=d.doReportMsgDelay).call(a,d),1e4)),c(r=e.common.link).call(r,(function(e){d.socketUrls.push(g.formatSocketUrl({url:e,secure:d.options.secure}))})),c(i=e.common["link.default"]).call(i,(function(e){var t;e=g.formatSocketUrl({url:e,secure:d.options.secure}),-1===u(t=d.socketUrls).call(t,e)&&d.socketUrls.push(e)}));try{g.uploadUrl=e.nosup[0]}catch(e){}if(g.chunkUploadUrl=g.chunkUploadUrl||e["nos-chunk"]||"",d.logger.info("link::refreshSocketUrl: ".concat(o(t).call(t,0,-32)," ajax load , got socket urls "),d.socketUrls),d.connectToUrl(d.getNextSocketUrl()),g.hasLocalStorage){e.common["lbs.backup"]&&d.options.lbsBackup&&localStorage.setItem("nim_lbs_backup",l(e.common["lbs.backup"]));var p=y.get(e,"common.report.apierror.on");e.common.report&&localStorage.setItem("nim_lbs_fail_report_on",!1===p?"0":"1");var f=y.get(e,"common.report.apierror.threshold.time");f&&localStorage.setItem("nim_lbs_fail_report_time",f)}}m.probeIp=function(){var e=this,t=g.ipProbeAddr,r=0,i=-1;function o(t){2==++r&&(r=-1,e.doRefreshSocketUrl(i))}b(t.ipv4,{timeout:2e3,onerror:o,onload:function(e){i++,o()}}),b(t.ipv6,{timeout:2e3,onerror:o,onload:function(e){i+=2,o()}}),n((function(){r||-1===i||(r=-1,e.doRefreshSocketUrl(i))}),100)},m.refreshSocketUrl=function(){g.isWeixinApp?this.doRefreshSocketUrl(2):2===this.options.ipVersion?this.probeIp():this.doRefreshSocketUrl(this.options.ipVersion)},m.doRefreshSocketUrl=function(e){var t=this,r=t.options.lbsUrl;1!==e&&2!==e&&(e=0),g.ipVersion=e;var n=(new Date).getTime();this.doRequestLbs(r).then((function(e){S.call(t,e,r)})).catch((function(e){if(t.logger.error("link::refreshSocketUrl: ".concat(r," ajax lbs error"),e),w.call(t,r,e,n),t.options.lbsBackup){var o=t.options.lbsBackupUrlsCustomer||[],a=[];g.hasLocalStorage&&(a=(a=localStorage.getItem("nim_lbs_backup"))?JSON.parse(a):[]);var s=i(a).call(a,o);(function(e){var t=this;if(!(e&&e.length>0))return v.updateUniErrCache("login",{operation_type:"HTTP",error:"no backup lbs"}),void x.call(t);t.logger.info("doRequestBackupLbsUrls: use backup lbs url",e);var r=0,n=0,i=!1,o=h((function(){if(r>=e.length)return o&&clearInterval(o),void t.logger.warn("doRequestBackupLbsUrls backup lbs all tried");var a=e[r++],s=(new Date).getTime();t.doRequestLbs(a).then((function(e){o&&clearInterval(o),!1===i&&S.call(t,e,a),i=!0})).catch((function(r){n++,t.logger.error("doRequestBackupLbsUrls: ".concat(a," ajax lbs error"),r),w.call(t,a,r,s),n>=e.length&&(o&&clearInterval(o),t.logger.warn("doRequestBackupLbsUrls: backup lbs all failed"),x.call(t))}))}),2e3)}).call(t,s)}else x.call(t)}))},m.doRequestLbs=function(e){var t=this.options,r=g.info;return e=e+y.genUrlSep(e)+"id="+t.account+"&sv="+r.sdkVersion+"&pv="+r.protocolVersion+"&networkType="+g.ipVersion+"&k="+t.appKey,this.logger.info("doRequestLbs ".concat(o(e).call(e,0,-32))),new a((function(t,r){g.isWeixinApp?wx.request({url:e,success:function(e){var n=e&&e.statusCode,i=e&&e.data;200===n?t(i):r(i)},fail:function(e){r(e)}}):b(e,{proxyUrl:y.url2origin(e)+"/lbs/res/cors/nej_proxy_frame.html",timeout:g.xhrTimeout,onload:function(e){t(JSON.parse(e))},onerror:function(e){r(e)}})}))};var _=[],M=null;if(g.hasLocalStorage){var T=localStorage.getItem("nim_lbs_fail_report_time");T=T?d(T):6e4,M=y.throttle((function(){if(_.length>0){var e=l(_);b("https://statistic.live.126.net/statics/report/im/api/error",{method:"POST",timeout:2e3,headers:{"Content-Type":"application/json"},data:e,onload:function(){},onerror:function(){var t,r=i(t=JSON.parse(e)).call(t,_);_=p(r).call(r,(function(e,t){return f(e).call(e,(function(e){return e.request_url===t.url&&e.error_code===t.code}))||e.push(t),e}),[])}}),_=[]}}),T,{leading:!1})}function w(e,t,r){var n=(new Date).getTime(),i=t.status||10001;v.updateUniErrCache("login",{operation_type:"HTTP",target:e}),this.api.reportLogs({event:"nimlb",code:3001}),f(_).call(_,(function(t){return t.request_url===e&&t.error_code===i}))||_.push({request_url:e,appkey:this.options.appKey,accid:this.options.account,timestamp:n,error_code:i,platform:"web",send_time:n-r}),g.hasLocalStorage&&"0"!==localStorage.getItem("nim_lbs_fail_report_on")&&M&&M()}function x(){var e=g.getDefaultLinkUrl(this.options.secure);e?(this.logger.warn("link::refreshSocketUrl: use default link url",e),this.connectToUrl(e)):this.onDisconnect("link::refreshSocketUrl")}},function(e,t,r){var n=r(4),i=r(11),o=r(24),a=r(23),s=r(51),c=r(6),u=r(3),l=r(19),d=r(30).fn,p=r(143),f=r(17),h="NIM-AllGrayscaleConfig",m="NIM-AllMixStorePolicy";function g(){var e=this;if(f.hasLocalStorage&&localStorage.getItem(m)){var t=null;try{t=JSON.parse(localStorage.getItem(m))[e.options.appKey]}catch(t){e.logger.error("mixStorePolicy error",t)}t&&(e.mixStorePolicy=t.timeStamp+1e3*t.ttl>(new Date).getTime()?t:null,e.mixStorePolicy&&t.ttl&&0!==t.ttl&&(e.mixStorePolicyClock=o(a(g).call(g,e),1e3*t.ttl)))}e.mixStorePolicy||e.sendCmd("getMixStorePolicy",{providers:e.options.providers&&e.options.providers.s3?[1,2]:[1]},(function(t,r){if(t){e.logger.error("Calculate Delay time, getMixStorePolicy error",t);try{r=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[e.options.appKey]}catch(t){e.logger.error("error:","get last mixStorePolicy failed",t)}}else if(r){var n=r;if(n.ttl=Number(n.ttl),n.providers=n.providers.split(","),n.nosPolicy=n.nosPolicy?JSON.parse(n.nosPolicy):null,n.s3Policy=n.s3Policy?JSON.parse(n.s3Policy):null,n.timeStamp=(new Date).getTime(),e.mixStorePolicy=n,n.ttl&&0!==n.ttl&&(e.mixStorePolicyClock=o(a(g).call(g,e),1e3*n.ttl)),f.hasLocalStorage){var s=localStorage.getItem(m)?JSON.parse(localStorage.getItem(m)):{};s[e.options.appKey]=n,localStorage.setItem(m,i(s))}}else e.logger.error("Calculate Delay time, mixStorePolicy error",r)}))}d.assembleLogin=function(){var e=this.assembleIMLogin();return this.addPushInfo instanceof Function?this.addPushInfo(e):n.resolve({login:e})},d.afterLogin=function(){var e=this,t=this;t.sendCmd("getNosCdnHost",{});var r=(new Date).getTime();t.sendCmd("getServerTime",{},(function(e,n){if(e)t.logger.error("Calculate Delay time, getServerTime error",e);else if(n){var i=(new Date).getTime(),o=(i-r)/2,a=n.getTime?n.getTime():n;t.relativeSeverTime=s(i-a-o)}else t.logger.warn("Calculate Delay time, getServerTime not correct")})),function(){var e=this;if(f.hasLocalStorage&&localStorage.getItem(h)){var t=null;try{t=JSON.parse(localStorage.getItem(h))[e.options.appKey]}catch(t){e.logger.error("appGrayConfig error",t)}t&&(e.appGrayConfig=t.timeStamp+1e3*t.ttl>(new Date).getTime()?t:null,e.appGrayConfig&&g.apply(e))}e.appGrayConfig||e.sendCmd("getGrayscaleConfig",{providers:""},(function(t,r){if(t)e.logger.error("Calculate Delay time, getGrayscaleConfig error",t);else if(r){var n=r;if(n.grayConfig=JSON.parse(n.grayConfig),n.ttl=Number(n.ttl),n.timeStamp=(new Date).getTime(),e.appGrayConfig=n,f.hasLocalStorage){var o=localStorage.getItem(h)?JSON.parse(localStorage.getItem(h)):{};o[e.options.appKey]=n,localStorage.setItem(h,i(o))}g.apply(e)}else e.logger.error("Calculate Delay time, getGrayscaleConfig error",r)}))}.apply(this),this.initPush instanceof Function&&this.initPush();var n=this.db;if(n.enable){var o=this.account;this.options.appendAppKeyForDBName&&(o+="-"+this.options.appKey),this.db.init(o).then((function(){e.notifyLogin(),e.syncData()}),(function(t){e.logger.warn("link::afterLogin: no db",t),n.reset(!1),e.notifyLogin(),e.syncData()}))}else this.logger.info("link::afterLogin: no db"),this.notifyLogin(),this.syncData()},d.getFileAuthToken=function(e){var t=this,r=t.mixStorePolicy.nosPolicy.authPolicy.policyType;-1!==r?c(r).call(r,e.type)<0?t.logger.error("this type Token error not support"):3!=e.type||e.urls&&e.urls.length?t.sendCmd("getBackSourceToken",{mixAuthTokenReq:e},(function(r,n){if(r)return t.logger.error("getBackSourceToken error",r),r;e.done&&e.done(n)})):t.logger.error("urls is Required when type 3"):t.logger.error("don't need token")},d.processAuth=function(e){switch(e.cmd){case"login":e.error||(e.content=e.content||{},this.loginAndroidPush&&this.loginAndroidPush(e.content.aosPushInfo||{}),e.obj=e.content.loginRes,this.connectionId=e.content.loginRes.connectionId,this.onLoginPortsChange(e,2));break;case"kicked":return void this.onKicked(e);case"multiPortLogin":this.onLoginPortsChange(e,e.content.state);break;case"kick":e.error||(e.obj.deviceIds=e.content.deviceIds)}},d.onLoginPortsChange=function(e,t){var r=this,n=e.content.loginPorts;if(n&&n.length){var i=!0;switch(t){case 2:i=!0;break;case 3:i=!1}u(n).call(n,(function(e){e.type=p.reverseType(e.type),e.customClientType&&(e.customClientType=+e.customClientType),e.time=+e.time,e.online=i})),(n=l(n).call(n,(function(e){return e.connectionId!==r.connectionId}))).length&&(r.logger.info("link::onLoginPortsChange:",n),r.options.onloginportschange(n))}},d.kickedReasons=["","samePlatformKick","serverKick","otherPlatformKick","silentlyKick"],d.kickedMessages=["","不允许同一个帐号在多个地方同时登录","被服务器踢了","被其它端踢了","悄悄被踢"]},function(e,t,r){var n=r(150),i=r(4),o=r(23),a=r(3),s=r(9),c=r(104),u=r(10),l=r(19),d=r(6),p=r(8),f=r(516),h=r(77),m=r(521),g=r(24),v=r(78),y=r(30).fn,b=r(0),S=r(33),_=b.undef,M=b.objs2ids,T=b.objs2accounts,w=b.teams2ids,x=r(144),I=b.getGlobal();y.beforeSync=function(){var e=this.db;return e.enable?e.clearSendingMsgs():i.resolve()},y.syncData=function(){var e=this,t=e.db,r=e.options,n=t.enable;function i(t){var i;e.syncPromiseArray=[],e.syncResult={},e.syncTeamMembersPromiseArray=[],e.syncSuperTeamMembersPromiseArray=[],e.syncTeamMembersResult={},e.checkNosReqNum=0,e.getNosOriginUrlReqNum=0,b.verifyBooleanWithDefault(r,"syncRelations syncFriends syncFriendUsers syncTeams syncSuperTeams syncRoamingMsgs syncSuperTeamRoamingMsgs syncMsgReceipts syncExtraTeamInfo",!0,"","sync::syncData"),b.verifyBooleanWithDefault(r,"syncFilter syncTeamMembers syncSuperTeamMembers",!1,"","sync::syncData");var a={};t=t||{},I._nimForceSyncIM&&(e.logger.warn("sync::syncData: nimForceSyncIM"),delete t.teams,I._nimForceSyncIM=!1),a.myInfo=t.myInfo||0,a.deleteMsgSelf=t.deleteMsgSelf||0,a.offlineMsgs=0,r.syncRelations&&(a.relations=t.relations||0),r.syncFriends&&(a.friends=t.friends||0),r.syncFriendUsers&&(a.friendUsers=t.friendUsers||0),r.syncRobots&&(a.robots=t.robots||0),r.syncTeams&&(a.teams=t.teams||0),r.syncSuperTeams&&(a.superTeams=t.superTeams||0),r.syncStickTopSessions&&(a.stickTopSessions=t.stickTopSessions||0),r.syncSessionUnread&&(a.sessionAck=n&&t.sessionAck||0,a.superTeamSessionAck=n&&t.superTeamSessionAck||0),r.syncRoamingMsgs&&(a.roamingMsgs=n&&t.roamingMsgs||0),r.syncSuperTeamRoamingMsgs&&(a.superTeamRoamingMsgs=n&&t.superTeamRoamingMsgs||0),r.syncMsgReceipts&&(a.msgReceipts=t.msgReceipts||0),r.syncExtraTeamInfo&&(a.myTeamMembers=t.myTeamMembers||0),r.syncBroadcastMsgs&&(a.broadcastMsgs=t.broadcastMsg||0),a.donnop=t.donnop||0,a.deleteMsg=t.deleteMsg||0,a.deleteSuperTeamMsg=t.deleteSuperTeamMsg||0,a.sessionHistoryMsgsDelete=t.sessionHistoryMsgsDelete||0,a.netcallMsgs=0,r.syncFilter&&(a.filterMsgs=0);var s=o(i=e.onSyncData).call(i,e);s.isImSyncDataCb=!0,e.logger.info("syncData:: start sync",a),e.sendCmd("sync",{sync:a,isImSyncDataObj:!0},s)}e.syncing=!0,n?e.beforeSync().then((function(){return e.db.getTimetags()})).then((function(e){i(e)}),(function(){i()})):i(e.timetags)},y.onSyncData=function(e,t){e&&this.syncRetryTimes>3&&(this.syncRetryTimes=0,e.callFunc="sync::onSyncData",this.onCustomError("SYNC_DATA_ERROR",e))},y.processSync=function(e){switch(this.syncRetryTimes=this.syncRetryTimes||0,this.syncRetryTimes++,e.cmd){case"syncDone":e.error?this.syncRetryTimes>3||this.syncData():(this.timetags.sync=e.content.timetag,this.onSyncDone());break;case"syncTeamMembersDone":this.onSyncTeamMembersDone()}},y.onSyncDone=function(e){var t,r,o,y,I,E,A,C,k,O,N,R,P,D,j,L,z,U,B,F,V,H,$,W,Y,G,Q,q=this,J=q.db,Z=J.enable,K=q.options,X=q.syncPromiseArray,ee=q.syncResult;function te(){if(X){q.logger.info("sync::onSyncDone: after sync",b.promises2cmds(X)),X=[],r=ee.blacklist||[],o=ee.invalidBlacklist||[],y=ee.mutelist||[],I=ee.invalidMutelist||[],E=ee.friends,A=ee.invalidFriends||[],C=ee.myInfo,k=ee.users,N=ee.superTeams,P=ee.invalidSuperTeams,O=ee.teams,R=ee.invalidTeams||[],D=ee.sessions||{},j=ee.ackMap,ee.msgReceipts,L=ee.roamingMsgs,z=ee.offlineMsgs,U=ee.offlineFilterMsgs,F=ee.offlineSysMsgs,V=ee.offlineCustomSysMsgs,H=ee.offlineFilterSysMsgs,$=ee.offlineFilterCustomSysMsgs,ee.broadcastMsgs,W=ee.sysMsgUnread,Y=ee.sessionsWithMoreRoaming,Q=ee.clearServerHistoryMsgs||[];var e=i.resolve();!function(){if(Z){var t,r=[re()];D&&a(t=s(D)).call(t,(function(e){r.push(J.putSession(D[e]))})),e=i.all(r).then((function(){var e,t=u(e=[]).call(e,n(s(j||{})),n(s(D||{})));t=l(t).call(t,(function(e,t,r){return d(r).call(r,e)===t}));var r=[];return a(t).call(t,(function(e){var t,n=D[e];(n.lastMsg||n.ack)&&(t=(t=n.ack?i.resolve(n):J.getSession(n.id)).then((function(t){var r=t.ack||0;return J.getMsgCountAfterAck({shouldCountNotifyUnread:q.options.shouldCountNotifyUnread,sessionId:e,ack:r}).then((function(r){return t.unread=r||0,D[e]=q.mergeSession(t),J.updateSession(t)}))})),r.push(t))})),i.all(r)})).then((function(){var e=[];return q.saveAck.p2pTeam&&e.push(J.updateSessionAck(q.saveAck.p2pTeam).catch((function(e){return q.logger.error("sessionAck::syncSessionAck::updatetimetag db",e),i.reject(e)}))),q.saveAck.superTeam&&e.push(J.updateSuperTeamSessionAck(q.saveAck.superTeam).catch((function(e){return q.logger.error("sessionAck::syncSuperTeamSessionAck::updatetimetag db",e),i.reject(e)}))),i.all(e)}))}else if(D){var o,c,p;a(o=[L,z]).call(o,(function(e){e&&a(e).call(e,(function(e){var t;(c=D[e.sessionId]).unread=c.unread||0,c.unreadMsgs=c.unreadMsgs||[],p=c.ack||0,a(t=e.msgs).call(t,(function(e){p>=e.time||("notification"===e.type?q.options.shouldCountNotifyUnread(e)&&c.unread++:"in"===e.flow&&!1!==e.isUnreadable&&(c.unread++,c.unreadMsgs.push(e)))})),q.mergeSession(c)}))}))}}(),e.then((function(){if(Z&&!q.hasSynced)q.hasSynced=!0,K.syncRelations&&(t=J.getRelations().then((function(e){r=e[0],y=e[1],r.invalid=o,y.invalid=I})).catch((function(e){return e._msg="on relations error",q.logger.error("sync::syncRelation: ",e),i.reject(e)})),X.push(t)),K.syncFriends&&(t=J.getFriends().then((function(e){(E=e).invalid=A})).catch((function(e){return e._msg="on friends error",q.logger.error("sync::syncFriends: ",e),i.reject(e)})),X.push(t)),_(C)&&(t=J.getUser(q.account).then((function(e){C=e})).catch((function(e){return e._msg="on myInfo error",q.logger.error("sync::syncMyInfo: ",e),i.reject(e)})),X.push(t)),K.syncFriendUsers&&(t=J.getFriends().then((function(e){return p(e).call(e,(function(e){return e.account}))})).then((function(e){return J.getUsers(e)})).then((function(e){k=e})).catch((function(e){return e._msg="on users error",q.logger.error("sync::syncFriendUser: ",e),i.reject(e)})),X.push(t)),K.syncTeams&&(t=J.getTeams().then((function(e){(O=e).invalid=R})).catch((function(e){return e._msg="on teams error",q.logger.error("sync::syncTeams: ",e),i.reject(e)})),X.push(t)),K.syncSuperTeams&&(t=J.getSuperTeams().then((function(e){(N=e).invalid=P})).catch((function(e){return e._msg="on superteams error",q.logger.error("sync::syncSuperTeams: ",e),i.reject(e)})),X.push(t)),t=J.getTeamMembersByAccount(q.account).then((function(e){q.mergeMyTeamMembers(e)})).catch((function(e){return q.logger.error("sync::getTeamMembersByAccount: ",e),i.reject(e)})),X.push(t),t=J.getDonnop().then((function(e){q.mergeDonnop(e)})).catch((function(e){return q.logger.error("sync::donnop: ",e),i.reject(e)})),X.push(t),t=J.getAllSessions().then((function(e){D=e})).catch((function(e){return q.logger.error("sync::getSession: ",e),i.reject(e)})),X.push(t),t=J.getSysMsgUnread().then((function(e){W=e})).catch((function(e){return e._msg="on sysMsgUnread error",q.logger.error("sync::getSysMsgUnread: ",e),i.reject(e)})),X.push(t),X.push(J.getSessionsWithMoreRoaming().then((function(e){Y=e})));else{var e,n,u=[];a(e=s(D)).call(e,(function(e){(n=D[e]).lastMsg&&u.push(n)})),D=c(u).call(u,(function(e,t){return t.updateTime-e.updateTime}))}i.all(X).then(ne).then(ie,(function(e){q.logger.error("taskAfterSync syncDBDataPromise error:",e),e.callFunc="sync::onSyncDone",e.message="taskAfterSync syncDBDataPromise 出错",q.onCustomError("SYNC_SESSION_ACK_ERROR",e)}))}))}else q.logger.warn("sync::onSyncDone: after sync --no promiseArray")}function re(){var e=[];return L&&a(L).call(L,(function(t){var r;e=u(r=[]).call(r,n(e),n(t.msgs))})),z&&a(z).call(z,(function(t){var r;e=u(r=[]).call(r,n(e),n(t.msgs))})),e.length?J.putMsg(e).then((function(){return e})):i.resolve(e)}function ne(){q.logger.info("sync::onSyncDone: taskAfterSync"),function(){if(ee.deleteMsgSysMsgs){var e,t={};L&&a(L).call(L,(function(e){t[e.sessionId]=e}));var r={};z&&a(z).call(z,(function(e){r[e.sessionId]=e}));var i=q.api;if(a(e=ee.deleteMsgSysMsgs).call(e,(function(e){var n;a(n=e.sysMsgs).call(n,(function(n){var o=n.msg,a=o.sessionId;"roaming"===e.type&&t[a]?t[a].msgs=i.cutMsgs(t[a].msgs,o):r[a]&&(r[a].msgs=i.cutMsgs(r[a].msgs,o))}))})),!J.enable){var o,s=u(o=[]).call(o,n(L||[]),n(z||[]));a(s).call(s,(function(e){if(e.msgs.length){var t=q.genSessionByMsgs(e.msgs);q.cacheSyncedSession(t),D.unshift(t)}else{var r=f(D).call(D,(function(t){return t.id===e.sessionId}));h(D).call(D,r,1)}}));var l={};a(D).call(D,(function(e){if(l[e.id]){var t=e.lastMsg.time>l[e.id].lastMsg.time?e.lastMsg:l[e.id].lastMsg;l[e.id]=e,l[e.id].lastMsg=t}else l[e.id]=e})),D=m(l),D=c(D).call(D,(function(e,t){return t.updateTime-e.updateTime}))}}}(),G=q.syncResult.stickTopSessions||[],a(G).call(G,(function(e,t){G[t]=q.mergeSession(e)}));var e=[q.deleteMsgOfflineRoaming(ee.deleteMsgSysMsgs,D)];return Q&&a(Q).call(Q,(function(t){e.push(function(e,t){var r;q.logger.info("sync::taskAfterSync:sessionHistoryMsgsDelete ".concat(e)),t=t||(new Date).getTime();var n=l(D).call(D,(function(t){return t.id===e}));r=q.findSession(e)||n[0];var o=!1!==K.rollbackClearMsgsUnread,a=[];return J.enable&&a.push(J.deleteMsgsBySessionId({sessionId:e,end:t})),o&&r&&(r.lastMsg=null,r.unread=0,r=q.mergeSession(r),J.enable&&a.push(J.updateSession(r))),i.all(a)}(t.sessionId,t.time))})),i.all(e)}function ie(){g(oe,0)}function oe(){var e,t,n=[],o=[];r&&r.length&&(q.logger.info("sync::notifyDataAsync: on blacklist",T(r)),K.onblacklist(r)),y&&y.length&&(q.logger.info("sync::notifyDataAsync: on mutelist",T(y)),K.onmutelist(y)),E&&(q.logger.info("sync::notifyDataAsync: on friends",T(E)),K.onfriends(E)),C&&(q.logger.info("sync::notifyDataAsync: on myInfo"),q.myInfo=C,K.onmyinfo(b.copy(C))),k&&(a(k).call(k,(function(e){q.mergeUser(e)})),q.logger.info("sync::notifyDataAsync: on users",T(k)),K.onusers(k)),O&&(q.logger.info("sync::notifyDataAsync: on teams",w(O)),K.onteams(O)),N&&(q.logger.info("sync::notifyDataAsync: onSuperTeams",w(N)),K.onSuperTeams(N)),D&&D.length&&(D=l(D).call(D,(function(e){return q.mergeSession(e),!e.isDeleted&&(v(x).call(x,e),!0)})),q.logger.info("sync::notifyDataAsync: on sessions",M(D),b.secureOutput("session",D)),K.onsessions(D)),G&&G.length&&(a(G).call(G,(function(e){q.mergeSession(e),v(x).call(x,e)})),q.logger.info("sync::notifyDataAsync: onStickTopSessions",M(G),b.secureOutput("session",G)),K.onStickTopSessions(G)),L&&a(L).call(L,(function(e){"superTeam"===e.scene?o.push(e.timetag):n.push(e.timetag),(t=e.msgs).length&&(q.logger.info("sync::notifyDataAsync: on roaming msgs",e.sessionId,t.length),K.onroamingmsgs(e))})),z&&a(z).call(z,(function(e){"superTeam"===e.scene?o.push(e.timetag):n.push(e.timetag),(t=e.msgs).length&&(q.logger.info("sync::notifyDataAsync: on offline msgs",e.sessionId,t.length,p(t).call(t,(function(e){return e.idServer}))),K.onofflinemsgs(e))})),U&&a(U).call(U,(function(e){n.push(e.timetag),(t=e.msgs).length&&(q.logger.info("sync::notifyDataAsync: on offline filter msgs",e.sessionId,t.length),K.onofflinefiltermsgs(t))})),Y&&(q.logger.info("sync::notifyDataAsync: on sessionsWithMoreRoaming",M(Y),Y),K.onSessionsWithMoreRoaming(Y));var s,c=[],d=[];ee.deleteMsgSysMsgs&&a(s=ee.deleteMsgSysMsgs).call(s,(function(e){"roaming"===e.type?c=u(c).call(c,e.sysMsgs):d=u(d).call(d,e.sysMsgs)})),c.length&&(B=u(B=B||[]).call(B,c)),d.length&&(F=u(F=F||[]).call(F,d)),B&&(q.logger.info("sync::notifyDataAsync: on roaming sys msgs",B.length),K.onroamingsysmsgs(B)),F&&(q.logger.info("sync::notifyDataAsync: on offline sys msgs",F.length),K.onofflinesysmsgs(F)),H&&(q.logger.info("sync::notifyDataAsync: on offline filter sys msgs",H.length),K.onofflinefiltersysmsgs(H)),V&&(q.logger.info("sync::notifyDataAsync: on offline custom sys msgs",V.length),K.onofflinecustomsysmsgs(V)),$&&(q.logger.info("sync::notifyDataAsync: on offline filter custom sys msgs",$.length),K.onofflinefiltercustomsysmsgs($)),W&&(W=b.merge({},q.sysMsgUnread,W),q.sysMsgUnread=b.merge({},W),q.logger.info("sync::notifyDataAsync: on sysMsgUnread",W),K.onsysmsgunread(W));var f=q.getPushNotificationMultiportConfig();q.logger.info("sync::notifyDataAsync: on pushNotificationMultiportConfig",f),K.onPushNotificationMultiportConfig(f);var h=o.length&&Math.max.apply(Math,o);if(e=n.length&&Math.max.apply(Math,n),J.enable){var m=[];h&&m.push(q.db.updateSuperTeamRoamingMsgTimetag(h)),e&&m.push(q.db.updateRoamingMsgTimetag(e)),i.all(m).then(ae).catch(ae)}else q.timetags.superTeamRoamingMsgs=h,q.timetags.roamingMsgs=e,ae();q.syncPromiseArray=[],q.syncResult={}}function ae(){if(q.processUnsettledMsgs(),q.processUnsettledSysMsgs(),q.syncing&&K.onsyncdone(),q.syncing=!1,K.syncTeamMembers&&O&&O.length)throw new S("sync team members api deprecated!")}X&&X.length?i.all(X).then(te).catch((function(e){te(),q.logger.error(e),e.callFunc="sync::onSyncDone",e.message="afterSync syncNormalPromise 出错",q.onCustomError("SYNC_promiseArray_ERROR",e)})):te()},y.syncTeamMembers=function(e){var t,r,n=this;r={},a(e).call(e,(function(e){r[e.teamId]=0}),n),n.sendCmd("syncTeamMembers",{sync:r},o(t=n.onSyncTeamMembers).call(t,n))},y.onSyncTeamMembers=function(e,t){e.callFunc="sync::onSyncTeamMembers",e.message="同步群成员错误",this.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)},y.onSyncTeamMembersDone=function(){var e,t=this,r=t.db,n=t.options,o=t.syncTeamMembersResult,c=t.syncTeamMembersPromiseArray;function u(){t.logger.log("sync::onSyncTeamMembersDone: afterSync",b.promises2cmds(c)),c=[],r.enable&&!t.hasSyncedTeamMembers?(t.hasSyncedTeamMembers=!0,function(){if(!n.syncTeams||!n.syncTeamMembers)return f();r.getTeams().then((function(r){a(r).call(r,(function(r){var n=r.teamId;e=new i((function(e,r){t.api.getTeamMembers({teamId:n,done:function(t,i){t&&r({callFunc:"sync::getTeamMembers: teamId-".concat(n),message:"sync team members error"}),o[n]=i.members||[],e()}})})),c.push(e)})),c.length?i.all(c).then(l,(function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="pullFullData promiseArray notifyData 错误",t.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)})):l()}),(function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="pullFullData getTeams 错误",t.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)}))}()):l()}function l(){g(p,0)}function p(){var e,r,i;a(e=s(o)).call(e,(function(e){-1===d(e).call(e,"invalid")&&(r=o[e],i=o[e+"-invalid"]||[],r.invalid=i,function(e,r){t.logger.info("sync::onSyncTeamMembersDone: onTeamMembers",e,T(r),r),n.onteammembers({teamId:e,members:r})}(e,r))})),f()}function f(){t.logger.info("sync::onSyncTeamMembersDone: bingo"),n.onsyncteammembersdone(),t.syncTeamMembersResult=null,t.syncTeamMembersPromiseArray=null}c.length?i.all(c).then(u,(function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="同步群成员 syncTeamMembersPromiseArray 错误",t.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)})).catch((function(e){t.logger.log("sync::onSyncTeamMembersDone: syncTeamMembersPromiseArray promise ",e),u()})):u()}},function(e,t,r){e.exports=r(517)},function(e,t,r){var n=r(518);e.exports=n},function(e,t,r){var n=r(15),i=r(519),o=Array.prototype;e.exports=function(e){var t=e.findIndex;return e===o||n(o,e)&&t===o.findIndex?i:t}},function(e,t,r){r(520);var n=r(22);e.exports=n("Array").findIndex},function(e,t,r){var n=r(2),i=r(79).findIndex,o=r(148),a=!0;"findIndex"in[]&&Array(1).findIndex((function(){a=!1})),n({target:"Array",proto:!0,forced:a},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("findIndex")},function(e,t,r){e.exports=r(522)},function(e,t,r){var n=r(523);e.exports=n},function(e,t,r){r(524);var n=r(12);e.exports=n.Object.values},function(e,t,r){var n=r(2),i=r(525).values;n({target:"Object",stat:!0},{values:function(e){return i(e)}})},function(e,t,r){var n=r(26),i=r(7),o=r(91),a=r(35),s=i(r(111).f),c=i([].push),u=function(e){return function(t){for(var r,i=a(t),u=o(i),l=u.length,d=0,p=[];l>d;)r=u[d++],n&&!s(i,r)||c(p,e?[r,i[r]]:i[r]);return p}};e.exports={entries:u(!0),values:u(!1)}},function(e,t,r){var n=r(8),i=r(5),o=r(4),a=r(3),s=r(30).fn,c=r(0),u=c.objs2accounts,l=r(527),d=r(154);s.processUser=function(e){var t,r=this,o=r.db,a=e.obj,s=e.error,c=e.content;switch(e.cmd){case"markInBlacklist":s||r.markInBlacklist(a);break;case"syncMarkInBlacklist":r.markInBlacklist(c,!0);break;case"markInMutelist":s||r.markInMutelist(a);break;case"syncMarkInMutelist":r.markInMutelist(c,!0);break;case"getRelations":s||r.onRelations(e);break;case"syncMyInfo":r.onMyInfo(e,!0);break;case"updateMyInfo":s||(a.updateTime=c.timetag,r.onUpdateMyInfo(e,a));break;case"syncUpdateMyInfo":r.onUpdateMyInfo(e,c.user,!0);break;case"getUsers":var u;s||(t=n(u=c.users).call(u,(function(e){return e=i(d).call(d,e,r.mixStorePolicy&&r.mixStorePolicy.s3Policy?r.mixStorePolicy.s3Policy.dlcdns:[],r.mixStorePolicy&&r.mixStorePolicy.s3Policy?r.mixStorePolicy.s3Policy.dlcdn:""),r.mergeUser(e),e})),e.obj=t,o.enable&&o.putUsers(t));break;case"updateDonnop":r.onUpdateDonnop(e);break;case"syncUpdateDonnop":r.onDonnop(e,!1)}},s.onMyInfo=function(e){var t,r=this,n=r.db,a=e.error,s=e.content,c=new o((function(e,o){var c,l;a?(a&&(a.callFunc="user::onMyInfo"),e(a),r.syncData()):(t=i(d).call(d,s.user),n.enable?(c=e,l=o,n.mergeMyInfo(t,!0).then((function(){u(),c()})).then(void 0,(function(e){e.message="db.mergeMyInfo error",e.callFunc="user::onMyInfo",l(e)}))):(u(),e()))})).catch((function(e){return r.logger.error("user::onMyInfo: ",e),o.reject(e)}));function u(){r.timetags.myInfo=t.updateTime,r.syncResult.myInfo=t}c.cmd="myInfo",r.syncPromiseArray.push(c)},s.onUpdateMyInfo=function(e,t,r){var n=this.db,o=i(d).call(d,t),a=c.merge(this.myInfo,o);this.myInfo=a,r?(this.logger.info("user::onUpdateMyInfo:",a&&a.account),this.options.onupdatemyinfo(a)):e.obj=a,n.enable&&(o.account=this.account,n.updateUser(o))},s.onRelations=function(e){var t,r=this,n=r.db,i=e.error,s=r.packetFromSync(e),c=e.content.specialRelations,d=!0,p=[],f=[],h=[],m=[],g=new o((function(g,y){var b,S;i?s&&(g(i),r.syncData()):(a(c).call(c,(function(e){var t={account:(e=l.parse(e)).account,createTime:e.createTime,updateTime:e.updateTime};e.isBlacked?p.push(t):f.push(t),e.isMuted?h.push(t):m.push(t)})),r.logger.info("user::onRelations: parse blacklist",u(p),p,"delete",u(f),f),r.logger.info("user::onRelations: parse mutelist",u(h),h,"delete",u(m),m),c.length?(d=!0,t=e.content.timetag):d=!1,n.enable?(b=g,S=y,e.promise=new o((function(e,i){function o(){s?(v(),e(),b()):n.getRelations().then((function(t){p=t[0],h=t[1],v(),e(),b()})).then(void 0,(function(e){e.message="db.getRelations error",e.callFunc="user::onRelations",i(e),S(e)}))}d?n.mergeRelations(p,f,h,m,t).then((function(){o()})).then(void 0,(function(e){e.message="db.mergeRelations error",e.callFunc="user::onRelations",i(e),S(e)})):(r.logger.warn("user::onRelations: no relations need merge"),o())})).then(void 0,(function(e){throw e.message="merge relations data error",e.callFunc="user::onRelations",S(e),e}))):(v(),g()))})).catch((function(e){return r.logger.error("user::onRelations: ",e),o.reject(e)}));function v(){r.timetags.relations=t,p.invalid=f,h.invalid=m,s?(r.syncResult.blacklist=p,r.syncResult.mutelist=h,r.syncResult.invalidBlacklist=f,r.syncResult.invalidMutelist=m):(r.logger.info("user::onRelations: get relations",p,h),e.obj.blacklist=p,e.obj.mutelist=h)}s&&(g.cmd="relations",r.syncPromiseArray.push(g))},s.markInBlacklist=function(e,t){var r=this.db;e.record={account:e.account,updateTime:+new Date},r.enable&&r.markInBlacklist(e),t&&(this.logger.info("user::markInBlacklist:",e),this.options.onsyncmarkinblacklist(e))},s.markInMutelist=function(e,t){var r=this.db;e.record={account:e.account,updateTime:+new Date},r.enable&&r.markInMutelist(e),t&&(this.logger.info("user::markInMutelist:",e),this.options.onsyncmarkinmutelist(e))},s.mergeUser=function(e){this.userSet[e.account]=e}},function(e,t,r){var n=r(0);function i(){}i.parse=function(e){var t=n.copy(e);return t.isBlacked="1"===t.isBlacked,t.isMuted="1"===t.isMuted,t.createTime=+t.createTime,t.updateTime=+t.updateTime,t},e.exports=i},function(e,t,r){var n=r(119),i=r(3),o=r(5),a=r(4),s=r(8),c=["type"],u=r(30).fn,l=r(0),d=l.objs2accounts,p=r(466),f=r(154);u.processFriend=function(e){var t=e.obj,r=e.content,n=e.error;switch(e.cmd){case"friendRequest":this.updateFriendSysMsg(e),n||this.onFriendRequest(t);break;case"syncFriendRequest":this.onFriendRequest(r,!0);break;case"deleteFriend":n||this.onDeleteFriend(t);break;case"syncDeleteFriend":this.onDeleteFriend(r,!0);break;case"updateFriend":n||this.onUpdateFriend(t);break;case"syncUpdateFriend":this.onUpdateFriend(r.friend,!0);break;case"getFriends":this.getFriends(e);break;case"syncFriends":this.onFriends(e);break;case"syncFriendUsers":this.onFriendUsers(e)}},u.getFriends=function(e){var t=e.content.friends,r=[],n=[];i(t).call(t,(function(e){(e=o(p).call(p,e)).valid?r.push(e):n.push(e)})),r.invalid=n,e.obj=r},u.onFriends=function(e){var t,r=this,n=r.db,s=e.error,c=e.content.friends,u=!0,l=[],f=[],h=new a((function(h,g){var v,y;s?g(s):(u&&i(c).call(c,(function(e){(e=o(p).call(p,e)).valid?l.push(e):f.push(e)})),r.logger.info("friend::onFriends: parse friends",d(l),"delete",d(f)),c.length?(u=!0,t=e.content.timetag):u=!1,n.enable?(v=h,y=g,e.promise=new a((function(e,i){function o(){m(),e(),v()}u?n.mergeFriends(l,f,t).then((function(){o()})).then(void 0,(function(e){e._msg="merge friends error",i(e),y(e)})):(r.logger.info("friend::onFriends: no merge friends"),o())})).then(void 0,(function(e){throw e._msg="merge friends data error",y(e),e}))):(m(),h()))})).catch((function(e){return r.logger.error("friend::onFriends: ",e),a.reject(e)}));function m(){r.timetags.friends=t,l.invalid=f,r.syncResult.friends=l,r.syncResult.invalidFriends=f}h.cmd="friends",r.syncPromiseArray.push(h)},u.onFriendRequest=function(e,t){var r=a.resolve(),i=this.db,o=e.type,s=n(e,c);if("addFriend"===(o=e.type=p.getTypeFromByte(o)||o)||"passFriendApply"===o){var u=e.friend=p.assembleFriend(s);i.enable&&(r=i.putFriend(u))}return t&&this.onSyncFriendAction(e),r},u.onSyncFriendAction=function(e){this.logger.info("friend::onSyncFriendActionon: ".concat(e.type,", "),e.account),this.options.onsyncfriendaction(e)},u.onDeleteFriend=function(e,t){var r=a.resolve(),n=this.db;return n.enable&&(r=n.deleteFriend(e.account)),t&&(e.type="deleteFriend",this.onSyncFriendAction(e)),r},u.onUpdateFriend=function(e,t){var r=this.db,n=o(p).call(p,e);r.enable&&r.updateFriend(n),t&&this.onSyncFriendAction({type:"updateFriend",friend:n})},u.onFriendUsers=function(e){var t,r=this.db,n=e.content,i=s(t=n.users).call(t,(function(e){return o(f).call(f,e)}));this.logger.info("friend::onFriendUsers: parse users",d(i));var c=n.timetag,u=a.resolve();r.enable&&(u=r.mergeFriendUsers(i,c)),this.timetags.friendUsers=c,u.cmd="friendUsers",this.syncPromiseArray.push(u),this.syncResult.users=i,this.syncing||this.onSyncDone()},u.updateFriendSysMsg=function(e){var t,r,n=e.obj,i=e.error;if(e.obj.idServer){if(i)t="error",i=l.filterObj(i,"code message");else{var o=n.type;switch(o=p.getTypeFromByte(o)||o){case"passFriendApply":t="passed";break;case"rejectFriendApply":t="rejected"}}r={idServer:n.idServer,state:t},i&&(r.error=i),this.updateSysMsg(r)}}},function(e,t,r){var n=r(29),i=r(19),o=r(30).fn,a=r(0);o.onRobots=function(e){var t=e.content;if(a.isFunction(this.options.onrobots)&&n(t.robots)){var r,o=i(r=t.robots).call(r,(function(e){return!!e.botid}));o.length>0&&this.options.onrobots(o||[])}}},function(e,t,r){var n=r(5),i=r(3),o=r(24),a=r(114),s=r(4),c=r(8),u=r(19),l=r(9),d=r(30).fn,p=r(0),f=p.objs2accounts,h=p.teams2ids,m=r(142),g=r(116);d.processTeam=function(e){var t,r,i,o=e.error;switch(void 0===e.obj&&(e.obj={}),e.cmd){case"createTeam":t=e.obj.team,o||(t=e.content.team),t=n(m).call(m,t),e.obj.team=t,i=g.assembleOwner(t),e.obj.owner=i,o||(this.logger.info("team::processTeam: create team ",t&&t.teamId,i&&i.account),this.onCreateTeam(t,i));break;case"syncCreateTeam":t=n(m).call(m,e.content.team),i=g.assembleOwner(t),this.logger.info("team::processTeam: sync createTeam",t&&t.teamId,i&&i.account),this.options.onsynccreateteam(t,i),this.onCreateTeam(t,i);break;case"sendSuperTeamMsg":case"sendTeamMsg":this.onSendMsg(e);break;case"teamMsg":case"syncSendTeamMsg":this.onMsg(e);break;case"teamMsgs":this.onMsgs(e);break;case"addTeamMembers":case"removeTeamMembers":case"leaveTeam":case"dismissTeam":case"addTeamManagers":case"removeTeamManagers":case"transferTeam":case"updateMuteStateInTeam":break;case"updateInfoInTeam":o||((r=e.obj).account=this.account,r.id=g.genId(r.teamId,r.account),r=n(g).call(g,r),e.obj=r,this.mergeMyTeamMembers(r),this.onUpdateTeamMember(r));break;case"updateNickInTeam":e.obj=n(g).call(g,e.obj);break;case"updateTeam":e.obj=n(m).call(m,e.obj,!0);break;case"applyTeam":case"getTeam":e.error||(e.obj=n(m).call(m,e.content.team));break;case"passTeamApply":this.updateTeamSysMsgState(e,"passed");break;case"rejectTeamApply":case"rejectTeamInvite":this.updateTeamSysMsgState(e,"rejected");break;case"acceptTeamInvite":this.updateTeamSysMsgState(e,"passed"),e.error||(e.obj=n(m).call(m,e.content.team));break;case"getTeams":case"syncTeams":this.onTeams(e);break;case"getTeamMembers":case"syncTeamMembers":this.onTeamMembers(e);break;case"getTeamHistoryMsgs":case"searchTeamHistoryMsgs":this.onHistoryMsgs(e);break;case"notifyTeamMsgReads":this.onTeamMsgReceipt(e);break;case"syncUpdateTeamMember":r=n(g).call(g,e.content.teamMember),this.onUpdateTeamMember(r),r.account===this.account&&this.mergeMyTeamMembers(r);break;case"getMyTeamMembers":e.error||(e.obj=g.reverseMembers(e.content.teamMembers));break;case"getMutedTeamMembers":e.error||(e.obj={teamId:e.obj.teamId,members:g.reverseMembers(e.content.teamMembers)});break;case"syncMyTeamMembers":this.onSyncMyTeamMembers(e);break;case"sendTeamMsgReceipt":this.sendTeamMsgReceipt(e);break;case"getTeamMsgReads":this.getTeamMsgReads(e);break;case"getTeamMsgReadAccounts":this.getTeamMsgReadAccounts(e);break;case"getTeamsById":this.getTeamsById(e)}},d.getTeamMsgReads=function(e){var t=this;if(e.error)this.logger.error("team::sendTeamMsgReceipt: ",e.error);else{var r=p._get(e,"content.teamMsgReceipts")||[];if(this.db.enable){var n=[];i(r).call(r,(function(e){e.idClient&&n.push({idClient:e.idClient,unread:+e.unread,read:+e.read})})),n.length>0&&o((function(){return t.db.updateMsgBatch(n)}),0)}}},d.getTeamMsgReadAccounts=function(e){if(e.error)this.logger.error("team::getTeamMsgReadAccounts: ",e.error);else{var t=p._get(e,"content.readAccounts")||[],r=p._get(e,"content.unreadAccounts")||[],n=p._get(e,"content.teamMsgReceipt.idClient")||[];this.db.putMsgReadDetail({idClient:n,readAccounts:t,unreadAccounts:r})}},d.sendTeamMsgReceipt=function(e){var t=this;if(e.error)this.logger.error("team::sendTeamMsgReceipt: ",e.error);else{var r=p._get(e,"obj.teamMsgReceipts")||[],n=p._get(e,"content.teamMsgReceipts")||[];if(this.db.enable){var s=[];i(r).call(r,(function(e){a(n).call(n,(function(t){return e.idServer===t.idServer}))||s.push({idClient:e.idClient,hasRead:!0})})),s.length>0&&(this.logger.log("sendTeamMsgReceipt::updateMsgBatch"),o((function(){return t.db.updateMsgBatch(s)}),0))}}},d.onCreateTeam=function(e,t){var r=this.db;r.enable&&(r.putTeam(e),r.putTeamMembers(t)),this.options.onCreateTeam(e,t)},d.onTeams=function(e){e.content=e.content||{};var t,r=this,o=r.db,a=r.packetFromSync(e),c=e.content.teams||[],u=!0,l=[],d=[];e.error&&803===e.error.code&&(e.error=null,u=!1);var p=new s((function(p,h){var g,v;e.error?a&&h(e.error):(u&&i(c).call(c,(function(e){(e=n(m).call(m,e)).validToCurrentUser?l.push(e):d.push(e)})),c.length?(u=!0,t=e.content.timetag):u=!1,o.enable?(g=p,v=h,e.promise=new s((function(e,n){function i(){a?(f(),e(),g()):o.getTeams().then((function(t){l=t,f(),e(),g()})).catch((function(e){e.message="db.getTeams error",e.callFunc="team::afterMergeData",n(e),v(e)}))}u?o.mergeTeams(l,d,t).then((function(){i()})).catch((function(e){var t={callFunc:"team::onTeams:mergeData",message:"db.mergeTeams error",event:e};n(t),v(t)})):(r.logger.warn("team::onTeams:mergeData: no teams need merge"),i())})).then(void 0,(function(e){throw e.message="merge teams data error",e.callFunc="team::mergeData",v(e),e}))):(f(),p()))})).catch((function(e){return r.logger.error("team::onTeams: ",e),s.reject(e)}));function f(){r.timetags.teams=t,l.invalid=d,a?(r.syncResult.teams=l,r.syncResult.invalidTeams=d,r.syncing||r.onSyncDone()):(r.logger.info("team::onTeams: not in syncing, get teams",h(l)),e.obj=l)}a&&(p.cmd="teams",r.syncPromiseArray.push(p))},d.getTeamsById=function(e){var t;if(e.error){if(816!==e.error.code)return;this.logger.error("team::getTeamsById: ",e.error),e.error=null}e.content.teams=c(t=e.content.teams).call(t,(function(e){return n(m).call(m,e)})),e.obj=e.content},d.onTeamMembers=function(e){e.content=e.content||{};var t,r,o=this,a=(o.db,o.packetFromSync(e)),c=e.content.members||[],u=!0,l=[],d=[];e.obj&&(r=e.obj.teamId),r||(r=e.content.teamId),r=""+r,e.error&&406===e.error.code&&(e.error=null,u=!1);var p=new s((function(s,p){e.error?a&&(o.logger.error("team::onTeamMember: team error:",r,e.error),p({callFunc:"team::onTeamMembers",event:e.error,message:"teamId-".concat(r," 获取群成员错误")})):(u&&i(c).call(c,(function(e){(e=n(g).call(g,e)).valid?l.push(e):d.push(e)})),c.length?(u=!0,t=e.content.timetag):u=!1,l.invalid=d,a?(o.syncTeamMembersResult[r]=l,o.syncTeamMembersResult[r+"-invalid"]=d,o.timetags["team-"+r]=t):(o.logger.info("team::onTeamMembers: not syncing, get members",r,f(l)),e.obj={teamId:r,members:l}),s())}));a&&(p.cmd=r,o.syncTeamMembersPromiseArray.push(p))},d.onUpdateTeamMember=function(e){e.updateTime||(e.updateTime=+new Date),this.logger.info("team::onUpdateTeamMember: ",e&&e.account),this.options.onupdateteammember(p.simpleClone(e));var t={teamId:e.teamId,memberUpdateTime:e.updateTime};this.onUpdateTeam(t);var r=this.db;r.enable&&r.updateTeamMember(e)},d.onUpdateTeam=function(e){this.logger.info("team::onUpdateTeam:",e&&e.teamId),this.options.onUpdateTeam(p.simpleClone(e));var t=this.db;t.enable&&t.updateTeam(e)},d.onSyncMyTeamMembers=function(e){var t=this,r=t.db,n=g.reverseMembers(e.content.teamMembers);if(r.enable){var i=r.putTeamMembers(n).then((function(){return r.updateMyTeamMembersTimetag(e.content.timetag)})).catch((function(e){return t.logger.error("team::syncMyTeamMember: ",e),s.reject(e)}));i.cmd="myTeamMembers",t.syncTeamMembersPromiseArray.push(i)}t.mergeMyTeamMembers(n)},d.mergeMyTeamMembers=function(e){p.isArray(e)||(e=[e]);var t=this.myTeamMembersMap=this.myTeamMembersMap||{};i(e).call(e,(function(e){var r=e.teamId;t[r]=p.merge(t[r],e)}))},d.notifyForNewTeamMsg=function(e){p.isArray(e)||(e=[e]);var t=this,r=this.myTeamMembersMap||{},n={},o=[];i(e).call(e,(function(e){p.exist(r[e])?n[e]=r[e].muteNotiType:o.push(e)}));var a=s.resolve({map:n});return o.length&&(a=t.api.getMyTeamMembers({teamIds:o,promise:!0}).then((function(r){t.mergeMyTeamMembers(r),i(r).call(r,(function(e){n[e.teamId]=e.muteNotiType}));var o=u(e).call(e,(function(e){return!n[e]}));return s.resolve({map:n,miss:o})})).catch((function(e){return l(n).length>0?s.resolve({map:n,miss:o,error:e}):s.reject(e)}))),a},d.updateTeamSysMsgState=function(e,t){var r,n=e.error;n&&(t="error",n=p.filterObj(n,"code message")),r={idServer:e.obj.idServer,state:t},n&&(r.error=n),this.updateSysMsg(r)},d.onTeamMsgReceipt=function(e){var t=e.content,r=e.error;r&&this.logger.error("team::onTeamMsgReceipt:",r),t&&t.teamMsgReceipts&&this.options.onTeamMsgReceipt(t)}},function(e,t,r){var n=r(5),i=r(4),o=r(3),a=r(30).fn,s=r(0),c=(s.objs2accounts,s.teams2ids),u=r(221),l=r(152);a.processSuperTeam=function(e){var t,r,i,o=e.error;switch(void 0===e.obj&&(e.obj={}),e.cmd){case"sendSuperTeamMsg":this.onSendMsg(e);break;case"superTeamMsg":case"syncSendSuperTeamMsg":this.onMsg(e);break;case"sendSuperTeamCustomSysMsg":this.onSendSysMsg(e);break;case"superTeamCustomSysMsg":this.onSysMsg(e);break;case"syncSuperTeams":case"getSuperTeams":this.onSuperTeams(e);break;case"syncCreateSuperTeam":t=n(u).call(u,e.content.team),i=l.assembleOwner(t),this.logger.info("team::processTeam: sync createTeam",t&&t.teamId,i&&i.account),this.options.onSyncCreateSuperTeam(t,i),this.onCreateSuperTeam(t,i);break;case"getSuperTeamHistoryMsgs":case"searchSuperTeamHistoryMsgs":this.onHistoryMsgs(e);break;case"addSuperTeamMembers":case"removeSuperTeamMembers":case"leaveSuperTeam":case"addSuperTeamManagers":case"removeSuperTeamManagers":case"transferSuperTeam":break;case"updateInfoInSuperTeam":o||((r=e.obj).account=this.account,r.id=l.genId(r.teamId,r.account),r=n(l).call(l,r),e.obj=r,this.onUpdateSuperTeamMember(r));break;case"updateNickInTeam":e.obj=n(l).call(l,e.obj);break;case"syncUpdateSuperTeamMember":r=n(l).call(l,e.content.teamMember),this.onUpdateSuperTeamMember(r);break;case"updateSuperTeam":e.obj=n(u).call(u,e.obj,!0);break;case"getSuperTeam":e.error||(e.obj=n(u).call(u,e.content.team));break;case"syncSuperTeamMembers":this.onSyncSuperTeamMembers(e);break;case"getSuperTeamMembers":e.error||this.onGetAllSuperTeamMembers(e);break;case"getSuperTeamMembersByJoinTime":case"getSuperTeamMembersByAccounts":case"getMutedSuperTeamMembers":e.error||this.onSuperTeamMembers(e);break;case"onDeleteSuperTeamMsg":this.onDeleteMsg(e);break;case"onSuperTeamMsgDelete":case"syncDeleteSuperTeamMsg":this.onMsgDeleted(e,!0);break;case"onMarkSuperTeamSessionAck":this.onMarkSessionAck(e);break;case"syncMarkSuperTeamSessionAck":this.syncMarkSessionAck(e)}},a.onSuperTeams=function(e){e.content=e.content||{};var t,r=this,a=r.db,s=r.packetFromSync(e),l=e.content.teams||[],d=!0,p=[],f=[];e.error&&803===e.error.code&&(e.error=null,d=!1);var h=new i((function(c,h){var g,v;e.error?s&&h(e.error):(d&&o(l).call(l,(function(e){(e=n(u).call(u,e)).validToCurrentUser?p.push(e):f.push(e)})),l.length?(d=!0,t=e.content.timetag):d=!1,a.enable?(g=c,v=h,e.promise=new i((function(e,n){function i(){s?(m(),e(),g()):a.getSuperTeams().then((function(t){p=t,m(),e(),g()})).then(void 0,(function(e){e.message="db.getSuperTeams error",e.callFunc="superTeam::afterMergeData",n(e),v(e)}))}d?a.mergeSuperTeams(p,f,t).then((function(){i()})).then(void 0,(function(e){var t={callFunc:"superTeam::onSuperTeams:mergeData",message:"db.mergeSuperTeams error",event:e};n(t),v(t)})):(r.logger.warn("superTeam::onSuperTeams:mergeData: no teams need merge"),i())})).then(void 0,(function(e){throw e.message="merge teams data error",e.callFunc="superTeam::mergeData",v(e),e}))):(m(),c()))})).catch((function(e){return r.logger.error("superTeam::onSuperTeams: ",e),i.reject(e)}));function m(){r.timetags.superTeams=t,p.invalid=f,s?(r.syncResult.superTeams=p,r.syncResult.invalidSuperTeams=f):(r.logger.info("superTeam::onSuperTeams: not in syncing, get teams",c(p)),e.obj=p)}s&&(h.cmd="superteams",r.syncPromiseArray.push(h))},a.onCreateSuperTeam=function(e,t){var r=this.db;r.enable&&(r.putSuperTeam(e),r.putSuperTeamMembers(t))},a.onGetAllSuperTeamMembers=function(e){var t=this,r=this.db,n=e.raw.ser,o=this.superTeamMembersData[n]||{},a=o.teamId||e.obj&&e.obj.teamId;if(r.enable){var s=e.content&&e.content.timetag,c=200===e.raw.code?i.all(o.pArr):i.resolve();e.promise=c.then((function(){return r.getSuperTeamMembers(a).then((function(t){s&&r.updateSuperTeamMemberTimetag(a,s),e.obj={members:t,invalid:[],teamId:a}}))})).catch((function(e){return t.logger.error(e)}))}else e.obj={members:o.members,invalid:o.invalid,teamId:a};this.superTeamMembersData[n]=void 0},a.onSyncSuperTeamMembers=function(e){var t,r=this.db,a=[],s=[],c=e.content.members||[],u=e.raw.ser;if(e.obj&&(t=e.obj.teamId),t||(t=e.content.teamId),o(c).call(c,(function(e){(e=n(l).call(l,e)).valid?s.push(e):a.push(e)})),r.enable){this.superTeamMembersData[u]=this.superTeamMembersData[u]||{teamId:t,pArr:[]};var d=i.resolve();e.content&&e.content.isAll&&(d=r.deleteSuperTeamMembers(t));var p=d.then((function(){return r.mergeSuperTeamMembers(t,s,a)})).then((function(){return i.resolve()}));this.superTeamMembersData[u].pArr.push(p)}else this.superTeamMembersData[u]=this.superTeamMembersData[u]||{teamId:t,members:[],invalid:[]},s.length&&(this.superTeamMembersData[u].members=this.api.mergeTeamMembers(this.superTeamMembersData[u].members,s)),a.length&&(this.superTeamMembersData[u].invalid=this.api.mergeTeamMembers(this.superTeamMembersData[u].invalid,a));e.raw=void 0},a.onSuperTeamMembers=function(e,t){var r,i=this.db,a=[],s=[],c=e.content.members||[];o(c).call(c,(function(e){(e=n(l).call(l,e)).valid?s.push(e):a.push(e)})),e.obj&&(r=e.obj.teamId),r||(r=e.content.teamId||s[0]&&s[0].teamId),i.enable&&!t&&i.mergeSuperTeamMembers(r,s,a),e.obj={members:s,invalid:a,teamId:r}},a.onUpdateSuperTeamMember=function(e){e.updateTime||(e.updateTime=+new Date),this.logger.info("superTeam::onUpdateSuperTeamMember: ",e&&e.account),this.options.onUpdateSuperTeamMember(s.simpleClone(e));var t={teamId:e.teamId,memberUpdateTime:e.updateTime};this.onUpdateSuperTeam(t);var r=this.db;r.enable&&r.updateSuperTeamMember(e)},a.onUpdateSuperTeam=function(e){this.logger.info("superteam::onUpdateSuperTeam:",e&&e.teamId),this.options.onUpdateSuperTeam(s.simpleClone(e));var t=this.db;t.enable&&t.updateSuperTeam(e)}},function(e,t,r){var n=r(5),i=r(4),o=r(24),a=r(30).fn,s=r(0),c=r(222);a.processNotify=function(e){switch(e.cmd){case"syncOfflineNetcallMsgs":case"syncOfflineMsgs":this.onOfflineMsgs(e);break;case"batchMarkRead":break;case"syncOfflineSysMsgs":case"syncOfflineSuperTeamSysMsgs":this.onOfflineSysMsgs(e);break;case"syncRoamingMsgs":case"syncSuperTeamRoamingMsgs":this.onRoamingMsgs(e);break;case"syncOfflineFilterMsgs":this.onOfflineMsgs(e,!0);break;case"syncOfflineFilterSysMsgs":this.onOfflineSysMsgs(e,!0);break;case"syncMsgReceipts":this.onOfflineMsgReceipts(e);break;case"syncDonnop":this.onDonnop(e,!0);break;case"syncSessionAck":this.syncSessionAck(e);break;case"syncSuperTeamSessionAck":this.syncSuperTeamSessionAck(e);break;case"syncRobots":this.onRobots(e);break;case"syncBroadcastMsgs":this.onBroadcastMsgs(e);break;case"syncDeleteSuperTeamMsgOfflineRoaming":this.onDeleteMsgOfflineRoaming(e);break;case"syncDeleteMsgSelf":this.syncDeleteMsgSelf(e);break;case"syncSessionsWithMoreRoaming":this.syncSessionsWithMoreRoaming(e);break;case"syncStickTopSessions":this.syncStickTopSessions(e);break;case"syncSessionHistoryMsgsDelete":this.syncSessionHistoryMsgsDelete(e)}},a.onDonnop=function(e,t){if(!e.error){var r=this,o=r.db,a=n(c).call(c,e.content.donnop);r.mergeDonnop(a);var s=r.dbDonnop();if(t){var u=e.content.timetag;r.timetags.donnop=u,o.enable&&(s=s.then((function(){return r.db.updateDonnopTimetag(u)})).catch((function(e){return r.logger.error("notify::onDonnop: ",e),i.reject(e)}))),s.cmd="donnop",r.syncPromiseArray.push(s)}else r.onPushNotificationMultiportConfigUpdate()}},a.onUpdateDonnop=function(e){if(!e.error){var t=e.obj;t&&(this.mergeDonnop(s.filterObj(t,["shouldPushNotificationWhenPCOnline"])),this.dbDonnop(),this.onPushNotificationMultiportConfigUpdate())}},a.getPushNotificationMultiportConfig=function(){return s.merge({},this.pushNotificationMultiportConfig)},a.mergeDonnop=function(e){this.pushNotificationMultiportConfig=s.merge({},this.pushNotificationMultiportConfig,e)},a.dbDonnop=function(){return this.db.enable?this.db.setDonnop(this.pushNotificationMultiportConfig):i.resolve()},a.onPushNotificationMultiportConfigUpdate=function(){var e=this;o((function(){var t=e.getPushNotificationMultiportConfig();e.logger.info("link::onPushNotificationMultiportConfigUpdate:",t),e.options.onPushNotificationMultiportConfigUpdate(t)}))}},function(e,t,r){var n=r(16),i=r(112),o=r(113),a=r(80),s=r(29),c=r(3),u=r(19),l=r(4),d=r(8),p=r(9),f=r(6),h=r(11),m=r(5),g=r(104),v=r(153),y=r(10),b=r(24),S=r(23),_=r(48);function M(e,t){var r=void 0!==o&&a(e)||e["@@iterator"];if(!r){if(s(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return T(e,t);var o=n(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?i(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?T(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var c=0,u=function(){};return{s:u,n:function(){return c>=e.length?{done:!0}:{done:!1,value:e[c++]}},e:function(e){throw e},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,d=!0,p=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return d=e.done,e},e:function(e){p=!0,l=e},f:function(){try{d||null==r.return||r.return()}finally{if(p)throw l}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var w=r(30).fn,x=r(0),I=x.undef,E=r(40),A=r(116),C=r(152),k=r(144),O=(r(223),r(54)),N=r(17),R=r(53);w.processMsg=function(e){switch(e.cmd){case"sendMsg":this.onSendMsg(e);break;case"msg":case"syncSendMsg":this.onMsg(e);break;case"sysMsg":this.onSysMsg(e);break;case"broadcastMsg":this.onBroadcastMsg(e);break;case"sendCustomSysMsg":this.onSendSysMsg(e);break;case"getHistoryMsgs":case"searchHistoryMsgs":this.onHistoryMsgs(e);break;case"msgFtsInServer":case"msgFtsInServerByTiming":this.onmsgFtsInServer(e);break;case"deleteSessions":this.onDeleteSessions(e);break;case"sendMsgReceipt":this.onSendMsgReceipt(e);break;case"msgReceipt":this.onMsgReceipt(e);break;case"onDeleteMsg":this.onDeleteMsg(e);break;case"onMsgDeleted":this.onMsgDeleted(e);break;case"onDeleteMsgOfflineRoaming":this.onDeleteMsgOfflineRoaming(e);break;case"onMarkSessionAck":this.onMarkSessionAck(e);break;case"syncMarkSessionAck":this.syncMarkSessionAck(e);break;case"syncUpdateServerSession":this.onSyncUpdateServerSession(e);break;case"deleteMsgSelf":this.deleteMsgSelf(e);break;case"deleteMsgSelfBatch":this.deleteMsgSelfBatch(e);break;case"onDeleteMsgSelf":this.onDeleteMsgSelf(e);break;case"onDeleteMsgSelfBatch":this.onDeleteMsgSelfBatch(e);break;case"clearServerHistoryMsgs":this.clearServerHistoryMsgs(e);break;case"onClearServerHistoryMsgs":this.onClearServerHistoryMsgs(e)}},w.checkIgnore=function(e){var t=this;c(e).call(e,(function(e){e.ignore||(t.options.shouldIgnoreMsg(e)&&(e.ignore=!0),"notification"===e.type&&t.options.shouldIgnoreNotification(e)&&(e.ignore=!0))}))},w.filterIgnore=function(e){return u(e).call(e,(function(e){return!e.ignore}))},w.genSessionByMsgs=function(e){return this.checkIgnore(e),k.genSessionByMsgs(this.message.Message,e)},w.onRoamingMsgs=function(e){var t=this,r=t.message,n=r.Message,i=n.getMaxTimetag,o=r.reverseMsgs(e.content.msgs),a=i(o);o=n.sortMsgs(o);var s=(o=n.deduplication(o))[0],c=s.sessionId,u=t.genSessionByMsgs(o);t.cacheSyncedSession(u);var d=t.putMsg(o,"roamingMsgs").then((function(e){o=e,(o=t.filterIgnore(o)).length&&(t.logger.info("msg::onRoamingMsgs: putRoamingMsgs",c,o.length),t.syncResult.roamingMsgs=t.syncResult.roamingMsgs||[],t.syncResult.roamingMsgs.push({sessionId:c,scene:s.scene,to:s.target,msgs:o,timetag:a}),t.syncing||t.onSyncDone())})).catch((function(e){return t.logger.error("msg::onRoamingMsgs: ",e),l.reject(e)}));d.cmd="roamingMsgs-"+c,t.syncPromiseArray.push(d)},w.onOfflineMsgs=function(e,t){var r,n=this,i=this.message,o=null;t&&(o={filter:!0});var a=i.reverseMsgs(e.content.msgs,{modifyObj:o}),s={};c(a).call(a,(function(e){s[e.sessionId]=s[e.sessionId]||[],s[e.sessionId].push(e)}));var u=d(r=p(s)).call(r,(function(e){return{sessionId:e,msgs:s[e]}})),f=x.asyncPool(50,u,(function(e){return function(e,t,r){var n=this,i=n.message.Message,o=r?"offlineFilterMsgs":"offlineMsgs";if(!(t&&t.length>0))return l.resolve();var a=i.getMaxTimetag(t),s=t[0].scene,c=t[0].target;n.markMsgRead(t),t=i.sortMsgs(t),t=i.deduplication(t);var u=n.genSessionByMsgs(t);n.cacheSyncedSession(u);var d=n.putMsg(t,"offlineMsgs").then((function(t){var r=t;(r=n.filterIgnore(r)).length&&(n.logger.info("msg::onOfflineMsgs： toreLastSession",o,e,r.length),n.syncResult[o]=n.syncResult[o]||[],n.syncResult[o].push({sessionId:e,scene:s,to:c,msgs:r,timetag:a}))})).catch((function(e){return n.logger.error("msg::onOfflineMsgs: ",e),l.reject(e)}));return d.cmd="offlineMsgs-"+e,d}.call(n,e.sessionId,e.msgs,t)}));this.syncPromiseArray.push(f)},w.completeMsg=function(e){return e.from=this.account,e.fromNick=this.myInfo&&this.myInfo.nick,e.fromClientType="Web",e.fromDeviceId=E.deviceId,e.time||(e.time=+new Date),e},w.onMsgs=function(e){var t=this,r=t.message.reverseMsgs(e.content.msgs,{mapper:function(e){t.handleMsg(e)}});t.pushMsgDelay(r)},w.onMsg=function(e,t){var r;if(e.content.msg.attach){var n=null;try{n=JSON.parse(e.content.msg.attach)}catch(e){}if(!this.mixStorePolicy)try{this.mixStorePolicy=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[this.options.appKey]}catch(e){this.logger.error("error:","get last mixStorePolicy failed",e)}if(n&&n.url&&this.mixStorePolicy.s3Policy&&this.mixStorePolicy.s3Policy.dlcdns&&this.mixStorePolicy.s3Policy.dlcdns.length){var i,o=M(this.mixStorePolicy.s3Policy.dlcdns);try{for(o.s();!(i=o.n()).done;){var a,s=i.value;f(a=n.url).call(a,s)>=0&&(n.isS3=!0,s!==this.mixStorePolicy.s3Policy.dlcdn&&(n.url=n.url.replace(s,this.mixStorePolicy.s3Policy.dlcdn)))}}catch(e){o.e(e)}finally{o.f()}}e.content.msg.attach=h(n)}var c=m(r=this.message).call(r,e.content.msg);t&&(c.filter=!0),"syncSendMsg"!==e.cmd||c.from!==c.to?(this.pushMsgDelay([c]),this.syncing?(this.logger.info("msg::onMsg:is in syncing ..."),this.unhandledMsgs.push({type:"onMsg",msg:c})):this.handleMsg(c)):this.logger.warn("onMsg::syncSendMsg to self, so ignore",c.idClient,c.idServer)},w.onBroadcastMsgs=function(e){var t=e.content.broadcastMsgs;t=g(t).call(t,(function(e,t){return e.broadcastId-t.broadcastId})),this.putBroadcastMsgs(t)},w.onBroadcastMsg=function(e){var t=e.content.broadcastMsg;t.time=t.timestamp,this.syncing?this.unhandledMsgs.push({type:"onBroadcastMsg",msg:t}):t&&this.putBroadcastMsg(t)},w.pushMsgTask=function(e){this.msgPromise=this.msgPromise.then((function(){return e()}))},w.pushMsgDelay=function(e){if(e&&e.length>0){var t=this;if(t.msgStatEnable&&!N.isWeixinApp&&void 0!==t.relativeSeverTime){var r,n=d(e).call(e,(function(e){return{appkey:t.options.appKey,accid:e.to,fromAccid:e.from,msgId:e.idServer,serverTime:e.time,receiveTime:v()-t.relativeSeverTime,sessionId:t.sdkSession,platform:"web",sdk_ver:N.info.version,manufactor:R.name+" "+R.version}}));t.msgDelayArr=y(r=t.msgDelayArr).call(r,n),t.msgDelayArr.length>5&&t.doReportMsgDelay()}}},w.doReportMsgDelay=function(){var e,t=h(this.msgDelayArr);this.msgDelayArr&&this.msgDelayArr.length>0&&(O.sendBeacon("https://statistic.live.126.net/statics/report/im/sdk/msgreceived",t),this.msgDelayArr=[]),this.msgDelayTimer&&clearTimeout(this.msgDelayTimer),this.socket&&(this.msgDelayTimer=b(S(e=this.doReportMsgDelay).call(e,this),1e4))},w.handleMsg=function(e){var t=this,r=t.db,n=e.time;t.markMsgRead(e),t.msgPromise=t.msgPromise.then((function(){return t.putMsg(e,"onMsg")})).then((function(i){var o;return t.logger.info(y(o="msg::handleMsg:putMsg: done ".concat(e.idServer," ")).call(o,e.idClient)),r.enable?"superTeam"===e.scene?r.updateSuperTeamRoamingMsgTimetag(n):r.updateRoamingMsgTimetag(n):(t.timetags["superTeam"===e.scene?"superTeamRoamingMsgs":"roamingMsgs"]=n,l.resolve())})).then((function(){if(e)return t.checkUserUpdate(e)})).then((function(){if(e){var r=e.type;if("notification"===(t.logger.info("msg::handleMsg:checkUserUpdate: "+e.scene+" "+r+" msg"+("notification"===r?" "+e.attach.type:"")),r))return t.onTeamNotificationMsg(e)}})).then((function(){e&&!e.ignore&&(t.logger.info("msg::handleMsg:onmsg: ",e.idClient,e.idServer),b((function(){t.options.onmsg(x.copy(e))}),0))})).catch((function(e){e.callFunc="msg::handleMsg",t.onCustomError("消息处理错误",e)}))},w.putMsg=function(e,t){if(x.isArray(e)||(e=[e]),u(e[0]))return l.resolve(e);var r,n=this,i=n.db,o=i.enable,a=l.resolve(),s=n.message.Message.getLastMsg(e),p=s.flow,f=n.genSessionByMsgs(e);g(f);var h=!1,m=[];function g(e){"roamingMsgs"!==t&&"offlineMsgs"!==t||n.cacheSyncedSession(e)}return a=(a=(a=a.then((function(){var r;return o||n.options.autoMarkRead||"roamingMsgs"===t||!f||(n.sessionUnreadMsgs=n.sessionUnreadMsgs||{},n.sessionUnreadMsgs[f.id]=n.sessionUnreadMsgs[f.id]||[],n.sessionUnreadMsgs[f.id]=y(r=n.sessionUnreadMsgs[f.id]).call(r,u(e).call(e,(function(e){return n.options.shouldCountNotifyUnread(e)})))),"offlineMsgs"===t||"roamingMsgs"===t?l.reject(e):o?i.putMsg(e):e})).then((function(t){var r=[];return c(e).call(e,(function(e){n.checkMsgUnique(e)&&r.push(e)})),e=r,m=o?t:e,l.resolve(e)}))).then((function(e){return e.length&&o&&f?new l((function(t,r){i.getSessions({sessionId:f.id}).then((function(r){if(r&&r.lastMsg){var n=r.lastMsg;f.lastMsg&&f.lastMsg.time<n.time&&(f.lastMsg=n)}m&&m.length?f?i.putSession(f).then((function(e){t(e)})):t(r):(h=!0,m=e,t(r))}))})):l.resolve(f)}))).then((function(e){if(f&&m.length){r=s.sessionId!==n.currSessionId;var a="roamingMsgs"===t,u=n.options.syncSessionUnread,l=f.id,v=n.findSession(l)||{},y=v.ack||0;if("offlineMsgs"===t||a&&u||"onMsg"===t&&"in"===p&&r){var b;o&&e?(f=e,y=y||f.ack||0):(e=v)&&(f.unread=e.unread||0),g(f),f.unread=f.unread||0;var S=0;c(m).call(m,(function(e){var t=n.options.shouldCountNotifyUnread(e),r=("notification"!==e.type||"notification"===e.type&&t)&&(I(e.isUnreadable)||e.isUnreadable);if(r&&u&&(r=e.time>y&&"out"!==e.flow),r&&(S++,u&&!o)){var i=v.unreadMsgs||[];i.push(e),f.unreadMsgs=i}})),f.unread+=S;var _=x.secureOutput("session",f);if(_.unreadMsgs&&(_.unreadMsgs=d(b=_.unreadMsgs).call(b,(function(e){return e&&e.idServer}))),n.logger.info("msg::putMsg:updateSession: ",_),g(f),o&&!h)return i.updateSession({id:f.id,unread:f.unread})}}})),"onMsg"===t&&(a=a.then((function(){e.length&&f&&(n.onUpdateSession(f),n.options.syncSessionUnread&&!r&&n.api.resetSessionUnread(n.currSessionId))}))),a.then((function(){return l.resolve(e)})).catch((function(e){return e&&e.length?l.resolve(e):l.reject(e)}))},w.putBroadcastMsgs=function(e){var t=this,r=t.db,n=e.length;if(n>0){if(t.doMarkBroadcastMsgsRead(e),r.enable){var i=e[n-1].broadcastId;return r.updateBroadcastMsgTimetag(i),r.putBroadcastMsg(e).then((function(){return b((function(){t.doMarkMsgsRead(),t.options.onbroadcastmsgs(x.copy(e))}),0),l.resolve(e)}))}b((function(){t.options.onbroadcastmsgs(x.copy(e))}),0)}return e},w.putBroadcastMsg=function(e){var t=this,r=t.db;return t.doMarkBroadcastMsgsRead([e]),r.enable?(e.broadcastId&&r.updateBroadcastMsgTimetag(e.broadcastId),r.putBroadcastMsg(e).all((function(){return b((function(){t.options.onbroadcastmsg(x.copy(e))}),0),l.resolve(e)}))):(b((function(){t.options.onbroadcastmsg(x.copy(e))}),0),e)},w.doMarkBroadcastMsgsRead=function(e){e=d(e).call(e,(function(e){return e.broadcastId})),this.sendCmd("batchMarkRead",{sid:7,cid:17,ids:e})},w.cacheSyncedSession=function(e){if(e&&this.syncResult){e=_({},e),this.syncResult.sessions=this.syncResult.sessions||{};var t=e.id,r=this.syncResult.sessions[t]||{};r&&r.ack<e.ack&&(e.ack=void 0),r&&r.msgReceiptTime<e.msgReceiptTime&&(e.msgReceiptTime=void 0),this.syncResult.sessions[t]=_(r,e),this.mergeSession(this.syncResult.sessions[t])}},w.checkMsgUnique=x.genCheckUniqueFunc("idClient"),w.revokeMsgUniqueCheck=function(e){this.uniqueSet&&this.uniqueSet.idClient&&(this.uniqueSet.idClient[e]=!1)},w.storeSendMsg=function(e){if(!this.syncing){var t=this.putMsg(e,"sendMsg");return this.msgPromise=this.msgPromise.then((function(){return t})),t}this.unhandledMsgs.push({type:"sendMsg",msg:e})},w.updateSendMsgError=function(e){if(!this.syncing){var t=this.updateMsg(e);return this.msgPromise=this.msgPromise.then((function(){return t})),t}this.unupdatedMsgs.push(e)},w.onSendMsg=function(e,t){var r,n=this,i=e.content&&e.content.msg,o=e.obj&&e.obj.msg||i;if(this.logger.warn(y(r="sendMsg::end: ".concat(i&&i.idServer," ")).call(r,o.idClient)),e.obj)s();else{var a=n.db;a&&a.enable&&a.getMsgByIdClient(o.idClient).then((function(e){e&&(o=e,s())})).catch((function(e){return s()}))}function s(){var r;n.completeMsg(o);var a=e.error&&7101===e.error.code;e.error&&!a||(o.idServer=i.idServer,o.time=+i.time,i.yidunAntiSpamRes&&(o.yidunAntiSpamRes=i.yidunAntiSpamRes),i.callbackExt&&(o.callbackExt=i.callbackExt)),a&&(o.isInBlackList=!0),e.error?o.status="fail":o.status="success",o=m(r=n.message).call(r,o),t&&(o.filter=!0),e.obj=o,n.syncing?n.unupdatedMsgs.push(o):n.msgPromise=l.all([n.msgPromise,e.obj.promise]).then((function(e){return e.length||(o.resend=!0),n.updateMsg(o).then((function(){return n.options.syncSessionUnread&&n.currSessionId===o.sessionId&&n.api.resetSessionUnread(n.currSessionId),n.resolveMsgReceiptTask(o),o}))})).catch((function(e){n.logger.error("onSendMsg::dealMsg error",e)}))}},w.updateLocalMsg=function(e){var t=this.updateMsg(e);return this.msgPromise=this.msgPromise.then((function(){return t})),t},w.updateMsg=function(e){if(u(e)||this.options.shouldIgnoreMsg(e))return l.resolve(e);var t=this,r=t.db,n="success"===e.status,i=k.genSessionByMsg(e),o=!!e.isLocal;return t.onUpdateSession(i),r.enable?r.updateMsg(e).then((function(t){var a=r.updateSession(i),s=l.resolve();return n&&t&&!o&&(s="superTeam"===e.scene?r.updateSuperTeamRoamingMsgTimetag(t.time):r.updateRoamingMsgTimetag(t.time)),l.all([a,s])})).catch((function(e){t.logger.error("updateMsg error",e)})):(n&&!o&&(t.timetags.roamingMsgs=e.time),l.resolve(e))},w.updateRoamingMsgTimetag=function(e){var t=this.db;return t.enable?t.updateRoamingMsgTimetag(e):(this.timetags.roamingMsgs=e,l.resolve(e))},w.checkUserUpdate=function(e){var t=this,r=e.from;return t.logger.info("handleMsg::checkUserUpdate: ",r,t.account),r===t.account?l.resolve():new l((function(n){var i=t.userSet[r];if(i){var o=+i.updateTime,a=+e.userUpdateTime;!isNaN(o)&&!isNaN(a)&&x.isNumber(o)&&x.isNumber(a)&&o<a?s():n()}else s();function s(){t.api.getUser({account:r,sync:!0,done:function(e,r){e||b((function(){t.logger.log("user::checkUserUpdate: onupdateuser",r&&r.account),t.options.onupdateuser(r)}),0),n()}})}}))},w.processUnsettledMsgs=function(){var e,t,r=this;c(e=r.unhandledMsgs).call(e,(function(e){var t=e.msg;switch(e.type){case"onMsg":r.handleMsg(t);break;case"sendMsg":r.msgPromise=r.msgPromise.then((function(){return r.putMsg(t)}));break;case"onBroadcastMsg":r.msgPromise=r.msgPromise.then((function(){return r.putBroadcastMsg(t)}))}})),c(t=r.unupdatedMsgs).call(t,(function(e){r.msgPromise=r.msgPromise.then((function(){return r.updateMsg(e)}))})),r.resetUnsettledMsgs()},w.onTeamNotificationMsg=function(e){this.db;var t=e.attach,r=t.type,n=e.from,i=e.to,o=e.time,a=t.team,s=t.account,c=t.accounts;switch(r){case"updateTeam":return a.updateTime=o,this.onUpdateTeam(a);case"addTeamMembers":return this.onAddTeamMembers(e,a,c);case"removeTeamMembers":return this.onRemoveTeamMembers(a,i,c);case"acceptTeamInvite":return this.onAddTeamMembers(e,a,[n]);case"passTeamApply":return this.onAddTeamMembers(e,a,[s]);case"addTeamManagers":return this.updateTeamManagers(e,i,c,!0,o);case"removeTeamManagers":return this.updateTeamManagers(e,i,c,!1,o);case"leaveTeam":return this.onRemoveTeamMembers(a,i,[n]);case"dismissTeam":return this.onDismissTeam(i,o);case"transferTeam":return this.transferTeam(e,a,n,s);case"updateTeamMute":return this.onUpdateTeamMembersMute(e,a,[s],t.mute);case"updateSuperTeam":return a.updateTime=o,this.onUpdateSuperTeam(a);case"addSuperTeamMembers":return this.onAddSuperTeamMembers(e,a,c);case"passSuperTeamApply":return this.onAddSuperTeamMembers(e,a,[s]);case"removeSuperTeamMembers":return this.onRemoveSuperTeamMembers(a,i,c);case"leaveSuperTeam":return this.onRemoveSuperTeamMembers(a,i,[n]);case"dismissSuperTeam":return this.onDismissSuperTeam(i,o);case"transferSuperTeam":return this.transferSuperTeam(e,a,n,s);case"addSuperTeamManagers":return this.updateSuperTeamManagers(e,i,c,!0,o);case"removeSuperTeamManagers":return this.updateSuperTeamManagers(e,i,c,!1,o);case"updateSuperTeamMembersMute":return this.onUpdateSuperTeamMembersMute(e,a,c,t.mute)}},w.onAddSuperTeamMembers=function(e,t,r){var n=this.db,i=C.assembleMembers(t,r);e.attach.members=i;var o={team:t,accounts:r,members:i};if(this.logger.info("team::onAddSuperTeamMembers: ".concat(o.team.teamId,", "),o.accounts),this.options.onAddSuperTeamMembers(x.simpleClone(o)),n.enable){var a=n.putSuperTeamMembers(i),s=n.putSuperTeam(t);return l.all([a,s])}},w.onRemoveSuperTeamMembers=function(e,t,r){var n=this.db,i={team:e,accounts:r};this.logger.info("team::onRemoveSuperTeamMembers: ".concat(i.team.teamId,", "),i.accounts);try{this.options.onRemoveSuperTeamMembers&&this.options.onRemoveSuperTeamMembers(x.simpleClone(i))}catch(e){throw new Error("Excute onRemoveSuperTeamMembers failed"+e.message)}if(n.enable){if(-1===f(r).call(r,this.account)){var o=n.removeSuperTeamMembersByAccounts(t,r),a=l.resolve();return e&&(a=n.putSuperTeam(e)),l.all([o,a])}return n.leaveSuperTeam(t)}},w.onDismissSuperTeam=function(e,t){var r=this.db,n={teamId:e};if(this.logger.info("team::onDismissSuperTeam:",e),this.options.onDismissSuperTeam(n),r.enable)return r.dismissSuperTeam(e,t)},w.onAddTeamMembers=function(e,t,r){var n=this,i=n.db,o=t.teamId,a=A.assembleMembers(t,r);e.attach.members=a;var s={team:t,accounts:r,members:a};if(n.logger.info("team::onAddTeamMembers: ",o,r),n.options.onAddTeamMembers(x.simpleClone(s)),i.enable){var c,u=i.putTeam(t);return-1===f(r).call(r,n.account)?c=i.putTeamMembers(a):(n.logger.log("team::onAddTeamMembers: user join team",o),u=new l((function(e){n.api.getTeamMembers({teamId:o,sync:!0,done:function(){e()}})}))),l.all([c,u])}},w.onRemoveTeamMembers=function(e,t,r){var n=this.db,i={team:e,accounts:r};if(this.logger.info("team::onRemoveTeamMembers: ".concat(e.teamId),r),this.options.onRemoveTeamMembers(x.simpleClone(i)),n.enable){if(-1===f(r).call(r,this.account)){var o=n.removeTeamMembersByAccounts(t,r),a=l.resolve();return e&&(a=n.putTeam(e)),l.all([o,a])}return n.leaveTeam(t)}},w.updateTeamManagers=function(e,t,r,n,i){var o=this.db,a=e.attach.members=d(r).call(r,(function(e){return{id:A.genId(t,e),type:n?"manager":"normal",updateTime:i}})),s={teamId:""+t,memberUpdateTime:i};e.attach.team=s;var c={team:s,accounts:r,isManager:n,members:a};if(this.logger.info("team::updateTeamManagers:",t,r,n),this.options.onUpdateTeamManagers(x.simpleClone(c)),o.enable){var u=o.updateTeam(s),p=o.updateTeamManagers(t,r,n,i);return l.all([u,p])}},w.updateSuperTeamManagers=function(e,t,r,n,i){var o=this.db,a=e.attach.members=d(r).call(r,(function(e){return{id:A.genId(t,e),teamId:t,account:e,type:n?"manager":"normal",updateTime:i}})),s={teamId:""+t,memberUpdateTime:i};e.attach.team=s;var c={team:s,accounts:r,isManager:n,members:a};if(this.logger.info("team::updateSuperTeamManagers:",t,r,n),this.options.onUpdateSuperTeamManagers(x.simpleClone(c)),o.enable){var u=o.updateSuperTeam(s),p=o.updateSuperTeamMembers(a);return l.all([u,p])}},w.onDismissTeam=function(e,t){var r=this.db,n={teamId:e};if(this.logger.info("team::onDismissTeam:",e),this.options.onDismissTeam(n),r.enable)return r.dismissTeam(e,t)},w.transferTeam=function(e,t,r,n){var i=this.db,o=t.teamId,a=t.memberUpdateTime,s={id:A.genId(o,r),type:"normal",updateTime:a},c={id:A.genId(o,n),type:"owner",updateTime:a};e.attach.members=[s,c];var u={team:t,from:s,to:c};if(this.logger.info("team::transferTeam: from to",o,r,n),this.options.onTransferTeam(x.simpleClone(u)),i.enable)return i.transferTeam(t,r,n)},w.transferSuperTeam=function(e,t,r,n){var i=this.db,o=t.teamId,a=t.memberUpdateTime,s={teamId:o,type:"normal",account:r,updateTime:a},c={teamId:o,type:"owner",account:n,updateTime:a};e.attach.members=[s,c];var u={team:t,from:s,to:c};if(this.logger.info("team::transferSuperTeam: from to ",o,r,n),this.options.onTransferSuperTeam(x.simpleClone(u)),i.enable)return i.transferSuperTeam(t,s,c)},w.onUpdateTeamMembersMute=function(e,t,r,n){var i=this.db,o=d(r).call(r,(function(e){return{id:A.genId(t.teamId,e),account:e,teamId:t.teamId,mute:n,updateTime:t.memberUpdateTime}}));e.attach.members=o;var a={team:t,accounts:r,members:o,mute:n};if(this.logger.info("team::onUpdateTeamMembersMute:",t.teamId,r,n),this.options.onUpdateTeamMembersMute(x.simpleClone(a)),i.enable){var s=i.updateTeamMembers(o),c=i.putTeam(t);return l.all([s,c])}},w.onUpdateSuperTeamMembersMute=function(e,t,r,n){var i=this.db,o=d(r).call(r,(function(e){return{id:C.genId(t.teamId,e),account:e,teamId:t.teamId,mute:n,updateTime:t.memberUpdateTime}}));e.attach.members=o;var a={team:t,accounts:r,members:o,mute:n};if(this.logger.info("team::onUpdateSuperTeamMembersMute:",t.teamId,r,n),this.options.onUpdateSuperTeamMembersMute(x.simpleClone(a)),i.enable){var s=i.updateSuperTeamMembers(o),c=i.putSuperTeam(t);return l.all([s,c])}},w.onHistoryMsgs=function(e){e.error||(e.obj.msgs=this.message.reverseMsgs(e.content.msgs))},w.onmsgFtsInServer=function(e){if(!e.error){var t=this.message.reverseMsgs(e.content.msgs);e.obj.msgs=t,e.content.msgs=t}},w.isFilterMsgs=function(e){return!!u(e[0])},w.splitMsgs=function(e,t,r,n){c(e).call(e,(function(e){if(u(e))n.push(e);else switch(e.scene){case"p2p":t.push(e);break;case"team":r.push(e)}}))},w.markMsgRead=function(e,t){if(x.isArray(e)||(e=[e]),this.db.enable||this.options.autoMarkRead||t){var r=d(e).call(e,(function(e){return{flag:"msg",idServer:e.idServer,scene:e.scene,filter:u(e),type:e.type,attachType:e.attach&&e.attach.type}}));this.msgAckBufferManager.add(r)}},w.markSysMsgRead=function(e,t){if(x.isArray(e)||(e=[e]),this.db.enable||this.options.autoMarkRead||t){var r=d(e).call(e,(function(e){return{flag:"systemMsg",idServer:e.idServer,scene:e.scene,filter:u(e),type:e.type}}));this.msgAckBufferManager.add(r)}},w.handleMsgsAck=function(e){var t,r=this,n={p2pSysMsgs:{sid:7,cid:3,msgs:[]},p2pMsgs:{sid:7,cid:2,msgs:[]},superTeamSysMsgs:{sid:21,cid:19,msgs:[]},teamMsgs:{sid:8,cid:3,msgs:[]},filterSysMsgs:{sid:101,cid:3,msgs:[]},filterMsgs:{sid:101,cid:2,msgs:[]},netcallMsgs:{sid:9,cid:11,msgs:[]}};c(e).call(e,(function(e){/^(netcallBill|netcallMiss|netcallReject)$/.test(e.attachType)?n.netcallMsgs.push(e):u(e)?"systemMsg"===e.flag?n.filterSysMsg.msgs.push(e):n.filterMsgs.msgs.push(e):"systemMsg"!==e.flag?"p2p"===e.scene?n.p2pMsgs.msgs.push(e):"team"===e.scene&&n.teamMsgs.msgs.push(e):"superTeam"===e.scene?n.superTeamSysMsgs.msgs.push(e):n.p2pSysMsgs.msgs.push(e)})),c(t=p(n)).call(t,(function(e){return r.doMarkMsgsRead(n[e].sid,n[e].cid,n[e].msgs)}))},w.doMarkMsgsRead=function(e,t,r){r&&r.length&&(this.logger.log("markMsgRead::batchMarkRead",e,t,r),this.sendCmd("batchMarkRead",{sid:e,cid:t,ids:d(r).call(r,(function(e){return e.idServer}))}))}},function(e,t,r){var n=r(59),i=r(60),o=r(61),a=r(62),s=r(50),c=r(63),u=r(5),l=r(3),d=r(9),p=r(19),f=r(4),h=r(48);function m(e,t){var r=d(e);if(n){var o=n(e);t&&(o=p(o).call(o,(function(t){return i(e,t).enumerable}))),r.push.apply(r,o)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)l(r=m(Object(n),!0)).call(r,(function(t){c(e,t,n[t])}));else if(o)a(e,o(n));else{var u;l(u=m(Object(n))).call(u,(function(t){s(e,t,i(n,t))}))}}return e}var v=r(30).fn,y=(r(0),r(467)),b=r(469);function S(e,t,r){var n=this,i=this.timetags&&this.timetags.sync;this.db.enable&&i&&t&&this.db.getMsgByIdClient(e).then((function(e){if(e&&!(e.commentTimetag&&e.commentTimetag<=i&&e.time<=i)){if(e.commentTimetag=t.time,e.comments=e.comments||[],r){var o;e.comments=p(o=e.comments).call(o,(function(e){return e.body!==t.body||e.from!==t.from}))}else{for(var a,s=0;s<e.comments.length;s++)if(e.comments[s].from===t.from&&e.comments[s].body===t.body){e.comments[s]=t,a=!0;break}a||e.comments.push(t)}var c={idClient:e.idClient,comments:e.comments,commentTimetag:e.commentTimetag};n.db.updateMsg(c)}}))}function _(e){e.scene=this.message.sceneReverseMap[+e.scene]||e.scene,e.time=+e.time}v.processMsgExtend=function(e){switch(e.cmd){case"getThreadMsgs":this.onGetThreadMsgs(e);break;case"getMsgsByIdServer":this.onGetMsgsByIdServer(e);break;case"addQuickComment":this.changeQuickComment(e);break;case"deleteQuickComment":this.changeQuickComment(e,!0);break;case"onQuickComment":case"syncAddQuickComment":this.onQuickComment(e);break;case"onDeleteQuickComment":case"syncDeleteQuickComment":this.onQuickComment(e,!0);break;case"getQuickComments":this.getQuickComments(e);break;case"addCollect":case"updateCollect":this.addCollect(e);break;case"deleteCollects":this.deleteCollects(e);break;case"getCollects":this.getCollects(e);break;case"addStickTopSession":case"syncAddStickTopSession":this.onChangeStickTopSession(e,"add");break;case"updateStickTopSession":case"syncUpdateStickTopSession":this.onChangeStickTopSession(e,"update");break;case"deleteStickTopSession":case"syncDeleteStickTopSession":this.onChangeStickTopSession(e,"delete");break;case"addMsgPin":case"onAddMsgPin":case"syncAddMsgPin":this.pinMsgChange(e,"add");break;case"updateMsgPin":case"onUpdateMsgPin":case"syncUpdateMsgPin":this.pinMsgChange(e,"update");break;case"deleteMsgPin":case"onDeleteMsgPin":case"syncDeleteMsgPin":this.pinMsgChange(e,"delete");break;case"getMsgPins":this.getMsgPins(e)}},v.onGetThreadMsgs=function(e){if(!e.error){var t;e.obj.msgs=this.message.reverseMsgs(e.content.msgs),e.obj.threadMsg=u(t=this.message).call(t,e.content.threadMsg);var r=e.content.threadMsgsMeta||{};e.obj.total=r.total,e.obj.timetag=r.lastMsgTime}},v.onGetMsgsByIdServer=function(e){e.error||(e.obj.msgs=this.message.reverseMsgs(e.content.msgs))},v.changeQuickComment=function(e,t){e.error||(e.obj.comment.time=e.content.timetag,e.obj.comment=u(y).call(y,e.obj.comment),_.call(this,e.obj.msg),S.call(this,e.obj.msg.idClient,e.obj.comment,t))},v.onQuickComment=function(e,t){if(e.content){var r=e.content,n=r.comment,i=r.msg;n&&i&&(_.call(this,i),n=u(y).call(y,n),t?this.options.onDeleteQuickComment(e.content.msg,n):this.options.onQuickComment(e.content.msg,n),S.call(this,i.idClient,n,t))}},v.getQuickComments=function(e){var t,r=this;if(!e.error){var n=e.obj.idMap,i=e.obj.indexMap,o=e.content&&e.content.commentRes||[];l(o).call(o,(function(e){var t=[],i=r.parser.unserializeMap.comment;if(1==+e.modify)try{t=JSON.parse(e.detail)}catch(e){r.logger.warn("getQuickComments parse detail error",e)}if(l(t).call(t,(function(e,r){var n,o={};l(n=d(e)).call(n,(function(t){o[i[t]]=e[t]})),o=u(y).call(y,o),t[r]=o})),e.timestamp=+e.timestamp,n[e.idClient]){var o={idClient:e.idClient,commentTimetag:e.timestamp};n[e.idClient].commentTimetag=e.timestamp,1==+e.modify&&(n[e.idClient].comments=t,o.comments=t),r.db.enable&&r.db.updateMsg(o)}else n[e.idClient]={idServer:e.idServer,idClient:e.idClient,comments:t,commentTimetag:e.timestamp}})),e.obj=[],l(t=d(i)).call(t,(function(t){e.obj[i[t]]=n[t]}))}},v.addCollect=function(e){e.error||(e.obj.collect=u(b).call(b,e.content.collect))},v.deleteCollects=function(e){e.error||(e.obj.deleteNum=e.content.deleteNum)},v.getCollects=function(e){if(!e.error){var t=[],r=e.content.collectList||[];l(r).call(r,(function(e){t.push(u(b).call(b,e))})),e.obj.collectList=t,e.obj.total=e.content.total}},v.onChangeStickTopSession=function(e,t){var r=this;if(!e.error){var n=e.content.stickTopSession||e.obj.stickTopSession||{},i=e.content.timetag||+n.updateTime,o=n.id.split("|");"super_team"===o[0]&&(o[0]="superTeam"),n={id:o.join("-"),scene:o[0],to:o[1],topCustom:n.topCustom||""},"delete"===t?n.isTop=!1:"add"===t&&(n.isTop=!0),n=this.onUpdateSession(n),e.obj&&(e.obj.stickTopSession=n),this.db.enable&&(this.db.updateSession(n).then((function(e){e||r.db.putSession(n)})),this.db.updateTimetag("stickTopSessions",i))}},v.pinMsgChange=function(e,t){var r=this;if(!e.error){e.content=e.content||{};var n=this,i=this.db,o=e.obj&&e.obj.msg,a=e.content.msg||o||{},s=e.content.pinTag||e.obj.pinTag,c=e.content.timetag||+s.updateTime,u=f.resolve();_.call(this,a),i.enable&&(u=i.getMsgByIdClient(a.idClient)),s.createTime&&(s.createTime=+s.createTime),s.updateTime&&(s.updateTime=+s.updateTime),u.then((function(u){return a=u||a,u?a=u:a.sessionId=a.scene+"-"+r.message.Message.getMsgTarget(a,r.account),o?(e.obj.msg=a,e.obj.pinTag=s):r.options.onPinMsgChange({msg:a,pinTag:s},t),i.enable&&i["delete"===t?"deleteMsgPin":"putMsgPin"](g(g({},a),{},{pinFrom:s.pinFrom,pinCustom:s.pinCustom})).then((function(){var e="pin-"+a.sessionId,t=n.timetags.sync;return i.getTimetag(e).then((function(r){return r>t?i.updateTimetag(e,c):f.resolve()}))})).catch((function(e){n.logger.error("msgExtend::pinMsgChange:error",e)})),f.resolve})).then((function(){})),e.promise=u}},v.getMsgPins=function(e){var t=this;if(!e.error){var r=this.db,n=e.content||{};if(n.pins=n.pins||[],n.modify){var i,o=[];r.enable&&(r.updateTimetag("pin-"+e.obj.id,n.timetag),l(i=n.pins).call(i,(function(t){t.sessionId=e.obj.id,o.push(r.getMsgByIdClient(t.idClient))}))),e.promise=f.all(o).then((function(i){var o;l(o=n.pins).call(o,(function(r,n){i[n]?h(r,i[n]):(r.sessionId=e.obj.id,_.call(t,r))})),e.obj.pins=n.pins,r.enable&&r.deleteMsgPins(e.obj.id).then((function(){return r.putMsgPins(n.pins)})).catch((function(e){t.logger.error("msgExtend::getMsgPins:change db error",e)}))}))}else r.enable?(r.updateTimetag("pin-"+e.obj.id,n.timetag),e.promise=r.getMsgPins(e.obj.id).then((function(t){e.obj.pins=t||[]}))):e.obj.pins=[]}}},function(e,t,r){var n=r(536);e.exports=n},function(e,t,r){r(537);var n=r(12);e.exports=n.Number.isInteger},function(e,t,r){r(2)({target:"Number",stat:!0},{isInteger:r(538)})},function(e,t,r){var n=r(27),i=Math.floor;e.exports=Number.isInteger||function(e){return!n(e)&&isFinite(e)&&i(e)===e}},function(e,t,r){var n=r(4),i=r(3),o=r(10),a=r(30).fn,s=r(0);r(33),a.onOfflineMsgReceipts=function(e){var t,r=this,o=r.db,a=e.content.msgReceipts,s=[],c=n.resolve();this.logger.info("onOfflineMsgReceipts",a),i(a).call(a,(function(e){t={id:"p2p-"+e.from,msgReceiptTime:+e.time},r.cacheSyncedSession(t)})),r.syncResult.msgReceipts=s,o.enable&&(c=o.updateMsgReceiptsTimetag(e.content.timetag)),c.cmd=s,r.syncPromiseArray.push(c)},a.shouldUpdateSessionFromMsgReceipt=function(e,t){return!e||!e.msgReceiptServerTime||t.time>e.msgReceiptServerTime},a.genSessionFromMsgReceipt=function(e,t){var r=t.time,n={id:t.sessionId,msgReceiptTime:r,msgReceiptServerTime:r};return e&&e.id===t.sessionId&&(n=s.merge({},e,n)),e&&e.updateTime||(n.updateTime=r),n},a.onMsgReceipt=function(e){var t=this,r=t.db,i=e.content.msgReceipt;i.time=+i.time;var o=i.idClient,a=n.resolve();r.enable&&o&&(a=r.getMsgByIdClient(o)),this.logger.info("onMsgReceipt::",i),a.then((function(e){var r;if(e){if(!e.idServer)return void(t.msgReceiptTasks[o]=i);r=e.time}else r=i.time;i.msgReceiptTime=r,t.updateSessionMsgReceiptTime(i)}))},a.resolveMsgReceiptTask=function(e){var t=this.msgReceiptTasks[e.idClient];t&&(t.msgReceiptTime=e.time,this.updateSessionMsgReceiptTime(t))},a.updateSessionMsgReceiptTime=function(e){var t=this.db,r={id:"p2p-"+e.from,msgReceiptTime:e.msgReceiptTime,msgReceiptServerTime:e.time};(this.findSession(r.id)||{}).msgReceiptTime>=r.msgReceiptTime?this.logger.warn("receive old msgReceiptTime",e):(t.enable&&t.putSession(r),this.onUpdateSession(r))},a.onSendMsgReceipt=function(e){var t;if(!e.error)if(e.obj&&e.obj.msgReceipt){var r=e.obj.msgReceipt,n=+r.time,i=+e.content.msgReceipt.time,a=this.findSession("p2p-"+r.to);this.logger.info(o(t="sendMsgReceipt on:: param time ".concat(n,", res time ")).call(t,i)),a.msgReceiptSendTime=Math.min(n,i)}else this.logger.info("sendMsgReceipt on:: origin msg is missing, it maybe timeout")},a.shouldSendMsgReceipt=function(e){if(e&&"p2p"===e.scene&&"success"===e.status){var t=this.findSession(e.sessionId);if(t){var r=t.msgReceiptSendTime;return!r||r<e.time}}return!1},a.isMsgRemoteRead=function(e){if(e&&"p2p"===e.scene&&"out"===e.flow&&"success"===e.status){var t=this.findSession(e.sessionId);if(t&&t.msgReceiptTime)return e.time<=t.msgReceiptTime}return!1}},function(e,t,r){var n=r(470),i=r(471),o=r(153),a=r(5),s=r(3),c=r(10),u=r(8),l=r(4),d=r(78),p=r(118),f=r(9),h=r(19),m=r(51),g=r(16),v=r(23),y=r(218),b=r(30).fn,S=r(117),_=r(144),M=r(0);function T(e,t){return w.apply(this,arguments)}function w(){return(w=i(n.mark((function e(t,r){var i,o,a,c,u,l,d,p,f,h,m,g,b,S=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(o=this).db,c=[],s(t).call(t,(function(e){S.revokeMsgUniqueCheck(e.idClient),c.push(e.idClient)})),o.options.rollbackDelMsgUnread){e.next=14;break}return e.next=7,a.deleteMsg(c);case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0=[];case 10:return u=e.t0,u="[object Array]"===Object.prototype.toString.call(u)?u:[u],o.logger.info("msg::_deleteMsgSelfBatchInDb, rollback false, affect: ".concat(u.length," rows")),e.abrupt("return");case 14:return l=!1,d=o.options.cbUpdateSession||v(i=o.updateLocalSession).call(i,o),p=o.findSession(r)||{id:r},f=p.lastMsg||{},y(c).call(c,f.idClient)&&(l=!0),o.logger.info("msg::_deleteMsgSelfBatchInDb session change before:",r,l,p.unread),e.next=22,a.deleteMsg(c);case 22:if(e.t1=e.sent,e.t1){e.next=25;break}e.t1=[];case 25:if(h=e.t1,h="[object Array]"===Object.prototype.toString.call(h)?h:[h],o.logger.info("msg::_deleteMsgSelfBatchInDb affect:",h.length," rows"),!l){e.next=34;break}return e.next=31,a.getMsgs({sessionId:r,limit:1});case 31:m=e.sent,f=m&&m[0]?m[0]:f,p.lastMsg=f;case 34:if(g=!1,p&&p.unread&&(b=p&&p.ack||0,s(h).call(h,(function(e){b<e.time&&"in"===e.flow&&(p.unread=p.unread-1,g=!0)}))),!l&&!g){e.next=39;break}return o.logger.info("msg::_deleteMsgSelfBatchInDb session change after:",r,p.unread),e.abrupt("return",d(p));case 39:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function x(e,t){t=t||(new Date).getTime();var r=this.db,n=this.findSession(e),i=!1!==this.options.rollbackClearMsgsUnread,o=[];return r.enable&&o.push(r.deleteMsgsBySessionId({sessionId:e,end:t})),i&&n&&(n=this.mergeSession({id:n.id,unread:0,lastMsg:null}),n=this.onUpdateSession(n)),r.enable&&i&&n&&o.push(r.updateSession(n)),l.all(o)}b.onDeleteMsg=function(e){var t=this.db;if(delete e.obj.sysMsg,!e.error){var r=e.obj.msg;e.promise=this.deleteLocalMsg(r).then((function(){if(t.enable){var e="superTeam"===r.scene?"deleteSuperTeamMsg":"deleteMsg";t.getTimetag(e).then((function(r){r=r||0,o()+1>=r&&t.updateTimetag(e,o()+1)}))}}))}},b.onMsgDeleted=function(e,t){if(!e.error){var r=this,n=r.db,i=a(S).call(S,e.content.sysMsg);i=r.processDeleteMsgSysMsg(i),t||r.markSysMsgRead(i),r.deleteLocalMsg(i.msg).then((function(){if(n.enable){var e=t?"deleteSuperTeamMsg":"deleteMsg";n.updateTimetag(e,i.time+1)}r.handleSysMsg(i)}))}},b.processDeleteMsgSysMsg=function(e){var t;return e.msg={},s(t=["scene","from","to"]).call(t,(function(t){e.msg[t]=e[t]})),e.msg.idClient=e.deletedIdClient,e.msg.idServer=e.deletedIdServer,e.msg.time=e.deletedMsgTime,e.msg.fromNick=e.deletedMsgFromNick,e.opeAccount=e.opeAccount||e.from,e.msg.opeAccount=e.opeAccount,this.message.Message.setExtra(e.msg,this.account),e},b.onDeleteMsgOfflineRoaming=function(e){if(!e.error){var t,r=this,n=1==+e.content.type?"offline":"roaming",i=S.reverseSysMsgs(e.content.sysMsgs,{mapper:function(e){return r.processDeleteMsgSysMsg(e)}}),o=i&&i[0]&&"superTeam"===i[0].scene;r.logger.info(c(t="msg::onDeleteMsgOfflineRoaming: on delete ".concat(n," ")).call(t,o?"superTeam":""," idServer deletedIdClient deletedIdClient="),u(i).call(i,(function(e){var t,r;return c(t=c(r="".concat(e.idServer,"-")).call(r,e.deletedIdServer,"-")).call(t,e.deletedIdClient)}))),"offline"===n&&r.markSysMsgRead(i);var a=e.content.timetag;o?(r.timetags.deleteSuperTeamMsg=a,r.syncResult.deleteSuperTeamMsgTimetag=a):(r.timetags.deleteMsg=a,r.syncResult.deleteMsgTimetag=a);var s=r.putSysMsg(i,"offlineSysMsgs").catch((function(e){return r.logger.error("msgDelete::onDeleteMsgOfflineRoaming: ",e),l.reject(e)}));s.cmd="deleteMsgSysMsgs "+n,r.syncPromiseArray.push(s),r.syncResult.deleteMsgSysMsgs=r.syncResult.deleteMsgSysMsgs||[],r.syncResult.deleteMsgSysMsgs.push({type:n,sysMsgs:i})}},b.deleteMsgOfflineRoaming=function(e,t){if(!e)return l.resolve();var r=this;r.logger.info("msg::deleteMsgOfflineRoaming: ",u(e).call(e,(function(e){var t;return e.type+" "+u(t=e.sysMsgs).call(t,(function(e){var t,r;return c(t=c(r="".concat(e.idServer,"-")).call(r,e.deletedIdServer,"-")).call(t,e.deletedIdClient)}))})),M.secureOutput("session",t));var n=r.db,i=[];return s(e).call(e,(function(e){var o;s(o=e.sysMsgs).call(o,(function(e){var o=r.deleteLocalMsg(e.msg,{cbUpdateSession:function(e){e=r.mergeSession(e),e=M.simpleClone(e),d(_).call(_,e);var i=M.findObjIndexInArray(t,{value:e.id});if(-1!==i&&(t[i]=M.merge({},t[i],e)),n.enable)return n.updateSession(e)}});i.push(o)}))})),l.all(i).then((function(){n.enable&&(r.syncResult.deleteMsgTimetag&&n.updateTimetag("deleteMsg",r.syncResult.deleteMsgTimetag),r.syncResult.deleteSuperTeamMsgTimetag&&n.updateTimetag("deleteSuperTeamMsg",r.syncResult.deleteSuperTeamMsgTimetag))}))},b.deleteMsgSelf=function(e){if(!e.error){var t=this.db,r=e.obj&&e.obj.deleteMsgSelfTag;if(r){var n=e.content&&e.content.timetag;r.scene=r.scene+""=="1"?"p2p":"team";var i=[this.deleteLocalMsg(r)];n<=this.timetags.deleteMsgSelf||(this.timetags.deleteMsgSelf=n,t.enable&&i.push(t.updateDeleteMsgSelf(n))),e.promise=l.all(i)}}},b.deleteMsgSelfBatch=function(){var e=i(n.mark((function e(t){var r,i,o,a,c,d,m,g;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}return e.abrupt("return");case 2:if(i=this,o=this.db,(a=t.obj&&t.obj.deleteMsgSelfTags)&&a.length>0){e.next=7;break}return e.abrupt("return");case 7:if(c=p(a).call(a,(function(e,t){var r=t.sessionId;return e[r]=e[r]||[],e[r].push(t),e}),{}),o.enable){e.next=11;break}return s(d=f(c)).call(d,(function(e){var t=c[e],r=i.findSession(e);if(i.options.rollbackDelMsgUnread&&r){var n=r.ack||0,o=h(t).call(t,(function(e){return n<e.time&&"in"===e.flow}));o.length>0&&r.unread&&(r.unread=r.unread?r.unread-o.length:0,i.onUpdateSession(r))}})),e.abrupt("return",l.resolve());case 11:m=u(r=f(c)).call(r,(function(e){var t=c[e];return T.call(i,t,e)})),(g=t.content&&t.content.timetag)<=i.timetags.deleteMsgSelf||(i.timetags.deleteMsgSelf=g,m.push(o.updateDeleteMsgSelf(g))),t.promise=l.all(m);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),b.onDeleteMsgSelf=function(e){var t=this,r=this.db,n=e.content.deleteMsgSelfTag;n.scene=n.scene+""=="1"?"p2p":"team",t.options.onDeleteMsgSelf([n]),t.deleteLocalMsg(n).then((function(){var e=n.deletedTime;return e<=t.timetags.deleteMsgSelf||!r.enable?l.resolve():(t.timetags.deleteMsgSelf=e,r.updateDeleteMsgSelf(e))})).catch((function(e){t.logger.error("onDeleteMsgSelf error",e)}))},b.onDeleteMsgSelfBatch=function(e){if(!e.error){var t={1:"p2p",2:"team"},r=M.get(e,"content.deleteMsgSelfTags")||[];s(r).call(r,(function(e){var r;e.sessionId=c(r="".concat(t[e.scene],"-")).call(r,e.from),e.deletedTime=m(e.deletedTime),e.time=m(e.time)}));var n=M.get(e,"content.deleteMsgSelfTags[0].deletedTime");n=m(n)||0,this.deleteMsgSelfBatch({obj:{deleteMsgSelfTags:r},content:{timetag:n}})}},b.clearServerHistoryMsgs=function(e){if(!e.error){var t=this.db,r=e.obj&&e.obj.clearMsgsParamsWithSync;if(r){var n="p2p"==(r.type&&"2"===r.type.toString()?"team":"p2p")?"p2p-".concat(r.otherAccid):"team-".concat(r.toTid),i=e.content&&m(e.content.timetag);i&&i>this.timetags.sessionHistoryMsgsDelete&&(this.timetags.sessionHistoryMsgsDelete=i,t.enable&&t.updateTimetag("sessionHistoryMsgsDelete",this.timetags.sessionHistoryMsgsDelete)),x.call(this,n,i)}}},b.onClearServerHistoryMsgs=function(e){if(!e.error){var t=this.db,r=e.content&&e.content.sessionHistoryMsgsDeleteTag;if(r){var n="p2p"==(r.type&&"2"===r.type.toString()?"team":"p2p")?"p2p-".concat(r.otherAccid):"team-".concat(r.toTid),i=m(r.time);this.options.onClearServerHistoryMsgs&&this.options.onClearServerHistoryMsgs([{sessionId:n,time:i}]),i<=this.timetags.sessionHistoryMsgsDelete||(this.timetags.sessionHistoryMsgsDelete=i,t.enable&&t.updateTimetag("sessionHistoryMsgsDelete",this.timetags.sessionHistoryMsgsDelete)),x.call(this,n,i)}}},b.syncSessionHistoryMsgsDelete=function(e){if(!e.error){var t=this.db,r=e.content&&e.content.sessionHistoryMsgsDeleteTags;if(r&&r.length>0){var n=u(r).call(r,(function(e){return{sessionId:"p2p"==(e.type&&"2"===e.type.toString()?"team":"p2p")?"p2p-".concat(e.otherAccid):"team-".concat(e.toTid),time:m(e.time)}}));this.options.onClearServerHistoryMsgs&&this.options.onClearServerHistoryMsgs(n),this.syncResult.clearServerHistoryMsgs=n;var i=0;s(n).call(n,(function(e){e.time>i&&(i=e.time)})),t.enable&&t.updateTimetag("sessionHistoryMsgsDelete",i)}}},b.syncDeleteMsgSelf=function(e){var t=this,r=this.db,n=e.content.deletedMsgs;if(n&&0!==n.length){var i=[];s(n).call(n,(function(e){e.scene="1"===e.scene?"p2p":"team",e.deletedTime=+e.deletedTime,e.time=+e.time,i.push(t.deleteLocalMsg(e))})),t.options.onDeleteMsgSelf(n),l.all(i).then((function(){var e=g(n).call(n,-1)[0].deletedTime;if(!(t.timetags.deleteMsgSelf>=e))return t.timetags.deleteMsgSelf=e,r.enable?r.updateDeleteMsgSelf(e):void 0})).catch((function(e){t.logger.error("syncDeleteMsgSelf error",e)}))}},b.deleteLocalMsg=function(e,t){var r,n=this,i=n.db,o=(t=t||{}).cbUpdateSession||v(r=n.updateLocalSession).call(r,n);if(this.revokeMsgUniqueCheck(e&&e.idClient),i.enable&&e){var a=!1,s=null,c=null,u=e.sessionId||e.scene+"-"+this.message.Message.getMsgTarget(e,this.account);return i.getMsgs({sessionId:u,limit:1}).then((function(t){t&&t[0]&&t[0].idClient===e.idClient&&(a=!0)})).then((function(){return i.getMsgByIdClient(e.idClient)})).then((function(t){return c=t,i.deleteMsg(e.idClient)})).then((function(){if(a)return i.getMsgs({sessionId:u,limit:1})})).then((function(e){a&&e&&e[0]&&(s=e[0])})).then((function(){if(n.options.rollbackDelMsgUnread)return i.getSession(u)})).then((function(e){var t=e||{id:u};a&&(t.lastMsg=s);var r=e&&e.ack||0,i=!1;return e&&c&&r<c.time&&"in"===c.flow&&e.unread&&(n.logger.info("msgDelete::deleteLocalMsg:db.getSessions: unread",e.id,e.unread),t.unread=e.unread-1,i=!0),a||i?o(t):l.resolve()}))}var d=n.findSession(e.sessionId);if(n.options.rollbackDelMsgUnread&&e&&e.sessionId&&d){var p=d.ack||0;d&&p<e.time&&"in"===e.flow&&d.unread&&(n.logger.info("msgDelete::deleteLocalMsg::no db: ",d.id),d.unread=d.unread-1,n.onUpdateSession(d))}return l.resolve()}},function(e,t,r){var n=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),a=new A(n||[]);return o._invoke=function(e,t,r){var n=d;return function(i,o){if(n===f)throw new Error("Generator is already running");if(n===h){if("throw"===i)throw o;return k()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=x(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var c=l(e,t,r);if("normal"===c.type){if(n=r.done?h:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=h,r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",p="suspendedYield",f="executing",h="completed",m={};function g(){}function v(){}function y(){}var b={};c(b,o,(function(){return this}));var S=Object.getPrototypeOf,_=S&&S(S(C([])));_&&_!==r&&n.call(_,o)&&(b=_);var M=y.prototype=g.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function x(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=l(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function C(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:k}}function k(){return{value:t,done:!0}}return v.prototype=y,c(M,"constructor",y),c(y,"constructor",v),v.displayName=c(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,s,"GeneratorFunction")),e.prototype=Object.create(M),e},e.awrap=function(e){return{__await:e}},T(w.prototype),c(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new w(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(M),c(M,s,"Generator"),c(M,o,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=C,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},function(e,t,r){e.exports=r(543)},function(e,t,r){var n=r(213);r(544),r(545),r(546),r(547),e.exports=n},function(e,t,r){r(214)},function(e,t,r){r(215)},function(e,t,r){var n=r(2),i=r(92),o=r(115);n({target:"Promise",stat:!0},{try:function(e){var t=i.f(this),r=o(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}})},function(e,t,r){r(216)},function(e,t,r){var n=r(77),i=r(8),o=r(5),a=r(10),s=r(4),c=r(24),u=r(19),l=r(3),d=r(30).fn,p=r(0),f=r(117);d.splitSysMsgs=function(e,t){for(var r,i=e.length-1;i>=0;i--)r=e[i],f.isCustom(r)&&(n(e).call(e,i,1),t.push(r))},d.onOfflineSysMsgs=function(e,t){var r,n=this,c=i(r=e.content.sysMsgs).call(r,(function(e){return e=o(f).call(f,e),t&&(e.filter=!0),e}));c=o(c).call(c),n.markSysMsgRead(c);var u=[];n.splitSysMsgs(c,u);var l,d=t?"offlineFilterSysMsgs":"offlineSysMsgs",p=t?"offlineFilterCustomSysMsgs":"offlineCustomSysMsgs";if(c.length){var h=n.putSysMsg(c,"offlineSysMsgs").then((function(e){var t;(c=e).length&&(n.logger.info("sysmsg::onOfflineSysMsgs: ",d,c.length,c&&i(c).call(c,(function(e){return e.idServer}))),n.syncResult[d]=n.syncResult[d]||[],n.syncResult[d]=a(t=n.syncResult[d]).call(t,c))})).catch((function(e){return n.logger.error("sysMsg::onOfflineSysMsgs: ",e),s.reject(e)}));h.cmd="sysMsgs",n.syncPromiseArray.push(h)}u.length&&(n.logger.info("sysmsg::onOfflineSysMsgs: ",p,i(u).call(u,(function(e){return e.idServer}))),n.syncResult[p]=n.syncResult[p]||[],n.syncResult[p]=a(l=n.syncResult[p]).call(l,u))},d.onSendSysMsg=function(e,t){var r=e.obj||{};r?(this.completeSysMsg(r),e.error?r.status="fail":r.status="success",r=o(f).call(f,r),t&&(e.obj.filter=!0),e.obj=r):this.logger.warn("onSendSysMsg::no obj")},d.completeSysMsg=function(e){return e.from=this.account,e},d.onSysMsg=function(e,t){var r=o(f).call(f,e.content.sysMsg);this.markSysMsgRead(r),t&&(r.filter=!0),f.isCustom(r)?(this.logger.info("sysmsg::onSysMsg: on customSysMsg"),this.options.oncustomsysmsg(r)):this.syncing?this.unhandledSysMsgs.push(r):this.handleSysMsg(r)},d.handleSysMsg=function(e){var t=this,r=e.type,n=e.from,i=e.serverex;t.sysMsgPromise=t.sysMsgPromise.then((function(){return t.putSysMsg(e,"onSysMsg")})).then((function(t){e=t[0]})).then((function(){if(e){var o,a=s.resolve();switch(r){case"addFriend":o={type:"addFriend",account:n},i&&(o.serverex=i),a=t.onFriendRequest(o);break;case"passFriendApply":o={type:"passFriendApply",account:n},a=t.onFriendRequest(o);break;case"deleteFriend":a=t.onDeleteFriend({account:n})}return o&&o.friend&&(e.friend=o.friend),a}})).then((function(){e&&(t.logger.info("sysmsg::handleSysMsg: ",r,p.pickAsString(e,["idServer","deletedIdClient","deletedIdServer"])),c((function(){t.options.onsysmsg(e)}),0))}))},d.putSysMsg=function(e,t){if(p.isArray(e)||(e=[e]),u(e[0]))return s.resolve(e);var r=this,n=r.db,i=n.enable,o=s.resolve(),a=[];return(o=(o=o.then((function(){return i?n.putSysMsg(e):e})).then((function(t){var n=[];l(e).call(e,(function(e){r.checkSysMsgUnique(e)&&n.push(e)})),e=n,a=i?t:e}))).then((function(){return r.getSysMsgUnread().then((function(n){return a.length||((a=e).backward=!0),r.updateSysMsgUnread(a,n,1).then((function(e){"offlineSysMsgs"===t&&(r.syncResult.sysMsgUnread=e),"onSysMsg"===t&&r.onUpdateSysMsgUnread(e)}))}))}))).then((function(){return e}))},d.checkSysMsgUnique=p.genCheckUniqueFunc("idServer"),d.getSysMsgUnread=function(){var e=this,t=e.db;return new s((function(r){t.enable?t.getSysMsgUnread().then((function(e){r(e)}),(function(){r(e.sysMsgUnread)})):r(e.sysMsgUnread)}))},d.updateSysMsgUnread=function(e,t,r){if(p.isArray(e)||(e=[e]),!e.length)return s.resolve(t);t=t||{};var n,i=this.db;return l(e).call(e,(function(e){(r>0&&!e.read||r<0&&e.read)&&(n=e.type,t[n]=(t[n]||0)+r)})),t=f.completeUnread(t),this.sysMsgUnread=t,i.enable&&!e.backward?i.updateSysMsgUnread(t):s.resolve(t)},d.reduceSysMsgUnread=function(e){var t=this;return t.getSysMsgUnread().then((function(r){return t.updateSysMsgUnread(e,r,-1)})).then((function(e){t.onUpdateSysMsgUnread(e)}))},d.onUpdateSysMsgUnread=function(e){var t=this;c((function(){t.logger.info("sysmsg::onUpdateSysMsgUnread:",e),t.options.onupdatesysmsgunread(e)}),0)},d.updateSysMsg=function(e){var t=this,r=t.db;(r.enable?r.updateSysMsg(e):s.resolve(e)).then((function(e){t.onUpdateSysMsg(e)}))},d.onUpdateSysMsg=function(e){var t=this;c((function(){p.isArray(e)||(e=[e]),l(e).call(e,(function(e){t.logger.info("sysmsg::onUpdateSysMsg:",e.idServer),t.options.onupdatesysmsg(e)}))}),0)},d.processUnsettledSysMsgs=function(){var e,t=this;l(e=t.unhandledSysMsgs).call(e,(function(e){t.handleSysMsg(e)})),t.resetUnsettledSysMsgs()}},function(e,t,r){var n=r(59),i=r(60),o=r(61),a=r(62),s=r(50),c=r(151),u=r(63),l=r(3),d=r(6),p=r(16),f=r(5),h=r(4),m=r(8),g=r(78),v=r(19),y=r(48),b=r(9),S=r(10);function _(e,t){var r=b(e);if(n){var o=n(e);t&&(o=v(o).call(o,(function(t){return i(e,t).enumerable}))),r.push.apply(r,o)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)l(r=_(Object(n),!0)).call(r,(function(t){u(e,t,n[t])}));else if(o)a(e,o(n));else{var c;l(c=_(Object(n))).call(c,(function(t){s(e,t,i(n,t))}))}}return e}var T=r(30).fn,w=r(0),x=r(144),I=r(33),E=r(117);T.processSession=function(e){if(!e.error)switch(e.cmd){case"getServerSessions":this.onGetServerSessions(e);break;case"getServerSession":this.onGetServerSession(e);break;case"updateServerSession":this.onUpdateServerSession(e)}},T.onGetServerSessions=function(e){var t=this,r=e.content&&e.content.sessionReqTag,n=e.content&&e.content.sessionList,i=[];l(n).call(n,(function(e){var r,n;if(e.id=e.id.split("|").join("-"),0===d(r=e.id).call(r,"super_team")&&(e.id="superTeam"+p(n=e.id).call(n,10)),e.updateTime=+e.updateTime,e.lastMsg){var o="1"===e.lastMsgType?"sysMsg":"msg";i.push(t.parser.unserialize(JSON.parse(e.lastMsg),o).then((function(r){var n;e.lastMsg="msg"===o?f(n=t.message).call(n,r):f(E).call(E,r)})))}})),e.promise=h.all(i).then((function(){e.obj={sessionList:n,hasMore:"1"===r.hasMore},r.minTimestamp&&(e.obj.minTimestamp=+r.minTimestamp)}))},T.onGetServerSession=function(e){var t,r,n=this,i=e.content&&e.content.session;if(i)if(i.id=i.id.split("|").join("-"),0===d(t=i.id).call(t,"super_team")&&(i.id="superTeam"+p(r=i.id).call(r,10)),i.updateTime=+i.updateTime,i.lastMsg){var o=e.content.session&&"1"===e.content.session.lastMsgType?"sysMsg":"msg";e.promise=n.parser.unserialize(JSON.parse(i.lastMsg),o).then((function(t){var r;i.lastMsg="msg"===o?f(r=n.message).call(r,t):f(E).call(E,t),e.obj=i}))}else e.obj=i},T.onUpdateServerSession=function(e){e.obj={}},T.onSyncUpdateServerSession=function(e){var t,r,n=this,i=this,o=e.content&&e.content.session;o&&(o.id=o.id.split("|").join("-"),0===d(t=o.id).call(t,"super_team")&&(o.id="superTeam"+p(r=o.id).call(r,10)),o.updateTime=+o.updateTime,o.lastMsg?i.parser.unserialize(JSON.parse(o.lastMsg),"msg").then((function(e){var t;o.lastMsg=f(t=i.message).call(t,e),n.options.onSyncUpdateServerSession(w.simpleClone(o))})):this.options.onSyncUpdateServerSession(w.simpleClone(o)))},T.mergeSession=function(e){e=w.copyWithNull(e);var t=this.sessionSet,r=e.id,n=t[r]||{},i=!1;return x.isComplete(e)?delete n.isDeleted:n.isDeleted&&(i=!0),t[r]=w.merge(n,e),e=i?e:t[r],w.undef(e.unread)&&(e.unread=0),e},T.mergeSessions=function(e){var t=this;return m(e=e||[]).call(e,(function(e){return t.mergeSession(e)}))},T.deleteLocalSession=function(e,t){var r=this;w.isArray(e)||(e=[e]),t?l(e).call(e,(function(e){r.sessionSet[e]&&(r.sessionSet[e].isDeleted=!0)})):l(e).call(e,(function(e){return delete r.sessionSet[e]}))},T.onDeleteSessions=function(e){var t;e.obj=m(t=e.obj.sessions).call(t,(function(e){return x.parse(e)}))},T.onUpdateSession=function(e){if(e){if(e=this.mergeSession(e),e=w.simpleClone(e),g(x).call(x,e),x.isComplete(e))return this.logger.info("session::onUpdateSession: ".concat(e.id),e.id,w.secureOutput("session",e)),this.options.onupdatesessions?this.options.onupdatesessions([e]):this.options.onupdatesession(e),e;this.logger.warn("session::onUpdateSession::session is not complete",w.secureOutput("session",e))}},T.onUpdateSessions=function(e){var t=this;if(e){e=t.mergeSessions(e),e=w.simpleClone(e),l(e).call(e,(function(e){g(x).call(x,e)}));var r=v(e).call(e,(function(e){return x.isComplete(e)})),n=v(e).call(e,(function(e){return!x.isComplete(e)}));if(n&&n.length>0&&t.logger.warn("session::onUpdateSessions::sessions is not complete",m(n).call(n,(function(e){return e.id})),w.secureOutput("session",n)),0!==r.length)return t.logger.info("session::onUpdateSessions:",w.secureOutput("session",r)),t.options.onupdatesessions?t.options.onupdatesessions(r):l(r).call(r,(function(e){t.options.onupdatesession(e)})),r;t.logger.warn("session::onUpdateSessions::completeSessions is empty")}},T.setCurrSession=function(e){e=""+e,this.currSessionId=e,this.logger.info("session::setCurrSession:",e)},T.findSession=function(e,t){var r=this.sessionSet[e];return!r||r.isDeleted&&!t?void 0:r},T.resetSessionUnread=function(e){var t=e.id;this.db.enable&&this.db.updateSession({id:t,unread:0}),!this.options.autoMarkRead&&this.sessionUnreadMsgs&&this.sessionUnreadMsgs[t]&&(this.markMsgRead(this.sessionUnreadMsgs[t],!0),this.sessionUnreadMsgs[t]=[]),this.findSession(t)?this.onUpdateSession({id:t,unread:0}):this.onUpdateSession(M(M({},e),{},{unread:0}))},T.resetSessionsUnread=function(e){var t=this,r=this.db;r.enable&&m(e).call(e,(function(e){r.updateSession({id:e.id,unread:0})}));var n=!this.options.autoMarkRead&&this.sessionUnreadMsgs;e=m(e).call(e,(function(e){return n&&t.sessionUnreadMsgs[e.id]&&(t.markMsgRead(t.sessionUnreadMsgs[e.id],!0),t.sessionUnreadMsgs[e.id]=[]),t.findSession(e.id)?{id:e.id,unread:0}:M(M({},e),{},{unread:0})})),this.onUpdateSessions(e)},T.insertLocalSession=function(e){var t=this,r=t.db,n=e.scene+"-"+e.to,i=t.findSession(n);return i&&x.isComplete(i)?h.reject(I.sessionExist({callFunc:"session::insertLocalSession",session:i})):(r.enable?r.getMsgs({sessionId:n,limit:1}):h.resolve()).then((function(o){if(w.isArray(o)&&1===o.length){var a=o[0];(i=x.genSessionByMsg(a)).updateTime=a.time}else i={id:n,scene:e.scene,to:e.to,updateTime:+e.updateTime||+new Date,lastMsg:null};return t.onUpdateSession(i),r.enable?r.putSession(i):h.resolve(i)}))},T.updateLocalSession=function(e,t){var r=this;return new h((function(n,i){var o=r.db;if(r.findSession(e.id)){var a=h.resolve(),s=w.filterObj(e,"id lastMsg localCustom unread");o.enable&&(a=o.updateSession(s)),a.then((function(e){return r.onUpdateSession(e,t)})).then(n,(function(e){i({callFunc:"session::updateLocalSession",event:e})}))}else i(I.sessionNotExist({sessionId:e.id,callFunc:"session::updateLocalSession"}))}))},T.checkAndUpdateLocalSessionByMsg=function(e){var t,r=this.db,n=this,i=this.options.syncSessionUnread&&e!==this.currSessionId,o=r.getMsgs({sessionId:e,limit:1}),a=r.getSession(e).then((function(o){if(o)return t=y({},o),o.ack=o.ack||0,i?r.getMsgs({sessionId:e,start:o.ack}):h.resolve();n.logger.error("can't find session that sessionId = ".concat(e))}));return h.all([o,a]).then((function(i){var o,a,s=c(i,2),u=s[0],d=s[1],p={id:e};if(o=t.lastMsg?t.lastMsg.idClient:null,u&&u[0]?a=(u=u[0]).idClient:(a=null,u=null),o!==a&&(p.lastMsg=u),void 0!==d){var f=0;l(d=d||[]).call(d,(function(e){e.isUnreadable&&"in"===e.flow&&("notification"!==e.type||n.options.shouldCountNotifyUnread(e))&&f++})),f!==t.unread&&(p.unread=f)}return b(p).length>1?(n.logger.info("session::checkAndUpdateLocalSessionByMsg::needUpdate newSession:",w.secureOutput("session",p)),r.updateSession(p).then((function(e){return n.onUpdateSession(p)}))):h.resolve(200)}))},T.syncSessionsWithMoreRoaming=function(e){var t=this,r=e&&e.content&&e.content.sessions;if(r&&r.length){var n={0:"p2p",1:"team",5:"superTeam"};if(l(r).call(r,(function(e){var r,i=e.to===t.options.account?e.from:e.to;e.scene=n[e.scene],e.id=S(r="".concat(e.scene,"-")).call(r,i),e.time=+e.time})),this.db.enable){var i=this.db.putSessionsWithMoreRoaming(r);i.cmd="syncSessionsWithMoreRoaming",this.syncPromiseArray.push(i)}this.syncing&&this.syncResult?this.syncResult.sessionsWithMoreRoaming=r:this.logger.warn("syncSessionsWithMoreRoaming::not in syncing or no syncResult")}},T.syncStickTopSessions=function(e){var t=this,r=this.db,n=[],i=[],o=h.resolve(),a=e.content.sessions||[];this.syncing&&this.syncResult?(l(a).call(a,(function(e){var t=e.id.split("|");"super_team"===t[0]&&(t[0]="superTeam"),e.id=t.join("-"),e.scene=t[0],e.to=t[1],e.isTop=!0,n.push(t.join("-")),delete e.createTime,delete e.updateTime,r.enable&&i.push(r.putSession(e))})),r.enable&&(o=r.updateTimetag("stickTopSessions",e.content.timetag)),o.then((function(){return r.enable?r.getStickTopSessions():[]})).then((function(o){if(e.content.modify){var a=[];l(o).call(o,(function(e){d(n).call(n,e.id)>-1||(a.push(e.id),e.isTop=!1,e.topCustom="",i.push(r.putSession(e)))}))}else t.syncResult.stickTopSessions=o;return h.all(i)})),this.syncResult.stickTopSessions=a,o.cmd="syncStickTopSessions",this.syncPromiseArray.push(o)):this.logger.warn("syncSessionsWithMoreRoaming::not in syncing or no syncResult")}},function(e,t,r){var n=r(3),i=r(9),o=r(10),a=r(48),s=r(30).fn,c=r(0);s.syncSessionAck=function(e){var t,r=this;if(this.logger.info("syncSessionAck::",e.content),r.syncing&&r.syncResult){r.saveAck.p2pTeam=e.content.timetag;var s={};n(t=[[e.content.p2p,"p2p"],[e.content.team.m_map,"team"]]).call(t,(function(e){var t,a=e[0],c=e[1];n(t=i(a)).call(t,(function(e){var t,n;s[o(t="".concat(c,"-")).call(t,e)]=a[e];var i={id:o(n="".concat(c,"-")).call(n,e),ack:a[e]};r.cacheSyncedSession(i)}))})),r.syncResult.ackMap?r.syncResult.ackMap=a(r.syncResult.ackMap,s):r.syncResult.ackMap=s}else r.logger.warn("syncSessionAck: not in syncing or no syncResult",r.syncing,!!r.syncResult)},s.syncSuperTeamSessionAck=function(e){var t,r=this;if(r.syncResult){r.saveAck.superTeam=e.content.timetag;var o={},s=e.content.superTeam.m_map;n(t=i(s)).call(t,(function(e){o["superTeam-".concat(e)]=s[e];var t={id:"superTeam-".concat(e),ack:s[e]};r.cacheSyncedSession(t)})),r.syncResult.ackMap?r.syncResult.ackMap=a(r.syncResult.ackMap,o):r.syncResult.ackMap=o}},s.onMarkSessionAck=function(e){e.error||this.storeSessionAck(e.obj)},s.syncMarkSessionAck=function(e){this.storeSessionAck(e.content,!0)},s.storeSessionAck=function(e,t){var r;if(this.options.syncSessionUnread&&e){var n;switch(e.scene){case 0:n="p2p";break;case 1:n="team";break;default:n="superTeam"}var i=o(r="".concat(n,"-")).call(r,e.to),a=e.timetag;if(a<=((this.findSession(i)||{}).ack||0))this.logger.warn("session::storeSessionAck: ack <= ackInMemory",a);else{var s={id:i,ack:a};this.mergeSession(s),this.logger.info("session::storeSessionAck:",c.secureOutput("session",s)),this.markUnreadBySessionAck({sessionId:i,ack:s.ack},t)}}},s.markUnreadBySessionAck=function(e,t){var r=e.sessionId,n=e.ack,i=this,o=i.db;if(o.enable)i.pushMsgTask((function(){return o.getMsgCountAfterAck({shouldCountNotifyUnread:i.options.shouldCountNotifyUnread,sessionId:r,ack:n}).then((function(e){var a={id:r,unread:e,ack:n};return i.logger.info("session::markUnreadBySessionAck: db.getMsgCountAfterAck done",a),i.syncing?i.cacheSyncedSession(a):t&&i.onUpdateSession(a),o.updateSession(a)})).catch((function(e){i.logger.error("markUnreadBySessionAck::error",e)}))}));else{var a=i.findSession(r);if(a){var s=a.unreadMsgs;if(s&&s.length){for(var c=0,u=[],l=s.length-1;l>=0;l--){var d=s[l];if(!(d.time>n))break;c++,u.push(d)}a.unreadMsgs=u,a.unread=c,i.logger.info("session::markUnreadBySessionAck: unread ".concat(c)),i.syncing?i.cacheSyncedSession(a):t&&i.onUpdateSession(a)}}}}},function(e,t,r){var n=r(30).fn;n.processChatroom=function(e){"getChatroomAddress"===e.cmd&&this.onChatroomAddress(e)},n.onChatroomAddress=function(e){e.error||(e.obj.address=e.content.address)}},function(e,t,r){r(30).fn.processFilter=function(e){switch(e.cmd){case"sendFilterMsg":this.onSendMsg(e,!0);break;case"filterMsg":this.onMsg(e,!0);break;case"filterSysMsg":this.onSysMsg(e,!0);break;case"sendFilterCustomSysMsg":this.onSendSysMsg(e,!0)}}},function(e,t,r){var n=r(8),i=r(40),o=r(30).fn,a=r(0),s=i.clientTypeMap;function c(e){e=e||{};var t=a.copy(e);return t.clientType&&(t.clientType=s[t.clientType]||""),t.serverCustom&&(t.custom=JSON.parse(t.serverCustom),"string"==typeof t.custom[0]&&(t.custom=t.custom[0]),delete t.serverCustom),t}o.processEventService=function(e){var t=e.content,r=e.error,i=this.options||{};switch(r&&(r.callFunc="events::processsEventService",this.onCustomError("事件服务解包失败","EVENT_SERVICE_ERROR",r)),e.cmd){case"pushEvent":if(a.isFunction(i.onpushevents)){var o={msgEvents:[c(t.msgEvent)]};i.onpushevents(o)}break;case"pushEvents":if(a.isFunction(i.onpushevents)){var s=t.msgEvents;s={msgEvents:n(s).call(s,(function(e){return c(e)}))},i.onpushevents(s)}}}},function(e,t,r){var n=r(30).fn,i=r(0);n.processProxyService=function(e){var t=e.error;switch(t&&(t.callFunc="events::processProxyService",this.onCustomError("proxyService","EVENT_PROXY_SERVICE_ERROR",t)),e.cmd){case"onProxyMsg":if(i.isFunction(this.options.onProxyMsg)){var r=e.content.proxyMsg||{};r.time&&(r.time=+r.time),this.options.onProxyMsg(r)}break;case"httpProxy":e.obj=e.content&&e.content.proxyTag}}},function(e,t,r){var n=r(5),i=r(8),o=r(0),a=function(e){this.account=e.account},s=a.prototype,c=s.Message=r(81),u=s.TextMessage=r(556),l=s.FileMessage=r(155),d=s.GeoMessage=r(560),p=s.NotificationMessage=r(561),f=s.CustomMessage=r(562),h=s.TipMessage=r(563),m=s.RobotMessage=r(564),g=s.G2Message=r(565);s.validScenes=c.validScenes,s.validTypes=c.validTypes,s.sceneMap=c.sceneMap,s.sceneReverseMap=c.sceneReverseMap,s.reverse=function(e){var t;switch(c.getType(e)){case"text":t=n(u).call(u,e);break;case"image":case"audio":case"video":case"file":t=n(l).call(l,e);break;case"geo":t=n(d).call(d,e);break;case"notification":t=n(p).call(p,e);break;case"custom":t=n(f).call(f,e);break;case"tip":t=n(h).call(h,e);break;case"g2":t=n(g).call(g,e);break;case"robot":t=n(m).call(m,e);break;default:t=n(c).call(c,e)}return c.setExtra(t,this.account),t},s.reverseMsgs=function(e,t){var r,a,s=this;return i(e).call(e,(function(e){return e=n(s).call(s,e),t&&((r=t.modifyObj)&&(e=o.merge(e,r)),a=t.mapper,o.isFunction(a)&&(e=a(e))),e}))},e.exports=a},function(e,t,r){var n=r(14),i=r(5),o=r(81),a=r(0);function s(e){a.verifyOptions(e,"text","msg::TextMessage"),e.type="text",o.call(this,e)}s.prototype=n(o.prototype),s.reverse=function(e){return i(o).call(o,e)},e.exports=s},function(e,t,r){var n=r(14),i=(r(0),r(155));function o(){}o.prototype=n(i.prototype),o.verifyFile=function(e,t){return!0},e.exports=o},function(e,t,r){var n=r(14),i=r(155),o=r(0);function a(){}a.prototype=n(i.prototype),a.verifyFile=function(e,t){o.verifyOptions(e,"dur",!0,"file.",t)},e.exports=a},function(e,t,r){var n=r(14),i=r(155),o=r(0);function a(){}a.prototype=n(i.prototype),a.verifyFile=function(e,t){o.verifyOptions(e,"dur w h",!0,"file.",t)},e.exports=a},function(e,t,r){var n=r(11),i=r(14),o=r(5),a=r(81),s=r(0);function c(e){e.type="geo",s.verifyOptions(e,"geo","msg::GeoMessage"),s.verifyOptions(e.geo,"lng lat title",!0,"geo.","msg::GeoMessage"),s.verifyParamType("geo.lng",e.geo.lng,"number","msg::GeoMessage"),s.verifyParamType("geo.lat",e.geo.lat,"number","msg::GeoMessage"),s.verifyParamType("geo.title",e.geo.title,"string","msg::GeoMessage"),a.call(this,e),this.attach=n(e.geo)}c.prototype=i(a.prototype),c.reverse=function(e){var t=o(a).call(a,e);return e.attach=e.attach?""+e.attach:"",t.geo=e.attach?JSON.parse(e.attach):{},t},e.exports=c},function(e,t,r){var n=r(14),i=r(5),o=r(8),a=r(114),s=r(0).notundef,c=r(81),u=r(110).IM,l=r(142),d=r(154),p={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function f(){}f.prototype=n(c.prototype),f.reverse=function(e){var t=i(c).call(c,e);if(e.attach=e.attach?""+e.attach:"",e.attach){var r=JSON.parse(e.attach);if(t.attach={type:p[r.id]||r.id},s(r.data)){var n,f,h=r.data;s(h.tinfo)&&(t.attach.team=i(l).call(l,u.syncUnserialize(h.tinfo,"team"),!0)),s(h.ids)&&(t.attach.accounts=h.ids),s(h.id)&&(t.attach.account=h.id),s(h.uinfos)&&(t.attach.users=o(n=h.uinfos).call(n,(function(e){return i(d).call(d,u.syncUnserialize(e,"user"))}))),s(h.mute)&&(t.attach.mute=1==+h.mute),s(h.attach)&&(t.attach.custom=h.attach),s(h.channel)&&(t.attach.channelId=h.channel),s(h.calltype)&&(t.attach.netcallType=h.calltype),s(h.duration)&&(t.attach.duration=h.duration),s(h.time)&&(t.attach.time=h.time),s(h.from)&&(t.attach.from=h.from),s(h.ext)&&(t.attach.ext=h.ext),t.attach.accounts&&t.attach.accounts.length<=2&&t.from===t.to&&a(f=t.attach.accounts).call(f,(function(e){if(e!==t.to)return t.to=e,!0}))}}else t.attach={};return t},e.exports=f},function(e,t,r){var n=r(14),i=r(5),o=r(81),a=r(0);function s(e){a.verifyOptions(e,"content","msg::CustomMessage"),e.type="custom",o.call(this,e),this.attach=e.content}s.prototype=n(o.prototype),s.reverse=function(e){var t=i(o).call(o,e);return t.content=e.attach,t},e.exports=s},function(e,t,r){var n=r(14),i=r(5),o=r(81),a=r(0);function s(e){a.verifyOptions(e,"tip","msg::TipMessage"),e.type="tip",o.call(this,e),this.body=e.tip}s.prototype=n(o.prototype),s.reverse=function(e){var t=i(o).call(o,e);return t.text="",t.tip=e.body,e.attach&&(t.attach=e.attach),t},e.exports=s},function(e,t,r){var n=r(11),i=r(14),o=r(5),a=r(8),s=r(81),c=r(0),u={welcome:"00",text:"01",link:"03"},l={"01":"text","02":"image","03":"answer",11:"template"};function d(e){c.verifyOptions(e,"content","msg::RobotMessage"),c.undef(e.robotAccid)&&(e.robotAccid=e.to);var t=e.content;switch(t.type){case"welcome":c.undef(e.body)&&(this.body="欢迎消息");break;case"text":c.verifyOptions(t,"content","msg::RobotMessage"),c.undef(e.body)&&(this.body=t.content);break;case"link":c.verifyOptions(t,"target","msg::RobotMessage")}t.type&&(t.type=u[t.type]),t={param:t,robotAccid:e.robotAccid},this.attach=n(t),e.type="robot",s.call(this,e)}d.prototype=i(s.prototype),d.reverse=function(e){var t=o(s).call(s,e);if("robot"===t.type){var r=JSON.parse(e.attach);if(r.param&&(r.param.type=l[r.param.type]||"unknown"),r.robotMsg){var n=(r=c.merge(r,r.robotMsg)).message;"bot"===r.flag?r.message=a(n).call(n,(function(e){return e.type=l[e.type]||"unknown",e})):r.flag,delete r.robotMsg}t.content=r}return t},e.exports=d},function(e,t,r){var n=r(11),i=r(14),o=r(5),a=r(81),s=r(0);function c(e){s.verifyOptions(e,"attach","msg::G2Message"),e.type="g2",a.call(this,e),this.attach=n(e.attach)}c.prototype=i(a.prototype),c.reverse=function(e){var t=o(a).call(a,e);return e.attach&&(t.attach=JSON.parse(e.attach)),t},e.exports=c},function(e,t,r){var n=r(63),i=r(470),o=r(28),a=r(471),s=r(8),c=r(19),u=r(6),l=r(4),d=r(3),p=r(48),f=r(9),h=r(59),m=r(60),g=r(61),v=r(62),y=r(50);function b(e,t){var r=f(e);if(h){var n=h(e);t&&(n=c(n).call(n,(function(t){return m(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r,i=null!=arguments[t]?arguments[t]:{};if(t%2)d(r=b(Object(i),!0)).call(r,(function(t){n(e,t,i[t])}));else if(g)v(e,g(i));else{var o;d(o=b(Object(i))).call(o,(function(t){y(e,t,m(i,t))}))}}return e}var _=r(32).fn,M=r(0),T=M.isArray,w=r(116);_.mergeObjArray=function(e,t,r){return e||(e=[]),t?(T(t)||(t=[t]),t.length?(r=r||{},M.mergeObjArray(e,t,r)):e):e},_.cutObjArray=function(e,t,r){return e&&t?(T(t)||(t=[t]),t.length?(r=r||{},M.cutObjArray(e,t,r)):e):e},_.mergeLoginPorts=function(e,t){return this.mergeObjArray(e,t,{keyPath:"deviceId"})},_.cutLoginPorts=function(e,t){return this.cutObjArray(e,t,{keyPath:"deviceId",sortPath:"type"})},_.mergeRelations=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},_.cutRelations=function(e,t){return this.cutObjArray(e,t,{keyPath:"account"})},_.findRelation=function(e,t){return M.findObjInArray(e,{keyPath:"account",value:t})},_.mergeFriends=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},_.cutFriends=function(e,t){return this.cutObjArray(e,t,{keyPath:"account"})},_.cutFriendsByAccounts=function(e,t){T(t)||(t=[t]);var r=s(t).call(t,(function(e){return{account:e}}));return this.cutFriends(e,r)},_.findFriend=function(e,t){return M.findObjInArray(e,{keyPath:"account",value:t})},_.mergeUsers=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},_.findUser=function(e,t){return M.findObjInArray(e,{keyPath:"account",value:t})},_.mergeTeams=function(e,t){return this.mergeObjArray(e,t,{keyPath:"teamId"})},_.cutTeams=function(e,t){return this.cutObjArray(e,t,{keyPath:"teamId"})},_.findTeam=function(e,t){return M.findObjInArray(e,{keyPath:"teamId",value:t})},_.assembleTeamOwner=w.assembleOwner,_.assembleTeamMembers=w.assembleMembers,_.genTeamMemberId=w.genId,_.mergeTeamMembers=function(e,t){return this.mergeObjArray(e,t)},_.cutTeamMembers=function(e,t){return this.cutObjArray(e,t)},_.cutTeamMembersByAccounts=function(e,t,r){T(r)||(r=[r]);var n=w.assembleMembers({teamId:t},r);return this.cutTeamMembers(e,n)},_.findTeamMember=function(e,t){return M.findObjInArray(e,{keyPath:"id",value:t})},_.mergeSessions=function(e,t){return this.mergeObjArray(e,t,{sortPath:"updateTime",desc:!0})},_.cutSessions=function(e,t){return this.cutObjArray(e,t)},_.cutSessionsByIds=function(e,t){T(t)||(t=[t]);var r=s(t).call(t,(function(e){return{id:e}}));return this.cutSessions(e,r)},_.findSession=function(e,t){return M.findObjInArray(e,{keyPath:"id",value:t})},_.mergeMsgs=function(e,t){return this.mergeObjArray(e,t,{keyPath:"idClient",sortPath:"time"})},_.cutMsgs=function(e,t){return this.cutObjArray(e,t,{keyPath:"idClient"})},_.cutMsgsByIdClients=function(e,t){T(t)||(t=[t]);var r=s(t).call(t,(function(e){return{idClient:e}}));return this.cutMsgs(e,r)},_.findMsg=function(e,t){return M.findObjInArray(e,{keyPath:"idClient",value:t})},_.mergeSysMsgs=function(e,t){return this.mergeObjArray(e,t,{keyPath:"idServer",desc:!0})},_.cutSysMsgs=function(e,t){return this.cutObjArray(e,t,{keyPath:"idServer"})},_.cutSysMsgsByIdServers=function(e,t){T(t)||(t=[t]);var r=s(t).call(t,(function(e){return{idServer:e}}));return this.cutSysMsgs(e,r)},_.findSysMsg=function(e,t){return M.findObjInArray(e,{keyPath:"idServer",value:t})},_.searchLocal=function(e){if(M.verifyOptions(e,"keyword","searchLocal"),this.db.enable){var t,r=this,n=this.db,h=e.keyword+"",m=["account","nick","alias"],g=["id","scene","lastMsg.type","lastMsg.text","localCustom","target.account","target.nick","target.alias","target.name"],v="",y=e.keyPath;switch(y?(v=(y=(y+"").split(".")).shift(),y=y.join(".")):v="all",v){case"user":y&&(m=c(m).call(m,(function(e){return e===y||0===u(e).call(e,y+".")}))),T(m).then((function(t){e.done(null,{sessions:[],users:t})}));break;case"session":y&&(g=c(g).call(g,(function(e){return e===y||0===u(e).call(e,y+".")}))),b(g,!y||u(y).call(y,"target")>-1).then((function(t){e.done(null,{sessions:t,users:[]})}));break;case"all":x().then((function(){l.all([b(g,!0),T(m)]).then((function(t){e.done(null,{sessions:t[0],users:t[1]})}))}));break;default:e.done(null,{sessions:[],users:[],msg:'keyPath must start with "user" or "session"'})}}else e.done(null,{sessions:[],users:[],msg:"no db"});function b(e,t){return _.apply(this,arguments)}function _(){return(_=a(i.mark((function e(t,r){var o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r?[n.getSessions(),x(),n.getTeams(),n.getSuperTeams()]:[n.getSessions()],e.abrupt("return",l.all(o).then((function(e){var n,i=e[0]||[],o={p2p:e[1]||[],team:e[2]||[],superTeam:e[3]||[]},a={};return r&&(d(n=f(o)).call(n,(function(e){var t;d(t=o[e]).call(t,(function(t){var r=t.teamId||t.account;a[e+"-"+r]=t}))})),d(i).call(i,(function(e){e.target=a[e.id]}))),E(t,i)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return w.apply(this,arguments)}function w(){return(w=a(i.mark((function e(t){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x();case 2:return r=e.sent,e.abrupt("return",E(t,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return I.apply(this,arguments)}function I(){return(I=a(i.mark((function e(){var n,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,r.db.getFriends();case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0=[];case 7:return n=e.t0,o=r.protocol.userSet||{},t=s(n).call(n,(function(e){return S(S({},e),o[e.account])})),e.abrupt("return",t);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){var r=[];return d(t).call(t,(function(t){for(var n=0;n<e.length;n++){var i=A(t,e[n].split("."));if(i&&u(i).call(i,h)>-1){r.push(p({},t));break}}})),r}function A(e,t){if("object"===o(e)&&e)return 1===t.length?e[t[0]]:A(e[t.shift()],t)}}},function(e,t,r){var n=r(16),i=r(32).fn,o=r(0);i.kick=function(e){var t;o.verifyOptions(e,"deviceIds","link::kick"),this.processCallback(e),this.sendCmd("kick",{deviceIds:n(t=e.deviceIds).call(t,0)},e.callback)}},function(e,t,r){var n=r(32).fn,i=r(0);n.markInBlacklist=function(e){i.verifyOptions(e,"account isAdd","relation::markInBlacklist"),i.verifyParamType("isAdd",e.isAdd,"boolean","relation::markInBlacklist"),this.processCallback(e),this.sendCmd("markInBlacklist",{account:e.account,isAdd:e.isAdd},e.callback)},n.addToBlacklist=function(e){return e.isAdd=!0,this.markInBlacklist(e)},n.removeFromBlacklist=function(e){return e.isAdd=!1,this.markInBlacklist(e)},n.markInMutelist=function(e){i.verifyOptions(e,"account","relation::markInMutelist"),i.verifyParamType("isAdd",e.isAdd,"boolean","relation::markInMutelist"),this.processCallback(e),this.sendCmd("markInMutelist",{account:e.account,isAdd:e.isAdd},e.callback)},n.addToMutelist=function(e){return e.isAdd=!0,this.markInMutelist(e)},n.removeFromMutelist=function(e){return e.isAdd=!1,this.markInMutelist(e)},n.getRelations=function(e){var t=this,r=t.db,n=0;function o(){t.sendCmd("getRelations",{timetag:n,NOTSTORE:"timetag"},e.callback)}e=i.verifyOptions(e),t.processCallback(e),r.enable?r.getRelationsTimetag().then((function(e){n=e,o()}),o):o()}},function(e,t,r){var n=r(10),i=r(3),o=r(6),a=r(32).fn,s=r(0),c=s.objs2accounts,u=r(154);a.updateMyInfo=function(e){s.verifyOptions(e),this.processCallback(e),e.user=new u(e),delete e.user.account,this.sendCmd("updateMyInfo",{user:e.user,antispamTag:{antiSpamBusinessId:e.antiSpamBusinessId},single:!0},e.callback)},a.getMyInfo=function(e){return(e=e||{}).account=this.account,this.getUser(e)},a.getUser=function(e){var t,r=this,n=r.db;function i(){r.sendCmd("getUsers",{accounts:[t],single:!0},e.callback)}s.verifyOptions(e,"account","user::getUser"),r.processCallback(e),e.cbaop=function(e,n){if(!e)return n=n[0]||null,r.logger.info("api::getUser: cbaop ".concat(t)),n},t=e.account,e.sync?i():n.enable?n.getUser(t).then((function(t){t?e.done(null,t):i()}),i):i()},a.getUsers=function(e){var t,r=this,a=r.db,u=[];function l(){r.sendCmd("getUsers",{accounts:t,single:!0},e.callback)}s.verifyOptions(e,"accounts","user::getUsers"),s.verifyParamType("accounts",e.accounts,"array","user::getUsers"),r.processCallback(e),e.cbaop=function(e,i){if(!e)return i=n(i).call(i,u),r.logger.info("api::getUsers: cbaop ".concat(t)),i},t=s.deduplicate(e.accounts),s.verifyArrayMax("accounts",e.accounts,150,"user::getUsers"),e.sync?l():a.enable?a.getUsers(t).then((function(r){if(r&&r.length===t.length)e.done(null,r);else{u=r;var n=c(r),a=[];i(t).call(t,(function(e){-1===o(n).call(n,e)&&a.push(e)})),t=a,l()}}),l):l()}},function(e,t,r){var n=r(104),i=r(32).fn,o=r(0),a=o.notundef,s=r(466);i.friendRequest=function(e){o.verifyOptions(e,"type account","friend::friendRequest"),o.verifyParamValid("type",e.type,s.validTypes(),"friend::friendRequest"),this.processPs(e),this.processCallback(e);var t={account:e.account,type:s.getByteFromType(e.type),ps:e.ps};a(e.idServer)&&(t.idServer=e.idServer),this.sendCmd("friendRequest",t,e.callback)},i.addFriend=function(e){e.type="addFriend",this.friendRequest(e)},i.applyFriend=function(e){e.type="applyFriend",this.friendRequest(e)},i.passFriendApply=function(e){o.verifyOptions(e,"idServer","friend::passFriendApply"),e.type="passFriendApply",this.friendRequest(e)},i.rejectFriendApply=function(e){o.verifyOptions(e,"idServer","friend::rejectFriendApply"),e.type="rejectFriendApply",this.friendRequest(e)},i.deleteFriend=function(e){o.verifyOptions(e,"account","friend::deleteFriend");var t=!0===e.delAlias;this.processCallback(e),this.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:t?1:0}},e.callback)},i.updateFriend=function(e){this.processCallback(e);var t=new s(e);this.sendCmd("updateFriend",{friend:t,single:!0},e.callback)},i.getFriends=function(e){var t=this.db;o.validate({timetag:{type:"number",required:!1}},e,"friend::getFriends"),this.processCallback(e),t.enable?t.getFriends({updateTime:e.updateTime||0}).then((function(t){(t=n(t).call(t,(function(e,t){return e.updateTime-t.updateTime}))).invalid=[],e.done(null,t)})):this.sendCmd("getFriends",{timetag:e.updateTime||0,NOTSTORE:"timetag"},e.callback)},i.isMyFriend=function(e){var t=this.db;o.validate({account:{type:"string",allowEmpty:!1,require:!0}},e),this.processCallback(e),t.enable||e.done(null,!1),t.getFriend(e.account).then((function(t){t&&!0===t.valid?e.done(null,!0):e.done(null,!1)}))},i.isUserInBlackList=function(e){var t=this.db;o.validate({account:{type:"string",allowEmpty:!1,require:!0}},e),this.processCallback(e),t.enable||e.done(null,!1),t.getUserFromBlackList(e.account).then((function(t){t&&t.account?e.done(null,!0):e.done(null,!1)}))}},function(e,t,r){r(32).fn.getRobots=function(e){(e=e||{}).type="getRobots",this.processCallback(e),this.sendCmd("sync",{sync:{robots:0}},e.callback)}},function(e,t,r){var n=r(16),i=r(8),o=r(19),a=r(4),s=r(32).fn,c=r(0),u=c.undef,l=r(142),d=r(116);s.createTeam=function(e){var t;c.verifyOptions(e,"type name","team::createTeam"),u(e.accounts)?e.accounts=[]:c.verifyParamType("accounts",e.accounts,"array","team::createTeam"),e.action="create",this.processPs(e),this.processCallback(e),e.team=new l(e);var r={team:e.team,accounts:n(t=e.accounts).call(t,0),ps:e.ps,antispamTag:{antiSpamBusinessId:e.antiSpamBusinessId}};this.sendCmd("createTeam",r,e.callback)},s.updateTeam=function(e){c.verifyOptions(e,"teamId","team::updateTeam"),e.action="update",this.processCallback(e),e.team=new l(e),this.sendCmd("updateTeam",{team:e.team,antispamTag:{antiSpamBusinessId:e.antiSpamBusinessId},single:!0},e.callback)},s.addTeamMembers=function(e){var t;c.verifyOptions(e,"teamId accounts","team::addTeamMembers"),c.verifyParamType("accounts",e.accounts,"array","team::addTeamMembers"),this.processPs(e),c.notexist(e.custom)&&(e.custom=""),this.processCallback(e);var r={teamId:e.teamId,accounts:n(t=e.accounts).call(t,0),ps:e.ps,attach:e.custom};this.sendCmd("addTeamMembers",r,e.callback)},s.removeTeamMembers=function(e){var t;c.verifyOptions(e,"teamId accounts","team::removeTeamMembers"),c.verifyParamType("accounts",e.accounts,"array","team::removeTeamMembers"),this.processCallback(e);var r={teamId:e.teamId,accounts:n(t=e.accounts).call(t,0)};this.sendCmd("removeTeamMembers",r,e.callback)},s.acceptTeamInvite=function(e){c.verifyOptions(e,"idServer teamId from","team::acceptTeamInvite"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("acceptTeamInvite",t,e.callback)},s.rejectTeamInvite=function(e){c.verifyOptions(e,"idServer teamId from","team::rejectTeamInvite"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectTeamInvite",t,e.callback)},s.applyTeam=function(e){c.verifyOptions(e,"teamId","team::applyTeam"),this.processPs(e),this.processCallback(e);var t={teamId:e.teamId,ps:e.ps};this.sendCmd("applyTeam",t,e.callback)},s.passTeamApply=function(e){c.verifyOptions(e,"idServer teamId from","team::passTeamApply"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("passTeamApply",t,e.callback)},s.rejectTeamApply=function(e){c.verifyOptions(e,"idServer teamId from","team::rejectTeamApply"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectTeamApply",t,e.callback)},s.addTeamManagers=function(e){var t;c.verifyOptions(e,"teamId accounts","team::addTeamManagers"),c.verifyParamType("accounts",e.accounts,"array","team::addTeamManagers"),this.processCallback(e);var r={teamId:e.teamId,accounts:n(t=e.accounts).call(t,0)};this.sendCmd("addTeamManagers",r,e.callback)},s.removeTeamManagers=function(e){var t;c.verifyOptions(e,"teamId accounts","team::removeTeamManagers"),c.verifyParamType("accounts",e.accounts,"array","team::removeTeamManagers"),this.processCallback(e);var r={teamId:e.teamId,accounts:n(t=e.accounts).call(t,0)};this.sendCmd("removeTeamManagers",r,e.callback)},s.updateInfoInTeam=function(e){c.verifyOptions(e,"teamId","team::updateInfoInTeam"),this.processCallback(e),this.sendCmd("updateInfoInTeam",{teamMember:new d(e),single:!0},e.callback)},s.updateNickInTeam=function(e){c.verifyOptions(e,"teamId account","team::updateNickInTeam"),this.processCallback(e),this.sendCmd("updateNickInTeam",{teamMember:new d(e),single:!0},e.callback)},s.updateMuteStateInTeam=function(e){c.verifyOptions(e,"teamId account mute","team::updateMuteStateInTeam"),this.processCallback(e),e.mute=e.mute?1:0,this.sendCmd("updateMuteStateInTeam",e)},s.getMutedTeamMembers=function(e){c.verifyOptions(e,"teamId","team::getMutedTeamMembers"),this.processCallback(e),this.sendCmd("getMutedTeamMembers",e)},s.leaveTeam=function(e){c.verifyOptions(e,"teamId","team::leaveTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("leaveTeam",t,e.callback)},s.transferTeam=function(e){c.verifyOptions(e,"teamId account leave","team::transferTeam"),c.verifyParamType("leave",e.leave,"boolean","team::transferTeam"),this.processCallback(e);var t={teamId:e.teamId,account:e.account,leave:e.leave};this.sendCmd("transferTeam",t,e.callback)},s.dismissTeam=function(e){c.verifyOptions(e,"teamId","team::dismissTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("dismissTeam",t,e.callback)},s.getTeam=function(e){var t,r=this,n=r.db;function i(){r.sendCmd("getTeam",{teamId:e.teamId},e.callback)}c.verifyOptions(e,"teamId","team::getTeam"),r.processCallback(e),e.cbaop=function(e,n){e||r.logger.info("api::getTeam: cbaop ".concat(t))},t=e.teamId,n.enable&&!e.sync?n.getTeam(t).then((function(n){n&&n.validToCurrentUser?(r.logger.log("api::getTeam: db.getTeam ".concat(t)),e.done(null,n)):i()}),i):i()},s.getTeams=function(e){var t=this,r=t.db,n=0;function i(){t.sendCmd("getTeams",{timetag:n,NOTSTORE:"timetag"},e.callback)}c.verifyOptions(e),t.processCallback(e),r.enable?r.getTeamsTimetag().then((function(e){n=e,i()}),i):i()},s.getTeamsById=function(e){c.verifyOptions(e,"teamIds","teams::getTeamsById"),this.processCallback(e),this.sendCmd("getTeamsById",{teamIds:e.teamIds},e.callback)},s.getTeamMembers=function(e){c.verifyOptions(e,"teamId","team::getTeamMembers"),this.processCallback(e),this.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0,NOTSTORE:"timetag"},e.callback)},s.getTeamMemberByTeamIdAndAccount=function(e){c.verifyParamType("teamId",e.teamId,"numeric or numeric string","team::getTeamMemberByTeamIdAndAccount"),c.verifyOptions(e,"account","team::getTeamMemberByTeamIdAndAccount"),this.processCallback(e),this.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0,NOTSTORE:"timetag"},(function(t,r,n){var i={};if(r&&r.members&&r.members.length)for(var o=0;o<r.members.length;o++)if(r.members[o].account===e.account){i[e.account]=r.members[o];break}e.callback(t,i,n)}))},s.getTeamMemberInvitorAccid=function(e){c.verifyParamType("teamId",e.teamId,"numeric or numeric string","team::getTeamMemberInvitorAccid"),u(e.accounts)||(c.verifyParamType("accounts",e.accounts,"array","team::getTeamMemberInvitorAccid"),e.accounts.length>200&&c.onParamError("accounts 参数数组长度不能超过200","team::getTeamMemberInvitorAccid"));var t,r={teamId:e.teamId};e.accounts.length&&(r.accounts=n(t=e.accounts).call(t,0)),this.processCallback(e),this.sendCmd("getTeamMemberInvitorAccid",r,(function(t,r,n){e.callback(t,n&&n.accountsMap||{})}))},s.notifyForNewTeamMsg=function(e){c.verifyOptions(e,"teamIds","team::notifyForNewTeamMsg"),this.protocol.notifyForNewTeamMsg(e.teamIds).then((function(t){e.done(t.error||null,i(t),t.miss)}),(function(t){e.done(t)}))},s.getMyTeamMembers=function(e){c.verifyOptions(e,"teamIds","team::getMyTeamMembers");var t=this.processCallbackPromise(e);return this.sendCmd("getMyTeamMembers",e),t},s.getLocalTeams=function(e){var t,r=this.db,n=[];function i(){e.teams=n,e.done(t,e)}c.verifyOptions(e,"teamIds","team::getLocalTeams"),c.verifyParamType("teamIds",e.teamIds,"array","team::getLocalTeams"),this.processCallback(e),r.enable?r.getTeamsByTeamIds(e.teamIds).then((function(e){n=o(e).call(e,(function(e){return!!e})),i()}),(function(e){t=e,i()})):i()},s.getLocalTeamMembers=function(e){var t,r=this.db,n=[];function i(){e.members=n,e.done(t,e)}c.verifyOptions(e,"teamId accounts","team::getLocalTeamMembers"),c.verifyParamType("accounts",e.accounts,"array","team::getLocalTeamMembers"),this.processCallback(e),r.enable?r.getInvalidTeamMembers(e.teamId,e.accounts).then((function(e){n=o(e).call(e,(function(e){return!!e})),i()}),(function(e){t=e,i()})):i()},s.deleteLocalTeam=function(e){var t,r=this.db;function n(){e.done(t,e)}c.verifyOptions(e,"teamId","team::deleteLocalTeam"),this.processCallback(e),r.enable?r.deleteTeam(e.teamId).then((function(){n()}),(function(e){t=e,n()})):n()},s.muteTeamAll=function(e){c.verifyOptions(e,"teamId mute","team::muteTeamAll"),e.mute=e.mute?1:0,this.processCallback(e),this.sendCmd("muteTeamAll",e)},s.sendTeamMsgReceipt=function(e){c.verifyOptions(e,"teamMsgReceipts","team::sendTeamMsgReceipt"),e.teamMsgReceipts.length>50?this.logger.error("team::sendTeamMsgReceipt：teamMsgReceipts length over 50"):(this.processCallback(e),this.sendCmd("sendTeamMsgReceipt",e))},s.getTeamMsgReads=function(e){c.verifyOptions(e,"teamMsgReceipts","team::getTeamMsgReads"),this.processCallback(e),this.sendCmd("getTeamMsgReads",e)},s.getTeamMsgReadAccounts=function(e){var t,r=this,n=this;c.verifyOptions(e,"teamMsgReceipt","team::getTeamMsgReadAccounts"),e.callback=function(r,n,i){r&&t?(n=n||{teamMsgReceipt:e.teamMsgReceipt},e.done(r,n,{teamMsgReceipt:e.teamMsgReceipt,unreadAccounts:t.unreadAccounts,readAccounts:t.readAccounts})):e.done(r,n,i)},this.db.enable&&e.teamMsgReceipt.idClient?this.db.getMsgReadDetail(e.teamMsgReceipt.idClient).then((function(r){if(t=r,!r)return a.reject("no record");if(r.unreadAccounts&&r.unreadAccounts.length>0)return a.reject("unreadAccounts.length > 0");var i={teamMsgReceipt:e.teamMsgReceipt,unreadAccounts:r.unreadAccounts,readAccounts:r.readAccounts};n.logger.info("getTeamMsgReadAccounts from db"),e.done(null,{teamMsgReceipt:e.teamMsgReceipt},i)})).catch((function(t){r.logger.warn("db.getMsgReadDetail invalid",t),n.sendCmd("getTeamMsgReadAccounts",e)})):n.sendCmd("getTeamMsgReadAccounts",e)}},function(e,t,r){var n=r(151),i=r(4),o=r(5),a=r(23),s=r(16),c=r(8),u=r(3),l=r(10),d=r(32).fn,p=r(0),f=p.undef,h=r(221),m=r(152);function g(e){var t=this.db;if(!t.enable)return i.resolve({valid:!1});var r=t.getSuperTeam(e),o=t.getSuperTeamMembersTimetag(e);return i.all([r,o]).then((function(e){var t=n(e,2),r=t[0],o=t[1],a=r&&r.memberUpdateTime,s={timetag:o=o||0};return a&&o>=a&&(s.valid=!0),i.resolve(s)})).catch((function(){return i.resolve({timetag:0})}))}d.addSuperTeamMembers=function(e){p.verifyOptions(e,"teamId accounts","superTeam::addSuperTeamMembers"),p.verifyParamType("accounts",e.accounts,"array","superTeam::addSuperTeamMembers");var t=p.deduplicate(e.accounts);this.processPs(e),this.processCallback(e);var r={teamId:e.teamId,accounts:t,ps:e.ps};this.sendCmd("addSuperTeamMembers",r,e.callback)},d.removeSuperTeamMembers=function(e){p.verifyOptions(e,"teamId accounts","team::removeSuperTeamMembers"),p.verifyParamType("accounts",e.accounts,"array","team::removeSuperTeamMembers");var t=p.deduplicate(e.accounts);this.processCallback(e);var r={teamId:e.teamId,accounts:t};this.sendCmd("removeSuperTeamMembers",r,e.callback)},d.leaveSuperTeam=function(e){p.verifyOptions(e,"teamId","superTeam::leaveSuperTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("leaveSuperTeam",t,e.callback)},d.getSuperTeam=function(e){var t,r=this,n=r.db;function i(){r.sendCmd("getSuperTeam",{teamId:e.teamId},e.callback)}p.verifyOptions(e,"teamId","team::getSuperTeam"),r.processCallback(e),e.cbaop=function(e,n){e||r.logger.info("api::getSuperTeam: cbaop ".concat(t))},t=e.teamId,n.enable&&!e.sync?n.getSuperTeam(t).then((function(n){n&&n.validToCurrentUser?(r.logger.log("api::getSuperTeam: db.getSuperTeam ".concat(t)),e.done(null,n)):i()})).catch((function(e){i()})):i()},d.getSuperTeams=function(e){var t=this,r=t.db,n=0;function i(){t.sendCmd("getSuperTeams",{timetag:n,NOTSTORE:"timetag"},e.callback)}p.verifyOptions(e),t.processCallback(e),r.enable?r.getSuperTeamsTimetag().then((function(e){n=e,i()}),i):i()},d.updateSuperTeam=function(e){p.verifyOptions(e,"teamId","superTeam::updateSuperTeam"),e.action="update",this.processCallback(e),e.team=new h(e),this.sendCmd("updateSuperTeam",{team:e.team,antispamTag:{antiSpamBusinessId:e.antiSpamBusinessId},single:!0},e.callback)},d.updateInfoInSuperTeam=function(e){p.verifyOptions(e,"teamId","superTeam::updateInfoInSuperTeam"),this.processCallback(e),this.sendCmd("updateInfoInSuperTeam",{superTeamMember:new m(e),single:!0},e.callback)},d.getSuperTeamMembersByJoinTime=function(e){var t=this,r=(t.db,e.joinTime),n=o(e),i=e.limit,a=e.teamId;n=!!n,f(r)&&(r=0),f(i)&&(i=100),p.verifyOptions(e,"teamId","superTeam::getSuperTeamMembersByJoinTime"),p.verifyParamType("joinTime",r,"number","api::superTeam::getSuperTeamMembersByJoinTime"),p.verifyParamType("limit",i,"number","api::superTeam::getSuperTeamMembersByJoinTime"),t.processCallback(e),t.sendCmd("getSuperTeamMembersByJoinTime",{teamId:a,limit:i,joinTime:r,reverse:n,timetag:0,NOTSTORE:"timetag"},e.callback)},d.getAllSuperTeamMembers=function(e){var t=this,r=this.db;function n(r){r=r||0,t.sendCmd("getSuperTeamMembers",{teamId:e.teamId,timetag:r,NOTSTORE:"timetag"},e.callback)}p.verifyOptions(e,"teamId","superTeam::getAllSuperTeamMembers"),t.processCallback(e),a(g).call(g,this)(e.teamId).then((function(i){var o=i.valid,a=i.timetag;o?(t.logger.info("getAllSuperTeamMembers from local db"),r.getSuperTeamMembers(e.teamId).then((function(t){var r={teamId:e.teamId,members:t};e.done(null,r)}),(function(){return n()}))):n(a)}))},d.applySuperTeam=function(e){p.verifyOptions(e,"teamId","team::applySuperTeam"),p.verifyOptions(e,"teamId","team::applySuperTeam"),this.processPs(e),this.processCallback(e);var t={teamId:e.teamId,ps:e.ps};this.sendCmd("applySuperTeam",t,e.callback)},d.passSuperTeamApply=function(e){p.verifyOptions(e,"idServer teamId from","team::passSuperTeamApply"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("passSuperTeamApply",t,e.callback)},d.rejectSuperTeamApply=function(e){p.verifyOptions(e,"idServer teamId from","team::rejectSuperTeamApply"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectSuperTeamApply",t,e.callback)},d.acceptSuperTeamInvite=function(e){p.verifyOptions(e,"idServer teamId from","team::acceptSuperTeamInvite"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("acceptSuperTeamInvite",t,e.callback)},d.rejectSuperTeamInvite=function(e){p.verifyOptions(e,"idServer teamId from","team::rejectSuperTeamInvite"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectSuperTeamInvite",t,e.callback)},d.addSuperTeamManagers=function(e){var t;p.verifyOptions(e,"teamId accounts","team::addSuperTeamManagers"),p.verifyParamType("accounts",e.accounts,"array","team::addSuperTeamManagers"),this.processCallback(e);var r={teamId:e.teamId,accounts:s(t=e.accounts).call(t,0)};this.sendCmd("addSuperTeamManagers",r,e.callback)},d.removeSuperTeamManagers=function(e){var t;p.verifyOptions(e,"teamId accounts","team::removeSuperTeamManagers"),p.verifyParamType("accounts",e.accounts,"array","team::removeSuperTeamManagers"),this.processCallback(e);var r={teamId:e.teamId,accounts:s(t=e.accounts).call(t,0)};this.sendCmd("removeSuperTeamManagers",r,e.callback)},d.updateSuperTeamMembersMute=function(e){p.verifyOptions(e,"teamId accounts mute","team::updateSuperTeamMembersMute"),p.verifyParamType("accounts",e.accounts,"array","team::updateSuperTeamMembersMute"),p.verifyArrayMax("accounts",e.accounts,10),this.processCallback(e),e.mute=e.mute?1:0,this.sendCmd("updateSuperTeamMembersMute",e)},d.updateSuperTeamMute=function(e){p.verifyOptions(e,"teamId mute","team::updateSuperTeamMute"),e.mute=e.mute?1:0,this.processCallback(e),this.sendCmd("updateSuperTeamMute",e)},d.updateNickInSuperTeam=function(e){p.verifyOptions(e,"teamId account","team::updateNickInSuperTeam"),this.processCallback(e),this.sendCmd("updateNickInSuperTeam",{superTeamMember:new m(e),single:!0},e.callback)},d.transferSuperTeam=function(e){p.verifyOptions(e,"teamId account leave","team::transferSuperTeam"),p.verifyParamType("leave",e.leave,"boolean","team::transferSuperTeam"),this.processCallback(e);var t={teamId:e.teamId,account:e.account,leave:e.leave};this.sendCmd("transferSuperTeam",t,e.callback)},d.getSuperTeamMembersByAccounts=function(e){var t=this,r=this.db,n=e.teamId,o=e.accounts;if(p.verifyOptions(e,"teamId accounts","superTeam::getSuperTeamMembersByAccounts"),p.verifyParamType("accounts",o,"array","superTeam::getSuperTeamMembersByAccounts"),p.verifyArrayMax("accounts",o,20),o.length<=0)return p.onParamError("参数accounts不能为空数组","superTeam::getSuperTeamMembersByAccounts");function a(){var r=c(o).call(o,(function(e){return n+"|"+e}));t.processCallback(e),t.sendCmd("getSuperTeamMembersByAccounts",{memberIds:r},(function(t,r){e.done(null,{accounts:o,members:r.members,invaldAccounts:r.invalid})}))}g.call(this,n).then((function(t){var s,c,d;return t.valid?(s=[],c=[],d=[],u(o).call(o,(function(e){var t,i=r.getSuperTeamMemberById(l(t="".concat(n,"-")).call(t,e)).then((function(e){c.push(e)})).catch((function(){d.push(e)}));s.push(i)})),void i.all(s).then((function(){e.done(null,{accounts:o,members:c,invaldAccounts:d})}))):a()})).catch((function(){return a()}))},d.getMutedSuperTeamMembers=function(e){var t=e.joinTime,r=o(e),n=e.limit,i=e.teamId;r=!!r,f(t)&&(t=0),f(n)&&(n=100),p.verifyOptions(e,"teamId","superTeam::getSuperTeamMembersByJoinTime"),p.verifyParamType("joinTime",t,"number","api::superTeam::getSuperTeamMembersByJoinTime"),p.verifyParamType("limit",n,"number","api::superTeam::getSuperTeamMembersByJoinTime"),this.processCallback(e),this.sendCmd("getMutedSuperTeamMembers",{teamId:i,limit:n,joinTime:t,reverse:r},e.callback)}},function(e,t,r){var n=r(8),i=r(3),o=r(4),a=r(10),s=r(5),c=r(16),u=r(29),l=r(19),d=r(6),p=r(32).fn,f=r(0),h=f.undef,m=f.notundef,g=r(203);function v(e,t){var r=this,n=[],s=[],c=this.db,u=this;return c.enable?(i(e).call(e,(function(e){var t=r.protocol.findSession(e);t?l(t):s.push(c.getSession(e).then((function(e){return l(e)})))})),o.all(s).then((function(){return n}))):(i(e).call(e,(function(e){return l(r.protocol.findSession(e))})),o.resolve(n));function l(e){var r,i,o,s;e?e.lastMsg?e.scene&&e.to?e.ack>=e.lastMsg.time?u.logger.warn(a(r="".concat(t," not need ack ")).call(r,e.id)):n.push(e):u.logger.warn(a(i="".concat(t," session.scene|to undefined ")).call(i,e.id)):u.logger.warn(a(o="".concat(t," session.lastMsg undefined ")).call(o,e.id)):u.logger.warn(a(s="".concat(t," session undefined ")).call(s,e.id))}}p.setCurrSession=function(e){this.resetSessionUnread(e),this.protocol.setCurrSession(e)},p.resetAllSessionUnread=function(){for(var e in this.protocol.sessionSet)this.protocol.sessionSet[e].unread>0&&this.resetSessionUnread(e)},p.resetSessionsUnread=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this;r.logger.info("resetSessionsUnread::",e),v.call(this,e,"api::resetSessionsUnread").then((function(e){if(r.protocol.resetSessionsUnread(e),r.options.syncSessionUnread&&0!==e.length){var i=n(e).call(e,(function(e){return{scene:"p2p"===e.scene?0:1,to:e.to,timetag:e.lastMsg.time}}));r.sendCmd("markSessionAckBatch",{sessionAckTags:i},(function(e){t(e||null)}))}else t()}))},p.resetSuperTeamSessionsUnread=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this;r.logger.info("resetSuperTeamSessionsUnread::",e),v.call(this,e,"api::resetSuperTeamSessionsUnread").then((function(e){if(r.protocol.resetSessionsUnread(e),r.options.syncSessionUnread&&0!==e.length){var i=n(e).call(e,(function(e){return{to:e.to,timetag:e.lastMsg.time}}));r.sendCmd("markSuperTeamSessionsAck",{sessionAckTags:i},(function(e){t(e||null)}))}else t()}))},p.resetSessionUnread=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this,n=!1!==r.options.resetUnreadMode,i=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r?t(r,e):t(null)};r.logger.info("resetSessionUnread::use reset mode",n);var a=r.protocol.findSession(e);(!a&&this.db.enable?r.db.getSession(e):o.resolve(a)).then((function(t){return t?r.options.syncSessionUnread?(n&&r.protocol.resetSessionUnread(t),void function(t){if(!t.lastMsg)return r.logger.warn("api::resetSessionUnread: session.lastMsg undefined ".concat(e)),i();if(!t.scene||!t.to)return r.logger.warn("api::resetSessionUnread: session.scene|to undefined ".concat(e)),i();var o=t.lastMsg.time;if(t&&t.ack&&t.ack>=o)return r.logger.warn("api::resetSessionUnread: session ack not needs ".concat(e)),i();var a={done:function(e){e?(r.logger.error({message:e||"mark ack failed",callFunc:"resetSessionUnread"}),i(e||"mark ack failed")):(n||r.protocol.resetSessionUnread(t),i())}};if(r.processCallback(a),"superTeam"===t.scene)r.sendCmd("markSuperTeamSessionAck",{to:t.to,timetag:o},a.callback);else{var s={scene:"p2p"===t.scene?0:1,to:t.to,timetag:o};r.sendCmd("markSessionAck",s,a.callback)}}(t)):(r.protocol.resetSessionUnread(t),i()):(r.logger.warn("api::resetSessionUnread: session undefined ".concat(e)),i())}))},p.resetCurrSession=function(){this.protocol.setCurrSession("")},p.insertLocalSession=function(e){var t,r;function n(){e.session=r,e.done(t,e)}f.verifyOptions(e,"scene to","scene::insertLocalSession"),f.verifyParamValid("scene",e.scene,this.message.validScenes,"scene::insertLocalSession"),this.protocol.insertLocalSession(e).then((function(e){r=e,n()}),(function(e){t=e,n()}))},p.getLocalSessions=function(e){var t,r=this,n=r.db,i=[];function o(){e.sessions=i,delete e.callback,e.done(t,e)}f.verifyOptions(e),h(e.limit)&&(e.limit=100),f.verifyParamType("limit",e.limit,"number","scene::getLocalSessions"),f.verifyParamMax("limit",e.limit,100,"scene::getLocalSessions"),m(s(e))?f.verifyParamType("reverse",s(e),"boolean","scene::getLocalSessions"):e.reverse=!1,r.processCallback(e),n.enable?n.getSessions(e).then((function(e){i=e,r.protocol.mergeSessions(i),o()}),(function(e){t=e,o()})):o()},p.getLocalSession=function(e){var t,r=this.db,n=null;if(f.verifyOptions(e,"sessionId","scene::getLocalSession"),f.verifyParamType("sessionId",e.sessionId,"string","scene::getLocalSession"),r.enable)return this.processCallback(e),void r.getSession(e.sessionId).then((function(e){e&&(n=e),i()}),(function(e){t=e,i()}));function i(){e.done(t,n)}n=this.protocol.findSession(e.sessionId),i()},p.getLocalSessionsByMsgType=function(e){var t,r=this.db,a=e.exclude,s=[],p=c(t=g.validTypes).call(t,0);if(m(a)){if("string"==typeof a)a=[a];else if(!u(a))return void f.onParamInvalidType("exclude",["string","string array"],"","exclude::getLocalSessionsByMsgType");a=l(a).call(a,(function(e){return d(p).call(p,e)>-1})),p=l(p).call(p,(function(e){return-1===d(a).call(a,e)}))}this.processCallback(e),r.enable?r.getSessions().then((function(t){a&&0!==a.length?p&&0!==p.length?(i(t).call(t,(function(e,n){var i,c,u;e.lastMsg&&d(a).call(a,e.lastMsg.type)>-1&&(i=n,c=e.id,u=r.getMsgs({sessionId:c,limit:1,types:p}).then((function(e){return e&&e[0]?t[i].lastMsg=e[0]:t[i].lastMsg=null,o.resolve()})),s.push(u))})),o.all(s).then((function(r){e.done(null,{exclude:a,sessions:t})}))):e.done(null,{exclude:a,sessions:n(t).call(t,(function(e){e.lastMsg=null}))}):e.done(null,{exclude:a,sessions:t})})):e.done(null,{exclude:a,sessions:[]})},p.updateLocalSession=function(e){var t,r=this,n=r.db;f.verifyOptions(e,"id","scene::updateLocalSession"),r.processCallback(e);var i=f.filterObj(e,"id localCustom");function o(){r.protocol.onUpdateSession(i),e.session=i,e.done(t,e)}n.enable?n.updateSession(i).then((function(e){i=e,o()}),(function(e){t=e,o()})):o()},p.deleteLocalSession=function(e){var t,r=this,i=r.db;if(f.verifyOptions(e,"id","session::deleteLocalSession"),r.processCallback(e),i.enable?(e.isLogic?i.deleteSessionLogic(e.id):i.deleteSession(e.id)).then((function(){r.protocol.deleteLocalSession(e.id,e.isLogic),a()}),(function(e){t=e,a()})):a(),e.isDeleteRoaming){var o="string"==typeof e.id?[e.id]:e.id;o=n(o).call(o,(function(e){return e.replace("-","|")})),this.sendCmd("deleteSessions",{sessions:o},(function(){}))}function a(){e.done(t,e)}},p.deleteSession=function(e){f.verifyOptions(e,"scene to","session::deleteSession"),this.processCallback(e),e.sessions=[{scene:e.scene,to:e.to}],this.deleteSessions(e)},p.deleteSessions=function(e){var t,r;f.verifyOptions(e,"sessions","session::deleteSessions"),f.verifyParamType("sessions",e.sessions,"array","session::deleteSessions"),i(t=e.sessions).call(t,(function(e,t){f.verifyOptions(e,"scene to",!0,"sessions["+t+"].","session::deleteSessions")})),this.processCallback(e),this.sendCmd("deleteSessions",{sessions:n(r=e.sessions).call(r,(function(e){return e.scene+"|"+e.to}))},e.callback)},p.getServerSessions=function(e){m(e.minTimestamp)&&f.verifyParamType("minTimestamp",e.minTimestamp,"number","session::deleteSessions"),m(e.maxTimestamp)&&f.verifyParamType("maxTimestamp",e.maxTimestamp,"number","session::deleteSessions"),m(e.needLastMsg)&&(e.needLastMsg=!1===e.needLastMsg?0:1),m(e.limit)&&(f.verifyParamType("limit",e.limit,"number","session::deleteSessions"),f.verifyParamMax("limit",e.limit,100,"scene::getLocalSessions")),this.processCallback(e),this.sendCmd("getServerSessions",{sessionReqTag:e},e.callback)},p.getServerSession=function(e){f.verifyOptions(e,"scene to","scene::getServerSession"),f.verifyParamValid("scene",e.scene,this.message.validScenes,"scene::getServerSession"),f.verifyParamType("to",e.to,"string","to::getServerSession");var t=e.scene+"|"+e.to;"superTeam"===e.scene&&(t="super_team|"+e.to),this.processCallback(e),this.sendCmd("getServerSession",{session:{id:t}},e.callback)},p.updateServerSession=function(e){f.verifyOptions(e,"scene to","scene::updateServerSession"),f.verifyParamValid("scene",e.scene,this.message.validScenes,"scene::updateServerSession"),f.verifyParamType("to",e.to,"string","to::updateServerSession"),m(e.extra)&&f.verifyParamType("extra",e.extra,"string","extra::updateServerSession");var t=e.scene+"|"+e.to;"superTeam"===e.scene&&(t="super_team|"+e.to),this.processCallback(e),this.sendCmd("updateServerSession",{session:{id:t,ext:e.extra||""}},e.callback)},p.deleteServerSessions=function(e){var t,r=this;f.verifyOptions(e,"sessions","scene::deleteServerSessions"),f.verifyParamType("sessions",e.sessions,"array","sessions::deleteServerSessions");var n=[];i(t=e.sessions).call(t,(function(e){f.verifyParamValid("scene",e.scene,r.message.validScenes,"scene::deleteServerSessions"),f.verifyParamType("to",e.to,"string","to::deleteServerSessions");var t=e.scene+"|"+e.to;"superTeam"===e.scene&&(t="super_team|"+e.to),n.push({id:t})})),this.processCallback(e),this.sendCmd("deleteServerSessions",{sessions:n},e.callback)},p.updateSessionsWithMoreRoaming=function(e){var t;if(f.verifyOptions(e,"msg","session::updateSessionsWithMoreRoaming"),f.verifyCallback(e,"done","session::updateSessionsWithMoreRoaming"),!this.db.enable)return e.done(null,"db is disable");var r={time:e.msg.time,idServer:e.msg.idServer,to:e.msg.to,from:e.msg.from};f.verifyParamType("msg.time",e.msg.time,"number","time::updateSessionsWithMoreRoaming"),f.verifyParamType("msg.idServer",e.msg.idServer,"string","idServer::updateSessionsWithMoreRoaming"),f.verifyParamType("msg.from",e.msg.from,"string","from::updateSessionsWithMoreRoaming"),f.verifyParamType("msg.to",e.msg.to,"string","to::updateSessionsWithMoreRoaming"),f.verifyParamValid("scene",e.msg.scene,this.message.validScenes,"scene::updateSessionsWithMoreRoaming");var n=r.to===this.account?r.from:r.to;r.id=a(t="".concat(e.msg.scene,"-")).call(t,n),this.db.updateSessionsWithMoreRoaming(r).then((function(t){e.done(null,t)})).catch((function(t){e.done(t)}))},p.deleteSessionsWithMoreRoaming=function(e){if(f.verifyOptions(e,"id","session::deleteSessionsWithMoreRoaming"),f.verifyCallback(e,"done","session::deleteSessionsWithMoreRoaming"),!this.db.enable)return e.done(null,"db is disable");this.db.deleteSessionsWithMoreRoaming(e.id).then((function(t){e.done(null,t)})).catch((function(t){e.done(t)}))},p.getSessionsWithMoreRoaming=function(e){if(f.verifyCallback(e,"done","session::getSessionsWithMoreRoaming"),!this.db.enable)return e.done(null,"db is disable");this.db.getSessionsWithMoreRoaming(e.id).then((function(t){e.done(null,t)})).catch((function(t){e.done(t)}))}},function(e,t,r){var n=r(9),i=r(59),o=r(60),a=r(61),s=r(62),c=r(50),u=r(119),l=r(63),d=r(19),p=r(16),f=r(3),h=r(29),m=r(114),g=r(8),v=r(10),y=r(5),b=r(11),S=r(576),_=["callback","done"],M=["callback","done"];function T(e,t){var r=n(e);if(i){var a=i(e);t&&(a=d(a).call(a,(function(t){return o(e,t).enumerable}))),r.push.apply(r,a)}return r}var w=r(32).fn,x=r(0),I=x.undef,E=x.notundef,A=r(40),C=r(144),k=r(117),O=r(33);w.sendG2Msg=function(e){return this.processCallback(e),e.msg=new this.message.G2Message(e),this.sendMsg(e)},w.beforeSendMsg=function(e){var t,r=this.protocol,n=e.msg;switch(n.to===this.account&&(n.fromDeviceId=A.deviceId),n.userUpdateTime=r.myInfo&&r.myInfo.updateTime,n.getScene()){case"p2p":t="sendMsg";break;case"team":t="sendTeamMsg";break;case"superTeam":t="sendSuperTeamMsg"}d(e)&&(t="sendFilterMsg",n.filter=!0),e.cmd=t},w.afterSendMsg=function(e){var t=e.rtnMsg;if(!t||!t.ignore){var r=this.protocol.findSession(t.sessionId);e.isLocal&&r&&r.lastMsg&&t.time<r.lastMsg.time||this.protocol.onUpdateSession(C.genSessionByMsg(t))}},w.beforeForwardMsg=function(e){x.verifyOptions(e,"msg scene to","msg::beforeForwardMsg"),e.msg.scene=e.scene,e.msg.to=e.to},w.markMsgRead=function(e){var t=this.protocol;!e||this.db.enable||t.options.autoMarkRead?this.logger.warn("api::markMsgRead: 不需要标记消息为已收到 (没有消息, 或者启用了数据库, 或者启用了自动标记已收到)"):t.markMsgRead(e,!0)},w.sendMsgReceipt=function(e){if(x.verifyOptions(e),this.processCallback(e),e.msg){x.verifyOptions(e,"msg","msg::sendMsgReceipt");var t=e.msg;x.verifyOptions(t,"target idClient time",!0,"msg.","msg::sendMsgReceipt"),this.protocol.shouldSendMsgReceipt(t)?this.sendCmd("sendMsgReceipt",{msgReceipt:{to:t.target,idClient:t.idClient,time:t.time}},e.callback):e.done()}else e.done()},w.isMsgRemoteRead=function(e){return this.protocol.isMsgRemoteRead(e)},w.deleteMsg=function(e){var t;x.verifyOptions(e,"msg","msg::deleteMsg");var r=e.msg;if("team"!==r.scene&&r.from!==this.account||"success"!==r.status||r.isLocal)return e.done(O.newParamError("只能删除自己发的, 并且发送成功的消息，且不能是本地消息",{callFunc:"msg::deleteMsg"}),e);x.verifyOptions(r,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsg"),x.verifyParamValid("msg.scene",r.scene,this.message.validScenes,"msg::deleteMsg"),this.processPs(e),this.processCallback(e);var n={deletedIdClient:r.idClient,deletedIdServer:r.idServer,time:r.time,from:r.from,to:r.to,opeAccount:r.from},i="superTeam"===r.scene?"deleteSuperTeamMsg":"deleteMsg";n.type="deleteMsg"+r.scene[0].toUpperCase()+p(t=r.scene).call(t,1);var o=["ps","apnsText","pushPayload","env","opeAccount","attach"];f(o).call(o,(function(t){e[t]&&(n[t]=e[t])})),n=new k(n),this.sendCmd(i,{sysMsg:n,msg:r},e.callback)},w.deleteMsgSelf=function(e){x.verifyOptions(e,"msg","msg::deleteMsgSelf");var t=e.msg;if("superTeam"===t.scene)return e.done(O.newParamError("单向删除暂不支持超大群场景",{callFunc:"msg::deleteMsgSelf"}),e);x.verifyOptions(t,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsgSelf"),x.verifyParamValid("msg.scene",t.scene,this.message.validScenes,"msg::deleteMsgSelf"),this.processCallback(e);var r={scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,time:t.time,idClient:t.idClient,idServer:t.idServer,custom:e.custom};this.sendCmd("deleteMsgSelf",{deleteMsgSelfTag:r},e.callback)},w.deleteMsgSelfBatch=function(e){var t,r,n,i=this;if(x.verifyOptions(e,"msgs","msg::deleteMsgSelfBatch"),(!h(e.msgs)||0===e.msgs.length||e.msgs.length>100)&&x.onParamError("msgs应该是数组且数据长度应大于0小于等于100","msg::deleteMsgSelfBatch"),m(t=e.msgs).call(t,(function(e){return"superTeam"===e.scene})))return e.done(O.newParamError("消息列表中存在超大群消息，单向删除暂不支持超大群场景",{callFunc:"msg::deleteMsgSelfBatch"}),e);f(r=e.msgs).call(r,(function(e){x.verifyOptions(e,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsgSelfBatch"),x.verifyParamValid("msg.scene",e.scene,i.message.validScenes,"msg::deleteMsgSelfBatch")})),this.processCallback(e);var o=g(n=e.msgs).call(n,(function(t){var r;return{scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,time:t.time,idClient:t.idClient,idServer:t.idServer,sessionId:t.sessionId||v(r="".concat(t.scene,"-")).call(r,t.to),custom:e.custom}}));this.sendCmd("deleteMsgSelfBatch",{deleteMsgSelfTags:o},e.callback)};var N={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};w.getHistoryMsgs=function(e){x.verifyOptions(e,"scene to","msg::getHistoryMsgs"),x.verifyParamValid("scene",e.scene,this.message.validScenes,"msg::getHistoryMsgs"),void 0===e.beginTime&&(e.beginTime=0);var t,r=this.protocol.findSession(e.scene+"-"+e.to),n=r&&r.lastEmptyTime;if(n>e.beginTime&&(e.beginTime=n),x.verifyParamType("beginTime",e.beginTime,"number","msg::getHistoryMsgs"),void 0===e.endTime&&(e.endTime=0),x.verifyParamType("endTime",e.endTime,"number","msg::getHistoryMsgs"),e.lastMsgId=e.lastMsgId&&+e.lastMsgId?e.lastMsgId:"0",void 0===e.limit&&(e.limit=100),x.verifyParamType("limit",e.limit,"number","msg::getHistoryMsgs"),x.verifyParamMax("limit",e.limit,100,"msg::getHistoryMsgs"),E(y(e))?x.verifyParamType("reverse",y(e),"boolean","msg::getHistoryMsgs"):e.reverse=!1,E(e.asc)?x.verifyParamType("asc",e.asc,"boolean","msg::getHistoryMsgs"):e.asc=!1,I(e.msgTypes))e.msgTypes=[];else if(h(e.msgTypes)){var i,o;e.msgTypes=g(i=e.msgTypes).call(i,(function(e){return N[e]})),e.msgTypes=d(o=e.msgTypes).call(o,(function(e){return"number"==typeof e}))}else"number"==typeof N[e.msgTypes]?e.msgTypes=[N[e.msgTypes]]:e.msgTypes=[];switch(this.processCallback(e),e.asc&&(e.cbaop=function(e,t){var r;e||(t.msgs=y(r=t.msgs).call(r))}),e.scene){case"p2p":t="getHistoryMsgs";break;case"team":t="getTeamHistoryMsgs";break;case"superTeam":t="getSuperTeamHistoryMsgs"}var a={scene:e.scene,to:e.to,beginTime:e.beginTime,endTime:e.endTime,lastMsgId:e.lastMsgId,limit:e.limit,reverse:y(e),msgTypes:e.msgTypes};this.sendCmd(t,a,e.callback)},w.searchHistoryMsgs=function(e){x.verifyOptions(e,"scene to keyword","msg::searchHistoryMsgs"),x.verifyParamValid("scene",e.scene,this.message.validScenes,"msg::searchHistoryMsgs"),void 0===e.beginTime&&(e.beginTime=0);var t,r=this.protocol.findSession(e.scene+"-"+e.to),n=r&&r.lastEmptyTime;switch(n>e.beginTime&&(e.beginTime=n),x.verifyParamType("beginTime",e.beginTime,"number","msg::searchHistoryMsgs"),void 0===e.endTime&&(e.endTime=0),x.verifyParamType("endTime",e.endTime,"number","msg::searchHistoryMsgs"),void 0===e.limit&&(e.limit=100),x.verifyParamType("limit",e.limit,"number","msg::searchHistoryMsgs"),x.verifyParamMax("limit",e.limit,100,"msg::searchHistoryMsgs"),E(y(e))?x.verifyParamType("reverse",y(e),"boolean","msg::searchHistoryMsgs"):e.reverse=!1,E(e.asc)?x.verifyParamType("asc",e.asc,"boolean","msg::searchHistoryMsgs"):e.asc=!1,this.processCallback(e),e.asc&&(e.cbaop=function(e,t){var r;e||(t.msgs=y(r=t.msgs).call(r))}),e.scene){case"p2p":t="searchHistoryMsgs";break;case"team":t="searchTeamHistoryMsgs"}var i=x.filterObj(e,"scene to beginTime endTime keyword limit reverse");this.sendCmd(t,i,e.callback)},w.getLocalMsgs=function(e){var t=this,r=t.db,n=[];x.verifyOptions(e);var i=!1;E(e.start)&&(i=!0,x.verifyParamType("start",e.start,"number","msg::getLocalMsgs"));var o=!1;if(E(e.end)&&(o=!0,x.verifyParamType("end",e.end,"number","msg::getLocalMsgs")),i&&o&&e.end<=e.start&&x.onParamError("参数 end 必须晚于 start"),E(e.subTypes)&&x.verifyParamType("subTypes",e.subTypes,"array","msg::getLocalMsgs"),I(e.limit)&&(e.limit=100),x.verifyParamType("limit",e.limit,"number","msg::getLocalMsgs"),x.verifyParamMin("limit",e.limit,1,"msg::getLocalMsgs"),t.processCallback(e),r.enable){var a=(new Date).getTime();r.getMsgs(e).then((function(r){var i;n=r,t.logger.info(v(i="api::getLocalMsgs: query db cost ".concat((new Date).getTime()-a," ms and the conditions is ")).call(i,b(e))),s()}),(function(e){(e=e||{}).message=e.message||"msg::getLocalMsgs:db error",s()}))}else s();function s(){var t=x.simpleClone(e);t.msgs=n,delete t.callback,delete t.done,e.done(null,t)}},w.getLocalMsgsInUnread=function(e){var t=this;x.validate({sessionId:{type:"string",allowEmpty:!1}},e),this.getLocalSession({sessionId:e.sessionId,done:function(r,n){r?e.done&&e.done(r):n?(n.ack=n.ack||0,t.getLocalMsgs(function(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)f(r=T(Object(n),!0)).call(r,(function(t){l(e,t,n[t])}));else if(a)s(e,a(n));else{var i;f(i=T(Object(n))).call(i,(function(t){c(e,t,o(n,t))}))}}return e}({sessionId:e.sessionId,start:n.ack,limit:S,filterFunc:function(e){return"in"===e.flow&&!0===e.isUnreadable},done:function(){}},e))):e.done&&e.done(new Error("session ".concat(e.sessionId," not exist")))}})},w.getLocalMsgByIdClient=function(e){var t=this.db,r=null,n=null;function i(){e.msg=n,e.done(r,e)}x.verifyOptions(e,"idClient","msg::getLocalMsgByIdClient"),this.processCallback(e),t.enable?t.getMsgByIdClient(e.idClient).then((function(e){e&&(n=e),i()}),(function(e){r=e,i()})):i()},w.getLocalMsgsByIdClients=function(e){var t,r=this.db,n=[];function i(){e.msgs=n,e.done(t,e)}x.verifyOptions(e,"idClients","msg::getLocalMsgByIdClients"),x.verifyParamType("idClients",e.idClients,"array","msg::getLocalMsgByIdClients"),this.processCallback(e),r.enable?r.getMsgsByIdClients(e.idClients).then((function(e){n=d(e).call(e,(function(e){return!!e})),i()}),(function(e){t=e,i()})):i()},w.updateLocalMsg=function(e){var t,r=this.db,n=null;if(x.verifyOptions(e,"idClient","msg::updateLocalMsg"),this.processCallback(e),r.enable){var i=x.filterObj(e,"idClient localCustom");r.updateMsg(i).then((function(e){n=e,o()}),(function(e){t=e,o()}))}else o();function o(){e.msg=n,e.done(t,e)}},w.deleteLocalMsg=function(e){var t;x.verifyOptions(e,"msg","msg::deleteLocalMsg");var r=e.msg;function n(){e.done(t,e)}x.verifyOptions(r,"idClient sessionId",!0,"msg.","msg::deleteLocalMsg"),this.processCallback(e),this.protocol.deleteLocalMsg(r).then(n,(function(e){t=e,n()}))},w.deleteLocalMsgsBySession=function(e){var t,r=this,n=r.db;x.verifyOptions(e,"scene to","msg::deleteLocalMsgsBySession"),x.verifyParamValid("scene",e.scene,r.message.validScenes,"msg::deleteLocalMsgsBySession"),e.sessionId=e.scene+"-"+e.to,e.delLastMsg=!0===e.delLastMsg,e.isTag=!0===e.isTag;var i=(new Date).getTime();function o(){e.done(t,e)}r.processCallback(e);var a={id:e.sessionId};e.delLastMsg&&(a.lastMsg=null),e.isTag&&(a.lastEmptyTime=i),n.enable?n.deleteMsgsBySessionId(e).then((function(){e.delLastMsg||e.isTag?n.updateSession(a).then((function(t){r.protocol.onUpdateSession(t),e.session=t,o()})):o()})).catch((function(e){t=e,o()})):(o(),(e.delLastMsg||e.isTag)&&r.protocol.onUpdateSession(a))},w.deleteLocalMsgs=function(e){var t,r=this,n=r.db,i=!1!==e.updateSession;function o(){e.done(t,e)}x.verifyOptions(e,"sessionId","msg::deleteLocalMsgsBySession"),E(e.start)&&x.verifyParamType("start",e.start,"number","msg::deleteLocalMsgs"),E(e.end)&&x.verifyParamType("end",e.end,"number","msg::deleteLocalMsgs"),E(e.end)&&E(e.start)&&e.end<=e.start&&x.onParamError("参数 end 必须大于 start"),r.processCallback(e),n.enable?n.deleteMsgsBySessionId(e).then((function(){o(),i&&r.protocol.checkAndUpdateLocalSessionByMsg(e.sessionId)}),(function(e){t=e,o()})):o()},w.deleteAllLocalMsgs=function(e){var t,r=this.db;function n(){e.done(t,e)}this.processCallback(e),this.protocol.sessionSet={},r.enable&&r.deleteAllMsgs().then((function(){n()}),(function(e){t=e,n()}))},w.saveMsgsToLocal=function(e){this.db.enable||e.done(null,[]),x.verifyOptions(e,"msgs done","msg::saveMsgsToLocal"),x.verifyParamType("msgs",e.msgs,"Array","msg::saveMsgsToLocal"),this.db.putMsg(e.msgs).then((function(t,r){r?e.done(r):e.done(null,t)}))},w.clearServerHistoryMsgs=function(e){x.verifyOptions(e,"account","msg::clearServerHistoryMsgs");var t=!1!==e.delRoam;this.processCallback(e),this.sendCmd("clearServerHistoryMsgs",{clearMsgsParams:{account:e.account,delRoam:t?1:0}},e.callback)},w.clearServerHistoryMsgsWithSync=function(e){x.verifyOptions(e,"scene to","msg::clearServerHistoryMsgsWithSync");var t={type:"team"===e.scene?2:1,isDeleteRoam:1,isSyncSelf:!0===e.isSyncSelf?1:0};t[2===t.type?"toTid":"otherAccid"]=e.to,void 0!==e.ext&&(t.ext=e.ext),this.processCallback(e),this.sendCmd("clearServerHistoryMsgsWithSync",{clearMsgsParamsWithSync:t},e.callback)},w.msgFtsInServer=function(e){this.processCallback(e),e.callback,e.done;var t=u(e,_);x.validate({keyword:{type:"string"},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",min:0,required:!1},msgLimit:{type:"number",min:0,required:!1},order:{type:"enum",values:["ASC","DESC"],required:!1},p2pList:{type:"array",required:!1},teamList:{type:"array",required:!1},senderList:{type:"array",required:!1},msgTypeList:{type:"array",required:!1},msgSubTypeList:{type:"array",required:!1}},t,"msg::msgFtsInServer"),E(t.toTime)&&E(t.fromTime)&&t.toTime<t.fromTime&&x.onParamError("Options error: toTime should be greater than fromTime");var r,n={ASC:1,DESC:2};t.order&&n[t.order]&&(t.order=n[t.order]),t.msgTypeList&&(t.msgTypeList=g(r=t.msgTypeList).call(r,(function(e){return N[e]})));var i=["p2pList","teamList","senderList","msgTypeList","msgSubTypeList"];f(i).call(i,(function(e){h(t[e])&&(t[e]=t[e].join(","))})),this.sendCmd("msgFtsInServer",{msgFullSearchRequestTag:t},e.callback)},w.msgFtsInServerByTiming=function(e){this.processCallback(e),e.callback,e.done;var t=u(e,M);x.validate({keyword:{type:"string"},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},msgLimit:{type:"number",min:0,required:!1},order:{type:"enum",values:["ASC","DESC"],required:!1},p2pList:{type:"array",required:!1},teamList:{type:"array",required:!1},senderList:{type:"array",required:!1},msgTypeList:{type:"array",required:!1},msgSubTypeList:{type:"array",required:!1}},t,"msg::msgFtsInServerByTimeSort"),E(t.toTime)&&E(t.fromTime)&&t.toTime<t.fromTime&&x.onParamError("Options error: toTime should be greater than fromTime");var r,n={ASC:1,DESC:2};void 0===t.msgLimit&&(t.msgLimit=20),t.order&&n[t.order]&&(t.order=n[t.order]),t.msgTypeList&&(t.msgTypeList=g(r=t.msgTypeList).call(r,(function(e){return N[e]})));var i=["p2pList","teamList","senderList","msgTypeList","msgSubTypeList"];f(i).call(i,(function(e){h(t[e])&&(t[e]=t[e].join(","))})),this.sendCmd("msgFtsInServerByTiming",{msgTimingFullSearchRequestTag:t},e.callback)}},function(e,t,r){e.exports=r(577)},function(e,t,r){var n=r(578);e.exports=n},function(e,t,r){r(579),e.exports=9007199254740991},function(e,t,r){r(2)({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){var n=r(5),i=r(29),o=r(16),a=r(3),s=r(11),c=r(9),u=r(19),l=r(32).fn,d=r(0),p=r(467),f=r(469),h=d.notundef;function m(e,t,r,n){r=r||"",d.verifyParamType(r+"from",e.from,"string",t),d.verifyParamType(r+"to",e.to,"string",t),d.verifyParamType(r+"idServer",e.idServer,"string",t),d.verifyParamType(r+"time",e.time,"number",t),d.verifyParamValid(r+"scene",e.scene,this.message.validScenes,t),n||d.verifyParamType(r+"idClient",e.idClient,"string",t)}l.getThreadMsgs=function(e){d.verifyCallback(e,"done","msg::getThreadMsgs"),d.verifyOptions(e,"scene threadMsgFromAccount threadMsgToAccount threadMsgIdServer threadMsgTime","msg::getThreadMsgs"),d.verifyParamType("threadMsgFromAccount",e.threadMsgFromAccount,"string","msg::getThreadMsgs"),d.verifyParamType("threadMsgToAccount",e.threadMsgToAccount,"string","msg::getThreadMsgs"),d.verifyParamType("threadMsgIdServer",e.threadMsgIdServer,"string","msg::getThreadMsgs"),d.verifyParamType("threadMsgTime",e.threadMsgTime,"number","msg::getThreadMsgs"),d.verifyParamValid("scene",e.scene,this.message.validScenes,"msg::getThreadMsgs"),this.processCallback(e);var t={scene:this.message.sceneMap[e.scene],from:e.threadMsgFromAccount,to:e.threadMsgToAccount,time:e.threadMsgTime,idServer:e.threadMsgIdServer},r={limit:e.limit<100?e.limit:100,beginTime:"number"==typeof e.beginTime?e.beginTime:0,reverse:!0===n(e)?1:0};e.endTime&&e.endTime<=r.beginTime&&d.onParamError("endTime应该大于beginTime","msg::getThreadMsgs"),e.lastMsgId&&(r.lastMsgId=e.lastMsgId),this.sendCmd("getThreadMsgs",{msg:t,threadMsgReq:r,NOTSTORE:"msg threadMsgReq"},e.callback)},l.getMsgsByIdServer=function(e){var t,r,n=this,s=this,c="msg::getMsgsByIdServer";d.verifyCallback(e,"done",c),(!i(e.reqMsgs)||0===e.reqMsgs.length||e.reqMsgs.length>100)&&d.onParamError("reqMsgs应该是数组且数据长度应大于0小于等于100",c),e.reqMsgs=o(t=e.reqMsgs).call(t,0),a(r=e.reqMsgs).call(r,(function(e,t){m.call(s,e,c,"reqMsgs[".concat(t,"]."),!0),e.scene=n.message.sceneMap[e.scene]})),this.processCallback(e),this.sendCmd("getMsgsByIdServer",{reqMsgs:e.reqMsgs},e.callback)},l.addQuickComment=function(e){d.verifyOptions(e,"msg body","msg::addQuickComment"),m.call(this,e.msg,"msg::addQuickComment");var t=new p(e,"msg::addQuickComment");t.from=this.account;var r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("addQuickComment",{msg:r,comment:t},e.callback)},l.deleteQuickComment=function(e){d.verifyOptions(e,"msg body","msg::deleteQuickComment"),m.call(this,e.msg,"msg::deleteQuickComment");var t=new p(e,"msg::addQuickComment");t.from=this.account;var r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("deleteQuickComment",{msg:r,comment:t},e.callback)},l.getQuickComments=function(e){var t=this,r="msg::getQuickComments",n=this,o={},l={};d.verifyOptions(e,"msgs","msg::getQuickComments"),(!i(e.msgs)||0===e.msgs.length||e.msgs.length>20)&&d.onParamError("msgs应该是数组且数据长度应大于0小于等于20",r);var p=[];try{p=JSON.parse(s(e.msgs))}catch(e){d.onParamError("msgs 不是合法的对象",r)}a(p).call(p,(function(e,i){m.call(n,e,r,"msgs[".concat(i,"]."),!0),e.scene=t.message.sceneMap[e.scene],o[e.idClient]=null,l[e.idClient]=i})),this.processCallback(e),this.getLocalMsgsByIdClients({idClients:c(o),done:function(t,r){var i,s=n.protocol.timetags.sync;!t&&r.msgs&&r.msgs.length&&s&&(a(i=r.msgs).call(i,(function(e){o[e.idClient]=e})),p=u(p).call(p,(function(e){var t=o[e.idClient];return!(t&&(t.commentTimetag&&(e.timestamp=t.commentTimetag),t.commentTimetag>s))}))),n.sendCmd("getQuickComments",{commentReq:p,idMap:o,indexMap:l},e.callback)}})},l.addCollect=function(e){d.verifyOptions(e,"type data","msg::addCollect");var t=new f(e,"msg::addCollect");this.processCallback(e),this.sendCmd("addCollect",{collect:t},e.callback)},l.deleteCollects=function(e){var t;d.verifyOptions(e,"collectList","msg::deleteCollects"),(!i(e.collectList)||0===e.collectList.length||e.collectList.length>100)&&d.onParamError("collectList应该是数组且数据长度应大于0小于等于100","msg::deleteCollects"),a(t=e.collectList).call(t,(function(e,t){d.verifyParamType("collectList[".concat(t,"].id"),e.id,"string","msg::deleteCollects"),d.verifyParamType("collectList[".concat(t,"].createTime"),e.createTime,"number","msg::deleteCollects")})),this.processCallback(e),this.sendCmd("deleteCollects",{collectList:e.collectList},e.callback)},l.updateCollect=function(e){d.verifyOptions(e,"collect","msg::updateCollect"),d.verifyParamType("collect.id",e.collect.id,"string","msg::updateCollect"),d.verifyParamType("collect.createTime",e.collect.createTime,"number","msg::updateCollect"),this.processCallback(e),this.sendCmd("updateCollect",{collect:e.collect},e.callback)},l.getCollects=function(e){d.verifyCallback(e,"done","msg::getCollects");var t={},r=["type","beginTime","endTime","limit"];a(r).call(r,(function(r){h(e[r])&&(d.verifyParamType(r,e[r],"number","msg::getCollects"),t[r]=e[r])})),e.limit>100&&d.onParamError("limit不能大于100","msg::getCollects"),e.beginTime>e.endTime&&d.onParamError("beginTime不能大于endTime","msg::getCollects"),h(e.lastId)&&(d.verifyParamType("lastId",e.lastId,"string","msg::getCollects"),t.lastId=e.lastId),h(n(e))&&(t.reverse=!0===n(e)),this.processCallback(e),this.sendCmd("getCollects",{collectQuery:t,NOTSTORE:"collectQuery"},e.callback)},l.addStickTopSession=function(e){d.verifyOptions(e,"id","msg::addStickTopSession");var t=e.id.split("-");d.verifyParamValid("id的前半部分",t[0],this.message.validScenes,"msg::addStickTopSession"),d.verifyParamType("id的后半部分",t[1],"string","msg::addStickTopSession"),"superTeam"===t[0]&&(t[0]="super_team");var r={id:t=t.join("|")};e.topCustom&&(d.verifyParamType("topCustom",e.topCustom,"string","msg::addStickTopSession"),r.topCustom=e.topCustom),this.processCallback(e),this.sendCmd("addStickTopSession",{stickTopSession:r},e.callback)},l.deleteStickTopSession=function(e){d.verifyOptions(e,"id","msg::deleteStickTopSession");var t=e.id.split("-");d.verifyParamValid("id的前半部分",t[0],this.message.validScenes,"msg::deleteStickTopSession"),d.verifyParamType("id的后半部分",t[1],"string","msg::deleteStickTopSession"),"superTeam"===t[0]&&(t[0]="super_team"),t=t.join("|"),this.processCallback(e),this.sendCmd("deleteStickTopSession",{stickTopSession:{id:t}},e.callback)},l.updateStickTopSession=function(e){d.verifyOptions(e,"id","msg::updateStickTopSession");var t=e.id.split("-");d.verifyParamValid("id的前半部分",t[0],this.message.validScenes,"msg::updateStickTopSession"),d.verifyParamType("id的后半部分",t[1],"string","msg::updateStickTopSession"),"superTeam"===t[0]&&(t[0]="super_team");var r={id:t=t.join("|")};e.topCustom&&(d.verifyParamType("topCustom",e.topCustom,"string","msg::updateStickTopSession"),r.topCustom=e.topCustom),this.processCallback(e),this.sendCmd("updateStickTopSession",{stickTopSession:r},e.callback)},l.getStickTopSessions=function(e){d.verifyOptions(e,"done","msg::getStickTopSessions"),this.processCallback(e);var t,r=this.protocol.sessionSet,n=[];for(var i in r)(t=this.protocol.findSession(i,e.findDelete))&&t.isTop&&n.push(r[i]);e.callback(null,n)},l.addMsgPin=function(e){d.verifyOptions(e,"msg","msg::addMsgPin"),m.call(this,e.msg,"msg::addMsgPin");var t={pinFrom:this.account};h(e.pinCustom)&&(d.verifyParamType("pinCustom",e.pinCustom,"string","msg::addMsgPin"),t.pinCustom=e.pinCustom);var r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("addMsgPin",{msg:r,pinTag:t},e.callback)},l.updateMsgPin=function(e){d.verifyOptions(e,"msg","msg::updateMsgPin"),m.call(this,e.msg,"msg::updateMsgPin");var t={pinFrom:this.account};h(e.pinCustom)&&(d.verifyParamType("pinCustom",e.pinCustom,"string","msg::updateMsgPin"),t.pinCustom=e.pinCustom);var r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("updateMsgPin",{msg:r,pinTag:t},e.callback)},l.deleteMsgPin=function(e){d.verifyOptions(e,"msg","msg::deleteMsgPin"),m.call(this,e.msg,"msg::deleteMsgPin");var t={pinFrom:this.account},r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("deleteMsgPin",{msg:r,pinTag:t},e.callback)},l.getMsgPins=function(e){var t=this;d.verifyOptions(e,"id","msg::getMsgPins");var r=this.db,n=e.id.split("-");d.verifyParamValid("id的前半部分",n[0],this.message.validScenes,"msg::getMsgPins"),d.verifyParamType("id的后半部分",n[1],"string","msg::getMsgPins"),"superTeam"===n[0]&&(n[0]="super_team");var i={sessionId:n=n.join("|"),timetag:0};if(this.processCallback(e),r.enable){var o=this.protocol.timetags.sync;r.getTimetag("pin-"+e.id).then((function(n){n>o?r.getMsgPins(e.id).then((function(t){return e.callback(null,{pins:t||[]})})).catch((function(t){return e.callback(t)})):(i.timetag=n,a.call(t))}))}else a.call(this);function a(){this.sendCmd("getMsgPins",{msgPinReq:i,id:e.id,NOTSTORE:"msgPinReq"},e.callback)}}},function(e,t,r){var n=r(4),i=r(19),o=r(3),a=r(5),s=r(32).fn,c=r(0),u=c.undef,l=c.notundef,d=r(117);s.markSysMsgRead=function(e){var t,r=this.db,a=n.resolve(),s=this.protocol;c.verifyOptions(e,"sysMsgs","sysmsg::markSysMsgRead");var u=e.sysMsgs;function l(){e.done(t,e)}c.isArray(u)||(u=[u]),r.enable?a=r.markSysMsgRead(u).then((function(e){u=e,s.onUpdateSysMsg(e)})):(u=i(u).call(u,(function(e){return!e.read}))).length&&(s.options.autoMarkRead||s.markSysMsgRead(u,!0),o(u).call(u,(function(e){e.read=!0})),s.onUpdateSysMsg(u)),a.then((function(){return s.reduceSysMsgUnread(u)})).then(l,(function(e){t=e,l()}))},s.sendCustomSysMsg=function(e){c.verifyOptions(e,"scene to content","sysmsg::sendCustomSysMsg"),c.verifyParamValid("scene",e.scene,this.message.validScenes,"sysmsg::sendCustomSysMsg"),this.processCallback(e);var t="sendCustomSysMsg";return"p2p"===e.scene?e.type="customP2p":"superTeam"===e.scene?(e.type="customSuperTeam",t="sendSuperTeamCustomSysMsg"):e.type="customTeam",e.sysMsg=new d(e),i(e)&&(t="sendFilterCustomSysMsg"),this.sendCmd(t,{sysMsg:e.sysMsg,single:!0},e.callback),this.formatReturnSysMsg(e.sysMsg)},s.formatReturnSysMsg=function(e){return e=c.copy(e),this.protocol.completeSysMsg(e),e.status="sending",a(d).call(d,e)},s.getLocalSysMsgs=function(e){var t,r=this.db,n=[];function i(){e.sysMsgs=n,e.done(t,e)}c.verifyOptions(e),e.category&&c.verifyParamValid("category",e.category,d.validCategories,"sysmsg::getLocalSysMsgs"),e.type&&c.verifyParamValid("type",e.type,d.validTypes,"sysmsg::getLocalSysMsgs"),u(e.limit)&&(e.limit=100),c.verifyParamType("limit",e.limit,"number","sysmsg::getLocalSysMsgs"),c.verifyParamMax("limit",e.limit,100,"sysmsg::getLocalSysMsgs"),l(a(e))?c.verifyParamType("reverse",a(e),"boolean","sysmsg::getLocalSysMsgs"):e.reverse=!1,this.processCallback(e),r.enable?r.getSysMsgs(e).then((function(e){n=e,i()}),(function(e){t=e,i()})):i()},s.updateLocalSysMsg=function(e){var t,r=this.db,n=null;if(c.verifyOptions(e,"idServer","sysmsg::updateLocalSysMsg"),this.processCallback(e),r.enable){var i=c.filterObj(e,"idServer state localCustom");r.updateSysMsg(i).then((function(e){n=e,o()}),(function(e){t=e,o()}))}else o();function o(){e.sysMsg=n,e.done(t,e)}},s.deleteLocalSysMsg=function(e){var t,r=this.db;function n(){e.done(t,e)}c.verifyOptions(e,"idServer","sysmsg::deleteLocalSysMsg"),this.processCallback(e),r.enable?r.deleteSysMsg(e.idServer).then((function(){n()}),(function(e){t=e,n()})):n()},s.deleteAllLocalSysMsgs=function(e){var t,r=this,n=r.db;function i(){r.protocol.onUpdateSysMsgUnread({}),e.done(t,e)}r.processCallback(e),n.enable&&n.deleteAllSysMsgs().then((function(){i()}),(function(e){t=e,i()}))}},function(e,t,r){var n=r(32).fn,i=r(0),o=r(17);n.getChatroomAddress=function(e){i.verifyOptions(e,"chatroomId","chatroom::getChatroomAddress"),e.isWeixinApp=o.isWeixinApp,e.type=o.ipVersion,this.processCallback(e),this.sendCmd("getChatroomAddress",e)}},function(e,t){},function(e,t){},function(e,t,r){var n=r(32).fn,i=r(0);n.audioToText=function(e){i.verifyOptions(e,"url","audio::audioToText"),e.audioToText=i.filterObj(e,"url"),this.processCallback(e),this.sendCmd("audioToText",e)}},function(e,t,r){var n=r(32).fn;n.clearDB=function(e){var t=this.db;this.processCallback(e);var r=e.done;t.enable?t.clear().then(r,r):r()},n.removeDB=function(e){var t=this.db;this.processCallback(e);var r=e.done;t.enable?t.destroy().then(r,r):r()},n.closeDB=function(e){var t=this.db;this.processCallback(e);var r=e.done;t.enable?t.close().then(r,r):r()}},function(e,t,r){var n=r(32).fn,i=r(222),o=r(0),a=o.undef;n.getPushNotificationMultiportConfig=function(){return this.protocol.getPushNotificationMultiportConfig()},n.updatePushNotificationMultiportConfig=function(e){o.verifyOptions(e),a(e.shouldPushNotificationWhenPCOnline)&&(e.shouldPushNotificationWhenPCOnline=!0),e.donnop=new i(e),this.processCallback(e),this.sendCmd("updateDonnop",e)}},function(e,t,r){var n=r(3),i=r(4),o=r(10),a=r(28),s=r(32).fn,c=r(0),u=r(589),l=r(590);function d(e){return"object"===a(e)&&(e.msgEventSubscribes?e=e.msgEventSubscribes:e.msgEventSubscribe?e=e.msgEventSubscribe:e.accounts?e=e.accounts:e.msgEvent&&(e=e.msgEvent).time&&(e.time=+e.time),1===e.sync?e.sync=!0:0===e.sync&&(e.sync=!1)),e}s.batchSendEventsCmds=function(e,t,r){var a=this,s=c.dropArrayDuplicates(t.accounts);s=c.reshape2d(s,100);var u=[];n(s).call(s,(function(r){u.push(new i((function(n,i){var o=c.simpleClone(t);o.accounts=r,a.sendCmdWithResp(e,o,(function(e,t){e?i(e):n(d(t))}))})))})),i.all(u).then((function(e){var t=null;if(e.length>0)if(e[0].msgEventSubscribe){var i=e[0].msgEventSubscribe;i=d(i);var a=[];n(e).call(e,(function(e){a=o(a).call(a,e.accounts)})),t={accounts:a,msgEventSubscribe:i}}else t=[],n(e).call(e,(function(e){t=o(t).call(t,e)}));r(null,t)}),(function(e){r(e,null)}))},s.publishEvent=function(e){var t=new u(e);t=t.assembleEvent(),this.processCallback(e),this.sendCmdWithResp("publishEvent",{msgEvent:t},(function(t,r){t||(r=d(r)),e.callback(t,r)}))},s.subscribeEvent=function(e){c.verifyOptions(e,"accounts","event::subscribeEvent");var t=new l(e);c.verifyParamType("accounts",e.accounts,"array","event::subscribeEvent"),this.processCallback(e),t=t.assembleEvent(),this.batchSendEventsCmds("subscribeEvent",{msgEventSubscribe:t,accounts:e.accounts},(function(t,r){!t&&r&&(r={failedAccounts:r}),e.callback(t,r)}))},s.unSubscribeEventsByAccounts=function(e){c.verifyOptions(e,"accounts","event::unSubscribeEventsByAccounts"),c.verifyParamType("accounts",e.accounts,"array","event::unSubscribeEventsByAccounts");var t=new l(e);t=t.assembleEvent(),this.processCallback(e),this.batchSendEventsCmds("unSubscribeEventsByAccounts",{msgEventSubscribe:t,accounts:e.accounts},(function(t,r){!t&&r&&(r={failedAccounts:r}),e.callback(t,r)}))},s.unSubscribeEventsByType=function(e){var t=new l(e);t=t.assembleEvent(),this.processCallback(e),this.sendCmdWithResp("unSubscribeEventsByType",{msgEventSubscribe:t},(function(t,r){e.callback(t)}))},s.querySubscribeEventsByAccounts=function(e){c.verifyOptions(e,"accounts","event::querySubscribeEventsByAccounts"),c.verifyParamType("accounts",e.accounts,"array","event::querySubscribeEventsByAccounts");var t=new l(e);t=t.assembleEvent(),this.processCallback(e),this.batchSendEventsCmds("querySubscribeEventsByAccounts",{msgEventSubscribe:t,accounts:e.accounts},(function(t,r){!t&&r&&(r={msgEventSubscribes:r}),e.callback(t,r)}))},s.querySubscribeEventsByType=function(e){var t=new l(e);t=t.assembleEvent(),this.processCallback(e),this.sendCmdWithResp("querySubscribeEventsByType",{msgEventSubscribe:t},(function(t,r){t||(r={msgEventSubscribes:d(r)}),e.callback(t,r)}))}},function(e,t,r){var n=r(6),i=r(0),o=i.notundef,a=r(33);function s(e){if(i.verifyOptions(e,"type value","event::MsgEvent"),i.verifyParamType("type",e.type,"number","event::MsgEvent"),i.verifyParamType("value",e.value,"number","event::MsgEvent"),this.type=e.type,this.value=e.value,this.idClient=i.guid(),o(e.custom)&&(this.custom=""+e.custom),this.validTime=e.validTime||604800,i.verifyParamType("validTime",this.validTime,"number","event::MsgEvent"),i.verifyParamMin("validTime",this.validTime,60,"event::MsgEvent"),i.verifyParamMax("validTime",this.validTime,604800,"event::MsgEvent"),o(e.broadcastType)){var t;if(i.verifyParamType("broadcastType",e.broadcastType,"number","event::MsgEvent"),n(t=[1,2]).call(t,e.broadcastType)<0)throw new a('参数错误"broadcastType":只能为1或2');this.broadcastType=e.broadcastType}else this.broadcastType=2;o(e.sync)?(i.verifyParamType("sync",e.sync,"boolean","event::MsgEvent"),this.sync=e.sync):this.sync=!1}s.prototype.assembleEvent=function(){return{type:this.type,value:this.value,idClient:this.idClient,custom:this.custom||"",validTime:this.validTime,broadcastType:this.broadcastType,sync:!0===this.sync?1:0}},e.exports=s},function(e,t,r){var n=r(0),i=n.notundef;function o(e){n.verifyOptions(e,"type","event::MsgEventSubscribe"),n.verifyParamType("type",e.type,"number","event::MsgEventSubscribe"),n.findObjIndexInArray([1,2,3],e.type)<0&&n.verifyParamMin("type",e.type,1e5,"event::MsgEventSubscribe"),this.type=e.type,i(e.subscribeTime)?(n.verifyParamType("subscribeTime",e.subscribeTime,"number","event::MsgEventSubscribe"),n.verifyParamMin("subscribeTime",e.subscribeTime,60,"event::MsgEventSubscribe"),n.verifyParamMax("subscribeTime",e.subscribeTime,2592e3,"event::MsgEventSubscribe"),this.subscribeTime=e.subscribeTime):this.subscribeTime=2592e3,i(e.sync)?(n.verifyParamType("sync",e.sync,"boolean","event::MsgEventSubscribe"),this.sync=e.sync):this.sync=!0}o.prototype.assembleEvent=function(e){return{type:this.type,subscribeTime:this.subscribeTime,sync:!0===this.sync?1:0}},e.exports=o},function(e,t,r){var n=r(48),i=r(32).fn,o=r(0);i.httpRequestProxy=function(e){o.verifyOptions(e,"path","misc::httpRequestProxy");var t=n({},e);delete t.done,this.processCallback(e),this.sendCmd("httpProxy",{proxyTag:t},e.callback)}},function(e,t,r){r(211);var n=r(156);r(224)(n),e.exports=n},function(e,t,r){var n=r(16);r(147).fn.refreshSocketUrl=function(){var e;this.socketUrlsBackup=this.socketUrlsBackup||[],this.socketUrls=n(e=this.socketUrlsBackup).call(e,0),this.logger.info("link::refreshSocketUrl"),this.connectToUrl(this.getNextSocketUrl())}},function(e,t,r){var n=r(11),i=r(147).fn,o=r(40),a=r(0);i.assembleLogin=function(){var e=this.options;this.sdkSession=this.genSessionKey();var t={appKey:e.appKey,account:e.account,deviceId:o.deviceId,chatroomId:e.chatroomId,session:this.sdkSession,appLogin:this.autoconnect?1:0},r=!0;if(void 0===e.loc_x||void 0===e.loc_y||void 0===e.loc_z?r=!1:("number"!=typeof e.loc_x&&(e.loc_x=0),"number"!=typeof e.loc_y&&(e.loc_y=0),"number"!=typeof e.loc_z&&(e.loc_z=0)),e.authType=e.loginAuthType,t=a.merge(t,a.filterObj(e,r?"chatroomNick chatroomAvatar chatroomCustom chatroomEnterCustom isAnonymous notifyTargetTags loginAuthType loginExt loc_x loc_y loc_z distance antiSpamBusinessId":"chatroomNick chatroomAvatar chatroomCustom chatroomEnterCustom isAnonymous notifyTargetTags loginAuthType loginExt distance antiSpamBusinessId")),e.tags&&e.tags.length>0)try{t.tags=n(e.tags)}catch(t){this.logger.error("assembleLogin::format tags error",e.tags,t)}return{type:1,login:t,imLogin:this.assembleIMLogin()}},i.afterLogin=function(e){var t=e.chatroom;this.sendCmd("getNosCdnHost",{}),this.chatroom=t,this.notifyLogin()},i.kickedReasons=["","chatroomClosed","managerKick","samePlatformKick","silentlyKick","blacked"],i.kickedMessages=["","聊天室关闭了","被房主或者管理员踢出","不允许同一个帐号在多个地方同时登录","悄悄被踢","被拉黑了"]},function(e,t,r){var n=r(5),i=r(24),o=r(77),a=r(48),s=r(51),c=r(16),u=r(29),l=r(93),d=r(3),p=r(9),f=r(147).fn,h=r(0),m=r(55),g=r(596),v=r(494),y=r(601),b=r(602),S=r(603);f.completeMsg=function(e){e.chatroomId=this.chatroom&&this.chatroom.id,e.from=this.options.account,e.fromClientType="Web",e.time||(e.time=+new Date)},f.onMsg=function(e){var t,r=n(t=this.message).call(t,e.content.msg);this.checkMsgUnique(r)?(this.msgBuffer.push(r),this.msgFlushTimer||this.startMsgFlushTimer()):this.logger.warn("onMsg::msg::repeat",r.idClient)},f.startMsgFlushTimer=function(){var e=this,t=e.options;e.msgFlushTimer=i((function(){var r,n=o(r=e.msgBuffer).call(r,0,t.msgBufferSize);e.options.onmsgs(n),e.msgBuffer.length?e.startMsgFlushTimer():delete e.msgFlushTimer}),t.msgBufferInterval)},f.checkMsgUnique=h.genCheckUniqueFunc("idClient"),f.onSendMsg=function(e){var t,r=e.obj.msg;e.error?r.status="fail":(r=e.content.msg).status="success",a(r,e.obj.msg),r=n(t=this.message).call(t,r),this.checkMsgUnique(r),e.obj=r},f.onHistoryMsgs=function(e){e.error||(e.obj||(e.obj={}),e.obj.msgs=this.message.reverseMsgs(e.content.msgs))},f.onCdnMsgInfo=function(e){if(e){e.cdnUrls&&(e.cdnUrls=e.cdnUrls.split("|")),e.interval&&(e.interval=1e3*s(e.interval)),e.timeout&&(e.timeout=+e.timeout),e.enable&&(e.enable=+e.enable),e.timestamp&&(e.timestamp=+e.timestamp,this.correctCdnTime(e.timestamp));var t=!this.cdnInfo.enable&&e.enable;a(this.cdnInfo,e),t&&this.queryCdnMsgs()}},f.correctCdnTime=function(e){e&&"number"==typeof e&&(this.cdnInfo||(this.cdnInfo={}),this.cdnInfo.timestamp=e,this.cdnInfo.localTime=+new Date,this.cdnInfo.lastNow=null,this.logger.info("correctCdnTime: timestamp, localTime",e,this.cdnInfo.localTime,new Date(e),new Date(this.cdnInfo.localTime)))},f.queryCdnMsgs=function(e){var t,r=this;if(this.cdnInfo&&this.cdnInfo.enable&&this.isConnected()){this.queryCdnTimer=i((function(){return r.queryCdnMsgs()}),this.cdnInfo.interval);var n=+new Date;if(n=n-this.cdnInfo.localTime+this.cdnInfo.timestamp,n-=n%this.cdnInfo.interval,this.cdnInfo.lastNow!==n&&this.cdnInfo.cdnUrls&&this.cdnInfo.cdnUrls.length){this.cdnInfo.cdnUrls.push(this.cdnInfo.cdnUrls.shift());var o=this,a=this.cdnInfo.decryptKey,s=this.cdnInfo.timeout||Math.ceil(this.cdnInfo.interval/2),u=c(t=this.cdnInfo.cdnUrls).call(t,0);e=e||0,function t(){if(e>=3)o.finalFail++;else if(u.length){var r=u.shift().replace("#time",n),i=r.split("/")[2],c=+new Date;m(r,{timeout:s,onload:function(e){if(o.cdnInfo.lastNow>n)o.logger.warn("queryCdnMsgs::doQuery cdnInfo.lastNow > now, will throw data ",o.cdnInfo.lastNow,n,e);else{o.cdnInfo.lastNow=n,o.afterQueryCdn(i,+new Date-c,!0);try{e=JSON.parse(e)}catch(e){o.logger.warn("queryCdnMsgs::doQuery::onload parse res error: ",e)}if(e&&e.data){e.ptm&&(o.cdnInfo.timeout=e.ptm),e.pis&&(o.cdnInfo.interval=1e3*e.pis);var t,r,s=!0===e.e?(t=e.data,r=a,g.decrypt(t,v.parse(r),{mode:y,padding:b}).toString(S)):e.data;o.onCdnMsgsSmoothly(s,n,1e3*e.c)}}},onerror:function(r){if(e++,o.afterQueryCdn(i,+new Date-c,!1),404===r.status){var n;try{var a=JSON.parse(r.result);404===a.code&&a.timestamp&&(n=a.timestamp)}catch(e){o.logger.warn("queryCdnMsgs::doQuery::parse 404 result error",e,r)}!n&&r.date&&(n=+new Date(r.date)),n&&(o.correctCdnTime(n),clearTimeout(o.queryCdnTimer),o.queryCdnMsgs(e))}else t()}})}}()}}},f.onCdnMsgsSmoothly=function(e,t,r){try{e=JSON.parse(e)}catch(e){this.logger.warn("onCdnMsgsSmoothly::JSON.parse error",e)}if(this.logger.info("receive cdn msgs "+e.length+" and request time is "+new Date(t)),u(e)&&e.length){var n=this,i=this.options.msgBufferInterval,a=Math.ceil(e.length*i/r);s(),clearInterval(n.cdnSmoothTimer),n.cdnSmoothTimer=l((function(){return s()}),i)}function s(){if(n.isConnected()){var t=o(e).call(e,0,a);d(t).call(t,(function(e){var t=n.parser.syncUnserialize(e,"msg");n.onMsg({content:{msg:t}})})),e.length||clearInterval(n.cdnSmoothTimer)}}},f.resetCdnData=function(){this.cdnData={},this.finalFail=0,this.cdnDataTime=+new Date},f.initCdnData=function(){this.resetCdnData(),h.isFunction(this.options.onCdnRequestData)?(this.options.cdnRequestDataInterval=this.options.cdnRequestDataInterval||3e4,this.afterQueryCdn=function(e,t,r){var n,i=this;this.cdnData[e]||(this.cdnData[e]={success:0,fail:0,sr:0,fr:0,smr:0,fmr:0}),r?(this.cdnData[e].success++,this.cdnData[e].sr+=t,t>this.cdnData[e].smr&&(this.cdnData[e].smr=t)):(this.cdnData[e].fail++,this.cdnData[e].fr+=t,t>this.cdnData[e].fmr&&(this.cdnData[e].fmr=t)),+new Date-this.cdnDataTime<this.options.cdnRequestDataInterval||(d(n=p(this.cdnData)).call(n,(function(e){i.cdnData[e].sr=i.cdnData[e].sr/i.cdnData[e].success||0,i.cdnData[e].fr=i.cdnData[e].fr/i.cdnData[e].fail||0})),this.options.onCdnRequestData(a({},this.cdnData),this.finalFail),this.resetCdnData())}):this.afterQueryCdn=function(){}}},function(e,t,r){var n;e.exports=(n=r(65),r(494),r(598),r(495),r(226),function(){var e=n,t=e.lib.BlockCipher,r=e.algo,i=[],o=[],a=[],s=[],c=[],u=[],l=[],d=[],p=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var h=n^n<<1^n<<2^n<<3^n<<4;h=h>>>8^255&h^99,i[r]=h,o[h]=r;var m=e[r],g=e[m],v=e[g],y=257*e[h]^16843008*h;a[r]=y<<24|y>>>8,s[r]=y<<16|y>>>16,c[r]=y<<8|y>>>24,u[r]=y,y=16843009*v^65537*g^257*m^16843008*r,l[h]=y<<24|y>>>8,d[h]=y<<16|y>>>16,p[h]=y<<8|y>>>24,f[h]=y,r?(r=m^e[e[e[v^m]]],n^=e[e[n]]):r=n=1}}();var h=[0,1,2,4,8,16,32,64,128,27,54],m=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),o=this._keySchedule=[],a=0;a<n;a++)a<r?o[a]=t[a]:(u=o[a-1],a%r?r>6&&a%r==4&&(u=i[u>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u]):(u=i[(u=u<<8|u>>>24)>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u],u^=h[a/r|0]<<24),o[a]=o[a-r]^u);for(var s=this._invKeySchedule=[],c=0;c<n;c++){if(a=n-c,c%4)var u=o[a];else u=o[a-4];s[c]=c<4||a<=4?u:l[i[u>>>24]]^d[i[u>>>16&255]]^p[i[u>>>8&255]]^f[i[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,c,u,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,l,d,p,f,o),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,o,a,s){for(var c=this._nRounds,u=e[t]^r[0],l=e[t+1]^r[1],d=e[t+2]^r[2],p=e[t+3]^r[3],f=4,h=1;h<c;h++){var m=n[u>>>24]^i[l>>>16&255]^o[d>>>8&255]^a[255&p]^r[f++],g=n[l>>>24]^i[d>>>16&255]^o[p>>>8&255]^a[255&u]^r[f++],v=n[d>>>24]^i[p>>>16&255]^o[u>>>8&255]^a[255&l]^r[f++],y=n[p>>>24]^i[u>>>16&255]^o[l>>>8&255]^a[255&d]^r[f++];u=m,l=g,d=v,p=y}m=(s[u>>>24]<<24|s[l>>>16&255]<<16|s[d>>>8&255]<<8|s[255&p])^r[f++],g=(s[l>>>24]<<24|s[d>>>16&255]<<16|s[p>>>8&255]<<8|s[255&u])^r[f++],v=(s[d>>>24]<<24|s[p>>>16&255]<<16|s[u>>>8&255]<<8|s[255&l])^r[f++],y=(s[p>>>24]<<24|s[u>>>16&255]<<16|s[l>>>8&255]<<8|s[255&d])^r[f++],e[t]=m,e[t+1]=g,e[t+2]=v,e[t+3]=y},keySize:8});e.AES=t._createHelper(m)}(),n.AES)},function(e,t){if(void 0===__WEBPACK_EXTERNAL_MODULE__597__){var r=new Error("Cannot find module 'crypto'");throw r.code="MODULE_NOT_FOUND",r}e.exports=__WEBPACK_EXTERNAL_MODULE__597__},function(e,t,r){var n;e.exports=(n=r(65),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[t+0],c=e[t+1],f=e[t+2],h=e[t+3],m=e[t+4],g=e[t+5],v=e[t+6],y=e[t+7],b=e[t+8],S=e[t+9],_=e[t+10],M=e[t+11],T=e[t+12],w=e[t+13],x=e[t+14],I=e[t+15],E=o[0],A=o[1],C=o[2],k=o[3];E=u(E,A,C,k,a,7,s[0]),k=u(k,E,A,C,c,12,s[1]),C=u(C,k,E,A,f,17,s[2]),A=u(A,C,k,E,h,22,s[3]),E=u(E,A,C,k,m,7,s[4]),k=u(k,E,A,C,g,12,s[5]),C=u(C,k,E,A,v,17,s[6]),A=u(A,C,k,E,y,22,s[7]),E=u(E,A,C,k,b,7,s[8]),k=u(k,E,A,C,S,12,s[9]),C=u(C,k,E,A,_,17,s[10]),A=u(A,C,k,E,M,22,s[11]),E=u(E,A,C,k,T,7,s[12]),k=u(k,E,A,C,w,12,s[13]),C=u(C,k,E,A,x,17,s[14]),E=l(E,A=u(A,C,k,E,I,22,s[15]),C,k,c,5,s[16]),k=l(k,E,A,C,v,9,s[17]),C=l(C,k,E,A,M,14,s[18]),A=l(A,C,k,E,a,20,s[19]),E=l(E,A,C,k,g,5,s[20]),k=l(k,E,A,C,_,9,s[21]),C=l(C,k,E,A,I,14,s[22]),A=l(A,C,k,E,m,20,s[23]),E=l(E,A,C,k,S,5,s[24]),k=l(k,E,A,C,x,9,s[25]),C=l(C,k,E,A,h,14,s[26]),A=l(A,C,k,E,b,20,s[27]),E=l(E,A,C,k,w,5,s[28]),k=l(k,E,A,C,f,9,s[29]),C=l(C,k,E,A,y,14,s[30]),E=d(E,A=l(A,C,k,E,T,20,s[31]),C,k,g,4,s[32]),k=d(k,E,A,C,b,11,s[33]),C=d(C,k,E,A,M,16,s[34]),A=d(A,C,k,E,x,23,s[35]),E=d(E,A,C,k,c,4,s[36]),k=d(k,E,A,C,m,11,s[37]),C=d(C,k,E,A,y,16,s[38]),A=d(A,C,k,E,_,23,s[39]),E=d(E,A,C,k,w,4,s[40]),k=d(k,E,A,C,a,11,s[41]),C=d(C,k,E,A,h,16,s[42]),A=d(A,C,k,E,v,23,s[43]),E=d(E,A,C,k,S,4,s[44]),k=d(k,E,A,C,T,11,s[45]),C=d(C,k,E,A,I,16,s[46]),E=p(E,A=d(A,C,k,E,f,23,s[47]),C,k,a,6,s[48]),k=p(k,E,A,C,y,10,s[49]),C=p(C,k,E,A,x,15,s[50]),A=p(A,C,k,E,g,21,s[51]),E=p(E,A,C,k,T,6,s[52]),k=p(k,E,A,C,h,10,s[53]),C=p(C,k,E,A,_,15,s[54]),A=p(A,C,k,E,c,21,s[55]),E=p(E,A,C,k,b,6,s[56]),k=p(k,E,A,C,I,10,s[57]),C=p(C,k,E,A,v,15,s[58]),A=p(A,C,k,E,w,21,s[59]),E=p(E,A,C,k,m,6,s[60]),k=p(k,E,A,C,M,10,s[61]),C=p(C,k,E,A,f,15,s[62]),A=p(A,C,k,E,S,21,s[63]),o[0]=o[0]+E|0,o[1]=o[1]+A|0,o[2]=o[2]+C|0,o[3]=o[3]+k|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),a=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,c=s.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+i+a;return(s<<o|s>>>32-o)+t}function l(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+i+a;return(s<<o|s>>>32-o)+t}function d(e,t,r,n,i,o,a){var s=e+(t^r^n)+i+a;return(s<<o|s>>>32-o)+t}function p(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+i+a;return(s<<o|s>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),n.MD5)},function(e,t,r){var n,i,o,a,s,c,u,l;e.exports=(o=(i=n=r(65)).lib,a=o.WordArray,s=o.Hasher,c=i.algo,u=[],l=c.SHA1=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],c=0;c<80;c++){if(c<16)u[c]=0|e[t+c];else{var l=u[c-3]^u[c-8]^u[c-14]^u[c-16];u[c]=l<<1|l>>>31}var d=(n<<5|n>>>27)+s+u[c];d+=c<20?1518500249+(i&o|~i&a):c<40?1859775393+(i^o^a):c<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,s=a,a=o,o=i<<30|i>>>2,i=n,n=d}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=s._createHelper(l),i.HmacSHA1=s._createHmacHelper(l),n.SHA1)},function(e,t,r){var n,i,o,a;e.exports=(i=(n=r(65)).lib.Base,o=n.enc,a=o.Utf8,void(n.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=a.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),s=i.words,c=o.words,u=0;u<r;u++)s[u]^=1549556828,c[u]^=909522486;i.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},function(e,t,r){var n,i;e.exports=(n=r(65),r(226),n.mode.ECB=((i=n.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),i.Decryptor=i.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),i),n.mode.ECB)},function(e,t,r){var n;e.exports=(n=r(65),r(226),n.pad.Pkcs7)},function(e,t,r){e.exports=r(65).enc.Utf8},function(e,t,r){var n=r(5),i=r(147).fn,o=r(225);i.onChatroomMembersInfo=i.onChatroomMembers=function(e){e.error||(e.obj.members=o.reverseMembers(e.content.members))},i.onGetChatroomMemberCountByTag=function(e){e.error||(e.obj=e.content)},i.onMarkChatroomMember=function(e){e.error||(e.obj.member=n(o).call(o,e.content.chatroomMember))},i.onSyncRobot=function(e){!e.error&&this.options.onrobots?this.options.onrobots(null,e.content):this.ontions.onrobots(e.error,{})}},function(e,t,r){var n=r(5),i=r(8),o=r(0),a=function(e){this.account=e.account},s=a.prototype,c=s.Message=r(90),u=s.TextMessage=r(606),l=s.FileMessage=r(157),d=s.GeoMessage=r(610),p=s.NotificationMessage=r(611),f=s.CustomMessage=r(612),h=s.TipMessage=r(613),m=s.RobotMessage=r(614);s.validTypes=c.validTypes,s.reverse=function(e){var t;switch(c.getType(e)){case"text":t=n(u).call(u,e);break;case"image":case"audio":case"video":case"file":t=n(l).call(l,e);break;case"geo":t=n(d).call(d,e);break;case"notification":t=n(p).call(p,e);break;case"custom":t=n(f).call(f,e);break;case"tip":t=n(h).call(h,e);break;case"robot":t=n(m).call(m,e);break;default:t=n(c).call(c,e)}return c.setExtra(t,this.account),t},s.reverseMsgs=function(e,t){var r,a,s=this;return i(e).call(e,(function(e){return e=n(s).call(s,e),t&&((r=t.modifyObj)&&(e=o.merge(e,r)),a=t.mapper,o.isFunction(a)&&(e=a(e))),e}))},e.exports=a},function(e,t,r){var n=r(14),i=r(5),o=r(90),a=r(0);function s(e){a.verifyOptions(e,"text","msg::TextMessage"),e.type="text",o.call(this,e),this.attach=e.text,this.body=""}s.prototype=n(o.prototype),s.reverse=function(e){var t=i(o).call(o,e);return t.text=e.attach,t},e.exports=s},function(e,t,r){var n=r(14),i=r(0),o=r(157);function a(){}a.prototype=n(o.prototype),a.verifyFile=function(e,t){i.verifyOptions(e,"w h",!0,"file.",t)},e.exports=a},function(e,t,r){var n=r(14),i=r(157),o=r(0);function a(){}a.prototype=n(i.prototype),a.verifyFile=function(e,t){o.verifyOptions(e,"dur",!0,"file.",t)},e.exports=a},function(e,t,r){var n=r(14),i=r(157),o=r(0);function a(){}a.prototype=n(i.prototype),a.verifyFile=function(e,t){o.verifyOptions(e,"dur w h",!0,"file.",t)},e.exports=a},function(e,t,r){var n=r(11),i=r(14),o=r(5),a=r(90),s=r(0);function c(e){e.type="geo",s.verifyOptions(e,"geo","msg::GeoMessage"),s.verifyOptions(e.geo,"lng lat title",!0,"geo.","msg::GeoMessage"),s.verifyParamType("geo.lng",e.geo.lng,"number","msg::GeoMessage"),s.verifyParamType("geo.lat",e.geo.lat,"number","msg::GeoMessage"),s.verifyParamType("geo.title",e.geo.title,"string","msg::GeoMessage"),a.call(this,e),this.attach=n(e.geo)}c.prototype=i(a.prototype),c.reverse=function(e){var t=o(a).call(a,e);return e.attach=e.attach?""+e.attach:"",t.geo=e.attach?JSON.parse(e.attach):{},t},e.exports=c},function(e,t,r){var n=r(14),i=r(5),o=r(51),a=r(0).notundef,s=r(90),c={301:"memberEnter",302:"memberExit",303:"blackMember",304:"unblackMember",305:"gagMember",306:"ungagMember",307:"addManager",308:"removeManager",309:"addCommon",310:"removeCommon",311:"closeChatroom",312:"updateChatroom",313:"kickMember",314:"addTempMute",315:"removeTempMute",316:"updateMemberInfo",317:"updateQueue",318:"muteRoom",319:"unmuteRoom",320:"batchUpdateQueue",321:"addTempMuteTag",322:"removeTempMuteTag",324:"batchQueueOffer",323:"deleteChatroomMsg",325:"updateChatroomTags"};function u(){}u.prototype=n(s.prototype),u.reverse=function(e){var t=i(s).call(s,e);if(e.attach=e.attach?""+e.attach:"",e.attach){var r=JSON.parse(e.attach);if(t.attach={type:c[r.id]},a(r.data)){var n=r.data;if(a(n.operator)&&(t.attach.from=n.operator),a(n.opeNick)&&(t.attach.fromNick=n.opeNick),a(n.target)&&(t.attach.to=n.target),a(n.tarNick)&&(t.attach.toNick=n.tarNick),a(n.muteDuration)&&(t.attach.duration=o(n.muteDuration,10)),"memberEnter"===t.attach.type&&(a(n.muted)?t.attach.gaged=1==+n.muted:t.attach.gaged=!1,a(n.tempMuted)?t.attach.tempMuted=1==+n.tempMuted:t.attach.tempMuted=!1,a(n.muteTtl)?t.attach.tempMuteDuration=+n.muteTtl:t.attach.tempMuteDuration=0),"deleteChatroomMsg"===t.attach.type&&(t.attach.msgId=n.msgId,t.attach.msgTime=n.msgTime),a(n.ext)&&(t.attach.custom=n.ext),a(n.queueChange)){var u=JSON.parse(n.queueChange);switch(u._e){case"OFFER":t.attach.queueChange={type:"OFFER",elementKey:u.key,elementValue:u.content};break;case"POLL":t.attach.queueChange={type:"POLL",elementKey:u.key,elementValue:u.content};break;case"DROP":t.attach.queueChange={type:"DROP"};break;case"PARTCLEAR":case"BATCH_UPDATE":t.attach.queueChange={type:u._e,elementKv:u.kvObject};break;case"BATCH_OFFER":t.attach.queueChange={type:u._e,elements:u.elements}}}}}else t.attach={};return t},e.exports=u},function(e,t,r){var n=r(11),i=r(14),o=r(5),a=r(90),s=r(0);function c(e){s.verifyOptions(e,"content","msg::CustomMessage"),e.type="custom",a.call(this,e),"string"!=typeof e.content&&(e.content=n(e.content)),this.attach=e.content}c.prototype=i(a.prototype),c.reverse=function(e){var t=o(a).call(a,e);return t.content=e.attach,t},e.exports=c},function(e,t,r){var n=r(14),i=r(5),o=r(90),a=r(0);function s(e){a.verifyOptions(e,"tip","msg::TipMessage"),e.type="tip",o.call(this,e),this.attach=e.tip}s.prototype=n(o.prototype),s.reverse=function(e){var t=i(o).call(o,e);return t.tip=e.attach,t},e.exports=s},function(e,t,r){var n=r(11),i=r(14),o=r(5),a=r(8),s=r(90),c=r(0),u={welcome:"00",text:"01",link:"03"},l={"01":"text","02":"image","03":"answer",11:"template"};function d(e){c.verifyOptions(e,"content","msg::RobotMessage");var t=e.content;switch(t.type){case"welcome":c.undef(e.body)&&(this.body="欢迎消息");break;case"text":c.verifyOptions(t,"content","msg::RobotMessage"),c.undef(e.body)&&(this.body=t.content);break;case"link":c.verifyOptions(t,"target","msg::RobotMessage")}t.type&&(t.type=u[t.type]),t={param:t,robotAccid:e.robotAccid},this.attach=n(t),e.type="robot",s.call(this,e)}d.prototype=i(s.prototype),d.reverse=function(e){var t=o(s).call(s,e);if("robot"===t.type){var r=JSON.parse(e.attach);if(r.param&&(r.param.type=l[r.param.type]||"unknown"),r.robotMsg){var n=(r=c.merge(r,r.robotMsg)).message;"bot"===r.flag?r.message=a(n).call(n,(function(e){return e.type=l[e.type]||"unknown",e})):r.flag,delete r.robotMsg}t.content=r}return t},e.exports=d},function(e,t,r){var n=r(5),i=r(29),o=r(8),a=r(19),s=r(0),c=s.undef,u=r(156).fn;u.beforeSendMsg=function(e){e.cmd="sendMsg"};var l={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};u.getHistoryMsgs=function(e){if(s.verifyOptions(e),c(e.timetag)?e.timetag=0:s.verifyParamType("timetag",e.timetag,"number","msg::getHistoryMsgs"),c(e.limit)?e.limit=100:s.verifyParamType("limit",e.limit,"number","msg::getHistoryMsgs"),c(n(e))?e.reverse=!1:s.verifyParamType("reverse",n(e),"boolean","msg::getHistoryMsgs"),c(e.msgTypes))e.msgTypes=[];else if(i(e.msgTypes)){var t,r;e.msgTypes=o(t=e.msgTypes).call(t,(function(e){return l[e]})),e.msgTypes=a(r=e.msgTypes).call(r,(function(e){return"number"==typeof e}))}else"number"==typeof l[e.msgTypes]?e.msgTypes=[l[e.msgTypes]]:e.msgTypes=[];this.processCallback(e),this.sendCmd("getHistoryMsgs",e,(function(t,r,n){i(n)&&(n=o(n).call(n,(function(e){return l[e.type]&&(e.type=l[e.type]),e}))),e.callback(t,r,n)}))}},function(e,t,r){var n=r(0),i=n.undef,o=n.verifyOptions,a=n.verifyParamType,s=r(225),c=r(156).fn;c.updateMyChatroomMemberInfo=function(e){o(e,"member needNotify","member::updateMyChatroomMemberInfo"),a("needNotify",e.needNotify,"boolean","member::updateMyChatroomMemberInfo"),e.needSave=e.needSave||!1,a("needSave",e.needSave,"boolean","member::updateMyChatroomMemberInfo"),this.processCustom(e),this.processCallback(e),e.chatroomMember=new s(e.member),e.antispamTag={antiSpamBusinessId:e.antiSpamBusinessId},this.sendCmd("updateMyChatroomMemberInfo",e)},c.getChatroomMembers=function(e){o(e,"guest","member::getChatroomMembers"),a("guest",e.guest,"boolean","member::getChatroomMembers"),i(e.time)?e.time=0:a("time",e.time,"number","member::getChatroomMembers"),i(e.limit)?e.limit=100:a("limit",e.limit,"number","member::getChatroomMembers"),this.processCallback(e),e.guest?e.type=!1===e.desc?3:1:e.type=e.onlyOnline?2:0,this.sendCmd("getChatroomMembers",e)},c.getChatroomMembersByTag=function(e){o(e,"tag","getChatroomMembersByTag::rag"),i(e.time)?e.time=0:a("time",e.time,"number","getChatroomMembersByTag::time"),i(e.limit)?e.limit=100:a("limit",e.limit,"number","getChatroomMembersByTag::limit"),this.processCallback(e),this.sendCmd("getChatroomMembersByTag",{tagMemberReq:n.filterObj(e,"tag limit time"),callback:e.callback})},c.getChatroomMemberCountByTag=function(e){o(e,"tag","getChatroomMemberCountByTag::rag"),this.processCallback(e),this.sendCmd("getChatroomMemberCountByTag",e)},c.getChatroomMembersInfo=function(e){o(e,"accounts","member::getChatroomMembersInfo"),a("accounts",e.accounts,"array","member::getChatroomMembersInfo"),this.processCallback(e),this.sendCmd("getChatroomMembersInfo",e)},c.markChatroomIdentity=function(e){o(e,"identity","member::markChatroomIdentity"),e.type={manager:1,common:2,black:-1,mute:-2}[e.identity],delete e.identity,isNaN(e.type)?o(e,"identity",'member::markChatroomIdentity. The valid value of the identity is "manager" or "common" or "black" or "mute".'):this.markChatroomMember(e)},c.markChatroomManager=function(e){e.type=1,this.markChatroomMember(e)},c.markChatroomCommonMember=function(e){e.type=2,this.markChatroomMember(e)},c.markChatroomBlacklist=function(e){e.type=-1,this.markChatroomMember(e)},c.markChatroomGaglist=function(e){e.type=-2,this.markChatroomMember(e)},c.markChatroomMember=function(e){o(e,"account type isAdd","member::markChatroomMember"),a("isAdd",e.isAdd,"boolean","member::markChatroomMember"),i(e.level)?e.level=0:a("level",e.level,"number","member::markChatroomMember"),this.processCustom(e),this.processCallback(e),this.sendCmd("markChatroomMember",e)},c.kickChatroomMember=function(e){o(e,"account","member::kickChatroomMember"),this.processCustom(e),this.processCallback(e),this.sendCmd("kickChatroomMember",e)},c.updateChatroomMemberTempMute=function(e){o(e,"account duration needNotify","member::updateChatroomMemberTempMute"),a("duration",e.duration,"number","member::updateChatroomMemberTempMute"),a("needNotify",e.needNotify,"boolean","member::updateChatroomMemberTempMute"),this.processCustom(e),this.processCallback(e),this.sendCmd("updateChatroomMemberTempMute",e)},c.updateTagMembersTempMute=function(e){o(e,"tag duration needNotify","member::updateTagMembersTempMute"),a("duration",e.duration,"number","member::updateTagMembersTempMute"),a("needNotify",e.needNotify,"boolean","member::updateTagMembersTempMute"),this.processCustom(e),this.processCallback(e);var t=n.filterObj(e,"tag duration custom notifyTargetTags");t.needNotify=e.needNotify?1:0,this.sendCmd("updateTagMembersTempMute",{tagMuteReq:t,callback:e.callback})},c.updateCoordinate=n.throttle((function(e){var t=!0;void 0===e.x||void 0===e.y||void 0===e.z?t=!1:("number"!=typeof e.x&&(e.x=0),"number"!=typeof e.y&&(e.y=0),"number"!=typeof e.z&&(e.z=0)),this.processCallback(e);var r=n.filterObj(e,t?"x y z distance":"distance");this.sendCmd("updateCoordinate",{coordinateReq:r,callback:e.callback})}),300,{},(function(e){e&&e.done&&e.done({code:416,chatroomId:this.options.chatroomId})})),c.getRobotList=function(e){i(e.timetag)&&(e.timetag=0),this.processCallback(e),this.sendCmd("syncRobot",e)}},function(e,t,r){var n=r(156).fn,i=r(0);n.queueOffer=function(e){i.verifyOptions(e,"elementKey elementValue","msg::queueOffer");var t={elementKey:e.elementKey,elementValue:e.elementValue,transient:!!e.transient};e.elementAccount&&(t.elementAccount=e.elementAccount),this.processCallback(e),this.sendCmd("queueOffer",t,e.callback)},n.queuePoll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.elementKey=e.elementKey||"",this.processCallback(e),this.sendCmd("queuePoll",e,e.callback)},n.queueList=function(e){this.processCallback(e),this.sendCmd("queueList",e,e.callback)},n.peak=function(e){this.processCallback(e),this.sendCmd("peak",e,e.callback)},n.queueDrop=function(e){this.processCallback(e),this.sendCmd("queueDrop",e,e.callback)},n.queueChange=function(e){i.verifyOptions(e,"elementMap","msg::queueOffer"),e.needNotify?(e.needNotify=!0,i.verifyOptions(e,"notifyExt","msg::queueOffer")):e.needNotify=!1,this.processCallback(e),this.sendCmd("queueChange",e,e.callback)}},,,function(e,t,r){e.exports=r(621)},function(e,t,r){r(211);var n={NIM:r(496),Chatroom:r(592)};r(224)(n),e.exports=n}])},module.exports=t(function(){try{return require("crypto")}catch(e){}}())})(NIM_Web_SDK_v8_11_3);var NIM=getDefaultExportFromCjs(NIM_Web_SDK_v8_11_3.exports),NEIM=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.init=function(e){this.appKey=e.appKey,this.token=e.token,this.account=e.account,this.imPrivateConf=e.imPrivateConf,this.roomAccountId=e.roomAccountId,this.roomAppKey=e.roomAppKey,this.roomAccountToken=e.roomAccountToken},t.prototype.resetState=function(){this.isReuseIM||this.nim.removeAllListeners(),this.nim=null},t.prototype.destroy=function(){return this.appKey="",this.token="",this.account="",this.imPrivateConf=void 0,this.roomAccountId="",this.roomAppKey="",this.roomAccountToken="",this.roomId="",this.logout()},t.prototype.login=function(){var e=this;return new Promise((function(r,n){if(e.isReuseIM){if(!e.nim)throw new Error("nim is null");return e.nim.options.account!==e.account?(e.logger.error("reuse IM, but IM account not match",e.nim.options.account,e.account),n(NEErrorCode.IM_REUSE_ACCOUNT_NOT_MATCH)):e.nim.protocol.isConnected()?r():n(NEErrorCode.IM_REUSE_NOT_LOGIN)}var i={};if(e.imPrivateConf){var o=e.imPrivateConf,a=o.lbs,s=o.link,c=o.linkSslWeb,u=o.nosUploader,l=o.httpsEnabled,d=o.nosDownloader;i.lbs_web=a,i.link_web=s,i.nos_uploader_web=u,i.link_ssl_web=c,i.https_enabled=l,i.nos_downloader=d}if(e.nim)return r();e.nim=NIM.NIM.getInstance({appKey:e.appKey,account:e.account,token:e.token,debug:e.debug,customTag:e.deviceId,onconnect:function(n){e.logger.log(t.TAG_NAME,"login connect"),e.emit("imConnect",n),r()},onwillreconnect:function(r){e.logger.log(t.TAG_NAME,"onwillreconnect",r),e.emit("imWillReConnect",r)},ondisconnect:function(r){e.logger.log(t.TAG_NAME,"login disconnect",r),e.emit("imDisconnect",r),e.resetState(),n(r)},onerror:function(r){e.logger.log(t.TAG_NAME,"login error",r),n(r)},onmsgs:function(t){e.emit("onRecvMsg",t)},onProxyMsg:function(r){e.emit("controlNotify",r),e.logger.log(t.TAG_NAME,"onProxyMsg",JSON.stringify(r))},privateConf:i})}))},t.prototype.logout=function(){var e=this;return new Promise((function(t,r){if(e.isReuseIM)return e.emit("imLogout",null),t();e.nim?e.nim.destroy({done:function(r){e.emit("imLogout",r),e.nim=null,t()}}):t()}))},t.prototype.setRoomId=function(e){this.roomId=e},t.prototype.sendHostProxy=function(e){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:this.logger.log(t.TAG_NAME,"sendHostProxy",e),n.label=1;case 1:if(n.trys.push([1,3,,4]),!this.roomId)throw new Error("roomId is empty");return[4,this.sendProxy({path:"/v1/sdk/meeting/control/host",body:{meetingId:this.roomId,action:e.action,members:e.accountIds,avRoomUids:e.avRoomUids}})];case 2:return n.sent(),[3,4];case 3:throw r=n.sent(),this.logger.error(t.TAG_NAME,"sendHostProxy fail: ",r),r;case 4:return[2]}}))}))},t.prototype.sendMemberProxy=function(e){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:this.logger.log(t.TAG_NAME,"sendMemberProxy"),n.label=1;case 1:if(n.trys.push([1,3,,4]),!this.roomId)throw new Error("roomId is empty");return[4,this.sendProxy({path:"/v1/sdk/meeting/control/member",body:{meetingId:this.roomId,action:e.action,avRoomUids:e.avRoomUids}})];case 2:return n.sent(),[3,4];case 3:throw r=n.sent(),this.logger.error(t.TAG_NAME,"sendMemberProxy fail: ",r),r;case 4:return[2]}}))}))},t.prototype.sendProxy=function(e){var t=this,r={clientType:this.clientType,meetingSdkVersion:this.version,appKey:this.roomAppKey,accountId:this.roomAccountId,accountToken:this.roomAccountToken,deviceId:this.deviceId};return new Promise((function(n,i){if(!t.nim)throw new Error("nim is null");return t.nim.options.account!==t.account?(t.logger.error("reuse IM, but IM account not match",t.nim.options.account,t.account),i(NEErrorCode.IM_REUSE_ACCOUNT_NOT_MATCH)):t.nim.protocol.isConnected()?void t.nim.httpRequestProxy({header:JSON.stringify(r),path:e.path,body:JSON.stringify(e.body),done:function(e,t){e?i(e):n(JSON.parse(t.body))}}):(t.logger.error("reuse IM, but IM not login"),i(NEErrorCode.IM_REUSE_NOT_LOGIN))}))},t.prototype.onReuseIm=function(e,r){if(this.isReuseIM)switch(e){case"reuseImWillReconnect":this.logger.log(t.TAG_NAME,"reuseImWillReconnect",r),this.emit("imWillReConnect",r);break;case"reuseImDisconnect":this.logger.log(t.TAG_NAME,"reuseImDisconnect"),this.emit("imDisconnect",r),this.resetState();break;case"reuseImError":this.logger.log(t.TAG_NAME,"reuseImError",r);break;case"reuseImMsgs":this.emit("onRecvMsg",r);break;case"reuseImProxyMsg":this.logger.log(t.TAG_NAME,"reuseImProxyMsg",r),this.emit("controlNotify",r)}},t.TAG_NAME="IMImpl",t}(IM),Chatroom=function(){function e(e){this.imAccid="",this.isConnect=!1,this.debug=e.debug,this.imImpl=e.imImpl,this.logger=e.logger,this.emitter=e.emitter}return e.prototype.logout=function(){var e=this;return new Promise((function(t,r){e.nim?(e.nim.destroy({done:function(e){e?r(e):t()}}),e.resetState()):t()}))},e.prototype.sendTextMessage=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return this.nim.sendText(e)},e.prototype.resendTextMessage=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return this.nim.sendText(__assign(__assign({},e),{flow:"out",status:"fail",resend:!0}))},e.prototype.sendFileMessage=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return this.nim.sendFile(e)},e.prototype.resendFileMessage=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return this.nim.sendFile(__assign(__assign({},e),{flow:"out",status:"fail",resend:!0}))},e.prototype.getHistoryMsgs=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return e=e||{},this.nim.getHistoryMsgs(__assign({},e))},e.prototype.getMembers=function(e){var t=this,r=e.guest,n=void 0===r||r,i=e.limit,o=void 0===i?100:i,a=e.time;return new Promise((function(e,r){t.nim.getChatroomMembers({guest:n,limit:o,time:a,done:function(n,i){if(n)return t.logger.error("getMembers failed: ",n),r(n);t.logger.log("getMembers success: ",i),e(i.members)}})}))},e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.off=function(e){this.emitter.off(e)},e.prototype.parseMsgs=function(e){var t=this,r=e.map((function(e){return __assign(__assign({},e),{isMe:e.fromUserUuid===t.imAccid})}));this.emitter.emit("onRecvMsg",r)},e.prototype.resetState=function(){this.nim=null,this.isConnect=!1,this.imAccid=""},e}(),NERoomChat=function(e){function t(t){return e.call(this,{emitter:t.emitter,debug:t.debug,logger:t.logger,imImpl:t.im})||this}return __extends(t,e),t.prototype.login=function(e){var r=this,n=e.account,i=e.appKey,o=e.token,a=e.chatroomId,s=e.chatroomNick,c=e.tags,u=e.notifyTargetTags,l=e.chatroomCustom;return this.logger.log(t.TAG_NAME,"joinChatroom"),new Promise((function(e,d){r.imImpl.nim.getChatroomAddress({chatroomId:a,done:function(p,f){if(p)return r.logger.log(t.TAG_NAME,"init fail: ",p),d(p);r.nim=NIM.Chatroom.getInstance({appKey:i,account:n,token:o,debug:r.debug,chatroomId:a,chatroomNick:s,tags:c,notifyTargetTags:u,chatroomCustom:l,chatroomAddresses:f.address,commonUpload:!0,onconnect:function(){r.logger.log(t.TAG_NAME,"chatroom onconnect"),r.isConnect=!0,r.imAccid=n,e()},ondisconnect:function(){r.logger.log(t.TAG_NAME,"chatroom ondisconnect"),r.resetState(),d()},onerror:function(e){r.logger.log(t.TAG_NAME,"chatroom error: ",e)},onmsgs:function(e){r.logger.log(t.TAG_NAME,"chatroom onmsgs",e),r.parseMsgs(e)}})}})}))},t.TAG_NAME="NERoomChat-Web",t}(Chatroom),WebRoomkit=function(e){function t(r){var n=this,i="https://roomkit.netease.im",o=axios.create({baseURL:i}),a=r&&r.debug||!1,s=new NERequest({appKey:"",baseDomain:i,clientType:NEClientType.WEB,request:o,token:"",userUuid:"",deviceId:t.getDeviceId(),versionCode:"1.5.1"}),c=new LogDebug({level:"log",appName:"roomkit-web",version:"1.5.1"}),u=new EventEmitter,l={Chatroom:NERoomChat,Im:NEIM,Rtc:NERTC,ToolCollection:ToolCollection,Whiteboard:Whiteboard,EventEmitter:EventEmitter,emitter:u,logger:c,request:s,debug:a,deviceId:t.getDeviceId()};return(n=e.call(this,l)||this)._emitter=u,o.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),o.interceptors.response.use((function(e){var t=e.data.code;return console.log("code",t),0!==t?(t==NEErrorCode.TOKEN_INCORRECT||t===NEErrorCode.UNAUTHORIZED?(console.log("code1111111111",t),n._emitter.emit(HTTP_EVENT.UNAUTHORIZED,t)):t===NEErrorCode.TOKEN_EXPIRED&&n._emitter.emit(HTTP_EVENT.TOKEN_EXPIRED,t),Promise.reject(e.data)):e.data}),(function(e){return Promise.reject(e)})),n}return __extends(t,e),Object.defineProperty(t.prototype,"deviceId",{get:function(){return t.getDeviceId()},enumerable:!1,configurable:!0}),t.getDeviceId=function(){var e=window.sessionStorage.getItem("NERoomkit-uuid");return e||(e=getUUID(),window.sessionStorage.setItem("NERoomkit-uuid",e),e)},t}(Roomkit),eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,o),!0;case 6:return l.fn.call(l.context,t,n,i,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(eventemitter3);var Eventemitter=eventemitter3.exports;const Auth=({renderCallback:e})=>{const[t,r]=react.exports.useState(!1),[n,i]=react.exports.useState(""),o=react.exports.useRef(""),[a,s]=react.exports.useState(!1),[c,u]=react.exports.useState(),[l,d]=react.exports.useState(""),{dispatch:p}=react.exports.useContext(MeetingInfoContext),{eventEmitter:f,neMeeting:h,dispatch:m}=react.exports.useContext(GlobalContext);react.exports.useEffect((()=>{null==f||f.on(UserEventType.LoginWithPassword,(e=>{const{options:t,callback:r}=e;y(t.username,t.password).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))})),null==f||f.on(UserEventType.Login,(e=>{const{options:t,callback:r}=e;g(t.accountId,t.accountToken).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))})),null==f||f.on(UserEventType.Logout,(e=>{const{callback:t}=e;v().then((()=>{t&&t()})).catch((e=>{t&&t(e)}))})),null==f||f.on(UserEventType.CreateMeeting,(e=>{const{options:t,callback:r}=e;b(t).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))})),null==f||f.on(UserEventType.JoinMeeting,(e=>{const{options:t,callback:r}=e;T(t).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))})),null==f||f.on(UserEventType.AnonymousJoinMeeting,(e=>{const{options:t,callback:r}=e;w(t).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))}));try{e&&e()}catch(e){console.warn("renderCallback failed",e)}}),[]),react.exports.useEffect((()=>{d("")}),[n]);const g=(e,t)=>h.login({accountId:e,accountToken:t,loginType:1}),v=()=>h.logout(),y=(e,t)=>h.login({username:e,password:t,loginType:2}),b=e=>h.create(e).then((()=>{const e=null==h?void 0:h.getMeetingInfo();console.log("创建会议成功",e),e&&p&&p({type:ActionType.SET_MEETING,data:e})})),S=e=>{p&&p({type:ActionType.UPDATE_MEETING_INFO,data:{isUnMutedVideo:1===e.video,isUnMutedAudio:1===e.audio}}),M();const t=null==h?void 0:h.getMeetingInfo();t&&t.meetingInfo&&(t.meetingInfo.isUnMutedAudio=1===e.audio,t.meetingInfo.isUnMutedVideo=1===e.video),t&&p&&p({type:ActionType.SET_MEETING,data:t})},_=(e,t)=>{switch(e.code){case 3104:case 1004:Toast.info("会议不存在"),M();break;case 1020:o.current&&d("会议密码错误"),u(t),r(!0);break;case 1019:Toast.info("会议已锁定，新参会者将无法加入会议"),M();break;default:Toast.info(e.message),M(),console.log(e,"加入失败")}};function M(){m&&m({type:ActionType.JOIN_LOADING,data:!1}),r(!1),i(""),d(""),s(!1),o.current=""}const T=e=>{if(!e.meetingId)throw Toast.info("请输入会议号"),new Error("meetingId is empty");return m&&m({type:ActionType.JOIN_LOADING,data:!0}),s(!1),h.join(e).then((t=>{S({video:e.video,audio:e.audio})})).catch((t=>{var r;return t.data&&(null===(r=t.data.message)||void 0===r?void 0:r.includes("mediaDevices is not support"))?(Toast.info("mediaDevices is not support"),S({video:null==e?void 0:e.video,audio:null==e?void 0:e.audio}),Promise.resolve()):(_(t,e),Promise.reject(t))}))},w=e=>{if(!e.meetingId)throw Toast.info("请输入会议号"),new Error("meetingId is empty");return m&&m({type:ActionType.JOIN_LOADING,data:!0}),s(!0),h.anonymousJoin(e).then((t=>{if([-101,-102].includes(null==t?void 0:t.code))throw t;S({video:e.video,audio:e.audio})})).catch((t=>{var r;return t.data&&(null===(r=t.data.message)||void 0===r?void 0:r.includes("mediaDevices is not support"))?(Toast.info("mediaDevices is not support"),S({video:null==e?void 0:e.video,audio:null==e?void 0:e.audio}),Promise.resolve()):(_(t,e),Promise.reject(t))}))};return jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:jsxRuntime.exports.jsx(Dialog,Object.assign({visible:t,title:"会议密码",confirmText:"加入会议",cancelText:"取消",onCancel:()=>{M()},onConfirm:()=>{!function(){if(!n.trim())return void d("请输入正确的会议密码");const e=Object.assign(Object.assign({},c),{password:n});console.log(e,"joinOption"),r(!1),a?null==f||f.emit(UserEventType.AnonymousJoinMeeting,{options:e}):null==f||f.emit(UserEventType.JoinMeeting,{options:e})}()}},{children:jsxRuntime.exports.jsxs("div",Object.assign({style:{minHeight:80,paddingTop:10}},{children:[jsxRuntime.exports.jsx("input",{style:{border:l?"1px solid red":"none"},className:"input-ele",placeholder:"请输入会议密码",maxLength:20,value:n.replace(/[^\d]/g,""),required:!0,onChange:e=>{let t=e.target.value;t=t.replace(/[^\d]/g,""),i(t),o.current=t}}),l?jsxRuntime.exports.jsx("div",Object.assign({style:{color:"#ff3141",marginTop:10,fontSize:12}},{children:l})):""]}))}))})},eventEmitter=new Eventemitter,outEventEmitter=new Eventemitter,roomkit=new WebRoomkit,joinLoading=void 0;function loadAsyncScript(e,t){const r=document.createElement("script");r.type="text/javascript",r.readyState?r.onreadystatechange=function(){"complete"!==r.readyState&&"loaded"!==r.readyState||t&&t()}:r.onload=function(){t&&t()},r.src=e,document.head.appendChild(r)}const render=(e,t,r)=>{const n=t.neMeeting;n.init({appKey:t.appKey,meetingServerDomain:t.meetingServerDomain}),ReactDOM.render(jsxRuntime.exports.jsx(GlobalContextProvider,Object.assign({outEventEmitter:outEventEmitter,eventEmitter:eventEmitter,neMeeting:n,joinLoading:joinLoading},{children:jsxRuntime.exports.jsxs(MeetingInfoContextProvider,Object.assign({memberList:[],meetingInfo:createMeetingInfoFactory()},{children:[jsxRuntime.exports.jsx(Auth,{renderCallback:r}),jsxRuntime.exports.jsx(App,{width:t.width,height:t.height})]}))})),e)},NEMeetingKit=new Proxy({view:null,NEMeetingInfo:null,toolBarList:[],moreBarList:[],memberInfo:{},joinMemberInfo:{},remoteMemberList:[],localMember:{},neMeeting:null,isInitialized:!1,login:(e,t)=>{console.log("login",e),eventEmitter.emit(UserEventType.Login,{options:e,callback:t})},logout:e=>{eventEmitter.emit(UserEventType.Logout,{callback:e})},loginWithPassword:(e,t)=>{console.log("loginWithPassword",e),eventEmitter.emit(UserEventType.LoginWithPassword,{options:e,callback:t})},init:(e=0,t=0,r,n)=>{if(NEMeetingKit.isInitialized)return void console.log("已初始化过");const i=new NEMeetingService({roomkit:roomkit,eventEmitter:eventEmitter});if(NEMeetingKit.neMeeting=i,!r||!r.appKey)throw new Error("init failed: appKey is empty");const o=document.getElementById("ne-web-meeting");if(!o)throw new Error("init failed: not found #ne-web-meeting");NEMeetingKit.view=o,NEMeetingKit.isInitialized=!0,render(o,{width:e,height:t,neMeeting:i,appKey:r.appKey,meetingServerDomain:r.meetingServerDomain},n)},checkSystemRequirements:e=>{var t;null===(t=NEMeetingKit.neMeeting)||void 0===t||t.checkSystemRequirements().then((t=>{e&&e(null,t)})).catch((t=>{e&&e(t)}))},anonymousJoinMeeting:(e,t)=>{eventEmitter.emit(UserEventType.AnonymousJoinMeeting,{options:e,callback:t})},create:(e,t)=>{eventEmitter.emit(UserEventType.CreateMeeting,{options:e,callback:t})},join:(e,t)=>{eventEmitter.emit(UserEventType.JoinMeeting,{options:e,callback:t})},afterLeave:e=>{e&&eventEmitter.emit(UserEventType.SetLeaveCallback,{callback:e})},destroy:()=>{console.log("destroy"),eventEmitter.emit("destroy"),NEMeetingKit.view&&ReactDOM.unmountComponentAtNode(NEMeetingKit.view),NEMeetingKit.view=null,NEMeetingKit.neMeeting=null,NEMeetingKit.isInitialized=!1,outEventEmitter.removeAllListeners()},on:(e,t)=>{outEventEmitter.on(e,t)},off:(e,t)=>{if(!e)throw new Error("please add your eventName when you use off");t?outEventEmitter.off(e,t):outEventEmitter.off(e)},uploadLog:(e,t)=>Promise.resolve([]),downloadLog:(e,t)=>Promise.resolve()},{get:function(e,t){var r,n,i,o,a,s,c,u,l;switch(t){case"memberInfo":let d=null;const p=null===(n=null===(r=NEMeetingKit.neMeeting)||void 0===r?void 0:r.roomContext)||void 0===n?void 0:n.localMember;return p&&(d=Object.assign(Object.assign({},p),{role:null===(i=p.role)||void 0===i?void 0:i.name})),d;case"joinMemberInfo":const f=null===(a=null===(o=NEMeetingKit.neMeeting)||void 0===o?void 0:o.roomContext)||void 0===a?void 0:a.remoteMembers,h=null===(c=null===(s=NEMeetingKit.neMeeting)||void 0===s?void 0:s.roomContext)||void 0===c?void 0:c.localMember,m={};return f&&Array.isArray(f)&&f.forEach((e=>{var t;(e.isInRtcChannel||e.uuid===(null==h?void 0:h.uuid))&&(m[e.uuid]=Object.assign(Object.assign({},e),{role:null===(t=e.role)||void 0===t?void 0:t.name}))})),h&&(m[h.uuid]=Object.assign(Object.assign({},h),{role:null===(u=h.role)||void 0===u?void 0:u.name})),m;case"NEMeetingInfo":{const e=null===(l=NEMeetingKit.neMeeting)||void 0===l?void 0:l.getMeetingInfo();if(e){const{meetingInfo:t}=e;return{isHost:!!t.hostUuid&&t.hostUuid===t.localMember.uuid,isLocked:t.isLocked,meetingId:t.meetingId,password:t.password,shortMeetingId:t.shortId,sipId:t.sipCid}}return{}}default:return e[t]}}});loadAsyncScript("//at.alicdn.com/t/font_2183559_zbxov2d0djl.js");var index={actions:NEMeetingKit};return index}));
