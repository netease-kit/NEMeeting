!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).NEMeetingKit=t()}(this,(function(){"use strict";function _mergeNamespaces(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}function __awaiter$2(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={},getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty$6=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function shouldUseNative(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map((function(e){return t[e]}));if("0123456789"!==n.join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(e,t){for(var r,n,i=toObject(e),o=1;o<arguments.length;o++){for(var s in r=Object(arguments[o]))hasOwnProperty$6.call(r,s)&&(i[s]=r[s]);if(getOwnPropertySymbols){n=getOwnPropertySymbols(r);for(var a=0;a<n.length;a++)propIsEnumerable.call(r,n[a])&&(i[n[a]]=r[n[a]])}}return i},l$2=objectAssign,n$3="function"==typeof Symbol&&Symbol.for,p$2=n$3?Symbol.for("react.element"):60103,q$2=n$3?Symbol.for("react.portal"):60106,r$2=n$3?Symbol.for("react.fragment"):60107,t$1=n$3?Symbol.for("react.strict_mode"):60108,u$2=n$3?Symbol.for("react.profiler"):60114,v$2=n$3?Symbol.for("react.provider"):60109,w$2=n$3?Symbol.for("react.context"):60110,x$1=n$3?Symbol.for("react.forward_ref"):60112,y$2=n$3?Symbol.for("react.suspense"):60113,z$1=n$3?Symbol.for("react.memo"):60115,A$1=n$3?Symbol.for("react.lazy"):60116,B$1="function"==typeof Symbol&&Symbol.iterator;function C$2(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var D$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E$2={};function F$2(e,t,r){this.props=e,this.context=t,this.refs=E$2,this.updater=r||D$1}function G$2(){}function H$2(e,t,r){this.props=e,this.context=t,this.refs=E$2,this.updater=r||D$1}F$2.prototype.isReactComponent={},F$2.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(C$2(85));this.updater.enqueueSetState(this,e,t,"setState")},F$2.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},G$2.prototype=F$2.prototype;var I$2=H$2.prototype=new G$2;I$2.constructor=H$2,l$2(I$2,F$2.prototype),I$2.isPureReactComponent=!0;var J$2={current:null},K$2=Object.prototype.hasOwnProperty,L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(e,t,r){var n,i={},o=null,s=null;if(null!=t)for(n in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)K$2.call(t,n)&&!L$2.hasOwnProperty(n)&&(i[n]=t[n]);var a=arguments.length-2;if(1===a)i.children=r;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(n in a=e.defaultProps)void 0===i[n]&&(i[n]=a[n]);return{$$typeof:p$2,type:e,key:o,ref:s,props:i,_owner:J$2.current}}function N$2(e,t){return{$$typeof:p$2,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function O$2(e){return"object"==typeof e&&null!==e&&e.$$typeof===p$2}function escape$1(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}var P$2=/\/+/g,Q$2=[];function R$2(e,t,r,n){if(Q$2.length){var i=Q$2.pop();return i.result=e,i.keyPrefix=t,i.func=r,i.context=n,i.count=0,i}return{result:e,keyPrefix:t,func:r,context:n,count:0}}function S$2(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>Q$2.length&&Q$2.push(e)}function T$2(e,t,r,n){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var o=!1;if(null===e)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case p$2:case q$2:o=!0}}if(o)return r(n,e,""===t?"."+U$2(e,0):t),1;if(o=0,t=""===t?".":t+":",Array.isArray(e))for(var s=0;s<e.length;s++){var a=t+U$2(i=e[s],s);o+=T$2(i,a,r,n)}else if(null===e||"object"!=typeof e?a=null:a="function"==typeof(a=B$1&&e[B$1]||e["@@iterator"])?a:null,"function"==typeof a)for(e=a.call(e),s=0;!(i=e.next()).done;)o+=T$2(i=i.value,a=t+U$2(i,s++),r,n);else if("object"===i)throw r=""+e,Error(C$2(31,"[object Object]"===r?"object with keys {"+Object.keys(e).join(", ")+"}":r,""));return o}function V$3(e,t,r){return null==e?0:T$2(e,"",t,r)}function U$2(e,t){return"object"==typeof e&&null!==e&&null!=e.key?escape$1(e.key):t.toString(36)}function W$2(e,t){e.func.call(e.context,t,e.count++)}function aa$1(e,t,r){var n=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?X$2(e,n,r,(function(e){return e})):null!=e&&(O$2(e)&&(e=N$2(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(P$2,"$&/")+"/")+r)),n.push(e))}function X$2(e,t,r,n,i){var o="";null!=r&&(o=(""+r).replace(P$2,"$&/")+"/"),V$3(e,aa$1,t=R$2(t,o,n,i)),S$2(t)}var Y$2={current:null};function Z$2(){var e=Y$2.current;if(null===e)throw Error(C$2(321));return e}var ba$1={ReactCurrentDispatcher:Y$2,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:J$2,IsSomeRendererActing:{current:!1},assign:l$2};react_production_min.Children={map:function(e,t,r){if(null==e)return e;var n=[];return X$2(e,n,null,t,r),n},forEach:function(e,t,r){if(null==e)return e;V$3(e,W$2,t=R$2(null,null,t,r)),S$2(t)},count:function(e){return V$3(e,(function(){return null}),null)},toArray:function(e){var t=[];return X$2(e,t,null,(function(e){return e})),t},only:function(e){if(!O$2(e))throw Error(C$2(143));return e}},react_production_min.Component=F$2,react_production_min.Fragment=r$2,react_production_min.Profiler=u$2,react_production_min.PureComponent=H$2,react_production_min.StrictMode=t$1,react_production_min.Suspense=y$2,react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ba$1,react_production_min.cloneElement=function(e,t,r){if(null==e)throw Error(C$2(267,e));var n=l$2({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=J$2.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)K$2.call(t,c)&&!L$2.hasOwnProperty(c)&&(n[c]=void 0===t[c]&&void 0!==a?a[c]:t[c])}var c=arguments.length-2;if(1===c)n.children=r;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];n.children=a}return{$$typeof:p$2,type:e.type,key:i,ref:o,props:n,_owner:s}},react_production_min.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:w$2,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:v$2,_context:e},e.Consumer=e},react_production_min.createElement=M$2,react_production_min.createFactory=function(e){var t=M$2.bind(null,e);return t.type=e,t},react_production_min.createRef=function(){return{current:null}},react_production_min.forwardRef=function(e){return{$$typeof:x$1,render:e}},react_production_min.isValidElement=O$2,react_production_min.lazy=function(e){return{$$typeof:A$1,_ctor:e,_status:-1,_result:null}},react_production_min.memo=function(e,t){return{$$typeof:z$1,type:e,compare:void 0===t?null:t}},react_production_min.useCallback=function(e,t){return Z$2().useCallback(e,t)},react_production_min.useContext=function(e,t){return Z$2().useContext(e,t)},react_production_min.useDebugValue=function(){},react_production_min.useEffect=function(e,t){return Z$2().useEffect(e,t)},react_production_min.useImperativeHandle=function(e,t,r){return Z$2().useImperativeHandle(e,t,r)},react_production_min.useLayoutEffect=function(e,t){return Z$2().useLayoutEffect(e,t)},react_production_min.useMemo=function(e,t){return Z$2().useMemo(e,t)},react_production_min.useReducer=function(e,t,r){return Z$2().useReducer(e,t,r)},react_production_min.useRef=function(e){return Z$2().useRef(e)},react_production_min.useState=function(e){return Z$2().useState(e)},react_production_min.version="16.14.0",react.exports=react_production_min;var React=react.exports,f$1=react.exports,g$1=60103;if(reactJsxRuntime_production_min.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var h$2=Symbol.for;g$1=h$2("react.element"),reactJsxRuntime_production_min.Fragment=h$2("react.fragment")}var m$2=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n$2=Object.prototype.hasOwnProperty,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q$1(e,t,r){var n,i={},o=null,s=null;for(n in void 0!==r&&(o=""+r),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(s=t.ref),t)n$2.call(t,n)&&!p$1.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:g$1,type:e,key:o,ref:s,props:i,_owner:m$2.current}}reactJsxRuntime_production_min.jsx=q$1,reactJsxRuntime_production_min.jsxs=q$1,jsxRuntime.exports=reactJsxRuntime_production_min;var reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};!function(e){var t,r,n,i,o;if("undefined"==typeof window||"function"!=typeof MessageChannel){var s=null,a=null,c=function(){if(null!==s)try{var t=e.unstable_now();s(!0,t),s=null}catch(e){throw setTimeout(c,0),e}},u=Date.now();e.unstable_now=function(){return Date.now()-u},t=function(e){null!==s?setTimeout(t,0,e):(s=e,setTimeout(c,0))},r=function(e,t){a=setTimeout(e,t)},n=function(){clearTimeout(a)},i=function(){return!1},o=e.unstable_forceFrameRate=function(){}}else{var l=window.performance,d=window.Date,p=window.setTimeout,m=window.clearTimeout;if("undefined"!=typeof console){var f=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==typeof l&&"function"==typeof l.now)e.unstable_now=function(){return l.now()};else{var h=d.now();e.unstable_now=function(){return d.now()-h}}var g=!1,v=null,y=-1,b=5,S=0;i=function(){return e.unstable_now()>=S},o=function(){},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):b=0<e?Math.floor(1e3/e):5};var T=new MessageChannel,_=T.port2;T.port1.onmessage=function(){if(null!==v){var t=e.unstable_now();S=t+b;try{v(!0,t)?_.postMessage(null):(g=!1,v=null)}catch(e){throw _.postMessage(null),e}}else g=!1},t=function(e){v=e,g||(g=!0,_.postMessage(null))},r=function(t,r){y=p((function(){t(e.unstable_now())}),r)},n=function(){m(y),y=-1}}function w(e,t){var r=e.length;e.push(t);e:for(;;){var n=r-1>>>1,i=e[n];if(!(void 0!==i&&0<E(i,t)))break e;e[n]=t,e[r]=i,r=n}}function M(e){return void 0===(e=e[0])?null:e}function x(e){var t=e[0];if(void 0!==t){var r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,i=e.length;n<i;){var o=2*(n+1)-1,s=e[o],a=o+1,c=e[a];if(void 0!==s&&0>E(s,r))void 0!==c&&0>E(c,s)?(e[n]=c,e[a]=r,n=a):(e[n]=s,e[o]=r,n=o);else{if(!(void 0!==c&&0>E(c,r)))break e;e[n]=c,e[a]=r,n=a}}}return t}return null}function E(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}var C=[],R=[],k=1,A=null,I=3,O=!1,P=!1,N=!1;function D(e){for(var t=M(R);null!==t;){if(null===t.callback)x(R);else{if(!(t.startTime<=e))break;x(R),t.sortIndex=t.expirationTime,w(C,t)}t=M(R)}}function L(e){if(N=!1,D(e),!P)if(null!==M(C))P=!0,t(j);else{var n=M(R);null!==n&&r(L,n.startTime-e)}}function j(t,o){P=!1,N&&(N=!1,n()),O=!0;var s=I;try{for(D(o),A=M(C);null!==A&&(!(A.expirationTime>o)||t&&!i());){var a=A.callback;if(null!==a){A.callback=null,I=A.priorityLevel;var c=a(A.expirationTime<=o);o=e.unstable_now(),"function"==typeof c?A.callback=c:A===M(C)&&x(C),D(o)}else x(C);A=M(C)}if(null!==A)var u=!0;else{var l=M(R);null!==l&&r(L,l.startTime-o),u=!1}return u}finally{A=null,I=s,O=!1}}function U(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var F=o;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){P||O||(P=!0,t(j))},e.unstable_getCurrentPriorityLevel=function(){return I},e.unstable_getFirstCallbackNode=function(){return M(C)},e.unstable_next=function(e){switch(I){case 1:case 2:case 3:var t=3;break;default:t=I}var r=I;I=t;try{return e()}finally{I=r}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=F,e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=I;I=e;try{return t()}finally{I=r}},e.unstable_scheduleCallback=function(i,o,s){var a=e.unstable_now();if("object"==typeof s&&null!==s){var c=s.delay;c="number"==typeof c&&0<c?a+c:a,s="number"==typeof s.timeout?s.timeout:U(i)}else s=U(i),c=a;return i={id:k++,callback:o,priorityLevel:i,startTime:c,expirationTime:s=c+s,sortIndex:-1},c>a?(i.sortIndex=c,w(R,i),null===M(C)&&i===M(R)&&(N?n():N=!0,r(L,c-a))):(i.sortIndex=s,w(C,i),P||O||(P=!0,t(j))),i},e.unstable_shouldYield=function(){var t=e.unstable_now();D(t);var r=M(C);return r!==A&&null!==A&&null!==r&&null!==r.callback&&r.startTime<=t&&r.expirationTime<A.expirationTime||i()},e.unstable_wrapCallback=function(e){var t=I;return function(){var r=I;I=t;try{return e.apply(this,arguments)}finally{I=r}}}}(scheduler_production_min),scheduler.exports=scheduler_production_min;var aa=react.exports,n$1=objectAssign,r$1=scheduler.exports;function u$1(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!aa)throw Error(u$1(227));function ba(e,t,r,n,i,o,s,a,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(e){this.onError(e)}}var da=!1,ea=null,fa=!1,ha=null,ia={onError:function(e){da=!0,ea=e}};function ja(e,t,r,n,i,o,s,a,c){da=!1,ea=null,ba.apply(ia,arguments)}function ka(e,t,r,n,i,o,s,a,c){if(ja.apply(this,arguments),da){if(!da)throw Error(u$1(198));var u=ea;da=!1,ea=null,fa||(fa=!0,ha=u)}}var la=null,ma=null,na=null;function oa(e,t,r){var n=e.type||"unknown-event";e.currentTarget=na(r),ka(n,t,void 0,e),e.currentTarget=null}var pa=null,qa={};function ra(){if(pa)for(var e in qa){var t=qa[e],r=pa.indexOf(e);if(!(-1<r))throw Error(u$1(96,e));if(!sa[r]){if(!t.extractEvents)throw Error(u$1(97,e));for(var n in sa[r]=t,r=t.eventTypes){var i=void 0,o=r[n],s=t,a=n;if(ta.hasOwnProperty(a))throw Error(u$1(99,a));ta[a]=o;var c=o.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&ua(c[i],s,a);i=!0}else o.registrationName?(ua(o.registrationName,s,a),i=!0):i=!1;if(!i)throw Error(u$1(98,n,e))}}}}function ua(e,t,r){if(va[e])throw Error(u$1(100,e));va[e]=t,wa[e]=t.eventTypes[r].dependencies}var sa=[],ta={},va={},wa={};function xa(e){var t,r=!1;for(t in e)if(e.hasOwnProperty(t)){var n=e[t];if(!qa.hasOwnProperty(t)||qa[t]!==n){if(qa[t])throw Error(u$1(102,t));qa[t]=n,r=!0}}r&&ra()}var ya=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),za=null,Aa=null,Ba=null;function Ca(e){if(e=ma(e)){if("function"!=typeof za)throw Error(u$1(280));var t=e.stateNode;t&&(t=la(t),za(e.stateNode,e.type,t))}}function Da(e){Aa?Ba?Ba.push(e):Ba=[e]:Aa=e}function Ea(){if(Aa){var e=Aa,t=Ba;if(Ba=Aa=null,Ca(e),t)for(e=0;e<t.length;e++)Ca(t[e])}}function Fa(e,t){return e(t)}function Ga(e,t,r,n,i){return e(t,r,n,i)}function Ha(){}var Ia=Fa,Ja=!1,Ka=!1;function La(){null===Aa&&null===Ba||(Ha(),Ea())}function Ma(e,t,r){if(Ka)return e(t,r);Ka=!0;try{return Ia(e,t,r)}finally{Ka=!1,La()}}var Na=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Oa=Object.prototype.hasOwnProperty,Pa={},Qa={};function Ra(e){return!!Oa.call(Qa,e)||!Oa.call(Pa,e)&&(Na.test(e)?Qa[e]=!0:(Pa[e]=!0,!1))}function Sa(e,t,r,n){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}function Ta(e,t,r,n){if(null==t||Sa(e,t,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function v$1(e,t,r,n,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o}var C$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){C$1[e]=new v$1(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];C$1[t]=new v$1(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){C$1[e]=new v$1(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){C$1[e]=new v$1(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){C$1[e]=new v$1(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){C$1[e]=new v$1(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){C$1[e]=new v$1(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){C$1[e]=new v$1(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){C$1[e]=new v$1(e,5,!1,e.toLowerCase(),null,!1)}));var Ua=/[\-:]([a-z])/g;function Va(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(Ua,Va);C$1[t]=new v$1(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(Ua,Va);C$1[t]=new v$1(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(Ua,Va);C$1[t]=new v$1(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){C$1[e]=new v$1(e,1,!1,e.toLowerCase(),null,!1)})),C$1.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){C$1[e]=new v$1(e,1,!1,e.toLowerCase(),null,!0)}));var Wa=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Xa(e,t,r,n){var i=C$1.hasOwnProperty(t)?C$1[t]:null;(null!==i?0===i.type:!n&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(Ta(t,r,i,n)&&(r=null),n||null===i?Ra(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=null===r?3!==i.type&&"":r:(t=i.attributeName,n=i.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(i=i.type)||4===i&&!0===r?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}Wa.hasOwnProperty("ReactCurrentDispatcher")||(Wa.ReactCurrentDispatcher={current:null}),Wa.hasOwnProperty("ReactCurrentBatchConfig")||(Wa.ReactCurrentBatchConfig={suspense:null});var Ya=/^(.*)[\\\/]/,E$1="function"==typeof Symbol&&Symbol.for,Za=E$1?Symbol.for("react.element"):60103,$a=E$1?Symbol.for("react.portal"):60106,ab=E$1?Symbol.for("react.fragment"):60107,bb=E$1?Symbol.for("react.strict_mode"):60108,cb=E$1?Symbol.for("react.profiler"):60114,db=E$1?Symbol.for("react.provider"):60109,eb=E$1?Symbol.for("react.context"):60110,fb=E$1?Symbol.for("react.concurrent_mode"):60111,gb=E$1?Symbol.for("react.forward_ref"):60112,hb=E$1?Symbol.for("react.suspense"):60113,ib=E$1?Symbol.for("react.suspense_list"):60120,jb=E$1?Symbol.for("react.memo"):60115,kb=E$1?Symbol.for("react.lazy"):60116,lb=E$1?Symbol.for("react.block"):60121,mb="function"==typeof Symbol&&Symbol.iterator;function nb(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=mb&&e[mb]||e["@@iterator"])?e:null}function ob(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}function pb(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case ab:return"Fragment";case $a:return"Portal";case cb:return"Profiler";case bb:return"StrictMode";case hb:return"Suspense";case ib:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case eb:return"Context.Consumer";case db:return"Context.Provider";case gb:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case jb:return pb(e.type);case lb:return pb(e.render);case kb:if(e=1===e._status?e._result:null)return pb(e)}return null}function qb(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var r="";break e;default:var n=e._debugOwner,i=e._debugSource,o=pb(e.type);r=null,n&&(r=pb(n.type)),n=o,o="",i?o=" (at "+i.fileName.replace(Ya,"")+":"+i.lineNumber+")":r&&(o=" (created by "+r+")"),r="\n    in "+(n||"Unknown")+o}t+=r,e=e.return}while(e);return t}function rb(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function sb(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function tb(e){var t=sb(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==r&&"function"==typeof r.get&&"function"==typeof r.set){var i=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function xb(e){e._valueTracker||(e._valueTracker=tb(e))}function yb(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=sb(e)?e.checked?"true":"false":e.value),(e=n)!==r&&(t.setValue(e),!0)}function zb(e,t){var r=t.checked;return n$1({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function Ab(e,t){var r=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;r=rb(null!=t.value?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Bb(e,t){null!=(t=t.checked)&&Xa(e,"checked",t,!1)}function Cb(e,t){Bb(e,t);var r=rb(t.value),n=t.type;if(null!=r)"number"===n?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?Db(e,t.type,r):t.hasOwnProperty("defaultValue")&&Db(e,t.type,rb(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Eb(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function Db(e,t,r){"number"===t&&e.ownerDocument.activeElement===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}function Fb(e){var t="";return aa.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}function Gb(e,t){return e=n$1({children:void 0},t),(t=Fb(t.children))&&(e.children=t),e}function Hb(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+rb(r),t=null,i=0;i<e.length;i++){if(e[i].value===r)return e[i].selected=!0,void(n&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Ib(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(u$1(91));return n$1({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Jb(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(u$1(92));if(Array.isArray(r)){if(!(1>=r.length))throw Error(u$1(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:rb(r)}}function Kb(e,t){var r=rb(t.value),n=rb(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=n&&(e.defaultValue=""+n)}function Lb(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var Mb={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Nb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ob(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Nb(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Pb,Qb=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,r,n,i){MSApp.execUnsafeLocalFunction((function(){return e(t,r)}))}:e}((function(e,t){if(e.namespaceURI!==Mb.svg||"innerHTML"in e)e.innerHTML=t;else{for((Pb=Pb||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Pb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function Rb(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}function Sb(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Tb={animationend:Sb("Animation","AnimationEnd"),animationiteration:Sb("Animation","AnimationIteration"),animationstart:Sb("Animation","AnimationStart"),transitionend:Sb("Transition","TransitionEnd")},Ub={},Vb={};function Wb(e){if(Ub[e])return Ub[e];if(!Tb[e])return e;var t,r=Tb[e];for(t in r)if(r.hasOwnProperty(t)&&t in Vb)return Ub[e]=r[t];return e}ya&&(Vb=document.createElement("div").style,"AnimationEvent"in window||(delete Tb.animationend.animation,delete Tb.animationiteration.animation,delete Tb.animationstart.animation),"TransitionEvent"in window||delete Tb.transitionend.transition);var Xb=Wb("animationend"),Yb=Wb("animationiteration"),Zb=Wb("animationstart"),$b=Wb("transitionend"),ac="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bc=new("function"==typeof WeakMap?WeakMap:Map);function cc(e){var t=bc.get(e);return void 0===t&&(t=new Map,bc.set(e,t)),t}function dc(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).effectTag)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function ec(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function fc(e){if(dc(e)!==e)throw Error(u$1(188))}function gc(e){var t=e.alternate;if(!t){if(null===(t=dc(e)))throw Error(u$1(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(n=i.return)){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return fc(i),e;if(o===n)return fc(i),t;o=o.sibling}throw Error(u$1(188))}if(r.return!==n.return)r=i,n=o;else{for(var s=!1,a=i.child;a;){if(a===r){s=!0,r=i,n=o;break}if(a===n){s=!0,n=i,r=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===r){s=!0,r=o,n=i;break}if(a===n){s=!0,n=o,r=i;break}a=a.sibling}if(!s)throw Error(u$1(189))}}if(r.alternate!==n)throw Error(u$1(190))}if(3!==r.tag)throw Error(u$1(188));return r.stateNode.current===r?e:t}function hc(e){if(!(e=gc(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function ic(e,t){if(null==t)throw Error(u$1(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function jc(e,t,r){Array.isArray(e)?e.forEach(t,r):e&&t.call(r,e)}var kc=null;function lc(e){if(e){var t=e._dispatchListeners,r=e._dispatchInstances;if(Array.isArray(t))for(var n=0;n<t.length&&!e.isPropagationStopped();n++)oa(e,t[n],r[n]);else t&&oa(e,t,r);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function mc(e){if(null!==e&&(kc=ic(kc,e)),e=kc,kc=null,e){if(jc(e,lc),kc)throw Error(u$1(95));if(fa)throw e=ha,fa=!1,ha=null,e}}function nc(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function oc(e){if(!ya)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var pc=[];function qc(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>pc.length&&pc.push(e)}function rc(e,t,r,n){if(pc.length){var i=pc.pop();return i.topLevelType=e,i.eventSystemFlags=n,i.nativeEvent=t,i.targetInst=r,i}return{topLevelType:e,eventSystemFlags:n,nativeEvent:t,targetInst:r,ancestors:[]}}function sc(e){var t=e.targetInst,r=t;do{if(!r){e.ancestors.push(r);break}var n=r;if(3===n.tag)n=n.stateNode.containerInfo;else{for(;n.return;)n=n.return;n=3!==n.tag?null:n.stateNode.containerInfo}if(!n)break;5!==(t=r.tag)&&6!==t||e.ancestors.push(r),r=tc(n)}while(r);for(r=0;r<e.ancestors.length;r++){t=e.ancestors[r];var i=nc(e.nativeEvent);n=e.topLevelType;var o=e.nativeEvent,s=e.eventSystemFlags;0===r&&(s|=64);for(var a=null,c=0;c<sa.length;c++){var u=sa[c];u&&(u=u.extractEvents(n,t,o,i,s))&&(a=ic(a,u))}mc(a)}}function uc(e,t,r){if(!r.has(e)){switch(e){case"scroll":vc(t,"scroll",!0);break;case"focus":case"blur":vc(t,"focus",!0),vc(t,"blur",!0),r.set("blur",null),r.set("focus",null);break;case"cancel":case"close":oc(e)&&vc(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===ac.indexOf(e)&&F$1(e,t)}r.set(e,null)}}var wc,xc,yc,zc=!1,Ac=[],Bc=null,Cc=null,Dc=null,Ec=new Map,Fc=new Map,Gc=[],Hc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Ic="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Jc(e,t){var r=cc(t);Hc.forEach((function(e){uc(e,t,r)})),Ic.forEach((function(e){uc(e,t,r)}))}function Kc(e,t,r,n,i){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|r,nativeEvent:i,container:n}}function Lc(e,t){switch(e){case"focus":case"blur":Bc=null;break;case"dragenter":case"dragleave":Cc=null;break;case"mouseover":case"mouseout":Dc=null;break;case"pointerover":case"pointerout":Ec.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fc.delete(t.pointerId)}}function Mc(e,t,r,n,i,o){return null===e||e.nativeEvent!==o?(e=Kc(t,r,n,i,o),null!==t&&(null!==(t=Nc(t))&&xc(t)),e):(e.eventSystemFlags|=n,e)}function Oc(e,t,r,n,i){switch(t){case"focus":return Bc=Mc(Bc,e,t,r,n,i),!0;case"dragenter":return Cc=Mc(Cc,e,t,r,n,i),!0;case"mouseover":return Dc=Mc(Dc,e,t,r,n,i),!0;case"pointerover":var o=i.pointerId;return Ec.set(o,Mc(Ec.get(o)||null,e,t,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,Fc.set(o,Mc(Fc.get(o)||null,e,t,r,n,i)),!0}return!1}function Pc(e){var t=tc(e.target);if(null!==t){var r=dc(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=ec(r)))return e.blockedOn=t,void r$1.unstable_runWithPriority(e.priority,(function(){yc(r)}))}else if(3===t&&r.stateNode.hydrate)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function Qc(e){if(null!==e.blockedOn)return!1;var t=Rc(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var r=Nc(t);return null!==r&&xc(r),e.blockedOn=t,!1}return!0}function Sc(e,t,r){Qc(e)&&r.delete(t)}function Tc(){for(zc=!1;0<Ac.length;){var e=Ac[0];if(null!==e.blockedOn){null!==(e=Nc(e.blockedOn))&&wc(e);break}var t=Rc(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:Ac.shift()}null!==Bc&&Qc(Bc)&&(Bc=null),null!==Cc&&Qc(Cc)&&(Cc=null),null!==Dc&&Qc(Dc)&&(Dc=null),Ec.forEach(Sc),Fc.forEach(Sc)}function Uc(e,t){e.blockedOn===t&&(e.blockedOn=null,zc||(zc=!0,r$1.unstable_scheduleCallback(r$1.unstable_NormalPriority,Tc)))}function Vc(e){function t(t){return Uc(t,e)}if(0<Ac.length){Uc(Ac[0],e);for(var r=1;r<Ac.length;r++){var n=Ac[r];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Bc&&Uc(Bc,e),null!==Cc&&Uc(Cc,e),null!==Dc&&Uc(Dc,e),Ec.forEach(t),Fc.forEach(t),r=0;r<Gc.length;r++)(n=Gc[r]).blockedOn===e&&(n.blockedOn=null);for(;0<Gc.length&&null===(r=Gc[0]).blockedOn;)Pc(r),null===r.blockedOn&&Gc.shift()}var Wc={},Yc=new Map,Zc=new Map,$c=["abort","abort",Xb,"animationEnd",Yb,"animationIteration",Zb,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",$b,"transitionEnd","waiting","waiting"];function ad(e,t){for(var r=0;r<e.length;r+=2){var n=e[r],i=e[r+1],o="on"+(i[0].toUpperCase()+i.slice(1));o={phasedRegistrationNames:{bubbled:o,captured:o+"Capture"},dependencies:[n],eventPriority:t},Zc.set(n,t),Yc.set(n,o),Wc[i]=o}}ad("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),ad("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),ad($c,2);for(var bd="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),cd=0;cd<bd.length;cd++)Zc.set(bd[cd],0);var dd=r$1.unstable_UserBlockingPriority,ed=r$1.unstable_runWithPriority,fd=!0;function F$1(e,t){vc(t,e,!1)}function vc(e,t,r){var n=Zc.get(t);switch(void 0===n?2:n){case 0:n=gd.bind(null,t,1,e);break;case 1:n=hd.bind(null,t,1,e);break;default:n=id.bind(null,t,1,e)}r?e.addEventListener(t,n,!0):e.addEventListener(t,n,!1)}function gd(e,t,r,n){Ja||Ha();var i=id,o=Ja;Ja=!0;try{Ga(i,e,t,r,n)}finally{(Ja=o)||La()}}function hd(e,t,r,n){ed(dd,id.bind(null,e,t,r,n))}function id(e,t,r,n){if(fd)if(0<Ac.length&&-1<Hc.indexOf(e))e=Kc(null,e,t,r,n),Ac.push(e);else{var i=Rc(e,t,r,n);if(null===i)Lc(e,n);else if(-1<Hc.indexOf(e))e=Kc(i,e,t,r,n),Ac.push(e);else if(!Oc(i,e,t,r,n)){Lc(e,n),e=rc(e,n,null,t);try{Ma(sc,e)}finally{qc(e)}}}}function Rc(e,t,r,n){if(null!==(r=tc(r=nc(n)))){var i=dc(r);if(null===i)r=null;else{var o=i.tag;if(13===o){if(null!==(r=ec(i)))return r;r=null}else if(3===o){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;r=null}else i!==r&&(r=null)}}e=rc(e,n,r,t);try{Ma(sc,e)}finally{qc(e)}return null}var jd={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kd=["Webkit","ms","Moz","O"];function ld(e,t,r){return null==t||"boolean"==typeof t||""===t?"":r||"number"!=typeof t||0===t||jd.hasOwnProperty(e)&&jd[e]?(""+t).trim():t+"px"}function md(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var n=0===r.indexOf("--"),i=ld(r,t[r],n);"float"===r&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}Object.keys(jd).forEach((function(e){kd.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),jd[t]=jd[e]}))}));var nd=n$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function od(e,t){if(t){if(nd[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(u$1(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(u$1(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(u$1(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(u$1(62,""))}}function pd(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qd=Mb.html;function rd(e,t){var r=cc(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=wa[t];for(var n=0;n<t.length;n++)uc(t[n],e,r)}function sd(){}function td(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function ud(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function vd(e,t){var r,n=ud(e);for(e=0;n;){if(3===n.nodeType){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ud(n)}}function wd(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?wd(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function xd(){for(var e=window,t=td();t instanceof e.HTMLIFrameElement;){try{var r="string"==typeof t.contentWindow.location.href}catch(e){r=!1}if(!r)break;t=td((e=t.contentWindow).document)}return t}function yd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var zd="$",Ad="/$",Bd="$?",Cd="$!",Dd=null,Ed=null;function Fd(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Gd(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Hd="function"==typeof setTimeout?setTimeout:void 0,Id="function"==typeof clearTimeout?clearTimeout:void 0;function Jd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Kd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if(r===zd||r===Cd||r===Bd){if(0===t)return e;t--}else r===Ad&&t++}e=e.previousSibling}return null}var Ld=Math.random().toString(36).slice(2),Md="__reactInternalInstance$"+Ld,Nd="__reactEventHandlers$"+Ld,Od="__reactContainere$"+Ld;function tc(e){var t=e[Md];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Od]||r[Md]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=Kd(e);null!==e;){if(r=e[Md])return r;e=Kd(e)}return t}r=(e=r).parentNode}return null}function Nc(e){return!(e=e[Md]||e[Od])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Pd(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(u$1(33))}function Qd(e){return e[Nd]||null}function Rd(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function Sd(e,t){var r=e.stateNode;if(!r)return null;var n=la(r);if(!n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(r&&"function"!=typeof r)throw Error(u$1(231,t,typeof r));return r}function Td(e,t,r){(t=Sd(e,r.dispatchConfig.phasedRegistrationNames[t]))&&(r._dispatchListeners=ic(r._dispatchListeners,t),r._dispatchInstances=ic(r._dispatchInstances,e))}function Ud(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,r=[];t;)r.push(t),t=Rd(t);for(t=r.length;0<t--;)Td(r[t],"captured",e);for(t=0;t<r.length;t++)Td(r[t],"bubbled",e)}}function Vd(e,t,r){e&&r&&r.dispatchConfig.registrationName&&(t=Sd(e,r.dispatchConfig.registrationName))&&(r._dispatchListeners=ic(r._dispatchListeners,t),r._dispatchInstances=ic(r._dispatchInstances,e))}function Wd(e){e&&e.dispatchConfig.registrationName&&Vd(e._targetInst,null,e)}function Xd(e){jc(e,Ud)}var Yd=null,Zd=null,$d=null;function ae$1(){if($d)return $d;var e,t,r=Zd,n=r.length,i="value"in Yd?Yd.value:Yd.textContent,o=i.length;for(e=0;e<n&&r[e]===i[e];e++);var s=n-e;for(t=1;t<=s&&r[n-t]===i[o-t];t++);return $d=i.slice(e,1<t?1-t:void 0)}function be(){return!0}function ce$1(){return!1}function G$1(e,t,r,n){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=r,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(r):"target"===i?this.target=n:this[i]=r[i]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?be:ce$1,this.isPropagationStopped=ce$1,this}function ee$1(e,t,r,n){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,r,n),i}return new this(e,t,r,n)}function fe$1(e){if(!(e instanceof this))throw Error(u$1(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function de$1(e){e.eventPool=[],e.getPooled=ee$1,e.release=fe$1}n$1(G$1.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=be)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=be)},persist:function(){this.isPersistent=be},isPersistent:ce$1,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ce$1,this._dispatchInstances=this._dispatchListeners=null}}),G$1.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},G$1.extend=function(e){function t(){}function r(){return n.apply(this,arguments)}var n=this;t.prototype=n.prototype;var i=new t;return n$1(i,r.prototype),r.prototype=i,r.prototype.constructor=r,r.Interface=n$1({},n.Interface,e),r.extend=n.extend,de$1(r),r},de$1(G$1);var ge$1=G$1.extend({data:null}),he$1=G$1.extend({data:null}),ie$1=[9,13,27,32],je=ya&&"CompositionEvent"in window,ke=null;ya&&"documentMode"in document&&(ke=document.documentMode);var le$1=ya&&"TextEvent"in window&&!ke,me$1=ya&&(!je||ke&&8<ke&&11>=ke),ne$1=String.fromCharCode(32),oe$1={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},pe$1=!1;function qe(e,t){switch(e){case"keyup":return-1!==ie$1.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function re$1(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var se$1=!1;function te$1(e,t){switch(e){case"compositionend":return re$1(t);case"keypress":return 32!==t.which?null:(pe$1=!0,ne$1);case"textInput":return(e=t.data)===ne$1&&pe$1?null:e;default:return null}}function ue$1(e,t){if(se$1)return"compositionend"===e||!je&&qe(e,t)?(e=ae$1(),$d=Zd=Yd=null,se$1=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return me$1&&"ko"!==t.locale?null:t.data}}var ve$1={eventTypes:oe$1,extractEvents:function(e,t,r,n){var i;if(je)e:{switch(e){case"compositionstart":var o=oe$1.compositionStart;break e;case"compositionend":o=oe$1.compositionEnd;break e;case"compositionupdate":o=oe$1.compositionUpdate;break e}o=void 0}else se$1?qe(e,r)&&(o=oe$1.compositionEnd):"keydown"===e&&229===r.keyCode&&(o=oe$1.compositionStart);return o?(me$1&&"ko"!==r.locale&&(se$1||o!==oe$1.compositionStart?o===oe$1.compositionEnd&&se$1&&(i=ae$1()):(Zd="value"in(Yd=n)?Yd.value:Yd.textContent,se$1=!0)),o=ge$1.getPooled(o,t,r,n),i?o.data=i:null!==(i=re$1(r))&&(o.data=i),Xd(o),i=o):i=null,(e=le$1?te$1(e,r):ue$1(e,r))?((t=he$1.getPooled(oe$1.beforeInput,t,r,n)).data=e,Xd(t)):t=null,null===i?t:null===t?i:[i,t]}},we={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xe(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!we[e.type]:"textarea"===t}var ye={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function ze(e,t,r){return(e=G$1.getPooled(ye.change,e,t,r)).type="change",Da(r),Xd(e),e}var Ae=null,Be=null;function Ce(e){mc(e)}function De(e){if(yb(Pd(e)))return e}function Ee(e,t){if("change"===e)return t}var Fe=!1;function Ge(){Ae&&(Ae.detachEvent("onpropertychange",He),Be=Ae=null)}function He(e){if("value"===e.propertyName&&De(Be))if(e=ze(Be,e,nc(e)),Ja)mc(e);else{Ja=!0;try{Fa(Ce,e)}finally{Ja=!1,La()}}}function Ie(e,t,r){"focus"===e?(Ge(),Be=r,(Ae=t).attachEvent("onpropertychange",He)):"blur"===e&&Ge()}function Je(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return De(Be)}function Ke(e,t){if("click"===e)return De(t)}function Le(e,t){if("input"===e||"change"===e)return De(t)}ya&&(Fe=oc("input")&&(!document.documentMode||9<document.documentMode));var Me={eventTypes:ye,_isInputEventSupported:Fe,extractEvents:function(e,t,r,n){var i=t?Pd(t):window,o=i.nodeName&&i.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===i.type)var s=Ee;else if(xe(i))if(Fe)s=Le;else{s=Je;var a=Ie}else(o=i.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(s=Ke);if(s&&(s=s(e,t)))return ze(s,r,n);a&&a(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&Db(i,"number",i.value)}},Ne=G$1.extend({view:null,detail:null}),Oe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Oe[e])&&!!t[e]}function Qe(){return Pe}var Re=0,Se=0,Te=!1,Ue=!1,Ve=Ne.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Qe,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Re;return Re=e.screenX,Te?"mousemove"===e.type?e.screenX-t:0:(Te=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Se;return Se=e.screenY,Ue?"mousemove"===e.type?e.screenY-t:0:(Ue=!0,0)}}),We=Ve.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Xe={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Ye={eventTypes:Xe,extractEvents:function(e,t,r,n,i){var o="mouseover"===e||"pointerover"===e,s="mouseout"===e||"pointerout"===e;if(o&&0==(32&i)&&(r.relatedTarget||r.fromElement)||!s&&!o)return null;(o=n.window===n?n:(o=n.ownerDocument)?o.defaultView||o.parentWindow:window,s)?(s=t,null!==(t=(t=r.relatedTarget||r.toElement)?tc(t):null)&&(t!==dc(t)||5!==t.tag&&6!==t.tag)&&(t=null)):s=null;if(s===t)return null;if("mouseout"===e||"mouseover"===e)var a=Ve,c=Xe.mouseLeave,u=Xe.mouseEnter,l="mouse";else"pointerout"!==e&&"pointerover"!==e||(a=We,c=Xe.pointerLeave,u=Xe.pointerEnter,l="pointer");if(e=null==s?o:Pd(s),o=null==t?o:Pd(t),(c=a.getPooled(c,s,r,n)).type=l+"leave",c.target=e,c.relatedTarget=o,(r=a.getPooled(u,t,r,n)).type=l+"enter",r.target=o,r.relatedTarget=e,l=t,(n=s)&&l)e:{for(u=l,s=0,e=a=n;e;e=Rd(e))s++;for(e=0,t=u;t;t=Rd(t))e++;for(;0<s-e;)a=Rd(a),s--;for(;0<e-s;)u=Rd(u),e--;for(;s--;){if(a===u||a===u.alternate)break e;a=Rd(a),u=Rd(u)}a=null}else a=null;for(u=a,a=[];n&&n!==u&&(null===(s=n.alternate)||s!==u);)a.push(n),n=Rd(n);for(n=[];l&&l!==u&&(null===(s=l.alternate)||s!==u);)n.push(l),l=Rd(l);for(l=0;l<a.length;l++)Vd(a[l],"bubbled",c);for(l=n.length;0<l--;)Vd(n[l],"captured",r);return 0==(64&i)?[c]:[c,r]}};function Ze(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var $e="function"==typeof Object.is?Object.is:Ze,af=Object.prototype.hasOwnProperty;function bf(e,t){if($e(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++)if(!af.call(t,r[n])||!$e(e[r[n]],t[r[n]]))return!1;return!0}var cf=ya&&"documentMode"in document&&11>=document.documentMode,df={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},ef=null,ff=null,gf=null,hf=!1;function jf(e,t){var r=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return hf||null==ef||ef!==td(r)?null:("selectionStart"in(r=ef)&&yd(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},gf&&bf(gf,r)?null:(gf=r,(e=G$1.getPooled(df.select,ff,e,t)).type="select",e.target=ef,Xd(e),e))}var kf={eventTypes:df,extractEvents:function(e,t,r,n,i,o){if(!(o=!(i=o||(n.window===n?n.document:9===n.nodeType?n:n.ownerDocument)))){e:{i=cc(i),o=wa.onSelect;for(var s=0;s<o.length;s++)if(!i.has(o[s])){i=!1;break e}i=!0}o=!i}if(o)return null;switch(i=t?Pd(t):window,e){case"focus":(xe(i)||"true"===i.contentEditable)&&(ef=i,ff=t,gf=null);break;case"blur":gf=ff=ef=null;break;case"mousedown":hf=!0;break;case"contextmenu":case"mouseup":case"dragend":return hf=!1,jf(r,n);case"selectionchange":if(cf)break;case"keydown":case"keyup":return jf(r,n)}return null}},lf=G$1.extend({animationName:null,elapsedTime:null,pseudoElement:null}),mf=G$1.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),nf=Ne.extend({relatedTarget:null});function of(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var pf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rf=Ne.extend({key:function(e){if(e.key){var t=pf[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=of(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?qf[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Qe,charCode:function(e){return"keypress"===e.type?of(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?of(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),sf=Ve.extend({dataTransfer:null}),tf=Ne.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Qe}),uf=G$1.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),vf=Ve.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),wf={eventTypes:Wc,extractEvents:function(e,t,r,n){var i=Yc.get(e);if(!i)return null;switch(e){case"keypress":if(0===of(r))return null;case"keydown":case"keyup":e=rf;break;case"blur":case"focus":e=nf;break;case"click":if(2===r.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Ve;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=sf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=tf;break;case Xb:case Yb:case Zb:e=lf;break;case $b:e=uf;break;case"scroll":e=Ne;break;case"wheel":e=vf;break;case"copy":case"cut":case"paste":e=mf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=We;break;default:e=G$1}return Xd(t=e.getPooled(i,t,r,n)),t}};if(pa)throw Error(u$1(101));pa=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),ra();var xf=Nc;la=Qd,ma=xf,na=Pd,xa({SimpleEventPlugin:wf,EnterLeaveEventPlugin:Ye,ChangeEventPlugin:Me,SelectEventPlugin:kf,BeforeInputEventPlugin:ve$1});var yf=[],zf=-1;function H$1(e){0>zf||(e.current=yf[zf],yf[zf]=null,zf--)}function I$1(e,t){zf++,yf[zf]=e.current,e.current=t}var Af={},J$1={current:Af},K$1={current:!1},Bf=Af;function Cf(e,t){var r=e.type.contextTypes;if(!r)return Af;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in r)o[i]=t[i];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function L$1(e){return null!=(e=e.childContextTypes)}function Df(){H$1(K$1),H$1(J$1)}function Ef(e,t,r){if(J$1.current!==Af)throw Error(u$1(168));I$1(J$1,t),I$1(K$1,r)}function Ff(e,t,r){var n=e.stateNode;if(e=t.childContextTypes,"function"!=typeof n.getChildContext)return r;for(var i in n=n.getChildContext())if(!(i in e))throw Error(u$1(108,pb(t)||"Unknown",i));return n$1({},r,{},n)}function Gf(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Af,Bf=J$1.current,I$1(J$1,e),I$1(K$1,K$1.current),!0}function Hf(e,t,r){var n=e.stateNode;if(!n)throw Error(u$1(169));r?(e=Ff(e,t,Bf),n.__reactInternalMemoizedMergedChildContext=e,H$1(K$1),H$1(J$1),I$1(J$1,e)):H$1(K$1),I$1(K$1,r)}var If=r$1.unstable_runWithPriority,Jf=r$1.unstable_scheduleCallback,Kf=r$1.unstable_cancelCallback,Lf=r$1.unstable_requestPaint,Mf=r$1.unstable_now,Nf=r$1.unstable_getCurrentPriorityLevel,Of=r$1.unstable_ImmediatePriority,Pf=r$1.unstable_UserBlockingPriority,Qf=r$1.unstable_NormalPriority,Rf=r$1.unstable_LowPriority,Sf=r$1.unstable_IdlePriority,Tf={},Uf=r$1.unstable_shouldYield,Vf=void 0!==Lf?Lf:function(){},Wf=null,Xf=null,Yf=!1,Zf=Mf(),$f=1e4>Zf?Mf:function(){return Mf()-Zf};function ag(){switch(Nf()){case Of:return 99;case Pf:return 98;case Qf:return 97;case Rf:return 96;case Sf:return 95;default:throw Error(u$1(332))}}function bg(e){switch(e){case 99:return Of;case 98:return Pf;case 97:return Qf;case 96:return Rf;case 95:return Sf;default:throw Error(u$1(332))}}function cg(e,t){return e=bg(e),If(e,t)}function dg(e,t,r){return e=bg(e),Jf(e,t,r)}function eg(e){return null===Wf?(Wf=[e],Xf=Jf(Of,fg)):Wf.push(e),Tf}function gg(){if(null!==Xf){var e=Xf;Xf=null,Kf(e)}fg()}function fg(){if(!Yf&&null!==Wf){Yf=!0;var e=0;try{var t=Wf;cg(99,(function(){for(;e<t.length;e++){var r=t[e];do{r=r(!0)}while(null!==r)}})),Wf=null}catch(t){throw null!==Wf&&(Wf=Wf.slice(e+1)),Jf(Of,gg),t}finally{Yf=!1}}}function hg(e,t,r){return 1073741821-(1+((1073741821-e+t/10)/(r/=10)|0))*r}function ig(e,t){if(e&&e.defaultProps)for(var r in t=n$1({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}var jg={current:null},kg=null,lg=null,mg=null;function ng(){mg=lg=kg=null}function og(e){var t=jg.current;H$1(jg),e.type._context._currentValue=t}function pg(e,t){for(;null!==e;){var r=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==r&&r.childExpirationTime<t&&(r.childExpirationTime=t);else{if(!(null!==r&&r.childExpirationTime<t))break;r.childExpirationTime=t}e=e.return}}function qg(e,t){kg=e,mg=lg=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(rg=!0),e.firstContext=null)}function sg(e,t){if(mg!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(mg=e,t=1073741823),t={context:e,observedBits:t,next:null},null===lg){if(null===kg)throw Error(u$1(308));lg=t,kg.dependencies={expirationTime:0,firstContext:t,responders:null}}else lg=lg.next=t;return e._currentValue}var tg=!1;function ug(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function vg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function wg(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function xg(e,t){if(null!==(e=e.updateQueue)){var r=(e=e.shared).pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}}function yg(e,t){var r=e.alternate;null!==r&&vg(r,e),null===(r=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=r.next,r.next=t)}function zg(e,t,r,n){var i=e.updateQueue;tg=!1;var o=i.baseQueue,s=i.shared.pending;if(null!==s){if(null!==o){var a=o.next;o.next=s.next,s.next=a}o=s,i.shared.pending=null,null!==(a=e.alternate)&&(null!==(a=a.updateQueue)&&(a.baseQueue=s))}if(null!==o){a=o.next;var c=i.baseState,u=0,l=null,d=null,p=null;if(null!==a)for(var m=a;;){if((s=m.expirationTime)<n){var f={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,tag:m.tag,payload:m.payload,callback:m.callback,next:null};null===p?(d=p=f,l=c):p=p.next=f,s>u&&(u=s)}else{null!==p&&(p=p.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,tag:m.tag,payload:m.payload,callback:m.callback,next:null}),Ag(s,m.suspenseConfig);e:{var h=e,g=m;switch(s=t,f=r,g.tag){case 1:if("function"==typeof(h=g.payload)){c=h.call(f,c,s);break e}c=h;break e;case 3:h.effectTag=-4097&h.effectTag|64;case 0:if(null==(s="function"==typeof(h=g.payload)?h.call(f,c,s):h))break e;c=n$1({},c,s);break e;case 2:tg=!0}}null!==m.callback&&(e.effectTag|=32,null===(s=i.effects)?i.effects=[m]:s.push(m))}if(null===(m=m.next)||m===a){if(null===(s=i.shared.pending))break;m=o.next=s.next,s.next=a,i.baseQueue=o=s,i.shared.pending=null}}null===p?l=c:p.next=d,i.baseState=l,i.baseQueue=p,Bg(u),e.expirationTime=u,e.memoizedState=c}}function Cg(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(null!==i){if(n.callback=null,n=i,i=r,"function"!=typeof n)throw Error(u$1(191,n));n.call(i)}}}var Dg=Wa.ReactCurrentBatchConfig,Eg=(new aa.Component).refs;function Fg(e,t,r,n){r=null==(r=r(n,t=e.memoizedState))?t:n$1({},t,r),e.memoizedState=r,0===e.expirationTime&&(e.updateQueue.baseState=r)}var Jg={isMounted:function(e){return!!(e=e._reactInternalFiber)&&dc(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternalFiber;var n=Gg(),i=Dg.suspense;(i=wg(n=Hg(n,e,i),i)).payload=t,null!=r&&(i.callback=r),xg(e,i),Ig(e,n)},enqueueReplaceState:function(e,t,r){e=e._reactInternalFiber;var n=Gg(),i=Dg.suspense;(i=wg(n=Hg(n,e,i),i)).tag=1,i.payload=t,null!=r&&(i.callback=r),xg(e,i),Ig(e,n)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var r=Gg(),n=Dg.suspense;(n=wg(r=Hg(r,e,n),n)).tag=2,null!=t&&(n.callback=t),xg(e,n),Ig(e,r)}};function Kg(e,t,r,n,i,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!bf(r,n)||!bf(i,o))}function Lg(e,t,r){var n=!1,i=Af,o=t.contextType;return"object"==typeof o&&null!==o?o=sg(o):(i=L$1(t)?Bf:J$1.current,o=(n=null!=(n=t.contextTypes))?Cf(e,i):Af),t=new t(r,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Jg,e.stateNode=t,t._reactInternalFiber=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Mg(e,t,r,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Jg.enqueueReplaceState(t,t.state,null)}function Ng(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs=Eg,ug(e);var o=t.contextType;"object"==typeof o&&null!==o?i.context=sg(o):(o=L$1(t)?Bf:J$1.current,i.context=Cf(e,o)),zg(e,r,i,n),i.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(Fg(e,t,o,r),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Jg.enqueueReplaceState(i,i.state,null),zg(e,r,i,n),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.effectTag|=4)}var Og=Array.isArray;function Pg(e,t,r){if(null!==(e=r.ref)&&"function"!=typeof e&&"object"!=typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(u$1(309));var n=r.stateNode}if(!n)throw Error(u$1(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=n.refs;t===Eg&&(t=n.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(u$1(284));if(!r._owner)throw Error(u$1(290,e))}return e}function Qg(e,t){if("textarea"!==e.type)throw Error(u$1(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Rg(e){function t(t,r){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=r,t.lastEffect=r):t.firstEffect=t.lastEffect=r,r.nextEffect=null,r.effectTag=8}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Sg(e,t)).index=0,e.sibling=null,e}function o(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.effectTag=2,r):n:(t.effectTag=2,r):r}function s(t){return e&&null===t.alternate&&(t.effectTag=2),t}function a(e,t,r,n){return null===t||6!==t.tag?((t=Tg(r,e.mode,n)).return=e,t):((t=i(t,r)).return=e,t)}function c(e,t,r,n){return null!==t&&t.elementType===r.type?((n=i(t,r.props)).ref=Pg(e,t,r),n.return=e,n):((n=Ug(r.type,r.key,r.props,null,e.mode,n)).ref=Pg(e,t,r),n.return=e,n)}function u(e,t,r,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Vg(r,e.mode,n)).return=e,t):((t=i(t,r.children||[])).return=e,t)}function l(e,t,r,n,o){return null===t||7!==t.tag?((t=Wg(r,e.mode,n,o)).return=e,t):((t=i(t,r)).return=e,t)}function d(e,t,r){if("string"==typeof t||"number"==typeof t)return(t=Tg(""+t,e.mode,r)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case Za:return(r=Ug(t.type,t.key,t.props,null,e.mode,r)).ref=Pg(e,null,t),r.return=e,r;case $a:return(t=Vg(t,e.mode,r)).return=e,t}if(Og(t)||nb(t))return(t=Wg(t,e.mode,r,null)).return=e,t;Qg(e,t)}return null}function p(e,t,r,n){var i=null!==t?t.key:null;if("string"==typeof r||"number"==typeof r)return null!==i?null:a(e,t,""+r,n);if("object"==typeof r&&null!==r){switch(r.$$typeof){case Za:return r.key===i?r.type===ab?l(e,t,r.props.children,n,i):c(e,t,r,n):null;case $a:return r.key===i?u(e,t,r,n):null}if(Og(r)||nb(r))return null!==i?null:l(e,t,r,n,null);Qg(e,r)}return null}function m(e,t,r,n,i){if("string"==typeof n||"number"==typeof n)return a(t,e=e.get(r)||null,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case Za:return e=e.get(null===n.key?r:n.key)||null,n.type===ab?l(t,e,n.props.children,i,n.key):c(t,e,n,i);case $a:return u(t,e=e.get(null===n.key?r:n.key)||null,n,i)}if(Og(n)||nb(n))return l(t,e=e.get(r)||null,n,i,null);Qg(t,n)}return null}function f(i,s,a,c){for(var u=null,l=null,f=s,h=s=0,g=null;null!==f&&h<a.length;h++){f.index>h?(g=f,f=null):g=f.sibling;var v=p(i,f,a[h],c);if(null===v){null===f&&(f=g);break}e&&f&&null===v.alternate&&t(i,f),s=o(v,s,h),null===l?u=v:l.sibling=v,l=v,f=g}if(h===a.length)return r(i,f),u;if(null===f){for(;h<a.length;h++)null!==(f=d(i,a[h],c))&&(s=o(f,s,h),null===l?u=f:l.sibling=f,l=f);return u}for(f=n(i,f);h<a.length;h++)null!==(g=m(f,i,h,a[h],c))&&(e&&null!==g.alternate&&f.delete(null===g.key?h:g.key),s=o(g,s,h),null===l?u=g:l.sibling=g,l=g);return e&&f.forEach((function(e){return t(i,e)})),u}function h(i,s,a,c){var u=nb(a);if("function"!=typeof u)throw Error(u$1(150));if(null==(a=u.call(a)))throw Error(u$1(151));for(var l=u=null,f=s,h=s=0,g=null,v=a.next();null!==f&&!v.done;h++,v=a.next()){f.index>h?(g=f,f=null):g=f.sibling;var y=p(i,f,v.value,c);if(null===y){null===f&&(f=g);break}e&&f&&null===y.alternate&&t(i,f),s=o(y,s,h),null===l?u=y:l.sibling=y,l=y,f=g}if(v.done)return r(i,f),u;if(null===f){for(;!v.done;h++,v=a.next())null!==(v=d(i,v.value,c))&&(s=o(v,s,h),null===l?u=v:l.sibling=v,l=v);return u}for(f=n(i,f);!v.done;h++,v=a.next())null!==(v=m(f,i,h,v.value,c))&&(e&&null!==v.alternate&&f.delete(null===v.key?h:v.key),s=o(v,s,h),null===l?u=v:l.sibling=v,l=v);return e&&f.forEach((function(e){return t(i,e)})),u}return function(e,n,o,a){var c="object"==typeof o&&null!==o&&o.type===ab&&null===o.key;c&&(o=o.props.children);var u="object"==typeof o&&null!==o;if(u)switch(o.$$typeof){case Za:e:{for(u=o.key,c=n;null!==c;){if(c.key===u){if(7===c.tag){if(o.type===ab){r(e,c.sibling),(n=i(c,o.props.children)).return=e,e=n;break e}}else if(c.elementType===o.type){r(e,c.sibling),(n=i(c,o.props)).ref=Pg(e,c,o),n.return=e,e=n;break e}r(e,c);break}t(e,c),c=c.sibling}o.type===ab?((n=Wg(o.props.children,e.mode,a,o.key)).return=e,e=n):((a=Ug(o.type,o.key,o.props,null,e.mode,a)).ref=Pg(e,n,o),a.return=e,e=a)}return s(e);case $a:e:{for(c=o.key;null!==n;){if(n.key===c){if(4===n.tag&&n.stateNode.containerInfo===o.containerInfo&&n.stateNode.implementation===o.implementation){r(e,n.sibling),(n=i(n,o.children||[])).return=e,e=n;break e}r(e,n);break}t(e,n),n=n.sibling}(n=Vg(o,e.mode,a)).return=e,e=n}return s(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==n&&6===n.tag?(r(e,n.sibling),(n=i(n,o)).return=e,e=n):(r(e,n),(n=Tg(o,e.mode,a)).return=e,e=n),s(e);if(Og(o))return f(e,n,o,a);if(nb(o))return h(e,n,o,a);if(u&&Qg(e,o),void 0===o&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(u$1(152,e.displayName||e.name||"Component"))}return r(e,n)}}var Xg=Rg(!0),Yg=Rg(!1),Zg={},$g={current:Zg},ah={current:Zg},bh={current:Zg};function ch(e){if(e===Zg)throw Error(u$1(174));return e}function dh(e,t){switch(I$1(bh,t),I$1(ah,e),I$1($g,Zg),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ob(null,"");break;default:t=Ob(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}H$1($g),I$1($g,t)}function eh(){H$1($g),H$1(ah),H$1(bh)}function fh(e){ch(bh.current);var t=ch($g.current),r=Ob(t,e.type);t!==r&&(I$1(ah,e),I$1($g,r))}function gh(e){ah.current===e&&(H$1($g),H$1(ah))}var M$1={current:0};function hh(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||r.data===Bd||r.data===Cd))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ih(e,t){return{responder:e,props:t}}var jh=Wa.ReactCurrentDispatcher,kh=Wa.ReactCurrentBatchConfig,lh=0,N$1=null,O$1=null,P$1=null,mh=!1;function Q$1(){throw Error(u$1(321))}function nh(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!$e(e[r],t[r]))return!1;return!0}function oh(e,t,r,n,i,o){if(lh=o,N$1=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,jh.current=null===e||null===e.memoizedState?ph:qh,e=r(n,i),t.expirationTime===lh){o=0;do{if(t.expirationTime=0,!(25>o))throw Error(u$1(301));o+=1,P$1=O$1=null,t.updateQueue=null,jh.current=rh,e=r(n,i)}while(t.expirationTime===lh)}if(jh.current=sh,t=null!==O$1&&null!==O$1.next,lh=0,P$1=O$1=N$1=null,mh=!1,t)throw Error(u$1(300));return e}function th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===P$1?N$1.memoizedState=P$1=e:P$1=P$1.next=e,P$1}function uh(){if(null===O$1){var e=N$1.alternate;e=null!==e?e.memoizedState:null}else e=O$1.next;var t=null===P$1?N$1.memoizedState:P$1.next;if(null!==t)P$1=t,O$1=e;else{if(null===e)throw Error(u$1(310));e={memoizedState:(O$1=e).memoizedState,baseState:O$1.baseState,baseQueue:O$1.baseQueue,queue:O$1.queue,next:null},null===P$1?N$1.memoizedState=P$1=e:P$1=P$1.next=e}return P$1}function vh(e,t){return"function"==typeof t?t(e):t}function wh(e){var t=uh(),r=t.queue;if(null===r)throw Error(u$1(311));r.lastRenderedReducer=e;var n=O$1,i=n.baseQueue,o=r.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}n.baseQueue=i=o,r.pending=null}if(null!==i){i=i.next,n=n.baseState;var a=s=o=null,c=i;do{var u=c.expirationTime;if(u<lh){var l={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===a?(s=a=l,o=n):a=a.next=l,u>N$1.expirationTime&&(N$1.expirationTime=u,Bg(u))}else null!==a&&(a=a.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),Ag(u,c.suspenseConfig),n=c.eagerReducer===e?c.eagerState:e(n,c.action);c=c.next}while(null!==c&&c!==i);null===a?o=n:a.next=s,$e(n,t.memoizedState)||(rg=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=a,r.lastRenderedState=n}return[t.memoizedState,r.dispatch]}function xh(e){var t=uh(),r=t.queue;if(null===r)throw Error(u$1(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,o=t.memoizedState;if(null!==i){r.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);$e(o,t.memoizedState)||(rg=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function yh(e){var t=th();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:vh,lastRenderedState:e}).dispatch=zh.bind(null,N$1,e),[t.memoizedState,e]}function Ah(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},null===(t=N$1.updateQueue)?(t={lastEffect:null},N$1.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e),e}function Bh(){return uh().memoizedState}function Ch(e,t,r,n){var i=th();N$1.effectTag|=e,i.memoizedState=Ah(1|t,r,void 0,void 0===n?null:n)}function Dh(e,t,r,n){var i=uh();n=void 0===n?null:n;var o=void 0;if(null!==O$1){var s=O$1.memoizedState;if(o=s.destroy,null!==n&&nh(n,s.deps))return void Ah(t,r,o,n)}N$1.effectTag|=e,i.memoizedState=Ah(1|t,r,o,n)}function Eh(e,t){return Ch(516,4,e,t)}function Fh(e,t){return Dh(516,4,e,t)}function Gh(e,t){return Dh(4,2,e,t)}function Hh(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ih(e,t,r){return r=null!=r?r.concat([e]):null,Dh(4,2,Hh.bind(null,t,e),r)}function Jh(){}function Kh(e,t){return th().memoizedState=[e,void 0===t?null:t],e}function Lh(e,t){var r=uh();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&nh(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Mh(e,t){var r=uh();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&nh(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function Nh(e,t,r){var n=ag();cg(98>n?98:n,(function(){e(!0)})),cg(97<n?97:n,(function(){var n=kh.suspense;kh.suspense=void 0===t?null:t;try{e(!1),r()}finally{kh.suspense=n}}))}function zh(e,t,r){var n=Gg(),i=Dg.suspense;i={expirationTime:n=Hg(n,e,i),suspenseConfig:i,action:r,eagerReducer:null,eagerState:null,next:null};var o=t.pending;if(null===o?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=e.alternate,e===N$1||null!==o&&o===N$1)mh=!0,i.expirationTime=lh,N$1.expirationTime=lh;else{if(0===e.expirationTime&&(null===o||0===o.expirationTime)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,r);if(i.eagerReducer=o,i.eagerState=a,$e(a,s))return}catch(e){}Ig(e,n)}}var sh={readContext:sg,useCallback:Q$1,useContext:Q$1,useEffect:Q$1,useImperativeHandle:Q$1,useLayoutEffect:Q$1,useMemo:Q$1,useReducer:Q$1,useRef:Q$1,useState:Q$1,useDebugValue:Q$1,useResponder:Q$1,useDeferredValue:Q$1,useTransition:Q$1},ph={readContext:sg,useCallback:Kh,useContext:sg,useEffect:Eh,useImperativeHandle:function(e,t,r){return r=null!=r?r.concat([e]):null,Ch(4,2,Hh.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Ch(4,2,e,t)},useMemo:function(e,t){var r=th();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=th();return t=void 0!==r?r(t):t,n.memoizedState=n.baseState=t,e=(e=n.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=zh.bind(null,N$1,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},th().memoizedState=e},useState:yh,useDebugValue:Jh,useResponder:ih,useDeferredValue:function(e,t){var r=yh(e),n=r[0],i=r[1];return Eh((function(){var r=kh.suspense;kh.suspense=void 0===t?null:t;try{i(e)}finally{kh.suspense=r}}),[e,t]),n},useTransition:function(e){var t=yh(!1),r=t[0];return t=t[1],[Kh(Nh.bind(null,t,e),[t,e]),r]}},qh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:wh,useRef:Bh,useState:function(){return wh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(e,t){var r=wh(vh),n=r[0],i=r[1];return Fh((function(){var r=kh.suspense;kh.suspense=void 0===t?null:t;try{i(e)}finally{kh.suspense=r}}),[e,t]),n},useTransition:function(e){var t=wh(vh),r=t[0];return t=t[1],[Lh(Nh.bind(null,t,e),[t,e]),r]}},rh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:xh,useRef:Bh,useState:function(){return xh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(e,t){var r=xh(vh),n=r[0],i=r[1];return Fh((function(){var r=kh.suspense;kh.suspense=void 0===t?null:t;try{i(e)}finally{kh.suspense=r}}),[e,t]),n},useTransition:function(e){var t=xh(vh),r=t[0];return t=t[1],[Lh(Nh.bind(null,t,e),[t,e]),r]}},Oh=null,Ph=null,Qh=!1;function Rh(e,t){var r=Sh(5,null,null,0);r.elementType="DELETED",r.type="DELETED",r.stateNode=t,r.return=e,r.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=r,e.lastEffect=r):e.firstEffect=e.lastEffect=r}function Th(e,t){switch(e.tag){case 5:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Uh(e){if(Qh){var t=Ph;if(t){var r=t;if(!Th(e,t)){if(!(t=Jd(r.nextSibling))||!Th(e,t))return e.effectTag=-1025&e.effectTag|2,Qh=!1,void(Oh=e);Rh(Oh,r)}Oh=e,Ph=Jd(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Qh=!1,Oh=e}}function Vh(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Oh=e}function Wh(e){if(e!==Oh)return!1;if(!Qh)return Vh(e),Qh=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Gd(t,e.memoizedProps))for(t=Ph;t;)Rh(e,t),t=Jd(t.nextSibling);if(Vh(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(u$1(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if(r===Ad){if(0===t){Ph=Jd(e.nextSibling);break e}t--}else r!==zd&&r!==Cd&&r!==Bd||t++}e=e.nextSibling}Ph=null}}else Ph=Oh?Jd(e.stateNode.nextSibling):null;return!0}function Xh(){Ph=Oh=null,Qh=!1}var Yh=Wa.ReactCurrentOwner,rg=!1;function R$1(e,t,r,n){t.child=null===e?Yg(t,null,r,n):Xg(t,e.child,r,n)}function Zh(e,t,r,n,i){r=r.render;var o=t.ref;return qg(t,i),n=oh(e,t,r,n,o,i),null===e||rg?(t.effectTag|=1,R$1(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),$h(e,t,i))}function ai(e,t,r,n,i,o){if(null===e){var s=r.type;return"function"!=typeof s||bi(s)||void 0!==s.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=Ug(r.type,null,n,null,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,ci(e,t,s,n,i,o))}return s=e.child,i<o&&(i=s.memoizedProps,(r=null!==(r=r.compare)?r:bf)(i,n)&&e.ref===t.ref)?$h(e,t,o):(t.effectTag|=1,(e=Sg(s,n)).ref=t.ref,e.return=t,t.child=e)}function ci(e,t,r,n,i,o){return null!==e&&bf(e.memoizedProps,n)&&e.ref===t.ref&&(rg=!1,i<o)?(t.expirationTime=e.expirationTime,$h(e,t,o)):di(e,t,r,n,o)}function ei(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.effectTag|=128)}function di(e,t,r,n,i){var o=L$1(r)?Bf:J$1.current;return o=Cf(t,o),qg(t,i),r=oh(e,t,r,n,o,i),null===e||rg?(t.effectTag|=1,R$1(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),$h(e,t,i))}function fi(e,t,r,n,i){if(L$1(r)){var o=!0;Gf(t)}else o=!1;if(qg(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),Lg(t,r,n),Ng(t,r,n,i),n=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var c=s.context,u=r.contextType;"object"==typeof u&&null!==u?u=sg(u):u=Cf(t,u=L$1(r)?Bf:J$1.current);var l=r.getDerivedStateFromProps,d="function"==typeof l||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==n||c!==u)&&Mg(t,s,n,u),tg=!1;var p=t.memoizedState;s.state=p,zg(t,n,s,i),c=t.memoizedState,a!==n||p!==c||K$1.current||tg?("function"==typeof l&&(Fg(t,r,l,n),c=t.memoizedState),(a=tg||Kg(t,r,a,n,p,c,u))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.effectTag|=4)):("function"==typeof s.componentDidMount&&(t.effectTag|=4),t.memoizedProps=n,t.memoizedState=c),s.props=n,s.state=c,s.context=u,n=a):("function"==typeof s.componentDidMount&&(t.effectTag|=4),n=!1)}else s=t.stateNode,vg(e,t),a=t.memoizedProps,s.props=t.type===t.elementType?a:ig(t.type,a),c=s.context,"object"==typeof(u=r.contextType)&&null!==u?u=sg(u):u=Cf(t,u=L$1(r)?Bf:J$1.current),(d="function"==typeof(l=r.getDerivedStateFromProps)||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==n||c!==u)&&Mg(t,s,n,u),tg=!1,c=t.memoizedState,s.state=c,zg(t,n,s,i),p=t.memoizedState,a!==n||c!==p||K$1.current||tg?("function"==typeof l&&(Fg(t,r,l,n),p=t.memoizedState),(l=tg||Kg(t,r,a,n,c,p,u))?(d||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(n,p,u),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(n,p,u)),"function"==typeof s.componentDidUpdate&&(t.effectTag|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=256),t.memoizedProps=n,t.memoizedState=p),s.props=n,s.state=p,s.context=u,n=l):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=256),n=!1);return gi(e,t,r,n,o,i)}function gi(e,t,r,n,i,o){ei(e,t);var s=0!=(64&t.effectTag);if(!n&&!s)return i&&Hf(t,r,!1),$h(e,t,o);n=t.stateNode,Yh.current=t;var a=s&&"function"!=typeof r.getDerivedStateFromError?null:n.render();return t.effectTag|=1,null!==e&&s?(t.child=Xg(t,e.child,null,o),t.child=Xg(t,null,a,o)):R$1(e,t,a,o),t.memoizedState=n.state,i&&Hf(t,r,!0),t.child}function hi(e){var t=e.stateNode;t.pendingContext?Ef(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Ef(e,t.context,!1),dh(e,t.containerInfo)}var ii={dehydrated:null,retryTime:0},ni,oi,pi,qi;function ji(e,t,r){var n,i=t.mode,o=t.pendingProps,s=M$1.current,a=!1;if((n=0!=(64&t.effectTag))||(n=0!=(2&s)&&(null===e||null!==e.memoizedState)),n?(a=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(s|=1),I$1(M$1,1&s),null===e){if(void 0!==o.fallback&&Uh(t),a){if(a=o.fallback,(o=Wg(null,i,0,null)).return=t,0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(r=Wg(a,i,r,null)).return=t,o.sibling=r,t.memoizedState=ii,t.child=o,r}return i=o.children,t.memoizedState=null,t.child=Yg(t,null,i,r)}if(null!==e.memoizedState){if(i=(e=e.child).sibling,a){if(o=o.fallback,(r=Sg(e,e.pendingProps)).return=t,0==(2&t.mode)&&(a=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(r.child=a;null!==a;)a.return=r,a=a.sibling;return(i=Sg(i,o)).return=t,r.sibling=i,r.childExpirationTime=0,t.memoizedState=ii,t.child=r,i}return r=Xg(t,e.child,o.children,r),t.memoizedState=null,t.child=r}if(e=e.child,a){if(a=o.fallback,(o=Wg(null,i,0,null)).return=t,o.child=e,null!==e&&(e.return=o),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(r=Wg(a,i,r,null)).return=t,o.sibling=r,r.effectTag|=2,o.childExpirationTime=0,t.memoizedState=ii,t.child=o,r}return t.memoizedState=null,t.child=Xg(t,e,o.children,r)}function ki(e,t){e.expirationTime<t&&(e.expirationTime=t);var r=e.alternate;null!==r&&r.expirationTime<t&&(r.expirationTime=t),pg(e.return,t)}function li(e,t,r,n,i,o){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailExpiration:0,tailMode:i,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailExpiration=0,s.tailMode=i,s.lastEffect=o)}function mi(e,t,r){var n=t.pendingProps,i=n.revealOrder,o=n.tail;if(R$1(e,t,n.children,r),0!=(2&(n=M$1.current)))n=1&n|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ki(e,r);else if(19===e.tag)ki(e,r);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(I$1(M$1,n),0==(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;null!==r;)null!==(e=r.alternate)&&null===hh(e)&&(i=r),r=r.sibling;null===(r=i)?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),li(t,!1,i,r,o,t.lastEffect);break;case"backwards":for(r=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===hh(e)){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}li(t,!0,r,null,o,t.lastEffect);break;case"together":li(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function $h(e,t,r){null!==e&&(t.dependencies=e.dependencies);var n=t.expirationTime;if(0!==n&&Bg(n),t.childExpirationTime<r)return null;if(null!==e&&t.child!==e.child)throw Error(u$1(153));if(null!==t.child){for(r=Sg(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Sg(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function ri(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function si(e,t,r){var n=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return L$1(t.type)&&Df(),null;case 3:return eh(),H$1(K$1),H$1(J$1),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||!Wh(t)||(t.effectTag|=4),oi(t),null;case 5:gh(t),r=ch(bh.current);var i=t.type;if(null!==e&&null!=t.stateNode)pi(e,t,i,n,r),e.ref!==t.ref&&(t.effectTag|=128);else{if(!n){if(null===t.stateNode)throw Error(u$1(166));return null}if(e=ch($g.current),Wh(t)){n=t.stateNode,i=t.type;var o=t.memoizedProps;switch(n[Md]=t,n[Nd]=o,i){case"iframe":case"object":case"embed":F$1("load",n);break;case"video":case"audio":for(e=0;e<ac.length;e++)F$1(ac[e],n);break;case"source":F$1("error",n);break;case"img":case"image":case"link":F$1("error",n),F$1("load",n);break;case"form":F$1("reset",n),F$1("submit",n);break;case"details":F$1("toggle",n);break;case"input":Ab(n,o),F$1("invalid",n),rd(r,"onChange");break;case"select":n._wrapperState={wasMultiple:!!o.multiple},F$1("invalid",n),rd(r,"onChange");break;case"textarea":Jb(n,o),F$1("invalid",n),rd(r,"onChange")}for(var s in od(i,o),e=null,o)if(o.hasOwnProperty(s)){var a=o[s];"children"===s?"string"==typeof a?n.textContent!==a&&(e=["children",a]):"number"==typeof a&&n.textContent!==""+a&&(e=["children",""+a]):va.hasOwnProperty(s)&&null!=a&&rd(r,s)}switch(i){case"input":xb(n),Eb(n,o,!0);break;case"textarea":xb(n),Lb(n);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(n.onclick=sd)}r=e,t.updateQueue=r,null!==r&&(t.effectTag|=4)}else{switch(s=9===r.nodeType?r:r.ownerDocument,e===qd&&(e=Nb(i)),e===qd?"script"===i?((e=s.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof n.is?e=s.createElement(i,{is:n.is}):(e=s.createElement(i),"select"===i&&(s=e,n.multiple?s.multiple=!0:n.size&&(s.size=n.size))):e=s.createElementNS(e,i),e[Md]=t,e[Nd]=n,ni(e,t,!1,!1),t.stateNode=e,s=pd(i,n),i){case"iframe":case"object":case"embed":F$1("load",e),a=n;break;case"video":case"audio":for(a=0;a<ac.length;a++)F$1(ac[a],e);a=n;break;case"source":F$1("error",e),a=n;break;case"img":case"image":case"link":F$1("error",e),F$1("load",e),a=n;break;case"form":F$1("reset",e),F$1("submit",e),a=n;break;case"details":F$1("toggle",e),a=n;break;case"input":Ab(e,n),a=zb(e,n),F$1("invalid",e),rd(r,"onChange");break;case"option":a=Gb(e,n);break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=n$1({},n,{value:void 0}),F$1("invalid",e),rd(r,"onChange");break;case"textarea":Jb(e,n),a=Ib(e,n),F$1("invalid",e),rd(r,"onChange");break;default:a=n}od(i,a);var c=a;for(o in c)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?md(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&Qb(e,u):"children"===o?"string"==typeof u?("textarea"!==i||""!==u)&&Rb(e,u):"number"==typeof u&&Rb(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(va.hasOwnProperty(o)?null!=u&&rd(r,o):null!=u&&Xa(e,o,u,s))}switch(i){case"input":xb(e),Eb(e,n,!1);break;case"textarea":xb(e),Lb(e);break;case"option":null!=n.value&&e.setAttribute("value",""+rb(n.value));break;case"select":e.multiple=!!n.multiple,null!=(r=n.value)?Hb(e,!!n.multiple,r,!1):null!=n.defaultValue&&Hb(e,!!n.multiple,n.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=sd)}Fd(i,n)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)qi(e,t,e.memoizedProps,n);else{if("string"!=typeof n&&null===t.stateNode)throw Error(u$1(166));r=ch(bh.current),ch($g.current),Wh(t)?(r=t.stateNode,n=t.memoizedProps,r[Md]=t,r.nodeValue!==n&&(t.effectTag|=4)):((r=(9===r.nodeType?r:r.ownerDocument).createTextNode(n))[Md]=t,t.stateNode=r)}return null;case 13:return H$1(M$1),n=t.memoizedState,0!=(64&t.effectTag)?(t.expirationTime=r,t):(r=null!==n,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Wh(t):(n=null!==(i=e.memoizedState),r||null===i||null!==(i=e.child.sibling)&&(null!==(o=t.firstEffect)?(t.firstEffect=i,i.nextEffect=o):(t.firstEffect=t.lastEffect=i,i.nextEffect=null),i.effectTag=8)),r&&!n&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&M$1.current)?S$1===ti&&(S$1=ui):(S$1!==ti&&S$1!==ui||(S$1=vi),0!==wi&&null!==T$1&&(xi(T$1,U$1),yi(T$1,wi)))),(r||n)&&(t.effectTag|=4),null);case 4:return eh(),oi(t),null;case 10:return og(t),null;case 19:if(H$1(M$1),null===(n=t.memoizedState))return null;if(i=0!=(64&t.effectTag),null===(o=n.rendering)){if(i)ri(n,!1);else if(S$1!==ti||null!==e&&0!=(64&e.effectTag))for(o=t.child;null!==o;){if(null!==(e=hh(o))){for(t.effectTag|=64,ri(n,!1),null!==(i=e.updateQueue)&&(t.updateQueue=i,t.effectTag|=4),null===n.lastEffect&&(t.firstEffect=null),t.lastEffect=n.lastEffect,n=t.child;null!==n;)o=r,(i=n).effectTag&=2,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null,null===(e=i.alternate)?(i.childExpirationTime=0,i.expirationTime=o,i.child=null,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null):(i.childExpirationTime=e.childExpirationTime,i.expirationTime=e.expirationTime,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,o=e.dependencies,i.dependencies=null===o?null:{expirationTime:o.expirationTime,firstContext:o.firstContext,responders:o.responders}),n=n.sibling;return I$1(M$1,1&M$1.current|2),t.child}o=o.sibling}}else{if(!i)if(null!==(e=hh(o))){if(t.effectTag|=64,i=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.effectTag|=4),ri(n,!0),null===n.tail&&"hidden"===n.tailMode&&!o.alternate)return null!==(t=t.lastEffect=n.lastEffect)&&(t.nextEffect=null),null}else 2*$f()-n.renderingStartTime>n.tailExpiration&&1<r&&(t.effectTag|=64,i=!0,ri(n,!1),t.expirationTime=t.childExpirationTime=r-1);n.isBackwards?(o.sibling=t.child,t.child=o):(null!==(r=n.last)?r.sibling=o:t.child=o,n.last=o)}return null!==n.tail?(0===n.tailExpiration&&(n.tailExpiration=$f()+500),r=n.tail,n.rendering=r,n.tail=r.sibling,n.lastEffect=t.lastEffect,n.renderingStartTime=$f(),r.sibling=null,t=M$1.current,I$1(M$1,i?1&t|2:1&t),r):null}throw Error(u$1(156,t.tag))}function zi(e){switch(e.tag){case 1:L$1(e.type)&&Df();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(eh(),H$1(K$1),H$1(J$1),0!=(64&(t=e.effectTag)))throw Error(u$1(285));return e.effectTag=-4097&t|64,e;case 5:return gh(e),null;case 13:return H$1(M$1),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return H$1(M$1),null;case 4:return eh(),null;case 10:return og(e),null;default:return null}}function Ai(e,t){return{value:e,source:t,stack:qb(t)}}ni=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},oi=function(){},pi=function(e,t,r,n,i){var o=e.memoizedProps;if(o!==n){var s,a,c=t.stateNode;switch(ch($g.current),e=null,r){case"input":o=zb(c,o),n=zb(c,n),e=[];break;case"option":o=Gb(c,o),n=Gb(c,n),e=[];break;case"select":o=n$1({},o,{value:void 0}),n=n$1({},n,{value:void 0}),e=[];break;case"textarea":o=Ib(c,o),n=Ib(c,n),e=[];break;default:"function"!=typeof o.onClick&&"function"==typeof n.onClick&&(c.onclick=sd)}for(s in od(r,n),r=null,o)if(!n.hasOwnProperty(s)&&o.hasOwnProperty(s)&&null!=o[s])if("style"===s)for(a in c=o[s])c.hasOwnProperty(a)&&(r||(r={}),r[a]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(va.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in n){var u=n[s];if(c=null!=o?o[s]:void 0,n.hasOwnProperty(s)&&u!==c&&(null!=u||null!=c))if("style"===s)if(c){for(a in c)!c.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in u)u.hasOwnProperty(a)&&c[a]!==u[a]&&(r||(r={}),r[a]=u[a])}else r||(e||(e=[]),e.push(s,r)),r=u;else"dangerouslySetInnerHTML"===s?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(e=e||[]).push(s,u)):"children"===s?c===u||"string"!=typeof u&&"number"!=typeof u||(e=e||[]).push(s,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(va.hasOwnProperty(s)?(null!=u&&rd(i,s),e||c===u||(e=[])):(e=e||[]).push(s,u))}r&&(e=e||[]).push("style",r),i=e,(t.updateQueue=i)&&(t.effectTag|=4)}},qi=function(e,t,r,n){r!==n&&(t.effectTag|=4)};var Bi="function"==typeof WeakSet?WeakSet:Set;function Ci(e,t){var r=t.source,n=t.stack;null===n&&null!==r&&(n=qb(r)),null!==r&&pb(r.type),t=t.value,null!==e&&1===e.tag&&pb(e.type);try{console.error(t)}catch(e){setTimeout((function(){throw e}))}}function Di(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Ei(e,t)}}function Fi(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Ei(e,t)}else t.current=null}function Gi(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 3:case 5:case 6:case 4:case 17:return;case 1:if(256&t.effectTag&&null!==e){var r=e.memoizedProps,n=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?r:ig(t.type,r),n),e.__reactInternalSnapshotBeforeUpdate=t}return}throw Error(u$1(163))}function Hi(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var n=r.destroy;r.destroy=void 0,void 0!==n&&n()}r=r.next}while(r!==t)}}function Ii(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function Ji(e,t,r){switch(r.tag){case 0:case 11:case 15:case 22:return void Ii(3,r);case 1:if(e=r.stateNode,4&r.effectTag)if(null===t)e.componentDidMount();else{var n=r.elementType===r.type?t.memoizedProps:ig(r.type,t.memoizedProps);e.componentDidUpdate(n,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=r.updateQueue)&&Cg(r,t,e));case 3:if(null!==(t=r.updateQueue)){if(e=null,null!==r.child)switch(r.child.tag){case 5:case 1:e=r.child.stateNode}Cg(r,t,e)}return;case 5:return e=r.stateNode,void(null===t&&4&r.effectTag&&Fd(r.type,r.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:return;case 13:return void(null===r.memoizedState&&(r=r.alternate,null!==r&&(r=r.memoizedState,null!==r&&(r=r.dehydrated,null!==r&&Vc(r)))))}throw Error(u$1(163))}function Ki(e,t,r){switch("function"==typeof Li&&Li(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e.next;cg(97<r?97:r,(function(){var e=n;do{var r=e.destroy;if(void 0!==r){var i=t;try{r()}catch(e){Ei(i,e)}}e=e.next}while(e!==n)}))}break;case 1:Fi(t),"function"==typeof(r=t.stateNode).componentWillUnmount&&Di(t,r);break;case 5:Fi(t);break;case 4:Mi(e,t,r)}}function Ni(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&Ni(t)}function Oi(e){return 5===e.tag||3===e.tag||4===e.tag}function Pi(e){e:{for(var t=e.return;null!==t;){if(Oi(t)){var r=t;break e}t=t.return}throw Error(u$1(160))}switch(t=r.stateNode,r.tag){case 5:var n=!1;break;case 3:case 4:t=t.containerInfo,n=!0;break;default:throw Error(u$1(161))}16&r.effectTag&&(Rb(t,""),r.effectTag&=-17);e:t:for(r=e;;){for(;null===r.sibling;){if(null===r.return||Oi(r.return)){r=null;break e}r=r.return}for(r.sibling.return=r.return,r=r.sibling;5!==r.tag&&6!==r.tag&&18!==r.tag;){if(2&r.effectTag)continue t;if(null===r.child||4===r.tag)continue t;r.child.return=r,r=r.child}if(!(2&r.effectTag)){r=r.stateNode;break e}}n?Qi(e,r,t):Ri(e,r,t)}function Qi(e,t,r){var n=e.tag,i=5===n||6===n;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!=(r=r._reactRootContainer)||null!==t.onclick||(t.onclick=sd));else if(4!==n&&null!==(e=e.child))for(Qi(e,t,r),e=e.sibling;null!==e;)Qi(e,t,r),e=e.sibling}function Ri(e,t,r){var n=e.tag,i=5===n||6===n;if(i)e=i?e.stateNode:e.stateNode.instance,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==n&&null!==(e=e.child))for(Ri(e,t,r),e=e.sibling;null!==e;)Ri(e,t,r),e=e.sibling}function Mi(e,t,r){for(var n,i,o=t,s=!1;;){if(!s){s=o.return;e:for(;;){if(null===s)throw Error(u$1(160));switch(n=s.stateNode,s.tag){case 5:i=!1;break e;case 3:case 4:n=n.containerInfo,i=!0;break e}s=s.return}s=!0}if(5===o.tag||6===o.tag){e:for(var a=e,c=o,u=r,l=c;;)if(Ki(a,l,u),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===c)break e;for(;null===l.sibling;){if(null===l.return||l.return===c)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}i?(a=n,c=o.stateNode,8===a.nodeType?a.parentNode.removeChild(c):a.removeChild(c)):n.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){n=o.stateNode.containerInfo,i=!0,o.child.return=o,o=o.child;continue}}else if(Ki(e,o,r),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(s=!1)}o.sibling.return=o.return,o=o.sibling}}function Si(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void Hi(3,t);case 1:case 12:case 17:return;case 5:var r=t.stateNode;if(null!=r){var n=t.memoizedProps,i=null!==e?e.memoizedProps:n;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(r[Nd]=n,"input"===e&&"radio"===n.type&&null!=n.name&&Bb(r,n),pd(e,i),t=pd(e,n),i=0;i<o.length;i+=2){var s=o[i],a=o[i+1];"style"===s?md(r,a):"dangerouslySetInnerHTML"===s?Qb(r,a):"children"===s?Rb(r,a):Xa(r,s,a,t)}switch(e){case"input":Cb(r,n);break;case"textarea":Kb(r,n);break;case"select":t=r._wrapperState.wasMultiple,r._wrapperState.wasMultiple=!!n.multiple,null!=(e=n.value)?Hb(r,!!n.multiple,e,!1):t!==!!n.multiple&&(null!=n.defaultValue?Hb(r,!!n.multiple,n.defaultValue,!0):Hb(r,!!n.multiple,n.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(u$1(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Vc(t.containerInfo)));case 13:if(r=t,null===t.memoizedState?n=!1:(n=!0,r=t.child,Ti=$f()),null!==r)e:for(e=r;;){if(5===e.tag)o=e.stateNode,n?"function"==typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,i=null!=(i=e.memoizedProps.style)&&i.hasOwnProperty("display")?i.display:null,o.style.display=ld("display",i));else if(6===e.tag)e.stateNode.nodeValue=n?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===r)break;for(;null===e.sibling;){if(null===e.return||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void Ui(t);case 19:return void Ui(t)}throw Error(u$1(163))}function Ui(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new Bi),t.forEach((function(t){var n=Vi.bind(null,e,t);r.has(t)||(r.add(t),t.then(n,n))}))}}var Wi="function"==typeof WeakMap?WeakMap:Map;function Xi(e,t,r){(r=wg(r,null)).tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Yi||(Yi=!0,Zi=n),Ci(e,t)},r}function $i(e,t,r){(r=wg(r,null)).tag=3;var n=e.type.getDerivedStateFromError;if("function"==typeof n){var i=t.value;r.payload=function(){return Ci(e,t),n(i)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(r.callback=function(){"function"!=typeof n&&(null===aj?aj=new Set([this]):aj.add(this),Ci(e,t));var r=t.stack;this.componentDidCatch(t.value,{componentStack:null!==r?r:""})}),r}var bj=Math.ceil,cj=Wa.ReactCurrentDispatcher,dj=Wa.ReactCurrentOwner,V$2=0,ej=8,fj=16,gj=32,ti=0,hj=1,ij=2,ui=3,vi=4,jj=5,W$1=V$2,T$1=null,X$1=null,U$1=0,S$1=ti,kj=null,lj=1073741823,mj=1073741823,nj=null,wi=0,oj=!1,Ti=0,pj=500,Y$1=null,Yi=!1,Zi=null,aj=null,qj=!1,rj=null,sj=90,tj=null,uj=0,vj=null,wj=0,Rj;function Gg(){return(W$1&(fj|gj))!==V$2?1073741821-($f()/10|0):0!==wj?wj:wj=1073741821-($f()/10|0)}function Hg(e,t,r){if(0==(2&(t=t.mode)))return 1073741823;var n=ag();if(0==(4&t))return 99===n?1073741823:1073741822;if((W$1&fj)!==V$2)return U$1;if(null!==r)e=hg(e,0|r.timeoutMs||5e3,250);else switch(n){case 99:e=1073741823;break;case 98:e=hg(e,150,100);break;case 97:case 96:e=hg(e,5e3,250);break;case 95:e=2;break;default:throw Error(u$1(326))}return null!==T$1&&e===U$1&&--e,e}function Ig(e,t){if(50<uj)throw uj=0,vj=null,Error(u$1(185));if(null!==(e=xj(e,t))){var r=ag();1073741823===t?(W$1&ej)!==V$2&&(W$1&(fj|gj))===V$2?yj(e):(Z$1(e),W$1===V$2&&gg()):Z$1(e),(4&W$1)===V$2||98!==r&&99!==r||(null===tj?tj=new Map([[e,t]]):(void 0===(r=tj.get(e))||r>t)&&tj.set(e,t))}}function xj(e,t){e.expirationTime<t&&(e.expirationTime=t);var r=e.alternate;null!==r&&r.expirationTime<t&&(r.expirationTime=t);var n=e.return,i=null;if(null===n&&3===e.tag)i=e.stateNode;else for(;null!==n;){if(r=n.alternate,n.childExpirationTime<t&&(n.childExpirationTime=t),null!==r&&r.childExpirationTime<t&&(r.childExpirationTime=t),null===n.return&&3===n.tag){i=n.stateNode;break}n=n.return}return null!==i&&(T$1===i&&(Bg(t),S$1===vi&&xi(i,U$1)),yi(i,t)),i}function zj(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!Aj(e,t=e.firstPendingTime))return t;var r=e.lastPingedTime;return 2>=(e=r>(e=e.nextKnownPendingLevel)?r:e)&&t!==e?0:e}function Z$1(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=eg(yj.bind(null,e));else{var t=zj(e),r=e.callbackNode;if(0===t)null!==r&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var n=Gg();if(1073741823===t?n=99:1===t||2===t?n=95:n=0>=(n=10*(1073741821-t)-10*(1073741821-n))?99:250>=n?98:5250>=n?97:95,null!==r){var i=e.callbackPriority;if(e.callbackExpirationTime===t&&i>=n)return;r!==Tf&&Kf(r)}e.callbackExpirationTime=t,e.callbackPriority=n,t=1073741823===t?eg(yj.bind(null,e)):dg(n,Bj.bind(null,e),{timeout:10*(1073741821-t)-$f()}),e.callbackNode=t}}}function Bj(e,t){if(wj=0,t)return Cj(e,t=Gg()),Z$1(e),null;var r=zj(e);if(0!==r){if(t=e.callbackNode,(W$1&(fj|gj))!==V$2)throw Error(u$1(327));if(Dj(),e===T$1&&r===U$1||Ej(e,r),null!==X$1){var n=W$1;W$1|=fj;for(var i=Fj();;)try{Gj();break}catch(t){Hj(e,t)}if(ng(),W$1=n,cj.current=i,S$1===hj)throw t=kj,Ej(e,r),xi(e,r),Z$1(e),t;if(null===X$1)switch(i=e.finishedWork=e.current.alternate,e.finishedExpirationTime=r,n=S$1,T$1=null,n){case ti:case hj:throw Error(u$1(345));case ij:Cj(e,2<r?2:r);break;case ui:if(xi(e,r),r===(n=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=Ij(i)),1073741823===lj&&10<(i=Ti+pj-$f())){if(oj){var o=e.lastPingedTime;if(0===o||o>=r){e.lastPingedTime=r,Ej(e,r);break}}if(0!==(o=zj(e))&&o!==r)break;if(0!==n&&n!==r){e.lastPingedTime=n;break}e.timeoutHandle=Hd(Jj.bind(null,e),i);break}Jj(e);break;case vi:if(xi(e,r),r===(n=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=Ij(i)),oj&&(0===(i=e.lastPingedTime)||i>=r)){e.lastPingedTime=r,Ej(e,r);break}if(0!==(i=zj(e))&&i!==r)break;if(0!==n&&n!==r){e.lastPingedTime=n;break}if(1073741823!==mj?n=10*(1073741821-mj)-$f():1073741823===lj?n=0:(n=10*(1073741821-lj)-5e3,0>(n=(i=$f())-n)&&(n=0),(r=10*(1073741821-r)-i)<(n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*bj(n/1960))-n)&&(n=r)),10<n){e.timeoutHandle=Hd(Jj.bind(null,e),n);break}Jj(e);break;case jj:if(1073741823!==lj&&null!==nj){o=lj;var s=nj;if(0>=(n=0|s.busyMinDurationMs)?n=0:(i=0|s.busyDelayMs,n=(o=$f()-(10*(1073741821-o)-(0|s.timeoutMs||5e3)))<=i?0:i+n-o),10<n){xi(e,r),e.timeoutHandle=Hd(Jj.bind(null,e),n);break}}Jj(e);break;default:throw Error(u$1(329))}if(Z$1(e),e.callbackNode===t)return Bj.bind(null,e)}}return null}function yj(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,(W$1&(fj|gj))!==V$2)throw Error(u$1(327));if(Dj(),e===T$1&&t===U$1||Ej(e,t),null!==X$1){var r=W$1;W$1|=fj;for(var n=Fj();;)try{Kj();break}catch(t){Hj(e,t)}if(ng(),W$1=r,cj.current=n,S$1===hj)throw r=kj,Ej(e,t),xi(e,t),Z$1(e),r;if(null!==X$1)throw Error(u$1(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,T$1=null,Jj(e),Z$1(e)}return null}function Lj(){if(null!==tj){var e=tj;tj=null,e.forEach((function(e,t){Cj(t,e),Z$1(t)})),gg()}}function Mj(e,t){var r=W$1;W$1|=1;try{return e(t)}finally{(W$1=r)===V$2&&gg()}}function Nj(e,t){var r=W$1;W$1&=-2,W$1|=ej;try{return e(t)}finally{(W$1=r)===V$2&&gg()}}function Ej(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var r=e.timeoutHandle;if(-1!==r&&(e.timeoutHandle=-1,Id(r)),null!==X$1)for(r=X$1.return;null!==r;){var n=r;switch(n.tag){case 1:null!=(n=n.type.childContextTypes)&&Df();break;case 3:eh(),H$1(K$1),H$1(J$1);break;case 5:gh(n);break;case 4:eh();break;case 13:case 19:H$1(M$1);break;case 10:og(n)}r=r.return}T$1=e,X$1=Sg(e.current,null),U$1=t,S$1=ti,kj=null,mj=lj=1073741823,nj=null,wi=0,oj=!1}function Hj(e,t){for(;;){try{if(ng(),jh.current=sh,mh)for(var r=N$1.memoizedState;null!==r;){var n=r.queue;null!==n&&(n.pending=null),r=r.next}if(lh=0,P$1=O$1=N$1=null,mh=!1,null===X$1||null===X$1.return)return S$1=hj,kj=t,X$1=null;e:{var i=e,o=X$1.return,s=X$1,a=t;if(t=U$1,s.effectTag|=2048,s.firstEffect=s.lastEffect=null,null!==a&&"object"==typeof a&&"function"==typeof a.then){var c=a;if(0==(2&s.mode)){var u=s.alternate;u?(s.updateQueue=u.updateQueue,s.memoizedState=u.memoizedState,s.expirationTime=u.expirationTime):(s.updateQueue=null,s.memoizedState=null)}var l=0!=(1&M$1.current),d=o;do{var p;if(p=13===d.tag){var m=d.memoizedState;if(null!==m)p=null!==m.dehydrated;else{var f=d.memoizedProps;p=void 0!==f.fallback&&(!0!==f.unstable_avoidThisFallback||!l)}}if(p){var h=d.updateQueue;if(null===h){var g=new Set;g.add(c),d.updateQueue=g}else h.add(c);if(0==(2&d.mode)){if(d.effectTag|=64,s.effectTag&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var v=wg(1073741823,null);v.tag=2,xg(s,v)}s.expirationTime=1073741823;break e}a=void 0,s=t;var y=i.pingCache;if(null===y?(y=i.pingCache=new Wi,a=new Set,y.set(c,a)):void 0===(a=y.get(c))&&(a=new Set,y.set(c,a)),!a.has(s)){a.add(s);var b=Oj.bind(null,i,c,s);c.then(b,b)}d.effectTag|=4096,d.expirationTime=t;break e}d=d.return}while(null!==d);a=Error((pb(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+qb(s))}S$1!==jj&&(S$1=ij),a=Ai(a,s),d=o;do{switch(d.tag){case 3:c=a,d.effectTag|=4096,d.expirationTime=t,yg(d,Xi(d,c,t));break e;case 1:c=a;var S=d.type,T=d.stateNode;if(0==(64&d.effectTag)&&("function"==typeof S.getDerivedStateFromError||null!==T&&"function"==typeof T.componentDidCatch&&(null===aj||!aj.has(T)))){d.effectTag|=4096,d.expirationTime=t,yg(d,$i(d,c,t));break e}}d=d.return}while(null!==d)}X$1=Pj(X$1)}catch(e){t=e;continue}break}}function Fj(){var e=cj.current;return cj.current=sh,null===e?sh:e}function Ag(e,t){e<lj&&2<e&&(lj=e),null!==t&&e<mj&&2<e&&(mj=e,nj=t)}function Bg(e){e>wi&&(wi=e)}function Kj(){for(;null!==X$1;)X$1=Qj(X$1)}function Gj(){for(;null!==X$1&&!Uf();)X$1=Qj(X$1)}function Qj(e){var t=Rj(e.alternate,e,U$1);return e.memoizedProps=e.pendingProps,null===t&&(t=Pj(e)),dj.current=null,t}function Pj(e){X$1=e;do{var t=X$1.alternate;if(e=X$1.return,0==(2048&X$1.effectTag)){if(t=si(t,X$1,U$1),1===U$1||1!==X$1.childExpirationTime){for(var r=0,n=X$1.child;null!==n;){var i=n.expirationTime,o=n.childExpirationTime;i>r&&(r=i),o>r&&(r=o),n=n.sibling}X$1.childExpirationTime=r}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=X$1.firstEffect),null!==X$1.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=X$1.firstEffect),e.lastEffect=X$1.lastEffect),1<X$1.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=X$1:e.firstEffect=X$1,e.lastEffect=X$1))}else{if(null!==(t=zi(X$1)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=X$1.sibling))return t;X$1=e}while(null!==X$1);return S$1===ti&&(S$1=jj),null}function Ij(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function Jj(e){var t=ag();return cg(99,Sj.bind(null,e,t)),null}function Sj(e,t){do{Dj()}while(null!==rj);if((W$1&(fj|gj))!==V$2)throw Error(u$1(327));var r=e.finishedWork,n=e.finishedExpirationTime;if(null===r)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,r===e.current)throw Error(u$1(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var i=Ij(r);if(e.firstPendingTime=i,n<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:n<=e.firstSuspendedTime&&(e.firstSuspendedTime=n-1),n<=e.lastPingedTime&&(e.lastPingedTime=0),n<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===T$1&&(X$1=T$1=null,U$1=0),1<r.effectTag?null!==r.lastEffect?(r.lastEffect.nextEffect=r,i=r.firstEffect):i=r:i=r.firstEffect,null!==i){var o=W$1;W$1|=gj,dj.current=null,Dd=fd;var s=xd();if(yd(s)){if("selectionStart"in s)var a={start:s.selectionStart,end:s.selectionEnd};else e:{var c=(a=(a=s.ownerDocument)&&a.defaultView||window).getSelection&&a.getSelection();if(c&&0!==c.rangeCount){a=c.anchorNode;var u=c.anchorOffset,l=c.focusNode;c=c.focusOffset;try{a.nodeType,l.nodeType}catch(e){a=null;break e}var d=0,p=-1,m=-1,f=0,h=0,g=s,v=null;t:for(;;){for(var y;g!==a||0!==u&&3!==g.nodeType||(p=d+u),g!==l||0!==c&&3!==g.nodeType||(m=d+c),3===g.nodeType&&(d+=g.nodeValue.length),null!==(y=g.firstChild);)v=g,g=y;for(;;){if(g===s)break t;if(v===a&&++f===u&&(p=d),v===l&&++h===c&&(m=d),null!==(y=g.nextSibling))break;v=(g=v).parentNode}g=y}a=-1===p||-1===m?null:{start:p,end:m}}else a=null}a=a||{start:0,end:0}}else a=null;Ed={activeElementDetached:null,focusedElem:s,selectionRange:a},fd=!1,Y$1=i;do{try{Tj()}catch(e){if(null===Y$1)throw Error(u$1(330));Ei(Y$1,e),Y$1=Y$1.nextEffect}}while(null!==Y$1);Y$1=i;do{try{for(s=e,a=t;null!==Y$1;){var b=Y$1.effectTag;if(16&b&&Rb(Y$1.stateNode,""),128&b){var S=Y$1.alternate;if(null!==S){var T=S.ref;null!==T&&("function"==typeof T?T(null):T.current=null)}}switch(1038&b){case 2:Pi(Y$1),Y$1.effectTag&=-3;break;case 6:Pi(Y$1),Y$1.effectTag&=-3,Si(Y$1.alternate,Y$1);break;case 1024:Y$1.effectTag&=-1025;break;case 1028:Y$1.effectTag&=-1025,Si(Y$1.alternate,Y$1);break;case 4:Si(Y$1.alternate,Y$1);break;case 8:Mi(s,u=Y$1,a),Ni(u)}Y$1=Y$1.nextEffect}}catch(e){if(null===Y$1)throw Error(u$1(330));Ei(Y$1,e),Y$1=Y$1.nextEffect}}while(null!==Y$1);if(T=Ed,S=xd(),b=T.focusedElem,a=T.selectionRange,S!==b&&b&&b.ownerDocument&&wd(b.ownerDocument.documentElement,b)){null!==a&&yd(b)&&(S=a.start,void 0===(T=a.end)&&(T=S),"selectionStart"in b?(b.selectionStart=S,b.selectionEnd=Math.min(T,b.value.length)):(T=(S=b.ownerDocument||document)&&S.defaultView||window).getSelection&&(T=T.getSelection(),u=b.textContent.length,s=Math.min(a.start,u),a=void 0===a.end?s:Math.min(a.end,u),!T.extend&&s>a&&(u=a,a=s,s=u),u=vd(b,s),l=vd(b,a),u&&l&&(1!==T.rangeCount||T.anchorNode!==u.node||T.anchorOffset!==u.offset||T.focusNode!==l.node||T.focusOffset!==l.offset)&&((S=S.createRange()).setStart(u.node,u.offset),T.removeAllRanges(),s>a?(T.addRange(S),T.extend(l.node,l.offset)):(S.setEnd(l.node,l.offset),T.addRange(S))))),S=[];for(T=b;T=T.parentNode;)1===T.nodeType&&S.push({element:T,left:T.scrollLeft,top:T.scrollTop});for("function"==typeof b.focus&&b.focus(),b=0;b<S.length;b++)(T=S[b]).element.scrollLeft=T.left,T.element.scrollTop=T.top}fd=!!Dd,Ed=Dd=null,e.current=r,Y$1=i;do{try{for(b=e;null!==Y$1;){var _=Y$1.effectTag;if(36&_&&Ji(b,Y$1.alternate,Y$1),128&_){S=void 0;var w=Y$1.ref;if(null!==w){var M=Y$1.stateNode;Y$1.tag,S=M,"function"==typeof w?w(S):w.current=S}}Y$1=Y$1.nextEffect}}catch(e){if(null===Y$1)throw Error(u$1(330));Ei(Y$1,e),Y$1=Y$1.nextEffect}}while(null!==Y$1);Y$1=null,Vf(),W$1=o}else e.current=r;if(qj)qj=!1,rj=e,sj=t;else for(Y$1=i;null!==Y$1;)t=Y$1.nextEffect,Y$1.nextEffect=null,Y$1=t;if(0===(t=e.firstPendingTime)&&(aj=null),1073741823===t?e===vj?uj++:(uj=0,vj=e):uj=0,"function"==typeof Uj&&Uj(r.stateNode,n),Z$1(e),Yi)throw Yi=!1,e=Zi,Zi=null,e;return(W$1&ej)!==V$2||gg(),null}function Tj(){for(;null!==Y$1;){var e=Y$1.effectTag;0!=(256&e)&&Gi(Y$1.alternate,Y$1),0==(512&e)||qj||(qj=!0,dg(97,(function(){return Dj(),null}))),Y$1=Y$1.nextEffect}}function Dj(){if(90!==sj){var e=97<sj?97:sj;return sj=90,cg(e,Vj)}}function Vj(){if(null===rj)return!1;var e=rj;if(rj=null,(W$1&(fj|gj))!==V$2)throw Error(u$1(331));var t=W$1;for(W$1|=gj,e=e.current.firstEffect;null!==e;){try{var r=e;if(0!=(512&r.effectTag))switch(r.tag){case 0:case 11:case 15:case 22:Hi(5,r),Ii(5,r)}}catch(t){if(null===e)throw Error(u$1(330));Ei(e,t)}r=e.nextEffect,e.nextEffect=null,e=r}return W$1=t,gg(),!0}function Wj(e,t,r){xg(e,t=Xi(e,t=Ai(r,t),1073741823)),null!==(e=xj(e,1073741823))&&Z$1(e)}function Ei(e,t){if(3===e.tag)Wj(e,e,t);else for(var r=e.return;null!==r;){if(3===r.tag){Wj(r,e,t);break}if(1===r.tag){var n=r.stateNode;if("function"==typeof r.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===aj||!aj.has(n))){xg(r,e=$i(r,e=Ai(t,e),1073741823)),null!==(r=xj(r,1073741823))&&Z$1(r);break}}r=r.return}}function Oj(e,t,r){var n=e.pingCache;null!==n&&n.delete(t),T$1===e&&U$1===r?S$1===vi||S$1===ui&&1073741823===lj&&$f()-Ti<pj?Ej(e,U$1):oj=!0:Aj(e,r)&&(0!==(t=e.lastPingedTime)&&t<r||(e.lastPingedTime=r,Z$1(e)))}function Vi(e,t){var r=e.stateNode;null!==r&&r.delete(t),0===(t=0)&&(t=Hg(t=Gg(),e,null)),null!==(e=xj(e,t))&&Z$1(e)}Rj=function(e,t,r){var n=t.expirationTime;if(null!==e){var i=t.pendingProps;if(e.memoizedProps!==i||K$1.current)rg=!0;else{if(n<r){switch(rg=!1,t.tag){case 3:hi(t),Xh();break;case 5:if(fh(t),4&t.mode&&1!==r&&i.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:L$1(t.type)&&Gf(t);break;case 4:dh(t,t.stateNode.containerInfo);break;case 10:n=t.memoizedProps.value,i=t.type._context,I$1(jg,i._currentValue),i._currentValue=n;break;case 13:if(null!==t.memoizedState)return 0!==(n=t.child.childExpirationTime)&&n>=r?ji(e,t,r):(I$1(M$1,1&M$1.current),null!==(t=$h(e,t,r))?t.sibling:null);I$1(M$1,1&M$1.current);break;case 19:if(n=t.childExpirationTime>=r,0!=(64&e.effectTag)){if(n)return mi(e,t,r);t.effectTag|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null),I$1(M$1,M$1.current),!n)return null}return $h(e,t,r)}rg=!1}}else rg=!1;switch(t.expirationTime=0,t.tag){case 2:if(n=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,i=Cf(t,J$1.current),qg(t,r),i=oh(null,t,n,e,i,r),t.effectTag|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,L$1(n)){var o=!0;Gf(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,ug(t);var s=n.getDerivedStateFromProps;"function"==typeof s&&Fg(t,n,s,e),i.updater=Jg,t.stateNode=i,i._reactInternalFiber=t,Ng(t,n,e,r),t=gi(null,t,n,!0,o,r)}else t.tag=0,R$1(null,t,i,r),t=t.child;return t;case 16:e:{if(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,ob(i),1!==i._status)throw i._result;switch(i=i._result,t.type=i,o=t.tag=Xj(i),e=ig(i,e),o){case 0:t=di(null,t,i,e,r);break e;case 1:t=fi(null,t,i,e,r);break e;case 11:t=Zh(null,t,i,e,r);break e;case 14:t=ai(null,t,i,ig(i.type,e),n,r);break e}throw Error(u$1(306,i,""))}return t;case 0:return n=t.type,i=t.pendingProps,di(e,t,n,i=t.elementType===n?i:ig(n,i),r);case 1:return n=t.type,i=t.pendingProps,fi(e,t,n,i=t.elementType===n?i:ig(n,i),r);case 3:if(hi(t),n=t.updateQueue,null===e||null===n)throw Error(u$1(282));if(n=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,vg(e,t),zg(t,n,null,r),(n=t.memoizedState.element)===i)Xh(),t=$h(e,t,r);else{if((i=t.stateNode.hydrate)&&(Ph=Jd(t.stateNode.containerInfo.firstChild),Oh=t,i=Qh=!0),i)for(r=Yg(t,null,n,r),t.child=r;r;)r.effectTag=-3&r.effectTag|1024,r=r.sibling;else R$1(e,t,n,r),Xh();t=t.child}return t;case 5:return fh(t),null===e&&Uh(t),n=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,Gd(n,i)?s=null:null!==o&&Gd(n,o)&&(t.effectTag|=16),ei(e,t),4&t.mode&&1!==r&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(R$1(e,t,s,r),t=t.child),t;case 6:return null===e&&Uh(t),null;case 13:return ji(e,t,r);case 4:return dh(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Xg(t,null,n,r):R$1(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,Zh(e,t,n,i=t.elementType===n?i:ig(n,i),r);case 7:return R$1(e,t,t.pendingProps,r),t.child;case 8:case 12:return R$1(e,t,t.pendingProps.children,r),t.child;case 10:e:{n=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value;var a=t.type._context;if(I$1(jg,a._currentValue),a._currentValue=o,null!==s)if(a=s.value,0===(o=$e(a,o)?0:0|("function"==typeof n._calculateChangedBits?n._calculateChangedBits(a,o):1073741823))){if(s.children===i.children&&!K$1.current){t=$h(e,t,r);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){s=a.child;for(var u=c.firstContext;null!==u;){if(u.context===n&&0!=(u.observedBits&o)){1===a.tag&&((u=wg(r,null)).tag=2,xg(a,u)),a.expirationTime<r&&(a.expirationTime=r),null!==(u=a.alternate)&&u.expirationTime<r&&(u.expirationTime=r),pg(a.return,r),c.expirationTime<r&&(c.expirationTime=r);break}u=u.next}}else s=10===a.tag&&a.type===t.type?null:a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}R$1(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=(o=t.pendingProps).children,qg(t,r),n=n(i=sg(i,o.unstable_observedBits)),t.effectTag|=1,R$1(e,t,n,r),t.child;case 14:return o=ig(i=t.type,t.pendingProps),ai(e,t,i,o=ig(i.type,o),n,r);case 15:return ci(e,t,t.type,t.pendingProps,n,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:ig(n,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,L$1(n)?(e=!0,Gf(t)):e=!1,qg(t,r),Lg(t,n,i),Ng(t,n,i,r),gi(null,t,n,!0,e,r);case 19:return mi(e,t,r)}throw Error(u$1(156,t.tag))};var Uj=null,Li=null;function Yj(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var r=t.inject(e);Uj=function(e){try{t.onCommitFiberRoot(r,e,void 0,64==(64&e.current.effectTag))}catch(e){}},Li=function(e){try{t.onCommitFiberUnmount(r,e)}catch(e){}}}catch(e){}return!0}function Zj(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Sh(e,t,r,n){return new Zj(e,t,r,n)}function bi(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Xj(e){if("function"==typeof e)return bi(e)?1:0;if(null!=e){if((e=e.$$typeof)===gb)return 11;if(e===jb)return 14}return 2}function Sg(e,t){var r=e.alternate;return null===r?((r=Sh(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.effectTag=0,r.nextEffect=null,r.firstEffect=null,r.lastEffect=null),r.childExpirationTime=e.childExpirationTime,r.expirationTime=e.expirationTime,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Ug(e,t,r,n,i,o){var s=2;if(n=e,"function"==typeof e)bi(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case ab:return Wg(r.children,i,o,t);case fb:s=8,i|=7;break;case bb:s=8,i|=1;break;case cb:return(e=Sh(12,r,t,8|i)).elementType=cb,e.type=cb,e.expirationTime=o,e;case hb:return(e=Sh(13,r,t,i)).type=hb,e.elementType=hb,e.expirationTime=o,e;case ib:return(e=Sh(19,r,t,i)).elementType=ib,e.expirationTime=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case db:s=10;break e;case eb:s=9;break e;case gb:s=11;break e;case jb:s=14;break e;case kb:s=16,n=null;break e;case lb:s=22;break e}throw Error(u$1(130,null==e?e:typeof e,""))}return(t=Sh(s,r,t,i)).elementType=e,t.type=n,t.expirationTime=o,t}function Wg(e,t,r,n){return(e=Sh(7,e,n,t)).expirationTime=r,e}function Tg(e,t,r){return(e=Sh(6,e,null,t)).expirationTime=r,e}function Vg(e,t,r){return(t=Sh(4,null!==e.children?e.children:[],e.key,t)).expirationTime=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ak(e,t,r){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=r,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Aj(e,t){var r=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==r&&r>=t&&e<=t}function xi(e,t){var r=e.firstSuspendedTime,n=e.lastSuspendedTime;r<t&&(e.firstSuspendedTime=t),(n>t||0===r)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function yi(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var r=e.firstSuspendedTime;0!==r&&(t>=r?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Cj(e,t){var r=e.lastExpiredTime;(0===r||r>t)&&(e.lastExpiredTime=t)}function bk(e,t,r,n){var i=t.current,o=Gg(),s=Dg.suspense;o=Hg(o,i,s);e:if(r){t:{if(dc(r=r._reactInternalFiber)!==r||1!==r.tag)throw Error(u$1(170));var a=r;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(L$1(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(null!==a);throw Error(u$1(171))}if(1===r.tag){var c=r.type;if(L$1(c)){r=Ff(r,c,a);break e}}r=a}else r=Af;return null===t.context?t.context=r:t.pendingContext=r,(t=wg(o,s)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),xg(i,t),Ig(i,o),o}function ck(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function dk(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function ek(e,t){dk(e,t),(e=e.alternate)&&dk(e,t)}function fk(e,t,r){var n=new ak(e,t,r=null!=r&&!0===r.hydrate),i=Sh(3,null,null,2===t?7:1===t?3:0);n.current=i,i.stateNode=n,ug(i),e[Od]=n.current,r&&0!==t&&Jc(e,9===e.nodeType?e:e.ownerDocument),this._internalRoot=n}function gk(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function hk(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var r;r=e.lastChild;)e.removeChild(r);return new fk(e,0,t?{hydrate:!0}:void 0)}function ik(e,t,r,n,i){var o=r._reactRootContainer;if(o){var s=o._internalRoot;if("function"==typeof i){var a=i;i=function(){var e=ck(s);a.call(e)}}bk(t,s,e,i)}else{if(o=r._reactRootContainer=hk(r,n),s=o._internalRoot,"function"==typeof i){var c=i;i=function(){var e=ck(s);c.call(e)}}Nj((function(){bk(t,s,e,i)}))}return ck(s)}function jk(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:$a,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}}function kk(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!gk(t))throw Error(u$1(200));return jk(e,t,null,r)}fk.prototype.render=function(e){bk(e,this._internalRoot,null,null)},fk.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;bk(null,e,null,(function(){t[Od]=null}))},wc=function(e){if(13===e.tag){var t=hg(Gg(),150,100);Ig(e,t),ek(e,t)}},xc=function(e){13===e.tag&&(Ig(e,3),ek(e,3))},yc=function(e){if(13===e.tag){var t=Gg();Ig(e,t=Hg(t,e,null)),ek(e,t)}},za=function(e,t,r){switch(t){case"input":if(Cb(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=Qd(n);if(!i)throw Error(u$1(90));yb(n),Cb(n,i)}}}break;case"textarea":Kb(e,r);break;case"select":null!=(t=r.value)&&Hb(e,!!r.multiple,t,!1)}},Fa=Mj,Ga=function(e,t,r,n,i){var o=W$1;W$1|=4;try{return cg(98,e.bind(null,t,r,n,i))}finally{(W$1=o)===V$2&&gg()}},Ha=function(){(W$1&(1|fj|gj))===V$2&&(Lj(),Dj())},Ia=function(e,t){var r=W$1;W$1|=2;try{return e(t)}finally{(W$1=r)===V$2&&gg()}};var lk={Events:[Nc,Pd,Qd,xa,ta,Xd,function(e){jc(e,Wd)},Da,Ea,id,mc,Dj,{current:!1}]};function checkDCE(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}!function(e){var t=e.findFiberByHostInstance;Yj(n$1({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wa.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=hc(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:tc,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}),reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lk,reactDom_production_min.createPortal=kk,reactDom_production_min.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(u$1(188));throw Error(u$1(268,Object.keys(e)))}return e=null===(e=hc(t))?null:e.stateNode},reactDom_production_min.flushSync=function(e,t){if((W$1&(fj|gj))!==V$2)throw Error(u$1(187));var r=W$1;W$1|=1;try{return cg(99,e.bind(null,t))}finally{W$1=r,gg()}},reactDom_production_min.hydrate=function(e,t,r){if(!gk(t))throw Error(u$1(200));return ik(null,e,t,!0,r)},reactDom_production_min.render=function(e,t,r){if(!gk(t))throw Error(u$1(200));return ik(null,e,t,!1,r)},reactDom_production_min.unmountComponentAtNode=function(e){if(!gk(e))throw Error(u$1(40));return!!e._reactRootContainer&&(Nj((function(){ik(null,null,e,!1,(function(){e._reactRootContainer=null,e[Od]=null}))})),!0)},reactDom_production_min.unstable_batchedUpdates=Mj,reactDom_production_min.unstable_createPortal=function(e,t){return kk(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!gk(r))throw Error(u$1(200));if(null==e||void 0===e._reactInternalFiber)throw Error(u$1(38));return ik(e,t,r,!1,n)},reactDom_production_min.version="16.14.0",checkDCE(),reactDom.exports=reactDom_production_min;var ReactDOM=reactDom.exports,ReactDOM$1=_mergeNamespaces({__proto__:null,default:ReactDOM},[reactDom.exports]);function isObject$7(e){return null!==e&&"object"==typeof e&&"constructor"in e&&e.constructor===Object}function extend$3(e={},t={}){Object.keys(t).forEach((r=>{void 0===e[r]?e[r]=t[r]:isObject$7(t[r])&&isObject$7(e[r])&&Object.keys(t[r]).length>0&&extend$3(e[r],t[r])}))}const ssrDocument={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector:()=>null,querySelectorAll:()=>[],getElementById:()=>null,createEvent:()=>({initEvent(){}}),createElement:()=>({children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName:()=>[]}),createElementNS:()=>({}),importNode:()=>null,location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function getDocument(){const e="undefined"!=typeof document?document:{};return extend$3(e,ssrDocument),e}const ssrWindow={document:ssrDocument,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle:()=>({getPropertyValue:()=>""}),Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia:()=>({}),requestAnimationFrame:e=>"undefined"==typeof setTimeout?(e(),null):setTimeout(e,0),cancelAnimationFrame(e){"undefined"!=typeof setTimeout&&clearTimeout(e)}};function getWindow(){const e="undefined"!=typeof window?window:{};return extend$3(e,ssrWindow),e}function makeReactive(e){const t=e.__proto__;Object.defineProperty(e,"__proto__",{get:()=>t,set(e){t.__proto__=e}})}class Dom7 extends Array{constructor(e){"number"==typeof e?super(e):(super(...e||[]),makeReactive(this))}}function arrayFlat(e=[]){const t=[];return e.forEach((e=>{Array.isArray(e)?t.push(...arrayFlat(e)):t.push(e)})),t}function arrayFilter(e,t){return Array.prototype.filter.call(e,t)}function arrayUnique(e){const t=[];for(let r=0;r<e.length;r+=1)-1===t.indexOf(e[r])&&t.push(e[r]);return t}function qsa(e,t){if("string"!=typeof e)return[e];const r=[],n=t.querySelectorAll(e);for(let e=0;e<n.length;e+=1)r.push(n[e]);return r}function $$1(e,t){const r=getWindow(),n=getDocument();let i=[];if(!t&&e instanceof Dom7)return e;if(!e)return new Dom7(i);if("string"==typeof e){const r=e.trim();if(r.indexOf("<")>=0&&r.indexOf(">")>=0){let e="div";0===r.indexOf("<li")&&(e="ul"),0===r.indexOf("<tr")&&(e="tbody"),0!==r.indexOf("<td")&&0!==r.indexOf("<th")||(e="tr"),0===r.indexOf("<tbody")&&(e="table"),0===r.indexOf("<option")&&(e="select");const t=n.createElement(e);t.innerHTML=r;for(let e=0;e<t.childNodes.length;e+=1)i.push(t.childNodes[e])}else i=qsa(e.trim(),t||n)}else if(e.nodeType||e===r||e===n)i.push(e);else if(Array.isArray(e)){if(e instanceof Dom7)return e;i=e}return new Dom7(arrayUnique(i))}function addClass(...e){const t=arrayFlat(e.map((e=>e.split(" "))));return this.forEach((e=>{e.classList.add(...t)})),this}function removeClass(...e){const t=arrayFlat(e.map((e=>e.split(" "))));return this.forEach((e=>{e.classList.remove(...t)})),this}function toggleClass(...e){const t=arrayFlat(e.map((e=>e.split(" "))));this.forEach((e=>{t.forEach((t=>{e.classList.toggle(t)}))}))}function hasClass(...e){const t=arrayFlat(e.map((e=>e.split(" "))));return arrayFilter(this,(e=>t.filter((t=>e.classList.contains(t))).length>0)).length>0}function attr(e,t){if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(let r=0;r<this.length;r+=1)if(2===arguments.length)this[r].setAttribute(e,t);else for(const t in e)this[r][t]=e[t],this[r].setAttribute(t,e[t]);return this}function removeAttr(e){for(let t=0;t<this.length;t+=1)this[t].removeAttribute(e);return this}function transform(e){for(let t=0;t<this.length;t+=1)this[t].style.transform=e;return this}function transition$1(e){for(let t=0;t<this.length;t+=1)this[t].style.transitionDuration="string"!=typeof e?`${e}ms`:e;return this}function on(...e){let[t,r,n,i]=e;function o(e){const t=e.target;if(!t)return;const i=e.target.dom7EventData||[];if(i.indexOf(e)<0&&i.unshift(e),$$1(t).is(r))n.apply(t,i);else{const e=$$1(t).parents();for(let t=0;t<e.length;t+=1)$$1(e[t]).is(r)&&n.apply(e[t],i)}}function s(e){const t=e&&e.target&&e.target.dom7EventData||[];t.indexOf(e)<0&&t.unshift(e),n.apply(this,t)}"function"==typeof e[1]&&([t,n,i]=e,r=void 0),i||(i=!1);const a=t.split(" ");let c;for(let e=0;e<this.length;e+=1){const t=this[e];if(r)for(c=0;c<a.length;c+=1){const e=a[c];t.dom7LiveListeners||(t.dom7LiveListeners={}),t.dom7LiveListeners[e]||(t.dom7LiveListeners[e]=[]),t.dom7LiveListeners[e].push({listener:n,proxyListener:o}),t.addEventListener(e,o,i)}else for(c=0;c<a.length;c+=1){const e=a[c];t.dom7Listeners||(t.dom7Listeners={}),t.dom7Listeners[e]||(t.dom7Listeners[e]=[]),t.dom7Listeners[e].push({listener:n,proxyListener:s}),t.addEventListener(e,s,i)}}return this}function off(...e){let[t,r,n,i]=e;"function"==typeof e[1]&&([t,n,i]=e,r=void 0),i||(i=!1);const o=t.split(" ");for(let e=0;e<o.length;e+=1){const t=o[e];for(let e=0;e<this.length;e+=1){const o=this[e];let s;if(!r&&o.dom7Listeners?s=o.dom7Listeners[t]:r&&o.dom7LiveListeners&&(s=o.dom7LiveListeners[t]),s&&s.length)for(let e=s.length-1;e>=0;e-=1){const r=s[e];n&&r.listener===n||n&&r.listener&&r.listener.dom7proxy&&r.listener.dom7proxy===n?(o.removeEventListener(t,r.proxyListener,i),s.splice(e,1)):n||(o.removeEventListener(t,r.proxyListener,i),s.splice(e,1))}}}return this}function trigger(...e){const t=getWindow(),r=e[0].split(" "),n=e[1];for(let i=0;i<r.length;i+=1){const o=r[i];for(let r=0;r<this.length;r+=1){const i=this[r];if(t.CustomEvent){const r=new t.CustomEvent(o,{detail:n,bubbles:!0,cancelable:!0});i.dom7EventData=e.filter(((e,t)=>t>0)),i.dispatchEvent(r),i.dom7EventData=[],delete i.dom7EventData}}}return this}function transitionEnd$1(e){const t=this;return e&&t.on("transitionend",(function r(n){n.target===this&&(e.call(this,n),t.off("transitionend",r))})),this}function outerWidth(e){if(this.length>0){if(e){const e=this.styles();return this[0].offsetWidth+parseFloat(e.getPropertyValue("margin-right"))+parseFloat(e.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null}function outerHeight(e){if(this.length>0){if(e){const e=this.styles();return this[0].offsetHeight+parseFloat(e.getPropertyValue("margin-top"))+parseFloat(e.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null}function offset(){if(this.length>0){const e=getWindow(),t=getDocument(),r=this[0],n=r.getBoundingClientRect(),i=t.body,o=r.clientTop||i.clientTop||0,s=r.clientLeft||i.clientLeft||0,a=r===e?e.scrollY:r.scrollTop,c=r===e?e.scrollX:r.scrollLeft;return{top:n.top+a-o,left:n.left+c-s}}return null}function styles(){const e=getWindow();return this[0]?e.getComputedStyle(this[0],null):{}}function css(e,t){const r=getWindow();let n;if(1===arguments.length){if("string"!=typeof e){for(n=0;n<this.length;n+=1)for(const t in e)this[n].style[t]=e[t];return this}if(this[0])return r.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(n=0;n<this.length;n+=1)this[n].style[e]=t;return this}return this}function each$1(e){return e?(this.forEach(((t,r)=>{e.apply(t,[t,r])})),this):this}function filter(e){return $$1(arrayFilter(this,e))}function html(e){if(void 0===e)return this[0]?this[0].innerHTML:null;for(let t=0;t<this.length;t+=1)this[t].innerHTML=e;return this}function text(e){if(void 0===e)return this[0]?this[0].textContent.trim():null;for(let t=0;t<this.length;t+=1)this[t].textContent=e;return this}function is$1(e){const t=getWindow(),r=getDocument(),n=this[0];let i,o;if(!n||void 0===e)return!1;if("string"==typeof e){if(n.matches)return n.matches(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);for(i=$$1(e),o=0;o<i.length;o+=1)if(i[o]===n)return!0;return!1}if(e===r)return n===r;if(e===t)return n===t;if(e.nodeType||e instanceof Dom7){for(i=e.nodeType?[e]:e,o=0;o<i.length;o+=1)if(i[o]===n)return!0;return!1}return!1}function index$1(){let e,t=this[0];if(t){for(e=0;null!==(t=t.previousSibling);)1===t.nodeType&&(e+=1);return e}}function eq$3(e){if(void 0===e)return this;const t=this.length;if(e>t-1)return $$1([]);if(e<0){const r=t+e;return $$1(r<0?[]:[this[r]])}return $$1([this[e]])}function append(...e){let t;const r=getDocument();for(let n=0;n<e.length;n+=1){t=e[n];for(let e=0;e<this.length;e+=1)if("string"==typeof t){const n=r.createElement("div");for(n.innerHTML=t;n.firstChild;)this[e].appendChild(n.firstChild)}else if(t instanceof Dom7)for(let r=0;r<t.length;r+=1)this[e].appendChild(t[r]);else this[e].appendChild(t)}return this}function prepend(e){const t=getDocument();let r,n;for(r=0;r<this.length;r+=1)if("string"==typeof e){const i=t.createElement("div");for(i.innerHTML=e,n=i.childNodes.length-1;n>=0;n-=1)this[r].insertBefore(i.childNodes[n],this[r].childNodes[0])}else if(e instanceof Dom7)for(n=0;n<e.length;n+=1)this[r].insertBefore(e[n],this[r].childNodes[0]);else this[r].insertBefore(e,this[r].childNodes[0]);return this}function next(e){return this.length>0?e?this[0].nextElementSibling&&$$1(this[0].nextElementSibling).is(e)?$$1([this[0].nextElementSibling]):$$1([]):this[0].nextElementSibling?$$1([this[0].nextElementSibling]):$$1([]):$$1([])}function nextAll(e){const t=[];let r=this[0];if(!r)return $$1([]);for(;r.nextElementSibling;){const n=r.nextElementSibling;e?$$1(n).is(e)&&t.push(n):t.push(n),r=n}return $$1(t)}function prev(e){if(this.length>0){const t=this[0];return e?t.previousElementSibling&&$$1(t.previousElementSibling).is(e)?$$1([t.previousElementSibling]):$$1([]):t.previousElementSibling?$$1([t.previousElementSibling]):$$1([])}return $$1([])}function prevAll(e){const t=[];let r=this[0];if(!r)return $$1([]);for(;r.previousElementSibling;){const n=r.previousElementSibling;e?$$1(n).is(e)&&t.push(n):t.push(n),r=n}return $$1(t)}function parent(e){const t=[];for(let r=0;r<this.length;r+=1)null!==this[r].parentNode&&(e?$$1(this[r].parentNode).is(e)&&t.push(this[r].parentNode):t.push(this[r].parentNode));return $$1(t)}function parents(e){const t=[];for(let r=0;r<this.length;r+=1){let n=this[r].parentNode;for(;n;)e?$$1(n).is(e)&&t.push(n):t.push(n),n=n.parentNode}return $$1(t)}function closest(e){let t=this;return void 0===e?$$1([]):(t.is(e)||(t=t.parents(e).eq(0)),t)}function find(e){const t=[];for(let r=0;r<this.length;r+=1){const n=this[r].querySelectorAll(e);for(let e=0;e<n.length;e+=1)t.push(n[e])}return $$1(t)}function children(e){const t=[];for(let r=0;r<this.length;r+=1){const n=this[r].children;for(let r=0;r<n.length;r+=1)e&&!$$1(n[r]).is(e)||t.push(n[r])}return $$1(t)}function remove(){for(let e=0;e<this.length;e+=1)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this}$$1.fn=Dom7.prototype;const Methods={addClass:addClass,removeClass:removeClass,hasClass:hasClass,toggleClass:toggleClass,attr:attr,removeAttr:removeAttr,transform:transform,transition:transition$1,on:on,off:off,trigger:trigger,transitionEnd:transitionEnd$1,outerWidth:outerWidth,outerHeight:outerHeight,styles:styles,offset:offset,css:css,each:each$1,html:html,text:text,is:is$1,index:index$1,eq:eq$3,append:append,prepend:prepend,next:next,nextAll:nextAll,prev:prev,prevAll:prevAll,parent:parent,parents:parents,closest:closest,find:find,children:children,filter:filter,remove:remove};function deleteProps(e){const t=e;Object.keys(t).forEach((e=>{try{t[e]=null}catch(e){}try{delete t[e]}catch(e){}}))}function nextTick(e,t=0){return setTimeout(e,t)}function now(){return Date.now()}function getComputedStyle$1(e){const t=getWindow();let r;return t.getComputedStyle&&(r=t.getComputedStyle(e,null)),!r&&e.currentStyle&&(r=e.currentStyle),r||(r=e.style),r}function getTranslate(e,t="x"){const r=getWindow();let n,i,o;const s=getComputedStyle$1(e);return r.WebKitCSSMatrix?(i=s.transform||s.webkitTransform,i.split(",").length>6&&(i=i.split(", ").map((e=>e.replace(",","."))).join(", ")),o=new r.WebKitCSSMatrix("none"===i?"":i)):(o=s.MozTransform||s.OTransform||s.MsTransform||s.msTransform||s.transform||s.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=o.toString().split(",")),"x"===t&&(i=r.WebKitCSSMatrix?o.m41:16===n.length?parseFloat(n[12]):parseFloat(n[4])),"y"===t&&(i=r.WebKitCSSMatrix?o.m42:16===n.length?parseFloat(n[13]):parseFloat(n[5])),i||0}function isObject$6(e){return"object"==typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)}function isNode(e){return"undefined"!=typeof window&&void 0!==window.HTMLElement?e instanceof HTMLElement:e&&(1===e.nodeType||11===e.nodeType)}function extend$2(...e){const t=Object(e[0]),r=["__proto__","constructor","prototype"];for(let n=1;n<e.length;n+=1){const i=e[n];if(null!=i&&!isNode(i)){const e=Object.keys(Object(i)).filter((e=>r.indexOf(e)<0));for(let r=0,n=e.length;r<n;r+=1){const n=e[r],o=Object.getOwnPropertyDescriptor(i,n);void 0!==o&&o.enumerable&&(isObject$6(t[n])&&isObject$6(i[n])?i[n].__swiper__?t[n]=i[n]:extend$2(t[n],i[n]):!isObject$6(t[n])&&isObject$6(i[n])?(t[n]={},i[n].__swiper__?t[n]=i[n]:extend$2(t[n],i[n])):t[n]=i[n])}}}return t}function setCSSProperty(e,t,r){e.style.setProperty(t,r)}function animateCSSModeScroll({swiper:e,targetPosition:t,side:r}){const n=getWindow(),i=-e.translate;let o,s=null;const a=e.params.speed;e.wrapperEl.style.scrollSnapType="none",n.cancelAnimationFrame(e.cssModeFrameID);const c=t>i?"next":"prev",u=(e,t)=>"next"===c&&e>=t||"prev"===c&&e<=t,l=()=>{o=(new Date).getTime(),null===s&&(s=o);const c=Math.max(Math.min((o-s)/a,1),0),d=.5-Math.cos(c*Math.PI)/2;let p=i+d*(t-i);if(u(p,t)&&(p=t),e.wrapperEl.scrollTo({[r]:p}),u(p,t))return e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout((()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[r]:p})})),void n.cancelAnimationFrame(e.cssModeFrameID);e.cssModeFrameID=n.requestAnimationFrame(l)};l()}let support,deviceCached,browser$1;function calcSupport(){const e=getWindow(),t=getDocument();return{smoothScroll:t.documentElement&&"scrollBehavior"in t.documentElement.style,touch:!!("ontouchstart"in e||e.DocumentTouch&&t instanceof e.DocumentTouch),passiveListener:function(){let t=!1;try{const r=Object.defineProperty({},"passive",{get(){t=!0}});e.addEventListener("testPassiveListener",null,r)}catch(e){}return t}(),gestures:"ongesturestart"in e}}function getSupport(){return support||(support=calcSupport()),support}function calcDevice({userAgent:e}={}){const t=getSupport(),r=getWindow(),n=r.navigator.platform,i=e||r.navigator.userAgent,o={ios:!1,android:!1},s=r.screen.width,a=r.screen.height,c=i.match(/(Android);?[\s\/]+([\d.]+)?/);let u=i.match(/(iPad).*OS\s([\d_]+)/);const l=i.match(/(iPod)(.*OS\s([\d_]+))?/),d=!u&&i.match(/(iPhone\sOS|iOS)\s([\d_]+)/),p="Win32"===n;let m="MacIntel"===n;return!u&&m&&t.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${s}x${a}`)>=0&&(u=i.match(/(Version)\/([\d.]+)/),u||(u=[0,1,"13_0_0"]),m=!1),c&&!p&&(o.os="android",o.android=!0),(u||d||l)&&(o.os="ios",o.ios=!0),o}function getDevice(e={}){return deviceCached||(deviceCached=calcDevice(e)),deviceCached}function calcBrowser(){const e=getWindow();return{isSafari:function(){const t=e.navigator.userAgent.toLowerCase();return t.indexOf("safari")>=0&&t.indexOf("chrome")<0&&t.indexOf("android")<0}(),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e.navigator.userAgent)}}function getBrowser(){return browser$1||(browser$1=calcBrowser()),browser$1}function Resize({swiper:e,on:t,emit:r}){const n=getWindow();let i=null,o=null;const s=()=>{e&&!e.destroyed&&e.initialized&&(r("beforeResize"),r("resize"))},a=()=>{e&&!e.destroyed&&e.initialized&&r("orientationchange")};t("init",(()=>{e.params.resizeObserver&&void 0!==n.ResizeObserver?e&&!e.destroyed&&e.initialized&&(i=new ResizeObserver((t=>{o=n.requestAnimationFrame((()=>{const{width:r,height:n}=e;let i=r,o=n;t.forEach((({contentBoxSize:t,contentRect:r,target:n})=>{n&&n!==e.el||(i=r?r.width:(t[0]||t).inlineSize,o=r?r.height:(t[0]||t).blockSize)})),i===r&&o===n||s()}))})),i.observe(e.el)):(n.addEventListener("resize",s),n.addEventListener("orientationchange",a))})),t("destroy",(()=>{o&&n.cancelAnimationFrame(o),i&&i.unobserve&&e.el&&(i.unobserve(e.el),i=null),n.removeEventListener("resize",s),n.removeEventListener("orientationchange",a)}))}function Observer({swiper:e,extendParams:t,on:r,emit:n}){const i=[],o=getWindow(),s=(e,t={})=>{const r=new(o.MutationObserver||o.WebkitMutationObserver)((e=>{if(1===e.length)return void n("observerUpdate",e[0]);const t=function(){n("observerUpdate",e[0])};o.requestAnimationFrame?o.requestAnimationFrame(t):o.setTimeout(t,0)}));r.observe(e,{attributes:void 0===t.attributes||t.attributes,childList:void 0===t.childList||t.childList,characterData:void 0===t.characterData||t.characterData}),i.push(r)};t({observer:!1,observeParents:!1,observeSlideChildren:!1}),r("init",(()=>{if(e.params.observer){if(e.params.observeParents){const t=e.$el.parents();for(let e=0;e<t.length;e+=1)s(t[e])}s(e.$el[0],{childList:e.params.observeSlideChildren}),s(e.$wrapperEl[0],{attributes:!1})}})),r("destroy",(()=>{i.forEach((e=>{e.disconnect()})),i.splice(0,i.length)}))}Object.keys(Methods).forEach((e=>{Object.defineProperty($$1.fn,e,{value:Methods[e],writable:!0})}));var eventsEmitter={on(e,t,r){const n=this;if(!n.eventsListeners||n.destroyed)return n;if("function"!=typeof t)return n;const i=r?"unshift":"push";return e.split(" ").forEach((e=>{n.eventsListeners[e]||(n.eventsListeners[e]=[]),n.eventsListeners[e][i](t)})),n},once(e,t,r){const n=this;if(!n.eventsListeners||n.destroyed)return n;if("function"!=typeof t)return n;function i(...r){n.off(e,i),i.__emitterProxy&&delete i.__emitterProxy,t.apply(n,r)}return i.__emitterProxy=t,n.on(e,i,r)},onAny(e,t){const r=this;if(!r.eventsListeners||r.destroyed)return r;if("function"!=typeof e)return r;const n=t?"unshift":"push";return r.eventsAnyListeners.indexOf(e)<0&&r.eventsAnyListeners[n](e),r},offAny(e){const t=this;if(!t.eventsListeners||t.destroyed)return t;if(!t.eventsAnyListeners)return t;const r=t.eventsAnyListeners.indexOf(e);return r>=0&&t.eventsAnyListeners.splice(r,1),t},off(e,t){const r=this;return!r.eventsListeners||r.destroyed?r:r.eventsListeners?(e.split(" ").forEach((e=>{void 0===t?r.eventsListeners[e]=[]:r.eventsListeners[e]&&r.eventsListeners[e].forEach(((n,i)=>{(n===t||n.__emitterProxy&&n.__emitterProxy===t)&&r.eventsListeners[e].splice(i,1)}))})),r):r},emit(...e){const t=this;if(!t.eventsListeners||t.destroyed)return t;if(!t.eventsListeners)return t;let r,n,i;"string"==typeof e[0]||Array.isArray(e[0])?(r=e[0],n=e.slice(1,e.length),i=t):(r=e[0].events,n=e[0].data,i=e[0].context||t),n.unshift(i);return(Array.isArray(r)?r:r.split(" ")).forEach((e=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach((t=>{t.apply(i,[e,...n])})),t.eventsListeners&&t.eventsListeners[e]&&t.eventsListeners[e].forEach((e=>{e.apply(i,n)}))})),t}};function updateSize(){const e=this;let t,r;const n=e.$el;t=void 0!==e.params.width&&null!==e.params.width?e.params.width:n[0].clientWidth,r=void 0!==e.params.height&&null!==e.params.height?e.params.height:n[0].clientHeight,0===t&&e.isHorizontal()||0===r&&e.isVertical()||(t=t-parseInt(n.css("padding-left")||0,10)-parseInt(n.css("padding-right")||0,10),r=r-parseInt(n.css("padding-top")||0,10)-parseInt(n.css("padding-bottom")||0,10),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=0),Object.assign(e,{width:t,height:r,size:e.isHorizontal()?t:r}))}function updateSlides(){const e=this;function t(t){return e.isHorizontal()?t:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[t]}function r(e,r){return parseFloat(e.getPropertyValue(t(r))||0)}const n=e.params,{$wrapperEl:i,size:o,rtlTranslate:s,wrongRTL:a}=e,c=e.virtual&&n.virtual.enabled,u=c?e.virtual.slides.length:e.slides.length,l=i.children(`.${e.params.slideClass}`),d=c?e.virtual.slides.length:l.length;let p=[];const m=[],f=[];let h=n.slidesOffsetBefore;"function"==typeof h&&(h=n.slidesOffsetBefore.call(e));let g=n.slidesOffsetAfter;"function"==typeof g&&(g=n.slidesOffsetAfter.call(e));const v=e.snapGrid.length,y=e.slidesGrid.length;let b=n.spaceBetween,S=-h,T=0,_=0;if(void 0===o)return;"string"==typeof b&&b.indexOf("%")>=0&&(b=parseFloat(b.replace("%",""))/100*o),e.virtualSize=-b,s?l.css({marginLeft:"",marginBottom:"",marginTop:""}):l.css({marginRight:"",marginBottom:"",marginTop:""}),n.centeredSlides&&n.cssMode&&(setCSSProperty(e.wrapperEl,"--swiper-centered-offset-before",""),setCSSProperty(e.wrapperEl,"--swiper-centered-offset-after",""));const w=n.grid&&n.grid.rows>1&&e.grid;let M;w&&e.grid.initSlides(d);const x="auto"===n.slidesPerView&&n.breakpoints&&Object.keys(n.breakpoints).filter((e=>void 0!==n.breakpoints[e].slidesPerView)).length>0;for(let i=0;i<d;i+=1){M=0;const s=l.eq(i);if(w&&e.grid.updateSlide(i,s,d,t),"none"!==s.css("display")){if("auto"===n.slidesPerView){x&&(l[i].style[t("width")]="");const o=getComputedStyle(s[0]),a=s[0].style.transform,c=s[0].style.webkitTransform;if(a&&(s[0].style.transform="none"),c&&(s[0].style.webkitTransform="none"),n.roundLengths)M=e.isHorizontal()?s.outerWidth(!0):s.outerHeight(!0);else{const e=r(o,"width"),t=r(o,"padding-left"),n=r(o,"padding-right"),i=r(o,"margin-left"),a=r(o,"margin-right"),c=o.getPropertyValue("box-sizing");if(c&&"border-box"===c)M=e+i+a;else{const{clientWidth:r,offsetWidth:o}=s[0];M=e+t+n+i+a+(o-r)}}a&&(s[0].style.transform=a),c&&(s[0].style.webkitTransform=c),n.roundLengths&&(M=Math.floor(M))}else M=(o-(n.slidesPerView-1)*b)/n.slidesPerView,n.roundLengths&&(M=Math.floor(M)),l[i]&&(l[i].style[t("width")]=`${M}px`);l[i]&&(l[i].swiperSlideSize=M),f.push(M),n.centeredSlides?(S=S+M/2+T/2+b,0===T&&0!==i&&(S=S-o/2-b),0===i&&(S=S-o/2-b),Math.abs(S)<.001&&(S=0),n.roundLengths&&(S=Math.floor(S)),_%n.slidesPerGroup==0&&p.push(S),m.push(S)):(n.roundLengths&&(S=Math.floor(S)),(_-Math.min(e.params.slidesPerGroupSkip,_))%e.params.slidesPerGroup==0&&p.push(S),m.push(S),S=S+M+b),e.virtualSize+=M+b,T=M,_+=1}}if(e.virtualSize=Math.max(e.virtualSize,o)+g,s&&a&&("slide"===n.effect||"coverflow"===n.effect)&&i.css({width:`${e.virtualSize+n.spaceBetween}px`}),n.setWrapperSize&&i.css({[t("width")]:`${e.virtualSize+n.spaceBetween}px`}),w&&e.grid.updateWrapperSize(M,p,t),!n.centeredSlides){const t=[];for(let r=0;r<p.length;r+=1){let i=p[r];n.roundLengths&&(i=Math.floor(i)),p[r]<=e.virtualSize-o&&t.push(i)}p=t,Math.floor(e.virtualSize-o)-Math.floor(p[p.length-1])>1&&p.push(e.virtualSize-o)}if(0===p.length&&(p=[0]),0!==n.spaceBetween){const r=e.isHorizontal()&&s?"marginLeft":t("marginRight");l.filter(((e,t)=>!n.cssMode||t!==l.length-1)).css({[r]:`${b}px`})}if(n.centeredSlides&&n.centeredSlidesBounds){let e=0;f.forEach((t=>{e+=t+(n.spaceBetween?n.spaceBetween:0)})),e-=n.spaceBetween;const t=e-o;p=p.map((e=>e<0?-h:e>t?t+g:e))}if(n.centerInsufficientSlides){let e=0;if(f.forEach((t=>{e+=t+(n.spaceBetween?n.spaceBetween:0)})),e-=n.spaceBetween,e<o){const t=(o-e)/2;p.forEach(((e,r)=>{p[r]=e-t})),m.forEach(((e,r)=>{m[r]=e+t}))}}if(Object.assign(e,{slides:l,snapGrid:p,slidesGrid:m,slidesSizesGrid:f}),n.centeredSlides&&n.cssMode&&!n.centeredSlidesBounds){setCSSProperty(e.wrapperEl,"--swiper-centered-offset-before",-p[0]+"px"),setCSSProperty(e.wrapperEl,"--swiper-centered-offset-after",e.size/2-f[f.length-1]/2+"px");const t=-e.snapGrid[0],r=-e.slidesGrid[0];e.snapGrid=e.snapGrid.map((e=>e+t)),e.slidesGrid=e.slidesGrid.map((e=>e+r))}if(d!==u&&e.emit("slidesLengthChange"),p.length!==v&&(e.params.watchOverflow&&e.checkOverflow(),e.emit("snapGridLengthChange")),m.length!==y&&e.emit("slidesGridLengthChange"),n.watchSlidesProgress&&e.updateSlidesOffset(),!(c||n.cssMode||"slide"!==n.effect&&"fade"!==n.effect)){const t=`${n.containerModifierClass}backface-hidden`,r=e.$el.hasClass(t);d<=n.maxBackfaceHiddenSlides?r||e.$el.addClass(t):r&&e.$el.removeClass(t)}}function updateAutoHeight(e){const t=this,r=[],n=t.virtual&&t.params.virtual.enabled;let i,o=0;"number"==typeof e?t.setTransition(e):!0===e&&t.setTransition(t.params.speed);const s=e=>n?t.slides.filter((t=>parseInt(t.getAttribute("data-swiper-slide-index"),10)===e))[0]:t.slides.eq(e)[0];if("auto"!==t.params.slidesPerView&&t.params.slidesPerView>1)if(t.params.centeredSlides)(t.visibleSlides||$$1([])).each((e=>{r.push(e)}));else for(i=0;i<Math.ceil(t.params.slidesPerView);i+=1){const e=t.activeIndex+i;if(e>t.slides.length&&!n)break;r.push(s(e))}else r.push(s(t.activeIndex));for(i=0;i<r.length;i+=1)if(void 0!==r[i]){const e=r[i].offsetHeight;o=e>o?e:o}(o||0===o)&&t.$wrapperEl.css("height",`${o}px`)}function updateSlidesOffset(){const e=this,t=e.slides;for(let r=0;r<t.length;r+=1)t[r].swiperSlideOffset=e.isHorizontal()?t[r].offsetLeft:t[r].offsetTop}function updateSlidesProgress(e=this&&this.translate||0){const t=this,r=t.params,{slides:n,rtlTranslate:i,snapGrid:o}=t;if(0===n.length)return;void 0===n[0].swiperSlideOffset&&t.updateSlidesOffset();let s=-e;i&&(s=e),n.removeClass(r.slideVisibleClass),t.visibleSlidesIndexes=[],t.visibleSlides=[];for(let e=0;e<n.length;e+=1){const a=n[e];let c=a.swiperSlideOffset;r.cssMode&&r.centeredSlides&&(c-=n[0].swiperSlideOffset);const u=(s+(r.centeredSlides?t.minTranslate():0)-c)/(a.swiperSlideSize+r.spaceBetween),l=(s-o[0]+(r.centeredSlides?t.minTranslate():0)-c)/(a.swiperSlideSize+r.spaceBetween),d=-(s-c),p=d+t.slidesSizesGrid[e];(d>=0&&d<t.size-1||p>1&&p<=t.size||d<=0&&p>=t.size)&&(t.visibleSlides.push(a),t.visibleSlidesIndexes.push(e),n.eq(e).addClass(r.slideVisibleClass)),a.progress=i?-u:u,a.originalProgress=i?-l:l}t.visibleSlides=$$1(t.visibleSlides)}function updateProgress(e){const t=this;if(void 0===e){const r=t.rtlTranslate?-1:1;e=t&&t.translate&&t.translate*r||0}const r=t.params,n=t.maxTranslate()-t.minTranslate();let{progress:i,isBeginning:o,isEnd:s}=t;const a=o,c=s;0===n?(i=0,o=!0,s=!0):(i=(e-t.minTranslate())/n,o=i<=0,s=i>=1),Object.assign(t,{progress:i,isBeginning:o,isEnd:s}),(r.watchSlidesProgress||r.centeredSlides&&r.autoHeight)&&t.updateSlidesProgress(e),o&&!a&&t.emit("reachBeginning toEdge"),s&&!c&&t.emit("reachEnd toEdge"),(a&&!o||c&&!s)&&t.emit("fromEdge"),t.emit("progress",i)}function updateSlidesClasses(){const e=this,{slides:t,params:r,$wrapperEl:n,activeIndex:i,realIndex:o}=e,s=e.virtual&&r.virtual.enabled;let a;t.removeClass(`${r.slideActiveClass} ${r.slideNextClass} ${r.slidePrevClass} ${r.slideDuplicateActiveClass} ${r.slideDuplicateNextClass} ${r.slideDuplicatePrevClass}`),a=s?e.$wrapperEl.find(`.${r.slideClass}[data-swiper-slide-index="${i}"]`):t.eq(i),a.addClass(r.slideActiveClass),r.loop&&(a.hasClass(r.slideDuplicateClass)?n.children(`.${r.slideClass}:not(.${r.slideDuplicateClass})[data-swiper-slide-index="${o}"]`).addClass(r.slideDuplicateActiveClass):n.children(`.${r.slideClass}.${r.slideDuplicateClass}[data-swiper-slide-index="${o}"]`).addClass(r.slideDuplicateActiveClass));let c=a.nextAll(`.${r.slideClass}`).eq(0).addClass(r.slideNextClass);r.loop&&0===c.length&&(c=t.eq(0),c.addClass(r.slideNextClass));let u=a.prevAll(`.${r.slideClass}`).eq(0).addClass(r.slidePrevClass);r.loop&&0===u.length&&(u=t.eq(-1),u.addClass(r.slidePrevClass)),r.loop&&(c.hasClass(r.slideDuplicateClass)?n.children(`.${r.slideClass}:not(.${r.slideDuplicateClass})[data-swiper-slide-index="${c.attr("data-swiper-slide-index")}"]`).addClass(r.slideDuplicateNextClass):n.children(`.${r.slideClass}.${r.slideDuplicateClass}[data-swiper-slide-index="${c.attr("data-swiper-slide-index")}"]`).addClass(r.slideDuplicateNextClass),u.hasClass(r.slideDuplicateClass)?n.children(`.${r.slideClass}:not(.${r.slideDuplicateClass})[data-swiper-slide-index="${u.attr("data-swiper-slide-index")}"]`).addClass(r.slideDuplicatePrevClass):n.children(`.${r.slideClass}.${r.slideDuplicateClass}[data-swiper-slide-index="${u.attr("data-swiper-slide-index")}"]`).addClass(r.slideDuplicatePrevClass)),e.emitSlidesClasses()}function updateActiveIndex(e){const t=this,r=t.rtlTranslate?t.translate:-t.translate,{slidesGrid:n,snapGrid:i,params:o,activeIndex:s,realIndex:a,snapIndex:c}=t;let u,l=e;if(void 0===l){for(let e=0;e<n.length;e+=1)void 0!==n[e+1]?r>=n[e]&&r<n[e+1]-(n[e+1]-n[e])/2?l=e:r>=n[e]&&r<n[e+1]&&(l=e+1):r>=n[e]&&(l=e);o.normalizeSlideIndex&&(l<0||void 0===l)&&(l=0)}if(i.indexOf(r)>=0)u=i.indexOf(r);else{const e=Math.min(o.slidesPerGroupSkip,l);u=e+Math.floor((l-e)/o.slidesPerGroup)}if(u>=i.length&&(u=i.length-1),l===s)return void(u!==c&&(t.snapIndex=u,t.emit("snapIndexChange")));const d=parseInt(t.slides.eq(l).attr("data-swiper-slide-index")||l,10);Object.assign(t,{snapIndex:u,realIndex:d,previousIndex:s,activeIndex:l}),t.emit("activeIndexChange"),t.emit("snapIndexChange"),a!==d&&t.emit("realIndexChange"),(t.initialized||t.params.runCallbacksOnInit)&&t.emit("slideChange")}function updateClickedSlide(e){const t=this,r=t.params,n=$$1(e).closest(`.${r.slideClass}`)[0];let i,o=!1;if(n)for(let e=0;e<t.slides.length;e+=1)if(t.slides[e]===n){o=!0,i=e;break}if(!n||!o)return t.clickedSlide=void 0,void(t.clickedIndex=void 0);t.clickedSlide=n,t.virtual&&t.params.virtual.enabled?t.clickedIndex=parseInt($$1(n).attr("data-swiper-slide-index"),10):t.clickedIndex=i,r.slideToClickedSlide&&void 0!==t.clickedIndex&&t.clickedIndex!==t.activeIndex&&t.slideToClickedSlide()}var update$1={updateSize:updateSize,updateSlides:updateSlides,updateAutoHeight:updateAutoHeight,updateSlidesOffset:updateSlidesOffset,updateSlidesProgress:updateSlidesProgress,updateProgress:updateProgress,updateSlidesClasses:updateSlidesClasses,updateActiveIndex:updateActiveIndex,updateClickedSlide:updateClickedSlide};function getSwiperTranslate(e=(this.isHorizontal()?"x":"y")){const{params:t,rtlTranslate:r,translate:n,$wrapperEl:i}=this;if(t.virtualTranslate)return r?-n:n;if(t.cssMode)return n;let o=getTranslate(i[0],e);return r&&(o=-o),o||0}function setTranslate(e,t){const r=this,{rtlTranslate:n,params:i,$wrapperEl:o,wrapperEl:s,progress:a}=r;let c=0,u=0;let l;r.isHorizontal()?c=n?-e:e:u=e,i.roundLengths&&(c=Math.floor(c),u=Math.floor(u)),i.cssMode?s[r.isHorizontal()?"scrollLeft":"scrollTop"]=r.isHorizontal()?-c:-u:i.virtualTranslate||o.transform(`translate3d(${c}px, ${u}px, 0px)`),r.previousTranslate=r.translate,r.translate=r.isHorizontal()?c:u;const d=r.maxTranslate()-r.minTranslate();l=0===d?0:(e-r.minTranslate())/d,l!==a&&r.updateProgress(e),r.emit("setTranslate",r.translate,t)}function minTranslate(){return-this.snapGrid[0]}function maxTranslate(){return-this.snapGrid[this.snapGrid.length-1]}function translateTo(e=0,t=this.params.speed,r=!0,n=!0,i){const o=this,{params:s,wrapperEl:a}=o;if(o.animating&&s.preventInteractionOnTransition)return!1;const c=o.minTranslate(),u=o.maxTranslate();let l;if(l=n&&e>c?c:n&&e<u?u:e,o.updateProgress(l),s.cssMode){const e=o.isHorizontal();if(0===t)a[e?"scrollLeft":"scrollTop"]=-l;else{if(!o.support.smoothScroll)return animateCSSModeScroll({swiper:o,targetPosition:-l,side:e?"left":"top"}),!0;a.scrollTo({[e?"left":"top"]:-l,behavior:"smooth"})}return!0}return 0===t?(o.setTransition(0),o.setTranslate(l),r&&(o.emit("beforeTransitionStart",t,i),o.emit("transitionEnd"))):(o.setTransition(t),o.setTranslate(l),r&&(o.emit("beforeTransitionStart",t,i),o.emit("transitionStart")),o.animating||(o.animating=!0,o.onTranslateToWrapperTransitionEnd||(o.onTranslateToWrapperTransitionEnd=function(e){o&&!o.destroyed&&e.target===this&&(o.$wrapperEl[0].removeEventListener("transitionend",o.onTranslateToWrapperTransitionEnd),o.$wrapperEl[0].removeEventListener("webkitTransitionEnd",o.onTranslateToWrapperTransitionEnd),o.onTranslateToWrapperTransitionEnd=null,delete o.onTranslateToWrapperTransitionEnd,r&&o.emit("transitionEnd"))}),o.$wrapperEl[0].addEventListener("transitionend",o.onTranslateToWrapperTransitionEnd),o.$wrapperEl[0].addEventListener("webkitTransitionEnd",o.onTranslateToWrapperTransitionEnd))),!0}var translate={getTranslate:getSwiperTranslate,setTranslate:setTranslate,minTranslate:minTranslate,maxTranslate:maxTranslate,translateTo:translateTo};function setTransition(e,t){const r=this;r.params.cssMode||r.$wrapperEl.transition(e),r.emit("setTransition",e,t)}function transitionEmit({swiper:e,runCallbacks:t,direction:r,step:n}){const{activeIndex:i,previousIndex:o}=e;let s=r;if(s||(s=i>o?"next":i<o?"prev":"reset"),e.emit(`transition${n}`),t&&i!==o){if("reset"===s)return void e.emit(`slideResetTransition${n}`);e.emit(`slideChangeTransition${n}`),"next"===s?e.emit(`slideNextTransition${n}`):e.emit(`slidePrevTransition${n}`)}}function transitionStart(e=!0,t){const r=this,{params:n}=r;n.cssMode||(n.autoHeight&&r.updateAutoHeight(),transitionEmit({swiper:r,runCallbacks:e,direction:t,step:"Start"}))}function transitionEnd(e=!0,t){const r=this,{params:n}=r;r.animating=!1,n.cssMode||(r.setTransition(0),transitionEmit({swiper:r,runCallbacks:e,direction:t,step:"End"}))}var transition={setTransition:setTransition,transitionStart:transitionStart,transitionEnd:transitionEnd};function slideTo(e=0,t=this.params.speed,r=!0,n,i){if("number"!=typeof e&&"string"!=typeof e)throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof e}] given.`);if("string"==typeof e){const t=parseInt(e,10);if(!isFinite(t))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${e}] given.`);e=t}const o=this;let s=e;s<0&&(s=0);const{params:a,snapGrid:c,slidesGrid:u,previousIndex:l,activeIndex:d,rtlTranslate:p,wrapperEl:m,enabled:f}=o;if(o.animating&&a.preventInteractionOnTransition||!f&&!n&&!i)return!1;const h=Math.min(o.params.slidesPerGroupSkip,s);let g=h+Math.floor((s-h)/o.params.slidesPerGroup);g>=c.length&&(g=c.length-1);const v=-c[g];if(a.normalizeSlideIndex)for(let e=0;e<u.length;e+=1){const t=-Math.floor(100*v),r=Math.floor(100*u[e]),n=Math.floor(100*u[e+1]);void 0!==u[e+1]?t>=r&&t<n-(n-r)/2?s=e:t>=r&&t<n&&(s=e+1):t>=r&&(s=e)}if(o.initialized&&s!==d){if(!o.allowSlideNext&&v<o.translate&&v<o.minTranslate())return!1;if(!o.allowSlidePrev&&v>o.translate&&v>o.maxTranslate()&&(d||0)!==s)return!1}let y;if(s!==(l||0)&&r&&o.emit("beforeSlideChangeStart"),o.updateProgress(v),y=s>d?"next":s<d?"prev":"reset",p&&-v===o.translate||!p&&v===o.translate)return o.updateActiveIndex(s),a.autoHeight&&o.updateAutoHeight(),o.updateSlidesClasses(),"slide"!==a.effect&&o.setTranslate(v),"reset"!==y&&(o.transitionStart(r,y),o.transitionEnd(r,y)),!1;if(a.cssMode){const e=o.isHorizontal(),r=p?v:-v;if(0===t){const t=o.virtual&&o.params.virtual.enabled;t&&(o.wrapperEl.style.scrollSnapType="none",o._immediateVirtual=!0),m[e?"scrollLeft":"scrollTop"]=r,t&&requestAnimationFrame((()=>{o.wrapperEl.style.scrollSnapType="",o._swiperImmediateVirtual=!1}))}else{if(!o.support.smoothScroll)return animateCSSModeScroll({swiper:o,targetPosition:r,side:e?"left":"top"}),!0;m.scrollTo({[e?"left":"top"]:r,behavior:"smooth"})}return!0}return o.setTransition(t),o.setTranslate(v),o.updateActiveIndex(s),o.updateSlidesClasses(),o.emit("beforeTransitionStart",t,n),o.transitionStart(r,y),0===t?o.transitionEnd(r,y):o.animating||(o.animating=!0,o.onSlideToWrapperTransitionEnd||(o.onSlideToWrapperTransitionEnd=function(e){o&&!o.destroyed&&e.target===this&&(o.$wrapperEl[0].removeEventListener("transitionend",o.onSlideToWrapperTransitionEnd),o.$wrapperEl[0].removeEventListener("webkitTransitionEnd",o.onSlideToWrapperTransitionEnd),o.onSlideToWrapperTransitionEnd=null,delete o.onSlideToWrapperTransitionEnd,o.transitionEnd(r,y))}),o.$wrapperEl[0].addEventListener("transitionend",o.onSlideToWrapperTransitionEnd),o.$wrapperEl[0].addEventListener("webkitTransitionEnd",o.onSlideToWrapperTransitionEnd)),!0}function slideToLoop(e=0,t=this.params.speed,r=!0,n){if("string"==typeof e){const t=parseInt(e,10);if(!isFinite(t))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${e}] given.`);e=t}const i=this;let o=e;return i.params.loop&&(o+=i.loopedSlides),i.slideTo(o,t,r,n)}function slideNext(e=this.params.speed,t=!0,r){const n=this,{animating:i,enabled:o,params:s}=n;if(!o)return n;let a=s.slidesPerGroup;"auto"===s.slidesPerView&&1===s.slidesPerGroup&&s.slidesPerGroupAuto&&(a=Math.max(n.slidesPerViewDynamic("current",!0),1));const c=n.activeIndex<s.slidesPerGroupSkip?1:a;if(s.loop){if(i&&s.loopPreventsSlide)return!1;n.loopFix(),n._clientLeft=n.$wrapperEl[0].clientLeft}return s.rewind&&n.isEnd?n.slideTo(0,e,t,r):n.slideTo(n.activeIndex+c,e,t,r)}function slidePrev(e=this.params.speed,t=!0,r){const n=this,{params:i,animating:o,snapGrid:s,slidesGrid:a,rtlTranslate:c,enabled:u}=n;if(!u)return n;if(i.loop){if(o&&i.loopPreventsSlide)return!1;n.loopFix(),n._clientLeft=n.$wrapperEl[0].clientLeft}function l(e){return e<0?-Math.floor(Math.abs(e)):Math.floor(e)}const d=l(c?n.translate:-n.translate),p=s.map((e=>l(e)));let m=s[p.indexOf(d)-1];if(void 0===m&&i.cssMode){let e;s.forEach(((t,r)=>{d>=t&&(e=r)})),void 0!==e&&(m=s[e>0?e-1:e])}let f=0;if(void 0!==m&&(f=a.indexOf(m),f<0&&(f=n.activeIndex-1),"auto"===i.slidesPerView&&1===i.slidesPerGroup&&i.slidesPerGroupAuto&&(f=f-n.slidesPerViewDynamic("previous",!0)+1,f=Math.max(f,0))),i.rewind&&n.isBeginning){const i=n.params.virtual&&n.params.virtual.enabled&&n.virtual?n.virtual.slides.length-1:n.slides.length-1;return n.slideTo(i,e,t,r)}return n.slideTo(f,e,t,r)}function slideReset(e=this.params.speed,t=!0,r){return this.slideTo(this.activeIndex,e,t,r)}function slideToClosest(e=this.params.speed,t=!0,r,n=.5){const i=this;let o=i.activeIndex;const s=Math.min(i.params.slidesPerGroupSkip,o),a=s+Math.floor((o-s)/i.params.slidesPerGroup),c=i.rtlTranslate?i.translate:-i.translate;if(c>=i.snapGrid[a]){const e=i.snapGrid[a];c-e>(i.snapGrid[a+1]-e)*n&&(o+=i.params.slidesPerGroup)}else{const e=i.snapGrid[a-1];c-e<=(i.snapGrid[a]-e)*n&&(o-=i.params.slidesPerGroup)}return o=Math.max(o,0),o=Math.min(o,i.slidesGrid.length-1),i.slideTo(o,e,t,r)}function slideToClickedSlide(){const e=this,{params:t,$wrapperEl:r}=e,n="auto"===t.slidesPerView?e.slidesPerViewDynamic():t.slidesPerView;let i,o=e.clickedIndex;if(t.loop){if(e.animating)return;i=parseInt($$1(e.clickedSlide).attr("data-swiper-slide-index"),10),t.centeredSlides?o<e.loopedSlides-n/2||o>e.slides.length-e.loopedSlides+n/2?(e.loopFix(),o=r.children(`.${t.slideClass}[data-swiper-slide-index="${i}"]:not(.${t.slideDuplicateClass})`).eq(0).index(),nextTick((()=>{e.slideTo(o)}))):e.slideTo(o):o>e.slides.length-n?(e.loopFix(),o=r.children(`.${t.slideClass}[data-swiper-slide-index="${i}"]:not(.${t.slideDuplicateClass})`).eq(0).index(),nextTick((()=>{e.slideTo(o)}))):e.slideTo(o)}else e.slideTo(o)}var slide={slideTo:slideTo,slideToLoop:slideToLoop,slideNext:slideNext,slidePrev:slidePrev,slideReset:slideReset,slideToClosest:slideToClosest,slideToClickedSlide:slideToClickedSlide};function loopCreate(){const e=this,t=getDocument(),{params:r,$wrapperEl:n}=e,i=n.children().length>0?$$1(n.children()[0].parentNode):n;i.children(`.${r.slideClass}.${r.slideDuplicateClass}`).remove();let o=i.children(`.${r.slideClass}`);if(r.loopFillGroupWithBlank){const e=r.slidesPerGroup-o.length%r.slidesPerGroup;if(e!==r.slidesPerGroup){for(let n=0;n<e;n+=1){const e=$$1(t.createElement("div")).addClass(`${r.slideClass} ${r.slideBlankClass}`);i.append(e)}o=i.children(`.${r.slideClass}`)}}"auto"!==r.slidesPerView||r.loopedSlides||(r.loopedSlides=o.length),e.loopedSlides=Math.ceil(parseFloat(r.loopedSlides||r.slidesPerView,10)),e.loopedSlides+=r.loopAdditionalSlides,e.loopedSlides>o.length&&e.params.loopedSlidesLimit&&(e.loopedSlides=o.length);const s=[],a=[];o.each(((e,t)=>{$$1(e).attr("data-swiper-slide-index",t)}));for(let t=0;t<e.loopedSlides;t+=1){const e=t-Math.floor(t/o.length)*o.length;a.push(o.eq(e)[0]),s.unshift(o.eq(o.length-e-1)[0])}for(let e=0;e<a.length;e+=1)i.append($$1(a[e].cloneNode(!0)).addClass(r.slideDuplicateClass));for(let e=s.length-1;e>=0;e-=1)i.prepend($$1(s[e].cloneNode(!0)).addClass(r.slideDuplicateClass))}function loopFix(){const e=this;e.emit("beforeLoopFix");const{activeIndex:t,slides:r,loopedSlides:n,allowSlidePrev:i,allowSlideNext:o,snapGrid:s,rtlTranslate:a}=e;let c;e.allowSlidePrev=!0,e.allowSlideNext=!0;const u=-s[t]-e.getTranslate();if(t<n){c=r.length-3*n+t,c+=n;e.slideTo(c,0,!1,!0)&&0!==u&&e.setTranslate((a?-e.translate:e.translate)-u)}else if(t>=r.length-n){c=-r.length+t+n,c+=n;e.slideTo(c,0,!1,!0)&&0!==u&&e.setTranslate((a?-e.translate:e.translate)-u)}e.allowSlidePrev=i,e.allowSlideNext=o,e.emit("loopFix")}function loopDestroy(){const{$wrapperEl:e,params:t,slides:r}=this;e.children(`.${t.slideClass}.${t.slideDuplicateClass},.${t.slideClass}.${t.slideBlankClass}`).remove(),r.removeAttr("data-swiper-slide-index")}var loop$1={loopCreate:loopCreate,loopFix:loopFix,loopDestroy:loopDestroy};function setGrabCursor(e){const t=this;if(t.support.touch||!t.params.simulateTouch||t.params.watchOverflow&&t.isLocked||t.params.cssMode)return;const r="container"===t.params.touchEventsTarget?t.el:t.wrapperEl;r.style.cursor="move",r.style.cursor=e?"grabbing":"grab"}function unsetGrabCursor(){const e=this;e.support.touch||e.params.watchOverflow&&e.isLocked||e.params.cssMode||(e["container"===e.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="")}var grabCursor={setGrabCursor:setGrabCursor,unsetGrabCursor:unsetGrabCursor};function closestElement(e,t=this){return function t(r){if(!r||r===getDocument()||r===getWindow())return null;r.assignedSlot&&(r=r.assignedSlot);const n=r.closest(e);return n||r.getRootNode?n||t(r.getRootNode().host):null}(t)}function onTouchStart(e){const t=this,r=getDocument(),n=getWindow(),i=t.touchEventsData,{params:o,touches:s,enabled:a}=t;if(!a)return;if(t.animating&&o.preventInteractionOnTransition)return;!t.animating&&o.cssMode&&o.loop&&t.loopFix();let c=e;c.originalEvent&&(c=c.originalEvent);let u=$$1(c.target);if("wrapper"===o.touchEventsTarget&&!u.closest(t.wrapperEl).length)return;if(i.isTouchEvent="touchstart"===c.type,!i.isTouchEvent&&"which"in c&&3===c.which)return;if(!i.isTouchEvent&&"button"in c&&c.button>0)return;if(i.isTouched&&i.isMoved)return;const l=!!o.noSwipingClass&&""!==o.noSwipingClass,d=e.composedPath?e.composedPath():e.path;l&&c.target&&c.target.shadowRoot&&d&&(u=$$1(d[0]));const p=o.noSwipingSelector?o.noSwipingSelector:`.${o.noSwipingClass}`,m=!(!c.target||!c.target.shadowRoot);if(o.noSwiping&&(m?closestElement(p,u[0]):u.closest(p)[0]))return void(t.allowClick=!0);if(o.swipeHandler&&!u.closest(o.swipeHandler)[0])return;s.currentX="touchstart"===c.type?c.targetTouches[0].pageX:c.pageX,s.currentY="touchstart"===c.type?c.targetTouches[0].pageY:c.pageY;const f=s.currentX,h=s.currentY,g=o.edgeSwipeDetection||o.iOSEdgeSwipeDetection,v=o.edgeSwipeThreshold||o.iOSEdgeSwipeThreshold;if(g&&(f<=v||f>=n.innerWidth-v)){if("prevent"!==g)return;e.preventDefault()}if(Object.assign(i,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),s.startX=f,s.startY=h,i.touchStartTime=now(),t.allowClick=!0,t.updateSize(),t.swipeDirection=void 0,o.threshold>0&&(i.allowThresholdMove=!1),"touchstart"!==c.type){let e=!0;u.is(i.focusableElements)&&(e=!1,"SELECT"===u[0].nodeName&&(i.isTouched=!1)),r.activeElement&&$$1(r.activeElement).is(i.focusableElements)&&r.activeElement!==u[0]&&r.activeElement.blur();const n=e&&t.allowTouchMove&&o.touchStartPreventDefault;!o.touchStartForcePreventDefault&&!n||u[0].isContentEditable||c.preventDefault()}t.params.freeMode&&t.params.freeMode.enabled&&t.freeMode&&t.animating&&!o.cssMode&&t.freeMode.onTouchStart(),t.emit("touchStart",c)}function onTouchMove(e){const t=getDocument(),r=this,n=r.touchEventsData,{params:i,touches:o,rtlTranslate:s,enabled:a}=r;if(!a)return;let c=e;if(c.originalEvent&&(c=c.originalEvent),!n.isTouched)return void(n.startMoving&&n.isScrolling&&r.emit("touchMoveOpposite",c));if(n.isTouchEvent&&"touchmove"!==c.type)return;const u="touchmove"===c.type&&c.targetTouches&&(c.targetTouches[0]||c.changedTouches[0]),l="touchmove"===c.type?u.pageX:c.pageX,d="touchmove"===c.type?u.pageY:c.pageY;if(c.preventedByNestedSwiper)return o.startX=l,void(o.startY=d);if(!r.allowTouchMove)return $$1(c.target).is(n.focusableElements)||(r.allowClick=!1),void(n.isTouched&&(Object.assign(o,{startX:l,startY:d,currentX:l,currentY:d}),n.touchStartTime=now()));if(n.isTouchEvent&&i.touchReleaseOnEdges&&!i.loop)if(r.isVertical()){if(d<o.startY&&r.translate<=r.maxTranslate()||d>o.startY&&r.translate>=r.minTranslate())return n.isTouched=!1,void(n.isMoved=!1)}else if(l<o.startX&&r.translate<=r.maxTranslate()||l>o.startX&&r.translate>=r.minTranslate())return;if(n.isTouchEvent&&t.activeElement&&c.target===t.activeElement&&$$1(c.target).is(n.focusableElements))return n.isMoved=!0,void(r.allowClick=!1);if(n.allowTouchCallbacks&&r.emit("touchMove",c),c.targetTouches&&c.targetTouches.length>1)return;o.currentX=l,o.currentY=d;const p=o.currentX-o.startX,m=o.currentY-o.startY;if(r.params.threshold&&Math.sqrt(p**2+m**2)<r.params.threshold)return;if(void 0===n.isScrolling){let e;r.isHorizontal()&&o.currentY===o.startY||r.isVertical()&&o.currentX===o.startX?n.isScrolling=!1:p*p+m*m>=25&&(e=180*Math.atan2(Math.abs(m),Math.abs(p))/Math.PI,n.isScrolling=r.isHorizontal()?e>i.touchAngle:90-e>i.touchAngle)}if(n.isScrolling&&r.emit("touchMoveOpposite",c),void 0===n.startMoving&&(o.currentX===o.startX&&o.currentY===o.startY||(n.startMoving=!0)),n.isScrolling)return void(n.isTouched=!1);if(!n.startMoving)return;r.allowClick=!1,!i.cssMode&&c.cancelable&&c.preventDefault(),i.touchMoveStopPropagation&&!i.nested&&c.stopPropagation(),n.isMoved||(i.loop&&!i.cssMode&&r.loopFix(),n.startTranslate=r.getTranslate(),r.setTransition(0),r.animating&&r.$wrapperEl.trigger("webkitTransitionEnd transitionend"),n.allowMomentumBounce=!1,!i.grabCursor||!0!==r.allowSlideNext&&!0!==r.allowSlidePrev||r.setGrabCursor(!0),r.emit("sliderFirstMove",c)),r.emit("sliderMove",c),n.isMoved=!0;let f=r.isHorizontal()?p:m;o.diff=f,f*=i.touchRatio,s&&(f=-f),r.swipeDirection=f>0?"prev":"next",n.currentTranslate=f+n.startTranslate;let h=!0,g=i.resistanceRatio;if(i.touchReleaseOnEdges&&(g=0),f>0&&n.currentTranslate>r.minTranslate()?(h=!1,i.resistance&&(n.currentTranslate=r.minTranslate()-1+(-r.minTranslate()+n.startTranslate+f)**g)):f<0&&n.currentTranslate<r.maxTranslate()&&(h=!1,i.resistance&&(n.currentTranslate=r.maxTranslate()+1-(r.maxTranslate()-n.startTranslate-f)**g)),h&&(c.preventedByNestedSwiper=!0),!r.allowSlideNext&&"next"===r.swipeDirection&&n.currentTranslate<n.startTranslate&&(n.currentTranslate=n.startTranslate),!r.allowSlidePrev&&"prev"===r.swipeDirection&&n.currentTranslate>n.startTranslate&&(n.currentTranslate=n.startTranslate),r.allowSlidePrev||r.allowSlideNext||(n.currentTranslate=n.startTranslate),i.threshold>0){if(!(Math.abs(f)>i.threshold||n.allowThresholdMove))return void(n.currentTranslate=n.startTranslate);if(!n.allowThresholdMove)return n.allowThresholdMove=!0,o.startX=o.currentX,o.startY=o.currentY,n.currentTranslate=n.startTranslate,void(o.diff=r.isHorizontal()?o.currentX-o.startX:o.currentY-o.startY)}i.followFinger&&!i.cssMode&&((i.freeMode&&i.freeMode.enabled&&r.freeMode||i.watchSlidesProgress)&&(r.updateActiveIndex(),r.updateSlidesClasses()),r.params.freeMode&&i.freeMode.enabled&&r.freeMode&&r.freeMode.onTouchMove(),r.updateProgress(n.currentTranslate),r.setTranslate(n.currentTranslate))}function onTouchEnd(e){const t=this,r=t.touchEventsData,{params:n,touches:i,rtlTranslate:o,slidesGrid:s,enabled:a}=t;if(!a)return;let c=e;if(c.originalEvent&&(c=c.originalEvent),r.allowTouchCallbacks&&t.emit("touchEnd",c),r.allowTouchCallbacks=!1,!r.isTouched)return r.isMoved&&n.grabCursor&&t.setGrabCursor(!1),r.isMoved=!1,void(r.startMoving=!1);n.grabCursor&&r.isMoved&&r.isTouched&&(!0===t.allowSlideNext||!0===t.allowSlidePrev)&&t.setGrabCursor(!1);const u=now(),l=u-r.touchStartTime;if(t.allowClick){const e=c.path||c.composedPath&&c.composedPath();t.updateClickedSlide(e&&e[0]||c.target),t.emit("tap click",c),l<300&&u-r.lastClickTime<300&&t.emit("doubleTap doubleClick",c)}if(r.lastClickTime=now(),nextTick((()=>{t.destroyed||(t.allowClick=!0)})),!r.isTouched||!r.isMoved||!t.swipeDirection||0===i.diff||r.currentTranslate===r.startTranslate)return r.isTouched=!1,r.isMoved=!1,void(r.startMoving=!1);let d;if(r.isTouched=!1,r.isMoved=!1,r.startMoving=!1,d=n.followFinger?o?t.translate:-t.translate:-r.currentTranslate,n.cssMode)return;if(t.params.freeMode&&n.freeMode.enabled)return void t.freeMode.onTouchEnd({currentPos:d});let p=0,m=t.slidesSizesGrid[0];for(let e=0;e<s.length;e+=e<n.slidesPerGroupSkip?1:n.slidesPerGroup){const t=e<n.slidesPerGroupSkip-1?1:n.slidesPerGroup;void 0!==s[e+t]?d>=s[e]&&d<s[e+t]&&(p=e,m=s[e+t]-s[e]):d>=s[e]&&(p=e,m=s[s.length-1]-s[s.length-2])}let f=null,h=null;n.rewind&&(t.isBeginning?h=t.params.virtual&&t.params.virtual.enabled&&t.virtual?t.virtual.slides.length-1:t.slides.length-1:t.isEnd&&(f=0));const g=(d-s[p])/m,v=p<n.slidesPerGroupSkip-1?1:n.slidesPerGroup;if(l>n.longSwipesMs){if(!n.longSwipes)return void t.slideTo(t.activeIndex);"next"===t.swipeDirection&&(g>=n.longSwipesRatio?t.slideTo(n.rewind&&t.isEnd?f:p+v):t.slideTo(p)),"prev"===t.swipeDirection&&(g>1-n.longSwipesRatio?t.slideTo(p+v):null!==h&&g<0&&Math.abs(g)>n.longSwipesRatio?t.slideTo(h):t.slideTo(p))}else{if(!n.shortSwipes)return void t.slideTo(t.activeIndex);t.navigation&&(c.target===t.navigation.nextEl||c.target===t.navigation.prevEl)?c.target===t.navigation.nextEl?t.slideTo(p+v):t.slideTo(p):("next"===t.swipeDirection&&t.slideTo(null!==f?f:p+v),"prev"===t.swipeDirection&&t.slideTo(null!==h?h:p))}}function onResize(){const e=this,{params:t,el:r}=e;if(r&&0===r.offsetWidth)return;t.breakpoints&&e.setBreakpoint();const{allowSlideNext:n,allowSlidePrev:i,snapGrid:o}=e;e.allowSlideNext=!0,e.allowSlidePrev=!0,e.updateSize(),e.updateSlides(),e.updateSlidesClasses(),("auto"===t.slidesPerView||t.slidesPerView>1)&&e.isEnd&&!e.isBeginning&&!e.params.centeredSlides?e.slideTo(e.slides.length-1,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0),e.autoplay&&e.autoplay.running&&e.autoplay.paused&&e.autoplay.run(),e.allowSlidePrev=i,e.allowSlideNext=n,e.params.watchOverflow&&o!==e.snapGrid&&e.checkOverflow()}function onClick(e){const t=this;t.enabled&&(t.allowClick||(t.params.preventClicks&&e.preventDefault(),t.params.preventClicksPropagation&&t.animating&&(e.stopPropagation(),e.stopImmediatePropagation())))}function onScroll(){const e=this,{wrapperEl:t,rtlTranslate:r,enabled:n}=e;if(!n)return;let i;e.previousTranslate=e.translate,e.isHorizontal()?e.translate=-t.scrollLeft:e.translate=-t.scrollTop,0===e.translate&&(e.translate=0),e.updateActiveIndex(),e.updateSlidesClasses();const o=e.maxTranslate()-e.minTranslate();i=0===o?0:(e.translate-e.minTranslate())/o,i!==e.progress&&e.updateProgress(r?-e.translate:e.translate),e.emit("setTranslate",e.translate,!1)}let dummyEventAttached=!1;function dummyEventListener(){}const events=(e,t)=>{const r=getDocument(),{params:n,touchEvents:i,el:o,wrapperEl:s,device:a,support:c}=e,u=!!n.nested,l="on"===t?"addEventListener":"removeEventListener",d=t;if(c.touch){const t=!("touchstart"!==i.start||!c.passiveListener||!n.passiveListeners)&&{passive:!0,capture:!1};o[l](i.start,e.onTouchStart,t),o[l](i.move,e.onTouchMove,c.passiveListener?{passive:!1,capture:u}:u),o[l](i.end,e.onTouchEnd,t),i.cancel&&o[l](i.cancel,e.onTouchEnd,t)}else o[l](i.start,e.onTouchStart,!1),r[l](i.move,e.onTouchMove,u),r[l](i.end,e.onTouchEnd,!1);(n.preventClicks||n.preventClicksPropagation)&&o[l]("click",e.onClick,!0),n.cssMode&&s[l]("scroll",e.onScroll),n.updateOnWindowResize?e[d](a.ios||a.android?"resize orientationchange observerUpdate":"resize observerUpdate",onResize,!0):e[d]("observerUpdate",onResize,!0)};function attachEvents(){const e=this,t=getDocument(),{params:r,support:n}=e;e.onTouchStart=onTouchStart.bind(e),e.onTouchMove=onTouchMove.bind(e),e.onTouchEnd=onTouchEnd.bind(e),r.cssMode&&(e.onScroll=onScroll.bind(e)),e.onClick=onClick.bind(e),n.touch&&!dummyEventAttached&&(t.addEventListener("touchstart",dummyEventListener),dummyEventAttached=!0),events(e,"on")}function detachEvents(){events(this,"off")}var events$1={attachEvents:attachEvents,detachEvents:detachEvents};const isGridEnabled=(e,t)=>e.grid&&t.grid&&t.grid.rows>1;function setBreakpoint(){const e=this,{activeIndex:t,initialized:r,loopedSlides:n=0,params:i,$el:o}=e,s=i.breakpoints;if(!s||s&&0===Object.keys(s).length)return;const a=e.getBreakpoint(s,e.params.breakpointsBase,e.el);if(!a||e.currentBreakpoint===a)return;const c=(a in s?s[a]:void 0)||e.originalParams,u=isGridEnabled(e,i),l=isGridEnabled(e,c),d=i.enabled;u&&!l?(o.removeClass(`${i.containerModifierClass}grid ${i.containerModifierClass}grid-column`),e.emitContainerClasses()):!u&&l&&(o.addClass(`${i.containerModifierClass}grid`),(c.grid.fill&&"column"===c.grid.fill||!c.grid.fill&&"column"===i.grid.fill)&&o.addClass(`${i.containerModifierClass}grid-column`),e.emitContainerClasses()),["navigation","pagination","scrollbar"].forEach((t=>{const r=i[t]&&i[t].enabled,n=c[t]&&c[t].enabled;r&&!n&&e[t].disable(),!r&&n&&e[t].enable()}));const p=c.direction&&c.direction!==i.direction,m=i.loop&&(c.slidesPerView!==i.slidesPerView||p);p&&r&&e.changeDirection(),extend$2(e.params,c);const f=e.params.enabled;Object.assign(e,{allowTouchMove:e.params.allowTouchMove,allowSlideNext:e.params.allowSlideNext,allowSlidePrev:e.params.allowSlidePrev}),d&&!f?e.disable():!d&&f&&e.enable(),e.currentBreakpoint=a,e.emit("_beforeBreakpoint",c),m&&r&&(e.loopDestroy(),e.loopCreate(),e.updateSlides(),e.slideTo(t-n+e.loopedSlides,0,!1)),e.emit("breakpoint",c)}function getBreakpoint(e,t="window",r){if(!e||"container"===t&&!r)return;let n=!1;const i=getWindow(),o="window"===t?i.innerHeight:r.clientHeight,s=Object.keys(e).map((e=>{if("string"==typeof e&&0===e.indexOf("@")){const t=parseFloat(e.substr(1));return{value:o*t,point:e}}return{value:e,point:e}}));s.sort(((e,t)=>parseInt(e.value,10)-parseInt(t.value,10)));for(let e=0;e<s.length;e+=1){const{point:o,value:a}=s[e];"window"===t?i.matchMedia(`(min-width: ${a}px)`).matches&&(n=o):a<=r.clientWidth&&(n=o)}return n||"max"}var breakpoints={setBreakpoint:setBreakpoint,getBreakpoint:getBreakpoint};function prepareClasses(e,t){const r=[];return e.forEach((e=>{"object"==typeof e?Object.keys(e).forEach((n=>{e[n]&&r.push(t+n)})):"string"==typeof e&&r.push(t+e)})),r}function addClasses(){const e=this,{classNames:t,params:r,rtl:n,$el:i,device:o,support:s}=e,a=prepareClasses(["initialized",r.direction,{"pointer-events":!s.touch},{"free-mode":e.params.freeMode&&r.freeMode.enabled},{autoheight:r.autoHeight},{rtl:n},{grid:r.grid&&r.grid.rows>1},{"grid-column":r.grid&&r.grid.rows>1&&"column"===r.grid.fill},{android:o.android},{ios:o.ios},{"css-mode":r.cssMode},{centered:r.cssMode&&r.centeredSlides},{"watch-progress":r.watchSlidesProgress}],r.containerModifierClass);t.push(...a),i.addClass([...t].join(" ")),e.emitContainerClasses()}function removeClasses(){const{$el:e,classNames:t}=this;e.removeClass(t.join(" ")),this.emitContainerClasses()}var classes={addClasses:addClasses,removeClasses:removeClasses};function loadImage(e,t,r,n,i,o){const s=getWindow();let a;function c(){o&&o()}$$1(e).parent("picture")[0]||e.complete&&i?c():t?(a=new s.Image,a.onload=c,a.onerror=c,n&&(a.sizes=n),r&&(a.srcset=r),t&&(a.src=t)):c()}function preloadImages(){const e=this;function t(){null!=e&&e&&!e.destroyed&&(void 0!==e.imagesLoaded&&(e.imagesLoaded+=1),e.imagesLoaded===e.imagesToLoad.length&&(e.params.updateOnImagesReady&&e.update(),e.emit("imagesReady")))}e.imagesToLoad=e.$el.find("img");for(let r=0;r<e.imagesToLoad.length;r+=1){const n=e.imagesToLoad[r];e.loadImage(n,n.currentSrc||n.getAttribute("src"),n.srcset||n.getAttribute("srcset"),n.sizes||n.getAttribute("sizes"),!0,t)}}var images={loadImage:loadImage,preloadImages:preloadImages};function checkOverflow(){const e=this,{isLocked:t,params:r}=e,{slidesOffsetBefore:n}=r;if(n){const t=e.slides.length-1,r=e.slidesGrid[t]+e.slidesSizesGrid[t]+2*n;e.isLocked=e.size>r}else e.isLocked=1===e.snapGrid.length;!0===r.allowSlideNext&&(e.allowSlideNext=!e.isLocked),!0===r.allowSlidePrev&&(e.allowSlidePrev=!e.isLocked),t&&t!==e.isLocked&&(e.isEnd=!1),t!==e.isLocked&&e.emit(e.isLocked?"lock":"unlock")}var checkOverflow$1={checkOverflow:checkOverflow},defaults$5={init:!0,direction:"horizontal",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopedSlidesLimit:!0,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1};function moduleExtendParams(e,t){return function(r={}){const n=Object.keys(r)[0],i=r[n];"object"==typeof i&&null!==i?(["navigation","pagination","scrollbar"].indexOf(n)>=0&&!0===e[n]&&(e[n]={auto:!0}),n in e&&"enabled"in i?(!0===e[n]&&(e[n]={enabled:!0}),"object"!=typeof e[n]||"enabled"in e[n]||(e[n].enabled=!0),e[n]||(e[n]={enabled:!1}),extend$2(t,r)):extend$2(t,r)):extend$2(t,r)}}const prototypes={eventsEmitter:eventsEmitter,update:update$1,translate:translate,transition:transition,slide:slide,loop:loop$1,grabCursor:grabCursor,events:events$1,breakpoints:breakpoints,checkOverflow:checkOverflow$1,classes:classes,images:images},extendedDefaults={};class Swiper$1{constructor(...e){let t,r;if(1===e.length&&e[0].constructor&&"Object"===Object.prototype.toString.call(e[0]).slice(8,-1)?r=e[0]:[t,r]=e,r||(r={}),r=extend$2({},r),t&&!r.el&&(r.el=t),r.el&&$$1(r.el).length>1){const e=[];return $$1(r.el).each((t=>{const n=extend$2({},r,{el:t});e.push(new Swiper$1(n))})),e}const n=this;n.__swiper__=!0,n.support=getSupport(),n.device=getDevice({userAgent:r.userAgent}),n.browser=getBrowser(),n.eventsListeners={},n.eventsAnyListeners=[],n.modules=[...n.__modules__],r.modules&&Array.isArray(r.modules)&&n.modules.push(...r.modules);const i={};n.modules.forEach((e=>{e({swiper:n,extendParams:moduleExtendParams(r,i),on:n.on.bind(n),once:n.once.bind(n),off:n.off.bind(n),emit:n.emit.bind(n)})}));const o=extend$2({},defaults$5,i);return n.params=extend$2({},o,extendedDefaults,r),n.originalParams=extend$2({},n.params),n.passedParams=extend$2({},r),n.params&&n.params.on&&Object.keys(n.params.on).forEach((e=>{n.on(e,n.params.on[e])})),n.params&&n.params.onAny&&n.onAny(n.params.onAny),n.$=$$1,Object.assign(n,{enabled:n.params.enabled,el:t,classNames:[],slides:$$1(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===n.params.direction,isVertical:()=>"vertical"===n.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:n.params.allowSlideNext,allowSlidePrev:n.params.allowSlidePrev,touchEvents:function(){const e=["touchstart","touchmove","touchend","touchcancel"],t=["pointerdown","pointermove","pointerup"];return n.touchEventsTouch={start:e[0],move:e[1],end:e[2],cancel:e[3]},n.touchEventsDesktop={start:t[0],move:t[1],end:t[2]},n.support.touch||!n.params.simulateTouch?n.touchEventsTouch:n.touchEventsDesktop}(),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:n.params.focusableElements,lastClickTime:now(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:n.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),n.emit("_swiper"),n.params.init&&n.init(),n}enable(){const e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){const e=this;e.enabled&&(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,t){const r=this;e=Math.min(Math.max(e,0),1);const n=r.minTranslate(),i=(r.maxTranslate()-n)*e+n;r.translateTo(i,void 0===t?0:t),r.updateActiveIndex(),r.updateSlidesClasses()}emitContainerClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const t=e.el.className.split(" ").filter((t=>0===t.indexOf("swiper")||0===t.indexOf(e.params.containerModifierClass)));e.emit("_containerClasses",t.join(" "))}getSlideClasses(e){const t=this;return t.destroyed?"":e.className.split(" ").filter((e=>0===e.indexOf("swiper-slide")||0===e.indexOf(t.params.slideClass))).join(" ")}emitSlidesClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const t=[];e.slides.each((r=>{const n=e.getSlideClasses(r);t.push({slideEl:r,classNames:n}),e.emit("_slideClass",r,n)})),e.emit("_slideClasses",t)}slidesPerViewDynamic(e="current",t=!1){const{params:r,slides:n,slidesGrid:i,slidesSizesGrid:o,size:s,activeIndex:a}=this;let c=1;if(r.centeredSlides){let e,t=n[a].swiperSlideSize;for(let r=a+1;r<n.length;r+=1)n[r]&&!e&&(t+=n[r].swiperSlideSize,c+=1,t>s&&(e=!0));for(let r=a-1;r>=0;r-=1)n[r]&&!e&&(t+=n[r].swiperSlideSize,c+=1,t>s&&(e=!0))}else if("current"===e)for(let e=a+1;e<n.length;e+=1){(t?i[e]+o[e]-i[a]<s:i[e]-i[a]<s)&&(c+=1)}else for(let e=a-1;e>=0;e-=1){i[a]-i[e]<s&&(c+=1)}return c}update(){const e=this;if(!e||e.destroyed)return;const{snapGrid:t,params:r}=e;function n(){const t=e.rtlTranslate?-1*e.translate:e.translate,r=Math.min(Math.max(t,e.maxTranslate()),e.minTranslate());e.setTranslate(r),e.updateActiveIndex(),e.updateSlidesClasses()}let i;r.breakpoints&&e.setBreakpoint(),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.params.freeMode&&e.params.freeMode.enabled?(n(),e.params.autoHeight&&e.updateAutoHeight()):(i=("auto"===e.params.slidesPerView||e.params.slidesPerView>1)&&e.isEnd&&!e.params.centeredSlides?e.slideTo(e.slides.length-1,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0),i||n()),r.watchOverflow&&t!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,t=!0){const r=this,n=r.params.direction;return e||(e="horizontal"===n?"vertical":"horizontal"),e===n||"horizontal"!==e&&"vertical"!==e||(r.$el.removeClass(`${r.params.containerModifierClass}${n}`).addClass(`${r.params.containerModifierClass}${e}`),r.emitContainerClasses(),r.params.direction=e,r.slides.each((t=>{"vertical"===e?t.style.width="":t.style.height=""})),r.emit("changeDirection"),t&&r.update()),r}changeLanguageDirection(e){const t=this;t.rtl&&"rtl"===e||!t.rtl&&"ltr"===e||(t.rtl="rtl"===e,t.rtlTranslate="horizontal"===t.params.direction&&t.rtl,t.rtl?(t.$el.addClass(`${t.params.containerModifierClass}rtl`),t.el.dir="rtl"):(t.$el.removeClass(`${t.params.containerModifierClass}rtl`),t.el.dir="ltr"),t.update())}mount(e){const t=this;if(t.mounted)return!0;const r=$$1(e||t.params.el);if(!(e=r[0]))return!1;e.swiper=t;const n=()=>`.${(t.params.wrapperClass||"").trim().split(" ").join(".")}`;let i=(()=>{if(e&&e.shadowRoot&&e.shadowRoot.querySelector){const t=$$1(e.shadowRoot.querySelector(n()));return t.children=e=>r.children(e),t}return r.children?r.children(n()):$$1(r).children(n())})();if(0===i.length&&t.params.createElements){const e=getDocument().createElement("div");i=$$1(e),e.className=t.params.wrapperClass,r.append(e),r.children(`.${t.params.slideClass}`).each((e=>{i.append(e)}))}return Object.assign(t,{$el:r,el:e,$wrapperEl:i,wrapperEl:i[0],mounted:!0,rtl:"rtl"===e.dir.toLowerCase()||"rtl"===r.css("direction"),rtlTranslate:"horizontal"===t.params.direction&&("rtl"===e.dir.toLowerCase()||"rtl"===r.css("direction")),wrongRTL:"-webkit-box"===i.css("display")}),!0}init(e){const t=this;if(t.initialized)return t;return!1===t.mount(e)||(t.emit("beforeInit"),t.params.breakpoints&&t.setBreakpoint(),t.addClasses(),t.params.loop&&t.loopCreate(),t.updateSize(),t.updateSlides(),t.params.watchOverflow&&t.checkOverflow(),t.params.grabCursor&&t.enabled&&t.setGrabCursor(),t.params.preloadImages&&t.preloadImages(),t.params.loop?t.slideTo(t.params.initialSlide+t.loopedSlides,0,t.params.runCallbacksOnInit,!1,!0):t.slideTo(t.params.initialSlide,0,t.params.runCallbacksOnInit,!1,!0),t.attachEvents(),t.initialized=!0,t.emit("init"),t.emit("afterInit")),t}destroy(e=!0,t=!0){const r=this,{params:n,$el:i,$wrapperEl:o,slides:s}=r;return void 0===r.params||r.destroyed||(r.emit("beforeDestroy"),r.initialized=!1,r.detachEvents(),n.loop&&r.loopDestroy(),t&&(r.removeClasses(),i.removeAttr("style"),o.removeAttr("style"),s&&s.length&&s.removeClass([n.slideVisibleClass,n.slideActiveClass,n.slideNextClass,n.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),r.emit("destroy"),Object.keys(r.eventsListeners).forEach((e=>{r.off(e)})),!1!==e&&(r.$el[0].swiper=null,deleteProps(r)),r.destroyed=!0),null}static extendDefaults(e){extend$2(extendedDefaults,e)}static get extendedDefaults(){return extendedDefaults}static get defaults(){return defaults$5}static installModule(e){Swiper$1.prototype.__modules__||(Swiper$1.prototype.__modules__=[]);const t=Swiper$1.prototype.__modules__;"function"==typeof e&&t.indexOf(e)<0&&t.push(e)}static use(e){return Array.isArray(e)?(e.forEach((e=>Swiper$1.installModule(e))),Swiper$1):(Swiper$1.installModule(e),Swiper$1)}}function createElementIfNotDefined(e,t,r,n){const i=getDocument();return e.params.createElements&&Object.keys(n).forEach((o=>{if(!r[o]&&!0===r.auto){let s=e.$el.children(`.${n[o]}`)[0];s||(s=i.createElement("div"),s.className=n[o],e.$el.append(s)),r[o]=s,t[o]=s}})),r}function classesToSelector(e=""){return`.${e.trim().replace(/([\.:!\/])/g,"\\$1").replace(/ /g,".")}`}function Pagination({swiper:e,extendParams:t,on:r,emit:n}){const i="swiper-pagination";let o;t({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:e=>e,formatFractionTotal:e=>e,bulletClass:`${i}-bullet`,bulletActiveClass:`${i}-bullet-active`,modifierClass:`${i}-`,currentClass:`${i}-current`,totalClass:`${i}-total`,hiddenClass:`${i}-hidden`,progressbarFillClass:`${i}-progressbar-fill`,progressbarOppositeClass:`${i}-progressbar-opposite`,clickableClass:`${i}-clickable`,lockClass:`${i}-lock`,horizontalClass:`${i}-horizontal`,verticalClass:`${i}-vertical`,paginationDisabledClass:`${i}-disabled`}}),e.pagination={el:null,$el:null,bullets:[]};let s=0;function a(){return!e.params.pagination.el||!e.pagination.el||!e.pagination.$el||0===e.pagination.$el.length}function c(t,r){const{bulletActiveClass:n}=e.params.pagination;t[r]().addClass(`${n}-${r}`)[r]().addClass(`${n}-${r}-${r}`)}function u(){const t=e.rtl,r=e.params.pagination;if(a())return;const i=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,u=e.pagination.$el;let l;const d=e.params.loop?Math.ceil((i-2*e.loopedSlides)/e.params.slidesPerGroup):e.snapGrid.length;if(e.params.loop?(l=Math.ceil((e.activeIndex-e.loopedSlides)/e.params.slidesPerGroup),l>i-1-2*e.loopedSlides&&(l-=i-2*e.loopedSlides),l>d-1&&(l-=d),l<0&&"bullets"!==e.params.paginationType&&(l=d+l)):l=void 0!==e.snapIndex?e.snapIndex:e.activeIndex||0,"bullets"===r.type&&e.pagination.bullets&&e.pagination.bullets.length>0){const n=e.pagination.bullets;let i,a,d;if(r.dynamicBullets&&(o=n.eq(0)[e.isHorizontal()?"outerWidth":"outerHeight"](!0),u.css(e.isHorizontal()?"width":"height",o*(r.dynamicMainBullets+4)+"px"),r.dynamicMainBullets>1&&void 0!==e.previousIndex&&(s+=l-(e.previousIndex-e.loopedSlides||0),s>r.dynamicMainBullets-1?s=r.dynamicMainBullets-1:s<0&&(s=0)),i=Math.max(l-s,0),a=i+(Math.min(n.length,r.dynamicMainBullets)-1),d=(a+i)/2),n.removeClass(["","-next","-next-next","-prev","-prev-prev","-main"].map((e=>`${r.bulletActiveClass}${e}`)).join(" ")),u.length>1)n.each((e=>{const t=$$1(e),n=t.index();n===l&&t.addClass(r.bulletActiveClass),r.dynamicBullets&&(n>=i&&n<=a&&t.addClass(`${r.bulletActiveClass}-main`),n===i&&c(t,"prev"),n===a&&c(t,"next"))}));else{const t=n.eq(l),o=t.index();if(t.addClass(r.bulletActiveClass),r.dynamicBullets){const t=n.eq(i),s=n.eq(a);for(let e=i;e<=a;e+=1)n.eq(e).addClass(`${r.bulletActiveClass}-main`);if(e.params.loop)if(o>=n.length){for(let e=r.dynamicMainBullets;e>=0;e-=1)n.eq(n.length-e).addClass(`${r.bulletActiveClass}-main`);n.eq(n.length-r.dynamicMainBullets-1).addClass(`${r.bulletActiveClass}-prev`)}else c(t,"prev"),c(s,"next");else c(t,"prev"),c(s,"next")}}if(r.dynamicBullets){const i=Math.min(n.length,r.dynamicMainBullets+4),s=(o*i-o)/2-d*o,a=t?"right":"left";n.css(e.isHorizontal()?a:"top",`${s}px`)}}if("fraction"===r.type&&(u.find(classesToSelector(r.currentClass)).text(r.formatFractionCurrent(l+1)),u.find(classesToSelector(r.totalClass)).text(r.formatFractionTotal(d))),"progressbar"===r.type){let t;t=r.progressbarOpposite?e.isHorizontal()?"vertical":"horizontal":e.isHorizontal()?"horizontal":"vertical";const n=(l+1)/d;let i=1,o=1;"horizontal"===t?i=n:o=n,u.find(classesToSelector(r.progressbarFillClass)).transform(`translate3d(0,0,0) scaleX(${i}) scaleY(${o})`).transition(e.params.speed)}"custom"===r.type&&r.renderCustom?(u.html(r.renderCustom(e,l+1,d)),n("paginationRender",u[0])):n("paginationUpdate",u[0]),e.params.watchOverflow&&e.enabled&&u[e.isLocked?"addClass":"removeClass"](r.lockClass)}function l(){const t=e.params.pagination;if(a())return;const r=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,i=e.pagination.$el;let o="";if("bullets"===t.type){let n=e.params.loop?Math.ceil((r-2*e.loopedSlides)/e.params.slidesPerGroup):e.snapGrid.length;e.params.freeMode&&e.params.freeMode.enabled&&!e.params.loop&&n>r&&(n=r);for(let r=0;r<n;r+=1)t.renderBullet?o+=t.renderBullet.call(e,r,t.bulletClass):o+=`<${t.bulletElement} class="${t.bulletClass}"></${t.bulletElement}>`;i.html(o),e.pagination.bullets=i.find(classesToSelector(t.bulletClass))}"fraction"===t.type&&(o=t.renderFraction?t.renderFraction.call(e,t.currentClass,t.totalClass):`<span class="${t.currentClass}"></span> / <span class="${t.totalClass}"></span>`,i.html(o)),"progressbar"===t.type&&(o=t.renderProgressbar?t.renderProgressbar.call(e,t.progressbarFillClass):`<span class="${t.progressbarFillClass}"></span>`,i.html(o)),"custom"!==t.type&&n("paginationRender",e.pagination.$el[0])}function d(){e.params.pagination=createElementIfNotDefined(e,e.originalParams.pagination,e.params.pagination,{el:"swiper-pagination"});const t=e.params.pagination;if(!t.el)return;let r=$$1(t.el);0!==r.length&&(e.params.uniqueNavElements&&"string"==typeof t.el&&r.length>1&&(r=e.$el.find(t.el),r.length>1&&(r=r.filter((t=>$$1(t).parents(".swiper")[0]===e.el)))),"bullets"===t.type&&t.clickable&&r.addClass(t.clickableClass),r.addClass(t.modifierClass+t.type),r.addClass(e.isHorizontal()?t.horizontalClass:t.verticalClass),"bullets"===t.type&&t.dynamicBullets&&(r.addClass(`${t.modifierClass}${t.type}-dynamic`),s=0,t.dynamicMainBullets<1&&(t.dynamicMainBullets=1)),"progressbar"===t.type&&t.progressbarOpposite&&r.addClass(t.progressbarOppositeClass),t.clickable&&r.on("click",classesToSelector(t.bulletClass),(function(t){t.preventDefault();let r=$$1(this).index()*e.params.slidesPerGroup;e.params.loop&&(r+=e.loopedSlides),e.slideTo(r)})),Object.assign(e.pagination,{$el:r,el:r[0]}),e.enabled||r.addClass(t.lockClass))}function p(){const t=e.params.pagination;if(a())return;const r=e.pagination.$el;r.removeClass(t.hiddenClass),r.removeClass(t.modifierClass+t.type),r.removeClass(e.isHorizontal()?t.horizontalClass:t.verticalClass),e.pagination.bullets&&e.pagination.bullets.removeClass&&e.pagination.bullets.removeClass(t.bulletActiveClass),t.clickable&&r.off("click",classesToSelector(t.bulletClass))}r("init",(()=>{!1===e.params.pagination.enabled?m():(d(),l(),u())})),r("activeIndexChange",(()=>{(e.params.loop||void 0===e.snapIndex)&&u()})),r("snapIndexChange",(()=>{e.params.loop||u()})),r("slidesLengthChange",(()=>{e.params.loop&&(l(),u())})),r("snapGridLengthChange",(()=>{e.params.loop||(l(),u())})),r("destroy",(()=>{p()})),r("enable disable",(()=>{const{$el:t}=e.pagination;t&&t[e.enabled?"removeClass":"addClass"](e.params.pagination.lockClass)})),r("lock unlock",(()=>{u()})),r("click",((t,r)=>{const i=r.target,{$el:o}=e.pagination;if(e.params.pagination.el&&e.params.pagination.hideOnClick&&o&&o.length>0&&!$$1(i).hasClass(e.params.pagination.bulletClass)){if(e.navigation&&(e.navigation.nextEl&&i===e.navigation.nextEl||e.navigation.prevEl&&i===e.navigation.prevEl))return;const t=o.hasClass(e.params.pagination.hiddenClass);n(!0===t?"paginationShow":"paginationHide"),o.toggleClass(e.params.pagination.hiddenClass)}}));const m=()=>{e.$el.addClass(e.params.pagination.paginationDisabledClass),e.pagination.$el&&e.pagination.$el.addClass(e.params.pagination.paginationDisabledClass),p()};Object.assign(e.pagination,{enable:()=>{e.$el.removeClass(e.params.pagination.paginationDisabledClass),e.pagination.$el&&e.pagination.$el.removeClass(e.params.pagination.paginationDisabledClass),d(),l(),u()},disable:m,render:l,update:u,init:d,destroy:p})}function isObject$5(e){return"object"==typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)}function extend$1(e,t){const r=["__proto__","constructor","prototype"];Object.keys(t).filter((e=>r.indexOf(e)<0)).forEach((r=>{void 0===e[r]?e[r]=t[r]:isObject$5(t[r])&&isObject$5(e[r])&&Object.keys(t[r]).length>0?t[r].__swiper__?e[r]=t[r]:extend$1(e[r],t[r]):e[r]=t[r]}))}function needsNavigation(e={}){return e.navigation&&void 0===e.navigation.nextEl&&void 0===e.navigation.prevEl}function needsPagination(e={}){return e.pagination&&void 0===e.pagination.el}function needsScrollbar(e={}){return e.scrollbar&&void 0===e.scrollbar.el}function uniqueClasses(e=""){const t=e.split(" ").map((e=>e.trim())).filter((e=>!!e)),r=[];return t.forEach((e=>{r.indexOf(e)<0&&r.push(e)})),r.join(" ")}Object.keys(prototypes).forEach((e=>{Object.keys(prototypes[e]).forEach((t=>{Swiper$1.prototype[t]=prototypes[e][t]}))})),Swiper$1.use([Resize,Observer]);const paramsList=["modules","init","_direction","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_preloadImages","updateOnImagesReady","_loop","_loopAdditionalSlides","_loopedSlides","_loopedSlidesLimit","_loopFillGroupWithBlank","loopPreventsSlide","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideBlankClass","slideActiveClass","slideDuplicateActiveClass","slideVisibleClass","slideDuplicateClass","slideNextClass","slideDuplicateNextClass","slidePrevClass","slideDuplicatePrevClass","wrapperClass","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","lazy","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom"];function getParams(e={},t=!0){const r={on:{}},n={},i={};extend$1(r,Swiper$1.defaults),extend$1(r,Swiper$1.extendedDefaults),r._emitClasses=!0,r.init=!1;const o={},s=paramsList.map((e=>e.replace(/_/,""))),a=Object.assign({},e);return Object.keys(a).forEach((a=>{void 0!==e[a]&&(s.indexOf(a)>=0?isObject$5(e[a])?(r[a]={},i[a]={},extend$1(r[a],e[a]),extend$1(i[a],e[a])):(r[a]=e[a],i[a]=e[a]):0===a.search(/on[A-Z]/)&&"function"==typeof e[a]?t?n[`${a[2].toLowerCase()}${a.substr(3)}`]=e[a]:r.on[`${a[2].toLowerCase()}${a.substr(3)}`]=e[a]:o[a]=e[a])})),["navigation","pagination","scrollbar"].forEach((e=>{!0===r[e]&&(r[e]={}),!1===r[e]&&delete r[e]})),{params:r,passedParams:i,rest:o,events:n}}function mountSwiper({el:e,nextEl:t,prevEl:r,paginationEl:n,scrollbarEl:i,swiper:o},s){needsNavigation(s)&&t&&r&&(o.params.navigation.nextEl=t,o.originalParams.navigation.nextEl=t,o.params.navigation.prevEl=r,o.originalParams.navigation.prevEl=r),needsPagination(s)&&n&&(o.params.pagination.el=n,o.originalParams.pagination.el=n),needsScrollbar(s)&&i&&(o.params.scrollbar.el=i,o.originalParams.scrollbar.el=i),o.init(e)}const calcLoopedSlides=(e,t)=>{let r=t.slidesPerView;if(t.breakpoints){const e=Swiper$1.prototype.getBreakpoint(t.breakpoints),n=e in t.breakpoints?t.breakpoints[e]:void 0;n&&n.slidesPerView&&(r=n.slidesPerView)}let n=Math.ceil(parseFloat(t.loopedSlides||r,10));return n+=t.loopAdditionalSlides,n>e.length&&t.loopedSlidesLimit&&(n=e.length),n};function renderLoop(e,t,r){const n=t.map(((t,r)=>React.cloneElement(t,{swiper:e,"data-swiper-slide-index":r})));function i(e,t,n){return React.cloneElement(e,{key:`${e.key}-duplicate-${t}-${n}`,className:`${e.props.className||""} ${r.slideDuplicateClass}`})}if(r.loopFillGroupWithBlank){const e=r.slidesPerGroup-n.length%r.slidesPerGroup;if(e!==r.slidesPerGroup)for(let t=0;t<e;t+=1){const e=React.createElement("div",{className:`${r.slideClass} ${r.slideBlankClass}`});n.push(e)}}"auto"!==r.slidesPerView||r.loopedSlides||(r.loopedSlides=n.length);const o=calcLoopedSlides(n,r),s=[],a=[];for(let e=0;e<o;e+=1){const t=e-Math.floor(e/n.length)*n.length;a.push(i(n[t],e,"append")),s.unshift(i(n[n.length-t-1],e,"prepend"))}return e&&(e.loopedSlides=o),[...s,...n,...a]}function getChangedParams(e,t,r,n,i){const o=[];if(!t)return o;const s=e=>{o.indexOf(e)<0&&o.push(e)};if(r&&n){const e=n.map(i),t=r.map(i);e.join("")!==t.join("")&&s("children"),n.length!==r.length&&s("children")}return paramsList.filter((e=>"_"===e[0])).map((e=>e.replace(/_/,""))).forEach((r=>{if(r in e&&r in t)if(isObject$5(e[r])&&isObject$5(t[r])){const n=Object.keys(e[r]),i=Object.keys(t[r]);n.length!==i.length?s(r):(n.forEach((n=>{e[r][n]!==t[r][n]&&s(r)})),i.forEach((n=>{e[r][n]!==t[r][n]&&s(r)})))}else e[r]!==t[r]&&s(r)})),o}function isChildSwiperSlide(e){return e.type&&e.type.displayName&&e.type.displayName.includes("SwiperSlide")}function processChildren(e){const t=[];return React.Children.toArray(e).forEach((e=>{isChildSwiperSlide(e)?t.push(e):e.props&&e.props.children&&processChildren(e.props.children).forEach((e=>t.push(e)))})),t}function getChildren(e){const t=[],r={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return React.Children.toArray(e).forEach((e=>{if(isChildSwiperSlide(e))t.push(e);else if(e.props&&e.props.slot&&r[e.props.slot])r[e.props.slot].push(e);else if(e.props&&e.props.children){const n=processChildren(e.props.children);n.length>0?n.forEach((e=>t.push(e))):r["container-end"].push(e)}else r["container-end"].push(e)})),{slides:t,slots:r}}function updateSwiper({swiper:e,slides:t,passedParams:r,changedParams:n,nextEl:i,prevEl:o,scrollbarEl:s,paginationEl:a}){const c=n.filter((e=>"children"!==e&&"direction"!==e)),{params:u,pagination:l,navigation:d,scrollbar:p,virtual:m,thumbs:f}=e;let h,g,v,y,b;n.includes("thumbs")&&r.thumbs&&r.thumbs.swiper&&u.thumbs&&!u.thumbs.swiper&&(h=!0),n.includes("controller")&&r.controller&&r.controller.control&&u.controller&&!u.controller.control&&(g=!0),n.includes("pagination")&&r.pagination&&(r.pagination.el||a)&&(u.pagination||!1===u.pagination)&&l&&!l.el&&(v=!0),n.includes("scrollbar")&&r.scrollbar&&(r.scrollbar.el||s)&&(u.scrollbar||!1===u.scrollbar)&&p&&!p.el&&(y=!0),n.includes("navigation")&&r.navigation&&(r.navigation.prevEl||o)&&(r.navigation.nextEl||i)&&(u.navigation||!1===u.navigation)&&d&&!d.prevEl&&!d.nextEl&&(b=!0);if(c.forEach((t=>{if(isObject$5(u[t])&&isObject$5(r[t]))extend$1(u[t],r[t]);else{const i=r[t];!0!==i&&!1!==i||"navigation"!==t&&"pagination"!==t&&"scrollbar"!==t?u[t]=r[t]:!1===i&&e[n=t]&&(e[n].destroy(),"navigation"===n?(u[n].prevEl=void 0,u[n].nextEl=void 0,e[n].prevEl=void 0,e[n].nextEl=void 0):(u[n].el=void 0,e[n].el=void 0))}var n})),c.includes("controller")&&!g&&e.controller&&e.controller.control&&u.controller&&u.controller.control&&(e.controller.control=u.controller.control),n.includes("children")&&t&&m&&u.virtual.enabled?(m.slides=t,m.update(!0)):n.includes("children")&&e.lazy&&e.params.lazy.enabled&&e.lazy.load(),h){f.init()&&f.update(!0)}g&&(e.controller.control=u.controller.control),v&&(a&&(u.pagination.el=a),l.init(),l.render(),l.update()),y&&(s&&(u.scrollbar.el=s),p.init(),p.updateSize(),p.setTranslate()),b&&(i&&(u.navigation.nextEl=i),o&&(u.navigation.prevEl=o),d.init(),d.update()),n.includes("allowSlideNext")&&(e.allowSlideNext=r.allowSlideNext),n.includes("allowSlidePrev")&&(e.allowSlidePrev=r.allowSlidePrev),n.includes("direction")&&e.changeDirection(r.direction,!1),e.update()}function renderVirtual(e,t,r){if(!r)return null;const n=e.isHorizontal()?{[e.rtlTranslate?"right":"left"]:`${r.offset}px`}:{top:`${r.offset}px`};return t.filter(((e,t)=>t>=r.from&&t<=r.to)).map((t=>React.cloneElement(t,{swiper:e,style:n})))}const updateOnVirtualData=e=>{!e||e.destroyed||!e.params.virtual||e.params.virtual&&!e.params.virtual.enabled||(e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.lazy&&e.params.lazy.enabled&&e.lazy.load(),e.parallax&&e.params.parallax&&e.params.parallax.enabled&&e.parallax.setTranslate())};function useIsomorphicLayoutEffect$3(e,t){return"undefined"==typeof window?react.exports.useEffect(e,t):react.exports.useLayoutEffect(e,t)}const SwiperSlideContext=react.exports.createContext(null),SwiperContext=react.exports.createContext(null);function _extends$4(){return _extends$4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends$4.apply(this,arguments)}const Swiper=react.exports.forwardRef((function(e,t){let{className:r,tag:n="div",wrapperTag:i="div",children:o,onSwiper:s,...a}=void 0===e?{}:e,c=!1;const[u,l]=react.exports.useState("swiper"),[d,p]=react.exports.useState(null),[m,f]=react.exports.useState(!1),h=react.exports.useRef(!1),g=react.exports.useRef(null),v=react.exports.useRef(null),y=react.exports.useRef(null),b=react.exports.useRef(null),S=react.exports.useRef(null),T=react.exports.useRef(null),_=react.exports.useRef(null),w=react.exports.useRef(null),{params:M,passedParams:x,rest:E,events:C}=getParams(a),{slides:R,slots:k}=getChildren(o),A=()=>{f(!m)};Object.assign(M.on,{_containerClasses(e,t){l(t)}});const I=()=>{if(Object.assign(M.on,C),c=!0,v.current=new Swiper$1(M),v.current.loopCreate=()=>{},v.current.loopDestroy=()=>{},M.loop&&(v.current.loopedSlides=calcLoopedSlides(R,M)),v.current.virtual&&v.current.params.virtual.enabled){v.current.virtual.slides=R;const e={cache:!1,slides:R,renderExternal:p,renderExternalUpdate:!1};extend$1(v.current.params.virtual,e),extend$1(v.current.originalParams.virtual,e)}};g.current||I(),v.current&&v.current.on("_beforeBreakpoint",A);return react.exports.useEffect((()=>()=>{v.current&&v.current.off("_beforeBreakpoint",A)})),react.exports.useEffect((()=>{!h.current&&v.current&&(v.current.emitSlidesClasses(),h.current=!0)})),useIsomorphicLayoutEffect$3((()=>{if(t&&(t.current=g.current),g.current)return v.current.destroyed&&I(),mountSwiper({el:g.current,nextEl:S.current,prevEl:T.current,paginationEl:_.current,scrollbarEl:w.current,swiper:v.current},M),s&&s(v.current),()=>{v.current&&!v.current.destroyed&&v.current.destroy(!0,!1)}}),[]),useIsomorphicLayoutEffect$3((()=>{!c&&C&&v.current&&Object.keys(C).forEach((e=>{v.current.on(e,C[e])}));const e=getChangedParams(x,y.current,R,b.current,(e=>e.key));return y.current=x,b.current=R,e.length&&v.current&&!v.current.destroyed&&updateSwiper({swiper:v.current,slides:R,passedParams:x,changedParams:e,nextEl:S.current,prevEl:T.current,scrollbarEl:w.current,paginationEl:_.current}),()=>{C&&v.current&&Object.keys(C).forEach((e=>{v.current.off(e,C[e])}))}})),useIsomorphicLayoutEffect$3((()=>{updateOnVirtualData(v.current)}),[d]),React.createElement(n,_extends$4({ref:g,className:uniqueClasses(`${u}${r?` ${r}`:""}`)},E),React.createElement(SwiperContext.Provider,{value:v.current},k["container-start"],React.createElement(i,{className:"swiper-wrapper"},k["wrapper-start"],M.virtual?renderVirtual(v.current,R,d):!M.loop||v.current&&v.current.destroyed?R.map((e=>React.cloneElement(e,{swiper:v.current}))):renderLoop(v.current,R,M),k["wrapper-end"]),needsNavigation(M)&&React.createElement(React.Fragment,null,React.createElement("div",{ref:T,className:"swiper-button-prev"}),React.createElement("div",{ref:S,className:"swiper-button-next"})),needsScrollbar(M)&&React.createElement("div",{ref:w,className:"swiper-scrollbar"}),needsPagination(M)&&React.createElement("div",{ref:_,className:"swiper-pagination"}),k["container-end"]))}));function _extends$3(){return _extends$3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends$3.apply(this,arguments)}Swiper.displayName="Swiper";const SwiperSlide=react.exports.forwardRef((function(e,t){let{tag:r="div",children:n,className:i="",swiper:o,zoom:s,virtualIndex:a,...c}=void 0===e?{}:e;const u=react.exports.useRef(null),[l,d]=react.exports.useState("swiper-slide");function p(e,t,r){t===u.current&&d(r)}useIsomorphicLayoutEffect$3((()=>{if(t&&(t.current=u.current),u.current&&o){if(!o.destroyed)return o.on("_slideClass",p),()=>{o&&o.off("_slideClass",p)};"swiper-slide"!==l&&d("swiper-slide")}})),useIsomorphicLayoutEffect$3((()=>{o&&u.current&&!o.destroyed&&d(o.getSlideClasses(u.current))}),[o]);const m={isActive:l.indexOf("swiper-slide-active")>=0||l.indexOf("swiper-slide-duplicate-active")>=0,isVisible:l.indexOf("swiper-slide-visible")>=0,isDuplicate:l.indexOf("swiper-slide-duplicate")>=0,isPrev:l.indexOf("swiper-slide-prev")>=0||l.indexOf("swiper-slide-duplicate-prev")>=0,isNext:l.indexOf("swiper-slide-next")>=0||l.indexOf("swiper-slide-duplicate-next")>=0},f=()=>"function"==typeof n?n(m):n;return React.createElement(r,_extends$3({ref:u,className:uniqueClasses(`${l}${i?` ${i}`:""}`),"data-swiper-slide-index":a},c),React.createElement(SwiperSlideContext.Provider,{value:m},s?React.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":"number"==typeof s?s:void 0},f()):f()))}));function styleInject(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}SwiperSlide.displayName="SwiperSlide";var css_248z$i=".meeting-canvas{overflow:hidden;position:relative}.meeting-canvas .meeting-canvas-swiper{background-color:#18181f}.meeting-canvas .meeting-canvas-swiper .swiper-pagination-bullet-active{background-color:#fff}.meeting-canvas .meeting-canvas-swiper .swiper-pagination-bullets.swiper-pagination-horizontal{background-color:hsla(0,0%,40%,.5);border-radius:8px;bottom:70px;left:50%;line-height:1;margin:auto;padding:1px 2px;transform:translateX(-50%);width:auto}.meeting-canvas .video-view-nickname{left:0;margin-top:0;right:0;top:50%;transform:translateY(-50%)}.meeting-canvas .video-view-nickname .icon-audio{left:-1px;position:relative;top:1px}.meeting-canvas .nickname-tip{align-items:center;background:rgba(0,0,0,.5);border-radius:2px;bottom:4px;display:flex;left:4px;max-width:100%;padding:3px 4px;position:absolute}.meeting-canvas .nickname-tip .nickname{color:#fff;font-size:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.meeting-canvas .nickname-tip .iconfont{font-size:10px;margin-right:2px}.meeting-canvas .video-view-wrap.full-screen-card{height:100%;width:100%}.meeting-canvas .video-view-wrap.full-screen-card .icon-audio{display:inline-block}.meeting-canvas .video-view-wrap.full-screen-card.local-member .icon-audio{display:none!important}.meeting-canvas .video-view-wrap{background-color:#292933;border:1px solid #000;box-sizing:border-box;color:#fff;overflow:hidden}.meeting-canvas .video-view-wrap .ios-time{color:transparent;position:absolute;z-index:-1}.meeting-canvas .video-view-wrap .icon-audio{display:none}.meeting-canvas .small-video-card{border:1px solid #fff;height:20%;overflow:hidden;position:absolute!important;right:15px;top:80px;width:20%;z-index:10}.meeting-canvas .meeting-canvas-swiper .nertc-screen-container,.meeting-canvas .meeting-canvas-swiper .nertc-video-container-local,.meeting-canvas .meeting-canvas-swiper .nertc-video-container-remote{height:100%!important;width:100%!important}.meeting-canvas .whiteboard-view,.meeting-canvas .whiteboard-wrap{height:100%;width:100%}.meeting-canvas .whiteboard-index{left:0;position:absolute;top:0;z-index:2}.meeting-canvas .active-border{border:2px solid #59f20c}";styleInject(css_248z$i);var css_248z$h='@font-face{font-family:swiper-icons;font-style:normal;font-weight:400;src:url("data:application/font-woff;charset=utf-8;base64, d09GRgABAAAAAAZgABAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAGRAAAABoAAAAci6qHkUdERUYAAAWgAAAAIwAAACQAYABXR1BPUwAABhQAAAAuAAAANuAY7+xHU1VCAAAFxAAAAFAAAABm2fPczU9TLzIAAAHcAAAASgAAAGBP9V5RY21hcAAAAkQAAACIAAABYt6F0cBjdnQgAAACzAAAAAQAAAAEABEBRGdhc3AAAAWYAAAACAAAAAj//wADZ2x5ZgAAAywAAADMAAAD2MHtryVoZWFkAAABbAAAADAAAAA2E2+eoWhoZWEAAAGcAAAAHwAAACQC9gDzaG10eAAAAigAAAAZAAAArgJkABFsb2NhAAAC0AAAAFoAAABaFQAUGG1heHAAAAG8AAAAHwAAACAAcABAbmFtZQAAA/gAAAE5AAACXvFdBwlwb3N0AAAFNAAAAGIAAACE5s74hXjaY2BkYGAAYpf5Hu/j+W2+MnAzMYDAzaX6QjD6/4//Bxj5GA8AuRwMYGkAPywL13jaY2BkYGA88P8Agx4j+/8fQDYfA1AEBWgDAIB2BOoAeNpjYGRgYNBh4GdgYgABEMnIABJzYNADCQAACWgAsQB42mNgYfzCOIGBlYGB0YcxjYGBwR1Kf2WQZGhhYGBiYGVmgAFGBiQQkOaawtDAoMBQxXjg/wEGPcYDDA4wNUA2CCgwsAAAO4EL6gAAeNpj2M0gyAACqxgGNWBkZ2D4/wMA+xkDdgAAAHjaY2BgYGaAYBkGRgYQiAHyGMF8FgYHIM3DwMHABGQrMOgyWDLEM1T9/w8UBfEMgLzE////P/5//f/V/xv+r4eaAAeMbAxwIUYmIMHEgKYAYjUcsDAwsLKxc3BycfPw8jEQA/gZBASFhEVExcQlJKWkZWTl5BUUlZRVVNXUNTQZBgMAAMR+E+gAEQFEAAAAKgAqACoANAA+AEgAUgBcAGYAcAB6AIQAjgCYAKIArAC2AMAAygDUAN4A6ADyAPwBBgEQARoBJAEuATgBQgFMAVYBYAFqAXQBfgGIAZIBnAGmAbIBzgHsAAB42u2NMQ6CUAyGW568x9AneYYgm4MJbhKFaExIOAVX8ApewSt4Bic4AfeAid3VOBixDxfPYEza5O+Xfi04YADggiUIULCuEJK8VhO4bSvpdnktHI5QCYtdi2sl8ZnXaHlqUrNKzdKcT8cjlq+rwZSvIVczNiezsfnP/uznmfPFBNODM2K7MTQ45YEAZqGP81AmGGcF3iPqOop0r1SPTaTbVkfUe4HXj97wYE+yNwWYxwWu4v1ugWHgo3S1XdZEVqWM7ET0cfnLGxWfkgR42o2PvWrDMBSFj/IHLaF0zKjRgdiVMwScNRAoWUoH78Y2icB/yIY09An6AH2Bdu/UB+yxopYshQiEvnvu0dURgDt8QeC8PDw7Fpji3fEA4z/PEJ6YOB5hKh4dj3EvXhxPqH/SKUY3rJ7srZ4FZnh1PMAtPhwP6fl2PMJMPDgeQ4rY8YT6Gzao0eAEA409DuggmTnFnOcSCiEiLMgxCiTI6Cq5DZUd3Qmp10vO0LaLTd2cjN4fOumlc7lUYbSQcZFkutRG7g6JKZKy0RmdLY680CDnEJ+UMkpFFe1RN7nxdVpXrC4aTtnaurOnYercZg2YVmLN/d/gczfEimrE/fs/bOuq29Zmn8tloORaXgZgGa78yO9/cnXm2BpaGvq25Dv9S4E9+5SIc9PqupJKhYFSSl47+Qcr1mYNAAAAeNptw0cKwkAAAMDZJA8Q7OUJvkLsPfZ6zFVERPy8qHh2YER+3i/BP83vIBLLySsoKimrqKqpa2hp6+jq6RsYGhmbmJqZSy0sraxtbO3sHRydnEMU4uR6yx7JJXveP7WrDycAAAAAAAH//wACeNpjYGRgYOABYhkgZgJCZgZNBkYGLQZtIJsFLMYAAAw3ALgAeNolizEKgDAQBCchRbC2sFER0YD6qVQiBCv/H9ezGI6Z5XBAw8CBK/m5iQQVauVbXLnOrMZv2oLdKFa8Pjuru2hJzGabmOSLzNMzvutpB3N42mNgZGBg4GKQYzBhYMxJLMlj4GBgAYow/P/PAJJhLM6sSoWKfWCAAwDAjgbRAAB42mNgYGBkAIIbCZo5IPrmUn0hGA0AO8EFTQAA")}:root{--swiper-theme-color:#007aff}.swiper{list-style:none;margin-left:auto;margin-right:auto;overflow:hidden;padding:0;position:relative;z-index:1}.swiper-vertical>.swiper-wrapper{flex-direction:column}.swiper-wrapper{box-sizing:content-box;display:flex;height:100%;position:relative;transition-property:transform;width:100%;z-index:1}.swiper-android .swiper-slide,.swiper-wrapper{transform:translateZ(0)}.swiper-pointer-events{touch-action:pan-y}.swiper-pointer-events.swiper-vertical{touch-action:pan-x}.swiper-slide{flex-shrink:0;height:100%;position:relative;transition-property:transform;width:100%}.swiper-slide-invisible-blank{visibility:hidden}.swiper-autoheight,.swiper-autoheight .swiper-slide{height:auto}.swiper-autoheight .swiper-wrapper{align-items:flex-start;transition-property:transform,height}.swiper-backface-hidden .swiper-slide{backface-visibility:hidden;transform:translateZ(0)}.swiper-3d,.swiper-3d.swiper-css-mode .swiper-wrapper{perspective:1200px}.swiper-3d .swiper-cube-shadow,.swiper-3d .swiper-slide,.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top,.swiper-3d .swiper-wrapper{transform-style:preserve-3d}.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top{height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%;z-index:10}.swiper-3d .swiper-slide-shadow{background:rgba(0,0,0,.15)}.swiper-3d .swiper-slide-shadow-left{background-image:linear-gradient(270deg,rgba(0,0,0,.5),transparent)}.swiper-3d .swiper-slide-shadow-right{background-image:linear-gradient(90deg,rgba(0,0,0,.5),transparent)}.swiper-3d .swiper-slide-shadow-top{background-image:linear-gradient(0deg,rgba(0,0,0,.5),transparent)}.swiper-3d .swiper-slide-shadow-bottom{background-image:linear-gradient(180deg,rgba(0,0,0,.5),transparent)}.swiper-css-mode>.swiper-wrapper{-ms-overflow-style:none;overflow:auto;scrollbar-width:none}.swiper-css-mode>.swiper-wrapper::-webkit-scrollbar{display:none}.swiper-css-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:start start}.swiper-horizontal.swiper-css-mode>.swiper-wrapper{scroll-snap-type:x mandatory}.swiper-vertical.swiper-css-mode>.swiper-wrapper{scroll-snap-type:y mandatory}.swiper-centered>.swiper-wrapper:before{content:"";flex-shrink:0;order:9999}.swiper-centered.swiper-horizontal>.swiper-wrapper>.swiper-slide:first-child{-webkit-margin-start:var(--swiper-centered-offset-before);margin-inline-start:var(--swiper-centered-offset-before)}.swiper-centered.swiper-horizontal>.swiper-wrapper:before{height:100%;min-height:1px;width:var(--swiper-centered-offset-after)}.swiper-centered.swiper-vertical>.swiper-wrapper>.swiper-slide:first-child{-webkit-margin-before:var(--swiper-centered-offset-before);margin-block-start:var(--swiper-centered-offset-before)}.swiper-centered.swiper-vertical>.swiper-wrapper:before{height:var(--swiper-centered-offset-after);min-width:1px;width:100%}.swiper-centered>.swiper-wrapper>.swiper-slide{scroll-snap-align:center center;scroll-snap-stop:always}';styleInject(css_248z$h);var css_248z$g=".swiper-pagination{position:absolute;text-align:center;transform:translateZ(0);transition:opacity .3s;z-index:10}.swiper-pagination.swiper-pagination-hidden{opacity:0}.swiper-pagination-disabled>.swiper-pagination,.swiper-pagination.swiper-pagination-disabled{display:none!important}.swiper-horizontal>.swiper-pagination-bullets,.swiper-pagination-bullets.swiper-pagination-horizontal,.swiper-pagination-custom,.swiper-pagination-fraction{bottom:10px;left:0;width:100%}.swiper-pagination-bullets-dynamic{font-size:0;overflow:hidden}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{position:relative;transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active,.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev{transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next{transform:scale(.33)}.swiper-pagination-bullet{background:var(--swiper-pagination-bullet-inactive-color,#000);border-radius:50%;display:inline-block;height:var(--swiper-pagination-bullet-height,var(--swiper-pagination-bullet-size,8px));opacity:var(--swiper-pagination-bullet-inactive-opacity,.2);width:var(--swiper-pagination-bullet-width,var(--swiper-pagination-bullet-size,8px))}button.swiper-pagination-bullet{-webkit-appearance:none;-moz-appearance:none;appearance:none;border:none;box-shadow:none;margin:0;padding:0}.swiper-pagination-clickable .swiper-pagination-bullet{cursor:pointer}.swiper-pagination-bullet:only-child{display:none!important}.swiper-pagination-bullet-active{background:var(--swiper-pagination-color,var(--swiper-theme-color));opacity:var(--swiper-pagination-bullet-opacity,1)}.swiper-pagination-vertical.swiper-pagination-bullets,.swiper-vertical>.swiper-pagination-bullets{right:10px;top:50%;transform:translate3d(0,-50%,0)}.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets .swiper-pagination-bullet{display:block;margin:var(--swiper-pagination-bullet-vertical-gap,6px) 0}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{top:50%;transform:translateY(-50%);width:8px}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{display:inline-block;transition:transform .2s,top .2s}.swiper-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet{margin:0 var(--swiper-pagination-bullet-horizontal-gap,4px)}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{left:50%;transform:translateX(-50%);white-space:nowrap}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:transform .2s,left .2s}.swiper-horizontal.swiper-rtl>.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:transform .2s,right .2s}.swiper-pagination-progressbar{background:rgba(0,0,0,.25);position:absolute}.swiper-pagination-progressbar .swiper-pagination-progressbar-fill{background:var(--swiper-pagination-color,var(--swiper-theme-color));height:100%;left:0;position:absolute;top:0;transform:scale(0);transform-origin:left top;width:100%}.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill{transform-origin:right top}.swiper-horizontal>.swiper-pagination-progressbar,.swiper-pagination-progressbar.swiper-pagination-horizontal,.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite,.swiper-vertical>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite{height:4px;left:0;top:0;width:100%}.swiper-horizontal>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-vertical,.swiper-vertical>.swiper-pagination-progressbar{height:100%;left:0;top:0;width:4px}.swiper-pagination-lock{display:none}",EventType,UserEventType,memberAction,hostAction,ActionType,BrowserType,NEClientType,NEMeetingRole,AttendeeOffType,Role,NEMeetingIdDisplayOptions,NEMeetingLeaveType;function createMeetingInfoFactory(){return{localMember:{uuid:"",isAudioOn:!1,isInChatroom:!1,isInRtcChannel:!1,isSharingScreen:!1,isVideoOn:!1,isSharingWhiteboard:!1,properties:{},clientType:NEClientType.WEB,role:Role.member,name:""},meetingNum:"",hostUuid:"",hostName:"",screenUuid:"",whiteboardUuid:"",focusUuid:"",activeSpeakerUuid:"",properties:{},subject:"",startTime:"",endTime:"",type:0,shortMeetingNum:"",remainingSeconds:0,myUuid:"",audioOff:AttendeeOffType.disable,videoOff:AttendeeOffType.disable,isLocked:!1}}styleInject(css_248z$g),function(e){e.MemberAudioMuteChanged="memberAudioMuteChanged",e.MemberJoinRoom="memberJoinRoom",e.MemberNameChanged="memberNameChanged",e.MemberJoinRtcChannel="memberJoinRtcChannel",e.MemberLeaveChatroom="memberLeaveChatroom",e.MemberLeaveRoom="memberLeaveRoom",e.MemberLeaveRtcChannel="memberLeaveRtcChannel",e.MemberRoleChanged="memberRoleChanged",e.MemberScreenShareStateChanged="memberScreenShareStateChanged",e.MemberVideoMuteChanged="memberVideoMuteChanged",e.MemberWhiteboardStateChanged="memberWhiteboardStateChanged",e.RoomPropertiesChanged="roomPropertiesChanged",e.RoomLockStateChanged="roomLockStateChanged",e.MemberPropertiesChanged="memberPropertiesChanged",e.MemberPropertiesDeleted="memberPropertiesDeleted",e.RoomPropertiesDeleted="roomPropertiesDeleted",e.RoomEnded="roomEnded",e.RtcActiveSpeakerChanged="rtcActiveSpeakerChanged",e.RtcChannelError="rtcChannelError",e.RoomConnectStateChanged="roomConnectStateChanged",e.CameraDeviceChanged="cameraDeviceChanged",e.PlayoutDeviceChanged="playoutDeviceChanged",e.RecordDeviceChanged="recordDeviceChanged",e.ReceiveChatroomMessages="receiveChatroomMessages",e.ReceivePassThroughMessage="receivePassThroughMessage",e.DeviceChange="deviceChange",e.NetworkError="networkError",e.ClientBanned="ClientBanned",e.AutoPlayNotAllowed="autoplayNotAllowed",e.NetworkReconnect="networkReconnect",e.NetworkReconnectSuccess="networkReconnectSuccess",e.roomRemainingSecondsRenewed="roomRemainingSecondsRenewed"}(EventType||(EventType={})),function(e){e.Login="login",e.Logout="logout",e.LoginWithPassword="loginWithPassword",e.CreateMeeting="createMeeting",e.JoinMeeting="joinMeeting",e.AnonymousJoinMeeting="anonymousJoinMeeting",e.SetLeaveCallback="setLeaveCallback"}(UserEventType||(UserEventType={})),function(e){e[e.muteAudio=51]="muteAudio",e[e.unmuteAudio=56]="unmuteAudio",e[e.muteVideo=50]="muteVideo",e[e.unmuteVideo=55]="unmuteVideo",e[e.muteScreen=52]="muteScreen",e[e.unmuteScreen=57]="unmuteScreen",e[e.handsUp=58]="handsUp",e[e.handsDown=59]="handsDown",e[e.openWhiteShare=60]="openWhiteShare",e[e.closeWhiteShare=61]="closeWhiteShare",e[e.shareWhiteShare=62]="shareWhiteShare",e[e.cancelShareWhiteShare=63]="cancelShareWhiteShare",e[e.modifyMeetingNickName=104]="modifyMeetingNickName"}(memberAction||(memberAction={})),function(e){e[e.remove=0]="remove",e[e.muteMemberVideo=10]="muteMemberVideo",e[e.muteMemberAudio=11]="muteMemberAudio",e[e.muteAllAudio=12]="muteAllAudio",e[e.lockMeeting=13]="lockMeeting",e[e.muteAllVideo=14]="muteAllVideo",e[e.unmuteMemberVideo=15]="unmuteMemberVideo",e[e.unmuteMemberAudio=16]="unmuteMemberAudio",e[e.unmuteAllAudio=17]="unmuteAllAudio",e[e.unlockMeeting=18]="unlockMeeting",e[e.unmuteAllVideo=19]="unmuteAllVideo",e[e.muteVideoAndAudio=20]="muteVideoAndAudio",e[e.unmuteVideoAndAudio=21]="unmuteVideoAndAudio",e[e.transferHost=22]="transferHost",e[e.setCoHost=23]="setCoHost",e[e.unSetCoHost=9999]="unSetCoHost",e[e.setFocus=30]="setFocus",e[e.unsetFocus=31]="unsetFocus",e[e.forceMuteAllAudio=40]="forceMuteAllAudio",e[e.rejectHandsUp=42]="rejectHandsUp",e[e.forceMuteAllVideo=43]="forceMuteAllVideo",e[e.closeScreenShare=53]="closeScreenShare",e[e.openWhiteShare=60]="openWhiteShare",e[e.closeWhiteShare=61]="closeWhiteShare"}(hostAction||(hostAction={})),function(e){e.UPDATE_GLOBAL_CONFIG="updateGlobalConfig",e.UPDATE_NAME="updateName",e.RESET_NAME="resetName",e.UPDATE_MEMBER="updateMember",e.ADD_MEMBER="addMember",e.REMOVE_MEMBER="removeMember",e.UPDATE_MEETING_INFO="updateMeetingInfo",e.SET_MEETING="setMeeting",e.RESET_MEETING="resetMeeting",e.JOIN_LOADING="joinLoading"}(ActionType||(ActionType={})),function(e){e.WX="WX",e.UC="UC",e.QQ="QQ",e.UNKNOWN="unknown",e.OTHER="other"}(BrowserType||(BrowserType={})),function(e){e.WEB="web",e.ANDROID="android",e.IOS="ios",e.PC="pc",e.MINIAPP="miniApp",e.MAC="mac",e.SIP="SIP",e.UNKNOWN="unknown"}(NEClientType||(NEClientType={})),function(e){e.participant="member",e.host="host",e.coHost="cohost",e.ghost="ghost"}(NEMeetingRole||(NEMeetingRole={})),function(e){e.offNotAllowSelfOn="offNotAllowSelfOn",e.offAllowSelfOn="offAllowSelfOn",e.disable="disable"}(AttendeeOffType||(AttendeeOffType={})),function(e){e.member="member",e.host="host",e.coHost="cohost"}(Role||(Role={})),function(e){e[e.displayAll=0]="displayAll",e[e.displayLongId=1]="displayLongId",e[e.displayShortId=2]="displayShortId"}(NEMeetingIdDisplayOptions||(NEMeetingIdDisplayOptions={})),function(e){e[e.leaveBySelf=0]="leaveBySelf",e[e.endBySelf=1]="endBySelf",e[e.leaveByHost=2]="leaveByHost",e[e.endByHost=3]="endByHost",e[e.networkError=4]="networkError"}(NEMeetingLeaveType||(NEMeetingLeaveType={}));const GlobalContext=React.createContext({}),globalReducer=(e,t)=>{switch(t.type){case ActionType.JOIN_LOADING:{const r=t.data;return Object.assign(Object.assign({},e),{joinLoading:r})}case ActionType.UPDATE_GLOBAL_CONFIG:const r=t.data;return Object.assign(Object.assign({},e),r);default:return Object.assign({},e)}},GlobalContextProvider=e=>{const[t,r]=react.exports.useReducer(globalReducer,{eventEmitter:e.eventEmitter,outEventEmitter:e.outEventEmitter,neMeeting:e.neMeeting,joinLoading:e.joinLoading,globalConfig:e.globalConfig,showMeetingRemainingTip:e.showMeetingRemainingTip});return jsxRuntime.exports.jsx(GlobalContext.Provider,Object.assign({value:Object.assign(Object.assign({},t),{dispatch:r})},{children:e.children}))},MeetingInfoContext=React.createContext({meetingInfo:createMeetingInfoFactory(),memberList:[]}),meetingInfoReducer=(e,t)=>{switch(t.type){case ActionType.UPDATE_MEMBER:{const r=t.data,n=e.meetingInfo;let{memberList:i}=e;const o=i.findIndex((e=>e.uuid===r.uuid));return o>-1&&(i[o]=Object.assign(Object.assign({},i[o]),r.member)),n.localMember.uuid===r.uuid&&(n.localMember=Object.assign(Object.assign({},n.localMember),r.member)),void 0!==r.member.role&&r.member.role===Role.host&&(n.hostUuid=r.uuid,n.hostName=i[o].name),void 0!==r.member.isSharingScreen&&1===Object.keys(r.member).length&&(n.screenUuid=r.member.isSharingScreen?i[o].uuid:""),i=sortMembers(i,n.localMember.uuid),Object.assign(Object.assign({},e),{memberList:i,meetingInfo:n})}case ActionType.ADD_MEMBER:{const{member:r}=t.data;let{memberList:n}=e;const i=e.meetingInfo,o=n.findIndex((e=>e.uuid===r.uuid));return o>-1?n[o]=r:n.push(r),n=sortMembers(n,i.localMember.uuid),Object.assign(Object.assign({},e),{memberList:n})}case ActionType.REMOVE_MEMBER:{const{uuids:r}=t.data,{memberList:n}=e;return r.forEach((e=>{const t=n.findIndex((t=>t.uuid===e));t>-1&&n.splice(t,1)})),Object.assign(Object.assign({},e),{memberList:n})}case ActionType.UPDATE_MEETING_INFO:{let{meetingInfo:r}=e;const n=t.data;return r=Object.assign(Object.assign({},r),n),Object.assign(Object.assign({},e),{meetingInfo:r})}case ActionType.SET_MEETING:{const r=t.data;let n=r.memberList;const{meetingInfo:i}=e;return n=sortMembers(n,i.localMember.uuid),r.memberList=n,Object.assign(Object.assign({},e),r)}case ActionType.RESET_MEETING:return{memberList:[],meetingInfo:createMeetingInfoFactory()};default:return Object.assign({},e)}},MeetingInfoContextProvider=e=>{const t=sortMembers(e.memberList,e.meetingInfo.localMember.uuid),[r,n]=react.exports.useReducer(meetingInfoReducer,{meetingInfo:e.meetingInfo,memberList:t});return jsxRuntime.exports.jsx(MeetingInfoContext.Provider,Object.assign({value:Object.assign(Object.assign({},r),{dispatch:n})},{children:e.children}))};function sortMembers(e,t){const r=[...e];return r.sort(((e,r)=>e.role!==Role.host&&r.role!==Role.host?e.role===Role.coHost&&r.role===Role.coHost||e.role!==Role.coHost&&r.role!==Role.coHost?e.uuid!==t&&r.uuid!==t?e.isHandsUp&&r.isHandsUp||!e.isHandsUp&&!r.isHandsUp?e.isSharingScreen&&r.isSharingScreen||!e.isSharingScreen&&!r.isSharingScreen?e.isSharingWhiteboard&&r.isSharingWhiteboard||!e.isSharingWhiteboard&&!r.isSharingWhiteboard?e.isVideoOn&&e.isAudioOn&&r.isAudioOn&&r.isVideoOn?0:e.isVideoOn&&r.isVideoOn||!e.isVideoOn&&!r.isVideoOn?e.isAudioOn&&r.isAudioOn||!e.isAudioOn&&!r.isAudioOn?0:e.isAudioOn>r.isAudioOn?-1:1:e.isVideoOn>r.isVideoOn?-1:1:!!e.isSharingWhiteboard>!!r.isSharingWhiteboard?-1:1:!!e.isSharingScreen>!!r.isSharingScreen?-1:1:!!e.isHandsUp>!!r.isHandsUp?-1:1:e.uuid===t?-1:1:e.role===Role.coHost?-1:1:e.role===Role.host?-1:1)),r}function useWatch(e,t,r={immediate:!1}){const{immediate:n}=r,i=react.exports.useRef(),o=react.exports.useRef(!1),s=react.exports.useRef(!1);react.exports.useEffect((()=>{const r=()=>t(i.current);o.current||(s.current?r():(s.current=!0,n&&r()),i.current=e)}),[e])}const VideoCard=e=>{const{member:t,className:r,onClick:n,isMySelf:i,isMain:o,showBorder:s,iosTime:a}=e,c=e.type||"video",u=!1!==e.isSubscribeVideo,{dispatch:l,meetingInfo:d}=react.exports.useContext(MeetingInfoContext),{neMeeting:p}=react.exports.useContext(GlobalContext),m=react.exports.useRef(null),f=react.exports.useRef(null),h=react.exports.useMemo((()=>o?0:1),[o]),g=()=>{var e,r;i||(u?(m.current&&(null===(e=null==p?void 0:p.rtcController)||void 0===e||e.setupRemoteVideoCanvas(m.current,t.uuid)),null===(r=null==p?void 0:p.rtcController)||void 0===r||r.subscribeRemoteVideoStream(t.uuid,h)):console.warn("非当前页不播放视频"))},v=()=>{var e,r;i||"screen"!==c||(m.current&&(null===(e=null==p?void 0:p.rtcController)||void 0===e||e.setupRemoteVideoSubStreamCanvas(m.current,t.uuid)),null===(r=null==p?void 0:p.rtcController)||void 0===r||r.subscribeRemoteVideoSubStream(t.uuid))};return react.exports.useEffect((()=>{var e,r,n;if(console.log("mounted",t,u,c),i){m.current&&(null===(e=null==p?void 0:p.rtcController)||void 0===e||e.setupLocalVideoCanvas(m.current)),t.isVideoOn&&(null===(r=null==p?void 0:p.rtcController)||void 0===r||r.playLocalStream("video"));const n=t.role===Role.host||t.role===Role.coHost;d.isUnMutedVideo&&(d.videoOff===AttendeeOffType.disable||n)&&(null==p||p.unmuteLocalVideo()),d.isUnMutedAudio&&(d.audioOff===AttendeeOffType.disable||n)&&(null==p||p.unmuteLocalAudio()),l&&l({type:ActionType.UPDATE_MEETING_INFO,data:{isUnMutedVideo:!1,isUnMutedAudio:!1}})}else"screen"===c?v():t.isVideoOn&&(u?g():null===(n=null==p?void 0:p.rtcController)||void 0===n||n.unsubscribeRemoteVideoStream(t.uuid,h));return()=>{f.current&&clearTimeout(f.current)}}),[]),useWatch(u,(e=>{e!==u&&"screen"!==c&&t.isVideoOn&&(u?f.current?(console.log("开始清除定时器"),clearTimeout(f.current),f.current=null):g():(console.log("开始取消订阅视频"),f.current=setTimeout((()=>{var e;null===(e=null==p?void 0:p.rtcController)||void 0===e||e.unsubscribeRemoteVideoStream(t.uuid,h),f.current=null}),1e4)))})),useWatch(t.isVideoOn,(e=>{var r,n,o;t.isVideoOn!==e&&"screen"!==c&&(t.isVideoOn?i?null===(r=null==p?void 0:p.rtcController)||void 0===r||r.playLocalStream("video"):u?g():null===(n=null==p?void 0:p.rtcController)||void 0===n||n.unsubscribeRemoteVideoStream(t.uuid,h):!i&&(null===(o=null==p?void 0:p.rtcController)||void 0===o||o.unsubscribeRemoteVideoStream(t.uuid,h)))})),useWatch(t.isSharingScreen,(e=>{var r,n;"screen"===c&&(i?t.isSharingScreen?null===(r=null==p?void 0:p.rtcController)||void 0===r||r.startScreenShare():null===(n=null==p?void 0:p.rtcController)||void 0===n||n.stopScreenShare():v())})),jsxRuntime.exports.jsxs("div",Object.assign({className:`video-view-wrap relative ${t.uuid}-${c}  ${s?"active-border":""} ${r||""}`,onClick:e=>function(e){null==n||n(e)}(e)},{children:[jsxRuntime.exports.jsx("div",Object.assign({ref:m,className:`video-view h-full w-full ${t.uuid}-${c}-${o}`,style:{display:"video"===c&&t.isVideoOn||"screen"===c&&t.isSharingScreen?"block":"none"}},{children:jsxRuntime.exports.jsx("span",Object.assign({className:"ios-time"},{children:a||""}))})),("video"===c&&!t.isVideoOn||"screen"===c&&!t.isSharingScreen)&&jsxRuntime.exports.jsxs("p",Object.assign({className:"video-view-nickname absolute"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"icon-audio"},{children:t.isAudioOn?jsxRuntime.exports.jsx("i",{className:"iconfont iconyx-tv-voice-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red iconfont iconyx-tv-voice-offx"})})),t.name]})),jsxRuntime.exports.jsx("div",Object.assign({className:"nickname-tip"},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"nickname"},{children:["screen"===c&&t.isSharingScreen?jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{}):t.isAudioOn?jsxRuntime.exports.jsx("i",{className:"iconfont iconyx-tv-voice-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red iconfont iconyx-tv-voice-offx"}),t.name]}))}))]}))};var VideoCard$1=React.memo(VideoCard);function groupMembersService(e){const{memberList:t,groupNum:r,focusUuid:n,screenUuid:i,myUuid:o,activeSpeakerUuid:s}=e,a=Array.isArray(t)?[...t]:[];if(1===a.length)return[a];let c=[];if(s&&sortMember2Top(a,s),i&&sortMember2Top(a,i,!0),a.length>=2){const e=a.find((e=>e.uuid===o));if(!i)if(n)sortMember2Top(a,o),sortMember2Top(a,n);else if(s){const t=a.shift();e&&sortMember2Top(a,e.uuid),a.unshift(t)}else{const e=a.shift();if(e&&e.uuid!==o)sortMember2Top(a,o),a.unshift(e);else{const t=a.shift();a.unshift(e),a.unshift(t)}}const t=a.shift(),u=a.shift(),l=Math.ceil(a.length/r);console.log("tmpMemberList",a,t,u);for(let e=0;e<l;e++)c.push(a.slice(e*r,(e+1)*r));c.unshift([t,u])}else c=[t];return c}function sortMember2Top(e,t,r=!1){const n=e.findIndex((e=>e.uuid===t));let i=null;if(n>=0){const[t]=e.splice(n,1);i=t,e.unshift(i),r&&e.unshift(i)}return i}const WhiteboardView=({className:e})=>{const t=react.exports.useRef(null);react.exports.useContext(MeetingInfoContext);const{neMeeting:r}=react.exports.useContext(GlobalContext);return react.exports.useEffect((()=>{var e;t.current&&(null===(e=null==r?void 0:r.whiteboardController)||void 0===e||e.setupWhiteboardCanvas(t.current).then((()=>{var e;null===(e=null==r?void 0:r.whiteboardController)||void 0===e||e.setEnableDraw(!1)})))}),[]),jsxRuntime.exports.jsx("div",Object.assign({className:`whiteboard-wrap ${e}`},{children:jsxRuntime.exports.jsx("div",{ref:t,className:"whiteboard-view"})}))};var WhiteboardView$1=React.memo(WhiteboardView),md5={};Object.defineProperty(md5,"__esModule",{value:!0});var Md5_1=md5.Md5=void 0,Md5=function(){function e(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendStr(e).end(t)},e.hashAsciiStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendAsciiStr(e).end(t)},e._hex=function(t){var r,n,i,o,s=e.hexChars,a=e.hexOut;for(o=0;o<4;o+=1)for(n=8*o,r=t[o],i=0;i<8;i+=2)a[n+1+i]=s.charAt(15&r),r>>>=4,a[n+0+i]=s.charAt(15&r),r>>>=4;return a.join("")},e._md5cycle=function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0},e.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this},e.prototype.appendStr=function(t){var r,n,i=this._buffer8,o=this._buffer32,s=this._bufferLength;for(n=0;n<t.length;n+=1){if((r=t.charCodeAt(n))<128)i[s++]=r;else if(r<2048)i[s++]=192+(r>>>6),i[s++]=63&r|128;else if(r<55296||r>56319)i[s++]=224+(r>>>12),i[s++]=r>>>6&63|128,i[s++]=63&r|128;else{if((r=1024*(r-55296)+(t.charCodeAt(++n)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");i[s++]=240+(r>>>18),i[s++]=r>>>12&63|128,i[s++]=r>>>6&63|128,i[s++]=63&r|128}s>=64&&(this._dataLength+=64,e._md5cycle(this._state,o),s-=64,o[0]=o[16])}return this._bufferLength=s,this},e.prototype.appendAsciiStr=function(t){for(var r,n=this._buffer8,i=this._buffer32,o=this._bufferLength,s=0;;){for(r=Math.min(t.length-s,64-o);r--;)n[o++]=t.charCodeAt(s++);if(o<64)break;this._dataLength+=64,e._md5cycle(this._state,i),o=0}return this._bufferLength=o,this},e.prototype.appendByteArray=function(t){for(var r,n=this._buffer8,i=this._buffer32,o=this._bufferLength,s=0;;){for(r=Math.min(t.length-s,64-o);r--;)n[o++]=t[s++];if(o<64)break;this._dataLength+=64,e._md5cycle(this._state,i),o=0}return this._bufferLength=o,this},e.prototype.getState=function(){var e=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}},e.prototype.setState=function(e){var t,r=e.buffer,n=e.state,i=this._state;for(this._dataLength=e.length,this._bufferLength=e.buflen,i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],t=0;t<r.length;t+=1)this._buffer8[t]=r.charCodeAt(t)},e.prototype.end=function(t){void 0===t&&(t=!1);var r=this._bufferLength,n=this._buffer8,i=this._buffer32,o=1+(r>>2);this._dataLength+=r;var s=8*this._dataLength;if(n[r]=128,n[r+1]=n[r+2]=n[r+3]=0,i.set(e.buffer32Identity.subarray(o),o),r>55&&(e._md5cycle(this._state,i),i.set(e.buffer32Identity)),s<=4294967295)i[14]=s;else{var a=s.toString(16).match(/(.*?)(.{0,8})$/);if(null===a)return;var c=parseInt(a[2],16),u=parseInt(a[1],16)||0;i[14]=c,i[15]=u}return e._md5cycle(this._state,i),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}();if(Md5_1=md5.Md5=Md5,"5d41402abc4b2a76b9719d911017c592"!==Md5.hashStr("hello"))throw new Error("Md5 self test failed.");let localStorage$1=window.localStorage;localStorage$1&&"function"==typeof localStorage$1.getItem&&"function"==typeof localStorage$1.setItem&&"function"==typeof localStorage$1.removeItem||(localStorage$1={privateObj:{},setItem:function(e,t){localStorage$1.privateObj[e]=t},getItem:function(e){return localStorage$1.privateObj[e]},removeItem:function(e){delete localStorage$1.privateObj[e]}});var dist={exports:{}};!function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=106)}([function(e,t,r){var n=r(3),i=r(27).f,o=r(74),s=r(9),a=r(12),c=r(14),u=r(13),l=function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,d,p,m,f,h,g,v,y=e.target,b=e.global,S=e.stat,T=e.proto,_=b?n:S?n[y]:(n[y]||{}).prototype,w=b?s:s[y]||(s[y]={}),M=w.prototype;for(p in t)r=!o(b?p:y+(S?".":"#")+p,e.forced)&&_&&u(_,p),f=w[p],r&&(h=e.noTargetGet?(v=i(_,p))&&v.value:_[p]),m=r&&h?h:t[p],r&&typeof f==typeof m||(g=e.bind&&r?a(m,n):e.wrap&&r?l(m):T&&"function"==typeof m?a(Function.call,m):m,(e.sham||m&&m.sham||f&&f.sham)&&c(g,"sham",!0),w[p]=g,T&&(u(s,d=y+"Prototype")||c(s,d,{}),s[d][p]=m,e.real&&M&&!M[p]&&c(M,p,m)))}},function(e,t,r){var n=r(10);e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){e.exports=!0},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,r(110))},function(e,t,r){var n=r(1),i=r(116),o=r(29),s=r(12),a=r(82),c=r(117),u=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,r){var l,d,p,m,f,h,g,v=r&&r.that,y=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_ITERATOR),S=!(!r||!r.INTERRUPTED),T=s(t,v,1+y+S),_=function(e){return l&&c(l),new u(!0,e)},w=function(e){return y?(n(e),S?T(e[0],e[1],_):T(e[0],e[1])):S?T(e,_):T(e)};if(b)l=e;else{if("function"!=typeof(d=a(e)))throw TypeError("Target is not iterable");if(i(d)){for(p=0,m=o(e.length);m>p;p++)if((f=w(e[p]))&&f instanceof u)return f;return new u(!1)}l=d.call(e)}for(h=l.next;!(g=h.call(l)).done;){try{f=w(g.value)}catch(e){throw c(l),e}if("object"==typeof f&&f&&f instanceof u)return f}return new u(!1)}},function(e,t,r){var n=r(9),i=r(13),o=r(68),s=r(15).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||s(t,e,{value:o.f(e)})}},function(e,t,r){var n=r(3),i=r(53),o=r(13),s=r(40),a=r(58),c=r(81),u=i("wks"),l=n.Symbol,d=c?l:l&&l.withoutSetter||s;e.exports=function(e){return o(u,e)&&(a||"string"==typeof u[e])||(a&&o(l,e)?u[e]=l[e]:u[e]=d("Symbol."+e)),u[e]}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t){e.exports={}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(7);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var n=r(8);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(19),i={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return i.call(n(e),t)}},function(e,t,r){var n=r(11),i=r(15),o=r(22);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(11),i=r(73),o=r(1),s=r(37),a=Object.defineProperty;t.f=n?a:function(e,t,r){if(o(e),t=s(t,!0),o(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(9),i=r(3),o=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?o(n[e])||o(i[e]):n[e]&&n[e][t]||i[e]&&i[e][t]}},function(e,t,r){var n=r(2),i=r(224);e.exports=n?i:function(e){return Map.prototype.entries.call(e)}},function(e,t,r){var n=r(72),i=r(36);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(36);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n,i,o,s=r(89),a=r(3),c=r(10),u=r(14),l=r(13),d=r(54),p=r(39),m=r(30),f=a.WeakMap;if(s||d.state){var h=d.state||(d.state=new f),g=h.get,v=h.has,y=h.set;n=function(e,t){if(v.call(h,e))throw new TypeError("Object already initialized");return t.facade=e,y.call(h,e,t),t},i=function(e){return g.call(h,e)||{}},o=function(e){return v.call(h,e)}}else{var b=p("state");m[b]=!0,n=function(e,t){if(l(e,b))throw new TypeError("Object already initialized");return t.facade=e,u(e,b,t),t},i=function(e){return l(e,b)?e[b]:{}},o=function(e){return l(e,b)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(9);e.exports=function(e){return n[e+"Prototype"]}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports={}},function(e,t,r){var n=r(59),i=r(15).f,o=r(14),s=r(13),a=r(119),c=r(6)("toStringTag");e.exports=function(e,t,r,u){if(e){var l=r?e:e.prototype;s(l,c)||i(l,c,{configurable:!0,value:t}),u&&!n&&o(l,"toString",a)}}},function(e,t,r){var n=r(12),i=r(72),o=r(19),s=r(29),a=r(63),c=[].push,u=function(e){var t=1==e,r=2==e,u=3==e,l=4==e,d=6==e,p=7==e,m=5==e||d;return function(f,h,g,v){for(var y,b,S=o(f),T=i(S),_=n(h,g,3),w=s(T.length),M=0,x=v||a,E=t?x(f,w):r||p?x(f,0):void 0;w>M;M++)if((m||M in T)&&(b=_(y=T[M],M,S),e))if(t)E[M]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return M;case 2:c.call(E,y)}else switch(e){case 4:return!1;case 7:c.call(E,y)}return d?-1:u||l?l:E}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterOut:u(7)}},function(e,t,r){e.exports=r(107)},function(e,t,r){var n=r(11),i=r(71),o=r(22),s=r(18),a=r(37),c=r(13),u=r(73),l=Object.getOwnPropertyDescriptor;t.f=n?l:function(e,t){if(e=s(e),t=a(t,!0),u)try{return l(e,t)}catch(e){}if(c(e,t))return o(!i.f.call(e,t),e[t])}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(42),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t){e.exports={}},function(e,t,r){var n=r(14);e.exports=function(e,t,r,i){i&&i.enumerable?e[t]=r:n(e,t,r)}},function(e,t,r){var n=r(1),i=r(8),o=r(6)("species");e.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[o])?t:i(r)}},function(e,t,r){var n=r(8),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},function(e,t,r){r(128);var n=r(129),i=r(3),o=r(45),s=r(14),a=r(23),c=r(6)("toStringTag");for(var u in n){var l=i[u],d=l&&l.prototype;d&&o(d)!==c&&s(d,c,u),a[u]=a.Array}},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,r){var n=r(10);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){e.exports=r(111)},function(e,t,r){var n=r(53),i=r(40),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+n).toString(36)}},function(e,t,r){var n,i=r(1),o=r(76),s=r(57),a=r(30),c=r(80),u=r(51),l=r(39)("IE_PROTO"),d=function(){},p=function(e){return"<script>"+e+"<\/script>"},m=function(){try{n=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;m=n?function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t}(n):((t=u("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F);for(var r=s.length;r--;)delete m.prototype[s[r]];return m()};a[l]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(d.prototype=i(e),r=new d,d.prototype=null,r[l]=e):r=m(),void 0===t?r:o(r,t)}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n,i,o=r(3),s=r(44),a=o.process,c=a&&a.versions,u=c&&c.v8;u?i=(n=u.split("."))[0]<4?1:n[0]+n[1]:s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(i=n[1]),e.exports=i&&+i},function(e,t,r){var n=r(16);e.exports=n("navigator","userAgent")||""},function(e,t,r){var n=r(59),i=r(28),o=r(6)("toStringTag"),s="Arguments"==i(function(){return arguments}());e.exports=n?i:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?r:s?i(t):"Object"==(n=i(t))&&"function"==typeof t.callee?"Arguments":n}},function(e,t){},function(e,t,r){var n=r(31);e.exports=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:n(e,i,t[i],r);return e}},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,r){var n=r(30),i=r(10),o=r(13),s=r(15).f,a=r(40),c=r(217),u=a("meta"),l=0,d=Object.isExtensible||function(){return!0},p=function(e){s(e,u,{value:{objectID:"O"+ ++l,weakData:{}}})},m=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,u)){if(!d(e))return"F";if(!t)return"E";p(e)}return e[u].objectID},getWeakData:function(e,t){if(!o(e,u)){if(!d(e))return!0;if(!t)return!1;p(e)}return e[u].weakData},onFreeze:function(e){return c&&m.REQUIRED&&d(e)&&!o(e,u)&&p(e),e}};n[u]=!0},function(e,t,r){var n=r(3),i=r(10),o=n.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},function(e,t,r){var n=r(13),i=r(19),o=r(39),s=r(114),a=o("IE_PROTO"),c=Object.prototype;e.exports=s?Object.getPrototypeOf:function(e){return e=i(e),n(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},function(e,t,r){var n=r(2),i=r(54);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.13.1",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(3),i=r(113),o=n["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,r){var n=r(1),i=r(115);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,o){return n(r),i(o),t?e.call(r,o):r.__proto__=o,r}}():void 0)},function(e,t,r){var n=r(77),i=r(57);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){var n=r(43),i=r(7);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(e,t,r){var n={};n[r(6)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){var n=r(28),i=r(3);e.exports="process"==n(i.process)},function(e,t,r){var n=r(126).charAt,i=r(20),o=r(62),s=i.set,a=i.getterFor("String Iterator");o(String,"String",(function(e){s(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=a(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(0),i=r(127),o=r(52),s=r(55),a=r(24),c=r(14),u=r(31),l=r(6),d=r(2),p=r(23),m=r(92),f=m.IteratorPrototype,h=m.BUGGY_SAFARI_ITERATORS,g=l("iterator"),v=function(){return this};e.exports=function(e,t,r,l,m,y,b){i(r,t,l);var S,T,_,w=function(e){if(e===m&&R)return R;if(!h&&e in E)return E[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},M=t+" Iterator",x=!1,E=e.prototype,C=E[g]||E["@@iterator"]||m&&E[m],R=!h&&C||w(m),k="Array"==t&&E.entries||C;if(k&&(S=o(k.call(new e)),f!==Object.prototype&&S.next&&(d||o(S)===f||(s?s(S,f):"function"!=typeof S[g]&&c(S,g,v)),a(S,M,!0,!0),d&&(p[M]=v))),"values"==m&&C&&"values"!==C.name&&(x=!0,R=function(){return C.call(this)}),d&&!b||E[g]===R||c(E,g,R),p[t]=R,m)if(T={values:w("values"),keys:y?R:w("keys"),entries:w("entries")},b)for(_ in T)(h||x||!(_ in E))&&u(E,_,T[_]);else n({target:t,proto:!0,forced:h||x},T);return T}},function(e,t,r){var n=r(10),i=r(64),o=r(6)("species");e.exports=function(e,t){var r;return i(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!i(r.prototype)?n(r)&&null===(r=r[o])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}},function(e,t,r){var n=r(28);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(37),i=r(15),o=r(22);e.exports=function(e,t,r){var s=n(t);s in e?i.f(e,s,o(0,r)):e[s]=r}},function(e,t,r){var n=r(7),i=r(6),o=r(43),s=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,r){var n=r(77),i=r(57).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(6);t.f=n},function(e,t,r){var n=r(7);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},function(e,t,r){var n=r(1);e.exports=function(e,t){var r,i=n(this),o=arguments.length>2?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof o)throw TypeError("At least one callback required");return i.has(e)?(r=i.get(e),"function"==typeof t&&(r=t(r),i.set(e,r))):"function"==typeof o&&(r=o(),i.set(e,r)),r}},function(e,t,r){var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!n.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},function(e,t,r){var n=r(7),i=r(28),o="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?o.call(e,""):Object(e)}:Object},function(e,t,r){var n=r(11),i=r(7),o=r(51);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(7),i=/#|\.prototype\./,o=function(e,t){var r=a[s(e)];return r==u||r!=c&&("function"==typeof t?n(t):!!t)},s=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},a=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";e.exports=o},function(e,t,r){var n=r(0),i=r(52),o=r(55),s=r(41),a=r(14),c=r(22),u=r(4),l=function(e,t){var r=this;if(!(r instanceof l))return new l(e,t);o&&(r=o(new Error(void 0),i(r))),void 0!==t&&a(r,"message",String(t));var n=[];return u(e,n.push,{that:n}),a(r,"errors",n),r};l.prototype=s(Error.prototype,{constructor:c(5,l),message:c(5,""),name:c(5,"AggregateError")}),n({global:!0},{AggregateError:l})},function(e,t,r){var n=r(11),i=r(15),o=r(1),s=r(56);e.exports=n?Object.defineProperties:function(e,t){o(e);for(var r,n=s(t),a=n.length,c=0;a>c;)i.f(e,r=n[c++],t[r]);return e}},function(e,t,r){var n=r(13),i=r(18),o=r(78).indexOf,s=r(30);e.exports=function(e,t){var r,a=i(e),c=0,u=[];for(r in a)!n(s,r)&&n(a,r)&&u.push(r);for(;t.length>c;)n(a,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){var n=r(18),i=r(29),o=r(79),s=function(e){return function(t,r,s){var a,c=n(t),u=i(c.length),l=o(s,u);if(e&&r!=r){for(;u>l;)if((a=c[l++])!=a)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},function(e,t,r){var n=r(42),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},function(e,t,r){var n=r(16);e.exports=n("document","documentElement")},function(e,t,r){var n=r(58);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n=r(45),i=r(23),o=r(6)("iterator");e.exports=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[n(e)]}},function(e,t,r){var n=r(3);e.exports=n.Promise},function(e,t,r){var n=r(16),i=r(15),o=r(6),s=r(11),a=o("species");e.exports=function(e){var t=n(e),r=i.f;s&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(54),i=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return i.call(e)}),e.exports=n.inspectSource},function(e,t,r){var n,i,o,s=r(3),a=r(7),c=r(12),u=r(80),l=r(51),d=r(87),p=r(60),m=s.location,f=s.setImmediate,h=s.clearImmediate,g=s.process,v=s.MessageChannel,y=s.Dispatch,b=0,S={},T=function(e){if(S.hasOwnProperty(e)){var t=S[e];delete S[e],t()}},_=function(e){return function(){T(e)}},w=function(e){T(e.data)},M=function(e){s.postMessage(e+"",m.protocol+"//"+m.host)};f&&h||(f=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return S[++b]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},n(b),b},h=function(e){delete S[e]},p?n=function(e){g.nextTick(_(e))}:y&&y.now?n=function(e){y.now(_(e))}:v&&!d?(o=(i=new v).port2,i.port1.onmessage=w,n=c(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts&&m&&"file:"!==m.protocol&&!a(M)?(n=M,s.addEventListener("message",w,!1)):n="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),T(e)}}:function(e){setTimeout(_(e),0)}),e.exports={set:f,clear:h}},function(e,t,r){var n=r(44);e.exports=/(?:iphone|ipod|ipad).*applewebkit/i.test(n)},function(e,t,r){var n=r(1),i=r(10),o=r(33);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(3),i=r(85),o=n.WeakMap;e.exports="function"==typeof o&&/native code/.test(i(o))},function(e,t,r){var n=r(0),i=r(8),o=r(33),s=r(49),a=r(4);n({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=o.f(t),n=r.resolve,c=r.reject,u=s((function(){var r=i(t.resolve),o=[],s=0,c=1;a(e,(function(e){var i=s++,a=!1;o.push(void 0),c++,r.call(t,e).then((function(e){a||(a=!0,o[i]={status:"fulfilled",value:e},--c||n(o))}),(function(e){a||(a=!0,o[i]={status:"rejected",reason:e},--c||n(o))}))})),--c||n(o)}));return u.error&&c(u.value),r.promise}})},function(e,t,r){var n=r(0),i=r(8),o=r(16),s=r(33),a=r(49),c=r(4);n({target:"Promise",stat:!0},{any:function(e){var t=this,r=s.f(t),n=r.resolve,u=r.reject,l=a((function(){var r=i(t.resolve),s=[],a=0,l=1,d=!1;c(e,(function(e){var i=a++,c=!1;s.push(void 0),l++,r.call(t,e).then((function(e){c||d||(d=!0,n(e))}),(function(e){c||d||(c=!0,s[i]=e,--l||u(new(o("AggregateError"))(s,"No one promise resolved")))}))})),--l||u(new(o("AggregateError"))(s,"No one promise resolved"))}));return l.error&&u(l.value),r.promise}})},function(e,t,r){var n,i,o,s=r(7),a=r(52),c=r(14),u=r(13),l=r(6),d=r(2),p=l("iterator"),m=!1;[].keys&&("next"in(o=[].keys())?(i=a(a(o)))!==Object.prototype&&(n=i):m=!0);var f=null==n||s((function(){var e={};return n[p].call(e)!==e}));f&&(n={}),d&&!f||u(n,p)||c(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:m}},function(e,t){e.exports=function(){}},function(e,t,r){var n=r(0),i=r(7),o=r(64),s=r(10),a=r(19),c=r(29),u=r(65),l=r(63),d=r(66),p=r(6),m=r(43),f=p("isConcatSpreadable"),h=m>=51||!i((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),g=d("concat"),v=function(e){if(!s(e))return!1;var t=e[f];return void 0!==t?!!t:o(e)};n({target:"Array",proto:!0,forced:!h||!g},{concat:function(e){var t,r,n,i,o,s=a(this),d=l(s,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(v(o=-1===t?s:arguments[t])){if(p+(i=c(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<i;r++,p++)r in o&&u(d,p,o[r])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(d,p++,o)}return d.length=p,d}})},function(e,t,r){var n=r(0),i=r(3),o=r(16),s=r(2),a=r(11),c=r(58),u=r(81),l=r(7),d=r(13),p=r(64),m=r(10),f=r(1),h=r(19),g=r(18),v=r(37),y=r(22),b=r(41),S=r(56),T=r(67),_=r(147),w=r(96),M=r(27),x=r(15),E=r(71),C=r(14),R=r(31),k=r(53),A=r(39),I=r(30),O=r(40),P=r(6),N=r(68),D=r(5),L=r(24),j=r(20),U=r(25).forEach,F=A("hidden"),$=P("toPrimitive"),B=j.set,V=j.getterFor("Symbol"),H=Object.prototype,W=i.Symbol,q=o("JSON","stringify"),z=M.f,G=x.f,J=_.f,K=E.f,Q=k("symbols"),Y=k("op-symbols"),X=k("string-to-symbol-registry"),Z=k("symbol-to-string-registry"),ee=k("wks"),te=i.QObject,re=!te||!te.prototype||!te.prototype.findChild,ne=a&&l((function(){return 7!=b(G({},"a",{get:function(){return G(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=z(H,t);n&&delete H[t],G(e,t,r),n&&e!==H&&G(H,t,n)}:G,ie=function(e,t){var r=Q[e]=b(W.prototype);return B(r,{type:"Symbol",tag:e,description:t}),a||(r.description=t),r},oe=u?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof W},se=function(e,t,r){e===H&&se(Y,t,r),f(e);var n=v(t,!0);return f(r),d(Q,n)?(r.enumerable?(d(e,F)&&e[F][n]&&(e[F][n]=!1),r=b(r,{enumerable:y(0,!1)})):(d(e,F)||G(e,F,y(1,{})),e[F][n]=!0),ne(e,n,r)):G(e,n,r)},ae=function(e,t){f(e);var r=g(t),n=S(r).concat(de(r));return U(n,(function(t){a&&!ce.call(r,t)||se(e,t,r[t])})),e},ce=function(e){var t=v(e,!0),r=K.call(this,t);return!(this===H&&d(Q,t)&&!d(Y,t))&&(!(r||!d(this,t)||!d(Q,t)||d(this,F)&&this[F][t])||r)},ue=function(e,t){var r=g(e),n=v(t,!0);if(r!==H||!d(Q,n)||d(Y,n)){var i=z(r,n);return!i||!d(Q,n)||d(r,F)&&r[F][n]||(i.enumerable=!0),i}},le=function(e){var t=J(g(e)),r=[];return U(t,(function(e){d(Q,e)||d(I,e)||r.push(e)})),r},de=function(e){var t=e===H,r=J(t?Y:g(e)),n=[];return U(r,(function(e){!d(Q,e)||t&&!d(H,e)||n.push(Q[e])})),n};c||(R((W=function(){if(this instanceof W)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=O(e),r=function(e){this===H&&r.call(Y,e),d(this,F)&&d(this[F],t)&&(this[F][t]=!1),ne(this,t,y(1,e))};return a&&re&&ne(H,t,{configurable:!0,set:r}),ie(t,e)}).prototype,"toString",(function(){return V(this).tag})),R(W,"withoutSetter",(function(e){return ie(O(e),e)})),E.f=ce,x.f=se,M.f=ue,T.f=_.f=le,w.f=de,N.f=function(e){return ie(P(e),e)},a&&(G(W.prototype,"description",{configurable:!0,get:function(){return V(this).description}}),s||R(H,"propertyIsEnumerable",ce,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:W}),U(S(ee),(function(e){D(e)})),n({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=String(e);if(d(X,t))return X[t];var r=W(t);return X[t]=r,Z[r]=t,r},keyFor:function(e){if(!oe(e))throw TypeError(e+" is not a symbol");if(d(Z,e))return Z[e]},useSetter:function(){re=!0},useSimple:function(){re=!1}}),n({target:"Object",stat:!0,forced:!c,sham:!a},{create:function(e,t){return void 0===t?b(e):ae(b(e),t)},defineProperty:se,defineProperties:ae,getOwnPropertyDescriptor:ue}),n({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:le,getOwnPropertySymbols:de}),n({target:"Object",stat:!0,forced:l((function(){w.f(1)}))},{getOwnPropertySymbols:function(e){return w.f(h(e))}}),q&&n({target:"JSON",stat:!0,forced:!c||l((function(){var e=W();return"[null]"!=q([e])||"{}"!=q({a:e})||"{}"!=q(Object(e))}))},{stringify:function(e,t,r){for(var n,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(n=t,(m(t)||void 0!==e)&&!oe(e))return p(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!oe(t))return t}),i[1]=t,q.apply(null,i)}}),W.prototype[$]||C(W.prototype,$,W.prototype.valueOf),L(W,"Symbol"),I[F]=!0},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){r(5)("iterator")},function(e,t,r){e.exports=r(174)},function(e,t,r){e.exports=r(182)},function(e,t,r){var n=r(0),i=r(3),o=r(50),s=r(7),a=r(14),c=r(4),u=r(48),l=r(10),d=r(24),p=r(15).f,m=r(25).forEach,f=r(11),h=r(20),g=h.set,v=h.getterFor;e.exports=function(e,t,r){var h,y=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),S=y?"set":"add",T=i[e],_=T&&T.prototype,w={};if(f&&"function"==typeof T&&(b||_.forEach&&!s((function(){(new T).entries().next()})))){h=t((function(t,r){g(u(t,h,e),{type:e,collection:new T}),null!=r&&c(r,t[S],{that:t,AS_ENTRIES:y})}));var M=v(e);m(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in _)||b&&"clear"==e||a(h.prototype,e,(function(r,n){var i=M(this).collection;if(!t&&b&&!l(r))return"get"==e&&void 0;var o=i[e](0===r?0:r,n);return t?this:o}))})),b||p(h.prototype,"size",{configurable:!0,get:function(){return M(this).collection.size}})}else h=r.getConstructor(t,e,y,S),o.REQUIRED=!0;return d(h,e,!1,!0),w[e]=h,n({global:!0,forced:!0},w),b||r.setStrong(h,e,y),h}},function(e,t,r){var n=r(8),i=r(12),o=r(4);e.exports=function(e){var t,r,s,a,c=arguments.length,u=c>1?arguments[1]:void 0;return n(this),(t=void 0!==u)&&n(u),null==e?new this:(r=[],t?(s=0,a=i(u,c>2?arguments[2]:void 0,2),o(e,(function(e){r.push(a(e,s++))}))):o(e,r.push,{that:r}),new this(r))}},function(e,t,r){e.exports=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}},function(e,t,r){var n=r(1),i=r(8);e.exports=function(){for(var e,t=n(this),r=i(t.delete),o=!0,s=0,a=arguments.length;s<a;s++)e=r.call(t,arguments[s]),o=o&&e;return!!o}},function(e,t,r){var n=r(1);e.exports=function(e,t){var r=n(this),i=r.has(e)&&"update"in t?t.update(r.get(e),e,r):t.insert(e,r);return r.set(e,i),i}},function(e,t,r){e.exports=r(241)},function(e,t,r){var n=r(35),i=n(r(26)),o=n(r(38)),s=n(r(134)),a=n(r(139)),c=function(e){return e&&e.__esModule?e:{default:e}};(0,i.default)(t,"__esModule",{value:!0});var u=c(r(143)),l=function(){function e(e,t,r){if(void 0===t&&(t=864e5),this.name=e,this.expire=t,this.onError=r,this.logQueue=[],this.addTimer=-1,this.onError=r||function(){},"undefined"==typeof indexedDB||"undefined"==typeof IDBKeyRange||"undefined"==typeof Proxy)return this.onError("not support indexeddb or Proxy"),this.get=function(){return o.default.resolve([])},this.delete=function(){return o.default.resolve()},void(this.log=function(){});this.db=new u.default(e,t)}return e.prototype.get=function(e){return this.db.getLogs(e)},e.prototype.delete=function(e){return this.db.deleteLogs(e)},e.prototype.log=function(e,t,r){var n,i=this,o={time:+new Date,level:e,type:r,logStr:t};this.logQueue.push(o),clearTimeout(this.addTimer),this.logQueue.length>3e3?this.db.save((0,s.default)(n=this.logQueue).call(n,0)):this.addTimer=(0,a.default)((function(){var e;i.db.save((0,s.default)(e=i.logQueue).call(e,0))}),2e3)},e}();t.default=l},function(e,t,r){var n=r(108);e.exports=n},function(e,t,r){r(109);var n=r(9).Object,i=e.exports=function(e,t,r){return n.defineProperty(e,t,r)};n.defineProperty.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(11);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperty:r(15).f})},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(112);r(130),r(131),r(132),r(133),e.exports=n},function(e,t,r){r(75),r(46),r(118),r(90),r(91),r(125),r(61),r(34);var n=r(9);e.exports=n.Promise},function(e,t,r){var n=r(3),i=r(14);e.exports=function(e,t){try{i(n,e,t)}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(7);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var n=r(10);e.exports=function(e){if(!n(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,r){var n=r(6),i=r(23),o=n("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[o]===e)}},function(e,t,r){var n=r(1);e.exports=function(e){var t=e.return;if(void 0!==t)return n(t.call(e)).value}},function(e,t,r){var n,i,o,s,a=r(0),c=r(2),u=r(3),l=r(16),d=r(83),p=r(31),m=r(47),f=r(55),h=r(24),g=r(84),v=r(10),y=r(8),b=r(48),S=r(85),T=r(4),_=r(120),w=r(32),M=r(86).set,x=r(121),E=r(88),C=r(123),R=r(33),k=r(49),A=r(20),I=r(74),O=r(6),P=r(124),N=r(60),D=r(43),L=O("species"),j="Promise",U=A.get,F=A.set,$=A.getterFor(j),B=d&&d.prototype,V=d,H=B,W=u.TypeError,q=u.document,z=u.process,G=R.f,J=G,K=!!(q&&q.createEvent&&u.dispatchEvent),Q="function"==typeof PromiseRejectionEvent,Y=!1,X=I(j,(function(){var e=S(V)!==String(V);if(!e&&66===D)return!0;if(c&&!H.finally)return!0;if(D>=51&&/native code/.test(V))return!1;var t=new V((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(t.constructor={})[L]=r,!(Y=t.then((function(){}))instanceof r)||!e&&P&&!Q})),Z=X||!_((function(e){V.all(e).catch((function(){}))})),ee=function(e){var t;return!(!v(e)||"function"!=typeof(t=e.then))&&t},te=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;x((function(){for(var n=e.value,i=1==e.state,o=0;r.length>o;){var s,a,c,u=r[o++],l=i?u.ok:u.fail,d=u.resolve,p=u.reject,m=u.domain;try{l?(i||(2===e.rejection&&oe(e),e.rejection=1),!0===l?s=n:(m&&m.enter(),s=l(n),m&&(m.exit(),c=!0)),s===u.promise?p(W("Promise-chain cycle")):(a=ee(s))?a.call(s,d,p):d(s)):p(n)}catch(e){m&&!c&&m.exit(),p(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&ne(e)}))}},re=function(e,t,r){var n,i;K?((n=q.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!Q&&(i=u["on"+e])?i(n):"unhandledrejection"===e&&C("Unhandled promise rejection",r)},ne=function(e){M.call(u,(function(){var t,r=e.facade,n=e.value;if(ie(e)&&(t=k((function(){N?z.emit("unhandledRejection",n,r):re("unhandledrejection",r,n)})),e.rejection=N||ie(e)?2:1,t.error))throw t.value}))},ie=function(e){return 1!==e.rejection&&!e.parent},oe=function(e){M.call(u,(function(){var t=e.facade;N?z.emit("rejectionHandled",t):re("rejectionhandled",t,e.value)}))},se=function(e,t,r){return function(n){e(t,n,r)}},ae=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,te(e,!0))},ce=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw W("Promise can't be resolved itself");var n=ee(t);n?x((function(){var r={done:!1};try{n.call(t,se(ce,r,e),se(ae,r,e))}catch(t){ae(r,t,e)}})):(e.value=t,e.state=1,te(e,!1))}catch(t){ae({done:!1},t,e)}}};if(X&&(H=(V=function(e){b(this,V,j),y(e),n.call(this);var t=U(this);try{e(se(ce,t),se(ae,t))}catch(e){ae(t,e)}}).prototype,(n=function(e){F(this,{type:j,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=m(H,{then:function(e,t){var r=$(this),n=G(w(this,V));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=N?z.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&te(r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=U(e);this.promise=e,this.resolve=se(ce,t),this.reject=se(ae,t)},R.f=G=function(e){return e===V||e===o?new i(e):J(e)},!c&&"function"==typeof d&&B!==Object.prototype)){s=B.then,Y||(p(B,"then",(function(e,t){var r=this;return new V((function(e,t){s.call(r,e,t)})).then(e,t)}),{unsafe:!0}),p(B,"catch",H.catch,{unsafe:!0}));try{delete B.constructor}catch(e){}f&&f(B,H)}a({global:!0,wrap:!0,forced:X},{Promise:V}),h(V,j,!1,!0),g(j),o=l(j),a({target:j,stat:!0,forced:X},{reject:function(e){var t=G(this);return t.reject.call(void 0,e),t.promise}}),a({target:j,stat:!0,forced:c||X},{resolve:function(e){return E(c&&this===o?V:this,e)}}),a({target:j,stat:!0,forced:Z},{all:function(e){var t=this,r=G(t),n=r.resolve,i=r.reject,o=k((function(){var r=y(t.resolve),o=[],s=0,a=1;T(e,(function(e){var c=s++,u=!1;o.push(void 0),a++,r.call(t,e).then((function(e){u||(u=!0,o[c]=e,--a||n(o))}),i)})),--a||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=G(t),n=r.reject,i=k((function(){var i=y(t.resolve);T(e,(function(e){i.call(t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},function(e,t,r){var n=r(59),i=r(45);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,r){var n=r(6)("iterator"),i=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){i=!0}};s[n]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},function(e,t,r){var n,i,o,s,a,c,u,l,d=r(3),p=r(27).f,m=r(86).set,f=r(87),h=r(122),g=r(60),v=d.MutationObserver||d.WebKitMutationObserver,y=d.document,b=d.process,S=d.Promise,T=p(d,"queueMicrotask"),_=T&&T.value;_||(n=function(){var e,t;for(g&&(e=b.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?s():o=void 0,e}}o=void 0,e&&e.enter()},f||g||h||!v||!y?S&&S.resolve?((u=S.resolve(void 0)).constructor=S,l=u.then,s=function(){l.call(u,n)}):s=g?function(){b.nextTick(n)}:function(){m.call(d,n)}:(a=!0,c=y.createTextNode(""),new v(n).observe(c,{characterData:!0}),s=function(){c.data=a=!a})),e.exports=_||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,s()),o=t}},function(e,t,r){var n=r(44);e.exports=/web0s(?!.*chrome)/i.test(n)},function(e,t,r){var n=r(3);e.exports=function(e,t){var r=n.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}},function(e,t){e.exports="object"==typeof window},function(e,t,r){var n=r(0),i=r(2),o=r(83),s=r(7),a=r(16),c=r(32),u=r(88),l=r(31);if(n({target:"Promise",proto:!0,real:!0,forced:!!o&&s((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=c(this,a("Promise")),r="function"==typeof e;return this.then(r?function(r){return u(t,e()).then((function(){return r}))}:e,r?function(r){return u(t,e()).then((function(){throw r}))}:e)}}),!i&&"function"==typeof o){var d=a("Promise").prototype.finally;o.prototype.finally!==d&&l(o.prototype,"finally",d,{unsafe:!0})}},function(e,t,r){var n=r(42),i=r(36),o=function(e){return function(t,r){var o,s,a=String(i(t)),c=n(r),u=a.length;return c<0||c>=u?e?"":void 0:(o=a.charCodeAt(c))<55296||o>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):o:e?a.slice(c,c+2):s-56320+(o-55296<<10)+65536}};e.exports={codeAt:o(!1),charAt:o(!0)}},function(e,t,r){var n=r(92).IteratorPrototype,i=r(41),o=r(22),s=r(24),a=r(23),c=function(){return this};e.exports=function(e,t,r){var u=t+" Iterator";return e.prototype=i(n,{next:o(1,r)}),s(e,u,!1,!0),a[u]=c,e}},function(e,t,r){var n=r(18),i=r(93),o=r(23),s=r(20),a=r(62),c=s.set,u=s.getterFor("Array Iterator");e.exports=a(Array,"Array",(function(e,t){c(this,{type:"Array Iterator",target:n(e),index:0,kind:t})}),(function(){var e=u(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){r(75)},function(e,t,r){r(90)},function(e,t,r){var n=r(0),i=r(33),o=r(49);n({target:"Promise",stat:!0},{try:function(e){var t=i.f(this),r=o(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}})},function(e,t,r){r(91)},function(e,t,r){e.exports=r(135)},function(e,t,r){var n=r(136);e.exports=n},function(e,t,r){var n=r(137),i=Array.prototype;e.exports=function(e){var t=e.splice;return e===i||e instanceof Array&&t===i.splice?n:t}},function(e,t,r){r(138);var n=r(21);e.exports=n("Array").splice},function(e,t,r){var n=r(0),i=r(79),o=r(42),s=r(29),a=r(19),c=r(63),u=r(65),l=r(66)("splice"),d=Math.max,p=Math.min;n({target:"Array",proto:!0,forced:!l},{splice:function(e,t){var r,n,l,m,f,h,g=a(this),v=s(g.length),y=i(e,v),b=arguments.length;if(0===b?r=n=0:1===b?(r=0,n=v-y):(r=b-2,n=p(d(o(t),0),v-y)),v+r-n>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=c(g,n),m=0;m<n;m++)(f=y+m)in g&&u(l,m,g[f]);if(l.length=n,r<n){for(m=y;m<v-n;m++)h=m+r,(f=m+n)in g?g[h]=g[f]:delete g[h];for(m=v;m>v-n+r;m--)delete g[m-1]}else if(r>n)for(m=v-n;m>y;m--)h=m+r-1,(f=m+n-1)in g?g[h]=g[f]:delete g[h];for(m=0;m<r;m++)g[m+y]=arguments[m+2];return g.length=v-n+r,l}})},function(e,t,r){e.exports=r(140)},function(e,t,r){var n=r(141);e.exports=n},function(e,t,r){r(142);var n=r(9);e.exports=n.setTimeout},function(e,t,r){var n=r(0),i=r(3),o=r(44),s=[].slice,a=function(e){return function(t,r){var n=arguments.length>2,i=n?s.call(arguments,2):void 0;return e(n?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,r)}};n({global:!0,bind:!0,forced:/MSIE .\./.test(o)},{setTimeout:a(i.setTimeout),setInterval:a(i.setInterval)})},function(e,t,r){var n=r(35),i=n(r(38)),o=n(r(144)),s=n(r(171)),a=n(r(26)),c=n(r(98)),u=n(r(178)),l=n(r(99)),d=function(e,t,r,n){return new(r||(r=i.default))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},p=function(e,t){var r,n,i,a,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof o.default&&(a[s.default]=function(){return this}),a;function u(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return c.label++,{value:o[1],done:!1};case 5:c.label++,n=o[1],o=[0];continue;case 7:o=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){c=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){c.label=o[1];break}if(6===o[0]&&c.label<i[1]){c.label=i[1],i=o;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(o);break}i[2]&&c.ops.pop(),c.trys.pop();continue}o=t.call(e,c)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};(0,a.default)(t,"__esModule",{value:!0});var m=r(188),f=function(){function e(e,t){void 0===t&&(t=86400),this.name=e,this.expire=t,this.dbVersion=2,this.name=e,this.expire=t,this.dbPromise=this.initDB()}return e.prototype.initDB=function(){return m.openDB(this.name,this.dbVersion,{upgrade:function(e,t,r,n){if(1===t)try{e.deleteObjectStore("log_detail")}catch(e){}e.createObjectStore("log_detail",{keyPath:"id",autoIncrement:!0}).createIndex("time","time")}})},e.prototype.getLogs=function(e){return d(this,void 0,void 0,(function(){var t,r,n,o,s,a,u,l;return p(this,(function(d){switch(d.label){case 0:return t=[],[4,this.dbPromise];case 1:return r=d.sent(),n=m.unwrap(r).transaction("log_detail","readonly").objectStore("log_detail"),o=function(e){var t=e.end,r=e.start,n=e.type,i=e.level,o=IDBKeyRange.bound(r||0,t||+new Date),s=function(e){return!0},a=0;switch(n&&(a+=2),i&&(a+=1),a){case 1:s=function(e){return e.level===i};break;case 2:s=function(e){return e.type===n};break;case 3:s=function(e){return e.type===n&&e.level===i}}return{indexName:"time",filter:s,keyRange:o}}(e),s=o.indexName,a=o.keyRange,u=(0,c.default)(o),l=n.index(s).openCursor(a),[2,new i.default((function(e,r){l.onsuccess=function(r){var n=r.target.result;n?(u(n.value)&&t.push(n.value),n.continue()):e(t)},l.onerror=function(e){r(e)}}))]}}))}))},e.prototype.deleteLogs=function(e){return d(this,void 0,void 0,(function(){var t,r,n,o,s;return p(this,(function(a){switch(a.label){case 0:return[4,this.dbPromise];case 1:return t=a.sent(),r=m.unwrap(t).transaction("log_detail","readwrite").objectStore("log_detail"),n=e.start,o=e.end,s=r.index("time").openKeyCursor(IDBKeyRange.bound(n,o)),[2,new i.default((function(e,t){s.onsuccess=function(){var t=s.result;t?(r.delete(t.primaryKey),t.continue()):e(null)},s.onerror=function(e){t(e)}}))]}}))}))},e.prototype.save=function(e){return d(this,void 0,void 0,(function(){var t,r;return p(this,(function(n){switch(n.label){case 0:return[4,this.dbPromise];case 1:return t=n.sent(),r=[],[2,this.deleteLogs({start:0,end:(0,u.default)()-this.expire}).then((function(){var n=t.transaction("log_detail","readwrite").objectStore("log_detail");return(0,l.default)(e).call(e,(function(e){r.push(n.put(e))})),i.default.all(r)}))]}}))}))},e}();t.default=f},function(e,t,r){e.exports=r(145)},function(e,t,r){var n=r(146);r(164),r(165),r(166),r(167),r(168),r(169),r(170),e.exports=n},function(e,t,r){r(94),r(46),r(95),r(148),r(149),r(150),r(151),r(97),r(152),r(153),r(154),r(155),r(156),r(157),r(158),r(159),r(160),r(161),r(162),r(163);var n=r(9);e.exports=n.Symbol},function(e,t,r){var n=r(18),i=r(67).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(n(e))}},function(e,t,r){r(5)("asyncIterator")},function(e,t){},function(e,t,r){r(5)("hasInstance")},function(e,t,r){r(5)("isConcatSpreadable")},function(e,t,r){r(5)("match")},function(e,t,r){r(5)("matchAll")},function(e,t,r){r(5)("replace")},function(e,t,r){r(5)("search")},function(e,t,r){r(5)("species")},function(e,t,r){r(5)("split")},function(e,t,r){r(5)("toPrimitive")},function(e,t,r){r(5)("toStringTag")},function(e,t,r){r(5)("unscopables")},function(e,t,r){var n=r(3);r(24)(n.JSON,"JSON",!0)},function(e,t){},function(e,t){},function(e,t,r){r(5)("asyncDispose")},function(e,t,r){r(5)("dispose")},function(e,t,r){r(5)("matcher")},function(e,t,r){r(5)("metadata")},function(e,t,r){r(5)("observable")},function(e,t,r){r(5)("patternMatch")},function(e,t,r){r(5)("replaceAll")},function(e,t,r){e.exports=r(172)},function(e,t,r){var n=r(173);e.exports=n},function(e,t,r){r(97),r(61),r(34);var n=r(68);e.exports=n.f("iterator")},function(e,t,r){var n=r(175);e.exports=n},function(e,t,r){var n=r(176),i=Array.prototype;e.exports=function(e){var t=e.filter;return e===i||e instanceof Array&&t===i.filter?n:t}},function(e,t,r){r(177);var n=r(21);e.exports=n("Array").filter},function(e,t,r){var n=r(0),i=r(25).filter;n({target:"Array",proto:!0,forced:!r(66)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(179)},function(e,t,r){var n=r(180);e.exports=n},function(e,t,r){r(181);var n=r(9);e.exports=n.Date.now},function(e,t,r){r(0)({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},function(e,t,r){var n=r(183);e.exports=n},function(e,t,r){r(34);var n=r(184),i=r(45),o=Array.prototype,s={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===o||e instanceof Array&&t===o.forEach||s.hasOwnProperty(i(e))?n:t}},function(e,t,r){var n=r(185);e.exports=n},function(e,t,r){r(186);var n=r(21);e.exports=n("Array").forEach},function(e,t,r){var n=r(0),i=r(187);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},function(e,t,r){var n=r(25).forEach,i=r(69)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){var n=r(189),i=r(193),o=r(98),s=r(196),a=r(99),c=r(200),u=r(205),l=r(26),d=r(35);l(t,"__esModule",{value:!0}),t.deleteDB=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).blocked,r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",(function(){return t()})),(0,v.w)(r).then((function(){}))},t.openDB=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.blocked,i=r.upgrade,o=r.blocking,s=r.terminated,a=indexedDB.open(e,t),c=(0,v.w)(a);return i&&a.addEventListener("upgradeneeded",(function(e){i((0,v.w)(a.result),e.oldVersion,e.newVersion,(0,v.w)(a.transaction))})),n&&a.addEventListener("blocked",(function(){return n()})),c.then((function(e){s&&e.addEventListener("close",(function(){return s()})),o&&e.addEventListener("versionchange",(function(){return o()}))})).catch((function(){})),c},l(t,"unwrap",{enumerable:!0,get:function(){return v.u}}),l(t,"wrap",{enumerable:!0,get:function(){return v.w}});var p=d(r(209)),m=d(r(211)),f=d(r(212)),h=d(r(213)),g=d(r(105)),v=r(250);function y(e,t){var r=n(e);if(i){var a=i(e);t&&(a=o(a).call(a,(function(t){return s(e,t).enumerable}))),r.push.apply(r,a)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)a(r=y(Object(n),!0)).call(r,(function(t){(0,m.default)(e,t,n[t])}));else if(c)u(e,c(n));else{var i;a(i=y(Object(n))).call(i,(function(t){l(e,t,s(n,t))}))}}return e}var S=["get","getKey","getAll","getAllKeys","count"],T=["put","add","delete","clear"],_=new h.default;function w(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(_.get(t))return _.get(t);var r=t.replace(/FromIndex$/,""),n=t!==r,i=(0,g.default)(T).call(T,r);if(r in(n?IDBIndex:IDBObjectStore).prototype&&(i||(0,g.default)(S).call(S,r))){var o=function(){var e=(0,f.default)(p.default.mark((function e(t){var o,s,a,c,u,l,d,m=arguments;return p.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),a=s.store,c=m.length,u=new Array(c>1?c-1:0),l=1;l<c;l++)u[l-1]=m[l];return n&&(a=a.index(u.shift())),e.next=6,(o=a)[r].apply(o,u);case 6:if(d=e.sent,!i){e.next=10;break}return e.next=10,s.done;case 10:return e.abrupt("return",d);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return _.set(t,o),o}}}(0,v.r)((function(e){return b(b({},e),{},{get:function(t,r,n){return w(t,r)||e.get(t,r,n)},has:function(t,r){return!!w(t,r)||e.has(t,r)}})}))},function(e,t,r){e.exports=r(190)},function(e,t,r){var n=r(191);e.exports=n},function(e,t,r){r(192);var n=r(9);e.exports=n.Object.keys},function(e,t,r){var n=r(0),i=r(19),o=r(56);n({target:"Object",stat:!0,forced:r(7)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},function(e,t,r){e.exports=r(194)},function(e,t,r){var n=r(195);e.exports=n},function(e,t,r){r(95);var n=r(9);e.exports=n.Object.getOwnPropertySymbols},function(e,t,r){e.exports=r(197)},function(e,t,r){var n=r(198);e.exports=n},function(e,t,r){r(199);var n=r(9).Object,i=e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)};n.getOwnPropertyDescriptor.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(7),o=r(18),s=r(27).f,a=r(11),c=i((function(){s(1)}));n({target:"Object",stat:!0,forced:!a||c,sham:!a},{getOwnPropertyDescriptor:function(e,t){return s(o(e),t)}})},function(e,t,r){e.exports=r(201)},function(e,t,r){var n=r(202);e.exports=n},function(e,t,r){r(203);var n=r(9);e.exports=n.Object.getOwnPropertyDescriptors},function(e,t,r){var n=r(0),i=r(11),o=r(204),s=r(18),a=r(27),c=r(65);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=s(e),i=a.f,u=o(n),l={},d=0;u.length>d;)void 0!==(r=i(n,t=u[d++]))&&c(l,t,r);return l}})},function(e,t,r){var n=r(16),i=r(67),o=r(96),s=r(1);e.exports=n("Reflect","ownKeys")||function(e){var t=i.f(s(e)),r=o.f;return r?t.concat(r(e)):t}},function(e,t,r){e.exports=r(206)},function(e,t,r){var n=r(207);e.exports=n},function(e,t,r){r(208);var n=r(9).Object,i=e.exports=function(e,t){return n.defineProperties(e,t)};n.defineProperties.sham&&(i.sham=!0)},function(e,t,r){var n=r(0),i=r(11);n({target:"Object",stat:!0,forced:!i,sham:!i},{defineProperties:r(76)})},function(e,t,r){e.exports=r(210)},function(e,t,r){var n=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function a(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof d?t:d,o=Object.create(i.prototype),s=new w(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return x()}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=S(s,r);if(a){if(a===l)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function p(){}function m(){}var f={};f[i]=function(){return this};var h=Object.getPrototypeOf,g=h&&h(h(M([])));g&&g!==t&&r.call(g,i)&&(f=g);var v=m.prototype=d.prototype=Object.create(f);function y(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(i,o){function s(){return new t((function(n,s){!function n(i,o,s,a){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,a)}))}a(c.arg)}(i,o,n,s)}))}return n=n?n.then(s,s):s()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function M(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return p.prototype=v.constructor=m,m.constructor=p,p.displayName=a(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,a(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),b.prototype[o]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var s=new b(c(t,r,n,i),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},y(v),a(v,s,"Generator"),v[i]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=M,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:M(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},function(e,t,r){var n=r(26);e.exports=function(e,t,r){return t in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(38);function i(e,t,r,i,o,s,a){try{var c=e[s](a),u=c.value}catch(e){return void r(e)}c.done?t(u):n.resolve(u).then(i,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new n((function(n,o){var s=e.apply(t,r);function a(e){i(s,n,o,a,c,"next",e)}function c(e){i(s,n,o,a,c,"throw",e)}a(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(214)},function(e,t,r){var n=r(215);r(219),r(220),r(221),r(222),r(223),r(225),r(226),r(227),r(228),r(229),r(231),r(232),r(233),r(234),r(235),r(236),r(237),r(238),r(239),r(240),e.exports=n},function(e,t,r){r(216),r(46),r(61),r(34);var n=r(9);e.exports=n.Map},function(e,t,r){var n=r(100),i=r(218);e.exports=n("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),i)},function(e,t,r){var n=r(7);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(e,t,r){var n=r(15).f,i=r(41),o=r(47),s=r(12),a=r(48),c=r(4),u=r(62),l=r(84),d=r(11),p=r(50).fastKey,m=r(20),f=m.set,h=m.getterFor;e.exports={getConstructor:function(e,t,r,u){var l=e((function(e,n){a(e,l,t),f(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),m=h(t),g=function(e,t,r){var n,i,o=m(e),s=v(e,t);return s?s.value=r:(o.last=s={index:i=p(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),d?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},v=function(e,t){var r,n=m(e),i=p(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return o(l.prototype,{clear:function(){for(var e=m(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t=m(this),r=v(this,e);if(r){var n=r.next,i=r.previous;delete t.index[r.index],r.removed=!0,i&&(i.next=n),n&&(n.previous=i),t.first==r&&(t.first=n),t.last==r&&(t.last=i),d?t.size--:this.size--}return!!r},forEach:function(e){for(var t,r=m(this),n=s(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!v(this,e)}}),o(l.prototype,r?{get:function(e){var t=v(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),d&&n(l.prototype,"size",{get:function(){return m(this).size}}),l},setStrong:function(e,t,r){var n=t+" Iterator",i=h(t),o=h(n);u(e,t,(function(e,t){f(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),l(t)}}},function(e,t,r){r(0)({target:"Map",stat:!0},{from:r(101)})},function(e,t,r){r(0)({target:"Map",stat:!0},{of:r(102)})},function(e,t,r){var n=r(0),i=r(2),o=r(103);n({target:"Map",proto:!0,real:!0,forced:i},{deleteAll:function(){return o.apply(this,arguments)}})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{emplace:r(104)})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(12),a=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{every:function(e){var t=o(this),r=a(t),n=s(e,arguments.length>1?arguments[1]:void 0,3);return!c(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){var n=r(1),i=r(82);e.exports=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return n(t.call(e))}},function(e,t,r){var n=r(0),i=r(2),o=r(16),s=r(1),a=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{filter:function(e){var t=s(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=a(i.set);return d(r,(function(e,r){n(r,e,t)&&p.call(i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(12),a=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{find:function(e){var t=o(this),r=a(t),n=s(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(12),a=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{findKey:function(e){var t=o(this),r=a(t),n=s(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(4),o=r(8);n({target:"Map",stat:!0},{groupBy:function(e,t){var r=new this;o(t);var n=o(r.has),s=o(r.get),a=o(r.set);return i(e,(function(e){var i=t(e);n.call(r,i)?s.call(r,i).push(e):a.call(r,i,[e])})),r}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(17),a=r(230),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{includes:function(e){return c(s(o(this)),(function(t,r,n){if(a(r,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){var n=r(0),i=r(4),o=r(8);n({target:"Map",stat:!0},{keyBy:function(e,t){var r=new this;o(t);var n=o(r.set);return i(e,(function(e){n.call(r,t(e),e)})),r}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(17),a=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{keyOf:function(e){return a(s(o(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(0),i=r(2),o=r(16),s=r(1),a=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{mapKeys:function(e){var t=s(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=a(i.set);return d(r,(function(e,r){p.call(i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(16),s=r(1),a=r(8),c=r(12),u=r(32),l=r(17),d=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{mapValues:function(e){var t=s(this),r=l(t),n=c(e,arguments.length>1?arguments[1]:void 0,3),i=new(u(t,o("Map"))),p=a(i.set);return d(r,(function(e,r){p.call(i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(8),a=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{merge:function(e){for(var t=o(this),r=s(t.set),n=0;n<arguments.length;)a(arguments[n++],r,{that:t,AS_ENTRIES:!0});return t}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(8),a=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{reduce:function(e){var t=o(this),r=a(t),n=arguments.length<2,i=n?void 0:arguments[1];if(s(e),c(r,(function(r,o){n?(n=!1,i=o):i=e(i,o,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return i}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(12),a=r(17),c=r(4);n({target:"Map",proto:!0,real:!0,forced:i},{some:function(e){var t=o(this),r=a(t),n=s(e,arguments.length>1?arguments[1]:void 0,3);return c(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){var n=r(0),i=r(2),o=r(1),s=r(8);n({target:"Map",proto:!0,real:!0,forced:i},{update:function(e,t){var r=o(this),n=arguments.length;s(t);var i=r.has(e);if(!i&&n<3)throw TypeError("Updating absent value");var a=i?r.get(e):s(n>2?arguments[2]:void 0)(e,r);return r.set(e,t(a,e,r)),r}})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{upsert:r(70)})},function(e,t,r){r(0)({target:"Map",proto:!0,real:!0,forced:r(2)},{updateOrInsert:r(70)})},function(e,t,r){var n=r(242);e.exports=n},function(e,t,r){var n=r(243),i=r(245),o=Array.prototype,s=String.prototype;e.exports=function(e){var t=e.includes;return e===o||e instanceof Array&&t===o.includes?n:"string"==typeof e||e===s||e instanceof String&&t===s.includes?i:t}},function(e,t,r){r(244);var n=r(21);e.exports=n("Array").includes},function(e,t,r){var n=r(0),i=r(78).includes,o=r(93);n({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(e,t,r){r(246);var n=r(21);e.exports=n("String").includes},function(e,t,r){var n=r(0),i=r(247),o=r(36);n({target:"String",proto:!0,forced:!r(249)("includes")},{includes:function(e){return!!~String(o(this)).indexOf(i(e),arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(248);e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,r){var n=r(10),i=r(28),o=r(6)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(6)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){var n=r(26),i=r(35);n(t,"__esModule",{value:!0}),t.r=function(e){b=e(b)},t.w=_,t.u=t.i=t.a=void 0;var o,s,a=i(r(251)),c=i(r(256)),u=i(r(38)),l=i(r(266)),d=i(r(270)),p=i(r(105)),m=function(e,t){return(0,a.default)(t).call(t,(function(t){return e instanceof t}))};t.i=m;var f=new c.default,h=new c.default,g=new c.default,v=new c.default,y=new c.default;t.a=y;var b={get:function(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("objectStoreNames"===t)return e.objectStoreNames||g.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return _(e[t])},set:function(e,t,r){return e[t]=r,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function S(e){var t;return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(0,p.default)(t=s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).call(t,e)?function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.apply(w(this),r),_(f.get(this))}:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return _(e.apply(w(this),r))}:function(t){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var s=e.call.apply(e,(0,l.default)(r=[w(this),t]).call(r,i));return g.set(s,(0,d.default)(t)?(0,d.default)(t).call(t):[t]),_(s)}}function T(e){return"function"==typeof e?S(e):(e instanceof IDBTransaction&&function(e){if(!h.has(e)){var t=new u.default((function(t,r){var n=function(){e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=function(){t(),n()},o=function(){r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));h.set(e,t)}}(e),m(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,b):e)}function _(e){if(e instanceof IDBRequest)return t=e,(r=new u.default((function(e,r){var n=function(){t.removeEventListener("success",i),t.removeEventListener("error",o)},i=function(){e(_(t.result)),n()},o=function(){r(t.error),n()};t.addEventListener("success",i),t.addEventListener("error",o)}))).then((function(e){e instanceof IDBCursor&&f.set(e,t)})).catch((function(){})),y.set(r,t),r;var t,r;if(v.has(e))return v.get(e);var n=T(e);return n!==e&&(v.set(e,n),y.set(n,e)),n}var w=function(e){return y.get(e)};t.u=w},function(e,t,r){e.exports=r(252)},function(e,t,r){var n=r(253);e.exports=n},function(e,t,r){var n=r(254),i=Array.prototype;e.exports=function(e){var t=e.some;return e===i||e instanceof Array&&t===i.some?n:t}},function(e,t,r){r(255);var n=r(21);e.exports=n("Array").some},function(e,t,r){var n=r(0),i=r(25).some;n({target:"Array",proto:!0,forced:!r(69)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(257)},function(e,t,r){var n=r(258);r(261),r(262),r(263),r(264),r(265),e.exports=n},function(e,t,r){r(46),r(259),r(34);var n=r(9);e.exports=n.WeakMap},function(e,t,r){var n,i=r(3),o=r(47),s=r(50),a=r(100),c=r(260),u=r(10),l=r(20).enforce,d=r(89),p=!i.ActiveXObject&&"ActiveXObject"in i,m=Object.isExtensible,f=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},h=e.exports=a("WeakMap",f,c);if(d&&p){n=c.getConstructor(f,"WeakMap",!0),s.REQUIRED=!0;var g=h.prototype,v=g.delete,y=g.has,b=g.get,S=g.set;o(g,{delete:function(e){if(u(e)&&!m(e)){var t=l(this);return t.frozen||(t.frozen=new n),v.call(this,e)||t.frozen.delete(e)}return v.call(this,e)},has:function(e){if(u(e)&&!m(e)){var t=l(this);return t.frozen||(t.frozen=new n),y.call(this,e)||t.frozen.has(e)}return y.call(this,e)},get:function(e){if(u(e)&&!m(e)){var t=l(this);return t.frozen||(t.frozen=new n),y.call(this,e)?b.call(this,e):t.frozen.get(e)}return b.call(this,e)},set:function(e,t){if(u(e)&&!m(e)){var r=l(this);r.frozen||(r.frozen=new n),y.call(this,e)?S.call(this,e,t):r.frozen.set(e,t)}else S.call(this,e,t);return this}})}},function(e,t,r){var n=r(47),i=r(50).getWeakData,o=r(1),s=r(10),a=r(48),c=r(4),u=r(25),l=r(13),d=r(20),p=d.set,m=d.getterFor,f=u.find,h=u.findIndex,g=0,v=function(e){return e.frozen||(e.frozen=new y)},y=function(){this.entries=[]},b=function(e,t){return f(e.entries,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=b(this,e);if(t)return t[1]},has:function(e){return!!b(this,e)},set:function(e,t){var r=b(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=h(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,r,u){var d=e((function(e,n){a(e,d,t),p(e,{type:t,id:g++,frozen:void 0}),null!=n&&c(n,e[u],{that:e,AS_ENTRIES:r})})),f=m(t),h=function(e,t,r){var n=f(e),s=i(o(t),!0);return!0===s?v(n).set(t,r):s[n.id]=r,e};return n(d.prototype,{delete:function(e){var t=f(this);if(!s(e))return!1;var r=i(e);return!0===r?v(t).delete(e):r&&l(r,t.id)&&delete r[t.id]},has:function(e){var t=f(this);if(!s(e))return!1;var r=i(e);return!0===r?v(t).has(e):r&&l(r,t.id)}}),n(d.prototype,r?{get:function(e){var t=f(this);if(s(e)){var r=i(e);return!0===r?v(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return h(this,e,t)}}:{add:function(e){return h(this,e,!0)}}),d}}},function(e,t,r){r(0)({target:"WeakMap",proto:!0,real:!0,forced:r(2)},{emplace:r(104)})},function(e,t,r){r(0)({target:"WeakMap",stat:!0},{from:r(101)})},function(e,t,r){r(0)({target:"WeakMap",stat:!0},{of:r(102)})},function(e,t,r){var n=r(0),i=r(2),o=r(103);n({target:"WeakMap",proto:!0,real:!0,forced:i},{deleteAll:function(){return o.apply(this,arguments)}})},function(e,t,r){r(0)({target:"WeakMap",proto:!0,real:!0,forced:r(2)},{upsert:r(70)})},function(e,t,r){e.exports=r(267)},function(e,t,r){var n=r(268);e.exports=n},function(e,t,r){var n=r(269),i=Array.prototype;e.exports=function(e){var t=e.concat;return e===i||e instanceof Array&&t===i.concat?n:t}},function(e,t,r){r(94);var n=r(21);e.exports=n("Array").concat},function(e,t,r){e.exports=r(271)},function(e,t,r){var n=r(272);e.exports=n},function(e,t,r){var n=r(273),i=Array.prototype;e.exports=function(e){var t=e.sort;return e===i||e instanceof Array&&t===i.sort?n:t}},function(e,t,r){r(274);var n=r(21);e.exports=n("Array").sort},function(e,t,r){var n=r(0),i=r(8),o=r(19),s=r(7),a=r(69),c=[],u=c.sort,l=s((function(){c.sort(void 0)})),d=s((function(){c.sort(null)})),p=a("sort");n({target:"Array",proto:!0,forced:l||!d||!p},{sort:function(e){return void 0===e?u.call(o(this)):u.call(o(this),i(e))}})}]).default}(dist);var LogStorage=getDefaultExportFromCjs(dist.exports);let logger$4;class LoggerWithStorage{constructor(){Object.defineProperty(this,"meetingLog",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rtcLog",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"imLog",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.meetingLog=new LogStorage("meeting"),this.rtcLog=new LogStorage("rtc"),this.imLog=new LogStorage("im")}log(e,t){this.baseLog(e,"log",t)}warn(e,t){this.baseLog(e,"warn",t)}error(e,t){this.baseLog(e,"error",t)}getLog(e,t=0,r=Date.now(),n){return __awaiter$2(this,void 0,void 0,(function*(){return yield this.logAction("get",e,t,r,n)}))}deleteLog(e,t=0,r=Date.now(),n){return __awaiter$2(this,void 0,void 0,(function*(){return yield this.logAction("delete",e,t,r,n)}))}logAction(e,t,r=0,n=Date.now(),i){return __awaiter$2(this,void 0,void 0,(function*(){return yield this[t][e]({start:r,end:n,type:i})}))}baseLog(e,t,r,n){this[e].log(t,r,n)}}var LoggerStorage={getInstance:()=>(logger$4||(logger$4=new LoggerWithStorage),logger$4),destroy(){logger$4=null}},axios$2={exports:{}},bind$2=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},bind$1=bind$2,toString=Object.prototype.toString,kindOf=(cache=Object.create(null),function(e){var t=toString.call(e);return cache[t]||(cache[t]=t.slice(8,-1).toLowerCase())}),cache;function kindOfTest(e){return e=e.toLowerCase(),function(t){return kindOf(t)===e}}function isArray$2(e){return Array.isArray(e)}function isUndefined(e){return void 0===e}function isBuffer$2(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer(e.buffer)}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isObject$4(e){return null!==e&&"object"==typeof e}function isPlainObject(e){if("object"!==kindOf(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList");function isFunction$3(e){return"[object Function]"===toString.call(e)}function isStream(e){return isObject$4(e)&&isFunction$3(e.pipe)}function isFormData(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||toString.call(e)===t||isFunction$3(e.toString)&&e.toString()===t)}var isURLSearchParams=kindOfTest("URLSearchParams");function trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),isArray$2(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function merge(){var e={};function t(t,r){isPlainObject(e[r])&&isPlainObject(t)?e[r]=merge(e[r],t):isPlainObject(t)?e[r]=merge({},t):isArray$2(t)?e[r]=t.slice():e[r]=t}for(var r=0,n=arguments.length;r<n;r++)forEach(arguments[r],t);return e}function extend(e,t,r){return forEach(t,(function(t,n){e[n]=r&&"function"==typeof t?bind$1(t,r):t})),e}function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}function inherits(e,t,r,n){e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,r&&Object.assign(e.prototype,r)}function toFlatObject(e,t,r){var n,i,o,s={};t=t||{};do{for(i=(n=Object.getOwnPropertyNames(e)).length;i-- >0;)s[o=n[i]]||(t[o]=e[o],s[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t}function endsWith(e,t,r){e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;var n=e.indexOf(t,r);return-1!==n&&n===r}function toArray$1(e){if(!e)return null;var t=e.length;if(isUndefined(t))return null;for(var r=new Array(t);t-- >0;)r[t]=e[t];return r}var isTypedArray$2=(TypedArray="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return TypedArray&&e instanceof TypedArray}),TypedArray,utils$h={isArray:isArray$2,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer$2,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject$4,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction$3,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray$1,isTypedArray:isTypedArray$2,isFileList:isFileList},utils$g=utils$h;function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$2=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(utils$g.isURLSearchParams(t))n=t.toString();else{var i=[];utils$g.forEach(t,(function(e,t){null!=e&&(utils$g.isArray(e)?t+="[]":e=[e],utils$g.forEach(e,(function(e){utils$g.isDate(e)?e=e.toISOString():utils$g.isObject(e)&&(e=JSON.stringify(e)),i.push(encode(t)+"="+encode(e))})))})),n=i.join("&")}if(n){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e},utils$f=utils$h;function InterceptorManager$1(){this.handlers=[]}InterceptorManager$1.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},InterceptorManager$1.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager$1.prototype.forEach=function(e){utils$f.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var InterceptorManager_1=InterceptorManager$1,utils$e=utils$h,normalizeHeaderName$1=function(e,t){utils$e.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))},utils$d=utils$h;function AxiosError$5(e,t,r,n,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}utils$d.inherits(AxiosError$5,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var prototype=AxiosError$5.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){descriptors[e]={value:e}})),Object.defineProperties(AxiosError$5,descriptors),Object.defineProperty(prototype,"isAxiosError",{value:!0}),AxiosError$5.from=function(e,t,r,n,i,o){var s=Object.create(prototype);return utils$d.toFlatObject(e,s,(function(e){return e!==Error.prototype})),AxiosError$5.call(s,e.message,t,r,n,i),s.name=e.name,o&&Object.assign(s,o),s};var AxiosError_1=AxiosError$5,transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},utils$c=utils$h;function toFormData$1(e,t){t=t||new FormData;var r=[];function n(e){return null===e?"":utils$c.isDate(e)?e.toISOString():utils$c.isArrayBuffer(e)||utils$c.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(i,o){if(utils$c.isPlainObject(i)||utils$c.isArray(i)){if(-1!==r.indexOf(i))throw Error("Circular reference detected in "+o);r.push(i),utils$c.forEach(i,(function(r,i){if(!utils$c.isUndefined(r)){var s,a=o?o+"."+i:i;if(r&&!o&&"object"==typeof r)if(utils$c.endsWith(i,"{}"))r=JSON.stringify(r);else if(utils$c.endsWith(i,"[]")&&(s=utils$c.toArray(r)))return void s.forEach((function(e){!utils$c.isUndefined(e)&&t.append(a,n(e))}));e(r,a)}})),r.pop()}else t.append(o,n(i))}(e),t}var toFormData_1=toFormData$1,AxiosError$4=AxiosError_1,settle$1=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new AxiosError$4("Request failed with status code "+r.status,[AxiosError$4.ERR_BAD_REQUEST,AxiosError$4.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)},utils$b=utils$h,cookies$1=utils$b.isStandardBrowserEnv()?{write:function(e,t,r,n,i,o){var s=[];s.push(e+"="+encodeURIComponent(t)),utils$b.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),utils$b.isString(n)&&s.push("path="+n),utils$b.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},isAbsoluteURL$1=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},combineURLs$1=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},isAbsoluteURL=isAbsoluteURL$1,combineURLs=combineURLs$1,buildFullPath$2=function(e,t){return e&&!isAbsoluteURL(t)?combineURLs(e,t):t},utils$a=utils$h,ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],parseHeaders$1=function(e){var t,r,n,i={};return e?(utils$a.forEach(e.split("\n"),(function(e){if(n=e.indexOf(":"),t=utils$a.trim(e.substr(0,n)).toLowerCase(),r=utils$a.trim(e.substr(n+1)),t){if(i[t]&&ignoreDuplicateOf.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([r]):i[t]?i[t]+", "+r:r}})),i):i},utils$9=utils$h,isURLSameOrigin$1=utils$9.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=n(window.location.href),function(t){var r=utils$9.isString(t)?n(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0},AxiosError$3=AxiosError_1,utils$8=utils$h;function CanceledError$3(e){AxiosError$3.call(this,null==e?"canceled":e,AxiosError$3.ERR_CANCELED),this.name="CanceledError"}utils$8.inherits(CanceledError$3,AxiosError$3,{__CANCEL__:!0});var CanceledError_1=CanceledError$3,parseProtocol$1=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},utils$7=utils$h,settle=settle$1,cookies=cookies$1,buildURL$1=buildURL$2,buildFullPath$1=buildFullPath$2,parseHeaders=parseHeaders$1,isURLSameOrigin=isURLSameOrigin$1,transitionalDefaults$1=transitional,AxiosError$2=AxiosError_1,CanceledError$2=CanceledError_1,parseProtocol=parseProtocol$1,xhr=function(e){return new Promise((function(t,r){var n,i=e.data,o=e.headers,s=e.responseType;function a(){e.cancelToken&&e.cancelToken.unsubscribe(n),e.signal&&e.signal.removeEventListener("abort",n)}utils$7.isFormData(i)&&utils$7.isStandardBrowserEnv()&&delete o["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",l=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+l)}var d=buildFullPath$1(e.baseURL,e.url);function p(){if(c){var n="getAllResponseHeaders"in c?parseHeaders(c.getAllResponseHeaders()):null,i={data:s&&"text"!==s&&"json"!==s?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:n,config:e,request:c};settle((function(e){t(e),a()}),(function(e){r(e),a()}),i),c=null}}if(c.open(e.method.toUpperCase(),buildURL$1(d,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=p:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(p)},c.onabort=function(){c&&(r(new AxiosError$2("Request aborted",AxiosError$2.ECONNABORTED,e,c)),c=null)},c.onerror=function(){r(new AxiosError$2("Network Error",AxiosError$2.ERR_NETWORK,e,c,c)),c=null},c.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||transitionalDefaults$1;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(new AxiosError$2(t,n.clarifyTimeoutError?AxiosError$2.ETIMEDOUT:AxiosError$2.ECONNABORTED,e,c)),c=null},utils$7.isStandardBrowserEnv()){var m=(e.withCredentials||isURLSameOrigin(d))&&e.xsrfCookieName?cookies.read(e.xsrfCookieName):void 0;m&&(o[e.xsrfHeaderName]=m)}"setRequestHeader"in c&&utils$7.forEach(o,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)})),utils$7.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),s&&"json"!==s&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(n=function(e){c&&(r(!e||e&&e.type?new CanceledError$2:e),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(n),e.signal&&(e.signal.aborted?n():e.signal.addEventListener("abort",n))),i||(i=null);var f=parseProtocol(d);f&&-1===["http","https","file"].indexOf(f)?r(new AxiosError$2("Unsupported protocol "+f+":",AxiosError$2.ERR_BAD_REQUEST,e)):c.send(i)}))},_null=null,utils$6=utils$h,normalizeHeaderName=normalizeHeaderName$1,AxiosError$1=AxiosError_1,transitionalDefaults=transitional,toFormData=toFormData_1,DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!utils$6.isUndefined(e)&&utils$6.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter(){var e;return("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=xhr),e}function stringifySafely(e,t,r){if(utils$6.isString(e))try{return(t||JSON.parse)(e),utils$6.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}var defaults$4={transitional:transitionalDefaults,adapter:getDefaultAdapter(),transformRequest:[function(e,t){if(normalizeHeaderName(t,"Accept"),normalizeHeaderName(t,"Content-Type"),utils$6.isFormData(e)||utils$6.isArrayBuffer(e)||utils$6.isBuffer(e)||utils$6.isStream(e)||utils$6.isFile(e)||utils$6.isBlob(e))return e;if(utils$6.isArrayBufferView(e))return e.buffer;if(utils$6.isURLSearchParams(e))return setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var r,n=utils$6.isObject(e),i=t&&t["Content-Type"];if((r=utils$6.isFileList(e))||n&&"multipart/form-data"===i){var o=this.env&&this.env.FormData;return toFormData(r?{"files[]":e}:e,o&&new o)}return n||"application/json"===i?(setContentTypeIfUnset(t,"application/json"),stringifySafely(e)):e}],transformResponse:[function(e){var t=this.transitional||defaults$4.transitional,r=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,i=!r&&"json"===this.responseType;if(i||n&&utils$6.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw AxiosError$1.from(e,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$6.forEach(["delete","get","head"],(function(e){defaults$4.headers[e]={}})),utils$6.forEach(["post","put","patch"],(function(e){defaults$4.headers[e]=utils$6.merge(DEFAULT_CONTENT_TYPE)}));var defaults_1=defaults$4,utils$5=utils$h,defaults$3=defaults_1,transformData$1=function(e,t,r){var n=this||defaults$3;return utils$5.forEach(r,(function(r){e=r.call(n,e,t)})),e},isCancel$1=function(e){return!(!e||!e.__CANCEL__)},utils$4=utils$h,transformData=transformData$1,isCancel=isCancel$1,defaults$2=defaults_1,CanceledError$1=CanceledError_1;function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new CanceledError$1}var dispatchRequest$1=function(e){return throwIfCancellationRequested(e),e.headers=e.headers||{},e.data=transformData.call(e,e.data,e.headers,e.transformRequest),e.headers=utils$4.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),utils$4.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||defaults$2.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},utils$3=utils$h,mergeConfig$3=function(e,t){t=t||{};var r={};function n(e,t){return utils$3.isPlainObject(e)&&utils$3.isPlainObject(t)?utils$3.merge(e,t):utils$3.isPlainObject(t)?utils$3.merge({},t):utils$3.isArray(t)?t.slice():t}function i(r){return utils$3.isUndefined(t[r])?utils$3.isUndefined(e[r])?void 0:n(void 0,e[r]):n(e[r],t[r])}function o(e){if(!utils$3.isUndefined(t[e]))return n(void 0,t[e])}function s(r){return utils$3.isUndefined(t[r])?utils$3.isUndefined(e[r])?void 0:n(void 0,e[r]):n(void 0,t[r])}function a(r){return r in t?n(e[r],t[r]):r in e?n(void 0,e[r]):void 0}var c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a};return utils$3.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,n=t(e);utils$3.isUndefined(n)&&t!==a||(r[e]=n)})),r},data={version:"0.27.2"},VERSION=data.version,AxiosError=AxiosError_1,validators$1={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){validators$1[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var deprecatedWarnings={};function assertOptions(e,t,r){if("object"!=typeof e)throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(e),i=n.length;i-- >0;){var o=n[i],s=t[o];if(s){var a=e[o],c=void 0===a||s(a,o,e);if(!0!==c)throw new AxiosError("option "+o+" must be "+c,AxiosError.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new AxiosError("Unknown option "+o,AxiosError.ERR_BAD_OPTION)}}validators$1.transitional=function(e,t,r){function n(e,t){return"[Axios v"+VERSION+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,i,o){if(!1===e)throw new AxiosError(n(i," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings[i]&&(deprecatedWarnings[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,o)}};var validator$1={assertOptions:assertOptions,validators:validators$1},utils$2=utils$h,buildURL=buildURL$2,InterceptorManager=InterceptorManager_1,dispatchRequest=dispatchRequest$1,mergeConfig$2=mergeConfig$3,buildFullPath=buildFullPath$2,validator=validator$1,validators=validator.validators;function Axios$1(e){this.defaults=e,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios$1.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=mergeConfig$2(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&validator.assertOptions(r,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var o,s=[];if(this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)})),!i){var a=[dispatchRequest,void 0];for(Array.prototype.unshift.apply(a,n),a=a.concat(s),o=Promise.resolve(t);a.length;)o=o.then(a.shift(),a.shift());return o}for(var c=t;n.length;){var u=n.shift(),l=n.shift();try{c=u(c)}catch(e){l(e);break}}try{o=dispatchRequest(c)}catch(e){return Promise.reject(e)}for(;s.length;)o=o.then(s.shift(),s.shift());return o},Axios$1.prototype.getUri=function(e){e=mergeConfig$2(this.defaults,e);var t=buildFullPath(e.baseURL,e.url);return buildURL(t,e.params,e.paramsSerializer)},utils$2.forEach(["delete","get","head","options"],(function(e){Axios$1.prototype[e]=function(t,r){return this.request(mergeConfig$2(r||{},{method:e,url:t,data:(r||{}).data}))}})),utils$2.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,i){return this.request(mergeConfig$2(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}Axios$1.prototype[e]=t(),Axios$1.prototype[e+"Form"]=t(!0)}));var Axios_1=Axios$1,CanceledError=CanceledError_1;function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new CanceledError(e),t(r.reason))}))}CancelToken.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},CancelToken.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},CancelToken.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},CancelToken.source=function(){var e,t=new CancelToken((function(t){e=t}));return{token:t,cancel:e}};var CancelToken_1=CancelToken,spread=function(e){return function(t){return e.apply(null,t)}},utils$1=utils$h,isAxiosError=function(e){return utils$1.isObject(e)&&!0===e.isAxiosError},utils=utils$h,bind=bind$2,Axios=Axios_1,mergeConfig$1=mergeConfig$3,defaults$1=defaults_1;function createInstance(e){var t=new Axios(e),r=bind(Axios.prototype.request,t);return utils.extend(r,Axios.prototype,t),utils.extend(r,t),r.create=function(t){return createInstance(mergeConfig$1(e,t))},r}var axios$1=createInstance(defaults$1);axios$1.Axios=Axios,axios$1.CanceledError=CanceledError_1,axios$1.CancelToken=CancelToken_1,axios$1.isCancel=isCancel$1,axios$1.VERSION=data.version,axios$1.toFormData=toFormData_1,axios$1.AxiosError=AxiosError_1,axios$1.Cancel=axios$1.CanceledError,axios$1.all=function(e){return Promise.all(e)},axios$1.spread=spread,axios$1.isAxiosError=isAxiosError,axios$2.exports=axios$1,axios$2.exports.default=axios$1;var axios=axios$2.exports;let reporter$1=null;const version$4="1.0.0";class DataReporter{constructor(e){Object.defineProperty(this,"_appkey",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_nickname",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_meetingId",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_url",{enumerable:!0,configurable:!0,writable:!0,value:"https://statistic.live.126.net/statics/report/common/form"}),Object.defineProperty(this,"_os",{enumerable:!0,configurable:!0,writable:!0,value:this.getOperatingSystemInfo()}),console.log("constructor(), options: %o",e)}init(e){console.log("init(), options: %o",e),e.appkey&&(this._appkey=e.appKey),e.nickName&&(this._nickname=e.nickName),e.uid&&(this._uid=e.uid),e.meetingId&&(this._meetingId=e.meetingId)}send(e){console.log("send(), options: %o",e),axios.post(this._url,{event:{action:Object.assign({module:"meeting",platform:"Web",app_key:this._appkey,device_id:"web",version_name:version$4,os_ver:this._os,manufacturer:"",model:"",network_type:"10",sdk_version:version$4,nickname:this._nickname,uid:this._uid,meeting_id:this._meetingId,occur_time:Date.now()},e)}},{headers:{"Content-Type":"application/json;charset=utf-8",ver:version$4,sdktype:"meeting",appkey:this._appkey}}).then((e=>{})).catch((e=>{console.error("send() failed: %o",e)}))}sendLog(e){console.log("sendLog(), options: %o",e),axios.post(this._url,{event:{feedback:Object.assign({module:"meeting",platform:"Web",app_key:this._appkey,device_id:"web",version_name:"1.0.0",os_ver:this._os,manufacturer:"",model:"",network_type:"10",sdk_version:"4.2.1",nickname:this._nickname,uid:this._uid,meeting_id:this._meetingId,occur_time:Date.now()},e)}},{headers:{"Content-Type":"application/json;charset=utf-8",ver:"1.0",sdktype:"meeting",appkey:this._appkey}}).then((e=>{})).catch((e=>{console.error("sendLog() failed: %o",e)}))}getOperatingSystemInfo(){const e=navigator.userAgent,t="Win32"==navigator.platform||"Windows"==navigator.platform,r="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(r)return"Mac";if("X11"==navigator.platform&&!t&&!r)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(t){if(e.indexOf("Windows NT 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Win2000";if(e.indexOf("Windows NT 5.1")>-1||e.indexOf("Windows XP")>-1)return"WinXP";if(e.indexOf("Windows NT 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Win2003";if(e.indexOf("Windows NT 6.0")>-1||e.indexOf("Windows Vista")>-1)return"WinVista";if(e.indexOf("Windows NT 6.1")>-1||e.indexOf("Windows 7")>-1)return"Win7";if(-1!=e.indexOf("Windows NT 10"))return"Win10"}return"other"}}var DataReporter$1={getInstance:e=>(reporter$1||(reporter$1=new DataReporter(e)),reporter$1),destroy(){reporter$1=null}};function throttle(e,t=1e3){let r=Date.now();return function(...n){const i=this;Date.now()-r>=t&&(e.apply(i,n),r=Date.now())}}function formatDate(e,t="yyyy/MM/dd hh:mm"){const r=new Date(e),n={"M+":r.getMonth()+1+"","d+":r.getDate()+"","h+":r.getHours()+"","m+":r.getMinutes()+"","s+":r.getSeconds()+"","q+":Math.floor((r.getMonth()+3)/3)+"",S:r.getMilliseconds()+""};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length)));for(const e in n)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[e]:("00"+n[e]).substr((""+n[e]).length)));return t}function copyElementValue(e,t){const r=document.createElement("input");r.setAttribute("readonly","readonly"),r.setAttribute("value",e),document.body.appendChild(r),r.setSelectionRange(0,9999),r.select(),document.execCommand("copy")&&(document.execCommand("copy"),console.log("复制成功"),t()),document.body.removeChild(r)}function getClientType(){const e=navigator.userAgent,t=e.indexOf("Android")>-1||e.indexOf("Adr")>-1,r=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return t?"Android":r?"IOS":"PC"}function getBrowserType(){const e=navigator.userAgent.toLowerCase();return e?e.match(/MicroMessenger/i)?BrowserType.WX:navigator.userAgent.indexOf("UCBrowser")>-1?BrowserType.UC:navigator.userAgent.indexOf("MQQBrowser")>-1?BrowserType.QQ:BrowserType.OTHER:BrowserType.UNKNOWN}function getIosVersion(){const e=navigator.userAgent.match(/(iPhone|iPad|iPod)\s+OS\s+([\d_]+)/);return e&&e[2]?e[2].replace(/_/g,"."):""}DataReporter$1.getInstance(),LoggerStorage.getInstance();const MeetingCanvas=e=>{const{className:t,onActiveIndexChanged:r}=e,[n,i]=react.exports.useState(4),[o,s]=react.exports.useState(0),{meetingInfo:a,memberList:c}=react.exports.useContext(MeetingInfoContext),[u,l]=react.exports.useState(0),[d,p]=react.exports.useState(0),[m,f]=react.exports.useState(!0),h=react.exports.useMemo((()=>a.screenUuid?"screen":"video"),[a.screenUuid]),g=react.exports.useMemo((()=>groupMembersService({memberList:c,groupNum:n,screenUuid:a.screenUuid,focusUuid:a.focusUuid,myUuid:a.localMember.uuid,activeSpeakerUuid:a.activeSpeakerUuid})),[c,c.length,a.hostUuid,a.focusUuid,a.activeSpeakerUuid,a.screenUuid]);return react.exports.useEffect((()=>{a.screenUuid&&s(0)}),[a.screenUuid]),react.exports.useEffect((()=>{r&&r(u),0!==u&&"IOS"===getClientType()&&(f(!1),setTimeout((()=>{f(!0)}),500))}),[u]),react.exports.useEffect((()=>{0===u&&setTimeout((()=>{p(Math.random())}),800)}),[g]),jsxRuntime.exports.jsxs("div",Object.assign({className:`meeting-canvas ${t}`},{children:[jsxRuntime.exports.jsx(Swiper,Object.assign({spaceBetween:50,slidesPerView:1,modules:[Pagination],pagination:m,className:"meeting-canvas-swiper h-full w-full",onActiveIndexChange:e=>l(e.activeIndex)},{children:g.map(((e,t)=>jsxRuntime.exports.jsx(SwiperSlide,Object.assign({className:"swiper-slide flex flex-wrap relative"},{children:0===t?e.map(((e,r)=>jsxRuntime.exports.jsx(VideoCard$1,{isMySelf:e.uuid===a.myUuid,isSubscribeVideo:t===u,isMain:0===r,type:0===r?h:"video",iosTime:r!==o?d:0,className:`${r===o?"full-screen-card":"small-video-card"} ${e.uuid===a.localMember.uuid?"local-member":""}`,onClick:t=>function(e,t,r){t!==o&&r.stopPropagation(),a.screenUuid!==e&&s(t)}(e.uuid,r,t),member:e},`${e.uuid}-main-${r}-${0===r?h:"video"}`))):e.map(((e,r)=>jsxRuntime.exports.jsx(VideoCard$1,{showBorder:a.focusUuid?a.focusUuid===e.uuid:a.activeSpeakerUuid===e.uuid,isSubscribeVideo:t===u,isMain:!1,isMySelf:e.uuid===a.myUuid,type:"video",className:"w-full h-full text-white w-1/2 h-1/2",member:e},e.uuid)))}),t)))})),(null==a?void 0:a.whiteboardUuid)&&jsxRuntime.exports.jsx(WhiteboardView$1,{className:"whiteboard-index"})]}))};var MeetingCanvas$1=React.memo(MeetingCanvas),css_248z$f=':root{--adm-radius-s:4px;--adm-radius-m:8px;--adm-radius-l:12px;--adm-font-size-1:9px;--adm-font-size-2:10px;--adm-font-size-3:11px;--adm-font-size-4:12px;--adm-font-size-5:13px;--adm-font-size-6:14px;--adm-font-size-7:15px;--adm-font-size-8:16px;--adm-font-size-9:17px;--adm-font-size-10:18px;--adm-color-primary:#1677ff;--adm-color-success:#00b578;--adm-color-warning:#ff8f1f;--adm-color-danger:#ff3141;--adm-color-text:#333;--adm-color-text-secondary:#666;--adm-color-weak:#999;--adm-color-light:#ccc;--adm-color-border:#eee;--adm-color-background:#fff;--adm-color-white:#fff;--adm-color-box:#f5f5f5;--adm-color-text-light-solid:var(--adm-color-white);--adm-color-text-dark-solid:#000;--adm-color-fill-content:var(--adm-color-box);--adm-font-size-main:var(--adm-font-size-5);--adm-font-family:-apple-system,blinkmacsystemfont,"Helvetica Neue",helvetica,segoe ui,arial,roboto,"PingFang SC","miui","Hiragino Sans GB","Microsoft Yahei",sans-serif;--adm-border-color:var(--adm-color-border)}html[data-prefers-color-scheme=dark]{--adm-color-primary:#3086ff;--adm-color-success:#34b368;--adm-color-warning:#ffa930;--adm-color-danger:#ff4a58;--adm-color-text:#e6e6e6;--adm-color-text-secondary:#b3b3b3;--adm-color-weak:grey;--adm-color-light:#4d4d4d;--adm-color-border:#2b2b2b;--adm-color-box:#0a0a0a;--adm-color-background:#1a1a1a;--adm-border-color:var(--adm-color-border)}:root{-webkit-tap-highlight-color:rgba(0,0,0,0)}body{color:var(--adm-color-text);font-family:var(--adm-font-family);font-size:var(--adm-font-size-main)}a,button{cursor:pointer}a{color:var(--adm-color-primary);transition:opacity .2s ease-in-out}a:active{opacity:.8}.adm-plain-anchor{color:unset;transition:none}.adm-plain-anchor:active{opacity:unset}body.adm-overflow-hidden{overflow:hidden!important}div.adm-px-tester{--size:1;bottom:-100vh;height:calc(var(--size)/2*2px);pointer-events:none;position:fixed;right:-100vw;-webkit-user-select:none;user-select:none;width:0}';styleInject(css_248z$f);const canUseDom=!("undefined"==typeof window||"undefined"==typeof document||!window.document||!window.document.createElement);function mergeLocale(e,t){return function e(t,r){if("object"!=typeof t||"object"!=typeof r||Array.isArray(t)||Array.isArray(r))return void 0!==r?r:t;const n={};for(const i in t)t.hasOwnProperty(i)&&(n[i]=e(t[i],r[i]));return n}(e,t)}canUseDom&&document.addEventListener("touchstart",(()=>{}),!0);const typeTemplate$1="${label} is not a valid ${type}",base={locale:"en",common:{confirm:"Confirm",cancel:"Cancel",loading:"Loading",close:"Close"},Calendar:{markItems:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],renderYearAndMonth:(e,t)=>`${e}/${t}`},Cascader:{placeholder:"Selecting"},Dialog:{ok:"OK"},DatePicker:{tillNow:"Till Now"},ErrorBlock:{default:{title:"Oops, something went wrong",description:"Please wait a minute and try again"},busy:{title:"Oops, not loading",description:"Try to refresh the page"},disconnected:{title:"Network is busy",description:"Try to refresh the page"},empty:{title:"Hmm, couldn't find that...",description:"Want to try a new search?"}},Form:{required:"Required",optional:"Optional",defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:typeTemplate$1,method:typeTemplate$1,array:typeTemplate$1,object:typeTemplate$1,number:typeTemplate$1,date:typeTemplate$1,boolean:typeTemplate$1,integer:typeTemplate$1,float:typeTemplate$1,regexp:typeTemplate$1,email:typeTemplate$1,url:typeTemplate$1,hex:typeTemplate$1},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},ImageUploader:{uploading:"Uploading...",upload:"Upload"},InfiniteScroll:{noMore:"No more",failedToLoad:"Failed to load",retry:"Retry"},Input:{clear:"clear"},Mask:{name:"Mask"},Modal:{ok:"OK"},PasscodeInput:{name:"Passcode Input"},PullToRefresh:{pulling:"Scroll down to refresh",canRelease:"Release to refresh immediately",complete:"Refresh successful"},SearchBar:{name:"Search Bar"},Slider:{name:"Slider"},Stepper:{decrease:"decrease",increase:"increase"},Switch:{name:"Switch"},Selector:{name:"Selector"}},typeTemplate="${label}不是一个有效的${type}",zhCN=mergeLocale(base,{locale:"zh-CH",common:{confirm:"确定",cancel:"取消",loading:"加载中",close:"关闭"},Calendar:{markItems:["一","二","三","四","五","六","日"],renderYearAndMonth:(e,t)=>`${e}年${t}月`},Cascader:{placeholder:"请选择"},Dialog:{ok:"我知道了"},DatePicker:{tillNow:"至今"},ErrorBlock:{default:{title:"页面遇到一些小问题",description:"待会来试试"},busy:{title:"前方拥堵",description:"刷新试试"},disconnected:{title:"网络有点忙",description:"动动手指帮忙修复"},empty:{title:"没有找到你需要的东西",description:"找找其他的吧"}},Form:{required:"必填",optional:"选填",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:typeTemplate,method:typeTemplate,array:typeTemplate,object:typeTemplate,number:typeTemplate,date:typeTemplate,boolean:typeTemplate,integer:typeTemplate,float:typeTemplate,regexp:typeTemplate,email:typeTemplate,url:typeTemplate,hex:typeTemplate},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},ImageUploader:{uploading:"上传中...",upload:"上传"},InfiniteScroll:{noMore:"没有更多了",failedToLoad:"加载失败",retry:"重新加载"},Input:{clear:"清除"},Mask:{name:"背景蒙层"},Modal:{ok:"我知道了"},PasscodeInput:{name:"密码输入框"},PullToRefresh:{pulling:"下拉刷新",canRelease:"释放立即刷新",complete:"刷新成功"},SearchBar:{name:"搜索框"},Slider:{name:"滑动输入条"},Stepper:{decrease:"减少",increase:"增加"},Switch:{name:"开关"},Selector:{name:"选择组"}});var zhCN$1=zhCN;const defaultConfigRef={current:{locale:zhCN$1}};function getDefaultConfig(){return defaultConfigRef.current}const ConfigContext=React.createContext(null);function useConfig(){var e;return null!==(e=react.exports.useContext(ConfigContext))&&void 0!==e?e:getDefaultConfig()}var css_248z$e=".adm-action-sheet-popup>.adm-popup-body{border-top-left-radius:8px;border-top-right-radius:8px;overflow:hidden}.adm-action-sheet-extra{color:var(--adm-color-weak);display:flex;font-size:var(--adm-font-size-7);justify-content:center;padding:18px 12px}.adm-action-sheet-button-item-wrapper,.adm-action-sheet-button-list,.adm-action-sheet-extra{border-bottom:1px solid var(--adm-color-border)}.adm-action-sheet-button-item-wrapper:last-child{border-bottom:none}.adm-action-sheet-button-item{background-color:var(--adm-color-background);display:block;padding:16px;text-align:center}.adm-action-sheet-button-item:active{background-color:#eee}.adm-action-sheet-button-item-disabled{cursor:not-allowed;opacity:.4;pointer-events:none}.adm-action-sheet-button-item-name{color:var(--adm-color-text);font-size:var(--adm-font-size-10)}.adm-action-sheet-button-item-description{color:var(--adm-color-weak);font-size:var(--adm-font-size-6);padding-top:4px}.adm-action-sheet-button-item-danger .adm-action-sheet-button-item-name{color:var(--adm-color-danger)}.adm-action-sheet-button-item-bold .adm-action-sheet-button-item-name{font-weight:700}.adm-action-sheet-cancel{background-color:var(--adm-color-fill-content);padding-top:8px}";function attachPropertiesToComponent(e,t){const r=e;for(const e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}styleInject(css_248z$e);var classnames={exports:{}};!function(e){!function(){var t={}.hasOwnProperty;function r(){for(var e=[],n=0;n<arguments.length;n++){var i=arguments[n];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)){if(i.length){var s=r.apply(null,i);s&&e.push(s)}}else if("object"===o){if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]")){e.push(i.toString());continue}for(var a in i)t.call(i,a)&&i[a]&&e.push(a)}}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):window.classNames=r}()}(classnames);var classNames=classnames.exports;function withNativeProps(e,t){const r=Object.assign({},t.props);e.className&&(r.className=classNames(t.props.className,e.className)),e.style&&(r.style=Object.assign(Object.assign({},r.style),e.style)),void 0!==e.tabIndex&&(r.tabIndex=e.tabIndex);for(const t in e)e.hasOwnProperty(t)&&(t.startsWith("data-")||t.startsWith("aria-"))&&(r[t]=e[t]);return React.cloneElement(t,r)}var freeGlobal$1="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root$2=freeGlobal||freeSelf||Function("return this")(),_root=root$2,root$1=_root,Symbol$3=root$1.Symbol,_Symbol=Symbol$3,Symbol$2=_Symbol,objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty,nativeObjectToString$1=objectProto$7.toString,symToStringTag$1=Symbol$2?Symbol$2.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$5.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch(e){}var i=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),i}var _getRawTag=getRawTag$1,objectProto$6=Object.prototype,nativeObjectToString=objectProto$6.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,Symbol$1=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag$3(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$3;function isObject$3(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var isObject_1=isObject$3,baseGetTag$2=_baseGetTag,isObject$2=isObject_1,asyncTag="[object AsyncFunction]",funcTag$1="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$2(e))return!1;var t=baseGetTag$2(e);return t==funcTag$1||t==genTag||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$2,root=_root,coreJsData$1=root["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""),uid?"Symbol(src)_1."+uid:""),uid;function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource$1(e){if(null!=e){try{return funcToString$1.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var _toSource=toSource$1,isFunction$1=isFunction_1,isMasked=_isMasked,isObject$1=isObject_1,toSource=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$5=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$4=objectProto$5.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$4).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){return!(!isObject$1(e)||isMasked(e))&&(isFunction$1(e)?reIsNative:reIsHostCtor).test(toSource(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return null==e?void 0:e[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$1(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$1,getNative=_getNative,defineProperty$2=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),_defineProperty$1=defineProperty$2,defineProperty$1=_defineProperty$1;function baseAssignValue$2(e,t,r){"__proto__"==t&&defineProperty$1?defineProperty$1(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var _baseAssignValue=baseAssignValue$2;function eq$2(e,t){return e===t||e!=e&&t!=t}var eq_1=eq$2,baseAssignValue$1=_baseAssignValue,eq$1=eq_1,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function assignValue$1(e,t,r){var n=e[t];hasOwnProperty$3.call(e,t)&&eq$1(n,r)&&(void 0!==r||t in e)||baseAssignValue$1(e,t,r)}var _assignValue=assignValue$1,assignValue=_assignValue,baseAssignValue=_baseAssignValue;function copyObject$1(e,t,r,n){var i=!r;r||(r={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=n?n(r[a],e[a],a,r,e):void 0;void 0===c&&(c=e[a]),i?baseAssignValue(r,a,c):assignValue(r,a,c)}return r}var _copyObject=copyObject$1;function identity$3(e){return e}var identity_1=identity$3;function apply$1(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _apply=apply$1,apply=_apply,nativeMax=Math.max;function overRest$1(e,t,r){return t=nativeMax(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=nativeMax(n.length-t,0),s=Array(o);++i<o;)s[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(s),apply(e,this,a)}}var _overRest=overRest$1;function constant$1(e){return function(){return e}}var constant_1=constant$1,constant=constant_1,defineProperty=_defineProperty$1,identity$2=identity_1,baseSetToString$1=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity$2,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(e){var t=0,r=0;return function(){var n=nativeNow(),i=HOT_SPAN-(n-r);if(r=n,i>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$1=shortOut(baseSetToString),_setToString=setToString$1,identity$1=identity_1,overRest=_overRest,setToString=_setToString;function baseRest$1(e,t){return setToString(overRest(e,t,identity$1),e+"")}var _baseRest=baseRest$1,MAX_SAFE_INTEGER$1=9007199254740991;function isLength$2(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$1}var isLength_1=isLength$2,isFunction=isFunction_1,isLength$1=isLength_1;function isArrayLike$2(e){return null!=e&&isLength$1(e.length)&&!isFunction(e)}var isArrayLike_1=isArrayLike$2,MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$2(e,t){var r=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$2,eq=eq_1,isArrayLike$1=isArrayLike_1,isIndex$1=_isIndex,isObject=isObject_1;function isIterateeCall$1(e,t,r){if(!isObject(r))return!1;var n=typeof t;return!!("number"==n?isArrayLike$1(r)&&isIndex$1(t,r.length):"string"==n&&t in r)&&eq(r[t],e)}var _isIterateeCall=isIterateeCall$1,baseRest=_baseRest,isIterateeCall=_isIterateeCall;function createAssigner$1(e){return baseRest((function(t,r){var n=-1,i=r.length,o=i>1?r[i-1]:void 0,s=i>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,s&&isIterateeCall(r[0],r[1],s)&&(o=i<3?void 0:o,i=1),t=Object(t);++n<i;){var a=r[n];a&&e(t,a,n,o)}return t}))}var _createAssigner=createAssigner$1;function baseTimes$1(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes$1;function isObjectLike$3(e){return null!=e&&"object"==typeof e}var isObjectLike_1=isObjectLike$3,baseGetTag$1=_baseGetTag,isObjectLike$2=isObjectLike_1,argsTag$1="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$2(e)&&baseGetTag$1(e)==argsTag$1}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$1=isObjectLike_1,objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,isArguments$1=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$1(e)&&hasOwnProperty$2.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArguments_1=isArguments$1,isArray$1=Array.isArray,isArray_1=isArray$1,isBuffer$1={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;!function(e,t){var r=_root,n=stubFalse_1,i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,s=o&&o.exports===i?r.Buffer:void 0,a=(s?s.isBuffer:void 0)||n;e.exports=a}(isBuffer$1,isBuffer$1.exports);var baseGetTag=_baseGetTag,isLength=isLength_1,isObjectLike=isObjectLike_1,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray$1(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$1(e){return function(t){return e(t)}}var _baseUnary=baseUnary$1,_nodeUtil={exports:{}};!function(e,t){var r=_freeGlobal,n=t&&!t.nodeType&&t,i=n&&e&&!e.nodeType&&e,o=i&&i.exports===n&&r.process,s=function(){try{var e=i&&i.require&&i.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=s}(_nodeUtil,_nodeUtil.exports);var baseIsTypedArray=_baseIsTypedArray,baseUnary=_baseUnary,nodeUtil=_nodeUtil.exports,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray$1=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$1,baseTimes=_baseTimes,isArguments=isArguments_1,isArray=isArray_1,isBuffer=isBuffer$1.exports,isIndex=_isIndex,isTypedArray=isTypedArray_1,objectProto$2=Object.prototype,hasOwnProperty$1=objectProto$2.hasOwnProperty;function arrayLikeKeys$1(e,t){var r=isArray(e),n=!r&&isArguments(e),i=!r&&!n&&isBuffer(e),o=!r&&!n&&!i&&isTypedArray(e),s=r||n||i||o,a=s?baseTimes(e.length,String):[],c=a.length;for(var u in e)!t&&!hasOwnProperty$1.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex(u,c))||a.push(u);return a}var _arrayLikeKeys=arrayLikeKeys$1,objectProto$1=Object.prototype;function isPrototype$1(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$1)}var _isPrototype=isPrototype$1;function overArg$1(e,t){return function(r){return e(t(r))}}var _overArg=overArg$1,overArg=_overArg,nativeKeys$1=overArg(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype=_isPrototype,nativeKeys=_nativeKeys,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseKeys$1(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty.call(e,r)&&"constructor"!=r&&t.push(r);return t}var _baseKeys=baseKeys$1,arrayLikeKeys=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike=isArrayLike_1;function keys$1(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}var keys_1=keys$1,copyObject=_copyObject,createAssigner=_createAssigner,keys=keys_1,assignWith=createAssigner((function(e,t,r,n){copyObject(t,keys(t),e,n)})),assignWith_1=assignWith;function mergeProps(...e){function t(e,t){return void 0===t?e:t}let r=Object.assign({},e[0]);for(let n=1;n<e.length;n++)r=assignWith_1(r,e[n],t);return r}var css_248z$d=".adm-popup{--z-index:var(--adm-popup-z-index,1000);position:fixed;z-index:var(--z-index)}.adm-popup-body{background-color:var(--adm-color-background);position:fixed;z-index:calc(var(--z-index) + 10)}.adm-popup-body .adm-popup-close-icon{position:absolute;z-index:100}.adm-popup-body-position-bottom{bottom:0;left:0;width:100%}.adm-popup-body-position-bottom .adm-popup-close-icon{right:8px;top:8px}.adm-popup-body-position-top{left:0;top:0;width:100%}.adm-popup-body-position-top .adm-popup-close-icon{bottom:8px;right:8px}.adm-popup-body-position-left{height:100%;left:0;top:0}.adm-popup-body-position-left .adm-popup-close-icon{right:8px;top:8px}.adm-popup-body-position-right{height:100%;right:0;top:0}.adm-popup-body-position-right .adm-popup-close-icon{left:8px;top:8px}.adm-popup-close-icon{color:var(--adm-color-weak);cursor:pointer;font-size:18px;line-height:1;padding:4px}";styleInject(css_248z$d);var isBrowser$1=!("undefined"==typeof window||!window.document||!window.document.createElement),isBrowser$2=isBrowser$1,useIsomorphicLayoutEffect$1=isBrowser$2?react.exports.useLayoutEffect:react.exports.useEffect,useIsomorphicLayoutEffect$2=useIsomorphicLayoutEffect$1,useUnmountedRef=function(){var e=react.exports.useRef(!1);return react.exports.useEffect((function(){return e.current=!1,function(){e.current=!0}}),[]),e},useUnmountedRef$1=useUnmountedRef,css_248z$c=".adm-mask{--z-index:var(--adm-mask-z-index,1000);display:block;position:fixed;z-index:var(--z-index)}.adm-mask,.adm-mask-aria-button{height:100%;left:0;top:0;width:100%}.adm-mask-aria-button{pointer-events:none;position:absolute;z-index:0}.adm-mask-content{z-index:1}";styleInject(css_248z$c);const MIN_DISTANCE=10;function getDirection(e,t){return e>t&&e>MIN_DISTANCE?"horizontal":t>e&&t>MIN_DISTANCE?"vertical":""}function useTouch(){const e=react.exports.useRef(0),t=react.exports.useRef(0),r=react.exports.useRef(0),n=react.exports.useRef(0),i=react.exports.useRef(0),o=react.exports.useRef(0),s=react.exports.useRef(""),a=()=>{r.current=0,n.current=0,i.current=0,o.current=0,s.current=""};return{move:a=>{const c=a.touches[0];r.current=c.clientX<0?0:c.clientX-e.current,n.current=c.clientY-t.current,i.current=Math.abs(r.current),o.current=Math.abs(n.current),s.current||(s.current=getDirection(i.current,o.current))},start:r=>{a(),e.current=r.touches[0].clientX,t.current=r.touches[0].clientY},reset:a,startX:e,startY:t,deltaX:r,deltaY:n,offsetX:i,offsetY:o,direction:s,isVertical:()=>"vertical"===s.current,isHorizontal:()=>"horizontal"===s.current}}const defaultRoot=canUseDom?window:void 0,overflowStylePatterns=["scroll","auto","overlay"];function isElement(e){return 1===e.nodeType}function getScrollParent(e,t=defaultRoot){let r=e;for(;r&&r!==t&&isElement(r);){if(r===document.body)return t;const{overflowY:e}=window.getComputedStyle(r);if(overflowStylePatterns.includes(e)&&r.scrollHeight>r.clientHeight)return r;r=r.parentNode}return t}let supportsPassive=!1;if(canUseDom)try{const e={};Object.defineProperty(e,"passive",{get(){supportsPassive=!0}}),window.addEventListener("test-passive",null,e)}catch(e){}let totalLockCount=0;const BODY_LOCK_CLASS="adm-overflow-hidden";function getScrollableElement(e){let t=null==e?void 0:e.parentElement;for(;t;){if(t.clientHeight<t.scrollHeight)return t;t=t.parentElement}return null}function useLockScroll(e,t){const r=useTouch(),n=n=>{r.move(n);const i=r.deltaY.current>0?"10":"01",o=getScrollParent(n.target,e.current);if(!o)return;if("strict"===t){const e=getScrollableElement(n.target);if(e===document.body||e===document.documentElement)return void n.preventDefault()}const{scrollHeight:s,offsetHeight:a,scrollTop:c}=o;let u="11";0===c?u=a>=s?"00":"01":c+a>=s&&(u="10"),"11"===u||!r.isVertical()||parseInt(u,2)&parseInt(i,2)||n.cancelable&&n.preventDefault()};react.exports.useEffect((()=>{if(t)return document.addEventListener("touchstart",r.start),document.addEventListener("touchmove",n,!!supportsPassive&&{passive:!1}),totalLockCount||document.body.classList.add(BODY_LOCK_CLASS),totalLockCount++,()=>{totalLockCount&&(document.removeEventListener("touchstart",r.start),document.removeEventListener("touchmove",n),totalLockCount--,totalLockCount||document.body.classList.remove(BODY_LOCK_CLASS))}}),[t])}let updateQueue=makeQueue();const raf=e=>schedule(e,updateQueue);let writeQueue=makeQueue();raf.write=e=>schedule(e,writeQueue);let onStartQueue=makeQueue();raf.onStart=e=>schedule(e,onStartQueue);let onFrameQueue=makeQueue();raf.onFrame=e=>schedule(e,onFrameQueue);let onFinishQueue=makeQueue();raf.onFinish=e=>schedule(e,onFinishQueue);let timeouts=[];raf.setTimeout=(e,t)=>{let r=raf.now()+t,n=()=>{let e=timeouts.findIndex((e=>e.cancel==n));~e&&timeouts.splice(e,1),pendingCount-=~e?1:0},i={time:r,handler:e,cancel:n};return timeouts.splice(findTimeout(r),0,i),pendingCount+=1,start(),i};let findTimeout=e=>~(~timeouts.findIndex((t=>t.time>e))||~timeouts.length);raf.cancel=e=>{onStartQueue.delete(e),onFrameQueue.delete(e),onFinishQueue.delete(e),updateQueue.delete(e),writeQueue.delete(e)},raf.sync=e=>{sync=!0,raf.batchedUpdates(e),sync=!1},raf.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function n(...e){t=e,raf.onStart(r)}return n.handler=e,n.cancel=()=>{onStartQueue.delete(r),t=null},n};let nativeRaf="undefined"!=typeof window?window.requestAnimationFrame:()=>{};raf.use=e=>nativeRaf=e,raf.now="undefined"!=typeof performance?()=>performance.now():Date.now,raf.batchedUpdates=e=>e(),raf.catch=console.error,raf.frameLoop="always",raf.advance=()=>{"demand"!==raf.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):update()};let ts=-1,pendingCount=0,sync=!1;function schedule(e,t){sync?(t.delete(e),e(0)):(t.add(e),start())}function start(){ts<0&&(ts=0,"demand"!==raf.frameLoop&&nativeRaf(loop))}function stop(){ts=-1}function loop(){~ts&&(nativeRaf(loop),raf.batchedUpdates(update))}function update(){let e=ts;ts=raf.now();let t=findTimeout(ts);t&&(eachSafely(timeouts.splice(0,t),(e=>e.handler())),pendingCount-=t),pendingCount?(onStartQueue.flush(),updateQueue.flush(e?Math.min(64,ts-e):16.667),onFrameQueue.flush(),writeQueue.flush(),onFinishQueue.flush()):stop()}function makeQueue(){let e=new Set,t=e;return{add(r){pendingCount+=t!=e||e.has(r)?0:1,e.add(r)},delete:r=>(pendingCount-=t==e&&e.has(r)?1:0,e.delete(r)),flush(r){t.size&&(e=new Set,pendingCount-=t.size,eachSafely(t,(t=>t(r)&&e.add(t))),pendingCount+=e.size,t=e)}}}function eachSafely(e,t){e.forEach((e=>{try{t(e)}catch(e){raf.catch(e)}}))}function noop$1(){}const defineHidden=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),is={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function isEqual(e,t){if(is.arr(e)){if(!is.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}const each=(e,t)=>e.forEach(t);function eachProp(e,t,r){if(is.arr(e))for(let n=0;n<e.length;n++)t.call(r,e[n],`${n}`);else for(const n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n)}const toArray=e=>is.und(e)?[]:is.arr(e)?e:[e];function flush(e,t){if(e.size){const r=Array.from(e);e.clear(),each(r,t)}}const flushCalls=(e,...t)=>flush(e,(e=>e(...t))),isSSR=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let createStringInterpolator$1,to,colors$1=null,skipAnimation=!1,willAdvance=noop$1;const assign=e=>{e.to&&(to=e.to),e.now&&(raf.now=e.now),void 0!==e.colors&&(colors$1=e.colors),null!=e.skipAnimation&&(skipAnimation=e.skipAnimation),e.createStringInterpolator&&(createStringInterpolator$1=e.createStringInterpolator),e.requestAnimationFrame&&raf.use(e.requestAnimationFrame),e.batchedUpdates&&(raf.batchedUpdates=e.batchedUpdates),e.willAdvance&&(willAdvance=e.willAdvance),e.frameLoop&&(raf.frameLoop=e.frameLoop)};var globals=Object.freeze({__proto__:null,get createStringInterpolator(){return createStringInterpolator$1},get to(){return to},get colors(){return colors$1},get skipAnimation(){return skipAnimation},get willAdvance(){return willAdvance},assign:assign});const startQueue=new Set;let currentFrame=[],prevFrame=[],priority=0;const frameLoop={get idle(){return!startQueue.size&&!currentFrame.length},start(e){priority>e.priority?(startQueue.add(e),raf.onStart(flushStartQueue)):(startSafely(e),raf(advance))},advance:advance,sort(e){if(priority)raf.onFrame((()=>frameLoop.sort(e)));else{const t=currentFrame.indexOf(e);~t&&(currentFrame.splice(t,1),startUnsafely(e))}},clear(){currentFrame=[],startQueue.clear()}};function flushStartQueue(){startQueue.forEach(startSafely),startQueue.clear(),raf(advance)}function startSafely(e){currentFrame.includes(e)||startUnsafely(e)}function startUnsafely(e){currentFrame.splice(findIndex(currentFrame,(t=>t.priority>e.priority)),0,e)}function advance(e){const t=prevFrame;for(let r=0;r<currentFrame.length;r++){const n=currentFrame[r];priority=n.priority,n.idle||(willAdvance(n),n.advance(e),n.idle||t.push(n))}return priority=0,prevFrame=currentFrame,prevFrame.length=0,currentFrame=t,currentFrame.length>0}function findIndex(e,t){const r=e.findIndex(t);return r<0?e.length:r}const clamp$1=(e,t,r)=>Math.min(Math.max(r,e),t),colors={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},NUMBER="[-+]?\\d*\\.?\\d+",PERCENTAGE=NUMBER+"%";function call$1(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const rgb=new RegExp("rgb"+call$1(NUMBER,NUMBER,NUMBER)),rgba=new RegExp("rgba"+call$1(NUMBER,NUMBER,NUMBER,NUMBER)),hsl=new RegExp("hsl"+call$1(NUMBER,PERCENTAGE,PERCENTAGE)),hsla=new RegExp("hsla"+call$1(NUMBER,PERCENTAGE,PERCENTAGE,NUMBER)),hex3=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex4=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6=/^#([0-9a-fA-F]{6})$/,hex8=/^#([0-9a-fA-F]{8})$/;function normalizeColor(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=hex6.exec(e))?parseInt(t[1]+"ff",16)>>>0:colors$1&&void 0!==colors$1[e]?colors$1[e]:(t=rgb.exec(e))?(parse255(t[1])<<24|parse255(t[2])<<16|parse255(t[3])<<8|255)>>>0:(t=rgba.exec(e))?(parse255(t[1])<<24|parse255(t[2])<<16|parse255(t[3])<<8|parse1(t[4]))>>>0:(t=hex3.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=hex8.exec(e))?parseInt(t[1],16)>>>0:(t=hex4.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=hsl.exec(e))?(255|hslToRgb(parse360(t[1]),parsePercentage(t[2]),parsePercentage(t[3])))>>>0:(t=hsla.exec(e))?(hslToRgb(parse360(t[1]),parsePercentage(t[2]),parsePercentage(t[3]))|parse1(t[4]))>>>0:null}function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function hslToRgb(e,t,r){const n=r<.5?r*(1+t):r+t-r*t,i=2*r-n,o=hue2rgb(i,n,e+1/3),s=hue2rgb(i,n,e),a=hue2rgb(i,n,e-1/3);return Math.round(255*o)<<24|Math.round(255*s)<<16|Math.round(255*a)<<8}function parse255(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function parse360(e){return(parseFloat(e)%360+360)%360/360}function parse1(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function parsePercentage(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function colorToRgba(e){let t=normalizeColor(e);return null===t?e:(t=t||0,`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`)}const createInterpolator=(e,t,r)=>{if(is.fun(e))return e;if(is.arr(e))return createInterpolator({range:e,output:t,extrapolate:r});if(is.str(e.output[0]))return createStringInterpolator$1(e);const n=e,i=n.output,o=n.range||[0,1],s=n.extrapolateLeft||n.extrapolate||"extend",a=n.extrapolateRight||n.extrapolate||"extend",c=n.easing||(e=>e);return e=>{const t=findRange(e,o);return interpolate(e,o[t],o[t+1],i[t],i[t+1],c,s,a,n.map)}};function interpolate(e,t,r,n,i,o,s,a,c){let u=c?c(e):e;if(u<t){if("identity"===s)return u;"clamp"===s&&(u=t)}if(u>r){if("identity"===a)return u;"clamp"===a&&(u=r)}return n===i?n:t===r?e<=t?n:i:(t===-1/0?u=-u:r===1/0?u-=t:u=(u-t)/(r-t),u=o(u),n===-1/0?u=-u:i===1/0?u+=n:u=u*(i-n)+n,u)}function findRange(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}const steps=(e,t="end")=>r=>{const n=(r="end"===t?Math.min(r,.999):Math.max(r,.001))*e,i="end"===t?Math.floor(n):Math.ceil(n);return clamp$1(0,1,i/e)},c1=1.70158,c2=1.525*c1,c3=c1+1,c4=2*Math.PI/3,c5=2*Math.PI/4.5,bounceOut=e=>{const t=7.5625,r=2.75;return e<1/r?t*e*e:e<2/r?t*(e-=1.5/r)*e+.75:e<2.5/r?t*(e-=2.25/r)*e+.9375:t*(e-=2.625/r)*e+.984375},easings={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>c3*e*e*e-c1*e*e,easeOutBack:e=>1+c3*Math.pow(e-1,3)+c1*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(2*(c2+1)*e-c2)/2:(Math.pow(2*e-2,2)*((c2+1)*(2*e-2)+c2)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*c4),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*c4)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*c5)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*c5)/2+1,easeInBounce:e=>1-bounceOut(1-e),easeOutBounce:bounceOut,easeInOutBounce:e=>e<.5?(1-bounceOut(1-2*e))/2:(1+bounceOut(2*e-1))/2,steps:steps};function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends$2.apply(this,arguments)}const $get=Symbol.for("FluidValue.get"),$observers=Symbol.for("FluidValue.observers"),hasFluidValue=e=>Boolean(e&&e[$get]),getFluidValue=e=>e&&e[$get]?e[$get]():e,getFluidObservers=e=>e[$observers]||null;function callFluidObserver(e,t){e.eventObserved?e.eventObserved(t):e(t)}function callFluidObservers(e,t){let r=e[$observers];r&&r.forEach((e=>{callFluidObserver(e,t)}))}class FluidValue{constructor(e){if(this[$get]=void 0,this[$observers]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");setFluidGetter(this,e)}}const setFluidGetter=(e,t)=>setHidden(e,$get,t);function addFluidObserver(e,t){if(e[$get]){let r=e[$observers];r||setHidden(e,$observers,r=new Set),r.has(t)||(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function removeFluidObserver(e,t){let r=e[$observers];if(r&&r.has(t)){const n=r.size-1;n?r.delete(t):e[$observers]=null,e.observerRemoved&&e.observerRemoved(n,t)}}const setHidden=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),numberRegex=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,colorRegex=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,unitRegex=new RegExp(`(${numberRegex.source})(%|[a-z]+)`,"i"),rgbaRegex=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,cssVariableRegex=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,variableToRgba=e=>{const[t,r]=parseCSSVariable(e);if(!t||isSSR())return e;const n=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(n)return n.trim();if(r&&r.startsWith("--")){const t=window.getComputedStyle(document.documentElement).getPropertyValue(r);return t||e}return r&&cssVariableRegex.test(r)?variableToRgba(r):r||e},parseCSSVariable=e=>{const t=cssVariableRegex.exec(e);if(!t)return[,];const[,r,n]=t;return[r,n]};let namedColorRegex;const rgbaRound=(e,t,r,n,i)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(n)}, ${i})`,createStringInterpolator=e=>{namedColorRegex||(namedColorRegex=colors$1?new RegExp(`(${Object.keys(colors$1).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map((e=>getFluidValue(e).replace(cssVariableRegex,variableToRgba).replace(colorRegex,colorToRgba).replace(namedColorRegex,colorToRgba))),r=t.map((e=>e.match(numberRegex).map(Number))),n=r[0].map(((e,t)=>r.map((e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})))).map((t=>createInterpolator(_extends$2({},e,{output:t}))));return e=>{var r;const i=!unitRegex.test(t[0])&&(null==(r=t.find((e=>unitRegex.test(e))))?void 0:r.replace(numberRegex,""));let o=0;return t[0].replace(numberRegex,(()=>`${n[o++](e)}${i||""}`)).replace(rgbaRegex,rgbaRound)}},prefix="react-spring: ",once=e=>{const t=e;let r=!1;if("function"!=typeof t)throw new TypeError(`${prefix}once requires a function parameter`);return(...e)=>{r||(t(...e),r=!0)}},warnInterpolate=once(console.warn);function deprecateInterpolate(){warnInterpolate(`${prefix}The "interpolate" function is deprecated in v9 (use "to" instead)`)}const warnDirectCall=once(console.warn);function deprecateDirectCall(){warnDirectCall(`${prefix}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function isAnimatedString(e){return is.str(e)&&("#"==e[0]||/\d/.test(e)||!isSSR()&&cssVariableRegex.test(e)||e in(colors$1||{}))}const useIsomorphicLayoutEffect=isSSR()?react.exports.useEffect:react.exports.useLayoutEffect,useIsMounted=()=>{const e=react.exports.useRef(!1);return useIsomorphicLayoutEffect((()=>(e.current=!0,()=>{e.current=!1})),[]),e};function useForceUpdate(){const e=react.exports.useState()[1],t=useIsMounted();return()=>{t.current&&e(Math.random())}}function useMemoOne(e,t){const[r]=react.exports.useState((()=>({inputs:t,result:e()}))),n=react.exports.useRef(),i=n.current;let o=i;if(o){Boolean(t&&o.inputs&&areInputsEqual(t,o.inputs))||(o={inputs:t,result:e()})}else o=r;return react.exports.useEffect((()=>{n.current=o,i==r&&(r.inputs=r.result=void 0)}),[o]),o.result}function areInputsEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const useOnce=e=>react.exports.useEffect(e,emptyDeps),emptyDeps=[];function usePrev(e){const t=react.exports.useRef();return react.exports.useEffect((()=>{t.current=e})),t.current}const $node=Symbol.for("Animated:node"),isAnimated=e=>!!e&&e[$node]===e,getAnimated=e=>e&&e[$node],setAnimated=(e,t)=>defineHidden(e,$node,t),getPayload=e=>e&&e[$node]&&e[$node].getPayload();class Animated{constructor(){this.payload=void 0,setAnimated(this,this)}getPayload(){return this.payload||[]}}class AnimatedValue extends Animated{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,is.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new AnimatedValue(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return is.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,is.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class AnimatedString extends AnimatedValue{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=createInterpolator({output:[e,e]})}static create(e){return new AnimatedString(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(is.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=createInterpolator({output:[this.getValue(),e]})),this._value=0,super.reset()}}const TreeContext={dependencies:null};class AnimatedObject extends Animated{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return eachProp(this.source,((r,n)=>{isAnimated(r)?t[n]=r.getValue(e):hasFluidValue(r)?t[n]=getFluidValue(r):e||(t[n]=r)})),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&each(this.payload,(e=>e.reset()))}_makePayload(e){if(e){const t=new Set;return eachProp(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){TreeContext.dependencies&&hasFluidValue(e)&&TreeContext.dependencies.add(e);const t=getPayload(e);t&&each(t,(e=>this.add(e)))}}class AnimatedArray extends AnimatedObject{constructor(e){super(e)}static create(e){return new AnimatedArray(e)}getValue(){return this.source.map((e=>e.getValue()))}setValue(e){const t=this.getPayload();return e.length==t.length?t.map(((t,r)=>t.setValue(e[r]))).some(Boolean):(super.setValue(e.map(makeAnimated)),!0)}}function makeAnimated(e){return(isAnimatedString(e)?AnimatedString:AnimatedValue).create(e)}function getAnimatedType(e){const t=getAnimated(e);return t?t.constructor:is.arr(e)?AnimatedArray:isAnimatedString(e)?AnimatedString:AnimatedValue}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends$1.apply(this,arguments)}const withAnimated=(e,t)=>{const r=!is.fun(e)||e.prototype&&e.prototype.isReactComponent;return react.exports.forwardRef(((n,i)=>{const o=react.exports.useRef(null),s=r&&react.exports.useCallback((e=>{o.current=updateRef(i,e)}),[i]),[a,c]=getAnimatedState(n,t),u=useForceUpdate(),l=()=>{const e=o.current;if(r&&!e)return;!1===(!!e&&t.applyAnimatedValues(e,a.getValue(!0)))&&u()},d=new PropsObserver(l,c),p=react.exports.useRef();useIsomorphicLayoutEffect((()=>(p.current=d,each(c,(e=>addFluidObserver(e,d))),()=>{p.current&&(each(p.current.deps,(e=>removeFluidObserver(e,p.current))),raf.cancel(p.current.update))}))),react.exports.useEffect(l,[]),useOnce((()=>()=>{const e=p.current;each(e.deps,(t=>removeFluidObserver(t,e)))}));const m=t.getComponentProps(a.getValue());return react.exports.createElement(e,_extends$1({},m,{ref:s}))}))};class PropsObserver{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&raf.write(this.update)}}function getAnimatedState(e,t){const r=new Set;return TreeContext.dependencies=r,e.style&&(e=_extends$1({},e,{style:t.createAnimatedStyle(e.style)})),e=new AnimatedObject(e),TreeContext.dependencies=null,[e,r]}function updateRef(e,t){return e&&(is.fun(e)?e(t):e.current=t),t}const cacheKey=Symbol.for("AnimatedComponent"),createHost=(e,{applyAnimatedValues:t=(()=>!1),createAnimatedStyle:r=(e=>new AnimatedObject(e)),getComponentProps:n=(e=>e)}={})=>{const i={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:n},o=e=>{const t=getDisplayName(e)||"Anonymous";return(e=is.str(e)?o[e]||(o[e]=withAnimated(e,i)):e[cacheKey]||(e[cacheKey]=withAnimated(e,i))).displayName=`Animated(${t})`,e};return eachProp(e,((t,r)=>{is.arr(e)&&(r=getDisplayName(t)),o[r]=o(t)})),{animated:o}},getDisplayName=e=>is.str(e)?e:e&&is.str(e.displayName)?e.displayName:is.fun(e)&&e.name||null;function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}function callProp(e,...t){return is.fun(e)?e(...t):e}const matchProp=(e,t)=>!0===e||!!(t&&e&&(is.fun(e)?e(t):toArray(e).includes(t))),resolveProp=(e,t)=>is.obj(e)?t&&e[t]:e,getDefaultProp=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,noopTransform=e=>e,getDefaultProps=(e,t=noopTransform)=>{let r=DEFAULT_PROPS;e.default&&!0!==e.default&&(e=e.default,r=Object.keys(e));const n={};for(const i of r){const r=t(e[i],i);is.und(r)||(n[i]=r)}return n},DEFAULT_PROPS=["config","onProps","onStart","onChange","onPause","onResume","onRest"],RESERVED_PROPS={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function getForwardProps(e){const t={};let r=0;if(eachProp(e,((e,n)=>{RESERVED_PROPS[n]||(t[n]=e,r++)})),r)return t}function inferTo(e){const t=getForwardProps(e);if(t){const r={to:t};return eachProp(e,((e,n)=>n in t||(r[n]=e))),r}return _extends({},e)}function computeGoal(e){return e=getFluidValue(e),is.arr(e)?e.map(computeGoal):isAnimatedString(e)?globals.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function hasProps(e){for(const t in e)return!0;return!1}function isAsyncTo(e){return is.fun(e)||is.arr(e)&&is.obj(e[0])}function detachRefs(e,t){var r;null==(r=e.ref)||r.delete(e),null==t||t.delete(e)}function replaceRef(e,t){var r;t&&e.ref!==t&&(null==(r=e.ref)||r.delete(e),t.add(e),e.ref=t)}const config={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},defaults=_extends({},config.default,{mass:1,damping:1,easing:easings.linear,clamp:!1});class AnimationConfig{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,defaults)}}function mergeConfig(e,t,r){r&&(sanitizeConfig(r=_extends({},r),t),t=_extends({},r,t)),sanitizeConfig(e,t),Object.assign(e,t);for(const t in defaults)null==e[t]&&(e[t]=defaults[t]);let{mass:n,frequency:i,damping:o}=e;return is.und(i)||(i<.01&&(i=.01),o<0&&(o=0),e.tension=Math.pow(2*Math.PI/i,2)*n,e.friction=4*Math.PI*o*n/i),e}function sanitizeConfig(e,t){if(is.und(t.decay)){const r=!is.und(t.tension)||!is.und(t.friction);!r&&is.und(t.frequency)&&is.und(t.damping)&&is.und(t.mass)||(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}else e.duration=void 0}const emptyArray=[];class Animation{constructor(){this.changed=!1,this.values=emptyArray,this.toValues=null,this.fromValues=emptyArray,this.to=void 0,this.from=void 0,this.config=new AnimationConfig,this.immediate=!1}}function scheduleProps(e,{key:t,props:r,defaultProps:n,state:i,actions:o}){return new Promise(((s,a)=>{var c;let u,l,d=matchProp(null!=(c=r.cancel)?c:null==n?void 0:n.cancel,t);if(d)f();else{is.und(r.pause)||(i.paused=matchProp(r.pause,t));let e=null==n?void 0:n.pause;!0!==e&&(e=i.paused||matchProp(e,t)),u=callProp(r.delay||0,t),e?(i.resumeQueue.add(m),o.pause()):(o.resume(),m())}function p(){i.resumeQueue.add(m),i.timeouts.delete(l),l.cancel(),u=l.time-raf.now()}function m(){u>0&&!globals.skipAnimation?(i.delayed=!0,l=raf.setTimeout(f,u),i.pauseQueue.add(p),i.timeouts.add(l)):f()}function f(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(p),i.timeouts.delete(l),e<=(i.cancelId||0)&&(d=!0);try{o.start(_extends({},r,{callId:e,cancel:d}),s)}catch(e){a(e)}}}))}const getCombinedResult=(e,t)=>1==t.length?t[0]:t.some((e=>e.cancelled))?getCancelledResult(e.get()):t.every((e=>e.noop))?getNoopResult(e.get()):getFinishedResult(e.get(),t.every((e=>e.finished))),getNoopResult=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),getFinishedResult=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),getCancelledResult=e=>({value:e,cancelled:!0,finished:!1});function runAsync(e,t,r,n){const{callId:i,parentId:o,onRest:s}=t,{asyncTo:a,promise:c}=r;return o||e!==a||t.reset?r.promise=(async()=>{r.asyncId=i,r.asyncTo=e;const u=getDefaultProps(t,((e,t)=>"onRest"===t?void 0:e));let l,d;const p=new Promise(((e,t)=>(l=e,d=t))),m=e=>{const t=i<=(r.cancelId||0)&&getCancelledResult(n)||i!==r.asyncId&&getFinishedResult(n,!1);if(t)throw e.result=t,d(e),e},f=(e,t)=>{const o=new BailSignal,s=new SkipAnimationSignal;return(async()=>{if(globals.skipAnimation)throw stopAsync(r),s.result=getFinishedResult(n,!1),d(s),s;m(o);const a=is.obj(e)?_extends({},e):_extends({},t,{to:e});a.parentId=i,eachProp(u,((e,t)=>{is.und(a[t])&&(a[t]=e)}));const c=await n.start(a);return m(o),r.paused&&await new Promise((e=>{r.resumeQueue.add(e)})),c})()};let h;if(globals.skipAnimation)return stopAsync(r),getFinishedResult(n,!1);try{let t;t=is.arr(e)?(async e=>{for(const t of e)await f(t)})(e):Promise.resolve(e(f,n.stop.bind(n))),await Promise.all([t.then(l),p]),h=getFinishedResult(n.get(),!0,!1)}catch(e){if(e instanceof BailSignal)h=e.result;else{if(!(e instanceof SkipAnimationSignal))throw e;h=e.result}}finally{i==r.asyncId&&(r.asyncId=o,r.asyncTo=o?a:void 0,r.promise=o?c:void 0)}return is.fun(s)&&raf.batchedUpdates((()=>{s(h,n,n.item)})),h})():c}function stopAsync(e,t){flush(e.timeouts,(e=>e.cancel())),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class BailSignal extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class SkipAnimationSignal extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const isFrameValue=e=>e instanceof FrameValue;let nextId$1=1;class FrameValue extends FluidValue{constructor(...e){super(...e),this.id=nextId$1++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=getAnimated(this);return e&&e.getValue()}to(...e){return globals.to(this,e)}interpolate(...e){return deprecateInterpolate(),globals.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){callFluidObservers(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||frameLoop.sort(this),callFluidObservers(this,{type:"priority",parent:this,priority:e})}}const $P=Symbol.for("SpringPhase"),HAS_ANIMATED=1,IS_ANIMATING=2,IS_PAUSED=4,hasAnimated=e=>(e[$P]&HAS_ANIMATED)>0,isAnimating=e=>(e[$P]&IS_ANIMATING)>0,isPaused=e=>(e[$P]&IS_PAUSED)>0,setActiveBit=(e,t)=>t?e[$P]|=IS_ANIMATING|HAS_ANIMATED:e[$P]&=~IS_ANIMATING,setPausedBit=(e,t)=>t?e[$P]|=IS_PAUSED:e[$P]&=~IS_PAUSED;class SpringValue extends FrameValue{constructor(e,t){if(super(),this.key=void 0,this.animation=new Animation,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!is.und(e)||!is.und(t)){const r=is.obj(e)?_extends({},e):_extends({},t,{from:e});is.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(isAnimating(this)||this._state.asyncTo)||isPaused(this)}get goal(){return getFluidValue(this.animation.to)}get velocity(){const e=getAnimated(this);return e instanceof AnimatedValue?e.lastVelocity||0:e.getPayload().map((e=>e.lastVelocity||0))}get hasAnimated(){return hasAnimated(this)}get isAnimating(){return isAnimating(this)}get isPaused(){return isPaused(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1;const n=this.animation;let{config:i,toValues:o}=n;const s=getPayload(n.to);!s&&hasFluidValue(n.to)&&(o=toArray(getFluidValue(n.to))),n.values.forEach(((a,c)=>{if(a.done)return;const u=a.constructor==AnimatedString?1:s?s[c].lastPosition:o[c];let l=n.immediate,d=u;if(!l){if(d=a.lastPosition,i.tension<=0)return void(a.done=!0);let t=a.elapsedTime+=e;const r=n.fromValues[c],o=null!=a.v0?a.v0:a.v0=is.arr(i.velocity)?i.velocity[c]:i.velocity;let s;const p=i.precision||(r==u?.005:Math.min(1,.001*Math.abs(u-r)));if(is.und(i.duration))if(i.decay){const e=!0===i.decay?.998:i.decay,n=Math.exp(-(1-e)*t);d=r+o/(1-e)*(1-n),l=Math.abs(a.lastPosition-d)<=p,s=o*n}else{s=null==a.lastVelocity?o:a.lastVelocity;const t=i.restVelocity||p/10,n=i.clamp?0:i.bounce,c=!is.und(n),m=r==u?a.v0>0:r<u;let f,h=!1;const g=1,v=Math.ceil(e/g);for(let e=0;e<v&&(f=Math.abs(s)>t,f||(l=Math.abs(u-d)<=p,!l));++e){c&&(h=d==u||d>u==m,h&&(s=-s*n,d=u));s+=(1e-6*-i.tension*(d-u)+.001*-i.friction*s)/i.mass*g,d+=s*g}}else{let n=1;i.duration>0&&(this._memoizedDuration!==i.duration&&(this._memoizedDuration=i.duration,a.durationProgress>0&&(a.elapsedTime=i.duration*a.durationProgress,t=a.elapsedTime+=e)),n=(i.progress||0)+t/this._memoizedDuration,n=n>1?1:n<0?0:n,a.durationProgress=n),d=r+i.easing(n)*(u-r),s=(d-a.lastPosition)/e,l=1==n}a.lastVelocity=s,Number.isNaN(d)&&(console.warn("Got NaN while animating:",this),l=!0)}s&&!s[c].done&&(l=!1),l?a.done=!0:t=!1,a.setValue(d,i.round)&&(r=!0)}));const a=getAnimated(this),c=a.getValue();if(t){const e=getFluidValue(n.to);c===e&&!r||i.decay?r&&i.decay&&this._onChange(c):(a.setValue(e),this._onChange(e)),this._stop()}else r&&this._onChange(c)}set(e){return raf.batchedUpdates((()=>{this._stop(),this._focus(e),this._set(e)})),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(isAnimating(this)){const{to:e,config:t}=this.animation;raf.batchedUpdates((()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()}))}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return is.und(e)?(r=this.queue||[],this.queue=[]):r=[is.obj(e)?e:_extends({},t,{to:e})],Promise.all(r.map((e=>this._update(e)))).then((e=>getCombinedResult(this,e)))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),stopAsync(this._state,e&&this._lastCallId),raf.batchedUpdates((()=>this._stop(t,e))),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:r,from:n}=e;r=is.obj(r)?r[t]:r,(null==r||isAsyncTo(r))&&(r=void 0),n=is.obj(n)?n[t]:n,null==n&&(n=void 0);const i={to:r,from:n};return hasAnimated(this)||(e.reverse&&([r,n]=[n,r]),n=getFluidValue(n),is.und(n)?getAnimated(this)||this._set(r):this._set(n)),i}_update(e,t){let r=_extends({},e);const{key:n,defaultProps:i}=this;r.default&&Object.assign(i,getDefaultProps(r,((e,t)=>/^on/.test(t)?resolveProp(e,n):e))),mergeActiveFn(this,r,"onProps"),sendEvent(this,"onProps",r,this);const o=this._prepareNode(r);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return scheduleProps(++this._lastCallId,{key:n,props:r,defaultProps:i,state:s,actions:{pause:()=>{isPaused(this)||(setPausedBit(this,!0),flushCalls(s.pauseQueue),sendEvent(this,"onPause",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},resume:()=>{isPaused(this)&&(setPausedBit(this,!1),isAnimating(this)&&this._resume(),flushCalls(s.resumeQueue),sendEvent(this,"onResume",getFinishedResult(this,checkFinished(this,this.animation.to)),this))},start:this._merge.bind(this,o)}}).then((e=>{if(r.loop&&e.finished&&(!t||!e.noop)){const e=createLoopUpdate(r);if(e)return this._update(e,!0)}return e}))}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(getCancelledResult(this));const n=!is.und(e.to),i=!is.und(e.from);if(n||i){if(!(t.callId>this._lastToId))return r(getCancelledResult(this));this._lastToId=t.callId}const{key:o,defaultProps:s,animation:a}=this,{to:c,from:u}=a;let{to:l=c,from:d=u}=e;!i||n||t.default&&!is.und(l)||(l=d),t.reverse&&([l,d]=[d,l]);const p=!isEqual(d,u);p&&(a.from=d),d=getFluidValue(d);const m=!isEqual(l,c);m&&this._focus(l);const f=isAsyncTo(t.to),{config:h}=a,{decay:g,velocity:v}=h;(n||i)&&(h.velocity=0),t.config&&!f&&mergeConfig(h,callProp(t.config,o),t.config!==s.config?callProp(s.config,o):void 0);let y=getAnimated(this);if(!y||is.und(l))return r(getFinishedResult(this,!0));const b=is.und(t.reset)?i&&!t.default:!is.und(d)&&matchProp(t.reset,o),S=b?d:this.get(),T=computeGoal(l),_=is.num(T)||is.arr(T)||isAnimatedString(T),w=!f&&(!_||matchProp(s.immediate||t.immediate,o));if(m){const e=getAnimatedType(l);if(e!==y.constructor){if(!w)throw Error(`Cannot animate between ${y.constructor.name} and ${e.name}, as the "to" prop suggests`);y=this._set(T)}}const M=y.constructor;let x=hasFluidValue(l),E=!1;if(!x){const e=b||!hasAnimated(this)&&p;(m||e)&&(E=isEqual(computeGoal(S),T),x=!E),(isEqual(a.immediate,w)||w)&&isEqual(h.decay,g)&&isEqual(h.velocity,v)||(x=!0)}if(E&&isAnimating(this)&&(a.changed&&!b?x=!0:x||this._stop(c)),!f&&((x||hasFluidValue(c))&&(a.values=y.getPayload(),a.toValues=hasFluidValue(l)?null:M==AnimatedString?[1]:toArray(T)),a.immediate!=w&&(a.immediate=w,w||b||this._set(c)),x)){const{onRest:e}=a;each(ACTIVE_EVENTS,(e=>mergeActiveFn(this,t,e)));const n=getFinishedResult(this,checkFinished(this,c));flushCalls(this._pendingCalls,n),this._pendingCalls.add(r),a.changed&&raf.batchedUpdates((()=>{a.changed=!b,null==e||e(n,this),b?callProp(s.onRest,n):null==a.onStart||a.onStart(n,this)}))}b&&this._set(S),f?r(runAsync(t.to,t,this._state,this)):x?this._start():isAnimating(this)&&!m?this._pendingCalls.add(r):r(getNoopResult(S))}_focus(e){const t=this.animation;e!==t.to&&(getFluidObservers(this)&&this._detach(),t.to=e,getFluidObservers(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;hasFluidValue(t)&&(addFluidObserver(t,this),isFrameValue(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;hasFluidValue(e)&&removeFluidObserver(e,this)}_set(e,t=!0){const r=getFluidValue(e);if(!is.und(r)){const e=getAnimated(this);if(!e||!isEqual(r,e.getValue())){const n=getAnimatedType(r);e&&e.constructor==n?e.setValue(r):setAnimated(this,n.create(r)),e&&raf.batchedUpdates((()=>{this._onChange(r,t)}))}}return getAnimated(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,sendEvent(this,"onStart",getFinishedResult(this,checkFinished(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),callProp(this.animation.onChange,e,this)),callProp(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;getAnimated(this).reset(getFluidValue(e.to)),e.immediate||(e.fromValues=e.values.map((e=>e.lastPosition))),isAnimating(this)||(setActiveBit(this,!0),isPaused(this)||this._resume())}_resume(){globals.skipAnimation?this.finish():frameLoop.start(this)}_stop(e,t){if(isAnimating(this)){setActiveBit(this,!1);const r=this.animation;each(r.values,(e=>{e.done=!0})),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),callFluidObservers(this,{type:"idle",parent:this});const n=t?getCancelledResult(this.get()):getFinishedResult(this.get(),checkFinished(this,null!=e?e:r.to));flushCalls(this._pendingCalls,n),r.changed&&(r.changed=!1,sendEvent(this,"onRest",n,this))}}}function checkFinished(e,t){const r=computeGoal(t);return isEqual(computeGoal(e.get()),r)}function createLoopUpdate(e,t=e.loop,r=e.to){let n=callProp(t);if(n){const i=!0!==n&&inferTo(n),o=(i||e).reverse,s=!i||i.reset;return createUpdate(_extends({},e,{loop:t,default:!1,pause:void 0,to:!o||isAsyncTo(r)?r:void 0,from:s?e.from:void 0,reset:s},i))}}function createUpdate(e){const{to:t,from:r}=e=inferTo(e),n=new Set;return is.obj(t)&&findDefined(t,n),is.obj(r)&&findDefined(r,n),e.keys=n.size?Array.from(n):null,e}function declareUpdate(e){const t=createUpdate(e);return is.und(t.default)&&(t.default=getDefaultProps(t)),t}function findDefined(e,t){eachProp(e,((e,r)=>null!=e&&t.add(r)))}const ACTIVE_EVENTS=["onStart","onRest","onChange","onPause","onResume"];function mergeActiveFn(e,t,r){e.animation[r]=t[r]!==getDefaultProp(t,r)?resolveProp(t[r],e.key):void 0}function sendEvent(e,t,...r){var n,i,o,s;null==(n=(i=e.animation)[t])||n.call(i,...r),null==(o=(s=e.defaultProps)[t])||o.call(s,...r)}const BATCHED_EVENTS=["onStart","onChange","onRest"];let nextId=1;class Controller$1{constructor(e,t){this.id=nextId++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(_extends({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every((e=>e.idle&&!e.isDelayed&&!e.isPaused))}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each(((t,r)=>e[r]=t.get())),e}set(e){for(const t in e){const r=e[t];is.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(createUpdate(e)),this}start(e){let{queue:t}=this;return e?t=toArray(e).map(createUpdate):this.queue=[],this._flush?this._flush(this,t):(prepareKeys(this,t),flushUpdateQueue(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const r=this.springs;each(toArray(t),(t=>r[t].stop(!!e)))}else stopAsync(this._state,this._lastAsyncId),this.each((t=>t.stop(!!e)));return this}pause(e){if(is.und(e))this.start({pause:!0});else{const t=this.springs;each(toArray(e),(e=>t[e].pause()))}return this}resume(e){if(is.und(e))this.start({pause:!1});else{const t=this.springs;each(toArray(e),(e=>t[e].resume()))}return this}each(e){eachProp(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:r}=this._events,n=this._active.size>0,i=this._changed.size>0;(n&&!this._started||i&&!this._started)&&(this._started=!0,flush(e,(([e,t])=>{t.value=this.get(),e(t,this,this._item)})));const o=!n&&this._started,s=i||o&&r.size?this.get():null;i&&t.size&&flush(t,(([e,t])=>{t.value=s,e(t,this,this._item)})),o&&(this._started=!1,flush(r,(([e,t])=>{t.value=s,e(t,this,this._item)})))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}raf.onFrame(this._onFrame)}}function flushUpdateQueue(e,t){return Promise.all(t.map((t=>flushUpdate(e,t)))).then((t=>getCombinedResult(e,t)))}async function flushUpdate(e,t,r){const{keys:n,to:i,from:o,loop:s,onRest:a,onResolve:c}=t,u=is.obj(t.default)&&t.default;s&&(t.loop=!1),!1===i&&(t.to=null),!1===o&&(t.from=null);const l=is.arr(i)||is.fun(i)?i:void 0;l?(t.to=void 0,t.onRest=void 0,u&&(u.onRest=void 0)):each(BATCHED_EVENTS,(r=>{const n=t[r];if(is.fun(n)){const i=e._events[r];t[r]=({finished:e,cancelled:t})=>{const r=i.get(n);r?(e||(r.finished=!1),t&&(r.cancelled=!0)):i.set(n,{value:null,finished:e||!1,cancelled:t||!1})},u&&(u[r]=t[r])}}));const d=e._state;t.pause===!d.paused?(d.paused=t.pause,flushCalls(t.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(t.pause=!0);const p=(n||Object.keys(e.springs)).map((r=>e.springs[r].start(t))),m=!0===t.cancel||!0===getDefaultProp(t,"cancel");(l||m&&d.asyncId)&&p.push(scheduleProps(++e._lastAsyncId,{props:t,state:d,actions:{pause:noop$1,resume:noop$1,start(t,r){m?(stopAsync(d,e._lastAsyncId),r(getCancelledResult(e))):(t.onRest=a,r(runAsync(l,t,d,e)))}}})),d.paused&&await new Promise((e=>{d.resumeQueue.add(e)}));const f=getCombinedResult(e,await Promise.all(p));if(s&&f.finished&&(!r||!f.noop)){const r=createLoopUpdate(t,s,i);if(r)return prepareKeys(e,[r]),flushUpdate(e,r,!0)}return c&&raf.batchedUpdates((()=>c(f,e,e.item))),f}function getSprings(e,t){const r=_extends({},e.springs);return t&&each(toArray(t),(e=>{is.und(e.keys)&&(e=createUpdate(e)),is.obj(e.to)||(e=_extends({},e,{to:void 0})),prepareSprings(r,e,(e=>createSpring(e)))})),setSprings(e,r),r}function setSprings(e,t){eachProp(t,((t,r)=>{e.springs[r]||(e.springs[r]=t,addFluidObserver(t,e))}))}function createSpring(e,t){const r=new SpringValue;return r.key=e,t&&addFluidObserver(r,t),r}function prepareSprings(e,t,r){t.keys&&each(t.keys,(n=>{(e[n]||(e[n]=r(n)))._prepareNode(t)}))}function prepareKeys(e,t){each(t,(t=>{prepareSprings(e.springs,t,(t=>createSpring(t,e)))}))}function _objectWithoutPropertiesLoose$2(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}const _excluded$6=["children"],SpringContext=e=>{let{children:t}=e,r=_objectWithoutPropertiesLoose$2(e,_excluded$6);const n=react.exports.useContext(ctx),i=r.pause||!!n.pause,o=r.immediate||!!n.immediate;r=useMemoOne((()=>({pause:i,immediate:o})),[i,o]);const{Provider:s}=ctx;return react.exports.createElement(s,{value:r},t)},ctx=makeContext(SpringContext,{});function makeContext(e,t){return Object.assign(e,react.exports.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}SpringContext.Provider=ctx.Provider,SpringContext.Consumer=ctx.Consumer;const SpringRef=()=>{const e=[],t=function(t){deprecateDirectCall();const n=[];return each(e,((e,i)=>{if(is.und(t))n.push(e.start());else{const o=r(t,e,i);o&&n.push(e.start(o))}})),n};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const r=e.indexOf(t);~r&&e.splice(r,1)},t.pause=function(){return each(e,(e=>e.pause(...arguments))),this},t.resume=function(){return each(e,(e=>e.resume(...arguments))),this},t.set=function(t){each(e,(e=>e.set(t)))},t.start=function(t){const r=[];return each(e,((e,n)=>{if(is.und(t))r.push(e.start());else{const i=this._getProps(t,e,n);i&&r.push(e.start(i))}})),r},t.stop=function(){return each(e,(e=>e.stop(...arguments))),this},t.update=function(t){return each(e,((e,r)=>e.update(this._getProps(t,e,r)))),this};const r=function(e,t,r){return is.fun(e)?e(r,t):e};return t._getProps=r,t};function useSprings(e,t,r){const n=is.fun(t)&&t;n&&!r&&(r=[]);const i=react.exports.useMemo((()=>n||3==arguments.length?SpringRef():void 0),[]),o=react.exports.useRef(0),s=useForceUpdate(),a=react.exports.useMemo((()=>({ctrls:[],queue:[],flush(e,t){const r=getSprings(e,t);return o.current>0&&!a.queue.length&&!Object.keys(r).some((t=>!e.springs[t]))?flushUpdateQueue(e,t):new Promise((n=>{setSprings(e,r),a.queue.push((()=>{n(flushUpdateQueue(e,t))})),s()}))}})),[]),c=react.exports.useRef([...a.ctrls]),u=[],l=usePrev(e)||0;function d(e,r){for(let i=e;i<r;i++){const e=c.current[i]||(c.current[i]=new Controller$1(null,a.flush)),r=n?n(i,e):t[i];r&&(u[i]=declareUpdate(r))}}react.exports.useMemo((()=>{each(c.current.slice(e,l),(e=>{detachRefs(e,i),e.stop(!0)})),c.current.length=e,d(l,e)}),[e]),react.exports.useMemo((()=>{d(0,Math.min(l,e))}),r);const p=c.current.map(((e,t)=>getSprings(e,u[t]))),m=react.exports.useContext(SpringContext),f=usePrev(m),h=m!==f&&hasProps(m);useIsomorphicLayoutEffect((()=>{o.current++,a.ctrls=c.current;const{queue:e}=a;e.length&&(a.queue=[],each(e,(e=>e()))),each(c.current,((e,t)=>{null==i||i.add(e),h&&e.start({default:m});const r=u[t];r&&(replaceRef(e,r.ref),e.ref?e.queue.push(r):e.start(r))}))})),useOnce((()=>()=>{each(a.ctrls,(e=>e.stop(!0)))}));const g=p.map((e=>_extends({},e)));return i?[g,i]:g}function useSpring(e,t){const r=is.fun(e),[[n],i]=useSprings(1,r?e:[e],r?t||[]:t);return r||2==arguments.length?[n,i]:n}let TransitionPhase;!function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"}(TransitionPhase||(TransitionPhase={}));class Interpolation extends FrameValue{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=createInterpolator(...t);const r=this._get(),n=getAnimatedType(r);setAnimated(this,n.create(r))}advance(e){const t=this._get();isEqual(t,this.get())||(getAnimated(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&checkIdle(this._active)&&becomeIdle(this)}_get(){const e=is.arr(this.source)?this.source.map(getFluidValue):toArray(getFluidValue(this.source));return this.calc(...e)}_start(){this.idle&&!checkIdle(this._active)&&(this.idle=!1,each(getPayload(this),(e=>{e.done=!1})),globals.skipAnimation?(raf.batchedUpdates((()=>this.advance())),becomeIdle(this)):frameLoop.start(this))}_attach(){let e=1;each(toArray(this.source),(t=>{hasFluidValue(t)&&addFluidObserver(t,this),isFrameValue(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))})),this.priority=e,this._start()}_detach(){each(toArray(this.source),(e=>{hasFluidValue(e)&&removeFluidObserver(e,this)})),this._active.clear(),becomeIdle(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=toArray(this.source).reduce(((e,t)=>Math.max(e,(isFrameValue(t)?t.priority:0)+1)),0))}}function isIdle(e){return!1!==e.idle}function checkIdle(e){return!e.size||Array.from(e).every(isIdle)}function becomeIdle(e){e.idle||(e.idle=!0,each(getPayload(e),(e=>{e.done=!0})),callFluidObservers(e,{type:"idle",parent:e}))}function _objectWithoutPropertiesLoose$1(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}globals.assign({createStringInterpolator:createStringInterpolator,to:(e,t)=>new Interpolation(e,t)});const _excluded$2=["style","children","scrollTop","scrollLeft","viewBox"],isCustomPropRE=/^--/;function dangerousStyleValue(e,t){return null==t||"boolean"==typeof t||""===t?"":"number"!=typeof t||0===t||isCustomPropRE.test(e)||isUnitlessNumber.hasOwnProperty(e)&&isUnitlessNumber[e]?(""+t).trim():t+"px"}const attributeCache={};function applyAnimatedValues(e,t){if(!e.nodeType||!e.setAttribute)return!1;const r="filter"===e.nodeName||e.parentNode&&"filter"===e.parentNode.nodeName,n=t,{style:i,children:o,scrollTop:s,scrollLeft:a,viewBox:c}=n,u=_objectWithoutPropertiesLoose$1(n,_excluded$2),l=Object.values(u),d=Object.keys(u).map((t=>r||e.hasAttribute(t)?t:attributeCache[t]||(attributeCache[t]=t.replace(/([A-Z])/g,(e=>"-"+e.toLowerCase())))));void 0!==o&&(e.textContent=o);for(let t in i)if(i.hasOwnProperty(t)){const r=dangerousStyleValue(t,i[t]);isCustomPropRE.test(t)?e.style.setProperty(t,r):e.style[t]=r}d.forEach(((t,r)=>{e.setAttribute(t,l[r])})),void 0!==s&&(e.scrollTop=s),void 0!==a&&(e.scrollLeft=a),void 0!==c&&e.setAttribute("viewBox",c)}let isUnitlessNumber={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const prefixKey=(e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1),prefixes=["Webkit","Ms","Moz","O"];isUnitlessNumber=Object.keys(isUnitlessNumber).reduce(((e,t)=>(prefixes.forEach((r=>e[prefixKey(r,t)]=e[t])),e)),isUnitlessNumber);const _excluded$1=["x","y","z"],domTransforms=/^(matrix|translate|scale|rotate|skew)/,pxTransforms=/^(translate)/,degTransforms=/^(rotate|skew)/,addUnit=(e,t)=>is.num(e)&&0!==e?e+t:e,isValueIdentity=(e,t)=>is.arr(e)?e.every((e=>isValueIdentity(e,t))):is.num(e)?e===t:parseFloat(e)===t;class AnimatedStyle extends AnimatedObject{constructor(e){let{x:t,y:r,z:n}=e,i=_objectWithoutPropertiesLoose$1(e,_excluded$1);const o=[],s=[];(t||r||n)&&(o.push([t||0,r||0,n||0]),s.push((e=>[`translate3d(${e.map((e=>addUnit(e,"px"))).join(",")})`,isValueIdentity(e,0)]))),eachProp(i,((e,t)=>{if("transform"===t)o.push([e||""]),s.push((e=>[e,""===e]));else if(domTransforms.test(t)){if(delete i[t],is.und(e))return;const r=pxTransforms.test(t)?"px":degTransforms.test(t)?"deg":"";o.push(toArray(e)),s.push("rotate3d"===t?([e,t,n,i])=>[`rotate3d(${e},${t},${n},${addUnit(i,r)})`,isValueIdentity(i,0)]:e=>[`${t}(${e.map((e=>addUnit(e,r))).join(",")})`,isValueIdentity(e,t.startsWith("scale")?1:0)])}})),o.length&&(i.transform=new FluidTransform(o,s)),super(i)}}class FluidTransform extends FluidValue{constructor(e,t){super(),this._value=null,this.inputs=e,this.transforms=t}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return each(this.inputs,((r,n)=>{const i=getFluidValue(r[0]),[o,s]=this.transforms[n](is.arr(i)?i:r.map(getFluidValue));e+=" "+o,t=t&&s})),t?"none":e}observerAdded(e){1==e&&each(this.inputs,(e=>each(e,(e=>hasFluidValue(e)&&addFluidObserver(e,this)))))}observerRemoved(e){0==e&&each(this.inputs,(e=>each(e,(e=>hasFluidValue(e)&&removeFluidObserver(e,this)))))}eventObserved(e){"change"==e.type&&(this._value=null),callFluidObservers(this,e)}}const primitives=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],_excluded$3=["scrollTop","scrollLeft"];globals.assign({batchedUpdates:reactDom.exports.unstable_batchedUpdates,createStringInterpolator:createStringInterpolator,colors:colors});const host=createHost(primitives,{applyAnimatedValues:applyAnimatedValues,createAnimatedStyle:e=>new AnimatedStyle(e),getComponentProps:e=>_objectWithoutPropertiesLoose$1(e,_excluded$3)}),animated=host.animated;function resolveContainer(e){return("function"==typeof e?e():e)||document.body}function renderToContainer(e,t){if(canUseDom&&e){const r=resolveContainer(e);return reactDom.exports.createPortal(t,r)}return t}function useInitialized(e){const t=react.exports.useRef(e);return e&&(t.current=!0),!!t.current}const ShouldRender=e=>useShouldRender(e.active,e.forceRender,e.destroyOnClose)?e.children:null;function useShouldRender(e,t,r){const n=useInitialized(e);return!!t||(!!e||!!n&&!r)}const eventToPropRecord={click:"onClick"};function withStopPropagation(e,t){const r=Object.assign({},t.props);for(const n of e){const e=eventToPropRecord[n];r[e]=function(r){var n,i;r.stopPropagation(),null===(i=(n=t.props)[e])||void 0===i||i.call(n,r)}}return React.cloneElement(t,r)}const classPrefix$3="adm-mask",opacityRecord={default:.55,thin:.35,thick:.75},colorRecord={black:"0, 0, 0",white:"255, 255, 255"},defaultProps$2={visible:!0,destroyOnClose:!1,forceRender:!1,color:"black",opacity:"default",disableBodyScroll:!0,getContainer:null,stopPropagation:["click"]},Mask$1=e=>{const t=mergeProps(defaultProps$2,e),{locale:r}=useConfig(),n=react.exports.useRef(null);useLockScroll(n,t.visible&&t.disableBodyScroll);const i=react.exports.useMemo((()=>{var e;const r=null!==(e=opacityRecord[t.opacity])&&void 0!==e?e:t.opacity,n=colorRecord[t.color];return n?`rgba(${n}, ${r})`:t.color}),[t.color,t.opacity]),[o,s]=react.exports.useState(t.visible),a=useUnmountedRef$1(),{opacity:c}=useSpring({opacity:t.visible?1:0,config:{precision:.01,mass:1,tension:250,friction:30,clamp:!0},onStart:()=>{s(!0)},onRest:()=>{var e,r;a.current||(s(t.visible),t.visible?null===(e=t.afterShow)||void 0===e||e.call(t):null===(r=t.afterClose)||void 0===r||r.call(t))}}),u=withStopPropagation(t.stopPropagation,withNativeProps(t,React.createElement(animated.div,{className:classPrefix$3,ref:n,style:Object.assign(Object.assign({},t.style),{background:i,opacity:c,display:o?void 0:"none"}),onClick:e=>{var r;e.target===e.currentTarget&&(null===(r=t.onMaskClick)||void 0===r||r.call(t,e))}},t.onMaskClick&&React.createElement("div",{className:`${classPrefix$3}-aria-button`,role:"button","aria-label":r.Mask.name,onClick:t.onMaskClick}),React.createElement("div",{className:`${classPrefix$3}-content`},t.children))));return React.createElement(ShouldRender,{active:o,forceRender:t.forceRender,destroyOnClose:t.destroyOnClose},renderToContainer(t.getContainer,u))};var Mask=Mask$1;function CloseOutline(e){return react.exports.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{style:Object.assign({verticalAlign:"-0.125em"},e.style),className:["antd-mobile-icon",e.className].filter(Boolean).join(" ")}),react.exports.createElement("g",{id:"CloseOutline-CloseOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},react.exports.createElement("g",{id:"CloseOutline-编组"},react.exports.createElement("rect",{id:"CloseOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),react.exports.createElement("path",{d:"M10.6085104,8.11754663 L24.1768397,21.8195031 L24.1768397,21.8195031 L37.7443031,8.1175556 C37.8194278,8.04168616 37.9217669,7.999 38.0285372,7.999 L41.1040268,7.999 C41.3249407,7.999 41.5040268,8.1780861 41.5040268,8.399 C41.5040268,8.50440471 41.4624226,8.60554929 41.3882578,8.68044752 L26.2773302,23.9408235 L26.2773302,23.9408235 L41.5021975,39.3175645 C41.65763,39.4745475 41.6563731,39.7278104 41.4993901,39.8832429 C41.4244929,39.9574004 41.3233534,39.999 41.2179546,39.999 L38.1434012,39.999 C38.0366291,39.999 37.9342885,39.9563124 37.8591634,39.8804408 L24.1768397,26.0621438 L24.1768397,26.0621438 L10.4936501,39.8804497 C10.4185257,39.9563159 10.3161889,39.999 10.2094212,39.999 L7.13584526,39.999 C6.91493136,39.999 6.73584526,39.8199139 6.73584526,39.599 C6.73584526,39.4936017 6.77744443,39.3924627 6.85160121,39.3175656 L22.0763492,23.9408235 L22.0763492,23.9408235 L6.96554081,8.68044639 C6.81010226,8.52346929 6.81134951,8.27020637 6.9683266,8.11476782 C7.04322474,8.04060377 7.14436883,7.999 7.24977299,7.999 L10.3242852,7.999 C10.4310511,7.999 10.5333863,8.04168267 10.6085104,8.11754663 Z",id:"CloseOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}const defaultPopupBaseProps={closeOnMaskClick:!1,destroyOnClose:!1,disableBodyScroll:!0,forceRender:!1,getContainer:()=>document.body,mask:!0,showCloseButton:!1,stopPropagation:["click"],visible:!1};function useInnerVisible(e){const[t,r]=react.exports.useState(e);return useIsomorphicLayoutEffect$2((()=>{r(e)}),[e]),t}function clamp(e,t,r){return Math.max(t,Math.min(e,r))}const V$1={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function rubberband(e,t,r){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*r):e*t*r/(t+r*e)}function rubberbandIfOutOfBounds(e,t,r,n=.15){return 0===n?clamp(e,t,r):e<t?-rubberband(t-e,r-t,n)+t:e>r?+rubberband(e-r,r-t,n)+r:e}function computeRubberband(e,[t,r],[n,i]){const[[o,s],[a,c]]=e;return[rubberbandIfOutOfBounds(t,o,s,n),rubberbandIfOutOfBounds(r,a,c,i)]}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const EVENT_TYPE_MAP={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize(e){return e?e[0].toUpperCase()+e.slice(1):""}const actionsWithoutCaptureSupported=["enter","leave"];function hasCapture(e=!1,t){return e&&!actionsWithoutCaptureSupported.includes(t)}function toHandlerProp(e,t="",r=!1){const n=EVENT_TYPE_MAP[e],i=n&&n[t]||t;return"on"+capitalize(e)+capitalize(i)+(hasCapture(r,i)?"Capture":"")}const pointerCaptureEvents=["gotpointercapture","lostpointercapture"];function parseProp(e){let t=e.substring(2).toLowerCase();const r=!!~t.indexOf("passive");r&&(t=t.replace("passive",""));const n=pointerCaptureEvents.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(n);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:r}}function toDomEventType(e,t=""){const r=EVENT_TYPE_MAP[e];return e+(r&&r[t]||t)}function isTouch(e){return"touches"in e}function getPointerType(e){return isTouch(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function getCurrentTargetTouchList(e){return Array.from(e.touches).filter((t=>{var r,n;return t.target===e.currentTarget||(null===(r=e.currentTarget)||void 0===r||null===(n=r.contains)||void 0===n?void 0:n.call(r,t.target))}))}function getTouchList(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}function getValueEvent(e){return isTouch(e)?getTouchList(e)[0]:e}function touchIds(e){return getCurrentTargetTouchList(e).map((e=>e.identifier))}function pointerId(e){const t=getValueEvent(e);return isTouch(e)?t.identifier:t.pointerId}function pointerValues(e){const t=getValueEvent(e);return[t.clientX,t.clientY]}function getEventDetails(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:r,altKey:n,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:r,altKey:n,metaKey:i,ctrlKey:o})}return t}function call(e,...t){return"function"==typeof e?e(...t):e}function noop(){}function chain(...e){return 0===e.length?noop:1===e.length?e[0]:function(){let t;for(const r of e)t=r.apply(this,arguments)||t;return t}}function assignDefault(e,t){return Object.assign({},t,e||{})}const BEFORE_LAST_KINEMATICS_DELAY=32;class Engine{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:n}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=n,e.axis=void 0,e.memo=void 0,e.elapsedTime=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?call(r.from,t):t.offset,t.offset=t.lastOffset),t.startTime=t.timeStamp=e.timeStamp}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:n}=this;t.args=this.args;let i=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,n.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,n.locked=!!document.pointerLockElement,Object.assign(n,getEventDetails(e)),n.down=n.pressed=n.buttons%2==1||n.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);V$1.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[o,s]=t._movement,[a,c]=r.threshold,{_step:u,values:l}=t;if(r.hasCustomTransform?(!1===u[0]&&(u[0]=Math.abs(o)>=a&&l[0]),!1===u[1]&&(u[1]=Math.abs(s)>=c&&l[1])):(!1===u[0]&&(u[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===u[1]&&(u[1]=Math.abs(s)>=c&&Math.sign(s)*c)),t.intentional=!1!==u[0]||!1!==u[1],!t.intentional)return;const d=[0,0];if(r.hasCustomTransform){const[e,t]=l;d[0]=!1!==u[0]?e-u[0]:0,d[1]=!1!==u[1]?t-u[1]:0}else d[0]=!1!==u[0]?o-u[0]:0,d[1]=!1!==u[1]?s-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(d);const p=t.offset,m=t._active&&!t._blocked||t.active;m&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=n[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=call(r.bounds,t)),this.setup&&this.setup()),t.movement=d,this.computeOffset()));const[f,h]=t.offset,[[g,v],[y,b]]=t._bounds;t.overflow=[f<g?-1:f>v?1:0,h<y?-1:h>b?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const S=t._active&&r.rubberband||[0,0];if(t.offset=computeRubberband(t._bounds,t.offset,S),t.delta=V$1.sub(t.offset,p),this.computeMovement(),m&&(!t.last||i>BEFORE_LAST_KINEMATICS_DELAY)){t.delta=V$1.sub(t.offset,p);const e=t.delta.map(Math.abs);V$1.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i])}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const n=this.handler(_objectSpread2(_objectSpread2(_objectSpread2({},t),e),{},{[this.aliasKey]:e.values}));void 0!==n&&(e.memo=n)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function selectAxis([e,t],r){const n=Math.abs(e),i=Math.abs(t);return n>i&&n>r?"x":i>n&&i>r?"y":void 0}class CoordinatesEngine extends Engine{constructor(...e){super(...e),_defineProperty(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=V$1.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=V$1.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const n="object"==typeof r.axisThreshold?r.axisThreshold[getPointerType(e)]:r.axisThreshold;t.axis=selectAxis(t._movement,n)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const identity=e=>e,DEFAULT_RUBBERBAND=.15,commonConfigResolver={enabled:(e=!0)=>e,eventOptions:(e,t,r)=>_objectSpread2(_objectSpread2({},r.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[DEFAULT_RUBBERBAND,DEFAULT_RUBBERBAND];case!1:return[0,0];default:return V$1.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?V$1.toVector(e):void 0,transform(e,t,r){const n=e||r.shared.transform;return this.hasCustomTransform=!!n,n||identity},threshold:e=>V$1.toVector(e,0)},DEFAULT_AXIS_THRESHOLD=0,coordinatesConfigResolver=_objectSpread2(_objectSpread2({},commonConfigResolver),{},{axis(e,t,{axis:r}){if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold:(e=DEFAULT_AXIS_THRESHOLD)=>e,bounds(e={}){if("function"==typeof e)return t=>coordinatesConfigResolver.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:r=1/0,top:n=-1/0,bottom:i=1/0}=e;return[[t,r],[n,i]]}}),DISPLACEMENT=10,KEYS_DELTA_MAP={ArrowRight:(e=1)=>[DISPLACEMENT*e,0],ArrowLeft:(e=1)=>[-DISPLACEMENT*e,0],ArrowUp:(e=1)=>[0,-DISPLACEMENT*e],ArrowDown:(e=1)=>[0,DISPLACEMENT*e]};class DragEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),n={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=coordinatesConfigResolver.bounds(n)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout((()=>{this.compute(),this.emit()}),0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,r=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;const n=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),n&&n.size>1&&r._pointerActive||(this.start(e),this.setupPointer(e),r._pointerId=pointerId(e),r._pointerActive=!0,this.computeValues(pointerValues(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==getPointerType(e)?(r._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,r=this.config;if(!t._pointerActive)return;if(t.type===e.type&&e.timeStamp===t.timeStamp)return;const n=pointerId(e);if(void 0!==t._pointerId&&n!==t._pointerId)return;const i=pointerValues(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=V$1.sub(i,t._values),this.computeValues(i)),V$1.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):r.preventScrollAxis&&!t._preventScroll?t.axis?t.axis===r.preventScrollAxis||"xy"===r.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(e){}const t=this.state,r=this.config;if(!t._active||!t._pointerActive)return;const n=pointerId(e);if(void 0!==t._pointerId&&n!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[i,o]=t._distance;if(t.tap=i<=r.tapsThreshold&&o<=r.tapsThreshold,t.tap&&r.filterTaps)t._force=!0;else{const[e,n]=t.direction,[i,o]=t.velocity,[s,a]=t.movement,[c,u]=r.swipe.velocity,[l,d]=r.swipe.distance,p=r.swipe.duration;t.elapsedTime<p&&(Math.abs(i)>c&&Math.abs(s)>l&&(t.swipe[0]=e),Math.abs(o)>u&&Math.abs(a)>d&&(t.swipe[1]=n))}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,persistEvent(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",(()=>{this.state._step=[0,0],this.startPointerDrag(e)}),this.config.delay)}keyDown(e){const t=KEYS_DELTA_MAP[e.key];if(t){const r=this.state,n=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=t(n),r._keyboardActive=!0,V$1.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in KEYS_DELTA_MAP&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function persistEvent(e){"persist"in e&&"function"==typeof e.persist&&e.persist()}const isBrowser="undefined"!=typeof window&&window.document&&window.document.createElement;function supportsTouchEvents(){return isBrowser&&"ontouchstart"in window}function isTouchScreen(){return supportsTouchEvents()||isBrowser&&window.navigator.maxTouchPoints>1}function supportsPointerEvents(){return isBrowser&&"onpointerdown"in window}function supportsPointerLock(){return isBrowser&&"exitPointerLock"in window.document}function supportsGestureEvents(){try{return"constructor"in GestureEvent}catch(e){return!1}}const SUPPORT={isBrowser:isBrowser,gesture:supportsGestureEvents(),touch:isTouchScreen(),touchscreen:isTouchScreen(),pointer:supportsPointerEvents(),pointerLock:supportsPointerLock()},DEFAULT_PREVENT_SCROLL_DELAY=250,DEFAULT_DRAG_DELAY=180,DEFAULT_SWIPE_VELOCITY=.5,DEFAULT_SWIPE_DISTANCE=50,DEFAULT_SWIPE_DURATION=250,DEFAULT_DRAG_AXIS_THRESHOLD={mouse:0,touch:0,pen:8},dragConfigResolver=_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{device(e,t,{pointer:{touch:r=!1,lock:n=!1,mouse:i=!1}={}}){return this.pointerLock=n&&SUPPORT.pointerLock,SUPPORT.touch&&r?"touch":this.pointerLock?"mouse":SUPPORT.pointer&&!i?"pointer":SUPPORT.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:r}){if(this.preventScrollDelay="number"==typeof r?r:r||void 0===r&&e?DEFAULT_PREVENT_SCROLL_DELAY:void 0,SUPPORT.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,{pointer:{capture:r=!0,buttons:n=1}={}}){return this.pointerButtons=n,!this.pointerLock&&"pointer"===this.device&&r},keys:(e=!0)=>e,threshold(e,t,{filterTaps:r=!1,tapsThreshold:n=3,axis:i}){const o=V$1.toVector(e,r?n:i?1:0);return this.filterTaps=r,this.tapsThreshold=n,o},swipe({velocity:e=DEFAULT_SWIPE_VELOCITY,distance:t=DEFAULT_SWIPE_DISTANCE,duration:r=DEFAULT_SWIPE_DURATION}={}){return{velocity:this.transform(V$1.toVector(e)),distance:this.transform(V$1.toVector(t)),duration:r}},delay(e=0){switch(e){case!0:return DEFAULT_DRAG_DELAY;case!1:return 0;default:return e}},axisThreshold:e=>e?_objectSpread2(_objectSpread2({},DEFAULT_DRAG_AXIS_THRESHOLD),e):DEFAULT_DRAG_AXIS_THRESHOLD});_objectSpread2(_objectSpread2({},commonConfigResolver),{},{device(e,t,{shared:r,pointer:{touch:n=!1}={}}){if(r.target&&!SUPPORT.touch&&SUPPORT.gesture)return"gesture";if(SUPPORT.touch&&n)return"touch";if(SUPPORT.touchscreen){if(SUPPORT.pointer)return"pointer";if(SUPPORT.touch)return"touch"}},bounds(e,t,{scaleBounds:r={},angleBounds:n={}}){const i=e=>{const t=assignDefault(call(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{const t=assignDefault(call(n,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof r&&"function"!=typeof n?[i(),o()]:e=>[i(e),o(e)]},threshold(e,t,r){this.lockDirection="lock"===r.axis;return V$1.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e}),_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{mouseOnly:(e=!0)=>e}),_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{mouseOnly:(e=!0)=>e});const EngineMap=new Map,ConfigResolverMap=new Map;function registerAction(e){EngineMap.set(e.key,e.engine),ConfigResolverMap.set(e.key,e.resolver)}const dragAction={key:"drag",engine:DragEngine,resolver:dragConfigResolver};function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}const sharedConfigResolver={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(SUPPORT.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},_excluded=["target","eventOptions","window","enabled","transform"];function resolveWith(e={},t){const r={};for(const[n,i]of Object.entries(t))switch(typeof i){case"function":r[n]=i.call(r,e[n],n,e);break;case"object":r[n]=resolveWith(e[n],i);break;case"boolean":i&&(r[n]=e[n])}return r}function parse$1(e,t,r={}){const n=e,{target:i,eventOptions:o,window:s,enabled:a,transform:c}=n,u=_objectWithoutProperties(n,_excluded);if(r.shared=resolveWith({target:i,eventOptions:o,window:s,enabled:a,transform:c},sharedConfigResolver),t){const e=ConfigResolverMap.get(t);r[t]=resolveWith(_objectSpread2({shared:r.shared},u),e)}else for(const e in u){const t=ConfigResolverMap.get(e);t&&(r[e]=resolveWith(_objectSpread2({shared:r.shared},u[e]),t))}return r}class EventStore{constructor(e,t){_defineProperty(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,n,i){const o=this._listeners,s=toDomEventType(t,r),a=_objectSpread2(_objectSpread2({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(s,n,a);const c=()=>{e.removeEventListener(s,n,a),o.delete(c)};return o.add(c),c}clean(){this._listeners.forEach((e=>e())),this._listeners.clear()}}class TimeoutStore{constructor(){_defineProperty(this,"_timeouts",new Map)}add(e,t,r=140,...n){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...n))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach((e=>{window.clearTimeout(e)})),this._timeouts.clear()}}class Controller{constructor(e){_defineProperty(this,"gestures",new Set),_defineProperty(this,"_targetEventStore",new EventStore(this)),_defineProperty(this,"gestureEventStores",{}),_defineProperty(this,"gestureTimeoutStores",{}),_defineProperty(this,"handlers",{}),_defineProperty(this,"config",{}),_defineProperty(this,"pointerIds",new Set),_defineProperty(this,"touchIds",new Set),_defineProperty(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),resolveGestures(this,e)}setEventIds(e){return isTouch(e)?(this.touchIds=new Set(touchIds(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=parse$1(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let n;if(!t.target||(n=t.target(),n)){if(t.enabled){for(const t of this.gestures){const i=this.config[t],o=bindToProps(r,i.eventOptions,!!n);if(i.enabled){new(EngineMap.get(t))(this,e,t).bind(o)}}const i=bindToProps(r,t.eventOptions,!!n);for(const t in this.nativeHandlers)i(t,"",(r=>this.nativeHandlers[t](_objectSpread2(_objectSpread2({},this.state.shared),{},{event:r,args:e}))),void 0,!0)}for(const e in r)r[e]=chain(...r[e]);if(!n)return r;for(const e in r){const{device:t,capture:i,passive:o}=parseProp(e);this._targetEventStore.add(n,t,"",r[e],{capture:i,passive:o})}}}}function setupGesture(e,t){e.gestures.add(t),e.gestureEventStores[t]=new EventStore(e,t),e.gestureTimeoutStores[t]=new TimeoutStore}function resolveGestures(e,t){t.drag&&setupGesture(e,"drag"),t.wheel&&setupGesture(e,"wheel"),t.scroll&&setupGesture(e,"scroll"),t.move&&setupGesture(e,"move"),t.pinch&&setupGesture(e,"pinch"),t.hover&&setupGesture(e,"hover")}const bindToProps=(e,t,r)=>(n,i,o,s={},a=!1)=>{var c,u;const l=null!==(c=s.capture)&&void 0!==c?c:t.capture,d=null!==(u=s.passive)&&void 0!==u?u:t.passive;let p=a?n:toHandlerProp(n,i,l);r&&d&&(p+="Passive"),e[p]=e[p]||[],e[p].push(o)};function useRecognizers(e,t={},r,n){const i=React.useMemo((()=>new Controller(e)),[]);if(i.applyHandlers(e,n),i.applyConfig(t,r),React.useEffect(i.effect.bind(i)),React.useEffect((()=>i.clean.bind(i)),[]),void 0===t.target)return i.bind.bind(i)}function useDrag(e,t){return registerAction(dragAction),useRecognizers({drag:e},t||{},"drag")}const classPrefix$2="adm-popup",defaultProps$1=Object.assign(Object.assign({},defaultPopupBaseProps),{closeOnSwipe:!1,position:"bottom"}),Popup$1=e=>{const t=mergeProps(defaultProps$1,e),{locale:r}=useConfig(),n=classNames(`${classPrefix$2}-body`,t.bodyClassName,`${classPrefix$2}-body-position-${t.position}`),[i,o]=react.exports.useState(t.visible);useIsomorphicLayoutEffect$2((()=>{t.visible&&o(!0)}),[t.visible]);const s=react.exports.useRef(null);useLockScroll(s,!(!t.disableBodyScroll||!i)&&"strict");const a=useUnmountedRef$1(),{percent:c}=useSpring({percent:t.visible?0:100,config:{precision:.1,mass:.4,tension:300,friction:30},onRest:()=>{var e,r;a.current||(o(t.visible),t.visible?null===(e=t.afterShow)||void 0===e||e.call(t):null===(r=t.afterClose)||void 0===r||r.call(t))}}),u=useDrag((({swipe:[,e]})=>{var r;t.closeOnSwipe&&(1===e&&"bottom"===t.position||-1===e&&"top"===t.position)&&(null===(r=t.onClose)||void 0===r||r.call(t))}),{axis:"y",enabled:["top","bottom"].includes(t.position)}),l=useInnerVisible(i&&t.visible),d=withStopPropagation(t.stopPropagation,withNativeProps(t,React.createElement("div",Object.assign({className:classPrefix$2,onClick:t.onClick,style:{display:i?void 0:"none",touchAction:["top","bottom"].includes(t.position)?"none":"auto"}},u()),t.mask&&React.createElement(Mask,{visible:l,forceRender:t.forceRender,destroyOnClose:t.destroyOnClose,onMaskClick:e=>{var r,n;null===(r=t.onMaskClick)||void 0===r||r.call(t,e),t.closeOnMaskClick&&(null===(n=t.onClose)||void 0===n||n.call(t))},className:t.maskClassName,style:t.maskStyle,disableBodyScroll:!1,stopPropagation:t.stopPropagation}),React.createElement(animated.div,{className:n,style:Object.assign(Object.assign({},t.bodyStyle),{transform:c.to((e=>"bottom"===t.position?`translate(0, ${e}%)`:"top"===t.position?`translate(0, -${e}%)`:"left"===t.position?`translate(-${e}%, 0)`:"right"===t.position?`translate(${e}%, 0)`:"none"))}),ref:s},t.showCloseButton&&React.createElement("a",{className:classNames(`${classPrefix$2}-close-icon`,"adm-plain-anchor"),onClick:()=>{var e;null===(e=t.onClose)||void 0===e||e.call(t)},role:"button","aria-label":r.common.close},React.createElement(CloseOutline,null)),t.children))));return React.createElement(ShouldRender,{active:i,forceRender:t.forceRender,destroyOnClose:t.destroyOnClose},renderToContainer(t.getContainer,d))};var Popup=Popup$1,css_248z$b=".adm-safe-area{--multiple:var(--adm-safe-area-multiple,1);display:block;width:100%}.adm-safe-area-position-top{padding-top:calc(env(safe-area-inset-top)*var(--multiple))}.adm-safe-area-position-bottom{padding-bottom:calc(env(safe-area-inset-bottom)*var(--multiple))}";styleInject(css_248z$b);const classPrefix$1="adm-safe-area",SafeArea$1=e=>withNativeProps(e,React.createElement("div",{className:classNames(classPrefix$1,`${classPrefix$1}-position-${e.position}`)}));var SafeArea=SafeArea$1;const fullClone=Object.assign({},ReactDOM$1),{version:version$3,render:reactRender,unmountComponentAtNode:unmountComponentAtNode}=fullClone;let createRoot;try{const e=Number((version$3||"").split(".")[0]);e>=18&&fullClone.createRoot&&(createRoot=fullClone.createRoot)}catch(e){}function toggleWarning(e){const{__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:t}=fullClone;t&&"object"==typeof t&&(t.usingClientEntryPoint=e)}const MARK="__antd_mobile_root__";function legacyRender(e,t){reactRender(e,t)}function concurrentRender(e,t){toggleWarning(!0);const r=t[MARK]||createRoot(t);toggleWarning(!1),r.render(e),t[MARK]=r}function render$1(e,t){createRoot?concurrentRender(e,t):legacyRender(e,t)}function legacyUnmount(e){return unmountComponentAtNode(e)}function concurrentUnmount(e){return __awaiter$2(this,void 0,void 0,(function*(){return Promise.resolve().then((()=>{var t;null===(t=e[MARK])||void 0===t||t.unmount(),delete e[MARK]}))}))}function unmount(e){return createRoot?concurrentUnmount(e):legacyUnmount(e)}function renderToBody(e){const t=document.createElement("div");return document.body.appendChild(t),render$1(e,t),function(){unmount(t)&&t.parentNode&&t.parentNode.removeChild(t)}}function renderImperatively(e){const t=React.forwardRef(((t,r)=>{const[i,o]=react.exports.useState(!1),s=react.exports.useRef(!1),[a,c]=react.exports.useState(e),u=react.exports.useRef(0);function l(){var e,t;s.current=!0,o(!1),null===(t=(e=a.props).onClose)||void 0===t||t.call(e)}function d(){var e,t;n(),null===(t=(e=a.props).afterClose)||void 0===t||t.call(e)}return react.exports.useEffect((()=>{s.current?d():o(!0)}),[]),react.exports.useImperativeHandle(r,(()=>({close:l,replace:e=>{var t,r;u.current++,null===(r=(t=a.props).afterClose)||void 0===r||r.call(t),c(e)}}))),React.cloneElement(a,Object.assign(Object.assign({},a.props),{key:u.current,visible:i,onClose:l,afterClose:d}))})),r=React.createRef(),n=renderToBody(React.createElement(t,{ref:r}));return{close:()=>__awaiter$2(this,void 0,void 0,(function*(){var e;r.current?null===(e=r.current)||void 0===e||e.close():n()})),replace:e=>{var t;null===(t=r.current)||void 0===t||t.replace(e)}}}const classPrefix="adm-action-sheet",defaultProps={visible:!1,actions:[],cancelText:"",closeOnAction:!1,closeOnMaskClick:!0,safeArea:!0,destroyOnClose:!1,forceRender:!1},ActionSheet$1=e=>{const t=mergeProps(defaultProps,e);return React.createElement(Popup,{visible:t.visible,onMaskClick:()=>{var e,r;null===(e=t.onMaskClick)||void 0===e||e.call(t),t.closeOnMaskClick&&(null===(r=t.onClose)||void 0===r||r.call(t))},afterClose:t.afterClose,className:classNames(`${classPrefix}-popup`,t.popupClassName),style:t.popupStyle,getContainer:t.getContainer,destroyOnClose:t.destroyOnClose,forceRender:t.forceRender},withNativeProps(t,React.createElement("div",{className:classPrefix},t.extra&&React.createElement("div",{className:`${classPrefix}-extra`},t.extra),React.createElement("div",{className:`${classPrefix}-button-list`},t.actions.map(((e,r)=>React.createElement("div",{key:e.key,className:`${classPrefix}-button-item-wrapper`},React.createElement("a",{className:classNames("adm-plain-anchor",`${classPrefix}-button-item`,{[`${classPrefix}-button-item-danger`]:e.danger,[`${classPrefix}-button-item-disabled`]:e.disabled,[`${classPrefix}-button-item-bold`]:e.bold}),onClick:()=>{var n,i,o;null===(n=e.onClick)||void 0===n||n.call(e),null===(i=t.onAction)||void 0===i||i.call(t,e,r),t.closeOnAction&&(null===(o=t.onClose)||void 0===o||o.call(t))},role:"option","aria-disabled":e.disabled},React.createElement("div",{className:`${classPrefix}-button-item-name`},e.text),e.description&&React.createElement("div",{className:`${classPrefix}-button-item-description`},e.description)))))),t.cancelText&&React.createElement("div",{className:`${classPrefix}-cancel`,role:"option","aria-label":t.cancelText},React.createElement("div",{className:`${classPrefix}-button-item-wrapper`},React.createElement("a",{className:classNames("adm-plain-anchor",`${classPrefix}-button-item`),onClick:()=>{var e;null===(e=t.onClose)||void 0===e||e.call(t)}},React.createElement("div",{className:`${classPrefix}-button-item-name`},t.cancelText)))),t.safeArea&&React.createElement(SafeArea,{position:"bottom"}))))};function showActionSheet(e){return renderImperatively(React.createElement(ActionSheet$1,Object.assign({},e)))}var ActionSheet=attachPropertiesToComponent(ActionSheet$1,{show:showActionSheet}),css_248z$a="#dark-toast{background:#333;background:rgba(29,29,29,.73);border-radius:5px;color:#fff;left:50%;max-width:50%;min-width:100px;padding:5px 10px;pointer-events:none;position:fixed;text-align:center;top:40%;transform:translateX(-50%);z-index:10000}#dark-toast i .rotate-loop{animation:rotate-loop 1s infinite}@keyframes rotate-loop{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}";styleInject(css_248z$a);let timer=null;class Toast extends React.Component{static info(e,t=2e3){init(),setTime(t),ReactDOM.render(jsxRuntime.exports.jsx(react.exports.Fragment,{children:jsxRuntime.exports.jsx("span",{children:e})}),document.getElementById("dark-toast"))}static success(e,t=2e3){init(),setTime(t),ReactDOM.render(jsxRuntime.exports.jsxs(react.exports.Fragment,{children:[jsxRuntime.exports.jsx("i",{className:"iconfont icon-check-circle-fill"}),jsxRuntime.exports.jsx("span",{children:e})]}),document.getElementById("dark-toast"))}static fail(e,t=2e3){init(),setTime(t),ReactDOM.render(jsxRuntime.exports.jsxs(react.exports.Fragment,{children:[jsxRuntime.exports.jsx("i",{className:"iconfont icon-close-circle-fill"}),jsxRuntime.exports.jsx("span",{children:e})]}),document.getElementById("dark-toast"))}static warning(e,t=2e3){init(),setTime(t),ReactDOM.render(jsxRuntime.exports.jsxs(react.exports.Fragment,{children:[jsxRuntime.exports.jsx("i",{className:"iconfont icon-warning-circle-fill"}),jsxRuntime.exports.jsx("span",{children:e})]}),document.getElementById("dark-toast"))}static loading(e,t){init(),setLoading(t),ReactDOM.render(jsxRuntime.exports.jsxs(react.exports.Fragment,{children:[jsxRuntime.exports.jsx("i",{className:"iconfont icon-reload rotate-loop"}),jsxRuntime.exports.jsx("span",{children:e})]}),document.getElementById("dark-toast"))}}function setLoading(e){const t=document.getElementById("dark-toast");t.style.display=e?"block":"none"}function init(){clearTimeout(timer);const e=document.getElementById("dark-toast");if(e)e.style.display="block";else{const e=document.createElement("div");e.setAttribute("id","dark-toast"),document.body.appendChild(e)}}function setTime(e){timer=setTimeout((()=>{const e=document.getElementById("dark-toast");e&&(e.style.display="none")}),e)}var css_248z$9=".meeting-header-wrap{position:absolute;width:100%;z-index:20}.meeting-header-wrap .meeting-name{display:inline-block;font-size:16px;line-height:24px;margin-right:8.56px;max-width:70%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.meeting-header-wrap .meeting-info-wrap{background-color:transparent;left:0;right:0;top:0;z-index:20}.meeting-header-wrap .meeting-info-modal{bottom:0;padding-bottom:env(safe-area-inset-bottom);z-index:20}.meeting-header-wrap .meeting-subject{color:#18181b;font-weight:500}.meeting-header-wrap .border-wrap{border-color:#f4f4f5;border-style:solid;margin-top:16px}.meeting-header-wrap .meeting-info-security{color:#9ca3af;margin-top:6px}.meeting-header-wrap .meeting-info-content{background-color:#fff;border-top-left-radius:16px;border-top-right-radius:16px;color:#1f2937;padding-bottom:16px;padding-top:24px}.meeting-header-wrap .meeting-info-content-wrap{padding-bottom:20px;padding-left:20px;padding-right:20px}.meeting-header-wrap .header-title{align-items:center;color:#fff;display:flex;justify-content:center}.meeting-header-wrap .exit-btn{background-color:#ef4444;border:0;border-radius:4px;color:#fff;font-size:12px;line-height:24px;padding:0 12px;right:16px;top:20px}.meeting-header-wrap .meeting-info{padding-top:8px}.meeting-header-wrap .meeting-info>div:nth-child(odd){color:#94979a}.meeting-header-wrap .meeting-info>div:nth-child(2n){color:#222;word-break:break-all}.meeting-header-wrap .meeting-info .info-item{display:flex}.meeting-header-wrap .meeting-info .info-item-title{color:#94979a;font-size:14px;width:80px}.meeting-header-wrap .meeting-info .info-item-content{color:#222;font-size:14px}.meeting-header-wrap .icon{display:inline-block}.meeting-header-wrap .meeting-header{background-color:#18181b;height:66px;line-height:66px;position:absolute;width:100%}.meeting-header-wrap .icon-cert.iconfont{color:#26bd71;font-size:14px;margin-right:4px;position:relative;top:1px}.meeting-header-wrap .icon-copy.iconfont{color:#337eff;font-size:14px;margin-left:3px}.meeting-header-wrap .meeting-header-icons .iconfont{font-size:18px;margin-left:16px}.meeting-header-wrap .meeting-header .icon-blue{color:#337eff}.meeting-header-wrap .button-ele{border:0}";styleInject(css_248z$9);const MeetingInfo=({visible:e=!1,onClose:t})=>{const[r,n]=react.exports.useState(!1),{meetingInfo:i}=react.exports.useContext(MeetingInfoContext),o=react.exports.useMemo((()=>{if(null==i?void 0:i.meetingNum){const e=i.meetingNum;return e.slice(0,3)+"-"+e.slice(3,6)+"-"+e.slice(6)}return""}),[null==i?void 0:i.meetingNum]);react.exports.useEffect((()=>{n(e)}),[e]);const s=e=>jsxRuntime.exports.jsx("i",{className:"icon-copy iconfont iconcopy1x",onClick:()=>{(e=>{copyElementValue(e,(()=>{Toast.success("复制成功")}))})(e)}});return jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:r&&jsxRuntime.exports.jsx("div",Object.assign({className:"meeting-info-wrap w-full h-full absolute",onClick:e=>{t&&t(),e.stopPropagation()}},{children:jsxRuntime.exports.jsx("div",Object.assign({id:"meetingDiv",className:"w-full absolute meeting-info-modal",onClick:e=>{e.stopPropagation()}},{children:jsxRuntime.exports.jsx("div",Object.assign({className:"meeting-info-content focus:outline-4"},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"meeting-info-content-wrap text-left"},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"drawer-info"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"meeting-subject text-xl"},{children:null==i?void 0:i.subject})),jsxRuntime.exports.jsxs("div",Object.assign({className:"meeting-info-security text-xs"},{children:[jsxRuntime.exports.jsx("i",{className:"icon-cert iconfont iconcertification1x"}),jsxRuntime.exports.jsx("span",{children:"会议正加密保护中"})]}))]})),jsxRuntime.exports.jsx("hr",{className:"border-wrap"}),jsxRuntime.exports.jsxs("div",Object.assign({className:"pt-2 meeting-info"},{children:[(null==i?void 0:i.shortMeetingNum)&&jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-title"},{children:"会议短号"})),jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-content"},{children:null==i?void 0:i.shortMeetingNum})),s(null==i?void 0:i.shortMeetingNum)]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-title"},{children:"会议ID"})),jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item-content"},{children:[jsxRuntime.exports.jsx("span",{children:o}),s(null==i?void 0:i.meetingNum)]}))]})),(null==i?void 0:i.password)&&jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-title"},{children:"会议密码"})),jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-content"},{children:null==i?void 0:i.password})),s(null==i?void 0:i.password)]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"info-item"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-title"},{children:"主持人"})),jsxRuntime.exports.jsx("div",Object.assign({className:"info-item-content"},{children:null==i?void 0:i.hostName}))]}))]}))]}))}))}))}))})};var MobileCameraType,MobileMicrophoneType;!function(e){e.FRONT="front",e.BACK="back"}(MobileCameraType||(MobileCameraType={})),function(e){e.HEADSET="headset",e.SPEAKER="speakerphone",e.EARPIECE="earpiece"}(MobileMicrophoneType||(MobileMicrophoneType={}));const MeetingHeader=({className:e="",visible:t=!1,onClick:r})=>{const[n,i]=react.exports.useState(!1),[o,s]=react.exports.useState(!1),{meetingInfo:{localMember:a,hostUuid:c,myUuid:u,subject:l},dispatch:d}=react.exports.useContext(MeetingInfoContext),{neMeeting:p,dispatch:m,showSubject:f}=react.exports.useContext(GlobalContext),[h,g]=react.exports.useState([]),v=react.exports.useRef(!1),[y,b]=react.exports.useState({cameraType:MobileCameraType.FRONT}),[S,T]=react.exports.useState(),_=a.role==Role.host||a.role==Role.coHost,w={[MobileCameraType.FRONT]:["front","前置"],[MobileCameraType.BACK]:["back","后置"]},M=()=>__awaiter$2(void 0,void 0,void 0,(function*(){try{yield null==p?void 0:p.leave(),setTimeout((()=>{d&&d({type:ActionType.RESET_MEETING,data:null})}),2e3)}catch(e){console.log("leaveMeetingRoom",e),d&&d({type:ActionType.RESET_MEETING,data:null}),null==p||p.destroy()}finally{m&&m({type:ActionType.JOIN_LOADING,data:!1})}})),x=()=>__awaiter$2(void 0,void 0,void 0,(function*(){try{yield null==p?void 0:p.end()}catch(e){console.log("leaveMeetingRoom",e),d&&d({type:ActionType.RESET_MEETING,data:null}),null==p||p.destroy()}finally{m&&m({type:ActionType.JOIN_LOADING,data:!1})}})),E=(e,t)=>__awaiter$2(void 0,void 0,void 0,(function*(){if(v.current)return;v.current=!0;let t=null==S?void 0:S.cameras;if(!t||0===(null==t?void 0:t.length)){const e=yield __awaiter$2(void 0,void 0,void 0,(function*(){const e=[null==p?void 0:p.getCameras()],t=yield Promise.all(e);if(t[0]){const e=t[0],r=null==p?void 0:p.getSelectedCameraDevice(),n=null==e?void 0:e.find((e=>e.deviceId===r)),i={cameras:e,cameraItem:n};console.log("-------------device---------------"),console.log(i);let o=MobileCameraType.FRONT;if(n){const e=w[MobileCameraType.BACK].includes(n.deviceName.toLowerCase());o=e?MobileCameraType.BACK:MobileCameraType.FRONT}return b((e=>({cameraType:o}))),T((e=>i)),i}}));e&&(t=null==e?void 0:e.cameras)}const{cameraType:r}=y;if(console.log("switchDevice  ",e,y),t&&"camera"===e){const e=r===MobileCameraType.BACK?MobileCameraType.FRONT:MobileCameraType.BACK;t.sort(((e,t)=>e.deviceName<t.deviceName?-1:e.deviceName>t.deviceName?1:0)),console.log("switchTag  ",e);const n=t.find((t=>{if(w[e].some((e=>t.deviceName.toLowerCase().indexOf(e)>-1)))return t}));(null==n?void 0:n.deviceId)?(yield null==p?void 0:p.muteLocalVideo(!1),yield null==p?void 0:p.changeLocalVideo(n.deviceId),null==p||p.unmuteLocalVideo("",!1).then((t=>{b({cameraType:e})})).catch((e=>{console.log(e)})).finally((()=>{v.current=!1}))):Toast.info("该设备暂不支持切换摄像头")}v.current=!1}));return jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:t&&jsxRuntime.exports.jsxs("div",Object.assign({className:`meeting-header-wrap ${e||""} ${n?"h-full":""}`,onClick:e=>{e.stopPropagation()}},{children:[jsxRuntime.exports.jsxs("div",Object.assign({onClick:e=>{return t=e,void(null==r||r(t));var t},className:"meeting-header bg-zinc-900"},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"absolute flex meeting-header-icons"},{children:(null==a?void 0:a.isVideoOn)&&jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:jsxRuntime.exports.jsx("i",{className:"iconfont icon-white iconyx-tv-filpx",onClick:()=>{E("camera",y.cameraType)}})})})),jsxRuntime.exports.jsxs("div",Object.assign({className:"header-title"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"meeting-name text-base",onClick:()=>{i(!n)}},{children:f?l:"网易会议"})),jsxRuntime.exports.jsx("i",{onClick:()=>{i(!n)},className:"iconfont icona-45"})]})),jsxRuntime.exports.jsx("button",Object.assign({className:"exit-btn bg-red-500 text-white rounded h-6 text-xs absolute top-5 right-4 button-ele",onClick:()=>{const e=[{text:"离开会议",key:"leave",onClick:()=>__awaiter$2(void 0,void 0,void 0,(function*(){yield M()}))},{text:"结束会议",key:"end",danger:!0,onClick:()=>__awaiter$2(void 0,void 0,void 0,(function*(){yield x()}))},{text:"取消",key:"cancel",onClick:()=>__awaiter$2(void 0,void 0,void 0,(function*(){s(!1)}))}];_||e.splice(1,1),g(e),s(!0)}},{children:_?"结束":"离开"}))]})),jsxRuntime.exports.jsx(MeetingInfo,{visible:n,onClose:()=>{i(!1)}}),jsxRuntime.exports.jsx(ActionSheet,{visible:o,actions:h,getContainer:null,onClose:()=>s(!1)})]}))})};var css_248z$8=".dialog-com{background-color:rgba(0,0,0,.5);left:0;right:0;top:0;z-index:9999}.dialog-com .dialog-box{background-color:#fff;border-radius:16px;padding-top:20px;position:absolute;top:50%;transform:translateY(-50%);width:83.33333%}.dialog-com .dialog-content{margin-top:8px;max-height:500px;min-height:60px;overflow:hidden;padding-left:16px;padding-right:16px;text-overflow:clip}.dialog-com .dialog-foot{border-top:1px solid rgba(0,0,80,.05);display:flex;height:44px;justify-content:space-between;line-height:40px;text-align:center}.dialog-com .dialog-foot>span{width:49%}.dialog-com .dialog-cancel{border-right:1px solid rgba(0,0,80,.05);color:#666;display:inline-block}.dialog-com .dialog-confirm{color:#007aff;display:inline-block}.dialog-com .dialog-title{color:#000;text-align:center}";styleInject(css_248z$8);const Dialog=({visible:e,ifShowCancel:t=!0,onCancel:r,onConfirm:n,title:i,popupClassName:o,cancelText:s="否",confirmText:a="是",children:c})=>{const[u,l]=react.exports.useState(!1);return react.exports.useEffect((()=>{l(e)}),[e]),jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:u&&jsxRuntime.exports.jsx("div",Object.assign({className:"w-full dialog-com h-full fixed flex items-center justify-center",onClick:e=>{e.stopPropagation()}},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:`dialog-box ${o||""}`},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"dialog-title text-lg"},{children:i})),jsxRuntime.exports.jsx("div",Object.assign({className:"dialog-content"},{children:c})),jsxRuntime.exports.jsxs("div",Object.assign({className:"dialog-foot text-base "},{children:[t&&jsxRuntime.exports.jsx("span",Object.assign({className:"dialog-cancel",onClick:e=>{r&&r(),e.stopPropagation()}},{children:s})),jsxRuntime.exports.jsx("span",Object.assign({className:"dialog-confirm",style:{width:t?"49%":"100%"},onClick:e=>{n&&n(),e.stopPropagation()}},{children:a}))]}))]}))}))})};var css_248z$7=".member-list{background-color:rgba(0,0,0,.8);bottom:0;font-size:14px;height:0;overflow:hidden;position:absolute;width:100%;z-index:21}.member-list .iconfont{color:#49494d;font-size:15px;margin-right:3px}.member-list .member-list-title-wrap{border-bottom:1px solid #f2f3f5;font-weight:500;line-height:48px}.member-list .member-list-title{font-size:16px}.member-list .search-member{border-bottom:1px solid #f2f3f5;padding:10px 20px}.member-list .member-item{border-bottom:1px solid #f2f3f5;height:48px;padding-left:20px;padding-right:20px;vertical-align:middle}.member-list .member-name{display:inline-block}.member-list .member-status{display:inline-block;right:12px;top:0}.member-list .close-icon{position:absolute;right:16px}.member-list.show{height:100%;transition:height .3s;-webkit-transition:height .3s}.member-list-content{background-color:#fff;border-top-left-radius:16px;border-top-right-radius:16px;bottom:0;height:0;left:0;position:absolute;right:0;z-index:22}.member-list-content.show{height:91%;transition:height .3s;-webkit-transition:height .3s}.mr10{margin-right:10px}.b-b-1-gray{border-bottom:1px solid #f2f3f5}.line-height-3{line-height:48px}.member-scroll{height:calc(100% - 110px);overflow-y:scroll}.member-scroll-forhost{height:calc(100% - 235px)}.member-scroll .icon{height:20px;margin-left:12px;width:20px}.member-info{align-items:center;color:#333;display:flex;height:100%;width:calc(100% - 4.5rem)}.member-info .member-tag{color:#999;font-size:12px}.style{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.entireOperation span{color:#337eff;display:inline-block;width:49%}.entireOperation span:nth-child(odd){border-right:1px solid #f2f3f5}.action-sheet .adm-action-sheet-button-item-name{color:#337eff}.action-sheet .adm-action-sheet-cancel{font-weight:500}.change-name{height:70px;text-align:left}.input-ele{background-color:#f3f4f6;border:0;border-radius:16px;height:36px;outline:none;padding:0 16px;width:90%}.change-name-error .input-ele{border:1px solid red}.change-name-error{color:red}.change-name-error>span{display:block;margin:5px 0}";styleInject(css_248z$7);const MemberListUI=({visible:e=!1,onClose:t})=>{const[r,n]=react.exports.useState(!1),{meetingInfo:{localMember:i,hostUuid:o,myUuid:s},memberList:a}=react.exports.useContext(MeetingInfoContext),{neMeeting:c}=react.exports.useContext(GlobalContext),[u,l]=react.exports.useState(!1),[d,p]=react.exports.useState(),[m,f]=react.exports.useState([]),[h,g]=react.exports.useState(!1),[v,y]=react.exports.useState(!1),[b,S]=react.exports.useState(""),[T,_]=react.exports.useState("");react.exports.useEffect((()=>{n(e)}),[e]);const w=e=>{t&&t(),e.stopPropagation()},M=react.exports.useCallback(((e,t)=>{console.log(e);const r=[];[{id:memberAction.modifyMeetingNickName,name:"改名",isShow:e.uuid===(null==i?void 0:i.uuid)}].map((t=>{t.isShow&&(t.id===memberAction.modifyMeetingNickName?r.push({text:t.name,key:t.id,onClick:()=>__awaiter$2(void 0,void 0,void 0,(function*(){S(null==i?void 0:i.name),l(!1),y(!0)}))}):r.push({text:t.name,key:t.id,onClick:()=>__awaiter$2(void 0,void 0,void 0,(function*(){x(e,null==e?void 0:e.uuid,t.id)}))}))})),r.length>0&&(p(e),f(r),l(!0),console.log("diplayBtns ",r))}),[i]),x=(e,t,r)=>__awaiter$2(void 0,void 0,void 0,(function*(){yield null==c?void 0:c.sendMemberControl(r,e.uuid)})),E=(e,t)=>{const r=[];return t===Role.host&&r.push("主持人"),t===Role.coHost&&r.push("联席主持人"),e===s&&r.push("我"),"("+r.join("，")+")"},C=react.exports.useMemo((()=>{console.log("filteredMemberList",a);return a.filter((e=>e.name.indexOf(T)>-1))}),[a,T,a.length]);return jsxRuntime.exports.jsxs(jsxRuntime.exports.Fragment,{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"member-list "+(r?"show":""),onClick:e=>{w(e)}},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"member-list-content "+(r?"show":""),onClick:e=>{e.stopPropagation()}},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"member-list-title-wrap text-center"},{children:[jsxRuntime.exports.jsxs("span",Object.assign({className:"member-list-title"},{children:["参会者(",null==a?void 0:a.length,")"]})),jsxRuntime.exports.jsx("i",{onClick:e=>{w(e)},className:"iconfont iconyx-pc-closex close-icon"})]})),jsxRuntime.exports.jsx("div",Object.assign({className:"search-member"},{children:jsxRuntime.exports.jsx("input",{className:"input-ele",placeholder:"搜索成员",value:T,onChange:e=>{var t;_(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)}})})),jsxRuntime.exports.jsx("div",Object.assign({className:`member-scroll text-left ${["host","cohost"].includes(null==i?void 0:i.role)&&"member-scroll-forhost"}`},{children:C.map(((e,t)=>jsxRuntime.exports.jsxs("div",Object.assign({className:"member-item relative",onClick:()=>{M(e,(null==i?void 0:i.uuid)===o)}},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"member-info"},{children:(null==e?void 0:e.role)===Role.coHost||(null==e?void 0:e.role)===Role.host||(null==e?void 0:e.uuid)===s?jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"truncate"},{children:[null==e?void 0:e.name,jsxRuntime.exports.jsx("div",Object.assign({className:"member-tag"},{children:E(e.uuid,e.role)}))]}))}):jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:jsxRuntime.exports.jsx("span",Object.assign({className:"member-name line-height-3 w-full truncate"},{children:null==e?void 0:e.name}))})})),jsxRuntime.exports.jsxs("div",Object.assign({className:"member-status absolute line-height-3"},{children:[(null==e?void 0:e.isSharingScreen)?jsxRuntime.exports.jsx("i",{className:"iconfont icon-bule icongongxiangpingmu"}):"",(null==e?void 0:e.isVideoOn)?jsxRuntime.exports.jsx("i",{className:"iconfont iconyx-tv-video-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red iconfont iconyx-tv-video-offx"}),(null==e?void 0:e.isAudioOn)?jsxRuntime.exports.jsx("i",{className:"iconfont iconyx-tv-voice-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red iconfont iconyx-tv-voice-offx"})]}))]}),(null==e?void 0:e.uuid)+t)))}))]}))})),jsxRuntime.exports.jsx(ActionSheet,{extra:null==d?void 0:d.name,cancelText:"取消",visible:u,actions:m,getContainer:null,onClose:()=>l(!1),popupClassName:"action-sheet"}),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:h,title:"移交主持人",onCancel:()=>{g(!1)},onConfirm:()=>{}},{children:"确认移交主持人权限给小A？"})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:v,title:"改名",cancelText:"取消",confirmText:"确认",onCancel:()=>{y(!1)},onConfirm:()=>__awaiter$2(void 0,void 0,void 0,(function*(){b.trim()&&(null==c||c.modifyNickName({nickName:b}).then((()=>{y(!1),Toast.success("昵称修改成功")})).catch((e=>{Toast.fail("failure"===(null==e?void 0:e.message)?"请求失败":null==e?void 0:e.message)})))}))},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:`change-name ${!b.trim()&&"change-name-error"}`},{children:[jsxRuntime.exports.jsx("input",{className:"input-ele",value:b,placeholder:"输入名称",maxLength:20,required:!0,onChange:e=>{S(e.target.value)}}),!b.trim()&&jsxRuntime.exports.jsx("span",{children:"请输入昵称"})]}))}))]})};var css_248z$6=".meeting-controller{background-color:#292933;border-top:.5px solid #666;bottom:0;color:#fff;font-size:10px;height:56px;padding-top:6px;z-index:10}.meeting-controller .controller-item{flex:1}.meeting-controller .member-count{left:62%;top:-2px}.meeting-controller .icon-tool{font-size:24px;margin:0 auto 2px}.meeting-controller .icon-blue{color:#337eff}.meeting-controller .unread-count{background-color:#fe3b30;border-radius:50%;box-sizing:border-box;color:#fff;font-size:10px;height:18px;left:50%;line-height:18px;min-width:18px;padding:0 3px;position:absolute;text-align:center;top:0;transform:translateX(5px);vertical-align:middle}.meeting-controller .hands-up-tip{background:#337eff;border-radius:5px;left:50%;padding-bottom:2px;position:absolute;top:-48px;transform:translateX(-50%) scale(.75);width:48px}.meeting-controller .hands-arrow{border:8px solid transparent;border-top-color:#337eff;bottom:-16px;height:0;left:50%;position:absolute;transform:translateX(-50%);width:0}.meeting-controller .hands-arrow-text{display:inline-block}.meeting-controller .hands-icon{color:#fff;display:block;font-size:20px;height:24px;margin:3px auto 0;width:24px}";styleInject(css_248z$6);var css_248z$5=".msg-wrap{margin-bottom:20px}.msg-wrap .msg-content-other{justify-content:flex-start}.msg-wrap .msg-content-wrap{display:flex}.msg-wrap .msg-content-self{justify-content:flex-end}.msg-wrap .msg-text{word-wrap:break-word;border-radius:8px;font-size:14px;min-height:12px;overflow:hidden;padding:5px 6px;text-align:left}.msg-wrap .msg-text-self{background:#cce1ff}.msg-wrap .msg-text-other{background:#f2f3f5}.msg-wrap .user-icon{border-radius:50%;height:16px;width:16px}.msg-wrap .nickname{color:#333;display:inline-block;font-size:12px;line-height:12px;margin-right:5px;max-width:115px;overflow:hidden;padding:0 2px;text-overflow:ellipsis;white-space:nowrap}.msg-wrap .date{color:#999;font-size:12px;line-height:12px}.msg-wrap .msg-type{color:#337eff;font-size:12px;line-height:12px}.msg-wrap .private-mag{color:#999}.msg-wrap .msg-info{align-items:center;display:flex;margin-bottom:6px}.msg-wrap .msg-info-self{justify-content:flex-end}.msg-wrap .msg-info-other{justify-content:flex-start}.msg-wrap .msg-text-error{background-color:#ff69b433}.msg-wrap .msg-item{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.msg-wrap .resend-icon{background-color:#ff4d4f;border-radius:50%;color:#fff;display:inline-block;height:16px;margin-right:10px;text-align:center;width:16px}";styleInject(css_248z$5);const NEChatRoomUI=({msgs:e,resendMsg:t})=>{const[r,n]=react.exports.useState(!1);return jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-ui"},{children:[jsxRuntime.exports.jsx(Dialog,Object.assign({visible:r,title:"",onCancel:()=>{n(!1)},onConfirm:function(){null==t||t(),n(!1)}},{children:"确认重发此条消息？"})),e&&e.map(((e,t)=>jsxRuntime.exports.jsx("div",{children:(null==e?void 0:e.isMe)?jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-wrap msg-wrap-self"},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-info msg-info-self"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"nickname"},{children:e.fromNick})),jsxRuntime.exports.jsx("span",Object.assign({className:"date"},{children:e.time}))]})),jsxRuntime.exports.jsx("div",Object.assign({className:"msg-content-wrap msg-content-self"},{children:"text"===e.type?jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-item"},{children:["fail"===e.status?jsxRuntime.exports.jsx("i",{onClick:()=>{n(!0)},className:"iconfont iconSubtract icon-red mr10"}):"",jsxRuntime.exports.jsx("span",Object.assign({className:"msg-text msg-text-self"},{children:e.text}))]})):jsxRuntime.exports.jsx("span",Object.assign({className:"msg-text msg-text-self msg-text-error"},{children:"暂不支持该消息类型"}))}))]})):jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-wrap msg-wrap-other"},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"msg-info msg-info-other"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"nickname"},{children:e.fromNick})),jsxRuntime.exports.jsx("span",Object.assign({className:"date"},{children:e.time}))]})),jsxRuntime.exports.jsx("div",Object.assign({className:"msg-content-wrap msg-content-other"},{children:"text"===e.type?jsxRuntime.exports.jsx("span",Object.assign({className:"msg-text msg-text-other"},{children:e.text})):jsxRuntime.exports.jsx("span",Object.assign({className:"msg-text msg-text-other msg-text-error"},{children:"暂不支持该消息类型"}))}))]}))},t)))]}))};function handleRecMsgService(e){let t=0;return{msgs:e=e.filter((e=>(["text","image","audio","video","file"].includes(e.type)&&(t+=1),["text","image","audio","video","file"].includes(e.type)||"notification"===e.type&&e.text))).map((e=>e=formatMsg(e))),unReadMsgsCount:t}}const handleMap={group:(e,t)=>(console.log("params",t),e.sendGroupTextMessage(t.toAccids,t.text).then((e=>e.data)).catch((e=>e))),orientation:(e,t)=>(console.log("params",t),e.sendBroadcastTextMessage(t.text).then((e=>e.data)).catch((e=>e))),resend:(e,t)=>(console.log("params",t),e.resendTextMessage(t.text,t.idClient,t.toAccids).then((e=>(console.log(e,"resend success"),e.data))).catch((e=>(console.log(e,"resend err"),e))))};function handleSendMsgService(e,t){return handleMap[t.msgType](e,t)}function formatMsg(e,t){return e.time=formatDate(e.time,"yyyy-MM-dd hh:mm:ss"),t&&(e.isMe=e.from===t),e}var css_248z$4=".ne-meeting-chatroom{background-color:rgba(0,0,0,.5);bottom:0;font-size:15px;height:0;left:0;overflow:hidden;position:absolute;right:0;width:100%;z-index:20}.ne-meeting-chatroom.show{height:100%}.ne-meeting-chatroom .ne-chatroom-body{background-color:#fff;bottom:0;height:0;left:0;position:absolute;right:0;z-index:21}.ne-meeting-chatroom .ne-chatroom-body.show{height:100%;transition:height .3s;-webkit-transition:height .3s}.ne-chatroom-header{font-weight:500;height:48px;line-height:48px;text-align:center}.ne-chatroom-header .title{font-size:16px}.chatroom-icon-close{color:#337eff;font-size:16px;left:16px;position:absolute;top:0}.ne-chatroom-content{height:calc(100% - 130px);overflow-y:scroll;padding:16px}.ne-chatroom-footer{background-color:#fff;border-top:1px solid #e1e3e6;box-sizing:border-box;display:flex;height:56px;justify-content:space-between;left:0;line-height:56px;padding:8px 10px calc(8px + env(safe-area-inset-bottom));position:absolute;right:0;z-index:22}.ne-chatroom-footer-bottom0{bottom:0}.ne-chatroom-footer-bottom50{bottom:50px}.ne-chatroom-input{background:#f2f3f5;border:0;border-radius:16px;height:40px;line-height:40px;outline:none;padding:0 12px;width:100%}.ne-chatroom-btn{align-self:center;background-color:#4d8eff;border-radius:14px;color:#fff;font-size:14px;height:28px;line-height:28px;margin-left:8px;min-width:52px}";styleInject(css_248z$4);const NEChatRoom=({visible:e=!1,onClose:t,unReadChange:r,receiveMsg:n})=>{const{neMeeting:i}=react.exports.useContext(GlobalContext),{meetingInfo:o,memberList:s}=react.exports.useContext(MeetingInfoContext),[a,c]=react.exports.useState(!1),[u,l]=react.exports.useState(0),[d,p]=react.exports.useState(""),[m,f]=react.exports.useState(),[h,g]=react.exports.useState([]),v=o.localMember,y=react.exports.useRef(null),[b,S]=react.exports.useState(!1);react.exports.useEffect((()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)}),[h]);const T={msgs:h,resendMsg:function(){if(console.log(m,"errorMsg"),!m)return;M({idClient:null==m?void 0:m.idClient,text:null==m?void 0:m.text,type:null==m?void 0:m.type,msgType:"resend",toAccids:[]})}};react.exports.useEffect((()=>{n&&function(e){console.log("--------onReceiveMsgs---------",e);const t=e,r=t[0].attach&&t[0].attach.type,n=["memberExit","memberEnter","kickMember","updateChatroom"];(function(e){const t=[...h],{msgs:r,unReadMsgsCount:n}=handleRecMsgService(e);console.log("--------unReadMsgs---------------",r,n),l(n+u);const i=[...t,...r];g(i)})(t),r&&n.includes(r)&&x()}(n)}),[n]),react.exports.useEffect((()=>{c(e),e?(null==r||r(0),l(0)):null==r||r(u)}),[e,u,r]);const _=react.exports.useMemo((()=>{if("IOS"===getClientType()&&"15.0"===getIosVersion()&&getBrowserType()!=BrowserType.WX){if(b)return"ne-chatroom-footer-bottom50";window.scrollBy(0,1)}return"ne-chatroom-footer-bottom0"}),[b]);react.exports.useEffect((()=>{console.log(v,s,"memberList"),function(){if(null==i?void 0:i.chatController){i.chatController.joinChatroom().then((e=>{console.log("joinChatroom success"),x()})).catch((e=>{console.error("joinChatroom err",e)}))}}()}),[]);const w=()=>{null==t||t()};function M(e){handleSendMsgService(null==i?void 0:i.chatController,e).then((e=>{e=formatMsg(e,v.uuid);const t=[...h];if(e.resend&&"success"===e.status){const r=t.findIndex((t=>t.idClient===e.idClient));return r>-1&&(t[r]=e),void g(t)}if(!e.resend){if("fail"===e.status||!e.status)return e.fromNick=v.name||"",f(e),void Toast.fail("发送失败，请重试");g([...t,e]),f(e)}p("")})).catch((e=>{console.error(e)}))}function x(){if(!(null==i?void 0:i.chatController))return void console.error("not init chatroom");const e=v.uuid;let t=s;return t=t.filter((t=>t.isInChatroom&&t.uuid!==e)),console.log("---------chatroom members------------",t),t}return jsxRuntime.exports.jsx("div",Object.assign({className:"ne-meeting-chatroom "+(a?"show":""),onClick:w},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-body "+(a?"show":""),onClick:e=>{e.stopPropagation()}},{children:[jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-header"},{children:[jsxRuntime.exports.jsx("span",Object.assign({className:"chatroom-icon-close",onClick:w},{children:"关闭"})),jsxRuntime.exports.jsx("span",Object.assign({className:"title"},{children:"聊天"}))]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"ne-chatroom-content",ref:y},{children:[jsxRuntime.exports.jsx(NEChatRoomUI,Object.assign({},T)),jsxRuntime.exports.jsxs("div",Object.assign({className:`ne-chatroom-footer ${_}`},{children:[jsxRuntime.exports.jsx("input",{value:d,className:"ne-chatroom-input",placeholder:"请输入消息...",onFocus:function(){S(!0)},onBlur:function(){S(!1)},onChange:e=>{p(e.target.value)}}),jsxRuntime.exports.jsx("span",Object.assign({className:"ne-chatroom-btn",onClick:function(){d&&d.trim()?(y.current&&(y.current.scrollTop=y.current.scrollHeight),M({text:d,type:"text",msgType:"orientation",toAccids:[]})):Toast.fail("无法发送内容为空的消息")}},{children:"发送"}))]}))]}))]}))}))},MeetingController=({className:e="",visible:t=!1,onClick:r,onRef:n})=>{const{meetingInfo:{localMember:i,audioOff:o,videoOff:s,screenUuid:a},memberList:c,dispatch:u}=react.exports.useContext(MeetingInfoContext),{neMeeting:l,eventEmitter:d}=react.exports.useContext(GlobalContext),[p,m]=react.exports.useState(!1),[f,h]=react.exports.useState(!1),[g,v]=react.exports.useState(0),[y,b]=react.exports.useState();react.exports.useImperativeHandle(n,(()=>({checkNeedHandsUp:C}))),react.exports.useEffect((()=>(console.log(i,c,"memberList"),null==d||d.on(EventType.ReceiveChatroomMessages,(e=>{b(e)})),null==d||d.on("needAudioHandsUp",(e=>{w(e)})),null==d||d.on("needVideoHandsUp",(e=>{T(e)})),()=>{null==d||d.off(EventType.ReceiveChatroomMessages),null==d||d.off("needAudioHandsUp"),null==d||d.off("needVideoHandsUp")})),[]);const[S,T]=react.exports.useState(!1),[_,w]=react.exports.useState(!1),[M,x]=react.exports.useState(!1),E=react.exports.useMemo((()=>!!a&&a===i.uuid),[a]),C=(e,t)=>{if(!t)return void("audio"===e?R(0):A(0));const r=i.role===Role.host||i.role===Role.coHost;"video"===e?s!==AttendeeOffType.offNotAllowSelfOn||r||E?A(1):i.isHandsUp?Toast.info("您已举手，等待主持人处理"):T(!0):"audio"===e&&(o!==AttendeeOffType.offNotAllowSelfOn||r||E?R(1):i.isHandsUp?Toast.info("您已举手，等待主持人处理"):w(!0))},R=e=>__awaiter$2(void 0,void 0,void 0,(function*(){console.log("操作本人音频 ",e);try{switch(e){case 1:yield null==l?void 0:l.unmuteLocalAudio();break;case 0:yield null==l?void 0:l.muteLocalAudio()}}catch(e){console.log("operateLocalAudio ",e)}})),k=e=>{null==l||l.sendMemberControl(e,i.uuid).then((()=>{e===memberAction.handsUp?Toast.info("举手成功，等待主持人处理"):Toast.info("取消举手成功"),u&&u({type:ActionType.UPDATE_MEMBER,data:{uuid:i.uuid,member:{isHandsUp:e===memberAction.handsUp}}})})).finally((()=>{e===memberAction.handsUp?(T(!1),w(!1)):x(!1)}))},A=e=>__awaiter$2(void 0,void 0,void 0,(function*(){console.log("操作本人视频 ",e);try{switch(e){case 1:yield null==l?void 0:l.unmuteLocalVideo();break;case 0:yield null==l?void 0:l.muteLocalVideo()}}catch(e){console.log("operateLocalVideo ",e)}}));return jsxRuntime.exports.jsxs(jsxRuntime.exports.Fragment,{children:[t&&jsxRuntime.exports.jsxs("div",Object.assign({className:`w-full meeting-controller absolute flex justify-around ${e||""}`,onClick:e=>{return t=e,void(null==r||r(t));var t}},{children:[jsxRuntime.exports.jsxs("div",Object.assign({onClick:()=>{C("audio",!i.isAudioOn)},className:"controller-item"},{children:[i.isAudioOn?jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconyx-tv-voice-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red icon-tool iconfont iconyx-tv-voice-offx"}),jsxRuntime.exports.jsx("div",{children:i.isAudioOn?"静音":"取消静音"})]})),jsxRuntime.exports.jsxs("div",Object.assign({onClick:()=>{C("video",!i.isVideoOn)},className:"controller-item"},{children:[i.isVideoOn?jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconyx-tv-video-onx"}):jsxRuntime.exports.jsx("i",{className:"icon-red icon-tool iconfont iconyx-tv-video-offx"}),jsxRuntime.exports.jsx("div",{children:i.isVideoOn?"停止视频":"开启视频"})]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"relative controller-item"},{children:[i.isHandsUp&&jsxRuntime.exports.jsxs("span",Object.assign({className:"hands-up-tip",onClick:()=>{x(!0)}},{children:[jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconraisehands1x"}),jsxRuntime.exports.jsx("span",{className:"hands-arrow"}),jsxRuntime.exports.jsx("span",Object.assign({className:"hands-arrow-text"},{children:"举手中"}))]})),jsxRuntime.exports.jsxs("div",Object.assign({onClick:()=>{m(!p)}},{children:[jsxRuntime.exports.jsx("div",Object.assign({className:"absolute member-count"},{children:(null==c?void 0:c.length)>99?"99+":null==c?void 0:c.length})),jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconyx-tv-attendeex"}),jsxRuntime.exports.jsx("div",{children:i.role===Role.host||i.role===Role.coHost?"管理参会者":"参会者"})]}))]})),jsxRuntime.exports.jsxs("div",Object.assign({className:"relative controller-item",onClick:()=>{h(!0),v(0)}},{children:[g?jsxRuntime.exports.jsx("div",Object.assign({className:"unread-count"},{children:g>99?"99+":g})):"",jsxRuntime.exports.jsx("i",{className:"icon-tool iconfont iconshipin-liaotian"}),jsxRuntime.exports.jsx("div",{children:"聊天"})]}))]})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:S,title:"提示",onCancel:()=>{T(!1)},onConfirm:()=>{k(memberAction.handsUp)}},{children:jsxRuntime.exports.jsx("div",Object.assign({style:{color:"#000",fontSize:"13px"}},{children:"主持人已将全体关闭视频，您可以举手申请发言"}))})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:_,title:"提示",onCancel:()=>{w(!1)},onConfirm:()=>{k(memberAction.handsUp)}},{children:jsxRuntime.exports.jsx("div",Object.assign({style:{color:"#000",fontSize:"13px"}},{children:"主持人已将全体关闭音频，您可以举手申请发言"}))})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:M,title:"提示",onCancel:()=>{x(!1)},onConfirm:()=>{k(memberAction.handsDown)}},{children:jsxRuntime.exports.jsx("div",Object.assign({style:{color:"#000",fontSize:"13px"}},{children:"确认取消举手申请吗？"}))})),jsxRuntime.exports.jsx(NEChatRoom,{visible:f,onClose:()=>h(!1),unReadChange:e=>v(e),receiveMsg:y}),jsxRuntime.exports.jsx(MemberListUI,{visible:p,onClose:()=>{m(!1)}})]})};var css_248z$3=".App{height:100%;text-align:center}.App-header{align-items:center;background-color:#282c34;color:#fff;display:flex;flex-direction:column;font-size:calc(10px + 2vmin);justify-content:center;min-height:100vh}.nemeeting-time-tip-wrap{left:50%;min-width:250px;position:absolute;top:20px;transform:translateX(-50%);z-index:30}.meeting-loading{background:#292932;height:100vh;margin:auto;position:relative;text-align:center;width:100vw;z-index:510}.meeting-loading-content{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.meeting-loading-text{color:#fff;font-size:14px}.meeting-loading-img{height:100px;width:100px}.icon-white{color:#fff!important}.icon-red{color:#fe3b30!important}.icon-bule{color:#337eff!important}";styleInject(css_248z$3);var css_248z$2='@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/c/font_2183559_tkkdsglaz4q.woff2?t=1659448086418) format("woff2"),url(//at.alicdn.com/t/c/font_2183559_tkkdsglaz4q.woff?t=1659448086418) format("woff"),url(//at.alicdn.com/t/c/font_2183559_tkkdsglaz4q.ttf?t=1659448086418) format("truetype")}.iconfont{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:iconfont!important;font-size:14px;font-style:normal}.iconxiangjifanzhuan1:before{content:"\\e600"}.iconguzhang:before{content:"\\e62c"}.iconxiangmu1:before{content:"\\e62b"}.icona-Frame2:before{content:"\\e6b9"}.iconjinggao:before{content:"\\e601"}.iconfsfds:before{content:"\\e69c"}.icona-45:before{content:"\\e69d"}.iconSIP:before{content:"\\e68b"}.iconSIP-copy:before{content:"\\e83e"}.iconzhuanshipin:before{content:"\\e67c"}.iconzhuanyuyin:before{content:"\\e67b"}.iconjiantou-zuo:before{content:"\\e675"}.iconbeijing:before{content:"\\e676"}.iconjiantou-shang:before{content:"\\e677"}.iconjiantou-you:before{content:"\\e678"}.iconxunirenkaiqi:before{content:"\\e679"}.iconxunirenguanbi:before{content:"\\e67a"}.iconshipin-shexiangtou:before{content:"\\e621"}.iconshipin-xianshi:before{content:"\\e622"}.iconshipin-maikefeng:before{content:"\\e623"}.iconshipin-shexiangtou-jinyong:before{content:"\\e624"}.iconshipin-gongxiangpingmu:before{content:"\\e625"}.iconyinliang2:before{content:"\\e626"}.iconyinliang1:before{content:"\\e627"}.iconshipin-liaotian:before{content:"\\e628"}.iconshipin-yincang:before{content:"\\e629"}.iconshipin-maikefeng-jinyong:before{content:"\\e62a"}.iconchuansongtupian:before{content:"\\e617"}.iconchuansongfujian:before{content:"\\e618"}.iconxiaochengxu:before{content:"\\e824"}.iconduigou:before{content:"\\e807"}.iconduorenshipin:before{content:"\\e808"}.iconshexiangtouguan:before{content:"\\e809"}.icongeren2:before{content:"\\e80b"}.icondianhua:before{content:"\\e80c"}.iconshexiangtoukai:before{content:"\\e80d"}.iconchahao:before{content:"\\e80e"}.icongeren1:before{content:"\\e80f"}.iconyingyong2:before{content:"\\e810"}.iconyingyong1:before{content:"\\e811"}.icongengduo:before{content:"\\e812"}.iconshezhi:before{content:"\\e813"}.iconfangda:before{content:"\\e814"}.iconsuoxiao:before{content:"\\e815"}.iconAndroid:before{content:"\\e816"}.iconmeiyan:before{content:"\\e81d"}.iconiOS:before{content:"\\e81e"}.iconxinhao:before{content:"\\e81f"}.iconshuju:before{content:"\\e820"}.iconWindows:before{content:"\\e821"}.iconxiangjifanzhuan:before{content:"\\e822"}.iconmacOS:before{content:"\\e823"}.iconyasuobao:before{content:"\\e619"}.iconqitawenjian1:before{content:"\\e61b"}.iconExcel:before{content:"\\e61c"}.iconWord:before{content:"\\e61d"}.iconSubtract:before{content:"\\e61e"}.iconPDF:before{content:"\\e61f"}.iconPPT:before{content:"\\e620"}.iconxiazai:before{content:"\\e61a"}.iconshangchuantupian:before{content:"\\e60c"}.iconbendiluzhi:before{content:"\\e60d"}.iconfengxiantishi:before{content:"\\e60e"}.iconshishipaizhao:before{content:"\\e60f"}.icongongxiangpingmu:before{content:"\\e610"}.icontonghuaguaqi:before{content:"\\e611"}.iconshangchuanfujian:before{content:"\\e612"}.iconkaiqimeiyan:before{content:"\\e613"}.iconzhuanjie:before{content:"\\e614"}.iconyaoqingzuoxi:before{content:"\\e615"}.icongongxiangwenjian:before{content:"\\e616"}.iconmorentouxiang:before{content:"\\e60b"}.iconqitawenjian:before{content:"\\e608"}.iconbaiban-fuzhi:before{content:"\\e605"}.iconbaiban-wenjianjia:before{content:"\\e606"}.iconyx-baiban:before{content:"\\e603"}.iconcross-y1x:before{content:"\\e830"}.iconhook-y1x:before{content:"\\e831"}.iconwarning-y1x:before{content:"\\e832"}.iconproblem1x:before{content:"\\e833"}.icondianzanx:before{content:"\\e754"}.icondianchapingx:before{content:"\\e759"}.iconhappy1x:before{content:"\\e83d"}.iconhang-up-y1x:before{content:"\\e82f"}.iconyx-input-clearx:before{content:"\\e789"}.iconfd-editx:before{content:"\\e78b"}.iconyx-tv-settingx1:before{content:"\\e78c"}.iconpassword-displayx:before{content:"\\e78d"}.iconpassword-hidex:before{content:"\\e78e"}.iconyx-pc-closex:before{content:"\\e790"}.iconyx-pc-maximizex:before{content:"\\e791"}.iconyx-pc-narrowx:before{content:"\\e792"}.iconyx-pc-restorex:before{content:"\\e796"}.iconyx-allowx:before{content:"\\e7a5"}.iconyx-tv-layout-bx:before{content:"\\e7b2"}.iconyx-tv-layout-ax:before{content:"\\e7b3"}.iconyx-tv-sharescreen1x:before{content:"\\e7b9"}.iconsound-soft1x:before{content:"\\e7bf"}.iconsound-loud1x:before{content:"\\e7c0"}.iconvideo-shrink-a1x:before{content:"\\e7c1"}.iconvideo-fullscreen-a1x:before{content:"\\e7c2"}.iconsignal1x:before{content:"\\e7d2"}.iconcheck-line-regular1x:before{content:"\\e7d3"}.iconsound-medium:before{content:"\\e7d4"}.iconsound-mute:before{content:"\\e7d5"}.iconsound-loud:before{content:"\\e7d6"}.iconyx-tv-more1x:before{content:"\\e7fd"}.iconcalendar1x:before{content:"\\e7fe"}.icondate-line:before{content:"\\e683"}.icontriangle-up1x:before{content:"\\e7f3"}.icontriangle-down1x:before{content:"\\e7f4"}.iconearpiece1x:before{content:"\\e7ff"}.iconamplify:before{content:"\\e800"}.iconheadset1x:before{content:"\\e801"}.iconarrow-double-line-regular:before{content:"\\e720"}.iconarrow-line-regular:before{content:"\\e724"}.iconyx-tv-duankai1x:before{content:"\\e607"}.iconcertification1x:before{content:"\\e817"}.iconcopy1x:before{content:"\\e818"}.iconnarrow-line1x:before{content:"\\e819"}.iconsearch2-line1x:before{content:"\\e81a"}.iconcross:before{content:"\\e80a"}.iconraisehands1x:before{content:"\\e81b"}.iconbeauty1x:before{content:"\\e81c"}.iconyx-tv-filpx-copy:before{content:"\\e83f"}.iconyx-tv-createx:before{content:"\\e75e"}.iconyx-tv-voice-offx:before{content:"\\e761"}.iconyx-tv-voice-onx:before{content:"\\e763"}.iconyx-tv-video-onx:before{content:"\\e760"}.iconyx-tv-video-offx:before{content:"\\e762"}.iconyx-tv-invitex:before{content:"\\e764"}.iconyx-tv-attendeex:before{content:"\\e765"}.iconyx-tv-joinx:before{content:"\\e766"}.iconyx-tv-likaix:before{content:"\\e767"}.iconyx-tv-duankaix:before{content:"\\e768"}.iconyx-tv-jieshux:before{content:"\\e769"}.iconyx-tv-computerx:before{content:"\\e76a"}.iconyx-tv-tvx:before{content:"\\e76b"}.iconyx-tv-cancelx:before{content:"\\e76c"}.iconyx-tv-settingx:before{content:"\\e76d"}.iconyx-tv-filpx:before{content:"\\e76e"}.iconyx-tv-removex:before{content:"\\e770"}.iconyx-pc-successx:before{content:"\\e76f"}.iconroom-flowx:before{content:"\\e77f"}.iconanchor-flowx:before{content:"\\e780"}.iconyx-returnx:before{content:"\\e788"}';styleInject(css_248z$2);var browser={exports:{}},s=1e3,m$1=60*s,h$1=60*m$1,d$1=24*h$1,w$1=7*d$1,y$1=365.25*d$1,ms=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return parse(e);if("number"===r&&isFinite(e))return t.long?fmtLong(e):fmtShort(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*y$1;case"weeks":case"week":case"w":return r*w$1;case"days":case"day":case"d":return r*d$1;case"hours":case"hour":case"hrs":case"hr":case"h":return r*h$1;case"minutes":case"minute":case"mins":case"min":case"m":return r*m$1;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function fmtShort(e){var t=Math.abs(e);return t>=d$1?Math.round(e/d$1)+"d":t>=h$1?Math.round(e/h$1)+"h":t>=m$1?Math.round(e/m$1)+"m":t>=s?Math.round(e/s)+"s":e+"ms"}function fmtLong(e){var t=Math.abs(e);return t>=d$1?plural(e,t,d$1,"day"):t>=h$1?plural(e,t,h$1,"hour"):t>=m$1?plural(e,t,m$1,"minute"):t>=s?plural(e,t,s,"second"):e+" ms"}function plural(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}function setup(e){function t(e){let n,i,o,s=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";s++;const o=t.formatters[i];if("function"==typeof o){const t=e[s];n=o.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=ms,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}var common=setup;!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=common(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(browser,browser.exports);var debug=browser.exports;debug.formatters.t=()=>`[${formatDate(new Date,"yyyy-MM-dd hh:mm:ss")}]`;const APP_NAME="NeMeeting";class Logger{constructor(e,t){Object.defineProperty(this,"_debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_warn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e?(this._debug=debug(e),this._warn=debug(`${e}:WARN`),this._error=debug(`${e}:ERROR:`)):(this._debug=debug(APP_NAME),this._warn=debug(`${APP_NAME}:WARN`),this._error=debug(`${APP_NAME}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console),t&&(this._debug.enabled=!0,this._warn.enabled=!0,this._error.enabled=!0)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}const logger$3=new Logger("Meeting-NeMeeting",!0);function updateMeetingService(e,t){const r=null==e?void 0:e.getMeetingInfo();console.log("获取会议信息",r),r&&t({type:ActionType.SET_MEETING,data:r})}class NEMeetingService{constructor(e){Object.defineProperty(this,"roomContext",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rtcController",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"chatController",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"whiteboardController",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"previewController",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isUnMutedAudio",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isUnMutedVideo",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_isAnonymous",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_isLoginedByAccount",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_meetingStatus",{enumerable:!0,configurable:!0,writable:!0,value:"unlogin"}),Object.defineProperty(this,"roomService",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"authService",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"messageService",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_roomkit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_eventEmitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_userUuid",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_appKey",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_token",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_meetingServerDomain",{enumerable:!0,configurable:!0,writable:!0,value:"https://roomkit.netease.im"}),Object.defineProperty(this,"_privateMeetingNum",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_meetingInfo",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_meetingType",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_isReuseIM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this._roomkit=e.roomkit,this._eventEmitter=e.eventEmitter,this._request=this.createRequest()}get meetingId(){return this._meetingInfo.meetingNum}init(e){var t;return __awaiter$2(this,void 0,void 0,(function*(){this._appKey=e.appKey,e.meetingServerDomain&&(this._meetingServerDomain=e.meetingServerDomain),this._isReuseIM=!!e.im,e.globalEventListener&&this._roomkit.addGlobalEventListener(e.globalEventListener);const r={appKey:this._appKey,im:e.im,debug:e.debug,eventTracking:e.eventTracking};e.imPrivateConf||e.neRtcServerAddresses||e.whiteboardConfig||e.meetingServerDomain&&"https://roomkit.netease.im"!==e.meetingServerDomain?r.serverConfig={roomKitServerConfig:{roomServer:this._meetingServerDomain},imServerConfig:e.imPrivateConf,rtcServerConfig:e.neRtcServerAddresses,whiteboardServerConfig:e.whiteboardConfig}:e.serverUrl&&(this._meetingServerDomain=e.serverUrl,r.serverUrl=e.serverUrl),yield this._roomkit.initialize(r),this._request=this.createRequest(),this.authService=this._roomkit.authService,this.roomService=this._roomkit.roomService,this.previewController=null===(t=this.roomService.getPreviewRoomContext())||void 0===t?void 0:t.previewController,this.messageService=this._roomkit.messageChannelService,this.messageService.addMessageChannelListener({onReceiveCustomMessage:e=>{if(console.log("onReceiveCustomMessage",e),99!==e.commandId)return;const t=e.data.body;"[object String]"==Object.prototype.toString.call(t)&&(e.data.body=JSON.parse(t)),this._eventEmitter.emit(EventType.ReceivePassThroughMessage,e)}})}))}getGlobalConfig(){return __awaiter$2(this,void 0,void 0,(function*(){return this._request.get(`/scene/meeting/${this._appKey}/v1/config`).then((e=>(logger$3.debug("getGlobalConfig",e),e)))}))}login(e){return __awaiter$2(this,void 0,void 0,(function*(){try{const{username:t,password:r}=e;if(1===e.loginType){this._userUuid=e.accountId,this._token=e.accountToken,this.authService&&(yield this.authService.login(e.accountId,e.accountToken));const t=yield this._request.get(`/scene/meeting/${this._appKey}/v1/account/info`);this._privateMeetingNum=t.privateMeetingNum}else{const e=yield this._request.post(`/scene/meeting/${this._appKey}/v1/login/${t}`,{password:Md5_1.hashStr(r+"@yiyong.im")});this._userUuid=e.userUuid,this._token=e.userToken,this._privateMeetingNum=e.privateMeetingNum,this.authService&&(yield this.authService.login(e.userUuid,e.userToken))}return void(this._isLoginedByAccount=!0)}catch(e){return this._isLoginedByAccount=!1,Promise.reject(e)}}))}create(e){return __awaiter$2(this,void 0,void 0,(function*(){try{const{meetingId:t,password:r,subject:n,roleBinds:i,noSip:o}=e;this.isUnMutedAudio=1==e.audio,this.isUnMutedVideo=1==e.video,this._meetingType=e.meetingId;const s=yield this._request.put(`/scene/meeting/${this._appKey}/v1/create/${t}`,{password:r,subject:n,roleBinds:i,roomConfigId:40,roomConfig:{resource:{rtc:!0,chatroom:!e.nochat,whiteboard:!0,record:!e.noCloudRecord,sip:void 0!==o&&!o}},roomProperties:{cloudRecord:{mode:0,videoEnable:!0,audioEnable:!0},extraData:{value:e.extraData},lock:{value:0},audioOff:{value:(e.attendeeAudioOff?AttendeeOffType.offNotAllowSelfOn:AttendeeOffType.disable)+`_${(new Date).getTime()}`},videoOff:{value:(e.attendeeVideoOff?AttendeeOffType.offNotAllowSelfOn:AttendeeOffType.disable)+`_${(new Date).getTime()}`}}});if(this._meetingInfo=s,yield this._joinRoomkit({role:"host",roomUuid:s.roomUuid,nickname:e.nickName,initialProperties:{tag:{value:e.memberTag}}}),this._addRoomListener(),e.videoProfile){const{resolution:t,frameRate:r}=e.videoProfile;yield this.setVideoProfile(t,r)}this.rtcController&&(yield this.rtcController.joinRtcChannel(),yield this.rtcController.setLocalAudioProfile("music_standard")),console.log("create meeting ",s),this._meetingStatus="created",this._meetingStatus="joined"}catch(e){return 3100===e.code?this._meetingType=2:this._meetingType=0,this._meetingStatus="login"===this._meetingStatus?"login":"unlogin",Promise.reject(e)}}))}anonymousJoin(e){return __awaiter$2(this,void 0,void 0,(function*(){if(this._isReuseIM)return console.warn("im复用不支持匿名入会"),{code:-101,message:"im复用不支持匿名入会"};if(this._isLoginedByAccount)return console.warn("已通过账号登录，建议直接入会。或者登出后再匿名入会"),{code:-102,message:"已通过账号登录，建议直接入会。或者登出后再匿名入会"};this.isUnMutedAudio=1==e.audio,this.isUnMutedVideo=1==e.video,this._isAnonymous=!0,console.log("anonymousJoin",e);try{const t=yield this._request.post(`/scene/apps/${this._appKey}/v1/anonymous/login`);e.role=e.role||Role.member,this._userUuid=t.userUuid,this._token=t.userToken,this._privateMeetingNum=t.privateMeetingNum||"";try{this.authService&&(yield this.authService.login(t.userUuid,t.userToken))}catch(e){console.log("authService.login",e)}yield this._joinHandler(e)}catch(e){throw console.log("anonymousJoin",e),e}}))}logout(){return __awaiter$2(this,void 0,void 0,(function*(){try{this.authService&&this.authService.logout(),this._isLoginedByAccount=!1,this._isAnonymous=!1,this._meetingStatus="unlogin"}catch(e){throw console.log("logout",e),e}}))}leave(e){return __awaiter$2(this,void 0,void 0,(function*(){try{logger$3.debug("leave() %t"),this.roomContext&&(yield this.roomContext.leaveRoom()),"AnonymousParticipant"===e||this._isAnonymous?this._meetingStatus="unlogin":this._meetingStatus="login",this._reset(),logger$3.debug("leave() successed %t")}catch(e){return Promise.reject(e)}}))}end(){return __awaiter$2(this,void 0,void 0,(function*(){try{logger$3.debug("end():  %s %t",this._isAnonymous),this.roomContext&&(yield this.roomContext.endRoom()),this._isAnonymous?this._meetingStatus="unlogin":this._meetingStatus="login",DataReporter$1.destroy(),this._reset(),logger$3.debug("end() successed:  %s %t",this._meetingStatus)}catch(e){return Promise.reject(e)}}))}resetStatus(){this._isAnonymous?(this._meetingStatus="unlogin",this.authService&&this.authService.logout(),this._isAnonymous=!1):this._meetingStatus="login"}getMeetingInfo(){var e,t,r,n;if(!this.roomContext)return null;const i=this.roomContext.remoteMembers,o=this.roomContext.localMember,s=this.roomContext.roomProperties;s.audioOff&&(s.audioOff.value=null===(e=s.audioOff.value)||void 0===e?void 0:e.split("_")[0]),s.videoOff&&(s.videoOff.value=null===(t=s.videoOff.value)||void 0===t?void 0:t.split("_")[0]);let a="",c="";const u=this.rtcController.getScreenSharingUserUuid(),l=s.wbSharingUuid?s.wbSharingUuid.value:"",d=s.focus?s.focus.value:"";o.isInChatroom=!0;const p=[o,...i],m=[];let f=!1;p.forEach((e=>{var t,r,n,i,s;(null===(t=e.role)||void 0===t?void 0:t.name)===NEMeetingRole.host&&(a=e.uuid,c=e.name);const u=null===(r=e.properties)||void 0===r?void 0:r.handsUp,l=(null===(n=e.role)||void 0===n?void 0:n.name)!==NEMeetingRole.host&&(null===(i=e.role)||void 0===i?void 0:i.name)!==NEMeetingRole.coHost&&(!(!u||!u.value)&&1==u.value);e.uuid===o.uuid&&(f=l),m.push(Object.assign(Object.assign({},e),{role:null===(s=e.role)||void 0===s?void 0:s.name,isHandsUp:l}))}));const{subject:h,startTime:g,endTime:v,type:y,settings:b,shortMeetingNum:S,meetingNum:T,meetingId:_}=this._meetingInfo;return{memberList:m,meetingInfo:{localMember:Object.assign(Object.assign({},o),{role:null===(r=o.role)||void 0===r?void 0:r.name,isHandsUp:f}),myUuid:o.uuid,focusUuid:d,hostUuid:a,hostName:c,screenUuid:u,whiteboardUuid:l,properties:s,password:this.roomContext.password,subject:h,startTime:g,endTime:v,type:y,shortMeetingNum:S,sipCid:this.roomContext.sipCid,activeSpeakerUuid:"",meetingId:_,meetingNum:T,remainingSeconds:this.roomContext.remainingSeconds,videoOff:s.videoOff?s.videoOff.value:AttendeeOffType.disable,audioOff:s.audioOff?s.audioOff.value:AttendeeOffType.disable,isLocked:1===(null===(n=s.lock)||void 0===n?void 0:n.value)}}}sendMemberControl(e,t){return this._handleMemberAction(e,t)}sendHostControl(e,t){return this._handleHostAction(e,t)}muteLocalAudio(e=!0){return __awaiter$2(this,void 0,void 0,(function*(){return e?this.sendMemberControl(memberAction.muteAudio):!!this.rtcController&&(yield this.rtcController.muteMyAudio(),!0)}))}unmuteLocalAudio(e,t=!0){return __awaiter$2(this,void 0,void 0,(function*(){return t?this.sendMemberControl(memberAction.unmuteAudio):!!this.rtcController&&(e?yield this.rtcController.switchDevice({type:"microphone",deviceId:e}):yield this.rtcController.unmuteMyAudio(),!0)}))}muteLocalVideo(e=!0){return __awaiter$2(this,void 0,void 0,(function*(){return e?this.sendMemberControl(memberAction.muteVideo):!!this.rtcController&&(yield this.rtcController.muteMyVideo(),!0)}))}unmuteLocalVideo(e,t=!0){return __awaiter$2(this,void 0,void 0,(function*(){if(t)return this.sendMemberControl(memberAction.unmuteVideo);if(!this.rtcController)return console.warn("unmuteLocalVideo no _webrtc %t"),!1;try{return yield this.rtcController.unmuteMyVideo(),console.debug("unmuteLocalVideo success %t"),!0}catch(e){return console.warn("unmuteLocalVideo failed ",e),!1}}))}muteLocalScreenShare(){return __awaiter$2(this,void 0,void 0,(function*(){console.debug("muteLocalScreenShare"),this.rtcController?(yield this.rtcController.stopScreenShare(),console.debug("muteLocalScreenShare success %t")):console.warn("muteLocalScreenShare no _webrtc %t")}))}unmuteLocalScreenShare(){return __awaiter$2(this,void 0,void 0,(function*(){logger$3.debug("unmuteLocalScreenShare %t"),this.rtcController?(yield this.rtcController.startScreenShare(),logger$3.debug("unmuteLocalScreenShare success %t")):logger$3.warn("unmuteLocalScreenShare no _webrtc %t")}))}changeLocalAudio(e){return __awaiter$2(this,void 0,void 0,(function*(){this.rtcController?(yield this.rtcController.switchDevice({type:"microphone",deviceId:e}),logger$3.debug("changeLocalAudio success %t")):logger$3.warn("changeLocalAudio no _webrtc %t")}))}changeLocalVideo(e,t=!0){return __awaiter$2(this,void 0,void 0,(function*(){if(this.rtcController)try{yield this.rtcController.switchDevice({type:"camera",deviceId:e}),logger$3.debug("changeLocalVideo success %t")}catch(e){throw logger$3.warn("changeLocalVideo error",e),e}else logger$3.warn("changeLocalVideo no _webrtc %t")}))}join(e){return __awaiter$2(this,void 0,void 0,(function*(){try{return e.role=e.role||Role.member,this.isUnMutedAudio=1==e.audio,this.isUnMutedVideo=1==e.video,logger$3.debug("_meetingStatus:  %s %t",this._meetingStatus),"created"!==this._meetingStatus&&"login"!==this._meetingStatus||logger$3.debug("join() %o %t",e),this._joinHandler(e)}catch(e){return logger$3.debug("join() failed: %o",e),Promise.reject(e)}}))}getSelectedRecordDevice(){return this.rtcController?this.rtcController.getSelectedRecordDevice():""}getSelectedCameraDevice(){return this.rtcController?this.rtcController.getSelectedCameraDevice():""}getSelectedPlayoutDevice(){return this.rtcController?this.rtcController.getSelectedPlayoutDevice():""}getMicrophones(){return __awaiter$2(this,void 0,void 0,(function*(){if(this.rtcController){const e=yield this.rtcController.enumRecordDevices();return logger$3.debug("getMicrophones success, %o %t",e.data),e.data.map((e=>(e.deviceName.indexOf("USB")<0&&e.deviceName.indexOf("Built")<0&&e.deviceName.indexOf("外置")<0&&e.deviceName.indexOf("麦克风")<0&&e.deviceName.indexOf("默认")<0&&(e.deviceName=e.deviceName+"（不推荐）"),e)))}return logger$3.warn("getMicrophones no previewController %t"),[]}))}getCameras(){return __awaiter$2(this,void 0,void 0,(function*(){if(logger$3.debug("getCameras"),this.rtcController){const e=yield this.rtcController.enumCameraDevices();return logger$3.debug("getCameras success, %o %t",e.data),e.data}logger$3.warn("getCameras no _webrtc %t")}))}getSpeakers(){return __awaiter$2(this,void 0,void 0,(function*(){if(logger$3.debug("getSpeakers %t"),this.rtcController){const e=yield this.rtcController.enumPlayoutDevices();return logger$3.debug("getSpeakers success, %o %t",e.data),e.data.map((e=>(e.deviceName.indexOf("USB")<0&&e.deviceName.indexOf("Built")<0&&e.deviceName.indexOf("外置")<0&&e.deviceName.indexOf("扬声器")<0&&e.deviceName.indexOf("默认")<0&&(e.deviceName=e.deviceName+"（不推荐）"),e)))}logger$3.warn("getSpeakers no _webrtc %t")}))}selectSpeakers(e){return __awaiter$2(this,void 0,void 0,(function*(){if(logger$3.debug("selectSpeakers %s %t",e),this.rtcController)return yield this.rtcController.switchDevice({type:"speaker",deviceId:e}),void logger$3.debug("selectSpeakers success %t");logger$3.warn("selectSpeakers no _webrtc %t")}))}setVideoProfile(e,t){return __awaiter$2(this,void 0,void 0,(function*(){this.rtcController?yield this.rtcController.setLocalVideoConfig({resolution:e,frameRate:t}):console.warn("setVideoProfile no _webrtc %t")}))}setAudioProfile(e){return __awaiter$2(this,void 0,void 0,(function*(){this.rtcController?yield this.rtcController.setLocalAudioProfile(e):console.warn("setAudioProfile no _webrtc %t")}))}modifyNickName(e){var t;return __awaiter$2(this,void 0,void 0,(function*(){return yield null===(t=this.roomContext)||void 0===t?void 0:t.changeMyName(e.nickName)}))}replayRemoteStream(e){logger$3.debug("replayRemoteStream %s %t",e.userUuid,e.type),this.rtcController&&this.rtcController.replayRemoteStream(e)}checkSystemRequirements(){return __awaiter$2(this,void 0,void 0,(function*(){return this.previewController?this.previewController.checkSystemRequirements():Promise.reject("检查异常")}))}destroy(){var e;return __awaiter$2(this,void 0,void 0,(function*(){logger$3.debug("destroy() %t"),yield this.destroyRoomContext(),null===(e=this.authService)||void 0===e||e.logout(),this._meetingStatus="unlogin"}))}destroyRoomContext(){return __awaiter$2(this,void 0,void 0,(function*(){logger$3.debug("destroyRoomContext() %t"),this.roomContext&&(yield this.roomContext.destroy()),this._isAnonymous&&(this._meetingStatus="unlogin",this.authService&&this.authService.logout(),this._isAnonymous=!1),this._reset()}))}_reset(){this.roomContext=null,this.rtcController=null,this.whiteboardController=null,this.chatController=null,this._meetingType=0,this._isLoginedByAccount=!1}_addRoomListener(){this.roomContext&&this.roomContext.addRoomListener({onMemberAudioMuteChanged:(e,t,r)=>{this._eventEmitter.emit(EventType.MemberAudioMuteChanged,e,t,r)},onMemberJoinChatroom:e=>__awaiter$2(this,void 0,void 0,(function*(){console.log("onMemberJoinChatroom",e[0])})),onMemberJoinRoom:e=>{console.log(EventType.MemberJoinRoom,e),this._eventEmitter.emit(EventType.MemberJoinRoom,e)},onMemberNameChanged:(e,t)=>{this._eventEmitter.emit(EventType.MemberNameChanged,e,t)},onMemberLeaveChatroom:e=>{console.log(EventType.MemberLeaveChatroom,e)},onMemberLeaveRoom:e=>{var t;console.log("onMemberLeaveRoom",e),1==e.length&&(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)===e[0].uuid&&(this._meetingStatus="login"),this._eventEmitter.emit(EventType.MemberLeaveRoom,e)},onMemberRoleChanged:(e,t,r)=>{this._eventEmitter.emit(EventType.MemberRoleChanged,e,t.name,r.name)},onMemberScreenShareStateChanged:(e,t,r)=>__awaiter$2(this,void 0,void 0,(function*(){this._eventEmitter.emit(EventType.MemberScreenShareStateChanged,e,t,r)})),onMemberVideoMuteChanged:(e,t,r)=>__awaiter$2(this,void 0,void 0,(function*(){this._eventEmitter.emit(EventType.MemberVideoMuteChanged,e,t,r)})),onMemberWhiteboardStateChanged:(e,t,r)=>__awaiter$2(this,void 0,void 0,(function*(){this._eventEmitter.emit(EventType.MemberWhiteboardStateChanged,e,t,r)})),onReceiveChatroomMessages:e=>{this._eventEmitter.emit(EventType.ReceiveChatroomMessages,e)},onRoomPropertiesChanged:e=>{this._eventEmitter.emit(EventType.RoomPropertiesChanged,e)},onRoomLockStateChanged:e=>{this._eventEmitter.emit(EventType.RoomLockStateChanged,e)},onMemberPropertiesChanged:(e,t)=>{this._eventEmitter.emit(EventType.MemberPropertiesChanged,e.uuid,t)},onMemberPropertiesDeleted:(e,t)=>{const r=Object.keys(t);this._eventEmitter.emit(EventType.MemberPropertiesDeleted,e,r)},onRoomPropertiesDeleted:e=>{const t=Object.keys(e);this._eventEmitter.emit(EventType.RoomPropertiesDeleted,t)},onRoomEnded:e=>{this._meetingStatus="login","kICK_BY_SELF"===e?this._clientBanned():this._eventEmitter.emit(EventType.RoomEnded,e)},onRtcActiveSpeakerChanged:e=>{this._eventEmitter.emit(EventType.RtcActiveSpeakerChanged,e)},onRtcChannelError:e=>{console.log("onRtcChannelError",e),"SOCKET_ERROR"===e&&(this._isAnonymous?(this._meetingStatus="unlogin",this.authService&&this.authService.logout()):this._meetingStatus="login",this._eventEmitter.emit(EventType.NetworkError))},onRoomConnectStateChanged:e=>{console.log(EventType.RoomConnectStateChanged,e),this._connectionStateChange(e)},onCameraDeviceChanged:e=>{this._deviceChange(e)},onPlayoutDeviceChanged:e=>{this._deviceChange(e)},onRecordDeviceChanged:e=>{this._deviceChange(e)},onAutoPlayNotAllowed:e=>{this._eventEmitter.emit(EventType.AutoPlayNotAllowed,e)},onRoomRemainingSecondsRenewed:e=>{this._eventEmitter.emit(EventType.roomRemainingSecondsRenewed,e)}})}_joinHandler(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=2===this._meetingType?this._privateMeetingNum:e.meetingNum||e.meetingId,r=yield this._request.get(`/scene/meeting/${this._appKey}/v1/info/${t}`);if(this._meetingInfo=r,console.log("options..",e),yield this._joinRoomkit({role:e.role,roomUuid:r.roomUuid,nickname:e.nickName,password:e.password,initialProperties:{tag:{value:e.memberTag}}}),this._addRoomListener(),e.videoProfile){const{resolution:t,frameRate:r}=e.videoProfile;yield this.setVideoProfile(t,r)}this.rtcController&&(yield this.rtcController.joinRtcChannel(),yield this.rtcController.setLocalAudioProfile("music_standard")),this._meetingStatus="joined"}))}_deviceChange(e){}_connectionStateChange(e){"DISCONNECTED"===e.curState&&"joined"===this._meetingStatus||("CONNECTING"===e.curState&&"joined"===this._meetingStatus?this._eventEmitter.emit(EventType.NetworkReconnect):("CONNECTED"===e.prevState&&"CONNECTED"===e.curState||"CONNECTING"===e.prevState&&"CONNECTED"===e.curState)&&"joined"===this._meetingStatus&&this._eventEmitter.emit(EventType.NetworkReconnectSuccess))}_handleMemberAction(e,t){return __awaiter$2(this,void 0,void 0,(function*(){t=t||this.roomContext.localMember.uuid;const r=this.roomContext.rtcController,n=this.roomContext.whiteboardController;switch(e){case memberAction.muteAudio:return r.muteMyAudio();case memberAction.unmuteAudio:return r.unmuteMyAudio();case memberAction.muteVideo:return r.muteMyVideo();case memberAction.unmuteVideo:return r.unmuteMyVideo();case memberAction.unmuteScreen:return r.startScreenShare();case memberAction.muteScreen:return r.stopScreenShare();case memberAction.openWhiteShare:return n.startWhiteboardShare();case memberAction.closeWhiteShare:return n.stopWhiteboardShare();case memberAction.shareWhiteShare:return this.roomContext.updateMemberProperty(t,"wbDrawable",JSON.stringify({value:"1"}));case memberAction.cancelShareWhiteShare:return this.roomContext.updateMemberProperty(t,"wbDrawable",JSON.stringify({value:"0"}));case memberAction.modifyMeetingNickName:return;case memberAction.handsUp:return this.roomContext.updateMemberProperty(t,"handsUp",JSON.stringify({value:"1"}));case memberAction.handsDown:return this.roomContext.deleteMemberProperty(t,"handsUp")}}))}_handleHostAction(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const r=this.roomContext;switch(e){case hostAction.remove:return r.kickMemberOut(t);case hostAction.muteMemberVideo:return this.rtcController.muteMemberVideo(t);case hostAction.muteMemberAudio:return this.rtcController.muteMemberAudio(t);case hostAction.muteAllAudio:return r.updateRoomProperty("audioOff",AttendeeOffType.offAllowSelfOn+`_${(new Date).getTime()}`);case hostAction.lockMeeting:return r.lockRoom();case hostAction.muteAllVideo:return r.updateRoomProperty("videoOff",AttendeeOffType.offAllowSelfOn+`_${(new Date).getTime()}`);case hostAction.unmuteMemberVideo:return this.messageService.sendCustomMessage(this.meetingId,t,99,JSON.stringify({type:2,category:"meeting_control"}));case hostAction.unmuteMemberAudio:return this.messageService.sendCustomMessage(this.meetingId,t,99,JSON.stringify({type:1,category:"meeting_control"}));case hostAction.unmuteAllAudio:return r.updateRoomProperty("audioOff",AttendeeOffType.disable+`_${(new Date).getTime()}`);case hostAction.unlockMeeting:return r.unlockRoom();case hostAction.unmuteAllVideo:return r.updateRoomProperty("videoOff",AttendeeOffType.disable+`_${(new Date).getTime()}`);case hostAction.muteVideoAndAudio:return this.rtcController.muteMemberVideo(t),void this.rtcController.muteMemberAudio(t);case hostAction.unmuteVideoAndAudio:return this.messageService.sendCustomMessage(this.meetingId,t,99,JSON.stringify({type:3,category:"meeting_control"}));case hostAction.transferHost:return r.handOverMyRole(t);case hostAction.setCoHost:return r.changeMemberRole(t,Role.coHost);case hostAction.unSetCoHost:return r.changeMemberRole(t,Role.member);case hostAction.setFocus:return r.updateRoomProperty("focus",t,t);case hostAction.unsetFocus:return r.updateRoomProperty("focus","");case hostAction.forceMuteAllAudio:return r.updateRoomProperty("audioOff",AttendeeOffType.offNotAllowSelfOn+`_${(new Date).getTime()}`);case hostAction.rejectHandsUp:return r.updateMemberProperty(t,"handsUp",JSON.stringify({value:"2"}));case hostAction.forceMuteAllVideo:return r.updateRoomProperty("videoOff",AttendeeOffType.offNotAllowSelfOn+`_${(new Date).getTime()}`);case hostAction.closeScreenShare:return this.rtcController.stopMemberScreenShare(t);case hostAction.openWhiteShare:return this.whiteboardController.startWhiteboardShare();case hostAction.closeWhiteShare:return this.whiteboardController.stopMemberWhiteboardShare(t)}}))}_joinRoomkit(e){return __awaiter$2(this,void 0,void 0,(function*(){return this.roomService.joinRoom({role:e.role,roomUuid:e.roomUuid,userName:e.nickname,password:e.password,initialProperties:e.initialProperties},{}).then((t=>{this.roomContext=this.roomService.getRoomContext(e.roomUuid),this.roomContext&&(this.rtcController=this.roomContext.rtcController,this.whiteboardController=this.roomContext.whiteboardController,this.whiteboardController.initWhiteboard(),this.chatController=this.roomContext.chatController)}))}))}_clientBanned(){this._isAnonymous?(this._meetingStatus="unlogin",this.authService&&this.authService.logout()):this._meetingStatus="login",this._eventEmitter.emit(EventType.ClientBanned)}createRequest(){const e=axios.create({baseURL:this._meetingServerDomain});return e.interceptors.request.use((e=>(e.headers=Object.assign(Object.assign({},e.headers),{clientType:"web",user:this._userUuid,token:this._token,versionCode:"3.1.0",deviceId:this._roomkit.deviceId}),e)),(function(e){return Promise.reject(e)})),e.interceptors.response.use((function(e){var t;return 0!==e.data.code?Promise.reject(e.data):null===(t=e.data)||void 0===t?void 0:t.data}),(function(e){return Promise.reject(e)})),e}}var img="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAsMSURBVHgB7Z1daFzHFcfP3F03fajBeUlshVayiZ1CEryWZSipZcl+SoPAHzTgkEBtQ4JfEsvKS9OHyBI0NQTjjxKwY4jVh6CQFCSBoXnzKnZtU0XSGkIf7ILXTtHqrQrWQ4vu7vT890NZrXZXd+/OvXdmNT8s9lp7Je3c/5wzM2fOzAhqIRKJ3k2xWLaXSLY7jkhISR34wntCFF5L8PcXhBBpvuJXSudyMsWv91w3nkqlkgvUIggymB8FFfwlD1aK6B+RklKm+GIim40lTRbcOIEhajzuJvijD7IVJljUTRQ841KK8enpb/5ChmGMwAVhc6fYsvpDEnUVXKHS/JLMZpeGUqm7aTIA7QVmYTvYDZ9hUX9HGsFij5ggtLYCFy12kB9lP2mM7kLHSEP27Nl3SojcOFttL2kOf0buB8QOPfdcu5ibe3yXNEMrC04kXknE47HzfNlLBoI2mq15v07WrI0FF6xWjLBF/JIMBZ0/x4n1t7V10Nzco0nSgMgtGJ2oeDx7jQy12jokXXfpeNTWHKnAcMmxWGxMXYBCL+CyHSd7eGrqdooiwqGIgEvm9na2VcUFKJuUsdmuru7IRgKRtMFdXfsw/DlL64dXo2qXQ3XRxdjxea7Zx2gdwuUemZq6eZxCJDSBi4GLG2y5CVrXiJTrOvvDmsAIpQ0uhhtnrbhAJvAsEolfdVAIBG7BRXFvtHJnyg9hBUUCFdiKW58wRA5MYCuuN4IWORCBrbiNEaTIygW24vojKJGVCmzFbY4gRFYmsBVXDapFViKwFVctKkVuWmArbjCoErkpga24waJCZN8CFycOWnq6Tw+ai137jkVj4sCKGwYygWcNgyIf+BJ49+7ua3biIExkYsOG7HnyQcMT/pisZ8vVOle5RUn4SRpoSGCk2ayzTAzd6G1ra/+hkfxrz52sYs7yLFkiR4jsLq+JfJ7a4MJwKDZGFi3I5WJjXhMGPAmMvGXbY9YHaBGPb7jm5d412+BCBuT6TJLTnA4v7XHdNri46uAhWXRlwXWXdtWLdNV10QhDkkVnNq3lqmu66MKQiI6SRXfquuqqLtpOIhgHu+rY1mrx6ni1u4tbJnRQBGzc+DPasmVz/lUFT54s0v37/yJd6O3tpqNHf5svXzJ5i65e9dQZXovibgh0uvKNVRYcdscKBe3p2cvx7V38lWBxt1AQ3L//gKanUzQ5eTP/GjYo59tvH6c33nh9xfc//fSaKpGJO1xbKztcqwTmiYSRMDY8gZWisH19v1FmrV7JZObzD3ZmZpZju/MUNKi4g4N/yJe5EniYAwdeIxVgv5Dp6ZVrn1YIHIb11qrJUVAS+vr1v1FQDAy8u2ZZuUNLquC2+OnytnjFMAltLwUI2p+JiS+1EBfAogYHP6DLly9SW9tmUgl+9+effxZ6WeNxd8VMX+U4uIcCAlb78cd/DN0dewHt/+XLl2jHjudJBUePvp4XV9Xvawxxqjw5YFngzs7uY0H1nCHuO++Euiy2YWBxELmv71XyS+F3XKT33383yopc3OqxwLLALO5BCgATxC0BUQYG3vNleWh+YLXwBtEjBktXeYFh0izwIVIMXJUp4paAyLDkRtpkDZufRMlN5wUubMmrFrgruCoTgVAffviBp3thuRpWYnbT2Xx/quSilVvvlSuXyGTgauGB6oFKjGGQjkgp9+M1L7AQcicpBMGLaoN604Bl1nO7eF/fcop8n8op+GqhNAXWtHa3FhC3lhVDWFRkXcGICNo65V1qFRTiyeZbb4lagQo9esv1QTvsqE5g17lW+wFWjEpbSTRBjEbJbXWkdJQK3NPTTa1GtTKZILAQzk6HfXU7KQI1XcdQZLNgKGQi3JPugItWdsDF9u3bqRVRmYAQJlIKCCw6SBGqZ2R0wtSOI8bByiy4Fd1zCRMFxlBJ6V6VrTQ8qmTjxo1kIkoFRvqJRS+UCry42LoCZzIZMhGneFybEqwFa8eCUgvWKf9YNWaWTaQR6EiTIpB73IpAXDO9U24BLvoRKcLcB1EfUysuDsBmC84pTfPHyoFWI5lcXSbkVOuOlLl7mGxIk0KCTCKPAgg5OXlr1fejWP7SOCLl4AhzUggK3kqdrVoVFp5K9+bIdeMpB8scVA6VwOjol9QKwHprCQxx9fZWIgVti8MkOUEKuX79a7Zk83dcGh39qu7iNKwK1NWKeaow34YUBRZJUszQ0J+M7lHDeiFwPVC+4eGPSEd4+DuO17zAxXZY6UlceEBXr35GJoLPfvLke57uVbiIWymuG8tveZjfo2N+Pv3ftrZ2LMrpIIV8990/UZOMSFArB+Km048934+O5YMHD+jll1/0NWUaQAWZmJn5ZgQXy5uwtLX9ggMe4hgpBoU3RWS43LNnz9GdO/+gRkGFwHgZAu/Y0Vhmi2qBpRRnM5lH93C9LPAzz2xbcBx5ki9/SooxQWSIC8v1I24JzKZhzLy4+IReeulFeuqpn3j6OZUCY0RUvsp/ebKhsCpcXqSAwEr6oaGPtIwAoQK+9dYJZeP30dG/0ptvnoiqrMny/6zYJ4utOMVW/HsKCDxAv24sCGC1n3xyJe+WVff4Yc3ohXvxXCotOJtdOjw//+/lDnOkm7BgiUsUifIQ84svvsoLEMZQDmXFYrzIN2EBUW2j1NOzj1544fnA8rrgPRB8iXIbJVToyrVOqGjnzv2ZVOBpGyWwe/feCzzVdIoiQPVGaGgHw9gqySvYIqKv77V8ijFCneibqKCa9YJaWxluKlqxspRaS3DUO1+p6makCHxs3vzz/7EV+9+RxBIaPKc/NDNz5+uq79X7wa6ubmwn3EsWbWHrfciueVut9+sm3QmRxeaWSmPUFrWwaz5Q7/26W/rPzX0/b121zkh2zbfH693h6Vgd66r1g13zGLvmI2vd5ykvmqeejqvO+rD4B+0uu+YBL/d6Phhrz55XElLag7E0QLputjOV8nYwluej7Yrt8Q+2PY6a3MBa7W45DZ1dmMl8f5fnjdnqRS9ZIkAOffvt3xs6O7Lh00fn5h4nt2xp38oTEvZ42RAphCJvnW7053wtPstmY/1IyyRLSIjZanFmL/gSGMkBOHbcihw86DHzsz5APvG9fLQo8mE7fAqO4nDoQLXzkLzieZhUC3uIVjD8KG7tcwm90LTAwIqsFlXiAiUCAyuyGlSKC5QJDKzIzaFaXKBUYGBF9kcQ4gLlAgMrcmMEJS4IRGBgRfZGkOKCwAQGVuT6BC0uCFRgYEWuThjiAqUboVWDozBpjl3vtxGvcsRsGOLm/xKFRCHXOndD9RkR5iFmEVtuJvzY0F+jkAlr7ZOOYMqPvdnpsMQFDc8HN0sm83h8HSYNSP43jPlcLCqgEAldYICkgXWU/iORZtNoJoYqQnfR5SCRL5eLjbVqD7vQU84e8ZogFwSB96LrMTV1O4UeNlWsSm8B4JJvFHrKtyNNiojUgsvp6tp7pvxgY1Nhq/2PELlhdskXSAO0ERgYHhSB1SZd1z0RxvjWK1oJXKKz89f9QjinTBFaN6stJ5Je9Fog//rZZ7dNCCGf1jw9VzIXs9n4kZmZm0nSEC0tuJyi2z6jWXBEFoIWS8M6ueNqaC9wiZLQfNkTkeuGqAvsVS65bvxCmNGoZjBG4HI6O7uPOY48yB//EAVLSVQMdYaxwbYpwpYwUuASmMBgq+7ly0Msws4mj6qXyxf5mS8xwVeT2InXNFHLMVrgSgozVm6CBdrpOCKB83P525twzCq79RU7BpWmL7lipDlk+jCXk/f4f49MF7SS/wOAnm9iigOiJgAAAABJRU5ErkJggg==",css_248z$1=".nemeeting-remaining-time-tip{align-items:center;background-color:#fff5a7;color:#000;display:flex;font-size:14px;justify-content:center;padding:10px 20px}.nemeeting-remaining-time-tip .nemtting-close-icon{cursor:pointer;height:12px;margin-left:20px;width:12px}";styleInject(css_248z$1);const RemainTimeTip=e=>{const{className:t,text:r,onCloseHandler:n}=e;return jsxRuntime.exports.jsxs("div",Object.assign({className:`nemeeting-remaining-time-tip ${t}`},{children:[jsxRuntime.exports.jsx("span",{children:r}),jsxRuntime.exports.jsx("svg",Object.assign({className:"icon nemeeting-close-icon","aria-hidden":"true",onClick:n},{children:jsxRuntime.exports.jsx("use",{xlinkHref:"#iconyx-pc-closex"})}))]}))};var RemainTimeTip$1=React.memo(RemainTimeTip);const logger$2=new Logger("Meeting-NeMeeting",!0),reporter=DataReporter$1.getInstance(),App=({height:e,width:t})=>{var r,n;const{meetingInfo:i,memberList:o,dispatch:s}=react.exports.useContext(MeetingInfoContext),{neMeeting:a,joinLoading:c,globalConfig:u,showMeetingRemainingTip:l,dispatch:d}=react.exports.useContext(GlobalContext),{eventEmitter:p,outEventEmitter:m}=react.exports.useContext(GlobalContext),[f,h]=react.exports.useState(null),g=react.exports.useRef(i),v=react.exports.useRef(o),y=react.exports.useRef(null),b=react.exports.useRef(null),S=react.exports.useRef(null),T=react.exports.useRef(0),_=react.exports.useRef(!1);g.current=i,v.current=o,_.current=!!l;const[w,M]=react.exports.useState(!1),[x,E]=react.exports.useState(!1),[C,R]=react.exports.useState(!0),[k,A]=react.exports.useState(!1),[I,O]=react.exports.useState(""),[P,N]=react.exports.useState(!1),[D,L]=react.exports.useState(!1),[j,U]=react.exports.useState(!1),[F,$]=react.exports.useState(!1),B=react.exports.useRef(!1),V=react.exports.useRef(!1),H=react.exports.useRef(!1),[W,q]=react.exports.useState(!1),[z,G]=react.exports.useState(!1),J=react.exports.useRef(!1),K=react.exports.useRef(!1),Q=react.exports.useRef(null),Y=e=>{var t;"audioSlave"===e?$(!1):"screen"===e?U(!1):A(!1),null===(t=v.current)||void 0===t||t.forEach((e=>{null==a||a.replayRemoteStream({userUuid:e.uuid,type:"audio"})}))},X=(e,t)=>{t>600&&300<e&&e<=600?(O("距离会议结束仅剩10分钟！"),N(!0)):t>300&&60<e&&e<=300?(O("距离会议结束仅剩5分钟！"),N(!0)):t>60&&0<e&&e<=60&&(O("距离会议结束仅剩1分钟！"),N(!0)),(e<=0||!g.current.meetingNum)&&b.current&&clearInterval(b.current)},Z=react.exports.useCallback((()=>{null==m||m.on(UserEventType.SetLeaveCallback,(e=>{h(e)})),null==p||p.on(EventType.MemberAudioMuteChanged,((e,t,r)=>{logger$2.debug("onMemberAudioMuteChanged: %o %o %t",e,r),s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{isAudioOn:!t}}}),t||getBrowserType()!==BrowserType.WX||"Android"!==getClientType()||K.current||(K.current=!0,A(!0)),g.current.localMember.uuid===e.uuid&&(t?e.uuid!==r.uuid&&Toast.info("您已被静音"):(g.current.localMember.role===Role.host||r.uuid===g.current.localMember.uuid||g.current.localMember.isAudioOn||Toast.info("主持人已将您解除静音，您可以自由发言"),g.current.localMember.isHandsUp&&(null==a||a.sendMemberControl(memberAction.handsDown,e.uuid))))})),null==p||p.on(EventType.MemberJoinRoom,(e=>{logger$2.debug("用户加入: %o %t",e);if(e.findIndex((e=>e.uuid===g.current.localMember.uuid))>0)return;e.forEach((e=>{var t,r;g.current.localMember.role,Role.host,e.role.name===Role.host&&s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{hostUuid:e.uuid,hostName:e.name}}),s&&(console.log("用户加入完成",e),s({type:ActionType.ADD_MEMBER,data:{member:Object.assign(Object.assign({},e),{role:null===(t=e.role)||void 0===t?void 0:t.name})}}),g.current.screenUuid&&!e.isSharingScreen&&g.current.screenUuid===e.uuid&&(s({type:ActionType.UPDATE_MEETING_INFO,data:{screenUuid:""}}),null===(r=null==a?void 0:a.rtcController)||void 0===r||r.unsubscribeRemoteVideoSubStream(e.uuid)))}));const t=e.map((e=>({uuid:e.uuid,name:e.name})));null==m||m.emit("peerJoin",t)})),null==p||p.on(EventType.MemberNameChanged,((e,t)=>{logger$2.debug("onMemberNameChanged: %o %t",e),s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{name:t}}}),e.role.name===Role.host&&s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{hostName:e.name}})})),null==p||p.on(EventType.MemberLeaveRoom,(e=>{logger$2.debug("用户离开: %o %t",e);const t=[];e.forEach((e=>{e.uuid!==g.current.localMember.uuid&&t.push(e.uuid)})),s&&s({type:ActionType.REMOVE_MEMBER,data:{uuids:t}});if(e.find((e=>e.role.name===Role.host))&&s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{hostUuid:"",hostName:""}}),null==m||m.emit("peerLeave",t),g.current.screenUuid){t.findIndex((e=>e===g.current.screenUuid))>-1&&s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{screenUuid:""}})}g.current.localMember.role===Role.host&&e.forEach((e=>{Toast.info(`${e.name}离开会议`)}))})),null==p||p.on(EventType.MemberLeaveRtcChannel,(()=>{})),null==p||p.on(EventType.MemberRoleChanged,((e,t,r)=>{if(logger$2.debug("onMemberRoleChanged: %o %o %o %t",e,t,r),e.uuid===g.current.localMember.uuid)console.log("afterRole",r),r===Role.host?Toast.info("您已经成为主持人"):r===Role.coHost?Toast.info("您已成为联席主持人"):t===Role.coHost&&r!==Role.host&&Toast.info("您已被取消设为联席主持人"),r!==Role.coHost&&r!==Role.host||(null==a||a.sendMemberControl(memberAction.handsDown,e.uuid),null==p||p.emit("needAudioHandsUp",!1),null==p||p.emit("needVideoHandsUp",!1));else if(g.current.localMember.role===Role.host||g.current.localMember.role===Role.coHost)if(r===Role.coHost)Toast.info(`${e.name}已经成为联席主持人`);else{const t=v.current.find((t=>t.uuid===e.uuid));t&&t.role===Role.coHost&&Toast.info(`${e.name}已被取消设为联席主持人`)}r===Role.host&&s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{hostUuid:e.uuid,hostName:e.name}}),a&&updateMeetingService(a,s)})),null==p||p.on(EventType.MemberScreenShareStateChanged,((e,t,r)=>{logger$2.debug("onMemberScreenShareStateChanged: %o %t",e),s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{isSharingScreen:t}}}),t?getBrowserType()!==BrowserType.WX||J.current||(J.current=!0,U(!0)):(r.uuid!==e.uuid&&e.uuid===g.current.localMember.uuid&&Toast.info("主持人已终止了您的共享"),reporter.send({action_name:"member_screen_share_stop",member_uid:e.uuid}))})),null==p||p.on(EventType.MemberVideoMuteChanged,((e,t,r)=>{logger$2.debug("login_对端发mutedChange: %o %t",e),s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{isVideoOn:!t}}}),e.uuid===g.current.localMember.uuid&&(t&&e.uuid!==r.uuid&&Toast.info("您已被停止视频"),t||g.current.localMember.isHandsUp&&(null==a||a.sendMemberControl(memberAction.handsDown,e.uuid)))})),null==p||p.on(EventType.MemberWhiteboardStateChanged,((e,t,r)=>{var n,i,o;logger$2.debug("onMemberWhiteboardStateChanged: %o %t",e,t),s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{whiteboardUuid:t?e.uuid:""}}),e||t?e&&(s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:e.uuid,member:{properties:{wbDrawable:{value:t?"1":"0"}}}}}),t||("1"===(null===(i=g.current.localMember.properties.wbDrawable)||void 0===i?void 0:i.value)&&(null==a||a.sendMemberControl(memberAction.cancelShareWhiteShare,g.current.localMember.uuid)),e.uuid===g.current.localMember.uuid&&r.uuid===g.current.hostUuid&&g.current.hostUuid!==g.current.localMember.uuid&&Toast.info("主持人已终止了您的共享"),e.uuid===g.current.localMember.uuid&&!t&&(null===(o=null==a?void 0:a.whiteboardController)||void 0===o||o.setEnableDraw(!1)))):"1"===(null===(n=g.current.localMember.properties.wbDrawable)||void 0===n?void 0:n.value)&&(null==a||a.sendMemberControl(memberAction.cancelShareWhiteShare,g.current.localMember.uuid))})),null==p||p.on(EventType.RoomPropertiesChanged,(e=>{var t,r;if(logger$2.debug("onRoomPropertiesChanged: %o %o %t",e),e.focus){const t=e.focus;t.value?g.current.localMember.uuid===t.value?Toast.info("您已被设置为焦点视频"):(g.current.localMember.uuid,g.current.focusUuid):te(),s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{focusUuid:t.value}})}else if(e.audioOff){const r=null===(t=e.audioOff.value)||void 0===t?void 0:t.split("_")[0];switch(s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{audioOff:r}}),r!==AttendeeOffType.offAllowSelfOn&&r!==AttendeeOffType.disable||(null==p||p.emit("needAudioHandsUp",!1),g.current.localMember.isHandsUp&&(null==a||a.sendMemberControl(memberAction.handsDown,g.current.localMember.uuid))),r){case AttendeeOffType.offNotAllowSelfOn:case AttendeeOffType.offAllowSelfOn:if(q(!1),g.current.localMember.role!==Role.host&&g.current.localMember.role!==Role.coHost&&Toast.info("主持人设置了全体静音"),!g.current.localMember.isAudioOn||g.current.localMember.role===Role.host||g.current.localMember.role===Role.coHost)return;null==a||a.muteLocalAudio();break;case AttendeeOffType.disable:if(q(!0),null==a||a.sendMemberControl(memberAction.handsDown,g.current.localMember.uuid),g.current.localMember.isAudioOn||g.current.localMember.role===Role.host||g.current.localMember.role===Role.coHost)return;Toast.info("主持人已将您解除静音，您可以自由发言"),ne()}}else if(e.videoOff){const t=null===(r=e.videoOff.value)||void 0===r?void 0:r.split("_")[0];switch(s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{videoOff:t}}),t!==AttendeeOffType.offAllowSelfOn&&t!==AttendeeOffType.disable||(console.log("needVideoHandsUp",t),null==p||p.emit("needVideoHandsUp",!1),g.current.localMember.isHandsUp&&(null==a||a.sendMemberControl(memberAction.handsDown,g.current.localMember.uuid))),t){case AttendeeOffType.offNotAllowSelfOn:case AttendeeOffType.offAllowSelfOn:if(G(!1),g.current.localMember.role!==Role.host&&g.current.localMember.role!==Role.coHost&&Toast.info("主持人设置了全体关闭视频"),!g.current.localMember.isVideoOn||g.current.localMember.role===Role.host||g.current.localMember.role===Role.coHost)return;null==a||a.muteLocalVideo();break;case AttendeeOffType.disable:if(G(!0),null==a||a.sendMemberControl(memberAction.handsDown,g.current.localMember.uuid),g.current.localMember.isVideoOn||g.current.localMember.role===Role.host||g.current.localMember.role===Role.coHost)return;re()}}})),null==p||p.on(EventType.RoomLockStateChanged,(e=>{logger$2.debug("onRoomLockStateChanged: %o %t",e),s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{properties:{isLocked:e}}})})),null==p||p.on(EventType.MemberPropertiesChanged,((e,t)=>{if(logger$2.debug("onMemberPropertiesChanged: %o %t",t,e),t.handsUp){const r=t.handsUp;s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:e,member:{isHandsUp:"1"==r.value}}}),"2"==r.value&&e===g.current.localMember.uuid&&Toast.info("主持人已将您的手放下")}else t.wbDrawable&&s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:e,member:{properties:{wbDrawable:t.wbDrawable}}}})})),null==p||p.on(EventType.MemberPropertiesDeleted,((e,t)=>{logger$2.debug("onMemberPropertiesDeleted: %o %o %t",t,e),s&&t.forEach((t=>{"handsUp"===t?s({type:ActionType.UPDATE_MEMBER,data:{uuid:e,member:{isHandsUp:!1}}}):"wbDrawable"===t&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:e,member:{properties:{wbDrawable:{value:"0"}}}}})}))})),null==p||p.on(EventType.RoomPropertiesDeleted,(e=>{console.log("RoomPropertiesDeleted",e),logger$2.debug("onRoomPropertiesDeleted: %o %t",e),e.forEach((e=>{"focus"===e?(te(),s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{focusUuid:""}})):"lock"===e&&s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{isLocked:!1}})}))})),null==p||p.on(EventType.RoomEnded,(e=>{console.log("RoomEnded",e),logger$2.debug("onRoomEnded: %o %t",e);const t={UNKNOWN:"未知异常",LOGIN_STATE_ERROR:"账号异常",CLOSE_BY_BACKEND:"后台关闭房间",ALL_MEMBERS_OUT:"所有成员退出房间",END_OF_LIFE:"房间时间到期",CLOSE_BY_MEMBER:"房间被关闭",KICK_OUT:"您已被主持人移出会议",SYNC_DATA_ERROR:"数据同步错误",LEAVE_BY_SELF:"您已离开房间",OTHER:"OTHER"};t[e]&&Toast.info(t[e]),ee(e)})),null==p||p.on(EventType.RtcActiveSpeakerChanged,throttle((e=>{e.userUuid!==g.current.activeSpeakerUuid&&s&&s({type:ActionType.UPDATE_MEETING_INFO,data:{activeSpeakerUuid:e.userUuid}})}),4e3)),null==p||p.on(EventType.ClientBanned,(()=>{logger$2.debug("clientBanned: 当前用户被踢出 %t"),s&&s({type:ActionType.RESET_MEETING,data:null}),Toast.info("因被主持人移出或切换至其他设备，您已退出当前会议"),M(!1),E(!1),A(!1),B.current=!1,V.current=!1,H.current=!1,null==m||m.emit(EventType.RoomEnded,NEMeetingLeaveType.leaveBySelf);try{f&&f(NEMeetingLeaveType.leaveBySelf)}catch(e){logger$2.warn("leaveCallback failed",e)}null==a||a.destroy()})),null==p||p.on(EventType.NetworkError,(()=>{console.log("断网 NetworkError"),setTimeout((()=>{ee("NetworkError")}),1e3)})),null==p||p.on(EventType.NetworkReconnectSuccess,(()=>{Toast.info("网络重连成功"),a&&updateMeetingService(a,s)})),null==p||p.on(EventType.DeviceChange,(e=>{console.log("deviceChange  "),console.log(e)})),null==p||p.on(EventType.ReceivePassThroughMessage,(e=>{logger$2.debug("onReceivePassThroughMessage: %o %t",e);const{body:t}=e.data,r=e.senderUuid,n=g.current.localMember;n.isHandsUp&&(null==a||a.sendMemberControl(memberAction.handsDown,n.uuid));const i=r===n.uuid;switch(t.type){case 1:logger$2.debug("开启mic请求 %t"),i||!n.isHandsUp||n.isAudioOn||Toast.info("主持人已将您解除静音，您可以自由发言"),ne(i);break;case 2:logger$2.debug("开启camera请求 %t"),re(i);break;case 3:logger$2.debug("开启音视频请求 %t"),i||!n.isHandsUp||n.isAudioOn||Toast.info("主持人已将您解除静音，您可以自由发言"),ne(i),re(i)}})),null==p||p.on(EventType.roomRemainingSecondsRenewed,(e=>{console.log("roomRemainingSecondsRenewed",e,_.current),_.current&&(null==s||s({type:ActionType.UPDATE_MEETING_INFO,data:{remainingSeconds:e}}))})),null==p||p.on(EventType.AutoPlayNotAllowed,(e=>{console.log("-notAllowedError- ",e),"audioSlave"===e.type?$(!0):A(!0)}))}),[]),ee=(e="OTHER")=>{s&&s({type:ActionType.RESET_MEETING,data:null}),M(!1),E(!1),A(!1),B.current=!1,V.current=!1,H.current=!1,J.current=!1,K.current=!1,null==a||a.destroy(),d&&d({type:ActionType.JOIN_LOADING,data:!1});let t=NEMeetingLeaveType.endByHost;"kICK_BY_SELF"===e?t=NEMeetingLeaveType.leaveBySelf:"KICK_OUT"===e?t=NEMeetingLeaveType.leaveByHost:"NetworkError"===e&&(t=NEMeetingLeaveType.networkError),null==m||m.emit(EventType.RoomEnded,t);try{f&&f(t)}catch(e){logger$2.warn("leaveCallback failed",e)}},te=()=>{g.current.localMember.uuid===g.current.focusUuid&&Toast.info("您已被取消焦点视频")},re=(e=!1)=>{const t=g.current.localMember;t.isVideoOn||(null==p||p.emit("needVideoHandsUp",!1),t.role!==Role.host&&t.role!==Role.coHost||!e?(G(!0),E(!0)):null==a||a.unmuteLocalVideo().then((()=>{s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})))},ne=(e=!1)=>{const t=g.current.localMember;t.isAudioOn||(null==p||p.emit("needAudioHandsUp",!1),t.role!==Role.host&&t.role!==Role.coHost?t.isHandsUp?null==a||a.unmuteLocalAudio().then((()=>{s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})):(q(!0),M(!0)):null==a||a.unmuteLocalAudio().then((()=>{s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})))},ie=e=>{if(e.target instanceof Window){const{innerHeight:t,innerWidth:r}=e.target;r-t>80&&(console.log({innerHeight:t,innerWidth:r}),R(!1))}},oe=react.exports.useCallback((e=>{var t,r;b.current&&clearInterval(b.current);const n=null===(r=null===(t=null==u?void 0:u.appConfig)||void 0===t?void 0:t.ROOM_END_TIME_TIP)||void 0===r?void 0:r.enable;e&&n&&_.current&&(N(!1),T.current=Math.max(e-1,-1),X(T.current,e),b.current=setInterval((()=>{const e=T.current;T.current=Math.max(e-1,-1),X(T.current,e)}),1e3))}),[null===(n=null===(r=null==u?void 0:u.appConfig)||void 0===r?void 0:r.ROOM_END_TIME_TIP)||void 0===n?void 0:n.enable]);function se(){y.current&&(clearTimeout(y.current),y.current=null),y.current=setTimeout((()=>{R(!1)}),5e3)}function ae(){R(!C),se()}return react.exports.useEffect((()=>(Z(),window.addEventListener("resize",ie),()=>{null==p||p.removeAllListeners(),null==m||m.removeAllListeners(),window.removeEventListener("resize",ie),ee()})),[]),react.exports.useEffect((()=>{!i.remainingSeconds||i.remainingSeconds<=0||oe(i.remainingSeconds)}),[i.remainingSeconds]),react.exports.useEffect((()=>{i.meetingNum||(S.current&&clearInterval(S.current),S.current=null)}),[i.meetingNum]),react.exports.useEffect((()=>{P?(S.current&&clearTimeout(S.current),S.current=setTimeout((()=>{S.current=null,N(!1)}),6e4)):S.current&&clearTimeout(S.current)}),[P]),jsxRuntime.exports.jsx("div",Object.assign({className:"App flex flex-col h-full relative",style:{width:""+(t?`${t}px`:"100%"),height:""+(e?`${e}px`:"100%")},onClick:ae},{children:i.meetingNum?jsxRuntime.exports.jsxs(jsxRuntime.exports.Fragment,{children:[jsxRuntime.exports.jsx(Dialog,Object.assign({visible:x,title:"打开摄像头",onCancel:()=>{G(!1),E(!1)},onConfirm:()=>{(()=>{var e;const{localMember:t,videoOff:r,screenUuid:n}=g.current,i=t.role===Role.host||t.role===Role.coHost,o=!!n&&n===t.uuid;if(!t.isVideoOn){if(r===AttendeeOffType.offNotAllowSelfOn&&!i&&!o&&!z)return E(!1),void(null===(e=Q.current)||void 0===e||e.checkNeedHandsUp("video",!0));G(!1),null==a||a.unmuteLocalVideo().then((()=>{s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})).catch((e=>{Toast.info("打开视频失败"),logger$2.error("muteLocalVideo %o %t",e)})),E(!1)}})()}},{children:"主持人已重新打开您的摄像头，确认打开？"})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:w,title:"打开麦克风",onCancel:()=>{q(!1),M(!1)},onConfirm:()=>{(()=>{var e;const{localMember:t,audioOff:r,screenUuid:n}=g.current,i=t.role===Role.host||t.role===Role.coHost,o=!!n&&n===t.uuid;if(!t.isAudioOn){if(r===AttendeeOffType.offNotAllowSelfOn&&!i&&!o&&!W)return M(!1),void(null===(e=Q.current)||void 0===e||e.checkNeedHandsUp("audio",!0));q(!1),null==a||a.unmuteLocalAudio().then((()=>{s&&s({type:ActionType.UPDATE_MEMBER,data:{uuid:t.uuid,member:{isHandsUp:!1}}})})).catch((e=>{Toast.info("打开音频失败"),logger$2.error("muteLocalAudio %o %t",e)})),M(!1)}})()}},{children:"主持人已重新打开您的麦克风，确认打开？"})),P&&jsxRuntime.exports.jsx(RemainTimeTip$1,{className:"nemeeting-time-tip-wrap",text:I,onCloseHandler:()=>{N(!1)}}),jsxRuntime.exports.jsx(MeetingHeader,{className:"",visible:C,onClick:function(e){e.stopPropagation(),y.current&&(clearTimeout(y.current),y.current=null)}}),jsxRuntime.exports.jsx(MeetingCanvas$1,{className:"flex-1 h-full",onActiveIndexChanged:e=>{console.log("onHandlerActionIndexChanged",e),0===e&&setTimeout((()=>{ae()}),200)}}),jsxRuntime.exports.jsx(MeetingController,{className:"",visible:C,onClick:function(e){e.stopPropagation(),se()},onRef:Q}),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:k,onConfirm:()=>Y("audio"),ifShowCancel:!1},{children:jsxRuntime.exports.jsx("span",{children:"即将开始播放其他成员的音视频"})})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:D,onConfirm:()=>Y("video"),ifShowCancel:!1},{children:jsxRuntime.exports.jsx("span",{children:"即将开始播放其他成员的视频"})})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:j,onConfirm:()=>Y("screen"),ifShowCancel:!1},{children:jsxRuntime.exports.jsx("span",{children:"即将开始播放其他成员的共享画面"})})),jsxRuntime.exports.jsx(Dialog,Object.assign({visible:F,onConfirm:()=>Y("audioSlave"),ifShowCancel:!1},{children:jsxRuntime.exports.jsx("span",{children:"即将开始播放其他成员的音频辅流"})}))]}):c?jsxRuntime.exports.jsx("div",Object.assign({className:"meeting-loading"},{children:jsxRuntime.exports.jsxs("div",Object.assign({className:"meeting-loading-content"},{children:[jsxRuntime.exports.jsx("img",{className:"meeting-loading-img",src:img,alt:""}),jsxRuntime.exports.jsx("div",Object.assign({className:"meeting-loading-text"},{children:"正在进入会议..."}))]}))})):""}))};var css_248z=".visible{visibility:visible}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.right-4{right:1rem}.top-5{top:1.25rem}.col-span-2{grid-column:span 2/span 2}.block{display:block}.flex{display:flex}.h-1\\/2{height:50%}.h-12{height:3rem}.h-24{height:6rem}.h-6{height:1.5rem}.h-full{height:100%}.w-1\\/2{width:50%}.w-full{width:100%}.flex-1{flex:1 1 0%}.resize{resize:both}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded{border-radius:.25rem}.border{border-width:1px}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68/var(--tw-bg-opacity))}.bg-zinc-900{--tw-bg-opacity:1;background-color:rgb(24 24 27/var(--tw-bg-opacity))}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-2\\.5{padding-bottom:.625rem;padding-top:.625rem}.pt-2{padding-top:.5rem}.text-left{text-align:left}.text-center{text-align:center}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem}.text-lg,.text-xl{line-height:1.75rem}.text-xl{font-size:1.25rem}.text-xs{font-size:.75rem;line-height:1rem}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.icon{fill:currentColor;height:1em;overflow:hidden;vertical-align:-.15em;width:1em}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}.h-full{height:100%}.w-full{width:100%}.flex{display:flex}.absolute{position:absolute}.relative{position:relative}.justify-around{justify-content:space-around}.justify-center{justify-content:center}.flex-wrap{flex-wrap:wrap}.text-white{color:#fff}.text-xl{font-size:20px;line-height:28px}.text-xs{font-size:12px;line-height:16px}.text-sm{font-size:14px;line-height:20px}.text-base{font-size:16px;line-height:24px}.text-lg{font-size:18px;line-height:28px}.w-1\\/2{width:50%}.h-1\\/2{height:50%}.text-left{text-align:left}.text-center{align-items:center}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.fixed{position:fixed}.flex-col{flex-direction:column}.focus\\:outline-4:focus{outline-width:4px}";styleInject(css_248z);var eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,o||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,o,s){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,o),!0;case 6:return l.fn.call(l.context,t,n,i,o,s),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,m=l.length;for(u=0;u<m;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||s(this,o);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[o]=1===u.length?u[0]:u:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a}(eventemitter3);var Eventemitter=eventemitter3.exports,loglevel={exports:{}};!function(e){!function(t,r){e.exports?e.exports=r():t.log=r()}(commonjsGlobal,(function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function i(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(t,r){for(var i=0;i<n.length;i++){var o=n[i];this[o]=i<t?e:this.methodFactory(o,t,r)}this.log=this.debug}function a(e,r,n){return function(){typeof console!==t&&(s.call(this,r,n),this[e].apply(this,arguments))}}function c(n,s,c){return function(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&r?o:void 0!==console[n]?i(console,n):void 0!==console.log?i(console,"log"):e)}(n)||a.apply(this,arguments)}function u(e,r,i){var o,a=this;r=null==r?"WARN":r;var u="loglevel";function l(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(u)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"==typeof e&&(u=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=i||c,a.getLevel=function(){return o},a.setLevel=function(r,i){if("string"==typeof r&&void 0!==a.levels[r.toUpperCase()]&&(r=a.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(o=r,!1!==i&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+r+";"}catch(e){}}}(r),s.call(a,r,e),typeof console===t&&r<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){r=e,l()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(r,!1),function(){if(typeof window!==t&&u){try{return void window.localStorage.removeItem(u)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var d=l();null==d&&(d=r),a.setLevel(d,!1)}var l=new u,d={};l.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new u(e,l.getLevel(),l.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return l.noConflict=function(){return typeof window!==t&&window.log===l&&(window.log=p),l},l.getLoggers=function(){return d},l.default=l,l}))}(loglevel);var e=loglevel.exports;function n(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function t(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function r(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function o(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e}function a$1(e,i){return function(s,a,c){var u=c.value;c.value=function(){for(var s=[],c=0;c<arguments.length;c++)s[c]=arguments[c];return n(this,void 0,void 0,(function(){var n,c,l;return t(this,(function(t){switch(t.label){case 0:i||(i=this.logger),["log","error"].some((function(e){return!i[e]}))&&console.warn("loggerDecorator warning: your logger is not complete"),n=u.name||a||"",t.label=1;case 1:return t.trys.push([1,3,,4]),null==i||i.log.apply(i,o([e,n],r(s))),[4,u.apply(this,s)];case 2:return c=t.sent(),null==i||i.log(e,"".concat(n," success: "),c),[2,c];case 3:throw l=t.sent(),null==i||i.error(e,"".concat(n," failed: "),l),l;case 4:return[2]}}))}))}}}var c$1=function(t){var r=void 0===t?{appName:"",version:"",storeWindow:!1}:t,n=r.level,i=r.appName,o=void 0===i?"":i,s=r.version,a=void 0===s?"":s,c=r.storeWindow,u=void 0!==c&&c,l=function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours()<10?"0".concat(e.getHours()):e.getHours(),o=e.getMinutes()<10?"0".concat(e.getMinutes()):e.getMinutes(),s=e.getSeconds()<10?"0".concat(e.getSeconds()):e.getSeconds();return"".concat(t,"-").concat(r,"-").concat(n," ").concat(i,":").concat(o,":").concat(s)},d=new Proxy(e,{get:function(e,t){if(t in e){var r=e[t];if(!["log","info","warn","error","trace","debug"].includes(t))return r;var n,i=function(){try{var e=navigator.userAgent.toLocaleLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/)||[];return{browser:e[1].replace(/version/,"safari"),ver:e[2]}}catch(e){return null}}();return n=i?"[ ".concat(o," ").concat(a," ").concat(i.browser,":").concat(i.ver," ").concat(l()," ]"):"[ ".concat(o," ").concat(a," ").concat(l()," ]"),r.bind(null,n)}}});return n&&d.setLevel(n),u&&(window.__LOGGER__=d),d},extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},extendStatics(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function __awaiter$1(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function __generator$1(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var request=function(e){var t=e.method,r=void 0===t?"POST":t,n=e.url,i=e.data,o=e.headers;return __awaiter$1(void 0,void 0,void 0,(function(){var e,t;return __generator$1(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,axios({method:r,url:n,data:i,headers:o})];case 1:return 200!==(e=s.sent()).data.code?[2,Promise.reject(e.data)]:[2,e.data];case 2:return t=s.sent(),[2,Promise.reject(t)];case 3:return[2]}}))}))},webRequestHelper=request,url="https://statistic.live.126.net/statics/report/xkit/action",EventTracking=function(){function e(e){var t=e.appKey,r=e.version,n=e.component,i=e.nertcVersion,o=e.imVersion,s=e.platform,a=void 0===s?"Web":s;this.platform=a,this.appKey=t,this.version=r,this.component=n,this.nertcVersion=i,this.imVersion=o}return e.prototype.track=function(e,t){return __awaiter$1(this,void 0,void 0,(function(){var r,n,i,o,s,a,c,u;return __generator$1(this,(function(l){switch(l.label){case 0:n=(r=this).appKey,i=r.version,o=r.component,s=r.nertcVersion,a=r.imVersion,c=r.platform,u=Date.now(),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,webRequestHelper({method:"POST",url:url,data:{appKey:n,version:i,component:o,timeStamp:u,nertcVersion:s,imVersion:a,platform:c,reportType:e,data:t}})];case 2:case 3:return l.sent(),[3,4];case 4:return[2]}}))}))},e}(),EventTracking$1=EventTracking;!function(e){function t(t){var r=e.call(this)||this;return r.visibilityState=document.visibilityState,r.entries=[],r._visibilitychange=function(){r.visibilityState=document.visibilityState,r._trigger()},r.intersectionObserver=new IntersectionObserver(r._intersectionObserverHandler.bind(r),t),document.addEventListener("visibilitychange",r._visibilitychange),r}__extends(t,e),t.prototype.observe=function(e){return this.intersectionObserver.observe(e)},t.prototype.unobserve=function(e){return this.intersectionObserver.unobserve(e)},t.prototype.destroy=function(){this.intersectionObserver.disconnect(),document.removeEventListener("visibilitychange",this._visibilitychange),this.entries=[]},t.prototype._intersectionObserverHandler=function(e,t){this.entries=e,this._trigger()},t.prototype._trigger=function(){var e=this;this.entries.forEach((function(t){"visible"!==e.visibilityState||t.intersectionRatio<=0?e.emit("visibleChange",{visible:!1,target:t.target}):e.emit("visibleChange",{visible:!0,target:t.target})}))}}(Eventemitter);var frequencyControl=function(e,t){var r,n=[],i=0;return function(){for(var o=this,s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return new Promise((function(a,c){n.push({resolve:a,reject:c});var u=Date.now(),l=function(e,t){for(;n.length;){var r=n.shift(),i=r.resolve,o=r.reject;e?i(t):o(t)}},d=function(){i=u,n.length&&e.apply(o,s).then((function(e){l(!0,e)}),(function(e){l(!1,e)}))};u-i>t?d():(clearTimeout(r),r=setTimeout((function(){d()}),t))}))}},NIM_BROWSER_SDK={exports:{}};!function(e,t){e.exports=function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e){var t={exports:{}};return e(t,t.exports),t.exports}var n,i,o=t(r((function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports}))),s=function(e){return e&&e.Math==Math&&e},a=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof e&&e)||function(){return this}()||Function("return this")(),c=function(e){try{return!!e()}catch(e){return!0}},u=!c((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),l=Function.prototype,d=l.apply,p=l.call,m="object"==typeof Reflect&&Reflect.apply||(u?p.bind(d):function(){return p.apply(d,arguments)}),f=Function.prototype,h=f.bind,g=f.call,v=u&&h.bind(g,g),y=u?function(e){return e&&v(e)}:function(e){return e&&function(){return g.apply(e,arguments)}},b=function(e){return"function"==typeof e},S=!c((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),T=Function.prototype.call,_=u?T.bind(T):function(){return T.apply(T,arguments)},w={}.propertyIsEnumerable,M=Object.getOwnPropertyDescriptor,x={f:M&&!w.call({1:2},1)?function(e){var t=M(this,e);return!!t&&t.enumerable}:w},E=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},C=y({}.toString),R=y("".slice),k=function(e){return R(C(e),8,-1)},A=Object,I=y("".split),O=c((function(){return!A("z").propertyIsEnumerable(0)}))?function(e){return"String"==k(e)?I(e,""):A(e)}:A,P=function(e){return null==e},N=TypeError,D=function(e){if(P(e))throw N("Can't call method on "+e);return e},L=function(e){return O(D(e))},j="object"==typeof document&&document.all,U=void 0===j&&void 0!==j?function(e){return"object"==typeof e?null!==e:b(e)||e===j}:function(e){return"object"==typeof e?null!==e:b(e)},F={},$=function(e){return b(e)?e:void 0},B=function(e,t){return arguments.length<2?$(F[e])||$(a[e]):F[e]&&F[e][t]||a[e]&&a[e][t]},V=y({}.isPrototypeOf),H=B("navigator","userAgent")||"",W=a.process,q=a.Deno,z=W&&W.versions||q&&q.version,G=z&&z.v8;G&&(i=(n=G.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&H&&(!(n=H.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=H.match(/Chrome\/(\d+)/))&&(i=+n[1]);var J,K=i,Q=!!Object.getOwnPropertySymbols&&!c((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&K&&K<41})),Y=Q&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,X=Object,Z=Y?function(e){return"symbol"==typeof e}:function(e){var t=B("Symbol");return b(t)&&V(t.prototype,X(e))},ee=String,te=function(e){try{return ee(e)}catch(e){return"Object"}},re=TypeError,ne=function(e){if(b(e))return e;throw re(te(e)+" is not a function")},ie=function(e,t){var r=e[t];return P(r)?void 0:ne(r)},oe=TypeError,se=Object.defineProperty,ae="__core-js_shared__",ce=a[ae]||function(e,t){try{se(a,e,{value:t,configurable:!0,writable:!0})}catch(r){a[e]=t}return t}(ae,{}),ue=r((function(e){(e.exports=function(e,t){return ce[e]||(ce[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),le=Object,de=function(e){return le(D(e))},pe=y({}.hasOwnProperty),me=Object.hasOwn||function(e,t){return pe(de(e),t)},fe=0,he=Math.random(),ge=y(1..toString),ve=function(e){return"Symbol("+(void 0===e?"":e)+")_"+ge(++fe+he,36)},ye=ue("wks"),be=a.Symbol,Se=be&&be.for,Te=Y?be:be&&be.withoutSetter||ve,_e=function(e){if(!me(ye,e)||!Q&&"string"!=typeof ye[e]){var t="Symbol."+e;Q&&me(be,e)?ye[e]=be[e]:ye[e]=Y&&Se?Se(t):Te(t)}return ye[e]},we=TypeError,Me=_e("toPrimitive"),xe=function(e,t){if(!U(e)||Z(e))return e;var r,n=ie(e,Me);if(n){if(void 0===t&&(t="default"),r=_(n,e,t),!U(r)||Z(r))return r;throw we("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var r,n;if("string"===t&&b(r=e.toString)&&!U(n=_(r,e)))return n;if(b(r=e.valueOf)&&!U(n=_(r,e)))return n;if("string"!==t&&b(r=e.toString)&&!U(n=_(r,e)))return n;throw oe("Can't convert object to primitive value")}(e,t)},Ee=function(e){var t=xe(e,"string");return Z(t)?t:t+""},Ce=a.document,Re=U(Ce)&&U(Ce.createElement),ke=function(e){return Re?Ce.createElement(e):{}},Ae=!S&&!c((function(){return 7!=Object.defineProperty(ke("div"),"a",{get:function(){return 7}}).a})),Ie=Object.getOwnPropertyDescriptor,Oe={f:S?Ie:function(e,t){if(e=L(e),t=Ee(t),Ae)try{return Ie(e,t)}catch(e){}if(me(e,t))return E(!_(x.f,e,t),e[t])}},Pe=/#|\.prototype\./,Ne=function(e,t){var r=Le[De(e)];return r==Ue||r!=je&&(b(t)?c(t):!!t)},De=Ne.normalize=function(e){return String(e).replace(Pe,".").toLowerCase()},Le=Ne.data={},je=Ne.NATIVE="N",Ue=Ne.POLYFILL="P",Fe=Ne,$e=y(y.bind),Be=function(e,t){return ne(e),void 0===t?e:u?$e(e,t):function(){return e.apply(t,arguments)}},Ve=S&&c((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),He=String,We=TypeError,qe=function(e){if(U(e))return e;throw We(He(e)+" is not an object")},ze=TypeError,Ge=Object.defineProperty,Je=Object.getOwnPropertyDescriptor,Ke="enumerable",Qe="configurable",Ye="writable",Xe={f:S?Ve?function(e,t,r){if(qe(e),t=Ee(t),qe(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Ye in r&&!r.writable){var n=Je(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:Qe in r?r.configurable:n.configurable,enumerable:Ke in r?r.enumerable:n.enumerable,writable:!1})}return Ge(e,t,r)}:Ge:function(e,t,r){if(qe(e),t=Ee(t),qe(r),Ae)try{return Ge(e,t,r)}catch(e){}if("get"in r||"set"in r)throw ze("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},Ze=S?function(e,t,r){return Xe.f(e,t,E(1,r))}:function(e,t,r){return e[t]=r,e},et=Oe.f,rt=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return m(e,this,arguments)};return t.prototype=e.prototype,t},nt=function(e,t){var r,n,i,o,s,c,u,l,d=e.target,p=e.global,m=e.stat,f=e.proto,h=p?a:m?a[d]:(a[d]||{}).prototype,g=p?F:F[d]||Ze(F,d,{})[d],v=g.prototype;for(i in t)r=!Fe(p?i:d+(m?".":"#")+i,e.forced)&&h&&me(h,i),s=g[i],r&&(c=e.dontCallGetSet?(l=et(h,i))&&l.value:h[i]),o=r&&c?c:t[i],r&&typeof s==typeof o||(u=e.bind&&r?Be(o,a):e.wrap&&r?rt(o):f&&b(o)?y(o):o,(e.sham||o&&o.sham||s&&s.sham)&&Ze(u,"sham",!0),Ze(g,i,u),f&&(me(F,n=d+"Prototype")||Ze(F,n,{}),Ze(F[n],i,o),e.real&&v&&!v[i]&&Ze(v,i,o)))},it=Math.ceil,ot=Math.floor,st=Math.trunc||function(e){var t=+e;return(t>0?ot:it)(t)},at=function(e){var t=+e;return t!=t||0===t?0:st(t)},ct=Math.max,ut=Math.min,lt=function(e,t){var r=at(e);return r<0?ct(r+t,0):ut(r,t)},dt=Math.min,pt=function(e){return(t=e.length)>0?dt(at(t),9007199254740991):0;var t},mt=function(e){return function(t,r,n){var i,o=L(t),s=pt(o),a=lt(n,s);if(e&&r!=r){for(;s>a;)if((i=o[a++])!=i)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===r)return e||a||0;return!e&&-1}},ft={includes:mt(!0),indexOf:mt(!1)},ht={},gt=ft.indexOf,vt=y([].push),yt=function(e,t){var r,n=L(e),i=0,o=[];for(r in n)!me(ht,r)&&me(n,r)&&vt(o,r);for(;t.length>i;)me(n,r=t[i++])&&(~gt(o,r)||vt(o,r));return o},bt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],St=Object.keys||function(e){return yt(e,bt)},Tt=S&&!Ve?Object.defineProperties:function(e,t){qe(e);for(var r,n=L(t),i=St(t),o=i.length,s=0;o>s;)Xe.f(e,r=i[s++],n[r]);return e},_t={f:Tt},wt=B("document","documentElement"),Mt=ue("keys"),xt=function(e){return Mt[e]||(Mt[e]=ve(e))},Et=xt("IE_PROTO"),Ct=function(){},Rt=function(e){return"<script>"+e+"<\/script>"},kt=function(e){e.write(Rt("")),e.close();var t=e.parentWindow.Object;return e=null,t},At=function(){try{J=new ActiveXObject("htmlfile")}catch(e){}var e,t;At="undefined"!=typeof document?document.domain&&J?kt(J):((t=ke("iframe")).style.display="none",wt.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Rt("document.F=Object")),e.close(),e.F):kt(J);for(var r=bt.length;r--;)delete At.prototype[bt[r]];return At()};ht[Et]=!0;var It=Object.create||function(e,t){var r;return null!==e?(Ct.prototype=qe(e),r=new Ct,Ct.prototype=null,r[Et]=e):r=At(),void 0===t?r:_t.f(r,t)};nt({target:"Object",stat:!0,sham:!S},{create:It});var Ot=F.Object,Pt=function(e,t){return Ot.create(e,t)},Nt=String,Dt=TypeError,Lt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=y(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return qe(r),function(e){if("object"==typeof e||b(e))return e;throw Dt("Can't set "+Nt(e)+" as a prototype")}(n),t?e(r,n):r.__proto__=n,r}}():void 0);nt({target:"Object",stat:!0},{setPrototypeOf:Lt});var jt=F.Object.setPrototypeOf,Ut=y([].slice),Ft=Function,$t=y([].concat),Bt=y([].join),Vt={},Ht=function(e,t,r){if(!me(Vt,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";Vt[t]=Ft("C,a","return new C("+Bt(n,",")+")")}return Vt[t](e,r)},Wt=u?Ft.bind:function(e){var t=ne(this),r=t.prototype,n=Ut(arguments,1),i=function(){var r=$t(n,Ut(arguments));return this instanceof i?Ht(t,r.length,r):t.apply(e,r)};return U(r)&&(i.prototype=r),i};nt({target:"Function",proto:!0,forced:Function.bind!==Wt},{bind:Wt});var qt=function(e){return F[e+"Prototype"]},zt=qt("Function").bind,Gt=Function.prototype,Jt=function(e){var t=e.bind;return e===Gt||V(Gt,e)&&t===Gt.bind?zt:t},Kt=r((function(e){function t(r,n){var i;return e.exports=t=jt?Jt(i=jt).call(i):function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Qt=t(r((function(e){e.exports=function(e,t){e.prototype=Pt(t.prototype),e.prototype.constructor=e,Kt(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports}))),Yt=Array.isArray||function(e){return"Array"==k(e)},Xt=TypeError,Zt=function(e){if(e>9007199254740991)throw Xt("Maximum allowed index exceeded");return e},er=function(e,t,r){var n=Ee(t);n in e?Xe.f(e,n,E(0,r)):e[n]=r},tr={};tr[_e("toStringTag")]="z";var rr="[object z]"===String(tr),nr=_e("toStringTag"),ir=Object,or="Arguments"==k(function(){return arguments}()),sr=rr?k:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=ir(e),nr))?r:or?k(t):"Object"==(n=k(t))&&b(t.callee)?"Arguments":n},ar=y(Function.toString);b(ce.inspectSource)||(ce.inspectSource=function(e){return ar(e)});var cr=ce.inspectSource,ur=function(){},lr=[],dr=B("Reflect","construct"),pr=/^\s*(?:class|function)\b/,mr=y(pr.exec),fr=!pr.exec(ur),hr=function(e){if(!b(e))return!1;try{return dr(ur,lr,e),!0}catch(e){return!1}},gr=function(e){if(!b(e))return!1;switch(sr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return fr||!!mr(pr,cr(e))}catch(e){return!0}};gr.sham=!0;var vr=!dr||c((function(){var e;return hr(hr.call)||!hr(Object)||!hr((function(){e=!0}))||e}))?gr:hr,yr=_e("species"),br=Array,Sr=function(e,t){return new(function(e){var t;return Yt(e)&&(t=e.constructor,(vr(t)&&(t===br||Yt(t.prototype))||U(t)&&null===(t=t[yr]))&&(t=void 0)),void 0===t?br:t}(e))(0===t?0:t)},Tr=_e("species"),_r=function(e){return K>=51||!c((function(){var t=[];return(t.constructor={})[Tr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},wr=_e("isConcatSpreadable"),Mr=K>=51||!c((function(){var e=[];return e[wr]=!1,e.concat()[0]!==e})),xr=_r("concat"),Er=function(e){if(!U(e))return!1;var t=e[wr];return void 0!==t?!!t:Yt(e)};nt({target:"Array",proto:!0,arity:1,forced:!Mr||!xr},{concat:function(e){var t,r,n,i,o,s=de(this),a=Sr(s,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(Er(o=-1===t?s:arguments[t]))for(i=pt(o),Zt(c+i),r=0;r<i;r++,c++)r in o&&er(a,c,o[r]);else Zt(c+1),er(a,c++,o);return a.length=c,a}});var Cr,Rr,kr,Ar=String,Ir=function(e){if("Symbol"===sr(e))throw TypeError("Cannot convert a Symbol value to a string");return Ar(e)},Or=bt.concat("length","prototype"),Pr={f:Object.getOwnPropertyNames||function(e){return yt(e,Or)}},Nr=Array,Dr=Math.max,Lr=function(e,t,r){for(var n=pt(e),i=lt(t,n),o=lt(void 0===r?n:r,n),s=Nr(Dr(o-i,0)),a=0;i<o;i++,a++)er(s,a,e[i]);return s.length=a,s},jr=Pr.f,Ur="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Fr={f:function(e){return Ur&&"Window"==k(e)?function(e){try{return jr(e)}catch(e){return Lr(Ur)}}(e):jr(L(e))}},$r={f:Object.getOwnPropertySymbols},Br=function(e,t,r,n){return n&&n.enumerable?e[t]=r:Ze(e,t,r),e},Vr={f:_e},Hr=Xe.f,Wr=function(e){var t=F.Symbol||(F.Symbol={});me(t,e)||Hr(t,e,{value:Vr.f(e)})},qr=function(){var e=B("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=_e("toPrimitive");t&&!t[n]&&Br(t,n,(function(e){return _(r,this)}),{arity:1})},zr=rr?{}.toString:function(){return"[object "+sr(this)+"]"},Gr=Xe.f,Jr=_e("toStringTag"),Kr=function(e,t,r,n){if(e){var i=r?e:e.prototype;me(i,Jr)||Gr(i,Jr,{configurable:!0,value:t}),n&&!rr&&Ze(i,"toString",zr)}},Qr=a.WeakMap,Yr=b(Qr)&&/native code/.test(String(Qr)),Xr="Object already initialized",Zr=a.TypeError,en=a.WeakMap;if(Yr||ce.state){var tn=ce.state||(ce.state=new en),rn=y(tn.get),nn=y(tn.has),on=y(tn.set);Cr=function(e,t){if(nn(tn,e))throw Zr(Xr);return t.facade=e,on(tn,e,t),t},Rr=function(e){return rn(tn,e)||{}},kr=function(e){return nn(tn,e)}}else{var sn=xt("state");ht[sn]=!0,Cr=function(e,t){if(me(e,sn))throw Zr(Xr);return t.facade=e,Ze(e,sn,t),t},Rr=function(e){return me(e,sn)?e[sn]:{}},kr=function(e){return me(e,sn)}}var an={set:Cr,get:Rr,has:kr,enforce:function(e){return kr(e)?Rr(e):Cr(e,{})},getterFor:function(e){return function(t){var r;if(!U(t)||(r=Rr(t)).type!==e)throw Zr("Incompatible receiver, "+e+" required");return r}}},cn=y([].push),un=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,u,l,d){for(var p,m,f=de(c),h=O(f),g=Be(u,l),v=pt(h),y=0,b=d||Sr,S=t?b(c,v):r||s?b(c,0):void 0;v>y;y++)if((a||y in h)&&(m=g(p=h[y],y,f),e))if(t)S[y]=m;else if(m)switch(e){case 3:return!0;case 5:return p;case 6:return y;case 2:cn(S,p)}else switch(e){case 4:return!1;case 7:cn(S,p)}return o?-1:n||i?i:S}},ln={forEach:un(0),map:un(1),filter:un(2),some:un(3),every:un(4),find:un(5),findIndex:un(6),filterReject:un(7)},dn=ln.forEach,pn=xt("hidden"),mn="Symbol",fn=an.set,hn=an.getterFor(mn),gn=Object.prototype,vn=a.Symbol,yn=vn&&vn.prototype,bn=a.TypeError,Sn=a.QObject,Tn=Oe.f,_n=Xe.f,wn=Fr.f,Mn=x.f,xn=y([].push),En=ue("symbols"),Cn=ue("op-symbols"),Rn=ue("wks"),kn=!Sn||!Sn.prototype||!Sn.prototype.findChild,An=S&&c((function(){return 7!=It(_n({},"a",{get:function(){return _n(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=Tn(gn,t);n&&delete gn[t],_n(e,t,r),n&&e!==gn&&_n(gn,t,n)}:_n,In=function(e,t){var r=En[e]=It(yn);return fn(r,{type:mn,tag:e,description:t}),S||(r.description=t),r},On=function(e,t,r){e===gn&&On(Cn,t,r),qe(e);var n=Ee(t);return qe(r),me(En,n)?(r.enumerable?(me(e,pn)&&e[pn][n]&&(e[pn][n]=!1),r=It(r,{enumerable:E(0,!1)})):(me(e,pn)||_n(e,pn,E(1,{})),e[pn][n]=!0),An(e,n,r)):_n(e,n,r)},Pn=function(e,t){qe(e);var r=L(t),n=St(r).concat(jn(r));return dn(n,(function(t){S&&!_(Nn,r,t)||On(e,t,r[t])})),e},Nn=function(e){var t=Ee(e),r=_(Mn,this,t);return!(this===gn&&me(En,t)&&!me(Cn,t))&&(!(r||!me(this,t)||!me(En,t)||me(this,pn)&&this[pn][t])||r)},Dn=function(e,t){var r=L(e),n=Ee(t);if(r!==gn||!me(En,n)||me(Cn,n)){var i=Tn(r,n);return!i||!me(En,n)||me(r,pn)&&r[pn][n]||(i.enumerable=!0),i}},Ln=function(e){var t=wn(L(e)),r=[];return dn(t,(function(e){me(En,e)||me(ht,e)||xn(r,e)})),r},jn=function(e){var t=e===gn,r=wn(t?Cn:L(e)),n=[];return dn(r,(function(e){!me(En,e)||t&&!me(gn,e)||xn(n,En[e])})),n};Q||(vn=function(){if(V(yn,this))throw bn("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Ir(arguments[0]):void 0,t=ve(e),r=function(e){this===gn&&_(r,Cn,e),me(this,pn)&&me(this[pn],t)&&(this[pn][t]=!1),An(this,t,E(1,e))};return S&&kn&&An(gn,t,{configurable:!0,set:r}),In(t,e)},yn=vn.prototype,Br(yn,"toString",(function(){return hn(this).tag})),Br(vn,"withoutSetter",(function(e){return In(ve(e),e)})),x.f=Nn,Xe.f=On,_t.f=Pn,Oe.f=Dn,Pr.f=Fr.f=Ln,$r.f=jn,Vr.f=function(e){return In(_e(e),e)},S&&_n(yn,"description",{configurable:!0,get:function(){return hn(this).description}})),nt({global:!0,constructor:!0,wrap:!0,forced:!Q,sham:!Q},{Symbol:vn}),dn(St(Rn),(function(e){Wr(e)})),nt({target:mn,stat:!0,forced:!Q},{useSetter:function(){kn=!0},useSimple:function(){kn=!1}}),nt({target:"Object",stat:!0,forced:!Q,sham:!S},{create:function(e,t){return void 0===t?It(e):Pn(It(e),t)},defineProperty:On,defineProperties:Pn,getOwnPropertyDescriptor:Dn}),nt({target:"Object",stat:!0,forced:!Q},{getOwnPropertyNames:Ln}),qr(),Kr(vn,mn),ht[pn]=!0;var Un=Q&&!!Symbol.for&&!!Symbol.keyFor,Fn=ue("string-to-symbol-registry"),$n=ue("symbol-to-string-registry");nt({target:"Symbol",stat:!0,forced:!Un},{for:function(e){var t=Ir(e);if(me(Fn,t))return Fn[t];var r=B("Symbol")(t);return Fn[t]=r,$n[r]=t,r}});var Bn=ue("symbol-to-string-registry");nt({target:"Symbol",stat:!0,forced:!Un},{keyFor:function(e){if(!Z(e))throw TypeError(te(e)+" is not a symbol");if(me(Bn,e))return Bn[e]}});var Vn=B("JSON","stringify"),Hn=y(/./.exec),Wn=y("".charAt),qn=y("".charCodeAt),zn=y("".replace),Gn=y(1..toString),Jn=/[\uD800-\uDFFF]/g,Kn=/^[\uD800-\uDBFF]$/,Qn=/^[\uDC00-\uDFFF]$/,Yn=!Q||c((function(){var e=B("Symbol")();return"[null]"!=Vn([e])||"{}"!=Vn({a:e})||"{}"!=Vn(Object(e))})),Xn=c((function(){return'"\\udf06\\ud834"'!==Vn("\udf06\ud834")||'"\\udead"'!==Vn("\udead")})),Zn=function(e,t){var r=Ut(arguments),n=t;if((U(t)||void 0!==e)&&!Z(e))return Yt(t)||(t=function(e,t){if(b(n)&&(t=_(n,this,e,t)),!Z(t))return t}),r[1]=t,m(Vn,null,r)},ei=function(e,t,r){var n=Wn(r,t-1),i=Wn(r,t+1);return Hn(Kn,e)&&!Hn(Qn,i)||Hn(Qn,e)&&!Hn(Kn,n)?"\\u"+Gn(qn(e,0),16):e};Vn&&nt({target:"JSON",stat:!0,arity:3,forced:Yn||Xn},{stringify:function(e,t,r){var n=Ut(arguments),i=m(Yn?Zn:Vn,null,n);return Xn&&"string"==typeof i?zn(i,Jn,ei):i}});var ti=!Q||c((function(){$r.f(1)}));nt({target:"Object",stat:!0,forced:ti},{getOwnPropertySymbols:function(e){var t=$r.f;return t?t(de(e)):[]}}),Wr("asyncIterator"),Wr("hasInstance"),Wr("isConcatSpreadable"),Wr("iterator"),Wr("match"),Wr("matchAll"),Wr("replace"),Wr("search"),Wr("species"),Wr("split"),Wr("toPrimitive"),qr(),Wr("toStringTag"),Kr(B("Symbol"),"Symbol"),Wr("unscopables"),Kr(a.JSON,"JSON",!0);var ri,ni,ii,oi=F.Symbol,si={},ai=Function.prototype,ci=S&&Object.getOwnPropertyDescriptor,ui=me(ai,"name"),li={EXISTS:ui,PROPER:ui&&"something"===function(){}.name,CONFIGURABLE:ui&&(!S||S&&ci(ai,"name").configurable)},di=!c((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),pi=xt("IE_PROTO"),mi=Object,fi=mi.prototype,hi=di?mi.getPrototypeOf:function(e){var t=de(e);if(me(t,pi))return t[pi];var r=t.constructor;return b(r)&&t instanceof r?r.prototype:t instanceof mi?fi:null},gi=_e("iterator"),vi=!1;[].keys&&("next"in(ii=[].keys())?(ni=hi(hi(ii)))!==Object.prototype&&(ri=ni):vi=!0);var yi=!U(ri)||c((function(){var e={};return ri[gi].call(e)!==e}));ri=yi?{}:It(ri),b(ri[gi])||Br(ri,gi,(function(){return this}));var bi={IteratorPrototype:ri,BUGGY_SAFARI_ITERATORS:vi},Si=bi.IteratorPrototype,Ti=function(){return this},_i=li.PROPER,wi=bi.BUGGY_SAFARI_ITERATORS,Mi=_e("iterator"),xi="keys",Ei="values",Ci="entries",Ri=function(){return this},ki=function(e,t,r,n,i,o,s){!function(e,t,r,n){var i=t+" Iterator";e.prototype=It(Si,{next:E(+!n,r)}),Kr(e,i,!1,!0),si[i]=Ti}(r,t,n);var a,c,u,l=function(e){if(e===i&&h)return h;if(!wi&&e in m)return m[e];switch(e){case xi:case Ei:case Ci:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",p=!1,m=e.prototype,f=m[Mi]||m["@@iterator"]||i&&m[i],h=!wi&&f||l(i),g="Array"==t&&m.entries||f;if(g&&(a=hi(g.call(new e)))!==Object.prototype&&a.next&&(Kr(a,d,!0,!0),si[d]=Ri),_i&&i==Ei&&f&&f.name!==Ei&&(p=!0,h=function(){return _(f,this)}),i)if(c={values:l(Ei),keys:o?h:l(xi),entries:l(Ci)},s)for(u in c)(wi||p||!(u in m))&&Br(m,u,c[u]);else nt({target:t,proto:!0,forced:wi||p},c);return s&&m[Mi]!==h&&Br(m,Mi,h,{name:i}),si[t]=h,c};Xe.f;var Ai="Array Iterator",Ii=an.set,Oi=an.getterFor(Ai);ki(Array,"Array",(function(e,t){Ii(this,{type:Ai,target:L(e),index:0,kind:t})}),(function(){var e=Oi(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),si.Arguments=si.Array;var Pi=_e("toStringTag");for(var Ni in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Di=a[Ni],Li=Di&&Di.prototype;Li&&sr(Li)!==Pi&&Ze(Li,Pi,Ni),si[Ni]=si.Array}var ji=oi;Wr("asyncDispose"),Wr("dispose"),Wr("matcher"),Wr("metadataKey"),Wr("observable"),Wr("metadata"),Wr("patternMatch"),Wr("replaceAll");var Ui=ji,Fi=y("".charAt),$i=y("".charCodeAt),Bi=y("".slice),Vi=function(e){return function(t,r){var n,i,o=Ir(D(t)),s=at(r),a=o.length;return s<0||s>=a?e?"":void 0:(n=$i(o,s))<55296||n>56319||s+1===a||(i=$i(o,s+1))<56320||i>57343?e?Fi(o,s):n:e?Bi(o,s,s+2):i-56320+(n-55296<<10)+65536}},Hi=(Vi(!1),Vi(!0)),Wi="String Iterator",qi=an.set,zi=an.getterFor(Wi);ki(String,"String",(function(e){qi(this,{type:Wi,string:Ir(e),index:0})}),(function(){var e,t=zi(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=Hi(r,n),t.index+=e.length,{value:e,done:!1})}));var Gi=Vr.f("iterator"),Ji=r((function(e){function t(r){return e.exports=t="function"==typeof Ui&&"symbol"==typeof Gi?function(e){return typeof e}:function(e){return e&&"function"==typeof Ui&&e.constructor===Ui&&e!==Ui.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Ki=Xe.f;nt({target:"Object",stat:!0,forced:Object.defineProperty!==Ki,sham:!S},{defineProperty:Ki});var Qi=r((function(e){var t=F.Object,r=e.exports=function(e,r,n){return t.defineProperty(e,r,n)};t.defineProperty.sham&&(r.sham=!0)})),Yi=Qi,Xi=c((function(){hi(1)}));nt({target:"Object",stat:!0,forced:Xi,sham:!di},{getPrototypeOf:function(e){return hi(de(e))}});var Zi=F.Object.getPrototypeOf,eo=function(e,t){var r=[][e];return!!r&&c((function(){r.call(null,t||function(){return 1},1)}))},to=ln.forEach,ro=eo("forEach")?[].forEach:function(e){return to(this,e,arguments.length>1?arguments[1]:void 0)};nt({target:"Array",proto:!0,forced:[].forEach!=ro},{forEach:ro});var no=qt("Array").forEach,io=Array.prototype,oo={DOMTokenList:!0,NodeList:!0},so=function(e){var t=e.forEach;return e===io||V(io,e)&&t===io.forEach||me(oo,sr(e))?no:t},ao=y([].concat),co=B("Reflect","ownKeys")||function(e){var t=Pr.f(qe(e)),r=$r.f;return r?ao(t,r(e)):t},uo=Error,lo=y("".replace),po=String(uo("zxcasd").stack),mo=/\n\s*at [^:]*:[^\n]*/,fo=mo.test(po),ho=function(e,t){if(fo&&"string"==typeof e&&!uo.prepareStackTrace)for(;t--;)e=lo(e,mo,"");return e},go=function(e,t){U(t)&&"cause"in t&&Ze(e,"cause",t.cause)},vo=_e("iterator"),yo=Array.prototype,bo=function(e){return void 0!==e&&(si.Array===e||yo[vo]===e)},So=_e("iterator"),To=function(e){if(!P(e))return ie(e,So)||ie(e,"@@iterator")||si[sr(e)]},_o=TypeError,wo=function(e,t){var r=arguments.length<2?To(e):t;if(ne(r))return qe(_(r,e));throw _o(te(e)+" is not iterable")},Mo=function(e,t,r){var n,i;qe(e);try{if(!(n=ie(e,"return"))){if("throw"===t)throw r;return r}n=_(n,e)}catch(e){i=!0,n=e}if("throw"===t)throw r;if(i)throw n;return qe(n),r},xo=TypeError,Eo=function(e,t){this.stopped=e,this.result=t},Co=Eo.prototype,Ro=function(e,t,r){var n,i,o,s,a,c,u,l=r&&r.that,d=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_RECORD),m=!(!r||!r.IS_ITERATOR),f=!(!r||!r.INTERRUPTED),h=Be(t,l),g=function(e){return n&&Mo(n,"normal",e),new Eo(!0,e)},v=function(e){return d?(qe(e),f?h(e[0],e[1],g):h(e[0],e[1])):f?h(e,g):h(e)};if(p)n=e.iterator;else if(m)n=e;else{if(!(i=To(e)))throw xo(te(e)+" is not iterable");if(bo(i)){for(o=0,s=pt(e);s>o;o++)if((a=v(e[o]))&&V(Co,a))return a;return new Eo(!1)}n=wo(e,i)}for(c=p?e.next:n.next;!(u=_(c,n)).done;){try{a=v(u.value)}catch(e){Mo(n,"throw",e)}if("object"==typeof a&&a&&V(Co,a))return a}return new Eo(!1)},ko=function(e,t){return void 0===e?arguments.length<2?"":t:Ir(e)},Ao=!c((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",E(1,7)),7!==e.stack)})),Io=_e("toStringTag"),Oo=Error,Po=[].push,No=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=V(Do,this);Lt?r=Lt(Oo(),i?hi(this):Do):(r=i?this:It(Do),Ze(r,Io,"Error")),void 0!==t&&Ze(r,"message",ko(t)),Ao&&Ze(r,"stack",ho(r.stack,1)),go(r,n);var o=[];return Ro(e,Po,{that:o}),Ze(r,"errors",o),r};Lt?Lt(No,Oo):function(e,t,r){for(var n=co(t),i=Xe.f,o=Oe.f,s=0;s<n.length;s++){var a=n[s];me(e,a)||r&&me(r,a)||i(e,a,o(t,a))}}(No,Oo,{name:!0});var Do=No.prototype=It(Oo.prototype,{constructor:E(1,No),message:E(1,""),name:E(1,"AggregateError")});nt({global:!0,constructor:!0,arity:2},{AggregateError:No});var Lo,jo,Uo,Fo,$o="process"==k(a.process),Bo=_e("species"),Vo=function(e){var t=B(e),r=Xe.f;S&&t&&!t[Bo]&&r(t,Bo,{configurable:!0,get:function(){return this}})},Ho=TypeError,Wo=function(e,t){if(V(t,e))return e;throw Ho("Incorrect invocation")},qo=TypeError,zo=function(e){if(vr(e))return e;throw qo(te(e)+" is not a constructor")},Go=_e("species"),Jo=function(e,t){var r,n=qe(e).constructor;return void 0===n||P(r=qe(n)[Go])?t:zo(r)},Ko=TypeError,Qo=function(e,t){if(e<t)throw Ko("Not enough arguments");return e},Yo=/(?:ipad|iphone|ipod).*applewebkit/i.test(H),Xo=a.setImmediate,Zo=a.clearImmediate,es=a.process,ts=a.Dispatch,rs=a.Function,ns=a.MessageChannel,is=a.String,os=0,ss={},as="onreadystatechange";try{Lo=a.location}catch(e){}var cs=function(e){if(me(ss,e)){var t=ss[e];delete ss[e],t()}},us=function(e){return function(){cs(e)}},ls=function(e){cs(e.data)},ds=function(e){a.postMessage(is(e),Lo.protocol+"//"+Lo.host)};Xo&&Zo||(Xo=function(e){Qo(arguments.length,1);var t=b(e)?e:rs(e),r=Ut(arguments,1);return ss[++os]=function(){m(t,void 0,r)},jo(os),os},Zo=function(e){delete ss[e]},$o?jo=function(e){es.nextTick(us(e))}:ts&&ts.now?jo=function(e){ts.now(us(e))}:ns&&!Yo?(Fo=(Uo=new ns).port2,Uo.port1.onmessage=ls,jo=Be(Fo.postMessage,Fo)):a.addEventListener&&b(a.postMessage)&&!a.importScripts&&Lo&&"file:"!==Lo.protocol&&!c(ds)?(jo=ds,a.addEventListener("message",ls,!1)):jo=as in ke("script")?function(e){wt.appendChild(ke("script")).onreadystatechange=function(){wt.removeChild(this),cs(e)}}:function(e){setTimeout(us(e),0)});var ps,ms,fs,hs,gs,vs,ys,bs,Ss={set:Xo,clear:Zo},Ts=/ipad|iphone|ipod/i.test(H)&&void 0!==a.Pebble,_s=/web0s(?!.*chrome)/i.test(H),ws=Oe.f,Ms=Ss.set,xs=a.MutationObserver||a.WebKitMutationObserver,Es=a.document,Cs=a.process,Rs=a.Promise,ks=ws(a,"queueMicrotask"),As=ks&&ks.value;As||(ps=function(){var e,t;for($o&&(e=Cs.domain)&&e.exit();ms;){t=ms.fn,ms=ms.next;try{t()}catch(e){throw ms?hs():fs=void 0,e}}fs=void 0,e&&e.enter()},Yo||$o||_s||!xs||!Es?!Ts&&Rs&&Rs.resolve?((ys=Rs.resolve(void 0)).constructor=Rs,bs=Be(ys.then,ys),hs=function(){bs(ps)}):$o?hs=function(){Cs.nextTick(ps)}:(Ms=Be(Ms,a),hs=function(){Ms(ps)}):(gs=!0,vs=Es.createTextNode(""),new xs(ps).observe(vs,{characterData:!0}),hs=function(){vs.data=gs=!gs}));var Is=As||function(e){var t={fn:e,next:void 0};fs&&(fs.next=t),ms||(ms=t,hs()),fs=t},Os=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Ps=function(){this.head=null,this.tail=null};Ps.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var Ns,Ds,Ls=Ps,js=a.Promise,Us="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Fs=!Us&&!$o&&"object"==typeof window&&"object"==typeof document,$s=js&&js.prototype,Bs=_e("species"),Vs=!1,Hs=b(a.PromiseRejectionEvent),Ws=Fe("Promise",(function(){var e=cr(js),t=e!==String(js);if(!t&&66===K)return!0;if(!$s.catch||!$s.finally)return!0;if(!K||K<51||!/native code/.test(e)){var r=new js((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[Bs]=n,!(Vs=r.then((function(){}))instanceof n))return!0}return!t&&(Fs||Us)&&!Hs})),qs={CONSTRUCTOR:Ws,REJECTION_EVENT:Hs,SUBCLASSING:Vs},zs=TypeError,Gs=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw zs("Bad Promise constructor");t=e,r=n})),this.resolve=ne(t),this.reject=ne(r)},Js={f:function(e){return new Gs(e)}},Ks=Ss.set,Qs="Promise",Ys=qs.CONSTRUCTOR,Xs=qs.REJECTION_EVENT,Zs=an.getterFor(Qs),ea=an.set,ta=js&&js.prototype,ra=js,na=ta,ia=a.TypeError,oa=a.document,sa=a.process,aa=Js.f,ca=aa,ua=!!(oa&&oa.createEvent&&a.dispatchEvent),la="unhandledrejection",da=function(e){var t;return!(!U(e)||!b(t=e.then))&&t},pa=function(e,t){var r,n,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{a?(s||(2===t.rejection&&va(t),t.rejection=1),!0===a?r=o:(l&&l.enter(),r=a(o),l&&(l.exit(),i=!0)),r===e.promise?u(ia("Promise-chain cycle")):(n=da(r))?_(n,r,c,u):c(r)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},ma=function(e,t){e.notified||(e.notified=!0,Is((function(){for(var r,n=e.reactions;r=n.get();)pa(r,e);e.notified=!1,t&&!e.rejection&&ha(e)})))},fa=function(e,t,r){var n,i;ua?((n=oa.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),a.dispatchEvent(n)):n={promise:t,reason:r},!Xs&&(i=a["on"+e])?i(n):e===la&&function(e,t){var r=a.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)},ha=function(e){_(Ks,a,(function(){var t,r=e.facade,n=e.value;if(ga(e)&&(t=Os((function(){$o?sa.emit("unhandledRejection",n,r):fa(la,r,n)})),e.rejection=$o||ga(e)?2:1,t.error))throw t.value}))},ga=function(e){return 1!==e.rejection&&!e.parent},va=function(e){_(Ks,a,(function(){var t=e.facade;$o?sa.emit("rejectionHandled",t):fa("rejectionhandled",t,e.value)}))},ya=function(e,t,r){return function(n){e(t,n,r)}},ba=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,ma(e,!0))},Sa=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw ia("Promise can't be resolved itself");var n=da(t);n?Is((function(){var r={done:!1};try{_(n,t,ya(Sa,r,e),ya(ba,r,e))}catch(t){ba(r,t,e)}})):(e.value=t,e.state=1,ma(e,!1))}catch(t){ba({done:!1},t,e)}}};Ys&&(na=(ra=function(e){Wo(this,na),ne(e),_(Ns,this);var t=Zs(this);try{e(ya(Sa,t),ya(ba,t))}catch(e){ba(t,e)}}).prototype,(Ns=function(e){ea(this,{type:Qs,done:!1,notified:!1,parent:!1,reactions:new Ls,rejection:!1,state:0,value:void 0})}).prototype=Br(na,"then",(function(e,t){var r=Zs(this),n=aa(Jo(this,ra));return r.parent=!0,n.ok=!b(e)||e,n.fail=b(t)&&t,n.domain=$o?sa.domain:void 0,0==r.state?r.reactions.add(n):Is((function(){pa(n,r)})),n.promise})),Ds=function(){var e=new Ns,t=Zs(e);this.promise=e,this.resolve=ya(Sa,t),this.reject=ya(ba,t)},Js.f=aa=function(e){return e===ra||void 0===e?new Ds(e):ca(e)}),nt({global:!0,constructor:!0,wrap:!0,forced:Ys},{Promise:ra}),Kr(ra,Qs,!1,!0),Vo(Qs);var Ta=_e("iterator"),_a=!1;try{var wa=0,Ma={next:function(){return{done:!!wa++}},return:function(){_a=!0}};Ma[Ta]=function(){return this},Array.from(Ma,(function(){throw 2}))}catch(e){}var xa=function(e,t){if(!t&&!_a)return!1;var r=!1;try{var n={};n[Ta]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r},Ea=qs.CONSTRUCTOR||!xa((function(e){js.all(e).then(void 0,(function(){}))}));nt({target:"Promise",stat:!0,forced:Ea},{all:function(e){var t=this,r=Js.f(t),n=r.resolve,i=r.reject,o=Os((function(){var r=ne(t.resolve),o=[],s=0,a=1;Ro(e,(function(e){var c=s++,u=!1;a++,_(r,t,e).then((function(e){u||(u=!0,o[c]=e,--a||n(o))}),i)})),--a||n(o)}));return o.error&&i(o.value),r.promise}});var Ca=qs.CONSTRUCTOR;js&&js.prototype,nt({target:"Promise",proto:!0,forced:Ca,real:!0},{catch:function(e){return this.then(void 0,e)}}),nt({target:"Promise",stat:!0,forced:Ea},{race:function(e){var t=this,r=Js.f(t),n=r.reject,i=Os((function(){var i=ne(t.resolve);Ro(e,(function(e){_(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}}),nt({target:"Promise",stat:!0,forced:qs.CONSTRUCTOR},{reject:function(e){var t=Js.f(this);return _(t.reject,void 0,e),t.promise}});var Ra=function(e,t){if(qe(e),U(t)&&t.constructor===e)return t;var r=Js.f(e);return(0,r.resolve)(t),r.promise},ka=qs.CONSTRUCTOR,Aa=B("Promise"),Ia=!ka;nt({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Ra(Ia&&this===Aa?js:this,e)}}),nt({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=Js.f(t),n=r.resolve,i=r.reject,o=Os((function(){var r=ne(t.resolve),i=[],o=0,s=1;Ro(e,(function(e){var a=o++,c=!1;s++,_(r,t,e).then((function(e){c||(c=!0,i[a]={status:"fulfilled",value:e},--s||n(i))}),(function(e){c||(c=!0,i[a]={status:"rejected",reason:e},--s||n(i))}))})),--s||n(i)}));return o.error&&i(o.value),r.promise}});var Oa="No one promise resolved";nt({target:"Promise",stat:!0},{any:function(e){var t=this,r=B("AggregateError"),n=Js.f(t),i=n.resolve,o=n.reject,s=Os((function(){var n=ne(t.resolve),s=[],a=0,c=1,u=!1;Ro(e,(function(e){var l=a++,d=!1;c++,_(n,t,e).then((function(e){d||u||(u=!0,i(e))}),(function(e){d||u||(d=!0,s[l]=e,--c||o(new r(s,Oa)))}))})),--c||o(new r(s,Oa))}));return s.error&&o(s.value),n.promise}});var Pa=js&&js.prototype,Na=!!js&&c((function(){Pa.finally.call({then:function(){}},(function(){}))}));nt({target:"Promise",proto:!0,real:!0,forced:Na},{finally:function(e){var t=Jo(this,B("Promise")),r=b(e);return this.then(r?function(r){return Ra(t,e()).then((function(){return r}))}:e,r?function(r){return Ra(t,e()).then((function(){throw r}))}:e)}});var Da=F.Promise;nt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=Js.f(this),r=Os(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var La=Da,ja=y([].reverse),Ua=[1,2];nt({target:"Array",proto:!0,forced:String(Ua)===String(Ua.reverse())},{reverse:function(){return Yt(this)&&(this.length=this.length),ja(this)}});var Fa=qt("Array").reverse,$a=Array.prototype,Ba=function(e){var t=e.reverse;return e===$a||V($a,e)&&t===$a.reverse?Fa:t},Va=_r("slice"),Ha=_e("species"),Wa=Array,qa=Math.max;nt({target:"Array",proto:!0,forced:!Va},{slice:function(e,t){var r,n,i,o=L(this),s=pt(o),a=lt(e,s),c=lt(void 0===t?s:t,s);if(Yt(o)&&(r=o.constructor,(vr(r)&&(r===Wa||Yt(r.prototype))||U(r)&&null===(r=r[Ha]))&&(r=void 0),r===Wa||void 0===r))return Ut(o,a,c);for(n=new(void 0===r?Wa:r)(qa(c-a,0)),i=0;a<c;a++,i++)a in o&&er(n,i,o[a]);return n.length=i,n}});var za=qt("Array").slice,Ga=Array.prototype,Ja=function(e){var t=e.slice;return e===Ga||V(Ga,e)&&t===Ga.slice?za:t},Ka=r((function(e){var t=Ji.default;function r(){e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,o=i.hasOwnProperty,s="function"==typeof Ui?Ui:{},a=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function l(e,t,r){return Yi(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var i=t&&t.prototype instanceof f?t:f,o=Pt(i.prototype),s=new x(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return C()}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=_(s,r);if(a){if(a===m)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=p(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var m={};function f(){}function h(){}function g(){}var v={};l(v,a,(function(){return this}));var y=Zi&&Zi(Zi(E([])));y&&y!==i&&o.call(y,a)&&(v=y);var b=g.prototype=f.prototype=Pt(v);function S(e){var t;so(t=["next","throw","return"]).call(t,(function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,r){function n(i,s,a,c){var u=p(e[i],e,s);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==t(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):r.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var i;this._invoke=function(e,t){function o(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(o,o):o()}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=p(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],so(e).call(e,w,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:C}}function C(){return{value:void 0,done:!0}}return h.prototype=g,l(b,"constructor",g),l(g,"constructor",h),h.displayName=l(g,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return jt?jt(e,g):(e.__proto__=g,l(e,u,"GeneratorFunction")),e.prototype=Pt(b),e},n.awrap=function(e){return{__await:e}},S(T.prototype),l(T.prototype,c,(function(){return this})),n.AsyncIterator=T,n.async=function(e,t,r,i,o){void 0===o&&(o=La);var s=new T(d(e,t,r,i),o);return n.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},S(b),l(b,u,"Generator"),l(b,a,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=[];for(var r in e)t.push(r);return Ba(t).call(t),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},n.values=E,x.prototype={constructor:x,reset:function(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,so(t=this.tryEntries).call(t,M),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+Ja(r).call(r,1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var a=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),m}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})),Qa=Ka(),Ya=Qa;try{regeneratorRuntime=Qa}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=Qa:Function("r","regeneratorRuntime = r")(Qa)}nt({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var Xa=9007199254740991,Za=c((function(){St(1)}));nt({target:"Object",stat:!0,forced:Za},{keys:function(e){return St(de(e))}});var ec=F.Object.keys,tc=Object.assign,rc=Object.defineProperty,nc=y([].concat),ic=!tc||c((function(){if(S&&1!==tc({b:1},tc(rc({},"a",{enumerable:!0,get:function(){rc(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=tc({},e)[r]||St(tc({},t)).join("")!=n}))?function(e,t){for(var r=de(e),n=arguments.length,i=1,o=$r.f,s=x.f;n>i;)for(var a,c=O(arguments[i++]),u=o?nc(St(c),o(c)):St(c),l=u.length,d=0;l>d;)a=u[d++],S&&!_(s,c,a)||(r[a]=c[a]);return r}:tc;nt({target:"Object",stat:!0,arity:2,forced:Object.assign!==ic},{assign:ic});var oc=F.Object.assign,sc=ft.indexOf,ac=y([].indexOf),cc=!!ac&&1/ac([1],1,-0)<0,uc=eo("indexOf");nt({target:"Array",proto:!0,forced:cc||!uc},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return cc?ac(this,e,t)||0:sc(this,e,t)}});var lc=qt("Array").indexOf,dc=Array.prototype,pc=function(e){var t=e.indexOf;return e===dc||V(dc,e)&&t===dc.indexOf?lc:t},mc=qt("Array").concat,fc=Array.prototype,hc=function(e){var t=e.concat;return e===fc||V(fc,e)&&t===fc.concat?mc:t};function gc(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function vc(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())}))}var yc=c((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),bc=Object.isExtensible,Sc=c((function(){bc(1)}))||yc?function(e){return!!U(e)&&(!yc||"ArrayBuffer"!=k(e))&&(!bc||bc(e))}:bc,Tc=!c((function(){return Object.isExtensible(Object.preventExtensions({}))})),_c=r((function(e){var t=Xe.f,r=!1,n=ve("meta"),i=0,o=function(e){t(e,n,{value:{objectID:"O"+i++,weakData:{}}})},s=e.exports={enable:function(){s.enable=function(){},r=!0;var e=Pr.f,t=y([].splice),i={};i[n]=1,e(i).length&&(Pr.f=function(r){for(var i=e(r),o=0,s=i.length;o<s;o++)if(i[o]===n){t(i,o,1);break}return i},nt({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Fr.f}))},fastKey:function(e,t){if(!U(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!me(e,n)){if(!Sc(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!me(e,n)){if(!Sc(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return Tc&&r&&Sc(e)&&!me(e,n)&&o(e),e}};ht[n]=!0})),wc=Xe.f,Mc=ln.forEach,xc=an.set,Ec=an.getterFor,Cc=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:Br(e,n,t[n],r);return e},Rc=Xe.f,kc=_c.fastKey,Ac=an.set,Ic=an.getterFor,Oc={getConstructor:function(e,t,r,n){var i=e((function(e,i){Wo(e,o),Ac(e,{type:t,index:It(null),first:void 0,last:void 0,size:0}),S||(e.size=0),P(i)||Ro(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,s=Ic(t),a=function(e,t,r){var n,i,o=s(e),a=c(e,t);return a?a.value=r:(o.last=a={index:i=kc(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=a),n&&(n.next=a),S?o.size++:e.size++,"F"!==i&&(o.index[i]=a)),e},c=function(e,t){var r,n=s(e),i=kc(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return Cc(o,{clear:function(){for(var e=s(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,S?e.size=0:this.size=0},delete:function(e){var t=this,r=s(t),n=c(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),S?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=s(this),n=Be(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),Cc(o,r?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),S&&Rc(o,"size",{get:function(){return s(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=Ic(t),o=Ic(n);ki(e,t,(function(e,t){Ac(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),Vo(t)}};!function(e,t,r){var n,i=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),s=i?"set":"add",u=a[e],l=u&&u.prototype,d={};if(S&&b(u)&&(o||l.forEach&&!c((function(){(new u).entries().next()})))){var p=(n=t((function(t,r){xc(Wo(t,p),{type:e,collection:new u}),null!=r&&Ro(r,t[s],{that:t,AS_ENTRIES:i})}))).prototype,m=Ec(e);Mc(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in l)||o&&"clear"==e||Ze(p,e,(function(r,n){var i=m(this).collection;if(!t&&o&&!U(r))return"get"==e&&void 0;var s=i[e](0===r?0:r,n);return t?this:s}))})),o||wc(p,"size",{configurable:!0,get:function(){return m(this).collection.size}})}else n=r.getConstructor(t,e,i,s),_c.enable();Kr(n,e,!1,!0),d[e]=n,nt({global:!0,forced:!0},d),o||r.setStrong(n,e,i)}("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Oc);var Pc=F.Map,Nc=[].push;nt({target:"Map",stat:!0,forced:!0},{from:function(e){var t,r,n,i,o=arguments.length,s=o>1?arguments[1]:void 0;return zo(this),(t=void 0!==s)&&ne(s),P(e)?new this:(r=[],t?(n=0,i=Be(s,o>2?arguments[2]:void 0),Ro(e,(function(e){_(Nc,r,i(e,n++))}))):Ro(e,Nc,{that:r}),new this(r))}}),nt({target:"Map",stat:!0,forced:!0},{of:function(){return new this(Ut(arguments))}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=qe(this),r=ne(t.delete),n=!0,i=0,o=arguments.length;i<o;i++)e=_(r,t,arguments[i]),n=n&&e;return!!n}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var r,n,i=qe(this),o=ne(i.get),s=ne(i.has),a=ne(i.set);return _(s,i,e)?(r=_(o,i,e),"update"in t&&(r=t.update(r,e,i),_(a,i,e,r)),r):(n=t.insert(e,i),_(a,i,e,n),n)}});var Dc=wo;nt({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=qe(this),r=Dc(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return!Ro(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=qe(this),r=Dc(t),n=Be(e,arguments.length>1?arguments[1]:void 0),i=new(Jo(t,B("Map"))),o=ne(i.set);return Ro(r,(function(e,r){n(r,e,t)&&_(o,i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=qe(this),r=Dc(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return Ro(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=qe(this),r=Dc(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return Ro(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Lc=y([].push);nt({target:"Map",stat:!0,forced:!0},{groupBy:function(e,t){ne(t);var r=wo(e),n=new this,i=ne(n.has),o=ne(n.get),s=ne(n.set);return Ro(r,(function(e){var r=t(e);_(i,n,r)?Lc(_(o,n,r),e):_(s,n,r,[e])}),{IS_ITERATOR:!0}),n}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return Ro(Dc(qe(this)),(function(t,r,n){if((i=r)===(o=e)||i!=i&&o!=o)return n();var i,o}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var r=new this;ne(t);var n=ne(r.set);return Ro(e,(function(e){_(n,r,t(e),e)})),r}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){return Ro(Dc(qe(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=qe(this),r=Dc(t),n=Be(e,arguments.length>1?arguments[1]:void 0),i=new(Jo(t,B("Map"))),o=ne(i.set);return Ro(r,(function(e,r){_(o,i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=qe(this),r=Dc(t),n=Be(e,arguments.length>1?arguments[1]:void 0),i=new(Jo(t,B("Map"))),o=ne(i.set);return Ro(r,(function(e,r){_(o,i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=qe(this),r=ne(t.set),n=arguments.length,i=0;i<n;)Ro(arguments[i++],r,{that:t,AS_ENTRIES:!0});return t}});var jc=TypeError;nt({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=qe(this),r=Dc(t),n=arguments.length<2,i=n?void 0:arguments[1];if(ne(e),Ro(r,(function(r,o){n?(n=!1,i=o):i=e(i,o,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw jc("Reduce of empty map with no initial value");return i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=qe(this),r=Dc(t),n=Be(e,arguments.length>1?arguments[1]:void 0);return Ro(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Uc=TypeError;nt({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=qe(this),n=ne(r.get),i=ne(r.has),o=ne(r.set),s=arguments.length;ne(t);var a=_(i,r,e);if(!a&&s<3)throw Uc("Updating absent value");var c=a?_(n,r,e):ne(s>2?arguments[2]:void 0)(e,r);return _(o,r,e,t(c,e,r)),r}});var Fc=TypeError,$c=function(e,t){var r,n=qe(this),i=ne(n.get),o=ne(n.has),s=ne(n.set),a=arguments.length>2?arguments[2]:void 0;if(!b(t)&&!b(a))throw Fc("At least one callback required");return _(o,n,e)?(r=_(i,n,e),b(t)&&(r=t(r),_(s,n,e,r))):b(a)&&(r=a(),_(s,n,e,r)),r};nt({target:"Map",proto:!0,real:!0,forced:!0},{upsert:$c}),nt({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:$c});var Bc=Pc,Vc=/MSIE .\./.test(H),Hc=a.Function,Wc=function(e){return Vc?function(t,r){var n=Qo(arguments.length,1)>2,i=b(t)?t:Hc(t),o=n?Ut(arguments,2):void 0;return e(n?function(){m(i,this,o)}:i,r)}:e},qc={setTimeout:Wc(a.setTimeout),setInterval:Wc(a.setInterval)},zc=qc.setInterval;nt({global:!0,bind:!0,forced:a.setInterval!==zc},{setInterval:zc});var Gc=qc.setTimeout;nt({global:!0,bind:!0,forced:a.setTimeout!==Gc},{setTimeout:Gc});var Jc=F.setTimeout;F.JSON||(F.JSON={stringify:JSON.stringify});var Kc=function(e,t,r){return m(F.JSON.stringify,null,arguments)},Qc=Kc,Yc=Date,Xc=y(Yc.prototype.getTime);nt({target:"Date",stat:!0},{now:function(){return Xc(new Yc)}});var Zc=F.Date.now,eu=r((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,o||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,o,s){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,o),!0;case 6:return l.fn.call(l.context,t,n,i,o,s),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,m=l.length;for(u=0;u<m;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||s(this,o);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[o]=1===u.length?u[0]:u:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a})),tu=ru;function ru(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ru.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},ru.prototype.reset=function(){this.attempts=0},ru.prototype.setMin=function(e){this.ms=e},ru.prototype.setMax=function(e){this.max=e},ru.prototype.setJitter=function(e){this.jitter=e};var nu="object"==typeof e&&e&&e.Object===Object&&e,iu="object"==typeof self&&self&&self.Object===Object&&self,ou=nu||iu||Function("return this")(),su=ou.Symbol,au=Object.prototype,cu=au.hasOwnProperty,uu=au.toString,lu=su?su.toStringTag:void 0,du=function(e){var t=cu.call(e,lu),r=e[lu];try{e[lu]=void 0;var n=!0}catch(e){}var i=uu.call(e);return n&&(t?e[lu]=r:delete e[lu]),i},pu=Object.prototype.toString,mu=function(e){return pu.call(e)},fu=su?su.toStringTag:void 0,hu=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":fu&&fu in Object(e)?du(e):mu(e)},gu=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},vu=function(e){if(!gu(e))return!1;var t=hu(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},yu={deviceId:"",chunkUploadHost:"https://wanproxy-web.127.net",commonUploadHost:"https://nos.netease.com",chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim.nosdn.127.net",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,timeout:8e3},bu={account:"",appkey:"",token:"",debugLevel:"off",needReconnect:!0,reconnectionAttempts:Xa},Su="weblink.netease.im:443",Tu=ft.includes,_u=c((function(){return!Array(1).includes()}));nt({target:"Array",proto:!0,forced:_u},{includes:function(e){return Tu(this,e,arguments.length>1?arguments[1]:void 0)}});var wu=qt("Array").includes,Mu=_e("match"),xu=TypeError,Eu=function(e){if(function(e){var t;return U(e)&&(void 0!==(t=e[Mu])?!!t:"RegExp"==k(e))}(e))throw xu("The method doesn't accept regular expressions");return e},Cu=_e("match"),Ru=y("".indexOf);nt({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Cu]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~Ru(Ir(D(this)),Ir(Eu(e)),arguments.length>1?arguments[1]:void 0)}});var ku=qt("String").includes,Au=Array.prototype,Iu=String.prototype,Ou=function(e){var t=e.includes;return e===Au||V(Au,e)&&t===Au.includes?wu:"string"==typeof e||e===Iu||V(Iu,e)&&t===Iu.includes?ku:t},Pu=ln.findIndex,Nu=!0;"findIndex"in[]&&Array(1).findIndex((function(){Nu=!1})),nt({target:"Array",proto:!0,forced:Nu},{findIndex:function(e){return Pu(this,e,arguments.length>1?arguments[1]:void 0)}});var Du=qt("Array").findIndex,Lu=Array.prototype,ju=function(e){var t=e.findIndex;return e===Lu||V(Lu,e)&&t===Lu.findIndex?Du:t},Uu=ln.map,Fu=_r("map");nt({target:"Array",proto:!0,forced:!Fu},{map:function(e){return Uu(this,e,arguments.length>1?arguments[1]:void 0)}});var $u=qt("Array").map,Bu=Array.prototype,Vu=function(e){var t=e.map;return e===Bu||V(Bu,e)&&t===Bu.map?$u:t},Hu=r((function(e){function t(r){var n;return e.exports=t=jt?Jt(n=Zi).call(n):function(e){return e.__proto__||Zi(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Wu=r((function(e){e.exports=function(e){var t;return-1!==pc(t=Function.toString.call(e)).call(t,"[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports})),qu=B("Reflect","construct"),zu=Object.prototype,Gu=[].push,Ju=c((function(){function e(){}return!(qu((function(){}),[],e)instanceof e)})),Ku=!c((function(){qu((function(){}))})),Qu=Ju||Ku;nt({target:"Reflect",stat:!0,forced:Qu,sham:Qu},{construct:function(e,t){zo(e),qe(t);var r=arguments.length<3?e:zo(arguments[2]);if(Ku&&!Ju)return qu(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return m(Gu,n,t),new(m(Wt,e,n))}var i=r.prototype,o=It(U(i)?i:zu),s=m(e,o,t);return U(s)?s:o}});var Yu=F.Reflect.construct,Xu=r((function(e){e.exports=function(){if("undefined"==typeof Reflect||!Yu)return!1;if(Yu.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Yu(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports})),Zu=r((function(e){function t(r,n,i){var o;return Xu()?(e.exports=t=Jt(o=Yu).call(o),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=t=function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Jt(Function).apply(e,n));return r&&Kt(i,r.prototype),i},e.exports.__esModule=!0,e.exports.default=e.exports),t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),el=r((function(e){function t(r){var n="function"==typeof Bc?new Bc:void 0;return e.exports=t=function(e){if(null===e||!Wu(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return Zu(e,arguments,Hu(this).constructor)}return t.prototype=Pt(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Kt(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),tl=function(e){function t(t,r,n){var i;return void 0===r&&(r={}),void 0===n&&(n=400),(i=e.call(this,t)||this).data=r,i.code=n,i.name="customError",i}return Qt(t,e),t}(t(el)(Error)),rl=function(e){function t(t,r,n){var i;return void 0===r&&(r={}),(i=e.call(this,t,r,414)||this).code=414,i.name="validateError",i.rules=n,i}return Qt(t,e),t}(tl),nl={200:null,406:null,808:null,810:null,201:"The client version is incorrect. You need to upgrade the SDK",302:"The user name or password is incorrect. Please check whether the appkey and token are valid and whether the account and token match",403:"Illegal operation or no permission",404:"Target object does not exist",405:"Parameter length too long",408:"Client request timed out",414:"Request parameter error",415:"Service unavailable",416:"Frequency control",417:"Repeat operation",422:"Account disabled",500:"Server internal error",503:"Server busy",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",997:"The packet has expired",998:"Deserialize packet error",999:"Serialize packet error",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"},il=function(e){function t(t,r,n,i,o){var s;return void 0===n&&(n=""),void 0===i&&(i=(new Date).getTime()),void 0===o&&(o={}),n=n||nl[t],(s=e.call(this,n,o,t)||this).name="cmdError",s.cmd=r,s.timetag=i,s}return Qt(t,e),t}(tl),ol=function(e){function t(t,r,n){var i;return(i=e.call(this,t,{},412)||this).code=412,i.name="formatError",i.key=r,i.reason=n,i}return Qt(t,e),t}(tl),sl=function(e){function t(t,r,n,i,o){var s;return(s=e.call(this,t,{file:o},400)||this).name="uploadError",s.rawError=r,s.curProvider=n||1,s.mixStorePolicy=i,s}return Qt(t,e),t}(tl),al=["error","warn","log","debug"],cl=function(){},ul=["off","error","warn","log","debug"],ll=function(){function e(t,r){this.name=r,this.strategies={debug:console.log,log:console.log,warn:console.warn,error:console.error},this.debug=cl,this.log=cl,this.warn=cl,this.error=cl,this.name=r,e.instancesName.push(r),Ou(ul).call(ul,t)||(t="off"),this.setLogFunc(t)}var t=e.prototype;return t.setLogFunc=function(e){var t=this,r=ju(al).call(al,(function(t){return t===e}));so(al).call(al,(function(e,n){n<=r&&(t[e]=function(){var t=Ja(Array.prototype).call(arguments),r=this.formatArgs(t,e);this.strategies[e](r)})}))},t.formatArgs=function(e,t){var r=new Date,n=r.getMonth()+1+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+":"+r.getMilliseconds();return"[NIM "+t+" "+this.name+" "+n+"] "+Vu(e).call(e,(function(e){return e instanceof tl?e.name+", "+e.code+", "+e.message:e instanceof Error?e&&e.message?e.message:e:"object"==typeof e?Qc(e):e})).join(" ")},e}();ll.instancesName=[];var dl=r((function(e,t){e.exports=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}var i={reportUrl:"https://statistic.live.126.net/statics/report/common/form",maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,reportInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0},o="https://statistic.live.126.net/dispatcher/req",s=function(){},a=function(){function t(r){e(this,t),this.enable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=i,this.msgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.setConfig(r),this.reportConfig.autoStart&&this.initUploadConfig()}return r(t,[{key:"setConfig",value:function(e){this.reportConfig=Object.assign({},this.reportConfig,e)}},{key:"report",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){var n=Date.now();r?this.lowPriorityMsgList.push({module:e,msg:t,createTime:n}):this.msgList.push({module:e,msg:t,createTime:n}),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&!this.traceMsgCache[e]){var r={user_id:t.user_id,action:t.action,start_time:Date.now(),updateTime:Date.now(),extension:[]};this.traceMsgCache[e]=r}}},{key:"reportTraceUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.traceMsgCache[e]){var i=t.operation_type,o=t.code,s=t.target,a=t.error,c=n(t,["operation_type","code","target","error"]);this.traceMsgCache[e].updateTime=Date.now(),a&&a.code&&(o=a.code),this.traceMsgCache[e].extension.push({operation_type:i,code:o,succeed:r,target:s,duration:this.traceMsgCache[e].updateTime-this.traceMsgCache[e].start_time,description:JSON.stringify(c)})}}},{key:"reportTraceEnd",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.traceMsgCache[e]&&("nos"!==e||0!==t?(this.traceMsgCache[e].succeed=!t,this.traceMsgCache[e].duration=Date.now()-this.traceMsgCache[e].start_time,delete this.traceMsgCache[e].updateTime,this.report(e,this.traceMsgCache[e]),this.traceMsgCache[e]=null):this.traceMsgCache[e]=null)}},{key:"pause",value:function(){this.enable=!1}},{key:"restore",value:function(){this.enable=!0,this.initConfigLoaded||this.initUploadConfig()}},{key:"destroy",value:function(){var e=this;Object.keys(this.traceMsgCache).forEach((function(t){e.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=s,this.report=s,this.reportTraceStart=s,this.reportTraceUpdate=s,this.reportTraceEnd=s,this.pause=s,this.restore=s,this.destroy=s,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.reportConfig={},this.isDestroyed=!0}},{key:"initUploadConfig",value:function(){var e,t,r=this;if(!this.loading){this.loading=!0;var n=this.reportConfig.common||{};try{this.reportConfig.request(o,{method:"GET",dataType:"json",params:{deviceId:n.deviceId,sdktype:n.sdktype,sdkVer:n.sdk_ver,platform:n.platform,appkey:n.app_key},timeout:this.reportConfig.timeout}).then((function(e){var t,n;if(!r.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){var i=e.data.data||{};r.reportConfig.reportInterval=i.maxInterval>1e4?1e4:i.maxInterval,r.reportConfig.reportInterval=i.maxInterval<10?10:i.maxInterval,r.reportConfig.maxSize=i.maxSize>1e3?1e3:i.maxSize,r.reportConfig.minInterval=i.minInterval<2?2:i.minInterval,r.reportConfig.maxDelay=i.maxDelay||300,r.reportConfig.reportInterval=1e3*r.reportConfig.reportInterval,r.reportConfig.minInterval=1e3*r.reportConfig.minInterval,r.reportConfig.maxDelay=1e3*r.reportConfig.maxDelay,r.enable=!0,r.initConfigLoaded=!0,r.loading=!1,r.reportHeartBeat()}null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.log("Get reporter upload config success")}})).catch((function(e){var t,n;r.loading=!1,null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.error("Get reporter upload config failed",e)}))}catch(r){this.loading=!1,null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.error("Exec reporter request failed",r)}}}},{key:"reportHeartBeat",value:function(){var e=this;this.isDestroyed||(this.timer=setTimeout((function(){e.reportHeartBeat()}),this.reportConfig.reportInterval),this.doReport())}},{key:"doReport",value:function(){this.isDestroyed||(this.msgList.length+this.lowPriorityMsgList.length>=this.reportConfig.maxSize||Date.now()-this.lastReportTime>=this.reportConfig.reportInterval)&&this.upload()}},{key:"getUploadMsg",value:function(){var e=this,t={},r=Date.now();this.msgList=this.msgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.lowPriorityMsgList=this.lowPriorityMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.cacheMsgList=this.cacheMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay}));var n=this.msgList.slice(0,this.reportConfig.maxSize);if(this.msgList=this.msgList.slice(n.length),n.length<this.reportConfig.maxSize){var i=this.reportConfig.maxSize-n.length;n=n.concat(this.lowPriorityMsgList.slice(0,i)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice(i)}if(n.length<this.reportConfig.maxSize){var o=this.reportConfig.maxSize-n.length;n=n.concat(this.cacheMsgList.slice(0,o)),this.cacheMsgList=this.cacheMsgList.slice(o)}return n.forEach((function(e){t[e.module]?t[e.module].push(e.msg):t[e.module]=[e.msg]})),{uploadMsgArr:n,uploadMsg:t}}},{key:"upload",value:function(){var e,t,r=this;if(this.enable&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var n=this.getUploadMsg(),i=n.uploadMsgArr,o=n.uploadMsg;if(i.length){this.lastReportTime=Date.now();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",params:{common:this.reportConfig.common,event:o},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(e){var t,n;r.cacheMsgList=r.cacheMsgList.concat(i).slice(0,r.reportConfig.cacheMaxSize),null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.warn("Reporter upload failed",e)}))}catch(r){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",r)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),t}();return a}()})),pl={setLogger:function(e){throw new Error("Function not implemented.")},platform:"",WebSocket:function(){function e(e,t){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,new Error("Method not implemented.")}var t=e.prototype;return t.close=function(e,t){throw new Error("Method not implemented.")},t.send=function(e){throw new Error("Method not implemented.")},t.onclose=function(e){throw new Error("Method not implemented.")},t.onerror=function(e){throw new Error("Method not implemented.")},t.onmessage=function(e){throw new Error("Method not implemented.")},t.onopen=function(e){throw new Error("Method not implemented.")},e}(),localStorage:{},request:function(e,t){throw new Error("Function not implemented.")},uploadFile:function(e){throw new Error("Function not implemented.")},getSystemInfo:function(){throw new Error("Function not implemented.")}},ml=TypeError,fl=function(e){return function(t,r,n,i){ne(r);var o=de(t),s=O(o),a=pt(o),c=e?a-1:0,u=e?-1:1;if(n<2)for(;;){if(c in s){i=s[c],c+=u;break}if(c+=u,e?c<0:a<=c)throw ml("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=u)c in s&&(i=r(i,s[c],c,o));return i}},hl=[fl(!1),fl(!0)][0],gl=eo("reduce");nt({target:"Array",proto:!0,forced:!gl||!$o&&K>79&&K<83},{reduce:function(e){var t=arguments.length;return hl(this,e,t,t>1?arguments[1]:void 0)}});var vl=qt("Array").reduce,yl=Array.prototype,bl=function(e){var t=e.reduce;return e===yl||V(yl,e)&&t===yl.reduce?vl:t},Sl=function(e){return void 0===e},Tl={},_l={};function wl(e,t){var r,n,i;try{i=JSON.parse(e)}catch(r){throw t.error("Parse command error: ",e),r}var o=i.sid+"_"+i.cid,s=i.r;if(Ou(r=["4_1","4_2","4_10","4_11"]).call(r,o)){var a=i.r[1].headerPacket;o=a.sid+"_"+a.cid,s=i.r[1].body}var c,u=_l[o],l=Tl[u],d=function(e,t){var r=nl[e];return null===r?null:new il(e,t,r,(new Date).getTime())}(i.code,u),p={cmd:u,raw:i,error:d,service:null==l?void 0:l.service,content:{}};if(p.error){if(p.error.cmd=u,p.error.callFunc="parseCmd",!(null===(n=null==l?void 0:l.ignoreErrCodes)||void 0===n?void 0:Ou(n).call(n,i.code)))return p;t.warn("parseCmd:: ignore error ",p.error),p.error.ignore=!0}return u&&l?(l.response&&so(c=l.response).call(c,(function(e,t){var r=s[t],n=e.type,i=e.name,o=e.reflectMapper;if(!Sl(r))switch(n){case"Property":p.content[i]=o?xl(r,o):r;break;case"PropertyArray":p.content[i]=Vu(r).call(r,(function(e){return o?xl(e,o):e}));break;case"long":case"Long":case"byte":case"Byte":case"Number":p.content[i]=+r;break;default:p.content[i]=r}})),p):(p.notFound=!0,p)}function Ml(e,t){var r={};for(var n in e)void 0!==t[n]&&(r[t[n]]=e[n]);return r}function xl(e,t){var r={};for(var n in e)void 0!==t[n]&&(r[t[n]]=e[n]);return r}function El(e){Tl=oc(Tl,e.cmdConfig),_l=oc(_l,e.cmdMap)}function Cl(e){var t;return bl(t=ec(e)).call(t,(function(t,r){var n,i=e[r];return t[r]=bl(n=ec(i)).call(n,(function(e,t){return e[i[t]]=t,e}),{}),t}),{})}var Rl=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],kl=["transport not supported","client not handshaken","unauthorized"],Al=["reconnect"],Il=function(e){function t(t,r){var n;return(n=e.call(this)||this).url=t,n.logger=r,n.websocket=null,n.url=t,n.status="disconnected",n.logger=r,n.connect(),n}Qt(t,e);var r=t.prototype;return r.connect=function(){var e=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",pl.request("https://"+this.url+"/socket.io/1/?t="+Zc(),{method:"GET",dataType:"text",timeout:8e3}).then((function(t){var r=t.data.split(":"),n=r[0],i=r[1];return e.sessionId=n,e.closeTimeout=1e3*i,e._createWebsocket("wss://"+e.url+"/socket.io/1/websocket/"+n)})).catch((function(t){e.logger.error("imsocket::handshake fail. ",t&&t.message),e.status="disconnected",e.emit("handshakeFailed")}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},r.close=function(){var e;if(this.websocket){this.status="disconnected",this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null;try{null===(e=this.websocket)||void 0===e||e.send(this.encodePacket({type:"disconnect"})),this.websocket.close()}catch(e){this.logger.warn("attempt to close websocket error",e)}this.websocket.onclose=null,this.websocket=null,this.emit("disconnect")}},r.onConnect=function(){this.status="connected",this.resetCloseTimer(),this.emit("connect")},r._createWebsocket=function(e){var t,r=this;this.websocket=new pl.WebSocket(e),this.websocket.onmessage=Jt(t=this.onMessage).call(t,this),this.websocket.onclose=function(){r.logger.log("imsocket:: websocket onclose done"),"disconnected"!==r.status&&(r.logger.log("imsocket:: close()",r.status),r.close())},this.websocket.onerror=function(e){r.logger.error("imsocket:: onerror",e)}},r.onMessage=function(e){var t;this.resetCloseTimer();var r=this.decodePacket(e.data);if(r)switch(r.type){case"connect":this.onConnect();break;case"disconnect":this.close();break;case"message":case"json":this.emit("message",r.data);break;case"event":r.name&&this.emit(r.name,r.args);break;case"error":"unauthorized"===r.reason?this.emit("connect_failed",r.reason):this.emit("error",r.reason);break;case"heartbeat":null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::no handler type",r.type)}},r.encodePacket=function(e){var t,r,n=e.type,i=e.id,o=void 0===i?"":i,s=e.endpoint,a=void 0===s?"":s,c=e.ack,u=null;if(!n)return"";switch(n){case"error":t=e.reason?pc(kl).call(kl,e.reason):"",r=e.advice?pc(Al).call(Al,e.advice):"",""===t&&""===r||(u=t+(""!==r?"+"+r:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":t={name:e.name},t=e.args&&e.args.length?{name:e.name,args:e.args}:{name:e.name},u=Qc(t);break;case"json":u=Qc(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+Qc(e.args):"")}var l=[pc(Rl).call(Rl,n),o+("data"===c?"+":""),a];return null!=u&&l.push(u),l.join(":")},r.decodePacket=function(e){if(e)if("�"!=e.charAt(0)){var t=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(t){var r,n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c={type:Rl[+n],endpoint:s};switch(i&&(c.id=i,c.ack=!o||"data"),c.type){case"error":r=a.split("+"),c.reason=kl[+r[0]]||"";break;case"message":c.data=a||"";break;case"connect":c.qs=a||"";break;case"event":try{var u=JSON.parse(a);c.name=u.name,c.args=u.args}catch(e){this.logger.error("imsocket::parseData::type::event error",e)}c.args=c.args||[];break;case"json":try{c.data=JSON.parse(a)}catch(e){this.logger.error("imsocket::parseData::type::json error",e)}break;case"ack":if((r=a.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=r[1],c.args=[],r[3]))try{c.args=r[3]?JSON.parse(r[3]):[]}catch(e){this.logger.error("imsocket::parseData::type::ack error",e)}}return c}}else this.logger.error("imsocket::unrecognize dataStr",Ja(e).call(e,0,20))},r.send=function(e){var t,r={data:e,type:"message",endpoint:""};null===(t=this.websocket)||void 0===t||t.send(this.encodePacket(r))},r.resetCloseTimer=function(){var e=this;this.closeTimeout&&(clearTimeout(this.closeTimer),this.closeTimer=Jc((function(){e.close()}),this.closeTimeout))},t}(eu),Ol=qt("Array").values,Pl=Array.prototype,Nl={DOMTokenList:!0,NodeList:!0},Dl=function(e){var t=e.values;return e===Pl||V(Pl,e)&&t===Pl.values||me(Nl,sr(e))?Ol:t};nt({target:"Array",stat:!0},{isArray:Yt});var Ll=F.Array.isArray,jl=ln.every,Ul=eo("every");nt({target:"Array",proto:!0,forced:!Ul},{every:function(e){return jl(this,e,arguments.length>1?arguments[1]:void 0)}});var Fl=qt("Array").every,$l=Array.prototype,Bl=function(e){var t=e.every;return e===$l||V($l,e)&&t===$l.every?Fl:t},Vl=function(e){return null!=e&&"object"==typeof e},Hl=function(e){return Vl(e)&&"[object RegExp]"==hu(e)},Wl=function(e){return function(t){return e(t)}},ql=r((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,i=n&&n.exports===r&&nu.process,o=function(){try{return n&&n.require&&n.require("util").types||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o})),zl=ql&&ql.isRegExp,Gl=zl?Wl(zl):Hl,Jl=ou["__core-js_shared__"],Kl=function(){var e=/[^.]+$/.exec(Jl&&Jl.keys&&Jl.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ql=function(e){return!!Kl&&Kl in e},Yl=Function.prototype.toString,Xl=function(e){if(null!=e){try{return Yl.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Zl=/^\[object .+?Constructor\]$/,ed=Function.prototype,td=Object.prototype,rd=ed.toString,nd=td.hasOwnProperty,id=RegExp("^"+rd.call(nd).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),od=function(e){return!(!gu(e)||Ql(e))&&(vu(e)?id:Zl).test(Xl(e))},sd=function(e,t){return null==e?void 0:e[t]},ad=function(e,t){var r=sd(e,t);return od(r)?r:void 0},cd=ad(Object,"create"),ud=function(){this.__data__=cd?cd(null):{},this.size=0},ld=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},dd=Object.prototype.hasOwnProperty,pd=function(e){var t=this.__data__;if(cd){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return dd.call(t,e)?t[e]:void 0},md=Object.prototype.hasOwnProperty,fd=function(e){var t=this.__data__;return cd?void 0!==t[e]:md.call(t,e)},hd=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=cd&&void 0===t?"__lodash_hash_undefined__":t,this};function gd(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}gd.prototype.clear=ud,gd.prototype.delete=ld,gd.prototype.get=pd,gd.prototype.has=fd,gd.prototype.set=hd;var vd=gd,yd=function(){this.__data__=[],this.size=0},bd=function(e,t){return e===t||e!=e&&t!=t},Sd=function(e,t){for(var r=e.length;r--;)if(bd(e[r][0],t))return r;return-1},Td=Array.prototype.splice,_d=function(e){var t=this.__data__,r=Sd(t,e);return!(r<0||(r==t.length-1?t.pop():Td.call(t,r,1),--this.size,0))},wd=function(e){var t=this.__data__,r=Sd(t,e);return r<0?void 0:t[r][1]},Md=function(e){return Sd(this.__data__,e)>-1},xd=function(e,t){var r=this.__data__,n=Sd(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Ed(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ed.prototype.clear=yd,Ed.prototype.delete=_d,Ed.prototype.get=wd,Ed.prototype.has=Md,Ed.prototype.set=xd;var Cd=Ed,Rd=ad(ou,"Map"),kd=function(){this.size=0,this.__data__={hash:new vd,map:new(Rd||Cd),string:new vd}},Ad=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e},Id=function(e,t){var r=e.__data__;return Ad(t)?r["string"==typeof t?"string":"hash"]:r.map},Od=function(e){var t=Id(this,e).delete(e);return this.size-=t?1:0,t},Pd=function(e){return Id(this,e).get(e)},Nd=function(e){return Id(this,e).has(e)},Dd=function(e,t){var r=Id(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Ld(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ld.prototype.clear=kd,Ld.prototype.delete=Od,Ld.prototype.get=Pd,Ld.prototype.has=Nd,Ld.prototype.set=Dd;var jd=Ld,Ud=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Fd=function(e){return this.__data__.has(e)};function $d(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new jd;++t<r;)this.add(e[t])}$d.prototype.add=$d.prototype.push=Ud,$d.prototype.has=Fd;var Bd=$d,Vd=function(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1},Hd=function(e){return e!=e},Wd=function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1},qd=function(e,t,r){return t==t?Wd(e,t,r):Vd(e,Hd,r)},zd=function(e,t){return!(null==e||!e.length)&&qd(e,t,0)>-1},Gd=function(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1},Jd=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i},Kd=function(e,t){return e.has(t)},Qd=function(e,t,r,n){var i=-1,o=zd,s=!0,a=e.length,c=[],u=t.length;if(!a)return c;r&&(t=Jd(t,Wl(r))),n?(o=Gd,s=!1):t.length>=200&&(o=Kd,s=!1,t=new Bd(t));e:for(;++i<a;){var l=e[i],d=null==r?l:r(l);if(l=n||0!==l?l:0,s&&d==d){for(var p=u;p--;)if(t[p]===d)continue e;c.push(l)}else o(t,d,n)||c.push(l)}return c},Yd=function(e){return e},Xd=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},Zd=Math.max,ep=function(e,t,r){return t=Zd(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=Zd(n.length-t,0),s=Array(o);++i<o;)s[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(s),Xd(e,this,a)}},tp=function(e){return function(){return e}},rp=function(){try{var e=ad(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),np=rp?function(e,t){return rp(e,"toString",{configurable:!0,enumerable:!1,value:tp(t),writable:!0})}:Yd,ip=Date.now,op=function(e){var t=0,r=0;return function(){var n=ip(),i=16-(n-r);if(r=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}},sp=op(np),ap=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},cp=function(e){return null!=e&&ap(e.length)&&!vu(e)},up=function(e){return Vl(e)&&cp(e)},lp=function(e,t){return sp(ep(e,t,Yd),e+"")}((function(e,t){return up(e)?Qd(e,t):[]})),dp=lp;function pp(e,t){return t instanceof RegExp?"__REGEXP "+t.toString():t}function mp(e,t,r){var n;void 0===t&&(t={});var i={};return so(n=ec(e)).call(n,(function(n){var o=e[n].type,s=r?"In "+r+", ":"";if(void 0===t[n]){if(!1===e[n].required)return void(i[n]=t[n]);throw new rl(s+'param "'+n+'" is required',{key:n},"required")}var a=fp[o];if(a&&!a(t,n,e[n]))throw new rl(s+'param "'+n+'" expects '+Qc(e[n],pp),{key:n,value:t[n]},Qc(e[n]));i[n]=t[n]})),i}var fp={string:function(e,t,r){var n=r.allowEmpty,i=r.max,o=r.min,s=r.regExp,a=e[t];return!("string"!=typeof a||!1===n&&""===a||"number"==typeof i&&a.length>i||"number"==typeof o&&a.length<o||Gl(s)&&!s.test(a))},number:function(e,t,r){var n=r.min,i=r.max,o=e[t];return!("number"!=typeof o||"number"==typeof n&&o<n||"number"==typeof i&&o>i)},boolean:function(e,t){return"boolean"==typeof e[t]},enum:function(e,t,r){var n=Dl(r),i=e[t];return!n||pc(n).call(n,i)>-1},array:function(e,t,r){var n,i=r.itemType,o=r.rules,s=r.min,a=r.max,c=Dl(r),u=e[t];return!(!Ll(u)||"number"==typeof a&&u.length>a||"number"==typeof s&&u.length<s||i&&"enum"!==i&&!Bl(u).call(u,(function(e){return typeof e===i}))||"enum"===i&&c&&dp.apply(void 0,hc(n=[u]).call(n,c)).length||(o&&so(u).call(u,(function(e,r){return mp(o,e,t+"["+r+"]")})),0))},object:function(e,t,r){var n=r.rules,i=e[t];return n&&mp(n,i,t),!0}},hp=ad(ou,"Set"),gp=function(){},vp=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},yp=hp&&1/vp(new hp([,-0]))[1]==1/0?function(e){return new hp(e)}:gp,bp=yp,Sp=function(e,t,r){var n=-1,i=zd,o=e.length,s=!0,a=[],c=a;if(r)s=!1,i=Gd;else if(o>=200){var u=t?null:bp(e);if(u)return vp(u);s=!1,i=Kd,c=new Bd}else c=t?[]:a;e:for(;++n<o;){var l=e[n],d=t?t(l):l;if(l=r||0!==l?l:0,s&&d==d){for(var p=c.length;p--;)if(c[p]===d)continue e;t&&c.push(d),a.push(l)}else i(c,d,r)||(c!==a&&c.push(d),a.push(l))}return a},Tp=function(e){return e&&e.length?Sp(e):[]},_p=ln.filter,wp=_r("filter");nt({target:"Array",proto:!0,forced:!wp},{filter:function(e){return _p(this,e,arguments.length>1?arguments[1]:void 0)}});var Mp=qt("Array").filter,xp=Array.prototype,Ep=function(e){var t=e.filter;return e===xp||V(xp,e)&&t===xp.filter?Mp:t},Cp="\t\n\v\f\r                　\u2028\u2029\ufeff",Rp=y("".replace),kp="["+Cp+"]",Ap=RegExp("^"+kp+kp+"*"),Ip=RegExp(kp+kp+"*$"),Op=function(e){return function(t){var r=Ir(D(t));return 1&e&&(r=Rp(r,Ap,"")),2&e&&(r=Rp(r,Ip,"")),r}},Pp=(Op(1),Op(2),Op(3)),Np=a.parseInt,Dp=a.Symbol,Lp=Dp&&Dp.iterator,jp=/^[+-]?0x/i,Up=y(jp.exec),Fp=8!==Np(Cp+"08")||22!==Np(Cp+"0x16")||Lp&&!c((function(){Np(Object(Lp))}))?function(e,t){var r=Pp(Ir(e));return Np(r,t>>>0||(Up(jp,r)?16:10))}:Np;nt({global:!0,forced:parseInt!=Fp},{parseInt:Fp});var $p,Bp=F.parseInt,Vp=($p=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return $p()+$p()+$p()+$p()+$p()+$p()+$p()+$p()});function Hp(e){var t;return Ep(t=ec(e)).call(t,(function(e){return!(+e>=0)}))}function Wp(e,t){var r,n=Ep(r=ec(e)).call(r,(function(r){return e[r]==t}));return n.length>0?n[0]:void 0}function qp(e,t){if(void 0===t&&(t="-"),!e)throw new Error("No sessionId");var r=pc(e).call(e,t);if(-1===r)throw new Error("Can not find conjunctions");var n=Ja(e).call(e,0,r);return{accid:Ja(e).call(e,r+1),scene:"super_team"===n?"superTeam":n}}var zp=TypeError,Gp=Object.getOwnPropertyDescriptor,Jp=S&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}()?function(e,t){if(Yt(e)&&!Gp(e,"length").writable)throw zp("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},Kp=TypeError,Qp=function(e,t){if(!delete e[t])throw Kp("Cannot delete property "+te(t)+" of "+te(e))},Yp=_r("splice"),Xp=Math.max,Zp=Math.min;nt({target:"Array",proto:!0,forced:!Yp},{splice:function(e,t){var r,n,i,o,s,a,c=de(this),u=pt(c),l=lt(e,u),d=arguments.length;for(0===d?r=n=0:1===d?(r=0,n=u-l):(r=d-2,n=Zp(Xp(at(t),0),u-l)),Zt(u+r-n),i=Sr(c,n),o=0;o<n;o++)(s=l+o)in c&&er(i,o,c[s]);if(i.length=n,r<n){for(o=l;o<u-n;o++)a=o+r,(s=o+n)in c?c[a]=c[s]:Qp(c,a);for(o=u;o>u-n+r;o--)Qp(c,o-1)}else if(r>n)for(o=u-n;o>l;o--)a=o+r-1,(s=o+n-1)in c?c[a]=c[s]:Qp(c,a);for(o=0;o<r;o++)c[o+l]=arguments[o+2];return Jp(c,u-n+r),i}});var em=qt("Array").splice,tm=Array.prototype,rm=function(e){var t=e.splice;return e===tm||V(tm,e)&&t===tm.splice?em:t},nm=function(e,t,r,n){try{return n?t(qe(r)[0],r[1]):t(r)}catch(t){Mo(e,"throw",t)}},im=Array,om=!xa((function(e){Array.from(e)}));nt({target:"Array",stat:!0,forced:om},{from:function(e){var t=de(e),r=vr(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Be(i,n>2?arguments[2]:void 0));var s,a,c,u,l,d,p=To(t),m=0;if(!p||this===im&&bo(p))for(s=pt(t),a=r?new this(s):im(s);s>m;m++)d=o?i(t[m],m):t[m],er(a,m,d);else for(l=(u=wo(t,p)).next,a=r?new this:[];!(c=_(l,u)).done;m++)d=o?nm(u,i,[c.value,m],!0):c.value,er(a,m,d);return a.length=m,a}});var sm=F.Array.from,am=To;function cm(e,t){var r,n=void 0!==Ui&&am(e)||e["@@iterator"];if(n)return Jt(r=(n=n.call(e)).next).call(r,n);if(Ll(e)||(n=function(e,t){var r;if(e){if("string"==typeof e)return um(e,t);var n=Ja(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?sm(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?um(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function um(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var lm,dm=function(){function e(){this.timerList=[],this.id=0,this.timer=null,this.timeout=0}var t=e.prototype;return t.addTimer=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=1);var n=(new Date).getTime(),i=this.id;return this.timerList.push({id:i,loop:r,count:0,timeout:n+t,interval:t,callback:e}),this.id++,this.checkTimer(n),i},t.checkTimer=function(e){if(void 0===e&&(e=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var t,r,n=0,i=cm(this.timerList);!(t=i()).done;){var o=t.value;(0===n||n>o.timeout)&&(n=o.timeout)}0!==this.timerList.length&&(null===this.timer||n<this.timeout||this.timeout<e)&&(this.timer=Jc(Jt(r=this.nowTime).call(r,this),n-e),this.timeout=n)}},t.nowTime=function(){for(var e,t=(new Date).getTime(),r=cm(this.timerList);!(e=r()).done;){var n=e.value;t>=n.timeout&&(n.callback(),n.count++,n.timeout=t+n.interval)}this.clerTime(),this.checkTimer(t)},t.clerTime=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function(e){for(var t=this.timerList.length-1;t>=0;t--){var r;this.timerList[t].id===e&&rm(r=this.timerList).call(r,t,1)}},t.removeFinished=function(){for(var e=this.timerList.length-1;e>=0;e--){var t,r=this.timerList[e];r.loop>=0&&r.count>=r.loop&&rm(t=this.timerList).call(t,e,1)}},t.destroy=function(){this.clerTime(),this.timerList=[],this.id=0,this.timer=null},e}();!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(lm||(lm={}));var pm=window&&vu(window.addEventListener)&&vu(window.removeEventListener),mm=function(e){function t(t,r){var n;(n=e.call(this)||this).status="unconnected",n.linkUrls=[],n.eventBus=new eu,n.packetSer=1,n.retryCount=0,n.reconnectTimer=0,n.backoff=new tu({max:8e3,min:1600,jitter:.01}),n.sendingCmdMap=new Bc,n.pingTimer=0,n.config=yu,mp({linkUrls:{type:"array",itemType:"string",required:!1}},t),n.options=oc(oc({},bu),t);var i=pl.localStorage.getItem("__NIM_DEVC_ID__");return n.options.isFixedDeviceId?(i=pl.localStorage.getItem("__NIM_DEVC_ID__")||Vp(),pl.localStorage.setItem("__NIM_DEVC_ID__",i)):i=Vp(),n.config=oc(oc(oc({},yu),r),{deviceId:i}),n.timerManager=new dm,n.logger=new ll(n.options.debugLevel,n.options.account),n.reporter=new dl({common:{app_key:t.appkey,deviceId:i,sdktype:"IM",platform:"Web",manufactor:"",sdk_ver:90800,env:"online"},request:pl.request,logger:n.logger,autoStart:"BROWSER"===pl.platform}),pl.setLogger(n.logger),n.logger.log("Core init, version ","0.11.0"," sdk version ",90800," appkey ",t.appkey),n}Qt(t,e);var r=t.prototype;return r.connect=function(e){return void 0===e&&(e={}),vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(mp({linkUrls:{type:"array",itemType:"string",required:!1}},e),"BROWSER"===pl.platform&&this.reporter.restore(),/^(unconnected|waitReconnect)$/.test(this.status)){t.next=6;break}return r="Core socket status is "+this.status+", and would not connect",this.logger.warn(r),t.abrupt("return",La.reject(r));case 6:e.isAutoReconnect||this.reporter.reportTraceStart("login",{user_id:this.options.account,action:"manual_login"}),this.status="connecting",e.linkUrls&&e.linkUrls.length>0&&(this.linkUrls=hc(n=e.linkUrls).call(n,this.linkUrls),this.linkUrls=Tp(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(Su),i=0;case 11:if(!(i<this.linkUrls.length)){t.next=29;break}return o=this.linkUrls[i],t.prev=13,t.next=16,this.doConnect(o);case 16:return this.reporter.reportTraceUpdate("login",{operation_type:"TCP",target:o}),this.status="connected",this.logger.log("core:: connect success with url: "+o),t.abrupt("return",o);case 22:t.prev=22,t.t0=t.catch(13),this.reporter.reportTraceUpdate("login",{operation_type:"TCP",error:"ws_handshake_failed",target:o},!1),this.logger.warn("core:: connect failed with url: "+o,t.t0);case 26:i++,t.next=11;break;case 29:throw 0===this.retryCount?this.doDisconnect(lm.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(lm.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("core: socket handshake failed");case 31:case"end":return t.stop()}}),t,this,[[13,22]])})))},r.doConnect=function(e){var t=this;return new La((function(r,n){var i;t.socket=new Il(e,t.logger),t.socket.on("connect",(function(){t.logger.log("socket on connect",e),r()})),t.socket.on("message",Jt(i=t.onMessage).call(i,t)),t.socket.on("disconnect",(function(e){t.logger.log("core:: socket on disconnect",e),t.doDisconnect(lm.OFFLINE,"SocketOnDisconnect")})),t.socket.on("handshakeFailed",(function(){t.logger.warn("core:: socket handshake failed"),n(new Error("handshake failed"))}))}))},r.resetConnectStatus=function(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},r.doDisconnect=function(e,t){if(this.logger.log("doDisconnect: type "+e+", description "+t),this.reporter.pause(),"unconnected"!==this.status){this.markAllCmdInvaild(new tl("Client request timed out",{},408)),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0);var r=!this.options.needReconnect||this.retryCount>=this.options.reconnectionAttempts;if(e===lm.ACTIVE||r)this.logger.log("doDisconnect: emit disconnect, type "+e,r),this.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.eventBus.emit("disconnect"),this.emit("disconnect"),this.destroyOnlineListener();else if(e===lm.KICKED){this.logger.log("doDisconnect: kicked"),this.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var n="string"==typeof t?{reason:"unknow",message:t}:t;this.eventBus.emit("kicked",n),this.emit("kicked",n),this.destroyOnlineListener()}else e===lm.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},r.attempToReconnect=function(){var e=this;if("waitReconnect"!==this.status){var t=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+t),this.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:t}),this.emit("willReconnect",{retryCount:this.retryCount,duration:t}),this.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=Jc((function(){"waitReconnect"===e.status?e.connect({isAutoReconnect:!0}).catch((function(){e.logger.error("core::attempToReconnect failed "+e.retryCount)})):e.logger.warn("doDisconnect: reconnectTimer status is "+e.status+", would not go on reconnecting")}),t)}else this.logger.warn("doDisconnect: already is waiting reconnect")},r.sendCmd=function(e,t,r){var n=this;if("logined"!==this.status&&"login"!==e&&"chatroomLogin"!==e&&"qchatLogin"!==e)return this.logger.warn("nim status is "+this.status+", so can not sendCmd "+e),La.reject({cmd:e,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return La.reject("No_socket");var i="heartbeat"!==e,o=i?this.packetSer++:0,s=function(e,t,r,n){var i=Tl[e];if(!i)return r.error("createCmd:: can not find cmd config: ",e),null;var o,s={SER:t,SID:i.sid,CID:i.cid,Q:[]};return i.params&&n&&so(o=i.params).call(o,(function(e){var t=n[e.name];if(!Sl(t)){var r=e.type,i=e.reflectMapper;switch(e.type){case"PropertyArray":r="ArrayMable",t=Vu(t).call(t,(function(e){return{t:"Property",v:i?Ml(e,i):e}}));break;case"Property":t=i?Ml(t,i):t;break;case"Bool":case"bool":t=t?"true":"false"}s.Q.push({t:r,v:t})}})),{packet:s,isNoResponse:i.isNoResponse||!1}}(e,o,this.logger,t);if(!s){var a="SendCmd "+o+" "+e+" error";return this.logger.error(a),La.reject(a)}var c=s.packet,u=s.isNoResponse,l=Qc(c);return i&&("debug"===this.options.debugLevel?this.logger.debug("core::sendCmd",e,"ser:"+o,l):this.logger.log("core::sendCmd",e,"ser:"+o)),new La((function(i,s){n.sendingCmdMap.set(o,{cmd:e,params:t,callback:[i,s],timer:u?null:Jc((function(){var t=new il(504,e,"Packet Timeout",(new Date).getTime(),{message:"ser "+o+" cmd "+e+" timeout"});t.callFunc="sendCmd",n.markCmdInvalid(o,t,e)}),r&&r.timeout?r.timeout:n.config.timeout)});try{n.socket.send(l)}catch(t){var a=new il(415,e,t&&t.message||"Unable to send packet",(new Date).getTime(),{message:"send json error",rawError:t});a.callFunc="sendCmd",n.markCmdInvalid(o,a,e),s(t)}}))},r.onMessage=function(e){var t=wl(e,this.logger);if(t){var r=t.raw.ser;if(t.error&&this.logger.error("core:onMessage packet error",t.raw.sid+"_"+t.raw.cid+", ser:"+r+",",t.error),!t.notFound)return"heartbeat"!==t.cmd&&("debug"===this.options.debugLevel?this.logger.debug("imsocket::recvCmd ser:"+r,t.cmd,t.content):this.logger.log("imsocket::recvCmd ser:"+r,t.cmd)),t.__receiveTime=Zc(),t;this.logger.warn("core::onMessage packet not found",t.raw.sid+"_"+t.raw.cid+", ser:"+r)}},r.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("packet "+e+", "+r+" is invalid:",t),i[1](t)}},r.markAllCmdInvaild=function(e){var t;this.logger.log("markAllCmdInvaild"),so(t=this.sendingCmdMap).call(t,(function(t){var r=t.callback,n=t.timer;n&&clearTimeout(n),r[1](e)})),this.sendingCmdMap.clear()},r.ping=function(){return vc(this,void 0,void 0,Ya.mark((function e(){var t=this;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this.pingTimer),e.prev=1,e.next=4,this.sendCmd("heartbeat");case 4:e.next=14;break;case 6:return e.prev=6,e.t0=e.catch(1),e.next=10,this.testHeartBeat5Timeout();case 10:if(!e.sent){e.next=14;break}return this.doDisconnect(lm.OFFLINE,"PingError"),e.abrupt("return");case 14:this.pingTimer=Jc((function(){t.ping()}),3e4);case 15:case"end":return e.stop()}}),e,this,[[1,6]])})))},r.testHeartBeat5Timeout=function(){return vc(this,void 0,void 0,Ya.mark((function e(){var t;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.debug("core:: test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},r.initOnlineListener=function(){var e,t;this.onlineListener||(pm?(this.onlineListener=Jt(e=function(){"logined"===this.status&&this.ping()}).call(e,this),this.offlineListener=Jt(t=function(){this.logger.log("offline"),this.doDisconnect(lm.OFFLINE,"OfflineListener")}).call(t,this),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)):this.logger.warn("initOnlineListener not support add listener"))},r.destroyOnlineListener=function(){this.onlineListener&&(window.removeEventListener("online",this.onlineListener),this.onlineListener=void 0),this.offlineListener&&(window.removeEventListener("offline",this.offlineListener),this.offlineListener=void 0)},r.disconnect=function(){switch(this.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(lm.ACTIVE,"UserActiveDisconnect"),La.resolve();case"unconnected":case"destroyed":return La.resolve()}},r.destroy=function(){var e=this;return this.disconnect().then((function(){e.status="destroyed",e.removeAllListeners(),e.eventBus.removeAllListeners(),e.reporter.destroy(),e.connect=function(){return La.resolve()},e.disconnect=function(){return La.resolve()},e.destroy=function(){return La.resolve()}}))},t}(eu);mm.setAdapters=function(e){oc(pl,e)};var fm={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"multiPortLogin","2_8":"kick"},hm={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,session:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,sdkType:41,userAgent:42,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,connectionId:102,ip:103,time:109},aosPushInfo:{pushType:110,hasTokenPreviously:111}},gm=Cl(hm),vm={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:hm.login}],response:[{type:"Property",name:"loginRes",reflectMapper:gm.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:gm.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:gm.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Number",name:"clientType"},{type:"Number",name:"reason"},{type:"String",name:"ext"},{type:"Number",name:"customClientType"}]},multiPortLogin:{sid:2,cid:7,service:"auth",response:[{type:"Number",name:"state"},{type:"PropertyArray",name:"loginPorts",reflectMapper:gm.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}},ym={debugLevel:"off",needReconnect:!0,reconnectionAttempts:Xa,lbsUrls:["https://lbs.netease.im/lbs/webconf.jsp"],linkUrl:Su},bm={},Sm=function(e){function t(r,n){var i,s;void 0===n&&(n={serverConfig:{},syncOptions:{},sessionConfig:{}}),(s=e.call(this,r,n.serverConfig)||this).instanceName="NIM",s.account="",s.options={},s.auth={},s.sync={},s.msg={},s.msgLog={},s.session={},s.cloudSession={},s.misc={},s.user={},s.friend={},s.systemMessage={},s.team={},s.event={},s.msgExtend={},s.cloudStorage={},s.passThrough={},s.superTeam={},s.plugin={},s.signaling={},s.setOptions(r),El({cmdMap:fm,cmdConfig:vm});var a=null;return so(i=ec(bm)).call(i,(function(e){var t=bm[e];"sync"===e?a=t:s[e]="session"===e?new t(o(s),n.sessionConfig):"cloudStorage"===e?new t(o(s),s.instanceName):new t(o(s))})),a&&(s.sync=new a(o(s),n.syncOptions)),s.eventBus.on("willReconnect",(function(){s.reporter.reportTraceStart("login",{user_id:s.account,action:"auto_login"})})),n&&s.setOtherOptions(n),t.instance=o(s),s}Qt(t,e),t.getInstance=function(e,r){if(!t.instance){if(e)return new t(e,r);throw new Error("Instance not exist, please input options")}if(e){if(t.instance.options.account===e.account&&t.instance.options.appkey===e.appkey)return t.instance.setOptions(e),r&&t.instance.setOtherOptions(r),t.instance;throw new Error("Unexpected login")}return t.instance};var r=t.prototype;return r.setOptions=function(e){mp({account:{type:"string"},appkey:{type:"string"},token:{type:"string"},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.logger.log("NIM::setOptions options is",e),this.account=e.account,this.options=oc(oc({},ym),e)},r.setOtherOptions=function(e){var t;e.serverConfig&&mp({commonUploadHost:{type:"string",required:!1},chunkUploadHost:{type:"string",required:!1},uploadReplaceFormat:{type:"string",required:!1},downloadUrl:{type:"string",required:!1},downloadHostList:{type:"string",required:!1},nosCdnEnable:{type:"boolean",required:!1}},e.serverConfig),(null===(t=null==e?void 0:e.cloudStorageConfig)||void 0===t?void 0:t.s3)&&this.cloudStorage.setS3(e.cloudStorageConfig.s3)},r.connect=function(t){void 0===t&&(t={});var r=Pt(null,{connect:{get:function(){return e.prototype.connect}}});return vc(this,void 0,void 0,Ya.mark((function e(){var n;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.status)){e.next=4;break}return n="NIM status is "+this.status+", and would not connect",this.logger.warn(n),e.abrupt("return",La.reject(n));case 4:return e.next=6,this.getLbsInfos();case 6:return e.next=8,r.connect.call(this);case 8:return e.next=10,this.login(t.isAutoReconnect);case 10:case"end":return e.stop()}}),e,this)})))},r.login=function(e){return void 0===e&&(e=!1),vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.auth.doLogin(e);case 3:r=t.sent,this.reporter.reportTraceUpdate("login",{operation_type:"protocol",target:"2-2"}),this.reporter.reportTraceEnd("login"),this.status="logined",t.next=19;break;case 9:if(t.prev=9,t.t0=t.catch(0),this.logger.warn("nim login:: login failed",t.t0),this.reporter.reportTraceUpdate("login",{operation_type:"protocol",error:t.t0},!1),this.reporter.reportTraceEnd("login",1),0!==this.retryCount){t.next=17;break}throw this.doDisconnect(lm.ACTIVE,"FailedToInitializeLogin"),t.t0;case 17:return this.doDisconnect(lm.OFFLINE,"ReconnectLoginFailed"),t.abrupt("return");case 19:return t.prev=19,t.next=22,this.cloudStorage.init();case 22:t.next=27;break;case 24:t.prev=24,t.t1=t.catch(19),this.logger.error("NIM:login cloudStorage init failed ",t.t1);case 27:if(this.eventBus.emit("logined",r),this.emit("logined",r),this.logger.log("login done"),this.resetConnectStatus(),!this.sync||!this.sync.doSync){t.next=34;break}return t.next=34,this.sync.doSync();case 34:if(!this.misc||!this.misc.getNosCdnHost){t.next=37;break}return t.next=37,this.misc.getNosCdnHost();case 37:this.ping();case 38:case"end":return t.stop()}}),t,this,[[0,9],[19,24]])})))},r.onMessage=function(t){var r,n,i=e.prototype.onMessage.call(this,t);if(i){var o=i.raw.ser,s=this.sendingCmdMap.get(o);if(s&&s.cmd===i.cmd){var a=s.callback,c=s.timer,u=s.params;if(clearTimeout(c),i.params=u,this.sendingCmdMap.delete(o),"heartbeat"===i.cmd)return void a[0]();var l=null===(r=this[i.service])||void 0===r?void 0:r.process(i);l&&"function"==typeof l.then?l.then((function(e){a[0](e)})).catch((function(e){a[1](e)})):(this.logger.log("imsocket:: handlerFn without promise",i.service,i.cmd),a[0]())}else null===(n=this[i.service])||void 0===n||n.process(i)}},r.getLbsInfos=function(){return vc(this,void 0,void 0,Ya.mark((function e(){var t,r,n,i,o,s,a,c;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pl.request,r=this.options.lbsUrls[0],n=pc(r).call(r,"?")>-1?"&":"?",i=r+n+"k="+this.options.appkey+"&id="+this.options.account+"&sv=180&pv=1&networkType=0",e.prev=4,this.logger.log("getLbsInfos ",i),e.next=8,t(i,{method:"GET",dataType:"json",timeout:1e4});case 8:if(200===(a=e.sent).status&&a.data){e.next=12;break}throw this.logger.error("getLbsInfos::error status",a.status,a),new Error("getLbsInfos failed, status "+a.status);case 12:this.reporter.reportTraceUpdate("login",{operation_type:"HTTP",target:i}),c=a.data.common,this.linkUrls=hc(o=c.link).call(o,c["link.default"]),this.config.chunkUploadHost=a.data["nos-chunk"],this.logger.log("getLbsInfos success, socket link:",Ja(s=this.linkUrls).call(s,0),"chunkUploadHost: ",this.config.chunkUploadHost),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(4),this.logger.error("getLbsInfos::error",e.t0&&e.t0.message,e.t0),this.linkUrls=[this.options.linkUrl],this.reporter.reportTraceUpdate("login",{operation_type:"HTTP",target:i},!1);case 24:case"end":return e.stop()}}),e,this,[[4,19]])})))},r.disconnect=function(){var t=this;switch(this.status){case"connected":case"logined":return this.sendCmd("logout").then((function(){e.prototype.doDisconnect.call(t,lm.ACTIVE,"UserActiveDisconnect")}));case"connecting":case"waitReconnect":return e.prototype.doDisconnect.call(this,lm.ACTIVE,"UserActiveDisconnect"),La.resolve();case"unconnected":case"destroyed":return La.resolve()}},r.destroy=function(){return t.instance=null,e.prototype.destroy.call(this)},r.kick=function(e){return mp({deviceIds:{type:"array",itemType:"string"}},e),this.auth.kick(e)},t.registerService=function(e,t){bm[t]=e},t}(mm);Sm.instance=null;var Tm=Math.min,_m=[].lastIndexOf,wm=!!_m&&1/[1].lastIndexOf(1,-0)<0,Mm=eo("lastIndexOf"),xm=wm||!Mm?function(e){if(wm)return m(_m,this,arguments)||0;var t=L(this),r=pt(t),n=r-1;for(arguments.length>1&&(n=Tm(n,at(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:_m;nt({target:"Array",proto:!0,forced:xm!==[].lastIndexOf},{lastIndexOf:xm});var Em,Cm,Rm,km,Am,Im=qt("Array").lastIndexOf,Om=Array.prototype,Pm=function(e){var t=e.lastIndexOf;return e===Om||V(Om,e)&&t===Om.lastIndexOf?Im:t},Nm=r((function(t,r){(function(){var n={function:!0,object:!0}[typeof window]&&window||this,i=r,o=t&&!t.nodeType&&t,s=i&&o&&"object"==typeof e&&e;!s||s.global!==s&&s.window!==s&&s.self!==s||(n=s);var a=Math.pow(2,53)-1,c=/\bOpera/,u=Object.prototype,l=u.hasOwnProperty,d=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function m(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function f(e,t){for(var r in e)l.call(e,r)&&t(e[r],r,e)}function h(e){return null==e?p(e):d.call(e).slice(8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function v(e,t){var r=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=a)for(;++r<n;)t(e[r],r,e);else f(e,t)}(e,(function(n,i){r=t(r,n,i,e)})),r}function y(e){return String(e).replace(/^ +| +$/g,"")}var b=function e(t){var r=n,i=t&&"object"==typeof t&&"String"!=h(t);i&&(r=t,t=null);var o=r.navigator||{},s=o.userAgent||"";t||(t=s);var a,u,l=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(d.toString()),p="Object",b=i?p:"ScriptBridgingProxyObject",S=i?p:"Environment",T=i&&r.java?"JavaPackage":h(r.java),_=i?p:"RuntimeObject",w=/\bJava/.test(T)&&r.java,M=w&&h(r.environment)==S,x=w?"a":"α",E=w?"b":"β",C=r.document||{},R=r.operamini||r.opera,k=c.test(k=i&&R?R["[[Class]]"]:h(R))?k:R=null,A=t,I=[],O=null,P=t==s,N=P&&R&&"function"==typeof R.version&&R.version(),D=function(e){return v(e,(function(e,r){return e||RegExp("\\b"+(r.pattern||g(r))+"\\b","i").exec(t)&&(r.label||r)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),L=function(e){return v(e,(function(e,r){return e||RegExp("\\b"+(r.pattern||g(r))+"\\b","i").exec(t)&&(r.label||r)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),j=$([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(e){return v(e,(function(e,r,n){return e||(r[j]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(j)]||RegExp("\\b"+g(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),F=function(e){return v(e,(function(e,r){var n=r.pattern||g(r);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),m(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,r.label||r)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function $(e){return v(e,(function(e,r){var n=r.pattern||g(r);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=m(e[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function B(e){return v(e,(function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(D&&(D=[D]),/\bAndroid\b/.test(F)&&!j&&(a=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(j=y(a[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),U&&!j?j=$([U]):U&&j&&(j=j.replace(RegExp("^("+g(U)+")[-_.\\s]","i"),U+" ").replace(RegExp("^("+g(U)+")[-_.]?(\\w)","i"),U+" $2")),(a=/\bGoogle TV\b/.exec(j))&&(j=a[0]),/\bSimulator\b/i.test(t)&&(j=(j?j+" ":"")+"Simulator"),"Opera Mini"==L&&/\bOPiOS\b/.test(t)&&I.push("running in Turbo/Uncompressed mode"),"IE"==L&&/\blike iPhone OS\b/.test(t)?(U=(a=e(t.replace(/like iPhone OS/,""))).manufacturer,j=a.product):/^iP/.test(j)?(L||(L="Safari"),F="iOS"+((a=/ OS ([\d_]+)/i.exec(t))?" "+a[1].replace(/_/g,"."):"")):"Konqueror"==L&&/^Linux\b/i.test(F)?F="Kubuntu":U&&"Google"!=U&&(/Chrome/.test(L)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(j))||/\bAndroid\b/.test(F)&&/^Chrome/.test(L)&&/\bVersion\//i.test(t)?(L="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==L?(/\bMobi/i.test(t)||(F="Android",I.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&I.unshift("accelerated")):"UC Browser"==L&&/\bUCWEB\b/.test(t)?I.push("speed mode"):"PaleMoon"==L&&(a=/\bFirefox\/([\d.]+)\b/.exec(t))?I.push("identifying as Firefox "+a[1]):"Firefox"==L&&(a=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(F||(F="Firefox OS"),j||(j=a[1])):!L||(a=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(L))?(L&&!j&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(a+"/")+8))&&(L=null),(a=j||U||F)&&(j||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(L=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:a)+" Browser")):"Electron"==L&&(a=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&I.push("Chromium "+a),N||(N=B(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",g(L),"(?:Firefox|Minefield|NetFront)"])),(a=("iCab"==D&&parseFloat(N)>3?"WebKit":/\bOpera\b/.test(L)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(D)&&"WebKit"||!D&&/\bMSIE\b/i.test(t)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==D&&/\bPlayStation\b(?! Vita\b)/i.test(L)&&"NetFront")&&(D=[a]),"IE"==L&&(a=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(L+=" Mobile",F="Windows Phone "+(/\+$/.test(a)?a:a+".x"),I.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(L="IE Mobile",F="Windows Phone 8.x",I.unshift("desktop mode"),N||(N=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=L&&"Trident"==D&&(a=/\brv:([\d.]+)/.exec(t))&&(L&&I.push("identifying as "+L+(N?" "+N:"")),L="IE",N=a[1]),P){if(function(e,t){var r=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!e[t])}(r,"global"))if(w&&(A=(a=w.lang.System).getProperty("os.arch"),F=F||a.getProperty("os.name")+" "+a.getProperty("os.version")),M){try{N=r.require("ringo/engine").version.join("."),L="RingoJS"}catch(t){(a=r.system)&&a.global.system==r.system&&(L="Narwhal",F||(F=a[0].os||null))}L||(L="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(a=r.process)&&("object"==typeof a.versions&&("string"==typeof a.versions.electron?(I.push("Node "+a.versions.node),L="Electron",N=a.versions.electron):"string"==typeof a.versions.nw&&(I.push("Chromium "+N,"Node "+a.versions.node),L="NW.js",N=a.versions.nw)),L||(L="Node.js",A=a.arch,F=a.platform,N=(N=/[\d.]+/.exec(a.version))?N[0]:null));else h(a=r.runtime)==b?(L="Adobe AIR",F=a.flash.system.Capabilities.os):h(a=r.phantom)==_?(L="PhantomJS",N=(a=a.version||null)&&a.major+"."+a.minor+"."+a.patch):"number"==typeof C.documentMode&&(a=/\bTrident\/(\d+)/i.exec(t))?(N=[N,C.documentMode],(a=+a[1]+4)!=N[1]&&(I.push("IE "+N[1]+" mode"),D&&(D[1]=""),N[1]=a),N="IE"==L?String(N[1].toFixed(1)):N[0]):"number"==typeof C.documentMode&&/^(?:Chrome|Firefox)\b/.test(L)&&(I.push("masking as "+L+" "+N),L="IE",N="11.0",D=["Trident"],F="Windows");F=F&&m(F)}if(N&&(a=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(N)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(P&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(O=/b/i.test(a)?"beta":"alpha",N=N.replace(RegExp(a+"\\+?$"),"")+("beta"==O?E:x)+(/\d+\+?/.exec(a)||"")),"Fennec"==L||"Firefox"==L&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(F))L="Firefox Mobile";else if("Maxthon"==L&&N)N=N.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(j))"Xbox 360"==j&&(F=null),"Xbox 360"==j&&/\bIEMobile\b/.test(t)&&I.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(L)&&(!L||j||/Browser|Mobi/.test(L))||"Windows CE"!=F&&!/Mobi/i.test(t))if("IE"==L&&P)try{null===r.external&&I.unshift("platform preview")}catch(t){I.unshift("embedded")}else(/\bBlackBerry\b/.test(j)||/\bBB10\b/.test(t))&&(a=(RegExp(j.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||N)?(F=((a=[a,/BB10/.test(t)])[1]?(j=null,U="BlackBerry"):"Device Software")+" "+a[0],N=null):this!=f&&"Wii"!=j&&(P&&R||/Opera/.test(L)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==L&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==L&&(F&&!/^Win/.test(F)&&N>5.5||/\bWindows XP\b/.test(F)&&N>8||8==N&&!/\bTrident\b/.test(t)))&&!c.test(a=e.call(f,t.replace(c,"")+";"))&&a.name&&(a="ing as "+a.name+((a=a.version)?" "+a:""),c.test(L)?(/\bIE\b/.test(a)&&"Mac OS"==F&&(F=null),a="identify"+a):(a="mask"+a,L=k?m(k.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(a)&&(F=null),P||(N=null)),D=["Presto"],I.push(a));else L+=" Mobile";(a=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(a=[parseFloat(a.replace(/\.(\d)$/,".0$1")),a],"Safari"==L&&"+"==a[1].slice(-1)?(L="WebKit Nightly",O="alpha",N=a[1].slice(0,-1)):N!=a[1]&&N!=(a[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(N=null),a[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==a[0]&&537.36==a[2]&&parseFloat(a[1])>=28&&"WebKit"==D&&(D=["Blink"]),P&&(l||a[1])?(D&&(D[1]="like Chrome"),a=a[1]||((a=a[0])<530?1:a<532?2:a<532.05?3:a<533?4:a<534.03?5:a<534.07?6:a<534.1?7:a<534.13?8:a<534.16?9:a<534.24?10:a<534.3?11:a<535.01?12:a<535.02?"13+":a<535.07?15:a<535.11?16:a<535.19?17:a<536.05?18:a<536.1?19:a<537.01?20:a<537.11?"21+":a<537.13?23:a<537.18?24:a<537.24?25:a<537.36?26:"Blink"!=D?"27":"28")):(D&&(D[1]="like Safari"),a=(a=a[0])<400?1:a<500?2:a<526?3:a<533?4:a<534?"4+":a<535?5:a<537?6:a<538?7:a<601?8:a<602?9:a<604?10:a<606?11:a<608?12:"12"),D&&(D[1]+=" "+(a+="number"==typeof a?".x":/[.+]/.test(a)?"":"+")),"Safari"==L&&(!N||parseInt(N)>45)?N=a:"Chrome"==L&&/\bHeadlessChrome/i.test(t)&&I.unshift("headless")),"Opera"==L&&(a=/\bzbov|zvav$/.exec(F))?(L+=" ",I.unshift("desktop mode"),"zvav"==a?(L+="Mini",N=null):L+="Mobile",F=F.replace(RegExp(" *"+a+"$"),"")):"Safari"==L&&/\bChrome\b/.exec(D&&D[1])?(I.unshift("desktop mode"),L="Chrome Mobile",N=null,/\bOS X\b/.test(F)?(U="Apple",F="iOS 4.3+"):F=null):/\bSRWare Iron\b/.test(L)&&!N&&(N=B("Chrome")),N&&0==N.indexOf(a=/[\d.]+$/.exec(F))&&t.indexOf("/"+a+"-")>-1&&(F=y(F.replace(a,""))),F&&-1!=F.indexOf(L)&&!RegExp(L+" OS").test(F)&&(F=F.replace(RegExp(" *"+g(L)+" *"),"")),D&&!/\b(?:Avant|Nook)\b/.test(L)&&(/Browser|Lunascape|Maxthon/.test(L)||"Safari"!=L&&/^iOS/.test(F)&&/\bSafari\b/.test(D[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(L)&&D[1])&&(a=D[D.length-1])&&I.push(a),I.length&&(I=["("+I.join("; ")+")"]),U&&j&&j.indexOf(U)<0&&I.push("on "+U),j&&I.push((/^on /.test(I[I.length-1])?"":"on ")+j),F&&(a=/ ([\d.+]+)$/.exec(F),u=a&&"/"==F.charAt(F.length-a[0].length-1),F={architecture:32,family:a&&!u?F.replace(a[0],""):F,version:a?a[1]:null,toString:function(){var e=this.version;return this.family+(e&&!u?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(a=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(A))&&!/\bi686\b/i.test(A)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+a),"")),L&&(/\bWOW64\b/i.test(t)||P&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&I.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==L&&parseFloat(N)>=39&&(F.architecture=64),t||(t=null);var V={};return V.description=t,V.layout=D&&D[0],V.manufacturer=U,V.name=L,V.prerelease=O,V.product=j,V.ua=t,V.version=L&&N,V.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}},V.parse=e,V.toString=function(){return this.description||""},V.version&&I.unshift(N),V.name&&I.unshift(L),F&&L&&(F!=String(F).split(" ")[0]||F!=L.split(" ")[0]&&!j)&&I.push(j?"("+F+")":"on "+F),I.length&&(V.description=I.join(" ")),V}();i&&o?f(b,(function(e,t){i[t]=e})):n.platform=b}).call(e)})),Dm=r((function(e,t){e.exports=function(){var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return T}});var r=function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=2,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.onError=function(e){},this.onProgress=function(e){},this.onComplete=function(e){},t)this[r]=t[r]};function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o=window.localStorage;window.localStorage&&"function"==typeof window.localStorage.getItem&&"function"==typeof window.localStorage.setItem&&"function"==typeof window.localStorage.removeItem||(o={privateObj:{},setItem:function(e,t){o.privateObj[e]=t},getItem:function(e){return o.privateObj[e]},removeItem:function(e){delete o.privateObj[e]},getKeys:function(){return Object.keys(o.privateObj)}});var s={getFileKey:function(e){var t=e.size.toString(),r=e.lastModified.toString();return e.name+t.slice(t.length-5)+r.slice(r.length-5)},getFileInfo:function(e){var t=o.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}},initFile:function(e,t){s.clearExpiredInfo();var r=this.getFileKey(t),n={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:Date.now(),end:!1};return e.payload&&(n.payload=e.payload),o.setItem(r,JSON.stringify(n)),r},setUploadContext:function(e,t){var r=this.getFileInfo(e);r&&(r.ctx=t,o.setItem(e,JSON.stringify(r)))},setComplete:function(e){var t=this.getFileInfo(e);t&&(t.modifyAt=Date.now(),t.end=!0,o.setItem(e,JSON.stringify(t)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){o.removeItem(e)},clearExpiredInfo:function(){var e,t="function"==typeof o.getKeys?o.getKeys():Object.keys(o),r=Date.now(),i=[],a=n(t);try{for(a.s();!(e=a.n()).done;){var c=e.value,u=s.getFileInfo(c);null===u||r-u.modifyAt>T.expireTime?o.removeItem(c):i.push({fileInfo:u,key:c})}}catch(e){a.e(e)}finally{a.f()}if(i.length>T.maxFileCache){var l,d=n(i.sort((function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt})).slice(T.maxFileCache));try{for(d.s();!(l=d.n()).done;){var p=l.value;o.removeItem(p.key)}}catch(e){d.e(e)}finally{d.f()}}}},a=s;function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return d(e,arguments,f(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),m(n,e)})(e)}function d(e,t,r){return(d=p()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&m(i,r.prototype),i}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(i,e);var t,r,n=(t=i,r=p(),function(){var e,n=f(t);if(r){var i=f(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return u(this,e)});function i(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=n.call(this,"NosUploadError:"+e)).errCode=t,r.errMsg=e,r}return i}(l(Error)),g=function e(t,r,n){if("uploading"===t.uploadState){var i=t.config,o=t.param,s=a.getUploadContext(t.fileKey);if(!s)return n(0);var c=new XMLHttpRequest,u=i.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName))+"?uploadContext"+"&context=".concat(s)+"&version=".concat(i.version);c.onreadystatechange=function(){if("abort"!==t.uploadState&&4===c.readyState){var o;try{o=JSON.parse(c.responseText)}catch(e){o={errMsg:"JsonParseError in getOffset",errCode:500}}200===c.status?o.errCode?t.config.onError(new h(o.errMsg,o.errCode)):n(o.offset):c.status.toString().match(/^5/)?e(t,r-1,n):(a.removeFileInfo(t.fileKey),c.status?i.onError(new h("getOffset(".concat(u,") error: ").concat(c.status," ").concat(c.statusText))):i.onError(new h("getOffset(".concat(u,") error. no Error Code"))))}},c.open("get",u),c.setRequestHeader("x-nos-token",o.token),c.timeout=i.getOffsetTimeout,c.send()}},v=function e(t,r,n,i){if("uploading"===t.uploadState){var o=t.param,s=t.config,c=File.prototype.slice,u=void 0!==o.ctx?o.ctx:"",l=r+s.trunkSize>t.file.size,d=l?t.file.size:r+s.trunkSize,p=new XMLHttpRequest,m=s.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName));if(p.upload.onprogress=function(e){var n=0;e.lengthComputable?(n=(r+e.loaded)/t.file.size,s.onProgress(n)):s.onError(new h("browser does not support query upload progress"))},p.onreadystatechange=function(){if("abort"!==t.uploadState&&4===p.readyState){var o;try{o=JSON.parse(p.responseText)}catch(e){console.error("JsonParseError in uploadTrunk",e),o={errMsg:"JsonParseError in uploadTrunk"}}200===p.status?(t.setContext(o.context),l?(i(),t.setComplete()):e(t,o.offset,s.retryCount,i)):p.status.toString().match(/^5/)?n>0?e(t,r,n-1,i):(a.removeFileInfo(t.fileKey),s.onError(new h(o.errMsg,o.errCode))):p.status?(a.removeFileInfo(t.fileKey),s.onError(new h("uploadTrunk(".concat(m,") error: ").concat(p.status," ").concat(p.statusText)))):(console.log("upload is paused",p),s.onError(new h("uploadTrunk(".concat(m,") error. no Error Code"))))}},p.open("post",m+"?offset=".concat(r)+"&complete=".concat(l)+"&context=".concat(u)+"&version=".concat(s.version)),p.setRequestHeader("x-nos-token",o.token),t.file.type&&p.setRequestHeader("content-type",t.file.type),p.timeout=s.trunkUploadTimeout,"undefined"!=typeof FileReader){var f=new FileReader;f.addEventListener("load",(function(e){var t;(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)?p.send(e.target.result):s.onError(new h("Read ArrayBuffer failed"))})),f.addEventListener("error",(function(e){var t=e.target.error;s.onError(new h("Read ArrayBuffer error. ".concat(t.toString()),t.code))})),f.readAsArrayBuffer(c.call(t.file,r,d))}else p.send(c.call(t.file,r,d))}};function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var b=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=n,this.file=t,this.param=r,this.fileKey=a.initFile(r,t),this.resume()}var t;return(t=[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;g(this,t.retryCount,(function(r){v(e,r,t.retryCount,(function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.setUploadState("abort"),a.removeFileInfo(this.fileKey)}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){a.setUploadContext(this.fileKey,e),this.param.ctx=e}},{key:"setComplete",value:function(){a.setComplete(this.fileKey),this.setUploadState("ended")}}])&&y(e.prototype,t),e}(),S={maxFileCache:6,expireTime:864e5,getFileUploadInformation:function(e){var t=a.getFileKey(e),r=a.getFileInfo(t);return null===r?null:Date.now()-r.modifyAt>S.expireTime?(a.removeFileInfo(t),null):{uploadInfo:Object.assign({bucketName:r.bucket,objectName:r.obj,token:r.token,ctx:r.ctx},r.payload?{payload:r.payload}:{}),complete:r.end}},setMaxFileCache:function(e){S.maxFileCache=e},setExpireTime:function(e){S.expireTime=e},printCaches:function(){for(var e=0,t=Object.keys(localStorage);e<t.length;e++){var r=t[e],n=a.getFileInfo(r);n&&console.log(n,"modifiedAt",new Date(n.modifyAt).toTimeString())}},createConfig:function(e){return new r(e)},createTask:function(e,t,r){return new b(e,t,r)}},T=S;return t.default}()})),Lm=r((function(e,t){e.exports=function(){const e=5e3;function t(e){if(e){let t="";return Object.entries(e).forEach((([e,r],n)=>{t+=0===n?"?":"&",t+=`${e}=${r}`})),t}return""}function r(t,r){return new Promise(((n,i)=>{setTimeout((()=>{i({message:"request timeout",params:r})}),t||e)}))}function n(n,i={dataType:"json",method:"GET",timeout:e}){const o="text"===i.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8";let s="GET"===i.method?t(i.params):"";return Promise.race([r(i.timeout,{url:n,params:i}),new Promise((function(e,t){if(window.fetch&&"function"==typeof window.fetch)try{let r={method:i.method,headers:Object.assign({"Content-Type":o},i.headers)};"POST"===i.method&&(r.body=JSON.stringify(i.params)),fetch(`${n}${s}`,r).then((r=>{"text"!==i.dataType?r.json().then((t=>{r.data=t,e(r)}),t):r.text().then((t=>{r.data=t,e(r)}),t)}),t)}catch(e){t(e)}else if(window.XMLHttpRequest){const r=new XMLHttpRequest;let a;if(r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){try{a=JSON.parse(r.response||"{}")}catch(e){a=r.response}e({status:r.status,data:a})}else t(r.status)},r.open(i.method,`${n}${s}`),r.setRequestHeader("Content-Type",o),i.headers)for(let e in i.headers)r.setRequestHeader(e,i.headers[e]);r.send(JSON.stringify(i.params))}else t("request no suppout")}))])}return n}()})),jm=console,Um={setLogger:function(e){jm=e},platform:"BROWSER",localStorage:window.localStorage,request:Lm,WebSocket:window.WebSocket,uploadFile:function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.fileInput||e.file){t.next=2;break}throw new Error("File not exist");case 2:if(!e.file){t.next=6;break}o=e.file,t.next=20;break;case 6:if("string"!=typeof e.fileInput){t.next=15;break}if(!((s=document.getElementById(e.fileInput))&&s.files&&s.files[0])){t.next=12;break}o=s.files[0],t.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:t.next=20;break;case 15:if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0])){t.next=19;break}o=e.fileInput.files[0],t.next=20;break;case 19:throw new Error("Can not get file from fileInput "+e.fileInput);case 20:if(!(e.maxSize&&o.size>e.maxSize)){t.next=22;break}throw new Error("The file exceeds maxSize limit. maxSize: "+e.maxSize+", get "+o.size);case 22:return t.next=24,new La((function(t,r){var n=Dm.createConfig({directUploadAddr:e.chunkUploadHost,onError:function(e){r(e)},onProgress:e.onUploadProgress||function(){},onComplete:function(e){t(e)}}),i=Dm.createTask(o,{bucketName:e.nosToken.bucket,objectName:decodeURIComponent(e.nosToken.objectName),token:e.nosToken.token},n);try{e.onUploadStart&&e.onUploadStart(i)}catch(e){jm.error("Adapter uploadFile: options.onUploadStart error",e&&e.message),i.abort(),r(e)}}));case 24:return(a=t.sent).name=o.name,a.size=o.size,a.type=o.type,a.ext=Pm(r=a.name).call(r,".")>-1?Ja(n=a.name).call(n,Pm(i=a.name).call(i,".")+1).toLowerCase():"",t.abrupt("return",a);case 30:case"end":return t.stop()}}),t)})))},getSystemInfo:function(){return{os:Nm.os?Nm.os.toString():"",browser:Nm.name+" "+Nm.version}}},Fm=function(){function e(e,t){this.name=e,this.core=t,this.name=e,this.logger=t.logger,this.core=t}return e.prototype.process=function(e){var t=this[e.cmd+"Handler"];return"function"==typeof t?t.call(this,e):e.error&&!e.error.ignore?La.reject(e.error):La.resolve(e)},e}();!function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(Em||(Em={})),function(e){e[e.p2p=0]="p2p",e[e.team=1]="team",e[e.superTeam=5]="superTeam"}(Cm||(Cm={})),function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac"}(Rm||(Rm={})),function(e){e[e.unread=1]="unread",e[e.read=2]="read",e[e.deleted=3]="deleted",e[e.sending=4]="sending",e[e.sendFailed=5]="sendFailed",e[e.sent=6]="sent",e[e.receipt=7]="receipt",e[e.refused=10]="refused"}(km||(km={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(Am||(Am={}));var $m=function(e,t){return function(r){return e(t(r))}},Bm=$m(Object.getPrototypeOf,Object),Vm=Function.prototype,Hm=Object.prototype,Wm=Vm.toString,qm=Hm.hasOwnProperty,zm=Wm.call(Object),Gm=function(e){if(!Vl(e)||"[object Object]"!=hu(e))return!1;var t=Bm(e);if(null===t)return!0;var r=qm.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Wm.call(r)==zm};function Jm(e,t){if(!Gm(t))return{};var r=JSON.parse(Qc(t)),n=Km(e,r);return JSON.parse(Qc(oc(oc({},r),n)))}function Km(e,t){if(!Gm(t))return{};var r={},n=ec(e);return so(n).call(n,(function(n){var i=e[n].type;if("string"!=typeof i){var o=Km(e[n],t);ec(o).length>0&&(r[n]=o)}else{var s=e[n],a=s.rawKey||n,c=Qm[i](t,a,s);void 0!==c&&(t[a]=void 0,r[n]=c)}})),r}var Qm={number:function(e,t){if(void 0!==e[t])return+e[t]},string:function(e,t){if(void 0!==e[t])return e[t]},boolean:function(e,t){return+e[t]>0||0!=+e[t]&&void 0},enum:function(e,t,r){return Dl(r)[e[t]]},object:function(e,t){if(void 0!==e[t])try{return JSON.parse(e[t])}catch(e){return{}}}};function Ym(e,t){if(!Gm(t))return{};var r=JSON.parse(Qc(t)),n=Xm(e,r);return JSON.parse(Qc(oc(oc({},r),n)))}function Xm(e,t){var r;if(!Gm(t))return bl(r=ec(e)).call(r,(function(t,r){return t[e[r].rawKey||r]=void 0,t}),{});var n={},i=ec(e);return so(i).call(i,(function(r){var i=e[r].type;if("string"!=typeof i){var o=Xm(e[r],t[r]);return oc(n,o),void(t[r]=void 0)}var s=e[r],a=s.rawKey||r,c=Zm[i](t,r,s);t[a]=void 0,n[a]=c})),n}var Zm={number:function(e,t){return e[t]},string:function(e,t){return e[t]},boolean:function(e,t){return!0===e[t]?1:!1===e[t]?0:void 0},enum:function(e,t,r){return Dl(r)[e[t]]},object:function(e,t){if(void 0!==e[t])try{return Qc(e[t])}catch(e){return""}}},ef=function(e){return function(t,r,n){for(var i=-1,o=Object(t),s=n(t),a=s.length;a--;){var c=s[e?a:++i];if(!1===r(o[c],c,o))break}return t}}(),tf=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},rf=function(e){return Vl(e)&&"[object Arguments]"==hu(e)},nf=Object.prototype,of=nf.hasOwnProperty,sf=nf.propertyIsEnumerable,af=rf(function(){return arguments}())?rf:function(e){return Vl(e)&&of.call(e,"callee")&&!sf.call(e,"callee")},cf=af,uf=Array.isArray,lf=function(){return!1},df=r((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,i=n&&n.exports===r?ou.Buffer:void 0,o=(i?i.isBuffer:void 0)||lf;e.exports=o})),pf=/^(?:0|[1-9]\d*)$/,mf=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&pf.test(e))&&e>-1&&e%1==0&&e<t},ff={};ff["[object Float32Array]"]=ff["[object Float64Array]"]=ff["[object Int8Array]"]=ff["[object Int16Array]"]=ff["[object Int32Array]"]=ff["[object Uint8Array]"]=ff["[object Uint8ClampedArray]"]=ff["[object Uint16Array]"]=ff["[object Uint32Array]"]=!0,ff["[object Arguments]"]=ff["[object Array]"]=ff["[object ArrayBuffer]"]=ff["[object Boolean]"]=ff["[object DataView]"]=ff["[object Date]"]=ff["[object Error]"]=ff["[object Function]"]=ff["[object Map]"]=ff["[object Number]"]=ff["[object Object]"]=ff["[object RegExp]"]=ff["[object Set]"]=ff["[object String]"]=ff["[object WeakMap]"]=!1;var hf,gf=function(e){return Vl(e)&&ap(e.length)&&!!ff[hu(e)]},vf=ql&&ql.isTypedArray,yf=vf?Wl(vf):gf,bf=Object.prototype.hasOwnProperty,Sf=function(e,t){var r=uf(e),n=!r&&cf(e),i=!r&&!n&&df(e),o=!r&&!n&&!i&&yf(e),s=r||n||i||o,a=s?tf(e.length,String):[],c=a.length;for(var u in e)!t&&!bf.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||mf(u,c))||a.push(u);return a},Tf=Object.prototype,_f=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Tf)},wf=$m(Object.keys,Object),Mf=Object.prototype.hasOwnProperty,xf=function(e){if(!_f(e))return wf(e);var t=[];for(var r in Object(e))Mf.call(e,r)&&"constructor"!=r&&t.push(r);return t},Ef=function(e){return cp(e)?Sf(e):xf(e)},Cf=function(e,t){return e&&ef(e,t,Ef)},Rf=function(e,t,r,n){return Cf(e,(function(e,i,o){t(n,r(e),i,o)})),n},kf=function(e,t){return function(r,n){return Rf(r,e,t(n),{})}},Af=Object.prototype.toString,If=kf((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Af.call(t)),e[t]=r}),tp(Yd)),Of=If({Android:1,iOS:2,PC:4,WindowsPhone:8,Web:16,Server:32,Mac:64}),Pf={p2p:0,team:1,superTeam:5};function Nf(e,t){return e&&e.length>0?Vu(e).call(e,(function(e){return oc(oc({},e),{account:e.account,connectionId:e.connectionId,deviceId:e.deviceId,ip:e.ip,mac:e.mac,os:e.os,type:Of[e.type]||e.type,time:Bp(e.time),online:3!==t})})):[]}If(Pf),function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(hf||(hf={}));var Df={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}},Lf={BROWSER:0,RN:2,UNIAPP:3,WECHAT:6},jf=function(e){function t(t){var r;return r=e.call(this,"auth",t)||this,El({cmdMap:fm,cmdConfig:vm}),r}Qt(t,e);var r=t.prototype;return r.doLogin=function(e){var t,r;return void 0===e&&(e=!1),vc(this,void 0,void 0,Ya.mark((function n(){var i,o,s,a,c,u,l,d,p,m;return Ya.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=this.core.options,o=pl.getSystemInfo(),s=oc(oc({},i),{appLogin:e?0:1,appkey:i.appkey,account:i.account,token:i.token,deviceId:this.core.config.deviceId,clientType:16,protocolVersion:1,sdkVersion:90800,sdkHumanVersion:"0.11.0",os:o.os,browser:o.browser,session:null===(t=this.core.socket)||void 0===t?void 0:t.sessionId,sdkType:Lf[pl.platform]||0,userAgent:"Native/0.11.0"}),a=o.os.toLowerCase(),"UNIAPP"!==pl.platform||"ios"!==a&&"android"!==a||(s.isReactNative=1,s.clientType="ios"===a?2:1,o.pushDeviceInfo&&o.pushDeviceInfo.MANUFACTURER&&(s.deviceInfo=Qc(o.pushDeviceInfo))),this.logger.log("auth::do login ",i.account,null===(r=this.core.socket)||void 0===r?void 0:r.sessionId),n.next=8,this.core.sendCmd("login",{login:s});case 8:if(!(c=n.sent).error){n.next=11;break}throw c.error;case 11:return u=c.content,l=u.loginRes,d=u.loginPorts,p=u.aosPushInfo,m=Nf(d,2),(m=Ep(m).call(m,(function(e){return e.connectionId!==l.connectionId}))).length>0&&this.core.emit("multiPortLogin",m),n.abrupt("return",oc(oc({},l),{aosPushInfo:p}));case 16:case"end":return n.stop()}}),n,this)})))},r.kick=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.core.sendCmd("kick",e);case 2:return n=r.sent,r.abrupt("return",null===(t=n.content)||void 0===t?void 0:t.deviceIds);case 4:case"end":return r.stop()}}),r,this)})))},r.multiPortLoginHandler=function(e){if(e.error)this.logger.error("multiPortLoginHandler:: error, ",e.error);else{var t=e.content,r=Nf(t.loginPorts,t.state);r.length>0&&this.core.emit("multiPortLogin",r)}},r.kickedHandler=function(e){if(e.error)this.logger.error("kickedHandler:: error, ",e.error);else{var t=function(e){var t=Jm({clientType:{type:"enum",values:Rm},customClientType:{type:"number"}},e),r=Df[t.reason];return oc(t,r=r||{reason:"unknow",message:"Unknown reason"})}(e.content);this.logger.warn("kicked::",t),this.core.doDisconnect(lm.KICKED,t)}},t}(Fm),Uf=Math.floor,Ff=function(e,t){var r=e.length,n=Uf(r/2);return r<8?$f(e,t):Bf(e,Ff(Lr(e,0,n),t),Ff(Lr(e,n),t),t)},$f=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},Bf=function(e,t,r,n){for(var i=t.length,o=r.length,s=0,a=0;s<i||a<o;)e[s+a]=s<i&&a<o?n(t[s],r[a])<=0?t[s++]:r[a++]:s<i?t[s++]:r[a++];return e},Vf=Ff,Hf=H.match(/firefox\/(\d+)/i),Wf=!!Hf&&+Hf[1],qf=/MSIE|Trident/.test(H),zf=H.match(/AppleWebKit\/(\d+)\./),Gf=!!zf&&+zf[1],Jf=[],Kf=y(Jf.sort),Qf=y(Jf.push),Yf=c((function(){Jf.sort(void 0)})),Xf=c((function(){Jf.sort(null)})),Zf=eo("sort"),eh=!c((function(){if(K)return K<70;if(!(Wf&&Wf>3)){if(qf)return!0;if(Gf)return Gf<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)Jf.push({k:t+n,v:r})}for(Jf.sort((function(e,t){return t.v-e.v})),n=0;n<Jf.length;n++)t=Jf[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));nt({target:"Array",proto:!0,forced:Yf||!Xf||!Zf||!eh},{sort:function(e){void 0!==e&&ne(e);var t=de(this);if(eh)return void 0===e?Kf(t):Kf(t,e);var r,n,i=[],o=pt(t);for(n=0;n<o;n++)n in t&&Qf(i,t[n]);for(Vf(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:Ir(t)>Ir(r)?1:-1}}(e)),r=pt(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)Qp(t,n++);return t}});var th=qt("Array").sort,rh=Array.prototype,nh=function(e){var t=e.sort;return e===rh||V(rh,e)&&t===rh.sort?th:t};nt({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var ih,oh=F.Number.isNaN,sh=If({none:0,normal:1,all:3}),ah={normal:0,advanced:1},ch=If(ah),uh=If({normal:0,owner:1,manager:2}),lh={noVerify:0,needVerify:1,rejectAll:2},dh=If(lh),ph={needVerify:0,noVerify:1},mh=If(ph),fh={manager:0,all:1},hh=If(fh),gh={manager:0,all:1},vh=If(gh),yh={manager:0,all:1},bh=If(yh);function Sh(e){var t,r=["teamId"],n=["level","memberNum","memberUpdateTime","createTime","updateTime"],i=["valid","validToCurrentUser","mute"],o={type:ch,muteType:sh,joinMode:dh,beInviteMode:mh,inviteMode:hh,updateTeamMode:vh,updateExtMode:bh};e.bits;var s=gc(e,["bits"]);return so(r).call(r,(function(e){s[e]&&(s[e]=s[e].toString())})),so(n).call(n,(function(e){void 0!==s[e]&&(s[e]=Bp(s[e]))})),so(i).call(i,(function(e){void 0!==s[e]&&(s[e]=1===Bp(s[e]))})),so(t=ec(o)).call(t,(function(e){void 0!==s[e]&&(s[e]=o[e][s[e]]||s[e])})),s}function Th(e){return e&&e.length>0?Vu(e).call(e,(function(e){return Sh(e)})):[]}function _h(e){var t,r=oc({},e),n=["avatar","name","intro","announcement","ext"],i={type:ah,joinMode:lh,beInviteMode:ph,inviteMode:fh,updateTeamMode:gh,updateExtMode:yh};return so(n).call(n,(function(e){void 0!==r[e]&&(r[e]=r[e].toString())})),so(t=ec(i)).call(t,(function(e){void 0!==r[e]&&(r[e]=i[e][r[e]])})),r}function wh(e){var t=["teamId","ext","account","nickInTeam"],r={};return void 0!==e.bitConfigMask&&(r.bits=Bp(e.bitConfigMask)),so(t).call(t,(function(t){e[t]&&(r[t]=e[t].toString())})),r}function Mh(e){var t,r=["teamId"],n=["joinTime","updateTime","bitConfigMask"],i=["active","valid","mute"],o={type:uh},s=e.bits,a=gc(e,["bits"]);return void 0!==s&&(a.muteTeam=1===Bp(s),a.bitConfigMask=s),a.id=a.teamId+"-"+a.account,so(r).call(r,(function(e){a[e]&&(a[e]=a[e].toString())})),so(n).call(n,(function(e){void 0!==a[e]&&(a[e]=Bp(a[e]))})),so(i).call(i,(function(e){void 0!==a[e]&&(a[e]=1===Bp(a[e]))})),so(t=ec(o)).call(t,(function(e){void 0!==a[e]&&(a[e]=o[e][a[e]]||a[e])})),a}function xh(e){return e&&e.length>0?Vu(e).call(e,(function(e){return Mh(e)})):[]}function Eh(e,t,r){return void 0===r&&(r="normal"),{id:e.teamId+"-"+t,teamId:e.teamId,account:t,type:r,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function Ch(e,t,r){return void 0===r&&(r="normal"),t&&t.length>0?Vu(t).call(t,(function(t){return Eh(e,t,r)})):[]}function Rh(e){var t=oc({},e);return t.createTime&&(t.createTime=+t.createTime),t.updateTime&&(t.updateTime=+t.updateTime),t.gender&&(t.gender=ih[+t.gender]),t}!function(e){e[e.unknown=0]="unknown",e[e.male=1]="male",e[e.female=2]="female"}(ih||(ih={}));var kh={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember"},Ah={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},Ih=Cl(Ah),Oh={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Ih.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Ih.team},{type:"Number",name:"timetag"}]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:Ah.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Ih.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Ah.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Ih.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Ah.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Ih.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:Ah.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:Ih.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Ih.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:Ah.team}],response:[{type:"Number",name:"id"},{type:"Number",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Ih.team},{type:"StrArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"String",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:Ih.teamMember},{type:"Number",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"String",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:Ih.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Ih.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:Ah.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:Ah.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"Object",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Number",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:Ih.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:Ih.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:Ih.teamMember}]}},Ph={"3_1":"updatePushToken","3_2":"updateAppBackground","3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},Nh={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},Dh=Cl(Nh),Lh={updatePushToken:{sid:3,cid:1,service:"user",params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"Int",name:"pushkit"}]},updateAppBackground:{sid:3,cid:2,service:"user",params:[{type:"Boolean",name:"isBackground"},{type:"Int",name:"badge"}]},syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:Dh.user},{type:"Number",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:Dh.relationMember},{type:"Number",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:Dh.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:Nh.user}],response:[{type:"Number",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:Dh.user}]}},jh={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:{needPush:{type:"boolean"},needPushBadge:{type:"boolean"},needPushNick:{type:"boolean"},pushApnsText:{type:"string"},pushPayload:{type:"string"}},teamSpecializationInfo:{needForcePush:{type:"boolean"},needACK:{type:"boolean"},forcePushIDsList:{type:"string"},pushContent:{type:"string"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},Uh={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function Fh(e,t){return Cm[e.scene]+"-"+(e.to===t?e.from:e.to)}function $h(e,t){var r=t.account,n=t.featureValue,i=t.statusValue,o=t.sessionAck,s=t.msgReceiptTime,a=Cm[e.scene],c=e.to===r?e.from:e.to,u=Am.default,l=km.unread;Bp(e.isInBlackList)>0?(l=km.refused,delete e.isInBlackList):l=e.from===r?s&&s>=+e.time?km.receipt:km.sent:o&&o>=+e.time?km.read:km.unread;var d=oc(oc({},Jm(jh,e)),{scene:a,type:Em[e.type],fromClientType:Rm[e.fromClientType],flow:e.from===r?"out":"in",target:c,to:e.to,from:e.from,time:e.time?+e.time:void 0,userUpdateTime:e.userUpdateTime?+e.userUpdateTime:void 0,idClient:e.idClient,sessionId:a+"-"+c,status:km[i||l],feature:Am[n||u]});if("string"==typeof d.attach)try{d.attach=JSON.parse(d.attach)}catch(e){}return"notification"===d.type&&(d.attach=d.attach?function(e){var t,r={};if(r.type=Uh[e.id]||e.id,!e.data)return r;var n,i={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},o=e.data;return so(t=ec(i)).call(t,(function(e){void 0!==o[e]&&(r[i[e]]=o[e])})),o.tinfo&&(r.team=Sh(xl(o.tinfo,Ih.team))),o.uinfos&&(r.users=Vu(n=o.uinfos).call(n,(function(e){return Rh(xl(e,Dh.user))}))),void 0!==o.mute&&(r.mute=1===Bp(o.mute)),r}(d.attach):{}),d}function Bh(e,t){return e&&e.length>0?Vu(e).call(e,(function(e){return $h(e,t)})):[]}function Vh(e,t){return Vu(e).call(e,(function(e){var r;return r=t||(oh(Bp(e.scene))?e.scene:1===Bp(e.scene)?"p2p":"team"),{deletedTime:Bp(e.time),from:e.from,idClient:e.deletedIdClient||e.idClient,idServer:e.deletedIdServer||e.idServer,scene:r,time:Bp(e.time),to:e.to}}))}var Hh=Array.prototype.reverse,Wh=function(e){return null==e?e:Hh.call(e)},qh=function(){function e(e){this.core=e}var t=e.prototype;return t.shouldSendMsgReceipt=function(e){if("p2p"===e.scene&&e.status===km[km.unread]){var t=this.core.session&&this.core.session.getSession&&this.core.session.getSession({id:e.sessionId});if(t){var r=t.msgReceiptTime;return!r||r<e.time}}return!1},t.processBroadcastMsg=function(e){var t=Vu(e).call(e,(function(e){return oc(oc({},e),{time:Bp(e.time)})}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:Vu(t).call(t,(function(e){return e.id}))}),t},e}(),zh={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},Gh={scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,pushPayload:16,pushApnsText:17,forcePushIDsList:18,pushContent:19,needForcePush:20,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needPush:107,needOffline:108,needPushBadge:109,needPushNick:110,isReplyMsg:111,ackSnapshot:112},Jh={msg:Gh,recallMsgTag:{time:0,type:1,to:2,from:3,ps:4,attach:5,apnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,opeAccount:16,env:21},deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,time:6,deletedTime:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},Kh=Cl(Jh),Qh={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:Jh.msg}],response:[{type:"Property",name:"msg",reflectMapper:Kh.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:Jh.msg}],response:[{type:"Property",name:"msg",reflectMapper:Kh.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:Jh.msg}],response:[{type:"Property",name:"msg",reflectMapper:Kh.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:Kh.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:Kh.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Kh.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Kh.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:Jh.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:Jh.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:Jh.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:Jh.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:Kh.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",isNoResponse:!0,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:Kh.msgReceiptTag},{type:"Number",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:Kh.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:Kh.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:Kh.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:Kh.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:Kh.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:Kh.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:Kh.deleteSelfMsgTag}]}},Yh=function(e){function t(t){var r;return(r=e.call(this,"msg",t)||this).service=new qh(t),El({cmdMap:zh,cmdConfig:Qh}),r}Qt(t,e);var r=t.prototype;return r.sendTextMsg=function(e){return mp({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(oc(oc({},e),{type:"text"}))},r.sendTipMsg=function(e){return mp({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(oc(oc({},e),{type:"tip"}))},r.sendGeoLocationMsg=function(e){return mp({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},e),this.sendMsg(oc(oc({},e),{type:"geo",attach:Qc(e.attach)}))},r.sendCustomMsg=function(e){return mp({attach:{type:"string",allowEmpty:!1}},e),this.sendMsg(oc(oc({},e),{type:"custom"}))},r.sendMsg=function(e){var t,r=this;mp({scene:{type:"enum",values:Hp(Cm)},type:{type:"enum",values:Hp(Em)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:{needPush:{type:"boolean",required:!1},pushApnsText:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,max:2048,required:!1}}},teamSpecializationInfo:{type:"object",required:!1,rules:{needForcePush:{type:"boolean",required:!1},needACK:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},pushContent:{type:"string",allowEmpty:!1,max:150,required:!1}}}},e);var n,i="p2p"===e.scene?"sendMsg":"team"===e.scene?"sendTeamMsg":"sendSuperTeamMsg",o=function(e,t,r,n){e.onSendBefore,e.onUploadStart,e.onUploadDone;var i=e.replyMsg,o=gc(e,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),s=oc(oc({},Ym(jh,o)),{scene:Cm[e.scene],type:Em[e.type],from:t,fromClientType:16,fromDeviceId:r,fromNick:null==n?void 0:n.nick,userUpdateTime:null==n?void 0:n.updateTime,status:km[km.sending]});if(s.idClient=s.resendFlag?e.idClient:Vp(),!s.idClient)throw new ol("idClient is required to resend a message","idClient","required");return s.scene===Cm.team&&s.needForcePush&&(s.pushContent=s.pushContent||s.pushApnsText,s.forcePushIDsList=s.forcePushIDsList?s.forcePushIDsList:"#%@all@%#"),i&&(s.replyMsgFromAccount=i.from,s.replyMsgToAccount=i.to,s.replyMsgTime=+i.time,s.replyMsgIdServer=i.idServer,s.replyMsgIdClient=i.idClient,s.threadMsgFromAccount=i.from,s.threadMsgToAccount=i.to,s.threadMsgTime=+i.time,s.threadMsgIdServer=i.idServer,s.threadMsgIdClient=i.idClient,i.threadMessageInfo&&i.threadMessageInfo.threadMsgIdServer&&(s.threadMsgFromAccount=i.threadMessageInfo.threadMsgFromAccount,s.threadMsgToAccount=i.threadMessageInfo.threadMsgToAccount,s.threadMsgTime=i.threadMessageInfo.threadMsgTime,s.threadMsgIdServer=i.threadMessageInfo.threadMsgIdServer,s.threadMsgIdClient=i.threadMessageInfo.threadMsgIdClient)),s}(e,this.core.account,this.core.config.deviceId,null===(t=this.core.user)||void 0===t?void 0:t.myInfo),s=$h(oc(oc({},o),{time:(new Date).getTime()}),{account:this.core.account,featureValue:Am.default,statusValue:km.sending});try{e.onSendBefore&&e.onSendBefore(s)}catch(e){this.logger.error("sendMsg: options.onSendBefore error",e)}return this.core.eventBus.emit("session/updateForNewMsg",s),this.core.sendCmd(i,{msg:o}).then((function(t){var i=t.content,a=t.error,c=$h(oc(oc({},o),i.msg),{account:r.core.account,featureValue:Am.default,statusValue:km.sent});if(n=i.msg,r.core.eventBus.emit("session/updateForNewMsg",c),r.core.reporter.report("msgSend",{msgId:c.idServer,clientId:c.idClient,msgTime:c.time,formAccid:"p2p"===e.scene?r.core.account:"",toAccid:c.to,type:Cm[c.scene],roomId:"",tid:"p2p"===e.scene?"":c.to,result:200,faiReason:"",rt:Zc()-s.time}),a)throw a;return c})).catch((function(t){var i=$h(oc(oc(oc({},o),n),{time:(new Date).getTime()}),{account:r.core.account,featureValue:Am.default,statusValue:7101===t.code?km.refused:km.sendFailed});throw t.msg=i,r.core.eventBus.emit("session/updateForNewMsg",i),r.core.reporter.report("msgSend",{msgId:i.idServer,clientId:i.idClient,msgTime:i.time,formAccid:"p2p"===e.scene?r.core.account:"",toAccid:i.to,type:Cm[i.scene],roomId:"",tid:"p2p"===e.scene?"":i.to,result:t&&t.error&&t.error.code,faiReason:t&&t.error&&t.error.message,rt:Zc()-s.time}),t}))},r.resendMsg=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(mp({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},e),r=e.msg,n=oc(oc({},r),{attach:r.attach?Qc(r.attach):void 0,setting:{resendFlag:!0}}),r.from===this.core.account){t.next=5;break}throw new Error("You can only resend messages that you sent: "+r.idClient);case 5:return t.abrupt("return",this.sendMsg(n));case 6:case"end":return t.stop()}}),t,this)})))},r.forwardMsg=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:Hp(Cm)},to:{type:"string",allowEmpty:!1}},e),r=e.msg,n=oc(oc({},r),{scene:e.scene,to:e.to,attach:r.attach?Qc(r.attach):void 0}),t.abrupt("return",this.sendMsg(n));case 4:case"end":return t.stop()}}),t,this)})))},r.sendImageMsg=function(e){return this.doSendFile(oc(oc({},e),{type:"image"}))},r.sendFileMsg=function(e){return this.doSendFile(oc(oc({},e),{type:"file"}))},r.sendAudioMsg=function(e){return this.doSendFile(oc(oc({},e),{type:"audio"}))},r.sendVideoMsg=function(e){return this.doSendFile(oc(oc({},e),{type:"video"}))},r.doSendFile=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(mp({scene:{type:"enum",values:Hp(Cm)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e),r=e.attach){t.next=27;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){t.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return t.prev=5,this.core.reporter.reportTraceStart("nos",{user_id:this.core.account,action:"upload"}),t.next=9,this.core.cloudStorage.uploadFile(e);case 9:r=t.sent,this.core.reporter.reportTraceEnd("nos",0),t.next=19;break;case 13:throw t.prev=13,t.t0=t.catch(5),this.core.reporter.reportTraceUpdate("nos",{operation_type:"transfer",error:t.t0},!1),this.core.reporter.reportTraceEnd("nos",0),this.logger.error("sendFile:: upload File error or abort",t.t0),t.t0;case 19:t.prev=19,e.onUploadDone&&e.onUploadDone(r),t.next=27;break;case 23:throw t.prev=23,t.t1=t.catch(19),this.logger.error("sendFile options.onUploadDone err",t.t1),t.t1;case 27:return t.abrupt("return",this.sendMsg(oc(oc({},e),{attach:Qc(r),type:e.type})));case 28:case"end":return t.stop()}}),t,this,[[5,13],[19,23]])})))},r.recallMsg=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:Hp(Cm)},time:{type:"number"}}},apnsText:{type:"string",allowEmpty:!1,required:!1},ps:{type:"string",allowEmpty:!1,required:!1}},e),r=e.msg,n={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},i={p2p:7,team:8,superTeam:12},t.next=6,this.core.sendCmd(n[r.scene],{recallMsgTag:{time:r.time,type:i[r.scene],to:r.to,from:r.from,ps:e.ps,attach:e.attach,apnsText:e.apnsText,pushPayload:e.pushPayload,deletedIdClient:r.idClient,deletedIdServer:r.idServer,opeAccount:r.from,env:e.env}});case 6:return this.core.eventBus.emit("session/updateForDeletedMsg",Vh([r])),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t,this)})))},r.deleteSelfMsgs=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=e.msgs,n=Vu(r).call(r,(function(t){return{scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,idServer:t.idServer,idClient:t.idClient,time:t.time,ext:e.ext}})),t.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:n});case 5:return i=Vh(n),this.core.eventBus.emit("session/updateForDeletedMsg",i),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})))},r.sendMsgReceipt=function(e){var t,r;return vc(this,void 0,void 0,Ya.mark((function n(){var i,o,s,a;return Ya.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(mp({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),i=e.msg,this.service.shouldSendMsgReceipt(i)){n.next=5;break}return this.logger.warn("P2p Message receipt should not be sent，check msg idClient "+i.idClient+", scene "+i.scene+", status "+i.status+", time "+i.time),n.abrupt("return",void 0);case 5:return o={to:i.target,idClient:i.idClient,time:i.time},n.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:o});case 8:return s=n.sent,a=Bp(null===(r=null===(t=s.content)||void 0===t?void 0:t.msgReceiptTag)||void 0===r?void 0:r.time),n.abrupt("return",oc(oc({},o),{time:a?Math.min(a,o.time):o.time}));case 11:case"end":return n.stop()}}),n,this)})))},r.sendTeamMsgReceipt=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},e),r=e.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:r}),t.abrupt("return",void 0);case 4:case"end":return t.stop()}}),t,this)})))},r.getTeamMsgReads=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i,o;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return mp({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),n=e.teamMsgReceipts,r.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:n});case 4:return i=r.sent,o=(o=null===(t=i.content)||void 0===t?void 0:t.teamMsgReceipts)?Vu(o).call(o,(function(e){return oc(oc({},e),{read:Bp(e.read),unread:Bp(e.unread)})})):[],r.abrupt("return",o);case 8:case"end":return r.stop()}}),r,this)})))},r.getTeamMsgReadAccounts=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),r=e.teamMsgReceipt,t.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:r});case 4:return n=t.sent,t.abrupt("return",n.content);case 6:case"end":return t.stop()}}),t,this)})))},r.markMsgsAck=function(e){if(e&&e.length>0){var t=[],r=[];so(e).call(e,(function(e){"p2p"===e.scene&&"in"===e.flow?t.push(e):"team"===e.scene&&"in"===e.flow&&r.push(e)})),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:Vu(t).call(t,(function(e){return e.idServer}))}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:Vu(r).call(r,(function(e){return e.idServer}))})}},r.onMsgHandler=function(e){if(e.error)this.logger.error("msgHandler::recvError",e.error);else{var t=Zc(),r=Fh(e.content.msg,this.core.account),n=this.core.session&&this.core.session.getSession&&this.core.session.getSession({id:r}),i=$h(e.content.msg,n?{account:this.core.account,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:this.core.account});if("debug"===this.core.options.debugLevel?this.logger.debug("msgHandler::recvMsg",i.idClient,i.idServer,i):this.logger.log("msgHandler::recvMsg",i.idClient,i.idServer),this.markMsgsAck([i]),"notification"===i.type)this.core.eventBus.emit("session/updateForNewMsg",i),this.core.eventBus.emit("team/onNotification",i);else{if("out"!==i.flow){var o="p2p"===i.scene,s={msgId:i.idServer,clientId:i.idClient,receiveTime:e.__receiveTime,serverTime:i.time,callbackTime:Zc(),preHandleTime:t,fromAccid:i.from,toAccid:this.core.account,type:Cm[i.scene],tid:o?"":i.to,result:200,failReason:"",rt:Zc()-i.time};this.core.reporter.report("msgReceive",s,!0)}this.core.eventBus.emit("session/updateForNewMsg",i),this.core.emit("msg",i)}}},r.nimOnTeamMsgsHandler=function(e){var t,r=this;so(t=e.content.datas).call(t,(function(t){r.onMsgHandler(oc({},e,{content:{msg:t}}))}))},r.syncRoamingMsgsHandler=function(e){var t=e.content.msgs||[];if(0!==t.length){var r=Fh(t[0],this.core.account),n=this.core.session&&this.core.session.getSession&&this.core.session.getSession({id:r}),i=(t=Bh(t,n?{account:this.core.account,featureValue:Am.roam,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:this.core.account,featureValue:Am.roam}))[0].time,o={timetag:i,sessionId:r,msgs:Wh(t)};this.core.eventBus.emit("session/syncMsgs",o),this.core.emit("syncRoamingMsgs",o),this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:i})}},r.syncOfflineMsgsHandler=function(e){var t,r=this,n=e.content.msgs||[];if(0!==n.length){var i={},o=[];so(n).call(n,(function(e){var t=Fh(e,r.core.account),n=r.core.session&&r.core.session.getSession&&r.core.session.getSession({id:t}),s=$h(e,n?{account:r.core.account,featureValue:Am.leave,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:r.core.account,featureValue:Am.leave});o.push(s),i[s.sessionId]?i[s.sessionId].push(s):i[s.sessionId]=[s]})),this.markMsgsAck(o);var s=0;so(t=ec(i)).call(t,(function(e){var t,n=nh(t=i[e]).call(t,(function(e,t){return t.time-e.time}));n[0].time>s&&(s=n[0].time);var o={timetag:n[0].time,sessionId:e,msgs:n};r.core.eventBus.emit("session/syncMsgs",o),r.core.emit("syncOfflineMsgs",o)})),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:s})}},r.syncDeleteSelfMsgsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.deletedMsgs;r&&r.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var n=r[r.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:n})},r.onDeleteSelfMsgHandler=function(e){var t=Vh([e.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)},r.onDeleteSelfMsgsHandler=function(e){var t=Vh(e.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)},r.onBroadcastMsgHandler=function(e){var t=e.content.msg,r=this.service.processBroadcastMsg([t]);this.core.emit("broadcastMsgs",r)},r.syncBroadcastMsgHandler=function(e){var t=e.content.msgs,r=this.service.processBroadcastMsg(t);this.core.emit("broadcastMsgs",r)},t}(Fm),Xh={"5_1":"sync"},Zh={sync:{sid:5,cid:1,service:"sync",isNoResponse:!0,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,signaling:21,superTeams:22,myInfoInSuperTeams:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Number",name:"timetag"}]}},eg=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"sync",t)||this).options=r,n.options=oc({myInfo:!!t.user.name,offlineMsgs:!!t.msg.name,teams:!!t.team.name,roamingMsgs:!!t.msg.name,relations:!!t.user.name,friends:!!t.friend.name,friendUsers:!!t.user.name,msgReceipts:!!t.msg.name,recallMsg:!!t.msg.name,sessionAck:!!t.session.name,superTeamSessionAck:!!t.session.name,superTeams:!!t.superTeam.name,superTeamRoamingMsgs:!!t.superTeam.name,deleteSuperTeamMsg:!!t.superTeam.name,deleteSelfMsgs:!!t.msg.name,sessionHistoryMsgsDelete:!!t.msgLog.name,signaling:!!t.signaling.name},r),n.timetags={},n.pArray=[],n.initEventListeners(),El({cmdMap:Xh,cmdConfig:Zh}),n}Qt(t,e);var r=t.prototype;return r.doSync=function(){return vc(this,void 0,void 0,Ya.mark((function e(){var t;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.genSyncParams(),this.logger.log("doSync: ",t),e.next=4,this.core.sendCmd("sync",{sync:t});case 4:case"end":return e.stop()}}),e,this)})))},r.initEventListeners=function(){var e=this;this.core.eventBus.on("sync/updateTimetag",(function(t){var r;so(r=ec(t)).call(r,(function(r){t[r]>(e.timetags[r]||0)&&(e.timetags[r]=t[r])}))}))},r.genSyncParams=function(){var e,t,r=this;return bl(e=Ep(t=ec(this.options)).call(t,(function(e){var t=e;return r.options[t]}))).call(e,(function(e,t){var n=t;return e[n]=r.timetags[n]||0,e}),{})},r.handleImmediate=function(e){var t;this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),this.logger.log("sync: emit syncdone",null===(t=e.content)||void 0===t?void 0:t.timetag),this.core.emit("syncdone")},r.syncHandler=function(e){var t=this;"ALI"==("undefined"!=typeof tt&&tt.getSystemInfo?"TT":"undefined"!=typeof swan&&swan.getSystemInfo?"BAIDU":"undefined"!=typeof my&&my.getSystemInfo?"ALI":"undefined"!=typeof wx&&wx.getSystemInfo?"WX":"unknow environment")?(this.logger.log("sync: emit ALIAPP sycnHandler, handle later"),Jc((function(){t.handleImmediate(e)}),100)):this.handleImmediate(e)},t}(Fm),tg={"6_26":"getNosCdnHost"},rg={getNosCdnHost:{sid:6,cid:26,service:"misc",response:[{type:"Property",name:"nosConfigTag",reflectMapper:Cl({nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4}}).nosConfigTag}]}},ng=function(e){function t(t){var r;return(r=e.call(this,"misc",t)||this).core=t,r.nosCdnHostTimer=0,El({cmdMap:tg,cmdConfig:rg}),r}return Qt(t,e),t.prototype.getNosCdnHost=function(){var e;return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o=this;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.core.sendCmd("getNosCdnHost");case 3:r=t.sent,t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),this.logger.error("getNosCdnHost::error",t.t0),t.abrupt("return");case 10:n=null===(e=null==r?void 0:r.content)||void 0===e?void 0:e.nosConfigTag,0!==(i=Bp(null==n?void 0:n.expire))&&n.cdnDomain?-1===i?(this.core.config.cdn.bucket=n.bucket,this.core.config.cdn.cdnDomain=n.cdnDomain,this.core.config.cdn.objectNamePrefix=n.objectNamePrefix):(this.core.config.cdn.bucket=n.bucket,this.core.config.cdn.cdnDomain=n.cdnDomain,this.core.config.cdn.objectNamePrefix=n.objectNamePrefix,this.nosCdnHostTimer&&clearTimeout(this.nosCdnHostTimer),this.nosCdnHostTimer=Jc((function(){o.getNosCdnHost()}),1e3*i)):(this.core.config.cdn.bucket="",this.core.config.cdn.cdnDomain="",this.core.config.cdn.objectNamePrefix="");case 13:case"end":return t.stop()}}),t,this,[[0,6]])})))},t}(Fm),ig=function(e){return"symbol"==typeof e||Vl(e)&&"[object Symbol]"==hu(e)},og=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,sg=/^\w*$/,ag=function(e,t){if(uf(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ig(e))||sg.test(e)||!og.test(e)||null!=t&&e in Object(t)};function cg(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=e.apply(this,n);return r.cache=o.set(i,s)||o,s};return r.cache=new(cg.Cache||jd),r}cg.Cache=jd;var ug=cg,lg=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dg=/\\(\\)?/g,pg=function(e){var t=ug(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(lg,(function(e,r,n,i){t.push(n?i.replace(dg,"$1"):r||e)})),t})),mg=pg,fg=su?su.prototype:void 0,hg=fg?fg.toString:void 0,gg=function e(t){if("string"==typeof t)return t;if(uf(t))return Jd(t,e)+"";if(ig(t))return hg?hg.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r},vg=function(e){return null==e?"":gg(e)},yg=function(e,t){return uf(e)?e:ag(e,t)?[e]:mg(vg(e))},bg=function(e){if("string"==typeof e||ig(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},Sg=function(e,t){for(var r=0,n=(t=yg(t,e)).length;null!=e&&r<n;)e=e[bg(t[r++])];return r&&r==n?e:void 0},Tg=function(e,t,r){"__proto__"==t&&rp?rp(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},_g=Object.prototype.hasOwnProperty,wg=function(e,t,r){var n=e[t];_g.call(e,t)&&bd(n,r)&&(void 0!==r||t in e)||Tg(e,t,r)},Mg=function(e,t,r,n){if(!gu(e))return e;for(var i=-1,o=(t=yg(t,e)).length,s=o-1,a=e;null!=a&&++i<o;){var c=bg(t[i]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=s){var l=a[c];void 0===(u=n?n(l,c,a):void 0)&&(u=gu(l)?l:mf(t[i+1])?[]:{})}wg(a,c,u),a=a[c]}return e},xg=function(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var s=t[n],a=Sg(e,s);r(a,s)&&Mg(o,yg(s,e),a)}return o},Eg=function(e,t){return null!=e&&t in Object(e)},Cg=function(e,t,r){for(var n=-1,i=(t=yg(t,e)).length,o=!1;++n<i;){var s=bg(t[n]);if(!(o=null!=e&&r(e,s)))break;e=e[s]}return o||++n!=i?o:!!(i=null==e?0:e.length)&&ap(i)&&mf(s,i)&&(uf(e)||cf(e))},Rg=function(e,t){return null!=e&&Cg(e,t,Eg)},kg=function(e,t){return xg(e,t,(function(t,r){return Rg(e,r)}))},Ag=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e},Ig=su?su.isConcatSpreadable:void 0,Og=function(e){return uf(e)||cf(e)||!!(Ig&&e&&e[Ig])},Pg=function e(t,r,n,i,o){var s=-1,a=t.length;for(n||(n=Og),o||(o=[]);++s<a;){var c=t[s];r>0&&n(c)?r>1?e(c,r-1,n,i,o):Ag(o,c):i||(o[o.length]=c)}return o},Ng=function(e){return null!=e&&e.length?Pg(e,1):[]},Dg=function(e){return sp(ep(e,void 0,Ng),e+"")}((function(e,t){return null==e?{}:kg(e,t)}));nt({global:!0},{globalThis:a});var Lg=a,jg=jg||function(e){var t;"undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),void 0!==Lg&&Lg.crypto&&(t=Lg.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==commonjsGlobal&&commonjsGlobal.crypto&&(t=commonjsGlobal.crypto);var r=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Pt||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},o=i.lib={},s=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(var a=0;a<i;a+=4)t[n+a>>>2]=r[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e,t=s.clone.call(this);return t.words=Ja(e=this.words).call(e,0),t},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new a.init(t,e)}}),c=i.enc={},u=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=Bp(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},l=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},d=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){var t;"string"==typeof e&&(e=d.parse(e)),hc(t=this._data).call(t,e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,s=this.blockSize,c=o/(4*s),u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,l=e.min(4*u,o);if(u){for(var d=0;d<u;d+=s)this._doProcessBlock(i,d);r=rm(i).call(i,0,u),n.sigBytes-=l}return new a.init(r,l)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=p.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new m.HMAC.init(e,r).finalize(t)}}});var m=i.algo={};return i}(Math),Ug=jg,Fg=Ug.lib,$g=Fg.WordArray,Bg=Fg.Hasher,Vg=Ug.algo,Hg=[],Wg=Vg.SHA1=Bg.extend({_doReset:function(){this._hash=new $g.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],c=0;c<80;c++){if(c<16)Hg[c]=0|e[t+c];else{var u=Hg[c-3]^Hg[c-8]^Hg[c-14]^Hg[c-16];Hg[c]=u<<1|u>>>31}var l=(n<<5|n>>>27)+a+Hg[c];l+=c<20?1518500249+(i&o|~i&s):c<40?1859775393+(i^o^s):c<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,a=s,s=o,o=i<<30|i>>>2,i=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=Bg.clone.call(this);return e._hash=this._hash.clone(),e}});Ug.SHA1=Bg._createHelper(Wg),Ug.HmacSHA1=Bg._createHmacHelper(Wg),jg.SHA1,function(e){var t=e,r=t.lib.Base,n=t.enc.Utf8;t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,c=s.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;o.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t,r=this._hasher,n=r.finalize(e);return r.reset(),r.finalize(hc(t=this._oKey.clone()).call(t,n))}})}(jg);var qg=jg,zg=qg.lib,Gg=zg.Base,Jg=zg.WordArray,Kg=qg.algo,Qg=Kg.MD5,Yg=Kg.EvpKDF=Gg.extend({cfg:Gg.extend({keySize:4,hasher:Qg,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),o=Jg.create(),s=o.words,a=n.keySize,c=n.iterations;s.length<a;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var u=1;u<c;u++)r=i.finalize(r),i.reset();hc(o).call(o,r)}return o.sigBytes=4*a,o}});qg.EvpKDF=function(e,t,r){return Yg.create(r).compute(e,t)},jg.EvpKDF;var Xg=jg,Zg=Xg.lib.WordArray;Xg.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<r;a++)i.push(n.charAt(s>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var o=r.charAt(64);if(o){var s=pc(e).call(e,o);-1!==s&&(t=s)}return function(e,t,r){for(var n=[],i=0,o=0;o<t;o++)if(o%4){var s=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;n[i>>>2]|=s<<24-i%4*8,i++}return Zg.create(n,i)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},jg.enc.Base64;var ev=jg,tv=ev.lib,rv=tv.WordArray,nv=tv.Hasher,iv=ev.algo,ov=[];!function(){for(var e=0;e<64;e++)ov[e]=4294967296*Math.abs(Math.sin(e+1))|0}();var sv=iv.MD5=nv.extend({_doReset:function(){this._hash=new rv.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,s=e[t+0],a=e[t+1],c=e[t+2],u=e[t+3],l=e[t+4],d=e[t+5],p=e[t+6],m=e[t+7],f=e[t+8],h=e[t+9],g=e[t+10],v=e[t+11],y=e[t+12],b=e[t+13],S=e[t+14],T=e[t+15],_=o[0],w=o[1],M=o[2],x=o[3];_=av(_,w,M,x,s,7,ov[0]),x=av(x,_,w,M,a,12,ov[1]),M=av(M,x,_,w,c,17,ov[2]),w=av(w,M,x,_,u,22,ov[3]),_=av(_,w,M,x,l,7,ov[4]),x=av(x,_,w,M,d,12,ov[5]),M=av(M,x,_,w,p,17,ov[6]),w=av(w,M,x,_,m,22,ov[7]),_=av(_,w,M,x,f,7,ov[8]),x=av(x,_,w,M,h,12,ov[9]),M=av(M,x,_,w,g,17,ov[10]),w=av(w,M,x,_,v,22,ov[11]),_=av(_,w,M,x,y,7,ov[12]),x=av(x,_,w,M,b,12,ov[13]),M=av(M,x,_,w,S,17,ov[14]),_=cv(_,w=av(w,M,x,_,T,22,ov[15]),M,x,a,5,ov[16]),x=cv(x,_,w,M,p,9,ov[17]),M=cv(M,x,_,w,v,14,ov[18]),w=cv(w,M,x,_,s,20,ov[19]),_=cv(_,w,M,x,d,5,ov[20]),x=cv(x,_,w,M,g,9,ov[21]),M=cv(M,x,_,w,T,14,ov[22]),w=cv(w,M,x,_,l,20,ov[23]),_=cv(_,w,M,x,h,5,ov[24]),x=cv(x,_,w,M,S,9,ov[25]),M=cv(M,x,_,w,u,14,ov[26]),w=cv(w,M,x,_,f,20,ov[27]),_=cv(_,w,M,x,b,5,ov[28]),x=cv(x,_,w,M,c,9,ov[29]),M=cv(M,x,_,w,m,14,ov[30]),_=uv(_,w=cv(w,M,x,_,y,20,ov[31]),M,x,d,4,ov[32]),x=uv(x,_,w,M,f,11,ov[33]),M=uv(M,x,_,w,v,16,ov[34]),w=uv(w,M,x,_,S,23,ov[35]),_=uv(_,w,M,x,a,4,ov[36]),x=uv(x,_,w,M,l,11,ov[37]),M=uv(M,x,_,w,m,16,ov[38]),w=uv(w,M,x,_,g,23,ov[39]),_=uv(_,w,M,x,b,4,ov[40]),x=uv(x,_,w,M,s,11,ov[41]),M=uv(M,x,_,w,u,16,ov[42]),w=uv(w,M,x,_,p,23,ov[43]),_=uv(_,w,M,x,h,4,ov[44]),x=uv(x,_,w,M,y,11,ov[45]),M=uv(M,x,_,w,T,16,ov[46]),_=lv(_,w=uv(w,M,x,_,c,23,ov[47]),M,x,s,6,ov[48]),x=lv(x,_,w,M,m,10,ov[49]),M=lv(M,x,_,w,S,15,ov[50]),w=lv(w,M,x,_,d,21,ov[51]),_=lv(_,w,M,x,y,6,ov[52]),x=lv(x,_,w,M,u,10,ov[53]),M=lv(M,x,_,w,g,15,ov[54]),w=lv(w,M,x,_,a,21,ov[55]),_=lv(_,w,M,x,f,6,ov[56]),x=lv(x,_,w,M,T,10,ov[57]),M=lv(M,x,_,w,p,15,ov[58]),w=lv(w,M,x,_,b,21,ov[59]),_=lv(_,w,M,x,l,6,ov[60]),x=lv(x,_,w,M,v,10,ov[61]),M=lv(M,x,_,w,c,15,ov[62]),w=lv(w,M,x,_,h,21,ov[63]),o[0]=o[0]+_|0,o[1]=o[1]+w|0,o[2]=o[2]+M|0,o[3]=o[3]+x|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32;var i=Math.floor(r/4294967296),o=r;t[15+(n+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(t.length+1),this._process();for(var s=this._hash,a=s.words,c=0;c<4;c++){var u=a[c];a[c]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return s},clone:function(){var e=nv.clone.call(this);return e._hash=this._hash.clone(),e}});function av(e,t,r,n,i,o,s){var a=e+(t&r|~t&n)+i+s;return(a<<o|a>>>32-o)+t}function cv(e,t,r,n,i,o,s){var a=e+(t&n|r&~n)+i+s;return(a<<o|a>>>32-o)+t}function uv(e,t,r,n,i,o,s){var a=e+(t^r^n)+i+s;return(a<<o|a>>>32-o)+t}function lv(e,t,r,n,i,o,s){var a=e+(r^(t|~n))+i+s;return(a<<o|a>>>32-o)+t}ev.MD5=nv._createHelper(sv),ev.HmacMD5=nv._createHmacHelper(sv),jg.MD5,function(e){e.lib.Cipher||function(){var t=e,r=t.lib,n=r.Base,i=r.WordArray,o=r.BufferedBlockAlgorithm,s=t.enc;s.Utf8;var a=s.Base64,c=t.algo.EvpKDF,u=r.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:g}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()});r.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var l=t.mode={},d=r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=l.CBC=function(){var e=d.extend();function t(e,t,r){var n,i=this._iv;i?(n=i,this._iv=void 0):n=this._prevBlock;for(var o=0;o<r;o++)e[t+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i),n.encryptBlock(e,r),this._prevBlock=Ja(e).call(e,r,r+i)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=Ja(e).call(e,r,r+i);n.decryptBlock(e,r),t.call(this,e,r,i),this._prevBlock=o}}),e}(),m=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,o=n<<24|n<<16|n<<8|n,s=[],a=0;a<n;a+=4)s.push(o);var c=i.create(s,n);hc(e).call(e,c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};r.BlockCipher=u.extend({cfg:u.cfg.extend({mode:p,padding:m}),reset:function(){var e;u.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var f=r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),h=(t.format={}).OpenSSL={stringify:function(e){var t,r,n=e.ciphertext,o=e.salt;return(o?hc(t=hc(r=i.create([1398893684,1701076831])).call(r,o)).call(t,n):n).toString(a)},parse:function(e){var t,r=a.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=i.create(Ja(n).call(n,2,4)),rm(n).call(n,0,4),r.sigBytes-=16),f.create({ciphertext:r,salt:t})}},g=r.SerializableCipher=n.extend({cfg:n.extend({format:h}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),s=i.cfg;return f.create({ciphertext:o,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){var o;n||(n=i.random(8));var s=c.create({keySize:t+r}).compute(e,n),a=i.create(Ja(o=s.words).call(o,t),4*r);return s.sigBytes=4*t,f.create({key:s,iv:a,salt:n})}},y=r.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:v}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=g.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=i.iv,g.decrypt.call(this,e,t,i.key,n)}})}()}(jg);var dv=jg,pv=dv.lib.StreamCipher,mv=dv.algo,fv=mv.RC4=pv.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var o=0;i<256;i++){var s=i%r,a=t[s>>>2]>>>24-s%4*8&255;o=(o+n[i]+a)%256;var c=n[i];n[i]=n[o],n[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=hv.call(this)},keySize:8,ivSize:0});function hv(){for(var e=this._S,t=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[r],e[r]=o,n|=e[(e[t]+e[r])%256]<<24-8*i}return this._i=t,this._j=r,n}dv.RC4=pv._createHelper(fv);var gv=mv.RC4Drop=fv.extend({cfg:fv.cfg.extend({drop:192}),_doReset:function(){fv._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)hv.call(this)}});dv.RC4Drop=pv._createHelper(gv);var vv=jg.RC4,yv=jg.enc.Utf8,bv=function(e){function t(t){var r;return(r=e.call(this,"user",t)||this).myInfo=Rh({}),El({cmdMap:Ph,cmdConfig:Lh}),r}Qt(t,e);var r=t.prototype;return r.setBlack=function(e){return mp({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),this.core.sendCmd("setBlack",e).then((function(){}))},r.setMute=function(e){return mp({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),this.core.sendCmd("setMute",e).then((function(){}))},r.getRelations=function(){return this.core.sendCmd("syncRelations",{timetag:0})},r.getBlackList=function(){return vc(this,void 0,void 0,Ya.mark((function e(){var t;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=e.sent,e.abrupt("return",t.blackList||[]);case 4:case"end":return e.stop()}}),e,this)})))},r.getMuteList=function(){return vc(this,void 0,void 0,Ya.mark((function e(){var t;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=e.sent,e.abrupt("return",t.muteList||[]);case 4:case"end":return e.stop()}}),e,this)})))},r.updatePushToken=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({tokenName:{type:"string",allowEmpty:!1,required:!0},token:{type:"string",allowEmpty:!1,required:!0},pushkit:{type:"number",required:!1}},e),r=yv.parse("557d1e3cafa43e2589a588270c53d56f"),n=yv.stringify(vv.decrypt(e.token,r)),t.next=5,this.core.sendCmd("updatePushToken",oc(oc({},e),{token:n}));case 5:case"end":return t.stop()}}),t,this)})))},r.updateAppBackground=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({isBackground:{type:"boolean",required:!0},badge:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("updateAppBackground",{isBackground:e.isBackground,badge:e.badge||0});case 3:case"end":return t.stop()}}),t,this)})))},r.getUsersNameCardFromServer=function(e){var t=this;return mp({accounts:{type:"array",max:150,itemType:"string"}},e),this.core.sendCmd("getUsersNameCardFromServer",Dg(e,["accounts"])).then((function(r){var n,i=r.content;return t.logger.log("user:: getUsers done",e.accounts),i&&i.users?Vu(n=i.users).call(n,(function(e){return Rh(e)})):[]}))},r.updateMyNameCard=function(e){var t=this;if(mp({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:Hp(ih),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},e),0===ec(e).length)return La.resolve(this.myInfo);var r=Dg(e,["nick","avatar","signature","email","birth","tel","ext"]);return e.gender&&(r.gender=ih[e.gender]),this.core.sendCmd("updateMyNameCard",{user:r}).then((function(n){var i=n.content;return i&&i.timetag&&t.core.eventBus.emit("sync/updateTimetag",{myInfo:+i.timetag}),e.gender&&(r.gender=e.gender),t.myInfo=oc({},t.myInfo,r),t.myInfo}))},r.onUpdateBlackListHandler=function(e){var t=e.content;t.account?this.core.emit("updateBlackList",t):this.logger.warn("onUpdateBlackListHandler: no account")},r.onUpdateMuteListHandler=function(e){var t=e.content;t.account?this.core.emit("updateMuteList",t):this.logger.warn("onUpdateBlackListHandler: no account")},r.syncRelationsHandler=function(e){var t=e.content,r=t.list,n=t.timetag,i={blackList:[],muteList:[]};return n&&this.core.eventBus.emit("sync/updateTimetag",{relations:n}),r&&r.length&&so(r).call(r,(function(e){var t=function(e){var t={account:e.account,updateTime:+e.updateTime,createTime:+e.createTime};return"1"===e.isMuted&&(t.isMuted=!0),"1"===e.isBlack&&(t.isBlack=!0),t}(e);t.isBlack&&i.blackList.push(t),t.isMuted&&i.muteList.push(t)})),this.core.emit("relations",i),La.resolve(i)},r.syncMyNameCardHandler=function(e){e.content.user&&(this.myInfo=Rh(e.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:e.content.timetag}))},r.onUpdateMyNameCardHandler=function(e){var t=e.content.user;t?(oc(this.myInfo,Rh(t)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},t}(Fm),Sv=function(){this.__data__=new Cd,this.size=0},Tv=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},_v=function(e){return this.__data__.get(e)},wv=function(e){return this.__data__.has(e)},Mv=function(e,t){var r=this.__data__;if(r instanceof Cd){var n=r.__data__;if(!Rd||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new jd(n)}return r.set(e,t),this.size=r.size,this};function xv(e){var t=this.__data__=new Cd(e);this.size=t.size}xv.prototype.clear=Sv,xv.prototype.delete=Tv,xv.prototype.get=_v,xv.prototype.has=wv,xv.prototype.set=Mv;var Ev=xv,Cv=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1},Rv=function(e,t,r,n,i,o){var s=1&r,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;var u=o.get(e),l=o.get(t);if(u&&l)return u==t&&l==e;var d=-1,p=!0,m=2&r?new Bd:void 0;for(o.set(e,t),o.set(t,e);++d<a;){var f=e[d],h=t[d];if(n)var g=s?n(h,f,d,t,e,o):n(f,h,d,e,t,o);if(void 0!==g){if(g)continue;p=!1;break}if(m){if(!Cv(t,(function(e,t){if(!Kd(m,t)&&(f===e||i(f,e,r,n,o)))return m.push(t)}))){p=!1;break}}else if(f!==h&&!i(f,h,r,n,o)){p=!1;break}}return o.delete(e),o.delete(t),p},kv=ou.Uint8Array,Av=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r},Iv=su?su.prototype:void 0,Ov=Iv?Iv.valueOf:void 0,Pv=function(e,t,r,n,i,o,s){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new kv(e),new kv(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return bd(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Av;case"[object Set]":var c=1&n;if(a||(a=vp),e.size!=t.size&&!c)return!1;var u=s.get(e);if(u)return u==t;n|=2,s.set(e,t);var l=Rv(a(e),a(t),n,i,o,s);return s.delete(e),l;case"[object Symbol]":if(Ov)return Ov.call(e)==Ov.call(t)}return!1},Nv=function(e,t,r){var n=t(e);return uf(e)?n:Ag(n,r(e))},Dv=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var s=e[r];t(s,r,e)&&(o[i++]=s)}return o},Lv=function(){return[]},jv=Object.prototype.propertyIsEnumerable,Uv=Object.getOwnPropertySymbols,Fv=Uv?function(e){return null==e?[]:(e=Object(e),Dv(Uv(e),(function(t){return jv.call(e,t)})))}:Lv,$v=Fv,Bv=function(e){return Nv(e,Ef,$v)},Vv=Object.prototype.hasOwnProperty,Hv=function(e,t,r,n,i,o){var s=1&r,a=Bv(e),c=a.length;if(c!=Bv(t).length&&!s)return!1;for(var u=c;u--;){var l=a[u];if(!(s?l in t:Vv.call(t,l)))return!1}var d=o.get(e),p=o.get(t);if(d&&p)return d==t&&p==e;var m=!0;o.set(e,t),o.set(t,e);for(var f=s;++u<c;){var h=e[l=a[u]],g=t[l];if(n)var v=s?n(g,h,l,t,e,o):n(h,g,l,e,t,o);if(!(void 0===v?h===g||i(h,g,r,n,o):v)){m=!1;break}f||(f="constructor"==l)}if(m&&!f){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(m=!1)}return o.delete(e),o.delete(t),m},Wv=ad(ou,"DataView"),qv=ad(ou,"Promise"),zv=ad(ou,"WeakMap"),Gv="[object Map]",Jv="[object Promise]",Kv="[object Set]",Qv="[object WeakMap]",Yv="[object DataView]",Xv=Xl(Wv),Zv=Xl(Rd),ey=Xl(qv),ty=Xl(hp),ry=Xl(zv),ny=hu;(Wv&&ny(new Wv(new ArrayBuffer(1)))!=Yv||Rd&&ny(new Rd)!=Gv||qv&&ny(qv.resolve())!=Jv||hp&&ny(new hp)!=Kv||zv&&ny(new zv)!=Qv)&&(ny=function(e){var t=hu(e),r="[object Object]"==t?e.constructor:void 0,n=r?Xl(r):"";if(n)switch(n){case Xv:return Yv;case Zv:return Gv;case ey:return Jv;case ty:return Kv;case ry:return Qv}return t});var iy=ny,oy="[object Arguments]",sy="[object Array]",ay="[object Object]",cy=Object.prototype.hasOwnProperty,uy=function(e,t,r,n,i,o){var s=uf(e),a=uf(t),c=s?sy:iy(e),u=a?sy:iy(t),l=(c=c==oy?ay:c)==ay,d=(u=u==oy?ay:u)==ay,p=c==u;if(p&&df(e)){if(!df(t))return!1;s=!0,l=!1}if(p&&!l)return o||(o=new Ev),s||yf(e)?Rv(e,t,r,n,i,o):Pv(e,t,c,r,n,i,o);if(!(1&r)){var m=l&&cy.call(e,"__wrapped__"),f=d&&cy.call(t,"__wrapped__");if(m||f){var h=m?e.value():e,g=f?t.value():t;return o||(o=new Ev),i(h,g,r,n,o)}}return!!p&&(o||(o=new Ev),Hv(e,t,r,n,i,o))},ly=function e(t,r,n,i,o){return t===r||(null==t||null==r||!Vl(t)&&!Vl(r)?t!=t&&r!=r:uy(t,r,n,i,e,o))},dy=function(e,t,r,n){var i=r.length,o=i,s=!n;if(null==e)return!o;for(e=Object(e);i--;){var a=r[i];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<o;){var c=(a=r[i])[0],u=e[c],l=a[1];if(s&&a[2]){if(void 0===u&&!(c in e))return!1}else{var d=new Ev;if(n)var p=n(u,l,c,e,t,d);if(!(void 0===p?ly(l,u,3,n,d):p))return!1}}return!0},py=function(e){return e==e&&!gu(e)},fy=function(e){for(var t=Ef(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,py(i)]}return t},hy=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}},gy=function(e){var t=fy(e);return 1==t.length&&t[0][2]?hy(t[0][0],t[0][1]):function(r){return r===e||dy(r,e,t)}},vy=function(e,t,r){var n=null==e?void 0:Sg(e,t);return void 0===n?r:n},yy=function(e,t){return ag(e)&&py(t)?hy(bg(e),t):function(r){var n=vy(r,e);return void 0===n&&n===t?Rg(r,e):ly(t,n,3)}},by=function(e){return function(t){return null==t?void 0:t[e]}},Sy=function(e){return function(t){return Sg(t,e)}},Ty=function(e){return ag(e)?by(bg(e)):Sy(e)},_y=function(e){return"function"==typeof e?e:null==e?Yd:"object"==typeof e?uf(e)?yy(e[0],e[1]):gy(e):Ty(e)},wy=/\s/,My=function(e){for(var t=e.length;t--&&wy.test(e.charAt(t)););return t},xy=/^\s+/,Ey=function(e){return e?e.slice(0,My(e)+1).replace(xy,""):e},Cy=/^[-+]0x[0-9a-f]+$/i,Ry=/^0b[01]+$/i,ky=/^0o[0-7]+$/i,Ay=parseInt,Iy=function(e){if("number"==typeof e)return e;if(ig(e))return NaN;if(gu(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=gu(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ey(e);var r=Ry.test(e);return r||ky.test(e)?Ay(e.slice(2),r?2:8):Cy.test(e)?NaN:+e},Oy=1/0,Py=function(e){return e?(e=Iy(e))===Oy||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0},Ny=function(e){var t=Py(e),r=t%1;return t==t?r?t-r:t:0},Dy=Math.max,Ly=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:Ny(r);return i<0&&(i=Dy(n+i,0)),Vd(e,_y(t),i)},jy={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},Uy={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},Fy=Cl(Uy),$y={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:Fy.msgReceiptTag},{type:"Number",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Number",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Number",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:Fy.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"String",name:"to"},{type:"long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:Uy.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"long",name:"to"},{type:"long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Uy.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:Fy.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Uy.stickTopSessionTag}],response:[{type:"Number",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:Uy.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:Fy.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:Fy.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Number",name:"timetag"},{type:"Property",name:"data",reflectMapper:Fy.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:Fy.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Number",name:"timetag"},{type:"Boolean",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:Fy.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:Uy.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:21,cid:22,service:"session",response:[{type:"PropertyArray",name:"datas",reflectMapper:{0:"scene",1:"to",2:"from",7:"time",12:"idServer"}}]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[{type:"Property",name:"context",reflectMapper:{1:"timetag",2:"type"}},{type:"PropertyArray",name:"datas",reflectMapper:Fy.sessionReliableSyncTag}]}},By={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function Vy(e,t,r){void 0===r&&(r=!0);var n=Jm(By,e);return n.isStickOnTop=r,n.id=t.id,oc(oc({},t),{stickTopInfo:t.stickTopInfo?oc({},t.stickTopInfo,n):n})}var Hy={scene:{type:"enum",values:Cm},time:{type:"number"}},Wy=function(){function e(e){this.core=e}var t=e.prototype;return t.getSession=function(e){return this.core.session.getSession({id:e})||this.core.session.createSession(e)},t.addStickTopSession=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),r=qp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i,ext:e.ext}});case 4:return o=t.sent,s=this.getSession(e.id),a=Vy(o.content.data,s),t.abrupt("return",a);case 8:case"end":return t.stop()}}),t,this)})))},t.deleteStickTopSession=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({id:{type:"string",allowEmpty:!1}},e),r=qp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i}});case 4:return o=t.sent,s=this.getSession(e.id),a=Vy({updateTime:o.content.timetag},s,!1),t.abrupt("return",a);case 8:case"end":return t.stop()}}),t,this)})))},t.updateStickTopSession=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),r=qp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i,ext:e.ext}});case 4:return o=t.sent,s=this.getSession(e.id),a=Vy(o.content.data,s),t.abrupt("return",a);case 8:case"end":return t.stop()}}),t,this)})))},t.stickTopSessionHandler=function(e,t){void 0===t&&(t=!0);var r=qp(e.id,"|"),n=r.scene+"-"+r.accid;return Vy(e,this.getSession(n),t)},e}(),qy=function(){function e(e){this.core=e,this.logger=e.logger}var t=e.prototype;return t.canSessionResetUnreadCount=function(e){var t=e.id;if(void 0===e.lastMsg)throw new Error("Session::canSessionResetUnreadCount: session "+t+" is not completly, lastMsg undefined");return null!==e.lastMsg||e.unread>0?!(e.ack&&e.lastMsg&&e.ack>=e.lastMsg.time&&(this.logger.log("Session::canSessionResetUnreadCount: session "+t+" reset failed, ack time is greater than last message time"),1)):(this.logger.log("Session::canSessionResetUnreadCount: session "+t+" doesn't need to be updated, lastMsg null and unread 0"),!1)},t.filterSessionForResetUnreadCount=function(e){var t=this,r={cmd:"markMultSuperTeamSessionsAck",params:[]},n={cmd:"markMultSessionsAck",params:[]};return so(e).call(e,(function(e){var i;try{if(!t.canSessionResetUnreadCount(e))return;var o=qp(e.id),s=o.accid,a=o.scene,c={to:s,sessionId:e.id,timetag:(null===(i=null==e?void 0:e.lastMsg)||void 0===i?void 0:i.time)||e.updateTime||0},u=function(e){return Ym({scene:{type:"enum",values:Cm}},e)}({scene:a});"superTeam"===a?r.params.push(c):n.params.push(oc(oc({},c),u))}catch(e){t.logger.warn(e)}})),{superTeam:r,p2pOrTeam:n}},e}(),zy=function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o},Gy=function(e,t,r){if(!gu(r))return!1;var n=typeof t;return!!("number"==n?cp(r)&&mf(t,r.length):"string"==n&&t in r)&&bd(r[t],e)},Jy=Math.ceil,Ky=Math.max,Qy=function(e,t,r){t=(r?Gy(e,t,r):void 0===t)?1:Ky(Ny(t),0);var n=null==e?0:e.length;if(!n||t<1)return[];for(var i=0,o=0,s=Array(Jy(n/t));i<n;)s[o++]=zy(e,i,i+=t);return s};function Yy(e,t){var r,n=void 0!==Ui&&am(e)||e["@@iterator"];if(n)return Jt(r=(n=n.call(e)).next).call(r,n);if(Ll(e)||(n=function(e,t){var r;if(e){if("string"==typeof e)return Xy(e,t);var n=Ja(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?sm(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xy(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Xy(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Zy,eb,tb=function(e){function t(t,r){var n;return(n=e.call(this,"session",t)||this).list=new Bc,n.unreadCountFilterFn=function(e){return!0},n.lastMessageFilterFn=function(e){return!0},n.initEventListeners(),El({cmdMap:jy,cmdConfig:$y}),"function"==typeof(null==r?void 0:r.unreadCountFilterFn)&&(n.unreadCountFilterFn=r.unreadCountFilterFn),"function"==typeof(null==r?void 0:r.lastMessageFilterFn)&&(n.lastMessageFilterFn=r.lastMessageFilterFn),n.stickTopService=new Wy(t),n.unreadModule=new qy(t),n}Qt(t,e);var r=t.prototype;return r.initEventListeners=function(){var e,t,r,n=this;this.core.eventBus.on("session/syncMsgs",Jt(e=this.onSyncMsgs).call(e,this)),this.core.eventBus.on("session/updateForNewMsg",Jt(t=this.updateSessionWithMsg).call(t,this)),this.core.eventBus.on("session/updateForClearMsg",(function(e,t){void 0===t&&(t=!0),e&&e.length>0&&so(e).call(e,(function(e){n.updateSession({id:e.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},t)}))})),this.core.eventBus.on("session/updateForDeletedMsg",Jt(r=this.updateSessionForDeletedMsg).call(r,this))},r.createSession=function(e,t){try{var r=qp(e);return{id:e,scene:r.scene,to:r.accid,lastMsg:t,updateTime:t?t.time:0,unread:0,unreadMsgs:[],ack:0}}catch(t){throw this.logger.error("Failed to create session with "+e,t),new Error("Failed to create session with "+e)}},r.getSession=function(e){return mp({id:{type:"string",allowEmpty:!1}},e),this.list.get(e.id)},r.getSessions=function(e){mp({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},e);var t=[],r=e.limit,n=void 0===r?100:r,i=e.desc,o=void 0===i||i,s=e.lastSessionId,a=0;if(o){for(var c,u,l=Yy(this.list);!(u=l()).done;){var d=u.value,p=d[0],m=d[1];if(s===p)break;void 0!==m.lastMsg&&t.push(m)}return Ba(c=Ja(t).call(t,-n)).call(c)}for(var f,h=Yy(this.list);!(f=h()).done;){var g=f.value,v=g[0],y=g[1];if(s)v===s&&(s=void 0);else if(void 0!==y.lastMsg){if(++a>n)break;t.push(y)}}return t},r.resetSessionUnreadCount=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i,o,s,a,c,u,l,d=this;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(mp({id:{type:"string",allowEmpty:!1}},e),mp({id:{type:"string",allowEmpty:!1}},e),n=e.id,i=this.list.get(n)){r.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+n),new Error("Session::canSessionResetUnreadCount: can not find session "+n);case 7:o=!1;try{o=this.unreadModule.canSessionResetUnreadCount(i)}catch(e){this.logger.warn(e)}if(!1!==o){r.next=11;break}return r.abrupt("return");case 11:return s=qp(n),a=s.accid,c=s.scene,u={to:a,timetag:(null===(t=null==i?void 0:i.lastMsg)||void 0===t?void 0:t.time)||i.updateTime||0},l="markSuperTeamSessionAck","superTeam"!==c&&(u.scene="p2p"===c?0:1,l="markSessionAck"),r.abrupt("return",this.core.sendCmd(l,u).then((function(){var e=d.storeUnreadByAck(n,u.timetag);e&&d.core.emit("updateSession",e)})));case 16:case"end":return r.stop()}}),r,this)})))},r.resetMultiSessionUnreadCount=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a,c,u,l,d,p,m,f,h,g=this;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:mp({ids:{type:"array",itemType:"string",min:1}},e),i=Ep(r=Vu(n=e.ids).call(n,(function(e){return g.list.get(e)}))).call(r,(function(t,r){return!!t||(g.logger.warn("Session::canSessionResetUnreadCount: can not find session "+e.ids[r]),!1)})),o=this.unreadModule.filterSessionForResetUnreadCount(i),s=o.superTeam,a=o.p2pOrTeam,c=Qy(s.params,10),u=Qy(a.params,10),l=Yy(c);case 6:if((d=l()).done){t.next=13;break}return p=d.value,t.next=10,this.core.sendCmd(s.cmd,{datas:p});case 10:so(p).call(p,(function(e){var t=g.storeUnreadByAck(e.sessionId,e.timetag);t&&g.core.emit("updateSession",t)}));case 11:t.next=6;break;case 13:m=Yy(u);case 14:if((f=m()).done){t.next=21;break}return h=f.value,t.next=18,this.core.sendCmd(a.cmd,{datas:h});case 18:so(h).call(h,(function(e){var t=g.storeUnreadByAck(e.sessionId,e.timetag);t&&g.core.emit("updateSession",t)}));case 19:t.next=14;break;case 21:case"end":return t.stop()}}),t,this)})))},r.resetAllSessionsUnreadCount=function(){var e,t=[];return so(e=this.list).call(e,(function(e){t.push(e.id)})),this.resetMultiSessionUnreadCount({ids:t})},r.deleteSession=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(mp({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},e),this.list.delete(e.id),!this.core.msgLog||!e.isSyncToServer){t.next=5;break}return t.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[e.id]});case 5:case"end":return t.stop()}}),t,this)})))},r.deleteAllSessionsFromLocal=function(){this.list.clear()},r.addStickTopSession=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.addStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.deleteStickTopSession=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.deleteStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.updateStickTopSession=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.updateStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.nimMultiSyncAddStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimMultiSyncDeleteStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler({id:e.content.data.id,updateTime:e.content.timetag},!1);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimMultiSyncUpdateStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimSyncStickTopSessionsHandler=function(e){var t=this,r=e.content.datas;so(r).call(r,(function(e){var r=t.stickTopService.stickTopSessionHandler(e);t.list.set(r.id,r)}))},r.updateSessionWithMsg=function(e){var t=!0,r=!0;try{t=!!this.unreadCountFilterFn(e)}catch(e){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",e)}try{r=!!this.lastMessageFilterFn(e)}catch(e){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",e)}var n=this.list.get(e.sessionId)||this.createSession(e.sessionId),i=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",e.sessionId,e.idClient,e.idServer,r,t),r&&(!n.lastMsg||n.lastMsg.time<e.time||e.status===km[km.sending]||n.lastMsg.status===km[km.sending])&&(n.lastMsg=e,n.updateTime=e.time,i=!0),t&&e.status===km[km.unread]&&e.time>(n.ack||0)){n.unread++;var o=n.unreadMsgs||[];o.unshift(e),nh(o).call(o,(function(e,t){return t.time-e.time})),i=!0}i&&(this.logger.log("session:updateSessionWithMsg updating ",n.id,n.unread,n.lastMsg&&n.lastMsg.idClient),this.list.set(n.id,n),this.core.emit("updateSession",n))},r.storeUnreadByAck=function(e,t){var r=this.list.get(e)||this.createSession(e);if(!(r.ack&&t<r.ack)){var n=r.unreadMsgs||[],i=[],o=0;return r.unreadMsgs=[],n.length>0&&(so(n).call(n,(function(e){e.time>t&&(o++,i.push(e))})),r.unreadMsgs=nh(i).call(i,(function(e,t){return t.time-e.time}))),r.ack=t,r.unread=o,r.lastMsg&&"unread"===r.lastMsg.status&&t>=r.lastMsg.time&&(r.lastMsg.status="read"),this.list.set(e,r),r}this.logger.warn("storeUnreadByAck: not need update ack",e,t,r.ack)},r.updateSession=function(e,t){void 0===t&&(t=!0);var r=e.id,n=this.list.get(r)||this.createSession(e.id),i=oc(n,e);return this.list.set(r,i),this.logger.log("updateSession: update",t,Dg(e,["id","ack","unread"]),i.lastMsg&&i.lastMsg.idClient),t&&this.core.emit("updateSession",i),i},r.syncSessionAckHandler=function(e){var t,r,n=this,i=e.content.p2p||{},o=e.content.team.m_map||{};this.logger.log("syncSessionAck::",i,o),so(t=ec(i)).call(t,(function(e){n.updateSession({id:"p2p-"+e,ack:i[e]},!1)})),so(r=ec(o)).call(r,(function(e){n.updateSession({id:"team-"+e,ack:o[e]},!1)}))},r.syncSuperTeamSessionAckHandler=function(e){var t,r=this,n=e.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",n),so(t=ec(n)).call(t,(function(e){r.updateSession({id:"superTeam-"+e,ack:n[e]},!1)}))},r.syncMarkSessionAckHandler=function(e){var t=e.content,r=(0===t.scene?"p2p":1===t.scene?"team":"superTeam")+"-"+t.to,n=this.list.get(r);if(n&&n.ack&&t.timetag<n.ack)this.logger.warn("syncMarkSessionAckHandler: "+r+" do not need update ack",n.ack,t.timetag);else{var i=this.storeUnreadByAck(r,t.timetag);i&&this.core.emit("updateSession",i)}},r.syncMarkSuperTeamSessionAckHandler=function(e){e.content.scene=5,this.syncMarkSessionAckHandler(e)},r.onSyncDone=function(){var e,t,r,n=this,i=[];so(e=this.list).call(e,(function(e,t){i.push(n.storeUnreadByAck(t,e.ack||0))})),this.list.clear(),so(t=nh(i).call(i,(function(e,t){return e.updateTime-t.updateTime}))).call(t,(function(e){n.list.set(e.id,e)})),(i=nh(r=Ep(i).call(i,(function(e){return e.lastMsg}))).call(r,(function(e,t){return t.updateTime-e.updateTime}))).length>0&&this.core.emit("sessions",i)},r.onSyncMsgs=function(e){var t,r=this,n=this.list.get(e.sessionId),i=[];try{var o;i=Ep(o=e.msgs).call(o,(function(e){return r.unreadCountFilterFn(JSON.parse(Qc(e)))}))}catch(e){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",e)}var s,a=[];try{var c;a=Ep(c=e.msgs).call(c,(function(e){return r.lastMessageFilterFn(JSON.parse(Qc(e)))}))}catch(e){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",e)}a&&a.length>0&&(s=a[a.length-1],s=a[0].time>s.time?a[0]:s);var u=s?s.time:0;n||(n=s?this.createSession(e.sessionId,s):this.createSession(e.sessionId)),n.unreadMsgs=n.unreadMsgs?Ep(t=hc(i).call(i,n.unreadMsgs)).call(t,(function(e){return e.status===km[km.unread]})):Ep(i).call(i,(function(e){return e.status===km[km.unread]})),n.updateTime&&n.updateTime>=u||(n.updateTime=u),n.lastMsg&&n.lastMsg.time>=u||(n.lastMsg=s),this.list.set(n.id,n)},r.updateSessionForDeletedMsg=function(e){var t,r=this,n={};so(e).call(e,(function(e){var t=e.to===r.core.account?e.from:e.to,i=e.scene+"-"+t,o=r.list.get(i);if(o){if((o.ack||0)<e.time&&e.from!==r.core.account&&o.unread>0&&(o.unread=o.unread-1,o.unreadMsgs&&o.unreadMsgs.length>0)){var s,a=Ly(o.unreadMsgs,{idClient:e.idClient});a>=0&&rm(s=o.unreadMsgs).call(s,a,1)}o.lastMsg&&o.lastMsg.idClient===e.idClient&&(o.lastMsg=null),n[o.id]=!0}})),so(t=ec(n)).call(t,(function(e){var t=r.list.get(e);t&&r.core.emit("updateSession",t)}))},r.multiSyncMsgReceiptHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.msgReceiptTag;r&&this.updateSessionMsgReceiptTime([r],!0)},r.syncMsgReceiptsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.msgReceipts;r&&this.updateSessionMsgReceiptTime(r,!1)},r.updateSessionMsgReceiptTime=function(e,t){var r=this;void 0===t&&(t=!0),e&&e.length>0&&so(e).call(e,(function(e){var n=r.list.get("p2p-"+e.from);if(n){var i=Bp(e.time);n.msgReceiptTime&&n.msgReceiptTime>=i||(n.msgReceiptTime=i,n.lastMsg&&"sent"===n.lastMsg.status&&i>=n.lastMsg.time&&(n.lastMsg.status="receipt"),r.logger.log("session: update session "+n.id+" msgReceiptTime: "+n.msgReceiptTime),r.list.set(n.id,n),t&&r.core.emit("updateSession",n))}}))},r.nimSyncSessionsWithMoreRoamingHandler=function(e){var t=function(e,t){return Vu(e).call(e,(function(e){var r=Jm(Hy,e);return r.sessionId=Fh(e,t),r}))}(e.content.datas,this.core.account);this.logger.log("session:syncSessionsWithMoreRoaming",t)},t}(Fm),rb=function(){function e(e){this.core=e}var t=e.prototype;return t.notifyAddTeamMembers=function(e,t){this.core.emit("addTeamMembers",{team:e,accounts:t,members:Ch(e,t)})},t.notifyUpdateTeamManagers=function(e,t,r,n){this.core.emit("updateTeamManagers",{team:{teamId:e,memberUpdateTime:n},accounts:t,isManager:r,members:Vu(t).call(t,(function(t){return{id:e+"-"+t,account:t,type:"manager",updateTime:n}}))})},t.notifyRemoveTeamMembers=function(e,t){this.core.emit("removeTeamMembers",{team:e,accounts:t})},t.notifyTransferTeam=function(e,t,r){this.core.emit("transferTeam",{team:e,from:{id:e.teamId+"-"+t,type:"normal",account:t,updateTime:e.memberUpdateTime},to:{id:e.teamId+"-"+r,type:"owner",account:r,updateTime:e.memberUpdateTime}})},t.notifyUpdateTeamMembersMute=function(e,t,r){this.core.emit("updateTeamMembersMute",{team:e,accounts:t,members:Vu(t).call(t,(function(t){return{id:e.teamId+"-"+t,account:t,teamId:e.teamId,mute:r,updateTime:e.memberUpdateTime}})),mute:r})},e}(),nb=function(e){function t(t){var r;return(r=e.call(this,"team",t)||this).service=new rb(t),r.core.eventBus.on("team/onNotification",(function(e){return r.notificationHandler(e)})),El({cmdMap:kh,cmdConfig:Oh}),r}Qt(t,e);var r=t.prototype;return r.getTeamInfo=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getTeamInfo",{teamId:e.teamId});case 3:return r=t.sent,n=r.content.team,t.abrupt("return",Sh(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getTeams=function(){return vc(this,void 0,void 0,Ya.mark((function e(){var t,r;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return t=e.sent,r=t.content.teams,e.abrupt("return",Th(r));case 5:case"end":return e.stop()}}),e,this)})))},r.getTeamsById=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamIds:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("getTeamsById",{teamIds:e.teamIds});case 3:return r=t.sent,n=Th(r.content.teams),t.abrupt("return",{teams:n,tids:r.content.tids});case 6:case"end":return t.stop()}}),t,this)})))},r.createTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!1,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!1,required:!1},announcement:{type:"string",allowEmpty:!1,required:!1},avatar:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=_h(e),t.next=4,this.core.sendCmd("createTeam",{team:r,accounts:e.accounts||[],ps:e.ps||""});case 4:return n=t.sent,i=Sh(n.content.team),t.abrupt("return",i);case 7:case"end":return t.stop()}}),t,this)})))},r.dismissTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("dismissTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.leaveTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("leaveTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.transferTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),t.next=3,this.core.sendCmd("transferTeam",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateTeamInfo=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!1,required:!1},announcement:{type:"string",allowEmpty:!1,required:!1},avatar:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=_h(e),t.next=4,this.core.sendCmd("updateTeamInfo",{team:r});case 4:return t.abrupt("return",Sh(r));case 5:case"end":return t.stop()}}),t,this)})))},r.getTeamMembers=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},e),r.next=3,this.core.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0});case 3:if(n=r.sent,i=xh(null===(t=n.content)||void 0===t?void 0:t.teamMembers),e.accounts&&e.accounts.length>0){r.next=7;break}return r.abrupt("return",i);case 7:return r.abrupt("return",Ep(i).call(i,(function(t){var r;return null===(r=e.accounts)||void 0===r?void 0:Ou(r).call(r,t.account)})));case 8:case"end":return r.stop()}}),r,this)})))},r.getMutedTeamMembers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:e.teamId});case 3:return r=t.sent,n=r.content,t.abrupt("return",xh(n.teamMembers));case 6:case"end":return t.stop()}}),t,this)})))},r.addTeamMembers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("addTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return t.stop()}}),t,this)})))},r.removeTeamMembers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("removeTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return t.stop()}}),t,this)})))},r.applyTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("applyTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return r=t.sent,t.abrupt("return",Sh(r.content.team));case 5:case"end":return t.stop()}}),t,this)})))},r.addTeamManagers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("addTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.removeTeamManagers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("removeTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!1,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),r=wh({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),t.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:r});case 4:return n=Mh(oc({updateTime:(new Date).getTime(),account:this.core.account},r)),this.core.emit("updateTeamMember",n),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)})))},r.updateMemberNick=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!1}},e),r=wh({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),t.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:r});case 4:return n=Mh(oc({updateTime:(new Date).getTime()},r)),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.muteTeamMember=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteTeamMember",{teamId:e.teamId,account:e.account,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.getTeamMemberInvitorAccid=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},e),n={teamId:e.teamId},e.accounts&&e.accounts.length>0&&(n.accounts=e.accounts),r.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",n);case 5:return i=r.sent,r.abrupt("return",(null===(t=i.content)||void 0===t?void 0:t.accountsMap)||{});case 7:case"end":return r.stop()}}),r,this)})))},r.muteTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.passTeamApply=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("passTeamApply",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectTeamApply=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("rejectTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 3:case"end":return t.stop()}}),t,this)})))},r.acceptTeamInvite=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("acceptTeamInvite",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectTeamInvite=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("rejectTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 3:case"end":return t.stop()}}),t,this)})))},r.notifyTeamMsgReceiptsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.teamMsgReceipts;r&&r.length>0&&this.core.emit("teamMsgReceipts",r)},r.syncTeamsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{teams:Bp(t.timetag)});var r=null==t?void 0:t.teams;if(r&&r.length){var n=Th(r);this.core.emit("teams",n)}},r.syncCreateTeamHandler=function(e){var t=e.content,r=Sh(null==t?void 0:t.team),n=Eh(r,r.owner,"owner");this.core.emit("createTeam",r,n)},r.syncUpdateTeamMemberHandler=function(e){var t=e.content,r=Mh(null==t?void 0:t.teamMember);r.updateTime||(r.updateTime=(new Date).getTime()),this.core.emit("updateTeamMember",r)},r.notificationHandler=function(e){var t=e.attach,r=e.scene,n=e.from,i=e.to,o=e.time,s=e.idServer,a=e.idClient,c=t.team,u=t.account,l=t.accounts,d=t.type;if("team"===r)switch("debug"===this.core.options.debugLevel?this.logger.debug("team::recvNotification",s,a,t):this.logger.log("team::recvNotification",s,a,i,d,u,l),d){case"updateTeam":c.updateTime=o,this.core.emit("updateTeam",c);break;case"addTeamMembers":this.service.notifyAddTeamMembers(c,l);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(c,[n]);break;case"passTeamApply":this.service.notifyAddTeamMembers(c,[u]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(i,l,!0,o);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(i,l,!1,o);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(c,l);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(c,[n]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:i});break;case"transferTeam":this.service.notifyTransferTeam(c,n,u);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(c,[u],t.mute)}},t}(Fm);!function(e){e[e.none=0]="none",e[e.pass=1]="pass",e[e.decline=2]="decline",e[e.read=3]="read",e[e.deleted=4]="deleted",e[e.invalid=5]="invalid"}(Zy||(Zy={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(eb||(eb={}));var ib={applyTeam:0,rejectTeamApply:1,teamInvite:2,rejectTeamInvite:3,friendRequest:5,deleteFriend:6,recallMsgP2p:7,recallMsgTeam:8,recallMsgSuperTeam:12,deleteMsgP2pOneWay:13,deleteMsgTeamOneWay:14,applySuperTeam:15,rejectSuperTeamApply:16,superTeamInvite:17,rejectSuperTeamInvite:18,customP2p:100,customTeam:101,customSuperTeam:103},ob={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},sb={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:{needPush:{type:"boolean"},needPushBadge:{type:"boolean"},needPushNick:{type:"boolean"},pushApnsText:{type:"string"},pushPayload:{type:"string"},needForcePush:{type:"boolean"},forcePushIDsList:{type:"string"},pushContent:{type:"string",rawKey:"forcePushContent"}},recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function ab(e,t,r){var n=+e.type,i=Wp(ib,n);r=r||eb.default;var o=oc(oc({},Jm(sb,e)),{type:i,time:+e.time,to:e.to,from:e.from,idServer:e.idServer,state:Zy[Zy.none],feature:eb[r]});if("string"==typeof o.attach)try{o.attach=JSON.parse(o.attach)}catch(e){t.error("formatSystemMessage: "+o.idServer+" parse attach error",e&&e.message)}return 5===n&&o.attach?(o.attach.type=ob[+o.attach.vt],"passFriendApply"===o.attach.type?o.state=Zy[Zy.pass]:"rejectFriendApply"===o.attach.type&&(o.state=Zy[Zy.decline])):n<=3&&o.attach&&(o.attach=function(e){var t=e.attach,r=e.tinfo,n=gc(e,["attach","tinfo"]);return n.ext=t,void 0!==r&&(n.team=Sh(xl(e.tinfo,Ih.team))),n}(o.attach)),o}function cb(e){var t=oc({},e);return oc(oc({},Ym(sb,t)),{type:ib[t.type],to:t.to,attach:t.attach})}var ub={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","4_101":"syncOfflineSysMsgs","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg","101_3":"onSysMsg","101_7":"sendFilterCustomSysMsg"},lb={sysMsg:{time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,pushApnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,envConfig:21,callbackExt:22,isRoutable:105,needPush:107,needPushBadge:109,needPushNick:110}},db=Cl(lb),pb={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:db.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:lb.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:lb.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:lb.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,isNoResponse:!0,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:db.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:db.sysMsg},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:db.sysMsg}]}},mb=function(e){function t(t){var r;return(r=e.call(this,"systemMessage",t)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},r.core.eventBus.on("logined",(function(){r.initEventListeners()})),El({cmdMap:ub,cmdConfig:pb}),r}Qt(t,e);var r=t.prototype;return r.initEventListeners=function(){var e=this;this.core.eventBus.on("systemMessage/passFriendApply",(function(t){e.core.emit("updateSystemMessages",[{idServer:t.idServer,from:t.account,state:"pass",type:"friendRequest"}])})),this.core.eventBus.on("systemMessage/rejectFriendApply",(function(t){e.core.emit("updateSystemMessages",[{idServer:t.idServer,from:t.account,state:"decline",type:"friendRequest"}])}))},r.doMarkSysMsgAck=function(e){var t=[],r=[],n=["applySuperTeam","rejectSuperTeamApply","superTeamInvite","rejectSuperTeamInvite","customSuperTeam"];so(e).call(e,(function(e){e.idServer&&(Ou(n).call(n,e.type)?r.push(e.idServer):t.push(e.idServer))})),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:t}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:r})},r.sendCustomSysMsg=function(e){var t=this;mp({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:{needPush:{type:"boolean",required:!1},pushApnsText:{type:"string",required:!1},pushPayload:{type:"string",required:!1}}}},e);var r="customSuperTeam"===e.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(r,{sysMsg:cb(e)}).then((function(){t.logger.log("sendCustomSysMsg success")})).catch((function(e){throw t.logger.error("sendCustomSysMsg failed",e.message),e}))},r.onSysMsgHandler=function(e){var t=e.content.sysMsg;if(t){var r=ab(t,this.logger,eb.default);this.core.emit("sysMsg",r),this.doMarkSysMsgAck([r])}else this.logger.warn("onSysMsg no content.sysMsg")},r.syncOfflineSysMsgsHandler=function(e){var t,r=this;if(e.content.sysMsgs&&e.content.sysMsgs.length>0){var n=Vu(t=e.content.sysMsgs).call(t,(function(e){return ab(e,r.logger,eb.leave)}));this.core.emit("syncSysMsgs",n),this.doMarkSysMsgAck(n)}},r.onRecallMsgHandler=function(e){var t=e.content.sysMsg;if(t){var r=Vh([t],function(e){return e===ib.recallMsgP2p?"p2p":e===ib.recallMsgTeam?"team":e===ib.recallMsgSuperTeam?"superTeam":""}(+t.type));this.core.eventBus.emit("session/updateForDeletedMsg",r);var n=ab(t,this.logger,eb.default);this.core.emit("sysMsg",n),this.doMarkSysMsgAck([n])}else this.logger.warn("onSysMsg no content.sysMsg")},r.syncRecallMsgOfflineAndRoamingHandler=function(e){var t=this,r=e.content,n=r.timetag,i=r.type,o=r.sysMsgs,s=Bp(i),a=1===s?eb.leave:eb.roam,c=Vu(o).call(o,(function(e){return ab(e,t.logger,a)}));1===s&&this.doMarkSysMsgAck(c),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:n}),this.core.emit("syncSysMsgs",c)},t}(Fm);function fb(e){var t=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],r=oc({},e);return so(t).call(t,(function(e){void 0!==r[e]&&(r[e]=Bp(r[e]))})),void 0!==r.relationShip&&(r.valid=1===r.relationShip),r}var hb={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},gb={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},vb={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},yb=Cl(vb),bb={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:yb.friendTag},{type:"Number",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:vb.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:vb.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:yb.friendTag},{type:"Number",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:yb.userTag},{type:"Number",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:yb.friendTag}]}},Sb=function(e){function t(t){var r;return r=e.call(this,"friend",t)||this,El({cmdMap:gb,cmdConfig:bb}),r}Qt(t,e);var r=t.prototype;return r.getFriends=function(){var e;return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return r=t.sent,n=(null===(e=r.content)||void 0===e?void 0:e.friends)||[],n=Vu(n).call(n,(function(e){return fb(e)})),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.addFriend=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:1,ps:e.ps||""});case 3:return r=(new Date).getTime(),t.abrupt("return",{account:e.account,createTime:r,updateTime:r,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 5:case"end":return t.stop()}}),t,this)})))},r.applyFriend=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({account:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:2,ps:e.ps||""});case 3:case"end":return t.stop()}}),t,this)})))},r.passFriendApply=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r=this;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({account:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:3,ps:e.ps||""}).then((function(t){return r.core.eventBus.emit("systemMessage/passFriendApply",e),t}));case 3:case"end":return t.stop()}}),t,this)})))},r.rejectFriendApply=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r=this;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({account:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:4,ps:e.ps||""}).then((function(t){return r.core.eventBus.emit("systemMessage/rejectFriendApply",e),t}));case 3:case"end":return t.stop()}}),t,this)})))},r.deleteFriend=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},e),t.next=3,this.core.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:!0===e.delAlias?1:0}});case 3:case"end":return t.stop()}}),t,this)})))},r.updateFriend=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:e});case 3:case"end":return t.stop()}}),t,this)})))},r.syncFriendRequestHandler=function(e){var t=function(e){var t=oc({},e);try{t.ps=t.ps&&JSON.parse(t.ps)}catch(e){}if(t.type=hb[t.type],"addFriend"===t.type||"passFriendApply"===t.type){var r=(new Date).getTime();t.friend={account:e.account,alias:"",createTime:r,ext:"",updateTime:r,valid:!0}}return t}(e.content);this.core.emit("syncFriend",t)},r.syncDeleteFriendHandler=function(e){var t=e.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+t),this.core.emit("syncFriend",{type:"deleteFriend",account:t})},r.syncUpdateFriendHandler=function(e){var t=fb(e.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==t?void 0:t.account),this.core.emit("syncFriend",{type:"updateFriend",friend:t})},r.syncFriendsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friends:Bp(t.timetag)});var r=null==t?void 0:t.friends;if(r&&r.length){var n=Vu(r).call(r,(function(e){return fb(e)}));this.core.emit("friends",n)}},r.syncFriendUsersHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:Bp(t.timetag)});var r=null==t?void 0:t.users;if(r&&r.length){var n=Vu(r).call(r,(function(e){return Rh(e)}));this.core.emit("users",n)}},t}(Fm),Tb={1:"Android",2:"iOS",4:"PC",8:"WindowsPhone",16:"Web",32:"Server",64:"Mac"};function _b(e){return e&&e.length>0?Vu(e).call(e,(function(e){return function(e){var t=oc({},e),r=["subscribeTime","time"];return so(r).call(r,(function(e){t[e]&&(t[e]=Bp(t[e]))})),t}(e)})):[]}function wb(e){if(!e)return e;var t=e.serverExt,r=gc(e,["serverExt"]),n=["time","type","value"];if(so(n).call(n,(function(e){r[e]&&(r[e]=Bp(r[e]))})),r.clientType&&(r.clientType=Tb[r.clientType]||""),t)try{r.ext=JSON.parse(t),"string"==typeof r.ext[0]&&(r.ext=r.ext[0])}catch(e){}return r}var Mb={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},xb={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},Eb=Cl(xb),Cb={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:xb.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:Eb.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:Eb.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:xb.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:xb.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:xb.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:xb.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Eb.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:xb.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Eb.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:Eb.msgEvent}]}},Rb=function(e){function t(t){var r;return r=e.call(this,"event",t)||this,El({cmdMap:Mb,cmdConfig:Cb}),r}Qt(t,e);var r=t.prototype;return r.publishEvent=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i,o;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return mp({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},e),n=oc(oc({validTime:604800},e),{idClient:Vp(),sync:!0===e.sync?1:0}),r.next=4,this.core.sendCmd("publishEvent",{msgEvent:n});case 4:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.msgEvent)||{},r.abrupt("return",wb(o));case 7:case"end":return r.stop()}}),r,this)})))},r.subscribeEvent=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i,o;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return mp({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},e),n=oc(oc({subscribeTime:2592e3},e),{sync:!0===e.sync?1:0}),r.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:n,accounts:e.accounts});case 4:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.accounts)||[],r.abrupt("return",{failedAccounts:o});case 7:case"end":return r.stop()}}),r,this)})))},r.unSubscribeEvents=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i,o;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(mp({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),n={type:e.type},!(e.accounts&&e.accounts.length>0)){r.next=9;break}return r.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:n,accounts:e.accounts});case 5:o=r.sent,i=(null===(t=o.content)||void 0===t?void 0:t.accounts)||[],r.next=12;break;case 9:return r.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:n});case 11:i=[];case 12:return r.abrupt("return",{failedAccounts:i});case 13:case"end":return r.stop()}}),r,this)})))},r.querySubscribeEvents=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(mp({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),!(e.accounts&&e.accounts.length>0)){r.next=7;break}return r.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:e.type},accounts:e.accounts});case 4:n=r.sent,r.next=10;break;case 7:return r.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:e.type}});case 9:n=r.sent;case 10:return r.abrupt("return",_b(null===(t=n.content)||void 0===t?void 0:t.msgEventSubscribes));case 11:case"end":return r.stop()}}),r,this)})))},r.pushEventHandler=function(e){var t,r=(null===(t=e.content)||void 0===t?void 0:t.msgEvent)||{};this.core.emit("pushEvents",[wb(r)])},r.pushEventsHandler=function(e){var t,r=(null===(t=e.content)||void 0===t?void 0:t.msgEvents)||{};this.core.emit("pushEvents",function(e){return Ll(e)&&e.length>0?Vu(e).call(e,(function(e){return wb(e)})):[]}(r))},t}(Fm);function kb(e){var t={scene:Pf[e.scene],from:e.threadMsgFromAccount,to:e.threadMsgToAccount,time:e.threadMsgTime,idServer:e.threadMsgIdServer},r={limit:e.limit<100?e.limit:100,beginTime:"number"==typeof e.beginTime?e.beginTime:0,reverse:!0===Ba(e)?1:0};return e.lastMsgId&&(r.lastMsgId=e.lastMsgId),{msg:t,threadMsgReq:r}}var Ab,Ib={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},Ob={msg:Gh,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},Pb=Cl(Ob),Nb={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:Ob.msg},{type:"Property",name:"threadMsgReq",reflectMapper:Ob.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:Pb.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:Pb.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:Pb.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:Ob.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Pb.msg}]}},Db=function(e){function t(t){var r;return r=e.call(this,"msgExtend",t)||this,El({cmdMap:Ib,cmdConfig:Nb}),r}Qt(t,e);var r=t.prototype;return r.getThreadMsgs=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a,c;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({scene:{type:"enum",values:Hp(Cm)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("getThreadMsgs",kb(e));case 3:return r=t.sent,n=r.content,i=n.msgs,o=n.threadMsg,s=r.content.threadMsgsMeta,a=Fh(o,this.core.account),c=this.core.session&&this.core.session.getSession&&this.core.session.getSession({id:a}),i=Bh(i,c?{account:this.core.account,sessionAck:c.ack,msgReceiptTime:c.msgReceiptTime}:{account:this.core.account}),o=$h(o,c?{account:this.core.account,sessionAck:c.ack,msgReceiptTime:c.msgReceiptTime}:{account:this.core.account}),t.abrupt("return",{msgs:i,threadMsg:o,total:Bp(s.total),timetag:Bp(s.lastMsgTime)});case 11:case"end":return t.stop()}}),t,this)})))},r.getMsgsByIdServer=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s=this;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:Hp(Cm)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},e),t.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:Vu(r=e.reqMsgs).call(r,(function(e){return oc(oc({},e),{scene:Wp(Cm,e.scene)})}))});case 3:return i=t.sent,o=Vu(n=i.content.msgs).call(n,(function(e){var t=Fh(e,s.core.account),r=s.core.session&&s.core.session.getSession&&s.core.session.getSession({id:t});return $h(e,r?{account:s.core.account,sessionAck:r.ack,msgReceiptTime:r.msgReceiptTime}:{account:s.core.account})})),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t,this)})))},t}(Fm);!function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(Ab||(Ab={}));var Lb,jb={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},Ub={msg:Gh,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},Fb=Cl(Ub),$b={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Fb.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:Ub.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:Fb.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:Fb.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:Ub.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Fb.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:Ub.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Fb.msg}]}};!function(e){e[e.p2p=1]="p2p",e[e.team=2]="team"}(Lb||(Lb={}));var Bb={type:{type:"enum",values:Lb},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function Vb(e){var t=Jm(Bb,e);return{sessionId:"p2p"===t.type?"p2p-"+t.otherAccid:"team-"+t.toTid,time:t.time}}var Hb={orderRule:{type:"enum",values:Ab}};function Wb(e){var t,r=Jm(Hb,e);Ll(r.msgTypeList)&&(r.msgTypeList=Vu(t=r.msgTypeList).call(t,(function(e){return Em[e]})).join(","));var n=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return so(n).call(n,(function(e){Ll(r[e])&&(r[e]=r[e].join(","))})),r}var qb=function(e){function t(t){var r;return r=e.call(this,"msgLog",t)||this,El({cmdMap:jb,cmdConfig:$b}),r}Qt(t,e);var r=t.prototype;return r.deleteRoamingMsgs=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:mp({ids:{type:"array",itemType:"string"}},e),r=[],t.prev=2,r=Vu(n=e.ids).call(n,(function(e){var t=qp(e);return t.scene+"|"+t.accid})),t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(2),this.logger.error("Failed to delete roaming msgs with "+e.ids,t.t0),new Error("Failed to create session with "+e.ids);case 10:return t.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:r});case 12:case"end":return t.stop()}}),t,this,[[2,6]])})))},r.getHistoryMsgs=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a,c;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({scene:{type:"enum",values:ec(Pf)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},e),n="p2p"===e.scene?"getHistoryMsgs":"team"===e.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",t.next=4,this.core.sendCmd(n,oc(oc({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},e),{msgTypes:e.msgTypes?Vu(r=e.msgTypes).call(r,(function(e){return hf[e]})):[]}));case 4:if(i=t.sent,(o=i.content).msgs&&o.msgs.length>0){t.next=8;break}return t.abrupt("return",[]);case 8:if(s=Fh(o.msgs[0],this.core.account),a=this.core.session&&this.core.session.getSession&&this.core.session.getSession({id:s}),c=Bh(o.msgs,a?{account:this.core.account,sessionAck:a.ack,msgReceiptTime:a.msgReceiptTime}:{account:this.core.account}),!0!==e.asc){t.next=13;break}return t.abrupt("return",nh(c).call(c,(function(e,t){return e.time-t.time})));case 13:return t.abrupt("return",c);case 14:case"end":return t.stop()}}),t,this)})))},r.clearHistoryMsgsFromServer=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},e),(r=oc(oc({isDeleteRoam:1},e),{type:"team"===e.scene?2:1,isSyncSelf:!0===e.isSyncSelf?1:0}))[2===r.type?"toTid":"otherAccid"]=e.to,t.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:r});case 5:return n=t.sent,i=n.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:e.scene+"-"+e.to}],!0),t.abrupt("return",i);case 9:case"end":return t.stop()}}),t,this)})))},r.multiSyncClearServerHistoryMsgsHandler=function(e){var t=Vb(e.content.data);this.core.eventBus.emit("session/updateForClearMsg",[t],!0),this.core.emit("clearServerHistoryMsgs",[t])},r.ftsCloudMsgLogs=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogs"));case 1:case"end":return t.stop()}}),t,this)})))},r.ftsCloudMsgLogsAggWithSession=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return t.stop()}}),t,this)})))},r.baseFtsCloudMsgLogs=function(e,t){return vc(this,void 0,void 0,Ya.mark((function r(){var n,i,o,s=this;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(mp({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:Hp(Ab),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:Hp(Em),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},e),!(e.fromTime&&e.toTime&&e.toTime<e.fromTime)){r.next=3;break}throw new rl("Request parameter error: toTime should be greater than fromTime",e,"");case 3:return i=Wb(e),r.next=6,this.core.sendCmd(t,{tag:i});case 6:return o=r.sent,r.abrupt("return",Vu(n=o.content.datas).call(n,(function(e){var t=Fh(e,s.core.account),r=s.core.session&&s.core.session.getSession&&s.core.session.getSession({id:t});return $h(e,r?{account:s.core.account,sessionAck:r.ack,msgReceiptTime:r.msgReceiptTime}:{account:s.core.account})})));case 8:case"end":return r.stop()}}),r,this)})))},r.syncClearServerHistoryMsgsHandler=function(e){var t=function(e){return Ll(e)&&e.length>0?Vu(e).call(e,(function(e){return Vb(e)})):[]}(e.content.datas);this.core.emit("clearServerHistoryMsgs",t)},t}(Fm),zb={"22_1":"requestProxy","22_2":"onRequestProxy"},Gb={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},Jb=Cl(Gb),Kb={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:Gb.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:Jb.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:Jb.requestProxyMsgTag}]}},Qb=function(e){function t(t){var r;return(r=e.call(this,"passThrough",t)||this).core=t,El({cmdMap:zb,cmdConfig:Kb}),r}Qt(t,e);var r=t.prototype;return r.request=function(e){return mp({path:{type:"string",allowEmpty:!1}},e),this.core.sendCmd("requestProxy",{requestProxyTag:e}).then((function(e){return e.content.proxyTag}))},r.onRequestProxyHandler=function(e){var t=e.content.proxyMsg;t&&t.time&&(t.time=+t.time),this.core.emit("proxyMsg",t)},t}(Fm),Yb=ln.some,Xb=eo("some");nt({target:"Array",proto:!0,forced:!Xb},{some:function(e){return Yb(this,e,arguments.length>1?arguments[1]:void 0)}});var Zb,eS,tS=qt("Array").some,rS=Array.prototype,nS=function(e){var t=e.some;return e===rS||V(rS,e)&&t===rS.some?tS:t},iS=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ag(t,$v(e)),e=Bm(e);return t}:Lv,oS=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},sS=Object.prototype.hasOwnProperty,aS=function(e){if(!gu(e))return oS(e);var t=_f(e),r=[];for(var n in e)("constructor"!=n||!t&&sS.call(e,n))&&r.push(n);return r},cS=function(e){return cp(e)?Sf(e,!0):aS(e)},uS=function(e){return Nv(e,cS,iS)},lS=function(e,t){if(null==e)return{};var r=Jd(uS(e),(function(e){return[e]}));return t=_y(t),xg(e,r,(function(e,r){return t(e,r[0])}))},dS={"6_2":"getNosToken","6_22":"getOriginUrl","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},pS={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,fileExpireSec:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4}},mS=Cl(pS),fS={getNosToken:{sid:6,cid:2,service:"cloudStorage",response:[{type:"Property",name:"nosToken",reflectMapper:mS.nosToken}],params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:pS.nosToken}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:mS.nosSafeUrlTag}],params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:pS.nosSafeUrlTag}]},getNosCdnHost:{sid:6,cid:26,service:"misc",response:[{type:"Property",name:"nosConfigTag",reflectMapper:mS.nosConfigTag}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",response:[{type:"Property",name:"grayConfigTag",reflectMapper:mS.grayConfigTag}],params:[{type:"Property",name:"config"}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:mS.mixStorePolicyTag}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:pS.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:mS.mixStoreTokenResTag}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:pS.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:mS.mixStoreAuthTokenResTag}]}},hS={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},gS={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function vS(e){return void 0===e&&(e="file"),Qc(hS[e]||{}).replace(/"/gi,'\\"')}!function(e){e[e.nos=1]="nos",e[e.s3=2]="s3"}(Zb||(Zb={})),function(e){e[e.dontNeed=-1]="dontNeed",e[e.time=2]="time",e[e.urls=3]="urls"}(eS||(eS={}));var yS=function(e){function t(t,r){var n;return(n=e.call(this)||this).GRAYKEY="AllGrayscaleConfig",n.MIXSTOREKEY="AllMixStorePolicy",n.nosCdnHostTimer=0,n.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},n.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},n.curProvider=Zb.nos,n.s3=null,n.mixStoreErrorCount=10,n.nosErrorCount=0,n.circuitTimer=0,n.name="cloudStorage",n.GRAYKEY=r+"-AllGrayscaleConfig",n.MIXSTOREKEY=r+"-AllMixStorePolicy",n.logger=t.logger,n.core=t,El({cmdMap:dS,cmdConfig:fS}),n}Qt(t,e);var r=t.prototype;return r.init=function(){return vc(this,void 0,void 0,Ya.mark((function e(){return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=Zb.nos,this.mixStoreErrorCount=10,e.next=6,this._getGrayscaleConfig(this.core.options.appkey);case 6:return e.next=8,this._getNosCdnHost();case 8:case"end":return e.stop()}}),e,this)})))},r.uploadFile=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(mp({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},e),e.fileInput||e.file||e.filePath){t.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!e.type||"file"===e.type){t.next=7;break}if("string"!=typeof(r=vy(e,"file.type"))||-1!==pc(r).call(r,e.type)){t.next=7;break}throw new Error('The meta type "'+r+'" does not match "'+e.type+'"');case 7:if(this.grayConfig&&this.grayConfig.mixStoreEnable&&this.mixStorePolicy.providers.length){t.next=10;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),t.abrupt("return",this.nosUpload(e));case 10:return this.logger.log("uploadFile:: uploadFile begin,Current settings grayConfig mixStoreEnable:"+this.grayConfig.mixStoreEnable+" curProvider:"+this.curProvider),this.s3||(this.curProvider=Zb.nos),n=gS,t.prev=13,t.next=16,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.curProvider,tokenCount:1,tag:"qchat",returnBody:vS(e.type)}});case 16:i=t.sent,n=i.content.mixStoreTokenResTag,t.next=24;break;case 20:throw t.prev=20,t.t0=t.catch(13),this.core.logger.error("uploadFile:: getMixStoreToken error",t.t0),new sl("getMixStoreToken error",t.t0,this.curProvider,this.mixStorePolicy);case 24:return t.abrupt("return",this.curProvider===Zb.s3?this.s3Upload(e,n):this.nosUpload(e,n));case 25:case"end":return t.stop()}}),t,this,[[13,20]])})))},r.nosUpload=function(e,t){var r,n;return vc(this,void 0,void 0,Ya.mark((function i(){var o,s,a,c,u,l,d,p,m,f,h,g,v;return Ya.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(o=vy(this.core,"config.cdn.bucket"),s={tag:e.nosScenes||o||"nim",expireSec:e.nosSurvivalTime},t){i.next=13;break}return i.prev=3,i.next=6,this.core.sendCmd("getNosToken",{responseBody:vS(e.type),nosToken:s});case 6:a=i.sent,i.next=13;break;case 9:throw i.prev=9,i.t0=i.catch(3),this.core.logger.error("uploadFile:: getNosToken error",i.t0),new sl("getNosToken error",i.t0,1);case 13:return i.prev=13,u=a?a.content.nosToken:t,this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:u,chunkUploadHost:this.core.config.chunkUploadHost,commonUploadHost:this.core.config.commonUploadHost,platform:pl.platform}),i.next=18,pl.uploadFile(oc(oc({},e),{nosToken:u,chunkUploadHost:this.core.config.chunkUploadHost,commonUploadHost:this.core.config.commonUploadHost,maxSize:e.maxSize||this.core.config.chunkMaxSize}));case 18:c=i.sent,i.next=42;break;case 21:if(i.prev=21,i.t1=i.catch(13),this.core.logger.error("uploadFile::nos uploadFile error",i.t1),!t){i.next=41;break}if(0!==this.nosErrorCount){i.next=37;break}i.prev=26,this._addCircuitTimer(),i.next=33;break;case 30:throw i.prev=30,i.t2=i.catch(26),new sl("upload file error",i.t2,this.curProvider,this.mixStorePolicy,e.file||e.filePath);case 33:return this.nosErrorCount=null===(r=this.mixStorePolicy.nosPolicy)||void 0===r?void 0:r.uploadConfig.retryPolicy.retry,i.abrupt("return",this.uploadFile(e));case 37:return this.nosErrorCount--,i.abrupt("return",this.nosUpload(e,t));case 39:i.next=42;break;case 41:throw new sl("nos uploadFile error",i.t1,1);case 42:if(l=null==c?void 0:c.type,d=l&&pc(l).call(l,"/")>-1?Ja(l).call(l,0,pc(l).call(l,"/")):"",p={image:"imageInfo",video:"vinfo",audio:"vinfo"},m=this.core.config.uploadReplaceFormat.replace("{host}",this.core.config.cdn.cdnDomain||this.core.config.cdn.defaultCdnDomain).replace("{object}",a?a.content.nosToken.objectName:null==t?void 0:t.objectName),t&&t.shortUrl&&(m=t.shortUrl),p[d]){i.next=49;break}return i.abrupt("return",oc({url:m},c));case 49:if(i.prev=49,!(pc(m).call(m,"_im_url=1")<0)){i.next=54;break}return i.next=53,pl.request(m+"?"+p[d],{method:"GET",dataType:"json",timeout:5e3});case 53:f=i.sent;case 54:i.next=60;break;case 56:return i.prev=56,i.t3=i.catch(49),this.core.logger.error("uploadFile:: fetch file info error",i.t3),i.abrupt("return",oc({url:m},c));case 60:if(!f){i.next=67;break}return h=f.data,g="imageInfo"===p[d]?h:null===(n=null==h?void 0:h.GetVideoInfo)||void 0===n?void 0:n.VideoInfo,v={url:m,name:c.name,size:c.size,ext:c.ext,w:g.Width,h:g.Height,orientation:g.Orientation,dur:g.Duration,audioCodec:g.AudioCodec,videoCodec:g.VideoCodec,container:g.Container},i.abrupt("return",lS(v,(function(e,t){return void 0!==t})));case 67:return i.abrupt("return",oc({url:m},c));case 68:case"end":return i.stop()}}),i,this,[[3,9],[13,21],[26,30],[49,56]])})))},r._getNosCdnHost=function(){var e;return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o=this;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.core.sendCmd("getNosCdnHost");case 3:r=t.sent,t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),this.logger.error("getNosCdnHost::error",t.t0),t.abrupt("return");case 10:if(r){t.next=12;break}return t.abrupt("return");case 12:n=null===(e=null==r?void 0:r.content)||void 0===e?void 0:e.nosConfigTag,0!==(i=Bp(null==n?void 0:n.expire))&&n.cdnDomain?-1===i?(this.core.config.cdn.bucket=n.bucket,this.core.config.cdn.cdnDomain=n.cdnDomain,this.core.config.cdn.objectNamePrefix=n.objectNamePrefix):(this.core.config.cdn.bucket=n.bucket,this.core.config.cdn.cdnDomain=n.cdnDomain,this.core.config.cdn.objectNamePrefix=n.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){o._getNosCdnHost()}),1e3*i)):(this.core.config.cdn.bucket="",this.core.config.cdn.cdnDomain="",this.core.config.cdn.objectNamePrefix="");case 15:case"end":return t.stop()}}),t,this,[[0,6]])})))},r._getGrayscaleConfig=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(pl.localStorage)try{pl.localStorage.getItem&&pl.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(pl.localStorage.getItem(this.GRAYKEY))[e])}catch(e){pl.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",e)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){r.next=17;break}return r.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(n=r.sent).content||!n.content.grayConfigTag){r.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(n.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(n.content.grayConfigTag.ttl)}catch(e){this.logger.error("getGrayscaleConfig error",e)}if(this.grayConfig){r.next=10;break}return r.abrupt("return");case 10:i=pl.localStorage.getItem(this.GRAYKEY)?JSON.parse(pl.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),i[e]=this.grayConfig,pl.localStorage.setItem(this.GRAYKEY,Qc(i)),r.next=17;break;case 16:this.logger.debug("uploadFile:: result grayConfig:",n.content);case 17:if(!(null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable)){r.next=20;break}return r.next=20,this._getMixStorePolicy(e);case 20:case"end":return r.stop()}}),r,this)})))},r._getMixStorePolicy=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a,c;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(new Date).getTime(),pl.localStorage)try{this.mixStorePolicy=JSON.parse(pl.localStorage.getItem(this.MIXSTOREKEY))[e],this.curProvider=Bp(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>r&&(i=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-r,this.core.timerManager.addTimer(Jt(n=this._getMixStorePolicy).call(n,this,e),i))}catch(t){pl.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(pl.localStorage.getItem(this.MIXSTOREKEY))[e]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",t)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=r)){t.next=30;break}return t.prev=3,t.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.s3?[1,2]:[1]});case 6:s=t.sent,a=s.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(a.ttl),this.mixStorePolicy.providers=a.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=Bp(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=a.nosPolicy?JSON.parse(a.nosPolicy):null,this.mixStorePolicy.s3Policy=a.s3Policy?JSON.parse(a.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(Jt(o=this._getMixStorePolicy).call(o,this,e),1e3*this.mixStorePolicy.ttl),c=pl.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(pl.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),c[e]=this.mixStorePolicy,pl.localStorage.setItem(this.MIXSTOREKEY,Qc(c)),t.next=30;break;case 23:if(t.prev=23,t.t0=t.catch(3),this.logger.error("getMixStorePolicy error",t.t0),0!==this.mixStoreErrorCount){t.next=28;break}throw new Error("getMixStorePolicy all count error");case 28:this._getMixStorePolicy(e),this.mixStoreErrorCount--;case 30:this.mixStorePolicy.nosPolicy&&(this.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 31:case"end":return t.stop()}}),t,this,[[3,23]])})))},r.s3Upload=function(e,t){return vc(this,void 0,void 0,Ya.mark((function r(){var n,i,o,s,a,c,u,l,d,p,m=this;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.file){r.next=4;break}n=e.file,r.next=19;break;case 4:if("string"!=typeof e.fileInput){r.next=14;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((i=document.getElementById(e.fileInput))&&i.files&&i.files[0])){r.next=11;break}n=i.files[0],r.next=12;break;case 11:throw new Error("Can not get file from fileInput");case 12:r.next=19;break;case 14:if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0])){r.next=18;break}n=e.fileInput.files[0],r.next=19;break;case 18:throw new Error("Can not get file from fileInput "+e.fileInput);case 19:if(this.mixStorePolicy.s3Policy){r.next=21;break}throw new Error("dont get s3 policy");case 21:return o={accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey,sessionToken:t.sessionToken,region:t.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},s=this.s3,(a=new s).config.update(o),c=decodeURIComponent(t.bucket),u=decodeURIComponent(t.objectName),d={Bucket:c,Key:u,Body:l=n,Metadata:{token:t.token},ContentType:l.type||"application/octet-stream"},this.core.logger.debug("uploadFile:: s3 upload params:",d),p=a.upload(d),r.abrupt("return",new La((function(r){p.send((function(n,i){if(n){m.logger.error("uploadFile:","api::s3:upload file failed",n);try{m._addCircuitTimer()}catch(n){throw new sl("upload file error",n,m.curProvider,m.mixStorePolicy,e.file||e.filePath)}r(m.uploadFile(e))}else{var o=m.mixStorePolicy.s3Policy.cdnSchema;o=(o=o.replace("{cdnDomain}",m.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",i.Key),r({size:l.size,name:l.name,url:t.shortUrl?t.shortUrl:o,ext:l.name.split(".")[1]||"unknown"})}}))})));case 32:case"end":return r.stop()}}),r,this)})))},r.getPrivateUrl=function(e){var t;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),"";var r=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);r[0];var n=r[1];r[2];var i=r[3];r[4];var o=r[5];if(r[6],r[7],null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable){var s=this._getUrlType(e);return s===Zb.s3&&this.mixStorePolicy.s3Policy&&(e=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",o)),s===Zb.nos&&this.mixStorePolicy.nosPolicy&&(e=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",o)),e}var a=this.core.config,c=a.downloadUrl,u=a.downloadHostList,l=a.nosCdnEnable,d=this.core.config.cdn.cdnDomain,p=this.core.config.cdn.objectNamePrefix?decodeURIComponent(this.core.config.cdn.objectNamePrefix):"",m=decodeURIComponent(o),f=pc(m).call(m,p);if(d&&f>-1&&l)return""+n+d+"/"+Ja(m).call(m,f);if(Ou(u).call(u,i)&&Ou(o).call(o,"/")){var h=pc(o).call(o,"/"),g=o.substring(0,h),v=o.substring(h+1);return c.replace("{bucket}",g).replace("{object}",v)}var y=Ep(u).call(u,(function(e){return"string"==typeof i&&Ou(i).call(i,e)}))[0],b=y?i.replace(y,"").replace(/\W/g,""):null;return b?c.replace("{bucket}",b).replace("{object}",o):e},r.getOriginUrl=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:e}});case 2:return r=t.sent,t.abrupt("return",r.content.nosSafeUrlTag.originUrl);case 4:case"end":return t.stop()}}),t,this)})))},r.getFileToken=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n,i,o,s,a=this;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(mp({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},e),r=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,n=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,r!==String(eS.dontNeed)||n!==String(eS.dontNeed)){t.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(e.type!==eS.time){t.next=17;break}if(!(r&&pc(r).call(r,String(eS.time))>=0||n&&pc(n).call(n,String(eS.time))>0)){t.next=13;break}return t.abrupt("return",this.getFileAuthToken(e));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:t.next=33;break;case 17:if(e.urls&&e.urls.length){t.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(o=[],s=[],so(i=e.urls).call(i,(function(e){var t=a._getUrlType(e);t===Zb.nos&&s.push(e),t===Zb.s3&&o.push(e)})),(!n||0!==o.length&&pc(n).call(n,String(eS.urls))<0)&&(this.logger.warn("s3 url don't support url token"),o=[]),(!r||0!==s.length&&pc(r).call(r,String(eS.urls))<0)&&(this.logger.warn("nos url don't support url token"),s=[]),0!==o.length||0!==s.length){t.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==o.length&&0!==s.length){t.next=33;break}return e.urls=Qc(e.urls),t.abrupt("return",this.getFileAuthToken(e));case 33:case"end":return t.stop()}}),t,this)})))},r.getFileAuthToken=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:e});case 2:return r=t.sent,t.abrupt("return",r.content.mixStoreAuthTokenResTag);case 4:case"end":return t.stop()}}),t,this)})))},r._getUrlType=function(e){var t,r;return this.mixStorePolicy.nosPolicy&&nS(t=this.mixStorePolicy.nosPolicy.dlcdns).call(t,(function(t){return pc(e).call(e,t)>=0}))?Zb.nos:this.mixStorePolicy.s3Policy&&nS(r=this.mixStorePolicy.s3Policy.dlcdns).call(r,(function(t){return pc(e).call(e,t)>=0}))?Zb.s3:null},r._addCircuitTimer=function(){var e=this,t=this.mixStorePolicy.providers,r=t[(pc(t).call(t,String(this.curProvider))+1)%t.length];if(r===t[0])throw new Error("uploadFile all policy fail");var n=vy(this.mixStorePolicy,"s3Policy.uploadConfig.retryPolicy");if(n&&n.retryNext&&r&&(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+r),this.curProvider=Bp(r),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy)){var i=this.mixStorePolicy[this.curProvider===Zb.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!i||0===i)return;this.circuitTimer=this.core.timerManager.addTimer((function(){e.logger.log("uploadFile:: upload policy will change,now policy:"+e.curProvider+" nextProvider:"+Bp(e.mixStorePolicy.providers[0])),e.curProvider=Bp(e.mixStorePolicy.providers[0]),e.core.timerManager.deleteTimer(e.circuitTimer)}),1e3*i)}},r.setS3=function(e){this.s3=e},r.process=function(e){var t=this[e.cmd+"Handler"];return"function"==typeof t?(t.call(this,e),La.resolve(e)):e.error&&!e.error.ignore?La.reject(e.error):La.resolve(e)},t}(eu),bS=If({none:0,normal:1,all:3}),SS=If({normal:0,advanced:1}),TS=If({normal:0,owner:1,manager:2}),_S={noVerify:0,needVerify:1,rejectAll:2},wS=If(_S),MS={needVerify:0,noVerify:1},xS=If(MS),ES={manager:0,all:1},CS=If(ES),RS={manager:0,all:1},kS=If(RS),AS={manager:0,all:1},IS=If(AS);function OS(e){var t,r=["teamId"],n=["level","memberNum","memberUpdateTime","createTime","updateTime"],i=["valid","validToCurrentUser","mute"],o={type:SS,muteType:bS,joinMode:wS,beInviteMode:xS,inviteMode:CS,updateTeamMode:kS,updateExtMode:IS};e.bits;var s=gc(e,["bits"]);return so(r).call(r,(function(e){s[e]&&(s[e]=s[e].toString())})),so(n).call(n,(function(e){void 0!==s[e]&&(s[e]=Bp(s[e]))})),so(i).call(i,(function(e){void 0!==s[e]&&(s[e]=1===Bp(s[e]))})),so(t=ec(o)).call(t,(function(e){void 0!==s[e]&&(s[e]=o[e][s[e]]||s[e])})),s}function PS(e){return e&&e.length>0?Vu(e).call(e,(function(e){return OS(e)})):[]}function NS(e){var t,r=oc({},e),n=["avatar","name","intro","announcement","ext"],i={joinMode:_S,beInviteMode:MS,inviteMode:ES,updateTeamMode:RS,updateExtMode:AS};return so(n).call(n,(function(e){void 0!==r[e]&&(r[e]=r[e].toString())})),so(t=ec(i)).call(t,(function(e){void 0!==r[e]&&(r[e]=i[e][r[e]])})),r}function DS(e){var t=["teamId","ext","account","nickInTeam"],r={};return void 0!==e.bitConfigMask&&(r.bits=Bp(e.bitConfigMask)),so(t).call(t,(function(t){e[t]&&(r[t]=e[t].toString())})),r}function LS(e){var t,r=["teamId"],n=["joinTime","updateTime","bitConfigMask"],i=["active","valid","mute"],o={type:TS},s=e.bits,a=gc(e,["bits"]);return void 0!==s&&(a.muteTeam=1===Bp(s),a.bitConfigMask=s),a.id=a.teamId+"-"+a.account,so(r).call(r,(function(e){a[e]&&(a[e]=a[e].toString())})),so(n).call(n,(function(e){void 0!==a[e]&&(a[e]=Bp(a[e]))})),so(i).call(i,(function(e){void 0!==a[e]&&(a[e]=1===Bp(a[e]))})),so(t=ec(o)).call(t,(function(e){void 0!==a[e]&&(a[e]=o[e][a[e]]||a[e])})),a}function jS(e){return e&&e.length>0?Vu(e).call(e,(function(e){return LS(e)})):[]}function US(e,t,r){return void 0===r&&(r="normal"),{id:e.teamId+"-"+t,teamId:e.teamId,account:t,type:r,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function FS(e,t,r){return void 0===r&&(r="normal"),t&&t.length>0?Vu(t).call(t,(function(t){return US(e,t,r)})):[]}var $S=function(){function e(e){this.core=e}var t=e.prototype;return t.notifyAddSuperTeamMembers=function(e,t){this.core.emit("addSuperTeamMembers",{team:e,accounts:t,members:FS(e,t)})},t.notifyUpdateSuperTeamManagers=function(e,t,r,n){this.core.emit("updateSuperTeamManagers",{team:{teamId:e,memberUpdateTime:n},accounts:t,isManager:r,members:Vu(t).call(t,(function(t){return{id:e+"-"+t,type:"manager",account:t,updateTime:n}}))})},t.notifyRemoveSuperTeamMembers=function(e,t){this.core.emit("removeSuperTeamMembers",{team:e,accounts:t})},t.notifyTransferSuperTeam=function(e,t,r){this.core.emit("transferSuperTeam",{team:e,from:{id:e.teamId+"-"+t,account:t,type:"normal",updateTime:e.memberUpdateTime},to:{id:e.teamId+"-"+r,account:r,type:"owner",updateTime:e.memberUpdateTime}})},t.notifyUpdateSuperTeamMembersMute=function(e,t,r){this.core.emit("updateSuperTeamMembersMute",{team:e,accounts:t,members:Vu(t).call(t,(function(t){return{id:e.teamId+"-"+t,account:t,teamId:e.teamId,mute:r,updateTime:e.memberUpdateTime}})),mute:r})},e}(),BS={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember"},VS={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},HS=Cl(VS),WS={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:HS.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:HS.superTeam},{type:"Number",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:VS.superTeam}],response:[{type:"Number",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:HS.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:VS.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:VS.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:HS.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:HS.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:HS.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:HS.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:HS.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:HS.superTeamMember}]}},qS=function(e){function t(t){var r;return(r=e.call(this,"superTeam",t)||this).service=new $S(t),El({cmdMap:BS,cmdConfig:WS}),r.core.eventBus.on("team/onNotification",(function(e){return r.notificationHandler(e)})),r}Qt(t,e);var r=t.prototype;return r.getSuperTeamInfo=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:e.teamId});case 3:return r=t.sent,n=r.content.superTeam,t.abrupt("return",OS(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getSuperTeams=function(){return vc(this,void 0,void 0,Ya.mark((function e(){var t,r;return Ya.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return t=e.sent,r=t.content.superTeams,e.abrupt("return",PS(r));case 5:case"end":return e.stop()}}),e,this)})))},r.updateSuperTeamInfo=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!1,required:!1},announcement:{type:"string",allowEmpty:!1,required:!1},avatar:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=NS(e),t.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:r});case 4:return t.abrupt("return",OS(r));case 5:case"end":return t.stop()}}),t,this)})))},r.addSuperTeamMembers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return t.stop()}}),t,this)})))},r.removeSuperTeamMembers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return t.stop()}}),t,this)})))},r.addSuperTeamManagers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("addSuperTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.removeSuperTeamManagers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("removeSuperTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.applySuperTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("applySuperTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return r=t.sent,t.abrupt("return",OS(r.content.superTeam));case 5:case"end":return t.stop()}}),t,this)})))},r.transferSuperTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),t.next=3,this.core.sendCmd("transferSuperTeam",e);case 3:case"end":return t.stop()}}),t,this)})))},r.muteSuperTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteSuperTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.muteSuperTeamMembers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.updateMemberNick=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!1}},e),r=DS({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),t.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:r});case 4:return n=LS(oc({updateTime:(new Date).getTime()},r)),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!1,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),r=DS({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),t.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:r});case 4:return n=LS(oc({updateTime:(new Date).getTime(),account:this.core.account},r)),this.core.emit("updateSuperTeamMember",n),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)})))},r.getSuperTeamMembersByAccounts=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n,i,o;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},e),i=Vu(n=e.accounts).call(n,(function(t){return e.teamId+"|"+t})),r.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:i});case 4:return o=r.sent,r.abrupt("return",jS(null===(t=o.content)||void 0===t?void 0:t.superTeamMembers));case 6:case"end":return r.stop()}}),r,this)})))},r.getSuperTeamMembers=function(e){var t;return vc(this,void 0,void 0,Ya.mark((function r(){var n;return Ya.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("getSuperTeamMembers",oc({joinTime:0,limit:100,reverse:!1},e));case 3:return n=r.sent,r.abrupt("return",jS(null===(t=n.content)||void 0===t?void 0:t.superTeamMembers));case 5:case"end":return r.stop()}}),r,this)})))},r.queryMuteMembers=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r,n;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",oc({limit:100,joinTime:0,reverse:!1},e));case 3:return r=t.sent,n=r.content,t.abrupt("return",jS(n.superTeamMembers));case 6:case"end":return t.stop()}}),t,this)})))},r.leaveSuperTeam=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.passSuperTeamApply=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("passSuperTeamApply",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectSuperTeamApply=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("rejectSuperTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 3:case"end":return t.stop()}}),t,this)})))},r.acceptSuperTeamInvite=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("acceptSuperTeamInvite",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectSuperTeamInvite=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("rejectSuperTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 3:case"end":return t.stop()}}),t,this)})))},r.syncSuperTeamsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:Bp(t.timetag)});var r=null==t?void 0:t.superTeams;if(r&&r.length){var n=PS(r);this.core.emit("superTeams",n)}},r.syncCreateSuperTeamHandler=function(e){var t=e.content,r=OS(null==t?void 0:t.superTeam),n=US(r,r.owner,"owner");this.core.emit("createSuperTeam",r,n)},r.syncUpdateSuperTeamMemberHandler=function(e){var t=e.content,r=LS(null==t?void 0:t.teamMember);r.updateTime||(r.updateTime=(new Date).getTime()),this.core.emit("updateSuperTeamMember",r)},r.notificationHandler=function(e){var t=e.attach,r=e.scene,n=e.from,i=e.to,o=e.time,s=e.idServer,a=e.idClient,c=t.team,u=t.account,l=t.accounts,d=t.type;if("superTeam"===r)switch("debug"===this.core.options.debugLevel?this.logger.debug("superTeam::recvNotification",s,a,t):this.logger.log("superTeam::recvNotification",s,a,i,d,u,l),d){case"updateSuperTeam":c.updateTime=o,this.core.emit("updateSuperTeam",c);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(c,l);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(c,[n]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(c,[u]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,l,!0,o);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,l,!1,o);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(c,l);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(c,[n]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:i});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(c,n,u);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(c,l,t.mute)}},t}(Fm),zS={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},GS={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Boolean",name:"isWeixinApp"},{type:"Number",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},JS=function(e){function t(t){var r;return(r=e.call(this,"plugin",t)||this).core=t,El({cmdMap:zS,cmdConfig:GS}),r}Qt(t,e);var r=t.prototype;return r.getChatroomAddress=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:e.chatroomId,isWeixinApp:"WXAPP"===pl.platform,ipType:e.ipType||0});case 3:return r=t.sent,t.abrupt("return",r.content.address);case 5:case"end":return t.stop()}}),t,this)})))},r.getQChatAddress=function(e){return vc(this,void 0,void 0,Ya.mark((function t(){var r;return Ya.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mp({ipType:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==e?void 0:e.ipType)||0}});case 3:return r=t.sent,t.abrupt("return",r.content.address);case 5:case"end":return t.stop()}}),t,this)})))},t}(Fm);return Sm.setAdapters(Um),Sm.registerService(jf,"auth"),Sm.registerService(Yh,"msg"),Sm.registerService(ng,"misc"),Sm.registerService(bv,"user"),Sm.registerService(tb,"session"),Sm.registerService(nb,"team"),Sm.registerService(mb,"systemMessage"),Sm.registerService(Sb,"friend"),Sm.registerService(Rb,"event"),Sm.registerService(Db,"msgExtend"),Sm.registerService(qb,"msgLog"),Sm.registerService(Qb,"passThrough"),Sm.registerService(yS,"cloudStorage"),Sm.registerService(qS,"superTeam"),Sm.registerService(eg,"sync"),Sm.registerService(JS,"plugin"),Sm}()}(NIM_BROWSER_SDK);var NIM$1=getDefaultExportFromCjs(NIM_BROWSER_SDK.exports),NERTC={exports:{}};(function(module,exports){!function(e,t){module.exports=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=205)}([function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){var n=r(32)("wks"),i=r(22),o=r(0).Symbol,s="function"==typeof o;(e.exports=function(e){return n[e]||(n[e]=s&&o[e]||(s?o:i)("Symbol."+e))}).store=n},function(e,t){var r=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=r)},function(e,t,r){var n=r(7);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getParameters=void 0;const n=r(70);let i={tracks:{audio:[],video:[]},shimVideoOrientation:"never",shimCanvas:"ios151",clients:[],localStreams:[],debugG2:!1,enableAlerter:"never",videoLowMaxWidth:320,videoLowMaxHeight:180,videoLowFramerate:15,videoLowCheckCanvasBlank:"ios",screenLowMaxWidth:320,screenLowMaxHeight:180,screenLowFramerate:15,controlOnPaused:!0,hideControlOnResume:!0,maxTransportRebuildCnt:Number.MAX_SAFE_INTEGER,logLevel:n.loglevels.INFO,forceLogLevel:-1,forceLogUpload:"default",forceListenDeviceChange:!0,codecOptions:{audio:{opusStereo:!0,opusDtx:!0}},videoHighStartBitrate:1e3,videoHighMinBitrate:0,videoLowStartBitrate:500,videoLowMinBitrate:0,screenHighStartBitrate:2e3,screenHighMinBitrate:0,screenLowStartBitrate:500,screenLowMinBitrate:0,screenFocus:!0,allowEmptyMedia:!0,keepLocalstreamOnLeave:!1,joinFirstTimeout:2e3,joinMaxRetry:3,reconnectionFirstTimeout:2e3,reconnectionMaxRetry:3,leaveOnUnload:!0,trustOnOnline:!1,h264Wait:1e3,encoderWatermarkLimit:1,encoderWatermarkFontFamily:"Verdana",forceEncodedInsertableStreams:!1,forceCustomEncryptionOff:!1,h264StrictHigh:!1,disableH264Send:!1,disableVP8Send:!1,enableTcpCandidate:!0,enableUdpCandidate:!0,maxEventLoopLagWarning:3,enableCompatAudio:!1,audioInputcompatMode:"auto",fireBackupDelay:5e3,audioAslFlag:!0,keepAspectRatio:!1,disableLBSService:!1,protooMessageTimeout:3e4,reuseMid:!0,playMediaTimeout:3e3,disableWebAudio:!1,disable2dContext:!1,disableWebGLContext:!1,reportPageBrowserId:!0,doHeartbeatInterval:1e3,deviceChangeInterval:0,h264ProfileLevel:"",h264ProfileLevelSignal:"42e01f",forceBWE:"transport-cc",shimLocalCanvas:"safari"};try{if(location.search&&"function"==typeof URLSearchParams){const e=new URLSearchParams(location.search);let t;for(t in i){const r=i[t],n=e.get(t);if(n){let e=null;"string"==typeof r?e=n:"boolean"==typeof r?"true"!==n&&"false"!==n||(e="true"===n):"number"==typeof r&&(e=Number(n),Number(n)>Number.MIN_SAFE_INTEGER&&(e=Number(n))),null!==e&&r!==e&&(console.warn(`NERTC 通过URL改变了私有化变量：${t}:`,r,"=>",e),i[t]=e)}}}}catch(e){}t.getParameters=()=>i},function(e,t,r){var n=r(6),i=r(21);e.exports=r(8)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(3),i=r(41),o=r(29),s=Object.defineProperty;t.f=r(8)?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){e.exports=!r(20)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function o(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e,t){var r=i?i+e:e,n=this._events[r];if(t)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var o=0,s=n.length,a=new Array(s);o<s;o++)a[o]=n[o].fn;return a},a.prototype.emit=function(e,t,r,n,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,o),!0;case 6:return l.fn.call(l.context,t,r,n,o,s),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,m=l.length;for(u=0;u<m;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,n);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,r){var n=new s(t,r||this),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},a.prototype.once=function(e,t,r){var n=new s(t,r||this,!0),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):(this._events[o]=n,this._eventsCount++),this},a.prototype.removeListener=function(e,t,r,n){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return 0==--this._eventsCount?this._events=new o:delete this._events[s],this;var a=this._events[s];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||(0==--this._eventsCount?this._events=new o:delete this._events[s]);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||n&&!a[c].once||r&&a[c].context!==r)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new o:delete this._events[s]}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new o:delete this._events[t])):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=i,a.EventEmitter=a,e.exports=a},function(e,t,r){var n=r(82),i=r(27);e.exports=function(e){return n(i(e))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default={PAGE_UNLOAD:3e4,LOGIN_FAILED:30001,MEDIA_CONNECTION_DISCONNECTED:30204,SIGNAL_CONNECTION_DISCONNECTED:30205,CLIENT_BANNED:30206,CHANNEL_CLOSED:30207,UID_DUPLICATE:30209,PERMKEY_TIMEOUT:30902,AUTO_PLAY_NOT_ALLOWED:41030,INVALID_PARAMETER_ERROR:1e4,NOT_SUPPORT_ERROR:10001,NETWORK_ERROR:10002,NETWORK_REQUEST_ERROR:10003,INVALID_OPERATION_ERROR:10008,API_CALL_SEQUENCE_BEFORE_ERROR:10009,API_CALL_SEQUENCE_AFTER_ERROR:10010,LOCALSTREAM_NOT_FOUND_ERROR:10011,UNKNOWN_TYPE_ERROR:10012,LOGIN_REQUEST_ERROR:10017,RECONNECTING:10020,SERVER_UNKNOWN_ERROR:10099,JOIN_FAILED:10100,REPEAT_JOIN_ERROR:10101,USER_NOT_IN_CHANNEL_ERROR:10104,JOIN_PERMKEY_ERROR:10109,JOIN_WITHOUT_CHANNEL_NAME:10110,JOIN_RECORD_TYPE_ERROR:10111,JOIN_UID_TYPE_ERROR:10112,SERVER_AUTH_ERROR:10119,SET_CHANNEL_PROFILE_INVALID_PARAMETER_ERROR:10121,TASKS_ROLE_ERROR:10131,ADD_TASK_PARAMETER_ERROR:10132,ADD_TASK_FAILED_ERROR:10133,DELETE_TASK_PARAMETER_ERROR:10134,DELETE_TASK_FAILED_ERROR:10135,UPDATE_TASK_PARAMETER_ERROR:10136,UPDATE_TASKS_FAILED_ERROR:10137,STREAM_UID_ERROR:10210,STREAM_PROFILE_ERROR:10211,MEDIA_DEVICE_ERROR:10212,STREAM_PLAY_ARGUMENT_ERROR:10215,STREAM_RENDER_ARGUMENT_ERROR:10216,STREAM_ISPLAYING_ARGUMENT_ERROR:10218,STREAM_OPTN_NO_TYPE_ERROR:10220,REPEAT_OPEN_MIC_ERROR:10221,REPEAT_OPEN_AUDIO_SLAVE_ERROR:10222,REPEAT_OPEN_CAMERA_ERROR:10223,REPEAT_OPEN_SCREEN_ERROR:10224,STREAM_CLOSE_ARGUMENT_ERROR:10228,STREAM_CLOSE_AUDIO_ERROR:10229,STREAM_CLOSE_AUDIO_SLAVE_ERROR:10230,STREAM_CLOSE_CAMERA_ERROR:10231,STREAM_CLOSE_SCREEN_ERROR:10232,STREAM_NOT_SUBSCRIBE_AUDIO:10240,STREAM_NOT_SUBSCRIBE_AUDIO_SLAVE:10241,STREAM_SET_CAPTURE_VOLUME_ARGUMENT_ERROR:10242,STREAM_TAKE_SNAPSHOT_ERROR:10247,STREAM_TAKE_SNAPSHOT_NO_CANVAS_ERROR:10248,SET_AUDIO_VOLUME_ARGUMENTS_ERROR:10250,SET_AUDIO_VOLUME_ERROR:10251,SET_CAPTURE_VOLUME_ARGUMENTS_ERROR:10252,SET_AUDIO_OUTPUT_ERROR:10253,SWITCH_DEVICE_REPEAT_ARGUMENTS_ERROR:10254,SWITCH_DEVICE_REPEAT_ERROR:10255,SWITCH_DEVICE_NO_MIC_ERROR:10256,SWITCH_DEVICE_NO_SUPPORT_AUDIO:10257,SWITCH_DEVICE_NO_CAMERA_ERROR:10258,SWITCH_DEVICE_NO_SUPPORT_VIDEO:10259,STREAM_MUTE_AUDIO_ERROR:10265,STREAM_NOT_MUTE_AUDIO_YET:10266,STREAM_UNMUTE_AUDIO_WITHOUT_STREAM:10267,STREAM_MUTE_AUDIO_SLAVE_ERROR:10270,STREAM_NOT_MUTE_AUDIO_SLAVE_YET:10271,STREAM_UNMUTE_AUDIO_SLAVE_WITHOUT_STREAM:10272,STREAM_MUTE_VIDEO_ERROR:10275,STREAM_NOT_MUTE_VIDEO_YET:10276,STREAM_UNMUTE_VIDEO_WITHOUT_STREAM:10277,STREAM_MUTE_SCREEN_ERROR:10280,STREAM_NOT_MUTE_SCREEN_YET:10281,STREAM_UNMUTE_SCREEN_WITHOUT_STREAM:10282,PUBLISH_NO_STREAM:10350,PUBLISH_ROLE_ERROR:10351,PUBLISH_SERVER_ERROR:10355,SUBSCRIBE_SERVER_ERROR:10360,WEBGL_NOT_SUPPORT_ERROR:10401,WEBGL_LOSE_CONTEXT_ERROR:10402,WEBGL_RESTORED_FAILD_ERROR:10403,BASIC_BEAUTY_RES_ERROR:10404,ADV_BEAUTY_RES_ERROR:10405,PLUGIN_LOADED_ERROR:10406,PLUGIN_ERROR:10407,PLUGIN_REGISTER_ERROR:10408,PLUGIN_NOT_REGISTER:10409,AUDIO_MIX_NO_AUDIO:10420,AUDIO_MIX_FILE_ERROR:10421,AUDIO_MIX_NO_SUPPORT:10422,AUDIO_MIX_NOT_STATE_ERROR:10423,AUDIO_MIX_NOT_PAUSE:10424,AUDIO_MIX_VOLUME_ERROR:10425,AUDIO_MIX_PLAY_START_TIME_ERROR:10426,AUDIO_EFFECT_NO_SUPPORT:10430,AUDIO_EFFECT_FILE_ERROR:10431,AUDIO_EFFECT_NO_AUDIO:10432,AUDIO_EFFECT_NOT_STATE_ERROR:10433,AUDIO_EFFECT_FILE_LOST_ERROR:10434,AUDIO_EFFECT_NOT_PAUSE:10435,AUDIO_EFFECT_PLAY_ALREADY:10436,AUDIO_EFFECT_ERROR:10437,SET_LOCAL_MEDIA_PRIORITY_ARGUMENT_ERROR:10445,UPDATE_PERMKEY_ERROR:10446,RECORDING_NOT_SUPPORT:10450,REPEAT_RECORDING_ERROR:10451,RECORDING_CACHE_ERROR:10452,RECORDING_ERROR:10453,RECORDING_NOT_START_ERROR:10454,WATERMARKS_EXCEEDED_ERROR:10460,LBS_REQUEST_ERROR:10461,LBS_JSON_ERROR:10462,CUSTOM_TRANSFOR_NOT_SUPPORT_ERROR:10471,SET_ENCRYPTION_MODE_ERROR:10472,SET_ENCRYPTION_SECRET_INVALID_OPERATION_ERROR:10473,ROLE_TYPE_ERROR:10477,GET_SYSTEM_STATS_NOT_SUPPORT_ERROR:10480}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(12));class o extends Error{constructor(e){let t=e.url?e.url:"https://doc.yunxin.163.com/docs/interface/NERTC_SDK/Latest/Web/api/index.html#errorCode",r=e.advice?` advice: ${e.advice} `:"";super(e.message+` <${function(e){for(let t in i.default)if(i.default[t]===e)return t;return"UNKNOWN"}(e.code)} ${e.code.toString()}> `+r+t),this.code_=e.code||0,this.message_=e.message||null,this.advice_=e.advice||null,this.extraCode_=e.extraCode||null}get code(){return this.code_}get message(){return this.message_}get extraCode(){return this.extraCode_}get advice(){return this.advice_}getCode(){return this.code_}getMessage(){return this.message_}getProposal(){return this.advice_}getExtraCode(){return this.extraCode_}}t.default=o},function(e,t){e.exports=!0},function(e,t,r){var n=r(0),i=r(2),o=r(18),s=r(5),a=r(9),c=function(e,t,r){var u,l,d,p=e&c.F,m=e&c.G,f=e&c.S,h=e&c.P,g=e&c.B,v=e&c.W,y=m?i:i[t]||(i[t]={}),b=y.prototype,S=m?n:f?n[t]:(n[t]||{}).prototype;for(u in m&&(r=t),r)(l=!p&&S&&void 0!==S[u])&&a(y,u)||(d=l?S[u]:r[u],y[u]=m&&"function"!=typeof S[u]?r[u]:g&&l?o(d,n):v&&S[u]==d?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):h&&"function"==typeof d?o(Function.call,d):d,h&&((y.virtual||(y.virtual={}))[u]=d,e&c.R&&b&&!b[u]&&s(b,u,d)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t){e.exports={}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(19);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(6).f,i=r(9),o=r(1)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.ELECTRON_VERSION=t.IS_ELECTRON=t.IS_UCBROWSER=t.IS_WX=t.IS_LINUX=t.MACOS_VERSION=t.IS_MAC=t.WIN_VERSION=t.IS_WIN=t.IPADQQB_VERSION=t.IS_IPADQQB=t.MACQQB_VERSION=t.IS_MACQQB=t.WQQB_VERSION=t.IS_WQQB=t.MQQB_VERSION=t.IS_MQQB=t.IS_X5MQQB=t.WECHAT_MAJOR_VERSION=t.WECHAT_VERSION=t.IS_WECHAT=t.IE_VERSION=t.IS_IE=t.IS_IE8=t.XWEB_VERSION=t.IS_XWEB=t.TBS_VERSION=t.IS_TBS=t.SOGOU_VERSION=t.IS_SOGOU=t.SOGOUM_VERSION=t.IS_SOGOUM=t.EDG_VERSION=t.EDG_MAJOR_VERSION=t.IS_EDG=t.EDGE_VERSION=t.IS_EDGE=t.FIREFOX_MAJOR_VERSION=t.FIREFOX_VERSION=t.IS_FIREFOX=t.ANDROID_VERSION=t.IS_ANDROID=t.IOS_MAJOR_VERSION=t.IOS_VERSION=t.IS_IOS=t.IS_IPOD=t.IS_IPHONE=t.IS_IPAD=t.USER_LANGUAGE=t.USER_AGENT=void 0,t.IS_EN=t.IS_ZH=t.IS_LOCAL=t.IS_IOS_SAFARI=t.IS_MAC_SAFARI=t.SAFARI_VERSION=t.SAFARI_MAJOR_VERSION=t.IS_ANY_SAFARI=t.IS_SAFARI=t.IOS_FIREFOX_MAJOR_VERSION=t.IOS_FIREFOX_VERSION=t.IS_IOS_FIREFOX=t.IOS_EDGE_MAJOR_VERSION=t.IOS_EDGE_VERSION=t.IS_IOS_EDGE=t.IOS_CHROME_MAJOR_VERSION=t.IOS_CHROME_VERSION=t.IS_IOS_CHROME=t.ANY_CHROME_MAJOR_VERSION=t.CHROME_VERSION=t.CHROME_MAJOR_VERSION=t.IS_CHROME=t.IS_CHROME_ONLY=t.VIVO_VERSION=t.IS_VIVOBROWSER=t.OPPO_VERSION=t.IS_OPPOBROWSER=t.SAMSUNG_VERSION=t.IS_SAMSUNGBROWSER=t.HUAWEI_VERSION=t.IS_HUAWEIBROWSER=t.MI_VERSION=t.IS_MIBROWSER=void 0,t.USER_AGENT=window.navigator&&window.navigator.userAgent||"",t.USER_LANGUAGE=window.navigator&&window.navigator.language,t.IS_IPAD=/iPad/i.test(t.USER_AGENT),t.IS_IPHONE=/iPhone/i.test(t.USER_AGENT)&&!t.IS_IPAD,t.IS_IPOD=/iPod/i.test(t.USER_AGENT),t.IS_IOS=t.IS_IPHONE||t.IS_IPAD||t.IS_IPOD,t.IOS_VERSION=t.IS_IOS&&function(){const e=t.USER_AGENT.match(/\b[0-9]+_[0-9]+(?:_[0-9]+)?\b/)||[""];return e&&e[0]?e[0].replace(/_/g,"."):null}(),t.IOS_MAJOR_VERSION=t.IOS_VERSION&&function(){const e=t.IOS_VERSION.match(/\d+.?\d/);return e&&e[0]?parseFloat(e[0]):null}(),t.IS_ANDROID=/Android/i.test(t.USER_AGENT),t.ANDROID_VERSION=t.IS_ANDROID&&function(){const e=t.USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const r=e[1],n=e[2],i=e[3];return r&&n&&i?r+"."+n+"."+i:r&&n?r+"."+n:r||null}(),t.IS_FIREFOX=/Firefox/i.test(t.USER_AGENT),t.FIREFOX_VERSION=t.IS_FIREFOX&&function(){const e=navigator.userAgent.match(/Firefox\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.FIREFOX_MAJOR_VERSION=t.IS_FIREFOX&&function(){const e=t.USER_AGENT.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_EDGE=/Edge\//i.test(t.USER_AGENT),t.EDGE_VERSION=t.IS_EDGE&&function(){var e=t.USER_AGENT.match(/Edge\/(\d+)/i);if(e&&e[1])return e[1]}(),t.IS_EDG=/Edg\//i.test(t.USER_AGENT),t.EDG_MAJOR_VERSION=t.IS_EDG&&function(){const e=t.USER_AGENT.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.EDG_VERSION=t.IS_EDG&&function(){const e=t.USER_AGENT.match(/Edg\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_SOGOUM=/SogouMobileBrowser\//i.test(t.USER_AGENT),t.SOGOUM_VERSION=t.IS_SOGOUM&&function(){const e=t.USER_AGENT.match(/SogouMobileBrowser\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_SOGOU=/MetaSr\s/i.test(t.USER_AGENT),t.SOGOU_VERSION=t.IS_SOGOU&&function(){const e=t.USER_AGENT.match(/MetaSr(\s\d+(\.\d+)+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_TBS=/TBS\/\d+/i.test(t.USER_AGENT),t.TBS_VERSION=t.IS_TBS&&function(){var e=t.USER_AGENT.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),t.IS_XWEB=/XWEB\/\d+/i.test(t.USER_AGENT),t.XWEB_VERSION=t.IS_XWEB&&function(){var e=t.USER_AGENT.match(/XWEB\/(\d+)/i);if(e&&e[1])return e[1]}(),t.IS_IE8=/MSIE\s8\.0/.test(t.USER_AGENT),t.IS_IE=/MSIE\/\d+/i.test(t.USER_AGENT),t.IE_VERSION=t.IS_IE&&function(){const e=/MSIE\s(\d+)\.\d/.exec(t.USER_AGENT);let r=e&&parseFloat(e[1]);return!r&&/Trident\/7.0/i.test(t.USER_AGENT)&&/rv:11.0/.test(t.USER_AGENT)&&(r=11),r}(),t.IS_WECHAT=/(micromessenger|webbrowser)/i.test(t.USER_AGENT),t.WECHAT_VERSION=t.IS_WECHAT&&function(){var e=navigator.userAgent.match(/MicroMessenger\/([\d.]+)/);if(e&&e[1])return e[1]}(),t.WECHAT_MAJOR_VERSION=t.IS_WECHAT&&function(){var e=t.USER_AGENT.match(/MicroMessenger\/(\d+)/i);if(e&&e[1])return parseFloat(e[1])}(),t.IS_X5MQQB=!t.IS_TBS&&/MQQBrowser\/\d+/i.test(t.USER_AGENT)&&/COVC\/\d+/i.test(t.USER_AGENT),t.IS_MQQB=!t.IS_TBS&&/MQQBrowser\/\d+/i.test(t.USER_AGENT)&&!/COVC\/\d+/i.test(t.USER_AGENT),t.MQQB_VERSION=(t.IS_MQQB||t.IS_X5MQQB)&&function(){const e=t.USER_AGENT.match(/ MQQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_WQQB=!t.IS_TBS&&/ QQBrowser\/\d+/i.test(t.USER_AGENT),t.WQQB_VERSION=t.IS_WQQB&&function(){const e=t.USER_AGENT.match(/ QQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_MACQQB=!t.IS_TBS&&/QQBrowserLite\/\d+/i.test(t.USER_AGENT),t.MACQQB_VERSION=t.IS_MACQQB&&function(){const e=t.USER_AGENT.match(/QQBrowserLite\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_IPADQQB=!t.IS_TBS&&/MQBHD\/\d+/i.test(t.USER_AGENT),t.IPADQQB_VERSION=t.IS_IPADQQB&&function(){const e=t.USER_AGENT.match(/MQBHD\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_WIN=/Windows/i.test(t.USER_AGENT),t.WIN_VERSION=t.IS_WIN&&function(){const e=t.USER_AGENT.match(/Windows NT (\d+)(?:\.(\d+))?(?:\.(\d+))*/i),r=e&&e[1],n=e&&e[2];return r&&n?r+"."+n:r||null}(),t.IS_MAC=!t.IS_IOS&&/MAC OS X/i.test(t.USER_AGENT),t.MACOS_VERSION=t.IS_MAC&&function(){const e=t.USER_AGENT.match(/\b[0-9]+_[0-9]+(?:_[0-9]+)?\b/)||[""];return e&&e[0]?e[0].replace(/_/g,"."):null}(),t.IS_LINUX=!t.IS_ANDROID&&/Linux/i.test(t.USER_AGENT),t.IS_WX=/MicroMessenger/i.test(t.USER_AGENT),t.IS_UCBROWSER=/UCBrowser/i.test(t.USER_AGENT),t.IS_ELECTRON=/Electron/i.test(t.USER_AGENT),t.ELECTRON_VERSION=t.IS_ELECTRON&&function(){const e=t.USER_AGENT.match(/Electron\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_MIBROWSER=/MiuiBrowser/i.test(t.USER_AGENT),t.MI_VERSION=t.IS_MIBROWSER&&function(){const e=t.USER_AGENT.match(/MiuiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_HUAWEIBROWSER=/HuaweiBrowser/i.test(t.USER_AGENT),t.HUAWEI_VERSION=t.IS_HUAWEIBROWSER&&function(){const e=t.USER_AGENT.match(/HuaweiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_SAMSUNGBROWSER=/SamsungBrowser/i.test(t.USER_AGENT),t.SAMSUNG_VERSION=t.IS_SAMSUNGBROWSER&&function(){const e=t.USER_AGENT.match(/SamsungBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_OPPOBROWSER=/HeyTapBrowser/i.test(t.USER_AGENT),t.OPPO_VERSION=t.IS_OPPOBROWSER&&function(){const e=t.USER_AGENT.match(/HeyTapBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_VIVOBROWSER=/VivoBrowser/i.test(t.USER_AGENT),t.VIVO_VERSION=t.IS_VIVOBROWSER&&function(){const e=t.USER_AGENT.match(/VivoBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_CHROME_ONLY=/Chrome/i.test(t.USER_AGENT),t.IS_CHROME=!t.IS_EDGE&&!t.IS_SOGOU&&!t.IS_SOGOUM&&!t.IS_TBS&&!t.IS_XWEB&&!t.IS_EDG&&!t.IS_WQQB&&!t.IS_MIBROWSER&&!t.IS_HUAWEIBROWSER&&!t.IS_SAMSUNGBROWSER&&!t.IS_OPPOBROWSER&&!t.IS_VIVOBROWSER&&/Chrome/i.test(t.USER_AGENT),t.CHROME_MAJOR_VERSION=t.IS_CHROME&&function(){const e=t.USER_AGENT.match(/Chrome\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.CHROME_VERSION=t.IS_CHROME&&function(){const e=t.USER_AGENT.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.ANY_CHROME_MAJOR_VERSION=function(){const e=t.USER_AGENT.match(/Chrome\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_IOS_CHROME=/CriOS/i.test(t.USER_AGENT),t.IOS_CHROME_VERSION=t.IS_IOS_CHROME&&function(){const e=t.USER_AGENT.match(/CriOS\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IOS_CHROME_MAJOR_VERSION=t.IS_IOS_CHROME&&function(){const e=t.USER_AGENT.match(/CriOS\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_IOS_EDGE=/EdgiOS/i.test(t.USER_AGENT),t.IOS_EDGE_VERSION=t.IS_IOS_EDGE&&function(){const e=t.USER_AGENT.match(/EdgiOS\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IOS_EDGE_MAJOR_VERSION=t.IS_IOS_EDGE&&function(){const e=t.USER_AGENT.match(/EdgiOS\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_IOS_FIREFOX=/FxiOS/i.test(t.USER_AGENT),t.IOS_FIREFOX_VERSION=t.IS_IOS_FIREFOX&&function(){const e=t.USER_AGENT.match(/FxiOS\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IOS_FIREFOX_MAJOR_VERSION=t.IS_IOS_FIREFOX&&function(){const e=t.USER_AGENT.match(/FxiOS\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.IS_SAFARI=!t.IS_CHROME_ONLY&&!t.IS_MQQB&&!t.IS_X5MQQB&&!t.IS_MACQQB&&!t.IS_IPADQQB&&/Safari/i.test(t.USER_AGENT),t.IS_ANY_SAFARI=t.IS_SAFARI||t.IS_IOS,t.SAFARI_MAJOR_VERSION=t.IS_SAFARI&&function(){const e=t.USER_AGENT.match(/Version\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),t.SAFARI_VERSION=t.IS_SAFARI&&function(){const e=t.USER_AGENT.match(/Version\/([\d.]+)/);return e&&e[1]?e[1]:null}(),t.IS_MAC_SAFARI=t.IS_SAFARI&&t.IS_MAC,t.IS_IOS_SAFARI=t.IS_SAFARI&&t.IS_IOS,t.IS_LOCAL="file:"===window.location.protocol||"localhost"===window.location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(window.location.hostname),t.IS_ZH=/zh/i.test(t.USER_LANGUAGE),t.IS_EN=/en/i.test(t.USER_LANGUAGE)},function(e,t,r){var n,i,o=e.exports=r(58),s=r(180);o.codegen=r(262),o.fetch=r(263),o.path=r(264),o.fs=o.inquire("fs"),o.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},o.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var a=/\\/g,c=/"/g;o.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},o.safeProp=function(e){return!/^[$\w_]+$/.test(e)||o.isReserved(e)?'["'+e.replace(a,"\\\\").replace(c,'\\"')+'"]':"."+e},o.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;o.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,(function(e,t){return t.toUpperCase()}))},o.compareFieldsById=function(e,t){return e.id-t.id},o.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(o.decorateRoot.remove(e.$type),e.$type.name=t,o.decorateRoot.add(e.$type)),e.$type;n||(n=r(182));var i=new n(t||e.name);return o.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var l=0;o.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=r(59));var t=new i("Enum"+l++,e);return o.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},o.setProperty=function(e,t,r){if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return function e(t,r,n){var i=r.shift();if(r.length>0)t[i]=e(t[i]||{},r,n);else{var o=t[i];o&&(n=[].concat(o).concat(n)),t[i]=n}return t}(e,t=t.split("."),r)},Object.defineProperty(o,"decorateRoot",{get:function(){return s.decorated||(s.decorated=new(r(190)))}})},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(7),i=r(0).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,r){var n=r(7);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(44),i=r(33);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=r(32)("keys"),i=r(22);e.exports=function(e){return n[e]||(n[e]=i(e))}},function(e,t,r){var n=r(2),i=r(0),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(14)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(19);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){t.f=r(1)},function(e,t,r){var n=r(0),i=r(2),o=r(14),s=r(35),a=r(6).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){},function(e,t,r){var n=r(79)(!0);r(40)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(14),i=r(15),o=r(42),s=r(5),a=r(16),c=r(80),u=r(23),l=r(85),d=r(1)("iterator"),p=!([].keys&&"next"in[].keys()),m=function(){return this};e.exports=function(e,t,r,f,h,g,v){c(r,t,f);var y,b,S,T=function(e){if(!p&&e in x)return x[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},_=t+" Iterator",w="values"==h,M=!1,x=e.prototype,E=x[d]||x["@@iterator"]||h&&x[h],C=E||T(h),R=h?w?T("entries"):C:void 0,k="Array"==t&&x.entries||E;if(k&&(S=l(k.call(new e)))!==Object.prototype&&S.next&&(u(S,_,!0),n||"function"==typeof S[d]||s(S,d,m)),w&&E&&"values"!==E.name&&(M=!0,C=function(){return E.call(this)}),n&&!v||!p&&!M&&x[d]||s(x,d,C),a[t]=C,a[_]=m,h)if(y={values:w?C:T("values"),keys:g?C:T("keys"),entries:R},v)for(b in y)b in x||o(x,b,y[b]);else i(i.P+i.F*(p||M),t,y);return y}},function(e,t,r){e.exports=!r(8)&&!r(20)((function(){return 7!=Object.defineProperty(r(28)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){e.exports=r(5)},function(e,t,r){var n=r(3),i=r(81),o=r(33),s=r(31)("IE_PROTO"),a=function(){},c=function(){var e,t=r(28)("iframe"),n=o.length;for(t.style.display="none",r(46).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[o[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(a.prototype=n(e),r=new a,a.prototype=null,r[s]=e):r=c(),void 0===t?r:i(r,t)}},function(e,t,r){var n=r(9),i=r(11),o=r(83)(!1),s=r(31)("IE_PROTO");e.exports=function(e,t){var r,a=i(e),c=0,u=[];for(r in a)r!=s&&n(a,r)&&u.push(r);for(;t.length>c;)n(a,r=t[c++])&&(~o(u,r)||u.push(r));return u}},function(e,t,r){var n=r(26),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=r(0).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(27);e.exports=function(e){return Object(n(e))}},function(e,t,r){r(86);for(var n=r(0),i=r(5),o=r(16),s=r(1)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var u=a[c],l=n[u],d=l&&l.prototype;d&&!d[s]&&i(d,s,u),o[u]=o.Array}},function(e,t,r){var n=r(17),i=r(1)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:o?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,r){var n=r(3),i=r(19),o=r(1)("species");e.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[o])?t:i(r)}},function(e,t,r){var n,i,o,s=r(18),a=r(95),c=r(46),u=r(28),l=r(0),d=l.process,p=l.setImmediate,m=l.clearImmediate,f=l.MessageChannel,h=l.Dispatch,g=0,v={},y=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){y.call(e.data)};p&&m||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return v[++g]=function(){a("function"==typeof e?e:Function(e),t)},n(g),g},m=function(e){delete v[e]},"process"==r(17)(d)?n=function(e){d.nextTick(s(y,e,1))}:h&&h.now?n=function(e){h.now(s(y,e,1))}:f?(o=(i=new f).port2,i.port1.onmessage=b,n=s(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):n="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}),e.exports={set:p,clear:m}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(3),i=r(7),o=r(34);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(44),i=r(33).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=r(70),i=r(57),o=r(69),s=r(4),a="mediasoup-client";let c=window;t.Logger={debug(e,...t){const r=e?`${a}:${e}`:""+a;t=Array.prototype.slice.call(arguments),this.formatArgs("DEBUG",t,r),s.getParameters().logLevel<=n.loglevels.DEBUG&&console.debug.apply(console,t),c.logUpload&&c.wsTransport&&c.wsTransport.sendLog(t)},warn(e,...t){const r=e?`${a}:${e}`:""+a;t=Array.prototype.slice.call(arguments),this.formatArgs("WARN",t,r),s.getParameters().logLevel<=n.loglevels.WARNING&&console.warn.apply(console,t),c.logUpload&&c.wsTransport&&c.wsTransport.sendLog(t)},error(e,...t){const r=e?`${a}:${e}`:""+a;t=Array.prototype.slice.call(arguments),this.formatArgs("ERROR",t,r),s.getParameters().logLevel<=n.loglevels.ERROR&&console.error.apply(console,t),c.logUpload&&c.wsTransport&&c.wsTransport.sendLog(t)},formatArgs(e,t,r){let n=new Date,s=this.formatTimeUnit(""+(n.getMonth()+1))+"-"+this.formatTimeUnit(""+n.getDate())+" "+this.formatTimeUnit(""+n.getHours())+":"+this.formatTimeUnit(""+n.getMinutes())+":"+this.formatTimeUnit(""+n.getSeconds())+":"+this.formatTimeUnit(""+n.getMilliseconds(),3),a=`[NERTC:${e}:${o.updateLogIndex()} ${s} ${r.toUpperCase()}]  `;for(let e=t.length-1;e>=0;e--)t[e]=i.formatSingleArg(t[e]);return t.unshift(a),t},formatTimeUnit(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r}}},function(e,t,r){function n(e,t=1,r=1){return e<=1?r:n(e-1,r,t+r)}function i(e){if(window.RTCRtpSender&&e instanceof RTCRtpSender)return`[RTCRtpSender track: ${i(e.track)}]`;if(e instanceof MediaStreamTrack){const t=e;return`[MediaStreamTrack kind:${t.kind} label:${t.label} readyState:${t.readyState} id: ${t.id} enabled:${t.enabled} muted: ${t.muted}]`}if(e instanceof HTMLElement){const t=e;return`[${t.tagName}.${t.className} ${t.clientWidth}x${t.clientHeight}]`}if(e instanceof MediaStream){const t=e;return`[MediaStream active:${t.active} a:${t.getAudioTracks().length} v:${t.getVideoTracks().length}]`}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.getDomInfo=t.makePrintable=t.formatSingleArg=t.deepCopy=t.randomString=t.randomId=t.generateUUID=t.getReconnectionTimeout=t.fibonacci=void 0,t.fibonacci=n,t.getReconnectionTimeout=function(e){const t=Math.round(e/2)+1;return t>6?13e3:1e3*n(t)},t.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},t.randomId=function(){return"xxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},t.randomString=(e,t)=>{if(!e||!t)return"";let r="";for(var n=t;n>0;--n)r+=e[Math.floor(Math.random()*e.length)];return r},t.deepCopy=function e(t){var r=Array.isArray(t)?[]:{};for(var n in t)t.hasOwnProperty(n)&&("object"==typeof t[n]&&null!==t[n]?r[n]=e(t[n]):r[n]=t[n]);return r},t.formatSingleArg=i,t.makePrintable=function e(t,r,n=[]){if("object"!=typeof t||!(null==t?void 0:t.hasOwnProperty))return t;var o=Array.isArray(t)?[]:{};for(var s in t)if(t.hasOwnProperty(s)){const a=i(t[s]);a&&("client"===s&&a.adapterRef||["adapterRef","sdkRef","logger","_events"].indexOf(s)>-1||(a&&"object"==typeof a?n.indexOf(a)>-1?o[s]="[Circular obj]":(n.push(o[s]),r>=1?o[s]=e(a,r-1,n):(null==a?void 0:a.toString)?o[s]=a.toString():o[s]=typeof a):o[s]=a))}return o},t.getDomInfo=function(e){if(!e)return""+e;let t=e.tagName;return e.id&&(t+="#"+e.id),e.className&&(t+="."+e.className),(e.offsetWidth||e.offsetHeight)&&(t+=` ${e.offsetWidth}x${e.offsetHeight}`),t}},function(e,t,r){(function(e){var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(177),n.base64=r(253),n.EventEmitter=r(254),n.float=r(255),n.inquire=r(178),n.utf8=r(256),n.pool=r(257),n.LongBits=r(258),n.isNode=Boolean(void 0!==e&&e&&e.process&&e.process.versions&&e.process.versions.node),n.global=n.isNode&&e||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=o,n.ProtocolError=o("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,r(67))},function(e,t,r){e.exports=s;var n=r(120);((s.prototype=Object.create(n.prototype)).constructor=s).className="Enum";var i=r(129),o=r(25);function s(e,t,r,i,o){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=o||{},this.reserved=void 0,t)for(var s=Object.keys(t),a=0;a<s.length;++a)"number"==typeof t[s[a]]&&(this.valuesById[this.values[s[a]]=t[s[a]]]=s[a])}s.fromJSON=function(e,t){var r=new s(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},s.prototype.add=function(e,t,r){if(!o.isString(e))throw TypeError("name must be a string");if(!o.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=r||null,this},s.prototype.remove=function(e){if(!o.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},s.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},s.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},function(e,t,r){e.exports=r(75)},function(e,t,r){t.__esModule=!0;var n,i=(n=r(77))&&n.__esModule?n:{default:n};t.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,r){return function n(o,s){try{var a=t[o](s),c=a.value}catch(e){return void r(e)}if(!a.done)return i.default.resolve(c).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(c)}("next")}))}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.SDK_VERSION=t.roomsTaskUrl=t.lbsUrl=t.LBS_BUILD_CONFIG=t.getCloudProxyInfoUrl=t.getChannelInfoUrl=t.ENV=t.ENGINE_VERSION=t.createChannelUrl=t.checkSumUrl=t.BUILD=void 0,t.SDK_VERSION="4.6.50",t.ENGINE_VERSION="4.6.50.0",t.BUILD="v4.6.50-0-gaba0865d";const n=r(207);Object.defineProperty(t,"ENV",{enumerable:!0,get:function(){return n.ENV}}),Object.defineProperty(t,"LBS_BUILD_CONFIG",{enumerable:!0,get:function(){return n.LBS_BUILD_CONFIG}});const i=n.Config.checkSumUrl;t.checkSumUrl=i;const o=n.Config.createChannelUrl;t.createChannelUrl=o;const s=n.Config.getChannelInfoUrl;t.getChannelInfoUrl=s;const a=n.Config.roomsTaskUrl;t.roomsTaskUrl=a;const c=n.Config.getCloudProxyInfoUrl;t.getCloudProxyInfoUrl=c;const u=n.Config.lbsUrl;t.lbsUrl=u},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebAudio=t.getAudioLevelDestination=t.getAudioContext=t.tryResumeAudioContext=void 0;const i=r(10),o=r(163),s=n(r(12)),a=n(r(13)),c=r(164),u=r(4),l=c.RtcSupport.checkWebAudio();let d;class p{constructor(e){this.id=e.id,this.label=e.label,this.audioNode=e.audioNode,this.gainNode=e.context.createGain(),this.type=e.type,this.audioNode.connect(this.gainNode)}connect(e){this.gainNode.connect(e)}disconnect(){try{this.audioNode.disconnect(this.gainNode)}catch(e){}this.gainNode.disconnect()}}function m(){return d?"suspended"===d.state&&(d.resume().catch((e=>{})),!0):null}function f(){return d?(m(),d):u.getParameters().disableWebAudio?null:l.WebAudio&&l.MediaStream?(d=new window.AudioContext,d):null}t.tryResumeAudioContext=m,t.getAudioContext=f;let h=null;t.getAudioLevelDestination=function(){if(!h){const e=f();e&&(h=e.createMediaStreamDestination())}return h};class g extends i.EventEmitter{constructor(e){super();const{logger:t,isAnalyze:r=!1,isRemote:n=!1}=e;this.support=l.WebAudio&&l.MediaStream,this.gain=1,this.logger=t,this.audioInArr=[],this.isAnalyze=r,this.isRemote=n||!1,this.instant=0,this.slow=0,this.clip=0,this.mediaHelper=e.mediaHelper,this.mixAudioConf={state:o.AuidoMixingState.UNSTART,audioSource:null,gainFilter:null,replace:!1,cycle:0,pauseTime:0,startTime:0,totalTime:0,volume:1,playStartTime:0,setPlayStartTime:0,auidoMixingEnd:null},this.context=f(),this.context?(this.destination=this.createDestination(),this.musicDestination=this.createDestination(),this.analyzeDestination=this.createDestination()):(this.destination=null,this.musicDestination=null,this.analyzeDestination=null),this.support&&(this.resetMixConf(),this.init())}createDestination(){if(!this.context)throw new Error("AudioContextRequired");try{return new MediaStreamAudioDestinationNode(this.context)}catch(e){if("TypeError"===e.name)return this.context.createMediaStreamDestination();throw e}}createSource(e){if(!this.context)throw new Error("AudioContextRequired");try{return new MediaStreamAudioSourceNode(this.context,e)}catch(t){if("TypeError"===t.name)return this.context.createMediaStreamSource(e.mediaStream);throw t}}init(){this.isAnalyze&&this.initMonitor(),this.initWebAudio(),this.initAudioIn()}initMonitor(){var e=this;this.context?(this.script=this.context.createScriptProcessor(0,1,1)).onaudioprocess=function(t){var r,n=t.inputBuffer.getChannelData(0),i=0,o=0;for(r=0;r<n.length;++r)i+=Math.abs(n[r]),Math.abs(n[r])>.99&&(o+=1);e.instant=Math.sqrt(i/n.length),e.slow=.95*e.slow+.05*e.instant,e.clip=o/n.length;let s=t.inputBuffer,a=t.outputBuffer;a.copyToChannel&&a.copyToChannel(s.getChannelData(0),0,0)}:e.logger.error("initMonitor:参数不够")}initWebAudio(){this.context&&this.destination?(this.gainFilter=this.context.createGain(),this.gainFilter.gain.value=this.gain):this.logger.error("initMonitor:参数不够")}initAudioIn(){var e,t,r;const n=this;if(!n.context||!n.gainFilter||!n.destination)return this.logger.error("initAudioIn:参数不够"),null;let i=(null===(t=null===(e=this.mediaHelper.audio.stageAIProcessing)||void 0===e?void 0:e.node)||void 0===t?void 0:t.audioNode)||null,s=null===(r=this.mediaHelper.audio.stageAIProcessing)||void 0===r?void 0:r.enabled;if(i)if(s)i.connect(n.gainFilter);else try{i.disconnect(n.gainFilter)}catch(e){}for(var a=0;a<n.audioInArr.length;a++){const t=n.audioInArr[a];if(i)if(s){try{t.gainNode.disconnect(n.gainFilter)}catch(e){}t.connect(i)}else{try{t.gainNode.disconnect(i)}catch(e){}t.connect(n.gainFilter)}else"MIX_PLAYING"===this.mixAudioConf.state&&this.mixAudioConf.replace?this.logger.log("当前正在以Replace模式播放伴音，暂不接入"):t.connect(n.gainFilter)}n.mixAudioConf.state===o.AuidoMixingState.UNSTART&&(n.script&&n.analyzeDestination&&(n.gainFilter.connect(n.script),n.script.connect(n.analyzeDestination)),n.gainFilter.connect(n.destination)),this.logger.log("WebAudio: initAudioIn: 初始化音频 state: ",n.context.state),"running"!==n.context.state&&n.context.resume().then((()=>{this.context&&this.logger.log("WebAudio: addMs: 状态变更成功 state: ",this.context.state)})).catch((e=>{this.logger.log("WebAudio: addMs: 状态变更出错: ",e.name,e.message,e),this.context&&this.context.resume()}))}updateTracks(e){for(let t=this.audioInArr.length-1;t>=0;t--){const r=this.audioInArr[t];e.find((e=>e.track&&r&&e.track.id===r.id))||(this.logger.log("updateTracks，删除",r.label,r.id),this.audioInArr.splice(t,1),r.disconnect())}for(let t=e.length-1;t>=0;t--){const r=e[t];if(!this.audioInArr.find((e=>r.track&&r.track.id===e.id))&&r.track)if(this.context){const e=new MediaStream;e.addTrack(r.track);const t={context:this.context,id:r.track.id,label:r.track.label,audioNode:this.createSource({mediaStream:e}),type:r.type},n=new p(t);n.gainNode.gain.value=this.gain,this.audioInArr.push(n)}else this.logger.error("updateTracks：没有audioContext")}this.initAudioIn()}removeTrack(e){for(let t=this.audioInArr.length-1;t>=0;t--){const r=this.audioInArr[t];r.id===e.id&&(this.logger.log("removeTrack，删除track",e.id,e.label),this.audioInArr.splice(t,1),r.disconnect())}}setGain(e,t){for(let r=0;r<this.audioInArr.length;r++){const n=this.audioInArr[r];t&&t!==n.type||(this.logger.log("WebAudio.setGain",t,e,n.type,n.label,n.id),n.gainNode.gain.value=e)}t||(this.gain=e)}getGain(){if(this.gainFilter)return this.gain}getGainMin(){let e=1;for(let t=0;t<this.audioInArr.length;t++){const r=this.audioInArr[t];r.gainNode.gain.value<e&&(e=r.gainNode.gain.value)}return e}stop(){this.gainFilter&&(this.script?this.script.disconnect(0):this.gainFilter.disconnect(0),this.instant=0)}start(){this.gainFilter&&this.destination&&(this.script&&this.analyzeDestination&&(this.gainFilter.connect(this.script),this.script.connect(this.analyzeDestination)),this.gainFilter.connect(this.destination))}resetMixConf(){var e,t;if(null===(e=this.mixAudioConf.audioSource)||void 0===e||e.disconnect(0),null===(t=this.mixAudioConf.gainFilter)||void 0===t||t.disconnect(0),this.mixAudioConf.replace&&(this.logger.log("伴音停止了，恢复mic"),this.gainFilter&&this.destination)){for(var r=0;r<this.audioInArr.length;r++)this.audioInArr[r].gainNode.connect(this.gainFilter);this.script&&this.analyzeDestination&&(this.gainFilter.connect(this.script),this.script.connect(this.analyzeDestination)),this.gainFilter.connect(this.destination)}this.mixAudioConf={state:o.AuidoMixingState.UNSTART,audioSource:null,gainFilter:null,replace:!1,cycle:0,pauseTime:0,startTime:0,totalTime:0,volume:1,playStartTime:0,setPlayStartTime:0,auidoMixingEnd:null},this.gainFilter&&1===this.gainFilter.gain.value&&this.emit("audioFilePlaybackCompleted")}startMix(e){if(!this.context||!this.destination||!this.gainFilter)return this.logger.error("startMix: 不支持伴音"),Promise.reject(new a.default({code:s.default.AUDIO_MIX_NO_SUPPORT,message:"startMix:不支持伴音"}));if(this.logger.log("开始混音: ",JSON.stringify(e)),this.mixAudioConf.audioSource=this.context.createBufferSource(),this.mixAudioConf.gainFilter=this.context.createGain(),this.mixAudioConf.audioSource.buffer=e.buffer,this.mixAudioConf.replace=e.replace,this.mixAudioConf.cycle=e.cycle,this.mixAudioConf.playStartTime=e.playStartTime,this.mixAudioConf.volume=e.volume?e.volume/255:1,this.mixAudioConf.auidoMixingEnd=e.auidoMixingEnd,this.mixAudioConf.audioSource.connect(this.mixAudioConf.gainFilter),this.mixAudioConf.gainFilter.connect(this.gainFilter),this.musicDestination&&this.mixAudioConf.gainFilter.connect(this.musicDestination),e.replace)for(var t=0;t<this.audioInArr.length;t++){const e=this.audioInArr[t];try{e.gainNode.disconnect(this.gainFilter),this.logger.log(`已断开音频：【${e.label}】`)}catch(t){"InvalidAccessError"===t.name?this.logger.log(`音频断开前未连接：【${e.label}】`):this.logger.error(`无法断开音频:【${e.label}】${t.name}`,t.message)}}if(this.mixAudioConf.audioSource.onended=e=>{this.audioEnd(e)},this.mixAudioConf.totalTime=e.buffer.duration,(this.mixAudioConf.playStartTime<0||this.mixAudioConf.playStartTime>=this.mixAudioConf.totalTime)&&(this.mixAudioConf.playStartTime=0),this.logger.log("设置音量:",this.mixAudioConf.volume),this.mixAudioConf.gainFilter.gain.value=this.mixAudioConf.volume,e.loopback&&e.cycle>1){this.mixAudioConf.audioSource.loop=e.loopback;const t=e.cycle*this.mixAudioConf.totalTime-this.mixAudioConf.playStartTime;this.logger.log("循环播放: options.playStartTime: ",this.mixAudioConf.playStartTime),this.logger.log("循环播放: totalTime: ",t),this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime,t-1)}else e.loopback&&1==e.cycle?(this.mixAudioConf.audioSource.loop=!1,this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime)):(this.logger.log("无限循环播放 loop: ",e.loopback),this.mixAudioConf.audioSource.loop=e.loopback,this.mixAudioConf.audioSource.start(0,this.mixAudioConf.playStartTime));return this.mixAudioConf.state=o.AuidoMixingState.PLAYED,this.mixAudioConf.startTime=Date.now(),Promise.resolve()}pauseAudioMixing(){if(!this.mixAudioConf.audioSource||!this.mixAudioConf.gainFilter)return void this.logger.error("pauseAudioMixing: 缺失audioSource/gainFilter");this.logger.log("暂停混音"),this.mixAudioConf.audioSource.onended=null,this.mixAudioConf.audioSource.disconnect(0),this.mixAudioConf.gainFilter.disconnect(0),this.mixAudioConf.audioSource.stop(),this.mixAudioConf.pauseTime=Date.now(),this.mixAudioConf.state=o.AuidoMixingState.PAUSED;let e=(this.mixAudioConf.pauseTime-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return this.logger.log("已经播放的时间: ",e),e>this.mixAudioConf.totalTime&&(e%=this.mixAudioConf.totalTime),this.logger.log("暂停位置:",e),Promise.resolve()}resumeAudioMixing(e){return this.logger.log("恢复混音"),this.mixAudioConf.pauseTime=0,e.volume=255*this.mixAudioConf.volume,this.startMix(e)}stopAudioMixing(e=!0){return this.mixAudioConf.audioSource&&this.mixAudioConf.gainFilter?(this.logger.log("开始停止混音, isFinished: ",e),this.mixAudioConf.audioSource.onended=null,this.mixAudioConf.audioSource.disconnect(0),this.mixAudioConf.gainFilter.disconnect(0),this.mixAudioConf.audioSource.stop(),this.mixAudioConf.state=o.AuidoMixingState.STOPED,e&&this.resetMixConf(),this.logger.log("混音已停止"),Promise.resolve()):Promise.reject(new a.default({code:s.default.AUDIO_MIX_NOT_STATE_ERROR,message:"stopAudioMixing() 当前没有开启伴音"}))}audioEnd(e){if(this.mixAudioConf.state===o.AuidoMixingState.PLAYED){if(!(this.mixAudioConf.audioSource&&this.mixAudioConf.audioSource.loop&&this.mixAudioConf.cycle<=0))return this.logger.log("伴音播放完成: ",this.mixAudioConf),this.mixAudioConf.audioSource&&(this.mixAudioConf.audioSource.onended=null),this.mixAudioConf.auidoMixingEnd&&(this.mixAudioConf.auidoMixingEnd(e),this.mixAudioConf.auidoMixingEnd=null),this.resetMixConf(),Promise.resolve();this.logger.log("无限循环时, 伴音播放完成event: ",e)}else this.logger.error("audioEnd:参数不够")}setAudioMixingVolume(e){if(this.mixAudioConf.gainFilter)return this.mixAudioConf.gainFilter.gain.value=e/255,this.mixAudioConf.volume=this.mixAudioConf.gainFilter.gain.value,Promise.resolve();this.logger.error("setAudioMixingVolume: 参数缺失gainFilter")}setAudioMixingPlayTime(e){return this.mixAudioConf.state===o.AuidoMixingState.PLAYED&&(this.mixAudioConf.setPlayStartTime=e.playStartTime),e.volume=255*this.mixAudioConf.volume,this.startMix(e)}getAudioMixingPlayedTime(){let e=Date.now();this.mixAudioConf.state==o.AuidoMixingState.PAUSED&&this.mixAudioConf.pauseTime&&(this.logger.log("当前是暂停状态"),e=this.mixAudioConf.pauseTime);let t=(e-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return t>this.mixAudioConf.totalTime&&(t%=this.mixAudioConf.totalTime),{playedTime:t}}getAudioMixingTotalTime(){return{totalTime:this.mixAudioConf.totalTime}}createAudioBufferSource(e){if(!this.context||!this.destination||!this.gainFilter)throw new a.default({code:s.default.AUDIO_EFFECT_NO_SUPPORT,message:"webAudio_createAudioBufferSource: 接口调用状态异常"});const t=this.context.createBufferSource();t.buffer=e;const r=this.context.createGain();return t.connect(r),{sourceNode:t,gainNode:r}}startAudioEffectMix(e){if(!this.context||!this.destination||!this.gainFilter)return Promise.reject(new a.default({code:s.default.AUDIO_EFFECT_NO_SUPPORT,message:"webAudio_startAudioEffectMix: 接口调用状态异常"}));const{sourceNode:t,gainNode:r,playOverTime:n,playStartTime:i,volume:c,cycle:u}=e;r&&t&&(this.logger.log("startAudioEffectMix: ",JSON.stringify(e)),r.connect(this.gainFilter),this.musicDestination&&r.connect(this.musicDestination),r.gain.value=c/100,u>1?(t.loop=!0,t.start(0,i,n)):(t.loop=!1,t.start(0,i)),this.mixAudioConf.state=o.AuidoMixingState.PLAYED,this.mixAudioConf.startTime=Date.now())}stopAudioEffectMix(e){const{sourceNode:t,gainNode:r,playOverTime:n,playStartTime:i,volume:o,cycle:c}=e;if(!r||!t)return Promise.reject(new a.default({code:s.default.AUDIO_EFFECT_NO_SUPPORT,message:"webAudio_startAudioEffectMix: 接口调用状态异常"}));this.logger.log("stopAudioEffectMix: ",JSON.stringify(e)),t.onended=null,t.disconnect(0),r.disconnect(0),t.stop()}destroy(){this.logger.log("AudioContext 清除"),this.instant=0,this.slow=0,this.clip=0,this.gainFilter&&this.gainFilter.disconnect(0),this.script&&this.script.disconnect(0);for(let e=0;e<this.audioInArr.length;e++)this.audioInArr[e]&&this.audioInArr[e].disconnect();this.audioInArr=[]}getVolumeData(){return this.instant.toFixed(2)}}t.WebAudio=g},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformType=t.PlatformTypeMap=t.MediaTypeList=t.MediaTypeListVideo=t.MediaTypeListAudio=void 0,t.MediaTypeListAudio=["audio","audioSlave"],t.MediaTypeListVideo=["video","screen"],t.MediaTypeList=["audio","video","screen","audioSlave"],t.PlatformTypeMap={"-1":"unknown",1:"aos",2:"ios",4:"pc",8:"winphone",9:"mac",16:"web"},function(e){e[e.unknown=-1]="unknown",e[e.aos=1]="aos",e[e.ios=2]="ios",e[e.pc=4]="pc",e[e.winphone=8]="winphone",e[e.mac=9]="mac",e[e.web=16]="web"}(t.PlatformType||(t.PlatformType={}))},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isNumber=t.isExistOptions=t.checkValidObject=t.checkValidString=t.checkValidInteger=t.checkValidFloat=t.checkValidBoolean=t.checkExists=t.isValidInteger=void 0;const a=s(r(12)),c=s(r(13)),u=o(r(24)),l=e=>Number.isInteger(e.value)?"number"==typeof e.min&&e.value<e.min?{result:!1,zhMsg:"参数小于最小值 "+e.min,enMsg:"The parameter is less than the minimum value "+e.min}:"number"==typeof e.max&&e.value>e.max?{result:!1,zhMsg:"参数大于最大值 "+e.max,enMsg:"The parameter is greater than the maximum value "+e.max}:{result:!0}:{result:!1,zhMsg:"参数不是整数",enMsg:"Parameter is not Number"};t.isValidInteger=l,t.checkValidInteger=e=>{const t=l(e);if(!t.result){let r=u.IS_ZH?`checkValidInteger: 参数错误: ${e.tag}:${t.zhMsg}`:`checkValidInteger: invalid parameter: ${e.tag}:${t.enMsg}`;throw new c.default({code:a.default.INVALID_PARAMETER_ERROR,message:r})}},t.checkValidBoolean=e=>{const t=(e=>"boolean"!=typeof e.value?{result:!1,enMsg:"The parameter is not Boolean",zhMsg:"参数不是布尔类型"}:{result:!0})(e);if(!t.result){let r=u.IS_ZH?`checkValidBoolean: 参数错误: ${e.tag}:${t.zhMsg}`:`checkValidBoolean: invalid parameter: ${e.tag}:${t.enMsg}`;throw new c.default({code:a.default.INVALID_PARAMETER_ERROR,message:r})}},t.checkValidString=e=>{const t=(e=>"string"!=typeof e.value?{result:!1,zhMsg:"参数不是字符串",enMsg:"The parameter is not String"}:"number"==typeof e.min&&e.value.length<e.min?{result:!1,zhMsg:"参数长度最小值"+e.min,enMsg:"The parameter is less than the minimum value "+e.min}:"number"==typeof e.max&&e.value.length>e.max?{result:!1,zhMsg:"参数长度大于最大值"+e.max,enMsg:"The parameter is greater than the maximum value "+e.max}:{result:!0})(e);if(!t.result){let r=u.IS_ZH?`checkValidString: 参数错误: ${e.tag}:${t.zhMsg}`:`checkValidString: invalid parameter: ${e.tag}:${t.enMsg}`;throw new c.default({code:a.default.INVALID_PARAMETER_ERROR,message:r})}},t.checkValidObject=e=>{const t=(e=>"object"!=typeof e.value?{result:!1,zhMsg:"参数不是对象",enMsg:"The parameter is not Object"}:{result:!0})(e);if(!t.result){let r=u.IS_ZH?`checkValidObject: 参数错误: ${e.tag}:${t.zhMsg}`:`checkValidObject: invalid parameter: ${e.tag}:${t.enMsg}`;throw new c.default({code:a.default.INVALID_PARAMETER_ERROR,message:r})}},t.checkValidFloat=e=>{const t=(e=>Number.isFinite(e.value)?"number"==typeof e.min&&e.value<e.min?{result:!1,zhMsg:"参数小于最小值"+e.min,enMsg:"The parameter is less than the minimum value "+e.min}:"number"==typeof e.max&&e.value>e.max?{result:!1,zhMsg:"参数大于最大值"+e.max,enMsg:"The parameter is greater than the maximum value "+e.max}:{result:!0}:{result:!1,zhMsg:"参数不是float类型",enMsg:"The parameter is not float"})(e);if(!t.result){let r=u.IS_ZH?`checkValidFloat: 参数错误: ${e.tag}:${t.zhMsg}`:`checkValidFloat: invalid parameter: ${e.tag}:${t.enMsg}`;throw new c.default({code:a.default.INVALID_PARAMETER_ERROR,message:r})}};const d=e=>void 0===e.value||null===e.value?{result:!1,zhMsg:"未填必选参数",enMsg:"Missing required parameters"}:{result:!0};t.isExistOptions=d,t.checkExists=e=>{const t=d(e);if(!t.result){let r=u.IS_ZH?`checkExists: 参数错误: ${e.tag}:${t.zhMsg}`:`checkExists: invalid parameter: ${e.tag}:${t.enMsg}`;throw new c.default({code:a.default.INVALID_PARAMETER_ERROR,message:r})}},t.isNumber=e=>!isNaN(parseFloat(e))&&"number"==typeof e},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&m())}function m(){if(!l){var e=a(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||l||a(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RTCEventEmitter=void 0;const n=r(10);class i extends n.EventEmitter{constructor(){super(),this._events||(this._events={})}safeEmit(e,...t){try{e.match(/^@/)||this.emit("@"+e,...t),this.emit(e,...t)}catch(t){(this.logger||console).error(`Error on event ${e}: ${t.name} ${t.message}`,t.stack)}}}t.RTCEventEmitter=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultLogger=t.Logger=t.updateLogIndex=void 0;const n=r(4),i=r(70),o=r(208),s=r(118),a=r(57),c=r(62);let u=0,l=[];function d(){return u++,(""+u).padStart(4,"0")}t.updateLogIndex=d;class p{constructor(e){this.style="color:#1cb977;",this.options=e,this.api="log",this.tagGen=e.tagGen,e.isSavedLogs&&(this.logHelper=new o.logHelper(e)),this.supportedBrowsers=["Chrome","Safari","Firefox","Chrome Mobile","Electron"],this.cs=console}getChild(e){const t=Object.assign({},this.options),r=new p(t);return r.tagGen=e,r.parent=this,r}debug(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("DEBUG",[].slice.call(arguments,0));n.getParameters().logLevel<=i.loglevels.DEBUG&&this._log("debug",e),h(e)}log(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("LOG",[].slice.call(arguments,0));if(-1!==this.supportedBrowsers.indexOf(s.getBrowserInfo().browserName)&&"string"==typeof e[0]){e[0]="%c"+e[0],e.splice(1,0,this.style);for(let t=2;t<e.length&&"string"==typeof e[t];t++)e[0]+="%c"+e[t],e[t]=""}n.getParameters().logLevel<=i.loglevels.INFO&&this._log("log",e),h(e)}info(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("INFO",[].slice.call(arguments,0));-1!==this.supportedBrowsers.indexOf(s.getBrowserInfo().browserName)&&"string"==typeof e[0]&&(e[0]="%c"+e[0],e.splice(1,0,this.style)),n.getParameters().logLevel<=i.loglevels.INFO&&this._log("info",e),h(e)}warn(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("WARN",[].slice.call(arguments,0));-1!==this.supportedBrowsers.indexOf(s.getBrowserInfo().browserName)&&"string"==typeof e[0]&&(e[0]="%c"+e[0],e.splice(1,0,this.style)),n.getParameters().logLevel<=i.loglevels.WARNING&&this._log("warn",e),h(e)}error(){this.logHelper&&this.logHelper.log(arguments);var e=this.formatArgs("ERROR",[].slice.call(arguments,0));-1!==this.supportedBrowsers.indexOf(s.getBrowserInfo().browserName)&&"string"==typeof e[0]&&(e[0]="%c"+e[0],e.splice(1,0,this.style)),n.getParameters().logLevel<=i.loglevels.ERROR&&this._log("error",e),h(e)}_log(e,t){let r=this.options.logFunc,n=null;if(r&&(r[e]&&(n=r[e]),"function"==typeof n))n.apply(r,t);else if(this.cs[e])try{this.cs[e].apply?this.chrome(e,t):this.ie(e,t)}catch(e){}}chrome(e,t){s.getBrowserInfo().browserName,this.cs[e]?this.cs[e].apply(this.cs,t):this.cs.log?this.cs.log.apply(this.cs,t):this.ie(e,t)}ie(e,t){var r=this;t.forEach((function(t){r.cs[e](JSON.stringify(t,null,4))}))}formatArgs(e,t){var r=new Date,n=f(""+(r.getMonth()+1))+"-"+f(""+r.getDate())+" "+f(""+r.getHours())+":"+f(""+r.getMinutes())+":"+f(""+r.getSeconds())+":"+f(""+r.getMilliseconds(),3);let i=this,o="";for(let e=0;e<3&&(i.tagGen&&(o=`[${i.tagGen()}]`+o),i.parent);e++)i=i.parent;return o=`[NERTC:${e}:${d()} ${n}]${o}`,t.splice(0,0,o),t.forEach((function(e,r){e=a.formatSingleArg(e),t[r]="object"==typeof e?function e(t,r=[]){if(!(t=a.formatSingleArg(t))||"object"!=typeof t)return t;let n={};for(let i in t)t.hasOwnProperty&&!t.hasOwnProperty(i)||(t[i]&&"object"==typeof t[i]?-1!==r.indexOf(t[i])?n[i]="[Circular obj]":(r.push(t[i]),n[i]=e(t[i],r)):n[i]=t[i]);return n}(e):e})),t}}t.Logger=p;let m=null;t.getDefaultLogger=function(){return m||(m=new p({tagGen:()=>""+c.BUILD})),m};var f=function(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r};function h(e){let t=window;if(t.logUpload)if(t.wsTransport)l.length&&(l.forEach((e=>{t.wsTransport&&t.wsTransport.sendLog(e.args)})),l=[]),t.wsTransport&&t.wsTransport.sendLog(e);else{let t=Date.now();try{l.length&&l[l.length-1].args[0].replace("[NERTC","[缓存][NERTC")}catch(e){}l.push({time:t,args:e})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.loglevelMap=t.loglevels=void 0,function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.NONE=4]="NONE"}(t.loglevels||(t.loglevels={})),t.loglevelMap={0:"DEBUG",1:"INFO",2:"WARNING",3:"ERROR",4:"NONE"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.reduceCodecs=t.getSupportedCodecs=t.VideoCodecList=void 0;const n=r(4),i=r(140);function o(e){const t={video:[],audio:[]};return e.match(/ H264/i)&&t.video.push("H264"),e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ opus/i)&&t.audio.push("OPUS"),t}function s(e,t,r){const i={video:[],audio:[]};if(t&&t.codecs&&t.codecs.length)for(let r=0;r<t.codecs.length;r++){const o=t.codecs[r];"video/H264"==o.mimeType&&-1===i.video.indexOf("H264")&&("recv"===e&&o.sdpFmtpLine&&o.sdpFmtpLine.indexOf("profile-level-id")>-1?n.getParameters().h264StrictHigh?o.sdpFmtpLine.indexOf("profile-level-id=64")>-1&&i.video.push("H264"):i.video.push("H264"):-1===i.video.indexOf("H264")&&i.video.push("H264")),"video/VP8"==o.mimeType&&-1===i.video.indexOf("VP8")&&i.video.push("VP8")}if(r&&r.codecs&&r.codecs.length)for(let e=0;e<r.codecs.length;e++)"audio/opus"==r.codecs[e].mimeType&&i.audio.push("OPUS");return i}function a(e){if("undefined"!=typeof RTCRtpSender){const t=RTCRtpSender.getCapabilities("video");if(t)for(let r in t.codecs){const n=t.codecs[r];if("video/H264"===n.mimeType&&n.sdpFmtpLine&&n.sdpFmtpLine.indexOf(e)>-1)return!0}}return!1}t.VideoCodecList=["H264","VP8"],t.getSupportedCodecs=async function(e="recv",t=RTCPeerConnection){if("recv"===e){if("undefined"!=typeof RTCRtpReceiver&&RTCRtpReceiver.getCapabilities)return s(e,RTCRtpReceiver.getCapabilities("video"),RTCRtpReceiver.getCapabilities("audio"));{const e=new t({});e.addTransceiver("audio",{direction:"recvonly"}),e.addTransceiver("video",{direction:"recvonly"});const r=await e.createOffer({});return e.close(),r.sdp?o(r.sdp):!1}}if("undefined"!=typeof RTCRtpSender&&RTCRtpSender.getCapabilities)return s(e,RTCRtpSender.getCapabilities("video"),RTCRtpSender.getCapabilities("audio"));{const e=new t({});let r=new i.RTCCanvas("canvas");const n=r._canvas.captureStream(0);e.addTrack(n.getVideoTracks()[0],n);const s=await e.createOffer({});if(e.close(),!s.sdp)return!1;const a=o(s.sdp);return r.destroy(),a}},t.reduceCodecs=function(e,r){const i=[];for(let o=0;o<e.length;o++){if(e[o].mimeType&&r&&t.VideoCodecList.indexOf(e[o].mimeType.split("/")[1])>-1&&e[o].mimeType!==r.mimeType){o++;continue}const s=e[o];"video/H264"===s.mimeType&&n.getParameters().h264ProfileLevel&&(s.parameters["profile-level-id"]&&a(n.getParameters().h264ProfileLevel)?(console.warn(`Changing Codec ${s.parameters["profile-level-id"]} => ${n.getParameters().h264ProfileLevel}`),s.parameters["profile-level-id"]=n.getParameters().h264ProfileLevel):console.warn("H264 Profile Level is not supported in current browser")),i.push(e[o])}return i}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e,t={}){return void 0===e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getStream=t.getScreenStream=t.emptyStreamWith=t.printForLongPromise=t.watchTrack=void 0;const n=r(174),i=r(147),o=r(117),s=r(4),a=r(63),c=r(241),u=r(242),l=r(69),d=new l.Logger({tagGen:()=>"GUM"});let p=0;t.getStream=async function(e,t){if(e.audio){if(!e.audio.deviceId){const r=o.Device.deviceHistory.audioIn.find((e=>"default"===e.deviceId));r&&(t.log("getStream：音频使用默认设备"+r.label),e.audio.deviceId={exact:r.deviceId})}i.compatAudioInputList.enabled&&(t.log("兼容模式：constraint强制将channelCount设为2，echoCancellation设为false"),e.audio.channelCount=2,e.audio.echoCancellation=!1)}const r=++p;t.log("getLocalStream constraint: #"+r,JSON.stringify(e));try{const o=navigator.mediaDevices.getUserMedia(e);v(o,"仍在等待 getUserMedia 返回 #"+r);const l=await o;t.log("获取到媒体流: #"+r,l.id);const d=l.getTracks();for(let e=0;e<d.length;e++){const r=d[e];if(g(r),"video"===r.kind){if(c.canShimCanvas()){t.warn("使用canvas track取代videoTrack",r.label);const e=c.shimCanvas(r);g(e),l.removeTrack(r),l.addTrack(e)}}else if("audio"===r.kind&&i.compatAudioInputList.enabled){const e=r.getSettings?r.getSettings():{};e.channelCount&&e.channelCount>=2?t.log("该设备支持兼容模式："+r.label,e):t.warn("该设备为单声道设备，强行开启兼容模式(右声道无声)："+r.label,e);const o=a.getAudioContext();if(o){const e=o.createChannelSplitter(2),a=o.createMediaStreamDestination(),c=new MediaStream([r]),d=o.createMediaStreamSource(c),p=new n.AudioLevel({stream:c,logger:t,sourceNode:d});let m=0;"left"===s.getParameters().audioInputcompatMode?(t.log("兼容模式：仅使用左声道"),m=0):"right"===s.getParameters().audioInputcompatMode?(t.log("兼容模式：仅使用右声道"),m=1):"auto"===s.getParameters().audioInputcompatMode&&(t.log("兼容模式：在左右声道间根据音量切换"),p.on("channel-state-change",(n=>{"leftLoud"===n.state&&1===m?(t.log("兼容模式切换至左声道：",r.label),e.disconnect(a),e.connect(a,0),m=0):"rightLoud"===n.state&&0===m&&(t.log("兼容模式切换至右声道：",r.label),e.disconnect(a),e.connect(a,1),m=1)}))),d.connect(e),e.connect(a,m);const f=a.stream.getTracks()[0];g(f),i.compatAudioInputList.compatTracks.push({source:r,dest:f}),u.syncTrackState(r,f,"bidirectional"),l.removeTrack(r),l.addTrack(f),t.log("getStream：启用兼容模式成功")}}}return l}catch(r){return t.error(`getUserMedia error: ${r.name} [${r.message}] constraint: ${JSON.stringify(e)}`),Promise.reject(r)}},t.getScreenStream=async function(e,t){var r;const n=++p;let i;t.log("getScreenStream constraint: #"+n,JSON.stringify(e,null," ")),navigator.getDisplayMedia||navigator.mediaDevices.getDisplayMedia;try{const t=navigator.mediaDevices.getDisplayMedia(e);v(t,"仍在等待 getDisplayMedia 返回 #"+n),i=await t}catch(s){if(!((null===(r=null==s?void 0:s.message)||void 0===r?void 0:r.indexOf("user gesture"))>-1&&o.Device.onUserGestureNeeded))throw t.error("屏幕共享获取失败: #"+n,s.name,s.message),s;t.warn("荧幕共享获取中断，需要手势触发。",n),o.Device.onUserGestureNeeded(s);try{i=await new Promise(((t,r)=>{o.Device.once("user-gesture-fired",(()=>{navigator.mediaDevices.getDisplayMedia(e).then(t).catch(r)}))}))}catch(e){throw t.error("第二次屏幕共享获取失败: #"+n,e.name,e.message),e}}return(e=>{t.log("获取到屏幕共享流: #"+n,e.id),e.getTracks().forEach((e=>{if(g(e),"video"===e.kind&&s.getParameters().screenFocus)if(e.focus){t.log("屏幕共享不跳转到被共享页面");try{e.focus("no-focus-change")}catch(e){}}else t.log("当前浏览器不支持屏幕共享跳转控制")})),Promise.resolve(e)})(i),i};let m=Date.now(),f=0;const h=()=>{const e=s.getParameters().tracks.video,t=s.getParameters().tracks.audio,r=Date.now();if(r-m>5e3&&f<s.getParameters().maxEventLoopLagWarning){let e=`侦测到主线程事件循环从卡死中恢复。卡顿时间：${r-m-1e3}毫秒。`;e+="这可能是由于页面切往后台、设备休眠、频繁的dom操作、阻塞性代码引起的。",e+=`当前页面页面是否隐藏：${document.hidden}，可见性：${document.visibilityState}，网络状态：${navigator.onLine}。`,f+=1,f===s.getParameters().maxEventLoopLagWarning&&(e+="今后不再提示。"),d.warn(e)}m=r,e.forEach(((e,t)=>{if(e&&!e.endedAt&&"ended"===e.readyState){d.log(`VIDEOTRACK#${t} 已停止：【${e.label}】`),e.endedAt=r;const n=new CustomEvent("neTrackEnded");e.dispatchEvent(n)}})),t.forEach(((e,t)=>{if(e&&!e.endedAt&&"ended"===e.readyState){d.log(`AUDIOTRACK#${t} 已停止：【${e.label}】`),e.endedAt=r;const n=new CustomEvent("neTrackEnded");e.dispatchEvent(n)}}))};function g(e){if(e)if("ended"===e.readyState&&d.error("注意：输入的track已经停止：",e),"audio"===e.kind){const t=s.getParameters().tracks.audio;d.log("获取到的设备类型: AUDIOTRACK#"+t.length,e.kind,e.label,e.id,JSON.stringify(e.getSettings()));const r=t.findIndex((t=>e===t));r>-1?(d.warn(`注意：AUDIOTRACK#${t.length} 与 AUDIOTRACK#${r} 相同`),t.push(null)):(e.addEventListener("ended",h),t.push(e))}else{const t=s.getParameters().tracks.video;d.log("获取到的设备类型: VIDEOTRACK#"+t.length,e.kind,e.label,e.id,JSON.stringify(e.getSettings()));const r=t.findIndex((t=>e===t));r>-1?(d.warn(`注意：VIDEOTRACK#${t.length} 与 VIDEOTRACK#${r} 相同`),t.push(null)):(e.addEventListener("ended",h),t.push(e))}}async function v(e,t){let r=0;const n=Date.now();let i=setInterval((()=>{r++,l.getDefaultLogger().warn(`${t} ${Date.now()-n}ms`),i&&r>10&&(clearInterval(i),i=null)}),6e3);e.then((()=>{i&&(clearInterval(i),i=null)})).catch((e=>{i&&(clearInterval(i),i=null)}))}setInterval(h,1e3),t.watchTrack=g,t.printForLongPromise=v,t.emptyStreamWith=function(e,t){let r=!1;e.getTracks().forEach((n=>{n!==t?(e.removeTrack(n),e.onremovetrack&&e.onremovetrack({track:n})):r=!0})),!r&&t&&(e.addTrack(t),e.onaddtrack&&e.onaddtrack({track:t}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.NeAudioNode=t.NeAudioNodeNullable=void 0;const n=r(68);let i=0;class o extends n.RTCEventEmitter{constructor(e,t){super(),this.id=i++,this.connectedTo=[],this.connectedFrom=[],this.tag=e,this.audioNode=t}connect(e){this.audioNode&&e.audioNode&&this.audioNode.connect(e.audioNode),-1===this.connectedTo.indexOf(e)&&this.connectedTo.push(e),-1===e.connectedFrom.indexOf(this)&&e.connectedFrom.push(this)}disconnect(e){this.audioNode&&e.audioNode&&this.audioNode.disconnect(e.audioNode),-1!==this.connectedTo.indexOf(e)&&this.connectedTo.splice(this.connectedTo.indexOf(e),1),-1===e.connectedFrom.indexOf(this)&&e.connectedFrom.splice(e.connectedFrom.indexOf(this),1)}isConnectedTo(e){return this.connectedTo.indexOf(e)>-1}isConnectedFrom(e){return this.connectedFrom.indexOf(e)>-1}disconnectFromAll(){this.connectedFrom.forEach((e=>{e.audioNode&&this.audioNode&&e.audioNode.disconnect(this.audioNode);const t=e.connectedTo.indexOf(this);t>-1&&e.connectedTo.splice(t,1)})),this.connectedFrom.length=0}disconnectToAll(){this.connectedTo.forEach((e=>{e.audioNode&&this.audioNode&&this.audioNode.disconnect(e.audioNode);const t=e.connectedFrom.indexOf(this);t>-1&&e.connectedFrom.splice(t,1)})),this.connectedTo.length=0}updateNode(e){this.connectedTo.forEach((t=>{t.audioNode&&(this.audioNode&&this.audioNode.disconnect(t.audioNode),e.connect(t.audioNode))})),this.connectedFrom.forEach((t=>{t.audioNode&&(this.audioNode&&t.audioNode.disconnect(this.audioNode),t.audioNode.connect(e))})),this.audioNode=e}}t.NeAudioNodeNullable=o,t.NeAudioNode=class extends o{constructor(e,t){super(e,t),this.tag=e,this.audioNode=t}}},function(e,t,r){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(76),i)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){var r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=h;var l={},d={};d[o]=function(){return this};var p=Object.getPrototypeOf,m=p&&p(p(E([])));m&&m!==r&&n.call(m,o)&&(d=m);var f=b.prototype=v.prototype=Object.create(d);y.prototype=f.constructor=b,b.constructor=y,b[a]=y.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(f),e},u.awrap=function(e){return{__await:e}},S(T.prototype),T.prototype[s]=function(){return this},u.AsyncIterator=T,u.async=function(e,t,r,n){var i=new T(h(e,t,r,n));return u.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(f),f[a]="Generator",f[o]=function(){return this},f.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},u.values=E,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}}}function h(e,t,r,n){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),s=new x(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=_(s,r);if(a){if(a===l)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=g(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function g(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function v(){}function y(){}function b(){}function S(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function T(e){var t;this._invoke=function(r,i){function o(){return new Promise((function(t,o){!function t(r,i,o,s){var a=g(e[r],e,i);if("throw"!==a.type){var c=a.arg,u=c.value;return u&&"object"==typeof u&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,s)}),(function(e){t("throw",e,o,s)})):Promise.resolve(u).then((function(e){c.value=e,o(c)}),s)}s(a.arg)}(r,i,t,o)}))}return t=t?t.then(o,o):o()}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=g(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,r){e.exports={default:r(78),__esModule:!0}},function(e,t,r){r(38),r(39),r(48),r(89),r(101),r(102),e.exports=r(2).Promise},function(e,t,r){var n=r(26),i=r(27);e.exports=function(e){return function(t,r){var o,s,a=String(i(t)),c=n(r),u=a.length;return c<0||c>=u?e?"":void 0:(o=a.charCodeAt(c))<55296||o>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):o:e?a.slice(c,c+2):s-56320+(o-55296<<10)+65536}}},function(e,t,r){var n=r(43),i=r(21),o=r(23),s={};r(5)(s,r(1)("iterator"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n(s,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t,r){var n=r(6),i=r(3),o=r(30);e.exports=r(8)?Object.defineProperties:function(e,t){i(e);for(var r,s=o(t),a=s.length,c=0;a>c;)n.f(e,r=s[c++],t[r]);return e}},function(e,t,r){var n=r(17);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(11),i=r(45),o=r(84);e.exports=function(e){return function(t,r,s){var a,c=n(t),u=i(c.length),l=o(s,u);if(e&&r!=r){for(;u>l;)if((a=c[l++])!=a)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}}},function(e,t,r){var n=r(26),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},function(e,t,r){var n=r(9),i=r(47),o=r(31)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,r){var n=r(87),i=r(88),o=r(16),s=r(11);e.exports=r(40)(Array,"Array",(function(e,t){this._t=s(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n,i,o,s,a=r(14),c=r(0),u=r(18),l=r(49),d=r(15),p=r(7),m=r(19),f=r(90),h=r(91),g=r(50),v=r(51).set,y=r(96)(),b=r(34),S=r(52),T=r(97),_=r(53),w=c.TypeError,M=c.process,x=M&&M.versions,E=x&&x.v8||"",C=c.Promise,R="process"==l(M),k=function(){},A=i=b.f,I=!!function(){try{var e=C.resolve(1),t=(e.constructor={})[r(1)("species")]=function(e){e(k,k)};return(R||"function"==typeof PromiseRejectionEvent)&&e.then(k)instanceof t&&0!==E.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(e){}}(),O=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},P=function(e,t){if(!e._n){e._n=!0;var r=e._c;y((function(){for(var n=e._v,i=1==e._s,o=0,s=function(t){var r,o,s,a=i?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{a?(i||(2==e._h&&L(e),e._h=1),!0===a?r=n:(l&&l.enter(),r=a(n),l&&(l.exit(),s=!0)),r===t.promise?u(w("Promise-chain cycle")):(o=O(r))?o.call(r,c,u):c(r)):u(n)}catch(e){l&&!s&&l.exit(),u(e)}};r.length>o;)s(r[o++]);e._c=[],e._n=!1,t&&!e._h&&N(e)}))}},N=function(e){v.call(c,(function(){var t,r,n,i=e._v,o=D(e);if(o&&(t=S((function(){R?M.emit("unhandledRejection",i,e):(r=c.onunhandledrejection)?r({promise:e,reason:i}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=R||D(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){v.call(c,(function(){var t;R?M.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},j=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),P(t,!0))},U=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw w("Promise can't be resolved itself");(t=O(e))?y((function(){var n={_w:r,_d:!1};try{t.call(e,u(U,n,1),u(j,n,1))}catch(e){j.call(n,e)}})):(r._v=e,r._s=1,P(r,!1))}catch(e){j.call({_w:r,_d:!1},e)}}};I||(C=function(e){f(this,C,"Promise","_h"),m(e),n.call(this);try{e(u(U,this,1),u(j,this,1))}catch(e){j.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(98)(C.prototype,{then:function(e,t){var r=A(g(this,C));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=R?M.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&P(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n;this.promise=e,this.resolve=u(U,e,1),this.reject=u(j,e,1)},b.f=A=function(e){return e===C||e===s?new o(e):i(e)}),d(d.G+d.W+d.F*!I,{Promise:C}),r(23)(C,"Promise"),r(99)("Promise"),s=r(2).Promise,d(d.S+d.F*!I,"Promise",{reject:function(e){var t=A(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(a||!I),"Promise",{resolve:function(e){return _(a&&this===s?C:this,e)}}),d(d.S+d.F*!(I&&r(100)((function(e){C.all(e).catch(k)}))),"Promise",{all:function(e){var t=this,r=A(t),n=r.resolve,i=r.reject,o=S((function(){var r=[],o=0,s=1;h(e,!1,(function(e){var a=o++,c=!1;r.push(void 0),s++,t.resolve(e).then((function(e){c||(c=!0,r[a]=e,--s||n(r))}),i)})),--s||n(r)}));return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=A(t),n=r.reject,i=S((function(){h(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(18),i=r(92),o=r(93),s=r(3),a=r(45),c=r(94),u={},l={};(t=e.exports=function(e,t,r,d,p){var m,f,h,g,v=p?function(){return e}:c(e),y=n(r,d,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(m=a(e.length);m>b;b++)if((g=t?y(s(f=e[b])[0],f[1]):y(e[b]))===u||g===l)return g}else for(h=v.call(e);!(f=h.next()).done;)if((g=i(h,y,f.value,t))===u||g===l)return g}).BREAK=u,t.RETURN=l},function(e,t,r){var n=r(3);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},function(e,t,r){var n=r(16),i=r(1)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){var n=r(49),i=r(1)("iterator"),o=r(16);e.exports=r(2).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(0),i=r(51).set,o=n.MutationObserver||n.WebKitMutationObserver,s=n.process,a=n.Promise,c="process"==r(17)(s);e.exports=function(){var e,t,r,u=function(){var n,i;for(c&&(n=s.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){s.nextTick(u)};else if(!o||n.navigator&&n.navigator.standalone)if(a&&a.resolve){var l=a.resolve(void 0);r=function(){l.then(u)}}else r=function(){i.call(n,u)};else{var d=!0,p=document.createTextNode("");new o(u).observe(p,{characterData:!0}),r=function(){p.data=d=!d}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){var n=r(0).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(5);e.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},function(e,t,r){var n=r(0),i=r(2),o=r(6),s=r(8),a=r(1)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(1)("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],s=o[n]();s.next=function(){return{done:r=!0}},o[n]=function(){return s},e(o)}catch(e){}return r}},function(e,t,r){var n=r(15),i=r(2),o=r(0),s=r(50),a=r(53);n(n.P+n.R,"Promise",{finally:function(e){var t=s(this,i.Promise||o.Promise),r="function"==typeof e;return this.then(r?function(r){return a(t,e()).then((function(){return r}))}:e,r?function(r){return a(t,e()).then((function(){throw r}))}:e)}})},function(e,t,r){var n=r(15),i=r(34),o=r(52);n(n.S,"Promise",{try:function(e){var t=i.f(this),r=o(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){t.__esModule=!0;var n=s(r(104)),i=s(r(106)),o="function"==typeof i.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function s(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===o(n.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}},function(e,t,r){e.exports={default:r(105),__esModule:!0}},function(e,t,r){r(39),r(48),e.exports=r(35).f("iterator")},function(e,t,r){e.exports={default:r(107),__esModule:!0}},function(e,t,r){r(108),r(38),r(114),r(115),e.exports=r(2).Symbol},function(e,t,r){var n=r(0),i=r(9),o=r(8),s=r(15),a=r(42),c=r(109).KEY,u=r(20),l=r(32),d=r(23),p=r(22),m=r(1),f=r(35),h=r(36),g=r(110),v=r(111),y=r(3),b=r(7),S=r(47),T=r(11),_=r(29),w=r(21),M=r(43),x=r(112),E=r(113),C=r(54),R=r(6),k=r(30),A=E.f,I=R.f,O=x.f,P=n.Symbol,N=n.JSON,D=N&&N.stringify,L=m("_hidden"),j=m("toPrimitive"),U={}.propertyIsEnumerable,F=l("symbol-registry"),$=l("symbols"),B=l("op-symbols"),V=Object.prototype,H="function"==typeof P&&!!C.f,W=n.QObject,q=!W||!W.prototype||!W.prototype.findChild,z=o&&u((function(){return 7!=M(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=A(V,t);n&&delete V[t],I(e,t,r),n&&e!==V&&I(V,t,n)}:I,G=function(e){var t=$[e]=M(P.prototype);return t._k=e,t},J=H&&"symbol"==typeof P.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof P},K=function(e,t,r){return e===V&&K(B,t,r),y(e),t=_(t,!0),y(r),i($,t)?(r.enumerable?(i(e,L)&&e[L][t]&&(e[L][t]=!1),r=M(r,{enumerable:w(0,!1)})):(i(e,L)||I(e,L,w(1,{})),e[L][t]=!0),z(e,t,r)):I(e,t,r)},Q=function(e,t){y(e);for(var r,n=g(t=T(t)),i=0,o=n.length;o>i;)K(e,r=n[i++],t[r]);return e},Y=function(e){var t=U.call(this,e=_(e,!0));return!(this===V&&i($,e)&&!i(B,e))&&(!(t||!i(this,e)||!i($,e)||i(this,L)&&this[L][e])||t)},X=function(e,t){if(e=T(e),t=_(t,!0),e!==V||!i($,t)||i(B,t)){var r=A(e,t);return!r||!i($,t)||i(e,L)&&e[L][t]||(r.enumerable=!0),r}},Z=function(e){for(var t,r=O(T(e)),n=[],o=0;r.length>o;)i($,t=r[o++])||t==L||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===V,n=O(r?B:T(e)),o=[],s=0;n.length>s;)!i($,t=n[s++])||r&&!i(V,t)||o.push($[t]);return o};H||(a((P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===V&&t.call(B,r),i(this,L)&&i(this[L],e)&&(this[L][e]=!1),z(this,e,w(1,r))};return o&&q&&z(V,e,{configurable:!0,set:t}),G(e)}).prototype,"toString",(function(){return this._k})),E.f=X,R.f=K,r(55).f=x.f=Z,r(37).f=Y,C.f=ee,o&&!r(14)&&a(V,"propertyIsEnumerable",Y,!0),f.f=function(e){return G(m(e))}),s(s.G+s.W+s.F*!H,{Symbol:P});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)m(te[re++]);for(var ne=k(m.store),ie=0;ne.length>ie;)h(ne[ie++]);s(s.S+s.F*!H,"Symbol",{for:function(e){return i(F,e+="")?F[e]:F[e]=P(e)},keyFor:function(e){if(!J(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){q=!0},useSimple:function(){q=!1}}),s(s.S+s.F*!H,"Object",{create:function(e,t){return void 0===t?M(e):Q(M(e),t)},defineProperty:K,defineProperties:Q,getOwnPropertyDescriptor:X,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var oe=u((function(){C.f(1)}));s(s.S+s.F*oe,"Object",{getOwnPropertySymbols:function(e){return C.f(S(e))}}),N&&s(s.S+s.F*(!H||u((function(){var e=P();return"[null]"!=D([e])||"{}"!=D({a:e})||"{}"!=D(Object(e))}))),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(b(t)||void 0!==e)&&!J(e))return v(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!J(t))return t}),n[1]=t,D.apply(N,n)}}),P.prototype[j]||r(5)(P.prototype,j,P.prototype.valueOf),d(P,"Symbol"),d(Math,"Math",!0),d(n.JSON,"JSON",!0)},function(e,t,r){var n=r(22)("meta"),i=r(7),o=r(9),s=r(6).f,a=0,c=Object.isExtensible||function(){return!0},u=!r(20)((function(){return c(Object.preventExtensions({}))})),l=function(e){s(e,n,{value:{i:"O"+ ++a,w:{}}})},d=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!c(e))return"F";if(!t)return"E";l(e)}return e[n].i},getWeak:function(e,t){if(!o(e,n)){if(!c(e))return!0;if(!t)return!1;l(e)}return e[n].w},onFreeze:function(e){return u&&d.NEED&&c(e)&&!o(e,n)&&l(e),e}}},function(e,t,r){var n=r(30),i=r(54),o=r(37);e.exports=function(e){var t=n(e),r=i.f;if(r)for(var s,a=r(e),c=o.f,u=0;a.length>u;)c.call(e,s=a[u++])&&t.push(s);return t}},function(e,t,r){var n=r(17);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(11),i=r(55).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(n(e))}},function(e,t,r){var n=r(37),i=r(21),o=r(11),s=r(29),a=r(9),c=r(41),u=Object.getOwnPropertyDescriptor;t.f=r(8)?u:function(e,t){if(e=o(e),t=s(t,!0),c)try{return u(e,t)}catch(e){}if(a(e,t))return i(!n.f.call(e,t),e[t])}},function(e,t,r){r(36)("asyncIterator")},function(e,t,r){r(36)("observable")},function(e,t,r){function n(e){return e>0&&0==(e&e-1)}Object.defineProperty(t,"__esModule",{value:!0}),t.loadImageBatch=t.retryLoadImage=t.loadImage=t.createTexture=t.imgDataSize=t.toNthPower=t.isNthPower=void 0,t.isNthPower=n,t.toNthPower=function(e){if(n(e))return e;const t=[4096,2048,1024,512,256,128,64,32,16,8,4,2,1];let r=1/0;for(let n=0;n<t.length;n++){const i=t[n],o=Math.abs(e-i);if(e>=i)return o>r?t[n-1]:i;r=o}return 1},t.imgDataSize=function(e,t,r){if(r=null!=r?r:Math.min(t)){const r=Math.max(e,t);if(r>512){const n=r/512;return{width:e/n>>0,height:t/n>>0}}}return{width:e,height:t}},t.createTexture=function e(t,r,n){const i=t.createTexture();if(!i)return console.error(`texture:[${r}] created error.`),null;const o=Object.assign({flipY:!0,wrapS:"clamp",wrapT:"clamp",genMipMaps:!1},n),s={clamp:t.CLAMP_TO_EDGE,repeat:t.REPEAT,mirror:t.MIRRORED_REPEAT},a={glTexture:i,source:r,refresh(){const{source:e,glTexture:r,opts:n}=a,{genMipMaps:i}=n,o=t.TEXTURE_2D;t.bindTexture(o,r);const{flipY:c}=n;c?t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0):t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texParameteri(o,t.TEXTURE_WRAP_S,s[n.wrapS]),t.texParameteri(o,t.TEXTURE_WRAP_T,s[n.wrapT]),t.texParameteri(o,t.TEXTURE_MIN_FILTER,i?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(o,t.TEXTURE_MAG_FILTER,t.LINEAR),"width"in n&&"height"in n?t.texImage2D(o,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,e):null!==e&&t.texImage2D(o,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),i&&t.generateMipmap(o)},updateMipMap(){const{glTexture:e,opts:r}=a,{genMipMaps:n}=r;if(!n)return;const i=t.TEXTURE_2D;t.bindTexture(i,e),t.generateMipmap(i)},clone:()=>e(t,a.source,a.opts),opts:o};return a.refresh(),a};const i={};function o(e,t,r){"string"==typeof e&&e&&(i[e]?null==t||t(i[e]):fetch(e+"?rdn="+Date.now()).then((e=>e.arrayBuffer())).then((n=>{let o=!1;const s=new Blob([n],{type:"image/*"}),a=new Image;new URL(e,window.location.href).origin!==window.location.origin&&(a.crossOrigin="anonymous"),a.onload=()=>{o||(o=!0,i[e]=a,null==t||t(a))},a.onerror=e=>{null==r||r(e)},a.src=URL.createObjectURL(s),setTimeout((()=>{!o&&a.complete&&a.naturalHeight>0&&(o=!0,i[e]=a,null==t||t(a))}),0)})).catch((e=>{null==r||r(e)})))}function s(e,t=3,r,n){let i=null;const s=(a=0)=>{(a+=1)<=t?o(e,(e=>{null==r||r(e)}),(e=>{i=e,s(a)})):null==n||n(i)};s()}t.loadImage=o,t.retryLoadImage=s,t.loadImageBatch=function(e,t=3,r){let n={},i=[];const o=()=>{Object.keys(n).length+i.length===e.length&&(null==r||r(n,i))};e.forEach((e=>{s(e,t,(t=>{n[e]=t,o()}),(()=>{i.push(e),o()}))}))}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.alerter=void 0;const i=n(r(12)),o=n(r(13)),s=r(68),a=r(69),c=r(146);Object.defineProperty(t,"alerter",{enumerable:!0,get:function(){return c.alerter}});const u=r(147),l=r(4);class d extends s.RTCEventEmitter{constructor(){super(),this.deviceChangeDetectionTimer=null,this.deviceInited=!1,this.hasPerm={audioIn:!1,video:!1,audioOut:!1},this.deviceHistory={audioIn:[],video:[],audioOut:[]},this.compatAudioInputList=u.compatAudioInputList,this.onUserGestureNeeded=null,this.logger=new a.Logger({tagGen:()=>`Device m${this.deviceHistory.audioIn.length}c${this.deviceHistory.video.length}s${this.deviceHistory.audioOut.length}`}),this.handleDeviceChange=this.detectDeviceChange.bind(this),this.onUserGestureNeeded=this.defaultHandleUserGestureNeeded.bind(this),c.alerter.addListener("@user-gesture-fired",(()=>{this.safeEmit("user-gesture-fired")}))}async getDevices(e){if(!navigator.mediaDevices)throw this.logger.error("navigator.mediaDevices is "+navigator.mediaDevices),new o.default({code:i.default.NOT_SUPPORT_ERROR,message:"getDevices: 当前浏览器不支持 mediaDevices",url:"https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"});if(!navigator.mediaDevices.enumerateDevices)throw this.logger.error("navigator.mediaDevices is "+navigator.mediaDevices.enumerateDevices),new o.default({code:i.default.NOT_SUPPORT_ERROR,message:"getDevices: 当前浏览器不支持 enumerateDevices",url:"https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"});let t={video:[],audioIn:[],audioOut:[]},r=await navigator.mediaDevices.enumerateDevices(),n=null;if(e.requestPerm){const t=r.find((t=>e.audioinput&&"audioinput"==t.kind&&!t.label)),i=r.find((t=>e.videoinput&&"videoinput"==t.kind&&!t.label));if(t||i)try{n=await navigator.mediaDevices.getUserMedia({audio:t,video:i})}catch(e){this.logger.error(e.name,e.message,e.stack)}}return r=await navigator.mediaDevices.enumerateDevices(),r.forEach((function(r){if(e.videoinput&&"videoinput"===r.kind){let n={deviceId:r.deviceId,label:r.label||(e.noFillLabel?r.label:"camera "+(t.video.length+1))};e.groupId&&(n.groupId=r.groupId),t.video.push(n)}else if(e.audioinput&&"audioinput"===r.kind){let n;n={deviceId:r.deviceId,label:r.label||(e.noFillLabel?r.label:"microphone "+(t.audioIn.length+1))},e.groupId&&(n.groupId=r.groupId),t.audioIn.push(n)}else if(e.audiooutput&&"audiooutput"===r.kind){let n={deviceId:r.deviceId,label:r.label||(e.noFillLabel?r.label:"speaker "+(t.audioOut.length+1))};e.groupId&&(n.groupId=r.groupId),t.audioOut.push(n)}n&&n.getTracks().forEach((e=>{e.stop()}))})),t}async getCameras(e){const t=await this.getDevices({videoinput:!0,requestPerm:e});return t?t.video:[]}async getMicrophones(e){const t=await this.getDevices({audioinput:!0,requestPerm:e});return t?t.audioIn:[]}async getSpeakers(e){const t=await this.getDevices({audioinput:!0,audiooutput:!0,requestPerm:e});return t?t.audioOut:[]}async detectDeviceChange(){let e={audioIn:{added:[],changed:[],removed:[]},video:{added:[],changed:[],removed:[]},audioOut:{added:[],changed:[],removed:[]}};const t=await this.getDevices({audioinput:!0,audiooutput:!0,videoinput:!0,requestPerm:!1,groupId:!0,noFillLabel:!0});["audioIn","video","audioOut"].forEach((r=>{if(this.deviceInited){const n=t[r].find((e=>e.deviceId&&e.label));n?this.hasPerm[r]?(t[r].forEach((t=>{const n=this.deviceHistory[r].find((e=>e.deviceId===t.deviceId||""===e.deviceId&&"default"===t.deviceId));if(n){if(n.label!==t.label||n.groupId!==t.groupId){let i=`检测到设备改变：${r}: deviceId ${t.deviceId}`;n.label!==t.label?i+=`【Label ${n.label} => ${t.label}】`:i+=" Label "+t.label,n.groupId!==t.groupId&&(i+="【groupId changed】"),this.logger.log(i),e[r].changed.push(t)}}else this.logger.log(`检测到设备新增：${r}: deviceId ${t.deviceId} 【${t.label}】`),e[r].added.push(t)})),this.deviceHistory[r].forEach((n=>{t[r].find((e=>n.deviceId===e.deviceId||""===n.deviceId&&"default"===e.deviceId))||(this.logger.log(`检测到设备拔出：${r}: deviceId ${n.deviceId} 【${n.label}】`),e[r].removed.push(n))})),this.deviceHistory[r]=t[r],e[r].added.forEach((e=>{"audioIn"===r?this.emit("recording-device-changed",{device:e,state:"ACTIVE"}):"video"===r?this.emit("camera-changed",{device:e,state:"ACTIVE"}):"audioOut"===r&&this.emit("playout-device-changed",{device:e,state:"ACTIVE"})})),e[r].changed.forEach((e=>{"audioIn"===r?this.emit("recording-device-changed",{device:e,state:"CHANGED"}):"video"===r?this.emit("camera-changed",{device:e,state:"CHANGED"}):"audioOut"===r&&this.emit("playout-device-changed",{device:e,state:"CHANGED"})})),e[r].removed.forEach((e=>{"audioIn"===r?this.emit("recording-device-changed",{device:e,state:"INACTIVE"}):"video"===r?this.emit("camera-changed",{device:e,state:"INACTIVE"}):"audioOut"===r&&this.emit("playout-device-changed",{device:e,state:"INACTIVE"})}))):(this.hasPerm[r]=!0,this.deviceHistory[r]=t[r],"audioIn"===r?(this.logger.log(`麦克风设备：${n.deviceId}【${n.label}】`),this.emit("recording-device-init")):"video"===r?(this.logger.log(`摄像头设备：【${t[r].map((e=>e.label)).join("】【")}】`),this.emit("camera-init")):"audioOut"===r&&(this.logger.log(`扬声器设备：${n.deviceId}【${n.label}】`),this.emit("playout-device-init"))):this.deviceHistory[r]=t[r]}else this.deviceHistory[r]=t[r]})),this.deviceInited||(this.deviceInited=!0,t.audioIn.length||this.logger.error("未侦测到可用麦克风"),t.video.length||this.logger.error("未侦测到可用摄像头"))}async startDeviceChangeDetection(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(this.deviceChangeDetectionTimer&&clearInterval(this.deviceChangeDetectionTimer),await this.handleDeviceChange(),navigator.mediaDevices.ondevicechange?navigator.mediaDevices.ondevicechange===this.handleDeviceChange||(l.getParameters().forceListenDeviceChange?navigator.mediaDevices.ondevicechange=this.handleDeviceChange:this.logger.warn("系统设备枚举回调已被占用，设备枚举实效性将受到影响")):navigator.mediaDevices.ondevicechange=this.handleDeviceChange,l.getParameters().deviceChangeInterval&&(this.deviceChangeDetectionTimer=setInterval(this.handleDeviceChange,1e3))):this.logger.warn("当前环境不支持设备枚举")}stopDeviceChangeDetection(){this.logger.log("停止监听浏览器设备变化"),this.deviceChangeDetectionTimer&&(clearInterval(this.deviceChangeDetectionTimer),this.deviceChangeDetectionTimer=null),navigator.mediaDevices&&navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=null),this.deviceInited=!1,this.deviceHistory.audioIn=[],this.deviceHistory.audioOut=[],this.deviceHistory.video=[],this.hasPerm.audioIn=!1,this.hasPerm.video=!1,this.hasPerm.audioOut=!1}enableCompatMode(){this.logger.log("开启兼容模式"),u.compatAudioInputList.enabled=!0,this.handleDeviceChange()}disableCompatMode(){this.logger.log("关闭兼容模式。"),u.compatAudioInputList.enabled=!1,this.handleDeviceChange()}defaultHandleUserGestureNeeded(e){const t=`由于浏览器限制，该操作需手势触发。<br/>${e.name}<br/>${e.message}<br/>点击此处以继续`;c.alerter.alert(t),this.logger.warn('为避免看到这个消息，您应该实现 Device.onUserGestureNeeded 方法，引导用户作出手势，并触发 Device.on("user-gesture-fired")事件。')}clean(){}}const p=new d;t.Device=p},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserInfo=t.getOSInfo=void 0;const s=o(r(24)),a=new Map([[s.IS_ANDROID,["Android",s.ANDROID_VERSION]],[s.IS_IOS,["iOS",s.IOS_VERSION]],[s.IS_WIN,["Windows",s.WIN_VERSION]],[s.IS_MAC,["MacOS",s.MACOS_VERSION]]]);t.getOSInfo=function(){let e="unknown",t="unknown";return a.get(!0)&&(e=a.get(!0)[0],t=a.get(!0)[1]),{osName:e,osVersion:t}};const c=new Map([[s.IS_FIREFOX,["Firefox",s.FIREFOX_VERSION]],[s.IS_EDG,["Edg",s.EDG_VERSION]],[s.IS_CHROME,["Chrome",s.CHROME_VERSION]],[s.IS_SAFARI,["Safari",s.SAFARI_VERSION]],[s.IS_WECHAT,["WeChat",s.WECHAT_VERSION]],[s.IS_WQQB,["QQ(Win)",s.WQQB_VERSION]],[s.IS_MQQB,["QQ(Mobile)",s.MQQB_VERSION]],[s.IS_X5MQQB,["QQ(Mobile X5)",s.MQQB_VERSION]],[s.IS_MACQQB,["QQ(Mac)",s.MACQQB_VERSION]],[s.IS_IPADQQB,["QQ(iPad)",s.IPADQQB_VERSION]],[s.IS_MIBROWSER,["MI",s.MI_VERSION]],[s.IS_HUAWEIBROWSER,["HW",s.HUAWEI_VERSION]],[s.IS_SAMSUNGBROWSER,["Samsung",s.SAMSUNG_VERSION]],[s.IS_OPPOBROWSER,["OPPO",s.OPPO_VERSION]],[s.IS_VIVOBROWSER,["VIVO",s.VIVO_VERSION]],[s.IS_EDGE,["EDGE",s.EDGE_VERSION]],[s.IS_SOGOUM,["SogouMobile",s.SOGOUM_VERSION]],[s.IS_SOGOU,["Sogou",s.SOGOU_VERSION]],[s.IS_ELECTRON,["Electron",s.ELECTRON_VERSION]]]);t.getBrowserInfo=function(){let e="unknown",t="unknown";return c.get(!0)&&(e=c.get(!0)[0],t=c.get(!0)[1]),{browserName:e,browserVersion:t}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.JSONBigStringify=t.JSONBigParse=void 0;const n=r(244),i=r(245);t.JSONBigParse=i.JSONParse(),t.JSONBigStringify=n.stringify},function(e,t,r){e.exports=o,o.className="ReflectionObject";var n,i=r(25);function o(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(o.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof n&&t._handleAdd(this)},o.prototype.onRemove=function(e){var t=e.root;t instanceof n&&t._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof n&&(this.resolved=!0),this},o.prototype.getOption=function(e){if(this.options)return this.options[e]},o.prototype.setOption=function(e,t,r){return r&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},o.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var o=n.find((function(t){return Object.prototype.hasOwnProperty.call(t,e)}));if(o){var s=o[e];i.setProperty(s,r,t)}else(o={})[e]=i.setProperty({},r,t),n.push(o)}else{var a={};a[e]=t,n.push(a)}return this},o.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},o.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},o._configure=function(e){n=e}},function(e,t,r){e.exports=u;var n=r(120);((u.prototype=Object.create(n.prototype)).constructor=u).className="Field";var i,o=r(59),s=r(130),a=r(25),c=/^required|optional|repeated$/;function u(e,t,r,i,o,u,l){if(a.isObject(i)?(l=o,u=i,i=o=void 0):a.isObject(o)&&(l=u,u=o,o=void 0),n.call(this,e,u),!a.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!a.isString(r))throw TypeError("type must be a string");if(void 0!==i&&!c.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==o&&!a.isString(o))throw TypeError("extend must be a string");"proto3_optional"===i&&(i="optional"),this.rule=i&&"optional"!==i?i:void 0,this.type=r,this.id=t,this.extend=o||void 0,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!a.Long&&void 0!==s.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=l}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,r){return"packed"===e&&(this._packed=null),n.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return a.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=s.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof o&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof o)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=a.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;a.base64.test(this.typeDefault)?a.base64.decode(this.typeDefault,e=a.newBuffer(a.base64.length(this.typeDefault)),0):a.utf8.write(this.typeDefault,e=a.newBuffer(a.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=a.emptyObject:this.repeated?this.defaultValue=a.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),n.prototype.resolve.call(this)},u.d=function(e,t,r,n){return"function"==typeof t?t=a.decorateType(t).name:t&&"object"==typeof t&&(t=a.decorateEnum(t).name),function(i,o){a.decorateType(i.constructor).add(new u(o,e,t,r,{default:n}))}},u._configure=function(e){i=e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.STREAM_TYPE_REV=t.STREAM_TYPE=t.NERTC_VIDEO_QUALITY_REV=t.NERTC_VIDEO_QUALITY=t.NERTC_VIDEO_QUALITY_ENUM=t.NERTC_RECORD_VIDEO_FRAME_RATE=t.NERTC_RECORD_VIDEO_QUALITY=t.VIDEO_FRAME_RATE=t.VIDEO_FRAME_RATE_ENUM=void 0,function(e){e[e.CHAT_VIDEO_FRAME_RATE_NORMAL=0]="CHAT_VIDEO_FRAME_RATE_NORMAL",e[e.CHAT_VIDEO_FRAME_RATE_5=1]="CHAT_VIDEO_FRAME_RATE_5",e[e.CHAT_VIDEO_FRAME_RATE_10=2]="CHAT_VIDEO_FRAME_RATE_10",e[e.CHAT_VIDEO_FRAME_RATE_15=3]="CHAT_VIDEO_FRAME_RATE_15",e[e.CHAT_VIDEO_FRAME_RATE_20=4]="CHAT_VIDEO_FRAME_RATE_20",e[e.CHAT_VIDEO_FRAME_RATE_25=5]="CHAT_VIDEO_FRAME_RATE_25",e[e.CHAT_VIDEO_FRAME_RATE_30=6]="CHAT_VIDEO_FRAME_RATE_30"}(t.VIDEO_FRAME_RATE_ENUM||(t.VIDEO_FRAME_RATE_ENUM={})),t.VIDEO_FRAME_RATE={CHAT_VIDEO_FRAME_RATE_NORMAL:0,CHAT_VIDEO_FRAME_RATE_5:1,CHAT_VIDEO_FRAME_RATE_10:2,CHAT_VIDEO_FRAME_RATE_15:3,CHAT_VIDEO_FRAME_RATE_20:4,CHAT_VIDEO_FRAME_RATE_25:5,CHAT_VIDEO_FRAME_RATE_30:6},t.NERTC_RECORD_VIDEO_QUALITY={RECORD_VIDEO_QUALITY_360p:360,RECORD_VIDEO_QUALITY_480p:480,RECORD_VIDEO_QUALITY_720p:720},t.NERTC_RECORD_VIDEO_FRAME_RATE={RECORD_VIDEO_FRAME_RATE_15:15,RECORD_VIDEO_FRAME_RATE_30:30},function(e){e[e.VIDEO_QUALITY_180p=2]="VIDEO_QUALITY_180p",e[e.VIDEO_QUALITY_480p=4]="VIDEO_QUALITY_480p",e[e.VIDEO_QUALITY_720p=8]="VIDEO_QUALITY_720p",e[e.VIDEO_QUALITY_1080p=16]="VIDEO_QUALITY_1080p"}(t.NERTC_VIDEO_QUALITY_ENUM||(t.NERTC_VIDEO_QUALITY_ENUM={})),t.NERTC_VIDEO_QUALITY={VIDEO_QUALITY_180p:2,VIDEO_QUALITY_480p:4,VIDEO_QUALITY_720p:8,VIDEO_QUALITY_1080p:16},t.NERTC_VIDEO_QUALITY_REV={[t.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_180p]:"320x180",[t.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p]:"640x480",[t.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_720p]:"1280x720",[t.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p]:"1920x1080"},t.STREAM_TYPE={HIGH:0,LOW:1},t.STREAM_TYPE_REV={0:"HIGH",1:"LOW"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getWebGLContext=t.get2DContext=void 0;const n=r(4);t.get2DContext=function(e,t){return n.getParameters().disable2dContext?null:e.getContext("2d",t)},t.getWebGLContext=function(e,t){return n.getParameters().disableWebGLContext?null:e.getContext("webgl",t)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;const n=r(168),i=r(56),o="EnhancedEventEmitter";class s extends n.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(t){return i.Logger.error(o,"safeEmit() | event listener threw an error [event:%s]:%o",e,t),Boolean(r)}}async safeEmitAsPromise(e,...t){return new Promise(((r,n)=>{try{this.emit(e,...t,r,n)}catch(t){i.Logger.error(o,"safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,t),n(t)}}))}}t.EnhancedEventEmitter=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;class n extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,n):this.stack=new Error(e).stack}}t.UnsupportedError=n;class i extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,i):this.stack=new Error(e).stack}}t.InvalidStateError=i},function(e,t,r){var n=r(219),i=r(220);t.write=i,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;const s=o(r(221)),a=o(r(72));function c(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)u(t)}function u(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function l(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(e.kind&&"string"==typeof e.kind||(e.kind=""),""!==e.kind&&"audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function d(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)p(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)m(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)f(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),h(e.rtcp)}function p(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)u(t)}function m(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function f(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function h(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function g(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function v(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function y(e,t,{strict:r=!1,modify:n=!1}={}){const i=e.mimeType.toLowerCase();if(i!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(i){case"video/h265":case"video/vp9":case"video/av1":return!1;case"video/h264":if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(r){if(!s.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=s.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}n&&(r?e.parameters["profile-level-id"]=r:delete e.parameters["profile-level-id"])}}return!0}function b(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function S(e,t){const r=[];for(const n of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find((e=>e.type===n.type&&(e.parameter===n.parameter||!e.parameter&&!n.parameter)));e&&r.push(e)}return r}t.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)c(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)l(t)},t.validateRtpCodecCapability=c,t.validateRtcpFeedback=u,t.validateRtpHeaderExtension=l,t.validateRtpParameters=d,t.validateRtpCodecParameters=p,t.validateRtpHeaderExtensionParameters=m,t.validateRtpEncodingParameters=f,t.validateRtcpParameters=h,t.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");g(e.numStreams)},t.validateNumSctpStreams=g,t.validateSctpParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const n of t.codecs||[]){if(v(n))continue;const t=(e.codecs||[]).find((e=>y(e,n,{strict:!0,modify:!0})));if(!t)continue;const i={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:n.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:n.parameters,rtcpFeedback:S(t,n)};r.codecs.push(i)}for(const n of r.codecs){const r=e.codecs.find((e=>v(e)&&e.parameters.apt===n.localPayloadType)),i=t.codecs.find((e=>v(e)&&e.parameters.apt===n.remotePayloadType));r&&i&&(n.localRtxPayloadType=r.preferredPayloadType,n.remoteRtxPayloadType=i.preferredPayloadType)}for(const n of t.headerExtensions){const t=e.headerExtensions.find((e=>b(e,n)));if(!t)continue;const i={kind:n.kind,uri:n.uri,sendId:t.preferredId,recvId:n.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(n.direction){case"sendrecv":i.direction="sendrecv";break;case"recvonly":i.direction="sendonly";break;case"sendonly":i.direction="recvonly";break;case"inactive":i.direction="inactive"}r.headerExtensions.push(i)}return r},t.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.localRtxPayloadType)continue;const n={mimeType:r.kind+"/rtx",kind:r.kind,preferredPayloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};t.codecs.push(n)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.sendId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t},t.getSendingRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:n.kind+"/rtx",payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}return r},t.getSendingRemoteRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.remoteParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:n.kind+"/rtx",payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return r},t.reduceCodecs=function(e,t){const r=[];if(t){for(let n=0;n<e.length;++n)if(y(e[n],t)){r.push(e[n]),v(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),v(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e,t){d(e=a.clone(e,{}));const r={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:t}],rtcp:{cname:"probator"}};return r.codecs.push(e.codecs[0]),r.codecs[0].payloadType=127,r.headerExtensions=e.headerExtensions,r},t.canSend=function(e,t){return t.codecs.some((t=>t.kind===e))},t.canReceive=function(e,t){if(d(e),0===e.codecs.length)return!1;for(let r in e.codecs)if("video/rtx"!==e.codecs[r].mimeType)for(let n in t.codecs)if(t.codecs[n].localPayloadType===e.codecs[r].payloadType)return!0;return!1}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getBlobUrl=void 0;const i=n(r(236)),o=n(r(237)),s=n(r(238)),a=n(r(239)),c=n(r(240)),u={volumeProcessor:{blobParts:[o.default],options:{type:"text/javascript; charset=utf-8"},url:""},audioWorkletAgentProcessor:{blobParts:[c.default],options:{type:"text/javascript; charset=utf-8"},url:""},webWorkerTimer:{blobParts:[s.default],options:{type:"text/javascript; charset=utf-8"},url:""},audioAIProcessor:{blobParts:[a.default],options:{type:"text/javascript; charset=utf-8"},url:""},rtcTimer:{blobParts:[i.default],options:{type:"text/js-worker"},url:""}};t.getBlobUrl=function(e){if(!u[e].url){const t=new Blob(u[e].blobParts,u[e].options);u[e].url=window.URL.createObjectURL(t)}return u[e].url}},function(e,t,r){e.exports=d;var n=r(120);((d.prototype=Object.create(n.prototype)).constructor=d).className="Namespace";var i,o,s,a=r(121),c=r(144),u=r(25);function l(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function d(e,t){n.call(this,e,t),this.nested=void 0,this._nestedArray=null}function p(e){return e._nestedArray=null,e}d.fromJSON=function(e,t){return new d(e,t.options).addJSON(t.nested)},d.arrayToJSON=l,d.isReservedId=function(e,t){if(e)for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0;return!1},d.isReservedName=function(e,t){if(e)for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1},Object.defineProperty(d.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=u.toArray(this.nested))}}),d.prototype.toJSON=function(e){return u.toObject(["options",this.options,"nested",l(this.nestedArray,e)])},d.prototype.addJSON=function(e){if(e)for(var t,r=Object.keys(e),n=0;n<r.length;++n)t=e[r[n]],this.add((void 0!==t.fields?i.fromJSON:void 0!==t.values?s.fromJSON:void 0!==t.methods?o.fromJSON:void 0!==t.id?a.fromJSON:d.fromJSON)(r[n],t));return this},d.prototype.get=function(e){return this.nested&&this.nested[e]||null},d.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},d.prototype.add=function(e){if(!(e instanceof a&&void 0!==e.extend||e instanceof i||e instanceof s||e instanceof o||e instanceof d||e instanceof c))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof d&&e instanceof d)||t instanceof i||t instanceof o)throw Error("duplicate name '"+e.name+"' in "+this);for(var r=t.nestedArray,n=0;n<r.length;++n)e.add(r[n]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),p(this)},d.prototype.remove=function(e){if(!(e instanceof n))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),p(this)},d.prototype.define=function(e,t){if(u.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof d))throw Error("path conflicts with non-namespace objects")}else r.add(r=new d(n))}return t&&r.addJSON(t),r},d.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof d?e[t++].resolveAll():e[t++].resolve();return this.resolve()},d.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),u.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var n=this.get(e[0]);if(n){if(1===e.length){if(!t||t.indexOf(n.constructor)>-1)return n}else if(n instanceof d&&(n=n.lookup(e.slice(1),t,!0)))return n}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof d&&(n=this._nestedArray[i].lookup(e,t,!0)))return n;return null===this.parent||r?null:this.parent.lookup(e,t)},d.prototype.lookupType=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such type: "+e);return t},d.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},d.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[i,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},d.prototype.lookupService=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},d._configure=function(e,t,r){i=e,o=t,s=r}},function(e,t,r){var n=t,i=r(25),o=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function s(e,t){var r=0,n={};for(t|=0;r<e.length;)n[o[r+t]]=e[r++];return n}n.basic=s([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=s([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=s([0,0,0,1,1],7),n.mapKey=s([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=s([1,5,0,0,0,5,5,0,0,0,1,1,0])},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createFrameBuffer=void 0;const n=r(116);t.createFrameBuffer=function(e,t,r,i){const o=e.createFramebuffer();if(!o)return console.error("framebuffer created error."),null;const s=n.createTexture(e,null,{width:t,height:r,genMipMaps:null!=i&&i});return s?(e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s.glTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null),{framebuffer:o,targetTexture:s,bind:t=>{t?e.bindFramebuffer(e.FRAMEBUFFER,null):e.bindFramebuffer(e.FRAMEBUFFER,o)}}):null}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Program=void 0;const n=r(301),i=r(159),o=r(302),s=r(303);t.Program=class{constructor(e,t){this.shaders={},this.uniforms={},this.attributes={},this.indices=null,this.gl=e,this.draw=t,this._program=e.createProgram(),this.setShader(n.defaultShader.vShader,"VERTEX"),this.setShader(n.defaultShader.fShader,"FRAGMENT")}get program(){return this._program||console.error("program create error."),this._program}parseUniforms(){const e=s.parseUniforms(this.gl,this.program);for(const t in e)t in this.uniforms&&e[t].setter(this.uniforms[t].value);this.uniforms=e}parseAttributes(){const e=this.gl,t=i.parseAttributes(this.gl,this.program);for(const r in this.attributes){const n=this.attributes[r];if(r in t){const e=n.attributeBuffer;e&&t[r].bufferSetter(e)}else e.deleteBuffer(n.buffer)}this.attributes=t}get count(){const e=this.attributes;let t=-1;for(const r in e){const n=e[r];-1!==t&&t!==n.count&&console.warn("inconsistent attribute length."),t=Math.max(t,n.count)}return t}setShader(e,t){const r=this.gl,i=this.program,s=o.createShader(r,e,t);if(s){const e=this.shaders[t];e&&(r.detachShader(i,e),r.deleteShader(e)),r.attachShader(i,s),this.shaders[t]=s,this.shaders.VERTEX&&this.shaders.FRAGMENT&&(r.linkProgram(i),this.parseUniforms(),this.parseAttributes())}else"VERTEX"===t?this.setShader(n.defaultShader.vShader,"VERTEX"):this.setShader(n.defaultShader.fShader,"FRAGMENT")}getUniform(e){var t;const r=null!==(t=this.uniforms[e])&&void 0!==t?t:null;return r||console.warn(`uniform:[${e}] does not exist.`),r}setUniform(e,t){var r;null===(r=this.getUniform(e))||void 0===r||r.setter(t)}updateUniform(e,t){var r;const n=this.getUniform(e);null==n||n.setter(null!==(r=t(n.value))&&void 0!==r?r:n.value)}setAttributeBuffer(e){var t;e&&(null===(t=this.getAttribute(e.name))||void 0===t||t.bufferSetter(e))}getAttribute(e){return this.attributes[e]||console.warn(`attribute:[${e}] does not exist.`),this.attributes[e]}setAttribute(e,t){var r;null===(r=this.getAttribute(e))||void 0===r||r.setter(t)}updateAttribute(e,t){var r;const n=this.getAttribute(e);null==n||n.setter(null!==(r=t(n.typedArray))&&void 0!==r?r:n.typedArray)}setIndices(e){if(e&&"indices"===e.name){const t=this.gl;t.bindBuffer(e.target,e.buffer),t.bufferData(e.target,e.typedArray,e.usage)}this.indices=e}render(){const e=this.gl,t=this.program;e.useProgram(t);const r=this.uniforms;for(const e in r)r[e].setter();const n=this.attributes;for(const e in n)n[e].setter();this.indices&&e.bindBuffer(this.indices.target,this.indices.buffer),this.draw?this.draw():e.drawArrays(e.TRIANGLE_STRIP,0,this.count)}destroy(e=!0){var t,r;const n=this.gl;if(e){for(const e in this.attributes){const t=this.attributes[e];if(t){const r=n.getAttribLocation(this.program,e);n.disableVertexAttribArray(r),n.deleteBuffer(t.buffer)}}this.indices&&n.deleteBuffer(this.indices.buffer)}n.deleteShader(null!==(t=this.shaders.VERTEX)&&void 0!==t?t:null),n.deleteShader(null!==(r=this.shaders.FRAGMENT)&&void 0!==r?r:null),n.deleteProgram(this.program)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.baseTextureShader=void 0,t.baseTextureShader={vShader:"\n    attribute vec4 position;\n    attribute vec2 uv;\n    varying vec2 vuv;\n    void main() {\n        gl_Position = position;\n        vuv = uv;\n    }\n",fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n    varying vec2 vuv;\n    void main() {\n        gl_FragColor = texture2D(map, vuv);\n    }\n",yFlipFShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n    varying vec2 vuv;\n    void main() {\n        gl_FragColor = texture2D(map, vec2(vuv.x, 1.0 - vuv.y));\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;const n=r(10);class i extends n.EventEmitter{constructor(e,t,r,n){super(),this.programs={},this.framebuffers={},this.renderer=e,this._map=t,this.posBuffer=r,this.uvBuffer=n}get map(){return this._map}set map(e){}get output(){return this._map}updateSize(){}render(){}destroy(e=!0){this.removeAllListeners();const t=this.renderer.gl,r=this.framebuffers,n=this.programs;for(const e in r){const n=r[e];n.bind(!0),null==t||t.deleteTexture(n.targetTexture.glTexture),null==t||t.deleteFramebuffer(n.framebuffer)}for(const t in n)n[t].destroy(e)}}t.Filter=i},,,,,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RTCCanvas=void 0;const n=r(123);t.RTCCanvas=class{constructor(e,t){this.isAppend=!1,this.title=e,this.isAppend=t,this.createCanvas()}get _canvas(){return this.canvas}get _ctx(){return this.ctx}createCanvas(){this.canvas=document.createElement("canvas"),this.ctx=n.get2DContext(this.canvas),this.isAppend&&document.body.appendChild(this.canvas)}setSize(e,t){this.canvas&&(this.canvas.width=e,this.canvas.height=t)}destroy(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.isAppend&&document.body.removeChild(this.canvas),this.canvas=null}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;const n=r(124);class i extends n.EnhancedEventEmitter{constructor(){super()}}t.HandlerInterface=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.filterTransportCCFromSdp=t.filterTransportCCFromRtpParameters=void 0,t.filterTransportCCFromRtpParameters=function(e){if(e.headerExtensions)for(let t=e.headerExtensions.length-1;t>=0;t--)e.headerExtensions[t].uri.indexOf("transport-wide-cc")>-1&&e.headerExtensions.splice(t,1);for(let t=e.codecs.length-1;t>=0;t--){const r=e.codecs[t];if(r.rtcpFeedback)for(let e=r.rtcpFeedback.length-1;e>=0;e--)"transport-cc"===r.rtcpFeedback[e].type&&r.rtcpFeedback.splice(e,1)}},t.filterTransportCCFromSdp=function(e){for(let t in e.media){const r=e.media[t];if(r.ext)for(let e=r.ext.length-1;e>=0;e--)r.ext[e].uri.indexOf("transport-wide-cc")>-1&&r.ext.splice(e,1);if(r.rtcpFb)for(let e=r.rtcpFb.length-1;e>=0;e--)"transport-cc"===r.rtcpFb[e].type&&r.rtcpFb.splice(e,1)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleBig=void 0;class n{constructor(e){this.isSimpleBig=!0,"string"==typeof e?this.numStr=e:e>Number.MIN_SAFE_INTEGER?this.numStr=e.toString():(console.error("Invalid numStr:",e),this.numStr="-1")}toString(){return this.numStr}static fromHex(e){if(e.length<13)return parseInt(e,16);let t="0";return e.split("").forEach((e=>{var r=parseInt(e,16);for(let e=8;e;e>>=1)t=i(t,t),r&e&&(t=i(t,"1"))})),new n(t)}}function i(e,t){let r=0,n=[],i=e.split("").map(Number),o=t.split("").map(Number);for(;i.length||o.length;){const e=(i.pop()||0)+(o.pop()||0)+r;n.unshift(e<10?e:e-10),r=e<10?0:1}return r&&n.unshift(r),n.join("")}t.SimpleBig=n},function(e,t,r){e.exports=s;var n=r(120);((s.prototype=Object.create(n.prototype)).constructor=s).className="OneOf";var i=r(121),o=r(25);function s(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),void 0!==t&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function a(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}s.fromJSON=function(e,t){return new s(e,t.oneof,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},s.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,a(this),this},s.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},s.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var r=e.get(this.oneof[t]);r&&!r.partOf&&(r.partOf=this,this.fieldsArray.push(r))}a(this)},s.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},s.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){o.decorateType(t.constructor).add(new s(r,e)),Object.defineProperty(t,r,{get:o.oneOfGetter(e),set:o.oneOfSetter(e)})}}},function(e,t,r){var n=r(70),i=r(69),o=r(4);e.exports=class{constructor(e){this.formatTimeUnit=function(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r},this.prefix=e?"protoo-client:"+e:"protoo-client"}debug(){var e=Array.prototype.slice.call(arguments);this.formatArgs(e),(0,o.getParameters)().logLevel<=n.loglevels.DEBUG&&console.debug.apply(console,e),window.logUpload&&window.wsTransport&&window.wsTransport.sendLog(e)}warn(){var e=Array.prototype.slice.call(arguments);this.formatArgs(e),(0,o.getParameters)().logLevel<=n.loglevels.WARNING&&console.warn.apply(console,e),window.logUpload&&window.wsTransport&&window.wsTransport.sendLog(e)}error(){var e=Array.prototype.slice.call(arguments);this.formatArgs(e),(0,o.getParameters)().logLevel<=n.loglevels.ERROR&&console.error.apply(console,e),window.logUpload&&window.wsTransport&&window.wsTransport.sendLog(e)}formatArgs(e){var t=new Date,r=this.formatTimeUnit(""+(t.getMonth()+1))+"-"+this.formatTimeUnit(""+t.getDate())+" "+this.formatTimeUnit(""+t.getHours())+":"+this.formatTimeUnit(""+t.getMinutes())+":"+this.formatTimeUnit(""+t.getSeconds())+":"+this.formatTimeUnit(""+t.getMilliseconds(),3),n="[NERTC:LOG:"+(0,i.updateLogIndex)()+" "+r+" "+this.prefix.toUpperCase()+"]";return e.unshift(n),e}}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.alerter=void 0;const s=r(162),a=o(r(24)),c=r(68),u=r(4),l=r(63);class d extends c.RTCEventEmitter{constructor(){super(...arguments),this.elem=null}alert(e,t){t||(t={resume:!1}),this.elem||(this.elem=document.createElement("div"),this.elem.style.fontSize="20px",this.elem.style.position="fixed",this.elem.style.background="yellow",this.elem.style.margin="auto",this.elem.style.width="100%",this.elem.style.zIndex="9999",this.elem.style.top="0",this.elem.addEventListener("click",(()=>{var e;(null===(e=this.elem)||void 0===e?void 0:e.parentNode)&&this.elem.parentNode.removeChild(this.elem),this.safeEmit("@user-gesture-fired")}))),this.elem.style.display="block",this.elem.innerHTML=e,document.body.appendChild(this.elem),t.resume&&this.elem.addEventListener("click",p,{once:!0})}watchClient(e){e.addListener("@pairing-join-start",(()=>{if(0===s.systemChecker.checkCnt||"always"===u.getParameters().enableAlerter){const e=72;if(a.IS_CHROME&&(a.IS_MAC||a.IS_WIN)&&a.CHROME_MAJOR_VERSION&&a.CHROME_MAJOR_VERSION<e){let e=`您当前正在使用的Chrome浏览器版本为${a.CHROME_MAJOR_VERSION}, 不在NERTC的支持范围。请更新您的浏览器。<br/>您看到这条提示是因为您未调用 NERTC.checkSystemRequirements()，并且浏览器版本过低。`;this.alert(e)}}})),e.addListener("@connection-state-change",(t=>{if("DISCONNECTING"===t.curState&&"CONNECTING"===t.prevState&&(e._events&&!e._events["connection-state-change"]&&!e._events.SOCKET_ERROR||"always"===u.getParameters().enableAlerter)){let e="由于网络原因，您当前已经退出房间。<br/>您看到这条提示是因为您未监听 connection-state-change 或 SOCKET_ERROR 事件，并且加入房间后意外退出了房间。";this.alert(e)}}))}watchLocalStream(e){e.on("@notAllowedError",(t=>{if(!e._events.notAllowedError||"always"===u.getParameters().enableAlerter){let e="音频播放需要手势触发。<br/>您看到这条提示是因为您未监听 notAllowedError 事件，并且遇到了浏览器自动播放策略问题。";this.alert(e,{resume:!0})}}))}watchRemoteStream(e){e.on("@notAllowedError",(t=>{if(!e._events.notAllowedError||"always"===u.getParameters().enableAlerter){let e="音频播放需要手势触发。<br/>您看到这条提示是因为您未监听 notAllowedError 事件，并且遇到了浏览器自动播放策略问题。";this.alert(e,{resume:!0})}}))}}function p(){const e=u.getParameters().clients;for(let t=0;t<e.length;t++){const r=e[t];if(!r.destroyed)for(let e in r.adapterRef.remoteStreamMap)r.adapterRef.remoteStreamMap[e].resume()}const t=u.getParameters().localStreams;for(let e=0;e<t.length;e++){const r=t[e];r.destroyed||r.resume()}const r=l.getAudioContext();"suspended"===(null==r?void 0:r.state)&&(e[0]&&e[0].logger.warn("尝试恢复 AudioContext"),r.resume())}t.alerter=new d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.compatAudioInputList=void 0;const n=r(4);t.compatAudioInputList=new class{constructor(){this.enabled=n.getParameters().enableCompatAudio,this.compatTracks=[]}findSource(e){const t=this.compatTracks.find((t=>t.dest.id===e));return t?t.source:null}}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.encryptionModeToInt=t.EncryptionModes=t.Encryption=void 0;const i=r(10),o=n(r(149)),s={none:-1,"sm4-128-ecb":0};t.EncryptionModes=s,t.encryptionModeToInt=function(e){return"none"===e||"sm4-128-ecb"===e?s[e]:void 0};class a extends i.EventEmitter{constructor(e){super(),this.encryptionMode="none",this.encryptionSecret="",this.encodedInsertableStreams=!1,this.adapterRef=e}setEncryptionMode(e){this.encryptionMode=e}setEncryptionSecret(e){this.encryptionSecret=o.default(e)}handleUpstreamTransform(e,t,r){e.index++,1===e.index&&this.adapterRef.logger.log("生成第一帧上行自定义加密（明文）。长度:",t.data.byteLength,e.mediaType,e.streamType),this.adapterRef.instance.safeEmit("sender-transform",{uid:this.adapterRef.channelInfo.uid,mediaType:e.mediaType,streamType:e.streamType,encodedFrame:t,controller:r})}handleDownstreamTransform(e,t,r){e.index++,1===e.index&&this.adapterRef.logger.log("收到第一帧下行自定义加密（密文）。长度:",t.data.byteLength,e.uid,e.mediaType),"key"===t.type&&this.adapterRef.state.videoFirstIframeTime<this.adapterRef.state.signalJoinSuccessTime&&(this.adapterRef.state.videoFirstIframeTime=Date.now()),this.adapterRef.instance.safeEmit("receiver-transform",{uid:e.uid,mediaType:e.mediaType,encodedFrame:t,controller:r})}}t.Encryption=a},function(e,t,r){var n,i,o,s,a;n=r(209),i=r(165).utf8,o=r(210),s=r(165).bin,(a=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?s.stringToBytes(e):i.stringToBytes(e):o(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var r=n.bytesToWords(e),c=8*e.length,u=1732584193,l=-271733879,d=-1732584194,p=271733878,m=0;m<r.length;m++)r[m]=16711935&(r[m]<<8|r[m]>>>24)|4278255360&(r[m]<<24|r[m]>>>8);r[c>>>5]|=128<<c%32,r[14+(c+64>>>9<<4)]=c;var f=a._ff,h=a._gg,g=a._hh,v=a._ii;for(m=0;m<r.length;m+=16){var y=u,b=l,S=d,T=p;u=f(u,l,d,p,r[m+0],7,-680876936),p=f(p,u,l,d,r[m+1],12,-389564586),d=f(d,p,u,l,r[m+2],17,606105819),l=f(l,d,p,u,r[m+3],22,-1044525330),u=f(u,l,d,p,r[m+4],7,-176418897),p=f(p,u,l,d,r[m+5],12,1200080426),d=f(d,p,u,l,r[m+6],17,-1473231341),l=f(l,d,p,u,r[m+7],22,-45705983),u=f(u,l,d,p,r[m+8],7,1770035416),p=f(p,u,l,d,r[m+9],12,-1958414417),d=f(d,p,u,l,r[m+10],17,-42063),l=f(l,d,p,u,r[m+11],22,-1990404162),u=f(u,l,d,p,r[m+12],7,1804603682),p=f(p,u,l,d,r[m+13],12,-40341101),d=f(d,p,u,l,r[m+14],17,-1502002290),u=h(u,l=f(l,d,p,u,r[m+15],22,1236535329),d,p,r[m+1],5,-165796510),p=h(p,u,l,d,r[m+6],9,-1069501632),d=h(d,p,u,l,r[m+11],14,643717713),l=h(l,d,p,u,r[m+0],20,-373897302),u=h(u,l,d,p,r[m+5],5,-701558691),p=h(p,u,l,d,r[m+10],9,38016083),d=h(d,p,u,l,r[m+15],14,-660478335),l=h(l,d,p,u,r[m+4],20,-405537848),u=h(u,l,d,p,r[m+9],5,568446438),p=h(p,u,l,d,r[m+14],9,-1019803690),d=h(d,p,u,l,r[m+3],14,-187363961),l=h(l,d,p,u,r[m+8],20,1163531501),u=h(u,l,d,p,r[m+13],5,-1444681467),p=h(p,u,l,d,r[m+2],9,-51403784),d=h(d,p,u,l,r[m+7],14,1735328473),u=g(u,l=h(l,d,p,u,r[m+12],20,-1926607734),d,p,r[m+5],4,-378558),p=g(p,u,l,d,r[m+8],11,-2022574463),d=g(d,p,u,l,r[m+11],16,1839030562),l=g(l,d,p,u,r[m+14],23,-35309556),u=g(u,l,d,p,r[m+1],4,-1530992060),p=g(p,u,l,d,r[m+4],11,1272893353),d=g(d,p,u,l,r[m+7],16,-155497632),l=g(l,d,p,u,r[m+10],23,-1094730640),u=g(u,l,d,p,r[m+13],4,681279174),p=g(p,u,l,d,r[m+0],11,-358537222),d=g(d,p,u,l,r[m+3],16,-722521979),l=g(l,d,p,u,r[m+6],23,76029189),u=g(u,l,d,p,r[m+9],4,-640364487),p=g(p,u,l,d,r[m+12],11,-421815835),d=g(d,p,u,l,r[m+15],16,530742520),u=v(u,l=g(l,d,p,u,r[m+2],23,-995338651),d,p,r[m+0],6,-198630844),p=v(p,u,l,d,r[m+7],10,1126891415),d=v(d,p,u,l,r[m+14],15,-1416354905),l=v(l,d,p,u,r[m+5],21,-57434055),u=v(u,l,d,p,r[m+12],6,1700485571),p=v(p,u,l,d,r[m+3],10,-1894986606),d=v(d,p,u,l,r[m+10],15,-1051523),l=v(l,d,p,u,r[m+1],21,-2054922799),u=v(u,l,d,p,r[m+8],6,1873313359),p=v(p,u,l,d,r[m+15],10,-30611744),d=v(d,p,u,l,r[m+6],15,-1560198380),l=v(l,d,p,u,r[m+13],21,1309151649),u=v(u,l,d,p,r[m+4],6,-145523070),p=v(p,u,l,d,r[m+11],10,-1120210379),d=v(d,p,u,l,r[m+2],15,718787259),l=v(l,d,p,u,r[m+9],21,-343485551),u=u+y>>>0,l=l+b>>>0,d=d+S>>>0,p=p+T>>>0}return n.endian([u,l,d,p])})._ff=function(e,t,r,n,i,o,s){var a=e+(t&r|~t&n)+(i>>>0)+s;return(a<<o|a>>>32-o)+t},a._gg=function(e,t,r,n,i,o,s){var a=e+(t&n|r&~n)+(i>>>0)+s;return(a<<o|a>>>32-o)+t},a._hh=function(e,t,r,n,i,o,s){var a=e+(t^r^n)+(i>>>0)+s;return(a<<o|a>>>32-o)+t},a._ii=function(e,t,r,n,i,o,s){var a=e+(r^(t|~n))+(i>>>0)+s;return(a<<o|a>>>32-o)+t},a._blocksize=16,a._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=n.wordsToBytes(a(e,t));return t&&t.asBytes?r:t&&t.asString?s.bytesToString(r):n.bytesToHex(r)}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Record=void 0;const a=r(10),c=s(r(12)),u=s(r(13)),l=o(r(24));class d extends a.EventEmitter{constructor(e){super(),this._status={recordedChunks:[],isRecording:!1,stream:null,option:null,contentTypes:[],mimeType:"",audioController:null,opStream:null,state:"init",timer:null,fileName:null,recordId:0,recordStatus:"init",recordUrl:null,startTime:null,endTime:null},this._recorder=null,this.logger=e.logger.getChild((()=>"recorder "+this._status.recordStatus)),this._reset(),this.client=e.client}get recoder(){return this._recorder}async start(e){const{stream:t=null,uid:r="0",type:n="video",reset:i=!1,recordName:o}=e;this.logger.log("开始本地录制: ",JSON.stringify(e,null,""));let s=null;if(!window.MediaRecorder||!MediaRecorder.isTypeSupported||!l.IS_CHROME)throw s="Record.start: 当前浏览器不支持本地录制",this.logger.warn(s),new u.default({code:c.default.RECORDING_NOT_SUPPORT,message:s});if(this._status.isRecording)throw s="Record.start: 操作异常, 当前正在录制中",this.logger.warn(s),new u.default({code:c.default.REPEAT_RECORDING_ERROR,message:s});if(this._status.recordUrl&&"downloaded"!==this._status.recordStatus){if(!e.reset)throw s="Record.start: 操作异常, 请先下载或重置上一段录制文件",this.logger.warn(s),new u.default({code:c.default.RECORDING_CACHE_ERROR,message:s});this.logger.warn("Record.start: 存在未下载视频，强制清除..."),await this.clean()}s&&this.client.apiFrequencyControl({name:"startMediaRecording",code:-1,param:JSON.stringify({reason:s,uid:r,mediaType:n,recordName:""},null," ")}),this._status.stream=t,this._status.option=e,this._status.fileName=this._getFilename(o),this._status.startTime=this._getTimeStamp();let a=["video/mp4;codecs=opus","video/webm","video/webm;codecs=h264","video/x-matroska;codecs=opus","video/invalid"];if("audio"===e.type&&(a=["audio/wav","audio/ogg","audio/pcm","audio/webm"]),!(this._status.mimeType=this._validation(a)[0]))return"RecordBrowserNotSupport";try{await this._format(),await this._start(),this.client.apiFrequencyControl({name:"startMediaRecording",code:0,param:JSON.stringify({uid:r,mediaType:n,recordName:""},null," ")})}catch(e){return this.logger.error("Record.start 内部异常: ",e.name,e.message),this.client.apiFrequencyControl({name:"startMediaRecording",code:-1,param:JSON.stringify({reason:e.message,uid:r,mediaType:n,recordName:""},null," ")}),Promise.reject(new u.default({code:c.default.RECORDING_ERROR,message:"Record.start: 录制异常 "+e.message}))}}stop(e){let t=null;return this._status.isRecording&&this._recorder||(this.logger.log("Record.stop 当前没有进行录制"),t="RecordNotExist"),this._recorder&&"started"!==this._status.state&&(this.logger.warn("Record.stop: record stopping when "+this._recorder.state),t="RecordStateError"),t?(e&&!1===e.isUser||this.client.apiFrequencyControl({name:"stopMediaRecording",code:-1,param:""}),Promise.resolve()):(this._status.state="stopped",this._status.recordStatus="stopping",new Promise(((t,r)=>{var n;this._status.fileName=this._status.fileName,this._recorder.onstop=()=>{this._onStop(t)},null===(n=null==this?void 0:this._recorder)||void 0===n||n.stop(),this.client.apiFrequencyControl({name:"stopMediaRecording",code:0,param:""}),e&&e.isUser&&this.client.apiFrequencyControl({name:"stopMediaRecording",code:-1,param:""})})))}play(e){return"stopped"!==this._status.state?(this.client.apiFrequencyControl({name:"playMediaRecording",code:-1,param:JSON.stringify({reason:"RecordStateError"},null," ")}),this.logger.warn("MediaRecordHelper: record stopping when "+(this._recorder&&this._recorder.state)),Promise.resolve()):(this.client.apiFrequencyControl({name:"playMediaRecording",code:0,param:JSON.stringify({recordId:""},null," ")}),this._play(e))}download(e=!0){return Promise.resolve().then((()=>this._status.isRecording?(this.logger.log("Record.download: 正在录制中，立即停止..."),this.stop({isUser:!1})):Promise.resolve())).then((()=>{if(this._status.recordUrl){const e=document.createElement("a");document.body.appendChild(e),e.style.display="none",e.href=this._status.recordUrl,e.download=(this._status.fileName||this._getTimeStamp())+".webm",e.click(),this._status.recordStatus="downloaded"}else this.logger.log("Record.download: cannot download media without url ...");return e&&this.client.apiFrequencyControl({name:"downloadMediaRecording",code:0,param:""}),Promise.resolve(this._status)}))}async clean(){this.client.apiFrequencyControl({name:"cleanMediaRecording",code:0,param:""}),this._status.isRecording&&this._recorder&&await this.stop(),this._status.recordUrl&&(window.URL.revokeObjectURL(this._status.recordUrl),this._status.recordUrl=null),this._destroy(),this._status.recordStatus="init"}leave(e={uid:0}){if(!this._status.isRecording||!this._recorder)return Promise.resolve();const{uid:t}=e;return t&&this._status.option?t===+this._status.option.uid?this.stop():void 0:Promise.resolve()}pause(){this._recorder&&this._recorder.pause()}resume(){this._recorder&&this._recorder.resume()}_reset(){this._recorder=null,Object.assign(this._status,{recordedChunks:[],isRecording:!1,stream:null,option:null,contentTypes:[],mimeType:"",audioController:null,opStream:null,state:"init",timer:null,fileName:null,recordId:0,recordStatus:"init",recordUrl:null,startTime:null,endTime:null})}_getTimeStamp(){return Math.floor(Date.now()/1e3)}_getFilename(e){let t="";e&&(t+=e+"_");const r=new Date;return t+=`${r.getFullYear()}${(r.getMonth()+1).toString().padStart(2,"0")}${r.getDate().toString().padStart(2,"0")}`,t+=`${r.getHours().toString().padStart(2,"0")}${r.getMinutes().toString().padStart(2,"0")}${r.getSeconds().toString().padStart(2,"0")}${r.getMilliseconds().toString().padStart(3,"0")}`,t}_validation(e){return e.filter((e=>MediaRecorder.isTypeSupported(e)))}_format(){let e=this._status.stream;return this._status.option,new Promise(((t,r)=>{let n=new MediaStream;if(!e)return r(new u.default({code:c.default.RECORDING_ERROR,message:"Record._format: stream 未明确"}));if(this._matchLocalStreamConstructor(e.constructor.toString())&&(e=[e]),Array.isArray(e)){if(e.forEach((e=>{e&&this._matchLocalStreamConstructor(e.constructor.toString())&&e.getTracks().forEach((e=>{n.addTrack(e)}))})),0===n.getTracks().length)return this.logger.error("_format: No tracks available"),t(n);this._status.opStream=n,t(n)}}))}_matchLocalStreamConstructor(e){return/(LocalMediaStream|MediaStream)/.test(e)}_start(){let e={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:this._status.mimeType};if(!this._status.opStream)return Promise.reject(new u.default({code:c.default.RECORDING_ERROR,message:"Record._start: opStream 未明确"}));const t=this._status.opStream.getAudioTracks();let r;r=t.length>1?new MediaStream([t[0]]):this._status.opStream;let n=this._recorder=new MediaRecorder(r,e);return n.ondataavailable=this._onDataAvailable.bind(this),n.onstop=()=>{this.logger.log("MediaRecordHelper: _start: record stop automatically ..."),this._onStop()},this._status.recordUrl&&(window.URL.revokeObjectURL(this._status.recordUrl),this._status.recordUrl=null),this._status.recordedChunks=[],this._status.isRecording=!0,this._status.state="started",this._status.recordId+=1,this._status.recordStatus="starting",this._recorder.start(),this._clearTimer(),this._startTimer(),Promise.resolve(this._status.recordId)}_startTimer(){this._status.timer||(this._status.timer=setInterval((()=>{this.logger.log(`MediaRecordHelper: startTimer: ${(new Date).toLocaleString()} --\x3e MediaRecorder status: ${this._recorder&&this._recorder.state}`)}),5e3))}_onStop(e){this.logger.log("MediaRecordHelper: _onStop: record stoped !!!"),this._clearTimer(),this._status.recordStatus="stopped",this._status.isRecording=!1,this._status.endTime=this._getTimeStamp();let t=new Blob(this._status.recordedChunks,{type:this._status.mimeType});this._status.recordUrl=URL.createObjectURL(t),this.emit("media-recording-stopped",this.getRecordStatus()),e&&e(this._status.fileName)}_play(e){let t=null;if(-1!=this._status.mimeType.indexOf("audio"))t=document.createElement("audio");else{if(-1==this._status.mimeType.indexOf("video"))return Promise.reject(new u.default({code:c.default.NOT_SUPPORT_ERROR,message:"_play: 当前浏览器不支持 MIME type "+this._status.mimeType}));t=document.createElement("video"),t.autoplay=!0}return this._status.recordUrl?(e.appendChild(t),t.srcObject=null,t.src=this._status.recordUrl,t.controls=!1,t.play(),Promise.resolve(this._status.option)):Promise.reject(new u.default({code:c.default.RECORDING_ERROR,message:"Record._play: 录制 url 未明确"}))}async _destroy(){this._status.audioController&&this._status.audioController.destroy(),this._status.isRecording&&await this.stop({isUser:!1}),this._clearTimer(),this._recorder=null,Object.assign(this._status,{stream:null,recordedChunks:[],isRecording:!1,audioController:null,status:"init"})}_clearTimer(){this._status.timer&&(clearInterval(this._status.timer),this._status.timer=null)}_onDataAvailable(e){if(this._status.recordStatus="recording",this.logger.log("MediaRecordHelper: ondataavailable: data received"),!(e.data.size>0))return this.logger.warn("MediaRecordHelper: ondataavailable: no data"),void this.stop();this._status.recordedChunks.push(e.data)}checkIsRecording(){return this._status.isRecording}getRecordStatus(){const e=Object.assign({id:this._status.recordId,type:this._status.mimeType,name:this._status.fileName,status:this._status.recordStatus,isRecording:this._status.isRecording,startTime:this._status.startTime,endTime:this._status.endTime},this._status.option);return this.client.apiFrequencyControl({name:"listMediaRecording",code:0,param:""}),e}destroy(){this._destroy()}}t.Record=d},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;const a=o(r(126)),c=s(r(12)),u=s(r(13));t.extractRtpCapabilities=function({sdpObject:e}){const t=new Map,r=[];let n=!1,i=!1;for(const o of e.media){const e=o.type;switch(e){case"audio":if(n)continue;n=!0;break;case"video":if(i)continue;i=!0;break;default:continue}for(const r of o.rtp){const n={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(n.preferredPayloadType,n)}for(const e of o.fmtp||[]){const r=a.parseParams(e.config),n=t.get(e.payload);n&&(r&&r.hasOwnProperty("profile-level-id")&&(r["profile-level-id"]=String(r["profile-level-id"])),n.parameters=r)}for(const e of o.rtcpFb||[]){const r=t.get(e.payload);if(!r)continue;const n={type:e.type,parameter:e.subtype};n.parameter||delete n.parameter,r.rtcpFeedback.push(n)}for(const t of o.ext||[]){if(t["encrypt-uri"])continue;const n={kind:e,uri:t.uri,preferredId:t.value};r.push(n)}}return{codecs:Array.from(t.values()),headerExtensions:r}},t.extractDtlsParameters=function({sdpObject:e}){const t=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!t)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"extractDtlsParameters: active media 未找到"});const r=t.fingerprint||e.fingerprint;let n;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}},t.getCname=function({offerMediaObject:e}){const t=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""},t.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e)continue;if(!(t.rtp||[]).find((e=>e.payload===r.payloadType)))continue;t.fmtp=t.fmtp||[];let n=t.fmtp.find((e=>e.payload===r.payloadType));n||(n={payload:r.payloadType,config:""},t.fmtp.push(n));const i=a.parseParams(n.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(i.stereo=e?1:0);break}}n.config="";for(const e of Object.keys(i))n.config&&(n.config+=";"),n.config+=`${e}=${i[e]}`}}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;const s=o(r(126)),a=r(4),c=r(56),u=r(225);t.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:o=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=n,this._plainRtpParameters=i,this._planB=o,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}i&&(this._sdpObject.origin.address=i.ip,this._sdpObject.origin.ipVer=i.ipVersion)}updateIceParameters(e){c.Logger.debug("RemoteSdp","updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){c.Logger.debug("RemoteSdp",`updateDtlsRole() [role: ${e}]`),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){if(a.getParameters().reuseMid)for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObjectArr:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:n,codecOptions:i,extmapAllowMixed:o=!1}){e.length&&e.forEach(((e,s)=>{if(!e)return;const a=new u.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:n,codecOptions:i?i[s]:void 0,extmapAllowMixed:o});t?this._replaceMediaSection(a,t):this._addMediaSection(a)}))}receive({mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:i,reuseMid:o=null,reuseMediaSection:s}){const a=this._midToIndex.get(e);let c;void 0!==a&&(c=this._mediaSections[a]),c?(c=new u.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:i}),this._replaceMediaSection(c,e)):(c=new u.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:i}),null===o?this._addMediaSection(c):this._replaceMediaSection(c,o))}disableMediaSection(e){const t=this._midToIndex.get(e);void 0!==t&&this._mediaSections[t].disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)return;const r=this._mediaSections[t];e===this._firstMid&&c.Logger.debug("RemoteSdp","closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),r.close()}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._midToIndex.get(e);if(void 0===r)return;const n=this._mediaSections[r];n.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(n)}sendSctpAssociation({offerMediaObject:e}){const t=new u.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new u.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,this._sdpObject.media.sort((function(e,t){return e.mid-t.mid})),s.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)return;const n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)return;this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0;const i=n(r(12)),o=n(r(13));t.getRtpEncodings=function({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new o.default({code:i.default.UNKNOWN_TYPE_ERROR,message:"getRtpEncodings: a=ssrc 行未找到"});const r=new Map;for(const n of e.ssrcGroups||[]){if("FID"!==n.semantics)continue;let[e,i]=n.ssrcs.split(/\s+/);e=Number(e),i=Number(i),t.has(e)&&(t.delete(e),t.delete(i),r.set(e,i))}for(const e of t)r.set(e,null);const n=[];for(const[e,t]of r){const r={ssrc:e};t&&(r.rtx={ssrc:t}),n.push(r)}return n},t.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!r)throw new o.default({code:i.default.UNKNOWN_TYPE_ERROR,message:"addLegacySimulcast: a=ssrc 行的 msid 信息未找到"});const[n,s]=r.value.split(" "),a=r.id;let c;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===a&&(c=Number(t[1]),!0)}));const u=e.ssrcs.find((e=>"cname"===e.attribute)).value,l=[],d=[];for(let e=0;e<t;++e)l.push(a+e),c&&d.push(c+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(let t=0;t<l.length;++t){const r=l[t];e.ssrcs.push({id:r,attribute:"cname",value:u}),e.ssrcs.push({id:r,attribute:"msid",value:`${n} ${s}`})}for(let t=0;t<d.length;++t){const r=l[t],i=d[t];e.ssrcs.push({id:i,attribute:"cname",value:u}),e.ssrcs.push({id:i,attribute:"msid",value:`${n} ${s}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${i}`})}}},function(e,t,r){e.exports=d;var n,i=r(58),o=i.LongBits,s=i.base64,a=i.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var p=function(){return i.Buffer?function(){return(d.create=function(){return new n})()}:function(){return new d}};function m(e,t,r){t[r]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function h(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function g(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=p(),d.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},f.prototype=Object.create(c.prototype),f.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(h,10,o.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){var t=o.from(e);return this._push(h,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(h,t.length(),t)},d.prototype.bool=function(e){return this._push(m,1,e?1:0)},d.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){var t=o.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(m,1,0);if(i.isString(e)){var r=d.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},d.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(m,1,0)},d.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d._configure=function(e){n=e,d.create=p(),n._configure()}},function(e,t,r){e.exports=c;var n,i=r(58),o=i.LongBits,s=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},d=function(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new n(e):l(e)})(e)}:l};function p(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function m(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new o(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}c.create=d(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return m(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|m(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=d(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return p.call(this)[t](!1)},uint64:function(){return p.call(this)[t](!0)},sint64:function(){return p.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},function(e,t,r){e.exports=i;var n=r(58);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ajax=t.getFormData=void 0;const i=n(r(12)),o=n(r(13)),s=r(119);t.getFormData=e=>Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(/Object/i.test(e[t])?s.JSONBigStringify(e[t]):e[t]))).join("&"),t.ajax=function(e){if(!e||!e.url)return Promise.reject(new o.default({code:i.default.NETWORK_REQUEST_ERROR,message:"ajax: 参数异常"}));e.dataType=e.dataType||"json";var r=new XMLHttpRequest;r.open(e.type||"GET",e.url,!0),r.responseType=""+e.dataType;const n=e.contentType||"application/json;charset=UTF-8";return r.setRequestHeader("Content-type",n),e.header&&Object.keys(e.header).map((t=>{e.header&&e.header[t]&&r.setRequestHeader(t,e.header[t])})),new Promise(((a,c)=>{r.onload=function(){if(r.status>400)return Promise.reject(new o.default({code:i.default.NETWORK_REQUEST_ERROR,message:"ajax: 响应异常, code: "+r.status}));var e=r.response;a(e)},r.onerror=function(e){c(e)},r.ontimeout=function(t){c({code:456,desc:"ERR_TIMED_OUT "+e.url})},n.indexOf("x-www-form-urlencoded")>=0?e.data?r.send(t.getFormData(e.data)):r.send():e.data?e.header&&"gzip"===e.header["Content-Encoding"]?r.send(e.data):r.send(s.JSONBigStringify(e.data)):r.send()}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.StageBase=void 0,t.StageBase=class{constructor(e){this.enabled=!1,this.node=null,this.state="UNINIT",this.context=e}isTransparent(){return!1}}},function(e,t,r){function n(e,t){return{ARRAY_BUFFER:e.ARRAY_BUFFER,ELEMENT_ARRAY_BUFFER:e.ELEMENT_ARRAY_BUFFER}[null!=t?t:"ARRAY_BUFFER"]}function i(e,t){return{STATIC_DRAW:e.STATIC_DRAW,DYNAMIC_DRAW:e.DYNAMIC_DRAW,STREAM_DRAW:e.STREAM_DRAW}[null!=t?t:"STATIC_DRAW"]}function o(e,t){const r={Int8Array:e.BYTE,Uint8Array:e.UNSIGNED_BYTE,Int16Array:e.SHORT,Uint16Array:e.UNSIGNED_SHORT,Int32Array:e.INT,Uint32Array:e.UNSIGNED_INT,Float32Array:e.FLOAT}[Object.prototype.toString.call(t).replace(/object|\[|\]|\s/g,"")];return void 0===r?(console.warn("attribute buffer type error.\n legal type may << Int8Array、Uint8Array、Int16Array、Uint16Array、Float32Array."),e.FLOAT):r}Object.defineProperty(t,"__esModule",{value:!0}),t.parseAttributes=t.createAttributeBuffer=void 0,t.createAttributeBuffer=function(e,t,r,s,a,c,u,l,d){const p=e.createBuffer();if(!p)return console.error("buffer created failed."),null;const m=r.length;return{type:o(e,r),buffer:p,name:t,typedArray:r,itemSize:null!=s?s:1,count:m/(null!=s?s:1)>>0,normalized:null!=u&&u,target:n(e,a),usage:i(e,c),stride:null!=l?l:0,offset:null!=d?d:0}},t.parseAttributes=function(e,t){const r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),s={};for(let a=0;a<r;a++){const r=e.getActiveAttrib(t,a);if(r){const{name:a}=r,c=e.getAttribLocation(t,a);if(null!==c){const t={type:e.FLOAT,buffer:null,typedArray:null,itemSize:1,count:0,normalized:!1,target:n(e),usage:i(e),stride:0,offset:0,setter:r=>{if(r){const{buffer:n}=t;if(!n)return void console.error(`buffer of attribute:[${a}] is not initialized.`);const{type:i}=t;if(o(e,r)!==i)return void console.error(`typedArray's type of attribute:[${a}] is inconsistent.`);t.typedArray=r;const{itemSize:s,normalized:u,target:l,usage:d,stride:p,offset:m}=t;e.bindBuffer(l,n),e.bufferData(l,r,d),e.enableVertexAttribArray(c),e.vertexAttribPointer(c,s,i,u,p,m)}else{const{buffer:r,type:n,itemSize:i,normalized:o,target:s,stride:a,offset:u}=t;e.bindBuffer(s,r),e.vertexAttribPointer(c,i,n,o,a,u)}},bufferSetter:e=>{if(e){const{name:r}=e;r===a&&(t.type=e.type,t.buffer=e.buffer,t.itemSize=e.itemSize,t.count=e.count,t.normalized=e.normalized,t.target=e.target,t.usage=e.usage,t.stride=e.stride,t.offset=e.offset,t.setter(e.typedArray))}},get attributeBuffer(){return null===t.buffer?null:{type:t.type,buffer:t.buffer,name:a,typedArray:t.typedArray,itemSize:t.itemSize,count:t.count,normalized:t.normalized,target:t.target,usage:t.usage,stride:t.stride,offset:t.offset}}};s[a]=t}else console.warn(`attribute:[${a}] is null.`)}}return s}},,,function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.checkSystemRequirements=t.systemChecker=void 0,t.systemChecker=new class{constructor(){this.checkCnt=0}checkSystemRequirements(){this.checkCnt++;const e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;return e?e.prototype.getSenders&&e.prototype.addTransceiver&&e.prototype.getTransceivers?!!window.WebSocket||(console.warn("checkSystemRequirements: 没有 WebSocket 对象。"),!1):(console.warn("checkSystemRequirements: RTCPeerConnection不符合sdk要求"),!1):(console.warn("checkSystemRequirements: 没有 RTCPeerConnection 对象。"),!1)}},t.checkSystemRequirements=function(){return t.systemChecker.checkSystemRequirements()}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AuidoMixingState=void 0,t.AuidoMixingState={UNSTART:"MIX_UNSTART",STARTING:"MIX_STARTING",PLAYED:"MIX_PLAYING",PAUSED:"MIX_PAUSED",STOPED:"MIX_STOPED"}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.isHttpProtocol=t.checkBrowserCompatibility=t.isBrowserSupported=t.isPullStreamSupported=t.isPushStreamSupported=t.RtcSupport=void 0;const s=r(117),a=r(71),c=o(r(24)),u=r(118);let l={isPullStreamSupport:!1,isPushStreamSupport:!1,isScreenShareSupport:!1},d={video:[],audio:[]},p={video:[],audio:[]};var m=null;c.IS_IOS&&c.IS_WECHAT||(m=navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia);var f=window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,h=window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,g=window.MediaStream=window.MediaStream||window.webkitMediaStream;function v(e){let t;return t||(t=document.createElement("video")),!!t.canPlayType({ogg:'video/ogg; codecs="theora"',h264:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8, vorbis"',vp9:'video/webm; codecs="vp9"',hls:'application/x-mpegURL; codecs="avc1.42E01E"'}[e]||e)}const y={WebRTC:!!h&&!!g,RTCPeerConnection:!!h,Vp8:v("webm"),Vp9:v("vp9"),H264:v("h264"),GetUserMedia:!!m&&!!navigator.mediaDevices,DataChannel:!!(h&&"undefined"!=typeof RTCDataChannel&&h.prototype&&h.prototype.createDataChannel),WebAudio:!(!f||!f.prototype.createMediaStreamSource),MediaStream:!!g};function b(){let e=u.getBrowserInfo().browserName,t=u.getBrowserInfo().browserVersion;return t=t&&t.match(/\d+/)[0],{prefix:e,version:t}}const S={checkWebRtc:()=>y,checkWebAudio:()=>({WebAudio:y.WebAudio,MediaStream:y.MediaStream}),checkCompatibility(){let e=Object.assign(b(),{system:u.getOSInfo().osName+" "+u.getOSInfo().osVersion,browser:u.getBrowserInfo().browserName,version:u.getBrowserInfo().browserVersion});return new Promise((function(t,r){(async()=>{const r=Object.assign(e,y,{ScreenSharing:!1}),n=await s.Device.getDevices({audiooutput:!0,audioinput:!0,videoinput:!0,requestPerm:!0}).catch((e=>t(r)));r.MicrophoneList=n&&n.audioIn||[],r.CameraList=n&&n.video||[],r.Microphone=n&&n.audioIn&&n.audioIn.length>0||!1,r.Camera=n&&n.video&&n.video.length>0||!1,t(r)})()}))},checkVersion:()=>b()};t.RtcSupport=S;const T=function(){return["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].filter((e=>e in window)).length>0},_=function(){return!!window.WebSocket&&!!window.WebSocket.prototype.send};async function w(){return await async function(){return!!d.video.length||(d=await a.getSupportedCodecs("send"),d.video.indexOf("H264")>-1||d.video.indexOf("VP8")>-1)}()&&T()&&_()&&function(){if(!navigator.mediaDevices)return!1;const e=["getUserMedia","enumerateDevices"];return e.filter((e=>e in navigator.mediaDevices)).length===e.length}()&&async function(){return!!h.prototype.getStats||!!RTCRtpSender.prototype.getStats}()}async function M(){return await async function(){return!!p.video.length||(p=await a.getSupportedCodecs("recv"),p.video.indexOf("H264")>-1||p.video.indexOf("VP8")>-1)}()&&T()&&_()&&async function(){return!!h.prototype.getStats||!!RTCRtpReceiver.prototype.getStats}()}t.isPushStreamSupported=w,t.isPullStreamSupported=M,t.isBrowserSupported=function(){return!(!(c.IS_CHROME&&c.CHROME_MAJOR_VERSION>=72)&&!(c.IS_MAC_SAFARI&&c.SAFARI_MAJOR_VERSION>=12)&&(!(c.IS_IOS_SAFARI&&c.SAFARI_MAJOR_VERSION>=13)||c.IS_WECHAT)&&!(c.IS_EDG&&c.EDG_MAJOR_VERSION>=80)&&!(c.IS_FIREFOX&&c.FIREFOX_MAJOR_VERSION>=66)&&(!c.IS_IOS||!c.IS_MQQB)&&!(c.IS_IOS&&c.IOS_VERSION&&parseFloat(c.IOS_VERSION)>=14.3&&c.IS_WECHAT&&c.WECHAT_VERSION&&parseFloat(c.WECHAT_VERSION)>=6.5)&&(!c.IS_ANDROID||!c.IS_TBS&&!c.IS_XWEB))},t.checkBrowserCompatibility=async function(){const e=function(){if(c.IS_ELECTRON)return!0;{let e=navigator.mediaDevices;return!(!e||!e.getDisplayMedia)}}(),t=await w(),r=await M();return l.isScreenShareSupport=e,l.isPushStreamSupport=t,l.isPullStreamSupport=r,l};const x="file:"===location.protocol||"localhost"===location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(location.hostname);t.isHttpProtocol=function(){return"http:"===location.protocol&&!x}},function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.parseScalabilityMode=t.Device=t.detectDevice=t.version=t.types=void 0;const s=r(167);Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return s.detectDevice}}),Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return s.Device}});const a=o(r(230));t.types=a,t.version="__MEDIASOUP_CLIENT_VERSION__";var c=r(233);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return c.parse}})},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;const s=r(124),a=r(125),c=r(218),u=r(226),l=r(227),d=r(56),p=o(r(127)),m=r(170),f=o(r(72)),h=o(r(24)),g=r(118),v="Device";function y(){return"object"==typeof navigator&&"string"==typeof navigator.userAgent?h.IS_CHROME_ONLY&&h.CHROME_MAJOR_VERSION&&h.CHROME_MAJOR_VERSION>=72||h.IS_ANDROID||h.IS_ELECTRON&&h.IS_CHROME_ONLY&&h.ANY_CHROME_MAJOR_VERSION&&h.ANY_CHROME_MAJOR_VERSION>=72?"Chrome74":h.IS_FIREFOX&&h.FIREFOX_MAJOR_VERSION&&h.FIREFOX_MAJOR_VERSION>=60?"Firefox60":h.IS_ANY_SAFARI&&h.SAFARI_MAJOR_VERSION&&h.SAFARI_MAJOR_VERSION>=12||h.IS_ANY_SAFARI&&h.IS_WECHAT?"Safari12":(d.Logger.warn(v,"this._detectDevice() | browser not supported [name:%s, version:%s], using Chrome72 as default",g.getBrowserInfo().browserName,g.getBrowserInfo().browserVersion),"Chrome74"):(d.Logger.warn(v,"this._detectDevice() | unknown device, using Chrome 72 as default"),"Chrome74")}t.detectDevice=y,t.Device=class{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new s.EnhancedEventEmitter,d.Logger.debug(v,"constructor()"),r){if(d.Logger.warn(v,"constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)d.Logger.debug(v,"constructor() | handler given: %s",e);else{if(!(e=y()))throw new a.UnsupportedError("device not supported");d.Logger.debug(v,"constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=c.Chrome74.createFactory();break;case"Safari12":this._handlerFactory=l.Safari12.createFactory();break;case"Firefox60":this._handlerFactory=u.Firefox60.createFactory();break;default:d.Logger.warn(`unknown browser handlerName "${e}, using Chrome 74 as default"`),this._handlerFactory=c.Chrome74.createFactory()}}const n=this._handlerFactory();this._handlerName=n.name,n.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new a.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new a.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;d.Logger.debug(v,"load()"),e=f.clone(e,void 0);try{if(this._loaded)throw new a.InvalidStateError("already loaded");p.validateRtpCapabilities(e),t=this._handlerFactory();const r=await t.getNativeRtpCapabilities();d.Logger.debug(v,"load() | got native RTP capabilities"),p.validateRtpCapabilities(r),this._extendedRtpCapabilities=p.getExtendedRtpCapabilities(r,e),d.Logger.debug(v,"load() | got extended RTP capabilities"),this._canProduceByKind.audio=p.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=p.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=p.getRecvRtpCapabilities(this._extendedRtpCapabilities),p.validateRtpCapabilities(this._recvRtpCapabilities),d.Logger.debug(v,"load() | got receiving RTP capabilities"),this._sctpCapabilities=await t.getNativeSctpCapabilities(),d.Logger.debug(v,"load() | got native SCTP capabilities"),p.validateSctpCapabilities(this._sctpCapabilities),d.Logger.debug(v,"load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new a.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:u={}}){return d.Logger.debug(v,"createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:u})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:u={}}){return d.Logger.debug(v,"createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:u})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,appData:d={}}){if(!this._loaded)throw new a.InvalidStateError("not loaded");if(d&&"object"!=typeof d)throw new TypeError("if given, appData must be an object");const p=new m.Transport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,appData:d,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",p),p}}},function(e,t,r){var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}v(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,s,a;if(u(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=p.bind(n);return i.listener=r,n.wrapFn=i,i}function f(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function v(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,l=g(c,u);for(r=0;r<u;++r)o(l[r],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,m(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,m(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,o,s;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach((function(e){r[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;const s=r(229),a=r(171),c=r(124),u=r(125),l=r(56),d=o(r(127)),p=r(172),m=o(r(72)),f="Transport";class h extends c.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:h,appData:g,handlerFactory:v,extendedRtpCapabilities:y,canProduceByKind:b}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new s.AwaitQueue({ClosedErrorClass:u.InvalidStateError}),this._observer=new c.EnhancedEventEmitter,this.send=[],this.recv=[],l.Logger.debug(f,`constructor() [id: ${t}, direction: ${e}]`),this._id=t,this._direction=e,this._extendedRtpCapabilities=y,this._canProduceByKind=b,this._maxSctpMessageSize=o?o.maxMessageSize:null,delete(p=m.clone(p,{})).iceServers,delete p.iceTransportPolicy,delete p.bundlePolicy,delete p.rtcpMuxPolicy,delete p.sdpSemantics,this._handler=v(),this._handler.run({direction:e,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:d,additionalSettings:p,proprietaryConstraints:h,extendedRtpCapabilities:y,appData:g}),this._appData=g,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){}get observer(){return this._observer}close(){if(!this._closed){l.Logger.debug(f,"close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new u.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(l.Logger.debug(f,"restartIce()"),this._closed)throw new u.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((async()=>this._handler.restartIce(e)),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(l.Logger.debug(f,"updateIceServers()"),this._closed)throw new u.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._handler.updateIceServers(e)}async produce({track:e,trackLow:t,encodings:r,codecOptions:n,codec:i,stopTracks:o=!1,disableTrackOnPause:s=!0,zeroRtpOnPause:a=!1,appData:c}){if(l.Logger.debug(f,"produce()"),!e)throw new TypeError("missing track");if("send"!==this._direction)throw new u.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new u.UnsupportedError("cannot produce "+e.kind);if("ended"===e.readyState)throw new u.InvalidStateError("track ended");if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(c&&"object"!=typeof c)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{let u;if(r&&!Array.isArray(r))throw TypeError("encodings must be an array");r&&0===r.length?u=void 0:r&&(u=r.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));const{localId:l,localIdLow:m,rtpParameters:f,rtpSender:h,rtpSenderLow:g,dtlsParameters:v,offer:y}=await this._handler.send({track:e,trackLow:t,encodings:u,codecOptions:n,appData:c,codec:i});h&&this.updateSenderInfo(h,"screenShare"===c.mediaType?"screen":c.mediaType,"high",l),g&&m&&this.updateSenderInfo(g,"screenShare"===c.mediaType?"screen":c.mediaType,"low",m);try{d.validateRtpParameters(f);const{id:r}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:f,track:e,trackLow:t,appData:c,localDtlsParameters:v,offer:y}),n=new p.Producer({id:r,localId:l,localIdLow:m,rtpSender:h,rtpSenderLow:g,track:e,trackLow:t,rtpParameters:f,stopTracks:o,disableTrackOnPause:s,zeroRtpOnPause:a,appData:c});return this._producers.set(n.id,n),this._handleProducer(n),this._observer.safeEmit("newproducer",n),n}catch(e){throw this._handler.stopSending(l,c.mediaType).catch((()=>{})),e}}),"transport.produce()").catch((e=>{throw e}))}async fillRemoteRecvSdp({kind:e,appData:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,sendingRtpParameters:s,codecOptions:a,offer:c,audioProfile:u,codec:l}){await this._handler.fillRemoteRecvSdp({kind:e,appData:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:o,sendingRtpParameters:s,codecOptions:a,offer:c,codec:l,audioProfile:u})}async prepareLocalSdp(e,t,r){try{const{dtlsParameters:n,rtpCapabilities:i,offer:o,mid:s,iceUfragReg:a}=await this._handler.prepareLocalSdp(e,r);if(!this._recvRtpCapabilities||!d.canSend("audio",this._recvRtpCapabilities)||!d.canSend("video",this._recvRtpCapabilities)){let e=d.getExtendedRtpCapabilities(i,t);this._recvRtpCapabilities=d.getRecvRtpCapabilities(e),d.validateRtpCapabilities(this._recvRtpCapabilities)}return{dtlsParameters:n,rtpCapabilities:this._recvRtpCapabilities,offer:o,mid:s,iceUfragReg:a}}catch(e){throw e}}async recoverLocalSdp(e,t,r){try{return void await this._handler.recoverTransceiver(e,t,r)}catch(e){throw e}}updateSenderInfo(e,t,r,n){let i=this.send.find((t=>t.sender===e));return i?(i.mediaType!==t||i.streamType||r||i.localId!==n)&&(l.Logger.debug(f,`Sender Change. mediaType:${i.mediaType} => ${t}, StreamType: ${i.streamType} => ${r}, LocalId: ${i.localId} => ${n} index: ${i.index}`),i.mediaType=t,i.streamType=r,i.localId=n,i.index=0):(i={sender:e,mediaType:t,streamType:r,localId:n,index:0},this.send.unshift(i)),i}updateReceiverInfo(e,t,r,n){let i=this.recv.find((t=>t.receiver===e));return i?i.uid===t&&i.mediaType===r&&i.localId===n||(l.Logger.debug(f,`Receiver Change. uid:${i.uid} => ${t}, mediaType:${i.mediaType} => ${r} localId: ${i.localId} => ${n} index: ${i.index}`),i.uid=t,i.mediaType=r,i.localId=n,i.index=0):(i={receiver:e,uid:t,mediaType:r,localId:n,index:0},this.recv.unshift(i)),i}async consume({id:e,producerId:t,kind:r,uid:n,mediaType:i,rtpParameters:o,appData:s={},offer:c,iceParameters:d,iceCandidates:p,dtlsParameters:h,sctpParameters:g,probeSSrc:v}){if(l.Logger.debug(f,"consume()"),o=m.clone(o,void 0),this._closed)throw new u.InvalidStateError("closed");if("recv"!==this._direction)throw new u.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{const{localId:u,rtpReceiver:l,track:m}=await this._handler.receive({iceParameters:d,iceCandidates:p,dtlsParameters:h,sctpParameters:g,trackId:e,kind:r,rtpParameters:o,offer:c,probeSSrc:v,remoteUid:s.remoteUid,extendedRtpCapabilities:this._extendedRtpCapabilities,appData:s});l&&this.updateReceiverInfo(l,n,i,u);const f=new a.Consumer({id:e,localId:u,producerId:t,rtpReceiver:l,track:m,rtpParameters:o,appData:s});return this._consumers.set(f.id,f),this._handleConsumer(f),this._observer.safeEmit("newconsumer",f),f}),"transport.consume()")}_handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},t,r)=>{this._closed?r(new u.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(l.Logger.debug(f,"connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}_handleProducer(e){e.on("@close",(()=>{this._closed||(l.Logger.warn(f,"producer 关闭: ",e.localId),this._awaitQueue.push((async()=>this._handler.stopSending(e.localId,e.appData.mediaType))).catch((e=>l.Logger.warn(f,"producer.close() failed:%o",e))))})),e.on("@replacetrack",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.replaceTrack(e.localId,t)),"producer @replacetrack event").then(r).catch(n)})),e.on("@setmaxspatiallayer",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.setMaxSpatialLayer(e.localId,t)),"producer @setmaxspatiallayer event").then(r).catch(n)})),e.on("@setrtpencodingparameters",((t,r,n)=>{this._awaitQueue.push((async()=>this._handler.setRtpEncodingParameters(e.localId,t)),"producer @setrtpencodingparameters event").then(r).catch(n)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new u.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}_handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopReceiving(e.localId)),"consumer @close event").catch((()=>{}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new u.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}}t.Transport=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;const n=r(124),i=r(125),o=r(56),s="Consumer";class a extends n.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:i,track:a,rtpParameters:c,appData:u}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,o.Logger.debug(s,"constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=i,this._track=a,this._rtpParameters=c,this._paused=!a.enabled,this._appData=u,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){}get observer(){return this._observer}close(){this._closed||(o.Logger.debug(s,"close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.Logger.debug(s,"transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new i.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){o.Logger.debug(s,"pause()"),this._closed?o.Logger.error(s,"pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause"))}resume(){o.Logger.debug(s,"resume()"),this._closed?o.Logger.error(s,"resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume"))}_onTrackEnded(){o.Logger.debug(s,'track "ended" event, %o, %s',this.id,this.kind),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){o.Logger.debug(s,"don not stop receiver track")}}t.Consumer=a},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;const s=o(r(24)),a=r(4),c=r(124),u=r(125),l=r(56),d="Producer";class p extends c.EnhancedEventEmitter{constructor({id:e,localId:t,localIdLow:r,rtpSender:n,rtpSenderLow:i,track:o,trackLow:s,rtpParameters:a,stopTracks:u,disableTrackOnPause:p,zeroRtpOnPause:m,appData:f}){super(),this._closed=!1,this._observer=new c.EnhancedEventEmitter,l.Logger.debug(d,"constructor()",t),this._id=e,this._localId=t,this._localIdLow=r,this._rtpSender=n,this._rtpSenderLow=i,this._track=o,this._trackLow=s,this._kind=o.kind,this._rtpParameters=a,this._paused=!!p&&!o.enabled,this._maxSpatialLayer=void 0,this._stopTracks=u,this._disableTrackOnPause=p,this._zeroRtpOnPause=m,this._appData=f,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){}get observer(){return this._observer}close(){this._closed||(l.Logger.debug(d,"close()"),this._closed=!0,this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(l.Logger.debug(d,"transportClosed()"),this._closed=!0,this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new u.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){l.Logger.debug(d,"pause()"),this._closed?l.Logger.error(d,"pause() | Producer closed"):(this._paused=!0,s.SAFARI_VERSION&&15.1===parseFloat(s.SAFARI_VERSION)||this._disableTrackOnPause&&(this._track&&(this._track.enabled=!1),this._trackLow&&(this._trackLow.enabled=!1)),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){l.Logger.debug(d,"resume()"),this._closed?l.Logger.error(d,"resume() | Producer closed"):(this._paused=!1,this._disableTrackOnPause&&(this._track&&(this._track.enabled=!0),this._trackLow&&(this._trackLow.enabled=!0)),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch((()=>{})),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(l.Logger.debug(d,"replaceTrack()"),this._closed){if(e&&this._stopTracks)try{if("audio"===e.kind){const t=a.getParameters().tracks.audio.findIndex((t=>e===t));l.Logger.warn(`Stopping AUDIOTRACK#${t} ${e.id}, ${e.label}, ${e.readyState}`)}else{const t=a.getParameters().tracks.video.findIndex((t=>e===t));l.Logger.warn(`Stopping VIDEOTRACK#${t} ${e.id}, ${e.label}, ${e.readyState}`)}e.stop()}catch(e){}throw new u.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new u.InvalidStateError("track ended");e!==this._track?(this._zeroRtpOnPause&&this._paused||await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()):l.Logger.debug(d,"replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new u.InvalidStateError("closed");if("video"!==this._kind)throw new u.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new u.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){l.Logger.debug(d,'track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){this._track&&l.Logger.warn(d,"don not stop sender track")}}t.Producer=p},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getRTCTimer=void 0;const n=r(128);class i{constructor(e={from:{native:!0,worker:!0,webAudio:!0},minInterval:8}){this.history=[],this.timers=[void 0],this.worker=null,this.options=e;const t=e=>{const t={source:e,ts:Date.now()},r=this.history[this.history.length-1];if(!(r&&t.ts-r.ts<this.options.minInterval)){this.history.push(t),this.history.length>1e3&&this.history.shift();for(let r=0;r<this.timers.length;r++){const n=this.timers[r];if(n&&!(n.cntMax<=n.cnt||t.ts-n.lastCalledAt<n.interval-1)){n.cnt++,n.lastCalledAt=t.ts;try{n.handler()}catch(e){console.error(e)}}}}};e.from.native&&(this.nativeTimer=setInterval((()=>{t("native")}),this.options.minInterval)),e.from.worker&&void 0!==typeof Worker&&(this.worker=new Worker(n.getBlobUrl("rtcTimer")),this.worker.onmessage=()=>{t("worker")})}setInterval(e,t){const r={handler:e,id:this.timers.length,interval:t,lastCalledAt:Date.now(),cnt:0,cntMax:Number.MAX_SAFE_INTEGER};return this.timers.push(r),r.id}clearInterval(e){if(!e)return;const t=this.timers[e];t&&(t.id===e?delete this.timers[e]:console.error("timer错位",e,t))}}let o=null;t.getRTCTimer=function(){return o||(o=new i),o}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioLevel=void 0;const n=r(10),i=r(128),o=r(63);let s="NOTREADY",a=null;class c extends n.EventEmitter{constructor(e){super(),this.volume=0,this.left=null,this.right=null,this.channelState="balance",this.stateChangeCnt=0,this.support=null,this.logger=e.logger.getChild((()=>{let e="AudioLevel";return e+="READY"!==s?" "+s:" "+this.channelState,this.stateChangeCnt&&(e+=" change"+this.stateChangeCnt),e}));const t=o.getAudioContext(),r=e.stream;t&&(this.support={stream:r,context:t},this.updateStream(r,e.sourceNode))}async updateStream(e,t){if(this.logger.log("AudioLevel updateStream"),this.support){if(!t)try{t=this.support.context.createMediaStreamSource(e)}catch(r){if("TypeError"!==r.name)return void this.logger.error("无法创建MediaStreamAudioSourceNode",r.name,r.message);t=new MediaStreamAudioSourceNode(this.support.context,{mediaStream:e})}if(this.support.sourceNode&&this.support.sourceNode.disconnect(),this.support.sourceNode=t,!this.support.audioWorkletNode){if(!this.support.context.audioWorklet)return void this.logger.error("该环境不支持音量模块");a?"LOADING"===s&&await a:(s="LOADING",this.logger.log("正在载入音量模块"),a=this.support.context.audioWorklet.addModule(i.getBlobUrl("volumeProcessor")),await a,s="READY",this.logger.log("载入音量模块成功")),this.support.audioWorkletNode=new AudioWorkletNode(this.support.context,"vumeter"),this.support.audioWorkletNode.port.onmessage=e=>{var t,r;const n=Date.now(),i=Math.floor(n);if(this.volume=e.data.volume,e.data.left>-1)this.left||(this.left={volume:0,history:[]}),this.left.history.length&&this.left.history[0].sec===i||this.left.history.unshift({sec:i,sum:0}),this.left.volume=e.data.left,this.left.history[0].sum+=e.data.left,this.left.history.length>2&&this.left.history.pop();else{const e=this.channelState;this.channelState="mono",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}if(e.data.right>-1&&(this.right||(this.right={volume:0,history:[]}),this.right.history.length&&this.right.history[0].sec===i||this.right.history.unshift({sec:i,sum:0}),this.right.volume=e.data.right,this.right.history[0].sum+=e.data.right,this.right.history.length>2&&this.right.history.pop()),(null===(t=this.left)||void 0===t?void 0:t.history[1])&&(null===(r=this.right)||void 0===r?void 0:r.history[1]))if(this.left.history[1].sum>4*this.right.history[1].sum){const e=this.channelState;this.channelState="leftLoud",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}else if(this.right.history[1].sum>4*this.left.history[1].sum){const e=this.channelState;this.channelState="rightLoud",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}else{if(this.left.history[1].sum>this.right.history[1].sum&&"leftLoud"!==this.channelState){const e=this.channelState;this.channelState="balance",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}if(this.right.history[1].sum>this.left.history[1].sum&&"rightLoud"!==this.channelState){const e=this.channelState;this.channelState="balance",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}}}}this.support.sourceNode.connect(this.support.audioWorkletNode);const r=o.getAudioLevelDestination();r&&this.support.audioWorkletNode.connect(r)}}getAudioLevel(){return this.volume}destroy(){this.logger.log("destroy() AudioLevel模块")}}t.AudioLevel=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DataReport=void 0;const n=r(62),i=r(24),o=r(247);let s="https://statistic.live.126.net/statics/report/common/form";t.DataReport=class{constructor(e){this.configs=e||{};const t=e.adapterRef;e.sdkRef,this.adapterRef=t;let r=t.instance,n=t.channelInfo||{};this.cid=n.cid||n.channelId||0,this.uid=n.uid||0;const i=r._params&&r._params.appkey;this.time=n.clientNtpTime-n.T4,this.common={name:"common",ver:"2.0",sdk_type:"nrtc2",session_id:this.adapterRef.deviceId,app_key:i},this.eventKeys=[],this.eventMap={},this.api=[],this.heartbeat=null}addEvent(e,t){return-1==this.eventKeys.indexOf(e)&&this.eventKeys.push(e),t.time?t.time=t.time+this.time:(this.adapterRef.logger.warn(`addEvent:事件${e}没有time属性。使用当前时间戳`),t.time=Date.now()),this.eventMap[e]=t,this}updateCommon(e){return Object.assign(this.common,e),this}setHeartbeat(e){this.heartbeat=e;const t=Object.keys(this.adapterRef.apiEvent),r=Object.keys(this.adapterRef.apiEvents),n=t.concat(r.filter((e=>!t.includes(e))));let i=[];for(let e in n){const t=n[e];this.adapterRef.apiEvents[t]&&this.adapterRef.apiEvents[t].length?(i=i.concat(this.adapterRef.apiEvents[t]),this.adapterRef.apiEvents[t]=[]):this.adapterRef.apiEvent[t]&&this.adapterRef.apiEvent[t].length&&(i=i.concat(this.adapterRef.apiEvent[t]),this.adapterRef.apiEvent[t]=[])}return this.api=this.api.concat(i),this}setNetworkChange(e){return this.addEvent("networkChange",e),this}setLogin(e){var t,r,s;e.sdk_ver=e.sdk_ver||n.SDK_VERSION,e.platform=e.platform||"Web",e.app_key=e.app_key||this.common.app_key,e.meeting_mode=e.meeting_mode||1,e.model=e.model,e.build=n.BUILD,e.supported_codec_send=null===(t=this.adapterRef.mediaCapability.supportedCodecSend)||void 0===t?void 0:t.join(","),e.supported_codec_recv=null===(r=this.adapterRef.mediaCapability.supportedCodecRecv)||void 0===r?void 0:r.join(","),e.preferred_codec_send=null===(s=this.adapterRef.mediaCapability.preferredCodecSend.video)||void 0===s?void 0:s.join(","),e.extra_info=JSON.stringify({proc:o.processManager.processId,page:o.processManager.pageId,brow:o.processManager.browserId,userAgent:i.USER_AGENT}),e.lbs_addrs=this.adapterRef.lbsManager.getReportField("nrtc"),this.addEvent("login",e)}setRelogin(e){this.addEvent("relogin",e)}setLogout(e){this.addEvent("logout",e)}deviceAbnormal(e){this.addEvent("deviceAbnormal",e)}setDisconnect(e){this.addEvent("disconnect",e)}setRecvFirstFrame(e){this.addEvent("recvFirstFrame",e)}setSendFirstPackage(e){this.addEvent("firstPacketSent",e)}setRecvFirstPackage(e){this.addEvent("recvFirstPackage",e)}setFunction(e){this.addEvent("function",e)}setRequestLbs(e){this.addEvent("requestLBS",e)}setAudioVideoBanned(e){this.addEvent("audioVideoBanned",e)}setStreamException(e){this.addEvent("streamException",e)}setUserCustomEvent(e){this.addEvent("userCustomEvent",e)}reset(){this.eventKeys=[],this.api=[],this.heartbeat=null}send(e){let t={common:this.common};if(e||(e=this.eventKeys),this.heartbeat&&(t.heartbeat=this.heartbeat,this.api.length&&(this.api.forEach((e=>{e.uid||(e.uid=this.adapterRef.channelInfo&&this.adapterRef.channelInfo.uid),e.cid||(e.cid=this.adapterRef.channelInfo&&this.adapterRef.channelInfo.cid),e.param&&"object"==typeof e.param&&void 0!==e.param.clientUid&&(e.param.clientUid=e.uid)})),t.event={apiEvent:this.api},this.api=[])),e){if(e.length){let r=0,n={};for(let t=e.length-1;t>=0;t--){const i=e[t];this.eventMap[i]&&(r++,n[i]=this.eventMap[i],delete this.eventMap[i],e.splice(t,1))}r&&(t.event=n)}}else if(!this.heartbeat)return this;return this.adapterRef.instance._params.neRtcServerAddresses.statisticsServer&&(s=this.adapterRef.instance._params.neRtcServerAddresses.statisticsServer),this.adapterRef.lbsManager.ajax({type:"post",url:s,data:t,header:{sdktype:this.common.sdk_type,appkey:this.common.app_key,platform:"web",sdkver:n.SDK_VERSION}}).then((t=>{e===this.eventKeys&&this.reset()})).catch((e=>{this.adapterRef.logger.log("dataReport, send error: ",e.name,e.message,e),this.reset()})),this}}},function(e,t,r){e.exports=r(251)},function(e,t,r){e.exports=function(e,t){for(var r=new Array(arguments.length-1),n=0,i=2,o=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,s){r[n]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,s(e))}}))}},function(module,exports,__webpack_require__){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){t.Service=r(261)},function(e,t,r){e.exports={}},function(e,t,r){e.exports=function(e){for(var t,r=o.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),a=e.fieldsArray.slice().sort(o.compareFieldsById),c=0;c<a.length;++c){var u=a[c].resolve(),l=e._fieldsArray.indexOf(u),d=u.resolvedType instanceof n?"int32":u.type,p=i.basic[d];t="m"+o.safeProp(u.name),u.map?(r("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",t,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===p?r("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",l,t):r(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|p,d,t),r("}")("}")):u.repeated?(r("if(%s!=null&&%s.length){",t,t),u.packed&&void 0!==i.packed[d]?r("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",d,t)("w.ldelim()"):(r("for(var i=0;i<%s.length;++i)",t),void 0===p?s(r,u,l,t+"[i]"):r("w.uint32(%i).%s(%s[i])",(u.id<<3|p)>>>0,d,t)),r("}")):(u.optional&&r("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",t,u.name),void 0===p?s(r,u,l,t):r("w.uint32(%i).%s(%s)",(u.id<<3|p)>>>0,d,t))}return r("return w")};var n=r(59),i=r(130),o=r(25);function s(e,t,r,n){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}},function(e,t,r){e.exports=y;var n=r(129);((y.prototype=Object.create(n.prototype)).constructor=y).className="Type";var i=r(59),o=r(144),s=r(121),a=r(183),c=r(184),u=r(156),l=r(155),d=r(154),p=r(25),m=r(181),f=r(186),h=r(187),g=r(188),v=r(189);function y(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(y.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=p.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=p.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=y.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,p.merge(e.prototype,t)),e.$type=e.prototype.$type=this,p.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:p.oneOfGetter(this._oneofsArray[r].oneof),set:p.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),y.generateConstructor=function(e){for(var t,r=p.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",p.safeProp(t.name)):t.repeated&&r("this%s=[]",p.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},y.fromJSON=function(e,t){var r=new y(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),l=0;l<u.length;++l)r.add((void 0!==t.fields[u[l]].keyType?a.fromJSON:s.fromJSON)(u[l],t.fields[u[l]]));if(t.oneofs)for(u=Object.keys(t.oneofs),l=0;l<u.length;++l)r.add(o.fromJSON(u[l],t.oneofs[u[l]]));if(t.nested)for(u=Object.keys(t.nested),l=0;l<u.length;++l){var d=t.nested[u[l]];r.add((void 0!==d.id?s.fromJSON:void 0!==d.fields?y.fromJSON:void 0!==d.values?i.fromJSON:void 0!==d.methods?c.fromJSON:n.fromJSON)(u[l],d))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r},y.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&Boolean(e.keepComments);return p.toObject(["options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},y.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return n.prototype.resolveAll.call(this)},y.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},y.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof s&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof o?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},y.prototype.remove=function(e){if(e instanceof s&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof o){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},y.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},y.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},y.prototype.create=function(e){return new this.ctor(e)},y.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=m(this)({Writer:d,types:t,util:p}),this.decode=f(this)({Reader:l,types:t,util:p}),this.verify=h(this)({types:t,util:p}),this.fromObject=g.fromObject(this)({types:t,util:p}),this.toObject=g.toObject(this)({types:t,util:p});var n=v[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},y.prototype.encode=function(e,t){return this.setup().encode(e,t)},y.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},y.prototype.decode=function(e,t){return this.setup().decode(e,t)},y.prototype.decodeDelimited=function(e){return e instanceof l||(e=l.create(e)),this.decode(e,e.uint32())},y.prototype.verify=function(e){return this.setup().verify(e)},y.prototype.fromObject=function(e){return this.setup().fromObject(e)},y.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},y.d=function(e){return function(t){p.decorateType(t,e)}}},function(e,t,r){e.exports=s;var n=r(121);((s.prototype=Object.create(n.prototype)).constructor=s).className="MapField";var i=r(130),o=r(25);function s(e,t,r,i,s,a){if(n.call(this,e,t,i,void 0,void 0,s,a),!o.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}s.fromJSON=function(e,t){return new s(e,t.id,t.keyType,t.type,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},s.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},s.d=function(e,t,r){return"function"==typeof r?r=o.decorateType(r).name:r&&"object"==typeof r&&(r=o.decorateEnum(r).name),function(n,i){o.decorateType(n.constructor).add(new s(i,e,t,r))}}},function(e,t,r){e.exports=a;var n=r(129);((a.prototype=Object.create(n.prototype)).constructor=a).className="Service";var i=r(185),o=r(25),s=r(179);function a(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function c(e){return e._methodsArray=null,e}a.fromJSON=function(e,t){var r=new a(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),o=0;o<n.length;++o)r.add(i.fromJSON(n[o],t.methods[n[o]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r},a.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&Boolean(e.keepComments);return o.toObject(["options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(a.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=o.toArray(this.methods))}}),a.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},a.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return n.prototype.resolve.call(this)},a.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,c(this)):n.prototype.add.call(this,e)},a.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,c(this)}return n.prototype.remove.call(this,e)},a.prototype.create=function(e,t,r){for(var n,i=new s.Service(e,t,r),a=0;a<this.methodsArray.length;++a){var c=o.lcFirst((n=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");i[c]=o.codegen(["r","c"],o.isReserved(c)?c+"_":c)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},function(e,t,r){e.exports=o;var n=r(120);((o.prototype=Object.create(n.prototype)).constructor=o).className="Method";var i=r(25);function o(e,t,r,o,s,a,c,u,l){if(i.isObject(s)?(c=s,s=a=void 0):i.isObject(a)&&(c=a,a=void 0),void 0!==t&&!i.isString(t))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(o))throw TypeError("responseType must be a string");n.call(this,e,c),this.type=t||"rpc",this.requestType=r,this.requestStream=!!s||void 0,this.responseType=o,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=l}o.fromJSON=function(e,t){return new o(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},function(e,t,r){e.exports=function(e){var t=o.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var r=0;r<e.fieldsArray.length;++r){var a=e._fieldsArray[r].resolve(),c=a.resolvedType instanceof n?"int32":a.type,u="m"+o.safeProp(a.name);t("case %i:",a.id),a.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[a.keyType]?t("k=%j",i.defaults[a.keyType]):t("k=null"),void 0!==i.defaults[c]?t("value=%j",i.defaults[c]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",a.keyType)("case 2:"),void 0===i.basic[c]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",c),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[a.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',u):t("%s[k]=value",u)):a.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[c]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,c)("}else"),void 0===i.basic[c]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,c)):void 0===i.basic[c]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,c),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var l=e._fieldsArray[r];l.required&&t("if(!m.hasOwnProperty(%j))",l.name)("throw util.ProtocolError(%j,{instance:m})",s(l))}return t("return m")};var n=r(59),i=r(130),o=r(25);function s(e){return"missing required '"+e.name+"'"}},function(e,t,r){e.exports=function(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r={};e.oneofsArray.length&&t("var p={}");for(var n=0;n<e.fieldsArray.length;++n){var c=e._fieldsArray[n].resolve(),u="m"+i.safeProp(c.name);if(c.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map)t("if(!util.isObject(%s))",u)("return%j",o(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),a(t,c,"k[i]"),s(t,c,n,u+"[k[i]]")("}");else if(c.repeated)t("if(!Array.isArray(%s))",u)("return%j",o(c,"array"))("for(var i=0;i<%s.length;++i){",u),s(t,c,n,u+"[i]")("}");else{if(c.partOf){var l=i.safeProp(c.partOf.name);1===r[c.partOf.name]&&t("if(p%s===1)",l)("return%j",c.partOf.name+": multiple values"),r[c.partOf.name]=1,t("p%s=1",l)}s(t,c,n,u)}c.optional&&t("}")}return t("return null")};var n=r(59),i=r(25);function o(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function s(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",o(t,"enum value"));for(var s=Object.keys(t.resolvedType.values),a=0;a<s.length;++a)e("case %i:",t.resolvedType.values[s[a]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",o(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",o(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",o(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",o(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",o(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",o(t,"buffer"))}return e}function a(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",o(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",o(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",o(t,"boolean key"))}return e}},function(e,t,r){var n=t,i=r(59),o=r(25);function s(e,t,r,n){if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var o=t.resolvedType.values,s=Object.keys(o),a=0;a<s.length;++a)t.repeated&&o[s[a]]===t.typeDefault&&e("default:"),e("case%j:",s[a])("case %i:",o[s[a]])("m%s=%j",n,o[s[a]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,c)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function a(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var o=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":o=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,o?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=o.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var a=t[n].resolve(),c=o.safeProp(a.name);a.map?(r("if(d%s){",c)('if(typeof d%s!=="object")',c)("throw TypeError(%j)",a.fullName+": object expected")("m%s={}",c)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",c),s(r,a,n,c+"[ks[i]]")("}")("}")):a.repeated?(r("if(d%s){",c)("if(!Array.isArray(d%s))",c)("throw TypeError(%j)",a.fullName+": array expected")("m%s=[]",c)("for(var i=0;i<d%s.length;++i){",c),s(r,a,n,c+"[i]")("}")("}")):(a.resolvedType instanceof i||r("if(d%s!=null){",c),s(r,a,n,c),a.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(o.compareFieldsById);if(!t.length)return o.codegen()("return {}");for(var r=o.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],s=[],c=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?n:t[u].map?s:c).push(t[u]);if(n.length){for(r("if(o.arrays||o.defaults){"),u=0;u<n.length;++u)r("d%s=[]",o.safeProp(n[u].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),u=0;u<s.length;++u)r("d%s={}",o.safeProp(s[u].name));r("}")}if(c.length){for(r("if(o.defaults){"),u=0;u<c.length;++u){var l=c[u],d=o.safeProp(l.name);if(l.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",d,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var p="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",d,p)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else r("d%s=%j",d,l.typeDefault)}r("}")}var m=!1;for(u=0;u<t.length;++u){l=t[u];var f=e._fieldsArray.indexOf(l);d=o.safeProp(l.name),l.map?(m||(m=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),a(r,l,f,d+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),a(r,l,f,d+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",d,l.name),a(r,l,f,d),l.partOf&&r("if(o.oneofs)")("d%s=%j",o.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}},function(e,t,r){var n=t,i=r(156);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].substr(1):e["@type"];return-1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="",n="";if(t&&t.json&&e.type_url&&e.value){n=e.type_url.substring(e.type_url.lastIndexOf("/")+1),r=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var o=this.lookup(n);o&&(e=o.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var s=e.$type.toObject(e,t);return""===r&&(r="type.googleapis.com/"),n=r+("."===e.$type.fullName[0]?e.$type.fullName.substr(1):e.$type.fullName),s["@type"]=n,s}return this.toObject(e,t)}}},function(e,t,r){e.exports=d;var n=r(129);((d.prototype=Object.create(n.prototype)).constructor=d).className="Root";var i,o,s,a=r(121),c=r(59),u=r(144),l=r(25);function d(e){n.call(this,"",e),this.deferred=[],this.files=[]}function p(){}d.fromJSON=function(e,t){return t||(t=new d),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},d.prototype.resolvePath=l.path.resolve,d.prototype.fetch=l.fetch,d.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var i=this;if(!n)return l.asPromise(e,i,t,r);var a=n===p;function c(e,t){if(n){var r=n;if(n=null,a)throw e;r(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function d(e,t){try{if(l.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),l.isString(t)){o.filename=e;var n,s=o(t,i,r),d=0;if(s.imports)for(;d<s.imports.length;++d)(n=u(s.imports[d])||i.resolvePath(e,s.imports[d]))&&m(n);if(s.weakImports)for(d=0;d<s.weakImports.length;++d)(n=u(s.weakImports[d])||i.resolvePath(e,s.weakImports[d]))&&m(n,!0)}else i.setOptions(t.options).addJSON(t.nested)}catch(e){c(e)}a||f||c(null,i)}function m(e,t){if(!(i.files.indexOf(e)>-1))if(i.files.push(e),e in s)a?d(e,s[e]):(++f,setTimeout((function(){--f,d(e,s[e])})));else if(a){var r;try{r=l.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||c(e))}d(e,r)}else++f,i.fetch(e,(function(r,o){--f,n&&(r?t?f||c(null,i):c(r):d(e,o))}))}var f=0;l.isString(t)&&(t=[t]);for(var h,g=0;g<t.length;++g)(h=i.resolvePath("",t[g]))&&m(h);if(a)return i;f||c(null,i)},d.prototype.loadSync=function(e,t){if(!l.isNode)throw Error("not supported");return this.load(e,t,p)},d.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return n.prototype.resolveAll.call(this)};var m=/^[A-Z]/;function f(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new a(t.fullName,t.id,t.type,t.rule,void 0,t.options);return n.declaringField=t,t.extensionField=n,r.add(n),!0}return!1}d.prototype._handleAdd=function(e){if(e instanceof a)void 0===e.extend||e.extensionField||f(0,e)||this.deferred.push(e);else if(e instanceof c)m.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof i)for(var t=0;t<this.deferred.length;)f(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);m.test(e.name)&&(e.parent[e.name]=e)}},d.prototype._handleRemove=function(e){if(e instanceof a){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof c)m.test(e.name)&&delete e.parent[e.name];else if(e instanceof n){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);m.test(e.name)&&delete e.parent[e.name]}},d._configure=function(e,t,r){i=e,o=t,s=r}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHelper=void 0;const a=r(10),c=r(163),u=r(122),l=r(157),d=s(r(12)),p=s(r(13)),m=o(r(73)),f=r(73),h=r(65),g=r(272),v=o(r(24)),y=r(56),b=r(147),S=r(117),T=r(4),_=r(273),w=r(63),M=r(274);class x extends a.EventEmitter{constructor(e){super(),this.audio={audioStream:new MediaStream,audioSourceStream:new MediaStream,musicStream:new MediaStream,micStream:new MediaStream,pipeline:null,audioSource:null,micTrack:null,deviceInfo:{mic:{compatAudio:!1,label:""}},webAudio:null,micConstraint:null,mixAudioConf:{index:0,audioBuffer:{},sounds:{}},stageAIProcessing:null,audioRoutingEnabled:!1},this.video={videoStream:new MediaStream,renderStream:new MediaStream,low:null,cameraTrack:null,cameraConstraint:{video:{}},videoSource:null,preProcessingEnabled:!1,preProcessing:null,captureConfig:{high:{width:640,height:480,frameRate:15}},encoderConfig:{high:{maxBitrate:8e5,contentHint:null},low:{maxBitrate:1e5,contentHint:"motion"}}},this.screen={screenVideoStream:new MediaStream,renderStream:new MediaStream,low:null,screenVideoTrack:null,screenVideoSource:null,preProcessingEnabled:!1,preProcessing:null,captureConfig:{high:{width:1920,height:1080,frameRate:5}},encoderConfig:{high:{maxBitrate:15e5,contentHint:null},low:{maxBitrate:2e5,contentHint:"motion"}}},this.screenAudio={screenAudioStream:new MediaStream,screenAudioTrack:null,screenAudioSource:null,pipeline:null},this.listenToTrackEnded=e=>{e&&e.addEventListener("ended",(()=>{this.logger.log("Track ended",e.label,e.id),this.stream===this.stream.client.adapterRef.localStream&&(e!==this.audio.micTrack&&e!==this.audio.audioSource||(this.logger.warn("音频轨道已停止"),this.stream.client.safeEmit("audioTrackEnded"),this.stream.client.apiEventReport("setStreamException",{name:"pushStreamException",value:"audioTrackEnded",mediaType:"audio"})),e!==this.video.cameraTrack&&e!==this.video.videoSource||(this.logger.warn("视频轨道已停止"),this.stream.client.safeEmit("videoTrackEnded"),this.stream.client.apiEventReport("setStreamException",{name:"pushStreamException",value:"videoTrackEnded",mediaType:"video"})),(e===this.screen.screenVideoTrack||e===this.screen.screenVideoSource||e.label.indexOf("screen")>-1||e.label.indexOf("window")>-1||e.label.indexOf("web-")>-1)&&(this.logger.warn("屏幕共享已停止"),this.stream.client.safeEmit("stopScreenSharing"),this.stream.client.apiEventReport("setStreamException",{name:"pushStreamException",value:"videoTrackEnded",mediaType:"screen"})),e===this.screenAudio.screenAudioTrack&&(this.logger.warn("屏幕共享音频已停止"),this.stream.client.safeEmit("stopScreenAudio"),this.stream.client.apiEventReport("setStreamException",{name:"pushStreamException",value:"stopScreenAudio",mediaType:"screenAudio"})))}))},this.stream=e.stream,this.logger=e.stream.logger.getChild((()=>{var e;let t="mediaHelper";return this.audio.audioRoutingEnabled&&(t+=" WebAudio"),this.audio.webAudio&&(this.audio.webAudio.context&&"running"!==this.audio.webAudio.context.state&&(t+=" "+this.audio.webAudio.context.state),this.audio.webAudio.mixAudioConf.state!==c.AuidoMixingState.UNSTART&&(t+=" "+(null===(e=this.audio.webAudio)||void 0===e?void 0:e.mixAudioConf.state))),this.stream.mediaHelper!==this&&(t+="DETACHED"),t})),this.bindRenderStream(),S.Device.on("recording-device-changed",(e=>{this.audio.micTrack&&this.audio.deviceInfo.mic.deviceId===e.device.deviceId&&("INACTIVE"===e.state?(this.logger.error("当前使用的麦克风设备被移除，需重新启用设备",e.device),this.stream.emit("recording-device-changed",e)):S.Device.deviceHistory.audioIn.find((e=>{e.groupId,this.audio.deviceInfo.mic.groupId}))||(this.logger.error(`当前麦克风已由【${this.audio.deviceInfo.mic.label}】切换至【${e.device.label}】，可能会影响通话质量`),this.audio.deviceInfo.mic.label=e.device.label,this.audio.deviceInfo.mic.groupId=e.device.groupId,this.stream.emit("recording-device-changed",e)))}))}getOrCreateAudioPipeline(e="audio"){let t;const r=w.getAudioContext();if(!r)return this.logger.error("getOrCreateAudioPipeline: AudioContext is not supported"),null;if("audio"===e)if(this.audio.pipeline?t=this.audio.pipeline:(t=new M.AudioPipeline({logger:this.logger,outputStream:this.audio.audioStream,context:r}),this.audio.pipeline=t,this.logger.log("getOrCreateAudioPipeline: 初始化成功")),this.stream.isRemote)t.inputs.remote.track!==this.audio.micTrack&&(this.logger.log("getOrCreateAudioPipeline: 更新输入的Track"),t.setInput("remote",this.audio.micTrack,"remote"+this.stream.streamID));else{const e=this.audio.micTrack||this.audio.audioSource;t.inputs.local.track!==e&&(this.logger.log("getOrCreateAudioPipeline: 更新输入的Track"),t.setInput("local",e,(null==e?void 0:e.label)||"empty"))}else if(this.screenAudio.pipeline?t=this.screenAudio.pipeline:(t=new M.AudioPipeline({logger:this.logger,outputStream:this.screenAudio.screenAudioStream,context:r}),this.screenAudio.pipeline=t,this.logger.log("getOrCreateAudioPipeline/screenAudio: 初始化成功")),this.stream.isRemote)t.inputs.remote.track!==this.screenAudio.screenAudioTrack&&(this.logger.log("getOrCreateAudioPipeline/screenAudio: 更新输入的Track"),t.setInput("remote",this.screenAudio.screenAudioTrack,`remote${this.stream.streamID}/screenAudio`));else{const e=this.screenAudio.screenAudioTrack||this.screenAudio.screenAudioSource;t.inputs.local.track!==e&&(this.logger.log("getOrCreateAudioPipeline/screenAudio: 更新输入的Track"),t.setInput("local",e,(null==e?void 0:e.label)||"empty"))}return t}bindRenderStream(){v.IS_SAFARI&&"safari"===T.getParameters().shimLocalCanvas||"all"===T.getParameters().shimLocalCanvas?(this.video.videoStream.onaddtrack=async e=>{if("undefined"!=typeof CanvasCaptureMediaStreamTrack&&e.track instanceof CanvasCaptureMediaStreamTrack){const t=g.pcCloneTrack(e.track);f.watchTrack(t),this.logger.warn("renderStream cloned track for video:",e.track,t),f.emptyStreamWith(this.video.renderStream,t)}else f.emptyStreamWith(this.video.renderStream,e.track)},this.video.videoStream.onremovetrack=e=>{f.emptyStreamWith(this.video.renderStream,null)},this.screen.screenVideoStream.onaddtrack=async e=>{if("undefined"!=typeof CanvasCaptureMediaStreamTrack&&e.track instanceof CanvasCaptureMediaStreamTrack){const t=g.pcCloneTrack(e.track);f.watchTrack(t),this.logger.warn("renderStream cloned track for screen:",e.track,t),f.emptyStreamWith(this.screen.renderStream,t)}else f.emptyStreamWith(this.screen.renderStream,e.track)},this.screen.screenVideoStream.onremovetrack=e=>{f.emptyStreamWith(this.screen.renderStream,null)}):(this.video.renderStream=this.video.videoStream,this.screen.renderStream=this.screen.screenVideoStream)}assertLive(){if(!this.stream.isRemote&&!this.stream.isRemote&&this.stream.destroyed)throw this._reset(),new p.default({code:d.default.LOCALSTREAM_NOT_FOUND_ERROR,message:"assertLive: localStream 已经销毁"})}_reset(){this.stopAllEffects(),this.stream.isRemote||(this.audio.webAudio&&(this.audio.webAudio.off("audioFilePlaybackCompleted"),this.audio.webAudio.destroy()),this.audio.webAudio=null,this.audio.micConstraint=null,this.audio.audioRoutingEnabled=!1,this.audio.micTrack&&(this.audio.micTrack.stop(),this.audio.micTrack=null),this.video.low&&(this.video.low.destroy(),this.video.low=null),this.video.videoSource=null,this.video.cameraTrack&&(this.video.cameraTrack.stop(),this.video.cameraTrack=null),this.screen.screenVideoTrack&&(this.screen.screenVideoTrack.stop(),this.screen.screenVideoTrack=null),this.video.cameraConstraint={video:{}},this.screenAudio.screenAudioTrack&&(this.screenAudio.screenAudioTrack.stop(),this.screenAudio.screenAudioTrack=null),this.audio.mixAudioConf={index:0,audioBuffer:{},sounds:{}}),f.emptyStreamWith(this.audio.audioStream,null),f.emptyStreamWith(this.audio.musicStream,null),f.emptyStreamWith(this.audio.micStream,null),f.emptyStreamWith(this.screenAudio.screenAudioStream,null),f.emptyStreamWith(this.video.videoStream,null),f.emptyStreamWith(this.screen.screenVideoStream,null),f.emptyStreamWith(this.screenAudio.screenAudioStream,null)}updateWebAudio(){var e,t;if(!this.audio.webAudio){this.audio.webAudio=new w.WebAudio({mediaHelper:this,logger:this.logger}),this.audio.webAudio.on("audioFilePlaybackCompleted",this._audioFilePlaybackCompletedEvent.bind(this));const r=null===(t=null===(e=this.audio.webAudio)||void 0===e?void 0:e.musicDestination)||void 0===t?void 0:t.stream.getAudioTracks()[0];r&&f.emptyStreamWith(this.audio.musicStream,r)}this.audio.webAudio.updateTracks([{track:this.audio.micTrack||this.audio.audioSource,type:"microphone"}])}async getScreenSource(e){const{width:t,height:r,frameRate:n}=this.screen.captureConfig.high;try{return await m.getScreenStream({video:{width:{ideal:t},height:{ideal:r},frameRate:{ideal:n,max:n}}},this.logger)}catch(e){const t="screen";return e.message&&e.message.indexOf("ermission")>-1&&e.message.indexOf("denied")>-1?this.stream.client.safeEmit("accessDenied",t):e.message&&e.message.indexOf("not found")>-1?this.stream.client.safeEmit("notFound",t):e.message&&e.message.indexOf("not start video source")>-1?this.stream.client.safeEmit("beOccupied",t):this.stream.client.safeEmit("deviceError",t),this.stream.emit("device-error",{type:t,error:e}),Promise.reject(e)}}getTrackByMediaType(e){return"audio"===e?this.audio.micTrack||this.audio.audioSource:"audioSlave"===e?this.screenAudio.screenAudioTrack||this.screenAudio.screenAudioSource:"video"===e?this.video.cameraTrack||this.video.videoSource:"screen"===e?this.screen.screenVideoTrack||this.screen.screenVideoSource:null}async getStream(e){let{audio:t=!1,audioDeviceId:r="",video:n=!1,videoDeviceId:i="",screen:o=!1,sourceId:s="",screenAudio:a=!1,facingMode:c="",audioSource:u=null,videoSource:l=null,screenAudioSource:d=null,screenVideoSource:p=null,deviceId:h=""}=e;if(u&&(t=!0),l&&(n=!0),p&&(o=!0),d&&(a=!0),this.stream.isRemote)this.logger.error("getStream: 远端流不能够调用getStream");else if(t||n||o||a){if(u){if("ended"===u.readyState)return void this.logger.error("不应输入已经停止的轨道:",u.kind,u.label);f.watchTrack(u),this.audio.audioSource=u,f.emptyStreamWith(this.audio.audioSourceStream,u),this.updateWebAudio(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(f.emptyStreamWith(this.audio.audioStream,u),this.updateAudioSender(u))),t=!1,this.stream.client.updateRecordingAudioStream()}if(l){if("ended"===l.readyState)return void this.logger.error("不应输入已经停止的轨道:",l.kind,l.label);f.watchTrack(l),this.video.videoSource=l,f.emptyStreamWith(this.video.videoStream,l),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint),n=!1}if(d){if("ended"===d.readyState)return void this.logger.error("不应输入已经停止的轨道:",d.kind,d.label);f.watchTrack(d),this.screenAudio.screenAudioSource=d,f.emptyStreamWith(this.screenAudio.screenAudioStream,d),this.listenToTrackEnded(this.screenAudio.screenAudioSource),f.emptyStreamWith(this.screenAudio.screenAudioStream,d),a=!1}if(p){if("ended"===p.readyState)return void this.logger.error("不应输入已经停止的轨道:",p.kind,p.label);f.watchTrack(p),this.screen.screenVideoSource=p,f.emptyStreamWith(this.screen.screenVideoStream,p),this.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.screen.encoderConfig.high.contentHint&&this.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.screen.encoderConfig.high.contentHint),this.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.screen.encoderConfig.high.contentHint),o=!1}try{if(o){const{width:e,height:r,frameRate:n}=this.screen.captureConfig.high;if(s){const t=(await m.getStream({video:{mandatory:{maxWidth:e,maxHeight:r,maxFrameRate:n,minFrameRate:5,chromeMediaSource:"desktop",chromeMediaSourceId:s}}},this.logger)).getVideoTracks()[0];this.screen.screenVideoTrack=t,f.emptyStreamWith(this.screen.screenVideoStream,t)}else{let t=await m.getScreenStream({video:{width:{ideal:e},height:{ideal:r},frameRate:{ideal:n,max:n}},audio:a&&this.getAudioConstraints("audioSlave")?this.getAudioConstraints("audioSlave"):a},this.logger);if(this.screen.screenVideoTrack=t.getVideoTracks()[0],this.listenToTrackEnded(this.screen.screenVideoTrack),f.emptyStreamWith(this.screen.screenVideoStream,this.screen.screenVideoTrack),this.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.screen.encoderConfig.high.contentHint&&this.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.screen.encoderConfig.high.contentHint),this.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.screen.encoderConfig.high.contentHint),a){const e=t.getAudioTracks()[0];e?(this.screenAudio.screenAudioTrack=e,f.emptyStreamWith(this.screenAudio.screenAudioStream,e),this.listenToTrackEnded(e),this.stream.client.apiEventReport("setFunction",{name:"pub_second_audio",oper:"1",value:JSON.stringify({result:"success",constaints:this.getAudioConstraints("audioSlave")},null," ")})):(this.logger.warn("getStream screenAudio: 未获取到屏幕共享音频"),this.stream.screenAudio=!1,this.stream.client.emit("error","screenAudioNotAllowed"))}}if(this.stream.client.apiEventReport("setFunction",{name:"set_screen",oper:"1",value:JSON.stringify({result:"success",constaints:{video:{width:{ideal:e},height:{ideal:r},frameRate:{ideal:n,max:n}},audio:a&&this.getAudioConstraints("audioSlave")?this.getAudioConstraints("audioSlave"):a}},null," ")}),t){let e=await m.getStream({audio:this.getAudioConstraints("audio")},this.logger);this.audio.micTrack=e.getAudioTracks()[0],f.emptyStreamWith(this.audio.micStream,this.audio.micTrack),this.listenToTrackEnded(this.audio.micTrack),this.updateWebAudio(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(f.emptyStreamWith(this.audio.audioStream,this.audio.micTrack),this.updateAudioSender(this.audio.micTrack)));const t=b.compatAudioInputList.findSource(this.audio.micTrack.id);if(t){this.audio.deviceInfo.mic.compatAudio=!0;const e=t.getSettings();this.audio.deviceInfo.mic.label=t.label,this.audio.deviceInfo.mic.deviceId=e.deviceId,this.audio.deviceInfo.mic.groupId=e.groupId}else{this.audio.deviceInfo.mic.compatAudio=!1;const e=this.audio.micTrack.getSettings();this.audio.deviceInfo.mic.label=this.audio.micTrack.label,this.audio.deviceInfo.mic.deviceId=e.deviceId,this.audio.deviceInfo.mic.groupId=e.groupId}this.stream.client.apiEventReport("setFunction",{name:"set_mic",oper:"1",value:JSON.stringify({result:"success",constaints:this.getAudioConstraints("audio")},null," ")})}}else if(a)this.logger.error("无法单独获取屏幕共享音频");else if(t||n){if(this.stream.isRemote)return void this.logger.error("MediaHelper.getStream:远端流不能调用getStream");const{height:e,width:o,frameRate:s}=this.video.captureConfig.high;let a={audio:t&&this.getAudioConstraints("audio")?this.getAudioConstraints("audio"):void 0,video:n?{width:{ideal:o},height:{ideal:e},frameRate:{ideal:s||15}}:void 0};r&&a.audio&&(a.audio.deviceId={exact:r}),a.video&&(c?a.video.facingMode={exact:c}:i&&(a.video.deviceId={exact:i}));const u=await m.getStream(a,this.logger),l=u.getVideoTracks()[0],d=u.getAudioTracks()[0];if(d){this.audio.micTrack=d,this.listenToTrackEnded(this.audio.micTrack),f.emptyStreamWith(this.audio.micStream,this.audio.micTrack),this.updateWebAudio(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(f.emptyStreamWith(this.audio.audioStream,this.audio.micTrack),this.updateAudioSender(this.audio.micTrack)));const e=b.compatAudioInputList.findSource(this.audio.micTrack.id);if(e){this.audio.deviceInfo.mic.compatAudio=!0;const t=e.getSettings();this.audio.deviceInfo.mic.label=e.label,this.audio.deviceInfo.mic.deviceId=t.deviceId,this.audio.deviceInfo.mic.groupId=t.groupId}else{this.audio.deviceInfo.mic.compatAudio=!1;const e=this.audio.micTrack.getSettings();this.audio.deviceInfo.mic.label=this.audio.micTrack.label,this.audio.deviceInfo.mic.deviceId=e.deviceId,this.audio.deviceInfo.mic.groupId=e.groupId}this.stream.client.apiEventReport("setFunction",{name:"set_mic",oper:"1",value:JSON.stringify({result:"success",constaints:a.audio},null," ")}),"object"==typeof a.audio&&(this.audio.micConstraint={audio:a.audio}),this.stream.client.updateRecordingAudioStream()}l&&(this.video.cameraTrack=l,f.emptyStreamWith(this.video.videoStream,l),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint),this.listenToTrackEnded(this.video.cameraTrack),this.stream.client.apiEventReport("setFunction",{name:"set_camera",oper:"1",value:JSON.stringify({result:"success",constaints:a.video})}),"object"==typeof a.video&&(this.video.cameraConstraint={video:a.video}))}this.assertLive()}catch(e){this.logger.error("getStream error:",e.name,e.message);let r="audio";return t&&this.stream.client.apiEventReport("setFunction",{name:"set_mic",oper:"1",value:JSON.stringify({result:"fail",reason:`${e.name} + ${e.message}`},null," ")}),n&&(r="video",this.stream.client.apiEventReport("setFunction",{name:"set_camera",oper:"1",value:JSON.stringify({result:"fail",reason:`${e.name} + ${e.message}`},null," ")})),o&&(r="screen",this.stream.client.apiEventReport("setFunction",{name:"set_screen",oper:"1",value:JSON.stringify({result:"fail",reason:`${e.name} + ${e.message}`},null," ")})),"NotAllowedError"===e.name?this.stream.client.safeEmit("accessDenied",r):"NotFoundError"===e.name?this.stream.client.safeEmit("notFound",r):"NotReadableError"===e.name?this.stream.client.safeEmit("beOccupied",r):"OverconstrainedError"===e.name&&this.stream.client.safeEmit("deviceError",r),this.stream.emit("device-error",{type:r,error:e}),this.stream.client.apiEventReport("setStreamException",{name:"pushStreamException",value:`getUserMediaError: ${e.name} + ${e.message}`,mediaType:r}),Promise.reject(e)}}else this.logger.error("getStream: 必须指定媒体类型")}async getSecondStream(e){let{audio:t=!1,video:r=!1}=e;if(!this.stream.isRemote)try{const t=await m.getStream(e,this.logger),r=t.getAudioTracks()[0],n=t.getVideoTracks()[0];if(this.logger.log(`getSecondStream: ${r?r.label:""} ${n?n.label:""}`),r){"object"==typeof e.audio&&(this.audio.micConstraint={audio:e.audio}),this.audio.micTrack=r,this._stopTrack(this.audio.micStream),f.emptyStreamWith(this.audio.micStream,this.audio.micTrack),this.listenToTrackEnded(this.audio.micTrack),this.updateWebAudio(),this.audio.audioRoutingEnabled||(this.getAudioInputTracks().length>1?this.enableAudioRouting():(f.emptyStreamWith(this.audio.audioStream,this.audio.micTrack),this.updateAudioSender(this.audio.micTrack)));const t=b.compatAudioInputList.findSource(this.audio.micTrack.id);if(t){this.audio.deviceInfo.mic.compatAudio=!0;const e=t.getSettings();this.audio.deviceInfo.mic.label=t.label,this.audio.deviceInfo.mic.deviceId=e.deviceId,this.audio.deviceInfo.mic.groupId=e.groupId}else{this.audio.deviceInfo.mic.compatAudio=!1;const e=this.audio.micTrack.getSettings();this.audio.deviceInfo.mic.label=this.audio.micTrack.label,this.audio.deviceInfo.mic.deviceId=e.deviceId,this.audio.deviceInfo.mic.groupId=e.groupId}this.stream.client.updateRecordingAudioStream(),this.stream.client.apiEventReport("setFunction",{name:"set_mic",oper:"1",value:JSON.stringify({result:"success",constaints:e.audio},null," ")})}if(n){"object"==typeof e.video&&(this.video.cameraConstraint={video:e.video}),this.video.cameraTrack=n,this._stopTrack(this.video.videoStream),f.emptyStreamWith(this.video.videoStream,this.video.cameraTrack),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint),this.stream.client.apiEventReport("setFunction",{name:"set_camera",oper:"1",value:JSON.stringify({result:"success",constaints:e.video},null," ")});const t=this.stream._play.video.view;t&&(await this.stream.play(t),"width"in this.stream.renderMode.local.video&&this.stream.setLocalRenderMode(this.stream.renderMode.local.video,"video"));const r=this.stream.getSender("video","high");(null==r?void 0:r.track)?r.replaceTrack(n):this.logger.warn("getSecondStream video: 此时未发布流")}}catch(e){this.logger.error("getStream error",e.message);const r=t?"set_mic":"set_camera";return this.stream.client.apiEventReport("setFunction",{name:r,oper:"1",value:JSON.stringify({result:"fail",reason:e.message},null," ")}),Promise.reject(e)}}convert(e){const t=e.resolution,r=e.frameRate;let n={width:640,height:480,frameRate:15};return 2===t?(n.width=320,n.height=180):4===t?(n.width=640,n.height=480):8===t||v.IS_IOS_SAFARI?(n.width=1280,n.height=720):16===t&&(n.width=1920,n.height=1080),r===u.VIDEO_FRAME_RATE_ENUM.CHAT_VIDEO_FRAME_RATE_NORMAL?n.frameRate=15:r===u.VIDEO_FRAME_RATE_ENUM.CHAT_VIDEO_FRAME_RATE_5?n.frameRate=5:r===u.VIDEO_FRAME_RATE_ENUM.CHAT_VIDEO_FRAME_RATE_10?n.frameRate=10:r===u.VIDEO_FRAME_RATE_ENUM.CHAT_VIDEO_FRAME_RATE_15?n.frameRate=15:r===u.VIDEO_FRAME_RATE_ENUM.CHAT_VIDEO_FRAME_RATE_20?n.frameRate=20:r===u.VIDEO_FRAME_RATE_ENUM.CHAT_VIDEO_FRAME_RATE_25?n.frameRate=25:r===u.VIDEO_FRAME_RATE_ENUM.CHAT_VIDEO_FRAME_RATE_30&&(n.frameRate=30),n}getAudioConstraints(e){if(this.stream.isRemote)return void this.logger.error("Remote Stream dont have audio constraints");const t=this.stream.audioProcessing;let r={channelCount:"audio"===e?1:2};switch(t&&(void 0!==t.AEC&&(r.echoCancellation=t.AEC,r.googEchoCancellation=t.AEC,r.googEchoCancellation2=t.AEC),void 0!==t.ANS&&(r.noiseSuppression=t.ANS,r.googNoiseSuppression=t.ANS,r.googNoiseSuppression2=t.ANS),void 0!==t.AGC&&(r.autoGainControl=t.AGC,r.googAutoGainControl=t.AGC,r.googAutoGainControl2=t.AGC)),"audioSlave"===e&&(void 0===r.echoCancellation&&(r.echoCancellation=!1),void 0===r.noiseSuppression&&(r.noiseSuppression=!1),void 0===r.autoGainControl&&(r.autoGainControl=!1)),this.stream.audioProfile){case"standard_stereo":case"high_quality_stereo":r.googAutoGainControl=!1,r.googAutoGainControl2=!1,r.echoCancellation=!1,r.googNoiseSuppression=!1,r.channelCount=2}return r}getTrackSettings(){const e={};try{if(this.audio.micTrack){const t=b.compatAudioInputList.findSource(this.audio.micTrack.id);e.mic=t?{compat:!0,settings:t.getSettings(),label:t.label,readyState:t.readyState}:{settings:this.audio.micTrack.getSettings(),label:this.audio.micTrack.label,readyState:this.audio.micTrack.readyState}}this.audio.audioSource&&(e.audioSource={settings:this.audio.audioSource.getSettings(),label:this.audio.audioSource.label,readyState:this.audio.audioSource.readyState}),this.video.cameraTrack&&(e.camera={settings:this.video.cameraTrack.getSettings(),label:this.video.cameraTrack.label,readyState:this.video.cameraTrack.readyState}),this.video.videoSource&&(e.videoSource={settings:this.video.videoSource.getSettings(),label:this.video.videoSource.label,readyState:this.video.videoSource.readyState}),this.screen.screenVideoTrack&&(e.screen={settings:this.screen.screenVideoTrack.getSettings(),label:this.screen.screenVideoTrack.label,readyState:this.screen.screenVideoTrack.readyState}),this.screen.screenVideoSource&&(e.screenVideoSource={settings:this.screen.screenVideoSource.getSettings(),label:this.screen.screenVideoSource.label,readyState:this.screen.screenVideoSource.readyState}),this.screenAudio.screenAudioTrack&&(e.screenAudio={settings:this.screenAudio.screenAudioTrack.getSettings(),label:this.screenAudio.screenAudioTrack.label,readyState:this.screenAudio.screenAudioTrack.readyState}),this.screenAudio.screenAudioSource&&(e.screenAudioSource={settings:this.screenAudio.screenAudioSource.getSettings(),label:this.screenAudio.screenAudioSource.label,readyState:this.screenAudio.screenAudioSource.readyState}),S.Device.deviceHistory.audioOut[0]&&(e.audioOutDefault=S.Device.deviceHistory.audioOut[0])}catch(t){e.errName=t.name,e.errMessage=t.message}return e}updateStream(e,t){"audio"===e?(this.audio.micTrack=t,f.emptyStreamWith(this.audio.audioStream,t),this.stream._play.audio.dom&&(this.stream._play.audio.dom.srcObject=this.audio.audioStream)):"audioSlave"===e?(this.screenAudio.screenAudioTrack=t,f.emptyStreamWith(this.screenAudio.screenAudioStream,t),this.stream._play.audioSlave.dom&&(this.stream._play.audioSlave.dom.srcObject=this.screenAudio.screenAudioStream)):"video"===e?(this.video.cameraTrack=t,f.emptyStreamWith(this.video.videoStream,t),this.video.videoStream.getVideoTracks().length&&"string"==typeof this.video.encoderConfig.high.contentHint&&this.video.videoStream.getVideoTracks()[0].contentHint!==this.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.video.encoderConfig.high.contentHint),this.video.videoStream.getVideoTracks()[0].contentHint=this.video.encoderConfig.high.contentHint),this.stream._play.video.dom&&(this.stream._play.video.dom.srcObject=this.video.renderStream)):"screen"===e&&(this.screen.screenVideoTrack=t,f.emptyStreamWith(this.screen.screenVideoStream,t),this.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.screen.encoderConfig.high.contentHint&&this.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.screen.encoderConfig.high.contentHint),this.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.screen.encoderConfig.high.contentHint),this.stream._play.screen.dom&&(this.stream._play.screen.dom.srcObject=this.screen.renderStream))}stopStream(e){var t,r,n,i;let o="set_mic";"audio"===e?(null===(t=this.audio.micTrack)||void 0===t||t.stop(),this.audio.micTrack=null,f.emptyStreamWith(this.audio.micStream,null),this.audio.audioSource=null,f.emptyStreamWith(this.audio.audioSourceStream,null),this.updateWebAudio(),this.canDisableAudioRouting()&&this.disableAudioRouting()):"screenAudio"===e?(null===(r=this.screenAudio.screenAudioTrack)||void 0===r||r.stop(),this.screenAudio.screenAudioTrack=null,this.screenAudio.screenAudioSource=null,f.emptyStreamWith(this.screenAudio.screenAudioStream,null),o="pub_second_audio"):"video"===e?(o="set_camera",null===(n=this.video.cameraTrack)||void 0===n||n.stop(),this.video.cameraTrack=null,f.emptyStreamWith(this.video.videoStream,null)):"screen"===e&&(o="set_screen",null===(i=this.screen.screenVideoTrack)||void 0===i||i.stop(),this.screen.screenVideoTrack=null,f.emptyStreamWith(this.screen.screenVideoStream,null)),this.stream.client.apiEventReport("setFunction",{name:o,oper:"0",value:"success"})}_stopTrack(e){if(!e)return;if(this.stream.isRemote)return;this.logger.log("清除stream: ",e);const t=e.getTracks();this.logger.log("清除stream: ",...t),t&&0!==t.length&&t.forEach((t=>{if("audio"===t.kind){const e=T.getParameters().tracks.audio.findIndex((e=>t===e));y.Logger.warn(`Stopping AUDIOTRACK#${e} ${t.id}, ${t.label}, ${t.readyState}`)}else{const e=T.getParameters().tracks.video.findIndex((e=>t===e));y.Logger.warn(`Stopping VIDEOTRACK#${e} ${t.id}, ${t.label}, ${t.readyState}`)}t.stop(),e.removeTrack(t),this.audio.micTrack===t&&(this.audio.micTrack=null,this.audio.deviceInfo.mic={compatAudio:b.compatAudioInputList.enabled,label:""},this.updateWebAudio()),this.screenAudio.screenAudioTrack===t&&(this.screenAudio.screenAudioTrack=null,this.updateWebAudio()),this.video.cameraTrack===t&&(this.video.cameraTrack=null),this.screen.screenVideoTrack===t&&(this.screen.screenVideoTrack=null)}))}getAudioTrack(){var e;return null===(e=this.audio)||void 0===e?void 0:e.audioStream.getAudioTracks()[0]}getVideoTrack(){var e;return null===(e=this.video)||void 0===e?void 0:e.videoStream.getVideoTracks()[0]}setGain(e,t){this.audio.webAudio?(this.logger.log("setGain",e),this.audio.webAudio.setGain(e,t),this.canDisableAudioRouting()&&this.disableAudioRouting()):this.logger.log("setGain: 缺失本地音频")}getGain(){var e;return(null===(e=this.audio.webAudio)||void 0===e?void 0:e.getVolumeData())||"0.0"}canDisableAudioRouting(){var e;let t=!0;if(!this.audio.webAudio)return!1;if(null===(e=this.audio.stageAIProcessing)||void 0===e?void 0:e.enabled)return!1;this.audio.webAudio.mixAudioConf.state!==c.AuidoMixingState.PLAYED&&this.audio.webAudio.mixAudioConf.state!==c.AuidoMixingState.PAUSED||(t=!1),Object.values(this.audio.mixAudioConf.sounds).forEach((e=>{"STARTING"!==e.state&&"PLAYED"!==e.state&&"PAUSED"!==e.state||(t=!1)}));const r=this.audio.webAudio.getGainMin();return t&&1===r&&this.audio.webAudio.audioInArr.length<=1}_audioFilePlaybackCompletedEvent(){this.canDisableAudioRouting()&&this.disableAudioRouting()}startAudioMixing(e){let t,r;return this.logger.log("开始伴音:",JSON.stringify(e,null," ")),Object.assign(this.audio.mixAudioConf,e),this.audio.mixAudioConf.audioFilePath?0!==this.getAudioInputTracks().length&&this.stream.pubStatus.audio.audio?this.audio.webAudio&&this.audio.webAudio.context||(r="startAudioMixing() 浏览器环境不支持伴音",t=d.default.AUDIO_MIX_NO_SUPPORT):(r="startAudioMixing() 当前没有开启过麦克风",t=d.default.AUDIO_MIX_NO_AUDIO):(r="startAudioMixing() 没有设置云端文件路径",t=d.default.AUDIO_MIX_FILE_ERROR),t?(this.logger.error(r),this.stream.client.apiFrequencyControl({name:"startAudioMixing",code:-1,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:t}),null," ")}),Promise.reject(new p.default({code:t,message:r}))):(this.stream.client.apiFrequencyControl({name:"startAudioMixing",code:0,param:JSON.stringify(this.audio.mixAudioConf,null," ")}),this.audio.webAudio&&(this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource&&this.audio.webAudio.mixAudioConf.state===c.AuidoMixingState.PLAYED&&(this.logger.log("startAudioMixing() 当前已经开启伴音，先关闭之前的伴音"),this.stopAudioMixing()),this.audio.webAudio.mixAudioConf.state,c.AuidoMixingState.STARTING),this.audio.mixAudioConf.audioFilePath&&this.audio.mixAudioConf.audioBuffer[this.audio.mixAudioConf.audioFilePath]?(this.logger.log("startAudioMixing() 开始伴音, 已经加载过云端音乐"),this.startMix(this.audio.mixAudioConf.index)):(this.logger.log("startAudioMixing() 开始伴音, 先加载云端音乐"),this.loadRemoteAudioFile(this.audio.mixAudioConf.index)))}loadRemoteAudioFile(e){const t=this.audio.mixAudioConf.audioFilePath;return t?l.ajax({url:t,type:"GET",dataType:"arraybuffer"}).then((r=>(this.logger.log("loadRemoteAudioFile 加载云端音乐成功"),new Promise(((n,i)=>{var o,s;null===(s=null===(o=this.audio.webAudio)||void 0===o?void 0:o.context)||void 0===s||s.decodeAudioData(r,(r=>{var i;this.logger.log("loadRemoteAudioFile 云端音乐解码成功"),this.audio.mixAudioConf.audioBuffer[t]=r,null===(i=this.startMix(e))||void 0===i||i.then((e=>{n(e)}))}),(e=>{i(new p.default({code:d.default.AUDIO_MIX_FILE_ERROR,message:"loadRemoteAudioFile: 云端音乐解码失败: "+e.message}))}))}))))).catch((e=>Promise.reject(new p.default({code:d.default.AUDIO_MIX_FILE_ERROR,message:`loadRemoteAudioFile: 加载云端音乐失败: ${e.name} ${e.message}`})))):(this.logger.warn("loadRemoteAudioFile() audioFilePath未设置"),Promise.resolve())}startMix(e){var t;if(this.logger.log("startMix 开始混音:",JSON.stringify(this.audio.mixAudioConf)),e!==this.audio.mixAudioConf.index)return this.logger.log("startMix: 该次伴音已经取消"),Promise.resolve();this.audio.audioRoutingEnabled||this.enableAudioRouting();const{audioFilePath:r="",loopback:n=!1,replace:i=!1,cycle:o=0,playStartTime:s=0,volume:a=255,auidoMixingEnd:c=null}=this.audio.mixAudioConf;return null===(t=this.audio.webAudio)||void 0===t?void 0:t.startMix({buffer:this.audio.mixAudioConf.audioBuffer[r],loopback:n,replace:i,cycle:o,playStartTime:s,volume:a,auidoMixingEnd:c})}stopAudioMixing(e=!0){var t;return(null===(t=this.audio.webAudio)||void 0===t?void 0:t.mixAudioConf)&&this.audio.webAudio.mixAudioConf.audioSource?(this.stream.client.apiFrequencyControl({name:"stopAudioMixing",code:0,param:JSON.stringify(this.audio.mixAudioConf,null," ")}),this.audio.webAudio.stopAudioMixing(e)):(this.logger.error("stopAudioMixing() 当前没有开启伴音"),this.stream.client.apiFrequencyControl({name:"stopAudioMixing",code:-1,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:"stopAudioMixing() 当前没有开启伴音"}),null," ")}),Promise.reject(new p.default({code:d.default.AUDIO_MIX_NOT_STATE_ERROR,message:"stopAudioMixing() 当前没有开启伴音"})))}pauseAudioMixing(){var e;return(null===(e=this.audio.webAudio)||void 0===e?void 0:e.mixAudioConf)&&this.audio.webAudio.mixAudioConf.audioSource&&this.audio.webAudio.mixAudioConf.state===c.AuidoMixingState.PLAYED?(this.stream.client.apiFrequencyControl({name:"pauseAudioMixing",code:0,param:JSON.stringify(this.audio.mixAudioConf,null," ")}),this.audio.webAudio&&this.audio.webAudio.pauseAudioMixing()):(this.logger.error("pauseAudioMixing() 当前没有开启伴音"),this.stream.client.apiFrequencyControl({name:"pauseAudioMixing",code:-1,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:"pauseAudioMixing() 当前没有开启伴音"}),null," ")}),Promise.reject(new p.default({code:d.default.AUDIO_MIX_NOT_STATE_ERROR,message:"pauseAudioMixing() 当前没有开启伴音"})))}resumeAudioMixing(){var e;let t,r;if((null===(e=this.audio.webAudio)||void 0===e?void 0:e.mixAudioConf)&&this.audio.webAudio.mixAudioConf.audioSource?this.audio.webAudio.mixAudioConf.state!==c.AuidoMixingState.PAUSED&&(r="resumeAudioMixing() 当前没有暂停伴音",t=d.default.AUDIO_MIX_NOT_PAUSE):(r="resumeAudioMixing() 当前没有开启伴音",t=d.default.AUDIO_MIX_NOT_STATE_ERROR),this.stream.client.apiFrequencyControl({name:"resumeAudioMixing",code:t?-1:0,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:r||""}),null," ")}),t)return this.logger.error(r),Promise.reject(new p.default({code:t,message:r}));if(!this.audio.webAudio)return;let{audioFilePath:n="",loopback:i=!1,replace:o=!1,cycle:s=0,playStartTime:a=0,auidoMixingEnd:u=null}=this.audio.mixAudioConf,l=(this.audio.webAudio.mixAudioConf.pauseTime-this.audio.webAudio.mixAudioConf.startTime)/1e3+this.audio.webAudio.mixAudioConf.playStartTime;return l>this.audio.webAudio.mixAudioConf.totalTime&&(this.logger.log("播放过的圈数 playedCycle: ",Math.floor(l/this.audio.webAudio.mixAudioConf.totalTime)),s-=Math.floor(l/this.audio.webAudio.mixAudioConf.totalTime),this.audio.mixAudioConf.cycle=s),this.audio.webAudio.mixAudioConf.setPlayStartTime?(this.logger.log("暂停期间，用户设置混音播放时间: ",this.audio.webAudio.mixAudioConf.setPlayStartTime),a=this.audio.webAudio.mixAudioConf.setPlayStartTime,this.audio.webAudio.mixAudioConf.setPlayStartTime=0):(this.logger.log("恢复混音:",JSON.stringify(this.audio.webAudio.mixAudioConf)),this.logger.log("已经播放的时间: ",l),l>this.audio.webAudio.mixAudioConf.totalTime&&(l%=this.audio.webAudio.mixAudioConf.totalTime),a=l),this.logger.log("回复重置的时间点：",a),this.audio.webAudio.resumeAudioMixing({buffer:this.audio.mixAudioConf.audioBuffer[n],loopback:i,replace:o,cycle:s,playStartTime:a,auidoMixingEnd:u})}setAudioMixingVolume(e){var t;let r,n;return(null===(t=this.audio.webAudio)||void 0===t?void 0:t.mixAudioConf)&&this.audio.webAudio.mixAudioConf.audioSource?(!Number.isInteger(e)||e<0||e>255)&&(n="adjustAudioMixingVolume() volume应该是1-255的number类型",r=d.default.AUDIO_MIX_VOLUME_ERROR):(n="adjustAudioMixingVolume() 当前没有开启伴音",r=d.default.AUDIO_MIX_NOT_STATE_ERROR),this.stream.client.apiFrequencyControl({name:"adjustAudioMixingVolume",code:r?-1:0,param:JSON.stringify(Object.assign(this.audio.mixAudioConf,{reason:n||"",volume:e}),null," ")}),r?(this.logger.error(n),Promise.reject(new p.default({code:r,message:n}))):this.audio.webAudio&&this.audio.webAudio.setAudioMixingVolume(e)}setAudioMixingPlayTime(e){var t;let r,n;if((null===(t=this.audio.webAudio)||void 0===t?void 0:t.mixAudioConf)&&this.audio.webAudio.mixAudioConf.audioSource){if(e<0)n="setAudioMixingPosition(): 设置的playStartTime 小于 0 了",r=d.default.AUDIO_MIX_PLAY_START_TIME_ERROR;else if(e>=this.audio.webAudio.mixAudioConf.totalTime)n="setAudioMixingPosition(): 设置的playStartTime大于音频文件总时长了",r=d.default.AUDIO_MIX_PLAY_START_TIME_ERROR;else if(this.audio.webAudio.mixAudioConf.state===c.AuidoMixingState.PAUSED)return this.audio.webAudio.mixAudioConf.setPlayStartTime=e,this.logger.log("setAudioMixingPosition() 当前正在暂停，记录设置的播发位置，在恢复伴音时，跳转到此次设置的播放位置: ",e),Promise.resolve()}else n="setAudioMixingPosition(): 当前没有开启伴音",r=d.default.AUDIO_MIX_NOT_STATE_ERROR;return this.stream.client.apiFrequencyControl({name:"setAudioMixingPosition",code:r?-1:0,param:JSON.stringify({playTime:e,reason:n||""},null," ")}),r?(this.logger.error(n),Promise.reject(new p.default({code:r,message:n}))):new Promise(((t,r)=>{this.stopAudioMixing(!1).then((n=>{if(!this.audio.webAudio)return;this.audio.mixAudioConf.playStartTime=e;let{audioFilePath:i="",loopback:o=!1,replace:s=!1,cycle:a=0,playStartTime:c=0,auidoMixingEnd:u=null}=this.audio.mixAudioConf;this.logger.log("设置混音的播放位置:",this.audio.webAudio.mixAudioConf);let l=(Date.now()-this.audio.webAudio.mixAudioConf.startTime)/1e3+this.audio.webAudio.mixAudioConf.playStartTime;this.logger.log("已经播放的时间: ",l),l>this.audio.webAudio.mixAudioConf.totalTime&&(this.logger.log("播放过的圈数 playedCycle: ",Math.floor(l/this.audio.webAudio.mixAudioConf.totalTime)),a-=Math.floor(l/this.audio.webAudio.mixAudioConf.totalTime),this.audio.mixAudioConf.cycle=a),this.logger.log(`setAudioMixingPlayTime, playTime: ${e}, cycle: ${a}`),this.audio.webAudio.setAudioMixingPlayTime({buffer:this.audio.mixAudioConf.audioBuffer[i],loopback:o,replace:s,cycle:a,playStartTime:c,auidoMixingEnd:u}).then((r=>{this.stream.client.apiFrequencyControl({name:"setAudioMixingPosition",code:0,param:JSON.stringify({playTime:e},null," ")}),t(r)})).catch((t=>{this.stream.client.apiFrequencyControl({name:"setAudioMixingPosition",code:-1,param:JSON.stringify({playTime:e,reason:"重新播放伴音失败"+t.message},null," ")}),r(t)}))})).catch((t=>(this.stream.client.apiFrequencyControl({name:"setAudioMixingPosition",code:-1,param:JSON.stringify({playTime:e,reason:"暂停当前播放失败"+t.message},null," ")}),Promise.reject(t))))}))}getAudioMixingPlayedTime(){var e,t;return(null===(e=this.audio.webAudio)||void 0===e?void 0:e.mixAudioConf)&&this.audio.webAudio.mixAudioConf.audioSource?(this.stream.client.apiFrequencyControl({name:"getAudioMixingCurrentPosition",code:0,param:JSON.stringify({playTime:null===(t=this.audio.webAudio.getAudioMixingPlayedTime())||void 0===t?void 0:t.playedTime},null," ")}),this.audio.webAudio.getAudioMixingPlayedTime()):(this.logger.log("getAudioMixingCurrentPosition() 当前没有开启伴音"),Promise.reject(new p.default({code:d.default.AUDIO_MIX_NOT_STATE_ERROR,message:"getAudioMixingCurrentPosition() 当前没有开启伴音"})))}getAudioMixingTotalTime(){var e,t;return(null===(e=this.audio.webAudio)||void 0===e?void 0:e.mixAudioConf)&&this.audio.webAudio.mixAudioConf.audioSource?(this.stream.client.apiFrequencyControl({name:"getAudioMixingDuration",code:0,param:JSON.stringify({totalTime:null===(t=this.audio.webAudio.getAudioMixingTotalTime())||void 0===t?void 0:t.totalTime},null," ")}),this.audio.webAudio.getAudioMixingTotalTime()):(this.logger.log("getAudioMixingDuration() 当前没有开启伴音"),Promise.reject(new p.default({code:d.default.AUDIO_MIX_NOT_STATE_ERROR,message:"getAudioMixingDuration() 当前没有开启伴音"})))}isMixAuido(){return!!(this.audio.webAudio&&this.audio.webAudio.mixAudioConf&&this.audio.webAudio.mixAudioConf.audioSource)}_initSoundIfNotExists(e,t){this.audio.mixAudioConf.sounds[e]||(this.audio.mixAudioConf.sounds[e]={soundId:e,state:"UNSTART",filePath:t||"",volume:100,sourceNode:null,gainNode:null,cycle:1,playStartTime:0,playOverTime:0,pauseTime:0,startTime:0,totalTime:0,options:{}}),t&&(this.audio.mixAudioConf.sounds[e].filePath=t)}async playEffect(e,t){const{soundId:r,filePath:n,cycle:i=1}=e,o={tag:"Stream.playEffect:filePath",value:n};h.checkExists(o);const s={tag:"Stream.playEffect:soundId",value:r,min:1,max:1e4};h.isExistOptions(s).result&&h.checkValidInteger(s);const a={tag:"Stream.playEffect:cycle",value:i,min:1,max:1e4};if(h.isExistOptions(a).result&&h.checkValidInteger(a),this._initSoundIfNotExists(r,n),this.audio.audioRoutingEnabled||this.enableAudioRouting(),!this.audio.webAudio||!this.audio.webAudio.context)return this.logger.log("playEffect() 浏览器不支持"),Promise.reject(new p.default({code:d.default.AUDIO_EFFECT_NO_SUPPORT,message:"playEffect() 当前浏览器不支持音效功能"}));if(!this.audio.mixAudioConf.sounds[r]||"STARTING"!==this.audio.mixAudioConf.sounds[r].state&&"PLAYED"!==this.audio.mixAudioConf.sounds[r].state&&"PAUSED"!==this.audio.mixAudioConf.sounds[r].state){if(0===this.getAudioInputTracks().length||!this.stream.pubStatus.audio.audio)return Promise.reject(new p.default({code:d.default.AUDIO_EFFECT_NO_AUDIO,message:"playEffect() 当前没有开启麦克风，无法使用音效功能"}))}else if(this.logger.log(`pauseEffect: 该音效文件正处于: ${this.audio.mixAudioConf.sounds[r].state} 状态`),void 0===t)return Promise.reject(new p.default({code:d.default.AUDIO_EFFECT_ERROR,message:"playEffect() playStartTime 异常"}));this.audio.mixAudioConf.sounds[r].state="STARTING",this.audio.mixAudioConf.audioBuffer[n]?this.logger.log("playEffect: 已经 load 音效文件"):(this.logger.log("playEffect, 先 load 音效文件"),await this.preloadEffect(r,n));try{const o=this.audio.webAudio.createAudioBufferSource(this.audio.mixAudioConf.audioBuffer[n]);this.audio.mixAudioConf.sounds[r].sourceNode=o.sourceNode,o&&o.sourceNode&&(o.sourceNode.onended=e=>{this.stopEffect(r)}),this.audio.mixAudioConf.sounds[r].gainNode=o.gainNode,this.audio.mixAudioConf.sounds[r].totalTime=this.audio.mixAudioConf.audioBuffer[n]&&this.audio.mixAudioConf.audioBuffer[n].duration,this.audio.mixAudioConf.sounds[r].cycle=i;const s=this.audio.mixAudioConf.audioBuffer[n]&&this.audio.mixAudioConf.audioBuffer[n].duration;this.audio.mixAudioConf.sounds[r].playOverTime=s,i>1&&(this.audio.mixAudioConf.sounds[r].playOverTime=i*s-this.audio.mixAudioConf.sounds[r].playStartTime),this.audio.mixAudioConf.sounds[r].playStartTime=t||0,this.audio.webAudio.startAudioEffectMix(this.audio.mixAudioConf.sounds[r]),this.audio.mixAudioConf.sounds[r].state="PLAYED",this.audio.mixAudioConf.sounds[r].startTime=Date.now(),this.stream.client.apiFrequencyControl({name:"playEffect",code:0,param:JSON.stringify(e,null," ")})}catch(e){}}async stopEffect(e){var t;const r={tag:"Stream.stopEffect:soundId",value:e};let n,i;if(h.isExistOptions(r).result&&h.checkValidInteger(r),this.audio.mixAudioConf.sounds[e]||(i="pauseEffect() soundId找不到对应的音效文件",n=d.default.AUDIO_EFFECT_FILE_LOST_ERROR),n)throw new p.default({code:n,message:i});null===(t=this.audio.webAudio)||void 0===t||t.stopAudioEffectMix(this.audio.mixAudioConf.sounds[e]),this.audio.mixAudioConf.sounds[e].state="STOPED",this._audioFilePlaybackCompletedEvent(),this.stream.client.apiFrequencyControl({name:"stopEffect",code:0,param:JSON.stringify(e,null," ")})}async pauseEffect(e){const t={tag:"Stream.pauseEffect:soundId",value:e};let r,n;if(h.isExistOptions(t).result&&h.checkValidInteger(t),this.audio.mixAudioConf.sounds[e]){if("PAUSED"===this.audio.mixAudioConf.sounds[e].state)return void this.logger.log("pauseEffect: 已经暂停");"PLAYED"!==this.audio.mixAudioConf.sounds[e].state&&(this.logger.log("pauseEffect: 当前没有开启该音效"),n="pauseEffect() 当前没有开启该音效",r=d.default.AUDIO_EFFECT_NOT_STATE_ERROR)}else n="pauseEffect() soundId找不到对应的音效文件",r=d.default.AUDIO_EFFECT_FILE_LOST_ERROR;if(r)throw new p.default({code:r,message:n});if(!this.audio.webAudio)return;this.audio.webAudio.stopAudioEffectMix(this.audio.mixAudioConf.sounds[e]),this.audio.mixAudioConf.sounds[e].pauseTime=Date.now(),this.audio.mixAudioConf.sounds[e].state="PAUSED";let i=(this.audio.mixAudioConf.sounds[e].pauseTime-this.audio.mixAudioConf.sounds[e].startTime)/1e3+this.audio.mixAudioConf.sounds[e].playStartTime;this.logger.log("pauseEffect 已经播放的时间: ",i),i>this.audio.mixAudioConf.sounds[e].totalTime&&(i%=this.audio.mixAudioConf.sounds[e].totalTime),this.logger.log("pauseEffect 暂停位置: ",i),this.stream.client.apiFrequencyControl({name:"pauseEffect",code:0,param:JSON.stringify(e,null," ")})}async resumeEffect(e){const t={tag:"Stream.resumeEffect:soundId",value:e};let r,n;if(h.isExistOptions(t).result&&h.checkValidInteger(t),this.audio.mixAudioConf.sounds[e]?"PAUSED"!==this.audio.mixAudioConf.sounds[e].state&&(n="resumeEffect() 当前没有暂停该音效文件",r=d.default.AUDIO_EFFECT_NOT_PAUSE):(n="resumeEffect() soundId找不到对应的音效文件",r=d.default.AUDIO_EFFECT_FILE_LOST_ERROR),r)throw new p.default({code:r,message:n});if(!this.audio.webAudio)return;let i=(this.audio.mixAudioConf.sounds[e].pauseTime-this.audio.mixAudioConf.sounds[e].startTime)/1e3+this.audio.mixAudioConf.sounds[e].playStartTime;if(this.logger.log("resumeEffect 已经播放的时间: ",i),i>this.audio.mixAudioConf.sounds[e].totalTime){const t=Math.floor(i/this.audio.mixAudioConf.sounds[e].totalTime);this.logger.log("播放过的圈数 playedCycle: ",t),i%=this.audio.mixAudioConf.sounds[e].totalTime,this.audio.mixAudioConf.sounds[e].cycle=this.audio.mixAudioConf.sounds[e].cycle-t}this.audio.mixAudioConf.sounds[e].playOverTime=this.audio.mixAudioConf.sounds[e].totalTime,this.audio.mixAudioConf.sounds[e].cycle>1&&(this.audio.mixAudioConf.sounds[e].playOverTime=this.audio.mixAudioConf.sounds[e].cycle*this.audio.mixAudioConf.sounds[e].totalTime-this.audio.mixAudioConf.sounds[e].playStartTime),i>this.audio.mixAudioConf.sounds[e].totalTime&&(i%=this.audio.mixAudioConf.sounds[e].totalTime),this.audio.mixAudioConf.sounds[e].playStartTime=i,this.logger.log("resumeEffect 回复重置的时间点：",i),this.playEffect({soundId:e,filePath:this.audio.mixAudioConf.sounds[e].filePath,cycle:this.audio.mixAudioConf.sounds[e].cycle},i),this.audio.mixAudioConf.sounds[e].state="PLAYED",this.audio.mixAudioConf.sounds[e].startTime=Date.now(),this.stream.client.apiFrequencyControl({name:"resumeEffect",code:0,param:JSON.stringify(e,null," ")})}async setVolumeOfEffect(e,t){var r;const n={tag:"Stream.setVolumeOfEffect:soundId",value:e,min:1};if(h.isExistOptions(n).result&&h.checkValidInteger(n),!this.audio.mixAudioConf.sounds[e])throw new p.default({code:d.default.AUDIO_EFFECT_FILE_LOST_ERROR,message:"resumeEffect() soundId找不到对应的音效文件"});const i={tag:"Stream.setVolumeOfEffect:volume",value:t,min:0,max:100};h.isExistOptions(i).result&&h.checkValidInteger(i),this.logger.log(`setVolumeOfEffect 设置 ${e} 音效文件的音量: ${t}`),this._initSoundIfNotExists(e);const o=null===(r=this.audio.mixAudioConf.sounds[e])||void 0===r?void 0:r.gainNode;o?o.gain.value=t/100:this.logger.log("setVolumeOfEffect: no gainNode"),this.audio.mixAudioConf.sounds[e].volume=t,this.stream.client.apiFrequencyControl({name:"setVolumeOfEffect",code:0,param:JSON.stringify({soundId:e,volume:t},null," ")})}async preloadEffect(e,t){const r={tag:"Stream.preloadEffect:filePath",value:t};h.checkExists(r);const n={tag:"Stream.preloadEffect:soundId",value:e};if(h.isExistOptions(n).result&&h.checkValidInteger(n),this.logger.log(`preloadEffect 设置soundId: ${e}, 音效文件的filePath: ${t}`),this._initSoundIfNotExists(e,t),this.audio.audioRoutingEnabled||this.enableAudioRouting(),this.audio.mixAudioConf.audioBuffer[t])this.logger.log("preloadEffect: 已经 load 音效文件");else try{await this.loadAudioBuffer(t),this.stream.client.apiFrequencyControl({name:"preloadEffect",code:0,param:JSON.stringify({soundId:e,filePath:t},null," ")})}catch(e){throw this.logger.error("preloadEffect 错误: ",e.name,e.message),this.stream.client.apiFrequencyControl({name:"preloadEffect",code:-1,param:JSON.stringify({reason:e.message},null," ")}),e}}async unloadEffect(e){const t={tag:"Stream.unloadEffect:soundId",value:e,min:1};return h.isExistOptions(t).result&&h.checkValidInteger(t),this.logger.log(`unloadEffect() ${e} 音效文件`),this.audio.mixAudioConf.sounds[e]?"UNSTART"!==this.audio.mixAudioConf.sounds[e].state&&"STOPED"!==this.audio.mixAudioConf.sounds[e].state?(this.logger.log("unloadEffect() 该音效文件正在播放"),Promise.reject(new p.default({code:d.default.AUDIO_EFFECT_PLAY_ALREADY,message:"unloadEffect() 该音效文件正在播放"}))):(delete this.audio.mixAudioConf.audioBuffer[this.audio.mixAudioConf.sounds[e].filePath],delete this.audio.mixAudioConf.sounds[e],void this.stream.client.apiFrequencyControl({name:"unloadEffect",code:0,param:JSON.stringify({soundId:e},null," ")})):(this.logger.log("unloadEffect() 没有该音效文件"),Promise.reject(new p.default({code:d.default.AUDIO_EFFECT_FILE_LOST_ERROR,message:"unloadEffect() soundId找不到对应的音效文件"})))}getEffectsVolume(){this.logger.log("getEffectsVolume()");const e=[];return Object.values(this.audio.mixAudioConf.sounds).forEach((t=>{e.push({soundId:t.soundId,volume:t.volume})})),this.stream.client.apiFrequencyControl({name:"getEffectsVolume",code:0,param:JSON.stringify(e,null,2)}),e}setEffectsVolume(e){const t={tag:"Stream.setEffectsVolume:volume",value:e,min:0,max:100};h.isExistOptions(t).result&&h.checkValidInteger(t),this.logger.log("setEffectsVolume(), 设置音量: "+e),Object.values(this.audio.mixAudioConf.sounds).forEach((t=>{this.setVolumeOfEffect(t.soundId,e)})),this.stream.client.apiFrequencyControl({name:"setEffectsVolume",code:0,param:JSON.stringify({volume:e},null,2)})}async stopAllEffects(){this.logger.log("stopAllEffects()"),Object.values(this.audio.mixAudioConf.sounds).forEach((e=>{"PLAYED"!==e.state&&"PAUSED"!==e.state||this.stopEffect(e.soundId)})),this.stream.client.apiFrequencyControl({name:"stopAllEffects",code:0,param:JSON.stringify("stopAllEffects",null,2)})}async pauseAllEffects(){this.logger.log("pauseAllEffects()"),Object.values(this.audio.mixAudioConf.sounds).forEach((e=>{"PLAYED"===e.state&&this.pauseEffect(e.soundId)})),this.stream.client.apiFrequencyControl({name:"pauseAllEffects",code:0,param:JSON.stringify("pauseAllEffects",null,2)})}async resumeAllEffects(){this.logger.log("resumeAllEffects()"),Object.values(this.audio.mixAudioConf.sounds).forEach((e=>{"PAUSED"===e.state&&this.resumeEffect(e.soundId)})),this.stream.client.apiFrequencyControl({name:"resumeAllEffects",code:0,param:JSON.stringify("resumeAllEffects",null,2)})}getAudioEffectsTotalTime(e){const{soundId:t,filePath:r,cycle:n=1}=e;if(!this.audio.mixAudioConf||"{}"===JSON.stringify(this.audio.mixAudioConf.sounds))return this.logger.log("getAudioEffectsDuration: 当前没有音效文件"),Promise.resolve();let i;return this._initSoundIfNotExists(t,r),"PLAYED"===this.audio.mixAudioConf.sounds[t].state&&(i=this.audio.mixAudioConf.sounds[t].totalTime),this.stream.client.apiFrequencyControl({name:"getAudioEffectsDuration",code:0,param:JSON.stringify({totalTime:i},null," ")}),i}getAudioEffectsPlayedTime(e){const{soundId:t,filePath:r,cycle:n=1}=e;if(!this.audio.mixAudioConf||"{}"===JSON.stringify(this.audio.mixAudioConf.sounds))return this.logger.log("getAudioEffectsCurrentPosition() 当前没有音效文件"),Promise.resolve();this._initSoundIfNotExists(t,r);let i=Date.now();"PAUSED"==this.audio.mixAudioConf.sounds[t].state&&(this.logger.log("getAudioEffectsCurrentPosition() 当前是暂停状态"),i=this.audio.mixAudioConf.sounds[t].pauseTime);let o=(i-this.audio.mixAudioConf.sounds[t].startTime)/1e3+this.audio.mixAudioConf.sounds[t].playStartTime;return o>this.audio.mixAudioConf.sounds[t].totalTime&&(o%=this.audio.mixAudioConf.sounds[t].totalTime),this.stream.client.apiFrequencyControl({name:"getAudioEffectsCurrentPosition",code:0,param:JSON.stringify({playTime:o},null," ")}),{playedTime:o}}loadAudioBuffer(e){return l.ajax({url:e,type:"GET",dataType:"arraybuffer"}).then((t=>(this.logger.log("loadAudioBuffer 加载 audio file 成功"),new Promise(((r,n)=>{var i,o;null===(o=null===(i=this.audio.webAudio)||void 0===i?void 0:i.context)||void 0===o||o.decodeAudioData(t,(t=>{this.logger.log("loadAudioBuffer audio file 解码成功"),this.audio.mixAudioConf.audioBuffer[e]=t,r(t)}),(e=>{this.logger.log("loadAudioBuffer 云端音乐解码失败：",e.message),n(new p.default({code:d.default.AUDIO_EFFECT_FILE_ERROR,message:`loadAudioBuffer: 云端音乐解码失败: ${e.name} ${e.message}`}))}))}))))).catch((e=>(this.logger.log("loadAudioBuffer 加载云端音乐失败: ",e),Promise.reject(new p.default({code:d.default.AUDIO_EFFECT_FILE_ERROR,message:`loadAudioBuffer: 加载云端音乐失败: ${e.name} ${e.message}`})))))}getAudioInputTracks(){var e,t;let r=[];return"live"===(null===(e=this.audio.audioSource)||void 0===e?void 0:e.readyState)&&r.push(this.audio.audioSource),"live"===(null===(t=this.audio.micTrack)||void 0===t?void 0:t.readyState)&&r.push(this.audio.micTrack),r}getAudioSlaveInputTracks(){var e,t;let r=[];return"live"===(null===(e=this.screenAudio.screenAudioTrack)||void 0===e?void 0:e.readyState)&&r.push(this.screenAudio.screenAudioTrack),"live"===(null===(t=this.screenAudio.screenAudioSource)||void 0===t?void 0:t.readyState)&&r.push(this.screenAudio.screenAudioSource),r}enableAudioRouting(){if(this.audio.webAudio&&this.audio.webAudio.destination){this.audio.audioRoutingEnabled=!0;const e=this.audio.webAudio.destination.stream.getAudioTracks()[0];this.logger.log("enableAudioRouting: ",e.label);const t=this.audio.audioStream.getAudioTracks()[0];t&&(e.enabled=t.enabled,t.enabled=!0),f.emptyStreamWith(this.audio.audioStream,e),this.stream.audioLevelHelper&&this.stream.audioLevelHelper.updateStream(this.audio.audioStream),this.updateAudioSender(e)}else this.logger.log("enableAudioRouting: 已替换为Destination")}disableAudioRouting(){const e=this.getAudioInputTracks();if(e.length){1===e.length?this.logger.log("disableAudioRouting: ",e[0].label):this.logger.warn("disableAudioRouting: 仍然有多于一个输入",...e);const t=this.audio.audioStream.getAudioTracks()[0];f.emptyStreamWith(this.audio.audioStream,e[0]),e[0].enabled=t.enabled,t.enabled=!0,this.updateAudioSender(e[0])}else this.logger.log("disableAudioRouting quiet."),f.emptyStreamWith(this.audio.audioStream,null);this.audio.audioRoutingEnabled=!1}updateAudioSender(e){var t,r,n,i,o,s,a,c,u,l,d,p,m,f,h,g,v;if(this.stream.isRemote)throw new Error("updateAudioSender only for localStream");if(null===(r=null===(t=this.stream.getAdapterRef())||void 0===t?void 0:t._mediasoup)||void 0===r?void 0:r._micProducer)if(null===(o=null===(i=null===(n=this.stream.getAdapterRef())||void 0===n?void 0:n._mediasoup)||void 0===i?void 0:i._micProducer)||void 0===o?void 0:o._rtpSender)this.logger.info("updateAudioSender: 替换当前_micProducer的track",e.label),null===(u=null===(c=null===(a=null===(s=this.stream.getAdapterRef())||void 0===s?void 0:s._mediasoup)||void 0===a?void 0:a._micProducer)||void 0===c?void 0:c._rtpSender)||void 0===u||u.replaceTrack(e);else if(null===(m=null===(p=null===(d=null===(l=this.stream.getAdapterRef())||void 0===l?void 0:l._mediasoup)||void 0===d?void 0:d._sendTransport)||void 0===p?void 0:p.handler)||void 0===m?void 0:m._pc){const t=null===(g=null===(h=null===(f=this.stream.getAdapterRef())||void 0===f?void 0:f._mediasoup)||void 0===h?void 0:h._sendTransport)||void 0===g?void 0:g.handler._pc.audioSender;t&&(this.logger.info("updateAudioSender: 替换audioSender",null===(v=null==t?void 0:t.track)||void 0===v?void 0:v.label),t.replaceTrack(e))}}enablePreProcessing(e,t){_.enablePreProcessing(this,e,t)}disablePreProcessing(e,t=!1){_.disablePreProcessing(this,e,t)}canDisablePreProcessing(e){return _.canDisablePreProcessing(this,e)}getPreprocessingStats(e="video"){var t;const r=null===(t=this[e].preProcessing)||void 0===t?void 0:t.history;if(!(null==r?void 0:r.length))return null;const n=r[r.length-1].endTs-r[0].startTs,i={total:0};for(let e=0;e<r.length;e++){i.total+=r[e].endTs-r[e].startTs;for(let t of r[e].handlerTs)t.spent>0&&(i[t.name]||(i[t.name]=0),i[t.name]+=t.spent)}return{fps:1e3*r.length/n,load:i.total/n,delay:i.total/r.length,spent:i}}destroy(){this.logger.log("清除 meida"),this._reset()}}t.MediaHelper=x},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.StageAIProcessing=void 0;const n=r(158),i=r(278);class o extends n.StageBase{constructor(e,t){super(e),this.type="stageAIProcessing",this.node=null,this.audioWorkletAgent=null,this.AIDenoise=null,this.enableAIDenoise=!0,this.pluginList=[],this.logger=t,this.enabled=!1}hasPlugin(e){return-1!==this.pluginList.indexOf(e)}registerPlugin(e,t,r){"AIDenoise"===e&&(this.registerAIDenoisePlugin(t,r),this.pluginList.push("AIDenoise"))}registerAIDenoisePlugin(e,t){this.AIDenoise=e}async init(){var e;this.state="INITING",this.audioWorkletAgent||(this.audioWorkletAgent=new i.AudioWorkletAgent({logger:this.logger,context:this.context}),this.node=this.audioWorkletAgent.node,await this.audioWorkletAgent.init(),this.audioWorkletAgent.on("rawinputs",(e=>{this.enabled&&this.AIDenoise&&this.AIDenoise.load&&this.AIDenoise.process(e.inputs[0],(t=>{t.length&&(e.inputs[0]=t),this.audioWorkletAgent.outputData(e.inputs[0])}))}))),null===(e=this.AIDenoise)||void 0===e||e.init(),this.state="INITED"}unregisterAIDenoise(){this.AIDenoise&&(this.AIDenoise.destroy(),this.AIDenoise=null),this.state="UNINIT"}}t.StageAIProcessing=o},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Play=void 0;const i=r(10),o=r(64),s=n(r(12)),a=n(r(13)),c=r(140),u=r(57),l=r(4),d=r(281),p=r(282),m=r(283),f=r(123);class h extends i.EventEmitter{constructor(e){super(),this.snapshotIndex=0,this.sinkId=null,this.audio={normalizedVolume:1,dom:null},this.audioSlave={normalizedVolume:1,dom:null},this.mask={enabled:!1},this.stream=e.stream,this.logger=e.stream.logger.getChild((()=>{var e,t;let r="player";return(null===(e=this.audio.dom)||void 0===e?void 0:e.paused)&&(r+=" audio_paused"),(null===(t=this.audioSlave.dom)||void 0===t?void 0:t.paused)&&(r+=" audioSlave_paused"),this.stream._play!==this&&(r+=" DETACHED"),r})),this.video={dom:null,containerDom:null,view:null,size:{width:0,height:0},canvasWatermark:d.createCanvasWatermarkControl(this.logger),encoderWatermark:p.createEncoderWatermarkControl(this.logger),frameData:{canvas:null,context:null},renderMode:{width:0,height:0,cut:!1}},this.screen={dom:null,containerDom:null,view:null,size:{width:0,height:0},canvasWatermark:d.createCanvasWatermarkControl(this.logger),encoderWatermark:p.createEncoderWatermarkControl(this.logger),frameData:{canvas:null,context:null},renderMode:{width:0,height:0,cut:!1}}}_initDomAndView(e){const t=this[e];if(t.view){if(!t.containerDom){const r=document.createElement("div");t.containerDom=r,t.containerDom.className=`nertc-${e}-container nertc-${e}-container-${this.stream.isRemote?"remote":"local"}`,r.style.overflow="hidden",r.style.position="relative",r.style.width=t.view.clientWidth+"px",r.style.height=t.view.clientHeight+"px",r.style.display="inline-block"}if(!t.dom){const r=document.createElement("video");t.dom=r,r.style.position="absolute",r.style.left="50%",r.style.top="50%",r.style.transform="translate(-50%,-50%)",r.setAttribute("x-webkit-airplay","x-webkit-airplay"),r.setAttribute("playsinline","playsinline"),r.setAttribute("webkit-playsinline","webkit-playsinline"),r.preload="auto",r.dataset.uid=""+this.stream.getId(),r.autoplay=!0,r.muted=!0,t.size.width=0,t.size.height=0,l.getParameters().controlOnPaused&&(r.addEventListener("pause",this.showControlIfVideoPause.bind(this)),r.addEventListener("play",this.handleVideoScreenPlay.bind(this)),r.addEventListener("click",this.handleVideoScreenClick.bind(this))),r.addEventListener("resize",(n=>{if(!this[e].dom||this[e].dom!==r||this[e].dom!==n.target)return;const i=r.videoWidth,o=r.videoHeight;i>2&&o>2&&this.stream.isRemote&&this.stream.client.adapterRef.state.videoResizeTime<this.stream.client.adapterRef.state.signalJoinSuccessTime&&(this.stream.client.adapterRef.state.videoResizeTime=Date.now()),i===t.size.width&&o===t.size.height||(this.logger.log(`[Play] 主流视频分辨率发生变化：${t.size.width}x${t.size.height} => ${i}x${o}。当前父节点：${u.getDomInfo(t.view)}`),i>o&&t.size.width>t.size.height||i<o&&t.size.width<t.size.height||this.setRender(e),t.size.width=i,t.size.height=o)}))}t.containerDom==t.dom.parentNode?this.logger.log("[Play] initVideoNode: 节点已挂载，请勿重复挂载"):(t.containerDom.appendChild(t.dom),this.logger.log("[Play] initVideoNode "+e)),t.view==t.containerDom.parentNode?this.logger.log("[Play] mountVideoToDom: 节点已挂载，请勿重复挂载"):(this.logger.log("[Play] mountVideoToDom"),t.view.appendChild(t.containerDom),this.logger.log("[Play] 视频主流dom节点挂载成功。父节点："+u.getDomInfo(t.view)),t.canvasWatermark.watermarks.length?t.canvasWatermark.start(t.containerDom):t.canvasWatermark.div=t.containerDom)}}showControlIfVideoPause(){o.MediaTypeList.forEach((e=>{const t=this[e].dom;(null==t?void 0:t.paused)&&this.logger.log("[Play] 可能遇到了播放问题",e)}))}handleVideoScreenClick(){o.MediaTypeList.forEach((e=>{const t=this[e].dom;(null==t?void 0:t.paused)&&(this.logger.log("[Play] 侦测到视频点击，尝试恢复播放:"+e),t.play())}))}handleVideoScreenPlay(){o.MediaTypeList.forEach((e=>{const t=this[e].dom;!1===(null==t?void 0:t.paused)&&this.logger.log("[Play] 侦测到播放: "+e)}))}isPlaying(e){let t=this[e].dom;if(!t)return!1;if(!t.srcObject)return!1;if(t.paused)return!1;if(4!==t.readyState)return!1;{let r=t.srcObject.getTracks()[0];if(!r)return!1;if(!r.enabled)return!1;if(r.muted)return!1;if("audio"===e||"audioSlave"===e){if(t.muted)return!1;if(0===t.volume)return!1}}return!0}canPlay(e){const t={result:!1,reason:""},r=this.stream.mediaHelper.getTrackByMediaType(e),n=this[e].dom;return r?"ended"===r.readyState?t.reason="ENDED":r.muted||!r.enabled?t.reason="MUTED":n&&n.srcObject?n.paused?"audio"===r.kind?t.result=!0:t.reason="PAUSED":t.reason="PLAYING":t.result=!0:this.stream.isRemote?this.stream.pubStatus[e].producerId?this.stream.pubStatus[e].consumerId?"end"!==this.stream.pubStatus[e].consumerStatus?t.reason="CONSUME_"+this.stream.pubStatus[e].consumerStatus:t.reason="INVALID_STATE":t.reason="NOT_SUBSCRIBED":t.reason="NOT_PUBLISHED":t.reason="NOT_OPENED",t}async resume(){const e=[];o.MediaTypeList.forEach((t=>{const r=this[t].dom;if(null==r?void 0:r.paused){const n=r.play();e.push(n),n.then((()=>{this.logger.log(`[Resume] 恢复播放: ${t} 成功`)})),n.catch((e=>{if(this.logger.error(`[Resume] 恢复播放 ${t} 出现问题:`,e.name,e.message),"notAllowedError"===e.name||"NotAllowedError"===e.name)throw new a.default({code:s.default.AUTO_PLAY_NOT_ALLOWED,url:"https://doc.yunxin.163.com/docs/jcyOTA0ODM/jM3NDE0NTI?platformId=50082",message:"resume: 浏览器自动播放受限: "+e.name})}))}}));try{await Promise.all(e)}catch(e){}}updatePlaybackVolume(){o.MediaTypeListAudio.forEach((e=>{const t=this[e].dom;if(t){let r;r=this.stream.isRemote?this.stream.client.adapterRef.nomalizedPlaybackVolume*this[e].normalizedVolume:this[e].normalizedVolume,Math.abs(t.volume-r)>.01&&(this.logger.log(`updatePlaybackVolume ${e} ${t.volume} => ${r} ( ${this.stream.client.adapterRef.nomalizedPlaybackVolume} * ${this[e].normalizedVolume})`),t.volume=r)}}))}async playAudioStream(e,t,r){const n=this[e];n.dom||(n.dom=document.createElement("audio"));const i=n.dom;if(i.muted="boolean"==typeof r&&r,i.srcObject=t,this.updatePlaybackVolume(),this.sinkId){this.logger.log(`[Play ${e}] 音频尝试使用输出设备`,this.sinkId);try{await i.setSinkId(this.sinkId),this.logger.log(`[Play] ${e} 音频使用输出设备成功`,this.sinkId)}catch(e){this.logger.error("[Play] 音频输出设备切换失败",e.name,e.message,e)}}try{await m.playMedia(i,l.getParameters().playMediaTimeout),this.logger.log("[Play] 播放音频完成，当前播放状态:",i.played.length),this.stream.client.updateRecordingAudioStream(),this.stream.client.apiEventReport("setFunction",{name:`set_${e}_play`,oper:"1",value:JSON.stringify({result:"success",streamUid:this.stream.stringStreamID,muted:i.muted,active:i.srcObject.active,played:i.played.length},null," ")})}catch(t){if(this.logger.warn(`[Play ${e}] 播放音频出现问题: `,t.name,t.message,t),this.stream.client.apiEventReport("setFunction",{name:`set_${e}_play`,oper:"1",value:JSON.stringify({result:"fail",reason:`${t.name} + ${t.message}`,uid:this.stream.stringStreamID,muted:i.muted,active:i.srcObject.active,played:i.played.length},null," ")}),"notAllowedError"===t.name||"NotAllowedError"===t.name)throw new a.default({code:s.default.AUTO_PLAY_NOT_ALLOWED,url:"https://doc.yunxin.163.com/docs/jcyOTA0ODM/jM3NDE0NTI?platformId=50082",message:`playStream ${e}: 浏览器自动播放受限: ${t.name}`})}}setPlayVolume(e,t){this[e].normalizedVolume=t,this.updatePlaybackVolume()}async playVideoStream(e,t,r){var n,i,o;const c=this[e];if((null===(n=c.dom)||void 0===n?void 0:n.srcObject)!==t){c.view=r,this._initDomAndView(e),this.mask.enabled&&this.enableMask();try{const r=t.getVideoTracks()[0];r?this.logger.log(`[Play] 开始加载 ${e} 播放视频源：视频参数 "${r.label}",enabled ${r.enabled} , ${JSON.stringify(r.getSettings())}`):this.logger.error(`[Play ${e}] 加载播放视频源失败：没有视频源`);const n=c.dom;if(!n)return;n.srcObject=t,this.stream.isRemote&&this.stream.client.adapterRef.state.domVideoAppendTime<this.stream.client.adapterRef.state.signalJoinSuccessTime&&(this.stream.client.adapterRef.state.domVideoAppendTime=Date.now()),await m.playMedia(n,l.getParameters().playMediaTimeout),this.logger.log(`[Play] 成功加载主流播放视频源：当前视频实际分辨率${n.videoWidth}x${n.videoHeight}，显示宽高${n.offsetWidth}x${n.offsetHeight}`),this.stream.client.apiEventReport("setFunction",{name:`set_${e}_play`,oper:"1",value:JSON.stringify({result:"success",uid:this.stream.stringStreamID,muted:n.muted,active:n.srcObject.active,played:n.played.length},null," ")}),n.paused&&l.getParameters().controlOnPaused&&this.showControlIfVideoPause()}catch(r){if(this.logger.warn(`[Play ${e}] 播放视频出现问题:`,r.name,r.message,r),this.stream.client.apiEventReport("setFunction",{name:`set_${e}_play`,oper:"1",value:JSON.stringify({result:"fail",reason:`${r.name} + ${r.message}`,uid:this.stream.stringStreamID,muted:null===(i=null==c?void 0:c.dom)||void 0===i?void 0:i.muted,active:t.active,played:null===(o=null==c?void 0:c.dom)||void 0===o?void 0:o.played.length},null," ")}),"notAllowedError"===r.name||"NotAllowedError"===r.name)throw new a.default({code:s.default.AUTO_PLAY_NOT_ALLOWED,url:"https://doc.yunxin.163.com/docs/jcyOTA0ODM/jM3NDE0NTI?platformId=50082",message:"playVideoStream: 浏览器自动播放受限: "+r.name})}}else this.logger.log(`[Play ${e}] playVideoStream: 跳过重复的播放请求`)}async stopPlayStream(e){"audio"===e||"audioSlave"===e?this._stopPlayAudioStream(e):"video"!==e&&"screen"!==e||this._stopPlayVideoStream(e)}async _stopPlayAudioStream(e){const t=this[e].dom;t&&(t.muted=!0,t.srcObject=null,this.stream.client.apiEventReport("setFunction",{name:`set_${e}_play`,oper:"0",value:JSON.stringify({result:"success",uid:this.stream.stringStreamID,muted:t.muted},null," ")}))}async _stopPlayVideoStream(e){this.logger.log("stopPlayVideoStream 停止播放 "+e);const t=this[e].view,r=this[e].containerDom,n=this[e].dom;if(r&&n){r===n.parentNode?(this.logger.log(`清除 ${e} dom`),r.removeChild(n)):r.lastChild&&(this.logger.log("videoContainerDom 删除子节点"),r.removeChild(r.lastChild));try{n.remove(),n.srcObject=null,this[e].dom=null,this.stream.client.apiEventReport("setFunction",{name:`set_${e}_play`,oper:"0",value:JSON.stringify({result:"success",uid:this.stream.stringStreamID},null," ")})}catch(t){this.logger.log("stopPlayVideoStream e: ",t),this.stream.client.apiEventReport("setFunction",{name:`set_${e}_play`,oper:"0",value:JSON.stringify({result:"failed",uid:this.stream.stringStreamID,reason:t.message},null," ")})}}t&&r&&(t==r.parentNode?(this.logger.log(`清除 ${e} containerDom`),t.removeChild(r)):t.lastChild&&(this.logger.log(e+" View 删除子节点"),t.removeChild(t.lastChild),t.innerHTML=""),this[e].containerDom=null,this[e].view=null)}setRender(e,t){var r,n,i,o;const s=this[e],a=s.containerDom,c=s.dom;if(t?(this.logger.log(`[Play ${e}] setRender() options: ${JSON.stringify(t)}`),s.renderMode=Object.assign({},t)):(t=s.renderMode,this.logger.log("[Play] setVideoRender() existing videoRenderMode: "+JSON.stringify(t))),a&&c)return a.style.width=t.width+"px",a.style.height=t.height+"px",t.cut?(c.videoWidth/c.videoHeight>t.width/t.height?(c.style.width="auto",c.style.height="100%"):(c.style.width="100%",c.style.height="auto"),void this.stream.client.apiEventReport("setFunction",{name:"set_render_"+e,oper:"1",value:JSON.stringify({result:"success",uid:this.stream.stringStreamID,played:c.played.length,domStyleWidth:c.style.width,domStyleHeight:c.style.height,containerDomWidth:null===(n=null===(r=s.containerDom)||void 0===r?void 0:r.style)||void 0===n?void 0:n.width,containerDomHeight:null===(o=null===(i=s.containerDom)||void 0===i?void 0:i.style)||void 0===o?void 0:o.height},null," ")})):(c.style.height="100%",void(c.style.width="100%"))}async setAudioOutput(e){this.sinkId=e;for(let t of o.MediaTypeListAudio){const r=this[t].dom;(null==r?void 0:r.srcObject)&&r.srcObject.getAudioTracks().length&&(await r.setSinkId(e),this.logger.log("[Play] setAudioOutput() 设置通话音频输出设备成功"))}}async takeSnapshot(e,t,r){if(this.mask.enabled)return this.logger.warn("takeSnapshot: 目前在打码状态"),null;let n=new c.RTCCanvas("canvas"),i=n._canvas,o=n._ctx;if(!o||!i)throw this.logger.error("takeSnapshot() 浏览器环境不支持"),new a.default({code:s.default.STREAM_TAKE_SNAPSHOT_NO_CANVAS_ERROR,message:"takeSnapshot() 浏览器环境不支持"});const u=["video","screen"];let l="";for(let s of u)if(!e.mediaType&&this[s].dom||e.mediaType===s){const a=e.name||(r||this.stream.getId())+"-"+this.snapshotIndex++;o.fillStyle="#ffffff";const c=this[s].dom;if(!c)return;o.fillRect(0,0,c.videoWidth,c.videoHeight),n.setSize(c.videoWidth,c.videoHeight),o.drawImage(c,0,0,c.videoWidth,c.videoHeight,0,0,c.videoWidth,c.videoHeight),"download"===t?l=await new Promise(((e,t)=>{i.toBlob((t=>{this.logger.log("takeSnapshot() 获取到截图的blob: ",t);let r=URL.createObjectURL(t),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=r,n.download=a+".png",n.click(),window.URL.revokeObjectURL(r),e(a+".png")}))})):"base64"===t&&(l=this.getBase64Image(i))}return n.destroy(),l}_initFrameDataCanvas(e){const t=this[e].frameData;return t.canvas||(this.logger.log("正在初始化 frameData.canvas "+e),t.canvas=document.createElement("canvas"),t.context=f.get2DContext(t.canvas,{willReadFrequently:!0})),t.context}getCurrentFrameData(e){if(this.mask.enabled)return this.logger.error("getCurrentFrameData: 当前在打码状态"),null;let t,r,n;if(n=e.mediaType&&"video"!==e.mediaType?"screen":"video",r=this[n].dom,t=this[n].frameData,!r)return this.logger.error("getCurrentFrameData: Playing Video is not found"),null;r.paused&&this.logger.warn("getCurrentFrameData: 目前数据源不在播放状态，截图结果可能不是最新。"),t.canvas||this._initFrameDataCanvas(n);const i=t.canvas,o=t.context;if(!o||!i)throw new a.default({code:s.default.STREAM_TAKE_SNAPSHOT_NO_CANVAS_ERROR,message:"getCurrentFrameData() 浏览器环境不支持"});const c=r.videoWidth,u=r.videoHeight;if(!c||!u)return null;let l,d;return e.width&&e.width>0?e.height&&e.height>0?(l=e.width,d=e.height):(l=e.width,d=Math.floor(e.width/c*u)):e.height&&e.height>0?(d=e.height,l=Math.floor(e.height/u*c)):(l=c,d=u),i.width!==l&&(i.width=l),i.height!==d&&(i.height=d),o.drawImage(r,0,0,l,d),o.getImageData(0,0,l,d)}getBase64Image(e){return e.toDataURL("image/",1)}enableMask(){this.mask.enabled=!0,this.video.dom&&(this.video.dom.style.filter="blur(20px)")}disableMask(){this.mask.enabled=!1,this.video.dom&&(this.video.dom.style.filter=""),this.screen.dom&&(this.screen.dom.style.filter="")}destroy(){o.MediaTypeList.forEach((e=>{this.stopPlayStream(e)}))}}t.Play=h},function(e,t,r){var n;!function(i){var o,s,a,c=(o=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|'[^']*'|'[^']*'/g,s=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,function(e,t,r,n){if(1!==arguments.length||"string"!==function(e){return null===e?"null":void 0===e?"undefined":"object"!=typeof e?typeof e:Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var i=(t=String(c.masks[t]||t||c.masks.default)).slice(0,4);"UTC:"!==i&&"GMT:"!==i||(t=t.slice(4),r=!0,"GMT:"===i&&(n=!0));var l=r?"getUTC":"get",d=e[l+"Date"](),p=e[l+"Day"](),m=e[l+"Month"](),f=e[l+"FullYear"](),h=e[l+"Hours"](),g=e[l+"Minutes"](),v=e[l+"Seconds"](),y=e[l+"Milliseconds"](),b=r?0:e.getTimezoneOffset(),S=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=t.getTimezoneOffset()-r.getTimezoneOffset();t.setHours(t.getHours()-n);var i=(t-r)/6048e5;return 1+Math.floor(i)}(e),T=function(e){var t=e.getDay();return 0===t&&(t=7),t}(e),_={d:d,dd:u(d),ddd:c.i18n.dayNames[p],dddd:c.i18n.dayNames[p+7],m:m+1,mm:u(m+1),mmm:c.i18n.monthNames[m],mmmm:c.i18n.monthNames[m+12],yy:String(f).slice(2),yyyy:f,h:h%12||12,hh:u(h%12||12),H:h,HH:u(h),M:g,MM:u(g),s:v,ss:u(v),l:u(y,3),L:u(Math.round(y/10)),t:h<12?"a":"p",tt:h<12?"am":"pm",T:h<12?"A":"P",TT:h<12?"AM":"PM",Z:n?"GMT":r?"UTC":(String(e).match(s)||[""]).pop().replace(a,""),o:(b>0?"-":"+")+u(100*Math.floor(Math.abs(b)/60)+Math.abs(b)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10],W:S,N:T};return t.replace(o,(function(e){return e in _?_[e]:e.slice(1,e.length-1)}))});function u(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}c.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},c.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},void 0===(n=function(){return c}.call(t,r,t,e))||(e.exports=n)}()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.measureText=t.numberToRGBA=void 0,t.numberToRGBA=function(e){if(0===e)return"rgba(0,0,0,0)";let t,r,n,i;return n=e%256,r=(e=Math.floor(e/256))%256,t=(e=Math.floor(e/256))%256,i=(e=Math.floor(e/256))>0?(e%256/256).toFixed(2):1,`rgba(${t}, ${r}, ${n}, ${i})`},t.measureText=function(e,t,r){if(!e)return{width:0,height:0};let n=document.createElement("div"),i=document.createElement("span");i.innerText=e,i.style.fontSize=t,i.style.fontFamily=r,n.style.opacity="0",n.style.position="absolute",n.style.height=t,document.body.appendChild(n),n.appendChild(i);const o=n.clientHeight,s=i.offsetWidth;return n.remove(),{width:s,height:o}}},function(e,t,r){var n=o(r(60)),i=o(r(61));function o(e){return e&&e.__esModule?e:{default:e}}var s=r(168).EventEmitter,a=r(145);e.exports=class extends s{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new a("EnhancedEventEmitter")}safeEmit(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}safeEmitAsPromise(e){for(var t=this,r=arguments.length,o=Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return(0,i.default)(n.default.mark((function r(){return n.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){t.safeEmit.apply(t,[e].concat(o,[r,n]))})));case 1:case"end":return r.stop()}}),r,t)})))()}}},function(e,t,r){var n,i=(n=r(103))&&n.__esModule?n:{default:n},o=r(145),s=r(289).generateRandomNumber,a=r(119).JSONBigParse,c=new o("Message");e.exports=class{static parse(e){var t=void 0,r={};try{t=a(e)}catch(e){return void c.error("parse() | invalid JSONbig: %s",e)}if("object"===(void 0===t?"undefined":(0,i.default)(t))&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void c.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void c.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void c.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void c.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void c.error("parse() | missing/invalid method field");r.id=t.id,r.method=t.method,r.data=t.data||{}}return r}c.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:s(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(70),o=r(69);let s=window;const a={setLogLevel(e){n.getParameters().logLevel!==e&&(o.getDefaultLogger().info(`NERTC LogLevel was changed: ${i.loglevelMap[n.getParameters().logLevel]} => ${i.loglevelMap[e]}`),n.getParameters().logLevel=e)},enableLogUpload(){s.logUpload=!0},disableLogUpload(){s.logUpload=!1}};"on"===n.getParameters().forceLogUpload?a.enableLogUpload():a.disableLogUpload(),t.default=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AdvBeautyFilter=t.resSet=void 0;const n=r(159),i=r(131),o=r(132),s=r(116),a=r(304),c=r(305),u=r(306),l=r(307),d=r(133),p=r(308),m=r(134);t.resSet={faceMask:"https://yx-web-nosdn.netease.im/common/6947be5d3e5604368401950ca0cf094d/facemask-01.png",eyeTeethMask:"https://yx-web-nosdn.netease.im/common/655421269305cac5c1e48d62f0fac8de/eye-teeth-mask-02.png",teethWhiten:"https://yx-web-nosdn.netease.im/common/ca8a6b0be3427ead9b19bcf9ae1245a8/teath.png"};const f={genTopFace(e){const t=p.Vector2.getVec(e,49),r=p.Vector2.getVec(e,43);let n=p.Vector2.sub(r,t),i=1.5*n.length;n=p.Vector2.normalize(n);const o=p.Vector2.sub(p.Vector2.getVec(e,0),r);let s=o.length;const a=p.Vector2.sub(p.Vector2.getVec(e,32),r);let c=a.length;const u=Math.max(s,c);let l=s/u,d=c/u;p.Vector2.setPoint(e,116,p.Vector2.add(r,p.Vector2.scale(n,i)));let m=p.Vector2.angle(o,n),f=p.Matrix3x3.rotate(m/-6,0,0),h=n;[110,109,108,107,106].forEach(((t,n)=>{h=f.multiplyVector(h);const o=(n+1)/7,a=1*(1-o)+l*o;p.Vector2.setPoint(e,t,p.Vector2.add(r,p.Vector2.scale(h,i*a*(1-o)+s*o)))})),m=p.Vector2.angle(a,n),f=p.Matrix3x3.rotate(m/6,0,0),h=n,[115,114,113,112,111].forEach(((t,n)=>{h=f.multiplyVector(h);const o=(n+1)/7,s=1*(1-o)+d*o;p.Vector2.setPoint(e,t,p.Vector2.add(r,p.Vector2.scale(h,i*s*(1-o)+c*o)))}))},genFaceOutline(e){const t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,106,107,108,109,110,111,112,113,114,115,116],r=p.Vector2.getVec(e,43);for(let n=0;n<t.length;n++){const i=t[n],o=p.Vector2.getVec(e,i),s=p.Vector2.add(r,p.Vector2.scale(p.Vector2.sub(o,r),1.3)),a=2*(117+n);e[a]=s.value[0]>>0,e[a+1]=s.value[1]>>0}}},h=new Set;let g=null,v=null,y=null;class b extends m.Filter{constructor(e,t,r,i,o,a,c,u,l,d,p,m){super(e,t,r,null),this.isShowWire=!1,this.advData=null,this.wirePosBuffer=null,this.targetPosBuffer=null,this.zIndexBuffer=null,this.indicesBuffer=null,this.faceMaskUVBuffer=null,this.planePosBuffer=null,this.planeUVBuffer=null,this.advEyeTeethPosBuffer=null,this.advEyeTeethIndicesBuffer=null,this.advEyeTeethZindexBuffer=null,this.advEyeTeethUVBuffer=null,this.defParams={enlargeEye:0,roundedEye:0,openCanthus:0,eyeDistance:.5,eyeAngle:.5,shrinkNose:0,lengthenNose:.5,shrinkMouth:.5,widenMouth:.5,mouthCorners:.5,adjustPhiltrum:.5,shrinkUnderjaw:0,shrinkCheekbone:0,lengthenJaw:.5,narrowedFace:0,shrinkFace:0,vShapedFace:0,minifyFace:0,shortenFace:0,whitenTeeth:0,brightenEye:0,fadeHeadWrinkle:0,fadeEyeRim:0,fadeNoseLine:0},h.add(this),this.faceMaskMap=s.createTexture(this.renderer.gl,g),this.eyeTeethMaskMap=s.createTexture(this.renderer.gl,v),this.whiteTeethLutMap=s.createTexture(this.renderer.gl,y,{flipY:!1}),this.params=Object.assign({},this.defParams),f.genTopFace(this.posBuffer.typedArray),f.genFaceOutline(this.posBuffer.typedArray),this.targetPosBuffer=n.createAttributeBuffer(this.renderer.gl,"tPosition",this.posBuffer.typedArray.slice(0),2),this.zIndexBuffer=i,this.indicesBuffer=o,this.faceMaskUVBuffer=a,this.planePosBuffer=c,this.planeUVBuffer=u,this.advEyeTeethPosBuffer=l,this.advEyeTeethIndicesBuffer=d,this.advEyeTeethZindexBuffer=p,this.advEyeTeethUVBuffer=m,this.setWirePosBuffer(),this.initProgramBuffer()}setWirePosBuffer(){if(!this.isShowWire)return;const e=new Set,t=[],r=this.indicesBuffer.typedArray,i=this.posBuffer.typedArray,o=(r,n)=>{if(!e.has(r+"-"+n)&&!e.has(n+"-"+r)){e.add(r+"-"+n);const o=2*r,s=2*n;t.push(i[o],i[o+1],i[s],i[s+1])}};for(let e=0;e<(r.length-2)/3;e++){const t=3*e,n=r[t],i=r[t+1],s=r[t+2];o(n,i),o(i,s),o(s,n)}this.wirePosBuffer?this.programs.wire.updateAttribute("position",(e=>{e.set(t,0)})):this.wirePosBuffer=n.createAttributeBuffer(this.renderer.gl,"position",new Int16Array(t),2)}initProgramBuffer(){const e=this.renderer.gl,t=this.renderer.getSize(),r={width:t.width>>2,height:t.height>>2};let n=null;if(this.isShowWire){const r=new o.Program(e,(()=>{var t;e.drawArrays(e.LINES,0,(null===(t=this.wirePosBuffer)||void 0===t?void 0:t.count)||0)}));r.setShader(u.advBeautyWireShader.vShader,"VERTEX"),r.setShader(u.advBeautyWireShader.fShader,"FRAGMENT"),r.setAttributeBuffer(this.wirePosBuffer),n=i.createFrameBuffer(e,t.width,t.height),r.setUniform("size",[t.width,t.height]),this.programs.wire=r,this.framebuffers.wire=n}const s=new o.Program(e,(()=>{e.drawElements(e.TRIANGLES,this.indicesBuffer.count,e.UNSIGNED_SHORT,0)}));s.setShader(c.advBeautyShader.vShader,"VERTEX"),s.setShader(c.advBeautyShader.fShader,"FRAGMENT"),s.setAttributeBuffer(this.posBuffer),s.setAttributeBuffer(this.targetPosBuffer),s.setAttributeBuffer(this.zIndexBuffer);const p=i.createFrameBuffer(e,t.width,t.height);s.setUniform("size",[t.width,t.height]),this.isShowWire&&s.setUniform("wireMap",n.targetTexture),s.setUniform("showWire",this.isShowWire?1:0),s.setUniform("map",this.map),s.setUniform("teethLut",this.whiteTeethLutMap),s.setUniform("teethIntensity",0),s.setUniform("eyeIntensity",0),s.setIndices(this.indicesBuffer),this.programs.morph=s,this.framebuffers.morph=p;const m=new o.Program(e,(()=>{e.drawElements(e.TRIANGLES,this.indicesBuffer.count,e.UNSIGNED_SHORT,0)}));m.setShader(l.advFaceMaskShader.vShader,"VERTEX"),m.setShader(d.baseTextureShader.fShader,"FRAGMENT"),m.setAttributeBuffer(this.targetPosBuffer),m.setAttributeBuffer(this.zIndexBuffer),m.setAttributeBuffer(this.faceMaskUVBuffer);const f=i.createFrameBuffer(e,r.width,r.height);m.setUniform("size",[t.width,t.height]),m.setUniform("map",this.faceMaskMap),m.setIndices(this.indicesBuffer),this.programs.faceMask=m,this.framebuffers.faceMask=f;const h=new o.Program(e,(()=>{e.drawElements(e.TRIANGLES,this.advEyeTeethIndicesBuffer.count,e.UNSIGNED_SHORT,0)}));h.setShader(l.advFaceMaskShader.vShader,"VERTEX"),h.setShader(d.baseTextureShader.fShader,"FRAGMENT"),h.setAttributeBuffer(this.advEyeTeethPosBuffer),h.setAttributeBuffer(this.advEyeTeethZindexBuffer),h.setAttributeBuffer(this.advEyeTeethUVBuffer);const g=i.createFrameBuffer(e,r.width,r.height);h.setUniform("size",[t.width,t.height]),h.setUniform("map",this.eyeTeethMaskMap),h.setIndices(this.advEyeTeethIndicesBuffer),this.programs.eyeTeeth=h,this.framebuffers.eyeTeeth=g,s.setUniform("eyeTeethMaskMap",g.targetTexture);for(let n=0;n<2;n++){const s=new o.Program(e);s.setShader(d.baseTextureShader.vShader,"VERTEX"),s.setShader(a.advBeautyEyeShader.fShader,"FRAGMENT"),s.setAttributeBuffer(this.planePosBuffer),s.setAttributeBuffer(this.planeUVBuffer);const c=i.createFrameBuffer(e,t.width,t.height);s.setUniform("map",0===n?p.targetTexture:this.framebuffers.lEye.targetTexture),s.setUniform("eyeCenter",[0,0]),s.setUniform("rdIntensity",0),s.setUniform("lgIntensity",0),s.setUniform("intensRatio",0),s.setUniform("range",0),s.setUniform("rdDir",[0,0]);const u=["lEye","rEye"][n];this.programs[u]=s,this.framebuffers[u]=c;const m=new o.Program(e);m.setShader(d.baseTextureShader.vShader,"VERTEX"),m.setShader(l.advFaceMaskShader.fShader,"FRAGMENT"),m.setAttributeBuffer(this.planePosBuffer),m.setAttributeBuffer(this.planeUVBuffer);const h=i.createFrameBuffer(e,r.width,r.height);m.setUniform("map",null),m.setUniform("maskMap",f.targetTexture),m.setUniform("index",n),this.programs["faceMaskMerge"+n]=m,this.framebuffers["faceMaskMerge"+n]=h}}get output(){return this.advData?this.framebuffers.rEye.targetTexture:super.output}get faceMask(){if(this.advData){const e=this.advData.length/212>>0;return this.framebuffers["faceMaskMerge"+(e-1)%2].targetTexture}return null}updateSize(){const e=this.renderer.getSize(),t={width:e.width>>2,height:e.height>>2};["wire","morph","lEye","rEye","faceMask","faceMaskMerge0","faceMaskMerge1","eyeTeeth"].forEach((r=>{var n;-1===["faceMaskMerge0","faceMaskMerge1","lEye","rEye"].indexOf(r)&&(null===(n=this.programs[r])||void 0===n||n.setUniform("size",[e.width,e.height]));const i=this.framebuffers[r];if(i){const n=-1===["faceMask","faceMaskMerge0","faceMaskMerge1","eyeTeeth"].indexOf(r)?e:t;i.targetTexture.opts.width=n.width,i.targetTexture.opts.height=n.height,i.targetTexture.refresh()}}))}setAdvData(e){this.advData=e.length?e:null}setAdvEffect(e,t){if(e in this.params&&"number"==typeof t)this.params[e]=Math.min(1,Math.max(0,t)),"whitenTeeth"===e&&0===this.params[e]?this.programs.morph.setUniform("teethIntensity",0):"brightenEye"===e?this.programs.morph.setUniform("eyeIntensity",t):"roundedEye"===e?(this.programs.lEye.setUniform("rdIntensity",t),this.programs.rEye.setUniform("rdIntensity",t)):"enlargeEye"===e&&(this.programs.lEye.setUniform("lgIntensity",t),this.programs.rEye.setUniform("lgIntensity",t));else for(const e in this.defParams)this.setAdvEffect(e,this.defParams[e])}presetAdvEffect(e){for(const t in this.defParams)t in e?this.setAdvEffect(t,e[t]):this.setAdvEffect(t,this.defParams[t])}get featureParas(){return this.advData?{forehead:this.params.fadeHeadWrinkle,eyeRim:this.params.fadeEyeRim,noseLine:this.params.fadeNoseLine}:{forehead:0,eyeRim:0,noseLine:0}}posToUV(e,t,r){return new p.Vector2(e.x/t,1-e.y/r)}render(){const e=this.advData;if(e){const t=this.renderer,r=t.gl,n=t.getSize(),i={width:n.width>>2,height:n.height>>2},o=e.length/212>>0;for(let s=0;s<o;s++){const o=e.slice(212*s,212*(s+1)),a=s%2,c=this.programs.morph,u=this.programs["faceMaskMerge"+a];c.setUniform("map",0===s?this.map:this.framebuffers.rEye.targetTexture),c.updateAttribute("position",(e=>{e.set(o,0),f.genTopFace(e),f.genFaceOutline(e)}));let l=null;if(c.updateAttribute("tPosition",(e=>{var t;const r=e;r.set(this.posBuffer.typedArray,0),p.preHandle(r);for(const e in p.handlers){const n=this.params[e];if(n!==this.defParams[e]){const i=null===(t=p.handlers[e])||void 0===t?void 0:t.call(p.handlers,r,n);"whitenTeeth"===e?c.setUniform("teethIntensity",i):"roundedEye"!==e&&"enlargeEye"!==e||(l=Object.assign(Object.assign({},i),{posData:r}))}}})),this.setWirePosBuffer(),this.isShowWire&&(this.framebuffers.wire.bind(),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),this.renderer.render(this.programs.wire)),t.setViewport(0,0,i.width,i.height),this.framebuffers.faceMask.bind(),this.renderer.render(this.programs.faceMask),u.setUniform("index",s),u.setUniform("map",this.framebuffers["faceMaskMerge"+(0===a?1:0)].targetTexture),this.framebuffers["faceMaskMerge"+a].bind(),this.renderer.render(u),this.programs.eyeTeeth.updateAttribute("tPosition",(e=>{const t=e,r=this.targetPosBuffer.typedArray;[52,53,72,54,55,56,73,57,61,60,75,59,58,63,76,62,96,97,98,99,100,101,102,103].forEach(((e,n)=>{let i=2*n,o=2*e;t[i]=r[o],t[i+1]=r[o+1]}))})),this.framebuffers.eyeTeeth.bind(),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),this.renderer.render(this.programs.eyeTeeth),t.setViewport(0,0,n.width,n.height),this.framebuffers.morph.bind(),this.renderer.render(c),l){const e=this.posToUV(l.lEyeCenter,n.width,n.height),t=this.posToUV(l.rEyeCenter,n.width,n.height),r=this.posToUV(p.Vector2.getVec(l.posData,52),n.width,n.height),i=this.posToUV(p.Vector2.getVec(l.posData,55),n.width,n.height);let o=p.Vector2.getVec(l.posData,72),s=p.Vector2.getVec(l.posData,73);const a=this.posToUV(p.Vector2.getVec(l.posData,58),n.width,n.height),c=this.posToUV(p.Vector2.getVec(l.posData,61),n.width,n.height);let u=p.Vector2.getVec(l.posData,75),d=p.Vector2.getVec(l.posData,76);const m=Math.min(1,Math.max(0,(p.Vector2.disPow2(o,s)-4)/4)),f=Math.min(1,Math.max(0,(p.Vector2.disPow2(u,d)-4)/4));o=this.posToUV(o,n.width,n.height),s=this.posToUV(s,n.width,n.height),u=this.posToUV(u,n.width,n.height),d=this.posToUV(d,n.width,n.height),this.programs.lEye.setUniform("eyeCenter",e.value),this.programs.lEye.setUniform("range",Math.max(p.Vector2.dis(e,r),p.Vector2.dis(e,i))),this.programs.lEye.setUniform("rdDir",p.Vector2.normalize(p.Vector2.sub(o,s)).value),this.programs.lEye.setUniform("intensRatio",m),this.programs.rEye.setUniform("eyeCenter",t.value),this.programs.rEye.setUniform("range",Math.max(p.Vector2.dis(t,a),p.Vector2.dis(t,c))),this.programs.rEye.setUniform("rdDir",p.Vector2.normalize(p.Vector2.sub(u,d)).value),this.programs.rEye.setUniform("intensRatio",f)}this.framebuffers.lEye.bind(),this.renderer.render(this.programs.lEye),this.framebuffers.rEye.bind(),this.renderer.render(this.programs.rEye)}}}static configStaticRes(e,r){const n=[];let i=1;const o=()=>{i-=1,i<=0&&(r?r.emit("advBeautyResComplete",n):h.forEach((e=>{try{e.emit("advBeautyResComplete",n)}catch(e){}})))};e.faceMask&&!g&&(i+=1,t.resSet.faceMask=e.faceMask,s.retryLoadImage(e.faceMask,3,(e=>{g=e,h.forEach((t=>{try{t.faceMaskMap.source=e,t.faceMaskMap.refresh()}catch(e){}})),o()}),(()=>{n.push(e.faceMask),o()}))),e.eyeTeethMask&&!v&&(i+=1,t.resSet.eyeTeethMask=e.eyeTeethMask,s.retryLoadImage(t.resSet.eyeTeethMask,3,(e=>{v=e,h.forEach((t=>{try{t.eyeTeethMaskMap.source=e,t.eyeTeethMaskMap.refresh()}catch(e){}})),o()}),(()=>{n.push(e.eyeTeethMask),o()}))),e.teethWhiten&&!y&&(i+=1,t.resSet.teethWhiten=e.teethWhiten,s.retryLoadImage(t.resSet.teethWhiten,3,(e=>{y=e,h.forEach((t=>{try{t.whiteTeethLutMap.source=e,t.whiteTeethLutMap.refresh()}catch(e){}})),o()}),(()=>{n.push(e.teethWhiten),o()}))),o()}destroy(){var e,t,r;super.destroy(),null===(e=this.renderer.gl)||void 0===e||e.deleteTexture(this.faceMaskMap.glTexture),null===(t=this.renderer.gl)||void 0===t||t.deleteTexture(this.eyeTeethMaskMap.glTexture),null===(r=this.renderer.gl)||void 0===r||r.deleteTexture(this.whiteTeethLutMap.glTexture),h.delete(this)}remove(){h.delete(this)}}t.AdvBeautyFilter=b},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.lutShader=void 0,t.lutShader={fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n    uniform sampler2D lut;\n\n    // lut强度\n    uniform float intensity;\n\n    varying vec2 vuv;\n\n    void main() {\n        vec3 color = texture2D(map, vuv).rgb;\n\n        if(intensity > 0.0){\n            float blue = color.b * 63.0;\n\n            vec2 q1;\n            float fb = floor(blue);\n            q1.y = floor(fb * 0.125);\n            q1.x = fb - (q1.y * 8.0);\n\n            vec2 q2;\n            float cb = ceil(blue);\n            q2.y = floor(cb * 0.125);\n            q2.x = cb - (q2.y * 8.0);\n\n            vec2 t = 0.123 * color.rg + vec2(0.000976563);\n            vec2 t1 = q1 * 0.125 + t;\n            vec3 p1 = texture2D(lut, t1).rgb;\n\n            vec2 t2 = q2 * 0.125 + t;\n            vec3 p2 = texture2D(lut, t2).rgb;\n\n            vec3 filter = mix(p1, p2, fract(blue));\n            color = mix(color, filter, intensity);\n        }\n        gl_FragColor = vec4(color, 1.0);\n    }"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.audioPlugins=t.videoPlugins=void 0,t.videoPlugins=["VirtualBackground","AdvancedBeauty"],t.audioPlugins=["AIDenoise"],t.default=["VirtualBackground","AdvancedBeauty","AIDenoise"]},,,,function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NERTC=void 0;const i=r(206),o=r(296),s=r(62),a=r(326),c=r(327),u=r(328),l=r(122),d=r(166),p=r(117),m=r(4),f=r(64),h=r(162),g=n(r(12)),v=n(r(13)),y=n(r(198)),b=r(70),S=r(65),T=r(71),_=r(164);let w,M=window;t.NERTC={Logger:{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,setLogLevel(e){const t=m.getParameters().forceLogLevel;-1!==t?null==w||w.logger.error("setLogLevel: 本页面的日志级别固定为 "+b.loglevelMap[t]):(w&&w.apiFrequencyControl({name:"setLogLevel",code:0,param:{clientUid:w.adapterRef.channelInfo.uid||"",level:e}}),y.default.setLogLevel(e))},enableLogUpload(){"off"===m.getParameters().forceLogUpload?null==w||w.logger.error("enableLogUpload: 禁止开启日志上传"):(w&&w.apiFrequencyControl({name:"enableLogUpload",code:0,param:{clientUid:w.adapterRef.channelInfo.uid||""}}),y.default.enableLogUpload())},disableLogUpload(){"on"===m.getParameters().forceLogUpload?null==w||w.logger.error("disableLogUpload: 禁止关闭日志上传"):(w&&w.apiFrequencyControl({name:"disableLogUpload",code:0,param:{clientUid:w.adapterRef.channelInfo.uid||""}}),y.default.disableLogUpload())}},createClient(e){if(!h.checkSystemRequirements())throw console.error("浏览器环境不支持"),new v.default({code:g.default.NOT_SUPPORT_ERROR,message:"云信sdk不支持，请使用最新版本的chrome浏览器"});S.checkExists({tag:"createClient:ClientOptions",value:e}),S.checkExists({tag:"createClient:ClientOptions.appkey",value:e.appkey});const r=new i.Client(Object.assign(e,{apiList:[],ref:t.NERTC}));return m.getParameters().clients.push(r),w||(w=r),r},createStream(e){if(S.checkExists({tag:"createStream:options",value:e}),_.isHttpProtocol())throw null==w||w.adapterRef.logger.warn("The current protocol is HTTP"),new v.default({code:g.default.NOT_SUPPORT_ERROR,message:"请使用https环境或者loclhost环境"});if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw console.warn("没有 getUserMedia 方法。请使用最新版本的chrome浏览器"),new v.default({code:g.default.NOT_SUPPORT_ERROR,message:"浏览器不支持开启媒体设备，请使用最新版本的chrome浏览器"});if(e.screenAudio&&!e.screen)throw new v.default({code:g.default.INVALID_OPERATION_ERROR,message:"createStream: screenAudio 要与 screen 一起开启"});if(!e.client&&w&&w.adapterRef.logger.warn("createStream: 未传入client参数。使用默认Client。"),w||e.client){const t=new o.LocalStream(Object.assign(e,{isRemote:!1,client:e.client||w}));return m.getParameters().localStreams.push(t),t}return a.clientNotYetUninitialized},Device:p.Device,getDevices:(e=!1)=>p.Device.getDevices({audioinput:!0,audiooutput:!0,videoinput:!0,requestPerm:e}),getCameras:(e=!1)=>p.Device.getCameras(e),getMicrophones:(e=!1)=>p.Device.getMicrophones(e),getSpeakers:(e=!1)=>p.Device.getSpeakers(e),checkSystemRequirements:h.checkSystemRequirements,getSupportedCodec:async()=>await T.getSupportedCodecs(),checkBrowserCompatibility:async()=>await _.checkBrowserCompatibility(),getHandler:()=>d.detectDevice(),getParameters:m.getParameters,destroy(e){let t=e||w;t&&t.destroy(),e||(w=null)},PlatformTypeMap:f.PlatformTypeMap,CHAT_VIDEO_FRAME_RATE_NORMAL:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,CHAT_VIDEO_FRAME_RATE_5:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5,CHAT_VIDEO_FRAME_RATE_10:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_10,CHAT_VIDEO_FRAME_RATE_15:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_15,CHAT_VIDEO_FRAME_RATE_20:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_20,CHAT_VIDEO_FRAME_RATE_25:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25,CHAT_VIDEO_FRAME_RATE_30:l.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_30,VIDEO_QUALITY_180p:l.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_180p,VIDEO_QUALITY_480p:l.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p,VIDEO_QUALITY_720p:l.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_720p,VIDEO_QUALITY_1080p:l.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p,RECORD_VIDEO_QUALITY_360p:l.NERTC_RECORD_VIDEO_QUALITY.RECORD_VIDEO_QUALITY_360p,RECORD_VIDEO_QUALITY_480p:l.NERTC_RECORD_VIDEO_QUALITY.RECORD_VIDEO_QUALITY_480p,RECORD_VIDEO_QUALITY_720p:l.NERTC_RECORD_VIDEO_QUALITY.RECORD_VIDEO_QUALITY_720p,RECORD_VIDEO_FRAME_RATE_15:l.NERTC_RECORD_VIDEO_FRAME_RATE.RECORD_VIDEO_FRAME_RATE_15,RECORD_VIDEO_FRAME_RATE_30:l.NERTC_RECORD_VIDEO_FRAME_RATE.RECORD_VIDEO_FRAME_RATE_30,LIVE_STREAM_AUDIO_CODEC_PROFILE:c.LIVE_STREAM_AUDIO_CODEC_PROFILE,LIVE_STREAM_AUDIO_SAMPLE_RATE:c.LIVE_STREAM_AUDIO_SAMPLE_RATE,VIDEO_FRAME_RATE:l.VIDEO_FRAME_RATE,VIDEO_QUALITY:l.NERTC_VIDEO_QUALITY,NETWORK_STATUS:u.NETWORK_STATUS,STREAM_TYPE:l.STREAM_TYPE,VERSION:s.SDK_VERSION,BUILD:s.BUILD,ENV:s.ENV},e.exports=M.WebRTC2=t.NERTC},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const i=r(62),o=r(122),s=r(117),a=r(148),c=r(211),u=r(4),l=r(150),d=r(63),p=r(64),m=n(r(12)),f=n(r(13)),h=r(212),g=r(65),v=r(213),y=r(295);class b extends v.Base{constructor(e){super(e),this.destroyed=!1,this.onJoinFinish=null,this.spatialManager=null,this.apiFrequencyControl({name:"createClient",code:0,param:{clientUid:"",debug:e.debug}}),this.operationQueue=new h.OperationQueue(this.logger),this.handlePageUnload=e=>{"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus||(this.logger.warn(`收到 ${null==e?void 0:e.type} 事件，当前状态：${this.adapterRef.channelStatus}，即将离开房间`),this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=m.default.PAGE_UNLOAD,this.leave())},this.handleOnOnlineOffline=e=>{var t,r,n,i,o;"online"===(null==e?void 0:e.type)?"CONNECTING"===this.adapterRef.connectState.curState?(this.logger.warn("侦测到网络恢复，恢复重连过程"),this.resumeReconnection()):this.logger.warn("侦测到网络恢复"):"offline"===(null==e?void 0:e.type)&&("CONNECTED"===this.adapterRef.connectState.curState?(this.logger.warn("侦测到网络断开，主动断开连接"),this.pauseReconnection(),null===(r=null===(t=this.adapterRef._mediasoup)||void 0===t?void 0:t._sendTransport)||void 0===r||r.close(),null===(i=null===(n=this.adapterRef._mediasoup)||void 0===n?void 0:n._recvTransport)||void 0===i||i.close(),this.adapterRef.channelStatus="connectioning",null===(o=this.adapterRef._signalling)||void 0===o||o._reconnection()):this.logger.warn("侦测到网络断开"))},u.getParameters().leaveOnUnload&&(window.addEventListener("pagehide",this.handlePageUnload),window.addEventListener("beforeunload",this.handlePageUnload)),u.getParameters().trustOnOnline&&(window.addEventListener("online",this.handleOnOnlineOffline),window.addEventListener("offline",this.handleOnOnlineOffline)),this._roleInfo={userRole:0,audienceList:{}},this._init(e),this.logger.info(`NERTC ${i.SDK_VERSION} ${i.BUILD}: 客户端创建成功。`),this.on("@connection-state-change",(e=>{var t,r,n;"CONNECTED"===e.prevState&&(null===(t=this.recordManager.record)||void 0===t?void 0:t._status.isRecording)&&"started"===(null===(r=this.recordManager.record)||void 0===r?void 0:r._status.state)&&(this.logger.log("自动停止客户端录制功能"),this.recordManager.record.download()),"CONNECTED"===e.curState&&"CONNECTING"===e.prevState&&(e.reconnect&&this.adapterRef.lbsManager.startUpdate("reconnect"),(null===(n=this.adapterRef.datareportCache)||void 0===n?void 0:n.length)&&(this.logger.log(`上报进频道前事件：${this.adapterRef.datareportCache.length}条: ${this.adapterRef.datareportCache.map((e=>e.func)).join()}`),this.adapterRef.datareportCache.forEach((e=>{const t=e.datareport[e.func];t&&(t.cid=t.cid||this.adapterRef.channelInfo.cid,t.uid=t.uid||this.adapterRef.channelInfo.uid),e.datareport.send()})),this.adapterRef.datareportCache=[]))}))}_init(e){const{appkey:t="",token:r}=e;this._params.appkey=t,this.adapterRef.lbsManager.loadBuiltinConfig("oninit"),this._params.token=r,this._roleInfo={userRole:0,audienceList:{}},s.Device.deviceInited||s.Device.startDeviceChangeDetection(),s.Device.on("recording-device-changed",(e=>{this.destroyed||(this.safeEmit("recording-device-changed",e),this.adapterRef.instance.apiEventReport("setUserCustomEvent",{name:"recording-device-changed",customIdentify:"client",param:JSON.stringify(e,null," ")}))})),s.Device.on("camera-changed",(e=>{this.destroyed||(this.safeEmit("camera-changed",e),this.adapterRef.instance.apiEventReport("setUserCustomEvent",{name:"camera-changed",customIdentify:"client",param:JSON.stringify(e,null," ")}))})),s.Device.on("playout-device-changed",(e=>{this.destroyed||(this.safeEmit("playout-device-changed",e),this.adapterRef.instance.apiEventReport("setUserCustomEvent",{name:"playout-device-changed",customIdentify:"client",param:JSON.stringify(e,null," ")}))}));const n=()=>{this.onJoinFinish?(this.onJoinFinish(),this.onJoinFinish=null):this.logger.debug("孤立的join完成回调")};this.addListener("@pairing-join-success",n),this.addListener("@pairing-join-error",n),"never"!==u.getParameters().enableAlerter&&s.alerter.watchClient(this.adapterRef.instance)}getUid(){return this.adapterRef.channelInfo&&this.adapterRef.channelInfo.uid}getParameter(e="getChannelInfo"){if(this.apiFrequencyControl({name:"getParameter",code:0,param:{type:e}}),"getChannelInfo"===e){const e=`appkey=${this._params.appkey}&osType=4&mode=2&netType=0&version=${i.SDK_VERSION+".0"}&webrtc=1&nrtcg2=1&t1=${Date.now()}`,t={"Content-Type":"application/x-www-form-urlencoded"};return JSON.stringify({postData:e,header:t})}}getChannelInfo(){return this.apiFrequencyControl({name:"getChannelInfo",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||""}}),this.adapterRef.channelInfo||{}}startProxyServer(e){let t=null;if(this.adapterRef.logger.log("startProxyServer() type: ",e),"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus||(this.adapterRef.logger.warn("startProxyServer() 请在加入房间前调用"),t="startProxyServer() 请在加入房间前调用"),this.apiFrequencyControl({name:"startProxyServer",code:t?-1:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",reason:t}}),t)throw new f.default({code:m.default.API_CALL_SEQUENCE_BEFORE_ERROR,message:"startProxyServer() 请在加入房间前调用"});this.adapterRef.proxyServer.enable=!0,e&&(this.adapterRef.proxyServer.type=e)}stopProxyServer(){this.adapterRef.logger.log("stopProxyServer()"),this.adapterRef.proxyServer&&(this.adapterRef.proxyServer.enable=!1,this.adapterRef.proxyServer.wsProxyArray=null),this.apiFrequencyControl({name:"stopProxyServer",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",reason:""}})}setLocalMediaPriority(e){this.logger.log("setLocalMediaPriority() options: ",JSON.stringify(e));let t=0,r="";"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus||(r="setLocalMediaPriority() 请在加入房间前调用",t=m.default.API_CALL_SEQUENCE_BEFORE_ERROR),100!==e.priority&&50!==e.priority&&(r="setLocalMediaPriority: options.priority应该是100或者50",t=m.default.SET_LOCAL_MEDIA_PRIORITY_ARGUMENT_ERROR);const{priority:n=100,preemtiveMode:i=!1}=e;if(this.apiFrequencyControl({name:"setLocalMediaPriority",code:t?-1:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",priority:n,preemtiveMode:i,reason:t,message:r}}),t)throw this.logger.error(r),new f.default({code:t,message:r});this.adapterRef.userPriority=e}async join(e){this.logger.log("join() 加入频道, options: ",JSON.stringify(e,null," "));try{if(!e.channelName||""===e.channelName)throw this.logger.log("join(): 请填写房间名称"),new f.default({code:m.default.JOIN_WITHOUT_CHANNEL_NAME,message:"join(): 请填写房间名称"});if(e.joinChannelRecordConfig&&(g.checkValidBoolean({tag:"joinOptions.joinChannelRecordConfig.recordAudio should be boolean",value:e.joinChannelRecordConfig.recordAudio}),g.checkValidBoolean({tag:"joinOptions.joinChannelRecordConfig.recordVideo should be boolean",value:e.joinChannelRecordConfig.recordVideo})),"string"==typeof e.uid){if(this.logger.log("join(): uid是string类型"),!/^\d+(\.\d+)?$/.test(e.uid))throw this.logger.log("join(): uid不是数字字符串格式"),new f.default({code:m.default.JOIN_UID_TYPE_ERROR,message:"join() uid不是数字字符串格式"});this.adapterRef.channelInfo.uidType="string"}else{if("number"!=typeof e.uid)return this.logger.error("join(): uid参数格式非法"),Promise.reject(new f.default({code:m.default.JOIN_UID_TYPE_ERROR,message:"join() uid参数格式非法"}));if(this.logger.log("join(): uid是number类型"),this.adapterRef.channelInfo.uidType="number",e.uid>Number.MAX_SAFE_INTEGER)throw this.logger.log("join():uid参数越界, 会导致精度缺失"),new f.default({code:m.default.JOIN_UID_TYPE_ERROR,message:"Number 类型的 uid 最大值是 2^53 - 1, 请输入正确的参数"})}if(this.onJoinFinish=await this.operationQueue.enqueue({caller:this,method:"join",options:e}),this.safeEmit("@pairing-join-start"),"join"===this.adapterRef.channelStatus||"connectioning"===this.adapterRef.channelStatus)return this.safeEmit("@pairing-join-error"),Promise.reject(new f.default({code:m.default.REPEAT_JOIN_ERROR,message:"join() 重复加入房间"}));this.adapterRef.connectState.curState="CONNECTING",this.adapterRef.connectState.prevState="DISCONNECTED",this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),e.spatial&&this.initSpatialManager(e.spatial),e.token&&(this._params.token=e.token),e.customData&&(this.adapterRef.channelInfo.customData=e.customData),this._params.JoinChannelRequestParam4WebRTC2={startJoinTime:Date.now(),appkey:this._params.appkey,userRole:this._roleInfo.userRole,channelName:e.channelName,wssArr:e.wssArr,uid:e.uid,permKey:e.permKey||"",token:this._params.token,joinChannelLiveConfig:e.joinChannelLiveConfig||{liveEnable:!1},joinChannelRecordConfig:e.joinChannelRecordConfig||{recordAudio:!1,recordVideo:!1,recordType:0,isHostSpeaker:!1},getChanneInfoResponse:e.getChanneInfoResponse},e.neRtcServerAddresses&&(this._params.neRtcServerAddresses={channelServer:e.neRtcServerAddresses.channelServer||"",statisticsServer:e.neRtcServerAddresses.statisticsServer||"",statisticsWebSocketServer:e.neRtcServerAddresses.statisticsWebSocketServer||"",roomServer:e.neRtcServerAddresses.roomServer||"",webSocketProxyServer:e.neRtcServerAddresses.webSocketProxyServer||"",mediaProxyServer:e.neRtcServerAddresses.mediaProxyServer||""});const t=this.adapterRef.lbsManager.loadLocalConfig("onjoin");if(t.config){const e=t.config.ts+1e3*t.config.config.ttl-Date.now();e<1e3*t.config.config.preloadTimeSec&&(this.logger.log(`join() LBS在 ${Math.floor(e/1e3)} 秒后过期。preloadTimeSec: ${t.config.config.preloadTimeSec}。发起异步刷新请求`),this.adapterRef.lbsManager.startUpdate("renew"))}else this.adapterRef.lbsManager.startUpdate(t.reason);if(this.setStartSessionTime(),this.initMode(),!this.adapterRef.mediaCapability.supportedCodecRecv||!this.adapterRef.mediaCapability.supportedCodecSend)try{await this.adapterRef.mediaCapability.detect()}catch(e){this.logger.warn("join() Failed to detect mediaCapability: ",e.name,e.message)}if(!this.adapterRef._meetings)throw this.logger.error("join() meeting模块缺失"),this.safeEmit("@pairing-join-error"),new f.default({code:m.default.UNKNOWN_TYPE_ERROR,message:"join() meeting模块缺失"});const r=await this.adapterRef._meetings.joinChannel(this._params.JoinChannelRequestParam4WebRTC2);return this.safeEmit("@pairing-join-success"),this.apiFrequencyControl({name:"join",code:0,param:Object.assign({},e)}),r}catch(t){throw this.safeEmit("@pairing-join-error"),this.apiFrequencyControl({name:"join",code:-1,param:Object.assign(Object.assign({},e),{reason:t&&t.message})}),new f.default({code:t.getCode&&t.getCode()||m.default.JOIN_FAILED,message:t.getCode&&t.getMessage()||`join() 内部错误: ${t.name}, ${t.message}`})}}async leave(){var e;const t=await this.operationQueue.enqueue({caller:this,method:"leave",options:null}),r=(null===(e=this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2)||void 0===e?void 0:e.logoutReason)||0;this.logger.log("leave() 离开频道: ",r),this.adapterRef.instance.apiEventReport("setLogout",{reason:r}),this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTING",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.setEndSessionTime(),this.adapterRef._meetings?this.adapterRef._meetings.leaveChannel().then(t):(this.adapterRef.connectState={prevState:"DISCONNECTED",curState:"DISCONNECTED",reconnect:!1},t()),this.apiFrequencyControl({name:"leave",code:0,param:{clientUid:this.getUid()}})}async leaveRts(){this.logger.log("离开频道"),"join"!==this.adapterRef.channelStatus&&"connectioning"!==this.adapterRef.channelStatus&&this.logger.log(" 状态: ",this.adapterRef.channelStatus),this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTING",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.setEndSessionTime(),this.adapterRef._meetings&&this.adapterRef._meetings.leaveChannel()}setEncryptionMode(e){if(g.checkValidInteger({tag:"Valid encryptionModes are: "+Object.keys(a.EncryptionModes).join(","),value:a.encryptionModeToInt(e)}),this.adapterRef.encryption.encodedInsertableStreams){const e="setEncryptionMode() 自定义加密功能与国密加密功能不兼容";throw this.logger.error(e),new f.default({code:m.default.SET_ENCRYPTION_MODE_ERROR,message:e})}this.logger.log("setEncryptionMode() 设置加密模式：",e),this.adapterRef.encryption.setEncryptionMode(e);const t={enable:"none"!==e,mode:a.encryptionModeToInt(e)};this.apiFrequencyControl({name:"setEncryptionMode",code:0,param:JSON.stringify(t,null," ")})}setEncryptionSecret(e){switch(this.adapterRef.encryption.encryptionMode){case"none":throw new f.default({code:m.default.SET_ENCRYPTION_SECRET_INVALID_OPERATION_ERROR,message:"setEncryptionSecret() 请先设置加密模式"});case"sm4-128-ecb":g.checkValidString({tag:"client.setEncryptionSecret:encryptionSecret",value:e,min:1,max:128})}this.logger.log("设置加密密钥"),this.adapterRef.encryption.setEncryptionSecret(e),this.apiFrequencyControl({name:"setEncryptionSecret",code:0,param:JSON.stringify({encryptionSecret:e},null," ")})}enableCustomTransform(e){var t;let r,n;if("DISCONNECTED"!==this.adapterRef.connectState.curState?(r="enableCustomTransform() 必须在加入频道前调用",n=m.default.API_CALL_SEQUENCE_BEFORE_ERROR):"function"!=typeof window.TransformStream?(r="enableCustomTransform() 浏览器不支持自定义加密, TransformStream 未找到",n=m.default.CUSTOM_TRANSFOR_NOT_SUPPORT_ERROR):"function"!=typeof(null===(t=window.RTCRtpReceiver)||void 0===t?void 0:t.prototype.createEncodedStreams)?(r="enableCustomTransform() 浏览器不支持自定义加解密，未找到createEncodedStreams",n=m.default.CUSTOM_TRANSFOR_NOT_SUPPORT_ERROR):"none"!==this.adapterRef.encryption.encryptionMode&&(r="enableCustomTransform() 自定义加密功能与国密加密功能不兼容",n=m.default.SET_ENCRYPTION_MODE_ERROR),this.apiFrequencyControl({name:"enableCustomTransform",code:r?-1:0,param:JSON.stringify({enable:e,message:r})}),r)throw this.logger.error(r),new f.default({code:n,message:r});!1===e?(this.adapterRef.encryption.encodedInsertableStreams=!1,this.logger.log("enableCustomTransform() 已关闭自定义加解密")):(this.adapterRef.encryption.encodedInsertableStreams=!0,this.logger.log("enableCustomTransform() 已开启自定义加解密"))}async publish(e){g.checkExists({tag:"client.publish:stream",value:e}),await this.doPublish(e)}async doPublish(e){const t=await this.operationQueue.enqueue({caller:this,method:"publish",options:e});let r=0,n="";const i=()=>{var i,o;t();const s={reason:r,message:n,pubStatus:e.pubStatus};(e.mediaHelper.video.cameraTrack||e.mediaHelper.video.videoSource)&&(s.webcamProducerCodec=null===(i=this.adapterRef._mediasoup)||void 0===i?void 0:i._webcamProducerCodec),(e.mediaHelper.screen.screenVideoTrack||e.mediaHelper.screen.screenVideoSource)&&(s.screenProducerCodec=null===(o=this.adapterRef._mediasoup)||void 0===o?void 0:o._screenProducerCodec),this.apiFrequencyControl({name:"publish",code:r?-1:0,param:JSON.stringify(s)});const a=JSON.stringify(e.mediaHelper.getTrackSettings());this.apiFrequencyControl({name:"_trackSettings",code:0,param:a}),this.adapterRef.instance.apiEventReport("setUserCustomEvent",{name:"media_track_Settings",customIdentify:"publish",param:a})};if(e&&(e.audio||e.video||e.screen||e.screenAudio)?1===this._roleInfo.userRole?(n="publish() 观众禁止Publish, 请先使用setClientRole设为主播",this.logger.error(n),r=m.default.PUBLISH_ROLE_ERROR):"CONNECTING"===this.adapterRef.connectState.curState?(n="publish() 当前正在连接, 将在连接成功后发布媒体流",this.bindLocalStream(e),r=m.default.RECONNECTING):"CONNECTED"!==this.adapterRef.connectState.curState&&(n="publish() 当前不在频道中, 可能是没有加入频道或者是网络波动导致暂时断开连接",this.logger.error(n),r=m.default.API_CALL_SEQUENCE_BEFORE_ERROR):e&&u.getParameters().allowEmptyMedia?this.logger.log("publish() 当前模式允许发布没有媒体流的localStream"):(n="publish() 传入的 stream 格式非法，没有媒体数据",this.logger.error(n),r=m.default.PUBLISH_NO_STREAM),r)return n?(i(),Promise.reject(new f.default({code:r,message:n}))):void i();try{if(!this.adapterRef._mediasoup)throw n="publish() 媒体mediasoup模块缺失",r=m.default.UNKNOWN_TYPE_ERROR,this.logger.error(n),i(),new f.default({code:r,message:n});this.bindLocalStream(e),await this.adapterRef._mediasoup.createProduce(e,"all"),i()}catch(e){throw this.logger.error("publish() 内部错误: ",e.name,e.message),r=m.default.UNKNOWN_TYPE_ERROR,n=e.message,i(),new f.default({code:e.getCode&&e.getCode()||r,message:e.getCode&&e.getMessage()||`publish() 内部错误: ${e.name}, ${e.message}`})}}async unpublish(e){g.checkExists({tag:"client.unpublish:stream",value:e});const t=await this.operationQueue.enqueue({caller:this,method:"unpublish",options:null}),r=()=>{t(),JSON.stringify({pubStatus:e&&e.pubStatus,reason:n,message:i},null," "),this.apiFrequencyControl({name:"unpublish",code:n?-1:0,param:{clientUid:this.getUid(),pubStatus:e&&e.pubStatus,reason:n}})};let n=0,i="";if("CONNECTING"===this.adapterRef.connectState.curState?(this.adapterRef.localStream=null,i="unpublish() 当前正在连接, 连接成功后将不再发送媒体流",n=m.default.RECONNECTING):"CONNECTED"!==this.adapterRef.connectState.curState&&(i="unpublish() 当前不在频道中, 可能是没有加入频道或者是网络波动导致暂时断开连接",this.logger.error(i),n=m.default.API_CALL_SEQUENCE_BEFORE_ERROR),n)return r(),i?(this.logger.error(i),Promise.reject(new f.default({code:n,message:i}))):void 0;this.logger.log("unpublish(): 开始取消发布本地流");try{if(!this.adapterRef._mediasoup)throw i="unpublish() 媒体mediasoup模块缺失",n=m.default.UNKNOWN_TYPE_ERROR,this.logger.error(i),r(),new f.default({code:n,message:i});await this.adapterRef._mediasoup.destroyProduce("audio"),await this.adapterRef._mediasoup.destroyProduce("audioSlave"),await this.adapterRef._mediasoup.destroyProduce("video"),await this.adapterRef._mediasoup.destroyProduce("screen"),this.adapterRef.localStream=null,r()}catch(e){throw this.logger.error("unpublish() 内部错误: ",e.name,e.message),n=m.default.UNKNOWN_TYPE_ERROR,i=e.message,r(),new f.default({code:e.getCode&&e.getCode()||n,message:e.getCode&&e.getMessage()||`publish() 内部错误: ${e.name}, ${e.message}`})}}getSubStatus(e,t){let r={status:"unsubscribed",subscribable:!1};if("all"===t){const t=[this.getSubStatus(e,"audio"),this.getSubStatus(e,"audioSlave"),this.getSubStatus(e,"video"),this.getSubStatus(e,"screen")];t.find((e=>"unsubscribing"===e.status))?r.status="unsubscribing":t.find((e=>"subscribing"===e.status))&&(r.status="subscribing"),t.find((e=>"subscribed"===e.status))&&(r.status="subscribed"),"subscribed"!==r.status&&"unsubscribed"!==r.status||t.find((e=>e.subscribable))&&(r.subscribable=!0)}else"start"===e.pubStatus[t].stopconsumerStatus?r.status="unsubscribing":"start"===e.pubStatus[t].consumerStatus?r.status="subscribing":e.pubStatus[t].consumerId?r.status="subscribed":"unsubscribed"===r.status&&e.pubStatus[t].producerId&&e.subConf[t]&&(r.subscribable=!0);return r}async subscribe(e,t){if(!this.spatialManager)return g.checkExists({tag:"client.subscribe:stream",value:e}),t?(this.logger.log(`subscribe [订阅远端: ${e.stringStreamID}] ${JSON.stringify(t)}`),e.doSetSubscribeConfig(t),this.doSubscribe(e)):(this.logger.log("subscribe() [订阅远端: ${stream.stringStreamID}]"),this.doSubscribe(e));this.logger.warn("subscribe() 已开启空间音频，跳过用户订阅步骤")}async doSubscribe(e){var t,r,n,i,s,a;const c=e.getId();if(!this.adapterRef._mediasoup){const e="subscribe() 媒体mediasoup模块缺失";throw this.logger.error(e),new f.default({code:m.default.UNKNOWN_TYPE_ERROR,message:e})}try{if(e.subConf.audio)!1===(null===(t=this.adapterRef.permKeyInfo)||void 0===t?void 0:t.subAudioRight)?(this.logger.error("subscribe() permKey权限控制你没有权限订阅audio"),this.adapterRef.instance.emit("error","no-subscribe-audio-permission")):e.pubStatus.audio.audio&&!e.pubStatus.audio.consumerId&&(this.logger.log(`subscribe() 开始订阅 ${e.getId()} 音频流`),e.pubStatus.audio.consumerStatus="start",await this.adapterRef._mediasoup.createConsumer(c,"audio","audio",e.pubStatus.audio.producerId),e.pubStatus.audio.consumerStatus="end",this.logger.log(`subscribe() 订阅 ${e.getId()} 音频流完成`));else if(e.pubStatus.audio.consumerId&&"start"!==e.pubStatus.audio.stopconsumerStatus){this.logger.log(`subscribe() 开始取消订阅 ${e.getId()} 音频流`),e.pubStatus.audio.stopconsumerStatus="start",await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.audio.consumerId,e,"audio"),this.adapterRef.instance.removeSsrc(e.getId(),"audio"),e.mediaHelper.updateStream("audio",null),e.pubStatus.audio.consumerId="",e.stop("audio"),e.pubStatus.audio.stopconsumerStatus="end",e.subStatus.audio=!1;const t=e.getId();t&&delete this.adapterRef.remoteAudioStats[t],this.logger.log(`subscribe() 取消订阅 ${e.getId()} 音频流完成`)}if(e.subConf.audioSlave)!1===(null===(r=this.adapterRef.permKeyInfo)||void 0===r?void 0:r.subAudioRight)?(this.logger.error("subscribe() permKey权限控制你没有权限订阅audio slave"),this.adapterRef.instance.emit("error","no-subscribe-audio-slave-permission")):e.pubStatus.audioSlave.audioSlave&&!e.pubStatus.audioSlave.consumerId&&(this.logger.log(`subscribe() 开始订阅 ${e.getId()} 音频辅流`),e.pubStatus.audioSlave.consumerStatus="start",await this.adapterRef._mediasoup.createConsumer(c,"audio","audioSlave",e.pubStatus.audioSlave.producerId),e.pubStatus.audioSlave.consumerStatus="end",this.logger.log(`subscribe() 订阅 ${e.getId()} 音频辅流完成`));else if(e.pubStatus.audioSlave.consumerId&&"start"!==e.pubStatus.audioSlave.stopconsumerStatus){this.logger.log(`subscribe() 开始取消订阅 ${e.getId()} 音频辅流`),e.pubStatus.audioSlave.stopconsumerStatus="start",await(null===(n=this.adapterRef._mediasoup)||void 0===n?void 0:n.destroyConsumer(e.pubStatus.audioSlave.consumerId,e,"audioSlave")),this.adapterRef.instance.removeSsrc(e.getId(),"audioSlave"),e.mediaHelper.updateStream("audioSlave",null),e.pubStatus.audioSlave.consumerId="",e.stop("audioSlave"),e.pubStatus.audioSlave.stopconsumerStatus="end",e.subStatus.audioSlave=!1;const t=e.getId();t&&delete this.adapterRef.remoteAudioSlaveStats[t],this.logger.log("subscribe() 取消订阅 ${stream.getId()} 音频辅流完成")}if(e.subConf.video)if(!1===(null===(i=this.adapterRef.permKeyInfo)||void 0===i?void 0:i.subVideoRight))this.logger.error("subscribe() permKey权限控制你没有权限订阅video"),this.adapterRef.instance.emit("error","no-subscribe-video-permission");else if(e.pubStatus.video.video&&!e.pubStatus.video.consumerId){let t;this.logger.log(`subscribe() 开始订阅 ${e.getId()} 视频流`),t=e.subConf.highOrLow.video===o.STREAM_TYPE.LOW?0:1,await this.adapterRef._mediasoup.createConsumer(c,"video","video",e.pubStatus.video.producerId,t),this.logger.log(`subscribe() 订阅 ${e.getId()} 视频流完成`)}else this.logger.log("subscribe() stream.pubStatus.video: ",JSON.stringify(e.pubStatus.video));else e.pubStatus.video.consumerId&&"start"!==e.pubStatus.video.stopconsumerStatus&&(this.logger.log("`subscribe() 开始取消订阅 ${stream.getId()} 视频流`"),e.pubStatus.video.stopconsumerStatus="start",await(null===(s=this.adapterRef._mediasoup)||void 0===s?void 0:s.destroyConsumer(e.pubStatus.video.consumerId,e,"video")),this.adapterRef.instance.removeSsrc(e.getId(),"video"),e.mediaHelper.updateStream("video",null),e.pubStatus.video.consumerId="",e.stop("video"),e.pubStatus.video.stopconsumerStatus="end",e.subStatus.video=!1,this.logger.log(`subscribe() 取消订阅 ${e.getId()} 视频流完成`));if(e.subConf.screen){if(!1===(null===(a=this.adapterRef.permKeyInfo)||void 0===a?void 0:a.subVideoRight))this.logger.error("subscribe() permKey权限控制你没有权利订阅screen"),this.adapterRef.instance.emit("error","no-subscribe-screen-permission");else if(e.pubStatus.screen.screen&&!e.pubStatus.screen.consumerId){let t;this.logger.log(`subscribe() 开始订阅 ${e.getId()} 辅流`),t=e.subConf.highOrLow.screen===o.STREAM_TYPE.LOW?0:1,await this.adapterRef._mediasoup.createConsumer(c,"video","screenShare",e.pubStatus.screen.producerId,t),this.logger.log(`subscribe() 订阅 ${e.getId()} 辅流完成`)}}else if(e.pubStatus.screen.consumerId&&"start"!==e.pubStatus.screen.stopconsumerStatus){this.logger.log(`subscribe() 开始取消订阅 ${e.getId()} 辅流`),e.pubStatus.screen.stopconsumerStatus="start",await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.screen.consumerId,e,"screen"),this.adapterRef.instance.removeSsrc(e.getId(),"screen"),e.mediaHelper.updateStream("screen",null),e.pubStatus.screen.consumerId="",e.stop("screen"),e.pubStatus.screen.stopconsumerStatus="end",e.subStatus.screen=!1;const t=e.getId();t&&delete this.adapterRef.remoteScreenStats[t],this.logger.log(`subscribe() 取消订阅 ${e.getId()} 辅流完成`)}this.apiFrequencyControl({name:"subscribe",code:0,param:JSON.stringify({reason:"",subStatus:e.subStatus,subConf:e.subConf,pubStatus:e.pubStatus},null," ")})}catch(t){if("resetConsumeRequestStatus"===t)return void this.logger.warn("subscribe() API调用被打断");throw this.logger.error("subscribe() 内部错误: ",t.message),this.apiFrequencyControl({name:"subscribe",code:-1,param:JSON.stringify({reason:t.message,subStatus:e.subStatus,subConf:e.subConf,pubStatus:e.pubStatus},null," ")}),new f.default({code:t.getCode&&t.getCode()||m.default.UNKNOWN_TYPE_ERROR,message:t.getCode&&t.getMessage()||`subscribe() 内部错误: ${t.name}, ${t.message}`})}}async unsubscribe(e,t){if(g.checkExists({tag:"client.unsubscribe:stream",value:e}),!t)return this.logger.log(`unsubscribe() [取消订阅远端: ${e.getId()}]`),this.doUnsubscribe(e);{g.checkValidObject({tag:"client.unsubscribe:unsubscribeOptions",value:t}),this.logger.log(`unsubscribe ${e.getId()} ${JSON.stringify(t)}`);const r={audio:e.subConf.audio,audioSlave:e.subConf.audio,video:e.subConf.video,screen:e.subConf.screen};p.MediaTypeList.forEach((e=>{!0===t[e]&&(r[e]=!1)})),e.doSetSubscribeConfig(r),this.doSubscribe(e)}}async doUnsubscribe(e,t){if(!this.adapterRef._mediasoup){const e="unsubscribe() 媒体mediasoup模块缺失";throw this.logger.error(e),new f.default({code:m.default.UNKNOWN_TYPE_ERROR,message:e})}try{if((void 0===t||"audio"===t)&&e.pubStatus.audio.consumerId&&"start"!==e.pubStatus.audio.stopconsumerStatus){this.logger.log(`unsubscribe() [开始取消订阅 ${e.getId()}] 的音频流`),e.pubStatus.audio.stopconsumerStatus="start",await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.audio.consumerId,e,"audio"),this.adapterRef.instance.removeSsrc(e.getId(),"audio"),e.mediaHelper.updateStream("audio",null),e.pubStatus.audio.consumerId="",e.stop("audio"),e.pubStatus.audio.stopconsumerStatus="end",e.subStatus.audio=!1;const t=e.getId();t&&delete this.adapterRef.remoteAudioStats[t],this.logger.log(`unsubscribe() [取消订阅 ${e.getId()}] 的音频流完成`)}if((void 0===t||"audioSlave"===t)&&e.pubStatus.audioSlave.consumerId&&"start"!==e.pubStatus.audioSlave.stopconsumerStatus){this.logger.log(`unsubscribe() [开始取消订阅 ${e.getId()}] 的音频辅流`),e.pubStatus.audioSlave.stopconsumerStatus="start",await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.audioSlave.consumerId,e,"audioSlave"),this.adapterRef.instance.removeSsrc(e.getId(),"audioSlave"),e.mediaHelper.updateStream("audioSlave",null),e.pubStatus.audioSlave.consumerId="",e.stop("audioSlave"),e.pubStatus.audioSlave.stopconsumerStatus="end",e.subStatus.audioSlave=!1;const t=e.getId();t&&delete this.adapterRef.remoteAudioSlaveStats[t],this.logger.log(`unsubscribe() [取消订阅 ${e.getId()}] 的音频辅流完成`)}if(void 0!==t&&"video"!==t||!e.pubStatus.video.consumerId||"start"===e.pubStatus.video.stopconsumerStatus||(this.logger.log(`unsubscribe() [开始取消订阅 ${e.getId()}] 的视频流`),e.pubStatus.video.stopconsumerStatus="start",await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.video.consumerId,e,"video"),this.adapterRef.instance.removeSsrc(e.getId(),"video"),e.mediaHelper.updateStream("video",null),e.pubStatus.video.consumerId="",e.stop("video"),e.pubStatus.video.stopconsumerStatus="end",e.subStatus.video=!1,e.getId(),this.logger.log(`unsubscribe() [取消订阅 ${e.getId()}] 的视频流完成`)),(void 0===t||"screen"===t)&&e.pubStatus.screen.consumerId&&"start"!==e.pubStatus.screen.stopconsumerStatus){this.logger.log(`unsubscribe() [开始取消订阅 ${e.getId()}] 的视频辅流`),e.pubStatus.screen.stopconsumerStatus="start",await this.adapterRef._mediasoup.destroyConsumer(e.pubStatus.screen.consumerId,e,"screen"),this.adapterRef.instance.removeSsrc(e.getId(),"screen"),e.mediaHelper.updateStream("screen",null),e.pubStatus.screen.consumerId="",e.stop("screen"),e.pubStatus.screen.stopconsumerStatus="end",e.subStatus.screen=!1;const t=e.getId();t&&delete this.adapterRef.remoteScreenStats[t],this.logger.log(`unsubscribe() [取消订阅 ${e.getId()}] 的视频辅流完成`)}this.apiFrequencyControl({name:"unsubscribe",code:0,param:JSON.stringify({clientUid:this.getUid(),streamId:e.stringStreamID,reason:"",subStatus:e.subStatus,subConf:e.subConf},null," ")})}catch(t){throw this.logger.error("unsubscribe() 内部错误:",t,t.name,t.message),this.apiFrequencyControl({name:"unsubscribe",code:-1,param:JSON.stringify({clientUid:this.getUid(),streamId:e.stringStreamID,reason:t.message,subStatus:e.subStatus,subConf:e.subConf},null," ")}),new f.default({code:t.getCode&&t.getCode()||m.default.UNKNOWN_TYPE_ERROR,message:t.getCode&&t.getMessage()||`unsubscribe() 内部错误: ${t.name}, ${t.message}`})}}async setRemoteVideoStreamType(e,t){var r;this.logger.log(`setRemoteVideoStreamType() uid ${e.getId()} 订阅成员的${t?"小":"大"}流`,t);try{await(null===(r=this.adapterRef._mediasoup)||void 0===r?void 0:r.setConsumerPreferredLayer(e,t?0:1,"video")),e.subConf.highOrLow.video=t,this.apiFrequencyControl({name:"setRemoteVideoStreamType",code:0,param:JSON.stringify({clientUid:this.getUid(),streamId:e.stringStreamID,highOrLow:t},null," ")})}catch(r){throw this.logger.error("setRemoteVideoStreamType() 内部错误: ",r.message),this.apiFrequencyControl({name:"setRemoteVideoStreamType",code:-1,param:JSON.stringify({clientUid:this.getUid(),streamId:e.stringStreamID,reason:r.message,highOrLow:t},null," ")}),new f.default({code:r.getCode&&r.getCode()||m.default.UNKNOWN_TYPE_ERROR,message:r.getMessage&&r.getMessage()||"内部错误: "+r.message})}}async setRemoteStreamType(e,t,r){var n;this.logger.log(`setRemoteStreamType() 订阅${e.getId()}成员${t}媒体的${t?"小":"大"}流`);try{await(null===(n=this.adapterRef._mediasoup)||void 0===n?void 0:n.setConsumerPreferredLayer(e,t?0:1,r)),e.subConf.highOrLow[r]=t,this.apiFrequencyControl({name:"setRemoteStreamType",code:0,param:{highOrLow:t,mediaType:r,clientUid:this.getUid(),streamID:e.stringStreamID}})}catch(n){throw this.logger.error("setRemoteStreamType() 内部错误: ",n.message),this.apiFrequencyControl({name:"setRemoteVideoStreamType",code:-1,param:JSON.stringify({reason:n.message,highOrLow:t,mediaType:r,streamID:e.stringStreamID},null," ")}),new f.default({code:n.getCode&&n.getCode()||m.default.UNKNOWN_TYPE_ERROR,message:n.getMessage&&n.getMessage()||"setRemoteStreamType() 内部错误: "+n.message})}}enableAudioVolumeIndicator(){this.logger.log("开启音量提醒")}enableDualStream(e={video:!0,screen:!1}){this.adapterRef.channelInfo.videoLow=e.video,this.adapterRef.channelInfo.screenLow=e.screen,this.logger.log("enableDualStream() 开启双流模式"),this.apiFrequencyControl({name:"enableDualStream",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",video:e.video,screen:e.screen,reason:""}})}disableDualStream(e={video:!1,screen:!1}){this.logger.log("disableDualStream() 关闭双流模式"),this.adapterRef.channelInfo.videoLow=!1,this.adapterRef.channelInfo.screenLow=!1,this.apiFrequencyControl({name:"disableDualStream",code:0,param:{clientUid:this.adapterRef.channelInfo.uid||"",video:e.video,screen:e.screen,reason:""}})}setPlaybackVolume(e){let t,r;if(!Number.isInteger(e)||e<0||e>100)t=m.default.SET_AUDIO_VOLUME_ARGUMENTS_ERROR,r="setPlaybackVolume() volume 应该为 0 - 100 的整数";else{const t=e/100;this.logger.log(`setPlaybackVolume: ${this.adapterRef.nomalizedPlaybackVolume} => ${t} normalized`),this.adapterRef.nomalizedPlaybackVolume=t}if(this.apiFrequencyControl({name:"setPlaybackVolume",code:t?-1:0,param:{volume:e}}),t)throw this.logger.error(r),new f.default({code:t,message:r});for(let e in this.adapterRef.remoteStreamMap){const t=this.adapterRef.remoteStreamMap[e];t.active&&t._play.updatePlaybackVolume()}}async setClientRole(e){var t;let r,n,i;if("host"===e||"broadcaster"===e?r=0:"audience"===e?r=1:(i="setClientRole() 无法识别的角色："+e,this.logger.error(i),n=m.default.ROLE_TYPE_ERROR,r=-1),!n){const o=this.adapterRef.channelInfo&&this.adapterRef.channelInfo.uid||"";if(r===this._roleInfo.userRole)this.logger.warn(`setClientRole() 用户${o}的角色已经是${e}了`);else switch(this.adapterRef.connectState.curState){case"CONNECTED":1===r&&this.adapterRef.localStream&&this.isPublished(this.adapterRef.localStream)&&(this.logger.info(`setClientRole() 主播 ${o}将设为观众，自动Unpublish中`),await this.unpublish(this.adapterRef.localStream)),await(null===(t=this.adapterRef._mediasoup)||void 0===t?void 0:t.updateUserRole(r)),this._roleInfo.userRole!==r&&(this._roleInfo.userRole=r,this.logger.info(`setClientRole() 本地用户${o} 设置角色为 ${e}`),this.safeEmit("client-role-changed",{role:e}));break;case"DISCONNECTED":this._roleInfo.userRole!==r&&(this._roleInfo.userRole=r,this.logger.info(`setClientRole() 本地用户${o}设置角色为 ${e}`),this.safeEmit("client-role-changed",{role:e}));break;default:i=`setClientRole() 本地用户${o}当前不在频道中，可能是网络波动导致暂时断开连接`,this.logger.error(i),n=m.default.USER_NOT_IN_CHANNEL_ERROR}}if(this.apiFrequencyControl({name:"setClientRole",code:n?-1:0,param:{role:e,reason:n}}),n)throw new f.default({code:n,message:i})}bindLocalStream(e){this.adapterRef.localStream=e,e.client=this,e.logger.parent=this.logger;const t=this.getUid();t&&e.streamID!==t&&(this.logger.warn("localStream更换streamID",e.streamID,"=>",t),e.streamID=t,e.stringStreamID=t.toString())}getConnectionState(){return this.apiFrequencyControl({name:"getConnectionState",code:0,param:JSON.stringify({},null," ")}),this.adapterRef.connectState.curState}getSystemStats(){return navigator.getBattery?new Promise(((e,t)=>{navigator.getBattery().then((function(t){e(100*t.level)}))})):Promise.reject(new f.default({code:m.default.GET_SYSTEM_STATS_NOT_SUPPORT_ERROR,message:"getSystemStats() 浏览器不支持, 建议使用最新版的 Chrome 浏览器"}))}getSessionStats(){return new Promise(((e,t)=>{this.adapterRef.sessionStats.Duration=(Date.now()-this.adapterRef.state.startSessionTime)/1e3,this.adapterRef.sessionStats.UserCount=Object.keys(this.adapterRef.memberMap).length+1,e(this.adapterRef.sessionStats)}))}getTransportStats(){return new Promise(((e,t)=>{e(this.adapterRef.transportStats)}))}getLocalAudioStats(){return new Promise(((e,t)=>{e(this.adapterRef.localAudioStats)}))}getLocalAudioSlaveStats(){return new Promise(((e,t)=>{e(this.adapterRef.localAudioSlaveStats)}))}getLocalVideoStats(e){let t=[];return e&&"video"!==e||(t=t.concat(this.adapterRef.localVideoStats)),e&&"screen"!==e||(t=t.concat(this.adapterRef.localScreenStats)),Promise.resolve(t)}getRemoteAudioStats(){return new Promise(((e,t)=>{e(this.adapterRef.remoteAudioStats)}))}getRemoteAudioSlaveStats(){return new Promise(((e,t)=>{e(this.adapterRef.remoteAudioSlaveStats)}))}getRemoteVideoStats(e){let t={};return e&&"screen"!==e||(t=Object.assign(t,this.adapterRef.remoteScreenStats)),e&&"video"!==e||(t=Object.assign(t,this.adapterRef.remoteVideoStats)),Promise.resolve(t)}setChannelProfile(e){const t=(null==e?void 0:e.mode)||null;let r,n;if(this.logger.log("setChannelProfile, options: ",JSON.stringify(e,null," ")),"rtc"!==t&&"live"!==t&&(n="setChannelProfile: 参数格式错误",r=m.default.SET_CHANNEL_PROFILE_INVALID_PARAMETER_ERROR,this.logger.warn(n)),"DISCONNECTED"!==this.adapterRef.connectState.curState?(n="setChannelProfile() 请在加入房间之前调用",r=m.default.API_CALL_SEQUENCE_BEFORE_ERROR,this.logger.warn(n)):(this.adapterRef.localStream&&("live"===t?this.adapterRef.localStream.audioProfile="music_standard":"rtc"===t&&(this.adapterRef.localStream.audioProfile="speech_low_quality")),this._params.mode=t),this.apiFrequencyControl({name:"setChannelProfile",code:r?-1:0,param:{mode:JSON.stringify(e,null," "),reason:r,message:n}}),r)throw new f.default({code:r,message:n})}async updatePermKey(e){var t;try{this.logger.log("updatePermKey() permKey: "+e),this.adapterRef.channelInfo.permKey=e,await(null===(t=this.adapterRef._signalling)||void 0===t?void 0:t.updatePermKey(e)),this.adapterRef.instance.apiFrequencyControl({name:"updatePermKey",code:0,param:{permKey:e}})}catch(t){throw this.adapterRef.instance.apiFrequencyControl({name:"updatePermKey",code:t.code,param:{permKey:e,reason:t.message}}),t}}async addTasks(e){var t;const{rtmpTasks:r=[]}=e;let n,i;if(this.logger.log("addTasks() 增加互动直播推流任务, options: ",JSON.stringify(e)),r&&Array.isArray(r)&&r.length?1===this._roleInfo.userRole?(i="addTasks() 观众不允许进行添加推流任务",n=m.default.TASKS_ROLE_ERROR):this.adapterRef._meetings||(i="addTasks() 加入房间后进行添加推流任务",n=m.default.API_CALL_SEQUENCE_AFTER_ERROR):(i="addTasks() 参数格式错误, rtmpTasks为空, 或者该数组长度为空",n=m.default.ADD_TASK_PARAMETER_ERROR),n)throw this.logger.error(i),this.adapterRef.instance.apiFrequencyControl({name:"addTasks",code:-1,param:{clientUid:this.getUid(),reason:n,message:i}}),new f.default({code:n,message:i});try{await(null===(t=this.adapterRef._meetings)||void 0===t?void 0:t.addTasks(e)),this.adapterRef.instance.apiFrequencyControl({name:"addTasks",code:0,param:{lbsAddrs:this.adapterRef.lbsManager.getReportField("call"),clientUid:this.getUid()}})}catch(e){throw this.adapterRef.instance.apiFrequencyControl({name:"addTasks",code:-1,param:{clientUid:this.getUid(),lbsAddrs:this.adapterRef.lbsManager.getReportField("call"),message:e.message}}),e}}async deleteTasks(e){var t;const{taskIds:r=[]}=e;let n,i;if(this.logger.log("deleteTasks() 删除互动直播推流任务, options: ",e),r&&Array.isArray(r)&&r.length?1===this._roleInfo.userRole?(i="deleteTasks() 观众不允许删除推流任务",n=m.default.TASKS_ROLE_ERROR):this.adapterRef._meetings||(i="deleteTasks() 加入房间后才能删除推流任务",n=m.default.API_CALL_SEQUENCE_AFTER_ERROR):(i="deleteTasks() 参数格式错误, taskIds为空, 或者该数组长度为空",n=m.default.DELETE_TASK_PARAMETER_ERROR),n)throw this.logger.error(i),this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:-1,param:{clientUid:this.getUid(),reason:n,message:i}}),new f.default({code:n,message:i});try{await(null===(t=this.adapterRef._meetings)||void 0===t?void 0:t.deleteTasks(e)),this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:0,param:{lbsAddrs:this.adapterRef.lbsManager.getReportField("call"),clientUid:this.getUid()}})}catch(e){throw this.adapterRef.instance.apiFrequencyControl({name:"deleteTasks",code:-1,param:{clientUid:this.getUid(),lbsAddrs:this.adapterRef.lbsManager.getReportField("call"),reason:e.message}}),e}}async updateTasks(e){var t;const{rtmpTasks:r=[]}=e;let n,i;if(this.logger.log("updateTasks() 更新互动直播推流任务, options: ",e),r&&Array.isArray(r)&&r.length?1===this._roleInfo.userRole?(i="updateTasks() 观众不允许进行添加推流任务",n=m.default.TASKS_ROLE_ERROR):this.adapterRef._meetings||(i="updateTasks() 加入房间后进行添加推流任务",n=m.default.API_CALL_SEQUENCE_AFTER_ERROR):(i="updateTasks() 参数格式错误, rtmpTasks为空, 或者该数组长度为空",n=m.default.UPDATE_TASK_PARAMETER_ERROR),n)throw this.logger.error(i),this.adapterRef.instance.apiFrequencyControl({name:"updateTasks",code:-1,param:{clientUid:this.getUid(),reason:n,message:i}}),new f.default({code:n,message:i});try{await(null===(t=this.adapterRef._meetings)||void 0===t?void 0:t.updateTasks(e)),this.adapterRef.instance.apiFrequencyControl({name:"onUpdateTasks",code:0,param:{clientUid:this.getUid(),lbsAddrs:this.adapterRef.lbsManager.getReportField("call")}})}catch(e){throw this.adapterRef.instance.apiFrequencyControl({name:"onUpdateTasks",code:-1,param:{clientUid:this.getUid(),lbsAddrs:this.adapterRef.lbsManager.getReportField("call"),reason:e.message}}),e}}async pauseReconnection(){this.logger.log("pauseReconnection：下一次重连行为会被暂停，直到调用resumeReconnection()方法");const e=await new Promise((e=>{this.adapterRef._signalling&&this.adapterRef._signalling.reconnectionControl.pausers.push(e)}));return this.logger.log("pauseReconnection：重连已被暂停："+JSON.stringify(e)),e}async resumeReconnection(){if(this.adapterRef._signalling){this.adapterRef._signalling.reconnectionControl.blocker?(this.logger.log("resumeReconnection：即将恢复重连过程"),this.adapterRef._signalling.reconnectionControl.blocker(),this.adapterRef._signalling.reconnectionControl.pausers.forEach((e=>e({reason:"reconnection-resume"}))),this.adapterRef._signalling.reconnectionControl.pausers=[]):this.adapterRef._signalling.reconnectionControl.pausers.length?(this.logger.log("resumeReconnection：取消之前的 pauseReconnection 操作。"),this.adapterRef._signalling.reconnectionControl.pausers.forEach((e=>e({reason:"cancelled"}))),this.adapterRef._signalling.reconnectionControl.pausers=[]):this.logger.warn("resumeReconnection：未发现pauseReconnection操作");const e=await new Promise((e=>{var t;null===(t=this.adapterRef._signalling)||void 0===t||t.reconnectionControl.resumers.push(e)}));return this.logger.log("resumeReconnection：恢复重连成功"+JSON.stringify(e)),e}}refreshRemoteEvents(){for(let e in this.adapterRef.remoteStreamMap){const t=this.adapterRef.remoteStreamMap[e];this.logger.warn("refreshRemoteEvents peer-online",e),this.safeEmit("peer-online",{uid:e}),p.MediaTypeList.forEach((r=>{t.pubStatus[r].producerId&&(this.logger.warn("refreshRemoteEvents stream-added",e,r),this.safeEmit("stream-added",{stream:t,mediaType:r}),t.muteStatus[r].send&&(this.logger.warn("refreshRemoteEvents mute-"+r,e,r),this.safeEmit("mute-"+r,{uid:t.getId()})))}))}}initSpatialManager(e){if(!this.spatialManager){const t=d.getAudioContext();if(!t)return void this.logger.error("当前环境不支持WebAudio");this.spatialManager=new y.SpatialManager({client:this,options:e,context:t})}this.spatialManager.init(),this.spatialManager.play()}syncUserList(){return this.adapterRef.memberMap}updateRecordingAudioStream(){if(!this.recordManager||!this.recordManager.formatMedia||!this.recordManager.formatMedia.destination)return;this.logger.log("updateRecordingAudioStream() [更新录制的音频]");const e=[];if(this.adapterRef.remoteStreamMap)for(var t in this.adapterRef.remoteStreamMap){const r=this.adapterRef.remoteStreamMap[t];e.push(r.mediaHelper.audio.audioStream)}this.adapterRef.localStream&&e.push(this.adapterRef.localStream.mediaHelper.audio.audioStream),this.recordManager.formatMedia.updateStream(e)}async startMediaRecording(e){const{recorder:t,recordConfig:r}=e;this.recordManager.record||(this.recordManager.record=new l.Record({logger:this.logger,client:this.adapterRef.instance}),this.recordManager.record.on("media-recording-stopped",(e=>{this.safeEmit("@media-recording-stopped")}))),this.recordManager.formatMedia||(this.recordManager.formatMedia=new c.FormatMedia({adapterRef:this.adapterRef}));const n=[];if(this.adapterRef.localStream&&n.push(this.adapterRef.localStream.mediaHelper.audio.audioStream),"all"===t&&this.adapterRef.remoteStreamMap)for(var i in this.adapterRef.remoteStreamMap){const e=this.adapterRef.remoteStreamMap[i];n.push(e.mediaHelper.audio.audioStream)}const o=await this.recordManager.formatMedia.formatAudio(n),s=await this.recordManager.formatMedia.formatVideo(t,r),a=[];if(a.push(o,s),0!==a.length)return this.recordManager.record.start({uid:"",type:(null==r?void 0:r.recordType)||"video",recordName:null==r?void 0:r.recordName,reset:!0,stream:a});this.logger.log("没有没发现要录制的媒体流")}stopMediaRecording(e){if(!this.recordManager.record)throw new f.default({code:m.default.RECORDING_NOT_START_ERROR,message:"stopMediaRecording() 录制未开始"});return this.recordManager.record.stop({})}cleanMediaRecording(){if(!this.recordManager.record)throw new f.default({code:m.default.RECORDING_NOT_START_ERROR,message:"stopMediaRecording() 录制未开始"});return this.recordManager.record.clean()}downloadMediaRecording(){if(!this.recordManager.record)throw new f.default({code:m.default.RECORDING_NOT_START_ERROR,message:"stopMediaRecording() 录制未开始"});return this.recordManager.record.download()}async destroy(){const e=await this.operationQueue.enqueue({caller:this,method:"destroy",options:null});this.logger&&this.logger.warn("清除 Client 实例中"),this._reset(),this.destroyed=!0,this.logger&&this.logger.warn("已清除 Client 实例"),e()}}t.Client=b},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.ENV=t.LBS_BUILD_CONFIG=t.Config=void 0,t.Config={lbsUrl:"https://wecan-lbs.netease.im/api/v1/web_domains",checkSumUrl:"https://nrtc.netease.im/demo/getChecksum.action",createChannelUrl:"https://nrtc.netease.im/nrtc/createChannel.action",getChannelInfoUrl:"https://nrtc.netease.im/nrtc/getChannelInfos.action",roomsTaskUrl:"https://roomserver.netease.im/v2/sdk/rooms/",getCloudProxyInfoUrl:"https://ap-prd-jd.netease.im/v1/g2/getCloudProxyInfo"},t.LBS_BUILD_CONFIG={lbs:["wecan-lbs.netease.im","wecan-lbs.yunxinvcloud.com"],nrtc:["nrtc.netease.im","wecan-gw.yunxinvcloud.com"],call:["roomserver.netease.im","wecan-sdk.yunxinvcloud.com"],tracking:["statistic.live.126.net","apm.yunxinhi.com"]},t.ENV="production"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.logHelper=void 0,t.logHelper=class{constructor(e){if(e.maxLogsLines&&"number"==typeof e.maxLogsLines&&!isNaN(e.maxLogsLines)?this.maxLogsLines=e.maxLogsLines:this.maxLogsLines=5e3,e.logFilename&&(e.logFilename=e.logFilename+".txt"),this.useTimestamps=e.useTimestamps||!1,this.useLocalStorage=e.useLocalStorage||!1,this.autoTrim=!0,this.maxLines=e.maxLogsLines||5e3,this.tailNumLines=100,this.logFilename=e.logFilename||"nimWebRtcLog.txt",this.maxDepth=5,this.depth=0,this.parentSizes=[0],this.currentResult="",this.startTime=new Date,this.output="",this.useLocalStorage){var t=window.localStorage.getItem("nimWebRtcLog");if(t){var r=JSON.parse(t);this.output=r.log;var n=new Date(r.startTime),i=new Date(r.lastLog);this.output+="\n---- Session end: "+r.lastLog+" ----\n",this.output+=this.formatSessionDuration(n.getTime(),i.getTime()),this.output+="\n\n"}}this.output+="---- Session started: "+this.startTime+" ----\n\n"}getLog(){var e=new Date;if(this.useLocalStorage){var t=window.localStorage.getItem("nimWebRtcLog");if(t){var r=JSON.parse(t);this.startTime=new Date(r.startTime),this.output=r.log,e=new Date(r.lastLog)}}return this.output+"\n---- Log retrieved: "+e+" ----\n"+this.formatSessionDuration(this.startTime.getTime(),e.getTime())}tail(e){return e=e||this.tailNumLines,this.trimLog(this.getLog(),e)}search(e){for(var t=this.output.split("\n"),r=new RegExp(e),n=[],i=0;i<t.length;i++){var o="["+i+"] ";t[i].match(r)&&n.push(o+t[i])}var s=n.join("\n");return 0==s.length&&(s='Nothing found for "'+e+'".'),s}getSlice(e,t){return this.output.split("\n").slice(e,e+t).join("\n")}downloadLog(){var e=this.getLog(),t=new Blob([e],{type:"data:text/plain;charset=utf-8"}),r=document.createElement("a");r.href=window.URL.createObjectURL(t),r.target="_blank",r.download=this.logFilename,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(r.href)}clear(){var e=new Date;if(this.output="---- Log cleared: "+e+" ----\n",this.useLocalStorage){var t={startTime:this.startTime,log:this.output,lastLog:e},r=JSON.stringify(t);window.localStorage.setItem("nimWebRtcLog",r)}}log(e){var t=this.determineType(e);if(null!=t){var r=this.formatType(t,e);if(this.useTimestamps){var n=new Date;this.output+=this.formatTimestamp(n)}if(this.output+=r+"\n",this.autoTrim&&(this.output=this.trimLog(this.output,this.maxLines)),this.useLocalStorage){var i=new Date,o={startTime:this.startTime,log:this.output,lastLog:i},s=JSON.stringify(o);window.localStorage.setItem("nimWebRtcLog",s)}}this.depth=0,this.parentSizes=[0],this.currentResult=""}determineType(e){if(null!=e){var t=typeof e;return"object"==t?null==e.length?"function"==typeof e.getTime?"Date":"function"==typeof e.test?"RegExp":"Object":"Array":t}return"null"}formatType(e,t){if(this.maxDepth&&this.depth>=this.maxDepth)return"... (max-depth reached)";switch(e){case"Object":this.currentResult+="{\n",this.depth++,this.parentSizes.push(this.objectSize(t));var r=0;for(var n in t){this.currentResult+=this.indentsForDepth(this.depth),this.currentResult+=n+": ";var i=this.determineType(t[n]);(o=this.formatType(i,t[n]))?("function"!==i&&(this.currentResult+=o),r!=this.parentSizes[this.depth]-1&&(this.currentResult+=","),this.currentResult+="\n"):(r!=this.parentSizes[this.depth]-1&&(this.currentResult+=","),this.currentResult+="\n"),r++}if(this.depth--,this.parentSizes.pop(),this.currentResult+=this.indentsForDepth(this.depth),this.currentResult+="}",0==this.depth)return this.currentResult;break;case"Array":for(this.currentResult+="[",this.depth++,this.parentSizes.push(t.length),r=0;r<t.length;r++){var o;"Object"!=(i=this.determineType(t[r]))&&"Array"!=i||(this.currentResult+="\n"+this.indentsForDepth(this.depth)),(o=this.formatType(i,t[r]))?(this.currentResult+=o,r!=this.parentSizes[this.depth]-1&&(this.currentResult+=", "),"Array"==i&&(this.currentResult+="\n")):(r!=this.parentSizes[this.depth]-1&&(this.currentResult+=", "),("Object"!=i||r==this.parentSizes[this.depth]-1)&&(this.currentResult+="\n"))}if(this.depth--,this.parentSizes.pop(),this.currentResult+="]",0==this.depth)return this.currentResult;break;case"function":var s=(t+="").split("\n");for(r=0;r<s.length;r++)s[r].match(/\}/)&&this.depth--,this.currentResult+=this.indentsForDepth(this.depth),s[r].match(/\{/)&&this.depth++,this.currentResult+=s[r]+"\n";return this.currentResult;case"RegExp":return"/"+t.source+"/";case"Date":case"string":return this.depth>0||0==t.length?'"'+t+'"':t;case"boolean":return t?"true":"false";case"number":return t+""}}indentsForDepth(e){for(var t="",r=0;r<e;r++)t+="\t";return t}trimLog(e,t){var r=e.split("\n");return r.length>t&&(r=r.slice(r.length-t)),r.join("\n")}lines(){return this.output.split("\n").length}formatSessionDuration(e,t){var r=t-e,n=Math.floor(r/1e3/60/60),i=("0"+n).slice(-2);r-=1e3*n*60*60;var o=Math.floor(r/1e3/60),s=("0"+o).slice(-2);r-=1e3*o*60;var a=Math.floor(r/1e3);return r-=1e3*a,"---- Session duration: "+i+":"+s+":"+("0"+a).slice(-2)+" ----"}formatTimestamp(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"]: "}objectSize(e){var t,r=0;for(t in e)e.hasOwnProperty&&e.hasOwnProperty(t)&&r++;return r}}},function(e,t){var r,n;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],n=0;n<e.length;n+=3)for(var i=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?t.push(r.charAt(i>>>6*(3-o)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],n=0,i=0;n<e.length;i=++n%4)0!=i&&t.push((r.indexOf(e.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|r.indexOf(e.charAt(n))>>>6-2*i);return t}},e.exports=n},function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormatMedia=void 0;const i=r(10),o=n(r(12)),s=n(r(13)),a=r(123);class c extends i.EventEmitter{constructor(e){super(),this.adapterRef=e.adapterRef,this.logger=e.adapterRef.logger,this.audioContext=null,this.destination=null,this.audioStreams=[],this.canvas=null,this.canvasContext=null,this.canvasTimer=null}async formatAudio(e){this.logger.log("formatAudio() [混音: ]",e);try{return this.audioContext||(this.audioContext=new window.AudioContext),this.destination=this.audioContext.createMediaStreamDestination(),await this.initAudioIn(e),this.destination.stream}catch(e){return this.logger.error("formatAudio() 异常: ",e.name,e.message),Promise.reject(new s.default({code:o.default.RECORDING_NOT_SUPPORT,message:e.message||"formatAudio() 浏览器不支持"}))}}initAudioIn(e){if(this.audioContext&&this.destination){for(var t=0;t<e.length;t++){const r=e[t].getAudioTracks()[0];if("live"!==(null==r?void 0:r.readyState))continue;const n=this.audioContext.createMediaStreamSource(e[t]);n.connect(this.destination),this.audioStreams.push(n)}this.logger.log(`initAudioIn() [初始化音频 state: ${this.audioContext.state}]`),"running"!==this.audioContext.state&&this.audioContext.resume().then((()=>{this.audioContext&&this.logger.log(`initAudioIn(): [audioContext 状态变更成功 state: ${this.audioContext.state}]`)})).catch((e=>{this.logger.warn(`initAudioIn(): [audioContext 状态变更发生错误, errorName: ${e.name}, erroMessage: ${e.message}]`),this.audioContext&&this.audioContext.resume()}))}else this.logger.error("initAudioIn:参数不够")}async updateStream(e){this.logger.log("updateStream() [更新混频的音频数据: ]",e),this.audioStreams.forEach((e=>{e.disconnect(0)})),this.audioStreams.length=0,this.initAudioIn(e)}stopFormatAudio(){this.logger.log("stopFormatAudio() [结束混音]"),this.audioStreams.forEach((e=>{e.disconnect(0)})),this.audioContext&&this.audioContext.close(),this.audioContext=null,this.destination=null}async formatVideo(e,t){this.logger.log("formatVideo() 混频 recorder: ",e,"recordConfig: ",t);let r=640,n=360;const i=(null==t?void 0:t.recordVideoFrame)||15;switch(null==t?void 0:t.recordVideoQuality){case 360:r=640,n=360;break;case 480:r=640,n=480;break;case 720:r=1280,n=720}this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=a.get2DContext(this.canvas)),this.canvas.width=r,this.canvas.height=n,this.canvasTimer&&(clearInterval(this.canvasTimer),this.canvasTimer=null);const o=Math.floor(r/2),s=Math.floor(n/2),c=Math.floor(r/3),u=Math.floor(n/3);return this.canvasContext&&(this.canvasContext.fillStyle="black",this.canvasContext.fillRect(0,0,r,n)),this.canvasTimer&&clearInterval(this.canvasTimer),this.canvasTimer=setInterval((()=>{var i,a,l;this.canvasContext&&(this.canvasContext.fillStyle="black",this.canvasContext.fillRect(0,0,r,n));let d=[];if("video"===(null==t?void 0:t.recordType)&&((null===(i=this.adapterRef.localStream)||void 0===i?void 0:i._play.video.dom)?d.push(this.adapterRef.localStream._play.video.dom):d.push(document.createElement("video")),(null===(a=this.adapterRef.localStream)||void 0===a?void 0:a._play.screen.dom)&&d.push(null===(l=this.adapterRef.localStream)||void 0===l?void 0:l._play.screen.dom),"all"===e&&this.adapterRef.remoteStreamMap))for(var p in this.adapterRef.remoteStreamMap){const e=this.adapterRef.remoteStreamMap[p];e._play.video.dom&&d.push(e._play.video.dom),e._play.screen.dom&&d.push(e._play.screen.dom)}switch(d.length>9&&(d=d.filter((e=>4===e.readyState))),d.length){case 0:break;case 1:this.drawSingleVideo(d[0],0,0,r,n);break;case 2:this.drawSingleVideo(d[0],0,0,o,n),this.drawSingleVideo(d[1],o,0,o,n);break;case 3:case 4:this.drawSingleVideo(d[0],0,0,o,s),this.drawSingleVideo(d[1],o,0,o,s),this.drawSingleVideo(d[2],0,s,o,s),this.drawSingleVideo(d[3],o,s,o,s);break;default:this.drawSingleVideo(d[0],0,0,c,u),this.drawSingleVideo(d[1],c,0,c,u),this.drawSingleVideo(d[2],2*c,0,c,u),this.drawSingleVideo(d[3],0,u,c,u),this.drawSingleVideo(d[4],c,u,c,u),this.drawSingleVideo(d[5],2*c,u,c,u),this.drawSingleVideo(d[6],0,2*u,c,u),this.drawSingleVideo(d[7],c,2*u,c,u),this.drawSingleVideo(d[8],2*c,2*u,c,u)}}),Math.floor(1e3/i)),this.canvas.captureStream()}drawSingleVideo(e,t,r,n,i){var o;if(!e)return;const s=Math.min(n/e.videoWidth,i/e.videoHeight);let a=e.videoWidth*s,c=e.videoHeight*s,u=t+(n-a)/2,l=r+(i-c)/2;null===(o=this.canvasContext)||void 0===o||o.drawImage(e,u,l,a,c)}async stopFormatVideo(){this.logger.log("stopFormatAudio() [结束混频]"),this.canvasTimer&&(clearInterval(this.canvasTimer),this.canvasTimer=null),this.canvasContext=this.canvas=null}destroy(){this.logger.log("destroy()"),this.stopFormatAudio(),this.stopFormatVideo()}}t.FormatMedia=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.OperationQueue=void 0,t.OperationQueue=class{constructor(e){this.cnt=0,this.current=null,this.history=null,this.queue=[],this.logger=e.getChild((()=>{let e="oper";return this.current?e+=` ${this.current.args.method}#${this.current.id}`:this.history&&(e+=` ${this.history.args.method}#${this.history.id} FINISHED`),this.queue.forEach((t=>{e+=`|${t.args.method}#${t.id}`})),e})),setInterval((()=>{if(this.current&&Date.now()-this.current.enqueueTs>5e3){if(this.queue.length){const e=this.queue[0];this.logger.error(`当前操作已执行了${Date.now()-this.current.enqueueTs}ms，放开锁限制：${this.current.args.method}#${this.current.id}。即将进行下一个操作：${e.args.method}#${e.id}`)}else this.logger.log(`当前操作已执行了${Date.now()-this.current.enqueueTs}ms，放开锁限制：${this.current.args.method}#${this.current.id}`);this.current.status="timeout",this.history=this.current,this.current=null,this.fire("timer")}}),5e3)}enqueue(e){return new Promise(((t,r)=>{this.queue.push({id:++this.cnt,enqueueTs:Date.now(),args:e,resolve:t,reject:r,status:"pending"}),this.current?this.logger.log(`操作等位中，目前有其他操作。前面还有${this.queue.length}位：${e.method}#${this.cnt}。`):this.fire("instant")}))}fire(e){var t;if(!this.current){const r=this.queue.shift();if(r){if(null===(t=r.args.caller)||void 0===t?void 0:t.destroyed)return this.logger.error(`无法执行操作：${r.args.method}: 对象已被销毁，请重新创建对象`),void this.fire("functionEnd");this.history=this.current,this.current=r,this.current.status="live","instant"===e?this.logger.log("开始执行操作："+r.args.method):this.logger.log(`开始执行队列中的操作：${r.args.method}#${r.id}，等待时间：${Date.now()-r.enqueueTs}ms。`),r.startTs=Date.now(),r.resolve((()=>{this.current===r?(this.current.status="finished",this.history=this.current,this.current=null,this.logger.log(`执行操作结束：${r.args.method}。花费 ${r.startTs?Date.now()-r.startTs:null}ms`),this.fire("functionEnd")):"timeout"===r.status?this.logger.log(`执行操作结束：${r.args.method}。花费 ${r.startTs?Date.now()-r.startTs:null}ms。该操作超时，但未阻塞执行队列。`):this.logger.error(`操作收到多次返回：${r.args.method}#${r.id}。花费 ${r.startTs?Date.now()-r.startTs:null}ms`)}))}}}}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Base=void 0;const i=r(148),o=r(214),s=r(216),a=r(246),c=r(4),u=r(175),l=r(248),d=r(270),p=r(64),m=n(r(12)),f=n(r(13)),h=n(r(198)),g=r(71),v=r(69),y=r(149),b=r(294),S=r(68),T=r(70),_=r(57);let w=0;class M extends S.RTCEventEmitter{constructor(e){super(),this.transportRebuildCnt=0,this.timeLast=Date.now(),this._params={appkey:"",mode:"rtc"},this.isReport="boolean"!=typeof e.report||e.report,this.clientId=w++,this.adapterRef={datareportCache:[],channelInfo:{customData:"",sessionConfig:{}},apiEvent:{},apiEvents:{},requestId:{},instance:this,preferRemb:!1,deviceId:""};const t=c.getParameters().forceLogLevel;-1!==t?h.default.setLogLevel(t):!0===e.debug?h.default.setLogLevel(T.loglevels.DEBUG):!1===e.debug&&c.getParameters().logLevel<=T.loglevels.WARNING&&h.default.setLogLevel(T.loglevels.WARNING),this.logger=new v.Logger({tagGen:()=>{let e="client"+(this.clientId||"");const t=this.getUid();return t&&(e+="#"+t),"CONNECTED"!==this.adapterRef.connectState.curState&&(e+=" "+this.adapterRef.connectState.curState),this.destroyed&&(e+=" DESTROYED"),e}}),this.adapterRef.logger=this.logger,this.recordManager={record:null,formatMedia:null},this._reset(),this.adapterRef.encryption=new i.Encryption(this.adapterRef),e.debug&&(c.getParameters().debugG2=!0),this.sdkRef=e.ref}_reset(){this.sdkRef=null,this.adapterRef={datareportCache:[],audioAsl:{enabled:"unknown",aslActiveNum:-1},uid2SscrList:{},netStatusTimer:null,networkQuality:{},_statsReport:null,_meetings:null,_enableRts:!1,state:void 0,mediaCapability:void 0,nim:void 0,instance:this,lbsManager:void 0,channelInfo:{customData:"",sessionConfig:{}},apiEvent:{},memberMap:{},apiEvents:{},transportStats:{txRtt:-1,rxRtt:-1,NetworkType:"unknown",OutgoingAvailableBandwidth:-1},sessionStats:void 0,remoteAudioStats:{},remoteAudioSlaveStats:{},remoteVideoStats:{},remoteScreenStats:{},remoteStreamMap:{},localStream:null,localAudioStats:{},localAudioSlaveStats:{},localVideoStats:[],localScreenStats:[],logger:this.logger,logStorage:void 0,channelStatus:"init",_signalling:null,_rtsTransport:null,connectState:{prevState:"DISCONNECTED",curState:"DISCONNECTED",reconnect:!1},_mediasoup:null,mediaHelpers:{},netStatusList:[],requestId:{},deviceId:"",preferRemb:!1,nomalizedPlaybackVolume:1,userPriority:{priority:100,preemtiveMode:!1},proxyServer:{enable:!1,type:3},encryption:void 0,isAudioBanned:!1,isVideoBanned:!1,permKeyInfo:void 0},this.adapterRef.mediaCapability=new o.MediaCapability(this.adapterRef),this.adapterRef.encryption=new i.Encryption(this.adapterRef),this._resetState(),this.adapterRef.lbsManager=new b.LBSManager(this),this._destroyModule()}_getSupportedCodecs(){return g.getSupportedCodecs(...arguments)}initMode(){this.adapterRef._meetings||(this.adapterRef._meetings=new a.Meeting({sdkRef:this.sdkRef,adapterRef:this.adapterRef})),this.adapterRef._signalling||(this.adapterRef._signalling=new d.Signalling({adapterRef:this.adapterRef,logger:this.logger})),this.adapterRef._mediasoup||(this.adapterRef._mediasoup=new s.Mediasoup({adapterRef:this.adapterRef,logger:this.logger})),this.adapterRef._statsReport||(this.adapterRef._statsReport=new l.StatsReport({sdkRef:this.sdkRef,adapterRef:this.adapterRef,isReport:this.isReport}))}_destroyModule(){this.adapterRef._meetings&&(this.adapterRef._meetings.destroy(),this.adapterRef._meetings=null),this.adapterRef._signalling&&(this.adapterRef._signalling.destroy(),this.adapterRef._signalling=null),this.adapterRef._rtsTransport&&(this.adapterRef._rtsTransport.destroy(),this.adapterRef._rtsTransport=null),this.adapterRef._mediasoup&&(this.adapterRef._mediasoup.destroy(),this.adapterRef._mediasoup=null),this.adapterRef._statsReport&&(this.adapterRef._statsReport.destroy(),this.adapterRef._statsReport=null),this.recordManager.formatMedia&&(this.recordManager.formatMedia.destroy(),this.recordManager.formatMedia=null),this.recordManager.record&&(this.recordManager.record.destroy(),this.recordManager.record=null)}_resetState(){this._params.neRtcServerAddresses={},this.adapterRef.channelStatus="init",this.adapterRef.connectState={prevState:"DISCONNECTED",curState:"DISCONNECTED",reconnect:!1},this.adapterRef.networkQuality={},this.adapterRef.localStream=null,this.adapterRef.memberMap={},this.adapterRef.remoteStreamMap={},this.adapterRef.netStatusList=[],this.adapterRef.netStatusTimer&&(clearInterval(this.adapterRef.netStatusTimer),this.adapterRef.netStatusTimer=null),this.adapterRef.uid2SscrList={},this.adapterRef.proxyServer={enable:!1,type:3},this.adapterRef.state={lastDeviceStatus:{audio:{type:null,device:null},video:{type:null,device:null}},audioDeviceHasOpened:!1,videoDeviceHasOpened:!1,chromeScreenShareOpened:!1,startSessionTime:0,endSessionTime:0,startPubVideoTime:0,startPubScreenTime:0,getChannelInfoTime:0,signalEstablishTime:0,signalOpenTime:0,signalJoinResTime:0,signalJoinSuccessTime:0,signalAudioAddedTime:0,signalAudioSubscribedTime:0,signalVideoAddedTime:0,signalVideoSubscribedTime:0,iceRecvConnectedTime:0,domVideoAppendTime:0,videoFirstIframeTime:0,videoResizeTime:0},Object.assign(this.adapterRef,{transportStats:{NetworkType:"unknown",OutgoingAvailableBandwidth:0,txRtt:0,rxRtt:0},sessionStats:{Duration:0,RecvBitrate:0,RecvBytes:0,SendBitrate:0,SendBytes:0,UserCount:0},localAudioStats:[],localAudioSlaveStats:[],localVideoStats:[],localScreenStats:[],remoteAudioStats:{},remoteAudioSlaveStats:{},remoteVideoStats:{},remoteScreenStats:{}})}setSessionConfig(e={}){this.adapterRef.channelInfo||(this.adapterRef.channelInfo={}),this.adapterRef.channelInfo.sessionConfig||(this.adapterRef.channelInfo.sessionConfig={}),this.adapterRef.channelInfo.sessionConfig=Object.assign(this.adapterRef.channelInfo.sessionConfig,e)}resetChannel(){this.adapterRef.networkQuality={},this.adapterRef.netStatusList=[];for(let e in this.adapterRef.remoteStreamMap){const t=this.adapterRef.remoteStreamMap[e];t.active&&(t.active=!1,t.stop(),t.clearRemotePubStatus(),this.adapterRef.instance.safeEmit("peer-leave",{uid:e}))}this.adapterRef.memberMap={},this.adapterRef.uid2SscrList={},this.adapterRef._mediasoup&&this.adapterRef._mediasoup.destroy()}async startSession(e=0){0===e?this.logger.log("开始音视频会话"):this.logger.log(`开始音视频会话：第${e}次`);let{wssArr:t,cid:r}=this.adapterRef.channelInfo;if(!t||0===t.length)throw this.logger.error("没有找到服务器地址 : "+JSON.stringify(this.adapterRef.channelInfo)),this.adapterRef.channelStatus="leave",new f.default({code:m.default.JOIN_FAILED,message:"没有找到媒体服务器地址"});if(!r)throw this.logger.error("服务器没有分配cid"),new f.default({code:m.default.JOIN_FAILED,message:"服务器没有分配cid"});if(this.logger.log(`开始连接服务器: ${this.adapterRef.channelInfo.wssArrIndex}, url: ${t[this.adapterRef.channelInfo.wssArrIndex]}`),this.adapterRef.channelInfo.wssArrIndex>=t.length)throw this.logger.error("所有的服务器地址都连接失败"),new f.default({code:m.default.NETWORK_ERROR,message:"所有的服务器地址都连接失败"});if(!this.adapterRef._signalling)throw new f.default({code:m.default.UNKNOWN_TYPE_ERROR,message:"startSession: 信令模块缺失"});try{await this.adapterRef._signalling.init(!1,!1)}catch(e){throw this.adapterRef.channelStatus="leave",e}const n=t[this.adapterRef.channelInfo.wssArrIndex];t.splice(this.adapterRef.channelInfo.wssArrIndex,1),t.unshift(n),this.adapterRef.channelInfo.wssArrIndex=0,this.adapterRef._statsReport&&this.adapterRef._statsReport.start()}stopSession(){this.logger.log("开始清除音视频会话"),this._destroyModule();const e=c.getParameters().localStreams.filter((e=>e.client===this&&!e.destroyed));e.length&&(c.getParameters().keepLocalstreamOnLeave?this.logger.log("当前模式下离开频道不会销毁localStream"):(this.logger.log(`即将销毁${e.length}个localStream`),e.forEach((e=>{e.destroy()})))),Object.values(this.adapterRef.remoteStreamMap).forEach((e=>{e.destroy()})),this.adapterRef.remoteStreamMap={},this.adapterRef.memberMap={},this.adapterRef.uid2SscrList={},this._resetState()}async clearMember(e){var t;this.logger.log(e+"离开房间");const r=this.adapterRef.remoteStreamMap[e];if(null==r?void 0:r.active){for(let e of p.MediaTypeList)r.pubStatus[e].producerId&&this.adapterRef.instance.safeEmit("stream-removed",{stream:r,mediaType:e,reason:"onPeerLeave"});delete this.adapterRef.remoteStreamMap[e],delete this.adapterRef.memberMap[e],delete this.adapterRef.remoteAudioStats[e],delete this.adapterRef.remoteAudioSlaveStats[e],delete this.adapterRef.remoteVideoStats[e],delete this.adapterRef.remoteScreenStats[e];for(let e of p.MediaTypeList)r.pubStatus[e].consumerId&&await(null===(t=this.adapterRef._mediasoup)||void 0===t?void 0:t.destroyConsumer(r.pubStatus[e].consumerId,r,e));r.active=!1,r.destroy()}this.adapterRef.netStatusList=this.adapterRef.netStatusList.filter(((t,r,n)=>t.uid!==e)),this.logger.log(e+" 离开房间 通知用户"),this.adapterRef._enableRts?this.adapterRef.instance.emit("rts-peer-leave",{uid:e}):this.adapterRef.instance.safeEmit("peer-leave",{uid:e})}setStartSessionTime(){this.adapterRef.state.startSessionTime=Date.now();const e=_.generateUUID(),t=this.adapterRef.channelInfo.channelName||"",r=this.adapterRef.channelInfo.uid||0,n=Date.now(),i=y(e+t+r+n+"");this.adapterRef.deviceId=_.randomString(i,16)}setEndSessionTime(){if(!this.adapterRef.state.startSessionTime)return void this.logger.log("AbstractAdapter: setEndSessionTime: startSessionTime为空");this.adapterRef.state.endSessionTime=Date.now();const e=this.adapterRef.state.endSessionTime-this.adapterRef.state.startSessionTime;this.adapterRef.instance.safeEmit("@sessionDuration",e),this.adapterRef.state.startSessionTime=0,this.adapterRef.state.endSessionTime=0}async reBuildRecvTransport(){if(this.transportRebuildCnt++,this.transportRebuildCnt>=c.getParameters().maxTransportRebuildCnt)return void this.logger.error("reBuildRecvTransport 达到最大重连次数："+this.transportRebuildCnt);if(this.logger.warn("下行通道异常，重新建立 #"+this.transportRebuildCnt),!this.adapterRef._mediasoup)return;this.adapterRef.instance.safeEmit("@pairing-reBuildRecvTransport-start"),this.adapterRef._mediasoup._recvTransport&&(this.adapterRef._mediasoup._recvTransport.close(),this.adapterRef._mediasoup.getIceStatus("recv"),this.adapterRef._mediasoup._recvTransport=null),this.adapterRef._mediasoup.init(),this.logger.log("下行通道异常, remoteStreamMap",Object.keys(this.adapterRef.remoteStreamMap)),this.logger.log("this._eventQueue: ",this.adapterRef._mediasoup._eventQueue);let e=!1;for(const t in this.adapterRef.remoteStreamMap){const r=this.adapterRef.remoteStreamMap[t];if(r){r.pubStatus.audio.consumerStatus="init",r.pubStatus.video.consumerStatus="init",r.pubStatus.screen.consumerStatus="init",r.pubStatus.audio.consumerId="",r.pubStatus.video.consumerId="",r.pubStatus.screen.consumerId="",this.logger.log("重连逻辑订阅 start：",r.stringStreamID);try{await this.doSubscribe(r)}catch(t){this.logger.error("重连逻辑订阅 error: ",t,t.name,t.message),e=!0,this.adapterRef.instance.safeEmit("@pairing-reBuildRecvTransport-error");break}this.logger.log("重连逻辑订阅 over: ",r.stringStreamID)}}e||this.adapterRef.instance.safeEmit("@pairing-reBuildRecvTransport-success")}async rtsRequestKeyFrame(e){this.logger.log("请求关键帧: ",e.pubStatus.video.consumerId),this.adapterRef._signalling&&await this.adapterRef._signalling.rtsRequestKeyFrame(e.pubStatus.video.consumerId)}apiFrequencyControl(e){const{name:t,code:r,param:n}=e;if(!t)return;this.adapterRef.apiEvent[t]||(this.adapterRef.apiEvent[t]=[],this.adapterRef.apiEvents[t]=[],this.adapterRef.requestId[t]=0);let i=this.adapterRef.channelInfo.clientNtpTime-this.adapterRef.channelInfo.T4;i>0||(i=0);let o=Date.now()+i;if(o<=this.timeLast&&(o=this.timeLast+1),this.timeLast=o,this.adapterRef.apiEvent[t].length<10)this.adapterRef.apiEvent[t].push({cid:this.adapterRef.channelInfo&&this.adapterRef.channelInfo.cid,uid:this.adapterRef.channelInfo&&this.adapterRef.channelInfo.uid,code:r,name:t,time:o,param:n,request_id:this.adapterRef.requestId[t]++});else{if(!this.adapterRef.apiEvent||!this.adapterRef.apiEvent[t]||!this.adapterRef.apiEvent[t].length)return;this.adapterRef.apiEvent[t][0].time,Date.now()-this.adapterRef.apiEvent[t][0].time<1e4?this.adapterRef.requestId[t]++:(this.adapterRef.apiEvents[t]=this.adapterRef.apiEvents[t].concat(this.adapterRef.apiEvent[t]),this.adapterRef.apiEvent[t]=[])}}apiEventReport(e,t){if(!e)return;let r=new u.DataReport({adapterRef:this.adapterRef,sdkRef:this.sdkRef});r[e](Object.assign({uid:""+this.adapterRef.channelInfo.uid,cid:""+this.adapterRef.channelInfo.cid,time:Date.now()},t)),this.adapterRef.channelInfo.cid&&this.adapterRef.channelInfo.uid?r.send():(this.adapterRef.datareportCache.push({func:e,datareport:r}),this.adapterRef.datareportCache.length>20&&this.adapterRef.datareportCache.shift())}getUidAndKindBySsrc(e){var t,r;const n=["high","low"];for(let i of p.MediaTypeList)for(let o of n)if((null===(r=null===(t=this.adapterRef._mediasoup)||void 0===t?void 0:t.senderEncodingParameter[i][o])||void 0===r?void 0:r.ssrc)===e)return{uid:0,kind:i,streamType:o};for(let t in this.adapterRef.uid2SscrList){if(this.adapterRef.uid2SscrList[t].audio.ssrc==e)return{uid:t,kind:"audio",streamType:"high"};if(this.adapterRef.uid2SscrList[t].audioSlave.ssrc==e)return{uid:t,kind:"audioSlave",streamType:"high"};if(this.adapterRef.uid2SscrList[t].video&&this.adapterRef.uid2SscrList[t].video.ssrc==e)return{uid:t,kind:"video",streamType:"high"};if(this.adapterRef.uid2SscrList[t].screen&&this.adapterRef.uid2SscrList[t].screen.ssrc==e)return{uid:t,kind:"screen",streamType:"high"}}return{uid:0,kind:"",streamType:"high"}}getSsrcByUidAndKind(e,t){return this.adapterRef.uid2SscrList[e]&&this.adapterRef.uid2SscrList[e][t]}addSsrc(e,t,r){this.adapterRef.uid2SscrList[e]||(this.adapterRef.uid2SscrList[e]={audio:{ssrc:0},audioSlave:{ssrc:0},video:{ssrc:0},screen:{ssrc:0}}),this.adapterRef.uid2SscrList[e][t]?this.adapterRef.uid2SscrList[e][t].ssrc=r:this.adapterRef.uid2SscrList[e][t]={ssrc:r}}removeSsrc(e,t){this.adapterRef.uid2SscrList[e]&&(t?this.adapterRef.uid2SscrList[e][t]&&(this.adapterRef.uid2SscrList[e][t].ssrc=0):delete this.adapterRef.uid2SscrList[e])}isPublished(e){return e&&this.adapterRef.localStream===e&&(e.audio&&e.pubStatus.audio.audio||e.video&&e.pubStatus.video.video||e.screen&&e.pubStatus.screen.screen)}getPeer(e){return this.adapterRef._mediasoup?"send"==e?this.adapterRef._mediasoup._sendTransport&&this.adapterRef._mediasoup._sendTransport.handler._pc:"recv"==e?this.adapterRef._mediasoup._recvTransport&&this.adapterRef._mediasoup._recvTransport.handler._pc:null:null}destroy(){this.logger.log("base: destroy!"),this._reset()}}t.Base=M},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.MediaCapability=void 0;const n=r(215),i=r(71),o=r(4);t.MediaCapability=class{constructor(e){this.logger=e.logger.getChild((()=>{let t="codec"+this.room.videoCodecType.join(",");return this.supportedCodecSend&&2===this.supportedCodecSend.length&&this.supportedCodecRecv&&2===this.supportedCodecRecv.length||(t+=`/${this.supportedCodecSend}/${this.supportedCodecRecv}`),e.mediaCapability!==this&&(t+=" DETACHED"),t})),this.supportedCodecRecv=null,this.supportedCodecSend=null,this.preferredCodecSend={video:["H264","VP8"],screen:["H264","VP8"]},this.room={videoCodecType:[]}}async detect(){const e=Date.now();let t=await i.getSupportedCodecs("recv")||{video:[],audio:["OPUS"]},r=await i.getSupportedCodecs("send")||{video:[],audio:["OPUS"]};if(o.getParameters().h264Wait){if(-1===t.video.indexOf("H264"))for(this.logger.warn(`当前浏览器不支持H264解码。这可能会触发频道内编码协商。最多等待 ${o.getParameters().h264Wait} 毫秒以避免编码器尚未加载。`);Date.now()-e<o.getParameters().h264Wait;){if(t=await i.getSupportedCodecs("recv")||{video:[],audio:["OPUS"]},-1!==t.video.indexOf("H264")){this.logger.log(`H264解码器加载完成！用时 ${Date.now()-e} 毫秒`);break}await new Promise((e=>{setTimeout(e,100)}))}-1===t.video.indexOf("H264")&&this.logger.warn("H264解码器加载失败！")}if(this.supportedCodecRecv=t.video,this.supportedCodecSend=r.video,o.getParameters().disableH264Send){let e=this.supportedCodecSend.indexOf("H264");-1!==e&&(this.logger.log("根据私有化参数设置，忽略H264发送支持"),this.supportedCodecSend.splice(e,1))}if(o.getParameters().disableVP8Send){let e=this.supportedCodecSend.indexOf("VP8");-1!==e&&(this.logger.log("根据私有化参数设置，忽略VP8发送支持"),this.supportedCodecSend.splice(e,1))}this.logger.log("detect supportedCodecRecv",JSON.stringify(this.supportedCodecRecv),"supportedCodecSend",JSON.stringify(this.supportedCodecSend),"Preferred codec:",JSON.stringify(this.preferredCodecSend))}getCodecCapability(){if(this.supportedCodecRecv&&this.supportedCodecSend){const e=[];for(let t of i.VideoCodecList)this.supportedCodecRecv.indexOf(t)>-1&&this.supportedCodecSend.indexOf(t)>-1&&e.push(t);return e}return this.logger.error("getCodecCapability: call detect first"),[]}stringify(){let e={256:[]};for(let t of this.getCodecCapability())n.VideoCodecStr2Int[t]>-1?e[256].push(n.VideoCodecStr2Int[t]):this.logger.error("MediaCapability:Unknown VideoCodecStr2Int",t);return 0===e[256].length&&this.logger.warn("MediaCapability:No Local Suitable codec available"),JSON.stringify(e)}getCodecSend(e,t){var r,n;let i={codecName:null},s={codecName:null};for(let a=0;a<this.preferredCodecSend[e].length;a++){const c=this.preferredCodecSend[e][a];if(t.codecs||!t.codecs.length)for(let e=0;e<t.codecs.length;e++){const a=t.codecs[e];o.getParameters().disableH264Send&&(null===(r=a.mimeType)||void 0===r?void 0:r.toLowerCase().indexOf("h264"))>-1||o.getParameters().disableVP8Send&&(null===(n=a.mimeType)||void 0===n?void 0:n.toLowerCase().indexOf("vp8"))>-1||a.mimeType&&a.mimeType.toLowerCase().indexOf(c.toLowerCase())>-1&&(this.room.videoCodecType.indexOf(c)>-1?i.codecName||(i={codecParam:a,codecName:c}):s.codecName||(s={codecParam:a,codecName:c}))}}return i.codecName?(this.logger.log("MediaCapability：发送的Codec为:",i.codecName,JSON.stringify(i.codecParam)),i):(this.logger.warn("MediaCapability：未找到合适的发送Codec。发送的Codec使用:",s.codecName,s.codecParam),s)}parseRoom(e){if(!e.mediaCapabilitySet)return;const t=JSON.parse(e.mediaCapabilitySet);if(t[256]){const r=this.room.videoCodecType;this.room.videoCodecType=[];for(const r of t[256]){let t=n.VideoCodecInt2Str[r];t?this.room.videoCodecType.push(t):this.logger.error("Unknown Video Codec Type",r,e)}r.length?this.logger.log("Room videoCodecType发生变更。new:",this.room.videoCodecType,"old:",r):this.logger.log("Room videoCodecType:",JSON.stringify(this.room.videoCodecType))}}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.VideoCodecStr2Int=t.VideoCodecInt2Str=t.SignalChannelMode=void 0,function(e){e[e.CHANNEL_MODE_P2P=1]="CHANNEL_MODE_P2P",e[e.CHANNEL_MODE_MEETING=2]="CHANNEL_MODE_MEETING",e[e.CHANNEL_MODE_1V1=3]="CHANNEL_MODE_1V1"}(t.SignalChannelMode||(t.SignalChannelMode={})),t.VideoCodecStr2Int={H264:0,H265:1,VP8:2,NEVC:3},t.VideoCodecInt2Str={0:"H264",1:"H265",2:"VP8",3:"NEVC"}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Mediasoup=void 0;const a=r(10),c=r(64),u=s(r(12)),l=s(r(13)),d=o(r(24)),p=r(217),m=o(r(166)),f=r(4),h=r(234),g=r(24),v=r(119),y=r(143),b=r(142);class S extends a.EventEmitter{constructor(e){super(),this._consumers={},this._timeout=6e4,this._edgeRtpCapabilities=null,this._mediasoupDevice=null,this._sendTransportIceParameters=null,this._recvTransportIceParameters=null,this._audioSlaveProducer=null,this._audioSlaveProducerId=null,this._micProducer=null,this._micProducerId=null,this._webcamProducer=null,this._webcamProducerId=null,this._screenProducer=null,this._screenProducerId=null,this._webcamProducerCodec=null,this._screenProducerCodec=null,this._sendTransport=null,this._recvTransport=null,this._sendTransportTimeoutTimer=null,this._recvTransportTimeoutTimer=null,this._eventQueue=[],this._protoo=null,this.senderEncodingParameter={ssrcList:[],audio:{high:null,low:null},audioSlave:{high:null,low:null},video:{high:null,low:null},screen:{high:null,low:null}},this.unsupportedProducers={},this.iceStatusHistory={send:{promises:[],status:{ts:0,info:""}},recv:{promises:[],status:{ts:0,info:""}}},this.adapterRef=e.adapterRef,this.logger=e.logger,this.loggerSend=e.logger.getChild((()=>{var e;let t="MediaSend";if(this._sendTransport)if(null===(e=this._sendTransport._handler)||void 0===e?void 0:e._pc){const e=this._sendTransport._handler._pc;e.connectionState&&"connected"!==e.connectionState&&(t+=" "+e.connectionState),"stable"!==e.signalingState&&(t+=" "+e.signalingState)}else t+=" NOTRANSPORT";else t+=" UNINIT";return this.adapterRef._mediasoup!==this&&(t+=" DETACHED"),t})),this.loggerRecv=e.logger.getChild((()=>{var e;let t="MediaRecv";if(this._recvTransport)if(null===(e=this._recvTransport._handler)||void 0===e?void 0:e._pc){const e=this._recvTransport._handler._pc;e.connectionState&&"connected"!==e.connectionState&&(t+=" "+e.connectionState),"stable"!==e.signalingState&&(t+=" "+e.signalingState)}else t+=" NOTRANSPORT";else t+=" UNINIT";return this.adapterRef._mediasoup!==this&&(t+=" DETACHED"),t})),this._reset()}get consumers(){return this._consumers}_reset(){this._edgeRtpCapabilities=null,this._mediasoupDevice=null,this._sendTransportIceParameters=null,this._recvTransportIceParameters=null,this._micProducer=null,this._audioSlaveProducer=null,this._micProducerId=null,this._webcamProducer=null,this._webcamProducerId=null,this._screenProducer=null,this._screenProducerId=null,this._consumers={},this._sendTransportTimeoutTimer&&clearTimeout(this._sendTransportTimeoutTimer),this._sendTransportTimeoutTimer=null,this._recvTransportTimeoutTimer&&clearTimeout(this._recvTransportTimeoutTimer),this._recvTransportTimeoutTimer=null,this._sendTransport&&(this._sendTransport.close(),this.getIceStatus("send")),this._sendTransport=null,this._recvTransport&&(this._recvTransport.close(),this.getIceStatus("recv")),this._recvTransport=null,this.resetConsumeRequestStatus()}async init(){if(this.logger.log("init() 初始化 devices、transport"),this.adapterRef._enableRts)return;this._mediasoupDevice||(this._mediasoupDevice=new m.Device,this._mediasoupDevice&&await this._mediasoupDevice.load({routerRtpCapabilities:this._edgeRtpCapabilities}));let e=[],t="all";if(this.adapterRef.channelInfo.relaytoken&&this.adapterRef.channelInfo.relayaddrs&&(this.adapterRef.channelInfo.relayaddrs.forEach((t=>{e.push({urls:"turn:"+t+"?transport=udp",credential:this.adapterRef.proxyServer.credential||this.adapterRef.channelInfo.uid+"/"+this.adapterRef.channelInfo.cid,username:this.adapterRef.channelInfo.relaytoken},{urls:"turn:"+t+"?transport=tcp",credential:this.adapterRef.proxyServer.credential||this.adapterRef.channelInfo.uid+"/"+this.adapterRef.channelInfo.cid,username:this.adapterRef.channelInfo.relaytoken})})),d.IS_FIREFOX||(t="relay")),e.length&&this.logger.log("iceTransportPolicy ",t," iceServers ",v.JSONBigStringify(e)),!this._sendTransport&&this._mediasoupDevice&&(this._sendTransport=this._mediasoupDevice.createSendTransport({id:this.adapterRef.channelInfo.uid,iceParameters:void 0,iceCandidates:void 0,dtlsParameters:void 0,sctpParameters:void 0,iceServers:e,appData:{cid:this.adapterRef.channelInfo.cid,uid:this.adapterRef.channelInfo.uid,encodedInsertableStreams:this.adapterRef.encryption.encodedInsertableStreams}}),this.senderEncodingParameter={ssrcList:[],audioSlave:{high:null,low:null},audio:{high:null,low:null},video:{high:null,low:null},screen:{high:null,low:null}},this._sendTransport.on("connectionstatechange",this._sendTransportConnectionstatechange.bind(this,this._sendTransport)),this._sendTransport.handler._pc.addEventListener("iceconnectionstatechange",(()=>{this.getIceStatus("send")}))),!this._recvTransport){const r=this._mediasoupDevice.createRecvTransport({id:this.adapterRef.channelInfo.uid,iceParameters:void 0,iceCandidates:void 0,dtlsParameters:void 0,sctpParameters:void 0,iceServers:e,iceTransportPolicy:t,appData:{cid:this.adapterRef.channelInfo.cid,uid:this.adapterRef.channelInfo.uid,encodedInsertableStreams:this.adapterRef.encryption.encodedInsertableStreams}});this._recvTransport=r,r.on("connectionstatechange",this._recvTransportConnectionstatechange.bind(this,r)),r.handler._pc.addEventListener("iceconnectionstatechange",(()=>{this.getIceStatus("recv")}))}let r=setInterval((()=>{const e=Date.now();e-this.iceStatusHistory.send.status.ts>1500&&this.getIceStatus("send"),e-this.iceStatusHistory.recv.status.ts>1500&&this.getIceStatus("recv"),this._mediasoupDevice||clearInterval(r)}),1e3);this.emit("transportReady")}async _sendTransportConnectionstatechange(e,t){if(this._sendTransport===e)if(this.loggerSend.log(`send connection #${e._handler._pc.pcid} state  changed to ${t}`),this.emit("upstream-state-change",{connectionState:t}),"failed"===t)try{this._sendTransport&&(this._sendTransportTimeoutTimer||(this._sendTransportTimeoutTimer=setTimeout((()=>{this._reconnectTransportConnectTimeout()}),this._timeout))),this._sendTransportConnectTimeout()}catch(e){this.loggerSend.error("reconnectSendTransportConnect() | failed:",e.name,e.message)}else"connected"===t&&this._sendTransportTimeoutTimer&&(clearTimeout(this._sendTransportTimeoutTimer),this._sendTransportTimeoutTimer=null);else this.loggerSend.error("_sendTransportConnectionstatechange: 出现了_sendTransport绑定不一致的状况。")}async _recvTransportConnectionstatechange(e,t){if(this._recvTransport===e)if(this.loggerRecv.log(`recv connection ${e._handler._pc.pcid} state changed to ${t}`),this.emit("downstream-state-change",{connectionState:t}),"failed"===t){try{this._recvTransport&&(this._recvTransportTimeoutTimer||(this._recvTransportTimeoutTimer=setTimeout((()=>{this._reconnectTransportConnectTimeout()}),this._timeout)))}catch(e){this.loggerRecv.error("reconnectRecvTransportConnect() | failed:",e.name,e.message)}this._recvTransportConnectTimeout()}else"connected"===t&&this._recvTransportTimeoutTimer&&(clearTimeout(this._recvTransportTimeoutTimer),this._recvTransportTimeoutTimer=null);else this.loggerRecv.error("_recvTransportConnectionstatechange：出现了_recvTransport绑定不一致的状况。")}async _sendTransportConnectTimeout(){this.loggerSend.warn("媒体上行传输通道连接失败"),this.adapterRef._signalling&&("CONNECTED"===this.adapterRef.connectState.curState?(this.loggerSend.log("媒体上行传输通道连接失败，尝试整体重连"),this.adapterRef.channelStatus="connectioning",this.adapterRef._signalling.reconnectionControl.next=this.adapterRef._signalling.reconnectionControl.copynext,this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"sendPeerIceFailed",ext:""}),this.adapterRef._signalling._reconnection()):(this.loggerRecv.warn("媒体上行传输通道建立失败, 此时sdk正在重连, 不用特殊处理"),this.adapterRef.instance.apiEventReport("setStreamException",{name:"pushStreamException",value:"send transport connection failed"})))}async _recvTransportConnectTimeout(){this.loggerRecv.warn("媒体下行传输通道建立失败"),this.adapterRef._signalling&&("CONNECTED"===this.adapterRef.connectState.curState?(this.loggerRecv.error("媒体下行传输通道连接失败，尝试整体重连"),this.adapterRef.channelStatus="connectioning",this.adapterRef._signalling.reconnectionControl.next=this.adapterRef._signalling.reconnectionControl.copynext,this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"recvPeerIceFailed",ext:""}),this.adapterRef._signalling._reconnection()):(this.loggerRecv.warn("媒体下行传输通道建立失败，此时sdk正在重连，不用特殊处理"),this.adapterRef.instance.apiEventReport("setStreamException",{name:"pullStreamException",value:"receive transport connection failed"})))}async _reconnectTransportConnectTimeout(){this.loggerRecv.error("媒体传输通道一直重连失败，主动退出房间"),this.adapterRef.instance.safeEmit("error","MEDIA_TRANSPORT_DISCONNECT"),this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=u.default.MEDIA_CONNECTION_DISCONNECTED,this.adapterRef.instance.leave()}async createProduce(e,t){var r,n,i,o,s;if(e.logger.log("发布音视频: ",e.getId(),t),!this._sendTransport)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"createProduce: 发送端 transport 未找到 1"});if(0===this._sendTransport.listenerCount("produce")&&this._sendTransport.on("produce",(async({kind:t,rtpParameters:r,appData:n,localDtlsParameters:i,offer:o},s,a)=>{if(this.loggerSend.log(`produce 反馈 [kind= ${t}, appData= ${v.JSONBigStringify(n)}]`),!this._sendTransport)return;const c="screenShare"==n.mediaType?"screen":n.mediaType;let d=!1;("video"===c&&this.adapterRef.channelInfo.videoLow||"screen"===c&&this.adapterRef.channelInfo.screenLow)&&(d=!0);const p=o.sdp.match(/a=ice-ufrag:([0-9a-zA-Z#=+-_\/\\\\]+)/);p||this.adapterRef.logger.error("找不到 iceUfragRegLocal: ",o.sdp);try{let a=r;const m=a.codecs[0];f.getParameters().h264ProfileLevel&&f.getParameters().h264ProfileLevelSignal&&"video/H264"===m.mimeType&&m.parameters&&m.parameters["profile-level-id"]!==f.getParameters().h264ProfileLevelSignal&&(a=JSON.parse(JSON.stringify(r)),this.logger.warn(`信令消息修改profile-level-id, ${a.codecs[0].parameters["profile-level-id"]} => ${f.getParameters().h264ProfileLevelSignal}`),a.codecs[0].parameters["profile-level-id"]="42e01f"),this.adapterRef.preferRemb&&(this.logger.log("使用REMB作为带宽估计方式"),b.filterTransportCCFromRtpParameters(a));let h=Object.assign({requestId:""+Math.ceil(1e9*Math.random()),kind:t,rtpParameters:a,iceUfrag:p[1],externData:{producerInfo:{mediaType:"audioSlave"===n.mediaType?"subAudio":n.mediaType,subStream:"screenShare"===n.mediaType||"audioSlave"===n.mediaType,simulcastEnable:d,spatialLayerCount:d?2:1,mute:e.muteStatus[c].send||!1}},appData:{enableTcpCandidate:!0}},n);"screen"===c?h.deviceId="screen-share-default":"video"===c&&(e.mediaHelper.video.videoSource?h.deviceId="video-external-default":h.deviceId="video-default");let g=this.senderEncodingParameter[c].high,y=this.senderEncodingParameter[c].low,S=o.sdp.indexOf(n.deviceId),T=o.sdp.indexOf(n.deviceIdLow);if(!g){if(r.encodings&&(g=r.encodings[0],g&&this.senderEncodingParameter.ssrcList.indexOf(g.ssrc)>-1&&(g=null),r.encodings[1]&&(y=r.encodings[1],y&&this.senderEncodingParameter.ssrcList.indexOf(y.ssrc)>-1&&(g=null))),!g&&n.deviceId&&S>-1){const e=o.sdp.substring(S).match(/a=ssrc-group:FID (\d+) (\d+)/);if(e&&(g={ssrc:parseInt(e[1]),rtx:{ssrc:parseInt(e[2])}}),g&&this.senderEncodingParameter.ssrcList.indexOf(g.ssrc)>-1&&(g=null),!y&&n.deviceIdLow&&T>-1){const e=o.sdp.substring(T).match(/a=ssrc-group:FID (\d+) (\d+)/);e&&(y={ssrc:parseInt(e[1]),rtx:{ssrc:parseInt(e[2])}}),y&&this.senderEncodingParameter.ssrcList.indexOf(y.ssrc)>-1&&(y=null)}}g||(this.loggerSend.log("使用sdp中第一个ssrc"),g={ssrc:parseInt(o.sdp.match(/a=ssrc:(\d+)/)[1]),dtx:!1}),this.senderEncodingParameter[c].high=g,this.senderEncodingParameter.ssrcList.push(g.ssrc),y?(this.senderEncodingParameter[c].low=y,this.senderEncodingParameter.ssrcList.push(y.ssrc)):this.senderEncodingParameter[c].low=null}r.encodings=[this.senderEncodingParameter[c].high],this.senderEncodingParameter[c].low&&r.encodings.unshift(this.senderEncodingParameter[c].low),"video"!==n.mediaType&&"screenShare"!==n.mediaType||(h.mediaProfile=[],y&&h.mediaProfile.push({ssrc:y.ssrc,res:"160*160",fps:"1",spatialLayer:0,maxBitrate:100}),h.mediaProfile.push({ssrc:g.ssrc,res:"640*480",fps:"15",spatialLayer:h.mediaProfile.length,maxBitrate:1e3}));for(let e=h.rtpParameters.codecs.length-1;e>=0;e--)"audio/red"===h.rtpParameters.codecs[e].mimeType&&h.rtpParameters.codecs.splice(e,1);if(void 0===i?h.transportId=this._sendTransport.id:h.dtlsParameters=i,!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"createProduce: _protoo 未找到"});let _=await this.adapterRef._signalling._protoo.request("Produce",h);const{code:w,transportId:M,iceParameters:x,iceCandidates:E,turnParameters:C,dtlsParameters:R,producerId:k,errMsg:A}=_;if(void 0!==M&&(this._sendTransport._id=M),200===w?this.loggerSend.log(`produce请求反馈结果, code: ${w}, kind: ${t}, producerId: ${k}`):this.loggerSend.error(`produce请求反馈错误, code: ${w}, kind: ${t}, producerId: ${k},  errMsg: ${A}, 请求：${v.JSONBigStringify(h)}, 返回：${v.JSONBigStringify(h)}`),C){let e=[];e.push({urls:"turn:"+C.ip+":"+C.port+"?transport=udp",credential:C.password,username:C.username},{urls:"turn:"+C.ip+":"+C.port+"?transport=tcp",credential:C.password,username:C.username}),await this._sendTransport.updateIceServers({iceServers:e})}let I={codecParam:null,codecName:null};if("audio"===n.mediaType?this._micProducerId=k:"audioSlave"===n.mediaType?this._audioSlaveProducerId=k:"video"===n.mediaType?(this._webcamProducerId=k,I=this.adapterRef.mediaCapability.getCodecSend("video",this._sendTransport.handler._sendingRtpParametersByKind.video),this._webcamProducerCodec=I.codecName):"screenShare"===n.mediaType&&(this._screenProducerId=k,I=this.adapterRef.mediaCapability.getCodecSend("screen",this._sendTransport.handler._sendingRtpParametersByKind.video),this._screenProducerCodec=I.codecName),x&&(this._sendTransportIceParameters=x),!this.adapterRef.localStream)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"createProduce: 未找到 localStream"});let O=[];if("audio"===n.mediaType||"audioSlave"===n.mediaType)O.push(Object.assign({},f.getParameters().codecOptions.audio));else if("video"===n.mediaType){if(r.encodings.length>=2){const e={};f.getParameters().videoLowStartBitrate&&(e.videoGoogleStartBitrate=f.getParameters().videoLowStartBitrate),f.getParameters().videoLowMinBitrate&&(e.videoGoogleMinBitrate=f.getParameters().videoLowMinBitrate),O.push(e)}const e={};f.getParameters().videoHighStartBitrate&&(e.videoGoogleStartBitrate=f.getParameters().videoHighStartBitrate),f.getParameters().videoHighMinBitrate&&(e.videoGoogleMinBitrate=f.getParameters().videoHighMinBitrate),O.push(e)}else if("screenShare"===n.mediaType){if(r.encodings.length>=2){const e={};f.getParameters().screenLowStartBitrate&&(e.videoGoogleStartBitrate=f.getParameters().screenLowStartBitrate),f.getParameters().screenLowMinBitrate&&(e.videoGoogleMinBitrate=f.getParameters().screenLowMinBitrate),O.push(e)}const e={};f.getParameters().screenHighStartBitrate&&(e.videoGoogleStartBitrate=f.getParameters().screenHighStartBitrate),f.getParameters().screenHighMinBitrate&&(e.videoGoogleMinBitrate=f.getParameters().screenHighMinBitrate),O.push(e)}this.logger.log(`codecOptions for producer ${n.mediaType}: ${v.JSONBigStringify(O)}`);let P=E;this.adapterRef.channelInfo.iceProtocol&&E&&(this.logger.warn("Produce iceProtocol: ",this.adapterRef.channelInfo.iceProtocol),P=E.filter((e=>e.protocol==this.adapterRef.channelInfo.iceProtocol))),await this._sendTransport.fillRemoteRecvSdp({kind:t,appData:n,iceParameters:x,iceCandidates:P,dtlsParameters:R,sctpParameters:void 0,sendingRtpParameters:r,codecOptions:O,offer:o,codec:I.codecParam,audioProfile:this.adapterRef.localStream.audioProfile}),"video"!==c&&"screen"!==c||(this.adapterRef.localStream.applyEncoderConfig(c,"high"),r.encodings.length>=2&&this.adapterRef.localStream.applyEncoderConfig(c,"low")),s({id:k})}catch(e){a(e)}})),"audio"===t||"all"===t)if(this._micProducer)this.loggerSend.log("音频已经publish，跳过");else{const t=e.mediaHelper.audio.audioStream.getAudioTracks()[0];t&&(!1===(null===(r=this.adapterRef.permKeyInfo)||void 0===r?void 0:r.pubAudioRight)?(this.loggerSend.error("permKey权限控制你没有权利发布audio"),this.adapterRef.instance.safeEmit("error","no-publish-audio-permission")):(this.loggerSend.log("发布音频流 audioTrack: ",t.id,t.label),e.pubStatus.audio.audio=!0,this._micProducer=await this._sendTransport.produce({track:t,trackLow:null,codecOptions:{opusStereo:!0,opusDtx:!0},appData:{preferRemb:this.adapterRef.preferRemb,deviceId:t.id,deviceIdLow:null,mediaType:"audio"}}),this.watchProducerState(this._micProducer,"_micProducer"),this.adapterRef.encryption.encodedInsertableStreams&&this._micProducer._rtpSender&&this.enableSendTransform(this._micProducer._rtpSender,"audio","high")))}if("audioSlave"===t||"all"===t)if(this._audioSlaveProducer)this.loggerSend.log("音频辅流已经publish，忽略");else{const t=e.mediaHelper.screenAudio.screenAudioStream.getAudioTracks()[0];t&&(!1===(null===(n=this.adapterRef.permKeyInfo)||void 0===n?void 0:n.pubAudioRight)?(this.loggerSend.error("permKey权限控制你没有权利发布audio slave"),this.adapterRef.instance.safeEmit("error","no-publish-audio-slave-permission")):(this.loggerSend.log("发布音频辅流 audioSlaveTrack: ",t.id,t.label),e.pubStatus.audioSlave.audio=!0,this._audioSlaveProducer=await this._sendTransport.produce({track:t,trackLow:null,codecOptions:{opusStereo:!0,opusDtx:!0},appData:{preferRemb:this.adapterRef.preferRemb,deviceId:t.id,deviceIdLow:null,mediaType:"audioSlave"}}),this.watchProducerState(this._audioSlaveProducer,"_audioSlaveProducer")))}if("video"===t||"all"===t)if(this._webcamProducer)this.loggerSend.log("视频已经publish，跳过");else if(e.mediaHelper.video.videoStream.getVideoTracks().length)if(!1===(null===(i=this.adapterRef.permKeyInfo)||void 0===i?void 0:i.pubVideoRight))this.loggerSend.error("permKey权限控制你没有权利发布video"),this.adapterRef.instance.safeEmit("error","no-publish-video-permission");else{let t=null;this.adapterRef.channelInfo.videoLow?(e.mediaHelper.video.low||(e.mediaHelper.video.low=new h.VideoTrackLow({logger:this.logger,mediaType:"video"})),t=e.mediaHelper.video.low.track):(e.mediaHelper.video.low&&e.mediaHelper.video.low.bindSender(null,null),this.senderEncodingParameter.video.low=null);const r=e.mediaHelper.video.videoStream.getVideoTracks()[0];this.loggerSend.log("发布视频 videoTrack: ",r.id,r.label),e.pubStatus.video.video=!0;const n=this.adapterRef.mediaCapability.getCodecSend("video",this._sendTransport.handler._sendingRtpParametersByKind.video);this._webcamProducer=await this._sendTransport.produce({track:r,trackLow:t,codec:n.codecParam,codecOptions:{videoGoogleStartBitrate:1e3},appData:{preferRemb:this.adapterRef.preferRemb,deviceId:r.id,deviceIdLow:(null==t?void 0:t.id)||null,mediaType:"video"}}),this._webcamProducer._rtpSender&&e.mediaHelper.video.low&&(e.mediaHelper.video.low.bindSender(this._webcamProducer._rtpSender,this._webcamProducer._rtpSenderLow||null),g.IS_SAFARI&&g.SAFARI_MAJOR_VERSION&&g.SAFARI_MAJOR_VERSION<14&&(null===(o=e._play.video.dom)||void 0===o?void 0:o.srcObject)&&(this.logger.log("尝试重置本地视图的SrcObject"),e._play.video.dom.srcObject=e._play.video.dom.srcObject)),this.watchProducerState(this._webcamProducer,"_webcamProducer"),this.adapterRef.encryption.encodedInsertableStreams&&(this._webcamProducer._rtpSender&&this.enableSendTransform(this._webcamProducer._rtpSender,"video","high"),this._webcamProducer._rtpSenderLow&&this.enableSendTransform(this._webcamProducer._rtpSenderLow,"video","low")),this.adapterRef.state.startPubVideoTime||(this.adapterRef.state.startPubVideoTime=Date.now())}if("screen"===t||"all"===t)if(this._screenProducer)this.loggerSend.log("屏幕共享已经publish，跳过");else if(e.mediaHelper.screen.screenVideoStream.getVideoTracks().length)if(!1===(null===(s=this.adapterRef.permKeyInfo)||void 0===s?void 0:s.pubVideoRight))this.loggerSend.error("permKey权限控制你没有权利发布screen"),this.adapterRef.instance.safeEmit("error","no-publish-screen-permission");else{let t=null;this.adapterRef.channelInfo.screenLow?(e.mediaHelper.screen.low||(e.mediaHelper.screen.low=new h.VideoTrackLow({logger:e.logger,mediaType:"screen"})),t=e.mediaHelper.screen.low.track):(e.mediaHelper.screen.low&&e.mediaHelper.screen.low.bindSender(null,null),this.senderEncodingParameter.screen.low=null);const r=e.mediaHelper.screen.screenVideoStream.getVideoTracks()[0];this.loggerSend.log("发布屏幕共享 screenTrack: ",r.id,r.label),e.pubStatus.screen.screen=!0;const n=this.adapterRef.mediaCapability.getCodecSend("screen",this._sendTransport.handler._sendingRtpParametersByKind.video);this._screenProducer=await this._sendTransport.produce({track:r,trackLow:t,codec:n.codecParam,codecOptions:{videoGoogleStartBitrate:1e3},appData:{preferRemb:this.adapterRef.preferRemb,deviceId:r.id,deviceIdLow:(null==t?void 0:t.id)||null,mediaType:"screenShare"}}),this._screenProducer._rtpSender&&e.mediaHelper.screen.low&&e.mediaHelper.screen.low.bindSender(this._screenProducer._rtpSender,this._screenProducer._rtpSenderLow||null),this.watchProducerState(this._screenProducer,"_screenProducer"),this.adapterRef.encryption.encodedInsertableStreams&&(this._screenProducer._rtpSender&&this.enableSendTransform(this._screenProducer._rtpSender,"screen","high"),this._screenProducer._rtpSenderLow&&this.enableSendTransform(this._screenProducer._rtpSenderLow,"screen","low")),this.adapterRef.state.startPubScreenTime||(this.adapterRef.state.startPubScreenTime=Date.now())}}enableSendTransform(e,t,r){var n;const i=null===(n=this._sendTransport)||void 0===n?void 0:n.send.find((t=>t.sender===e));if(i)if(i.encodedStreams)this.loggerRecv.log(`发送端自定义加密，复用之前的通道。 ${i.mediaType} ${i.streamType}`);else{const t=e.createEncodedStreams(),r=new TransformStream({transform:this.adapterRef.encryption.handleUpstreamTransform.bind(this.adapterRef.encryption,i)});t.readable.pipeThrough(r).pipeTo(t.writable),i.encodedStreams=t,i.transformStream=r,this.loggerRecv.log(`发送端自定义加密，成功启动。 ${i.mediaType} ${i.streamType}`)}else this.loggerRecv.error("enableSendTransform() 未找到匹配的Sender",t,r)}enableRecvTransform(e,t,r){var n;const i=null===(n=this._recvTransport)||void 0===n?void 0:n.recv.find((t=>t.receiver===e));if(i)if(i.encodedStreams)this.loggerRecv.log(`接收端自定义解密，复用之前的通道。uid:${i.uid}, mediaType: ${i.mediaType}`);else{const t=e.createEncodedStreams(),r=new TransformStream({transform:this.adapterRef.encryption.handleDownstreamTransform.bind(this.adapterRef.encryption,i)});t.readable.pipeThrough(r).pipeTo(t.writable),i.encodedStreams=t,i.transformStream=r,this.loggerRecv.log(`接收端自定义解密，成功启动。uid:${i.uid}, mediaType: ${i.mediaType}`)}else this.loggerRecv.error("enableRecvTransform() 未找到匹配的Receiver",t,r)}watchProducerState(e,t){var r;if(null===(r=e.rtpSender)||void 0===r?void 0:r.transport){const r=e.rtpSender.transport;if("failed"===r.state)this.logger.error(`Producer state ${t} ${r.state}`);else this.logger.log(`Producer state ${t} ${r.state}`),e.rtpSender.transport.addEventListener("statechange",(()=>{switch(r.state){case"failed":this.logger.error(`Producer state changed: ${t} ${r.state}`);break;case"connected":case"new":case"connecting":this.logger.log(`Producer state changed: ${t} ${r.state}`)}}))}else this.logger.log("Producer state: transport is null")}async destroyProduce(e){var t;let r=null,n=null;if(!this.adapterRef.localStream)throw new l.default({code:u.default.LOCALSTREAM_NOT_FOUND_ERROR,message:`destroyProduce.${e}: 未找到 localStream`});"audio"===e?(r=this._micProducer,n=this._micProducerId,this._micProducer=this._micProducerId=null,this.adapterRef.localStream.pubStatus.audio.audio=!1):"audioSlave"===e?(r=this._audioSlaveProducer,n=this._audioSlaveProducerId,this._audioSlaveProducer=this._audioSlaveProducerId=null,this.adapterRef.localStream.pubStatus.audioSlave.audio=!1):"video"===e?(r=this._webcamProducer,n=this._webcamProducerId,this._webcamProducer=this._webcamProducerId=null,this.adapterRef.localStream.pubStatus.video.video=!1):"screen"===e&&(r=this._screenProducer,n=this._screenProducerId,this._screenProducer=this._screenProducerId=null,this.adapterRef.localStream.pubStatus.screen.screen=!1);try{if(this.loggerSend.log(`停止发布 destroyProduce ${e} producerId=`,n),!r)return;r.close(),(null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)?this.adapterRef._signalling._protoo.request("CloseProducer",{requestId:""+Math.ceil(1e9*Math.random()),producerId:n}).catch((e=>{this.logger.error("CloseProducer Failed: ",e.name,e.message)})):this.logger.warn("destroyProduce: 当前信令中断, 不发信令包",e,n)}catch(e){this.loggerSend.error("destroyProduce failed: ",e.name,e.message)}}async createConsumer(e,t,r,n,i=0){this.adapterRef.instance.safeEmit("@pairing-createConsumer-start");let o=!1;if(this._eventQueue.forEach((t=>{if(t.id===n)return this.loggerRecv.log(`[subscribe] 已经在订阅任务队列中，忽略该次请求, uid: ${e}, mediaType: ${r}, producerId: ${n}`),void(o=!0)})),!o)return new Promise(((o,s)=>{this._eventQueue.push({uid:e,kind:t,id:n,mediaType:r,preferredSpatialLayer:i,resolve:o,reject:s}),this._eventQueue.length>1||(this.adapterRef._enableRts?this._createConsumerRts(this._eventQueue[0]):this._createConsumer(this._eventQueue[0]))}))}async setConsumerPreferredLayer(e,t,r){if(!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"setConsumerPreferredLayer: _protoo 未找到"});return this.loggerSend.log("setConsumerPreferredLayer() [切换大小流]layer: ",t,1===t?"大流":"小流",r),await this.adapterRef._signalling._protoo.request("SetConsumerPreferredLayer",{requestId:""+Math.ceil(1e9*Math.random()),uid:new y.SimpleBig(e.streamID),producerId:e.pubStatus[r].producerId,consumerId:e.pubStatus[r].consumerId,spatialLayer:t})}async resetConsumeRequestStatus(){const e=this._eventQueue;this._eventQueue=[];for(let t=0;t<e.length;t++){const r=e[t];this.loggerRecv.log(`resetConsumeRequestStatus：uid ${r.uid}, uid ${r.uid}, kind ${r.kind}, id ${r.id}`),r.reject("resetConsumeRequestStatus")}}removeUselessConsumeRequest(e){const{producerId:t,uid:r}=e;if(t||r)for(let e=1;e<this._eventQueue.length;e++){const n=this._eventQueue[e];n.id!==t&&n.uid!==r||(this.loggerRecv.log(`removeUselessConsumeRequest：uid ${n.uid}, uid ${n.uid}, kind ${n.kind}, id ${n.id}`),this._eventQueue.splice(e,1),e++)}}checkConsumerList(e){return this._eventQueue.shift(),e.resolve(null),this.loggerRecv.log("查看事件队列, _eventQueue: ",this._eventQueue.length),this._eventQueue.forEach((e=>{this.loggerRecv.log(`consumerList, uid: ${e.uid}, kind: ${e.kind}, mediaType: ${e.mediaType}, id: ${e.id}`)})),this._eventQueue.length>0&&(this.adapterRef._enableRts?this._createConsumerRts(this._eventQueue[0]):this._createConsumer(this._eventQueue[0])),"checkConsumerList"}async _createConsumer(e){var t,r;const{uid:n,kind:i,mediaType:o,id:s,preferredSpatialLayer:a=0}=e,c="screenShare"===o?"screen":o;if("audio"===c?this.loggerRecv.log(`[Subscribe] 开始订阅 ${n} 的 ${c} 媒体: ${s}`):this.loggerRecv.log(`[Subscribe] 开始订阅 ${n} 的 ${c} 媒体: ${s} preferredSpatialLayer: ${a} 大小流: `,1===a?"大流":"小流"),!s)return this.adapterRef.instance.safeEmit("@pairing-createConsumer-error"),this.checkConsumerList(e);if(this.unsupportedProducers[s])return this.loggerRecv.warn("[Subscribe] createConsumer: 跳过不支持的Producer",s,v.JSONBigStringify(this.unsupportedProducers[s])),this.checkConsumerList(e);const d=this.adapterRef.remoteStreamMap[n];if(!d||!d.pubStatus[c][c]||!d.pubStatus[c].producerId)return this.adapterRef.instance.safeEmit("@pairing-createConsumer-skip"),this.checkConsumerList(e);if(d.pubStatus[c].consumerId){this.loggerRecv.log("[Subscribe] 已经订阅过");let t=!0;if(d.Play&&(t=d._play.isPlaying(c)),t)return this.loggerRecv.log("[Subscribe] 当前播放正常，直接返回"),this.adapterRef.instance.safeEmit("@pairing-createConsumer-skip"),this.checkConsumerList(e);if("start"!==d.pubStatus[c].stopconsumerStatus){this.loggerRecv.log("[Subscribe] 先停止之前的订阅");try{if(d.pubStatus[c].stopconsumerStatus="start",!this.adapterRef._mediasoup)return this.checkConsumerList(e);await this.destroyConsumer(d.pubStatus.audio.consumerId,null,null),this.adapterRef.instance.removeSsrc(d.getId(),c),d.pubStatus[c].consumerId="",d.stop(c),d.pubStatus[c].stopconsumerStatus="end"}catch(e){this.loggerRecv.error("[Subscribe] 停止之前的订阅出现错误: ",e.name,e.message)}}}let m=null;if("audio"!==c&&"audioSlave"!==c||(m={opusStereo:1}),this._mediasoupDevice&&this._mediasoupDevice.loaded||(this.loggerRecv.warn("[Subscribe] createConsumer：Waiting for Transport Ready"),await p.waitForEvent(this,"transportReady",3e3)),!this._recvTransport)throw this.adapterRef.instance.safeEmit("@pairing-createConsumer-error"),e.resolve(null),new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"createConsumer: 接收端 transport 未找到"});this.loggerRecv.log(`[Subscribe] prepareLocalSdp [kind: ${i}, mediaTypeShort: ${c}, uid: ${n}]`),this._recvTransport.id===this.adapterRef.channelInfo.uid&&(this.loggerRecv.log("[Subscribe] transporth还没有协商, 需要dtls消息"),this._recvTransport._handler._transportReady=!1);const h=await this._recvTransport.prepareLocalSdp(i,this._edgeRtpCapabilities,n);this.adapterRef&&"DISCONNECTING"!=this.adapterRef.connectState.curState&&"DISCONNECTED"!=this.adapterRef.connectState.curState||this.checkConsumerList(e),this.loggerRecv.log("[Subscribe] 获取本地sdp, mid =",h.mid);let{rtpCapabilities:g,offer:b}=h,S=h.mid;const T=h.dtlsParameters;S="number"==typeof S&&S<0?void 0:""+S;const _=b.sdp.match(/a=ice-ufrag:([0-9a-zA-Z=#+-_\/\\\\]+)/);if(!_)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"_createConsumer: iceUfragRegRemote 为空"});let w={requestId:""+Math.ceil(1e9*Math.random()),kind:i,rtpCapabilities:g,uid:new y.SimpleBig(n),producerId:s,preferredSpatialLayer:a,mid:S,pause:!1,iceUfrag:_[1],audioAslFlag:"yes"===this.adapterRef.audioAsl.enabled&&f.getParameters().audioAslFlag,appData:{enableTcpCandidate:!0}};if(void 0===T?w.transportId=this._recvTransport.id:w.dtlsParameters=T,this.loggerRecv.log(`[Subscribe] 发送consume请求, uid: ${n}, kind: ${i}, mediaTypeShort: ${c}, producerId: ${w.producerId}, transportId: ${w.transportId}, requestId: ${w.requestId}`),!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw e.resolve(null),new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"_createConsumer: _protoo 未找到"});const M=this.adapterRef._signalling._protoo;let x=null;try{x=await this.adapterRef._signalling._protoo.request("Consume",w)}catch(e){throw"request timeout"===e.message&&this.adapterRef._signalling._protoo===M?(this.logger.error(`[Subscribe] Consume消息Timeout, 尝试信令重连: ${e.name}/${e.message}, 当前的连接状态: ${this.adapterRef.connectState.curState}, 原始请求: `,v.JSONBigStringify(w)),this.adapterRef.channelStatus="connectioning",this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"consumeRequestTimeout",ext:""}),this.adapterRef._signalling._reconnection()):this.logger.error(`[Subscribe] Consume消息错误: ${e.name}/${e.message}, 当前的连接状态：${this.adapterRef.connectState.curState}, 原始请求：`,v.JSONBigStringify(w)),new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"_createConsumer: Consume 消息错误:"+e.message})}let{transportId:E,iceParameters:C,iceCandidates:R,dtlsParameters:k,probeSSrc:A,rtpParameters:I,turnParameters:O,producerId:P,consumerId:N,code:D,errMsg:L}=x;if(this.loggerRecv.log(`[Subscribe] consume反馈结果 code: ${D} uid: ${n}, mid: ${I&&I.mid}, kind: ${i}, producerId: ${P}, consumerId: ${N}, transportId: ${E}, requestId: ${x.requestId}, errMsg: ${L}`),!this._recvTransport)return this.loggerRecv.error("[Subscribe] transport undefined, 直接返回"),this.checkConsumerList(e);if(200!==D&&!(null===(r=null===(t=this._recvTransport)||void 0===t?void 0:t._handler)||void 0===r?void 0:r.remoteSdp))return this._recvTransport.recoverLocalSdp(n,"0",i),this.loggerRecv.log("[Subscribe] consume, 此外没有remoteSdp, 忽略改次失败的consume"),this.checkConsumerList(e);if(O){let e=[];e.push({urls:"turn:"+O.ip+":"+O.port+"?transport=udp",credential:O.password,username:O.username},{urls:"turn:"+O.ip+":"+O.port+"?transport=tcp",credential:O.password,username:O.username}),await this._recvTransport.updateIceServers({iceServers:e})}const j=x.uid;I&&I.encodings&&I.encodings.length&&I.encodings[0].ssrc&&this.adapterRef.instance.addSsrc(n,c,I.encodings[0].ssrc),void 0!==E&&(this._recvTransport._id=E),void 0!==A&&(this._probeSSrc=A),C&&(this._recvTransportIceParameters=C),I&&null!=I.mid&&(I.mid=I.mid+"");let U=R;this.adapterRef.channelInfo.iceProtocol&&R&&(this.logger.warn("Consume iceProtocol: ",this.adapterRef.channelInfo.iceProtocol),U=R.filter((e=>e.protocol==this.adapterRef.channelInfo.iceProtocol)));const F=await this._recvTransport.consume({id:N||P||s,producerId:P||s,kind:i,mediaType:c,uid:n||j,rtpParameters:I,codecOptions:m,appData:{peerId:j,remoteUid:n,mid:S},offer:b,iceParameters:C,iceCandidates:U,dtlsParameters:k,sctpParameters:void 0,probeSSrc:this._probeSSrc});if(this.adapterRef.encryption.encodedInsertableStreams&&F.rtpReceiver&&this.enableRecvTransform(F.rtpReceiver,n,c),this._consumers[F.id]=F,F.on("transportclose",(()=>{this._consumers&&delete this._consumers[F.id]})),this.loggerRecv.log("[Subscribe] 订阅consume完成 peerId =",j),this.adapterRef.instance.apiEventReport("setFunction",{name:`set_${c}_sub`,oper:"1",value:v.JSONBigStringify({remoteUid:n,result:D,reason:L||"",preferredSpatialLayer:a,consumerId:N||"",producerId:P||s},null," ")}),d&&d.pubStatus[c].producerId){if(d.subStatus[c]=!0,d.pubStatus[c][c]=!0,d.pubStatus[c].consumerId=N,d.pubStatus[c].producerId=P,d.getMuteStatus(c).muted){this.loggerRecv.log(`[Subscribe] 远端流处于mute状态：uid ${d.getId()}, ${c}, ${v.JSONBigStringify(d.getMuteStatus(c))}`);const e=d.getMuteStatus(c);e.send&&this.loggerRecv.log(`[Subscribe] 远端流把自己mute了：uid ${d.getId()}, ${c}, ${v.JSONBigStringify(e)}`),e.recv&&(this.loggerRecv.log(`[Subscribe] 本端把远端流mute了：uid ${d.getId()}, ${c}, ${v.JSONBigStringify(e)}`),F.track.enabled=!1)}else F.track.enabled=!0;d.mediaHelper.updateStream(c,F.track),this.adapterRef.instance.safeEmit("@pairing-createConsumer-success"),"audio"===c?this.adapterRef.state.signalAudioSubscribedTime<this.adapterRef.state.signalOpenTime&&(this.adapterRef.state.signalAudioSubscribedTime=Date.now()):"video"===c&&this.adapterRef.state.signalVideoSubscribedTime<this.adapterRef.state.signalOpenTime&&(this.adapterRef.state.signalVideoSubscribedTime=Date.now()),this.adapterRef.instance.safeEmit("stream-subscribed",{stream:d,mediaType:c})}else this.adapterRef.instance.safeEmit("@pairing-createConsumer-error"),this.loggerRecv.log("[Subscribe] 该次consume状态错误: ",v.JSONBigStringify(d.pubStatus,null,""));return this.checkConsumerList(e)}async _createConsumerRts(e){const{uid:t,kind:r,id:n,mediaType:i,preferredSpatialLayer:o=0}=e,s="screenShare"===i?"screen":i;if(this.loggerRecv.log(`开始订阅 ${t} 的 ${s} 媒体: ${n} 大小流: ${o}`),!this.adapterRef._rtsTransport)return;if(!(this.adapterRef._signalling&&this.adapterRef._signalling._protoo&&this.adapterRef._signalling._protoo.request))return;if("audio"!==s&&"video"!==s&&"screen"!==s)return;if(!n)return this.adapterRef.instance.safeEmit("@pairing-createConsumer-error"),this.checkConsumerList(e);let a=this.adapterRef.remoteStreamMap[t];if(!a||!a.pubStatus[s][s]||!a.pubStatus[s].producerId)return this.adapterRef.instance.safeEmit("@pairing-createConsumer-error"),this.checkConsumerList(e);if(a.pubStatus[s].consumerId)return this.loggerRecv.log("已经订阅过，返回"),this.adapterRef.instance.safeEmit("@pairing-createConsumer-skip"),this.checkConsumerList(e);const c={requestId:""+Math.ceil(1e9*Math.random()),transportId:this.adapterRef._rtsTransport.transportId,uid:t,producerId:n,preferredSpatialLayer:o,pause:!1,rtsCapabilities:{codecs:[{kind:s,codec:"video"==s||"screen"==s?"h264":"opus",payloadType:"video"==s||"screen"==s?2:1}]}};if(this.loggerRecv.log("发送consume请求 =",v.JSONBigStringify(c)),!this.adapterRef._signalling||!this.adapterRef._signalling._protoo)throw e.resolve(null),new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"_createConsumerRts: _protoo 未找到 2"});const d=await this.adapterRef._signalling._protoo.request("WsConsume",c);this.loggerRecv.log("consume反馈结果 =",v.JSONBigStringify(d));let{transportId:p,rtpParameters:m,producerId:f,consumerId:h,code:g,errMsg:y}=d;try{const n=d.uid;return 200===g&&this.adapterRef.remoteStreamMap[t]?(this._consumers[h]={producerId:f,close:function(){return Promise.resolve()}},this.loggerRecv.log("订阅consume完成 peerId =",n),a=this.adapterRef.remoteStreamMap[t],a&&a.pubStatus[s].producerId?(a.subStatus[s]=!0,a.pubStatus[s][s]=!0,a.pubStatus[s].consumerId=h,a.pubStatus[s].producerId=f,this.adapterRef.instance.safeEmit("@pairing-createConsumer-success")):(this.loggerRecv.log("该次consume状态错误： ",v.JSONBigStringify(a.pubStatus,null,"")),this.adapterRef.instance.safeEmit("@pairing-createConsumer-error")),this.checkConsumerList(e)):(this.loggerRecv.error(`订阅 ${t} 的 ${r} 媒体失败, errcode: ${g}, reason: ${y} ，做容错处理: 重新建立下行连接`),this._eventQueue.length=0,void(this._recvTransport=null))}catch(e){return this.adapterRef&&this.loggerRecv.error('"newConsumer" request failed:',e.name,e.message,e),this.loggerRecv.error(`订阅 ${t} 的 ${s} 媒体失败，做容错处理: 重新建立下行连接`),this.adapterRef.instance.reBuildRecvTransport()}}async destroyConsumer(e,t,r){var n,i;if(e)try{const o=this._consumers[e];if(!o)return void this.loggerRecv.log("跳过停止订阅 destroyConsumer consumerId=",e,null==t?void 0:t.streamID);this.loggerRecv.log("停止订阅 destroyConsumer consumerId=",e,null==t?void 0:t.streamID),delete this._consumers[e];try{await(null===(i=null===(n=this.adapterRef._signalling)||void 0===n?void 0:n._protoo)||void 0===i?void 0:i.request("CloseConsumer",{requestId:""+Math.ceil(1e9*Math.random()),consumerId:e,producerId:o.producerId})),await o.close(),t&&r&&this.adapterRef.instance.safeEmit("@stream-unsubscribed",{stream:t,mediaType:r}),this.adapterRef.instance.apiEventReport("setFunction",{name:`set_${r}_sub`,oper:"0",value:v.JSONBigStringify({remoteUid:null==t?void 0:t.stringStreamID,consumerId:e||""},null," ")})}catch(e){this.logger.error("CloseConsumer失败",e.name,e.message,e)}}catch(e){this.loggerRecv.error("destroyConsumer() | failed:",e.name,e.message,e.stack)}}async closeTransport(e){var t,r;if(e&&e.id)try{this.logger.log(`closeTransport() [停止通道 transportId= ${e.id}]`);const n=await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("CloseTransport",{requestId:""+Math.ceil(1e9*Math.random()),transportId:e.id}));this.logger.log(`closeTransport() [停止通道反馈结果 result=${v.JSONBigStringify(n,null," ")}]`),e.close()}catch(e){this.logger.error("closeTransport() | failed:",e.name,e.message)}}async muteAudio(){var e,t,r,n;this.loggerSend.log("mute音频"),null===(e=this._micProducer)||void 0===e||e.pause();try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{producerId:null===(n=this._micProducer)||void 0===n?void 0:n.id,mute:!0}}}))}catch(e){this.loggerSend.error("muteAudio() | failed:",e.name,e.message,e)}}async unmuteAudio(){var e,t,r,n;this.loggerSend.log("unmute音频"),null===(e=this._micProducer)||void 0===e||e.resume();try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{producerId:null===(n=this._micProducer)||void 0===n?void 0:n.id,mute:!1}}}))}catch(e){return this.loggerSend.error("unmuteAudio() | failed: ",e.name,e.message),Promise.reject(e)}}async muteAudioSlave(){var e,t,r,n;this.loggerSend.log("mute音频辅流"),null===(e=this._audioSlaveProducer)||void 0===e||e.pause();try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{producerId:null===(n=this._audioSlaveProducer)||void 0===n?void 0:n.id,mute:!0}}}))}catch(e){this.loggerSend.error("muteAudioSlave() | failed:",e.name,e.message)}}async unmuteAudioSlave(){var e,t,r,n;this.loggerSend.log("unmute音频辅流"),null===(e=this._audioSlaveProducer)||void 0===e||e.resume();try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{producerId:null===(n=this._audioSlaveProducer)||void 0===n?void 0:n.id,mute:!1}}}))}catch(e){return this.loggerSend.error("unmuteAudioSlave() | failed: ",e.name,e.message),Promise.reject(e)}}async muteVideo(){var e,t,r,n;this.loggerSend.log("mute视频"),null===(e=this._webcamProducer)||void 0===e||e.pause();try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{producerId:null===(n=this._webcamProducer)||void 0===n?void 0:n.id,mute:!0}}}))}catch(e){this.loggerSend.error("muteVideo() | failed:",e.name,e.message)}}async unmuteVideo(){var e,t,r,n;this.loggerSend.log("unmute视频"),null===(e=this._webcamProducer)||void 0===e||e.resume();try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{producerId:null===(n=this._webcamProducer)||void 0===n?void 0:n.id,mute:!1}}}))}catch(e){this.loggerSend.error("unmuteVideo() | failed:",e.name,e.message)}}async muteScreen(){var e,t,r,n;this.loggerSend.log("mute屏幕共享"),null===(e=this._screenProducer)||void 0===e||e.pause();try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{producerId:null===(n=this._screenProducer)||void 0===n?void 0:n.id,mute:!0}}}))}catch(e){this.loggerSend.error("muteScreen() | failed: ",e.name,e.message)}}async unmuteScreen(){var e,t,r,n;this.loggerSend.log("unmute屏幕共享"),null===(e=this._screenProducer)||void 0===e||e.resume();try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"Mute",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{producerId:null===(n=this._screenProducer)||void 0===n?void 0:n.id,mute:!1}}}))}catch(e){this.loggerSend.error("unmuteScreen() | failed:",e.name,e.message)}}async updateUserRole(e){var t,r;this.loggerSend.log("updateUserRole() 更新用户角色为"+e);try{await(null===(r=null===(t=this.adapterRef._signalling)||void 0===t?void 0:t._protoo)||void 0===r?void 0:r.request("SendUserData",{externData:{type:"UserRole",cid:this.adapterRef.channelInfo.cid,uid:new y.SimpleBig(this.adapterRef.channelInfo.uid),data:{userRole:e}}}))}catch(e){throw this.loggerSend.error("updateUserRole() failed:",e.name,e.message),e}}async getIceStatus(e="send"){var t,r,n,i;const o=Date.now(),s={ts:Date.now(),direction:e,iceConnectionState:"uninit",info:"",stuckTime:-1,elapse:-1};let a;if(a="send"===e?null===(r=null===(t=this._sendTransport)||void 0===t?void 0:t._handler)||void 0===r?void 0:r._pc:null===(i=null===(n=this._recvTransport)||void 0===n?void 0:n._handler)||void 0===i?void 0:i._pc,a){if(s.info+="#"+a.pcid,s.iceConnectionState=a.iceConnectionState,s.info+="|iceConnectoinState "+a.iceConnectionState,a.iceStartedAt&&(s.elapse=o-a.iceStartedAt),this.iceStatusHistory[e].promises[0]&&(this.iceStatusHistory[e].promises[0](null),this.iceStatusHistory[e].promises=[]),"checking"===a.iceConnectionState){if(a.iceStartedAt||(a.iceStartedAt=o),await new Promise((t=>{this.iceStatusHistory[e].promises=[t],setTimeout(t,3e3)})),"checking"!==a.iceConnectionState)return s;s.elapse=Date.now()-a.iceStartedAt}"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState||(a.iceConnectedAt||(a.iceConnectedAt=o),await new Promise((t=>{this.iceStatusHistory[e].promises=[t],setTimeout(t,100)})));let t=null;try{let r=Date.now(),n=null;if("send"===e){let e=a.getSenders()[0];(null==e?void 0:e.track)&&(n=e.track)}else{let e=a.getReceivers()[0];(null==e?void 0:e.track)&&(n=e.track)}let i=a.getStats(n);s.stuckTime=Date.now()-r,t=await i}catch(e){}const r=[],n=[];let i=Date.now();t&&t.forEach(((e,t)=>{r.push(e),"transport"===e.type&&n.push(e)})),n.length||(s.info+="|no transport stats"),n.forEach((e=>{const t=r.find((t=>t.id===e.selectedCandidatePairId));if(t){const e=r.find((e=>e.id===t.localCandidateId));e?(s.info+=`|local:${e.protocol} `,s.info+=`${e.address||"NOADDRESS"}:${e.port||"NOPORT"} ${e.candidateType} ${e.networkType||""}`,s.networkType=e.networkType,s.protocol=e.protocol,s.relayProtocol=e.relayProtocol,s.ip=e.ip,s.address=e.address):s.info+="|无法找到localCandidate "+t.localCandidateId;const n=r.find((e=>e.id===t.remoteCandidateId));n?(s.info+=`|remote:${n.protocol} `,s.info+=`${n.address||"NOADDRESS"}:${n.port||"NOPORT"} ${n.candidateType}`):s.info+="|无法找到remoteCandidate "+t.remoteCandidateId}else s.info+="无法找到candidatePair "+e.selectedCandidatePairId})),s.stuckTime+=Date.now()-i}else s.info="no_pc_"+e;if(this.iceStatusHistory[e].status.info!==s.info&&"new"!==s.iceConnectionState&&this._mediasoupDevice){const t={new:1,checking:2,connected:3,completed:4,failed:-1,disconnected:-2,closed:-3},r=t[s.iceConnectionState||0]||0;r>0?(this.adapterRef.logger.log("iceConnectionStateChanged",e,s.info),r===t.connected&&"recv"===e&&this.adapterRef.state.iceRecvConnectedTime<this.adapterRef.state.signalJoinResTime&&(this.adapterRef.state.iceRecvConnectedTime=Date.now())):this.adapterRef.logger.warn("iceConnectionStateChanged",e,s.info),this.adapterRef.instance.apiFrequencyControl({name:"_iceStateChange_"+e,code:r,param:v.JSONBigStringify(s)}),this.adapterRef.instance.safeEmit("@ice-change",s)}return this.iceStatusHistory[e].status=s,s}getReceivers(e={}){const t=[];for(let r in this.adapterRef.remoteStreamMap){const n=this.adapterRef.remoteStreamMap[r];e.uid&&e.uid.toString()!==r||c.MediaTypeList.forEach((i=>{if(e.mediaType&&e.mediaType!==i)return;if(!n.active||!n.pubStatus[i].consumerId)return;const o=this._consumers[n.pubStatus[i].consumerId];o&&t.push({uid:r,mediaType:i,remoteStream:n,consumer:o})}))}return t}destroy(){this.logger.log("清除 meidasoup"),this._reset()}}t.Mediasoup=S},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.waitForEvent=void 0,t.waitForEvent=async function(e,t,r){return new Promise(((n,i)=>{let o;const s=e=>{o&&clearTimeout(o),n(e)};r&&(o=setTimeout((()=>{e.removeListener(t,s),i(`timed out after ${r}ms:${t}`)}),r)),e.once(t,s)}))}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;const a=o(r(126)),c=s(r(12)),u=s(r(13)),l=r(71),d=r(4),p=r(56),m=o(r(127)),f=o(r(72)),h=r(141),g=o(r(151)),v=r(152),y=o(r(153)),b=r(142),S="Chrome_",T={OS:1024,MIS:1024};let _=0;class w extends h.HandlerInterface{constructor(){super(),this._sendingRemoteRtpParametersByKind={},this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._transportReady=!1,this._appData={}}static createFactory(){return()=>new w}get name(){return"Chrome74"}get remoteSdp(){return this._remoteSdp}close(){if(p.Logger.debug(S,"close()"),this._pc)try{this._pc.onconnectionstatechange=null,this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){p.Logger.debug(S,"getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();t.sdp=t.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack");try{e.close()}catch(e){}const r=a.parse(t.sdp);return g.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return p.Logger.debug(S,"getNativeSctpCapabilities()"),{numStreams:T}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:u,appData:l}){p.Logger.debug(S,"run()"),this._appData=l,this._direction=e,this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",u),video:m.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",u),video:m.getSendingRemoteRtpParameters("video",u)},p.Logger.debug(S,"iceServers: ",o);const d={iceServers:o||[],iceTransportPolicy:s||"all",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"};l.encodedInsertableStreams&&(d.encodedInsertableStreams=!0),this._pc=new RTCPeerConnection(d,c),this._pc.pcid=_++,this._pc.onconnectionstatechange=()=>{switch(this._pc.connectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}},this._pc.onicecandidate=e=>{},this._pc.onicecandidateerror=e=>{p.Logger.warn("onicecandidateerror: ",e)}}async updateIceServers(e){p.Logger.debug(S,"updateIceServers(): ");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(p.Logger.debug(S,"restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if(this._direction){const e=await this._pc.createOffer({iceRestart:!0});let t=a.parse(e.sdp);t.media.forEach((e=>{"audio"===e.type&&"send"===this._direction&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),e.sdp=a.write(t),p.Logger.debug(S,"restartIce() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(e);const r={type:"answer",sdp:this._remoteSdp.getSdp()};p.Logger.debug(S,"restartIce() | calling pc.setRemoteDescription() [answer]"),await this._pc.setRemoteDescription(r)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};p.Logger.debug(S,"restartIce() | calling pc.setRemoteDescription()"),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();p.Logger.debug(S,"restartIce() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,trackLow:t,encodings:r,codecOptions:n,codec:i,appData:o}){this._assertSendDirection(),p.Logger.debug(S,`send() [kind: ${e.kind}, track.id: ${e.id}, appData: ${JSON.stringify(o)}]`),r&&r.length>1&&r.forEach(((e,t)=>{e.rid="r"+t}));const s=f.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);let d={},m={};const h=new MediaStream;"audio"===o.mediaType&&this._pc.audioSender?(p.Logger.debug(S,"audioSender 更新 track: ",this._pc.audioSender.track,"=>",e),this._pc.audioSender.replaceTrack(e)):"audioSlave"===o.mediaType&&this._pc.audioSlaveSender?(p.Logger.debug(S,"audioSlaveSender 更新 track: ",this._pc.audioSlaveSender.track,"=>",e),this._pc.audioSlaveSender.replaceTrack(e)):"video"===o.mediaType&&this._pc.videoSender?(p.Logger.debug(S,"videoSender 更新 track: ",this._pc.videoSender.track,"=>",e),this._pc.videoSender.replaceTrack(e),this._pc.videoSenderLow&&this._pc.videoSenderLow.track!==t&&(p.Logger.debug(S,"videoSenderLow 更新 track: ",this._pc.videoSenderLow),this._pc.videoSenderLow.replaceTrack(t))):"screenShare"===o.mediaType&&this._pc.screenSender?(p.Logger.debug(S,"screenSender 更新 track: ",this._pc.screenSender.track,"=>",e),this._pc.screenSender.replaceTrack(e),this._pc.screenSenderLow&&this._pc.screenSenderLow.track!==t&&(p.Logger.debug(S,"screenSenderLow 更新 track: ",this._pc.screenSenderLow),this._pc.screenSenderLow.replaceTrack(t))):(h.addTrack(e),d=this._pc.addTransceiver(e,{direction:"sendonly",streams:[h],sendEncodings:r}),t&&(m=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r})),"audio"!==o.mediaType||this._pc.audioSender?"audioSlave"!==o.mediaType||this._pc.audioSlaveSender?"video"!==o.mediaType||this._pc.videoSender?"screenShare"!==o.mediaType||this._pc.screenSender||(this._pc.screenSender=d.sender,this._pc.screenSenderLow=m.sender):(this._pc.videoSender=d.sender,this._pc.videoSenderLow=m.sender):this._pc.audioSlaveSender=d.sender:this._pc.audioSender=d.sender),p.Logger.debug(S,`send() | [transceivers: ${this._pc.getTransceivers().length}]`);let v,T,_,w=await this._pc.createOffer(),M=a.parse(w.sdp);o.preferRemb&&b.filterTransportCCFromSdp(M);const x=M.media.filter((r=>{const n=this._mapMidTransceiver.get(""+r.mid);return!(r.type!==e.kind||n&&n.sender&&n.sender.track&&(n.sender.track.id===e.id?(v=r,1):t&&n.sender.track.id===t.id&&(T=r,1)))}));v||(v=x.pop()),t&&!T&&(T=x.pop()),this._transportReady||(_=await this._setupTransport({localDtlsRole:"server",localSdpObject:M}));let E=null==v?void 0:v.mid;if("number"==typeof E&&(E=""+E),!E)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Chrome.send: localId 未找到"});let C=null;if(T&&(C=""+T.mid),s.mid=E,s.rtcp.cname=g.getCname({offerMediaObject:v}),r)if(1===r.length){let e=y.getRtpEncodings({offerMediaObject:v});Object.assign(e[0],r[0]),s.encodings=e}else s.encodings=r;else s.encodings=[],T&&(s.encodings=s.encodings.concat(y.getRtpEncodings({offerMediaObject:T}))),s.encodings=s.encodings.concat(y.getRtpEncodings({offerMediaObject:v}));return s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase())&&M.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),w.sdp=a.write(M),this._mapMidTransceiver.set(E,d),C&&this._mapMidTransceiver.set(C,m),{localId:E,localIdLow:C,rtpParameters:s,rtpSender:d.sender,rtpSenderLow:m.sender||null,dtlsParameters:_,offer:w}}async fillRemoteRecvSdp({kind:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,sendingRtpParameters:o,codecOptions:s,offer:c,audioProfile:u,codec:m}){p.Logger.debug(S,"fillRemoteRecvSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(c),this._remoteSdp||(this._remoteSdp=new v.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._remoteSdp.updateDtlsRole("client"));const h=f.clone(this._sendingRemoteRtpParametersByKind[e]);h.codecs=l.reduceCodecs(h.codecs,m);let g=a.parse(this._pc.localDescription.sdp);const y=this._remoteSdp.getNextMediaSectionIdx();let b=g.media[y.idx],T=null;o.encodings&&o.encodings.length>1&&(T=g.media[y.idx+1]),this._remoteSdp.send({offerMediaObjectArr:[b,T],reuseMid:y.reuseMid,offerRtpParameters:o,answerRtpParameters:h,codecOptions:s,extmapAllowMixed:!0});const _={type:"answer",sdp:this._remoteSdp.getSdp()};if(p.Logger.debug(S,"audioProfile设置为: ",u),u){let e=null;switch(u){case"speech_low_quality":e="maxplaybackrate=16000;sprop-maxcapturerate=16000;maxaveragebitrate=32000";break;case"speech_standard":e="maxplaybackrate=32000;sprop-maxcapturerate=32000;maxaveragebitrate=36000";break;case"music_standard":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;";break;case"standard_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=56000";break;case"high_quality":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=128000";break;case"high_quality_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=192000"}_.sdp.indexOf("a=fmtp:111")&&(_.sdp=_.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;useinbandfec=1;"+e)),_.sdp=_.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=maxptime:60")}p.Logger.debug(S,"fillRemoteRecvSdp() | calling pc.setRemoteDescription()"),d.getParameters().enableUdpCandidate||(_.sdp=_.sdp.replace(/\r\na=candidate:udpcandidate[^\r]+/g,"")),d.getParameters().enableTcpCandidate||(_.sdp=_.sdp.replace(/\r\na=candidate:tcpcandidate[^\r]+/g,"")),await this._pc.setRemoteDescription(_)}async stopSending(e,t){this._assertSendDirection(),p.Logger.debug(S,`stopSending() [kind: ${t}, localId: ${e}]`);const r=this._mapMidTransceiver.get(e);"audio"===t?this._pc.audioSender.replaceTrack(null):"audioSlave"===t?this._pc.audioSlaveSender.replaceTrack(null):"video"===t?(this._pc.videoSender.replaceTrack(null),this._pc.videoSenderLow&&this._pc.videoSenderLow.replaceTrack(null)):"screenShare"===t?(this._pc.screenSender.replaceTrack(null),this._pc.screenSenderLow&&this._pc.screenSenderLow.replaceTrack(null)):null==r||r.sender.replaceTrack(null);const n=await this._pc.createOffer();let i=a.parse(n.sdp);i.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),n.sdp=a.write(i),p.Logger.debug(S,"stopSending() | calling pc.setLocalDescription()");try{await this._pc.setLocalDescription(n)}catch(e){p.Logger.debug(S,"setLocalDescription error: ",e.message)}const o={type:"answer",sdp:this._remoteSdp.getSdp()};p.Logger.debug(S,"stopSending() | calling pc.setRemoteDescription()"),await this._pc.setRemoteDescription(o)}async replaceTrack(e,t){this._assertSendDirection(),t?p.Logger.debug(S,"replaceTrack() [localId:%s, track.id:%s]",e,t.id):p.Logger.debug(S,"replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);await(null==r?void 0:r.sender.replaceTrack(t))}async setMaxSpatialLayer(e,t){this._assertSendDirection(),p.Logger.debug(S,"setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e),n=null==r?void 0:r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await(null==r?void 0:r.sender.setParameters(n))}async setRtpEncodingParameters(e,t){this._assertSendDirection(),p.Logger.debug(S,"setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)return;const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Chrome.getSenderStats: RTCRtpTransceiver 未找到"});return t.sender.getStats()}async recoverTransceiver(e,t,r){p.Logger.debug(S,"recoverTransceiver() [kind:%s, remoteUid:%s, mid: %s]",r,e,t);const n=this._mapMidTransceiver.get(t);n?n.isUseless=!0:p.Logger.debug(S,"recoverTransceiver() transceiver undefined")}async prepareLocalSdp(e,t){p.Logger.debug(S,`[Subscribe] prepareLocalSdp() [kind: ${e}, remoteUid: ${t}]`);let r=-1;for(const t of this._mapMidTransceiver.keys()){const n=this._mapMidTransceiver.get(t);if(!n)continue;const i=n.receiver&&n.receiver.track&&n.receiver.track.kind||e;if(n.isUseless&&i===e){r=t-0,n.isUseless=!1;break}}let n=this._pc.localDescription,i=null;if(-1===r)p.Logger.debug(S,"[Subscribe] prepareLocalSdp() 添加一个M行"),i=this._pc.addTransceiver(e,{direction:"recvonly"}),n=await this._pc.createOffer(),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),n.sdp.indexOf("a=fmtp:111")&&(n.sdp=n.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z-]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1"));else if(!n){n=await this._pc.createOffer(),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),n.sdp.indexOf("a=fmtp:111")&&(n.sdp=n.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z-]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1"));const e=a.parse(n.sdp);r=e.media[e.media.length-1].mid}const o=a.parse(n.sdp);let s;this._transportReady||(s=await this._setupTransport({localDtlsRole:"server",localSdpObject:o}));const c=g.extractRtpCapabilities({sdpObject:o});return-1===r&&(r=o.media[o.media.length-1].mid,this._mapMidTransceiver.set(""+r,i)),{dtlsParameters:s,rtpCapabilities:c,offer:n,mid:r,iceUfragReg:""}}async receive({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,trackId:i,kind:o,rtpParameters:s,offer:a,probeSSrc:c=-1,remoteUid:u,extendedRtpCapabilities:l,appData:m}){this._assertRecvDirection(),p.Logger.debug(S,`[Subscribe] receive() [trackId: ${i}, kind: ${o}, remoteUid: ${u}]`),this._remoteSdp||(this._remoteSdp=new v.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n}),this._remoteSdp.updateDtlsRole("client"));let f=s&&s.mid||m.mid;if(p.Logger.debug(S,"[Subscribe] receive() mid: "+f),null==s?void 0:s.mid)this._remoteSdp.receive({mid:f,kind:o,offerRtpParameters:s,streamId:s.rtcp.cname,trackId:i});else{p.Logger.debug(S,"[Subscribe] receive() 容错流程");const e=[];l.codecs.forEach((t=>{if(t.kind===o){const r=Object.assign({},t);r.parameters=r.parameters||r.localParameters,r.payloadType=r.payloadType||r.localPayloadType,e.push(r)}}));const t={mid:f,kind:o,offerRtpParameters:{codecs:e,encodings:[{ssrc:0}],headerExtensions:[],rtcp:{},mid:f},streamId:o,trackId:i,reuseMediaSection:void 0};this._remoteSdp.receive(t),this._remoteSdp.disableMediaSection(""+f)}a.sdp=a.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),a.sdp.indexOf("a=fmtp:111")&&(a.sdp=a.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1"));const h={type:"answer",sdp:this._remoteSdp.getSdp()};h.sdp.indexOf("a=fmtp:111")&&(h.sdp=h.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1")),d.getParameters().enableUdpCandidate||(h.sdp=h.sdp.replace(/\r\na=candidate:udpcandidate[^\r]+/g,"")),d.getParameters().enableTcpCandidate||(h.sdp=h.sdp.replace(/\r\na=candidate:tcpcandidate[^\r]+/g,"")),p.Logger.debug(S,"[Subscribe] receive() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(a),p.Logger.debug(S,"[Subscribe] receive() | calling pc.setRemoteDescription()"),await this._pc.setRemoteDescription(h);const g=this._pc.getTransceivers().find((e=>e.mid===f));return this._mapMidTransceiver.set(f,g),{localId:f,track:g.receiver.track,rtpReceiver:g.receiver}}async stopReceiving(e){this._assertRecvDirection(),p.Logger.debug(S,"stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t||!t.mid)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Chrome.stopReceiving: RTCRtpTransceiver 未找到"});t.receiver&&t.receiver.track&&t.receiver.track&&"audio"===t.receiver.track.kind||(t.isUseless=!0),this._remoteSdp.disableMediaSection(t.mid);const r=this._pc.localDescription;p.Logger.debug(S,"stopReceiving() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};p.Logger.debug(S,"stopReceiving() | calling pc.setRemoteDescription()"),await this._pc.setRemoteDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Chrome.getReceiverStats: RTCRtpTransceiver 未找到"});return t.receiver.getStats()}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=g.extractDtlsParameters({sdpObject:t});return r.role=e,this._transportReady=!0,r}_assertSendDirection(){if("send"!==this._direction)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"_assertSendDirection: 操作异常"})}_assertRecvDirection(){if("recv"!==this._direction)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"_assertRecvDirection: 操作异常"})}}t.Chrome74=w},function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=n(e[o+1]))}(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=r(169),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach((function(e){var t=e[0],s=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var a=0;a<(o[t]||[]).length;a+=1){var c=o[t][a];if(c.reg.test(s))return i(c,n,s)}})),t.media=r,t};var a=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){var n=r(169),i=/%[sdv%]/g,o=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},s=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var s=t.names[i];t.name?n.push(r[t.name][s]):n.push(r[t.names[i]])}else n.push(r[t.name]);return o.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||a,i=t.innerOrder||c,o=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(s(t,r,e))}))}))})),e.media.forEach((function(e){o.push(s("m",n.m[0],e)),i.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?o.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){o.push(s(t,r,e))}))}))}))})),o.join("\r\n")+"\r\n"}},function(e,t,r){const n=r(222)("h264-profile-level-id");n.log=console.info.bind(console),t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5,t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;class i{constructor(e,t){this.profile=e,this.level=t}}t.ProfileLevelId=i;const o=new i(1,31);class s{constructor(e){this._mask=~u("x",e),this._maskedValue=u("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class a{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const c=[new a(66,new s("x1xx0000"),1),new a(77,new s("1xxx0000"),1),new a(88,new s("11xx0000"),1),new a(66,new s("x0xx0000"),2),new a(88,new s("10xx0000"),2),new a(77,new s("0x0x0000"),3),new a(100,new s("00000000"),5),new a(100,new s("00001100"),4)];function u(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function l(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const t=parseInt(e,16);if(0===t)return null;const r=255&t,o=t>>8&255,s=t>>16&255;let a;switch(r){case 11:a=0!=(16&o)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:a=r;break;default:return n("parseProfileLevelId() | unrecognized level_idc:%s",r),null}for(const e of c)if(s===e.profile_idc&&e.profile_iop.isMatch(o))return new i(e.profile,a);return n("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return n("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return n("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r="0"+r),`${t}${r}`},t.parseSdpProfileLevelId=function(e={}){const r=e["profile-level-id"];return r?t.parseProfileLevelId(r):o},t.isSameProfile=function(e={},r={}){const n=t.parseSdpProfileLevelId(e),i=t.parseSdpProfileLevelId(r);return Boolean(n&&i&&n.profile===i.profile)},t.generateProfileLevelIdForAnswer=function(e={},r={}){if(!e["profile-level-id"]&&!r["profile-level-id"])return n("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const o=t.parseSdpProfileLevelId(e),s=t.parseSdpProfileLevelId(r);if(!o)throw new TypeError("invalid local_profile_level_id");if(!s)throw new TypeError("invalid remote_profile_level_id");if(o.profile!==s.profile)throw new TypeError("H264 Profile mismatch");const a=l(e)&&l(r),c=o.level,u=function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(d=c,p=s.level)?d:p;var d,p;const m=a?c:u;return n("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",o.profile,m),t.profileLevelIdToString(new i(o.profile,m))}},function(e,t,r){(function(n){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(223)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(66))},function(e,t,r){e.exports=function(e){function t(e){let r,i,o,s=null;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),o=i-(r||i);n.diff=o,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";s++;const o=t.formatters[i];if("function"==typeof o){const t=e[s];r=o.call(n,t),e.splice(s,1),s--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(224),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},function(e,t){var r=1e3,n=6e4,i=60*n,o=24*i;function s(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===a&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=o?s(e,t,o,"day"):t>=i?s(e,t,i,"hour"):t>=n?s(e,t,n,"minute"):t>=r?s(e,t,r,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=o?Math.round(e/o)+"d":t>=i?Math.round(e/i)+"h":t>=n?Math.round(e/n)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;const s=o(r(72));class a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:n=!1}){if(this._mediaObject={},this._planB=n,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get type(){return String(this._mediaObject.type)}get closed(){return 0===this._mediaObject.port}set mid(e){this._mediaObject.mid=e}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}function c(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.MediaSection=a,t.AnswerMediaSection=class extends a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:o=!1,offerMediaObject:a,offerRtpParameters:u,answerRtpParameters:l,codecOptions:d,extmapAllowMixed:p=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:o}),this._mediaObject.mid=String(a.mid),this._mediaObject.type=a.type,this._mediaObject.protocol=a.protocol,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),a.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of l.codecs){const t={payload:e.payloadType,codec:c(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=s.clone(e.parameters,{});if(d){const{opusStereo:t,opusFec:n,opusDtx:i,opusMaxPlaybackRate:o,opusPtime:s,videoGoogleStartBitrate:a,videoGoogleMaxBitrate:c,videoGoogleMinBitrate:l}=d,p=u.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==t&&(p.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==n&&(p.parameters.useinbandfec=n?1:0,r.useinbandfec=n?1:0),void 0!==i&&(p.parameters.usedtx=i?1:0,r.usedtx=i?1:0),void 0!==o&&(r.maxplaybackrate=o),void 0!==s&&(p.parameters.ptime=s,r.ptime=s);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==a&&(r["x-google-start-bitrate"]=a),void 0!==c&&(r["x-google-max-bitrate"]=c),void 0!==l&&(r["x-google-min-bitrate"]=l)}}const n={payload:e.payloadType,config:""};for(const e of Object.keys(r))n.config&&(n.config+=";"),n.config+=`${e}=${r[e]}`;n.config&&this._mediaObject.fmtp.push(n);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=l.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of l.headerExtensions)(a.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id});if(p&&"extmap-allow-mixed"===a.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),a.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:a.simulcast.list1},this._mediaObject.rids=[];for(const e of a.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(a.simulcast_03){this._mediaObject.simulcast_03={value:a.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of a.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof a.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize):a.sctpmap&&(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}},t.OfferMediaSection=class extends a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:i,planB:o=!1,mid:s,kind:a,offerRtpParameters:u,streamId:l,trackId:d,oldDataChannelSpec:p=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:o}),this._mediaObject.mid=String(s),this._mediaObject.type=a,i?(this._mediaObject.connection={ip:i.ip,version:i.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=i.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=n?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),a){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${l||"-"} ${d}`);for(const e of u.codecs){const t={payload:e.payloadType||e.localPayloadType||125,codec:c(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType||e.localPayloadType||125,config:""},n=e.parameters||e.localParameters||{};for(const e of Object.keys(n))r.config&&(r.config+=";"),r.config+=`${e}=${n[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=u.codecs.map((e=>e.payloadType||e.localPayloadType||125)).join(" "),this._mediaObject.ext=[];for(const e of u.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=u.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],u.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:u.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${l||"-"} ${d}`}),r&&(u.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:u.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${l||"-"} ${d}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":p?(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize)}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const n=e.encodings[0],i=n.ssrc,o=n.rtx&&n.rtx.ssrc?n.rtx.ssrc:void 0;e.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${t||"-"} ${r}`}),o&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${i} ${o}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==n)),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${n}`)))}}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;const a=o(r(126)),c=s(r(12)),u=s(r(13)),l=r(71),d=r(4),p=r(56),m=o(r(127)),f=o(r(72)),h=r(141),g=o(r(151)),v=r(152),y=o(r(153)),b=r(142),S="Firefox_",T={OS:1024,MIS:1024};let _=0;class w extends h.HandlerInterface{constructor(){super(),this._sendingRemoteRtpParametersByKind={},this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._transportReady=!1,this._appData={},this.signalingState="stable"}static createFactory(){return()=>new w}get name(){return"Firefox60"}get remoteSdp(){return this._remoteSdp}close(){if(p.Logger.debug(S,"close()"),this._pc)try{this._pc.oniceconnectionstatechange=null,this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){p.Logger.debug(S,"getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();t.sdp=t.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack");try{e.close()}catch(e){}const r=a.parse(t.sdp);return g.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return p.Logger.debug(S,"getNativeSctpCapabilities()"),{numStreams:T}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:u,appData:l}){p.Logger.debug(S,"run()",l),this._appData=l,this._direction=e,this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",u),video:m.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",u),video:m.getSendingRemoteRtpParameters("video",u)},p.Logger.debug(S,"iceServers: %o",o);const d={iceServers:o||[],iceTransportPolicy:s||"all",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"};l.encodedInsertableStreams&&(d.encodedInsertableStreams=!0),this._pc=new RTCPeerConnection(d,c),this._pc.pcid=_++,this._pc.oniceconnectionstatechange=()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}},this._pc.onicecandidate=e=>{},this._pc.onicecandidateerror=e=>{p.Logger.debug("onicecandidateerror: ",e)}}async updateIceServers(e){p.Logger.debug(S,"updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(p.Logger.debug(S,"restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if(this._direction){const e=await this._pc.createOffer({iceRestart:!0});e.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(e.sdp=e.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-_\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#${this._direction}`));let t=a.parse(e.sdp);t.media.forEach((e=>{"audio"===e.type&&"send"===this._direction&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),e.sdp=a.write(t),p.Logger.debug(S,"restartIce() | calling pc.setLocalDescription()"),this.signalingState="have-local-offer",await this._pc.setLocalDescription(e);const r={type:"answer",sdp:this._remoteSdp.getSdp()};p.Logger.debug(S,"restartIce() | calling pc.setRemoteDescription()"),this.signalingState="stable",await this._pc.setRemoteDescription(r)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};p.Logger.debug(S,"restartIce() | calling pc.setRemoteDescription()"),this.signalingState="stable",await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();p.Logger.debug(S,"restartIce() | calling pc.setLocalDescription() [answer:%o]",t),this.signalingState="have-local-offer",await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,trackLow:t,encodings:r,codecOptions:n,codec:i,appData:o}){this._assertSendDirection(),p.Logger.debug(S,`[Produce] send() [kind: ${e.kind}, track.id: ${e.id}, appData: ${JSON.stringify(o)}]`),r&&r.length>1&&(r.forEach(((e,t)=>{e.rid="r"+t})),r.reverse());const s=f.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);let d={},m={};const h=new MediaStream;"audio"===o.mediaType&&this._pc.audioSender?(p.Logger.debug(S,"[Produce] audioSender更新track: ",this._pc.audioSender),this._pc.audioSender.replaceTrack(e)):"video"===o.mediaType&&this._pc.videoSender?(p.Logger.debug(S,"[Produce] videoSender更新track: ",this._pc.videoSender),this._pc.videoSender.replaceTrack(e),this._pc.videoSenderLow&&this._pc.videoSenderLow.track!==t&&(p.Logger.debug(S,"[Produce] videoSenderLow更新track: ",this._pc.videoSenderLow),this._pc.videoSenderLow.replaceTrack(t))):"screenShare"===o.mediaType&&this._pc.screenSender?(p.Logger.debug(S,"[Produce] screenSender更新track: ",this._pc.screenSender),this._pc.screenSender.replaceTrack(e),this._pc.screenSenderLow&&this._pc.screenSenderLow.track!==t&&(p.Logger.debug(S,"[Produce] screenSenderLow更新track: ",this._pc.screenSenderLow),this._pc.screenSenderLow.replaceTrack(t))):(h.addTrack(e),d=this._pc.addTransceiver(e,{direction:"sendonly",streams:[h],sendEncodings:r}),t&&(m=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r})),"audio"!==o.mediaType||this._pc.audioSender?"video"!==o.mediaType||this._pc.videoSender?"screenShare"!==o.mediaType||this._pc.screenSender||(this._pc.screenSender=d.sender,this._pc.screenSenderLow=m.sender):(this._pc.videoSender=d.sender,this._pc.videoSenderLow=m.sender):this._pc.audioSender=d.sender),p.Logger.debug(S,"[Produce] send() | [transceivers:%d]",this._pc.getTransceivers().length);let v=await this._pc.createOffer();v.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(v.sdp=v.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-_\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#send`));let T,_,w,M=a.parse(v.sdp);o.preferRemb&&b.filterTransportCCFromSdp(M);const x=M.media.filter((r=>{const n=this._mapMidTransceiver.get(""+r.mid);return!(r.type!==e.kind||n&&n.sender&&n.sender.track&&(n.sender.track.id===e.id?(T=r,1):t&&n.sender.track.id===t.id&&(_=r,1)))}));T||(T=x.pop()),t&&!_&&(_=x.pop()),this._transportReady||(w=await this._setupTransport({localDtlsRole:"server",localSdpObject:M}));let E=null==T?void 0:T.mid;if("number"==typeof E&&(E=""+E),!E)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Firefox.send: localId 未找到"});let C=null;if(_&&(C=""+_.mid),s.mid=E,s.rtcp.cname=g.getCname({offerMediaObject:T}),r)if(1===r.length){let e=y.getRtpEncodings({offerMediaObject:T});Object.assign(e[0],r[0]),s.encodings=e}else s.encodings=r.reverse();else s.encodings=[],_&&(s.encodings=s.encodings.concat(y.getRtpEncodings({offerMediaObject:_}))),s.encodings=s.encodings.concat(y.getRtpEncodings({offerMediaObject:T}));return s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||s.codecs[0].mimeType.toLowerCase()),M.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),v.sdp=a.write(M),this._mapMidTransceiver.set(E,d),C&&this._mapMidTransceiver.set(C,m),{localId:E,localIdLow:C,rtpParameters:s,rtpSender:d.sender,rtpSenderLow:m.sender||null,dtlsParameters:w,offer:v}}async fillRemoteRecvSdp({kind:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,sendingRtpParameters:o,codecOptions:s,offer:c,audioProfile:u,codec:d}){p.Logger.debug(S,"fillRemoteRecvSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(c),this._remoteSdp||(this._remoteSdp=new v.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._remoteSdp.updateDtlsRole("client"));const m=f.clone(this._sendingRemoteRtpParametersByKind[e]);m.codecs=l.reduceCodecs(m.codecs,d);let h=a.parse(this._pc.localDescription.sdp);const g=this._remoteSdp.getNextMediaSectionIdx();let y=h.media[g.idx],b=null;o.encodings&&o.encodings.length>1&&(b=h.media[g.idx+1]),this._remoteSdp.send({offerMediaObjectArr:[y,b],reuseMid:g.reuseMid,offerRtpParameters:o,answerRtpParameters:m,codecOptions:s,extmapAllowMixed:!0});const T={type:"answer",sdp:this._remoteSdp.getSdp()};if(p.Logger.debug(S,"audioProfile设置为: ",u),u){let e=null;switch(u){case"speech_low_quality":e="maxplaybackrate=16000;sprop-maxcapturerate=16000;maxaveragebitrate=32000";break;case"speech_standard":e="maxplaybackrate=32000;sprop-maxcapturerate=32000;maxaveragebitrate=36000";break;case"music_standard":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;";break;case"standard_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=56000";break;case"high_quality":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=128000";break;case"high_quality_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=192000"}T.sdp.indexOf("a=fmtp:111")&&(T.sdp=T.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;useinbandfec=1;"+e)),T.sdp=T.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=maxptime:60")}p.Logger.debug(S,"fillRemoteRecvSdp() | calling pc.setRemoteDescription()"),await this._pc.setRemoteDescription(T)}async stopSending(e,t){this._assertSendDirection(),p.Logger.debug(S,"stopSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Firefox.stopSending: RTCRtpTransceiver 未找到"});"audio"===t?this._pc.audioSender.replaceTrack(null):"video"===t?(this._pc.videoSender.replaceTrack(null),this._pc.videoSenderLow&&this._pc.videoSenderLow.replaceTrack(null)):"screenShare"===t?(this._pc.screenSender.replaceTrack(null),this._pc.screenSenderLow&&this._pc.screenSenderLow.replaceTrack(null)):(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid));const n=await this._pc.createOffer();n.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(n.sdp=n.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#send`));let i=a.parse(n.sdp);i.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),n.sdp=a.write(i),p.Logger.debug(S,"stopSending() | calling pc.setLocalDescription()");try{await this._pc.setLocalDescription(n)}catch(e){p.Logger.debug(S,"setLocalDescription error = %o",e)}const o={type:"answer",sdp:this._remoteSdp.getSdp()};p.Logger.debug(S,"stopSending() | calling pc.setRemoteDescription()"),await this._pc.setRemoteDescription(o),this._mapMidTransceiver.delete(e)}async replaceTrack(e,t){this._assertSendDirection(),t?p.Logger.debug(S,"replaceTrack() [localId:%s, track.id:%s]",e,t.id):p.Logger.debug(S,"replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);await(null==r?void 0:r.sender.replaceTrack(t))}async setMaxSpatialLayer(e,t){this._assertSendDirection(),p.Logger.debug(S,"setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e),n=null==r?void 0:r.sender.getParameters();t=n.encodings.length-1-t,n.encodings.forEach(((e,r)=>{e.active=r>=t})),await(null==r?void 0:r.sender.setParameters(n))}async setRtpEncodingParameters(e,t){this._assertSendDirection(),p.Logger.debug(S,"setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Firefox.setRtpEncodingParameters: RTCRtpTransceiver 未找到"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Firefox.getSenderStats: RTCRtpTransceiver 未找到"});return t.sender.getStats()}async recoverTransceiver(e,t,r){p.Logger.debug(S,"recoverTransceiver() [kind:%s, remoteUid:%s, mid: %s]",r,e,t);const n=this._mapMidTransceiver.get(t);n?n.isUseless=!0:p.Logger.debug(S,"recoverTransceiver() transceiver undefined")}async prepareLocalSdp(e,t){p.Logger.debug(S,`[Subscribe] prepareLocalSdp() [kind: ${e}, remoteUid: ${t}]`);let r=-1;for(const t of this._mapMidTransceiver.keys()){const n=this._mapMidTransceiver.get(t);if(!n)continue;const i=n.receiver&&n.receiver.track&&n.receiver.track.kind||e;if(n.isUseless&&i===e){r=t-0,n.isUseless=!1;break}}let n=this._pc.localDescription,i=null;if(-1===r)p.Logger.debug(S,"[Subscribe] prepareLocalSdp() 添加一个M行"),i=this._pc.addTransceiver(e,{direction:"recvonly"}),n=await this._pc.createOffer(),n.sdp.indexOf(`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#`)<0&&(n.sdp=n.sdp.replace(/a=ice-ufrag:([0-9a-zA-Z=+-_\/\\\\]+)/g,`a=ice-ufrag:${this._appData.cid}#${this._appData.uid}#recv`),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"));else if(!n){n=await this._pc.createOffer(),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),n.sdp.indexOf("a=fmtp:111")&&(n.sdp=n.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z-]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1"));const e=a.parse(n.sdp);r=e.media[e.media.length-1].mid}const o=a.parse(n.sdp);let s;this._transportReady||(s=await this._setupTransport({localDtlsRole:"server",localSdpObject:o}));const c=g.extractRtpCapabilities({sdpObject:o});return-1===r&&(r=o.media[o.media.length-1].mid,this._mapMidTransceiver.set(""+r,i)),{dtlsParameters:s,rtpCapabilities:c,offer:n,mid:r,iceUfragReg:""}}async receive({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,trackId:i,kind:o,rtpParameters:s,offer:a,probeSSrc:c=-1,remoteUid:u,extendedRtpCapabilities:l,appData:m}){this._assertRecvDirection(),p.Logger.debug(S,`[Subscribe] receive() [trackId: ${i}, kind: ${o}, remoteUid: ${u}]`),this._remoteSdp||(this._remoteSdp=new v.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n}),this._remoteSdp.updateDtlsRole("client"));let f=s&&s.mid||m.mid;if(p.Logger.debug(S,"[Subscribe] receive() mid: "+f),s.mid)this._remoteSdp.receive({mid:f,kind:o,offerRtpParameters:s,streamId:s.rtcp.cname,trackId:i});else{p.Logger.debug(S,"[Subscribe] receive() 容错流程");const e=[];l.codecs.forEach((t=>{if(t.kind===o){const r=Object.assign({},t);r.parameters=r.parameters||r.localParameters,r.payloadType=r.payloadType||r.localPayloadType,e.push(r)}}));const t={mid:f,kind:o,offerRtpParameters:{codecs:e,encodings:[{ssrc:0}],headerExtensions:[],rtcp:{},mid:f},streamId:o,trackId:i,reuseMediaSection:void 0};this._remoteSdp.receive(t),this._remoteSdp.disableMediaSection(""+f)}const h={type:"answer",sdp:this._remoteSdp.getSdp()};h.sdp.indexOf("a=fmtp:111")&&(h.sdp=h.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1")),d.getParameters().enableUdpCandidate||(h.sdp=h.sdp.replace(/\r\na=candidate:udpcandidate[^\r]+/g,"")),d.getParameters().enableTcpCandidate||(h.sdp=h.sdp.replace(/\r\na=candidate:tcpcandidate[^\r]+/g,"")),p.Logger.debug(S,"[Subscribe] receive() | calling pc.setLocalDescription()");try{await this._pc.setLocalDescription(a)}catch(e){if("InvalidModificationError"!==e.name)throw e;await this._pc.createOffer(),await this._pc.setLocalDescription(a)}p.Logger.debug(S,"[Subscribe] receive() | calling pc.setRemoteDescription()"),await this._pc.setRemoteDescription(h);const g=this._pc.getTransceivers().find((e=>e.mid===f));return g.isUseless=!s.mid,this._mapMidTransceiver.set(f,g),{localId:f,track:g.receiver.track,rtpReceiver:g.receiver}}async stopReceiving(e){this._assertRecvDirection(),p.Logger.debug(S,"stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t||!t.mid)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Firefox.stopReceiving: RTCRtpTransceiver 未找到"});t.receiver&&t.receiver.track&&t.receiver.track&&"audio"===t.receiver.track.kind||(t.isUseless=!0),this._remoteSdp.disableMediaSection(t.mid)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Firefox.getReceiverStats: RTCRtpTransceiver 未找到"});return t.receiver.getStats()}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=g.extractDtlsParameters({sdpObject:t});return r.role=e,this._transportReady=!0,r}_assertSendDirection(){if("send"!==this._direction)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"_assertSendDirection: 操作异常"})}_assertRecvDirection(){if("recv"!==this._direction)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"_assertRecvDirection: 操作异常"})}}t.Firefox60=w},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;const a=o(r(126)),c=s(r(12)),u=s(r(13)),l=r(71),d=r(228),p=r(4),m=r(56),f=o(r(127)),h=o(r(72)),g=r(141),v=o(r(151)),y=r(152),b=o(r(153)),S=r(142),T="Safari_",_={OS:1024,MIS:1024};let w=0;class M extends g.HandlerInterface{constructor(){super(),this._sendingRemoteRtpParametersByKind={},this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._transportReady=!1,this._appData={}}static createFactory(){return()=>new M}get name(){return"Safari12"}get remoteSdp(){return this._remoteSdp}close(){if(m.Logger.debug(T,"close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.Logger.debug(T,"getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();t.sdp=t.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack");try{e.close()}catch(e){}const r=a.parse(t.sdp);return v.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.Logger.debug(T,"getNativeSctpCapabilities()"),{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,extendedRtpCapabilities:u,appData:l}){m.Logger.debug(T,"run()"),this._direction=e,this._appData=l,this._sendingRtpParametersByKind={audio:f.getSendingRtpParameters("audio",u),video:f.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:f.getSendingRemoteRtpParameters("audio",u),video:f.getSendingRemoteRtpParameters("video",u)},this._pc=new RTCPeerConnection(Object.assign({iceServers:o||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},a),c),this._pc.pcid=w++,this._pc.onconnectionstatechange=()=>{switch(this._pc.connectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}}async updateIceServers(e){m.Logger.debug(T,"updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.Logger.debug(T,"restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if(this._direction){const e=await this._pc.createOffer({iceRestart:!0});let t=a.parse(e.sdp);t.media.forEach((e=>{"audio"===e.type&&"send"===this._direction&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),e.sdp=a.write(t),m.Logger.debug(T,"restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const r={type:"answer",sdp:this._remoteSdp.getSdp()};m.Logger.debug(T,"restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.Logger.debug(T,"restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.Logger.debug(T,"restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,trackLow:t,encodings:r,codecOptions:n,codec:i,appData:o}){this._assertSendDirection(),m.Logger.debug(T,`send() [kind: ${e.kind}, track.id: ${e.id}, appData: ${JSON.stringify(o)}]`);const s=h.clone(this._sendingRtpParametersByKind[e.kind],{});s.codecs=l.reduceCodecs(s.codecs,i);let d={},p={};const f=new MediaStream;"audio"===o.mediaType&&this._pc.audioSender?(m.Logger.warn(T,"audioSender更新track: ",this._pc.audioSender.track,"=>",e),this._pc.audioSender.replaceTrack(e)):"video"===o.mediaType&&this._pc.videoSender?(m.Logger.warn(T,"videoSender更新track: ",this._pc.videoSender.track,"=>",e),this._pc.videoSender.replaceTrack(e),this._pc.videoSenderLow&&this._pc.videoSenderLow.track!==t&&(m.Logger.debug(T,"videoSenderLow更新track: ",this._pc.videoSenderLow),this._pc.videoSenderLow.replaceTrack(t))):"screenShare"===o.mediaType&&this._pc.screenSender?(m.Logger.warn(T,"screenSender更新track: ",this._pc.screenSender.track,"=>",e),this._pc.screenSender.replaceTrack(e),this._pc.screenSenderLow&&this._pc.screenSenderLow.track!==t&&(m.Logger.debug(T,"screenSenderLow更新track: ",this._pc.screenSenderLow),this._pc.screenSenderLow.replaceTrack(t))):(f.addTrack(e),d=this._pc.addTransceiver(e,{direction:"sendonly",streams:[f],sendEncodings:r}),t&&(p=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r})),"audio"!==o.mediaType||this._pc.audioSender?"video"!==o.mediaType||this._pc.videoSender?"screenShare"!==o.mediaType||this._pc.screenSender||(this._pc.screenSender=d.sender,this._pc.screenSenderLow=p.sender):(this._pc.videoSender=d.sender,this._pc.videoSenderLow=p.sender):this._pc.audioSender=d.sender),"audio"!==o.mediaType||this._pc.audioSender?"video"!==o.mediaType||this._pc.videoSender?"screenShare"!==o.mediaType||this._pc.screenSender||(this._pc.screenSender=d.sender):this._pc.videoSender=d.sender:this._pc.audioSender=d.sender,m.Logger.debug(T,"send() | [transceivers:%d]",this._pc.getTransceivers().length);let g,y,_,w=await this._pc.createOffer(),M=a.parse(w.sdp);o.preferRemb&&S.filterTransportCCFromSdp(M);const x=M.media.filter((r=>{const n=this._mapMidTransceiver.get(""+r.mid);return!(r.type!==e.kind||n&&n.sender&&n.sender.track&&(n.sender.track.id===e.id?(g=r,1):t&&n.sender.track.id===t.id&&(y=r,1)))}));g||(g=x.pop()),t&&!y&&(y=x.pop()),this._transportReady||(_=await this._setupTransport({localDtlsRole:"server",localSdpObject:M}));let E=null==g?void 0:g.mid;if("number"==typeof E&&(E=""+E),!E)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Safari.send: localId 未找到"});let C=null;if(y&&(C=""+y.mid),s.mid=E,m.Logger.debug(T,"要检查M行: ",g),s.rtcp.cname=v.getCname({offerMediaObject:g}),r)if(1===r.length){let e=b.getRtpEncodings({offerMediaObject:g});Object.assign(e[0],r[0]),s.encodings=e}else s.encodings=r;else s.encodings=[],y&&(s.encodings=s.encodings.concat(b.getRtpEncodings({offerMediaObject:y}))),s.encodings=s.encodings.concat(b.getRtpEncodings({offerMediaObject:g}));return s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase())&&M.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),w.sdp=a.write(M),this._mapMidTransceiver.set(E,d),C&&this._mapMidTransceiver.set(C,p),{localId:E,localIdLow:C,rtpParameters:s,rtpSender:d.sender,rtpSenderLow:p.sender||null,dtlsParameters:_,offer:w}}async fillRemoteRecvSdp({kind:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,sendingRtpParameters:o,codecOptions:s,offer:c,audioProfile:u,codec:p}){let f=a.parse(c.sdp);f.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),c.sdp=a.write(f),m.Logger.debug(T,"fillRemoteRecvSdp() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(c),this._remoteSdp||(this._remoteSdp=new y.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i}),this._remoteSdp.updateDtlsRole("client"));const g=h.clone(this._sendingRemoteRtpParametersByKind[e]);g.codecs=l.reduceCodecs(g.codecs,p);let v=a.parse(this._pc.localDescription.sdp);const b=this._remoteSdp.getNextMediaSectionIdx();let S=v.media[b.idx],_=null;o.encodings&&o.encodings.length>1&&(_=v.media[b.idx+1]),this._remoteSdp.send({offerMediaObjectArr:[S,_],reuseMid:b.reuseMid,offerRtpParameters:o,answerRtpParameters:g,codecOptions:s,extmapAllowMixed:!0});const w={type:"answer",sdp:this._remoteSdp.getSdp()};if(m.Logger.debug(T,"audioProfile设置为: ",u),u){let e=null;switch(u){case"speech_low_quality":e="maxplaybackrate=16000;sprop-maxcapturerate=16000;maxaveragebitrate=32000";break;case"speech_standard":e="maxplaybackrate=32000;sprop-maxcapturerate=32000;maxaveragebitrate=36000";break;case"music_standard":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;";break;case"standard_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=56000";break;case"high_quality":e="maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=128000";break;case"high_quality_stereo":e="stereo=1;sprop-stereo=1;maxplaybackrate=48000;sprop-maxcapturerate=48000;maxaveragebitrate=192000"}w.sdp.indexOf("a=fmtp:111")&&(w.sdp=w.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;useinbandfec=1;"+e)),w.sdp=w.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=maxptime:60")}d.canShimVideoOrientation(c,w)&&d.shimVideoOrientation(c,w),m.Logger.debug(T,"fillRemoteRecvSdp() | calling pc.setRemoteDescription() [answer:%o]",w.sdp),await this._pc.setRemoteDescription(w)}async stopSending(e,t){this._assertSendDirection(),m.Logger.debug(T,"stopSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);"audio"===t?(this._pc.audioSender.replaceTrack(null),m.Logger.debug(T,"删除发送的audio track: ",this._pc.audioSender)):"video"===t?(this._pc.videoSenderLow&&this._pc.videoSenderLow.replaceTrack(null),this._pc.videoSender.replaceTrack(null),m.Logger.debug(T,"删除发送的video track: ",this._pc.videoSender)):"screenShare"===t?(this._pc.screenSender.replaceTrack(null),this._pc.screenSenderLow&&this._pc.screenSenderLow.replaceTrack(null),m.Logger.debug(T,"删除发送的screen track: ",this._pc.screenSender)):null==r||r.sender.replaceTrack(null);const n=await this._pc.createOffer();let i=a.parse(n.sdp);i.media.forEach((e=>{"audio"===e.type&&e.ext&&e.rtcpFb&&(e.ext=e.ext.filter((e=>-1==e.uri.indexOf("transport-wide-cc")&&-1==e.uri.indexOf("abs-send-time"))),e.rtcpFb=e.rtcpFb.map((e=>(e.type=e.type.replace(/transport-cc/g,"nack"),e))))})),n.sdp=a.write(i),m.Logger.debug(T,"stopSending() | calling pc.setLocalDescription() [offer:%o]",n.sdp),await this._pc.setLocalDescription(n);const o={type:"answer",sdp:this._remoteSdp.getSdp()};m.Logger.debug(T,"stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async replaceTrack(e,t){this._assertSendDirection(),t?m.Logger.debug(T,"replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.Logger.debug(T,"replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);await(null==r?void 0:r.sender.replaceTrack(t))}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.Logger.debug(T,"setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Safari.setMaxSpatialLayer: RTCRtpTransceiver 未找到"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(n)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.Logger.debug(T,"setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Safari.setRtpEncodingParameters: RTCRtpTransceiver 未找到"});const n=r.sender.getParameters();n.encodings.forEach(((e,r)=>{n.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(n)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Safari.getSenderStats: RTCRtpTransceiver 未找到"});return t.sender.getStats()}async recoverTransceiver(e,t,r){m.Logger.debug(T,"recoverTransceiver() [kind:%s, remoteUid:%s, mid: %s]",r,e,t);const n=this._mapMidTransceiver.get(t);n?n.isUseless=!0:m.Logger.debug(T,"recoverTransceiver() transceiver undefined")}async prepareLocalSdp(e,t){m.Logger.debug(T,`[Subscribe] prepareLocalSdp() [kind: ${e}, remoteUid: ${t}]`);let r=-1;for(const t of this._mapMidTransceiver.keys()){const n=this._mapMidTransceiver.get(t);if(!n)continue;const i=n.receiver&&n.receiver.track&&n.receiver.track.kind||e;if(n.isUseless&&i===e){r=t-0,n.isUseless=!1;break}}let n=null,i=null;if(-1===r)m.Logger.debug(T,"[Subscribe] prepareLocalSdp() 添加一个M行"),i=this._pc.addTransceiver(e,{direction:"recvonly"}),n=await this._pc.createOffer(),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack");else if(this._pc.localDescription)n={type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp};else if(!this._pc.localDescription){n=await this._pc.createOffer(),n.sdp=n.sdp.replace(/a=rtcp-fb:111 transport-cc/g,"a=rtcp-fb:111 transport-cc\r\na=rtcp-fb:111 nack"),n.sdp.indexOf("a=fmtp:111")&&(n.sdp=n.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z-]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1"));const e=a.parse(n.sdp);r=e.media[e.media.length-1].mid}const o=a.parse(n.sdp);let s;this._transportReady||(s=await this._setupTransport({localDtlsRole:"server",localSdpObject:o}));const c=v.extractRtpCapabilities({sdpObject:o});return-1===r&&(r=o.media[o.media.length-1].mid,this._mapMidTransceiver.set(""+r,i)),{dtlsParameters:s,rtpCapabilities:c,offer:n,mid:r,iceUfragReg:""}}async receive({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,trackId:i,kind:o,rtpParameters:s,offer:a,probeSSrc:l=-1,remoteUid:d,extendedRtpCapabilities:f,appData:h}){this._assertRecvDirection(),m.Logger.debug(T,`[Subscribe] receive() [trackId: ${i}, kind: ${o}, remoteUid: ${d}]`),this._remoteSdp||(this._remoteSdp=new y.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n}),this._remoteSdp.updateDtlsRole("client"));let g=s&&s.mid||h.mid;if(m.Logger.debug(T,"receive() mid: "+g),s.mid)this._remoteSdp.receive({mid:g,kind:o,offerRtpParameters:s,streamId:s.rtcp.cname,trackId:i});else{m.Logger.debug(T,"[Subscribe] receive() 容错流程");const e=[];f.codecs.forEach((t=>{if(t.kind===o){const r=Object.assign({},t);r.parameters=r.parameters||r.localParameters,r.payloadType=r.payloadType||r.localPayloadType,e.push(r)}}));const t={mid:g,kind:o,offerRtpParameters:{codecs:e,encodings:[{ssrc:0}],headerExtensions:[],rtcp:{},mid:g},streamId:o,trackId:i,reuseMediaSection:void 0};this._remoteSdp.receive(t),this._remoteSdp.disableMediaSection(""+g)}let v={type:"answer",sdp:this._remoteSdp.getSdp()};v.sdp.indexOf("a=fmtp:111")&&(v.sdp=v.sdp.replace(/a=fmtp:111 ([0-9=;a-zA-Z]*)/,"a=fmtp:111 minptime=10;stereo=1;sprop-stereo=1;useinbandfec=1")),p.getParameters().enableUdpCandidate||(v.sdp=v.sdp.replace(/\r\na=candidate:udpcandidate[^\r]+/g,"")),p.getParameters().enableTcpCandidate||(v.sdp=v.sdp.replace(/\r\na=candidate:tcpcandidate[^\r]+/g,"")),m.Logger.debug(T,"[Subscribe] receive() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(a),m.Logger.debug(T,"[Subscribe] receive() | calling pc.setRemoteDescription()"),await this._pc.setRemoteDescription(v);const b=this._pc.getTransceivers().find((e=>e.mid===g));if(!b)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Safari.receive: RTCRtpTransceiver 未找到"});return this._mapMidTransceiver.set(g,b),{localId:g,track:b.receiver.track,rtpReceiver:b.receiver}}async stopReceiving(e){this._assertRecvDirection(),m.Logger.debug(T,"stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t||!t.mid)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Safari.stopReceiving: RTCRtpTransceiver 未找到"});m.Logger.debug(T,"transceiver: ",t),t.receiver&&t.receiver.track&&t.receiver.track&&"audio"===t.receiver.track.kind||(t.isUseless=!0),this._remoteSdp.disableMediaSection(t.mid);const r=this._pc.localDescription;m.Logger.debug(T,"stopReceiving() | calling pc.setLocalDescription()"),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.Logger.debug(T,"stopReceiving() | calling pc.setRemoteDescription() [answer:%o]",n.sdp),await this._pc.setRemoteDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"Safari.getReceiverStats: RTCRtpTransceiver 未找到"});return t.receiver.getStats()}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=a.parse(this._pc.localDescription.sdp));const r=v.extractDtlsParameters({sdpObject:t});return r.role=e,this._transportReady=!0,r}_assertSendDirection(){if("send"!==this._direction)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"_assertSendDirection: 操作异常"})}_assertRecvDirection(){if("recv"!==this._direction)throw new u.default({code:c.default.UNKNOWN_TYPE_ERROR,message:"_assertRecvDirection: 操作异常"})}}t.Safari12=M},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.shimVideoOrientation=t.canShimVideoOrientation=void 0;const s=r(4),a=o(r(24)),c=r(118),u="a=extmap:4 ";t.canShimVideoOrientation=function(e,t){if("never"===s.getParameters().shimVideoOrientation)return!1;if("ios151"===s.getParameters().shimVideoOrientation){if(!a.IS_IOS)return!1;if(a.IS_SAFARI){if(parseFloat(c.getBrowserInfo().browserVersion)<15.1)return!1}else{if(!a.IS_WECHAT)return!1;if(!navigator.userAgent.match(/OS 15_[1-9]/))return!1}}if(-1===t.sdp.indexOf("H264")||-1===t.sdp.indexOf("m=video"))return!1;const r=e.sdp.match(/\r\n(.*3gpp\:video-orientation.*)\r\n/);return!!(r&&e.sdp.indexOf(u)>-1&&-1===t.sdp.indexOf(r[1]))},t.shimVideoOrientation=function(e,t){if(-1===t.sdp.indexOf("H264")||-1===t.sdp.indexOf("m=video"))return;const r=e.sdp.match(/\r\n(.*3gpp\:video-orientation.*)\r\n/);if(r&&e.sdp.indexOf(u)>-1&&-1===t.sdp.indexOf(r[1])){const e=r[1];console.log(`shimVideoOrientation for ${c.getBrowserInfo().browserName} ${c.getBrowserInfo().browserVersion} ${e}`),t.sdp=t.sdp.split(u).join(e+"\r\n"+u)}else console.error("Failed to shimVideoOrientation",r,e.sdp.indexOf(u),r&&t.sdp.indexOf(r[1]))}},function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=class{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(e,t){return n(this,void 0,void 0,(function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof e)throw new TypeError("given task is not a function");if(!e.name&&t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,n)=>{const i={task:e,name:t,resolve:r,reject:n,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(i),1===this.pendingTasks.length&&this.next()}))}))}stop(){if(!this.closed){for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const e=new Date;return this.pendingTasks.map((t=>({task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0})))}next(){return n(this,void 0,void 0,(function*(){const e=this.pendingTasks[0];e&&(yield this.executeTask(e),this.pendingTasks.shift(),this.next())}))}executeTask(e){return n(this,void 0,void 0,(function*(){if(!e.stopped){e.executedAt=new Date;try{const t=yield e.task();if(e.stopped)return;e.resolve(t)}catch(t){if(e.stopped)return;e.reject(t)}}}))}}},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(171),t),i(r(167),t),i(r(125),t),i(r(141),t),i(r(172),t),i(r(231),t),i(r(232),t),i(r(170),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;const n=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){const t=n.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.VideoTrackLow=void 0;const n=r(235),i=r(173),o=r(73),s=r(4),a=r(123),c=r(243),u=r(24);t.VideoTrackLow=class{constructor(e){var t;this.width=0,this.height=0,this.canvas=document.createElement("canvas"),this.context=a.get2DContext(this.canvas),this.timer=null,this.lastDrawAt=0,this.lastState="clear",this.high={sender:null,track:null,stream:new MediaStream,videoDom:n.getAutoplayVideo(),width:0,height:0},this.sender=null,this.emptyTrackInfo={track:null,count:0,visible:"unknown"},this.mediaType=e.mediaType,"video"===this.mediaType?(this.WIDTH_MAX=s.getParameters().videoLowMaxWidth,this.HEIGHT_MAX=s.getParameters().videoLowMaxHeight,this.FRAME_RATE=s.getParameters().videoLowFramerate):(this.WIDTH_MAX=s.getParameters().screenLowMaxWidth,this.HEIGHT_MAX=s.getParameters().screenLowMaxHeight,this.FRAME_RATE=s.getParameters().screenLowFramerate),this.stream=this.canvas.captureStream?this.canvas.captureStream(this.FRAME_RATE):null,this.track=(null===(t=this.stream)||void 0===t?void 0:t.getTracks()[0])||null,o.watchTrack(this.track),this.logger=e.logger.getChild((()=>{let e=`low_${this.mediaType} ${this.width}x${this.height}`;return this.high.sender?this.high.sender.track?"live"!==this.high.sender.track.readyState?e+=" HIGH_STATE_"+this.high.sender.track.readyState:(this.high.sender&&this.high.sender.track!==this.high.track&&(e+=" MISMATCH"),this.high.sender.track.enabled||(e+=" muted"),e+=` 【${this.high.sender.track.label}】`):e+=" NO_HIGH_TRACK":e+=" NO_HIGH_SENDER",this.track?"live"!==this.track.readyState&&(e+=" LOW_STATE_"+this.track.readyState):e+=" NO_LOW_TRACK",e})),this.track?this.context?this.timer=i.getRTCTimer().setInterval((()=>{this.drawOneFrame()}),1e3/this.FRAME_RATE):(this.logger.error("CanvasContext无法顺利启动"),this.stream=null,this.track=null):this.logger.error("当前浏览器不支持CanvasTrack")}_correctSize(){if(this.high.sender&&this._bindTrack(this.high.sender.track),this.high.width!==this.high.videoDom.videoWidth||this.high.height!==this.high.videoDom.videoHeight){const e=this.high.videoDom.videoWidth/this.high.videoDom.videoHeight;let t=this.width,r=this.height;const n=e>1?this.WIDTH_MAX:this.HEIGHT_MAX,i=e>1?this.HEIGHT_MAX:this.WIDTH_MAX;e>n/i?(r=Math.floor(this.high.videoDom.videoHeight/this.high.videoDom.videoWidth*n),r>0?t=n:(t=0,r=0)):(r=i,t=Math.floor(this.high.videoDom.videoWidth/this.high.videoDom.videoHeight*i),t>0?r=i:(t=0,r=0)),this.logger.log(`High resize ${this.high.width}x${this.high.height}=>${this.high.videoDom.videoWidth}x${this.high.videoDom.videoHeight}, low: ${this.width}x${this.height}=>${t}x${r}`),this.high.width=this.high.videoDom.videoWidth,this.high.height=this.high.videoDom.videoHeight,this.width=t,this.height=r,this.canvas.width=this.width,this.canvas.height=this.height}}destroy(){var e;this.timer&&(i.getRTCTimer().clearInterval(this.timer),this.timer=null),null===(e=this.track)||void 0===e||e.stop(),this.stream=null}drawOneFrame(){var e,t,r,n;if(this.context)if(this._correctSize(),!0===(null===(e=this.high.track)||void 0===e?void 0:e.enabled)&&!1===(null===(t=this.track)||void 0===t?void 0:t.enabled)&&(this.logger.log("恢复小流mute状态"),this.track.enabled=!0),this.track){if("live"!==this.track.readyState)this.logger.error("小流 Track 已停止");else if(!1===(null===(r=this.high.track)||void 0===r?void 0:r.enabled)){if("frame"===this.lastState||"clear"===this.lastState){this.logger.log("track处在mute状态");let e="black";this.logger.log(`小流状态变更 ${this.lastState} => ${e}`),this.lastState=e,this.context.fillRect(0,0,this.width,this.height)}}else if(this.high.videoDom.paused){if("frame"===this.lastState||"clear"===this.lastState){let e="paused";this.logger.log(`小流状态变更 ${this.lastState} => ${e}`),this.lastState=e,this.high.videoDom.play().catch((e=>{}))}("all"===s.getParameters().videoLowCheckCanvasBlank||u.IS_IOS&&"ios"===s.getParameters().videoLowCheckCanvasBlank)&&this._checkCanvasBlank()}else if("live"===(null===(n=this.high.track)||void 0===n?void 0:n.readyState)){if("frame"!==this.lastState){let e="frame";this.logger.log(`小流状态变更 ${this.lastState} => ${e}`),this.lastState=e}const e=this.high.track.canvas;e?this.context.drawImage(e,0,0,this.width,this.height):this.context.drawImage(this.high.videoDom,0,0,this.width,this.height),this.lastDrawAt=Date.now(),("all"===s.getParameters().videoLowCheckCanvasBlank||u.IS_IOS&&"ios"===s.getParameters().videoLowCheckCanvasBlank)&&this._checkCanvasBlank()}else if("frame"===this.lastState){let e="clear";this.logger.log(`小流状态变更 ${this.lastState} => ${e}`),this.lastState=e,this.context.clearRect(0,0,this.width,this.height)}}else this.logger.error("无法获取小流 Track")}_checkCanvasBlank(){var e,t;(null===(e=this.high.sender)||void 0===e?void 0:e.track)&&(null===(t=this.sender)||void 0===t?void 0:t.track)&&(this.high.sender.track!==this.emptyTrackInfo.track&&(this.emptyTrackInfo={track:this.high.sender.track,count:0,visible:"unknown"}),"unknown"===this.emptyTrackInfo.visible)&&(this.high.videoDom.paused||4!==this.high.videoDom.readyState||c.isCanvasBlank(this.canvas)?this.emptyTrackInfo.count++:(this.emptyTrackInfo.visible="yes",this.logger.log("_checkCanvasBlank: 小流画面可见",this.emptyTrackInfo.count),this.sender.track!==this.track&&(this.logger.warn("小流切换至低分辨率模式"),this.sender.replaceTrack(this.track))),this.emptyTrackInfo.count>30&&(this.emptyTrackInfo.visible="no",this.sender.track!==this.high.sender.track?(this.logger.warn("_checkCanvasBlank: 小流两秒内无画面，小流切换至相同分辨率模式"),this.sender.replaceTrack(this.high.sender.track)):this.logger.warn("_checkCanvasBlank: 小流两秒内无画面，继续使用相同分辨率模式")))}_bindTrack(e){var t;this.high.track!==e&&(this.high.track&&this.high.stream.removeTrack(this.high.track),e&&this.high.stream.addTrack(e),this.high.track=e,this.high.videoDom.srcObject=this.high.stream,this.high.videoDom.play().catch((e=>{})),(null===(t=this.sender)||void 0===t?void 0:t.track)&&("no"===this.emptyTrackInfo.visible?(this.logger.warn("小流正在使用相同分辨率模式"),this.sender.replaceTrack(e)):this.sender.track!==this.track&&(this.logger.warn("小流正在使用低分辨率模式"),this.sender.replaceTrack(this.track))))}bindSender(e,t){this.high.sender=e,this.sender=t,e?this._bindTrack(e.track):this._bindTrack(null)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAutoplayVideo=void 0;let n=0;t.getAutoplayVideo=function(){const e=document.createElement("video");return e.style.position="absolute",e.setAttribute("x-webkit-airplay","x-webkit-airplay"),e.setAttribute("playsinline","playsinline"),e.setAttribute("webkit-playsinline","webkit-playsinline"),e.preload="auto",e.className="nertc-video-id-"+n++,e.autoplay=!0,e.muted=!0,e}},function(e,t,r){e.exports="setInterval(() => {\n  self.postMessage('RTCTimer')\n}, 8)\n"},function(e,t,r){e.exports="const SMOOTHING_FACTOR = 0.8\nconst MINIMUM_VALUE = 0.00001\nregisterProcessor(\n  'vumeter',\n  class extends AudioWorkletProcessor {\n    constructor() {\n      super()\n      this._leftVolume = 0\n      this._rightVolume = 0\n      this._updateIntervalInMS = 25\n      this._nextUpdateFrame = this._updateIntervalInMS\n      this.port.onmessage = (event) => {\n        if (event.data.updateIntervalInMS) this._updateIntervalInMS = event.data.updateIntervalInMS\n      }\n    }\n\n    get intervalInFrames() {\n      return (this._updateIntervalInMS / 1000) * sampleRate\n    }\n\n    process(inputs, outputs, parameters) {\n      const input = inputs[0]\n\n      // Note that the input will be down-mixed to mono; however, if no inputs are\n      // connected then zero channels will be passed in.\n      if (input.length > 0) {\n        const samplesLeft = input[0]\n        const samplesRight = input[1]\n\n        let sum = 0\n        let rms = 0\n        // Calculated the squared-sum.\n        if (samplesLeft && samplesLeft.length) {\n          for (let i = 0; i < samplesLeft.length; ++i) {\n            sum += samplesLeft[i] * samplesLeft[i]\n          }\n          // Calculate the RMS level and update the volume.\n          rms = Math.sqrt(sum / samplesLeft.length)\n          this._leftVolume = Math.max(rms, this._leftVolume * SMOOTHING_FACTOR)\n          if (this._leftVolume < 1e-10) {\n            this._leftVolume = 0\n          }\n        }\n        if (samplesRight) {\n          sum = 0\n          rms = 0\n          // Calculated the squared-sum.\n          for (let j = 0; j < samplesRight.length; ++j) sum += samplesRight[j] * samplesRight[j]\n\n          // Calculate the RMS level and update the volume.\n          rms = Math.sqrt(sum / samplesRight.length)\n          this._rightVolume = Math.max(rms, this._rightVolume * SMOOTHING_FACTOR)\n          if (this._rightVolume < 1e-10) {\n            this._rightVolume = 0\n          }\n        }\n\n        // Update and sync the volume property with the main thread.\n        this._nextUpdateFrame -= samplesLeft.length\n        if (this._nextUpdateFrame < 0) {\n          this._nextUpdateFrame += this.intervalInFrames\n          let volume = Math.max(this._leftVolume, this._rightVolume)\n          if (!(volume > -1)) {\n            if (this._leftVolume > -1) {\n              volume = this._leftVolume\n            } else if (this._rightVolume > -1) {\n              volume = this._rightVolume\n            }\n          }\n          if (samplesRight) {\n            this.port.postMessage({\n              left: this._leftVolume,\n              right: this._rightVolume,\n              volume: volume\n            })\n          } else {\n            this.port.postMessage({\n              volume: volume\n            })\n          }\n        }\n      }\n\n      return true\n    }\n  }\n)\n"},function(e,t,r){e.exports=";(function () {\n  const intervalIds = {}\n  const timeoutIds = {}\n\n  // 监听message 开始执行定时器或者销毁\n  self.onmessage = function onMsgFunc(e) {\n    switch (e.data.command) {\n      case 'interval:start': // 开启定时器\n        const intervalId = setInterval(function () {\n          postMessage({\n            message: 'interval:tick',\n            id: e.data.id\n          })\n        }, e.data.interval)\n\n        postMessage({\n          message: 'interval:started',\n          id: e.data.id\n        })\n\n        intervalIds[e.data.id] = intervalId\n        break\n      case 'interval:clear': // 销毁\n        clearInterval(intervalIds[e.data.id])\n\n        postMessage({\n          message: 'interval:cleared',\n          id: e.data.id\n        })\n\n        delete intervalIds[e.data.id]\n        break\n\n      case 'timeout:start': // 开启定时器\n        const timeoutId = this.setTimeout(function () {\n          postMessage({\n            message: 'timeout:tick',\n            id: e.data.id\n          })\n        }, e.data.timeout)\n\n        postMessage({\n          message: 'timeout:started',\n          id: e.data.id\n        })\n\n        timeoutIds[e.data.id] = timeoutId\n        break\n      case 'timeout:clear': // 销毁\n        clearTimeout(timeoutIds[e.data.id])\n\n        postMessage({\n          message: 'timeout:cleared',\n          id: e.data.id\n        })\n\n        delete timeoutIds[e.data.id]\n        break\n    }\n  }\n})()\n"},function(e,t,r){e.exports="/**\n * 模拟一个AI Worklet\n * 其实是个Delay\n */\nregisterProcessor(\n  'audioAIProcessor',\n  class extends AudioWorkletProcessor {\n    constructor() {\n      super()\n      // 尚未接入AI，以延迟1秒为例\n      this.inputSamplesHistory = []\n      this.delayMs = 3000\n    }\n\n    process(inputs, outputs, parameters) {\n      const now = Date.now()\n      const input = inputs[0].map((channel) => {\n        return channel.slice(0)\n      })\n      const output = outputs[0]\n      this.inputSamplesHistory.push({\n        input,\n        ms: now\n      })\n      const firstItem = this.inputSamplesHistory[0]\n      if (firstItem) {\n        if (now - firstItem.ms > this.delayMs) {\n          this.inputSamplesHistory.shift()\n          output.forEach((channel, index) => {\n            for (let i = 0; i < channel.length; i++) {\n              if (firstItem.input[index] && firstItem.input[index][i]) {\n                channel[i] = firstItem.input[index][i]\n              }\n            }\n          })\n        }\n      }\n      return true\n    }\n  }\n)\n"},function(e,t,r){e.exports="/* eslint-disable */\nregisterProcessor(\n  'audioWorkletAgentProcessor',\n  class extends AudioWorkletProcessor {\n    // Float32Array[][][]\n    constructor() {\n      super()\n      this.inputDataSeq = []\n      this.bufferDrop = 0\n      this.bufferDropSum = 0\n      this.bufferDropTime = 0\n      this.port.onmessage = (event) => {\n        if (event.data.type === 'outputData') {\n          this.inputDataSeq.push(event.data.data)\n          this.bufferDrop++\n        }\n      }\n    }\n\n    process(inputs, outputs, parameters) {\n      this.port.postMessage({\n        type: 'rawinputs',\n        inputs\n      })\n\n      const inputData = this.inputDataSeq.shift()\n      if (inputData && outputs[0] && !this.bufferDropSum) {\n        if (outputs[0][1]) {\n          outputs[0][1].set(inputData[0])\n        }\n        outputs[0][0].set(inputData[0])\n      }\n      if (this.bufferDrop > 200) {\n        this.bufferDropSum += this.bufferDrop\n        this.bufferDropTime = currentTime\n      }\n      this.bufferDrop = 0\n      if (this.bufferDropTime && currentTime - this.bufferDropTime > 0.3) {\n        this.inputDataSeq = []\n        this.port.postMessage({\n          type: 'bufferDrop',\n          cnt: this.bufferDropSum\n        })\n        this.bufferDropTime = 0\n        this.bufferDropSum = 0\n      }\n      return true\n    }\n  }\n)\n"},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.shimCanvas=t.canShimCanvas=void 0;const s=r(4),a=r(140),c=o(r(24));t.canShimCanvas=function(){let e=!1;if("never"===s.getParameters().shimCanvas)e=!1;else if("always"===s.getParameters().shimCanvas)e=!0;else if("ios151"===s.getParameters().shimCanvas)return!!(c.IS_IOS&&navigator.userAgent.indexOf(" OS 15_1")>-1);return e},t.shimCanvas=function(e){let t=new a.RTCCanvas("canvas");const r=document.createElement("video");let n=t._canvas,i=e.getSettings().frameRate||15,o=t._ctx;const s=new MediaStream([e]);if(r.srcObject=s,r.setAttribute("playsinline","playsinline"),r.setAttribute("muted","muted"),r.setAttribute("autoplay","autoplay"),r.className="nertc-ios-shim",r.style.display="none",r.onresize=()=>{r.videoWidth&&r.videoHeight&&t.setSize(r.videoWidth,r.videoHeight)},o){const s=n.captureStream(i).getVideoTracks()[0];Object.defineProperty(s,"enabled",{get:()=>e.enabled,set(t){console.warn("Delegate cameraTrack enabled",t),e.enabled=t}});const a=setInterval((()=>{r.paused?r.play():"ended"===s.readyState?("live"===e.readyState&&(console.warn("canvasTrack已停止，回收videoTrack中"),e.stop()),clearInterval(a),document.body.removeChild(r)):o.drawImage(r,0,0)}),1e3/i);return document.body.appendChild(r),t.destroy(),s}throw new Error("Ctx not supported")}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.syncTrackState=void 0;const n=new(r(69).Logger)({tagGen:()=>"syncTrackState"}),i=[];setInterval((()=>{for(let e=i.length-1;e>=0;e--){const t=i[e];if("ended"===t.srcTrack.readyState)return"live"===t.destTrack.readyState&&(n.log(`同步MediaStreamTrack关闭状态。【${t.srcTrack.label}】=>【${t.destTrack.label}】`),t.destTrack.stop()),void i.splice(e,1);if("bidirectional"===t.direction&&"ended"===t.destTrack.readyState)return"live"===t.srcTrack.readyState&&(n.warn(`同步MediaStreamTrack关闭状态。【${t.destTrack.label}】=>【${t.srcTrack.label}】`),t.srcTrack.stop()),void i.splice(e,1);t.srcTrack.enabled!==t.enabled&&(t.enabled=t.srcTrack.enabled,t.srcTrack.enabled!==t.destTrack.enabled&&(n.warn(`同步MediaStreamTrack enabled:【${t.srcTrack.label}】`,t.enabled),t.destTrack.enabled=t.srcTrack.enabled)),"bidirectional"===t.direction&&t.destTrack.enabled!==t.enabled&&(t.enabled=t.destTrack.enabled,t.destTrack.enabled!==t.srcTrack.enabled&&(n.warn(`同步MediaStreamTrack enabled:【${t.srcTrack.label}】`,t.enabled),t.srcTrack.enabled=t.destTrack.enabled))}}),1e3),t.syncTrackState=function(e,t,r){i.push({srcTrack:e,destTrack:t,direction:r,enabled:e.enabled})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isCanvasBlank=void 0;let n=null;t.isCanvasBlank=function(e){n||(n=document.createElement("canvas")),n.width=e.width,n.height=e.height;let t=e.toDataURL()===n.toDataURL();return t&&console.error("result",t,e),t}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.stringify=void 0;const n=r(143),i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;let o,s;const a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};let c;function u(e){return i.lastIndex=0,i.test(e)?`"${e.replace(i,(e=>{const t=a[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))}"`:`"${e}"`}t.stringify=function(e,t,r){let i;if(o="",s="","number"==typeof r)for(i=0;i<r;i+=1)s+=" ";else"string"==typeof r&&(s=r);if(c=t,t&&"function"!=typeof t&&!Array.isArray(t))throw new Error("JSON.stringify");return function e(t,r){let i,a,l,d;const p=o;let m,f=r[t];const h=null!=f&&f instanceof n.SimpleBig;switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(t)),"function"==typeof c&&(f=c.call(r,t,f)),typeof f){case"string":return u(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"bigint":return String(f);case"object":if(h)return f.toString();if(!f)return"null";if(o+=s,m=[],"[object Array]"===Object.prototype.toString.apply(f)){for(d=f.length,i=0;i<d;i+=1)m[i]=e(i,f)||"null";return l=0===m.length?"[]":o?`[\n${o}${m.join(",\n"+o)}\n${p}]`:`[${m.join(",")}]`,o=p,l}if(Array.isArray(c))for(d=c.length,i=0;i<d;i+=1)"string"==typeof c[i]&&(a=c[i],l=e(a,f),l&&m.push(u(a)+(o?": ":":")+l));else Object.keys(f).forEach((t=>{const r=e(t,f);r&&m.push(u(t)+(o?": ":":")+r)}));return l=0===m.length?"{}":o?`{\n${o}${m.join(",\n"+o)}\n${p}}`:`{${m.join(",")}}`,o=p,l;default:return"null"}}("",{"":e})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.JSONParse=void 0;const n=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,i=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;t.JSONParse=function(e){const t={strict:!1,storeAsString:!0,alwaysParseAsBig:!1,useNativeBigInt:!0,protoAction:"error",constructorAction:"error"};if(null!=e){if(!0===e.strict&&(t.strict=!0),!0===e.storeAsString&&(t.storeAsString=!0),t.alwaysParseAsBig=!0===e.alwaysParseAsBig&&e.alwaysParseAsBig,t.useNativeBigInt=!0===e.useNativeBigInt&&e.useNativeBigInt,void 0!==e.constructorAction){if("error"!==e.constructorAction&&"ignore"!==e.constructorAction&&"preserve"!==e.constructorAction)throw new Error('Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed '+e.constructorAction);t.constructorAction=e.constructorAction}if(void 0!==e.protoAction){if("error"!==e.protoAction&&"ignore"!==e.protoAction&&"preserve"!==e.protoAction)throw new Error('Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed '+e.protoAction);t.protoAction=e.protoAction}}let r,o;const s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};let a;const c=function(e){throw{name:"SyntaxError",message:e,at:r,text:a}},u=function(e){return e&&e!==o&&c(`Expected '${e}' instead of '${o}'`),o=a.charAt(r),r+=1,o},l=function(){let e,r="";for("-"===o&&(r="-",u("-"));o>="0"&&o<="9";)r+=o,u();if("."===o)for(r+=".";u()&&o>="0"&&o<="9";)r+=o;if("e"===o||"E"===o)for(r+=o,u(),"-"!==o&&"+"!==o||(r+=o,u());o>="0"&&o<="9";)r+=o,u();if(e=+r,isFinite(e))return r.length>15?t.storeAsString?r:t.useNativeBigInt?BigInt(r):null:t.alwaysParseAsBig?t.useNativeBigInt?BigInt(e):null:e;c("Bad number")};function d(){let e,t,n,i="";if('"'===o){let c=r;for(;u();){if('"'===o)return r-1>c&&(i+=a.substring(c,r-1)),u(),i;if("\\"===o){if(r-1>c&&(i+=a.substring(c,r-1)),u(),"u"===o){for(n=0,t=0;t<4&&(e=parseInt(u(),16),isFinite(e));t+=1)n=16*n+e;i+=String.fromCharCode(n)}else{if("string"!=typeof s[o])break;i+=s[o]}c=r}}}c("Bad string")}const p=function(){for(;o&&o<=" ";)u()};function m(){switch(p(),o){case"{":return f();case"[":return function(){const e=[];if("["===o){if(u("["),p(),"]"===o)return u("]"),e;for(;o;){if(e.push(m()),p(),"]"===o)return u("]"),e;u(","),p()}}c("Bad array")}();case'"':return d();case"-":return l();default:return o>="0"&&o<="9"?l():function(){switch(o){case"t":return u("t"),u("r"),u("u"),u("e"),!0;case"f":return u("f"),u("a"),u("l"),u("s"),u("e"),!1;case"n":return u("n"),u("u"),u("l"),u("l"),null}c(`Unexpected '${o}'`)}()}}const f=function(){let e;const r=Object.create(null);if("{"===o){if(u("{"),p(),"}"===o)return u("}"),r;for(;o;){if(e=d(),p(),u(":"),!0===t.strict&&Object.hasOwnProperty.call(r,e)&&c(`Duplicate key "${e}"`),!0===n.test(e)?"error"===t.protoAction?c("Object contains forbidden prototype property"):"ignore"===t.protoAction?m():r[e]=m():!0===i.test(e)?"error"===t.constructorAction?c("Object contains forbidden constructor property"):"ignore"===t.constructorAction?m():r[e]=m():r[e]=m(),p(),"}"===o)return u("}"),r;u(","),p()}}c("Bad object")};return function(e,t){let n;return a=""+e,r=0,o=" ",n=m(),p(),o&&c("Syntax error"),"function"==typeof t?function e(r,n){let i;const o=r[n];return o&&"object"==typeof o&&Object.keys(o).forEach((t=>{i=e(o,t),void 0!==i?o[t]=i:delete o[t]})),t.call(r,n,o)}({"":n},""):n}}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Meeting=void 0;const i=r(10),o=r(62),s=r(149),a=n(r(12)),c=n(r(13)),u=r(119),l=r(143);class d extends i.EventEmitter{constructor(e){super(),this.info={turn:!0,relay:!1,forward:!1,secure:!0},this._reset(),this.adapterRef=e.adapterRef,this.sdkRef=e.sdkRef,this.logger=e.adapterRef.logger.getChild((()=>{var t,r,n;let i="meeting";return this.info.secure||(i+=" INSECURE"),this.info.forward&&(i+=" FORWARD"),this.info.turn||(i+=" NOTURN"),(null===(n=null===(r=null===(t=e.adapterRef.instance)||void 0===t?void 0:t._params)||void 0===r?void 0:r.neRtcServerAddresses)||void 0===n?void 0:n.channelServer)&&(i+=" PRIVATE"),e.adapterRef._meetings!==this&&(i+=" DETACHED"),i}))}_reset(){}async getCloudProxyInfo(e){const{appkey:t,channelName:r,uid:n,token:i=""}=e;this.adapterRef.logger.log("getCloudProxyInfo() url: ",o.getCloudProxyInfoUrl);let d=o.getCloudProxyInfoUrl;this.adapterRef.instance._params.neRtcServerAddresses.cloudProxyServer&&(d=this.adapterRef.instance._params.neRtcServerAddresses.cloudProxyServer,this.adapterRef.logger.log("getCloudProxyInfo() 私有化配置cloudProxyServer: ",d));let p=Date.parse(new Date)/1e3;try{const e=await this.adapterRef.lbsManager.ajax({url:d,type:"POST",header:{"Session-Id":this.adapterRef.deviceId||""},data:{uid:new l.SimpleBig(n),appkey:t,channelName:r,secureType:i?"1":"2",osType:"4",version:o.SDK_VERSION+".0"||!1,curtime:""+p,checksum:s(t+"."+n+"."+p),proxy:"1",needIPV6:"0"}});if(this.adapterRef.logger.log("getCloudProxyInfo() 获取到云代理服务相关信息: ",u.JSONBigStringify(e,null," ")),this.adapterRef.instance.apiFrequencyControl({name:"setCloudProxyInfo",code:200===e.code?0:-1,param:{channelName:r,uid:n,appkey:t,token:i,reason:e.code}}),200===e.code){this.adapterRef.channelStatus="join";const{wsProxyArray:t,mediaProxyArray:r,mediaProxyToken:i,cname:o,curTime:s}=e;this.adapterRef.instance._params.neRtcServerAddresses.webSocketProxyServer?(this.adapterRef.logger.warn("getCloudProxyInfo() webSocketProxyServer: ",this.adapterRef.instance._params.neRtcServerAddresses.webSocketProxyServer),this.adapterRef.proxyServer.wsProxyArray=[this.adapterRef.instance._params.neRtcServerAddresses.webSocketProxyServer]):this.adapterRef.proxyServer.wsProxyArray=t,this.adapterRef.instance._params.neRtcServerAddresses.mediaProxyServer?(this.adapterRef.logger.warn("getCloudProxyInfo() mediaProxyServer:",this.adapterRef.instance._params.neRtcServerAddresses.mediaProxyServer),this.adapterRef.proxyServer.mediaProxyArray=[this.adapterRef.instance._params.neRtcServerAddresses.mediaProxyServer],this.adapterRef.proxyServer.mediaProxyToken="netease",this.adapterRef.proxyServer.credential="netease"):(this.adapterRef.proxyServer.mediaProxyArray=r,this.adapterRef.proxyServer.mediaProxyToken=i,this.adapterRef.proxyServer.credential=n+"/"+s)}else this.adapterRef.logger.log("getCloudProxyInfo() 云代理服务相关信息获取失败, 回滚")}catch(t){throw this.adapterRef.logger.log("getCloudProxyInfo() 网络请求异常:",t.name,t.message,t),this.adapterRef.channelStatus="leave",this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.apiFrequencyControl({name:"startProxyServer",code:-1,param:Object.assign(Object.assign({},e),{reason:t.message})}),new c.default({code:a.default.NETWORK_REQUEST_ERROR,message:t.message})}}async joinChannel(e){try{this.adapterRef.proxyServer.enable&&await this.getCloudProxyInfo(e)}catch(e){throw e}const{appkey:t,channelName:r,uid:n,wssArr:i=null,sessionMode:d="meeting",joinChannelRecordConfig:p,joinChannelLiveConfig:m,token:f="",permKey:h="",getChanneInfoResponse:g}=e;let v=Date.now(),y=+new Date,b=o.getChannelInfoUrl;this.adapterRef.instance._params.neRtcServerAddresses.channelServer&&(b=this.adapterRef.instance._params.neRtcServerAddresses.channelServer,this.logger.log("jion() 私有化配置的 getChannelInfoUrl: ",b)),Object.assign(this.adapterRef.channelInfo,{uid:n,sessionMode:d,appkey:t});try{let S=g;S||(S=await this.adapterRef.lbsManager.ajax({url:b,type:"POST",contentType:"application/x-www-form-urlencoded",header:{"Session-Id":this.adapterRef.deviceId||""},data:{uid:new l.SimpleBig(n),appkey:t,permKeySecret:h,channelName:r,secureType:f?"1":"2",osType:"4",mode:2,netType:"0",version:o.SDK_VERSION+".0"||!1,curtime:y,checksum:f||s(t+"."+n+"."+y),webrtc:1,nrtcg2:1,t1:v}}),this.adapterRef.state.getChannelInfoTime=Date.now());let T=!("0"==n||"0"!=n&&!n);if(this.info.secure=!!f,"string"==typeof S?(this.logger.warn("join() 返回值类型为string，应为object。尝试进行强制类型转换。",S),S=u.JSONBigParse(S)):this.logger.log("join() 获取到房间信息:",u.JSONBigStringify(S,null," ")),200===S.code){this.adapterRef.channelStatus="join";const{ips:o,time:s}=S;o&&o.uid||this.logger.warn("join 加入频道时服务端未返回uid");const a=S.config&&S.config.quality_level_limit||16;this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.startWssTime=Date.now();let c=o.webrtcarray&&o.webrtcarray.length&&o.webrtcarray[0];if(c&&this.adapterRef.proxyServer.wsProxyArray){const e=o.turnaddrs&&o.turnaddrs.length&&o.turnaddrs[0][0];let t=e.split(":").length>1?e.split(":")[1]:"",r=c.split("/").length>1?c.split("/")[1]:"";this.adapterRef.instance._params.neRtcServerAddresses.webSocketProxyServer&&(t=r.split(":")[1]),r&&t?this.adapterRef.proxyServer.wsProxyArray=this.adapterRef.proxyServer.wsProxyArray.map((e=>e+"/"+r.split(":")[0]+":"+t)):this.adapterRef.logger.log(`join 云代理无法获取到代理信息, serverurl: ${r}, port: ${t}`)}Object.assign(this.adapterRef.channelInfo,{cid:+S.cid,permKey:h,token:S.token,turnToken:o.token,channelName:r,wssArr:i||this.adapterRef.proxyServer.enable&&this.adapterRef.proxyServer.wsProxyArray||o.webrtcarray||[],relayaddrs:this.adapterRef.proxyServer.mediaProxyArray||o.relayaddrs||null,relaytoken:this.adapterRef.proxyServer.mediaProxyToken||o.relaytoken||null,wssArrIndex:0,maxVideoQuality:a,netDetect:!1},{uid:T?n:o.uid,sessionMode:d,appkey:t}),e.uid=e.uid?e.uid:this.adapterRef.channelInfo.uid,this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.token=S.token,this.adapterRef.channelInfo.T4=Date.now();let u=this.adapterRef.channelInfo.T4-s.t1-(s.t3-s.t2);return this.adapterRef.channelInfo.clientNtpTime=s.t3+Math.round(u/2),this.adapterRef.instance.setSessionConfig(Object.assign({maxVideoQuality:a},m,p)),this.info.relay=o.relayaddrs&&o.relayaddrs.length>0,this.info.turn=o.turnaddrs&&o.turnaddrs.length>0,this.adapterRef.instance.startSession()}{const e=S.desc&&""!==S.desc?"join() "+S.desc:"join() 服务器不允许加入房间, code "+S.code;return this.logger.error(e),this.adapterRef.channelStatus="leave",this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.apiEventReport("setLogin",{a_record:p.recordAudio,v_record:p.recordVideo,record_type:p.recordType,host_speaker:p.isHostSpeaker,result:S.code,permKey:this.adapterRef.channelInfo.permKey,serverIp:S.ips&&S.ips.turnaddrs&&S.ips.turnaddrs.length&&S.ips.turnaddrs[0],desc:e}),Promise.reject(new c.default({code:a.default.SERVER_AUTH_ERROR,extraCode:S.code,message:e}))}}catch(e){throw this.logger.log("joing() 获取到房间信息错误:",e.name,e.message),this.adapterRef.channelStatus="leave",this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.apiEventReport("setLogin",{a_record:p.recordAudio,v_record:p.recordVideo,record_type:p.recordType,host_speaker:p.isHostSpeaker,result:-1,desc:`join() 内部错误: ${e.name}, ${e.message}`,serverIp:""}),new c.default({code:e.getCode&&e.getCode()||a.default.JOIN_FAILED,message:e.getCode&&e.getMessage()||`join() 内部错误: ${e.name}, ${e.message}`})}}leaveChannel(){return this.adapterRef._signalling?this.adapterRef._signalling.doSendLogout().then((()=>(this.adapterRef.channelStatus="leave",this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.stopSession()))):Promise.resolve()}async addTasks(e){const{rtmpTasks:t=[]}=e;let r=o.roomsTaskUrl;this.adapterRef.instance._params.neRtcServerAddresses.roomServer&&(r=this.adapterRef.instance._params.neRtcServerAddresses.roomServer,"/"!==r.substr(-1)&&(r+="/"),this.logger.log("addTasks() 私有化配置的 roomsTaskUrl: ",r)),r=`${r}${this.adapterRef.channelInfo.cid}/tasks`;for(let n=0;n<t.length;n++){t[n].hostUid=new l.SimpleBig(this.adapterRef.channelInfo.uid),t[n].version=1,this.logger.log("addTasks() rtmpTask: ",u.JSONBigStringify(t[n]));const i=t[n].layout;i.users.forEach((e=>{"string"==typeof e.uid&&(e.uid=new l.SimpleBig(e.uid))}));try{const e=await this.adapterRef.lbsManager.ajax({url:r,type:"POST",contentType:"application/json;charset=utf-8",header:{Token:this.adapterRef.channelInfo.turnToken,"Session-Id":this.adapterRef.deviceId||""},data:{version:1,taskId:t[n].taskId,streamUrl:t[n].streamUrl,record:t[n].record,hostUid:t[n].hostUid,layout:i,config:t[n].config,extraInfo:t[n].extraInfo||""}});if(200!==e.code)return this.logger.error(`addTasks() 添加第 ${n} 个推流任务失败: `,e),Promise.reject(new c.default({code:a.default.ADD_TASK_FAILED_ERROR,extraCode:e.code,message:"addTasks() 添加推流任务失败: "+e.code}));this.logger.log(`addTasks() 添加第 ${n} 个推流任务完成`)}catch(e){return this.logger.error("addTasks: ",e.name,e.message),Promise.reject(new c.default({code:a.default.ADD_TASK_FAILED_ERROR,message:"addTasks() 内部错误: $e.message}"}))}}}async deleteTasks(e){const{taskIds:t=[]}=e;let r=o.roomsTaskUrl;this.adapterRef.instance._params.neRtcServerAddresses.roomServer&&(r=this.adapterRef.instance._params.neRtcServerAddresses.roomServer,"/"!==r.substr(-1)&&(r+="/"),this.logger.log("deleteTasks() 私有化配置的 roomsTaskUrl: ",r)),r=`${r}${this.adapterRef.channelInfo.cid}/tasks/delete`;for(let n=0;n<t.length;n++){this.logger.log("deleteTasks() taskId: ",t[n]);try{const e=await this.adapterRef.lbsManager.ajax({url:r,type:"POST",contentType:"application/json;charset=utf-8",header:{Token:this.adapterRef.channelInfo.turnToken,"Session-Id":this.adapterRef.deviceId||""},data:{taskId:t[n]}});return 200===e.code?(this.logger.log("删除推流任务完成"),Promise.resolve()):(this.logger.log("删除推流任务请求失败:",u.JSONBigStringify(e)),Promise.reject(new c.default({code:a.default.DELETE_TASK_FAILED_ERROR,extraCode:e.code,message:"deleteTasks() 删除推流任务失败: "+e.code})))}catch(e){return this.logger.error("deleteTasks发生错误: ",e.name,e.message),Promise.reject(new c.default({code:a.default.DELETE_TASK_FAILED_ERROR,message:"deleteTasks() 内部错误: $e.message}"}))}}}async updateTasks(e){const{rtmpTasks:t=[]}=e;let r=o.roomsTaskUrl;this.adapterRef.instance._params.neRtcServerAddresses.roomServer&&(r=this.adapterRef.instance._params.neRtcServerAddresses.roomServer,"/"!==r.substr(-1)&&(r+="/"),this.logger.log("updateTasks() 私有化配置的 roomsTaskUrl: ",r)),r=`${r}${this.adapterRef.channelInfo.cid}/task/update`;for(let n=0;n<t.length;n++){const i=t[n].layout;i.users.forEach((e=>{"string"==typeof e.uid&&(e.uid=new l.SimpleBig(e.uid))}));try{const e=await this.adapterRef.lbsManager.ajax({url:r,type:"POST",contentType:"application/json;charset=utf-8",header:{Token:this.adapterRef.channelInfo.turnToken,"Session-Id":this.adapterRef.deviceId||""},data:{version:1,taskId:t[n].taskId,streamUrl:t[n].streamUrl,record:t[n].record,hostUid:new l.SimpleBig(this.adapterRef.channelInfo.uid),layout:i,config:t[n].config}});return 200===e.code?(this.logger.log("updateTasks() 更新推流任务完成"),Promise.resolve()):(this.logger.log("() 更新推流任务失败：",u.JSONBigStringify(e)),Promise.reject(new c.default({code:a.default.UPDATE_TASKS_FAILED_ERROR,extraCode:e.code,message:"updateTasks() 更新推流任务失败: "+e.code})))}catch(e){return this.logger.error("updateTasks 发生错误: ",e.name,e.message),Promise.reject(new c.default({code:a.default.UPDATE_TASKS_FAILED_ERROR,message:"updateTasks() 内部错误: $e.message}"}))}}}destroy(){this.logger.log("清除 meeting"),this._reset()}}t.Meeting=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.processManager=void 0;const n=r(57),i=r(4);t.processManager=new class{constructor(){this.id=new Date;const e=`${n.generateUUID().substr(0,4)}-${(new Date).toISOString().replace(/[^\d]/g,"")}`;if(this.processId="proc-"+e,!i.getParameters().reportPageBrowserId)return this.pageId="",void(this.browserId="");try{let t=sessionStorage.getItem("NERTC_PAGEID");t||(t="page-"+e,sessionStorage.setItem("NERTC_PAGEID",t)),this.pageId=t}catch(e){this.pageId=""}try{let t=sessionStorage.getItem("NERTC_BROWSERID");t||(t="brow-"+e,localStorage.setItem("NERTC_BROWSERID",t)),this.browserId=t}catch(e){this.browserId=""}}}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StatsReport=void 0;const i=r(10),o=r(62),s=n(r(249)),a=n(r(250)),c=r(266),u=r(4),l=r(118),d=r(268),p=r(175),m=Date.now();class f extends i.EventEmitter{constructor(e){var t,r;super(),this._reset(),this.heartbeat_=-1,this.wsTransport_=null,this.sdkRef=e.sdkRef,this.adapterRef=e.adapterRef,this.isReport=e.isReport,this.appKey=this.adapterRef.instance._params.appkey||this.adapterRef.channelInfo&&this.adapterRef.channelInfo.appKey||"",this.reportData={appkey:this.appKey,cid:(null===(t=this.adapterRef)||void 0===t?void 0:t.channelInfo.cid)||0,uid:""+(null===(r=this.adapterRef)||void 0===r?void 0:r.channelInfo.uid)||"0",browser:l.getBrowserInfo().browserName,platform:l.getOSInfo().osName,timestamp:0,local:{},remote:{}},this.stats=new c.GetStats({adapterRef:this.adapterRef})}_reset(){this.stats&&this.stats.destroy(),this.stats=null,this.stopHeartbeat()}stop(){this.stats&&this.stats.stop()}start(){var e,t,r;this.reportData.uid=""+(null===(e=this.adapterRef)||void 0===e?void 0:e.channelInfo.uid)||"0",this.reportData.cid=null===(t=this.adapterRef)||void 0===t?void 0:t.channelInfo.cid;let n=null===(r=this.adapterRef)||void 0===r?void 0:r.deviceId,i=d(`0${m}${o.SDK_VERSION}webwebrtc${n}40f5a1a1871e46089e1e5139a779dd77`),s=`${this.adapterRef.instance._params.neRtcServerAddresses.statisticsWebSocketServer||"wss://statistic.live.126.net/lps-websocket/websocket/collect"}?deviceId=${n}&isTest=0&sdkVer=${o.SDK_VERSION}&sdktype=webrtc&timestamp=${m}&platform=web&checkSum=${i}`,c=window;this.wsTransport_=c.wsTransport=new a.default({url:s,adapterRef:this.adapterRef}),this.wsTransport_.init(),this.startHeartbeat()}startHeartbeat(){-1===this.heartbeat_&&(this.adapterRef.logger.log("startHeartbeat..."),this.heartbeat_=s.default.setInterval(this.doHeartbeat.bind(this),u.getParameters().doHeartbeatInterval))}stopHeartbeat(){-1!==this.heartbeat_&&(s.default.clearInterval(this.heartbeat_),this.heartbeat_=-1)}async doHeartbeat(){var e;try{let t=await(null===(e=this.stats)||void 0===e?void 0:e.getAllStats());this.isReport&&(null==t?void 0:t.times)%2==0&&(this.reportData.local=null==t?void 0:t.local,this.reportData.remote=null==t?void 0:t.remote,this.reportData.timestamp=(new Date).getTime(),this.wsTransport_.sendPB(this.reportData)),(null==t?void 0:t.times)%60==0&&this.sendDataReportHeartbeat()}catch(e){this.adapterRef.logger.warn("数据上报出现异常: ",e.message)}}sendDataReportHeartbeat(){var e;let t=new p.DataReport({adapterRef:this.adapterRef});t.setHeartbeat({name:"setHeartbeat",uid:""+(null===(e=this.adapterRef)||void 0===e?void 0:e.channelInfo.uid)||"0",cid:""+this.adapterRef.channelInfo.cid}),t.send()}destroy(){this.sendDataReportHeartbeat(),this.stop(),this._reset(),this.isReport&&this.wsTransport_&&this.wsTransport_.close()}}t.StatsReport=f},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(57),i=new class{constructor(){this.intervalMap_=new Map}setInterval(e,t,r=!0){const i=n.generateUUID();let o=Date.now(),s=o;this.intervalMap_.set(i,{rafId:null,timeoutId:null,onVisibilityChange:null});const a=()=>{if(r&&document.hidden){e();const r=setTimeout(a,t);this.setTimeoutId(i,r),o=Date.now(),s=o}else{s=Date.now(),s-o>=t&&(o=s,e());const r=requestAnimationFrame(a);this.setRafId(i,r)}},c=requestAnimationFrame(a);if(this.setRafId(i,c),r){const e=()=>{if(document.hidden){const e=Date.now()-o;if(e>=t)a();else{const r=setTimeout(a,t-e);this.setTimeoutId(i,r)}}};document.addEventListener("visibilitychange",e),this.setOnVisibilityChange(i,e)}return i}clearInterval(e){if(this.intervalMap_.has(e)){const{rafId:t,timeoutId:r,onVisibilityChange:n}=this.intervalMap_.get(e);cancelAnimationFrame(t),clearTimeout(r),document.removeEventListener("visibilitychange",n),this.intervalMap_.delete(e)}}setTimeoutId(e,t){if(this.intervalMap_.has(e)){const r=this.intervalMap_.get(e);r.timeoutId&&clearTimeout(r.timeoutId),r.timeoutId=t}}setRafId(e,t){if(this.intervalMap_.has(e)){const r=this.intervalMap_.get(e);r.rafId&&cancelAnimationFrame(r.rafId),r.rafId=t}}setOnVisibilityChange(e,t){this.intervalMap_.has(e)&&(this.intervalMap_.get(e).onVisibilityChange=t)}};t.default=i},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const s=r(10),a=o(r(176)),c=r(57),u=r(265);let l=new Uint8Array(1);l[0]=10;const d=l;t.default=class{constructor(e){this.lastLogTime=0,this.cachedLogs=[],this.textEncoder=new TextEncoder,this.url_=e.url,this.socket_=null,this.isConnected_=!1,this.isConnecting_=!1,this.pingPongTimeoutId_=-1,this.pingTimeoutId_=-1,this.reconnectionTimer_=-1,this.reconnectionCount_=0,this.emitter_=new s.EventEmitter,this.adapterRef=e.adapterRef,this.logger=this.adapterRef.logger.getChild((()=>"wsTransport"))}init(){this.logger.log("connect to url: "+this.url_),this.socket_=new WebSocket(this.url_),this.bindSocket(this.socket_)}bindSocket(e){e.onopen=this.onopen.bind(this),e.onclose=this.onclose.bind(this),e.onerror=this.onerror.bind(this),e.onmessage=this.onmessage.bind(this)}unbindSocket(e){e.onopen=()=>{},e.onclose=()=>{},e.onerror=()=>{},e.onmessage=()=>{}}onopen(e){if(this.isConnected_)return;this.isConnected_=!0,this.isConnecting_=!1;const t=e.target.url;this.logger.log(`websocket[${t}] is connected`),this.urlSetting&&(this.logger.debug(`markFinish success seqId:${this.urlSetting.seqId} source:${this.urlSetting.item.source}  url:${t}`),delete this.urlSetting),this.startPingPong()}onclose(e){const t=e.target.url,r=e.target===this.socket_;this.logger.log(`websocket[${t} InUse: ${r}] is closed with code: ${e.code}`),this.socket_&&e.target===this.socket_&&(this.isConnected_=!1,e.wasClean&&1e3===e.code?this.close():(this.logger.warn(`onclose code:${e.code} reason:${e.reason}`),this.socket_.onclose=()=>{},this.socket_.close(4001),this.socket_=null,this.reconnect()))}onerror(e){const t=e.target.url;this.logger.warn(`websocket[${t}] error observed`),this.urlSetting&&(this.logger.debug(`markFinish fail seqId:${this.urlSetting.seqId} source:${this.urlSetting.item.source}  url:${t}`),delete this.urlSetting),this.isConnected_?e.target===this.socket_&&(this.isConnected_=!1,this.socket_=null,this.reconnect()):this.reconnect(),this.isConnecting_=!1,this.isConnected_=!1}onmessage(e){this.isConnected_&&e&&e.data&&(11===JSON.parse(e.data).action&&this.emit(11,e),this.clearReconnectionTimer())}isConnected(){return this.isConnected_}sendPB(e){var t;if(this.isConnected_){const r=this.createPBMessage(e);1===(null===(t=this.socket_)||void 0===t?void 0:t.readyState)&&this.socket_.send(r)}}sendPing(e){var t;this.isConnected_&&1===(null===(t=this.socket_)||void 0===t?void 0:t.readyState)&&this.socket_.send(e)}sendLog(e){var t,r;const n=Math.max(this.lastLogTime+1,Date.now());this.lastLogTime=n;try{this.cachedLogs.length&&this.cachedLogs[this.cachedLogs.length-1].data[0].replace("[NERTC","[缓存][NERTC")}catch(e){}if(this.cachedLogs.push({time:n,data:e}),this.cachedLogs.length>50&&this.cachedLogs.shift(),this.isConnected_&&1===(null===(t=this.socket_)||void 0===t?void 0:t.readyState)&&(null===(r=this.adapterRef.channelInfo)||void 0===r?void 0:r.cid)){const t=this.cachedLogs;this.cachedLogs=[];for(let r of t){const t=Object.assign({uid:this.adapterRef.channelInfo.uid,cid:this.adapterRef.channelInfo.cid},r);try{const e=this.textEncoder.encode(JSON.stringify(t));let r=[5,1,1,1,2,0,0,0],n=Uint8Array.from(r.concat(Array.from(e)));this.socket_.send(n)}catch(e){}}}}createPBMessage(e){let t=a.Root.fromJSON(u).lookupType("WebrtcStats"),r=t.create(e),n=t.encode(r).finish();return Uint8Array.from([4,1,1,1,3,0,0,0].concat(Array.from(n)))}async startPingPong(){try{if(-1!==this.pingPongTimeoutId_)return;await this.ping(),this.pingPongTimeoutId_=setTimeout((()=>{this.pingPongTimeoutId_=-1,this.startPingPong()}),1e4)}catch(e){this.logger.log("ping-pong failed, start reconnection"),this.clearSocket(),this.reconnect()}}stopPingPong(){this.logger.log("stop ping pong"),clearTimeout(this.pingTimeoutId_),clearTimeout(this.pingPongTimeoutId_),this.pingTimeoutId_=-1,this.pingPongTimeoutId_=-1}ping(){return new Promise(((e,t)=>{if(-1!==this.pingTimeoutId_)return e();this.sendPing(d),this.once(11,(()=>{clearTimeout(this.pingTimeoutId_),this.pingTimeoutId_=-1,e()})),this.pingTimeoutId_=setTimeout((()=>{this.pingTimeoutId_=-1,t()}),1e4)}))}reconnect(){var e,t,r;if(this.isConnecting_||-1!==this.reconnectionTimer_)return void this.logger.log("websocket is reconnecting");if(this.isConnecting_=!0,this.reconnectionCount_++,null===(r=null===(t=null===(e=this.adapterRef.instance)||void 0===e?void 0:e._params)||void 0===t?void 0:t.neRtcServerAddresses)||void 0===r?void 0:r.channelServer)return void this.logger.log("WebSocket不启用备用线路：当前为私有化配置");{const e=this.adapterRef.lbsManager.getURLSettings(this.url_),t=e[this.reconnectionCount_%e.length];t.url!==this.url_&&(this.logger.warn(`${t.seqId} WebSocket切换备用线路 ${this.url_} => ${t.url}`),this.url_=t.url,this.urlSetting=t)}this.socket_=new WebSocket(this.url_),this.bindSocket(this.socket_);const n=c.getReconnectionTimeout(this.reconnectionCount_);this.reconnectionTimer_=setTimeout((()=>{this.isConnecting_=!1,this.clearReconnectionTimer(),this.socket_&&this.unbindSocket(this.socket_),this.socket_=null,this.reconnect()}),n)}clearReconnectionTimer(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}once(e,t,r){this.emitter_.once(e,t,r)}emit(e,t,r){this.emitter_.emit(e,t,r)}clearSocket(){this.socket_&&this.unbindSocket(this.socket_),this.isConnected_=!1,this.isConnecting_=!1,this.socket_=null}close(){var e;this.logger.log("close websocket"),this.clearReconnectionTimer(),this.stopPingPong(),null===(e=this.socket_)||void 0===e||e.close(),this.clearSocket()}}},function(e,t,r){var n=e.exports=r(252);n.build="light",n.load=function(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)},n.loadSync=function(e,t){return t||(t=new n.Root),t.loadSync(e)},n.encoder=r(181),n.decoder=r(186),n.verifier=r(187),n.converter=r(188),n.ReflectionObject=r(120),n.Namespace=r(129),n.Root=r(190),n.Enum=r(59),n.Type=r(182),n.Field=r(121),n.OneOf=r(144),n.MapField=r(183),n.Service=r(184),n.Method=r(185),n.Message=r(156),n.wrappers=r(189),n.types=r(130),n.util=r(25),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},function(e,t,r){var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(154),n.BufferWriter=r(259),n.Reader=r(155),n.BufferReader=r(260),n.util=r(58),n.rpc=r(179),n.roots=r(180),n.configure=i,i()},function(e,t,r){var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=new Array(64),o=new Array(123),s=0;s<64;)o[i[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,r){for(var n,o=null,s=[],a=0,c=0;t<r;){var u=e[t++];switch(c){case 0:s[a++]=i[u>>2],n=(3&u)<<4,c=1;break;case 1:s[a++]=i[n|u>>4],n=(15&u)<<2,c=2;break;case 2:s[a++]=i[n|u>>6],s[a++]=i[63&u],c=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=i[n],s[a++]=61,1===c&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.decode=function(e,t,r){for(var n,i=r,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&s>1)break;if(void 0===(c=o[c]))throw Error("invalid encoding");switch(s){case 0:n=c,s=1;break;case 1:t[r++]=n<<2|(48&c)>>4,n=c,s=2;break;case 2:t[r++]=(15&n)<<4|(60&c)>>2,n=c,s=3;break;case 3:t[r++]=(3&n)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,r){function n(){this._listeners={}}e.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},function(e,t,r){function n(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?s:a,e.readFloatBE=n?a:s}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,s=8388607&n;return 255===o?s?NaN:i*(1/0):0===o?1401298464324817e-60*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,s),e.readFloatBE=r.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?s:a,e.readDoubleBE=n?a:s}():function(){function t(e,t,r,n,i,o){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>17976931348623157e292)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=n*Math.pow(2,-c))>>>0,i,o+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),s=e(n,i+r),a=2*(s>>31)+1,c=s>>>20&2047,u=4294967296*(1048575&s)+o;return 2047===c?u?NaN:a*(1/0):0===c?5e-324*a*u:a*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,s,0,4),e.readDoubleBE=r.bind(null,a,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=n(n)},function(e,t,r){var n=t;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],s=0;t<r;)(n=e[t++])<128?o[s++]=n:n>191&&n<224?o[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(n>>10),o[s++]=56320+(1023&n)):o[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(e,t,r){for(var n,i,o=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}},function(e,t,r){e.exports=function(e,t,r){var n=r||8192,i=n>>>1,o=null,s=n;return function(r){if(r<1||r>i)return e(r);s+r>n&&(o=e(n),s=0);var a=t.call(o,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},function(e,t,r){e.exports=i;var n=r(58);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var s=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===s?o:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){e.exports=o;var n=r(154);(o.prototype=Object.create(n.prototype)).constructor=o;var i=r(58);function o(){n.call(this)}function s(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}o._configure=function(){o.alloc=i._Buffer_allocUnsafe,o.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},o.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(s,t,e),this},o._configure()},function(e,t,r){e.exports=o;var n=r(155);(o.prototype=Object.create(n.prototype)).constructor=o;var i=r(58);function o(e){n.call(this,e)}o._configure=function(){i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()},function(e,t,r){e.exports=i;var n=r(58);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,o,s){if(!o)throw TypeError("request must be specified");var a=this;if(!s)return n.asPromise(e,a,t,r,i,o);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){function n(e,t){"string"==typeof e&&(t=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var t=o();if(n.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var s=Object.keys(e),a=new Array(s.length+1),c=new Array(s.length),u=0;u<s.length;)a[u]=s[u],c[u]=e[s[u++]];return a[u]=t,Function.apply(null,a).apply(null,c)}return Function(t)()}for(var l=new Array(arguments.length-1),d=0;d<l.length;)l[d]=arguments[++d];if(d=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var r=l[d++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"})),d!==l.length)throw Error("parameter count mismatch");return r.push(e),i}function o(n){return"function "+(n||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=o,i}e.exports=n,n.verbose=!1},function(e,t,r){e.exports=o;var n=r(177),i=r(178)("fs");function o(e,t,r){return"function"==typeof t?(r=t,t={}):t||(t={}),r?!t.xhr&&i&&i.readFile?i.readFile(e,(function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?o.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))})):o.xhr(e,t,r):n(o,this,e,t)}o.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},function(e,t,r){var n=t,i=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},o=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=i(e),n="";r&&(n=t.shift()+"/");for(var o=0;o<t.length;)".."===t[o]?o>0&&".."!==t[o-1]?t.splice(--o,2):r?t.splice(o,1):++o:"."===t[o]?t.splice(o,1):++o;return n+t.join("/")};n.resolve=function(e,t,r){return r||(t=o(t)),i(t)?t:(r||(e=o(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?o(e+"/"+t):t)}},function(e,t,r){var n=r(176),i=(n.roots.default||(n.roots.default=new n.Root)).addJSON({WebrtcStats:{fields:{local:{type:"local_obj",id:1},remote:{type:"remote_obj",id:2},timestamp:{type:"int64",id:3},appkey:{type:"string",id:4},cid:{type:"int64",id:5},uid:{type:"string",id:6},browser:{type:"string",id:7},platform:{type:"string",id:8},sdkVersion:{type:"string",id:9}},nested:{local_obj:{fields:{audio_ssrc:{rule:"repeated",type:"audio_ssrc_obj",id:1},audioSlave_ssrc:{rule:"repeated",type:"audioSlave_ssrc_obj",id:2},video_ssrc:{rule:"repeated",type:"video_ssrc_obj",id:3},screen_ssrc:{rule:"repeated",type:"screen_ssrc_obj",id:4},bwe:{rule:"repeated",type:"bwe_obj",id:5}},nested:{audio_ssrc_obj:{fields:{audioInputLevel:{type:"int64",id:1},totalAudioEnergy:{type:"int64",id:2},totalSamplesDuration:{type:"int64",id:3},bytesSent:{type:"int64",id:4},bitsSentPerSecond:{type:"int64",id:5},targetBitrate:{type:"int64",id:6},packetsSent:{type:"int64",id:7},packetsSentPerSecond:{type:"int64",id:8},packetsLost:{type:"int64",id:9},fractionLost:{type:"int64",id:10},packetsLostRate:{type:"int64",id:11},nackCount:{type:"int64",id:12},rtt:{type:"int64",id:13},jitterReceived:{type:"int64",id:14},echoReturnLoss:{type:"string",id:15},echoReturnLossEnhancement:{type:"string",id:16},active:{type:"int64",id:17}}},audioSlave_ssrc_obj:{fields:{audioInputLevel:{type:"int64",id:1},totalAudioEnergy:{type:"int64",id:2},totalSamplesDuration:{type:"int64",id:3},bytesSent:{type:"int64",id:4},bitsSentPerSecond:{type:"int64",id:5},targetBitrate:{type:"int64",id:6},packetsSent:{type:"int64",id:7},packetsSentPerSecond:{type:"int64",id:8},packetsLost:{type:"int64",id:9},fractionLost:{type:"int64",id:10},packetsLostRate:{type:"int64",id:11},nackCount:{type:"int64",id:12},rtt:{type:"int64",id:13},jitterReceived:{type:"int64",id:14},echoReturnLoss:{type:"string",id:15},echoReturnLossEnhancement:{type:"string",id:16},active:{type:"int64",id:17}}},video_ssrc_obj:{fields:{bytesSent:{type:"int64",id:1},bitsSentPerSecond:{type:"int64",id:2},targetBitrate:{type:"int64",id:3},packetsSent:{type:"int64",id:4},packetsSentPerSecond:{type:"int64",id:5},packetsLost:{type:"int64",id:6},fractionLost:{type:"int64",id:7},packetsLostRate:{type:"int64",id:8},firCount:{type:"int64",id:9},pliCount:{type:"int64",id:10},nackCount:{type:"int64",id:11},framesEncoded:{type:"int64",id:12},framesEncodedPerSecond:{type:"int64",id:13},avgEncodeMs:{type:"int64",id:14},encodeUsagePercent:{type:"int64",id:15},framesSent:{type:"int64",id:16},frameRateInput:{type:"int64",id:17},frameRateSent:{type:"int64",id:18},frameWidthInput:{type:"int64",id:19},frameWidthSent:{type:"int64",id:20},frameHeightInput:{type:"int64",id:21},frameHeightSent:{type:"int64",id:22},hugeFramesSent:{type:"int64",id:23},qpSum:{type:"int64",id:24},qpPercentage:{type:"int64",id:25},freezeTime:{type:"int64",id:26},totalFreezeTime:{type:"int64",id:27},qualityLimitationReason:{type:"string",id:28},qualityLimitationResolutionChanges:{type:"int64",id:29},jitter:{type:"int64",id:30},rtt:{type:"int64",id:31},active:{type:"int64",id:32},streamType:{type:"string",id:33}}},screen_ssrc_obj:{fields:{bytesSent:{type:"int64",id:1},bitsSentPerSecond:{type:"int64",id:2},targetBitrate:{type:"int64",id:3},packetsSent:{type:"int64",id:4},packetsSentPerSecond:{type:"int64",id:5},packetsLost:{type:"int64",id:6},fractionLost:{type:"int64",id:7},packetsLostRate:{type:"int64",id:8},firCount:{type:"int64",id:9},pliCount:{type:"int64",id:10},nackCount:{type:"int64",id:11},framesEncoded:{type:"int64",id:12},framesEncodedPerSecond:{type:"int64",id:13},avgEncodeMs:{type:"int64",id:14},encodeUsagePercent:{type:"int64",id:15},framesSent:{type:"int64",id:16},frameRateInput:{type:"int64",id:17},frameRateSent:{type:"int64",id:18},frameWidthInput:{type:"int64",id:19},frameWidthSent:{type:"int64",id:20},frameHeightInput:{type:"int64",id:21},frameHeightSent:{type:"int64",id:22},hugeFramesSent:{type:"int64",id:23},qpSum:{type:"int64",id:24},qpPercentage:{type:"int64",id:25},freezeTime:{type:"int64",id:26},totalFreezeTime:{type:"int64",id:27},qualityLimitationReason:{type:"string",id:28},qualityLimitationResolutionChanges:{type:"int64",id:29},jitter:{type:"int64",id:30},rtt:{type:"int64",id:31},active:{type:"int64",id:32},streamType:{type:"string",id:33}}},bwe_obj:{fields:{googActualEncBitrate:{type:"int64",id:1},googAvailableSendBandwidth:{type:"int64",id:2},googRetransmitBitrate:{type:"int64",id:3},googAvailableReceiveBandwidth:{type:"int64",id:4},googTargetEncBitrate:{type:"int64",id:5},googBucketDelay:{type:"int64",id:6},googTransmitBitrate:{type:"int64",id:7}}}}},remote_obj:{fields:{audio_ssrc:{rule:"repeated",type:"audio_ssrc_obj",id:1},audioSlave_ssrc:{rule:"repeated",type:"audioSlave_ssrc_obj",id:2},video_ssrc:{rule:"repeated",type:"video_ssrc_obj",id:3},screen_ssrc:{rule:"repeated",type:"screen_ssrc_obj",id:4}},nested:{audio_ssrc_obj:{fields:{audioOutputLevel:{type:"int64",id:1},totalAudioEnergy:{type:"int64",id:2},totalSamplesDuration:{type:"int64",id:3},bytesReceived:{type:"int64",id:4},bitsReceivedPerSecond:{type:"int64",id:5},packetsReceived:{type:"int64",id:6},packetsReceivedPerSecond:{type:"int64",id:7},packetsLost:{type:"int64",id:8},packetsLostRate:{type:"int64",id:9},nackCount:{type:"int64",id:10},lastPacketReceivedTimestamp:{type:"int64",id:11},estimatedPlayoutTimestamp:{type:"int64",id:12},freezeTime:{type:"int64",id:13},totalFreezeTime:{type:"int64",id:14},decodingPLC:{type:"int64",id:15},decodingPLCCNG:{type:"int64",id:16},decodingNormal:{type:"int64",id:17},decodingMuted:{type:"int64",id:18},decodingCNG:{type:"int64",id:19},decodingCTN:{type:"int64",id:20},currentDelayMs:{type:"int64",id:21},preferredJitterBufferMs:{type:"int64",id:22},jitterBufferMs:{type:"int64",id:23},jitterBufferDelay:{type:"int64",id:24},jitter:{type:"int64",id:25},rtt:{type:"int64",id:26},preemptiveExpandRate:{type:"int64",id:27},speechExpandRate:{type:"int64",id:28},concealedSamples:{type:"int64",id:29},silentConcealedSamples:{type:"int64",id:30},secondaryDecodedRate:{type:"int64",id:31},secondaryDiscardedRate:{type:"int64",id:32},remoteuid:{type:"string",id:33}}},audioSlave_ssrc_obj:{fields:{audioOutputLevel:{type:"int64",id:1},totalAudioEnergy:{type:"int64",id:2},totalSamplesDuration:{type:"int64",id:3},bytesReceived:{type:"int64",id:4},bitsReceivedPerSecond:{type:"int64",id:5},packetsReceived:{type:"int64",id:6},packetsReceivedPerSecond:{type:"int64",id:7},packetsLost:{type:"int64",id:8},packetsLostRate:{type:"int64",id:9},nackCount:{type:"int64",id:10},lastPacketReceivedTimestamp:{type:"int64",id:11},estimatedPlayoutTimestamp:{type:"int64",id:12},freezeTime:{type:"int64",id:13},totalFreezeTime:{type:"int64",id:14},decodingPLC:{type:"int64",id:15},decodingPLCCNG:{type:"int64",id:16},decodingNormal:{type:"int64",id:17},decodingMuted:{type:"int64",id:18},decodingCNG:{type:"int64",id:19},decodingCTN:{type:"int64",id:20},currentDelayMs:{type:"int64",id:21},preferredJitterBufferMs:{type:"int64",id:22},jitterBufferMs:{type:"int64",id:23},jitterBufferDelay:{type:"int64",id:24},jitter:{type:"int64",id:25},rtt:{type:"int64",id:26},preemptiveExpandRate:{type:"int64",id:27},speechExpandRate:{type:"int64",id:28},concealedSamples:{type:"int64",id:29},silentConcealedSamples:{type:"int64",id:30},secondaryDecodedRate:{type:"int64",id:31},secondaryDiscardedRate:{type:"int64",id:32},remoteuid:{type:"string",id:33}}},video_ssrc_obj:{fields:{bytesReceived:{type:"int64",id:1},bitsReceivedPerSecond:{type:"int64",id:2},packetsReceived:{type:"int64",id:3},packetsReceivedPerSecond:{type:"int64",id:4},packetsLost:{type:"int64",id:5},packetsLostRate:{type:"int64",id:6},firCount:{type:"int64",id:7},pliCount:{type:"int64",id:8},nackCount:{type:"int64",id:9},lastPacketReceivedTimestamp:{type:"int64",id:10},estimatedPlayoutTimestamp:{type:"int64",id:11},pauseCount:{type:"int64",id:12},totalPausesDuration:{type:"int64",id:13},freezeCount:{type:"int64",id:14},totalFreezesDuration:{type:"int64",id:15},totalFreezeTime:{type:"int64",id:16},freezeTime:{type:"int64",id:17},framesDecoded:{type:"int64",id:18},framesDropped:{type:"int64",id:19},framesReceived:{type:"int64",id:20},decodeMs:{type:"int64",id:21},frameRateDecoded:{type:"int64",id:22},frameRateOutput:{type:"int64",id:23},frameRateReceived:{type:"int64",id:24},frameWidthReceived:{type:"int64",id:25},frameHeightReceived:{type:"int64",id:26},powerEfficientDecoder:{type:"int64",id:27},currentDelayMs:{type:"int64",id:28},jitterBufferDelay:{type:"int64",id:29},remoteuid:{type:"string",id:30}}},screen_ssrc_obj:{fields:{bytesReceived:{type:"int64",id:1},bitsReceivedPerSecond:{type:"int64",id:2},packetsReceived:{type:"int64",id:3},packetsReceivedPerSecond:{type:"int64",id:4},packetsLost:{type:"int64",id:5},packetsLostRate:{type:"int64",id:6},firCount:{type:"int64",id:7},pliCount:{type:"int64",id:8},nackCount:{type:"int64",id:9},lastPacketReceivedTimestamp:{type:"int64",id:10},estimatedPlayoutTimestamp:{type:"int64",id:11},pauseCount:{type:"int64",id:12},totalPausesDuration:{type:"int64",id:13},freezeCount:{type:"int64",id:14},totalFreezesDuration:{type:"int64",id:15},totalFreezeTime:{type:"int64",id:16},freezeTime:{type:"int64",id:17},framesDecoded:{type:"int64",id:18},framesDropped:{type:"int64",id:19},framesReceived:{type:"int64",id:20},decodeMs:{type:"int64",id:21},frameRateDecoded:{type:"int64",id:22},frameRateOutput:{type:"int64",id:23},frameRateReceived:{type:"int64",id:24},frameWidthReceived:{type:"int64",id:25},frameHeightReceived:{type:"int64",id:26},powerEfficientDecoder:{type:"int64",id:27},currentDelayMs:{type:"int64",id:28},jitterBufferDelay:{type:"int64",id:29},remoteuid:{type:"string",id:30}}}}}}}});e.exports=i},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.GetStats=void 0;const s=r(267),a=o(r(24));t.GetStats=class{constructor(e){this.times=0,this.tmp={bytesSent:0,bytesReceived:0},this.adapterRef=e.adapterRef,this.browser="chrome",this.audioLevel=[],this._reset(),this.formativeStatsReport=new s.FormativeStatsReport({adapterRef:this.adapterRef})}_reset(){this.times=0,this.browser="chrome",a.IS_CHROME_ONLY&&a.CHROME_MAJOR_VERSION&&a.CHROME_MAJOR_VERSION>=72||a.IS_ANDROID?this.browser="chrome":a.IS_ANY_SAFARI&&a.SAFARI_MAJOR_VERSION&&a.SAFARI_MAJOR_VERSION>=12||a.IS_ANY_SAFARI&&a.IS_WECHAT?this.browser="safari":a.IS_FIREFOX&&a.FIREFOX_MAJOR_VERSION&&a.FIREFOX_MAJOR_VERSION>=60&&(this.browser="firefox"),this.audioLevel=[],this.formativeStatsReport&&this.formativeStatsReport.destroy(),this.formativeStatsReport=null}async getAllStats(){var e,t,r,n,i,o,s,a,c,u,l,d;try{let l=null===(n=null===(r=null===(t=null===(e=null==this?void 0:this.adapterRef)||void 0===e?void 0:e._mediasoup)||void 0===t?void 0:t._sendTransport)||void 0===r?void 0:r._handler)||void 0===n?void 0:n._pc,p=null===(a=null===(s=null===(o=null===(i=null==this?void 0:this.adapterRef)||void 0===i?void 0:i._mediasoup)||void 0===o?void 0:o._recvTransport)||void 0===s?void 0:s._handler)||void 0===a?void 0:a._pc;if(!l&&!p)return;this.audioLevel.length=0,this.adapterRef.remoteAudioStats={},this.adapterRef.remoteAudioSlaveStats={},this.adapterRef.remoteVideoStats={},this.adapterRef.remoteScreenStats={},this.tmp={bytesSent:0,bytesReceived:0},this.times=(this.times||0)+1;let m={local:l?await this.getLocalStats(l):null,remote:p?await this.getRemoteStats(p):null,times:this.times};return this.audioLevel.sort((d="level",function(e,t){var r=e[d],n=t[d];return 0===n||n?0===r||r?n-r:1:-1})),this.audioLevel.length>0&&this.audioLevel[0].level>0&&(null===(c=null==this?void 0:this.adapterRef)||void 0===c||c.instance.safeEmit("active-speaker",this.audioLevel[0]),null===(u=null==this?void 0:this.adapterRef)||void 0===u||u.instance.safeEmit("volume-indicator",this.audioLevel)),m}catch(e){null===(l=this.adapterRef)||void 0===l||l.logger.warn("数据汇集出现异常: ",e.message)}}async getLocalStats(e){return!e||/(failed|closed|new)/gi.test(e.iceConnectionState)?{}:await this[this.browser](e,"send")}async getRemoteStats(e){return!e||/(failed|closed|new)/gi.test(e.iceConnectionState)?{}:await this[this.browser](e,"recv")}async chrome(e,t){const r=await(()=>new Promise(((r,n)=>{e.getStats((n=>{let i={};n.result().forEach((function(e){const t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i[t.id]=t})),e.lastStats=e.lastStats||{},i=this.formatChromeNonStandardStats(e,i,t),r(i)}))})))(),n=await(async()=>{if(!e.getTransceivers)return{};let r={audio_ssrc:[],audioSlave_ssrc:[],video_ssrc:[],screen_ssrc:[]};const n=e.getTransceivers();for(let e=0;e<n.length;e++){let i=null;const o=n[e];"sendonly"===o.direction?o.sender&&o.sender.track&&o.sender.getStats&&(i=await o.sender.getStats(),i=this.formatChromeStandardizedStats(i,t),i.video_ssrc&&r.video_ssrc?(r.video_ssrc.push(i.video_ssrc[0]),r.video_ssrc.length>1&&"low"===(r.video_ssrc[0]||{}).streamType&&([r.video_ssrc[0],r.video_ssrc[1]]=[r.video_ssrc[1],r.video_ssrc[0]])):i.screen_ssrc&&r.screen_ssrc?(r.screen_ssrc.push(i.screen_ssrc[0]),r.screen_ssrc.length>1&&"low"===(r.screen_ssrc[0]||{}).streamType&&([r.screen_ssrc[0],r.screen_ssrc[1]]=[r.screen_ssrc[1],r.screen_ssrc[0]])):Object.assign(r,i)):"recvonly"===o.direction&&o.receiver&&o.receiver.track&&o.receiver.getStats&&(i=await o.receiver.getStats(),i=this.formatChromeStandardizedStats(i,t),i.audio_ssrc&&r.audio_ssrc?r.audio_ssrc.push(i.audio_ssrc[0]):i.audioSlave_ssrc&&r.audioSlave_ssrc?r.audioSlave_ssrc.push(i.audioSlave_ssrc[0]):i.video_ssrc&&r.video_ssrc?r.video_ssrc.push(i.video_ssrc[0]):i.screen_ssrc&&r.screen_ssrc?r.screen_ssrc.push(i.screen_ssrc[0]):Object.assign(r,i))}return r})(),i={};return r&&n?Object.keys(r).forEach((e=>{const t=r[e],o=n[e];if(i[e]=[],o)for(let r=0;r<t.length;r++)o[r]&&i[e].push(Object.assign(t[r],o[r]));else i[e]=t})):r?Object.assign(i,r):n&&Object.assign(i,n),i}formatChromeNonStandardStats(e,t,r){function n(e){if(!e)return 16;let t;return t=new Map([["speech_low_quality",16],["speech_standard",32],["music_standard",48],["standard_stereo",48],["high_quality",48],["high_quality_stereo",48]]).get(e),t}const i=[],o=[],s=[],a=[],c=[];Object.values(t).forEach((t=>{var u,l,d,p,m,f,h,g,v,y,b,S,T,_,w,M,x,E,C,R,k,A,I,O,P,N,D,L,j;if(t.id.includes("Conn-")&&"true"===t.googActiveConnection&&(null===(u=this.formativeStatsReport)||void 0===u||u.formatTransportData(t,r)),t.id.includes("Cand-")&&t.networkType)this.adapterRef.transportStats.NetworkType=t.networkType||"";else if("bweforvideo"===t.id&&"send"===r)t=function(e){const t={googAvailableSendBandwidth:1,googTargetEncBitrate:1,googActualEncBitrate:1,googRetransmitBitrate:1,googTransmitBitrate:1};return Object.keys(e).map((r=>{t[r]&&(e[r]=parseInt(e[r])/1024)})),e}(t),this.adapterRef.transportStats.OutgoingAvailableBandwidth=t.googAvailableSendBandwidth,c.push({googActualEncBitrate:parseInt(t.googActualEncBitrate)||0,googAvailableSendBandwidth:parseInt(t.googAvailableSendBandwidth)||0,googRetransmitBitrate:parseInt(t.googRetransmitBitrate)||0,googAvailableReceiveBandwidth:parseInt(t.googAvailableReceiveBandwidth)||0,googTargetEncBitrate:parseInt(t.googTargetEncBitrate)||0,googTransmitBitrate:parseInt(t.googTransmitBitrate)||0,googBucketDelay:parseInt(t.googBucketDelay)||0});else if(/^ssrc_/i.test(t.id)){const c=null===(l=null==this?void 0:this.adapterRef)||void 0===l?void 0:l.instance.getUidAndKindBySsrc(parseInt(t.ssrc)),u=null==c?void 0:c.uid,U=null==c?void 0:c.streamType;let F="";F=(null==c?void 0:c.kind)?c.kind:"screen"===t.googContentType?"screen":t.mediaType;let $={};if("send"===r){if("audio"===t.mediaType){void 0!==t.audioInputLevel&&($.audioInputLevel=parseInt(t.audioInputLevel)),$.totalAudioEnergy=parseInt(t.totalAudioEnergy),$.totalSamplesDuration=parseInt(t.totalSamplesDuration),$.bytesSent=parseInt(t.bytesSent),$.packetsSent=parseInt(t.packetsSent),$.packetsLost=parseInt(t.packetsLost),$.rtt=parseInt(t.googRtt),$.jitterReceived=parseInt(t.googJitterReceived),void 0!==t.googEchoCancellationReturnLoss&&($.echoReturnLoss=t.googEchoCancellationReturnLoss),void 0!==t.googEchoCancellationReturnLossEnhancement&&($.echoReturnLossEnhancement=t.googEchoCancellationReturnLossEnhancement),null===(d=this.formativeStatsReport)||void 0===d||d.formatSendData($,F);const r={CodecType:"Opus",rtt:$.rtt||0,MuteState:(null===(h=null===(f=null===(m=null===(p=null==this?void 0:this.adapterRef)||void 0===p?void 0:p.localStream)||void 0===m?void 0:m.muteStatus)||void 0===f?void 0:f.audio)||void 0===h?void 0:h.send)||!1,RecordingLevel:$.audioInputLevel||0,SamplingRate:n(null===(v=null===(g=null==this?void 0:this.adapterRef)||void 0===g?void 0:g.localStream)||void 0===v?void 0:v.audioProfile),SendBitrate:$.bitsSentPerSecond||0,SendLevel:$.audioInputLevel||0};"audio"===F?(i.push($),(null===(y=e.audioSender)||void 0===y?void 0:y.track)?this.adapterRef.localAudioStats[0]=r:this.adapterRef.localAudioStats=[]):"audioSlave"===F&&(o.push($),(null===(b=e.audioSlaveSender)||void 0===b?void 0:b.track)?this.adapterRef.localAudioSlaveStats[0]=r:this.adapterRef.localAudioSlaveStats=[])}else if("video"===t.mediaType){$.bytesSent=parseInt(t.bytesSent),$.packetsSent=parseInt(t.packetsSent),$.packetsLost=parseInt(t.packetsLost),$.firCount=parseInt(t.googFirsReceived),$.pliCount=parseInt(t.googPlisReceived),$.nackCount=parseInt(t.googNacksReceived),void 0!==t.framesEncoded&&($.framesEncoded=parseInt(t.framesEncoded)),$.avgEncodeMs=parseInt(t.googAvgEncodeMs),$.encodeUsagePercent=parseInt(t.googEncodeUsagePercent),$.frameRateInput=parseInt(t.googFrameRateInput),$.frameRateSent=parseInt(t.googFrameRateSent),$.frameWidthInput=parseInt(t.googFrameWidthInput),$.frameWidthSent=parseInt(t.googFrameWidthSent),$.frameHeightInput=parseInt(t.googFrameHeightInput),$.frameHeightSent=parseInt(t.googFrameHeightSent),void 0!==t.hugeFramesSent&&($.hugeFramesSent=parseInt(t.hugeFramesSent)),$.qpSum=parseInt(t.qpSum),$.qualityLimitationReason=function(e){return e.googBandwidthLimitedResolution?1:e.googCpuLimitedResolution?2:e.googHasEnteredLowResolution?3:0}(t),$.qualityLimitationResolutionChanges=parseInt(t.googAdaptationChanges),$.rtt=parseInt(t.googRtt),$.streamType=U,"high"===U&&(null===(S=this.formativeStatsReport)||void 0===S||S.formatSendData($,F));const r={LayerType:1,CodecName:t.googCodecName||"h264",CodecImplementationName:t.codecImplementationName||"",CaptureFrameRate:$.frameRateInput||0,CaptureResolutionHeight:$.frameHeightInput||0,CaptureResolutionWidth:$.frameWidthInput||0,EncodeDelay:$.avgEncodeMs||0,MuteState:(null===(w=null===(_=null===(T=this.adapterRef.localStream)||void 0===T?void 0:T.muteStatus)||void 0===_?void 0:_.video)||void 0===w?void 0:w.send)||!1,SendBitrate:$.bitsSentPerSecond||0,SendFrameRate:$.frameRateSent||0,SendResolutionHeight:$.frameHeightSent||0,SendResolutionWidth:$.frameWidthSent||0,TargetSendBitrate:$.bitsSentPerSecond||0,TotalDuration:void 0!==(null===(M=null==this?void 0:this.adapterRef)||void 0===M?void 0:M.state.startPubVideoTime)?(Date.now()-this.adapterRef.state.startPubVideoTime)/1e3:0,TotalFreezeTime:$.totalFreezeTime||0};"video"===F?(s.push($),(null===(x=e.videoSender)||void 0===x?void 0:x.track)?"high"===U&&(this.adapterRef.localVideoStats[0]=r):this.adapterRef.localVideoStats=[]):"screen"===F&&((null===(E=e.screenSender)||void 0===E?void 0:E.track)?"high"===U&&(r.MuteState=(null===(k=null===(R=null===(C=this.adapterRef.localStream)||void 0===C?void 0:C.muteStatus)||void 0===R?void 0:R.screen)||void 0===k?void 0:k.send)||!1,r.TotalDuration=void 0!==(null===(A=null==this?void 0:this.adapterRef)||void 0===A?void 0:A.state.startPubScreenTime)?(Date.now()-this.adapterRef.state.startPubScreenTime)/1e3:0,r.LayerType=2,this.adapterRef.localScreenStats[0]=r):this.adapterRef.localScreenStats=[],a.push($))}}else if("recv"===r){if(!u)return{};if(null===(I=this.formativeStatsReport)||void 0===I||I.clearFirstRecvData(u),$.remoteuid=u,"audio"===t.mediaType){$.audioOutputLevel=parseInt(t.audioOutputLevel),$.totalAudioEnergy=parseInt(t.totalAudioEnergy),$.totalSamplesDuration=parseInt(t.totalSamplesDuration),$.bytesReceived=parseInt(t.bytesReceived),$.packetsReceived=parseInt(t.packetsReceived),$.packetsLost=parseInt(t.packetsLost),$.decodingPLC=parseInt(t.googDecodingPLC),$.decodingPLCCNG=parseInt(t.googDecodingPLCCNG),$.decodingNormal=parseInt(t.googDecodingNormal),$.decodingMuted=parseInt(t.googDecodingMuted),$.decodingCNG=parseInt(t.googDecodingCNG),$.decodingCTN=parseInt(t.googDecodingCTN),$.currentDelayMs=parseInt(t.googCurrentDelayMs),$.preferredJitterBufferMs=parseInt(t.googPreferredJitterBufferMs),$.jitterBufferMs=parseInt(t.googJitterBufferMs),$.jitter=parseInt(t.googJitterReceived),$.preemptiveExpandRate=parseInt(t.googPreemptiveExpandRate),$.speechExpandRate=parseInt(t.googSpeechExpandRate),$.secondaryDecodedRate=parseInt(t.googSecondaryDecodedRate),$.secondaryDiscardedRate=parseInt(t.googSecondaryDiscardedRate),null===(O=this.formativeStatsReport)||void 0===O||O.formatRecvData($,F);const e=null===(P=null==this?void 0:this.adapterRef)||void 0===P?void 0:P.remoteStreamMap[t.remoteuid],r=e&&(e.muteStatus.audioSlave.send||e.muteStatus.audioSlave.recv)||!1,n={CodecType:"Opus",End2EndDelay:(parseInt(t.googCurrentDelayMs)||0)+(parseInt(t.googJitterBufferMs)||0),MuteState:r,PacketLossRate:$.packetsLostRate||0,RecvBitrate:$.bitsReceivedPerSecond||0,RecvLevel:$.audioOutputLevel||0,TotalFreezeTime:$.totalFreezeTime||0,TotalPlayDuration:parseInt(t.totalSamplesDuration)||0,TransportDelay:parseInt(t.googCurrentDelayMs)||0};"audio"===F?($.remoteuid&&(this.adapterRef.remoteAudioStats[$.remoteuid]=n),i.push($)):"audioSlave"===F&&($.remoteuid&&(this.adapterRef.remoteAudioSlaveStats[$.remoteuid]=n),o.push($))}else if("video"===t.mediaType){$.bytesReceived=parseInt(t.bytesReceived),$.bitsReceivedPerSecond=0,$.packetsReceived=parseInt(t.packetsReceived),$.packetsLost=parseInt(t.packetsLost),$.firCount=parseInt(t.googFirsSent),$.pliCount=parseInt(t.googPlisSent),$.nackCount=parseInt(t.googNacksSent),$.framesDecoded=parseInt(t.framesDecoded),$.decodeMs=parseInt(t.googDecodeMs),$.frameRateDecoded=parseInt(t.googFrameRateDecoded),$.frameRateOutput=parseInt(t.googFrameRateOutput),$.frameRateReceived=parseInt(t.googFrameRateReceived),$.frameWidthReceived=parseInt(t.googFrameWidthReceived),$.frameHeightReceived=parseInt(t.googFrameHeightReceived),$.currentDelayMs=parseInt(t.googCurrentDelayMs),void 0!==t.googJitterBufferMs&&($.jitterBufferDelay=parseInt(t.googJitterBufferMs)),null===(N=this.formativeStatsReport)||void 0===N||N.formatRecvData($,F);const e=null===(D=null==this?void 0:this.adapterRef)||void 0===D?void 0:D.remoteStreamMap[$.remoteuid];let r=e&&e.Play&&(null===(L=null==e?void 0:e.Play)||void 0===L?void 0:L.video.dom),n=e&&(e.muteStatus.video.send||e.muteStatus.video.recv)||!1;"screen"===F&&(r=e&&e.Play&&(null===(j=null==e?void 0:e.Play)||void 0===j?void 0:j.screen.dom),n=e&&(e.muteStatus.screen.send||e.muteStatus.screen.recv)||!1);const i={LayerType:1,CodecName:t.googCodecName,End2EndDelay:(parseInt(t.googCurrentDelayMs)||0)+(parseInt(t.googJitterBufferMs)||0)+(parseInt(t.googRenderDelayMs)||0),MuteState:n,PacketLossRate:$.packetsLostRate||0,RecvBitrate:$.bitsReceivedPerSecond||0,RecvResolutionHeight:$.frameHeightReceived||0,RecvResolutionWidth:$.frameWidthReceived||0,RenderFrameRate:$.frameRateOutput||0,RenderResolutionHeight:r?r.videoHeight:0,RenderResolutionWidth:r?r.videoWidth:0,TotalFreezeTime:t.totalFreezeTime||0,TotalPlayDuration:r&&r.played&&r.played.length?r.played.end(0):0,TransportDelay:parseInt(t.googCurrentDelayMs)||0};"video"===F?(this.adapterRef.remoteVideoStats[$.remoteuid]=i,s.push($)):"screen"===F&&(i.LayerType=2,this.adapterRef.remoteScreenStats[$.remoteuid]=i,a.push($))}}}}));const u={};return i.length&&(u.audio_ssrc=i),o.length&&(u.audioSlave_ssrc=o),s.length&&(s.length>1&&"low"===(s[0]||{}).streamType&&([s[0],s[1]]=[s[1],s[0]]),u.video_ssrc=s),a.length&&(a.length>1&&"low"===(a[0]||{}).streamType&&([a[0],a[1]]=[a[1],a[0]]),u.screen_ssrc=a),c.length&&(u.bwe=c),u}formatChromeStandardizedStats(e,t){var r,n;const i={},o={};let s=0;e.forEach((e=>{var r;"media-source"==e.type?"audio"===e.kind?(i.audioInputLevel=Math.round(32768*e.audioLevel),i.totalAudioEnergy=Math.round(e.totalAudioEnergy),i.totalSamplesDuration=Math.round(e.totalSamplesDuration),void 0!==e.echoReturnLoss&&(i.echoReturnLoss=e.echoReturnLoss.toString()),void 0!==e.echoReturnLossEnhancement&&(i.echoReturnLossEnhancement=e.echoReturnLossEnhancement.toString())):"video"===e.kind&&(o.frameRateInput=e.framesPerSecond,o.frameWidthInput=e.width,o.frameHeightInput=e.height):"outbound-rtp"==e.type?(s=e.ssrc,"audio"===e.kind?(void 0!==e.targetBitrate&&(i.targetBitrate=Math.round(e.targetBitrate/1e3)),i.bytesSent=e.headerBytesSent+e.bytesSent,i.packetsSent=e.packetsSent,void 0!==e.nackCount&&(i.nackCount=e.nackCount),i.active=e.active?1:0):"video"===e.kind&&(o.active=e.active?1:0,o.bytesSent=e.headerBytesSent+e.bytesSent,o.firCount=e.firCount,o.nackCount=e.nackCount,o.pliCount=e.pliCount,void 0!==e.framesEncoded&&(o.framesEncoded=e.framesEncoded),void 0!==e.framesSent&&(o.framesSent=e.framesSent),void 0!==e.hugeFramesSent&&(o.hugeFramesSent=e.hugeFramesSent),o.packetsSent=e.packetsSent,o.qpSum=e.qpSum,o.qualityLimitationReason="bandwidth"===(r=e.qualityLimitationReason)?1:"cpu"===r?2:"other"===r?3:0,o.qualityLimitationResolutionChanges=e.qualityLimitationResolutionChanges,void 0!==e.targetBitrate&&(o.targetBitrate=Math.round(e.targetBitrate/1e3)),void 0!==e.framesPerSecond&&(o.frameRateSent=e.framesPerSecond),void 0!==e.frameWidth&&(o.frameWidthSent=e.frameWidth),void 0!==e.frameHeight&&(o.frameHeightSent=e.frameHeight))):"remote-inbound-rtp"==e.type?"audio"===e.kind?(void 0!==e.fractionLost&&(i.fractionLost=e.fractionLost),i.jitterReceived=Math.round(1e3*e.jitter),i.packetsLost=e.packetsLost,i.rtt=Math.round(1e3*e.roundTripTime)):"video"===e.kind&&(void 0!==e.fractionLost&&(o.fractionLost=e.fractionLost),o.jitter=Math.round(1e3*e.jitter),o.packetsLost=e.packetsLost,o.rtt=Math.round(1e3*e.roundTripTime)):"inbound-rtp"==e.type?(s=e.ssrc,"audio"===e.kind?(void 0!==e.audioLevel&&(i.audioOutputLevel=Math.round(32768*e.audioLevel)),void 0!==e.totalAudioEnergy&&(i.totalAudioEnergy=Math.round(e.totalAudioEnergy)),void 0!==e.totalSamplesReceived&&(i.totalSamplesDuration=Math.round(e.totalSamplesReceived/48e3)),i.bytesReceived=e.headerBytesReceived+e.bytesReceived,void 0!==e.concealedSamples&&(i.concealedSamples=e.concealedSamples),i.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp||0,i.jitter=Math.round(1e3*e.jitter),void 0!==e.jitterBufferDelay&&(i.jitterBufferDelay=Math.round(1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount)),i.lastPacketReceivedTimestamp=e.lastPacketReceivedTimestamp,void 0!==e.nackCount&&(i.nackCount=e.nackCount),void 0!==e.silentConcealedSamples&&(i.silentConcealedSamples=e.silentConcealedSamples),i.packetsLost=e.packetsLost,i.packetsReceived=e.packetsReceived):"video"===e.kind&&(o.bytesReceived=e.bytesReceived+e.headerBytesReceived,o.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp||0,o.lastPacketReceivedTimestamp=e.lastPacketReceivedTimestamp||0,o.firCount=e.firCount,o.nackCount=e.nackCount,o.pliCount=e.pliCount,o.framesDecoded=e.framesDecoded,void 0!==e.framesDropped&&(o.framesDropped=e.framesDropped),void 0!==e.framesReceived&&(o.framesReceived=e.framesReceived),o.packetsReceived=e.packetsReceived,o.packetsLost=e.packetsLost,void 0!==e.pauseCount&&(o.pauseCount=e.pauseCount),void 0!==e.totalPausesDuration&&(o.totalPausesDuration=e.totalPausesDuration),void 0!==e.freezeCount&&(o.freezeCount=e.freezeCount),void 0!==e.totalFreezesDuration&&(o.totalFreezesDuration=e.totalFreezesDuration),void 0!==e.framesPerSecond&&(o.frameRateReceived=e.framesPerSecond),void 0!==e.frameWidth&&(o.frameWidthReceived=e.frameWidth),void 0!==e.frameHeight&&(o.frameHeightReceived=e.frameHeight),o.powerEfficientDecoder=e.powerEfficientDecoder?1:0,void 0!==e.jitterBufferDelay&&(o.jitterBufferDelay=Math.round(1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount)))):"remote-outbound-rtp"==e.type?"audio"===e.kind?(void 0!==e.jitter&&(i.jitter=Math.round(1e3*e.jitter)),void 0!==e.roundTripTime&&(i.rtt=Math.round(1e3*e.roundTripTime))):e.kind:"track"==e.type&&"recv"===t&&"audio"===e.kind&&void 0!==e.audioLevel&&(i.audioOutputLevel=Math.round(32768*e.audioLevel))}));const a=null===(r=null==this?void 0:this.adapterRef)||void 0===r?void 0:r.instance.getUidAndKindBySsrc(s);let c=null==a?void 0:a.kind;"{}"!==JSON.stringify(o)&&"send"===t&&(o.streamType=(null==a?void 0:a.streamType)||"high");const u={};if("recv"===t)if("{}"!==JSON.stringify(o))o.remoteuid=null==a?void 0:a.uid;else if("{}"!==JSON.stringify(i)&&(i.remoteuid=null==a?void 0:a.uid,i.audioOutputLevel)){const e=null===(n=null==this?void 0:this.adapterRef)||void 0===n?void 0:n.remoteStreamMap[i.remoteuid],t=c&&(null==e?void 0:e.isPlaying(c))||!1;this.audioLevel.push({uid:i.remoteuid,level:t&&+i.audioOutputLevel||0,type:c})}return(null==c?void 0:c.includes("audio"))?u[c+"_ssrc"]=[i]:"video"!==c&&"screen"!==c||(u[c+"_ssrc"]=[o]),u}async safari(e,t){var r,n;if(!e.getTransceivers)return{};let i={audio_ssrc:[],audioSlave_ssrc:[],video_ssrc:[],screen_ssrc:[]};const o=e.getTransceivers();for(let e=0;e<o.length;e++){let s=null;const a=o[e];"sendonly"===a.direction?a.sender&&a.sender.getStats&&(s=await a.sender.getStats(),s=this.formatSafariStandardizedStats(s,t,(null===(r=a.sender.track)||void 0===r?void 0:r.kind)||""),s.video_ssrc&&i.video_ssrc?(i.video_ssrc.push(s.video_ssrc[0]),i.video_ssrc.length>1&&"low"===(i.video_ssrc[0]||{}).streamType&&([i.video_ssrc[0],i.video_ssrc[1]]=[i.video_ssrc[1],i.video_ssrc[0]])):s.screen_ssrc&&i.screen_ssrc?(i.screen_ssrc.push(s.screen_ssrc[0]),i.screen_ssrc.length>1&&"low"===(i.screen_ssrc[0]||{}).streamType&&([i.screen_ssrc[0],i.screen_ssrc[1]]=[i.screen_ssrc[1],i.screen_ssrc[0]])):Object.assign(i,s)):"recvonly"===a.direction&&a.receiver&&a.receiver.getStats&&(s=await a.receiver.getStats(),s=this.formatSafariStandardizedStats(s,t,(null===(n=a.receiver.track)||void 0===n?void 0:n.kind)||""),s.audio_ssrc&&i.audio_ssrc?i.audio_ssrc.push(s.audio_ssrc[0]):s.audioSlave_ssrc&&i.audioSlave_ssrc?i.audioSlave_ssrc.push(s.audioSlave_ssrc[0]):s.video_ssrc&&i.video_ssrc?i.video_ssrc.push(s.video_ssrc[0]):s.screen_ssrc&&i.screen_ssrc?i.screen_ssrc.push(s.screen_ssrc[0]):Object.assign(i,s))}return i}formatSafariStandardizedStats(e,t,r){var n,i,o,s,a,c,u;const l={},d={};let p=0;e.forEach((e=>{"track"==e.type?"audio"===e.kind||"audio"===r?(l.active=e.ended?0:1,void 0!==e.audioLevel&&(l.audioOutputLevel=Math.round(32768*e.audioLevel))):"video"!==e.kind&&"video"!==r||(d.active=e.ended?0:1,"send"===t?(d.frameWidthInput=e.width||e.frameWidth,d.frameHeightInput=e.height||e.frameHeight,void 0!==e.framesSent&&(d.framesSent=e.framesSent)):"recv"===t&&(d.frameWidthReceived=e.width||e.frameWidth,d.frameHeightReceived=e.height||e.frameHeight,void 0!==e.framesDecoded&&(d.framesDecoded=e.framesDecoded),void 0!==e.framesReceived&&(d.framesReceived=e.framesReceived),void 0!==e.framesDropped&&(d.framesDropped=e.framesDropped))):"outbound-rtp"==e.type?(p=e.ssrc,"audio"===e.kind||"audio"===e.mediaType||"audio"===r?(l.bytesSent=(e.headerBytesSent||0)+e.bytesSent,l.packetsSent=e.packetsSent,void 0!==e.nackCount&&(l.nackCount=e.nackCount)):"video"!==e.kind&&"video"!==e.mediaType&&"video"!==r||(d.bytesSent=(e.headerBytesSent||0)+e.bytesSent,d.firCount=e.firCount,d.nackCount=e.nackCount,d.pliCount=e.pliCount,d.framesEncoded=e.framesEncoded,void 0!==e.hugeFramesSent&&(d.hugeFramesSent=e.hugeFramesSent),d.packetsSent=e.packetsSent,d.qpSum=e.qpSum,void 0!==e.qualityLimitationResolutionChanges&&(d.qualityLimitationResolutionChanges=e.qualityLimitationResolutionChanges),void 0!==e.totalEncodeTime&&(d.avgEncodeMs=Math.round(1e3*e.totalEncodeTime/e.framesEncoded)),void 0!==e.framesPerSecond&&(d.frameRateSent=e.framesPerSecond),void 0!==e.frameWidth&&(d.frameWidthSent=e.frameWidth),void 0!==e.frameHeight&&(d.frameHeightSent=e.frameHeight))):"remote-inbound-rtp"==e.type?"audio"===e.kind?(void 0!==e.jitter&&(l.jitterReceived=Math.round(1e3*e.jitter)),void 0!==e.packetsLost&&(l.packetsLost=e.packetsLost),l.rtt=Math.round(1e3*e.roundTripTime)):"video"===e.kind&&(void 0!==e.jitter&&(d.jitter=Math.round(1e3*e.jitter)),void 0!==e.packetsLost&&(d.packetsLost=e.packetsLost),d.rtt=Math.round(1e3*e.roundTripTime)):"inbound-rtp"==e.type?(p=e.ssrc,"audio"===e.kind||"audio"===e.mediaType||"audio"===r?(void 0!==e.audioLevel&&(l.audioOutputLevel=Math.round(32768*e.audioLevel)),void 0!==e.totalAudioEnergy&&(l.totalAudioEnergy=Math.round(e.totalAudioEnergy)),void 0!==e.totalSamplesReceived&&(l.totalSamplesDuration=Math.round(e.totalSamplesReceived/48e3)),l.bytesReceived=(e.headerBytesReceived||0)+e.bytesReceived,void 0!==e.concealedSamples&&(l.concealedSamples=e.concealedSamples),void 0!==e.estimatedPlayoutTimestamp&&(l.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp),void 0!==e.jitter&&(l.jitter=Math.round(1e3*e.jitter)),void 0!==e.jitterBufferDelay&&(l.jitterBufferDelay=Math.round(1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount)),void 0!==e.lastPacketReceivedTimestamp&&(l.lastPacketReceivedTimestamp=e.lastPacketReceivedTimestamp),void 0!==e.nackCount&&(l.nackCount=e.nackCount),void 0!==e.silentConcealedSamples&&(l.silentConcealedSamples=e.silentConcealedSamples),l.packetsLost=e.packetsLost,l.packetsReceived=e.packetsReceived,void 0!==e.jitter&&(l.jitter=Math.round(1e3*e.jitter))):"video"!==e.kind&&"video"!==e.mediaType&&"video"!==r||(d.bytesReceived=e.bytesReceived+(e.headerBytesReceived||0),void 0!==e.estimatedPlayoutTimestamp&&(d.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp),void 0!==e.lastPacketReceivedTimestamp&&(d.lastPacketReceivedTimestamp=e.lastPacketReceivedTimestamp),d.firCount=e.firCount,d.nackCount=e.nackCount,d.pliCount=e.pliCount,void 0!==e.framesDecoded&&(d.framesDecoded=e.framesDecoded),void 0!==e.framesDropped&&(d.framesDropped=e.framesDropped),void 0!==e.framesReceived&&(d.framesReceived=e.framesReceived),d.packetsReceived=e.packetsReceived,d.packetsLost=e.packetsLost,void 0!==e.framesPerSecond&&(d.frameRateReceived=e.framesPerSecond),void 0!==e.frameWidth&&(d.frameWidthReceived=e.frameWidth),void 0!==e.frameHeight&&(d.frameHeightReceived=e.frameHeight),void 0!==e.jitter&&(d.jitter=Math.round(1e3*e.jitter)),void 0!==e.jitterBufferDelay&&(d.jitterBufferDelay=Math.round(1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount)))):"remote-outbound-rtp"==e.type&&("audio"===e.kind?(void 0!==e.jitter&&(l.jitter=Math.round(1e3*e.jitter)),void 0!==e.roundTripTime&&(l.rtt=Math.round(1e3*e.roundTripTime))):e.kind)}));const m=null===(n=null==this?void 0:this.adapterRef)||void 0===n?void 0:n.instance.getUidAndKindBySsrc(p);let f=null==m?void 0:m.kind;"{}"!==JSON.stringify(d)&&"send"===t&&(d.streamType=(null==m?void 0:m.streamType)||"high");const h={};if("recv"===t)if(null===(i=this.formativeStatsReport)||void 0===i||i.clearFirstRecvData(null==m?void 0:m.uid),"{}"!==JSON.stringify(d))d.remoteuid=null==m?void 0:m.uid,null===(o=this.formativeStatsReport)||void 0===o||o.formatRecvData(d,f);else if("{}"!==JSON.stringify(l)&&(l.remoteuid=null==m?void 0:m.uid,null===(s=this.formativeStatsReport)||void 0===s||s.formatRecvData(l,f),l.audioOutputLevel)){const e=null===(a=null==this?void 0:this.adapterRef)||void 0===a?void 0:a.remoteStreamMap[l.remoteuid],t=f&&(null==e?void 0:e.isPlaying(f))||!1;this.audioLevel.push({uid:l.remoteuid,level:t&&+l.audioOutputLevel||0,type:f})}return(null==f?void 0:f.includes("audio"))?("send"===t&&(null===(c=this.formativeStatsReport)||void 0===c||c.formatSendData(l,f)),"number"==typeof l.active&&(h[f+"_ssrc"]=[l])):"video"!==f&&"screen"!==f||("high"===(null==m?void 0:m.streamType)&&"send"===t&&(null===(u=this.formativeStatsReport)||void 0===u||u.formatSendData(d,f)),"number"==typeof d.active&&(h[f+"_ssrc"]=[d])),h}async firefox(e,t){if(!e.getTransceivers)return{};let r={audio_ssrc:[],audioSlave_ssrc:[],video_ssrc:[],screen_ssrc:[]};const n=e.getTransceivers();for(let e=0;e<n.length;e++){let i=null;const o=n[e];"sendonly"===o.direction?o.sender&&o.sender.getStats&&(i=await o.sender.getStats(),i=this.formatFirefoxStandardizedStats(i,t),Object.assign(r,i)):"recvonly"===o.direction&&o.receiver&&o.receiver.getStats&&(i=await o.receiver.getStats(),i=this.formatFirefoxStandardizedStats(i,t),i.audio_ssrc&&r.audio_ssrc?r.audio_ssrc.push(i.audio_ssrc[0]):i.audioSlave_ssrc&&r.audioSlave_ssrc?r.audioSlave_ssrc.push(i.audioSlave_ssrc[0]):i.video_ssrc&&r.video_ssrc?r.video_ssrc.push(i.video_ssrc[0]):i.screen_ssrc&&r.screen_ssrc?r.screen_ssrc.push(i.screen_ssrc[0]):Object.assign(r,i))}return r}formatFirefoxStandardizedStats(e,t){var r,n,i,o,s,a,c;const u={},l={};let d=0;e.forEach((e=>{"outbound-rtp"==e.type?(d=e.ssrc,"audio"===e.kind?(u.bytesSent=(e.headerBytesSent||0)+e.bytesSent,u.packetsSent=e.packetsSent,u.nackCount=e.nackCount):"video"===e.kind&&(l.bytesSent=(e.headerBytesSent||0)+e.bytesSent,l.firCount=e.firCount,l.nackCount=e.nackCount,l.pliCount=e.pliCount,void 0!==e.hugeFramesSent&&(l.hugeFramesSent=e.hugeFramesSent),l.packetsSent=e.packetsSent,l.qpSum=e.qpSum,void 0!==e.framesEncoded&&(l.framesEncoded=e.framesEncoded),void 0!==e.framesSent&&(l.framesSent=e.framesSent),void 0!==e.totalEncodeTime&&void 0!==e.framesEncoded&&(l.avgEncodeMs=Math.round(1e3*e.totalEncodeTime/e.framesEncoded)),void 0!==e.framesPerSecond&&(l.frameRateSent=e.framesPerSecond),void 0!==e.frameWidth&&(l.frameWidthSent=e.frameWidth),void 0!==e.frameHeight&&(l.frameHeightSent=e.frameHeight))):"remote-inbound-rtp"==e.type?"video"===e.kind&&(l.fractionLost=e.fractionLost,l.jitter=Math.round(1e3*e.jitter),l.packetsLost=e.packetsLost,l.rtt=Math.round(1e3*e.roundTripTime)):"inbound-rtp"==e.type&&(d=e.ssrc,"audio"===e.kind?(void 0!==e.audioLevel&&(u.audioOutputLevel=Math.round(32768*e.audioLevel)),void 0!==e.insertedSamplesForDeceleration&&(u.preemptiveExpandRate=parseInt(e.insertedSamplesForDeceleration)),void 0!==e.removedSamplesForAcceleration&&(u.speechExpandRate=parseInt(e.removedSamplesForAcceleration)),u.bytesReceived=e.bytesReceived+(e.headerBytesReceived||0),u.concealedSamples=e.concealedSamples,u.jitter=Math.round(1e3*e.jitter),u.jitterBufferDelay=Math.round(1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount),u.silentConcealedSamples=e.silentConcealedSamples,u.packetsLost=e.packetsLost,u.packetsReceived=e.packetsReceived,void 0!==e.totalSamplesReceived&&(u.totalSamplesDuration=Math.round(e.totalSamplesReceived/48e3)),void 0!==e.totalAudioEnergy&&(u.totalAudioEnergy=Math.round(e.totalAudioEnergy)),void 0!==e.totalSamplesReceived&&(u.totalSamplesDuration=Math.round(e.totalSamplesReceived/48e3))):"video"===e.kind&&(l.bytesReceived=e.bytesReceived+(e.headerBytesReceived||0),l.firCount=e.firCount,l.nackCount=e.nackCount,l.pliCount=e.pliCount,l.framesDecoded=e.framesDecoded,l.framesDropped=e.framesReceived-e.framesDecoded,l.framesReceived=e.framesReceived,l.packetsReceived=e.packetsReceived,l.packetsLost=e.packetsLost,l.frameRateReceived=e.framesPerSecond||0,l.frameWidthReceived=e.frameWidth,l.frameHeightReceived=e.frameHeight,l.jitterBufferDelay=Math.round(1e3*e.jitterBufferDelay/e.jitterBufferEmittedCount),void 0!==e.estimatedPlayoutTimestamp&&(l.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp),void 0!==e.lastPacketReceivedTimestamp&&(l.lastPacketReceivedTimestamp=e.lastPacketReceivedTimestamp)))}));const p=null===(r=null==this?void 0:this.adapterRef)||void 0===r?void 0:r.instance.getUidAndKindBySsrc(d);let m=null==p?void 0:p.kind;"{}"!==JSON.stringify(l)&&"send"===t&&(l.streamType=(null==p?void 0:p.streamType)||"high");const f={};if("recv"===t)if(null===(n=this.formativeStatsReport)||void 0===n||n.clearFirstRecvData(null==p?void 0:p.uid),"{}"!==JSON.stringify(l))l.remoteuid=null==p?void 0:p.uid,null===(i=this.formativeStatsReport)||void 0===i||i.formatRecvData(l,m);else if("{}"!==JSON.stringify(u)&&(u.remoteuid=null==p?void 0:p.uid,null===(o=this.formativeStatsReport)||void 0===o||o.formatRecvData(u,m),u.audioOutputLevel)){const e=null===(s=null==this?void 0:this.adapterRef)||void 0===s?void 0:s.remoteStreamMap[u.remoteuid],t=m&&(null==e?void 0:e.isPlaying(m))||!1;this.audioLevel.push({uid:u.remoteuid,level:t&&+u.audioOutputLevel||0,type:m})}return(null==m?void 0:m.includes("audio"))?("send"===t&&(null===(a=this.formativeStatsReport)||void 0===a||a.formatSendData(u,m)),f[m+"_ssrc"]=[u]):"video"!==m&&"screen"!==m||("high"===(null==p?void 0:p.streamType)&&"send"===t&&(null===(c=this.formativeStatsReport)||void 0===c||c.formatSendData(l,m)),f[m+"_ssrc"]=[l]),f}stop(){this._reset()}destroy(){this._reset()}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FormativeStatsReport=void 0,t.FormativeStatsReport=class{constructor(e){this.adapterRef=e.adapterRef,this.firstData={recvFirstData:{},sendFirstAudioPackage:!1,sendFirstVideoPackage:!1,sendFirstScreenPackage:!1},this.statsCatch={upAudioCache:{},upAudioSlaveCache:{},upVideoCache:{},upScreenCache:{},downAudioCache:{},downAudioSlaveCache:{},downVideoCache:{},downScreenCache:{},upTransportCache:{},downTransportCache:{}}}_reset(){this.firstData={recvFirstData:{},sendFirstAudioPackage:!1,sendFirstVideoPackage:!1,sendFirstScreenPackage:!1},this.statsCatch={upAudioCache:{},upAudioSlaveCache:{},upVideoCache:{},upScreenCache:{},downAudioCache:{},downAudioSlaveCache:{},downVideoCache:{},downScreenCache:{},upTransportCache:{},downTransportCache:{}}}clearFirstRecvData(e){const t=this.adapterRef.remoteStreamMap[e],r=this.firstData.recvFirstData[e];t&&r&&(""===t.pubStatus.audio.consumerId&&(r.recvFirstAudioFrame=r.recvFirstAudioPackage=!1,this.statsCatch.downAudioCache[e]=null),""===t.pubStatus.audioSlave.consumerId&&(this.statsCatch.downAudioSlaveCache[e]=null),""===t.pubStatus.video.consumerId&&(r.recvFirstVideoFrame=r.recvFirstVideoPackage=!1,this.statsCatch.downVideoCache[e]=null),""===t.pubStatus.screen.consumerId&&(r.recvFirstScreenFrame=r.recvFirstScreenPackage=!1,this.statsCatch.downScreenCache[e]=null))}formatTransportData(e,t){let r;"send"===t?(this.adapterRef.transportStats.rxRtt=e.googRtt-0,this.adapterRef.transportStats.txRtt=e.googRtt-0,this.adapterRef.sessionStats.SendBytes=e.bytesSent-0,this.statsCatch.upTransportCache&&(r=this.statsCatch.upTransportCache),this.statsCatch.upTransportCache=e,r&&(this.adapterRef.sessionStats.SendBitrate=Math.round(8*(e.bytesSent-r.bytesSent)/1e3))):(this.adapterRef.sessionStats.RecvBytes=e.bytesReceived-0,this.statsCatch.downTransportCache&&(r=this.statsCatch.downTransportCache),this.statsCatch.downTransportCache=e,r&&(this.adapterRef.sessionStats.RecvBitrate=Math.round(8*(e.bytesReceived-r.bytesReceived)/1e3)))}formatSendData(e,t){var r,n,i,o,s,a,c,u;let l;if("audio"===t){if(!(null===(n=null===(r=null==this?void 0:this.adapterRef)||void 0===r?void 0:r._mediasoup)||void 0===n?void 0:n._micProducer))return this.firstData.sendFirstAudioPackage=!1,void(this.statsCatch.upAudioCache={});e.packetsSent>0&&!this.firstData.sendFirstAudioPackage&&(this.firstData.sendFirstAudioPackage=!0,this.adapterRef.instance.apiEventReport("setSendFirstPackage",{media_type:0})),this.statsCatch.upAudioCache&&(l=this.statsCatch.upAudioCache),this.statsCatch.upAudioCache=e}else if("audioSlave"===t){if(!(null===(o=null===(i=null==this?void 0:this.adapterRef)||void 0===i?void 0:i._mediasoup)||void 0===o?void 0:o._audioSlaveProducer))return void(this.statsCatch.upAudioSlaveCache={});this.statsCatch.upAudioSlaveCache&&(l=this.statsCatch.upAudioSlaveCache),this.statsCatch.upAudioSlaveCache=e,this.dispatchExceptionEventSendAudio(l,e)}else if("video"===t){if(!(null===(a=null===(s=null==this?void 0:this.adapterRef)||void 0===s?void 0:s._mediasoup)||void 0===a?void 0:a._webcamProducer))return this.firstData.sendFirstVideoPackage=!1,void(this.statsCatch.upVideoCache={});e.packetsSent>0&&!this.firstData.sendFirstVideoPackage&&(this.firstData.sendFirstVideoPackage=!0,this.adapterRef.instance.apiEventReport("setSendFirstPackage",{media_type:1})),this.statsCatch.upVideoCache&&(l=this.statsCatch.upVideoCache),this.statsCatch.upVideoCache=e,this.dispatchExceptionEventSendVideo(l,e)}else if("screen"===t){if(!(null===(u=null===(c=null==this?void 0:this.adapterRef)||void 0===c?void 0:c._mediasoup)||void 0===u?void 0:u._screenProducer))return this.firstData.sendFirstScreenPackage=!1,void(this.statsCatch.upScreenCache={});e.packetsSent>0&&!this.firstData.sendFirstScreenPackage&&(this.firstData.sendFirstScreenPackage=!0,this.adapterRef.instance.apiEventReport("setSendFirstPackage",{media_type:2})),this.statsCatch.upScreenCache&&(l=this.statsCatch.upScreenCache),this.statsCatch.upScreenCache=e}if(e.bitsSentPerSecond=Math.round(8*(e.bytesSent-(l.bytesSent||0))/1e3),e.packetsSentPerSecond=e.packetsSent-(l.packetsSent||0),void 0!==e.packetsLost&&(e.packetsLostRate=this.getPacketLossRate(l,e,!0)),e.streamType){e.framesEncoded>=l.framesEncoded?e.framesEncodedPerSecond=e.framesEncoded-l.framesEncoded:e.framesEncodedPerSecond=0,e.qpPercentage=this.getQpPercentage(l,e),e.frameRateSent||(e.frameRateSent=e.framesSent-l.framesSent);let r={freezeTime:0,totalFreezeTime:0};"video"===t?r=this.getLocalVideoFreezeStats(e):"screen"===t&&(r=this.getLocalScreenFreezeStats(e)),e.freezeTime=r.freezeTime,e.totalFreezeTime=r.totalFreezeTime}}formatRecvData(e,t){let r;const n=e.remoteuid||0;if(this.clearFirstRecvData(n),this.firstData.recvFirstData[n]||(this.firstData.recvFirstData[n]={recvFirstAudioFrame:!1,recvFirstVideoFrame:!1,recvFirstScreenFrame:!1,recvFirstAudioPackage:!1,recvFirstVideoPackage:!1,recvFirstScreenPackage:!1}),"audio"===t?(!this.firstData.recvFirstData[n].recvFirstAudioPackage&&e.packetsReceived>0&&(this.firstData.recvFirstData[n].recvFirstAudioPackage=!0,this.adapterRef.instance.apiEventReport("setRecvFirstPackage",{media_type:0,pull_uid:n})),e.decodingNormal&&e.decodingNormal>0&&!this.firstData.recvFirstData[n].recvFirstAudioFrame&&(this.firstData.recvFirstData[n].recvFirstAudioFrame=!0,this.adapterRef.instance.apiEventReport("setRecvFirstFrame",{media_type:0,pull_uid:n})),this.statsCatch.downAudioCache&&(r=this.statsCatch.downAudioCache[n]),this.statsCatch.downAudioCache[n]=e,this.dispatchExceptionEventRecvAudio(r,e,n)):"audioSlave"===t?(this.statsCatch.downAudioSlaveCache&&(r=this.statsCatch.downAudioSlaveCache[n]),this.statsCatch.downAudioSlaveCache[n]=e):"video"===t?(!this.firstData.recvFirstData[n].recvFirstVideoPackage&&e.packetsReceived>0&&(this.firstData.recvFirstData[n].recvFirstVideoPackage=!0,this.adapterRef.instance.apiEventReport("setRecvFirstPackage",{media_type:1,pull_uid:n})),!this.firstData.recvFirstData[n].recvFirstVideoFrame&&e.framesDecoded>0&&(this.firstData.recvFirstData[n].recvFirstVideoFrame=!0,this.adapterRef.instance.apiEventReport("setRecvFirstFrame",{media_type:1,pull_uid:n})),this.statsCatch.downVideoCache&&(r=this.statsCatch.downVideoCache[n]),this.statsCatch.downVideoCache[n]=e,this.dispatchExceptionEventRecvVideo(r,e,n)):"screen"===t&&(!this.firstData.recvFirstData[n].recvFirstScreenPackage&&e.packetsReceived>0&&(this.firstData.recvFirstData[n].recvFirstScreenPackage=!0,this.adapterRef.instance.apiEventReport("setRecvFirstPackage",{media_type:2,pull_uid:n})),!this.firstData.recvFirstData[n].recvFirstScreenFrame&&e.framesDecoded>0&&(this.firstData.recvFirstData[n].recvFirstScreenFrame=!0,this.adapterRef.instance.apiEventReport("setRecvFirstFrame",{media_type:2,pull_uid:n})),this.statsCatch.downScreenCache&&(r=this.statsCatch.downScreenCache[n]),this.statsCatch.downScreenCache[n]=e,this.dispatchExceptionEventRecvScreen(r,e,n)),!r||e.bytesReceived<r.bytesReceived)return;let i={freezeTime:0,totalFreezeTime:0};e.bitsReceivedPerSecond=Math.round(8*(e.bytesReceived-r.bytesReceived)/1e3),e.packetsReceivedPerSecond=e.packetsReceived-r.packetsReceived,void 0!==e.packetsLost&&(e.packetsLostRate=this.getPacketLossRate(r,e)),"video"===t||"screen"===t?(e.frameRateReceived||(e.frameRateReceived=e.framesReceived-r.framesReceived),e.frameRateDecoded||(e.frameRateDecoded=e.framesDecoded-r.framesDecoded),"video"===t?i=this.getRemoteVideoFreezeStats(r,e,n):"screen"===t&&(i=this.getRemoteScreenFreezeStats(r,e,n))):e.decodingCTN&&(i=this.getRemoteAudioFreezeStats(r,e,n)),e.freezeTime=i.freezeTime,e.totalFreezeTime=i.totalFreezeTime}getQpPercentage(e,t){if(!(e&&e.framesEncoded&&e.qpSum&&t&&t.framesEncoded&&t.qpSum))return 0;const r=t.qpSum-e.qpSum,n=t.framesEncoded-e.framesEncoded;return r<=0||n<=0?0:r>n?100:Math.round(r/n*100)}getPacketLossRate(e,t,r=!1){if(!e||!t)return 0;const n=parseInt(e.packetsLost)||0,i=parseInt(t.packetsLost)||0;if(i<=n)return 0;const o=r?e.packetsSent:e.packetsReceived,s=r?t.packetsSent:t.packetsReceived,a=parseInt(o||"")||0,c=parseInt(s||"")||0;return c<=a?0:r?Math.round((i-n)/(c-a)*100):Math.round((i-n)/(i-n+(c-a))*100)}getLocalVideoFreezeStats(e){let t=0;if(!e||!e.frameRateSent)return{totalFreezeTime:t,freezeTime:0};let r=0,n=parseInt(e.frameRateSent);if(n<=0)return{totalFreezeTime:2e3,freezeTime:6};if(n>15)return{totalFreezeTime:0,freezeTime:0};r=Math.abs(15-n),t=parseInt(2e3*r);let i=0;return t<300?(t=0,i=0):i=t>1500?6:parseInt(t/300),{totalFreezeTime:t,freezeTime:i}}getLocalScreenFreezeStats(e){let t=0;if(!e||!e.frameRateSent)return{totalFreezeTime:t,freezeTime:0};let r=parseInt(e.framesEncoded)||0,n=parseInt(e.framesSent)||0;if(r<=0||n<=0)return{totalFreezeTime:2e3,freezeTime:6};let i=Math.abs(r-n);t=parseInt(i/r*2e3);let o=0;return t<300?(t=0,o=0):o=t>1500?6:parseInt(t/300),{totalFreezeTime:t,freezeTime:o}}getRemoteAudioFreezeStats(e,t,r){if(!e||!t)return{totalFreezeTime:0,freezeTime:0};let n=parseInt(e.decodingPLC)+parseInt(e.decodingCNG)+parseInt(e.decodingPLCCNG),i=parseInt(e.decodingCTN),o=parseInt(e.decodingPLC)+parseInt(e.decodingCNG)+parseInt(e.decodingPLCCNG),s=parseInt(t.decodingCTN);if(s<=n)return{totalFreezeTime:0,freezeTime:0};let a=(o-n)/(s-i);return{totalFreezeTime:parseInt(1e3*a),freezeTime:10*a>1?parseInt(10*a):a>0?1:0}}getRemoteVideoFreezeStats(e,t,r){let n=0;if(!t||0==t.framesDecoded)return{totalFreezeTime:n,freezeTime:0};if(t&&t.framesDecoded&&0==t.frameRateDecoded)return{totalFreezeTime:2e3,freezeTime:6};let i=parseInt(t.frameRateReceived)||0,o=parseInt(t.frameRateDecoded);if(i<=0||o<=0)return{totalFreezeTime:2e3,freezeTime:6};let s=0;if(i>15)return{totalFreezeTime:0,freezeTime:0};s=Math.abs(15-i),n=parseInt(s/15*2e3),n>2e3&&(n=2e3);let a=0;return n<300?(n=0,a=0):a=n>1500?6:parseInt(n/300),{totalFreezeTime:n,freezeTime:a}}getRemoteScreenFreezeStats(e,t,r){let n=0;if(!t)return{totalFreezeTime:n,freezeTime:0};let i=parseInt(t.frameRateReceived),o=parseInt(t.frameRateDecoded);if(i<=0||o<=0)return{totalFreezeTime:2e3,freezeTime:6};let s=Math.abs(o-i);n=parseInt(s/i*2e3)||0;let a=0;return n<300?(n=0,a=0):a=n>1500?6:parseInt(n/300),{totalFreezeTime:n,freezeTime:a}}dispatchExceptionEventSendAudio(e,t){var r,n,i,o;if(!e||!t)return;const s=null===(r=this.adapterRef.localStream)||void 0===r?void 0:r.muteStatus.audio.send,a=null===(n=this.adapterRef.localStream)||void 0===n?void 0:n.pubStatus.audio.audio;!0!==s&&!1!==a&&(0===t.audioInputLevel&&this.adapterRef.instance.safeEmit("exception",{msg:"AUDIO_INPUT_LEVEL_TOO_LOW",code:2001,uid:(null===(i=this.adapterRef)||void 0===i?void 0:i.channelInfo.uid)||0}),0==parseInt(t.bytesSent)-parseInt(e.bytesSent)&&this.adapterRef.instance.safeEmit("exception",{msg:"SEND_AUDIO_BITRATE_TOO_LOW",code:2003,uid:(null===(o=this.adapterRef)||void 0===o?void 0:o.channelInfo.uid)||0}))}dispatchExceptionEventSendVideo(e,t){var r,n,i,o;if(!e||!t)return;const s=null===(r=this.adapterRef.localStream)||void 0===r?void 0:r.muteStatus.video.send,a=null===(n=this.adapterRef.localStream)||void 0===n?void 0:n.pubStatus.video.video;!0!==s&&!1!==a&&(t.frameRateInput&&parseInt(t.frameRateInput)>5&&parseInt(t.frameRateSent)<=1&&this.adapterRef.instance.safeEmit("exception",{msg:"FRAMERATE_SENT_TOO_LOW",code:1002,uid:(null===(i=this.adapterRef)||void 0===i?void 0:i.channelInfo.uid)||0}),0==parseInt(t.bytesSent)-parseInt(e.bytesSent)&&this.adapterRef.instance.safeEmit("exception",{msg:"FRAMERATE_VIDEO_BITRATE_TOO_LOW",code:1003,uid:(null===(o=this.adapterRef)||void 0===o?void 0:o.channelInfo.uid)||0}))}dispatchExceptionEventRecvAudio(e,t,r){if(!e||!t||!t.googDecodingNormal)return;const n=this.adapterRef.remoteStreamMap[r],i=n&&(n.muteStatus.audio.send||n.muteStatus.audio.recv);if(n&&i)return;if(!n||!n.Play||!n.Play.audio.dom||!n.Play.audio.dom.srcObject||n.Play.audio.dom.muted)return;let o=parseInt(t.bytesReceived)-parseInt(e.bytesReceived),s=parseInt(t.decodingNormal)-parseInt(e.decodingNormal);if(o>0&&0===s&&this.adapterRef.instance.safeEmit("exception",{msg:"RECV_AUDIO_DECODE_FAILED",code:2005,uid:r}),o>0&&s>0&&0==+(t.audioOutputLevel||t.audioLevel)){const e=n&&n.Play&&n.Play.audio.dom&&n.Play.audio.dom.volume;e&&e>0&&this.adapterRef.instance.safeEmit("exception",{msg:"AUDIO_OUTPUT_LEVEL_TOO_LOW",code:2002,uid:r})}}dispatchExceptionEventRecvVideo(e,t,r){if(!e||!t)return;const n=this.adapterRef.remoteStreamMap[r],i=n&&(n.muteStatus.video.send||n.muteStatus.video.recv);n&&i||parseInt(t.bytesReceived)-parseInt(e.bytesReceived)>0&&0===parseInt(t.frameRateDecoded)&&this.adapterRef.instance.safeEmit("exception",{msg:"RECV_VIDEO_DECODE_FAILED",code:1005,uid:r})}dispatchExceptionEventRecvScreen(e,t,r){if(!e||!t)return;const n=this.adapterRef.remoteStreamMap[r],i=n&&(n.muteStatus.screen.send||n.muteStatus.screen.recv);n&&i||parseInt(t.bytesReceived)-parseInt(e.bytesReceived)>0&&0===parseInt(t.frameRateDecoded)&&this.adapterRef.instance.safeEmit("exception",{msg:"RECV_SCREEN_DECODE_FAILED",code:1005,uid:r})}destroy(){this._reset()}}},function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;!function(){var root="object"==typeof window?window:{},NODE_JS=!root.JS_SHA1_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS&&(root=global);var COMMON_JS=!root.JS_SHA1_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__(269),HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[],createOutputMethod=function(e){return function(t){return new Sha1(!0).update(t)[e]()}},createMethod=function(){var e=createOutputMethod("hex");NODE_JS&&(e=nodeWrap(e)),e.create=function(){return new Sha1},e.update=function(t){return e.create().update(t)};for(var t=0;t<OUTPUT_TYPES.length;++t){var r=OUTPUT_TYPES[t];e[r]=createOutputMethod(r)}return e},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("sha1").update(e,"utf8").digest("hex");if(e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(void 0===e.length)return method(e);return crypto.createHash("sha1").update(new Buffer(e)).digest("hex")};return nodeMethod};function Sha1(e){e?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===root.ArrayBuffer&&(e=new Uint8Array(e));for(var r,n,i=0,o=e.length||0,s=this.blocks;i<o;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(n=this.start;i<o&&n<64;++i)s[n>>2]|=e[i]<<SHIFT[3&n++];else for(n=this.start;i<o&&n<64;++i)(r=e.charCodeAt(i))<128?s[n>>2]|=r<<SHIFT[3&n++]:r<2048?(s[n>>2]|=(192|r>>6)<<SHIFT[3&n++],s[n>>2]|=(128|63&r)<<SHIFT[3&n++]):r<55296||r>=57344?(s[n>>2]|=(224|r>>12)<<SHIFT[3&n++],s[n>>2]|=(128|r>>6&63)<<SHIFT[3&n++],s[n>>2]|=(128|63&r)<<SHIFT[3&n++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++i)),s[n>>2]|=(240|r>>18)<<SHIFT[3&n++],s[n>>2]|=(128|r>>12&63)<<SHIFT[3&n++],s[n>>2]|=(128|r>>6&63)<<SHIFT[3&n++],s[n>>2]|=(128|63&r)<<SHIFT[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=s[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha1.prototype.hash=function(){var e,t,r=this.h0,n=this.h1,i=this.h2,o=this.h3,s=this.h4,a=this.blocks;for(e=16;e<80;++e)t=a[e-3]^a[e-8]^a[e-14]^a[e-16],a[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)r=(t=(n=(t=(i=(t=(o=(t=(s=(t=r<<5|r>>>27)+(n&i|~n&o)+s+1518500249+a[e]<<0)<<5|s>>>27)+(r&(n=n<<30|n>>>2)|~r&i)+o+1518500249+a[e+1]<<0)<<5|o>>>27)+(s&(r=r<<30|r>>>2)|~s&n)+i+1518500249+a[e+2]<<0)<<5|i>>>27)+(o&(s=s<<30|s>>>2)|~o&r)+n+1518500249+a[e+3]<<0)<<5|n>>>27)+(i&(o=o<<30|o>>>2)|~i&s)+r+1518500249+a[e+4]<<0,i=i<<30|i>>>2;for(;e<40;e+=5)r=(t=(n=(t=(i=(t=(o=(t=(s=(t=r<<5|r>>>27)+(n^i^o)+s+1859775393+a[e]<<0)<<5|s>>>27)+(r^(n=n<<30|n>>>2)^i)+o+1859775393+a[e+1]<<0)<<5|o>>>27)+(s^(r=r<<30|r>>>2)^n)+i+1859775393+a[e+2]<<0)<<5|i>>>27)+(o^(s=s<<30|s>>>2)^r)+n+1859775393+a[e+3]<<0)<<5|n>>>27)+(i^(o=o<<30|o>>>2)^s)+r+1859775393+a[e+4]<<0,i=i<<30|i>>>2;for(;e<60;e+=5)r=(t=(n=(t=(i=(t=(o=(t=(s=(t=r<<5|r>>>27)+(n&i|n&o|i&o)+s-1894007588+a[e]<<0)<<5|s>>>27)+(r&(n=n<<30|n>>>2)|r&i|n&i)+o-1894007588+a[e+1]<<0)<<5|o>>>27)+(s&(r=r<<30|r>>>2)|s&n|r&n)+i-1894007588+a[e+2]<<0)<<5|i>>>27)+(o&(s=s<<30|s>>>2)|o&r|s&r)+n-1894007588+a[e+3]<<0)<<5|n>>>27)+(i&(o=o<<30|o>>>2)|i&s|o&s)+r-1894007588+a[e+4]<<0,i=i<<30|i>>>2;for(;e<80;e+=5)r=(t=(n=(t=(i=(t=(o=(t=(s=(t=r<<5|r>>>27)+(n^i^o)+s-899497514+a[e]<<0)<<5|s>>>27)+(r^(n=n<<30|n>>>2)^i)+o-899497514+a[e+1]<<0)<<5|o>>>27)+(s^(r=r<<30|r>>>2)^n)+i-899497514+a[e+2]<<0)<<5|i>>>27)+(o^(s=s<<30|s>>>2)^r)+n-899497514+a[e+3]<<0)<<5|n>>>27)+(i^(o=o<<30|o>>>2)^s)+r-899497514+a[e+4]<<0,i=i<<30|i>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+n<<0,this.h2=this.h2+i<<0,this.h3=this.h3+o<<0,this.h4=this.h4+s<<0},Sha1.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,i=this.h4;return HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,i=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,i>>24&255,i>>16&255,i>>8&255,255&i]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};var exports=createMethod();COMMON_JS?module.exports=exports:(root.sha1=exports,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()}).call(this,__webpack_require__(66),__webpack_require__(67))},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Signalling=void 0;const i=r(10),o=r(271),s=r(62),a=r(64),c=r(284),u=n(r(12)),l=n(r(13)),d=r(73),p=r(118),m=r(148),f=r(4),h=r(286),g=r(143),v=r(287);class y extends i.EventEmitter{constructor(e){super(),this._reconnectionTimer=null,this._protoo=null,this._url=null,this._resolve=null,this._reject=null,this.consumers={},this.keepAliveTimer=null,this._reconnectionTimeout=3e4,this.reconnectionControl={current:null,next:null,copynext:null,blocker:null,pausers:[],resumers:[]},this.autoMask={timer:null,data:[]},this.logger=e.logger.getChild((()=>{var t;let r="signal";return this._protoo?(this._protoo.id&&(r+="#"+this._protoo.id+"_"+(null===(t=this._protoo._transport)||void 0===t?void 0:t.wsid)),this._protoo.connected||(r+="!connected")):r+=" PROTOO_UNINIT",e.adapterRef._signalling!==this&&(r+=" DETACHED"),r})),this._reset(),this.adapterRef=e.adapterRef,this.browserDevice=p.getOSInfo().osName+"-"+p.getBrowserInfo().browserName+"-"+p.getBrowserInfo().browserVersion}async _reset(){this._reconnectionTimer&&clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null,this._destroyProtoo(),this.reconnectionControl.current=null,this.reconnectionControl.next=null,this.reconnectionControl.copynext=null,this._reconnectionTimeout=3e4,this._resolve=null,this._reject=null}init(e,t){return this._reconnectionTimer?Promise.resolve():new Promise(((r,n)=>{e||(this._resolve=r),e||(this._reject=n);const i=this.reconnectionControl.next||{timeout:t?f.getParameters().reconnectionFirstTimeout:0,url:this.adapterRef.channelInfo.wssArr[0],serverIndex:0,times:t?1:0,isJoinRetry:e,isReconnection:t};this.adapterRef.channelInfo.wssArrIndex=i.serverIndex,e?t?this.adapterRef.logger.error(`Signalling 开始尝试第 ${i.serverIndex+1}/${this.adapterRef.channelInfo.wssArr.length} 台服务器的第 ${i.times}/${f.getParameters().reconnectionMaxRetry} 次重连，退避时间：${i.timeout}毫秒，服务器地址：${i.url}`):this.adapterRef.logger.error(`Join: 正在尝试第 ${i.serverIndex+1}/${this.adapterRef.channelInfo.wssArr.length} 台服务器的第 ${i.times}/${f.getParameters().joinMaxRetry} 次重连，退避时间：${i.timeout}毫秒，服务器地址：${i.url}`):this.adapterRef.logger.log(`Join: 正在尝试第 ${i.serverIndex+1} / ${this.adapterRef.channelInfo.wssArr.length} 个服务器的第 ${i.times} / ${f.getParameters().joinMaxRetry} 次连接`),this.reconnectionControl.current=i,this.reconnectionControl.next=null,this._init(i.url);let o=Object.assign({},i);i.times?o.serverIndex++:(o.times=1,o.serverIndex=1),o.serverIndex>=this.adapterRef.channelInfo.wssArr.length&&(o.times++,o.serverIndex=0),e?o.timeout=f.getParameters().joinFirstTimeout+2e3*(o.times-1):t&&(o.timeout=f.getParameters().reconnectionFirstTimeout+2e3*(o.times-1)),o.timeout=2e3*o.times,o.isJoinRetry=e,o.isReconnection=t,o.url=this.adapterRef.channelInfo.wssArr[o.serverIndex],this.reconnectionControl.next=this.reconnectionControl.copynext=o,this._reconnectionTimer&&clearTimeout(this._reconnectionTimer),this._reconnectionTimer=setTimeout((()=>{this._reconnectionTimer&&clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null,this._destroyProtoo(),t?(this.adapterRef.instance.safeEmit("@pairing-websocket-reconnection-error"),this._reconnection()):this._connection()}),o.timeout)}))}async _connection(){this._destroyProtoo();const e=this.reconnectionControl.current,t=this.reconnectionControl.next;t?!e||t.times<=f.getParameters().joinMaxRetry?this.init(!0,!1):(this.adapterRef.logger.error("join() 所有的服务器地址都连接失败, 主动离开房间"),this.adapterRef.instance.apiEventReport("setStreamException",{name:"socketError",value:"signalling server connection failed(timeout)"}),this.adapterRef.channelInfo.wssArrIndex=0,this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=u.default.SIGNAL_CONNECTION_DISCONNECTED,this.adapterRef.instance.leave(),this.adapterRef.instance.safeEmit("error","SOCKET_ERROR"),this._reject&&this._reject(new l.default({code:u.default.NETWORK_ERROR,message:"join() 所有的服务器地址都连接失败"}))):this.adapterRef.logger.error("Join结束")}async _reconnection(){if(!this._reconnectionTimer){this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="CONNECTING",this.adapterRef.connectState.reconnect=!0,this.adapterRef.connectState.prevState!==this.adapterRef.connectState.curState&&this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef.instance.safeEmit("@pairing-websocket-reconnection-start"),this._destroyProtoo(),"CONNECTED"===this.adapterRef.connectState.prevState&&(this.adapterRef.netStatusList.forEach((e=>{e.uplinkNetworkQuality=0,e.downlinkNetworkQuality=0})),this.adapterRef.instance.safeEmit("network-quality",this.adapterRef.netStatusList)),this.reconnectionControl.pausers.length&&(this.logger.log("重连过程暂停"),this.reconnectionControl.pausers.forEach((e=>e({reason:"reconnection-start"}))),this.reconnectionControl.pausers=[],await new Promise((e=>{this.reconnectionControl.blocker=e})));for(let e in this.adapterRef.remoteStreamMap){const t=this.adapterRef.remoteStreamMap[e];t._play&&(this.logger.warn("Destroy Remote Player",e),t._play.destroy())}this.reconnectionControl.next&&this.reconnectionControl.next.times>f.getParameters().reconnectionMaxRetry?(this.adapterRef.instance.safeEmit("@pairing-websocket-reconnection-skip"),this.adapterRef.logger.error("所有的服务器地址都连接失败, 主动离开房间"),this.adapterRef.instance.apiEventReport("setStreamException",{name:"socketError",value:"signalling server reconnection failed(timeout)"}),this.adapterRef.channelInfo.wssArrIndex=0,this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=u.default.SIGNAL_CONNECTION_DISCONNECTED,this.adapterRef.instance.leave(),this.adapterRef.instance.safeEmit("error","SOCKET_ERROR")):this.init(!0,!0)}}_init(e){-1===e.indexOf("?")&&(e+="?"),this.logger.log("Signalling: init url=",e),this.adapterRef.channelInfo._protooUrl=e,this._url=`${-1===e.indexOf("://")?"wss://":""}${e}&cid=${this.adapterRef.channelInfo.cid}&uid=${this.adapterRef.channelInfo.uid}&deviceid=${this.adapterRef.deviceId}`,this.logger.log("连接的url: ",this._url);const t=new v.WebSocketTransport(this._url,{retry:{retries:0,factor:2,minTimeout:1e3,maxTimeout:2e3,forever:!1,maxRetryTime:2e3}});this._protoo=new v.Peer(t),this.adapterRef.state.signalEstablishTime=Date.now(),this._bindEvent()}_bindEvent(){var e,t,r,n,i;null===(e=this._protoo)||void 0===e||e.on("open",this.join.bind(this)),null===(t=this._protoo)||void 0===t||t.on("failed",this._handleFailed.bind(this)),null===(r=this._protoo)||void 0===r||r.on("notification",this._handleMessage.bind(this)),null===(n=this._protoo)||void 0===n||n.on("close",this._handleClose.bind(this)),null===(i=this._protoo)||void 0===i||i.on("disconnected",this._handleDisconnected.bind(this,this._protoo))}_destroyProtoo(){var e;if(this._protoo){this.logger.debug(`信令通道#${this._protoo.id}_${null===(e=this._protoo._transport)||void 0===e?void 0:e.wsid} 被主动关闭。`),this._protoo.removeAllListeners();try{this._protoo&&this._protoo.close()}catch(e){}this._protoo=null}}async _handleMessage(e){var t,r,n,i,s,a,c;switch(e.method){case"OnPeerJoin":{const{requestId:t,externData:r}=e.data;this.logger.log("收到OnPeerJoin成员加入消息 uid =",r.uid);let n=r.uid;"string"===this.adapterRef.channelInfo.uidType&&(n=n.toString());let i=this.adapterRef.remoteStreamMap[n];i?i.active=!0:(i=new o.RemoteStream({uid:n,audio:!1,audioSlave:!1,video:!1,screen:!1,client:this.adapterRef.instance,platformType:r.platformType}),this.adapterRef.remoteStreamMap[n]=i,this.adapterRef.memberMap[n]=n),this.adapterRef.instance._roleInfo.audienceList[n]=!1,this.adapterRef.instance.safeEmit("peer-online",{uid:n}),r.customData&&this.adapterRef.instance.safeEmit("custom-data",{uid:n,customData:r.customData});break}case"OnPeerLeave":{const{requestId:t,externData:r}=e.data;this.logger.log("OnPeerLeave externData =",r),r.userList&&r.userList.forEach((e=>{var t;let r=e.uid;"string"===this.adapterRef.channelInfo.uidType&&(r=r.toString()),null===(t=this.adapterRef._mediasoup)||void 0===t||t.removeUselessConsumeRequest({uid:r}),this.adapterRef.instance.clearMember(r),this.adapterRef.instance.removeSsrc(r),delete this.adapterRef.instance._roleInfo.audienceList[r]}));break}case"OnNewProducer":{const{requestId:n,externData:i}=e.data;this.logger.log("收到OnNewProducer发布消息 externData =",JSON.stringify(i.producerInfo));let s,{uid:a,producerId:c,mediaType:u,mute:l,simulcastEnable:d}=i.producerInfo;switch("string"===this.adapterRef.channelInfo.uidType&&(a=a.toString()),u){case"video":s="video";break;case"screenShare":s="screen";break;case"audio":s="audio";break;case"subAudio":s="audioSlave";break;default:return void this.logger.warn(`OnNewProducer 不支持的媒体类型:${u}, uid ${a}`)}let p=this.adapterRef.remoteStreamMap[a];p?p.active=!0:(p=new o.RemoteStream({uid:a,audio:"audio"===s,audioSlave:"audioSlave"===s,video:"video"===s,screen:"screen"===s,client:this.adapterRef.instance,platformType:i.platformType}),this.adapterRef.remoteStreamMap[a]=p,this.adapterRef.memberMap[a]=a),p.muteStatus[s].send=i.producerInfo.mute,p.pubStatus[s].consumerId?null===(t=this.adapterRef._mediasoup)||void 0===t||t.destroyConsumer(p.pubStatus[s].consumerId,p,s):null===(r=this.adapterRef._mediasoup)||void 0===r||r.removeUselessConsumeRequest({producerId:p.pubStatus[s].producerId,uid:a}),p[s]=!0,p.pubStatus[s][s]=!0,p.pubStatus[s].producerId=c,p.pubStatus[s].mute=l,p.pubStatus[s].simulcastEnable=d,p.pubStatus[s].consumerId="",this.adapterRef._enableRts&&this.adapterRef._rtsTransport?this.adapterRef.instance.emit("rts-stream-added",{stream:p,kind:u}):this.adapterRef.instance.safeEmit("stream-added",{stream:p,mediaType:s}),l&&("audioSlave"===s?this.adapterRef.instance.safeEmit("mute-audio-slave",{uid:p.getId()}):this.adapterRef.instance.safeEmit("mute-"+s,{uid:p.getId()}));break}case"OnProducerClose":{const{requestId:t,code:r,errMsg:o,externData:s}=e.data;let{uid:a,producerId:c,mediaType:u,cid:l}=s;"string"===this.adapterRef.channelInfo.uidType&&(a=a.toString());let p,m=this.adapterRef.remoteStreamMap[a];if(!m)return void this.logger.warn(`收到OnProducerClose消息，但是当前没有该Producer： code = ${r}, errMsg = ${o}, uid = ${a}, mediaType = ${u}, producerId: ${c}`);switch(this.logger.log(`收到OnProducerClose消息 code = ${r}, errMsg = ${o}, uid = ${a}, mediaType = ${u}, producerId: ${c}`),u){case"video":p="video";break;case"screenShare":p="screen";break;case"audio":p="audio";break;case"subAudio":p="audioSlave";break;default:return void this.logger.warn(`OnProducerClose 不支持的媒体类型 ${u} ${a}`)}if(m.pubStatus[p].producerId!==c)return void this.logger.log("该 producerId 已经无效，不处理");null===(n=this.adapterRef._mediasoup)||void 0===n||n.removeUselessConsumeRequest({producerId:c,uid:a}),m.pubStatus[p].consumerId&&(null===(i=this.adapterRef._mediasoup)||void 0===i||i.destroyConsumer(m.pubStatus[p].consumerId,m,p),m.pubStatus[p].consumerId=""),this.adapterRef.instance.removeSsrc(a,p),m.subStatus[p]=!1,m.pubStatus[p][p]=!1,m[p]=!1,m.pubStatus[p].consumerId="",m.pubStatus[p].producerId="","audio"===p?(m.mediaHelper.audio.micTrack=null,d.emptyStreamWith(m.mediaHelper.audio.audioStream,null)):"audioSlave"===p?(m.mediaHelper.screenAudio.screenAudioTrack=null,d.emptyStreamWith(m.mediaHelper.screenAudio.screenAudioStream,null)):"video"===p?(m.mediaHelper.video.cameraTrack=null,d.emptyStreamWith(m.mediaHelper.video.videoStream,null)):"screen"===p&&(m.mediaHelper.screen.screenVideoTrack=null,d.emptyStreamWith(m.mediaHelper.screen.screenVideoStream,null)),this.adapterRef._enableRts?this.adapterRef.instance.emit("rts-stream-removed",{stream:m}):this.adapterRef.instance.safeEmit("stream-removed",{stream:m,mediaType:p});break}case"OnConsumerClose":{const{requestId:t,code:r,errMsg:n,consumerId:i,producerId:o}=e.data;this.logger.log(`chence OnConsumerClose code = ${r} errMsg = ${n} producerId = ${o}`);const s=this.consumers[i];if(!s)break;s.close();break}case"consumerPaused":{const{consumerId:t}=e.data;if(!this.consumers[t])break;break}case"consumerResumed":case"consumerScore":break;case"OnTransportClose":{const{requestId:t,code:r,errMsg:n,transportId:i}=e.data;this.logger.warn(`chence OnTransportClose: code = ${r}, errMsg = ${n}, transportId = ${i}`),(null===(s=this.adapterRef._mediasoup)||void 0===s?void 0:s._sendTransport)||(null===(a=this.adapterRef._mediasoup)||void 0===a?void 0:a._recvTransport)?(this.logger.warn("服务器媒体进程crash，上行媒体和下行媒体同时重连"),this.adapterRef.channelStatus="connectioning",this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"OnTransportClose",ext:""}),this._reconnection()):this.logger.warn("服务器发送了错误信息");break}case"OnSignalRestart":{const{requestId:t,code:r,errMsg:n}=e.data;this.logger.warn(`chence OnSignalRestart code = ${r} errMsg = ${n}`),this.logger.warn("服务器信令进程crash，重连"),this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"OnSignalRestart",ext:""}),(null===(c=this._protoo)||void 0===c?void 0:c.connected)&&"CONNECTED"===this.adapterRef.connectState.curState||this._reconnection();break}case"OnPermKeyTimeout":this.adapterRef.instance.safeEmit("permkey-will-expire");break;case"OnPeerClose":this.logger.warn("相同UID在其他地方登录，您被提出房间"),this.adapterRef.instance.safeEmit("uid-duplicate"),this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=u.default.UID_DUPLICATE,this.adapterRef.instance.leave();break;case"OnKickOff":{let{msg:t,reason:r}=e.data.externData;this._handleKickedNotify(r);break}case"OnUserData":{let{type:t,data:r}=e.data.externData;if("StreamStatus"===t)this._handleStreamStatusNotify(r);else if("NetStatus"===t)this._handleNetStatusNotify(r);else if("Mute"===t)this.logger.log("mute变更: ",JSON.stringify(r,null,"")),this._handleMuteNotify(r);else if("UserRole"===t)this.logger.log("UserRole变更: ",JSON.stringify(r,null,"")),this._handleUserRoleNotify(e.data.externData);else if("RtmpTaskStatus"===t)this.logger.log("RtmpTaskStatus变更: ",JSON.stringify(r,null,"")),this.adapterRef.instance.safeEmit("rtmp-state",r);else if("AutoMaskUid"===t){const e=r;this.logger.log("收到打码通知：",e.maskUid,"时长",e.duration,"秒"),e.maskUid&&e.duration&&(e.targetEndMs=Date.now()+1e3*e.duration,this.autoMask.data.push(e),this.updateMaskStatus())}else if("MediaCapability"===t){if(this.logger.warn("MediaCapability房间能力变更: ",JSON.stringify(r,null,"")),this.adapterRef.mediaCapability.parseRoom(r),this.adapterRef.instance.safeEmit("@mediaCapabilityChange"),this.adapterRef._mediasoup&&this.adapterRef.mediaCapability.room.videoCodecType&&this.adapterRef.localStream){const e=this.adapterRef.mediaCapability.getCodecSend("video",this.adapterRef._mediasoup._sendTransport.handler._sendingRtpParametersByKind.video),t=this.adapterRef.mediaCapability.getCodecSend("screen",this.adapterRef._mediasoup._sendTransport.handler._sendingRtpParametersByKind.video),r=this.adapterRef._mediasoup._webcamProducerCodec&&this.adapterRef._mediasoup._webcamProducerCodec!==e.codecName;r&&this.logger.warn("将视频的Codec切走：",this.adapterRef._mediasoup._webcamProducerCodec,"=>",e.codecName);const n=this.adapterRef._mediasoup._screenProducerCodec&&this.adapterRef._mediasoup._screenProducerCodec!==e.codecName;n&&this.logger.error("将辅流的Codec切走：",this.adapterRef._mediasoup._screenProducerCodec,"=>",t.codecName),r||n?this._protoo&&this._protoo._transport&&this._protoo._transport._ws&&this._protoo._transport._ws.close():this.logger.log("Codec保持不动。video:",this.adapterRef._mediasoup._webcamProducerCodec,", screen:",this.adapterRef._mediasoup._screenProducerCodec)}}else if("Ability"===t)this._handleAbility(e.data.externData.data);else if("ChangeRight"===t){let e=r.uid;if(1===r.audioRight?(this.adapterRef.isAudioBanned=!0,this.adapterRef.instance.safeEmit("audioVideoBanned",{uid:e,mediaType:"audio",state:!0,duration:r.audioDuration})):2===r.audioRight&&(this.adapterRef.isAudioBanned=!1,this.adapterRef.instance.safeEmit("audioVideoBanned",{uid:e,mediaType:"audio",state:!1,duration:r.audioDuration})),1===r.videoRight?(this.adapterRef.isVideoBanned=!0,this.adapterRef.instance.safeEmit("audioVideoBanned",{uid:e,mediaType:"video",state:!0,duration:r.videoDuration})):2===r.videoRight&&(this.adapterRef.isVideoBanned=!1,this.adapterRef.isVideoBanned=!0,this.adapterRef.instance.safeEmit("audioVideoBanned",{uid:e,mediaType:"video",state:!1,duration:r.videoDuration})),this.adapterRef.isAudioBanned&&this.adapterRef.isVideoBanned&&this.adapterRef.instance.apiEventReport("setAudioVideoBanned",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!0,isVideoBanned:!0}),!this.adapterRef.isAudioBanned&&this.adapterRef.isVideoBanned&&this.adapterRef.instance.apiEventReport("setAudioVideoBanned",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!1,isVideoBanned:!0}),this.adapterRef.isAudioBanned&&!this.adapterRef.isVideoBanned&&this.adapterRef.instance.apiEventReport("setAudioVideoBanned",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!0,isVideoBanned:!1}),this.adapterRef.isAudioBanned||this.adapterRef.isVideoBanned||this.adapterRef.instance.apiEventReport("setAudioVideoBanned",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!1,isVideoBanned:!1}),!this.adapterRef.localStream)return}else this.logger.error(`收到OnUserData通知消息 type = ${t}, data: `,r)}}}_handleFailed(){this.logger.log("Signalling:_handleFailed")}_handleClose(){}_handleDisconnected(e){var t,r,n,i;this.logger.log("Signalling:_handleDisconnected"),!this._reconnectionTimer||"connectioning"!==this.adapterRef.channelStatus&&"join"!==this.adapterRef.channelStatus?(this.logger.warn(`信令通道#${e.id}_${null===(i=e._transport)||void 0===i?void 0:i.wsid} 收到关闭信号，即将开始重连过程。`),this.adapterRef.channelStatus="connectioning",this._reconnection()):e.closed?this.logger.warn(`信令通道#${e.id}_${null===(t=e._transport)||void 0===t?void 0:t.wsid} 在建立过程中被关闭。当前正在重连中，等待下次重连过程。`):this.logger.warn(`信令通道#${e.id}_${null===(r=e._transport)||void 0===r?void 0:r.wsid} 在建立过程中被关闭。信令通道会自动重试。连接地址：${null===(n=e._transport)||void 0===n?void 0:n._url}`),this.adapterRef.instance.apiEventReport("setDisconnect",{reason:"websocketDisconnect",ext:""})}async join(){var e,t;let r;this.adapterRef.state.signalOpenTime=Date.now(),r=!!this.adapterRef.encryption.encryptionSecret&&"none"!==this.adapterRef.encryption.encryptionMode;const n={method:"Join",permKeySecret:this.adapterRef.channelInfo.permKey,requestId:""+Math.ceil(1e9*Math.random()),supportStdRed:!0,supportTurn:!this.adapterRef.proxyServer.enable,externData:{userName:""+this.adapterRef.channelInfo.uid,token:this.adapterRef.channelInfo.token,cname:""+this.adapterRef.channelInfo.channelName,subType:"select",role:"part",version:"2.0",sessionMode:"meeting",engineVersion:s.ENGINE_VERSION,userRole:this.adapterRef.instance._roleInfo.userRole,userType:3,platformType:16,rtmp:{support:this.adapterRef.channelInfo.sessionConfig.liveEnable},record:{host:this.adapterRef.channelInfo.sessionConfig.isHostSpeaker,supportVideo:this.adapterRef.channelInfo.sessionConfig.recordVideo,supportAuido:this.adapterRef.channelInfo.sessionConfig.recordAudio,recordType:this.adapterRef.channelInfo.sessionConfig.recordType-0},mediaCapabilitySet:this.adapterRef.mediaCapability.stringify(),browser:{name:p.getBrowserInfo().browserName,version:""+p.getBrowserInfo().browserVersion},customData:this.adapterRef.channelInfo.customData||"",gmEnable:r,gmMode:m.encryptionModeToInt(this.adapterRef.encryption.encryptionMode),gmKey:this.adapterRef.encryption.encryptionSecret,customEncryption:!f.getParameters().forceCustomEncryptionOff&&this.adapterRef.encryption.encodedInsertableStreams,userPriority:this.adapterRef.userPriority}};this.logger.log("Signalling: socket连接成功，开始发送Join请求"),null===(e=this._protoo)||void 0===e||e.clear();try{let r=null,i=this._protoo;try{r=await(null===(t=this._protoo)||void 0===t?void 0:t.request("Join",n)),this.adapterRef.state.signalJoinResTime=Date.now()}catch(e){if(i!==this._protoo)return void this.logger.warn(`Login 过期的信令通道消息：【${e.name}】`,e.message);throw this.logger.warn("Login request error: ",e.message),new l.default({code:u.default.LOGIN_REQUEST_ERROR,message:e.message})}if(this.logger.log("Signalling:Join请求收到response"),200!=r.code){let e="Unknown Error";return r.externData?e=r.externData.errMsg:r.errMsg&&(e=r.errMsg),this.logger.error(`Signalling: 加入房间失败, code = ${r.code}, reason = ${e}`),this.adapterRef.instance.safeEmit("@pairing-websocket-reconnection-error"),void this._joinFailed(r.code,e)}let s=this.adapterRef.channelInfo.uid;if(r.PermKey&&(this.adapterRef.permKeyInfo=r.PermKey),1===r.externData.audioRight?(this.adapterRef.isAudioBanned=!0,this.adapterRef.instance.safeEmit("audioVideoBanned",{uid:s,mediaType:"audio",state:!0})):this.adapterRef.isAudioBanned=!1,1===r.externData.videoRight?(this.adapterRef.isVideoBanned=!0,this.adapterRef.isAudioBanned=!0,this.adapterRef.instance.safeEmit("audioVideoBanned",{uid:s,mediaType:"audio",state:!0})):this.adapterRef.isVideoBanned=!1,this.adapterRef.instance.apiEventReport("setAudioVideoBanned",{name:"set_mediaRightChange",oper:"1",isAudioBanned:!!this.adapterRef.isAudioBanned,isVideoBanned:!!this.adapterRef.isVideoBanned}),this.adapterRef.isAudioBanned&&this.adapterRef.isVideoBanned&&this.logger.warn("服务器禁止发送音频流"),this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null),this.reconnectionControl.next=null,this.logger.log("Signalling: 加入房间成功"),this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="CONNECTED","no"===f.getParameters().forceBWE?r.preferRemb?(this.logger.log("服务端配置bwe：上行使用remb"),this.adapterRef.preferRemb=!0):(this.logger.log("服务端配置bwe：上行使用transport-cc"),this.adapterRef.preferRemb=!1):(this.adapterRef.preferRemb||r.preferRemb)&&"transport-cc"===f.getParameters().forceBWE?(this.logger.warn("强行使用transport-cc。忽略服务端配置bwe：preferRemb: "+r.preferRemb),this.adapterRef.preferRemb=!1):"remb"===f.getParameters().forceBWE&&(this.logger.warn("强行使用REMB。忽略服务端配置bwe：preferRemb: "+r.preferRemb),this.adapterRef.preferRemb=!0),this.adapterRef.audioAsl.enabled=r.supportWebAsl?"yes":"no",this.adapterRef.audioAsl.aslActiveNum=r.aslActiveNum,r.supportWebAsl?r.aslActiveNum?this.logger.log("aslActiveNum数量： "+r.aslActiveNum):this.logger.warn("服务端支持ASL但没有返回ASL数量"):this.logger.log("服务端未开启ASL"),this.adapterRef.instance.safeEmit("aslStatus",{enabled:!!r.supportWebAsl,aslActiveNum:r.aslActiveNum}),"connectioning"===this.adapterRef.channelStatus){if(this.adapterRef.connectState.reconnect=!0,this.logger.log("Signalling: 重连成功, 清除之前的媒体的通道"),this.adapterRef.channelStatus="join",this.adapterRef.instance.apiEventReport("setRelogin",{a_record:this.adapterRef.channelInfo.sessionConfig.recordAudio,v_record:this.adapterRef.channelInfo.sessionConfig.recordVideo,record_type:this.adapterRef.channelInfo.sessionConfig.recordType,host_speaker:this.adapterRef.channelInfo.sessionConfig.isHostSpeaker,permKey:this.adapterRef.channelInfo.permKey,result:0,reason:1,server_ip:this.adapterRef.channelInfo._protooUrl}),this.adapterRef.instance.resetChannel(),!this.adapterRef._mediasoup)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"signalling_join: 媒体服务异常 1"});this.adapterRef._mediasoup._edgeRtpCapabilities=r.edgeRtpCapabilities,this.adapterRef.mediaCapability.parseRoom(r.externData.roomCapability),this.adapterRef.instance.safeEmit("@mediaCapabilityChange"),await this.adapterRef._mediasoup.init(),this.adapterRef.localStream?this.adapterRef.localStream.audio||this.adapterRef.localStream.video||this.adapterRef.localStream.screen||this.adapterRef.localStream.screenAudio||f.getParameters().allowEmptyMedia||this.adapterRef.localStream.audioSlave?(this.logger.log(`重连成功，重新publish本端流: audio ${this.adapterRef.localStream.hasAudio()}, video ${this.adapterRef.localStream.hasVideo()}, screen ${this.adapterRef.localStream.hasScreen()}, audioSlave ${this.adapterRef.localStream.hasAudioSlave()}`),this.adapterRef.instance.doPublish(this.adapterRef.localStream)):this.logger.log("重连成功，当前没有媒体流，无需发布"):this.logger.log("重连成功，当前在未发布状态，无需发布")}else{this.adapterRef.connectState.reconnect=!1;const e=this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2,t=Date.now();if(this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.joinedSuccessedTime=t,this.adapterRef.instance.apiEventReport("setLogin",{a_record:this.adapterRef.channelInfo.sessionConfig.recordAudio,v_record:this.adapterRef.channelInfo.sessionConfig.recordVideo,record_type:this.adapterRef.channelInfo.sessionConfig.recordType,host_speaker:this.adapterRef.channelInfo.sessionConfig.isHostSpeaker,permKey:this.adapterRef.channelInfo.permKey,result:0,server_ip:this.adapterRef.channelInfo._protooUrl,signal_time_elapsed:e.startWssTime-e.startJoinTime,time_elapsed:t-e.startJoinTime,model:this.browserDevice}),!this.adapterRef._mediasoup)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"signalling_join: 媒体服务异常 2"});this.adapterRef._mediasoup._edgeRtpCapabilities=r.edgeRtpCapabilities,this.adapterRef.mediaCapability.parseRoom(r.externData.roomCapability),this.adapterRef.instance.safeEmit("@mediaCapabilityChange"),await this.adapterRef._mediasoup.init()}this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),this.adapterRef._enableRts&&(await this.createRTSTransport(),this.adapterRef.instance.emit("connected")),this.logger.log("Signalling: 查看房间其他人的发布信息: "+JSON.stringify(r.externData.userList));const a=[];if(void 0!==r.externData&&r.externData.userList&&r.externData.userList.length){let e=this;for(const t of r.externData.userList){let r=t.uid;"string"===this.adapterRef.channelInfo.uidType&&(r=r.toString());let n=this.adapterRef.remoteStreamMap[r];if(n?(n.active=!0,this.adapterRef.memberMap[r]=""+r,a.push({eventName:"peer-online",eventData:{uid:r}})):(n=new o.RemoteStream({uid:r,audio:!1,audioSlave:!1,video:!1,screen:!1,client:this.adapterRef.instance,platformType:t.platformType}),this.adapterRef.remoteStreamMap[r]=n,this.adapterRef.memberMap[r]=""+r,a.push({eventName:"peer-online",eventData:{uid:r}})),t.customData&&a.push({eventName:"custom-data",eventData:{uid:r,customData:t.customData}}),t.producerInfoList)for(const i of t.producerInfoList){const{mediaType:t,producerId:o,mute:s,simulcastEnable:c}=i;let u;switch(t){case"video":u="video";break;case"screenShare":u="screen";break;case"audio":u="audio";break;case"subAudio":u="audioSlave";break;default:this.logger.warn(`join: 不支持的媒体类型 ${t} ${r}`);continue}n[u]=!0,n.pubStatus[u][u]=!0,n.pubStatus[u].producerId=o,n.pubStatus[u].mute=s,n.muteStatus[u].send=s,n.pubStatus[u].simulcastEnable=c,e.logger.log(`Signalling: 通知 ${n.getId()} 发布信息: ${JSON.stringify(n.pubStatus,null,"")}`),e.adapterRef._enableRts&&e.adapterRef._rtsTransport?a.push({eventName:"rts-stream-added",eventData:{stream:n,kind:u}}):(n.pubStatus.audio.audio||n.pubStatus.video.video||n.pubStatus.screen.screen||n.pubStatus.audioSlave.audioSlave)&&a.push({eventName:"stream-added",eventData:{stream:n,mediaType:u}}),s&&("audioSlave"===u?a.push({eventName:"mute-audio-slave",eventData:{uid:n.getId()}}):a.push({eventName:"mute-"+u,eventData:{uid:n.getId()}}))}}for(let e in this.adapterRef.remoteStreamMap)this.adapterRef.remoteStreamMap[e].active||(this.logger.warn("重连期间远端流停止发布："+e),delete this.adapterRef.remoteStreamMap[e])}const c=this.adapterRef.instance;setTimeout((()=>{for(let e=0;e<a.length;e++){const t=a[e].eventName,r=a[e].eventData;c&&("stream-added"===t&&("audio"===r.mediaType?c.adapterRef.state.signalAudioAddedTime<c.adapterRef.state.signalOpenTime&&(c.adapterRef.state.signalAudioAddedTime=Date.now()):"video"===r.mediaType&&c.adapterRef.state.signalVideoAddedTime<c.adapterRef.state.signalOpenTime&&(c.adapterRef.state.signalVideoAddedTime=Date.now())),c.safeEmit(t,r))}}),0),this.adapterRef.state.signalJoinSuccessTime=Date.now(),this._resolve?(this.logger.log("加入房间成功, 反馈通知"),this._resolve(r),this._resolve=null,this._reject=null):(this.adapterRef.instance.safeEmit("@pairing-websocket-reconnection-success"),this.reconnectionControl.resumers.length&&(this.reconnectionControl.resumers.forEach((e=>e({reason:"reconnection-success"}))),this.reconnectionControl.resumers=[])),this.doSendKeepAliveTask()}catch(e){this.logger.error("Signalling: 登录流程内部错误: ",e.message),this._joinFailed(-1,e.message||"LOGIN_ERROR")}}_joinFailed(e,t){this.adapterRef.connectState.prevState=this.adapterRef.connectState.curState,this.adapterRef.connectState.curState="DISCONNECTED",this.adapterRef.connectState.reconnect=!1,this.adapterRef.channelStatus="init",this.adapterRef.instance.safeEmit("connection-state-change",this.adapterRef.connectState),4009===e&&this.adapterRef.instance.safeEmit("crypt-error",{cryptType:this.adapterRef.encryption.encryptionMode});const r=Date.now(),n=this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2;if(this.adapterRef.instance.apiEventReport("setLogin",{a_record:this.adapterRef.channelInfo.sessionConfig.recordAudio,v_record:this.adapterRef.channelInfo.sessionConfig.recordVideo,record_type:this.adapterRef.channelInfo.sessionConfig.recordType,host_speaker:this.adapterRef.channelInfo.sessionConfig.isHostSpeaker,permKey:this.adapterRef.channelInfo.permKey,result:e,server_ip:this.adapterRef.channelInfo._protooUrl,signal_time_elapsed:n.startWssTime-n.startJoinTime,time_elapsed:r-n.startJoinTime,model:this.browserDevice,desc:t||""}),this._reject)this.logger.error("加入房间失败, 反馈通知"),this._reject(new l.default({code:u.default.SERVER_AUTH_ERROR,extraCode:e,message:t||"join failed"})),this._resolve=null,this._reject=null,this.keepAliveTimer&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=null),this.adapterRef.channelStatus="leave",this.adapterRef.instance.stopSession();else{if("room not found"===t)this.logger.error("网络重连时，加入房间失败，主动离开。重连失败原因：",t,"，这通常是因为房间内其他人都已离开，房间关闭引起的");else this.logger.error("网络重连时，加入房间失败，主动离开。重连失败原因：",t);this.adapterRef.instance.safeEmit("error","RELOGIN_ERROR"),this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=u.default.LOGIN_FAILED,this.adapterRef.instance.leave()}}doSendKeepAliveTask(){this.keepAliveTimer&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=null),this.keepAliveTimer=setInterval((()=>{this.doSendKeepAlive()}),6e3)}async doSendKeepAlive(){var e,t;if(null===(e=this._protoo)||void 0===e?void 0:e.connected){this._protoo.id,null===(t=this._protoo._transport)||void 0===t||t.wsid;try{await this._protoo.request("Heartbeat")}catch(e){this.logger.error("信令包保活失败, reanson: "+e.message)}}}async createRTSTransport(){if(this.logger.log("createRTSTransport()"),!this._protoo)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"createRTSTransport: _protoo 未找到"});if(!this._url)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"createRTSTransport: _url 未找到"});try{const e=await this._protoo.request("CreateWsTrasnport");this.logger.warn("CreateWsTrasnport response: ",JSON.stringify(e,null,""));const{code:t,errMsg:r,transportId:n,wsPort:i="6666"}=e;200==t?(this.adapterRef._rtsTransport&&(this.logger.log("CreateWsTrasnport: 需要更新"),this.adapterRef._rtsTransport.destroy()),this.logger.log("CreateWsTrasnport: 开始创建"),this.adapterRef._rtsTransport=new h.RTSTransport({url:this._url.replace(/:\d+/,":"+i)+"&transportId="+n,transportId:n,port:i,adapterRef:this.adapterRef})):this.logger.error(`createWsTrasnport failed, code: ${t}, reason: ${r}`)}catch(e){throw this.logger.error("createRTSTransport failed:",e.name,e.message),e}}async rtsRequestKeyFrame(e){if(this.logger.log("rtsRequestKeyFrame(): ",e),!this._protoo)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"rtsRequestKeyFrame: _protoo 未找到"});if(!e)throw new l.default({code:u.default.UNKNOWN_TYPE_ERROR,message:"rtsRequestKeyFrame: consumerId 未找到"});try{const t=await this._protoo.request("RequestKeyFrame",{consumerId:e});this.logger.warn("rtsRequestKeyFrame response: ",t);let{code:r,errMsg:n}=t;200==r?this.logger.log("RTS 关键帧请求完成"):this.logger.error(`RTS 关键帧请求失败, code: ${r}, reason: ${n}`)}catch(e){throw this.logger.error("rtsRequestKeyFrame failed:",e),e}}async updatePermKey(e){var t;if(this.logger.log("updatePermKey newwork isConnect: ",null===(t=this._protoo)||void 0===t?void 0:t.connected),!this._protoo||!this._protoo.connected)return;const r=await this._protoo.request("PermKeyUpdate",{requestId:""+Math.ceil(1e9*Math.random()),permKeySecret:e});200!==r.code?new l.default({code:u.default.UPDATE_PERMKEY_ERROR,extraCode:r.code,message:"update permkey 认证错误"}):this.adapterRef.permKeyInfo=r.PermKey}updateMaskStatus(){var e,t,r;let n=Date.now();for(let r=this.autoMask.data.length-1;r>=0;r--){let i=this.autoMask.data[r];if(n>=i.targetEndMs){if(this.adapterRef.channelInfo.uid===i.maskUid&&this.adapterRef.localStream)this.logger.log("updateMaskStatus 本地用户去除打码",i.maskUid),null===(e=this.adapterRef.localStream._play)||void 0===e||e.disableMask();else{const e=this.adapterRef.remoteStreamMap[i.maskUid];e&&(null===(t=e._play)||void 0===t?void 0:t.mask.enabled)&&(this.logger.log("updateMaskStatus 远端用户去除打码",i.maskUid),e._play.disableMask())}this.autoMask.data.splice(r,1)}}let i=Number.MAX_SAFE_INTEGER;for(let e=0;e<this.autoMask.data.length;e++){let t=this.autoMask.data[e];if(i=Math.min(i,t.targetEndMs),this.adapterRef.channelInfo.uid==t.maskUid&&this.adapterRef.localStream)this.logger.log("updateMaskStatus 本地用户增加打码",t.maskUid),null===(r=this.adapterRef.localStream._play)||void 0===r||r.enableMask();else{const e=this.adapterRef.remoteStreamMap[t.maskUid];e?e._play&&!e._play.mask.enabled&&(this.logger.log("updateMaskStatus 远端用户增加打码",t.maskUid,"打码时长",t.duration,"秒"),e._play.enableMask()):this.logger.log("updateMaskStatus 远端用户不在频道中",t.maskUid,"打码时长",t.duration,"秒")}}this.autoMask.timer&&clearTimeout(this.autoMask.timer),this.autoMask.timer=setTimeout((()=>{this.updateMaskStatus()}),i-n)}async doSendLogout(){if(this.logger.log("doSendLogout() begin"),this.keepAliveTimer&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=null),!this._protoo||!this._protoo.connected)return;let e={requestId:""+Math.ceil(1e9*Math.random()),externData:{reason:0}};this._protoo.notify("Leave",e),this.logger.log("doSendLogout() success")}_handleStreamStatusNotify(e){}_handleNetStatusNotify(e){const t=e.netStatusList;let r=c.parseBase64(t).toString(),n=[],i=r.substr(2,2)+r.substr(0,2);i=parseInt(i,16),r=r.substr(4);for(let e=0;e<i;e++){let e=r.substr(0,16);e=o(e);const t=r.substr(16,2),i=r.substr(18,2);let s=0;if("00"!=r.substr(20,2)){const e=r.substr(22,2);s=parseInt(e,16),r.substr(24,s),s++}const a={uid:"string"===this.adapterRef.channelInfo.uidType?g.SimpleBig.fromHex(e).toString():parseInt(e,16),downlinkNetworkQuality:parseInt(t,16),uplinkNetworkQuality:parseInt(i,16),receiveTs:Date.now()};n.push(a),r=r.substr(22+s)}function o(e){let t=[];for(var r=e.length;r>=1;r-=2)t.push(e[r-2],e[r-1]);return t.join("")}let s=!0,a=[];n=n.filter((e=>0!=e.uid)),this.adapterRef.netStatusList.map((e=>{s=!0,n.map((t=>{e.uid!=t.uid&&0!=t.uid||(s=!1)})),s&&a.push(e)}));let u=a.concat(n);u=u.filter((e=>this.adapterRef.memberMap[e.uid]||e.uid==this.adapterRef.channelInfo.uid)),this.adapterRef.netStatusList=u,this.adapterRef.instance.safeEmit("network-quality",this.adapterRef.netStatusList)}_handleMuteNotify(e){const t=e.producerId,r=e.mute;Object.values(this.adapterRef.remoteStreamMap).forEach((e=>{a.MediaTypeList.forEach((n=>{e.pubStatus[n].producerId===t&&(e.muteStatus[n].send=r,r?"audioSlave"===n?this.adapterRef.instance.safeEmit("mute-audio-slave",{uid:e.getId()}):this.adapterRef.instance.safeEmit("mute-"+n,{uid:e.getId()}):"audioSlave"===n?this.adapterRef.instance.safeEmit("unmute-audio-slave",{uid:e.getId()}):this.adapterRef.instance.safeEmit("unmute-"+n,{uid:e.getId()}))}))}))}_handleUserRoleNotify(e){let t=e.uid;"string"===this.adapterRef.channelInfo.uidType&&(t=t.toString());const r=e.data&&e.data.userRole;if(this.logger.warn(`用户${t}角色变为${r?"观众":"主播"}`),t&&1===r&&(this.adapterRef.instance.clearMember(t),this.adapterRef.instance.removeSsrc(t),this.adapterRef.instance._roleInfo.audienceList[t]=!0),t&&0===r){this.adapterRef.instance.safeEmit("peer-online",{uid:t});let r=this.adapterRef.remoteStreamMap[t];r?r.active=!0:(r=new o.RemoteStream({uid:t,audio:!1,audioSlave:!1,video:!1,screen:!1,client:this.adapterRef.instance,platformType:e.platformType}),this.adapterRef.remoteStreamMap[t]=r,this.adapterRef.memberMap[t]=t),this.adapterRef.instance._roleInfo.audienceList[t]=!1}}_handleAbility(e){this.adapterRef.instance.safeEmit("warning",{code:e.code,msg:e.msg})}_handleKickedNotify(e,t=this.adapterRef.channelInfo.uid){"string"===this.adapterRef.channelInfo.uidType&&(t=t.toString()),1==e?(this.logger.warn("房间被关闭"),this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=u.default.CHANNEL_CLOSED,this.adapterRef.instance.leave(),this.adapterRef.instance.safeEmit("channel-closed",{})):2==e?(this.logger.warn(t+"被提出房间"),t.toString()==this.adapterRef.channelInfo.uid.toString()&&(this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=u.default.CLIENT_BANNED,this.adapterRef.instance.leave()),this.adapterRef.instance.safeEmit("client-banned",{uid:t})):5==e&&(this.logger.warn(t+" permKey 超时被提出房间"),t.toString()==this.adapterRef.channelInfo.uid.toString()&&(this.adapterRef.instance._params.JoinChannelRequestParam4WebRTC2.logoutReason=u.default.PERMKEY_TIMEOUT,this.adapterRef.instance.leave()),this.adapterRef.instance.safeEmit("permkey-timeout",{uid:t}))}destroy(){this.logger.log("清除 Signalling"),this._destroyProtoo(),this._reset()}}t.Signalling=y},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteStream=void 0;const i=r(122),o=r(146),s=r(191),a=r(4),c=r(193),u=r(150),l=r(64),d=n(r(12)),p=n(r(13)),m=r(65),f=r(68),h=r(63);let g=0;class v extends f.RTCEventEmitter{constructor(e){if(super(),this.audioLevelHelper=null,this.platformType=l.PlatformType.unknown,this.isRemote=!0,this.pubStatus={audio:{audio:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},audioSlave:{audioSlave:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},video:{video:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},screen:{screen:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1}},this.subStatus={audio:!1,audioSlave:!1,video:!1,screen:!1},this.muteStatus={audio:{send:!1,recv:!1},audioSlave:{send:!1,recv:!1},video:{send:!1,recv:!1},screen:{send:!1,recv:!1}},this.active=!0,this.destroyed=!1,this.spatialPosition={x:0,y:0},this.remoteStreamId=g++,this.streamID=e.uid,this.stringStreamID=this.streamID.toString(),this.platformType=e.platformType,this.logger=e.client.adapterRef.logger.getChild((()=>{let t="remote#"+this.stringStreamID;return l.PlatformTypeMap[this.platformType]&&(t+=" "+l.PlatformTypeMap[this.platformType]),t+=this.remoteStreamId,this.pubStatus.audio.consumerId?t+="M":this.pubStatus.audio.producerId&&(t+="m"),this.pubStatus.video.consumerId?t+="C":this.pubStatus.video.producerId&&(t+="c"),this.pubStatus.screen.consumerId?t+="S":this.pubStatus.screen.producerId&&(t+="s"),e.client.adapterRef.remoteStreamMap[this.streamID]!==this&&(t+=" DETACHED"),t})),"string"==typeof e.uid)e.client.adapterRef.channelInfo.uidType="string";else{if("number"!=typeof e.uid)throw this.logger.error("remoteSteram: uid参数格式非法"),new p.default({code:d.default.STREAM_UID_ERROR,message:"remoteSteram: uid参数格式非法"});if(e.client.adapterRef.channelInfo.uidType="number",e.uid>Number.MAX_SAFE_INTEGER)throw this.logger.error("remoteSteram: uid超出number类型精度"),new p.default({code:d.default.STREAM_UID_ERROR,message:"Number 类型的 uid 最大值是 2^53 - 1， 请输入正确的参数"})}this.videoView=null,this.screenView=null,this.renderMode={remote:{video:{},screen:{}}},this.consumerId=null,this.producerId=null,this.subConf={audio:!0,audioSlave:!0,video:!0,screen:!0,highOrLow:{video:i.STREAM_TYPE.HIGH,screen:i.STREAM_TYPE.HIGH}},this.renderMode={remote:{video:{},screen:{}}},this._reset(),this.streamID=e.uid,this.stringStreamID=this.streamID.toString(),this.audio=e.audio,this.audioSlave=e.audioSlave||!1,this.video=e.video||!1,this.screen=e.screen||!1,this.client=e.client,this.mediaHelper=new s.MediaHelper({stream:this}),this._play=new c.Play({stream:this}),this._record=new u.Record({logger:this.logger,client:this.client}),"never"!==a.getParameters().enableAlerter&&o.alerter.watchRemoteStream(this),this.client.apiFrequencyControl({name:"createRemoteStream",code:0,param:{streamID:this.stringStreamID,isRemote:!0,clientUid:this.client.adapterRef.channelInfo.uid||""}})}_reset(){this.audio=!1,this.audioSlave=!1,this.video=!1,this.screen=!1,this.videoView=null,this.screenView=null,this.renderMode={remote:{video:{},screen:{}}},this.consumerId=null,this.producerId=null,this.pubStatus={audio:{audio:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},audioSlave:{audioSlave:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},video:{video:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1},screen:{screen:!1,producerId:"",consumerId:"",consumerStatus:"init",stopconsumerStatus:"init",mute:!1,simulcastEnable:!1}},this.subConf={audio:!0,audioSlave:!0,video:!0,screen:!0,highOrLow:{video:i.STREAM_TYPE.HIGH,screen:i.STREAM_TYPE.HIGH}},this.subStatus={audio:!1,audioSlave:!1,video:!1,screen:!1},this.muteStatus={audio:{send:!1,recv:!1},audioSlave:{send:!1,recv:!1},video:{send:!1,recv:!1},screen:{send:!1,recv:!1}},this.renderMode={remote:{video:{},screen:{}}},this.mediaHelper&&this.mediaHelper.destroy(),this._play&&this._play.destroy(),this._record&&this._record.destroy(),this._record=null}get Play(){return this._play}get Record(){return this._record}getId(){return"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID}doSetSubscribeConfig(e){const t=Object.assign({},this.subConf);t.highOrLow=Object.assign({},this.subConf.highOrLow);for(let t of l.MediaTypeListAudio){const r=e[t];"boolean"==typeof r&&(this.subConf[t]=r)}for(let t of l.MediaTypeListVideo){const r=e[t];e.highOrLow&&(this.subConf.highOrLow[t]=e.highOrLow),"high"===r||"low"===r?(this.subConf[t]=!0,this.subConf.highOrLow[t]=i.STREAM_TYPE["high"===r?"HIGH":"LOW"]):"boolean"==typeof r&&(this.subConf[t]=r)}this.pubStatus.audio.audio&&this.subConf.audio?(this.subConf.audio=!0,this.audio=!0):this.subConf.audio=!1,this.pubStatus.audioSlave.audioSlave&&this.subConf.audioSlave?(this.subConf.audioSlave=!0,this.audioSlave=!0):this.subConf.audioSlave=!1,this.pubStatus.video.video&&this.subConf.video?(this.subConf.video=!0,this.video=!0):this.subConf.video=!1,this.pubStatus.screen.screen&&this.subConf.screen?(this.subConf.screen=!0,this.screen=!0):this.subConf.screen=!1;let r="doSetSubscribeConfig",n=!1;for(let e of l.MediaTypeList)r+=` ${e}:${t[e]}`,t[e]!==this.subConf[e]&&(r+="=>"+this.subConf[e],n=!0),"video"!==e&&"screen"!==e||(r+=" "+i.STREAM_TYPE_REV[t.highOrLow[e]],t.highOrLow[e]!==this.subConf.highOrLow[e]&&(r+="=>"+i.STREAM_TYPE_REV[this.subConf.highOrLow[e]],n=!0));n||(r+="【Unchanged】"),this.logger.log(r)}setSubscribeConfig(e){if(this.logger.log(`setSubscribeConfig() 设置 ${this.stringStreamID} 订阅规则：${JSON.stringify(e)}`),this.doSetSubscribeConfig(e),this.logger.log(`setSubscribeConfig() 设置 ${this.stringStreamID} 订阅规则结果：${JSON.stringify(this.subConf)}`),this.client.apiFrequencyControl({name:"setSubscribeConfig",code:0,param:{streamID:this.stringStreamID,isRemote:!0,conf:Object.assign({},this.subConf)}}),this.pubStatus.screen.screen){const e={uid:"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID,subscribe:this.subConf.screen};this.client.apiFrequencyControl({name:"subscribeRemoteSubStreamVideo",code:0,param:JSON.stringify(e,null," ")})}}getAudioStream(){return this.client.apiFrequencyControl({name:"getAudioStream",code:0,param:JSON.stringify({isRemote:!0,streamID:this.getId()},null," ")}),this.mediaHelper.audio.audioStream}getAudioTrack(){return this.mediaHelper.audio.audioStream.getAudioTracks()[0]||null}getVideoTrack(){return this.mediaHelper.video.videoStream.getVideoTracks()[0]||null}getScreenTrack(){return this.mediaHelper.screen.screenVideoStream.getVideoTracks()[0]||null}getAudioSlaveTrack(){return this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks()[0]||null}async play(e,t={}){if((t.video||t.screen)&&!e)throw this.logger.warn(`play() remoteStream ${this.getId()} 播放视频没有指定div标签`),new p.default({code:d.default.STREAM_PLAY_ARGUMENT_ERROR,message:"play() 播放视频没有指定div标签"});if(m.isExistOptions({tag:"Stream.playOptions.audio",value:t.audio}).result||(t.audio=!0),m.isExistOptions({tag:"Stream.playOptions.audioSlave",value:t.audioSlave}).result||(t.audioSlave=!0),m.isExistOptions({tag:"Stream.playOptions.video",value:t.video}).result||(t.video=!0),m.isExistOptions({tag:"Stream.playOptions.screen",value:t.screen}).result||(t.screen=!0),this.logger.log(`play() uid ${this.stringStreamID} 播放, playOptions:${JSON.stringify(t)}`),t.audio&&this._play&&this.mediaHelper.audio.audioStream.getTracks().length)if(this.client.spatialManager)this.logger.log("[play] 启用了空间音频，跳过本地音频播放。");else{this.logger.log(`[play] uid ${this.stringStreamID} 开始播放远端音频`);try{await this._play.playAudioStream("audio",this.mediaHelper.audio.audioStream,t.muted)}catch(e){this.client.emit("notAllowedError",e),this.client.emit("NotAllowedError",e),this.safeEmit("notAllowedError",e)}}if(t.audioSlave&&this._play&&this.mediaHelper.screenAudio.screenAudioStream.getTracks().length)if(this.client.spatialManager)this.logger.log("[play] 启用了空间音频，跳过本地音频辅流播放。");else{this.logger.log(`[play] uid ${this.stringStreamID} 开始播放远端音频辅流`);try{await this._play.playAudioStream("audioSlave",this.mediaHelper.screenAudio.screenAudioStream,t.muted)}catch(e){this.client.emit("notAllowedError",e),this.client.emit("NotAllowedError",e),this.safeEmit("notAllowedError",e)}}let r;if(r="string"==typeof e?document.getElementById(e):e||null,r){if(t.video&&(this.videoView=r,this._play&&this.mediaHelper.video.videoStream.getVideoTracks().length)){this.logger.log(`[play] uid ${this.stringStreamID} 开始启动视频播放 主流 远端`);try{await this._play.playVideoStream("video",this.mediaHelper.video.renderStream,r),"width"in this.renderMode.remote.video&&this._play.setRender("video",this.renderMode.remote.video)}catch(e){this.client.emit("notAllowedError",e),this.client.emit("NotAllowedError",e),this.safeEmit("notAllowedError",e)}}if(t.screen&&(this.screenView=r,this._play&&this.mediaHelper&&this.mediaHelper.screen.screenVideoStream.getVideoTracks().length)){this.logger.log(`[play] uid ${this.stringStreamID} 开始启动视频播放 辅流 远端`);try{await this._play.playVideoStream("screen",this.mediaHelper.screen.renderStream,r),"width"in this.renderMode.remote.screen&&this._play.setRender("screen",this.renderMode.remote.screen)}catch(e){this.client.emit("notAllowedError",e),this.client.emit("NotAllowedError",e),this.safeEmit("notAllowedError",e)}}}this.client.apiFrequencyControl({name:"play",code:0,param:JSON.stringify({streamID:this.stringStreamID,playOptions:t,isRemote:!0},null," ")})}async resume(){h.tryResumeAudioContext()&&this.logger.log("正在尝试恢复AudioContext自动播放受限"),this._play&&(this.logger.log("resume() uid: ",this.stringStreamID),await this._play.resume()),this.client.apiFrequencyControl({name:"resume",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0},null," ")})}setRemoteRenderMode(e,t){if(!e||!Number.isInteger(e.width)||!Number.isInteger(e.width))throw this.logger.warn("setRemoteRenderMode 参数宽高错误"),this.client.apiFrequencyControl({name:"setRemoteRenderMode",code:-1,param:Object.assign({streamID:this.stringStreamID,isRemote:!0,mediaType:t},e)}),new p.default({code:d.default.STREAM_RENDER_ARGUMENT_ERROR,message:"setLocalRenderMode() 参数宽高错误"});this.client&&this._play&&(this.logger.log(`uid ${this.stringStreamID} 设置远端视频播放窗口大小: `,t||"video+screen",JSON.stringify(e)),t&&"video"!==t||(this._play&&this._play.setRender("video",e),this.renderMode.remote.video=e),t&&"screen"!==t||(this.renderMode.remote.screen=e,this._play&&this._play.setRender("screen",e)),this.client.apiFrequencyControl({name:"setRemoteRenderMode",code:0,param:Object.assign(Object.assign({},e),{mediaType:t,isRemote:!0,streamID:this.stringStreamID})}))}stop(e){this.logger.log(`stop() uid ${this.stringStreamID}, 停止播放 ${e||"音视频流"}`),this._play&&(l.MediaTypeList.forEach((t=>{e&&t!==e||this._play.stopPlayStream(t)})),this.client.apiFrequencyControl({name:"stop",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,audio:this.audio,video:this.video,screen:this.screen,type:e},null," ")}))}isPlaying(e){if(this._play){if(l.MediaTypeList.indexOf(e)>-1)return this._play.isPlaying(e);throw this.logger.warn("isPlaying() unknown type"),new p.default({code:d.default.STREAM_ISPLAYING_ARGUMENT_ERROR,message:"isPlaying() type 参数类型非法"})}return this.client.apiFrequencyControl({name:"isPlaying",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,type:e},null," ")}),this.logger.log(`检查${this.stringStreamID}的${e}播放状态: false`),!1}canPlay(e){return-1===l.MediaTypeList.indexOf(e)?null:this._play.canPlay(e)}async unmuteAudio(){var e;let t,r;if(this.muteStatus.audio.recv||(t=d.default.STREAM_NOT_MUTE_AUDIO_YET,r="remoteStream.unmuteAudio: 当前没有mute音频, 不支持unmute"),this._play.audio.dom&&(null===(e=this.mediaHelper.audio.audioStream)||void 0===e?void 0:e.active)||(t=d.default.STREAM_UNMUTE_AUDIO_WITHOUT_STREAM,r="remoteStream.unmuteAudio: 没有音频流, 无法执行unmute操作"),this.client.apiFrequencyControl({name:"unmuteAudio",code:t?-1:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,reason:r||""},null," ")}),t)throw this.logger.error(r),new p.default({code:t,message:r});try{this.logger.log("unmuteAudio() 启用音频轨道: ",this.stringStreamID),this.muteStatus.audio.recv=!1,this.mediaHelper.audio.audioStream.getAudioTracks().length&&(this.mediaHelper.audio.audioStream.getAudioTracks()[0].enabled=!0),this._play.playAudioStream("audio",this.mediaHelper.audio.audioStream,!1)}catch(e){this.logger.error("unmuteAudio() 异常: ",e.name,e.message),this.client.apiFrequencyControl({name:"unmuteAudio",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,reason:e},null," ")})}}async muteAudio(){var e,t,r,n,i,o;if(this.logger.log("禁用音频轨道: ",this.stringStreamID),!(null===(r=null===(t=null===(e=this._play)||void 0===e?void 0:e.audio)||void 0===t?void 0:t.dom)||void 0===r?void 0:r.srcObject)||!(null===(o=null===(i=null===(n=this.mediaHelper)||void 0===n?void 0:n.audio)||void 0===i?void 0:i.audioStream)||void 0===o?void 0:o.active))throw this.logger.log("muteAudio() 之前没有播放过音频, 不支持unmute: ",this.stringStreamID),new p.default({code:d.default.STREAM_MUTE_AUDIO_ERROR,message:"remoteStream.muteAudio: 之前没有播放过音频, 不支持muteAudio"});try{this.muteStatus.audio.recv=!0,this.mediaHelper.audio.audioStream.getAudioTracks().length&&(this.mediaHelper.audio.audioStream.getAudioTracks()[0].enabled=!1),this._play.stopPlayStream("audio"),this.client.apiFrequencyControl({name:"muteAudio",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0},null," ")})}catch(e){this.logger.error("API调用失败: Stream:muteAudio",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteAudio",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,reason:e.message},null," ")})}}async unmuteAudioSlave(){var e;let t,r;if(this.muteStatus.audioSlave.recv||(t=d.default.STREAM_NOT_MUTE_AUDIO_SLAVE_YET,r="remoteStream.unmuteAudioSlave: 当前没有mute音频辅流, 不支持unmute"),this._play.audioSlave.dom&&(null===(e=this.mediaHelper.screenAudio.screenAudioStream)||void 0===e?void 0:e.active)||(t=d.default.STREAM_UNMUTE_AUDIO_SLAVE_WITHOUT_STREAM,r="remoteStream.unmuteAudioSlave: 没有音频辅流, 无法执行unmute操作"),this.client.apiFrequencyControl({name:"unmuteAudioSlave",code:t?-1:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:r||""},null," ")}),t)throw this.logger.error(r),new p.default({code:t,message:r});try{this.logger.log("unmuteAudioSlave() 启用音频辅流轨道: ",this.stringStreamID),this.muteStatus.audioSlave.recv=!1,this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks().length&&(this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks()[0].enabled=!0),this._play.playAudioStream("audioSlave",this.mediaHelper.screenAudio.screenAudioStream,!1)}catch(e){this.logger.error("Stream:unmuteAudioSlave 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteAudioSlave",code:-1,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:e.message},null," ")})}}async muteAudioSlave(){var e,t,r,n,i,o;if(!(null===(r=null===(t=null===(e=this._play)||void 0===e?void 0:e.audioSlave)||void 0===t?void 0:t.dom)||void 0===r?void 0:r.srcObject)||!(null===(o=null===(i=null===(n=this.mediaHelper)||void 0===n?void 0:n.screenAudio)||void 0===i?void 0:i.screenAudioStream)||void 0===o?void 0:o.active))throw this.logger.error("muteAudioSlave() 之前没有播放过音频辅流, 不支持unmute: ",this.stringStreamID),new p.default({code:d.default.STREAM_MUTE_AUDIO_SLAVE_ERROR,message:"remoteStream.muteAudioSlave: 之前没有播放过音频辅流, 不支持mute"});try{this.logger.log("muteAudioSlave() 禁用音频辅流轨道: ",this.stringStreamID),this.muteStatus.audioSlave.recv=!0,this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks().length&&(this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks()[0].enabled=!1),this._play.stopPlayStream("audioSlave"),this.client.apiFrequencyControl({name:"muteAudioSlave",code:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("Stream:muteAudioSlave 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteAudioSlave",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,reason:e},null," ")})}}hasAudio(){return this.mediaHelper.audio.audioStream.getAudioTracks().length>0}hasAudioSlave(){return this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks().length>0}getAudioLevel(e="audio"){const t=this.mediaHelper.getOrCreateAudioPipeline(e);if(t){if(!t.audioLevelNode){const t=h.getAudioContext();if(t&&t.audioWorklet&&t.audioWorklet.addModule||(this.logger.error("getAudioLevel is not supported in this browser"),this.client.safeEmit("error","AUDIOLEVEL_NOT_SUPPORTED")),"suspended"===(null==t?void 0:t.state)){const e=new p.default({code:d.default.AUTO_PLAY_NOT_ALLOWED,url:"https://doc.yunxin.163.com/docs/jcyOTA0ODM/jM3NDE0NTI?platformId=50082",message:"playVideoStream: 浏览器自动播放受限: AudioContext is Suspended"});return this.client.safeEmit("notAllowedError",e),this.safeEmit("notAllowedError",e),0}this.client.apiFrequencyControl({name:"getAudioLevel",code:0,param:{mediaType:e,isRemote:!0,streamID:this.stringStreamID}})}const r=t.getAudioLevel();return r?r.volume:(this.logger.log("getAudioLevel() 正在加载音频模块"),0)}return 0}setAudioVolume(e=100){var t;let r,n;(!Number.isInteger(e)||e<0||e>100)&&(r=d.default.SET_AUDIO_VOLUME_ARGUMENTS_ERROR,n="setAudioVolume() volume 应该为 0 - 100 的整数");const i=e/100;if(this.audio&&this._play&&this._play.audio&&this._play.audio.dom||(n="setAudioVolume() 没有音频流，请检查是否有订阅播放过音频",r=d.default.SET_AUDIO_VOLUME_ERROR),this.client.apiFrequencyControl({name:"setAudioVolume",code:r?-1:0,param:{streamID:this.stringStreamID,isRemote:!0,volume:2.55*e,normalizedVolume:i,reason:n}}),r)throw this.logger.error(n),new p.default({code:r,message:n});this.logger.log(`setAudioVolume() 调节${this.stringStreamID}的音量大小: ${2.55*e} (normalized: ${i})`),null===(t=this._play)||void 0===t||t.setPlayVolume("audio",i)}setAudioSlaveVolume(e=100){var t;let r,n;Number.isInteger(e)?e<0?e=0:e>100&&(e=100):(r=d.default.SET_AUDIO_VOLUME_ARGUMENTS_ERROR,n="setAudioSlaveVolume() volume 应该为 0 - 100 的整数");const i=e/100;if(this.audio&&this._play&&this._play.audioSlave&&this._play.audioSlave.dom||(n="setAudioSlaveVolume() 没有音频流，请检查是否有订阅播放过音频辅流",r=d.default.SET_AUDIO_VOLUME_ERROR),this.client.apiFrequencyControl({name:"setAudioSlaveVolume",code:r?-1:0,param:{streamID:this.stringStreamID,isRemote:!0,volume:2.55*e,normalizedVolume:i,reason:n||""}}),r)throw this.logger.error(n),new p.default({code:r,message:n});this.logger.log(`setAudioSlaveVolume() 调节${this.stringStreamID}的音量大小: ${2.55*e} (normalized: ${i})`),null===(t=this._play)||void 0===t||t.setPlayVolume("audioSlave",i)}async setAudioOutput(e,t){if(this._play){try{await this._play.setAudioOutput(e)}catch(e){throw t&&setTimeout((()=>{t(e)}),0),this.logger.error("设置输出设备失败",e.name,e.message),new p.default({code:d.default.SET_AUDIO_OUTPUT_ERROR,message:e.message||"系统内部错误"})}t&&setTimeout(t,0)}this.client.apiFrequencyControl({name:"setAudioOutput",code:0,param:JSON.stringify({streamID:this.stringStreamID,deviceId:e,isRemote:!0},null," ")})}async unmuteVideo(){let e,t;if(this.muteStatus.video.recv||(e=d.default.STREAM_NOT_MUTE_VIDEO_YET,t="remoteStream.unmuteVideo: 当前没有mute视频, 不支持unmute"),this.mediaHelper.video.cameraTrack||(e=d.default.STREAM_UNMUTE_VIDEO_WITHOUT_STREAM,t="remoteStream.unmuteVideo: 没有视频流, 无法执行unmute操作"),this.client.apiFrequencyControl({name:"unmuteVideo",code:e?-1:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:t||""},null," ")}),e)throw this.logger.error(t),new p.default({code:e,message:t});try{this.logger.log(`unmuteVideo() 启用 ${this.stringStreamID} 的视频轨道`),this.muteStatus.video.recv=!1,this.mediaHelper&&this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!0)}catch(e){this.logger.error("API调用失败：Stream:unmuteVideo",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteVideo",code:-1,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:e.message},null," ")})}}async muteVideo(){var e,t,r,n,i;if(!(null===(r=null===(t=null===(e=this._play)||void 0===e?void 0:e.video)||void 0===t?void 0:t.dom)||void 0===r?void 0:r.srcObject)||!(null===(i=null===(n=this.mediaHelper)||void 0===n?void 0:n.video)||void 0===i?void 0:i.cameraTrack))throw this.logger.log("muteVideo() 之前没有播放过视频, 不支持unmute: ",this.stringStreamID),new p.default({code:d.default.STREAM_MUTE_VIDEO_ERROR,message:"remoteStream.muteVideo: 之前没有播放过视频, 不支持mute"});try{this.logger.log(`muteVideo() 禁用 ${this.stringStreamID} 的视频轨道`),this.muteStatus.video.recv=!0,this.mediaHelper&&this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!1),this.client.apiFrequencyControl({name:"muteVideo",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0},null," ")})}catch(e){this.logger.error("API调用失败：Stream:muteVideo",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteVideo",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!0,reason:e.message},null," ")})}}async unmuteScreen(){let e,t;if(this.muteStatus.screen.recv||(e=d.default.STREAM_NOT_MUTE_SCREEN_YET,t="remoteStream.unmuteScreen: 当前没有mute屏幕共享, 不支持unmute"),this.mediaHelper.screen.screenVideoTrack||(e=d.default.STREAM_UNMUTE_SCREEN_WITHOUT_STREAM,t="remoteStream.unmuteScreen: 没有屏幕共享流, 无法执行unmute操作"),this.client.apiFrequencyControl({name:"unmuteScreen",code:e?-1:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:t||""},null," ")}),e)throw this.logger.error(t),new p.default({code:e,message:t});try{this.logger.log(`unmuteScreen() 启用 ${this.stringStreamID} 的屏幕共享轨道`),this.muteStatus.screen.recv=!1,this.mediaHelper&&this.mediaHelper.screen.screenVideoTrack&&(this.mediaHelper.screen.screenVideoTrack.enabled=!0),this.client.apiFrequencyControl({name:"unmuteScreen",code:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("unmuteScreen() 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteScreen",code:-1,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:e.message},null," ")})}}async muteScreen(){var e,t,r,n;if(!(null===(r=null===(t=null===(e=this._play)||void 0===e?void 0:e.screen)||void 0===t?void 0:t.dom)||void 0===r?void 0:r.srcObject)||!(null===(n=this.mediaHelper)||void 0===n?void 0:n.screen.screenVideoTrack))throw this.logger.log("muteScreen() 之前没有播放过屏幕共享, 不支持unmute: ",this.stringStreamID),new p.default({code:d.default.STREAM_MUTE_SCREEN_ERROR,message:"remoteStream.muteScreen: 之前没有播放过屏幕共享, 不支持mute"});try{this.logger.log(`muteScreen() 禁用 ${this.stringStreamID} 的屏幕共享轨道`),this.mediaHelper&&this.mediaHelper.screen.screenVideoTrack&&(this.mediaHelper.screen.screenVideoTrack.enabled=!1),this.muteStatus.screen.recv=!0,this.client.apiFrequencyControl({name:"muteScreen",code:0,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("muteScreen() 异常: ",e,...arguments),this.client.apiFrequencyControl({name:"muteScreen",code:-1,param:JSON.stringify({isRemote:!0,streamID:this.stringStreamID,reason:e.message},null," ")})}}hasVideo(){this.logger.log("获取视频 flag"),this.mediaHelper.video.videoStream.getVideoTracks().length}hasScreen(){this.mediaHelper.screen.screenVideoStream.getVideoTracks().length}async takeSnapshot(e){var t,r,n,i;let o,s;const a=this.video&&(null===(r=null===(t=this._play)||void 0===t?void 0:t.video)||void 0===r?void 0:r.dom),c=this.screen&&(null===(i=null===(n=this.Play)||void 0===n?void 0:n.screen)||void 0===i?void 0:i.dom);if(a||c?(await this._play.takeSnapshot(e,"download",this.streamID),this.client.apiFrequencyControl({name:"takeSnapshot",code:0,param:Object.assign(Object.assign({},e),{streamID:this.stringStreamID,isRemote:!0})})):(s="takeSnapshot(): 没有视频流, 请检查视频是否正在播放",o=d.default.STREAM_TAKE_SNAPSHOT_ERROR),o)throw this.logger.error(s),this.client.apiFrequencyControl({name:"takeSnapshot",code:-1,param:JSON.stringify(Object.assign(Object.assign({streamID:this.stringStreamID,isRemote:!0},e),{reason:s}),null," ")}),new p.default({code:o,message:s})}takeSnapshotBase64(e){var t,r,n,i;let o,s;const a=this.video&&(null===(r=null===(t=this._play)||void 0===t?void 0:t.video)||void 0===r?void 0:r.dom),c=this.screen&&(null===(i=null===(n=this.Play)||void 0===n?void 0:n.screen)||void 0===i?void 0:i.dom);if(a||c){let t=this._play.takeSnapshot(e,"base64");return this.client.apiFrequencyControl({name:"takeSnapshotBase64",code:0,param:Object.assign({streamID:this.stringStreamID,isRemote:!0},e)}),t}if(s="takeSnapshotBase64(): 没有视频流, 请检查视频是否正在播放",o=d.default.STREAM_TAKE_SNAPSHOT_ERROR,o)throw this.logger.error(s),this.client.apiFrequencyControl({name:"takeSnapshotBase64",code:-1,param:JSON.stringify(Object.assign(Object.assign({streamID:this.stringStreamID,isRemote:!0},e),{reason:s}),null," ")}),new p.default({code:o,message:s})}getCurrentFrameData(e={mediaType:"video"}){return this._play.getCurrentFrameData(e)}async startMediaRecording(e){const t=[];switch(e.type){case"screen":t.push(this.mediaHelper.screen.screenVideoStream),t.push(this.mediaHelper.audio.audioStream);break;case"camera":case"video":t.push(this.mediaHelper.video.videoStream),t.push(this.mediaHelper.audio.audioStream);break;case"audio":t.push(this.mediaHelper.audio.audioStream)}if(0!==t.length){if(!this._record||!this.streamID||!t)throw new p.default({code:d.default.RECORDING_ERROR,message:"remoteStream_startMediaRecording: 开始录制时参数异常"});return this._record&&this._record.start({uid:"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID,type:e.type,reset:e.reset,stream:t})}this.logger.log("没有没发现要录制的媒体流")}stopMediaRecording(e){if(!this._record||!this._record.recoder)throw new p.default({code:d.default.RECORDING_NOT_START_ERROR,message:"remoteStream.stopMediaRecording: 录制未开始"});return this._record.stop({})}playMediaRecording(e){if(!this._record||!this._record.recoder)throw new p.default({code:d.default.RECORDING_NOT_START_ERROR,message:"remoteStream.playMediaRecording: 录制未开始"});return this._record.play(e.view)}listMediaRecording(){let e=[];if(!this._record||!this._record.recoder)throw new p.default({code:d.default.RECORDING_NOT_START_ERROR,message:"remoteStream.listMediaRecording: 录制未开始"});const t=this._record.getRecordStatus();return"init"!==t.status&&e.push(t),e}cleanMediaRecording(e){if(!this._record||!this._record.recoder)throw new p.default({code:d.default.RECORDING_NOT_START_ERROR,message:"remoteStream.cleanMediaRecording: 录制未开始"});return this._record.clean()}downloadMediaRecording(e){if(!this._record||!this._record.recoder)throw new p.default({code:d.default.RECORDING_NOT_START_ERROR,message:"remoteStream.downloadMediaRecording: 录制未开始"});return this._record.download()}clearRemotePubStatus(){for(let e of l.MediaTypeList)this[e]=!1,this.pubStatus[e][e]=!1,this.pubStatus[e].producerId="",this.pubStatus[e].consumerId="",this.pubStatus[e].consumerStatus="init",this.pubStatus[e].stopconsumerStatus="init"}setCanvasWatermarkConfigs(e){if(this._play){let t="screen"===e.mediaType?this._play.screen.canvasWatermark:this._play.video.canvasWatermark;if(!t)return void this.logger.error("setCanvasWatermarkConfigs：播放器未初始化",e.mediaType);const r={TEXT:10,TIMESTAMP:1,IMAGE:4};if(e.textWatermarks&&e.textWatermarks.length>r.TEXT)throw this.logger.error(`目前的文字水印数量：${e.textWatermarks.length}。允许的数量：${r.TEXT}`),new p.default({code:d.default.WATERMARKS_EXCEEDED_ERROR,message:"最多可以设置 10 个文字水印"});if(e.imageWatermarks&&e.imageWatermarks.length>r.IMAGE)throw this.logger.error(`目前的图片水印数量：${e.imageWatermarks.length}。允许的数量：${r.IMAGE}`),new p.default({code:d.default.WATERMARKS_EXCEEDED_ERROR,message:"最多可以设置 4 个图片水印"});t.checkWatermarkParams(e),t.updateWatermarks(e),Object.assign({uid:this.stringStreamID},e),this.client.apiFrequencyControl({name:"setRemoteCanvasWatermarkConfigs",code:0,param:{isRemote:!0,streamID:this.stringStreamID,mediaType:e.mediaType}})}else this.logger.error("setCanvasWatermarkConfigs：播放器未初始化")}getMuteStatus(e){return"audio"===e?{send:this.muteStatus.audio.send,recv:this.muteStatus.audio.recv,muted:this.muteStatus.audio.send||this.muteStatus.audio.recv}:"video"===e?{send:this.muteStatus.video.send,recv:this.muteStatus.video.recv,muted:this.muteStatus.video.send||this.muteStatus.video.recv}:{send:this.muteStatus.screen.send,recv:this.muteStatus.screen.recv,muted:this.muteStatus.screen.send||this.muteStatus.screen.recv}}getAdapterRef(){return this.client.adapterRef.remoteStreamMap[this.streamID]===this?this.client.adapterRef:null}getNativeDom(e){var t;const r=this[e],n=null===(t=this._play[e])||void 0===t?void 0:t.dom;return r&&n||this.logger.warn("No remote "+e),n}destroy(){this.client&&(this.client.apiFrequencyControl({name:"destroy",code:0,param:{streamID:this.stringStreamID,isRemote:!0}}),this.logger.log(`uid ${this.stringStreamID} 销毁 Stream 实例`),this.stop(),this._reset())}}t.RemoteStream=v},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.pcCloneTrack=void 0,t.pcCloneTrack=function(e){const t=new RTCPeerConnection,r=new RTCPeerConnection;window.pcLocal=t,window.pcRemote=r,t.onicecandidate=e=>{e.candidate&&r.addIceCandidate(e.candidate)},t.onnegotiationneeded=async e=>{const n=await t.createOffer();await t.setLocalDescription(n),await r.setRemoteDescription(n);const i=await r.createAnswer();await r.setLocalDescription(i),await t.setRemoteDescription(i)};const n=t.addTransceiver("video",{direction:"recvonly"});return r.addTrack(e),e.addEventListener("neTrackEnded",(()=>{r.close(),n.receiver.track.stop()})),n.receiver.track}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.preProcessingPureColor=t.preProcessingCopy=t.preProcessingSyncState=t.disablePreProcessing=t.canDisablePreProcessing=t.enablePreProcessing=void 0;const n=r(73),i=r(173),o=r(140);function s(e,t,r){r.videoTrack&&r.videoTrack.enabled!==r.canvasTrack.enabled&&(e.logger.log(`preProcessingCopy: 更改mute状态 ${t} ${r.canvasTrack.enabled} => ${r.videoTrack.enabled}`),r.canvasTrack.enabled=r.videoTrack.enabled)}function a(e,t,r){r.videoTrack&&r.videoTrack.enabled!==r.canvasTrack.enabled&&(e.logger.log(`preProcessingCopy: 更改mute状态 ${t} ${r.canvasTrack.enabled} => ${r.videoTrack.enabled}`),r.canvasTrack.enabled=r.videoTrack.enabled),r.canvasCtx.drawImage(r.videoElem,0,0)}t.enablePreProcessing=async function(e,t,r){let c;if(r||(r=e[t].captureConfig.high.frameRate),c="video"===t?e.video.cameraTrack||e.video.videoSource:e.screen.screenVideoTrack||e.screen.screenVideoSource,!c)return void e.logger.warn("enablePreProcessing：当前没有视频输入 "+t);let u,l=e[t].preProcessing;if(!l){e.logger.log("enablePreProcessing:初始化 mediaType "+t);const r=document.createElement("video");let n=new o.RTCCanvas("canvas"),i=n._canvas,c=n._ctx;if(!c)throw new Error("无法创建canvasCtx 2d");const u=i.captureStream();r.onresize=()=>{n.setSize(r.videoWidth,r.videoHeight),r.play()};const d=u.getVideoTracks()[0];l={canvasTrack:d,canvasCtx:c,videoTrack:null,videoElem:r,canvasElem:i,handlers:[{name:"syncState",enabled:!0,func:s},{name:"copy",enabled:!0,func:a},{name:"mirror",enabled:!1,func:()=>{}},e.stream._play[t].encoderWatermark.handler],history:[],timer:null},e[t].preProcessing=l}if(!l)return;"video"===t?n.emptyStreamWith(e.video.videoStream,l.canvasTrack):n.emptyStreamWith(e.screen.screenVideoStream,l.canvasTrack),l.videoElem.srcObject=new MediaStream([c]),l.videoTrack=c,e.stream.isRemote||(u=e.stream.getSender(t,"high")),u&&(u.replaceTrack(l.canvasTrack),e.logger.log(`enablePreProcessing ${t} 成功替换上行`));const d=async()=>{if(l)if(l.videoElem.videoWidth&&l.videoElem.videoHeight&&(l.videoElem.videoWidth===l.canvasElem.width&&l.videoElem.videoHeight===l.canvasElem.height||(e.logger.warn(`前处理宽高变化 ${t} ${l.canvasElem.width}x${l.canvasElem.height} => ${l.videoElem.videoWidth}x${l.videoElem.videoHeight}`),l.canvasElem.width=l.videoElem.videoWidth,l.canvasElem.height=l.videoElem.videoHeight)),l.handlers.length){const r=Date.now(),n=[];for(let i of l.handlers)if(i&&i.enabled){const o=r;await i.func(e,t,l);const s=Date.now()-o;n.push({name:i.name,spent:s})}const i=Date.now();let o=0;for(;o<l.history.length&&i-l.history[o].endTs>5e3;o++);l.history.splice(0,o),l.history.push({startTs:r,endTs:i,handlerTs:n})}else a(e,t,l)};l.timer&&clearInterval(l.timer);const p=Math.floor(1e3/r);try{d()}catch(t){e.logger.error("drawFrame",t.name,t.message,t.stack)}l.timer=i.getRTCTimer().setInterval(d,p),e[t].preProcessingEnabled=!0,e.emit("preProcessChange",{mediaType:t,isOn:!0})},t.canDisablePreProcessing=function(e,t){const r=e[t].preProcessing;return!(!r||!r.timer)&&0===r.handlers.filter((e=>e&&e.enabled&&"syncState"!==e.name&&"copy"!==e.name)).length},t.disablePreProcessing=async function(e,t="video",r=!1){e.logger.log("disablePreProcessing "+t);const o=e[t].preProcessing;if(!o)return void e.logger.warn(`disablePreProcessing ${t}:当前没有前处理配置`);let s,a;o.canvasCtx.clearRect(0,0,o.canvasElem.width,o.canvasElem.height),(null==o?void 0:o.timer)&&(i.getRTCTimer().clearInterval(o.timer),o.timer=null),"video"===t?(s=e.video.cameraTrack||e.video.videoSource,n.emptyStreamWith(e.video.videoStream,s)):(s=e.screen.screenVideoTrack||e.screen.screenVideoSource,n.emptyStreamWith(e.screen.screenVideoStream,s)),o.videoElem.srcObject&&(o.videoElem.srcObject=null),e.stream.isRemote||(a=e.stream.getSender(t,"high")),a&&("live"===(null==s?void 0:s.readyState)?(a.replaceTrack(s),e.logger.log(`disablePreProcessing ${t} 成功替换上行为【${s.label}】`)):(a.replaceTrack(null),e.logger.warn("disablePreProcessing 删除上行"))),r||(e[t].preProcessingEnabled=!1),e.emit("preProcessChange",{mediaType:t,isOn:!1})},t.preProcessingSyncState=s,t.preProcessingCopy=a,t.preProcessingPureColor=function(e,t,r){r.canvasCtx.fillStyle="green",r.canvasCtx.fillRect(0,0,r.canvasElem.width,r.canvasElem.height)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioPipeline=void 0;const n=r(275),i=r(74),o=r(276),s=r(277),a=r(192),c=r(279),u=r(280);let l=0;t.AudioPipeline=class{constructor(e){this.id=++l,this.inputs={local:{track:null,node:null,label:""},remote:{track:null,node:null,label:""}},this.audioLevelNode=null,this.stages=[],this.mixins={},this.output={track:null,stream:new MediaStream,destination:null,directOutput:!0},this.context=e.context,this.logger=e.logger.getChild((()=>{let e="AudioPipeline#"+this.id;this.inputs.local.track&&(e+=" LOCAL",this.inputs.local.track===this.output.track&&(e+=`[${this.inputs.local.label}]`)),this.inputs.remote.track&&(e+=" REMOTE",this.inputs.remote.track===this.output.track&&(e+=`[${this.inputs.remote.label}]`));let t="";for(let e in this.mixins)this.output.destination&&this.mixins[e].node.isConnectedTo(this.output.destination)&&(t+=" m"+e);t&&(e+=" "+t);for(let t in this.stages)this.stages[t].enabled&&(e+="/"+this.stages[t].type);return e})),this.stageInputVolume=new s.StageInputVolume(this.context),this.stageAIProcessing=new a.StageAIProcessing(this.context,this.logger),this.stageDelay=new c.StageDelay(this.context),this.stages=[this.stageInputVolume,this.stageAIProcessing,this.stageDelay],this.output.stream=e.outputStream,this.pluginList=[],this.logger.log("Audio Pipeline Init")}getMixin(e){return this.mixins[e]||(this.mixins[e]=new u.AudioMix(this)),this.mixins[e]}getEnabledStages(){return this.stages.filter((e=>e.enabled))}setInput(e,t,r){this.inputs[e].track=t,this.updateConnection()}getInputVolume(){return this.stageInputVolume.volume}setInputVolume(e){this.stageInputVolume.setVolume(e),this.stageInputVolume.isTransparent()?this.stageInputVolume.enabled&&(this.stageInputVolume.enabled=!1,this.updateConnection()):this.stageInputVolume.enabled||(this.stageInputVolume.enabled=!0,this.updateConnection())}setDelay(e){this.stageDelay.setDelay(e),this.stageDelay.isTransparent()?this.stageDelay.enabled&&(this.stageDelay.enabled=!1,this.updateConnection()):this.stageDelay.enabled||(this.stageDelay.enabled=!0,this.updateConnection())}getAudioLevel(){return this.audioLevelNode||(this.initAudioLevelNode(),this.updateConnection()),this.audioLevelNode?(this.audioLevelNode.audioNode&&!this.audioLevelNode.audioNode.port.onmessage&&(this.audioLevelNode.logger.warn("Rebinding Audio Worklet Node"),this.audioLevelNode.bindAudioWorkletNode(this.audioLevelNode.audioNode)),this.audioLevelNode.getAudioLevel()):0}initAudioLevelNode(){this.audioLevelNode?this.logger.log("initAudioLevelNode: audioLevelNode Already Inited"):(this.audioLevelNode=new n.AudioLevelNode({logger:this.logger,context:this.context}),this.updateConnection())}hasWorkingMixin(){for(let e in this.mixins)if("MIX_PLAYING"===this.mixins[e].mixAudioConf.state)return!0;return!1}updateConnection(){var e,t,r,n,s,a;const c=this.getInputsInfo();let u=null;switch(c.cnt){case 0:this.output.directOutput=!0,this.output.stream.getTracks().length&&(this.output.stream.getTracks().forEach((e=>{this.output.stream.removeTrack(e)})),this.logger.log("updateConnection:NoInput"),this.output.stream.dispatchEvent(new Event("neTrackUpdated")),this.output.track=null),this.audioLevelNode&&this.audioLevelNode.disconnectFromAll();break;case 1:if(this.getEnabledStages().length||this.hasWorkingMixin()){this.output.destination||(this.logger.log("updateConnection: Creating output destination"),this.output.destination=new i.NeAudioNode("destination",this.context.createMediaStreamDestination())),this.output.track=this.output.destination.audioNode.stream.getTracks()[0],this.output.stream.getTracks()[0]!==this.output.track&&(this.output.stream.getTracks().forEach((e=>{var t;this.logger.log(`updateConnection: Updating output track ${e.label} => ${null===(t=this.output.track)||void 0===t?void 0:t.label}`),this.output.stream.removeTrack(e)})),this.output.stream.addTrack(this.output.track),this.output.stream.dispatchEvent(new Event("neTrackUpdated")));let e=!1;for(let t in this.mixins){const r=this.mixins[t];"MIX_PLAYING"===r.mixAudioConf.state?(r.mixAudioConf.replace&&(e=!0),r.node.isConnectedTo(this.output.destination)||(this.logger.log(`connect ${t} to destination`),r.node.connect(this.output.destination))):r.node.isConnectedTo(this.output.destination)&&r.node.disconnect(this.output.destination)}if(this.stages){let t=this.output.destination;for(let i=this.stages.length-1;i>=0;i--){const o=this.stages[i];o.enabled&&o.node?(u||(u=o.node),e&&t===this.output.destination?o.node.isConnectedTo(t)&&o.node.disconnect(t):o.node.isConnectedTo(t)||(o.node.disconnectToAll(),o.node.connect(t)),t=o.node):o.enabled||(null===(r=o.node)||void 0===r||r.disconnectToAll(),null===(n=o.node)||void 0===n||n.disconnectFromAll())}c.singleInput&&(c.singleInput.track&&(c.singleInput.node=o.getMediaStreamSourceNode(this.context,c.singleInput.track,c.singleInput===this.inputs.remote)),e&&t===this.output.destination?(null===(s=c.singleInput.node)||void 0===s?void 0:s.isConnectedTo(t))&&(null===(a=c.singleInput.node)||void 0===a||a.disconnect(t)):c.singleInput.node&&!c.singleInput.node.isConnectedTo(t)&&(c.singleInput.node.disconnectToAll(),c.singleInput.node.connect(t)))}}else this.output.directOutput=!0,(null===(e=c.singleInput)||void 0===e?void 0:e.track)&&(this.output.track=c.singleInput.track,this.output.stream.getTracks()[0]!==this.output.track&&(this.output.stream.getTracks().forEach((e=>{this.output.stream.removeTrack(e)})),this.output.stream.addTrack(this.output.track),this.logger.log("updateConnection: DIRECT",this.output.track.label),this.output.stream.dispatchEvent(new Event("neTrackUpdated"))),this.audioLevelNode&&(c.singleInput.node=o.getMediaStreamSourceNode(this.context,c.singleInput.track,c.singleInput===this.inputs.remote),u=c.singleInput.node)),(null===(t=c.singleInput)||void 0===t?void 0:t.node)&&c.singleInput.node.disconnectToAll()}this.audioLevelNode&&u&&(u.isConnectedTo(this.audioLevelNode)||(this.audioLevelNode.disconnectFromAll(),u.connect(this.audioLevelNode)))}getInputsInfo(){let e=0,t=null;return this.inputs.local.track&&(e++,t=this.inputs.local),this.inputs.remote.track&&(e++,t=this.inputs.remote),{cnt:e,singleInput:1===e?t:null}}registerPlugin(e,t,r){"AIDenoise"===e&&(this.stageAIProcessing.registerAIDenoisePlugin(t,r),this.pluginList.push("AIDenoise"))}unregisterPlugin(e){const t=this.pluginList.indexOf(e);-1!==t&&(this.pluginList.splice(t,1),this.stageAIProcessing.unregisterAIDenoise())}hasPlugin(e){return-1!==this.pluginList.indexOf(e)}async enableAIdenoise(e=!0){this.logger.log("Enabling AI Denoise",e),this.stageAIProcessing.enabled=e,"UNINIT"===this.stageAIProcessing.state&&await this.stageAIProcessing.init(),this.updateConnection()}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioLevelNode=void 0;const n=r(128),i=r(74),o=r(63);let s="NOTREADY",a=null;class c extends i.NeAudioNodeNullable{constructor(e){super("AudioLevelNode",null),this.volume=0,this.volumeTs=Date.now(),this.left=null,this.right=null,this.channelState="balance",this.stateChangeCnt=0,this.context=e.context,this.logger=e.logger.getChild((()=>{let e="AudioLevelNode#"+this.id;return e+="READY"!==s?" "+s:" "+this.channelState,this.stateChangeCnt&&(e+=" change"+this.stateChangeCnt),e})),this.initAudioWorklet()}async initAudioWorklet(){if(this.logger.log("AudioLevelNode initAudioWorklet"),!this.context.audioWorklet)return void this.logger.error("该环境不支持音频处理");a?"LOADING"===s&&await a:(s="LOADING",this.logger.log("正在载入音量模块"),a=this.context.audioWorklet.addModule(n.getBlobUrl("volumeProcessor")),await a,s="READY",this.logger.log("载入音量模块成功"));const e=new AudioWorkletNode(this.context,"vumeter");this.bindAudioWorkletNode(e);const t=o.getAudioLevelDestination();t&&e.connect(t),this.connectedFrom.forEach((e=>{e.connect(this)})),this.connectedTo.forEach((e=>{this.connect(e)}))}bindAudioWorkletNode(e){this.audioNode=e,e.port.onmessage=t=>{var r,n;if(this.audioNode!==e)return;const i=Date.now(),o=Math.floor(i);if(t.data.volume>-1){if(this.volume=t.data.volume,this.volumeTs=i,t.data.left>-1)this.left||(this.left={volume:0,history:[]}),this.left.history.length&&this.left.history[0].sec===o||this.left.history.unshift({sec:o,sum:0}),this.left.volume=t.data.left,this.left.history[0].sum+=t.data.left,this.left.history.length>2&&this.left.history.pop();else{const e=this.channelState;this.channelState="mono",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}if(t.data.right>-1&&(this.right||(this.right={volume:0,history:[]}),this.right.history.length&&this.right.history[0].sec===o||this.right.history.unshift({sec:o,sum:0}),this.right.volume=t.data.right,this.right.history[0].sum+=t.data.right,this.right.history.length>2&&this.right.history.pop()),(null===(r=this.left)||void 0===r?void 0:r.history[1])&&(null===(n=this.right)||void 0===n?void 0:n.history[1]))if(this.left.history[1].sum>4*this.right.history[1].sum){const e=this.channelState;this.channelState="leftLoud",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}else if(this.right.history[1].sum>4*this.left.history[1].sum){const e=this.channelState;this.channelState="rightLoud",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}else{if(this.left.history[1].sum>this.right.history[1].sum&&"leftLoud"!==this.channelState){const e=this.channelState;this.channelState="balance",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}if(this.right.history[1].sum>this.left.history[1].sum&&"rightLoud"!==this.channelState){const e=this.channelState;this.channelState="balance",e!==this.channelState&&(this.stateChangeCnt++,this.stateChangeCnt<20&&this.logger.log(`声道状态变更 ${e} => ${this.channelState}`),this.emit("channel-state-change",{state:this.channelState,prev:e}))}}}else this.logger.error("Unsupported message",t.data)}}getAudioLevel(){var e,t;return Date.now()-this.volumeTs>1e3?{volume:0}:{volume:this.volume,left:null===(e=this.left)||void 0===e?void 0:e.volume,right:null===(t=this.right)||void 0===t?void 0:t.volume}}}t.AudioLevelNode=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaStreamSourceNode=void 0;const n=r(74),i=[];t.getMediaStreamSourceNode=function(e,t,r){const o=i.find((r=>r.ctx===e&&r.track===t));if(o){if(r){if(!o.audioElem){const e=document.createElement("audio");e.muted=!0,e.volume=0,e.autoplay=!0,e.controls=!0,o.audioElem=e}o.audioElem.srcObject=o.stream,o.audioElem.play().catch((e=>{}))}return o.node}{const o=new MediaStream([t]),s=e.createMediaStreamSource(o),a=new n.NeAudioNode("MediaStreamSource",s);let c=null;r&&(c=document.createElement("audio"),c.muted=!0,c.volume=0,c.autoplay=!0,c.controls=!0,c.srcObject=o,c.play().catch((e=>{})));const u={track:t,stream:o,source:s,ctx:e,node:a,audioElem:c};return i.push(u),a}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.StageInputVolume=void 0;const n=r(158),i=r(74);class o extends n.StageBase{constructor(e){super(e),this.type="stageInputVolume",this.node=null,this.volume=1}async init(){"UNINIT"===this.state&&(this.node=new i.NeAudioNode("gain",this.context.createGain()),this.state="INITED")}isTransparent(){return Math.abs(this.volume-1)<.01}setVolume(e){"UNINIT"===this.state&&this.init(),this.node&&e<=this.node.audioNode.gain.maxValue&&e>=this.node.audioNode.gain.minValue&&(this.node.audioNode.gain.value=e,this.volume=e)}}t.StageInputVolume=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioWorkletAgent=void 0;const n=r(10),i=r(128),o=r(74);let s="NOTREADY",a=null;class c extends n.EventEmitter{constructor(e){super(),this.outputCnt=0,this.inputCnt=0,this.node=new o.NeAudioNodeNullable("AudioWorkletAgent",null),this.logger=e.logger.getChild((()=>{let e="AudioWorkletAgent";return"READY"!==s&&(e+=" "+s),e}));const t=e.context;this.support={context:t}}async init(){this.support.audioWorkletNode?this.logger.error("Already Inited"):this.support.context.audioWorklet?(a?"LOADING"===s&&await a:(s="LOADING",this.logger.log("正在载入 audioWorkletAgentProcessor 模块"),a=this.support.context.audioWorklet.addModule(i.getBlobUrl("audioWorkletAgentProcessor")),await a,s="READY",this.logger.log("载入 audioWorkletAgentProcessor 模块成功")),this.support.audioWorkletNode=new AudioWorkletNode(this.support.context,"audioWorkletAgentProcessor"),this.node.updateNode(this.support.audioWorkletNode),this.bindProcessorEvents()):this.logger.error("该环境不支持音频处理")}outputData(e){if(!this.support.audioWorkletNode)throw new Error("Destroyed");this.inputCnt++,this.support.audioWorkletNode.port.postMessage({type:"outputData",data:e})}bindProcessorEvents(){this.removeAllListeners("rawinputs"),this.support.audioWorkletNode.port.onmessage=e=>{this.emit("processor-message",e),"rawinputs"===e.data.type?this.handleTypeRawInputs(e):"bufferDrop"===e.data.type?this.logger.warn(`音频处理程序刚刚丢弃了${5*e.data.cnt}ms的处理数据`):console.error("Unknown message",e)}}handleTypeRawInputs(e){this.outputCnt++,this.emit("rawinputs",e.data)}}t.AudioWorkletAgent=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.StageDelay=void 0;const n=r(158),i=r(74);class o extends n.StageBase{constructor(e){super(e),this.type="stageDelay",this.node=null,this.delayTime=1}async init(){"UNINIT"===this.state&&(this.node=new i.NeAudioNode("delay",this.context.createDelay(10)),this.state="INITED",this.node.audioNode.delayTime.value=this.delayTime)}isTransparent(){return this.delayTime<.01}setDelay(e){"UNINIT"===this.state&&this.init(),this.node&&(this.delayTime=e,this.node.audioNode.delayTime.value=e)}}t.StageDelay=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMix=void 0;const n=r(74),i=r(68),o=r(157);class s extends i.RTCEventEmitter{constructor(e){super(),this.pipeline=e,this.context=e.context;const t=new n.NeAudioNode("AudioMixingGain",this.context.createGain());this.node=t,this.mixAudioConf={audioFilePath:"",state:"MIX_UNSTART",buffer:null,cachedBuffers:{},audioSource:null,gainFilter:t,replace:!1,loopback:!1,cycle:0,pauseTime:0,startTime:0,totalTime:0,volume:1,playStartTime:0,setPlayStartTime:0,auidoMixingEnd:null},this.logger=e.logger.getChild((()=>"AudioMix "+this.mixAudioConf.state))}async startAudioMixing(e){if((null==e?void 0:e.audioFilePath)?this.logger.log("即将开始伴音:",JSON.stringify(e,null," ")):this.logger.error("startAudioMixing:未指定伴音文件"),Object.assign(this.mixAudioConf,e),this.mixAudioConf.audioFilePath){if(this.mixAudioConf.cachedBuffers[this.mixAudioConf.audioFilePath])return this.mixAudioConf.buffer=this.mixAudioConf.cachedBuffers[this.mixAudioConf.audioFilePath],this.logger.log("即将从缓存播放伴音",this.mixAudioConf.audioFilePath),this.startMix();{this.logger.log("即将加载云端音乐",this.mixAudioConf.audioFilePath),this.mixAudioConf.state="MIX_STARTING";const e=await this.loadAudioBuffer(this.mixAudioConf.audioFilePath);if("MIX_STARTING"===this.mixAudioConf.state)return this.mixAudioConf.buffer=e,this.startMix();this.logger.warn("startAudioMixing: 播放行为被覆盖")}}}stopAudioMixing(e=!1){return this.mixAudioConf.audioSource?(this.logger.log("即将停止混音"),this.mixAudioConf.audioSource.audioNode.onended=null,this.mixAudioConf.audioSource.disconnect(this.mixAudioConf.gainFilter),this.mixAudioConf.audioSource.audioNode.stop(),this.mixAudioConf.audioSource=null):this.logger.warn("stopAudioMixing:当前没有在混音"),this.mixAudioConf.startTime=0,this.mixAudioConf.pauseTime=0,this.mixAudioConf.playStartTime=0,e&&this.resetMixConf(),this.mixAudioConf.state="MIX_STOPED",this.pipeline.updateConnection(),this.logger.log("混音已停止"),Promise.resolve()}pauseAudioMixing(){if(!this.mixAudioConf.audioSource)return void this.logger.error("pauseAudioMixing:参数不够");this.logger.log("暂停混音"),this.mixAudioConf.audioSource.audioNode.onended=null,this.mixAudioConf.audioSource.disconnect(this.mixAudioConf.gainFilter),this.mixAudioConf.audioSource.audioNode.stop(),this.mixAudioConf.audioSource.disconnectToAll(),this.mixAudioConf.audioSource=null,this.mixAudioConf.pauseTime=Date.now(),this.mixAudioConf.state="MIX_PAUSED";let e=(this.mixAudioConf.pauseTime-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return this.logger.log("已经播放的时间: ",e),e>this.mixAudioConf.totalTime&&(e%=this.mixAudioConf.totalTime),this.logger.log("暂停位置:",e),Promise.resolve()}resumeAudioMixing(){let e,t=(this.mixAudioConf.pauseTime-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return t>this.mixAudioConf.totalTime&&(this.logger.log("播放过的圈数 playedCycle: ",Math.floor(t/this.mixAudioConf.totalTime)),this.mixAudioConf.cycle=this.mixAudioConf.cycle-Math.floor(t/this.mixAudioConf.totalTime)),this.mixAudioConf.setPlayStartTime?(this.logger.log("暂停期间，用户设置混音播放时间: ",this.mixAudioConf.setPlayStartTime),e=this.mixAudioConf.setPlayStartTime,this.mixAudioConf.setPlayStartTime=0):(this.logger.log("恢复混音:",this.mixAudioConf),this.logger.log("已经播放的时间: ",t),t>this.mixAudioConf.totalTime&&(t%=this.mixAudioConf.totalTime),e=t),this.logger.log("回复重置的时间点：",e),this.mixAudioConf.playStartTime=e,this.startMix()}setAudioMixingVolume(e){if(e<=255&&e>=0){const t=e/255;this.logger.log(`setAudioMixingVolume ${this.mixAudioConf.gainFilter.audioNode.gain.value} => ${t}`),this.mixAudioConf.gainFilter.audioNode.gain.value=e/255,this.mixAudioConf.volume=this.mixAudioConf.gainFilter.audioNode.gain.value}else this.logger.error("setAudioMixingVolume: volume不在0~255范围内：",e)}getAudioMixingPlayedTime(){let e=Date.now();"MIX_PAUSED"==this.mixAudioConf.state&&this.mixAudioConf.pauseTime&&(this.logger.log("当前是暂停状态"),e=this.mixAudioConf.pauseTime);let t=(e-this.mixAudioConf.startTime)/1e3+this.mixAudioConf.playStartTime;return t>this.mixAudioConf.totalTime&&(t%=this.mixAudioConf.totalTime),{playedTime:t}}getAudioMixingTotalTime(){return{totalTime:this.mixAudioConf.totalTime}}startMix(){if(this.logger.log("startMix: ",this.mixAudioConf),this.mixAudioConf.buffer){if(this.mixAudioConf.audioSource&&this.mixAudioConf.audioSource.disconnectToAll(),this.mixAudioConf.audioSource=new n.NeAudioNode("AudioMixBufferSource",this.pipeline.context.createBufferSource()),this.mixAudioConf.audioSource.audioNode.buffer=this.mixAudioConf.buffer,this.mixAudioConf.audioSource.connect(this.mixAudioConf.gainFilter),this.mixAudioConf.audioSource.audioNode.onended=e=>{this.audioEnd(e)},this.mixAudioConf.totalTime=this.mixAudioConf.buffer.duration,(this.mixAudioConf.playStartTime<0||this.mixAudioConf.playStartTime>=this.mixAudioConf.totalTime)&&(this.mixAudioConf.playStartTime=0),this.logger.log("设置音量:",this.mixAudioConf.volume),this.mixAudioConf.gainFilter.audioNode.gain.value=this.mixAudioConf.volume,this.mixAudioConf.loopback&&this.mixAudioConf.cycle>1){this.mixAudioConf.audioSource.audioNode.loop=this.mixAudioConf.loopback;const e=this.mixAudioConf.cycle*this.mixAudioConf.totalTime-this.mixAudioConf.playStartTime;this.logger.log("循环播放: options.playStartTime: ",this.mixAudioConf.playStartTime),this.logger.log("循环播放: totalTime: ",e),this.mixAudioConf.audioSource.audioNode.start(0,this.mixAudioConf.playStartTime,e-1)}else this.mixAudioConf.loopback&&1==this.mixAudioConf.cycle?(this.mixAudioConf.audioSource.audioNode.loop=!1,this.mixAudioConf.audioSource.audioNode.start(0,this.mixAudioConf.playStartTime)):(this.logger.log("无限循环播放 loop: ",this.mixAudioConf.loopback),this.mixAudioConf.audioSource.audioNode.loop=this.mixAudioConf.loopback,this.mixAudioConf.audioSource.audioNode.start(0,this.mixAudioConf.playStartTime));return this.mixAudioConf.state="MIX_PLAYING",this.mixAudioConf.startTime=Date.now(),this.pipeline.updateConnection(),Promise.resolve()}this.logger.error("startMix: 缺少 mixAudioConf.buffer")}audioEnd(e){return"MIX_PLAYING"!==this.mixAudioConf.state?void this.logger.error("audioEnd:状态不对"):this.mixAudioConf.audioSource&&this.mixAudioConf.audioSource.audioNode.loop&&this.mixAudioConf.cycle<=0?void this.logger.log("无限循环时，伴音播放完成event: ",e):(this.logger.log("伴音播放完成: ",this.mixAudioConf),this.mixAudioConf.audioSource&&(this.mixAudioConf.audioSource.audioNode.onended=null),this.mixAudioConf.auidoMixingEnd&&(this.mixAudioConf.auidoMixingEnd(e),this.mixAudioConf.auidoMixingEnd=null),this.resetMixConf(),this.pipeline.updateConnection(),Promise.resolve())}async loadAudioBuffer(e){let t,r;this.mixAudioConf.cachedBuffers[e]?this.logger.warn(`loadAudioBuffer: 该文件已有缓存，长度：${this.mixAudioConf.cachedBuffers[e].duration} 秒。即将更新该文件地址：${e}`):this.logger.warn("loadAudioBuffer: 开始加载文件。地址："+e);try{t=await o.ajax({url:e,type:"GET",dataType:"arraybuffer"})}catch(e){throw this.logger.error("loadAudioBuffer 加载云端音乐失败: ",e),e}this.logger.log(`loadAudioBuffer 文件下载成功。大小：${Math.floor(t.byteLength/1024)} KB`);try{r=await this.pipeline.context.decodeAudioData(t)}catch(e){throw this.logger.log("loadAudioBuffer 解码失败:",e),e}return this.logger.log(`loadAudioBuffer 解码成功。长度：${r.duration} 秒。`),this.mixAudioConf.cachedBuffers[e]=r,r}resetMixConf(){this.mixAudioConf.audioSource&&(this.mixAudioConf.audioSource.disconnect(this.mixAudioConf.gainFilter),this.mixAudioConf.audioSource=null),this.mixAudioConf.audioFilePath="",this.mixAudioConf.buffer=null,this.mixAudioConf.state="MIX_UNSTART",this.mixAudioConf.replace=!1,this.mixAudioConf.cycle=0,this.mixAudioConf.pauseTime=0,this.mixAudioConf.startTime=0,this.mixAudioConf.totalTime=0,this.mixAudioConf.volume=1,this.mixAudioConf.playStartTime=0,this.mixAudioConf.setPlayStartTime=0,this.mixAudioConf.auidoMixingEnd=null,this.emit("audioFilePlaybackCompleted")}}t.AudioMix=s},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createCanvasWatermarkControl=t.CanvasWatermarkControl=void 0;const i=n(r(194)),o=r(10),s=r(65),a=r(195);class c extends o.EventEmitter{constructor(e){super(),this.logger=e,this.settings={defaultStyle:{background:"rgba(128,128,128, 0.5)",overflow:"hidden","white-space":"break-spaces",position:"absolute",wordBreak:"break-all",color:"white",fontSize:"10pt"}},this.watermarks=[],this.div=null}checkWatermarkParams(e){e.textWatermarks&&e.textWatermarks.forEach((e=>{const t={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.fontSize",value:e.fontSize,min:1};s.isExistOptions(t).result&&s.checkValidInteger(t);const r={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.fontColor",value:e.fontColor,min:0};s.isExistOptions(r).result&&s.checkValidInteger(r);const n={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.wmWidth",value:e.wmWidth,min:0};s.isExistOptions(n).result&&s.checkValidInteger(n);const i={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.wmHeight",value:e.wmHeight,min:0};s.isExistOptions(i).result&&s.checkValidInteger(i);const o={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.offsetX",value:e.offsetX};s.isExistOptions(o).result&&s.checkValidInteger(o);const a={tag:"Stream.setCanvasWatermarkConfigs:textWatermarks.offsetY",value:e.offsetY};s.isExistOptions(a).result&&s.checkValidInteger(a)})),e.timestampWatermarks&&[e.timestampWatermarks].forEach((e=>{const t={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.fontSize",value:e.fontSize,min:1};s.isExistOptions(t).result&&s.checkValidInteger(t);const r={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.fontColor",value:e.fontColor,min:0};s.isExistOptions(r).result&&s.checkValidInteger(r);const n={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.wmWidth",value:e.wmWidth,min:0};s.isExistOptions(n).result&&s.checkValidInteger(n);const i={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.wmHeight",value:e.wmHeight,min:0};s.isExistOptions(i).result&&s.checkValidInteger(i);const o={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.offsetX",value:e.offsetX};s.isExistOptions(o).result&&s.checkValidInteger(o);const a={tag:"Stream.setCanvasWatermarkConfigs:timestampWatermarks.offsetY",value:e.offsetY};s.isExistOptions(a).result&&s.checkValidInteger(a)})),e.imageWatermarks&&e.imageWatermarks.forEach((e=>{const t={tag:"Stream.setCanvasWatermarkConfigs.imageWatermarks.wmWidth",value:e.wmWidth,min:0};s.isExistOptions(t).result&&s.checkValidInteger(t);const r={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.wmHeight",value:e.wmHeight,min:0};s.isExistOptions(r).result&&s.checkValidInteger(r);const n={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.offsetX",value:e.offsetX};s.isExistOptions(n).result&&s.checkValidInteger(n);const i={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.offsetY",value:e.offsetY};s.isExistOptions(i).result&&s.checkValidInteger(i);const o={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.imageUrls",value:e.imageUrls};s.checkExists(o);const a={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.imageUrls.length",value:e.imageUrls.length,min:1};s.checkValidInteger(a);const c={tag:"Stream.setCanvasWatermarkConfigs:imageWatermarks.fps",value:e.fps,min:0};s.isExistOptions(c).result&&s.checkValidFloat(c)}))}updateWatermarks(e){this.clear(),this.watermarks=[],e.imageWatermarks&&e.imageWatermarks.forEach((e=>{const t=Object.assign({},this.settings.defaultStyle,{background:"none"});let r;"number"==typeof e.offsetX?t.left=e.offsetX+"px":e.offsetX&&"string"==typeof e.offsetX&&(t.left=e.offsetX),"number"==typeof e.offsetY?t.top=e.offsetY+"px":e.offsetY&&"string"==typeof e.offsetY&&(t.top=e.offsetY),0!==e.wmWidth&&0!==e.wmHeight||(delete e.wmWidth,delete e.wmHeight),e.wmWidth&&("number"==typeof e.wmWidth?t.width=e.wmWidth+"px":"string"==typeof e.wmWidth&&(t.width=e.wmWidth)),e.wmHeight&&("number"==typeof e.wmHeight?t.height=e.wmHeight+"px":"string"==typeof e.wmHeight&&(t.height=e.wmHeight)),"number"==typeof e.wmHeight?t.height=e.wmHeight+"px":e.wmHeight&&"string"==typeof e.wmHeight&&(t.height=e.wmHeight),r=e.fps?{type:"image",content:"",imageUrls:e.imageUrls,loop:!(!1===e.loop),loopIndex:0,interval:1e3/(e.fps||1),elem:null,style:t}:{type:"image",content:"",imageUrls:[e.imageUrls[e.imageUrls.length-1]],loop:!1,loopIndex:0,interval:0,elem:null,style:t},this.watermarks.push(r)})),e.textWatermarks&&e.textWatermarks.forEach((e=>{let t=e.content||"";const r=Object.assign({},this.settings.defaultStyle);"number"==typeof e.fontColor?r.color=a.numberToRGBA(e.fontColor):e.fontColor&&"string"==typeof e.fontColor&&(r.color=e.fontColor),"number"==typeof e.fontSize?r.fontSize=e.fontSize+"pt":e.fontSize&&"string"==typeof e.fontSize&&(r.fontSize=e.fontSize),"number"==typeof e.offsetX?r.left=e.offsetX+"px":e.offsetX&&"string"==typeof e.offsetX&&(r.left=e.offsetX),"number"==typeof e.offsetY?r.top=e.offsetY+"px":e.offsetY&&"string"==typeof e.offsetY&&(r.top=e.offsetY),!e.wmWidth&&!e.wmHeight||0===e.wmWidth||0===e.wmHeight?r.background="":"number"==typeof e.wmColor?r.background=a.numberToRGBA(e.wmColor):e.wmColor&&"string"==typeof e.wmColor&&(r.background=e.wmColor),e.wmWidth,"number"==typeof e.wmWidth?e.wmWidth>0&&(r.width=e.wmWidth+"px"):"string"==typeof e.wmWidth&&(r.width=e.wmWidth),e.wmHeight&&("number"==typeof e.wmHeight?(e.wmHeight>0&&(r.wmHeight=e.wmWidth+"px"),r.height=e.wmHeight+"px"):"string"==typeof e.wmHeight&&(r.height=e.wmHeight));const n={type:"text",content:t,loop:!1,elem:null,loopIndex:0,style:r};this.watermarks.push(n)})),e.timestampWatermarks&&[e.timestampWatermarks].forEach((e=>{const t=Object.assign({},this.settings.defaultStyle);"number"==typeof e.fontColor?t.color=a.numberToRGBA(e.fontColor):e.fontColor&&"string"==typeof e.fontColor&&(t.color=e.fontColor),"number"==typeof e.fontSize?t.fontSize=e.fontSize+"pt":e.fontSize&&"string"==typeof e.fontSize&&(t.fontSize=e.fontSize),"number"==typeof e.offsetX?t.left=e.offsetX+"px":e.offsetX&&"string"==typeof e.offsetX&&(t.left=e.offsetX),"number"==typeof e.offsetY?t.top=e.offsetY+"px":e.offsetY&&"string"==typeof e.offsetY&&(t.top=e.offsetY),!e.wmWidth&&!e.wmHeight||0===e.wmWidth||0===e.wmHeight?t.background="":"number"==typeof e.wmColor?t.background=a.numberToRGBA(e.wmColor):e.wmColor&&"string"==typeof e.wmColor&&(t.background=e.wmColor),e.wmWidth&&("number"==typeof e.wmWidth?t.width=e.wmWidth+"px":"string"==typeof e.wmWidth&&(t.width=e.wmWidth)),e.wmHeight&&("number"==typeof e.wmHeight?t.height=e.wmHeight+"px":"string"==typeof e.wmHeight&&(t.height=e.wmHeight));const r={type:"timestamp",content:"yyyy-mm-dd HH:MM:ss",loop:!1,loopIndex:0,elem:null,style:t};this.watermarks.push(r)})),this.div&&this.start(this.div)}start(e){this.clear(),this.div=e,this.watermarks.forEach((t=>{let r;switch(t.type){case"text":r=document.createElement("pre"),r.className="nim-watermark nim-watermark-text",r.innerText=t.content||"",Object.assign(r.style,t.style);break;case"timestamp":r=document.createElement("pre"),r.className="nim-watermark nim-watermark-timestamp",r.innerText="",Object.assign(r.style,t.style);break;case"image":!t.imageUrls&&t.content&&(t.imageUrls=[t.content]),r=document.createElement("div"),r.className="nim-watermark nim-watermark-image-container",t.imgElems=[],t.imageUrls&&t.imageUrls.length&&t.imageUrls.forEach(((e,n)=>{const i=document.createElement("img");i.className="nim-watermark nim-watermark-image nim-watermark-image-"+n,i.src=e,i.style.width="100%",t.style.height&&(i.style.height="100%"),i.style.overflow="hidden",t.imgElems&&t.imgElems.push(i),r.appendChild(i),n>0&&(i.style.display="none")})),t.loopIndex=-1;const e=()=>{if(!t.interval&&t.imgElems&&t.loopIndex>=0)t.imgElems[t.loopIndex].style.display="";else{if(t.imgElems&&t.imgElems[t.loopIndex]&&(t.imgElems[t.loopIndex].style.display="none"),t.loopIndex++,t.imgElems&&t.loopIndex>=t.imgElems.length){if(!t.loop)return void(t.loopTimer&&clearInterval(t.loopTimer));t.loopIndex=0}t.imgElems&&(t.imgElems[t.loopIndex].style.display="")}};e(),t.interval&&(t.loopTimer=setInterval(e,t.interval)),Object.assign(r.style,t.style)}t.elem=r,e.appendChild(t.elem)}))}clear(){this.div&&this.watermarks.forEach((e=>{e.elem&&(e.elem.remove(),e.elem=null),e.loopTimer&&clearTimeout(e.loopTimer)}))}}t.CanvasWatermarkControl=c;const u=new class{constructor(){this.controls=[],this.timer=setInterval((()=>{this.updateTimestamps()}),1e3)}updateTimestamps(){this.controls.forEach((e=>{e.watermarks.filter((e=>"timestamp"===e.type)).forEach((e=>{e.elem&&(e.elem.innerText=i.default(new Date,e.content||"yyyy-mm-dd HH:MM:ss"))}))}))}};t.createCanvasWatermarkControl=function(e){const t=new c(e);return u.controls.push(t),t}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createEncoderWatermarkControl=t.EncoderWatermarkControl=void 0;const i=n(r(194)),o=r(10),s=r(65),a=r(4),c=r(195);class u extends o.EventEmitter{constructor(e){super(),this.logger=e,this.settings={defaultStyle:{left:0,top:0,textWidth:0,textHeight:0,fontSize:"15pt",fontFamily:a.getParameters().encoderWatermarkFontFamily,fillStyle:"white",textBaseline:"hanging",bgWidth:-1,bgHeight:-1,bgFillStyle:"rgba(136, 136, 136, 0.5)"}},this.watermarks=[],this.handler={name:"watermark",enabled:!1,func:this.handleFrame.bind(this)}}handleFrame(e,t,r){this.watermarks.forEach((e=>{if("text"===e.type||"timestamp"===e.type){let t="";t="timestamp"===e.type?i.default(new Date,e.content||"yyyy-mm-dd HH:MM:ss"):e.content||"",r.canvasCtx.font=`${e.style.fontSize} ${e.style.fontFamily}`,r.canvasCtx.textBaseline=e.style.textBaseline,e.content,-1===e.style.bgWidth&&-1===e.style.bgHeight&&(e.style.bgWidth=e.style.textWidth,e.style.bgHeight=e.style.textHeight),e.style.bgWidth&&e.style.bgHeight&&(r.canvasCtx.fillStyle=e.style.bgFillStyle,r.canvasCtx.fillRect(e.style.left,e.style.top,e.style.bgWidth,e.style.bgHeight)),r.canvasCtx.fillStyle=e.style.fillStyle,r.canvasCtx.fillText(t,e.style.left,e.style.top)}if("image"===e.type&&e.imgElems){let t;if(e.interval){if(e.startMs&&e.interval){const r=Date.now()-e.startMs,n=Math.floor(r/e.interval);for(let r=n;r<n+e.imgElems.length;r++){const n=e.imgElems[e.loop?r%e.imgElems.length:r];if(n&&n.complete&&n.naturalWidth&&n.naturalHeight){t=n;break}}}}else e.imgElems[0].complete&&e.imgElems[0].naturalWidth&&e.imgElems[0].naturalHeight&&(t=e.imgElems[0]);if(t){let n,i;e.style.bgWidth>0&&e.style.bgHeight>0?(n=e.style.bgWidth,i=e.style.bgHeight):(n=t.naturalWidth,i=t.naturalHeight),r.canvasCtx.drawImage(t,e.style.left,e.style.top,n,i)}}}))}checkWatermarkParams(e){var t,r;const n={tag:"Stream.setEncoderWatermarkConfigs:watermarks.count",value:((null===(t=e.textWatermarks)||void 0===t?void 0:t.length)||0)+(e.timestampWatermarks?1:0)+((null===(r=e.imageWatermarks)||void 0===r?void 0:r.length)||0),max:a.getParameters().encoderWatermarkLimit};s.checkValidInteger(n),e.textWatermarks&&e.textWatermarks.forEach((e=>{const t={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.fontSize",value:e.fontSize,min:1,max:128};s.isExistOptions(t).result&&s.checkValidInteger(t);const r={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.fontColor",value:e.fontColor,min:0,max:4294967295};s.isExistOptions(r).result&&s.checkValidInteger(r);const n={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.wmWidth",value:e.wmWidth,min:0};s.isExistOptions(n).result&&s.checkValidInteger(n);const i={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.wmHeight",value:e.wmHeight,min:0};s.isExistOptions(i).result&&s.checkValidInteger(i);const o={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.offsetX",value:e.offsetX};s.isExistOptions(o).result&&s.checkValidInteger(o);const a={tag:"Stream.setEncoderWatermarkConfigs:textWatermarks.offsetY",value:e.offsetY};s.isExistOptions(a).result&&s.checkValidInteger(a)})),e.timestampWatermarks&&[e.timestampWatermarks].forEach((e=>{const t={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.fontSize",value:e.fontSize,min:1,max:128};s.isExistOptions(t).result&&s.checkValidInteger(t);const r={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.fontColor",value:e.fontColor,min:0,max:4294967295};s.isExistOptions(r).result&&s.checkValidInteger(r);const n={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.wmWidth",value:e.wmWidth,min:0};s.isExistOptions(n).result&&s.checkValidInteger(n);const i={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.wmHeight",value:e.wmHeight,min:0};s.isExistOptions(i).result&&s.checkValidInteger(i);const o={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.offsetX",value:e.offsetX};s.isExistOptions(o).result&&s.checkValidInteger(o);const a={tag:"Stream.setEncoderWatermarkConfigs:timestampWatermarks.offsetY",value:e.offsetY};s.isExistOptions(a).result&&s.checkValidInteger(a)})),e.imageWatermarks&&e.imageWatermarks.forEach((e=>{const t={tag:"Stream.setEncoderWatermarkConfigs.imageWatermarks.wmWidth",value:e.wmWidth,min:0};s.isExistOptions(t).result&&s.checkValidInteger(t);const r={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.wmHeight",value:e.wmHeight,min:0};s.isExistOptions(r).result&&s.checkValidInteger(r);const n={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.offsetX",value:e.offsetX};s.isExistOptions(n).result&&s.checkValidInteger(n);const i={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.offsetY",value:e.offsetY};s.isExistOptions(i).result&&s.checkValidInteger(i);const o={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.imageUrls",value:e.imageUrls};s.checkExists(o);const a={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.imageUrls.length",value:e.imageUrls.length,min:1,max:10};s.checkValidInteger(a);const c={tag:"Stream.setEncoderWatermarkConfigs:imageWatermarks.fps",value:e.fps,min:0,max:30};s.isExistOptions(c).result&&s.checkValidFloat(c)}))}updateWatermarks(e){this.watermarks=[],e.imageWatermarks&&e.imageWatermarks.forEach((e=>{const t=Object.assign({},this.settings.defaultStyle,{background:"none"});let r;if("number"==typeof e.offsetX?t.left=e.offsetX:e.offsetX,"number"==typeof e.offsetY?t.top=e.offsetY:e.offsetY,0!==e.wmWidth&&0!==e.wmHeight||(delete e.wmWidth,delete e.wmHeight),e.wmWidth&&"number"==typeof e.wmWidth&&(t.bgWidth=e.wmWidth),e.wmHeight&&"number"==typeof e.wmHeight&&(t.bgHeight=e.wmHeight),!1!==e.loop&&(e.loop=!0),r=e.fps?{type:"image",content:"",imageUrls:e.imageUrls,loop:!(!1===e.loop),loopIndex:0,interval:1e3/(e.fps||1),style:t}:{type:"image",content:"",imageUrls:[e.imageUrls[e.imageUrls.length-1]],loop:!1,loopIndex:0,interval:0,style:t},r.startMs=Date.now(),r.imgElems=[],r.imageUrls)for(let e=0;e<r.imageUrls.length;e++){const t=new Image;t.src=r.imageUrls[e],r.imgElems.push(t)}this.watermarks.push(r)})),e.textWatermarks&&e.textWatermarks.forEach((e=>{let t=e.content||"";const r=Object.assign({},this.settings.defaultStyle);"number"==typeof e.fontColor?r.fillStyle=c.numberToRGBA(e.fontColor):e.fontColor&&"string"==typeof e.fontColor&&(r.fillStyle=e.fontColor),"number"==typeof e.fontSize?r.fontSize=e.fontSize+"pt":e.fontSize&&"string"==typeof e.fontSize&&(r.fontSize=e.fontSize);const n=c.measureText(e.content,r.fontSize,r.fontFamily);r.textWidth=n.width,r.textHeight=n.height,e.offsetX&&(r.left=e.offsetX),e.offsetY&&(r.top=e.offsetY),e.wmColor,e.wmWidth>=0&&(r.bgWidth=e.wmWidth),e.wmHeight>=0&&(r.bgHeight=e.wmHeight),"number"==typeof e.wmColor?r.bgFillStyle=c.numberToRGBA(e.wmColor):e.wmColor&&"string"==typeof e.wmColor&&(r.bgFillStyle=e.wmColor);const i={type:"text",content:t,loop:!1,loopIndex:0,style:r};this.watermarks.push(i)})),e.timestampWatermarks&&[e.timestampWatermarks].forEach((e=>{const t=Object.assign({},this.settings.defaultStyle);"number"==typeof e.fontColor?t.fillStyle=c.numberToRGBA(e.fontColor):e.fontColor&&"string"==typeof e.fontColor&&(t.fillStyle=e.fontColor),"number"==typeof e.fontSize?t.fontSize=e.fontSize+"pt":e.fontSize&&"string"==typeof e.fontSize&&(t.fontSize=e.fontSize);const r=c.measureText("yyyy-mm-dd HH:MM:ss",t.fontSize,t.fontFamily);t.textWidth=r.width,t.textHeight=r.height,e.offsetX&&(t.left=e.offsetX),e.offsetY&&(t.top=e.offsetY),e.wmWidth>=0&&(t.bgWidth=e.wmWidth),e.wmHeight>=0&&(t.bgHeight=e.wmHeight),"number"==typeof e.wmColor?t.bgFillStyle=c.numberToRGBA(e.wmColor):e.wmColor&&"string"===e.wmColor&&(t.bgFillStyle=e.wmColor);const n={type:"timestamp",content:"yyyy-mm-dd HH:MM:ss",loop:!1,loopIndex:0,style:t};this.watermarks.push(n)}))}}t.EncoderWatermarkControl=u,t.createEncoderWatermarkControl=function(e){return new u(e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.playMedia=void 0;const n=r(73);t.playMedia=function(e,t){return new Promise(((r,i)=>{let o=setTimeout((()=>{o&&(o=null,r())}),t);const s=e.play();n.printForLongPromise(s,"媒体标签仍在启动播放中"),s.then((()=>{o&&(clearTimeout(o),o=null,r())})),s.catch((e=>{o&&(clearTimeout(o),o=null,i(e))}))}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parseBase64=void 0;const n=r(285);let i;t.parseBase64=function(e){var t=e.length,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(!i){i=[];for(var o=0;o<65;o++)i[r.charCodeAt(o)]=o}var s=r.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function(e,t,r){for(var i=[],o=0,s=0;s<t;s++)if(s%4){var a=r[e.charCodeAt(s-1)]<<s%4*2|r[e.charCodeAt(s)]>>>6-s%4*2;i[o>>>2]|=a<<24-o%4*8,o++}return new n.WordArray(i,o)}(e,t,i)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.WordArray=t.Hex=void 0,t.Hex={stringify(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")}},t.WordArray=class{constructor(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length}toString(e){return(e||t.Hex).stringify(this)}concat(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(var a=0;a<i;a+=4)t[n+a>>>2]=r[a>>>2];return this.sigBytes+=i,this}clamp(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTSTransport=void 0;const i=r(10),o=n(r(12)),s=n(r(13));class a extends i.EventEmitter{constructor(e){super(),this._reset(),this.adapterRef=e.adapterRef,this._url=e.url,this._port=e.port,this._transportId=e.transportId,this._ws=null,this.initSocket()}get transportId(){return this._transportId}_reset(){this._url="",this._port=0,this._ws=null}initSocket(){if(this.adapterRef.logger.log("RTSTransport建立连接, url: ",this._url),!this._url)throw new s.default({code:o.default.NETWORK_ERROR,message:"initSocket: RTSTransport 的 url 未找到"});this._ws=new WebSocket(this._url,["protoo"]),this._ws.binaryType="arraybuffer";const e=this._ws;e.onopen=this._onOpen.bind(this),e.onmessage=this._onMessage.bind(this),e.onclose=this._onClose.bind(this),e.onerror=this._onError.bind(this)}_onOpen(e){this.adapterRef.logger.log("RTSTransport:_onOpen"),this.emit("open",e)}_onMessage(e){this.adapterRef.instance.emit("rts-stream-data",e)}_onClose(e){this.adapterRef.logger.log("RTSTransport:onClose <- ",e),this.emit("close",e)}_onError(e){this.adapterRef.logger.log("RTSTransport:onError <- ",e),this.emit("error",e)}send(e){this._ws&&this._ws.readyState===WebSocket.OPEN?this._ws.send(JSON.stringify(e)):this.adapterRef.logger.log("RTSTransport:send: 当前不能发送，等待ws连接成功之后发送")}_close(){this.adapterRef.logger.log("RTSTransport:close"),this._ws&&(this._ws.onclose=null,this._ws.onerror=null,this._ws.onopen=null,this._ws.onmessage=null,this._ws.close(),this._ws=null)}destroy(){this.adapterRef.logger.log("WSTransport:destroy"),this._close(),this._url=null}}t.RTSTransport=a},function(e,t,r){var n=r(288),i=r(290);t.Peer=n,t.WebSocketTransport=i},function(e,t,r){var n=o(r(60)),i=o(r(61));function o(e){return e&&e.__esModule?e:{default:e}}var s=r(145),a=r(196),c=r(197),u=r(4).getParameters,l=new s("Peer"),d=0;e.exports=class extends a{constructor(e){super(l),l.debug("constructor()"),this._closed=!1,this.id=d++,this._transport=e,this._connected=!1,this._data={createTs:Date.now()},this._sents=new Map,this._notificationId=0,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){l.debug("close()"),this._closed=!0,this._connected=!1,this._notificationId=0,this._transport.close(),this._transport=null;var e=!0,t=!1,r=void 0;try{for(var n,i=this._sents.values()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0)n.value.close()}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}this._sents.clear()}}clear(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._sents.values()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0)n.value.close()}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}this._sents.clear()}request(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return(0,i.default)(n.default.mark((function i(){var o;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=c.createRequest(e,r),"Heartbeat"!=e&&t._logger.debug("request() [method: "+e+", id: "+o.id+"]"),n.next=4,t._transport.send(o);case 4:return n.abrupt("return",new Promise((function(e,r){var n=u().protooMessageTimeout,i={id:o.id,method:o.method,startTs:Date.now(),resolve:function(r){t._sents.delete(o.id)&&(t._closed||(clearTimeout(i.timer),e(r)))},reject:function(e){t._sents.delete(o.id)&&(clearTimeout(i.timer),r(e))},timer:setTimeout((function(){t._sents.delete(o.id)&&r(new Error("request timeout"))}),n),close:function(){var e=new Error;e.name="peer closed",i.method&&(e.message="向edge的 "+i.method+" 请求被取消：连接 #"+t.id+" 已被关闭。连接建立时间："+(t._data.openTs-t._data.createTs)+"ms, 请求时间："+(Date.now()-i.startTs)+"ms"),r(e)}};t._sents.set(o.id,i)})));case 5:case"end":return n.stop()}}),i,t)})))()}notify(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return(0,i.default)(n.default.mark((function i(){var o;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=c.createNotification(e,r),t._logger.debug("notify() [method:%s]",e),n.next=4,t._transport.send(o);case 4:case"end":return n.stop()}}),i,t)})))()}_handleTransport(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){e._closed||(e._connected=!1,e.safeEmit("close"))}));this._transport.on("open",(function(){e._closed||(l.debug('emit "open"'),e._connected=!0,e._data.openTs=Date.now(),e.safeEmit("open"))})),this._transport.on("disconnected",(function(){e._closed||(l.debug('emit "disconnected"'),e._connected=!1,e.safeEmit("disconnected"))})),this._transport.on("failed",(function(t){e._closed||(l.debug('emit "failed" [currentAttempt:%s]',t),e._connected=!1,e.safeEmit("failed",t))})),this._transport.on("close",(function(){e._closed||(e._closed=!0,l.debug('emit "close"'),e._connected=!1,e.safeEmit("close"))})),this._transport.on("message",(function(t){t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t)}))}_handleRequest(e){var t=this;try{this.emit("request",e,(function(r){var n=c.createSuccessResponse(e,r);t._transport.send(n).catch((function(){}))}),(function(r,n){r instanceof Error?(r=500,n=String(r)):"number"==typeof r&&n instanceof Error&&(n=String(n));var i=c.createErrorResponse(e,r,n);t._transport.send(i).catch((function(){}))}))}catch(t){var r=c.createErrorResponse(e,500,String(t));this._transport.send(r).catch((function(){}))}}_handleResponse(e){var t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else l.error("received response does not match any sent request",e.id,JSON.stringify(e))}_handleNotification(e){if(this._handleNotification>e.id)l.warn("忽略重复的通知消息: ",JSON.stringify(e,null," "));else{this._notificationId=e.id;var t=c.createSuccessResponse(e,{});this._transport.send(t).catch((function(){})),this.safeEmit("notification",e)}}}},function(e,t,r){t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){var n=o(r(60)),i=o(r(61));function o(e){return e&&e.__esModule?e:{default:e}}var s=r(291),a=r(145),c=r(196),u=r(197),l=r(119).JSONBigStringify,d={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},p=new a("WebSocketTransport"),m=0;e.exports=class extends c{constructor(e,t){super(p),p.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this.wsid=0,this.skipReconnection=!1,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){p.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){p.error("close() | error closing the WebSocket: %o",e)}}}send(e){var t=this;return(0,i.default)(n.default.mark((function r(){return n.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t._closed){r.next=2;break}throw new Error("transport closed");case 2:r.prev=2,t._ws.send(l(e)),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),p.warn("send() failed:",r.t0.name,r.t0.message),r.t0;case 10:case"end":return r.stop()}}),r,t,[[2,6]])})))()}_runWebSocket(){var e=this,t=s.operation(this._options.retry||d),r=!1;t.attempt((function(n){e._closed?t.stop():(p.debug("_runWebSocket() [currentAttempt:%s]",n),e._ws=new WebSocket(e._url,["protoo"]),m++,e.wsid=m,e._ws.onopen=function(){e._closed||(r=!0,e.safeEmit("open"))},e._ws.onclose=function(i){if(!e._closed)if(p.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',i.wasClean,i.code,i.reason),r){if(t.stop(),e.safeEmit("disconnected"),e._closed||e.skipReconnection)return;e._runWebSocket()}else e.safeEmit("failed",n),e._closed||t.retry(!0)||(e._closed=!0,e.safeEmit("close"))},e._ws.onerror=function(){e._closed||p.error('WebSocket "error" event')},e._ws.onmessage=function(t){if(!e._closed){var r=u.parse(t.data);r&&(0!==e.listenerCount("message")?e.safeEmit("message",r):p.error('no listeners for WebSocket "message" event, ignoring received message'))}})}))}}},function(e,t,r){e.exports=r(292)},function(e,t,r){var n=r(293);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var o=0;o<n.length;o++){var s=n[o],a=e[s];e[s]=function(n){var i=t.operation(r),o=Array.prototype.slice.call(arguments,1),s=o.pop();o.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))})),i.attempt((function(){n.apply(e,o)}))}.bind(e,a),e[s].options=r}}},function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,i=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&i.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,s=(e[o]||0)+1;e[o]=s,s>=r&&(t=i,r=s)}return t}},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LBSManager=void 0;const i=r(62),o=r(157),s=n(r(12)),a=n(r(13)),c=r(57),u=r(4),l=r(119);var d;!function(e){e[e.UNKNOWN_ERROR=99999]="UNKNOWN_ERROR",e[e.TIMEOUT=70100]="TIMEOUT",e[e.JSON_ERROR=70101]="JSON_ERROR",e[e.FORMAT_ERROR=70102]="FORMAT_ERROR"}(d||(d={})),t.LBSManager=class{constructor(e){this.urlBackupMap={},this.requestCnt=0,this.localStorageKey="LBS_CONFIG",this.builtinConfig=i.LBS_BUILD_CONFIG,this.updateTimer=null,this.lastUpdateStartAt=0,this.lastUpdate=null,this.tagToMainDomain={},this.lbsState="uninit",this.lbsStateWillChangeTimer=null,this.client=e,this.logger=e.logger.getChild((()=>{let e="LBSManager "+this.lbsState;return this.client.adapterRef.lbsManager!==this&&(e+="DETACHED"),e})),window.addEventListener("online",(()=>{"DISCONNECTED"!==this.client.adapterRef.connectState.curState&&this.client.adapterRef.lbsManager===this&&(this.logger.log("侦测到网络连接恢复，尝试更新LBS配置"),this.startUpdate("online"))}))}async startUpdate(e){var t,r,n;if(!this.client._params.appkey)return void this.logger.error("无法更新域名配置：缺少appkey");if(null===(n=null===(r=null===(t=this.client)||void 0===t?void 0:t._params)||void 0===r?void 0:r.neRtcServerAddresses)||void 0===n?void 0:n.channelServer)return void this.logger.log("忽略更新LBS配置请求：当前为私有化配置");const o=Date.now(),s=o-this.lastUpdateStartAt;if(s<3e3)return void this.logger.log(`startUpdate 忽略更新请求 ${e}: 上次更新于 ${s} 毫秒前`);this.lastUpdateStartAt=o,this.logger.log("startUpdate: 开始更新LBS配置。原因："+e);let a=null;try{a=await this.ajax({url:`${i.lbsUrl}?reason=${e}&sdkVersion=${encodeURIComponent(i.SDK_VERSION)}&appKey=${encodeURIComponent(this.client._params.appkey)}&business=rtc&clientType=16`,type:"GET",header:{}})}catch(e){this.logger.error("LBS更新失败！",e)}if(this.getReportField("lbs").forEach((e=>{this.client.apiEventReport("setRequestLbs",e)})),a&&a.nrtc&&a.call&&a.tracking)return a.ttl&&(this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout((()=>{this.logger.log("LBS已到过期时间，正在回滚至内建设置"),this.loadBuiltinConfig("expire")}),1e3*a.ttl)),this.lastUpdate={activeFrom:Date.now(),res:a},this.handleLbsStateWillChange(e),this.addUrlBackup(this.tagToMainDomain.nrtc,a.nrtc,"nrtc","lbs"),this.addUrlBackup(this.tagToMainDomain.call,a.call,"call","lbs"),this.addUrlBackup(this.tagToMainDomain.tracking,a.tracking,"tracking","lbs"),this.lbsState="remote",this.logger.log(`成功加载远端配置。过期时间：${a.ttl}秒后。preloadTimeSec:${a.preloadTimeSec}：`),this.client.safeEmit("@lbs-config-update",{reason:e}),this.saveConfig(a),a;this.logger.error("startUpdate更新失败：无效的 LBS 返回",a)}async loadBuiltinConfig(e){"uninit"!==this.lbsState&&this.handleLbsStateWillChange(e);for(let e in this.builtinConfig)this.builtinConfig[e].length&&(this.addUrlBackup(this.builtinConfig[e][0],this.builtinConfig[e],e,"builtin"),this.tagToMainDomain[e]=this.builtinConfig[e][0]);this.lbsState="builtin",this.client.safeEmit("@lbs-config-update",{reason:e}),"oninit"!==e&&this.logger.log(`成功加载内建配置 ${e}。`)}handleLbsStateWillChange(e){this.lbsStateWillChangeTimer&&clearTimeout(this.lbsStateWillChangeTimer);const t={lbsState:this.lbsState,settings:this.getSettings()};this.lbsStateWillChangeTimer=setTimeout((()=>{const r={lbsState:this.lbsState,settings:this.getSettings()};"DISCONNECTED"!==this.client.adapterRef.connectState.curState&&this.client.apiFrequencyControl({name:"_lbsStateChange",code:0,param:{reason:e,before:t,after:r}})}),0)}getSettings(){const e=Object.keys(this.urlBackupMap),t={};return e.forEach((e=>{t[e]=this.urlBackupMap[e].map((e=>{const t=e.lastRequest?{status:e.lastRequest.status,rtt:e.lastRequest.rtt}:void 0;return{domain:e.domain,successCount:e.successCount,failCount:e.failCount,lastResult:t}}))})),t}getReportField(e){const t=[];for(let r in this.urlBackupMap)for(let n=0;n<this.urlBackupMap[r].length;n++){const i=this.urlBackupMap[r][n];i.tag===e&&t.push(i)}let r=[],n=0;return t.forEach((t=>{if(t.lastRequest&&"inprogress"!==t.lastRequest.status){if(t.lastRequest.requestId>n&&(n=t.lastRequest.requestId,r=[]),t.lastRequest.requestId!==n)return;"lbs"===e?r.push({app_key:this.client._params.appkey,request_id:t.lastRequest.uuid,err_code:t.lastRequest.errCode,err_msg:t.lastRequest.errMsg,rtt:t.lastRequest.rtt,time:t.lastRequest.finishiedAt}):"nrtc"===e?r.push({domain:t.domain,type:1,code:"success"===t.lastRequest.status?0:1}):"call"===e?r.push({domain:t.domain,type:1,code:"success"===t.lastRequest.status?0:1,status:t.lastRequest.status,lbsFrom:this.lbsState,rtt:t.lastRequest.rtt}):r.push({domain:t.domain,requestId:t.lastRequest.uuid,addr:"",type:1,code:"success"===t.lastRequest.status?0:1,status:t.lastRequest.status,lbsFrom:this.lbsState,rtt:t.lastRequest.rtt})}})),r}saveConfig(e){if(!this.client._params.appkey)return void this.logger.error("saveConfig: 缺少appkey");const t={ts:Date.now(),appKey:this.client._params.appkey,sdkVersion:i.SDK_VERSION,sdkBuild:i.BUILD,config:e};try{localStorage.setItem(this.localStorageKey,l.JSONBigStringify(t))}catch(e){this.logger.error("saveConfig：无法存储LBS设置",e.name,e.message)}}loadLocalConfig(e){var t,r;if(!this.client._params.appkey)return this.logger.error("loadLocalConfig: 缺少appkey"),{reason:"appkeyNotFound",config:null};if(null===(r=null===(t=this.client._params)||void 0===t?void 0:t.neRtcServerAddresses)||void 0===r?void 0:r.channelServer)return this.logger.log("忽略 loadLocalConfig 请求：当前为私有化配置"),{reason:"privilization",config:null};let n=null;try{const e=window.localStorage.getItem(this.localStorageKey);if(!e)return this.logger.log("本地未发现LBS配置"),{reason:"configNotFound",config:null};n=l.JSONBigParse(e)}catch(e){this.logger.error("无法读取本地配置：",e.name,e.message)}if(!n)return{reason:"configError",config:null};const o=Date.now(),s=n.ts+1e3*n.config.ttl-o;return s<0?(this.logger.log(`LBS不使用本地配置：ttl已过期${Math.floor(-s/1e3)} 秒。`),{reason:"expire",config:null}):n.sdkVersion!==i.SDK_VERSION||n.sdkBuild!==i.BUILD?(this.logger.warn(`LBS不使用本地配置：版本不匹配。${n.sdkVersion}/${n.sdkBuild} ${i.SDK_VERSION}/${i.BUILD}。`),{reason:"version",config:null}):n.appKey!==this.client._params.appkey?(this.logger.warn(`LBS不使用本地配置：appKey不匹配。${n.appKey} ${this.client._params.appkey}。`),{reason:"appkey",config:null}):(this.lastUpdate={activeFrom:n.ts,res:n.config},this.handleLbsStateWillChange(e),this.addUrlBackup(this.tagToMainDomain.call,n.config.call,"call","localstorage"),this.addUrlBackup(this.tagToMainDomain.nrtc,n.config.nrtc,"nrtc","localstorage"),this.addUrlBackup(this.tagToMainDomain.tracking,n.config.tracking,"tracking","localstorage"),this.lbsState="local",this.logger.log(`成功加载本地配置。过期时间：${Math.floor(s/1e3)} 秒后。`),this.client.safeEmit("@lbs-config-update",{reason:e}),{reason:"success",config:n})}addUrlBackup(e,t,r,n){const i=this.urlBackupMap[e]||[];this.urlBackupMap[e]=[];const o=this.urlBackupMap[e],s=Date.now();t.forEach((t=>{let a=i.find((r=>r.domain===t&&r.mainDomain===e));a?(a.updatedAt=s,a.tag=r,a.source=n):a={id:o.length,domain:t,mainDomain:e,successCount:0,failCount:0,updatedAt:s,tag:r,source:n},o.push(a)}))}getURLSettings(e){const t=/(\/\/)([^\/]+)(\/)/,r=e.match(t);let n="";n=r?r[2]:e,this.urlBackupMap[n]||this.addUrlBackup(n,[n],"extra","extra");const i=this.requestCnt++;return this.urlBackupMap[n].map(((r,n)=>{const o=e.replace(t,`$1${r.domain}$3`);return{seqId:`${i}_${n}`,state:"uninit",requestId:i,url:o,item:r}}))}markSuccess(e,t){var r;"inprogress"===(null==t?void 0:t.status)&&(t.finishiedAt=Date.now(),t.rtt=t.finishiedAt-t.startAt,t.status="success",this.logger.debug(`markFinish success seqId:${e.seqId} source:${e.item.source} rtt:${t.rtt}ms url:${e.url}`)),e.item.successCount++,e.state="success";const n=this.urlBackupMap[e.item.mainDomain];if(n&&"fail"===(null===(r=n[0].lastRequest)||void 0===r?void 0:r.status)){const t=n.findIndex((t=>t===e.item));t>-1&&(this.logger.warn(`主备域名互换。${n[0].domain} => ${e.item.domain}`),this.handleLbsStateWillChange("domainDown:"+n[0].domain),n.splice(t,1),n.unshift(e.item))}}markFail(e,t,r,n){"inprogress"===(null==t?void 0:t.status)&&(t.finishiedAt=Date.now(),t.rtt=t.finishiedAt-t.startAt,t.status="fail",t.errCode=r,t.errMsg=n,this.logger.debug(`markFinish fail seqId:${e.seqId} source:${e.item.source} rtt:${t.rtt}ms url:${e.url}`,r,n)),e.item.failCount++,e.state="fail",this.logger.error("markFail：",e.item.domain,r,n)}isAllRequestsFinished(e){for(let t in e){const r=e[t];if("uninit"===r.state||"sent"===r.state)return!1}return!0}ajax(e){if(u.getParameters().disableLBSService)return this.logger.log("disableLBSService:",e.url),o.ajax(e);const t=this.getURLSettings(e.url);let r=!1;return new Promise(((n,i)=>{const p=(e,o,c)=>{var u,p,m,f,h,g,v;if(e.status>=400){if(this.markFail(c,o,e.status,"string"==typeof e.response?e.response:l.JSONBigStringify(e.response)),t[1]&&t[1].fire&&t[1].timer)this.logger.warn(`主线路请求发生错误，启用备用线路 【主  ${c.url} 】【备 ${t[1].url} 】`,e.status),t[1].fire();else if(this.isAllRequestsFinished(t))return i(new a.default({code:s.default.LBS_REQUEST_ERROR,message:"LBS: 网络请求错误"}))}else if("json"!==e.responseType||e.response)if(500===(null===(u=e.response)||void 0===u?void 0:u.code)){if(this.markFail(c,o,d.UNKNOWN_ERROR,l.JSONBigStringify(e.response)),t[1]&&t[1].fire&&t[1].timer)this.logger.warn(`主线路请求发生错误，启用备用线路 【主  ${c.url} 】【备 ${t[1].url} 】`,e.response),t[1].fire();else if(this.isAllRequestsFinished(t)){var y=e.response;n(y)}}else if("lbs"!==c.item.tag||(null===(m=null===(p=e.response)||void 0===p?void 0:p.call)||void 0===m?void 0:m.length)&&(null===(h=null===(f=e.response)||void 0===f?void 0:f.nrtc)||void 0===h?void 0:h.length)&&(null===(v=null===(g=e.response)||void 0===g?void 0:g.tracking)||void 0===v?void 0:v.length)){if(this.markSuccess(c,o),t.forEach((e=>{e.timer&&(clearTimeout(e.timer),e.timer=void 0),e.fire=void 0})),r)return void this.logger.log(`${c.url} 已忽略返回值：${e.status}`);r=!0,y=e.response,n(y)}else{if(this.markFail(c,o,d.FORMAT_ERROR,l.JSONBigStringify(e.response)),!(t[1]&&t[1].fire&&t[1].timer))return n(e.response);this.logger.warn(`主线路请求发生错误，启用备用线路 【主  ${c.url} 】【备 ${t[1].url} 】`,"FORMAT_ERROR"),t[1].fire()}else if(this.markFail(c,o,d.JSON_ERROR,"JSON_ERROR"),t[1]&&t[1].fire&&t[1].timer)this.logger.warn(`主线路请求发生错误，启用备用线路 【主  ${c.url} 】【备 ${t[1].url} 】`,e),t[1].fire();else if(this.isAllRequestsFinished(t))return i(new a.default({code:s.default.LBS_JSON_ERROR,message:"LBS: 结果json解析错误"}))},m=(e,n,o,c)=>{if(this.markFail(o,n,d.UNKNOWN_ERROR,`${c.type||l.JSONBigStringify(c)}:${o.url}`),t[1]&&t[1].fire&&t[1].timer)this.logger.warn(`主线路请求发生错误，启用备用线路 【主  ${o.url} 】【备 ${t[1].url} 】`,c),t[1].fire();else if(this.isAllRequestsFinished(t))return r=!0,i(new a.default({code:s.default.LBS_REQUEST_ERROR,message:"LBS: 主线路请求发生错误(onerror)"}))},f=(e,n,o,c)=>{if(this.markFail(o,n,d.TIMEOUT,"TIMEOUT"),t[1]&&t[1].fire&&t[1].timer)this.logger.warn(`主线路请求超时，启用备用线路 【主 ${o.url}】【备 ${t[1].url}】`,c),t[1].fire();else if(this.isAllRequestsFinished(t))return r=!0,i(new a.default({code:s.default.LBS_REQUEST_ERROR,message:"LBS: 主线路请求发生错误(ontimeout)"}))};t.forEach(((t,r)=>{t.fire=()=>{t.fire=void 0,t.timer&&(clearTimeout(t.timer),t.timer=void 0),t.state="sent";const r={status:"inprogress",startAt:Date.now(),requestId:t.requestId,seqId:t.seqId,uuid:"",finishiedAt:0,errCode:0,errMsg:"",rtt:-1};t.item.lastRequest=r,((t,r)=>{const n=new XMLHttpRequest;t.xhr=n,n.open(e.type||"GET",r.url,!0),n.responseType=e.dataType||"json";const i=e.contentType||"application/json;charset=UTF-8";if(n.setRequestHeader("Content-Type",i),e.header&&Object.keys(e.header).map((t=>{e.header&&e.header[t]&&n.setRequestHeader(t,e.header[t])})),"lbs"===r.item.tag){const e=c.generateUUID();r.item.lastRequest&&(r.item.lastRequest.uuid=e),n.setRequestHeader("X-Request-Id",e)}n.onload=p.bind(n,n,t,r),n.onerror=m.bind(n,n,t,r),n.ontimeout=f.bind(n,n,t,r),i.indexOf("x-www-form-urlencoded")>=0?e.data?n.send(o.getFormData(e.data)):n.send():e.data?n.send(l.JSONBigStringify(e.data)):n.send()})(r,t)},r&&(t.timer=setTimeout((()=>{t.fire&&(this.logger.warn("主线路请求超时，发起备用线路请求："+t.url),t.fire())}),u.getParameters().fireBackupDelay*r))})),t[0].fire&&t[0].fire()}))}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.SpatialManager=void 0;const n=r(117);t.SpatialManager=class{constructor(e){this.elem=document.createElement("audio"),this.fakeElem=document.createElement("audio"),this.data={},this.context=e.context,this.client=e.client,this.options=e.options,this.logger=e.client.adapterRef.logger.getChild((()=>"spatial"));try{this.destination=new MediaStreamAudioDestinationNode(this.context)}catch(e){if("TypeError"!==e.name)throw e;this.destination=this.context.createMediaStreamDestination()}this.elem.setAttribute("playsinline","playsinline"),this.elem.setAttribute("autoplay","autoplay"),this.elem.className="nertc-panner-manager",this.elem.srcObject=this.destination.stream,this.fakeElem.muted=!0,this.fakeElem.volume=0,this.fakeElem.autoplay=!0,this.fakeElem.controls=!0}getUserData(e){const t=""+e;""+parseInt(t)!==t&&this.logger.warn("getUserData:异常的uid：",e);let r=this.data[t];return r||(r={position:{x:0,y:0}},this.data[t]=r),r}shouldSubscribe(e){const t=this.getUserData(e);return Math.abs(t.position.x)<=64&&Math.abs(t.position.y)<=64}async updatePosition(e,t){const r=this.getUserData(e),n=this.client.adapterRef.remoteStreamMap[e];if(n){const i=this.client.getSubStatus(n,"all");if(this.shouldSubscribe(e))if(i.subscribable)this.logger.log(`[remote#${e} status:${i.status}]界内，【即将订阅】: (${r.position.x}, ${r.position.y}) => (${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y,await this.client.doSubscribe(n),this.updatePosition(e,r.position);else{if(r.position.x===t.x&&r.position.y===t.y)return;this.logger.log(`[remote#${e} status:${i.status}]界内，即将更新remoteStream位置: (${r.position.x}, ${r.position.y}) => (${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y,r.audioNodes&&(r.audioNodes.pannerNode.positionX.value=t.x,r.audioNodes.pannerNode.positionY.value=t.y)}else if("subscribed"===i.status)this.logger.log(`[remote#${e} status:${i.status}]界外，【即将取消订阅】:  (${r.position.x}, ${r.position.y}) => (${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y,await this.client.doUnsubscribe(n),this.updatePosition(e,r.position);else{if(r.position.x===t.x&&r.position.y===t.y)return;this.logger.log(`[remote#${e} status:${i.status}]界外，即将更新remoteStream位置:  (${r.position.x}, ${r.position.y}) => (${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y,r.audioNodes&&(r.audioNodes.pannerNode.positionX.value=t.x,r.audioNodes.pannerNode.positionY.value=t.y)}}else this.logger.log(`updatePosition: 更新未到的stream: ${e} ( ${t.x}, ${t.y})`),r.position.x=t.x,r.position.y=t.y}init(){this.client.addListener("@stream-added",(e=>{const t=this.getUserData(e.stream.getId());e.stream.setSubscribeConfig(this.options.subConfig),this.updatePosition(e.stream.getId(),t.position)})),this.client.addListener("@stream-unsubscribed",(e=>{const t=this.getUserData(e.stream.getId());this.updatePosition(e.stream.getId(),t.position)})),this.client.addListener("@stream-subscribed",(async e=>{this.logger.log("Subscribed to",e.stream.streamID,e.mediaType);const t=this.getUserData(e.stream.getId());"audio"===e.mediaType&&(t.audioNodes&&(t.audioNodes.pannerNode.disconnect(),t.audioNodes.source.disconnect(),t.audioNodes.gainNode.disconnect()),t.audioNodes={source:this.context.createMediaStreamSource(e.stream.mediaHelper.audio.audioStream),gainNode:this.context.createGain(),pannerNode:new PannerNode(this.context,{panningModel:"HRTF",distanceModel:"linear",rolloffFactor:1,coneInnerAngle:360,positionX:t.position.x,positionY:t.position.y,positionZ:0,maxDistance:100})},t.audioNodes.source.connect(t.audioNodes.gainNode),t.audioNodes.gainNode.connect(t.audioNodes.pannerNode),t.audioNodes.pannerNode.connect(this.destination),this.fakeElem.srcObject=e.stream.mediaHelper.audio.audioStream,this.fakeElem.play().catch((e=>{n.Device.onUserGestureNeeded&&(n.Device.onUserGestureNeeded(e),n.Device.once("user-gesture-fired",(()=>{this.fakeElem.play()})))})),this.logger.log("Connected",e.stream.getId,e.stream.mediaHelper.audio.audioStream.getAudioTracks()[0])),this.updatePosition(e.stream.getId(),t.position)}))}play(){this.elem.controls=!0,"suspended"===this.context.state&&n.Device.onUserGestureNeeded&&(n.Device.onUserGestureNeeded(new Error("恢复AudioContext")),n.Device.once("user-gesture-fired",(()=>{this.context.resume()}))),this.elem.play().catch((e=>{n.Device.onUserGestureNeeded&&(n.Device.onUserGestureNeeded(e),n.Device.once("user-gesture-fired",(()=>{this.elem.play()})))}))}}},function(module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalStream=void 0;const videoQuality_1=__webpack_require__(122),alerter_1=__webpack_require__(146),audioLevel_1=__webpack_require__(174),media_1=__webpack_require__(191),parameters_1=__webpack_require__(4),play_1=__webpack_require__(193),record_1=__webpack_require__(150),video_post_processing_1=__importDefault(__webpack_require__(297)),advanced_beauty_1=__importDefault(__webpack_require__(320)),basic_beauty_1=__importDefault(__webpack_require__(321)),virtual_background_1=__importDefault(__webpack_require__(322)),plugin_1=__webpack_require__(323),plugin_list_1=__webpack_require__(201),param_1=__webpack_require__(65),types_1=__webpack_require__(64),errorCode_1=__importDefault(__webpack_require__(12)),rtcError_1=__importDefault(__webpack_require__(13)),gum_1=__webpack_require__(73),param_2=__webpack_require__(65),applyResolution_1=__webpack_require__(324),env=__importStar(__webpack_require__(24)),RTCEventEmitter_1=__webpack_require__(68),utils_1=__webpack_require__(57),webAudio_1=__webpack_require__(63),StageAIProcessing_1=__webpack_require__(192),wasmDetect_1=__webpack_require__(325);let localStreamCnt=0;class LocalStream extends RTCEventEmitter_1.RTCEventEmitter{constructor(e){if(super(),this.safariVideoSizeChange=!1,this._advancedBeautyProcessor=null,this.videoPostProcessTags={isBeautyTrack:!1,isBodySegmentTrack:!1,isAdvBeautyTrack:!1},this.replaceTags={videoPost:!1,waterMark:!1,isMuted:!1},this.audioLevelHelper=null,this.audioLevelHelperSlave=null,this.videoProfile={frameRate:videoQuality_1.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,resolution:videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p},this.screenProfile={frameRate:videoQuality_1.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5,resolution:videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p},this.state="UNINIT",this.videoView=null,this.screenView=null,this.renderMode={local:{video:{},screen:{}}},this.inSwitchDevice={audio:!1,video:!1},this.pubStatus={audio:{audio:!1},audioSlave:{audio:!1},video:{video:!1},screen:{screen:!1}},this.muteStatus={audio:{send:!1},audioSlave:{send:!1},video:{send:!1},screen:{send:!1}},this.isRemote=!1,this.active=!0,this.destroyed=!1,this.canvasWatermarkOptions=null,this.encoderWatermarkOptions=null,this.supportWasm=!0,this.supportAIDenoise=!0,this.basicBeautyStaticRes=e=>{this.logger.log("config basic beauty static resources."),this.WebGLSupportError(),basic_beauty_1.default.configStaticRes(e)},this.advBeautyStaticRes=e=>{this.logger.log("config advanced beauty static resources."),this.WebGLSupportError(),advanced_beauty_1.default.configStaticRes(e)},this.setAdvBeautyEffect=(...e)=>{this.logger.log("set advanced beauty parameters:"+JSON.stringify(e)),this.videoPostProcess.availableCode<1||(this.advancedBeauty.isEnable||this.logger.warn("advanced beauty is not opened."),this.advancedBeauty.setAdvEffect(...e))},this.presetAdvBeautyEffect=(...e)=>{this.logger.log("preset advanced beauty parameters:"+JSON.stringify(e)),this.videoPostProcess.availableCode<1||(this.advancedBeauty.isEnable||this.logger.warn("advanced beauty is not opened."),this.advancedBeauty.presetAdvEffect(...e))},this.localStreamId=localStreamCnt++,this.logger=e.client.adapterRef.logger.getChild((()=>{let e=this.localStreamId?"local"+this.localStreamId:"localStream";if(this.mediaHelper){let t="";this.mediaHelper.audio.micTrack&&(t+="m"),this.mediaHelper.video.cameraTrack&&(t+="c"),this.mediaHelper.screen.screenVideoTrack&&(t+="s"),this.mediaHelper.screenAudio.screenAudioTrack&&(t+="t"),t&&(e+=" "+t)}return"INITED"!==this.state&&(e+=" "+this.state),"INITED"===this.state&&this.client&&this.client.adapterRef.localStream!==this&&(e+=" DETACHED"),this.destroyed&&(e+=" DESTROYED"),e})),e.uid)if("string"==typeof e.uid){if(this.logger.log("createStream: uid是string类型"),e.client.adapterRef.channelInfo.uidType="string",!/^\d+(\.\d+)?$/.test(e.uid))throw this.logger.log("join(): uid不是数字字符串格式"),new rtcError_1.default({code:errorCode_1.default.JOIN_UID_TYPE_ERROR,message:"createStream: uid不是数字字符串格式"})}else{if("number"!=typeof e.uid)throw this.logger.error("createStream: uid参数格式非法"),new rtcError_1.default({code:errorCode_1.default.STREAM_UID_ERROR,message:"createStream: uid参数格式非法"});if(this.logger.log("createStream: uid是number类型"),e.client.adapterRef.channelInfo.uidType="number",e.uid>Number.MAX_SAFE_INTEGER)throw new rtcError_1.default({code:errorCode_1.default.STREAM_UID_ERROR,message:"Number 类型的 uid 最大值是 2^53 - 1， 请输入正确的参数"})}else e.uid="local_"+this.localStreamId;this._reset(),this.streamID=e.uid,this.stringStreamID=this.streamID.toString(),this.audio=e.audio,this.audioProcessing=e.audioProcessing||null,this.microphoneId=e.microphoneId||"",this.cameraId=e.cameraId||"",this.video=e.video||!1,this.screen=e.screen||!1,this.screenAudio=e.screenAudio||!1,this.audioSlave=this.screenAudio,this.sourceId=e.sourceId||"",this.facingMode=e.facingMode||"",this.client=e.client,this.audioSource=e.audioSource||null,this.videoSource=e.videoSource||null,this.screenAudioSource=e.screenAudioSource||null,this.screenVideoSource=e.screenVideoSource||null,this._segmentProcessor=null,this._cameraTrack=null,this._transformedTrack=null,this.mediaHelper=new media_1.MediaHelper({stream:this}),this._play=new play_1.Play({stream:this}),this._record=new record_1.Record({logger:this.logger,client:this.client}),this.client._params&&"live"===this.client._params.mode?this.audioProfile="music_standard":this.audioProfile="speech_low_quality","never"!==parameters_1.getParameters().enableAlerter&&alerter_1.alerter.watchLocalStream(this),this.logger.log("创建本地Stream: ",JSON.stringify({streamID:this.stringStreamID,audio:e.audio,video:e.video})),this.client.apiFrequencyControl({name:"createLocalStream",code:0,param:{streamID:this.stringStreamID,videoProfile:this.videoProfile,audio:this.audio,audioProfile:this.audioProfile,video:this.video,screen:this.screen,screenProfile:this.screenProfile}}),this.supportWasm=wasmDetect_1.webassemblySupported(),this.videoPostProcess=new video_post_processing_1.default(this.logger),this.basicBeauty=new basic_beauty_1.default(this.videoPostProcess),this.virtualBackground=new virtual_background_1.default(this.videoPostProcess),this.advancedBeauty=new advanced_beauty_1.default(this.videoPostProcess),env.IS_ANY_SAFARI&&this.videoPostProcess.on("safariVideoSizeChange",(()=>{this.safariVideoSizeChange=!0,this.loseContext()})),this.videoPostProcess.on("contextLost",(()=>{this.suspendVideoPostProcess(),this.safariVideoSizeChange?setTimeout((()=>{this.restoreContext()}),0):this.emit("video-post-context-lost")})),this.videoPostProcess.on("contextRestored",(e=>{this.resumeVideoPostProcess(),this.safariVideoSizeChange?this.safariVideoSizeChange=!1:(this.emit("video-post-context-restored",e),this.logger.log("webgl context restored, try to reinitialize webgl pipeline."))})),this.videoPostProcess.on("beautyResComplete",(e=>{this.emit("basic-beauty-res-complete",e)})),this.videoPostProcess.on("advBeautyResComplete",(e=>{this.emit("adv-beauty-res-complete",e)})),this.videoPostProcess.on("taskSwitch",(e=>{if(this.replaceTags.videoPost=e,this.replaceCanvas(),e&&env.IS_ANY_SAFARI){const e=parseFloat(env.SAFARI_VERSION||"0");e<15.4&&this.logger.warn("It is detected that you are using safari and the version is lower than 15.4. For a better experience, it is recommended to use version 15.4 and above."),15.3===e&&this.logger.warn("In the current version of Safari, enabling video post-processing related functions will cause memory leaks (Safari kernel bug: capturing video streams from WebGL will cause memory leaks)."),15===e&&this.logger.warn("In the current version of Safari, enabling video post-processing related functions will cause the page to crash (Safari kernel bug: WebGL rendering WebCam will cause the page to crash).")}})),env.IS_ANY_SAFARI&&env.SAFARI_MAJOR_VERSION<15&&document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&this.replaceTags.videoPost&&this.logger.warn("In the current version of Safari, the page with the video post-processing function is restored from the background, the sending frame rate will slowly return to the normal frame rate from a lower value.")})),this.mediaHelper.on("preProcessChange",(e=>{"video"===e.mediaType&&(this.replaceTags.waterMark=e.isOn,this.replaceCanvas())}))}getAdapterRef(){return this.client.adapterRef.localStream===this?this.client.adapterRef:null}_reset(){this.streamID="",this.stringStreamID="",this.state="UNINIT",this.videoProfile={frameRate:videoQuality_1.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_NORMAL,resolution:videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p},this.audioProfile="speech_low_quality",this.screenProfile={frameRate:videoQuality_1.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5,resolution:videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p},this.audio=!1,this.microphoneId="",this.video=!1,this.cameraId="",this.screen=!1,this.screenAudio=!1,this.audioSlave=!1,this.sourceId="",this.facingMode="",this.videoView=null,this.screenView=null,this.renderMode={local:{video:{},screen:{}}},this.inSwitchDevice={audio:!1,video:!1},this.pubStatus={audio:{audio:!1},audioSlave:{audio:!1},video:{video:!1},screen:{screen:!1}},this.muteStatus={audio:{send:!1},audioSlave:{send:!1},video:{send:!1},screen:{send:!1}},this.renderMode={local:{video:{},screen:{}}},this.mediaHelper&&this.mediaHelper.destroy(),this._play&&this._play.destroy(),this._record&&this._record.destroy(),this._record=null,this.audioLevelHelper&&this.audioLevelHelper.destroy(),this.audioLevelHelper=null,this.audioLevelHelperSlave&&this.audioLevelHelperSlave.destroy(),this.audioLevelHelperSlave=null}get segmentProcessor(){return this._segmentProcessor}get Play(){return this._play}get Record(){return this._record}getId(){return"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID}getAudioStream(){return this.mediaHelper?(this.client.apiFrequencyControl({name:"getAudioStream",code:0,param:JSON.stringify({streamID:this.getId()},null," ")}),this.mediaHelper.audio.audioStream):null}async init(){const e=await this.client.operationQueue.enqueue({caller:this,method:"init",options:null}),t=()=>{e();const t={audio:this.audio,video:this.video,screen:this.screen,screenAudio:this.screenAudio};(this.audio||this.screenAudio)&&(t.audioProfile=this.audioProfile,t.audioProcessing=this.audioProcessing),this.video&&(t.videoProfile=this.mediaHelper.video.captureConfig.high,t.videoEncoder=this.mediaHelper.video.encoderConfig.high),this.screen&&(t.screenProfile=this.mediaHelper.screen.captureConfig.high,t.screenEncoder=this.mediaHelper.screen.encoderConfig.high),this.client.apiFrequencyControl({name:"init",code:0,param:Object.assign({streamID:this.stringStreamID},t)}),this.client.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(this.mediaHelper.getTrackSettings())})};let r=null;this.state="INITING",this.logger.log("init() 初始化音视频流对象"),this.client.adapterRef.channelInfo.sessionConfig.maxVideoQuality=videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p,this.videoProfile&&(this.client.adapterRef.channelInfo.sessionConfig.videoQuality=this.videoProfile.resolution,this.client.adapterRef.channelInfo.sessionConfig.videoFrameRate=this.videoProfile.frameRate);try{this.audio&&await this.mediaHelper.getStream({audio:this.audio,audioDeviceId:this.microphoneId,audioSource:this.audioSource})}catch(e){this.logger.log("init() 打开mic失败: "+e.message),r=e,this.audio=!1}try{this.video&&(await this.mediaHelper.getStream({video:this.video,videoSource:this.videoSource,videoDeviceId:this.cameraId,facingMode:this.facingMode}),this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("video"))}catch(e){this.logger.log("init() 打开camera失败: "+e.message),r=e,this.video=!1}try{if(this.screen){const e={sourceId:this.sourceId,screen:this.screen,screenVideoSource:this.screenVideoSource,screenAudio:this.screenAudio,screenAudioSource:this.screenAudioSource};await this.mediaHelper.getStream(e),this.mediaHelper.screen.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("screen")}}catch(e){this.logger.log("init() 打开screen失败: "+e.message),r=e,this.screen=!0}if(this.audio||this.video||this.screen||this.audioSlave)this.state="INITED";else{if(r)throw this.state="UNINIT",this.logger.error("localStream.init失败:",r.name,r.message,r),t(),r;if(!parameters_1.getParameters().allowEmptyMedia)throw this.state="UNINIT",this.logger.warn("init() localStream不允许初始化时无任何音视频"),t(),new rtcError_1.default({code:errorCode_1.default.STREAM_PROFILE_ERROR,message:"init() localStream不允许初始化时无任何音视频"});this.logger.log("init() 当前模式下localStream允许初始化时无任何音视频"),this.state="INITED"}t()}getAudioTrack(e="audio"){if(this.mediaHelper)return"audio"===e?this.mediaHelper.getAudioInputTracks()[0]:"audioSlave"===e?this.mediaHelper.getAudioSlaveInputTracks()[0]:null}getVideoTrack(e="video"){if(this.mediaHelper)return"video"===e?this.mediaHelper.video.cameraTrack||this.mediaHelper.video.videoSource:"screen"===e?this.mediaHelper.screen.screenVideoTrack||this.mediaHelper.screen.screenVideoSource:null}getScreenTrack(){return this.mediaHelper.screen.screenVideoStream.getVideoTracks()[0]||null}getAudioSlaveTrack(){return this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks()[0]||null}async play(e,t={}){if((t.video||t.screen)&&!e)throw this.logger.warn(`play() localStream ${this.getId()} 播放视频没有指定div标签`),new rtcError_1.default({code:errorCode_1.default.STREAM_PLAY_ARGUMENT_ERROR,message:"play() 播放视频没有指定div标签"});param_2.isExistOptions({tag:"Stream.playOptions.audio",value:t.audio}).result||(t.audio=!1),t.audio&&!t.audioType&&(t.audioType="mixing"),param_2.isExistOptions({tag:"Stream.playOptions.video",value:t.video}).result||(t.video=!0),param_2.isExistOptions({tag:"Stream.playOptions.screen",value:t.screen}).result||(t.screen=!0),this.logger.log(`play() uid: ${this.stringStreamID}, playOptions: ${JSON.stringify(t)}`),t.audio&&this._play&&this.mediaHelper.getAudioInputTracks().length>0&&(this.logger.log(`play() uid ${this.stringStreamID} 开始播放本地音频: `,t.audioType),"voice"===t.audioType?this._play.playAudioStream("audio",this.mediaHelper.audio.micStream,t.muted):"music"===t.audioType?this._play.playAudioStream("audio",this.mediaHelper.audio.musicStream,t.muted):"mixing"===t.audioType&&this._play.playAudioStream("audio",this.mediaHelper.audio.audioStream,t.muted));let r=null;if("string"==typeof e?r=document.getElementById(e):e&&(r=e),r){if(t.video&&(this.videoView=r,this._play&&this.mediaHelper.video.videoStream.getVideoTracks().length)){this.logger.log(`play() uid ${this.stringStreamID} 开始启动视频播放 主流 本地`);try{await this._play.playVideoStream("video",this.mediaHelper.video.renderStream,r),"width"in this.renderMode.local.video&&this._play.setRender("video",this.renderMode.local.video)}catch(e){throw this.logger.log("play() 视频播放异常: ",e),e}await this.resumeVideoPostProcess()}if(t.screen&&(this.screenView=r,this._play&&this.mediaHelper.screen.screenVideoStream.getVideoTracks().length)){this.logger.log(`play() uid ${this.stringStreamID} 开始启动视频播放 辅流 本地`);try{await this._play.playVideoStream("screen",this.mediaHelper.screen.renderStream,r),"width"in this.renderMode.local.screen&&this._play.setRender("screen",this.renderMode.local.screen)}catch(e){throw this.logger.log("play() 屏幕共享播放异常: ",e),e}}}if(t.audio){const e={enable:!0};this.client.apiFrequencyControl({name:"enableEarback",code:0,param:JSON.stringify(e,null," ")})}this.client.apiFrequencyControl({name:"play",code:0,param:JSON.stringify({streamID:this.stringStreamID,playOptions:t,isRemote:!1},null," ")})}async resume(){this._play&&(this.logger.log("resume() uid: ",this.stringStreamID),await this._play.resume()),this.client.apiFrequencyControl({name:"resume",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}setLocalRenderMode(e,t){if(!e||!param_1.isNumber(e.width)||!param_1.isNumber(e.height)||e.width<0||e.height<0)throw this.logger.warn("setLocalRenderMode() 参数宽高参数错误"),this.client.apiFrequencyControl({name:"setLocalRenderMode",code:-1,param:Object.assign({streamID:this.stringStreamID,mediaType:t},e)}),new rtcError_1.default({code:errorCode_1.default.STREAM_RENDER_ARGUMENT_ERROR,message:"setLocalRenderMode() 参数宽高错误"});this.logger.log(`setLocalRenderMode() uid ${this.stringStreamID} 设置本地视频播放窗口大小: `,t||"video+screen",JSON.stringify(e)),t&&"video"!==t||(this._play&&this._play.setRender("video",e),this.renderMode.local.video=e,this.replaceCanvas()),t&&"screen"!==t||(this.renderMode.local.screen=e,this._play&&this._play.setRender("screen",e)),this.client.apiFrequencyControl({name:"setLocalRenderMode",code:0,param:Object.assign({streamID:this.stringStreamID,mediaType:t},e)})}stop(e){this.logger.log(`stop() uid ${this.stringStreamID} 停止播放 ${e||"音视频流"}`),this._play&&(types_1.MediaTypeList.forEach((t=>{e&&t!==e||this._play.stopPlayStream(t)})),this.client.apiFrequencyControl({name:"stop",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,audio:this.audio,video:this.video,screen:this.screen,type:e},null," ")}))}isPlaying(e){if(this._play){if(types_1.MediaTypeList.indexOf(e)>-1)return this._play.isPlaying(e);throw this.logger.warn("isPlaying() unknown type"),new rtcError_1.default({code:errorCode_1.default.STREAM_ISPLAYING_ARGUMENT_ERROR,message:"isPlaying() type 参数类型非法"})}return this.client.apiFrequencyControl({name:"isPlaying",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,type:e},null," ")}),this.logger.log(`检查${this.stringStreamID}的${e}播放状态: false`),!1}canPlay(e){return-1===types_1.MediaTypeList.indexOf(e)?null:this._play.canPlay(e)}async open(e){var t,r,n,i;let{type:o,deviceId:s,sourceId:a,facingMode:c,screenAudio:u,audioSource:l,videoSource:d,screenAudioSource:p,screenVideoSource:m}=e;const f=await this.client.operationQueue.enqueue({caller:this,method:"open",options:e}),h=t=>{f();const r=utils_1.makePrintable(Object.assign({},e,t.param),1);this.client.apiFrequencyControl({name:"open",code:t.code,param:Object.assign({streamID:this.stringStreamID},r)}),this.client.apiFrequencyControl({name:"_trackSettings",code:t.code,param:JSON.stringify(this.mediaHelper.getTrackSettings())})};try{switch(this.getAdapterRef()||(this.logger.log("open(): 绑定 localStream ",o),this.client.bindLocalStream(this)),o){case"audio":if(this.logger.log("open(): 开启 "+(l?l.label:"mic设备")),this.mediaHelper.audio.micTrack||this.mediaHelper.audio.audioSource)return this.logger.warn("open(): 请先关闭麦克风"),h({code:-1,param:{reason:"重复打开麦克风",type:o}}),Promise.reject(new rtcError_1.default({code:errorCode_1.default.REPEAT_OPEN_MIC_ERROR,message:"open() 重复打开麦克风"}));if(this.audio=!0,this.mediaHelper){const e={audio:!0,audioDeviceId:s,audioSource:l};await this.mediaHelper.getStream(e),this.audioLevelHelper&&this.mediaHelper.audio.audioStream&&this.audioLevelHelper.updateStream(this.mediaHelper.audio.audioStream),s&&(this.microphoneId=s),this.audioSource=l||null,"CONNECTED"!==this.client.adapterRef.connectState.curState?this.logger.log("Stream.open:client不在频道中，无需发布。",e):(this.logger.log("Stream.open:开始发布",e),await(null===(t=this.client.adapterRef._mediasoup)||void 0===t?void 0:t.createProduce(this,"audio")))}break;case"screenAudio":if(!p)return void this.logger.warn("open(): 不允许单独开启屏幕共享音频功能。");if(this.logger.log("open(): 开启自定义屏幕共享音频 "+p.label),this.mediaHelper.screenAudio.screenAudioTrack||this.mediaHelper.screenAudio.screenAudioSource)return this.logger.warn("请先关闭屏幕共享音频"),h({code:-1,param:{reason:"请先关闭屏幕共享音频",type:o}}),Promise.reject(new rtcError_1.default({code:errorCode_1.default.REPEAT_OPEN_AUDIO_SLAVE_ERROR,message:"open() 重复打开屏幕共享音频"}));if(this.screenAudio=!0,this.mediaHelper){const e={screenAudio:!0,screenAudioSource:p};await this.mediaHelper.getStream(e),this.audioLevelHelperSlave&&this.mediaHelper.screenAudio.screenAudioStream&&this.audioLevelHelperSlave.updateStream(this.mediaHelper.screenAudio.screenAudioStream),"CONNECTED"!==this.client.adapterRef.connectState.curState?this.logger.log("Stream.open:client不在频道中，无需发布。",e):(this.logger.log("Stream.open:开始发布",e),await(null===(r=this.client.adapterRef._mediasoup)||void 0===r?void 0:r.createProduce(this,"audioSlave")))}break;case"video":case"screen":if(this.logger.log(`开启${"video"===o?"camera":"screen"}设备`),this[o]){const e="video"===o;return this.logger.warn("open() 请先关闭"+(e?"摄像头":"屏幕共享")),this.client.apiFrequencyControl({name:"open",code:-1,param:JSON.stringify({reason:"open() 重复打开"+(e?"摄像头":"屏幕共享"),type:o},null," ")}),h({code:-1,param:{reason:"open() 重复打开"+(e?"摄像头":"屏幕共享"),type:o}}),Promise.reject(new rtcError_1.default({code:e?errorCode_1.default.REPEAT_OPEN_CAMERA_ERROR:errorCode_1.default.REPEAT_OPEN_SCREEN_ERROR,message:"open() 重复打开"+(e?"摄像头":"屏幕共享")}))}if(e.screenAudio&&(this.mediaHelper.screenAudio.screenAudioTrack||this.mediaHelper.screenAudio.screenAudioSource))return this.logger.warn("open() 重复开启屏幕共享音频"),h({code:-1,param:{reason:"open() 重复开启屏幕共享音频",type:o}}),Promise.reject(new rtcError_1.default({code:errorCode_1.default.REPEAT_OPEN_AUDIO_SLAVE_ERROR,message:"open() 重复开启屏幕共享音频"}));this[o]=!0;const u={videoDeviceId:s,sourceId:a,videoSource:d,screenAudioSource:p,screenVideoSource:m,facingMode:c};u[o]=!0,"screen"===o&&e.screenAudio&&(u.screenAudio=!0,this.screenAudio=!0),await this.mediaHelper.getStream(u),this.videoSource=d||null,this.screenAudio&&this.audioLevelHelperSlave&&this.mediaHelper.screenAudio.screenAudioStream&&this.audioLevelHelperSlave.updateStream(this.mediaHelper.screenAudio.screenAudioStream),"video"===o&&this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("video"),"screen"===o&&this.mediaHelper.screen.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("screen"),s&&"video"===o&&(this.cameraId=s),"CONNECTED"!==this.client.adapterRef.connectState.curState?this.logger.log("Stream.open:client不在频道中, 无需发布。",u):(this.logger.log("Stream.open:开始发布",u),await(null===(n=this.client.adapterRef._mediasoup)||void 0===n?void 0:n.createProduce(this,o)),e.screenAudio&&await(null===(i=this.client.adapterRef._mediasoup)||void 0===i?void 0:i.createProduce(this,"audioSlave")));break;default:throw this.logger.warn("open() 非法参数"),new rtcError_1.default({code:errorCode_1.default.STREAM_OPTN_NO_TYPE_ERROR,message:"open() type 参数类型非法"})}h({code:0,param:{type:o}})}catch(t){throw["audio","video","screen"].indexOf(o)>-1&&(this[o]=!1,"screen"===o&&e.screenAudio&&(this.screenAudio=!1)),this.logger.log(o+" 开启失败: ",t.name,t.message),h({code:-1,param:{type:o,reason:t.message}}),new rtcError_1.default({code:errorCode_1.default.MEDIA_DEVICE_ERROR,message:`${t.name} ${t.message}`})}}async switchScreenStream(e){var t;let r=null,n=!1,i=null,o="";"video"===(null===(t=e.screenVideoSource)||void 0===t?void 0:t.kind)?(r=e.screenVideoSource,n=!0):r=(await this.mediaHelper.getScreenSource({screen:this.screen})).getVideoTracks()[0],r?(i=await this.replaceTrack({mediaType:"screen",track:r,external:n}),i?(this.client.adapterRef.logger.log(`switchScreenStream: 已从 ${i.external?"自定义辅流":"屏幕共享"} 切换到 ${n?"自定义辅流":"屏幕共享"}`),i.external||i.oldTrack.stop()):(o="当前没有screen流",this.client.adapterRef.logger.error(`switchScreenStream: 无法切换到${n?"自定义辅流":"屏幕共享"}: ${o}`))):(o="无法获得新的screenVideoTrack",this.client.adapterRef.logger.error("switchScreenStream: ",o)),this.client.adapterRef.instance.apiEventReport("setFunction",{name:"switch_to_custom_screen",oper:"1",param:o||"success"}),this.client.apiFrequencyControl({name:"switchScreenStream",code:o?-1:0,param:JSON.stringify({external:n,reason:o},null," ")})}async close(e){var t,r,n,i;e||(e={type:"all"});const o=await this.client.operationQueue.enqueue({caller:this,method:"close",options:e});let s,a,c=e.type;switch(c){case"audio":if(this.logger.log("close() 关闭mic设备"),!this.audio){s=errorCode_1.default.STREAM_CLOSE_AUDIO_ERROR,a="close() 没有开启过麦克风";break}this.audio=!1,this.mediaHelper.stopStream("audio"),this.getAdapterRef()?this.mediaHelper.getAudioInputTracks().length>0?this.logger.log("close() 关闭音频，保留发布：",c):(this.logger.log("close() 停止发布音频"),await(null===(t=this.client.adapterRef._mediasoup)||void 0===t?void 0:t.destroyProduce("audio"))):this.logger.log("close() 未发布音频，无需停止发布"),this.audioSource=null;break;case"screenAudio":if(this.logger.log("close() 关闭屏幕共享音频"),!this.screenAudio){s=errorCode_1.default.STREAM_CLOSE_AUDIO_SLAVE_ERROR,a="close() 没有开启过屏幕共享音频";break}this.screenAudio=!1,this.mediaHelper.stopStream("screenAudio"),this.getAdapterRef()?(this.logger.log("close() 停止发布音频辅流"),await(null===(r=this.client.adapterRef._mediasoup)||void 0===r?void 0:r.destroyProduce("audioSlave"))):this.logger.log("close() 未发布音频，无需停止发布");break;case"video":if(this.logger.log("close() 关闭camera设备"),!this.video){s=errorCode_1.default.STREAM_CLOSE_CAMERA_ERROR,a="close() 没有开启过摄像头";break}await this.suspendVideoPostProcess(),this._transformedTrack&&this._cameraTrack&&(this._cameraTrack.stop(),this._cameraTrack=null),this._transformedTrack&&(this._transformedTrack.stop(),this._transformedTrack=null),this.video=!1,this.mediaHelper.stopStream("video"),this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.disablePreProcessing("video",!0),null==this||this._play.stopPlayStream("video"),this.getAdapterRef()?(this.logger.log("close() 停止发布视频"),await(null===(n=this.client.adapterRef._mediasoup)||void 0===n?void 0:n.destroyProduce("video"))):this.logger.log("close() 未发布视频，无需停止发布"),this.replaceTags.isMuted&&(this.replaceTags.isMuted=!1,this.virtualBackground.emptyFrame=!1),this.videoSource=null;break;case"screen":if(this.logger.log("close() 关闭屏幕共享"),!this.screen){s=errorCode_1.default.STREAM_CLOSE_SCREEN_ERROR,a="close() 没有开启过屏幕共享";break}this.screen=!1,this.mediaHelper.screen.preProcessingEnabled&&this.mediaHelper.disablePreProcessing("screen",!0),this.mediaHelper.stopStream("screen"),null==this||this._play.stopPlayStream("screen"),this.getAdapterRef()?(this.logger.log("Stream.close: 停止发布辅流"),await(null===(i=this.client.adapterRef._mediasoup)||void 0===i?void 0:i.destroyProduce("screen"))):this.logger.log("Stream.close: 未发布辅流，无需停止发布");break;case"all":this.logger.log(`Stream.close:关闭所有设备: audio ${this.audio}, video ${this.video}, screen ${this.screen}, screenAudio ${this.screenAudio}`),this.audio&&await this.close({type:"audio"}),this.video&&await this.close({type:"video"}),this.screen&&await this.close({type:"screen"}),this.screenAudio&&await this.close({type:"screenAudio"}),this.logger.log(`Stream.close:关闭所有设备成功: audio ${this.audio}, video ${this.video}, screen ${this.screen}, screenAudio ${this.screenAudio}`);break;default:s=errorCode_1.default.STREAM_CLOSE_ARGUMENT_ERROR,a="close() Unknown Type"}if(s)throw this.logger.error(a),this.client.apiFrequencyControl({name:"close",code:-1,param:JSON.stringify({reason:a,streamID:this.stringStreamID,audio:this.audio,video:this.video,screen:this.screen,type:e.type},null," ")}),o(),new rtcError_1.default({code:s,message:a});return o(),void this.client.apiFrequencyControl({name:"close",code:0,param:JSON.stringify({reason:s,streamID:this.stringStreamID,audio:this.audio,video:this.video,screen:this.screen,screenAudio:this.screenAudio,type:e.type},null," ")})}async unmuteAudio(){var e,t;this.logger.log("unmuteAudio() 启用音频轨道: ",this.stringStreamID);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.unmuteAudio());const r=this.mediaHelper.audio.audioStream.getAudioTracks();r&&r.length&&r.forEach((e=>{e.enabled=!0})),this.mediaHelper.getAudioInputTracks().forEach((e=>{e.enabled=!0})),(null===(t=this.mediaHelper.audio.webAudio)||void 0===t?void 0:t.gainFilter)&&(this.mediaHelper.audio.webAudio.gainFilter.gain.value=1),this.muteStatus.audio.send=!1,this.client.apiFrequencyControl({name:"unmuteAudio",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("unmuteAudio() 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteAudio",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}async muteAudio(){var e,t;this.logger.log("muteAudio() 禁用音频轨道: ",this.stringStreamID);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.muteAudio());const r=this.mediaHelper.audio.audioStream.getAudioTracks();r&&r.length&&r.forEach((e=>{e.enabled=!1})),this.mediaHelper.getAudioInputTracks().forEach((e=>{e.enabled=!1})),(null===(t=this.mediaHelper.audio.webAudio)||void 0===t?void 0:t.gainFilter)&&(this.mediaHelper.audio.webAudio.gainFilter.gain.value=0),this.muteStatus.audio.send=!0,this.client.apiFrequencyControl({name:"muteAudio",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("muteAudio() 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteAudio",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}async unmuteAudioSlave(){var e;this.logger.log("unmuteAudioSlave() 启用音频辅流轨道: ",this.stringStreamID);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.unmuteAudioSlave());const t=this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks();t&&t.length&&t.forEach((e=>{e.enabled=!0})),this.muteStatus.audioSlave.send=!1,this.client.apiFrequencyControl({name:"unmuteAudioSlave",code:0,param:JSON.stringify({streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("unmuteAudioSlave() 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteAudioSlave",code:-1,param:JSON.stringify({streamID:this.stringStreamID,reason:e},null," ")})}}async muteAudioSlave(){var e;this.logger.log("muteAudioSlave() 禁用音频辅流轨道: ",this.stringStreamID);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.muteAudioSlave());const t=this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks();t&&t.length&&t.forEach((e=>{e.enabled=!1})),this.muteStatus.audioSlave.send=!0,this.client.apiFrequencyControl({name:"muteAudioSlave",code:0,param:JSON.stringify({streamID:this.stringStreamID},null," ")})}catch(e){this.logger.error("muteAudioSlave() 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteAudioSlave",code:-1,param:JSON.stringify({streamID:this.stringStreamID,reason:e},null," ")})}}hasAudio(){return this.mediaHelper.getAudioInputTracks().length>0}hasAudioSlave(){return this.mediaHelper.getAudioSlaveInputTracks().length>0}getAudioLevel(e="audio"){var t,r;if("audio"===e){if(!this.audioLevelHelper&&this.mediaHelper.audio.audioStream.getAudioTracks().length){const e=webAudio_1.getAudioContext();e&&e.audioWorklet&&e.audioWorklet.addModule||(this.logger.error("getAudioLevel is not supported in this browser"),this.client.safeEmit("error","AUDIOLEVEL_NOT_SUPPORTED")),this.audioLevelHelper=new audioLevel_1.AudioLevel({stream:this.mediaHelper.audio.audioStream,logger:this.logger})}return(null===(t=this.audioLevelHelper)||void 0===t?void 0:t.getAudioLevel())||0}return!this.audioLevelHelperSlave&&this.mediaHelper.screenAudio.screenAudioStream.getAudioTracks().length&&(this.audioLevelHelperSlave=new audioLevel_1.AudioLevel({stream:this.mediaHelper.screenAudio.screenAudioStream,logger:this.logger})),(null===(r=this.audioLevelHelperSlave)||void 0===r?void 0:r.getAudioLevel())||0}getAudioSlaveLevel(){return this.mediaHelper.getGain()}setAudioProfile(e){this.logger.log("setAudioProfile() 设置音频属性: ",e),this.audioProfile=e,this.client.apiFrequencyControl({name:"setAudioProfile",code:0,param:{streamID:this.stringStreamID,profile:e}})}setAudioVolume(e=100){var t;let r,n;(!Number.isInteger(e)||e<0||e>100)&&(r=errorCode_1.default.SET_AUDIO_VOLUME_ARGUMENTS_ERROR,n="setAudioVolume() volume 应该为 0 - 100 的整数");const i=e/100;if(this.logger.log(`setAudioVolume() 调节${this.stringStreamID}的音量大小: ${2.55*e} (normalized: ${i})`),this.audio?null===(t=this._play)||void 0===t||t.setPlayVolume("audio",i):(n="setAudioVolume() 没有音频流，请检查是否有发布过音频",r=errorCode_1.default.SET_AUDIO_VOLUME_ERROR),this.client.apiFrequencyControl({name:"setAudioVolume",code:r?-1:0,param:{streamID:this.stringStreamID,isRemote:!1,volume:2.55*e,normalizedVolume:i,reason:n}}),r)throw this.logger.error(n),new rtcError_1.default({code:r,message:n})}setCaptureVolume(e,t){let r,n;if(Number.isInteger(e)?(e<0||e>100)&&(r=errorCode_1.default.STREAM_SET_CAPTURE_VOLUME_ARGUMENT_ERROR,n="setCaptureVolume() volume 应该为 0 - 100 的整数"):(r=errorCode_1.default.SET_CAPTURE_VOLUME_ARGUMENTS_ERROR,n="setCaptureVolume() volume 应该为 0 - 100 的整数"),this.client.apiFrequencyControl({name:"setCaptureVolume",code:r?-1:0,param:JSON.stringify({streamID:this.stringStreamID,audioType:t,volume:e},null," ")}),r)throw this.logger.error(n),new rtcError_1.default({code:r,message:n});this.logger.log(`setCaptureVolume() 调节${this.stringStreamID}的音量大小: ${e}`),this.mediaHelper.audio.audioRoutingEnabled||this.mediaHelper.enableAudioRouting(),this.mediaHelper.setGain(e/100,t)}async setAudioOutput(e,t){if(this._play){try{await this._play.setAudioOutput(e)}catch(e){throw t&&setTimeout((()=>{t(e)}),0),this.logger.error("设置输出设备失败",e.name,e.message),new rtcError_1.default({code:errorCode_1.default.SET_AUDIO_OUTPUT_ERROR,message:e.message||"系统内部错误"})}t&&setTimeout(t,0)}this.client.apiFrequencyControl({name:"setAudioOutput",code:0,param:JSON.stringify({streamID:this.stringStreamID,deviceId:e,isRemote:!1},null," ")})}async switchDevice(e,t){this.logger.log(`switchDevice() 切换媒体输入设备: ${e}, deviceId: ${t}`);let r,n,i={};if(this.inSwitchDevice[e]?(n="switchDevice() 正在切换中, 重复切换 "+e,r=errorCode_1.default.SWITCH_DEVICE_REPEAT_ERROR):this.inSwitchDevice[e]=!0,"audio"===e){const o=this.mediaHelper.audio.micTrack;if("live"===(null==o?void 0:o.readyState)&&(null==o?void 0:o.getSettings().deviceId)===t)return void this.logger.warn("switchDevice() 切换相同的麦克风设备，不处理");if(this.hasAudio()?this.audioSource&&(n="switchDevice() 自定义音频输入不支持，无法切换",r=errorCode_1.default.SWITCH_DEVICE_NO_SUPPORT_AUDIO):(n="switchDevice() 当前没有开启音频输入设备，无法切换",r=errorCode_1.default.SWITCH_DEVICE_NO_MIC_ERROR),r)throw this.logger.error(n),this.inSwitchDevice[e]=!1,this.client.apiFrequencyControl({name:"switchDevice",code:-1,param:{reason:n,type:e,deviceId:t,streamID:this.stringStreamID}}),new rtcError_1.default({code:r,message:n});this.mediaHelper.audio.micConstraint&&this.mediaHelper.audio.micConstraint.audio?this.mediaHelper.audio.micConstraint.audio.deviceId={exact:t}:this.mediaHelper.audio.micConstraint?(this.mediaHelper.audio.micConstraint.audio={},this.mediaHelper.audio.micConstraint.audio.deviceId={exact:t}):this.mediaHelper.audio.micConstraint={audio:{deviceId:{exact:t}}},i=this.mediaHelper.audio.micConstraint,this.microphoneId=t}else{if("video"!==e)return this.logger.error("switchDevice() type参数错误: "+e),Promise.reject(new rtcError_1.default({code:errorCode_1.default.SWITCH_DEVICE_REPEAT_ARGUMENTS_ERROR,message:"switchDevice() type参数错误: "+e}));{const o=this.mediaHelper.video.cameraTrack;if(await this.suspendVideoPostProcess(),this._transformedTrack&&(this._transformedTrack.stop(),this._transformedTrack=null),"live"===(null==o?void 0:o.readyState)&&(null==o?void 0:o.getSettings().deviceId)===t)return this.logger.log("switchDevice() 切换相同的摄像头设备，不处理"),void(this.inSwitchDevice[e]=!1);if(this.hasVideo()?this.videoSource&&(n="switchDevice() 自定义视频输入不支持切换",r=errorCode_1.default.SWITCH_DEVICE_NO_SUPPORT_VIDEO):(n="switchDevice() 当前没有开启视频输入设备，无法切换",r=errorCode_1.default.SWITCH_DEVICE_NO_CAMERA_ERROR),r)return this.logger.error(n),this.inSwitchDevice[e]=!1,this.client.apiFrequencyControl({name:"switchDevice",code:-1,param:{reason:n,type:e,deviceId:t,streamID:this.stringStreamID}}),Promise.reject(new rtcError_1.default({code:r,message:n}));this.mediaHelper.video.cameraConstraint&&this.mediaHelper.video.cameraConstraint.video&&(this.mediaHelper.video.cameraConstraint.video.deviceId={exact:t},i=this.mediaHelper.video.cameraConstraint),this.cameraId=t,this.replaceTags.isMuted&&(this.replaceTags.isMuted=!1,this.virtualBackground.emptyFrame=!1)}}try{const r=this.mediaHelper.video.preProcessingEnabled;r&&this.mediaHelper.disablePreProcessing("video"),await this.mediaHelper.getSecondStream(i),this.inSwitchDevice[e]=!1,r&&this.mediaHelper.enablePreProcessing("video"),"video"===e&&await this.resumeVideoPostProcess(),this.client.apiFrequencyControl({name:"switchDevice",code:0,param:{type:e,deviceId:t,streamID:this.stringStreamID}}),this.client.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(this.mediaHelper.getTrackSettings())}),this._play.resume()}catch(r){throw this.logger.error("switchDevice() 异常：",r.name,r.message,r),this.inSwitchDevice[e]=!1,this.client.apiFrequencyControl({name:"switchDevice",code:-1,param:{reason:r.message,type:e,deviceId:t,streamID:this.stringStreamID}}),this.client.apiFrequencyControl({name:"_trackSettings",code:0,param:JSON.stringify(this.mediaHelper.getTrackSettings())}),new rtcError_1.default({code:r.code||errorCode_1.default.UNKNOWN_TYPE_ERROR,message:r.message||r.name})}}async unmuteVideo(){var e,t;this.logger.log(`unmuteVideo() 启用 ${this.stringStreamID} 的视频轨道`);try{if(this.virtualBackground&&(this.virtualBackground.emptyFrame=!1),this.getAdapterRef()&&(null===(e=this.client.adapterRef._mediasoup)||void 0===e||e.unmuteVideo()),this.mediaHelper.video.videoSource&&(this.mediaHelper.video.videoSource.enabled=!0),this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!0),this.videoPostProcess.sourceTrack&&(this.videoPostProcess.sourceTrack.enabled=!0),env.IS_SAFARI){const e=null===(t=this._play)||void 0===t?void 0:t.video.containerDom;e&&(e.style.backgroundColor="")}this.muteStatus.video.send=!1,this.client.apiFrequencyControl({name:"unmuteVideo",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")}),this.replaceTags.isMuted=!1}catch(e){this.logger.error("unmuteVideo() 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"unmuteVideo",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}async muteVideo(){var e,t;this.logger.log(`muteVideo() 禁用 ${this.stringStreamID} 的视频轨道`);try{if(this.virtualBackground&&(this.virtualBackground.emptyFrame=!0),env.IS_SAFARI){const t=null===(e=this._play)||void 0===e?void 0:e.video.dom;t&&(t.style.backgroundColor="black")}this.getAdapterRef()&&await(null===(t=this.client.adapterRef._mediasoup)||void 0===t?void 0:t.muteVideo()),this.mediaHelper.video.videoSource&&(this.mediaHelper.video.videoSource.enabled=!1),this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!1),this.videoPostProcess.sourceTrack&&(this.videoPostProcess.sourceTrack.enabled=!1),this.muteStatus.video.send=!0,this.client.apiFrequencyControl({name:"muteVideo",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")}),this.replaceTags.isMuted=!0}catch(e){this.logger.error("muteVideo() 异常: ",e.name,e.message,e),this.client.apiFrequencyControl({name:"muteVideo",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")}),this.replaceTags.isMuted=!1}}async unmuteScreen(){var e;this.logger.log(`unmuteScreen() 启用 ${this.stringStreamID} 的视频轨道`);try{this.getAdapterRef()&&(null===(e=this.client.adapterRef._mediasoup)||void 0===e||e.unmuteScreen()),this.mediaHelper.screen.screenVideoTrack&&(this.mediaHelper.screen.screenVideoTrack.enabled=!0),this.mediaHelper.screen.screenVideoSource&&(this.mediaHelper.screen.screenVideoSource.enabled=!0),this.muteStatus.screen.send=!1,this.client.apiFrequencyControl({name:"unmuteScreen",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("unmuteScreen() 异常: ",e.name,e.message),this.client.apiFrequencyControl({name:"unmuteScreen",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}async muteScreen(){var e;this.logger.log(`muteScreen() 禁用 ${this.stringStreamID} 的辅流轨道`);try{this.getAdapterRef()&&await(null===(e=this.client.adapterRef._mediasoup)||void 0===e?void 0:e.muteScreen()),this.mediaHelper.screen.screenVideoSource&&(this.mediaHelper.screen.screenVideoSource.enabled=!1),this.mediaHelper.screen.screenVideoTrack&&(this.mediaHelper.screen.screenVideoTrack.enabled=!1),this.muteStatus.screen.send=!0,this.client.apiFrequencyControl({name:"muteScreen",code:0,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1},null," ")})}catch(e){this.logger.error("muteScreen() ",e.message),this.client.apiFrequencyControl({name:"muteScreen",code:-1,param:JSON.stringify({streamID:this.stringStreamID,isRemote:!1,reason:e.message},null," ")})}}hasVideo(){return this.logger.log("hasVideo()"),this.mediaHelper.video.videoStream.getVideoTracks().length>0}async setVideoProfile(e){e.resolution>-1&&(this.videoProfile.resolution=e.resolution),e.frameRate>-1&&(this.videoProfile.frameRate=e.frameRate),this.mediaHelper.video.captureConfig.high=this.mediaHelper.convert(this.videoProfile),this.mediaHelper.video.encoderConfig.high.maxBitrate=this.getVideoBW(this.videoProfile)||this.mediaHelper.video.encoderConfig.high.maxBitrate,this.logger.log(`setVideoProfile() options: ${JSON.stringify(e)}, 视频采集参数: ${JSON.stringify(this.mediaHelper.video.captureConfig.high)}, 编码参数: ${JSON.stringify(this.mediaHelper.video.encoderConfig.high)}`),this.client.adapterRef.channelInfo.sessionConfig.maxVideoQuality=videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p,this.client.adapterRef.channelInfo.sessionConfig.videoQuality=this.videoProfile.resolution,this.client.adapterRef.channelInfo.sessionConfig.videoFrameRate=this.videoProfile.frameRate;let t=this.mediaHelper.video.cameraTrack;if(this.videoPostProcess.hasAnyTask&&(this.logger.log("setVideoProfile() 侦测到美颜在开启状态"),t=this.videoPostProcess.sourceTrack),t)try{this.logger.log(`setVideoProfile() 尝试动态修改分辨率【${t.label}】`),await applyResolution_1.applyResolution({track:t,targetWidth:this.mediaHelper.video.captureConfig.high.width,targetHeight:this.mediaHelper.video.captureConfig.high.height,keepAspectRatio:parameters_1.getParameters().keepAspectRatio,logger:this.logger});const e=t.getSettings();e.width&&e.height&&(this.mediaHelper.video.cameraConstraint.video.width=e.width,this.mediaHelper.video.cameraConstraint.video.height=e.height)}catch(e){this.logger.error("setVideoProfile() 无法设置动态分辨率:",e.name,e.message)}const r=this.getSender("video","high");if(r){const t=r.getParameters(),n=t.encodings&&t.encodings[0];if((null==n?void 0:n.maxBitrate)!==this.mediaHelper.video.encoderConfig.high.maxBitrate){this.logger.log(`setVideoProfile() 调整上行码率 ${n.maxBitrate} => ${this.mediaHelper.video.encoderConfig.high.maxBitrate}`),n.maxBitrate=this.mediaHelper.video.encoderConfig.high.maxBitrate;try{r.setParameters(t)}catch(e){this.logger.warn("setVideoProfile() 无法调整上行码率: ",e.name,e.message)}}}this.client.apiFrequencyControl({name:"setVideoProfile",code:0,param:Object.assign({streamID:this.stringStreamID},e)}),this.replaceCanvas()}setVideoEncoderConfiguration(e){if(e.mediaType=e.mediaType||"video",e.streamType=e.streamType||"high",this.logger.log("setVideoEncoderConfiguration() 自定义视频编码配置: ",e),this.mediaHelper[e.mediaType].encoderConfig[e.streamType]){if(e.maxBitrate){const t=1e3*e.maxBitrate;this.logger.log(`setVideoEncoderConfiguration() 设置maxBitrate ${e.mediaType} ${e.streamType} ${this.mediaHelper[e.mediaType].encoderConfig[e.streamType].maxBitrate} => ${t}`),this.mediaHelper[e.mediaType].encoderConfig[e.streamType].maxBitrate=t}else this.logger.log("setVideoEncoderConfiguration:未设定maxBitrate。保留目前的值: ",e.mediaType,e.streamType,this.mediaHelper[e.mediaType].encoderConfig[e.streamType].maxBitrate);"string"==typeof e.contentHint?(this.logger.log(`setVideoEncoderConfiguration: 应用 contentHint ${e.mediaType} ${e.streamType} ${this.mediaHelper[e.mediaType].encoderConfig[e.streamType].contentHint} => ${e.contentHint}`),this.mediaHelper[e.mediaType].encoderConfig[e.streamType].contentHint=e.contentHint):this.logger.log("setVideoEncoderConfiguration: 未设定 contentHint。保留目前的值：",e.mediaType,e.streamType,this.mediaHelper[e.mediaType].encoderConfig[e.streamType].contentHint)}else this.logger.warn("setVideoEncoderConfiguration() 无法识别的媒体类型：",e.mediaType,e.streamType);this.getSender(e.mediaType,e.streamType)&&this.applyEncoderConfig(e.mediaType,e.streamType),this.client.apiFrequencyControl({name:"setVideoEncoderConfiguration",code:0,param:{streamID:this.stringStreamID,options:e}})}async replaceTrack(e){let t,r=!1,n=!1,i="video";if("screen"===e.mediaType)n=this.mediaHelper.screen.preProcessingEnabled,i=e.mediaType,n&&this.mediaHelper.disablePreProcessing("screen"),this.mediaHelper.screen.screenVideoTrack?(t=this.mediaHelper.screen.screenVideoTrack,this.mediaHelper.screen.screenVideoTrack=null):this.mediaHelper.screen.screenVideoSource&&(r=!0,t=this.mediaHelper.screen.screenVideoSource,this.mediaHelper.screen.screenVideoSource=null),t&&(e.external?this.mediaHelper.screen.screenVideoSource=e.track:this.mediaHelper.screen.screenVideoTrack=e.track,gum_1.emptyStreamWith(this.mediaHelper.screen.screenVideoStream,e.track),gum_1.emptyStreamWith(this.mediaHelper.screen.renderStream,e.track),this.mediaHelper.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.mediaHelper.screen.encoderConfig.high.contentHint&&this.mediaHelper.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.mediaHelper.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.mediaHelper.screen.encoderConfig.high.contentHint),this.mediaHelper.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.mediaHelper.screen.encoderConfig.high.contentHint));else if("video"===e.mediaType){const n=this.mediaHelper.video.preProcessingEnabled;i=e.mediaType,n&&this.mediaHelper.disablePreProcessing("video"),this.mediaHelper.video.cameraTrack?(t=this.mediaHelper.video.cameraTrack,this.mediaHelper.video.cameraTrack=null):this.mediaHelper.video.videoSource&&(r=!0,t=this.mediaHelper.video.videoSource,this.mediaHelper.video.videoSource=null),t&&(e.external?this.mediaHelper.video.videoSource=e.track:this.mediaHelper.video.cameraTrack=e.track,gum_1.emptyStreamWith(this.mediaHelper.video.videoStream,e.track),gum_1.emptyStreamWith(this.mediaHelper.video.renderStream,e.track),this.mediaHelper.video.videoStream.getVideoTracks().length&&"string"==typeof this.mediaHelper.video.encoderConfig.high.contentHint&&this.mediaHelper.video.videoStream.getVideoTracks()[0].contentHint!==this.mediaHelper.video.encoderConfig.high.contentHint&&(this.logger.log("replaceTrack() 应用 contentHint video high",this.mediaHelper.video.encoderConfig.high.contentHint),this.mediaHelper.video.videoStream.getVideoTracks()[0].contentHint=this.mediaHelper.video.encoderConfig.high.contentHint),this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("video"))}if(!t)return this.logger.error(`replaceTrack() ${e.mediaType} 当前没有可替换的流`),null;if(this.logger.log(`replaceTrack ${e.mediaType}【external: ${r} ${t.label}】=>【external: ${e.external} ${e.track.label}】`),gum_1.watchTrack(e.track),this.mediaHelper.listenToTrackEnded(e.track),n)this.mediaHelper.enablePreProcessing(i);else{const t=this.getSender(e.mediaType,"high");t&&(t.replaceTrack(e.track),this.logger.log(`replaceTrack() ${e.mediaType} 成功替换上行`))}return this.replaceTags.isMuted&&this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!1),{oldTrack:t,external:r}}hasScreen(){return this.mediaHelper.screen.screenVideoStream.getVideoTracks().length>0}setScreenProfile(e){e.frameRate>-1&&(this.screenProfile.frameRate=e.frameRate),e.resolution>-1&&(this.screenProfile.resolution=e.resolution),this.mediaHelper.screen.captureConfig.high=this.mediaHelper.convert(this.screenProfile),this.mediaHelper.screen.encoderConfig.high.maxBitrate=this.getVideoBW(this.screenProfile),this.logger.log(`setScreenProfile() profile: ${JSON.stringify(e)}, 屏幕共享采集参数: ${JSON.stringify(this.mediaHelper.screen.captureConfig.high)}, 编码参数: ${JSON.stringify(this.mediaHelper.screen.encoderConfig.high)}`),this.client.adapterRef.channelInfo.sessionConfig.screenQuality=e,this.mediaHelper.screen.screenVideoTrack&&applyResolution_1.applyResolution({track:this.mediaHelper.screen.screenVideoTrack,targetWidth:this.mediaHelper.screen.captureConfig.high.width,targetHeight:this.mediaHelper.screen.captureConfig.high.height,keepAspectRatio:parameters_1.getParameters().keepAspectRatio,logger:this.logger});const t=this.getSender("screen","high");if(t){const r=t.getParameters(),n=r.encodings&&r.encodings[0];if((null==n?void 0:n.maxBitrate)!==this.mediaHelper.screen.encoderConfig.high.maxBitrate){this.logger.log(`setScreenProfile() 调整上行码率 ${n.maxBitrate} => ${this.mediaHelper.screen.encoderConfig.high.maxBitrate}`),n.maxBitrate=this.mediaHelper.screen.encoderConfig.high.maxBitrate;try{t.setParameters(r)}catch(e){this.logger.error("setScreenProfile() 无法调整上行码率",e.name,e.message)}}}this.client.apiFrequencyControl({name:"setScreenProfile",code:0,param:Object.assign({streamID:this.stringStreamID},e)})}getSender(e,t){var r,n,i;const o=null===(i=null===(n=null===(r=this.getAdapterRef())||void 0===r?void 0:r._mediasoup)||void 0===n?void 0:n._sendTransport)||void 0===i?void 0:i.handler._pc;let s=null;return o&&("audio"===e&&(s="high"===t?o.audioSender:null),"video"===e?s="high"===t?o.videoSender:o.videoSenderLow:"screen"===e?s="high"===t?o.screenSender:o.screenSenderLow:"audioSlave"===e&&(s=o.audioSlaveSender)),s||null}applyEncoderConfig(e,t){let r=this.mediaHelper[e].encoderConfig[t].maxBitrate;if(!r)return;let n=this.getSender(e,t);if(!n)return void this.logger.error("localStream.applyEncoderConfig: cannot find sender for ",e,t);let i=this.mediaHelper[e].encoderConfig[t].contentHint;"string"==typeof i&&n.track&&n.track.contentHint!==i&&(this.logger.log(`applyEncoderConfig 应用 contentHint：${e} ${t} ${n.track.contentHint} => ${i}`),n.track.contentHint=i);const o=n.getParameters();let s;o.encodings&&o.encodings.length?(s=o.encodings[0].maxBitrate,o.encodings[0].maxBitrate=r):o.encodings=[{maxBitrate:r}],n.setParameters(o).then((()=>{this.logger.log(`最大编码码率：${e} ${t} ${s?s+"=>":""}${r}`)})).catch((n=>{this.logger.error(`应用最大编码码率失败：${e} ${t} ${r}`,o,n.name,n.message)}))}getVideoBW(e){return e.resolution==videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_180p?e.frameRate<=videoQuality_1.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_15?14e4:22e4:e.resolution==videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_480p?e.frameRate<=videoQuality_1.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_15?5e5:75e4:e.resolution==videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_720p?e.frameRate<=videoQuality_1.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_15?113e4:171e4:e.resolution==videoQuality_1.NERTC_VIDEO_QUALITY.VIDEO_QUALITY_1080p?e.frameRate<=videoQuality_1.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_15?208e4:315e4:(this.logger.warn("发现不支持的 NERTC_VIDEO_QUALITY "+e.resolution),8e5)}async takeSnapshot(e){var t,r,n,i;let o,s;const a=this.video&&(null===(r=null===(t=this._play)||void 0===t?void 0:t.video)||void 0===r?void 0:r.dom),c=this.screen&&(null===(i=null===(n=this.Play)||void 0===n?void 0:n.screen)||void 0===i?void 0:i.dom);if(a||c?(this.logger.log("takeSnapshot() options: "+JSON.stringify(e)),await this._play.takeSnapshot(e,"download",this.streamID),this.client.apiFrequencyControl({name:"takeSnapshot",code:0,param:Object.assign({streamID:this.stringStreamID,isRemote:!1},e)})):(s="takeSnapshot(): 没有视频流, 请检查视频是否正在播放",o=errorCode_1.default.STREAM_TAKE_SNAPSHOT_ERROR),o)throw this.logger.error(s),this.client.apiFrequencyControl({name:"takeSnapshot",code:-1,param:JSON.stringify(Object.assign(Object.assign({streamID:this.stringStreamID,isRemote:!1},e),{reason:s}),null," ")}),new rtcError_1.default({code:o,message:s})}takeSnapshotBase64(e){var t,r,n,i;let o,s;const a=this.video&&(null===(r=null===(t=this._play)||void 0===t?void 0:t.video)||void 0===r?void 0:r.dom),c=this.screen&&(null===(i=null===(n=this.Play)||void 0===n?void 0:n.screen)||void 0===i?void 0:i.dom);if(a||c){let t=this._play.takeSnapshot(e,"base64");return this.client.apiFrequencyControl({name:"takeSnapshotBase64",code:0,param:Object.assign({streamID:this.stringStreamID,isRemote:!1},e)}),t}if(s="takeSnapshotBase64(): 没有视频流, 请检查视频是否正在播放",o=errorCode_1.default.STREAM_TAKE_SNAPSHOT_ERROR,o)throw this.logger.error(s),this.client.apiFrequencyControl({name:"takeSnapshotBase64",code:-1,param:JSON.stringify(Object.assign(Object.assign({streamID:this.stringStreamID,isRemote:!1},e),{reason:s}),null," ")}),new rtcError_1.default({code:o,message:s})}getCurrentFrameData(e={mediaType:"video"}){return this._play.getCurrentFrameData(e)}async startMediaRecording(e){const t=[];switch(e.type){case"screen":t.push(this.mediaHelper.screen.screenVideoStream),t.push(this.mediaHelper.audio.audioStream);break;case"camera":case"video":t.push(this.mediaHelper.video.videoStream),t.push(this.mediaHelper.audio.audioStream);break;case"audio":if(t.push(this.mediaHelper.audio.audioStream),this.client.adapterRef.remoteStreamMap)for(var r in this.client.adapterRef.remoteStreamMap){const e=this.client.adapterRef.remoteStreamMap[r];t.push(e.mediaHelper.audio.audioStream)}}if(0!==t.length){if(!this._record||!this.streamID||!t)throw new rtcError_1.default({code:errorCode_1.default.RECORDING_ERROR,message:"localStream_startMediaRecording: 开始录制时参数异常"});return this._record&&this._record.start({uid:"string"===this.client.adapterRef.channelInfo.uidType?this.stringStreamID:this.streamID,type:e.type,reset:e.reset,stream:t})}this.logger.log("没有没发现要录制的媒体流")}stopMediaRecording(e){if(!this._record||!this._record.recoder)throw new rtcError_1.default({code:errorCode_1.default.RECORDING_NOT_START_ERROR,message:"localStream.stopMediaRecording: 录制未开始"});return this._record.stop({})}playMediaRecording(e){if(!this._record||!this._record.recoder)throw new rtcError_1.default({code:errorCode_1.default.RECORDING_NOT_START_ERROR,message:"localStream.playMediaRecording: 录制未开始"});return this._record.play(e.view)}listMediaRecording(){let e=[];if(!this._record||!this._record.recoder)throw new rtcError_1.default({code:errorCode_1.default.RECORDING_NOT_START_ERROR,message:"localStream.listMediaRecording: 录制未开始"});const t=this._record.getRecordStatus();return"init"!==t.status&&e.push(t),e}cleanMediaRecording(e){if(!this._record||!this._record.recoder)throw new rtcError_1.default({code:errorCode_1.default.RECORDING_NOT_START_ERROR,message:"localStream.cleanMediaRecording: 录制未开始"});return this._record.clean()}downloadMediaRecording(e){if(!this._record||!this._record.recoder)throw new rtcError_1.default({code:errorCode_1.default.RECORDING_NOT_START_ERROR,message:"localStream.downloadMediaRecording: 录制未开始"});return this._record.download()}startAudioMixing(e){return this.logger.log("startAudioMixing() 开始伴音"),this.mediaHelper.startAudioMixing(e)}stopAudioMixing(){return this.logger.log("stopAudioMixing() 停止伴音"),this.mediaHelper.stopAudioMixing()}pauseAudioMixing(){return this.logger.log("pauseAudioMixing() 暂停伴音"),this.mediaHelper.pauseAudioMixing()}resumeAudioMixing(){return this.logger.log("resumeAudioMixing() 恢复伴音"),this.mediaHelper.resumeAudioMixing()}adjustAudioMixingVolume(e){return this.logger.log("adjustAudioMixingVolume() 调节伴音音量: ",e),this.mediaHelper.setAudioMixingVolume(e)}getAudioMixingDuration(){return this.logger.log("getAudioMixingDuration() 获取伴音总时长"),this.mediaHelper.getAudioMixingTotalTime()}getAudioMixingCurrentPosition(){return this.mediaHelper.getAudioMixingPlayedTime()}setAudioMixingPosition(e){return this.logger.log("setAudioMixingPosition() 设置伴音音频文件的播放位置: ",e),this.mediaHelper.setAudioMixingPlayTime(e)}async playEffect(e){return this.logger.log("playEffect() 开始播放音效: ",JSON.stringify(e,null," ")),this.mediaHelper.playEffect(e)}async stopEffect(e){return this.logger.log("stopEffect() 停止播放音效: ",e),this.mediaHelper.stopEffect(e)}async pauseEffect(e){return this.logger.log("pauseEffect() 暂停播放音效：",e),this.mediaHelper.pauseEffect(e)}async resumeEffect(e){return this.logger.log("resumeEffect() 恢复播放音效文件: ",e),this.mediaHelper.resumeEffect(e)}async setVolumeOfEffect(e,t){return this.logger.log(`setVolumeOfEffect() 调节 ${e} 音效文件音量为: ${t}`),this.mediaHelper.setVolumeOfEffect(e,t)}async preloadEffect(e,t){return this.logger.log(`preloadEffect() 预加载 ${e} 音效文件地址: ${t}`),this.mediaHelper.preloadEffect(e,t)}async unloadEffect(e){return this.logger.log("unloadEffect() 释放指定音效文件 "+e),this.mediaHelper.unloadEffect(e)}getEffectsVolume(){return this.logger.log("getEffectsVolume() 获取所有音效文件播放音量"),this.mediaHelper.getEffectsVolume()}setEffectsVolume(e){return this.logger.log("setEffectsVolume() 设置所有音效文件播放音量:",e),this.mediaHelper.setEffectsVolume(e)}async stopAllEffects(){return this.logger.log("stopAllEffects() 停止播放所有音效文件"),this.mediaHelper.stopAllEffects()}async pauseAllEffects(){return this.logger.log("pauseAllEffects() 暂停播放所有音效文件"),this.mediaHelper.pauseAllEffects()}async resumeAllEffects(){return this.logger.log("resumeAllEffects() 恢复播放所有音效文件"),this.mediaHelper.resumeAllEffects()}getAudioEffectsDuration(e){return this.logger.log("getAudioEffectsDuration() 获取音效总时长"),this.mediaHelper.getAudioEffectsTotalTime(e)}getAudioEffectsCurrentPosition(e){return this.mediaHelper.getAudioEffectsPlayedTime(e)}setCanvasWatermarkConfigs(e){if(this._play){let t="screen"===e.mediaType?this._play.screen.canvasWatermark:this._play.video.canvasWatermark;if(!t)return void this.logger.error("setCanvasWatermarkConfigs：播放器未初始化",e.mediaType);const r={TEXT:10,TIMESTAMP:1,IMAGE:4};if(e.textWatermarks&&e.textWatermarks.length>r.TEXT)throw this.logger.error(`目前的文字水印数量：${e.textWatermarks.length}。允许的数量：${r.TEXT}`),new rtcError_1.default({code:errorCode_1.default.WATERMARKS_EXCEEDED_ERROR,message:"最多可以设置 10 个文字水印"});if(e.imageWatermarks&&e.imageWatermarks.length>r.IMAGE)throw this.logger.error(`目前的图片水印数量：${e.imageWatermarks.length}。允许的数量：${r.IMAGE}`),new rtcError_1.default({code:errorCode_1.default.WATERMARKS_EXCEEDED_ERROR,message:"最多可以设置 4 个图片水印"});t.checkWatermarkParams(e),t.updateWatermarks(e),this.canvasWatermarkOptions=e,this.client.apiFrequencyControl({name:"setLocalCanvasWatermarkConfigs",code:0,param:{streamID:this.stringStreamID,isRemote:!1,mediaType:e.mediaType}})}else this.logger.error("setCanvasWatermarkConfigs: 播放器未初始化")}setEncoderWatermarkConfigs(e){var t,r;if(this._play&&this._play){const n=e.mediaType||"video",i=this._play[n].encoderWatermark;if(!i)return void this.logger.error("setEncoderWatermarkConfigs: 播放器未初始化",e.mediaType);(null===(t=e.textWatermarks)||void 0===t?void 0:t.length)||e.timestampWatermarks||(null===(r=e.imageWatermarks)||void 0===r?void 0:r.length)?(i.handler.enabled=!0,this.mediaHelper[n].preProcessingEnabled||this.mediaHelper.enablePreProcessing(n)):(i.handler.enabled=!1,this.mediaHelper.canDisablePreProcessing(n)&&this.mediaHelper.disablePreProcessing(n));const o={TEXT:10,TIMESTAMP:1,IMAGE:4};if(e.textWatermarks&&e.textWatermarks.length>o.TEXT)throw this.logger.error(`目前的文字水印数量：${e.textWatermarks.length}。允许的数量：${o.TEXT}`),new rtcError_1.default({code:errorCode_1.default.WATERMARKS_EXCEEDED_ERROR,message:"最多可以设置 10 个文字水印"});if(e.imageWatermarks&&e.imageWatermarks.length>o.IMAGE)throw this.logger.error(`目前的图片水印数量：${e.imageWatermarks.length}。允许的数量：${o.IMAGE}`),new rtcError_1.default({code:errorCode_1.default.WATERMARKS_EXCEEDED_ERROR,message:"最多可以设置 4 个图片水印"});i.checkWatermarkParams(e),i.updateWatermarks(e),this.encoderWatermarkOptions=e,this.client.apiFrequencyControl({name:"setEncoderWatermarkConfigs",code:0,param:JSON.stringify(e,null,2)})}else this.logger.error("setEncoderWatermarkConfigs: 播放器未初始化")}getMuteStatus(e){return"audio"===e?{muted:this.muteStatus.audio.send}:"video"===e?{muted:this.muteStatus.video.send}:{muted:this.muteStatus.screen.send}}WebGLSupportError(){if(0===this.videoPostProcess.availableCode)throw new rtcError_1.default({code:errorCode_1.default.WEBGL_NOT_SUPPORT_ERROR,message:"当前环境不支持 WebGL"})}setBeautyEffectOptions(e){if(this.logger.log("set basic beauty parameters:",e),!(this.videoPostProcess.availableCode<1)){this.basicBeauty.isEnable||this.logger.warn("basic beauty is not opened.");for(const t in e)try{e[t]=Math.min(Math.max(parseFloat(e[t]+""),0),1)}catch(r){e[t]=0,this.logger.error("setBeautyEffectOptions:"+r.message)}this.lastEffects=Object.assign(Object.assign({},this.lastEffects),e),this.basicBeauty.setBeautyOptions(e)}}async setBeautyEffect(e,t=!1){if(this.logger.log((e?"start":"close")+" basic beauty."),this.WebGLSupportError(),e&&this.videoPostProcess.availableCode<2)return this.logger.error(this.videoPostProcess.glErrorTip);const r=this.basicBeauty;if(!t){if(e&&r.isEnable)return this.logger.warn("basic beauty is already opened");if(!e&&!r.isEnable)return this.logger.warn("basic beauty is already closed")}if(this.videoPostProcessTags.isBeautyTrack=e,this.mediaHelper&&this.mediaHelper.video.cameraTrack){this.replaceTags.waterMark&&this.mediaHelper.disablePreProcessing("video",!0),this._cameraTrack=this.mediaHelper.video.cameraTrack;let n=0;try{this._transformedTrack=await r.setBeauty(e,this._cameraTrack),await this.replacePluginTrack({mediaType:"video",track:this._transformedTrack,external:!1})}catch(e){n=-1,this.logger.error("setBeautyEffect:"+e.message)}if(this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("video"),e&&0===n){let e;e=this.lastEffects?this.lastEffects:{brightnessLevel:0,rednessLevel:0,smoothnessLevel:0},r.setBeautyOptions(e)}t||this.client.apiFrequencyControl({name:"setBeautyEffect",code:n,param:{streamID:this.stringStreamID,isRemote:!1,isEnable:e}})}else this.logger.log("setBeautyEffect:video track not ready.")}setFilter(e,t){if(this.logger.log("set beauty filter parameters:"+JSON.stringify([e,t])),!(this.videoPostProcess.availableCode<1)){this.basicBeauty.isEnable||this.logger.warn("basic beauty is not opened.");try{void 0!==t&&(t=Math.min(Math.max(parseFloat(t+""),0),1))}catch(e){t=void 0,this.logger.error("setFilter:"+e.message)}this.lastFilter=e,this.basicBeauty.setFilter(e,t)}}async enableBodySegment(){if(this.logger.log("start virtual background."),this.WebGLSupportError(),this.videoPostProcess.availableCode<2)return this.logger.error(this.videoPostProcess.glErrorTip);if(!this.videoPostProcess.getPlugin("VirtualBackground"))throw this.logger.error("virtual background plugin is not register."),new rtcError_1.default({code:errorCode_1.default.PLUGIN_NOT_REGISTER,message:"virtual background plugin is not register"});if(this._segmentProcessor)return this.logger.warn("virtual background is already opened.");this._segmentProcessor=this.virtualBackground,this._segmentProcessor.init(),this._segmentProcessor.once("segment-load",(async()=>{var e;let t=0;try{await this._startBodySegment()}catch(r){null===(e=this._segmentProcessor)||void 0===e||e.destroy(),this._segmentProcessor=null,t=-1,this.logger.error("enableBodySegment:"+r.message)}this.client.apiFrequencyControl({name:"enableBodySegment",code:t,param:{streamID:this.stringStreamID}})})),env.IS_ANY_SAFARI&&parseFloat(env.SAFARI_VERSION||"0")<15&&this.logger.warn("In the current version of Safari, wasm has low execution efficiency, which will result in low frame rate when background-segmentation is enabled.")}async disableBodySegment(){if(this.logger.log("close virtual background."),this.WebGLSupportError(),this._segmentProcessor){let e=0;try{await this._cancelBodySegment(),this._segmentProcessor.destroy(),this._segmentProcessor=null}catch(t){e=-1,this.logger.error("disableBodySegment:"+t.message)}this.client.apiFrequencyControl({name:"disableBodySegment",code:e,param:{streamID:this.stringStreamID}})}else this.logger.warn("virtual background is already closed.")}async _startBodySegment(){this.videoPostProcess.availableCode<2||this._segmentProcessor&&(await this.transformTrack(!0,this._segmentProcessor),this.videoPostProcessTags.isBodySegmentTrack=!0)}async _cancelBodySegment(){this.videoPostProcess.availableCode<1||this._segmentProcessor&&(await this.transformTrack(!1,this._segmentProcessor),this.videoPostProcessTags.isBodySegmentTrack=!1)}setBackground(e){this.logger.log("set virtual background parameters:"+JSON.stringify(e)),this.videoPostProcess.availableCode<1||(this.virtualBackground.isEnable||this.logger.warn("virtual background is not opened."),this.virtualBackground.setVirtualBackGround(e))}setBackGround(e){this.setBackground(e)}async enableAdvancedBeauty(e){if(this.logger.log("start advanced beauty."),this.WebGLSupportError(),this.videoPostProcess.availableCode<2)return this.logger.error(this.videoPostProcess.glErrorTip);if(!this.videoPostProcess.getPlugin("AdvancedBeauty"))throw this.logger.error("advanced beauty plugin is not register."),new rtcError_1.default({code:errorCode_1.default.PLUGIN_NOT_REGISTER,message:"advanced beauty plugin is not register"});if(this._advancedBeautyProcessor)return this.logger.warn("advanced beauty is already opened.");this._advancedBeautyProcessor=this.advancedBeauty,this._advancedBeautyProcessor.init(e),this._advancedBeautyProcessor.once("facePoints-load",(async()=>{var e;let t=0;try{await this._startAdvancedBeauty()}catch(r){null===(e=this._advancedBeautyProcessor)||void 0===e||e.destroy(),this._advancedBeautyProcessor=null,t=-1,this.logger.error("enableAdvancedBeauty:"+r.message)}this.client.apiFrequencyControl({name:"enableAdvancedBeauty",code:t,param:{streamID:this.stringStreamID}})})),env.IS_ANY_SAFARI&&parseFloat(env.SAFARI_VERSION||"0")<15&&this.logger.warn("In the current version of Safari, wasm has low execution efficiency, which will result in low frame rate when advanced-beauty is enabled.")}async disableAdvancedBeauty(){if(this.logger.log("close advanced beauty."),this.WebGLSupportError(),this._advancedBeautyProcessor){let e=0;try{await this._cancelAdvancedBeauty(),this._advancedBeautyProcessor.destroy(),this._advancedBeautyProcessor=null}catch(t){e=-1,this.logger.error("disableAdvancedBeauty:"+t.message)}this.client.apiFrequencyControl({name:"disableAdvancedBeauty",code:e,param:{streamID:this.stringStreamID}})}else this.logger.warn("advanced beauty is already closed.")}async _startAdvancedBeauty(){this.videoPostProcess.availableCode<2||this._advancedBeautyProcessor&&(await this.transformTrack(!0,this._advancedBeautyProcessor),this.videoPostProcessTags.isAdvBeautyTrack=!0)}async _cancelAdvancedBeauty(){this.videoPostProcess.availableCode<1||this._advancedBeautyProcessor&&(await this.transformTrack(!1,this._advancedBeautyProcessor),this.videoPostProcessTags.isAdvBeautyTrack=!1)}async enableAIDenoise(){if(!this.supportAIDenoise)return this.logger.warn("Unsupport ai denoise. Please check your plugin version"),!1;let e;if(this.logger.log("start ai denoise."),this.mediaHelper.audio.stageAIProcessing){if(e=this.mediaHelper.audio.stageAIProcessing,e.enabled&&"INITED"===e.state)return this.logger.warn("ai denoise is already opened."),!0}else{const t=webAudio_1.getAudioContext();if(!t)return this.logger.error("当前环境不支持AudioContext"),!1;e=new StageAIProcessing_1.StageAIProcessing(t,this.logger),this.mediaHelper.audio.stageAIProcessing=e}if(!e.hasPlugin("AIDenoise"))throw this.logger.error("AIDenoise plugin is not register."),new rtcError_1.default({code:errorCode_1.default.PLUGIN_NOT_REGISTER,message:"AIDenoise plugin is not register"});return e.enabled=!0,"UNINIT"===e.state&&await e.init(),this.mediaHelper.audio.audioRoutingEnabled||this.mediaHelper.enableAudioRouting(),this.mediaHelper.updateWebAudio(),this.client.apiFrequencyControl({name:"enableAIDenoise",code:0,param:{streamID:this.stringStreamID}}),!0}async disableAIDenoise(){this.logger.log("close ai denoise.");const e=this.mediaHelper.audio.stageAIProcessing;return e?e.enabled?(e.enabled=!1,this.mediaHelper.updateWebAudio(),this.mediaHelper.canDisableAudioRouting()&&this.mediaHelper.disableAudioRouting(),this.client.apiFrequencyControl({name:"disableAIDenoise",code:0,param:{streamID:this.stringStreamID}}),!1):(this.logger.warn("ai denoise is already closed."),!0):(this.logger.warn("disableAIDenoise: ai denoise is not created"),!0)}async replacePluginTrack(e){if(this.videoPostProcess.availableCode<1)return;let t,r=!1;if("screen"===e.mediaType?(this.mediaHelper.screen.screenVideoTrack?(t=this.mediaHelper.screen.screenVideoTrack,this.mediaHelper.screen.screenVideoTrack=null):this.mediaHelper.screen.screenVideoSource&&(r=!0,t=this.mediaHelper.screen.screenVideoSource,this.mediaHelper.screen.screenVideoSource=null),t&&(e.external?this.mediaHelper.screen.screenVideoSource=e.track:this.mediaHelper.screen.screenVideoTrack=e.track,gum_1.emptyStreamWith(this.mediaHelper.screen.screenVideoStream,e.track),gum_1.emptyStreamWith(this.mediaHelper.screen.renderStream,e.track),this.mediaHelper.screen.screenVideoStream.getVideoTracks().length&&"string"==typeof this.mediaHelper.screen.encoderConfig.high.contentHint&&this.mediaHelper.screen.screenVideoStream.getVideoTracks()[0].contentHint!==this.mediaHelper.screen.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint screen high",this.mediaHelper.screen.encoderConfig.high.contentHint),this.mediaHelper.screen.screenVideoStream.getVideoTracks()[0].contentHint=this.mediaHelper.screen.encoderConfig.high.contentHint))):"video"===e.mediaType&&(this.mediaHelper.video.cameraTrack?(t=this.mediaHelper.video.cameraTrack,this.mediaHelper.video.cameraTrack=null):this.mediaHelper.video.videoSource&&(r=!0,t=this.mediaHelper.video.videoSource,this.mediaHelper.video.videoSource=null),t&&(e.external?this.mediaHelper.video.videoSource=e.track:this.mediaHelper.video.cameraTrack=e.track,gum_1.emptyStreamWith(this.mediaHelper.video.videoStream,e.track),gum_1.emptyStreamWith(this.mediaHelper.video.renderStream,e.track),this.mediaHelper.video.videoStream.getVideoTracks().length&&"string"==typeof this.mediaHelper.video.encoderConfig.high.contentHint&&this.mediaHelper.video.videoStream.getVideoTracks()[0].contentHint!==this.mediaHelper.video.encoderConfig.high.contentHint&&(this.logger.log("应用 contentHint video high",this.mediaHelper.video.encoderConfig.high.contentHint),this.mediaHelper.video.videoStream.getVideoTracks()[0].contentHint=this.mediaHelper.video.encoderConfig.high.contentHint))),!t)return this.logger.error(`replaceTrack ${e.mediaType} 当前没有可替换的流`),null;this.logger.log(`replaceTrack ${e.mediaType}【external: ${r} ${t.label}】=>【external: ${e.external} ${e.track.label}】`),gum_1.watchTrack(e.track),this.mediaHelper.listenToTrackEnded(e.track);const n=this.getSender(e.mediaType,"high");return n&&(n.replaceTrack(e.track),this.logger.log(`replaceTrack ${e.mediaType} 成功替换上行`)),this.replaceTags.isMuted&&this.mediaHelper.video.cameraTrack&&(this.mediaHelper.video.cameraTrack.enabled=!1),{oldTrack:t,external:r}}async transformTrack(e,t){if(!(this.videoPostProcess.availableCode<1)&&t)if(this.mediaHelper&&this.mediaHelper.video.cameraTrack){this.replaceTags.waterMark&&this.mediaHelper.disablePreProcessing("video",!0),this._cameraTrack=this.mediaHelper.video.cameraTrack;let r=null;try{this._transformedTrack=await t.setTrack(e,this._cameraTrack),this._transformedTrack&&await this.replacePluginTrack({mediaType:"video",track:this._transformedTrack,external:!1})}catch(e){r=e}if(this.mediaHelper.video.preProcessingEnabled&&this.mediaHelper.enablePreProcessing("video"),r)throw r}else this.logger.log("transformTrack:video track not ready.")}async registerPlugin(options){if(this.logger.log("register plugin:"+options.key),!this.supportWasm)throw this.client.apiFrequencyControl({name:"registerPlugin",code:-1,param:{streamID:this.stringStreamID,plugin:options.key,msg:"unsupportWasm"}}),new rtcError_1.default({code:errorCode_1.default.WEBGL_NOT_SUPPORT_ERROR,message:`该浏览器不支持WebAssembly，注册 ${options.key} 失败。`});if(this.videoPostProcess.getPlugin(options.key))return this.logger.warn(`plugin ${options.key} already exists.`);const stageAIProcessing=this.mediaHelper.audio.stageAIProcessing;if(stageAIProcessing&&stageAIProcessing.hasPlugin(options.key))return this.logger.warn(`plugin ${options.key} already exists.`),!1;let plugin=null;options.adapterRef=this.client.adapterRef;try{if(options.pluginUrl?(await plugin_1.loadPlugin(options.key,options.pluginUrl),plugin=eval(`new window.${options.key}(options)`)):options.pluginObj&&(plugin=new options.pluginObj(options)),!plugin)throw new rtcError_1.default({code:errorCode_1.default.PLUGIN_LOADED_ERROR,message:"unsupport plugin "+options.key});plugin.once("plugin-load",(()=>{if(this.logger.log(`plugin ${options.key} loaded`),-1!==plugin_list_1.videoPlugins.indexOf(options.key))this.WebGLSupportError(),this.videoPostProcess.registerPlugin(options.key,plugin);else{if(-1===plugin_list_1.audioPlugins.indexOf(options.key))throw new Error("unsupport plugin "+options.key);if("AIDenoise"===options.key){let e;if(this.mediaHelper.audio.stageAIProcessing)e=this.mediaHelper.audio.stageAIProcessing;else{const t=webAudio_1.getAudioContext();if(!t)return this.logger.error("当前环境不支持AudioContext"),!1;e=new StageAIProcessing_1.StageAIProcessing(t,this.logger),this.mediaHelper.audio.stageAIProcessing=e}e.registerPlugin(options.key,plugin,options.wasmUrl)}}this.emit("plugin-load",options.key),this.client.apiFrequencyControl({name:"registerPlugin",code:0,param:{streamID:this.stringStreamID,plugin:options.key}})})),plugin.once("plugin-load-error",(()=>{this.emit("plugin-load-error",{key:options.key,msg:`load ${options.wasmUrl} error.`}),this.client.apiFrequencyControl({name:"registerPlugin",code:-1,param:{streamID:this.stringStreamID,plugin:options.key,msg:`load ${options.wasmUrl} error.`}})})),plugin.once("error",(e=>{"AIDenoise"==options.key&&(this.supportAIDenoise=!1),this.unregisterPlugin(options.key),this.client.apiFrequencyControl({name:"registerPlugin",code:-1,param:{streamID:this.stringStreamID,plugin:options.key,msg:`插件 ${options.key} 内部错误：${e}。`}})}))}catch(e){throw this.emit("plugin-load-error",{key:options.key,msg:e}),this.client.apiFrequencyControl({name:"registerPlugin",code:-1,param:{streamID:this.stringStreamID,plugin:options.key,msg:e}}),new rtcError_1.default({code:errorCode_1.default.PLUGIN_LOADED_ERROR,message:e.message})}}async unregisterPlugin(e){if(this.logger.log("unRegister plugin:"+e),-1===plugin_list_1.audioPlugins.indexOf(e))this.WebGLSupportError(),this.videoPostProcess&&("VirtualBackground"===e&&this._segmentProcessor?await this.disableBodySegment():"AdvancedBeauty"===e&&this._advancedBeautyProcessor&&await this.disableAdvancedBeauty(),this.videoPostProcess.unregisterPlugin(e));else if("AIDenoise"===e){const e=this.mediaHelper.audio.stageAIProcessing;e&&(e.enabled=!1,this.mediaHelper.updateWebAudio(),this.mediaHelper.canDisableAudioRouting()&&this.mediaHelper.disableAudioRouting(),e.unregisterAIDenoise(),this.mediaHelper.audio.stageAIProcessing=null)}}async suspendVideoPostProcess(){if(this.videoPostProcess.availableCode<1)return;const{isBeautyTrack:e,isBodySegmentTrack:t,isAdvBeautyTrack:r}=this.videoPostProcessTags;e&&(await this.setBeautyEffect(!1,!0),this.videoPostProcessTags.isBeautyTrack=!0),t&&(await this._cancelBodySegment(),this.videoPostProcessTags.isBodySegmentTrack=!0),r&&(await this._cancelAdvancedBeauty(),this.videoPostProcessTags.isAdvBeautyTrack=!0)}async resumeVideoPostProcess(){if(!(this.videoPostProcess.availableCode<1))try{const{isBeautyTrack:e,isBodySegmentTrack:t,isAdvBeautyTrack:r}=this.videoPostProcessTags;e&&(await this.setBeautyEffect(!0,!0),this.lastEffects&&this.setBeautyEffectOptions(this.lastEffects),this.lastFilter&&this.setFilter(this.lastFilter)),t&&await this._startBodySegment(),r&&await this._startAdvancedBeauty()}catch(e){this.logger.log("开启失败: "+e)}}async replaceCanvas(){var e,t;if(this.videoPostProcess.availableCode<1)return;if(!this._play)return;if(!env.IS_ANY_SAFARI)return;if(env.SAFARI_VERSION&&parseFloat(env.SAFARI_VERSION)>15.2)return;const r=null===(e=this._play.video.dom)||void 0===e?void 0:e.querySelector("video"),n=this._play.video.containerDom;if(r&&n){const e=this.videoPostProcess.filters,i=this.videoPostProcess.video,o=this.replaceTags.videoPost,s=this.replaceTags.waterMark;if(o){const t=e.canvas;if(t.style.height="0px",t.style.width="0px",document.body.appendChild(t),env.SAFARI_MAJOR_VERSION<14&&i&&(i.style.height="0px",i.style.width="0px",document.body.appendChild(i)),s||e.canvas.parentElement===n)s&&(r.style.display="");else{const t=e.canvas;r.style.display="none",t.style.position="absolute";const i=n.getBoundingClientRect(),o=i.width/i.height,s=t.width/t.height,{width:a,height:c,cut:u}=this.renderMode.local.video;if(u)if(a/c>s){t.style.width="100%",t.style.left="0px";const e=i.width/s/i.height;t.style.height=100*e+"%",t.style.top=50*-(e-1)+"%"}else{t.style.height="100%",t.style.top="0px";const e=i.height*s/i.width;t.style.width=100*e+"%",t.style.left=50*-(e-1)+"%"}else if(o>s){t.style.height="100%",t.style.top="0px";const e=i.height*s/i.width;t.style.width=100*e+"%",t.style.left=50*(1-e)+"%"}else{t.style.width="100%",t.style.left="0px";const e=i.width/s/i.height;t.style.height=100*e+"%",t.style.top=50*(1-e)+"%"}n.appendChild(e.canvas)}}else r.style.display="",null===(t=e.canvas.parentNode)||void 0===t||t.removeChild(e.canvas)}}loseContext(){var e,t;try{null===(t=null===(e=this.videoPostProcess.filters)||void 0===e?void 0:e.webglLostContext)||void 0===t||t.loseContext()}catch(e){}}restoreContext(){var e,t;try{null===(t=null===(e=this.videoPostProcess.filters)||void 0===e?void 0:e.webglLostContext)||void 0===t||t.restoreContext()}catch(e){}}getNativeDom(e){const t=this[e],r=this._play[e].dom;return t&&r||this.logger.warn("No local "+e),r}async destroy(){this.client&&(this.client.apiFrequencyControl({name:"destroy",code:0,param:{streamID:this.stringStreamID,isRemote:!1}}),this.logger.log(`uid ${this.stringStreamID} 销毁 Stream 实例`),this.stop(),this._reset(),this.destroyed=!0,this.lastEffects=null,this.lastFilter=null,this._segmentProcessor&&(this._segmentProcessor.destroy(),this._segmentProcessor=null),this._advancedBeautyProcessor&&(this._advancedBeautyProcessor.destroy(),this._advancedBeautyProcessor=null),this._cameraTrack&&(this._cameraTrack.stop(),this._cameraTrack=null),this._transformedTrack&&(this._transformedTrack.stop(),this._transformedTrack=null),this.videoPostProcess.destroy())}}exports.LocalStream=LocalStream},function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(10),c=o(r(24)),u=s(r(298)),l=r(299);class d extends a.EventEmitter{constructor(e){super(),this.pluginModules={VirtualBackground:null,AdvancedBeauty:null},this.isAlive=!0,this.filters=null,this.video=null,this.frameRate=15,this.timerId=-1,this.taskSet=new Set,this.taskSnapshot=new Set,this.readyTaskSet=new Set(["BasicBeauty"]),this.sourceMap=null,this.maskData=null,this.advBeautyData=[],this.sourceTrack=null,this.trackInstance=null,this.videoSizeTag="",this.frameCount=[0,0],this.update=(e=!0)=>{if(this.availableCode<2)return;if(c.IS_ANY_SAFARI&&"hidden"===document.visibilityState)return;const t=this.filters;if(!this.taskSet.size)return t?t.update(!1):u.default.clearTimeout(this.timerId);if(e&&(this.frameCount[0]+=1),this.taskReady){let e=!1,r=!1;if(this.taskSet.has("VirtualBackground")&&(t.virtualBackground.setMaskMap(this.maskData),this.maskData=null,e=!0,r=!0),this.taskSet.has("AdvancedBeauty")?(t.advBeauty.setAdvData(this.advBeautyData),this.advBeautyData=[],e=!0):r=!1,this.taskSnapshot=new Set(this.taskSet),this.readyTaskSet.clear(),this.readyTaskSet.add("BasicBeauty"),this.frameCount[1]=this.frameCount[0],e?(t.update(!1),this.sourceMap=t.normal.getImageData(t.srcMap)):t.update(!0),this.taskSet.has("VirtualBackground")){const e=this.pluginModules.VirtualBackground;if(e){const{width:n,height:i}=t.canvas;n>16&&i>16?e.process(r?this.sourceMap.slice():this.sourceMap,n,i,(e=>{const t=(e.data||e).length;this.maskData=this.taskSet.has("VirtualBackground")&&t>0?e:null,this.readyTaskSet.add("VirtualBackground"),this.frameCount[1]<this.frameCount[0]&&(this.updateTimer(),this.update(!1))}),c.IS_CHROME&&(c.CHROME_MAJOR_VERSION||0)>=104):this.readyTaskSet.add("VirtualBackground")}}if(this.taskSet.has("AdvancedBeauty")){const e=this.pluginModules.AdvancedBeauty;if(e){const{width:r,height:n}=t.canvas;e.process(this.sourceMap,r,n,(e=>{this.advBeautyData=this.taskSet.has("AdvancedBeauty")?e:[],this.readyTaskSet.add("AdvancedBeauty"),this.frameCount[1]<this.frameCount[0]&&(this.updateTimer(),this.update(!1))}),c.IS_CHROME&&(c.CHROME_MAJOR_VERSION||0)>=104)}}}},this.setTaskAndTrack=(e,t,r)=>new Promise(((n,i)=>{if(this.availableCode<1)return i(this.glErrorTip);if(t){if(this.hasTask(e))return n(this.track);this.createTrack(r).then((t=>{this.addTask(e),setTimeout((()=>{n(this.track)}),t)})).catch((e=>{i(e)}))}else{if(!this.hasTask(e))return n(this.track);this.removeTask(e),n(this.track)}})),this.logger=e;try{this.filters=new l.Filters;const e=this.filters.canvas;e.addEventListener("webglcontextlost",(e=>{e.preventDefault(),this.emit("contextLost")}),!1),e.addEventListener("webglcontextrestored",(e=>{var t;e.preventDefault();let r=!0;this.filters=(null===(t=this.filters)||void 0===t?void 0:t.clone())||null,this.filters||(r=!1),this.emit("contextRestored",r)}),!1)}catch(e){}}registerPlugin(e,t){this.pluginModules[e]=t}getPlugin(e){return this.pluginModules[e]}unregisterPlugin(e){this.pluginModules[e]=null}get availableCode(){return this.isAlive?this.filters&&this.filters.gl?this.filters.gl.isContextLost()?1:2:0:-1}get glErrorTip(){switch(this.availableCode){case-1:return"localStream is already destroyed.";case 0:return"the current environment does not support webgl.";case 1:return"webgl context has been lost."}return""}get taskReady(){for(const e of this.taskSnapshot)if(!this.readyTaskSet.has(e))return!1;return!0}addTask(e){this.taskSet.has(e)||(this.taskSet.add(e),this.logger.log(`task ${e} is added.`),this.update(),1===this.taskSet.size&&(this.updateTimer(),this.emit("taskSwitch",!0)))}removeTask(e){var t;this.taskSet.delete(e),this.logger.log(`task ${e} is removed.`),0===this.taskSet.size&&(u.default.clearTimeout(this.timerId),this.timerId=-1,this.sourceMap=null,null===(t=this.trackInstance)||void 0===t||t.stop(),this.trackInstance=null,this.emit("taskSwitch",!1)),this.update(),this.taskSnapshot.delete(e)}hasTask(e){return this.taskSet.has(e)}get hasAnyTask(){return this.taskSet.size>0}videoSizeChange(e,t){if(c.IS_ANY_SAFARI&&this.filters){const r=`${e}-${t}`;this.videoSizeTag!==r&&(this.videoSizeTag=r,this.emit("safariVideoSizeChange"))}}createTrack(e){return new Promise(((t,r)=>{var n,i;if(this.trackInstance&&this.trackInstance===e)return this.logger.log("VideoPostProcess track transform unnecessary"),t(0);this.logger.log("VideoPostProcess track transform");const o=e.getSettings();this.frameRate=o.frameRate||15,this.frameRate>30&&(this.logger.warn("In chrome, webgl drawing video which framerate greater than 30fps may cause memory leak."),this.frameRate=30),this.sourceTrack=e,this.trackInstance&&(this.trackInstance.stop(),this.trackInstance=null),o.width&&o.height&&(null===(n=this.filters)||void 0===n||n.setSize(o.width,o.height),this.videoSizeTag||(this.videoSizeTag=`${o.width}-${o.height}`));const s=(null===(i=this.filters)||void 0===i?void 0:i.canvas).captureStream(this.frameRate);this.trackInstance=s.getVideoTracks()[0],this.video=this.video||document.createElement("video");const a=new MediaStream([this.sourceTrack]);this.video.srcObject=a;const c=e=>{var t;const{videoWidth:r,videoHeight:n}=e;null===(t=this.filters)||void 0===t||t.setSize(r,n),this.videoSizeChange(r,n)};this.video.onloadedmetadata=()=>{this.video.play().then((()=>{this.filters.mapSource=this.video,c(this.video),t(0)})).catch((e=>{r(e)}))},this.video.onresize=()=>{c(this.video)}}))}get track(){return this.taskSet.size?(this.logger.log("return video post procss track."),this.trackInstance):(this.logger.log("return origin track."),this.sourceTrack)}updateTimer(){u.default.clearTimeout(this.timerId),this.timerId=u.default.setTimeout((()=>{this.updateTimer(),this.update()}),1e3/(1.1*this.frameRate),null)}destroy(){var e,t,r;this.isAlive=!1,u.default.clearTimeout(this.timerId),this.removeAllListeners(),this.taskSet.clear(),this.readyTaskSet.clear(),this.taskSnapshot.clear(),null===(e=this.sourceTrack)||void 0===e||e.stop(),this.sourceTrack=null,null===(t=this.trackInstance)||void 0===t||t.stop(),this.trackInstance=null,this.video=null,null===(r=this.filters)||void 0===r||r.destroy(),this.filters=null,this.sourceMap=null,this.maskData=null,this.advBeautyData=null,this.pluginModules=null,this.frameCount=[0,0]}}t.default=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(128),i=new class{constructor(){this.id=0,this.callbacks={},this.worker=null}getWorker(){return this.worker||(this.worker=new Worker(n.getBlobUrl("webWorkerTimer")),this.worker.onmessage=e=>{switch(e.data.message){case"interval:tick":case"timeout:tick":{const t=this.callbacks[e.data.id];t&&t.fn&&t.fn.apply(t.context);break}case"interval:cleared":case"timeout:cleared":delete this.callbacks[e.data.id]}}),this.worker}setInterval(e,t,r){this.id++;const n=this.id;return this.callbacks[n]={fn:e,context:r},this.getWorker().postMessage({command:"interval:start",interval:t,id:n}),n}setTimeout(e,t,r){this.id++;const n=this.id;return this.callbacks[n]={fn:e,context:r},this.getWorker().postMessage({command:"timeout:start",timeout:t,id:n}),n}clearInterval(e){this.getWorker().postMessage({command:"interval:clear",id:e})}clearTimeout(e){this.getWorker().postMessage({command:"timeout:clear",id:e})}};t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Filters=void 0;const n=r(159),i=r(300),o=r(116),s=r(199),a=r(309),c=r(313),u=r(314),l=r(315),d=r(316);class p{constructor(e){this._alive=!0,this.time=-1,this.lastTimer=performance.now(),this.webglLostContext=null,this._renderer=new i.Renderer({canvas:e,antialias:!0}),this.map=o.createTexture(this._renderer.gl,null);const t=this._renderer.gl;this.webglLostContext=t.getExtension("WEBGL_lose_context");const{posArray:r,uvArray:p,advBeautyIndicesArray:m,advBeautyPosArray:f,advBeautyZindexArray:h,advFaceMaskUVArray:g,advEyeTeethPosArray:v,advEyeTeethIndicesArray:y,advEyeTeethZindexArray:b,advEyeTeethUVArray:S}=l.typedArray,T=n.createAttributeBuffer(t,"position",r,2),_=n.createAttributeBuffer(t,"uv",p,2),w=n.createAttributeBuffer(t,"position",f,2),M=n.createAttributeBuffer(t,"zIndex",h,1),x=n.createAttributeBuffer(t,"indices",m,1,"ELEMENT_ARRAY_BUFFER"),E=n.createAttributeBuffer(t,"uv",g,2),C=n.createAttributeBuffer(t,"tPosition",v,2),R=n.createAttributeBuffer(t,"indices",y,1,"ELEMENT_ARRAY_BUFFER"),k=n.createAttributeBuffer(t,"zIndex",b,1),A=n.createAttributeBuffer(t,"uv",S,2);this.advBeauty=new s.AdvBeautyFilter(this._renderer,this.map,w,M,x,E,T,_,C,R,k,A),this.beauty=new a.BeautyFilter(this._renderer,this.map,T,_),this.lut=new c.LutFilter(this._renderer,this.map,T,_),this.normal=new u.NormalFilter(this._renderer,this.map,T,_),this.virtualBackground=new d.VirtualBackFilter(this._renderer,this.map,T,_)}clone(){var e;try{const t=new p(this._renderer.canvas);t.mapSource=(null===(e=this.srcMap)||void 0===e?void 0:e.source)||null,this.advBeauty.remove(),t.advBeauty.presetAdvEffect(Object.assign({},this.advBeauty.params));const r=this.virtualBackground.lastSetInfo;return"bk"===r.type?t.virtualBackground.setBackground(r.value):"blur"===r.type&&t.virtualBackground.setBlurIntensity(r.value),t}catch(e){return null}}get filters(){return[this.advBeauty,this.beauty,this.lut,this.virtualBackground,this.normal]}get canvas(){return this._renderer.canvas}get gl(){return this._renderer.gl}get srcMap(){return this.map}set mapSource(e){const t=this.map;t&&(t.source=e,t.refresh())}get isAlive(){return this._alive}setSize(e,t){this._renderer.setSize(e,t),this.filters.forEach((e=>{e.updateSize()}))}render(){const e=this.filters;e[0].map=this.map,e[0].render(),e[1].faceMask=e[0].faceMask,e[1].featureParas=e[0].featureParas;for(let t=1;t<e.length;t++)e[t].map=e[t-1].output,e[t].render()}update(e=!0){var t;if(this._alive){if(this.time<0)this.time=0,this.lastTimer=performance.now();else{const e=performance.now(),t=Math.min(e-this.lastTimer,100);this.lastTimer=e,this.time+=t/1e3}e&&(null===(t=this.map)||void 0===t||t.refresh()),this.render()}}destroy(){this._alive=!1,this.time=-1;const e=this._renderer.gl;this.filters.forEach((e=>{e.destroy()})),null==e||e.deleteTexture(this.map.glTexture)}}t.Filters=p},function(e,t,r){var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;const i=r(123);t.Renderer=class{constructor(e){this._gl=null,this._pixelRatio=1,this._viewport={x:0,y:0,width:640,height:480};const t=Object.assign({preserveDrawingBuffer:!0,powerPreference:"high-performance"},e),{canvas:r=document.createElement("canvas"),width:o=640,height:s=480}=t,a=n(t,["canvas","width","height"]);this._canvas=r,this._gl=i.getWebGLContext(r,a);const c=this.setSize(o,s);this.setViewport(0,0,c.width,c.height)}get canvas(){return this._canvas}get gl(){return this._gl}getPixelRatio(){var e;return null!==(e=this._pixelRatio)&&void 0!==e?e:1}setPixelRatio(e){const t=this.getPixelRatio();if(t===e)return;const r=this.getSize();r.width/=t,r.height/=t,this._pixelRatio=e,this.setSize(r.width,r.height)}getSize(){return{width:this.canvas.width,height:this.canvas.height}}setSize(e,t,r=!1){const n=this.canvas,i=this.getPixelRatio();return n.width=e*i,r&&(n.style.width=e+"px"),n.height=t*i,r&&(n.style.height=t+"px"),this.getSize()}getViewport(){return this._viewport}setViewport(e,t,r,n){var i;this._viewport={x:e,y:t,width:r,height:n},null===(i=this.gl)||void 0===i||i.viewport(e,t,r,n)}resize(e,t,r,n){const i=this.setSize(e,t);r&&this.setPixelRatio(r),n?this.setViewport(n.x,n.y,n.width,n.height):this.setViewport(0,0,i.width,i.height)}render(e){if(!this.gl)return;const t=this.gl;t.enable(t.CULL_FACE),e.render()}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultShader=void 0,t.defaultShader={vShader:"\n    attribute vec4 position;\n    void main() {\n        gl_Position = position;\n    }\n",fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    void main() {\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createShader=void 0,t.createShader=function(e,t,r){const n=e.createShader({VERTEX:e.VERTEX_SHADER,FRAGMENT:e.FRAGMENT_SHADER}[r]);if(!n)return console.error(r+"Shader was not created successfully."),null;if(e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))return n;const i=t.split("\n").map(((e,t)=>`${t+1}${e}`)).join("\n");return console.error(`${e.getShaderInfoLog(n)}\n%cshader source code\n${i}\n`,"color: #008040"),e.deleteShader(n),null}},function(e,t,r){function n(e,t,r,n,i,o){var s;if(r===e.FLOAT)return n?r=>e.uniform1fv(t,r):r=>e.uniform1f(t,r);const a={[e.FLOAT_VEC2]:r=>e.uniform2fv(t,r),[e.FLOAT_VEC3]:r=>e.uniform3fv(t,r),[e.FLOAT_VEC4]:r=>e.uniform4fv(t,r)}[r];if(a)return a;if(r===e.INT||r===e.BOOL)return n?r=>e.uniform1iv(t,r):r=>e.uniform1i(t,r);const c={[e.BOOL_VEC2]:e.INT_VEC2,[e.BOOL_VEC3]:e.INT_VEC3,[e.BOOL_VEC4]:e.INT_VEC4},u={[e.INT_VEC2]:r=>e.uniform2iv(t,r),[e.INT_VEC3]:r=>e.uniform3iv(t,r),[e.INT_VEC4]:r=>e.uniform4iv(t,r)}[null!==(s=c[r])&&void 0!==s?s:r];if(u)return u;const l={[e.FLOAT_MAT2]:r=>e.uniformMatrix2fv(t,!1,r),[e.FLOAT_MAT3]:r=>e.uniformMatrix3fv(t,!1,r),[e.FLOAT_MAT4]:r=>e.uniformMatrix4fv(t,!1,r)}[r];if(l)return l;if(r===e.SAMPLER_2D||r===e.SAMPLER_CUBE){const s=r===e.SAMPLER_2D?e.TEXTURE_2D:e.TEXTURE_CUBE_MAP;if(n){const r=[];for(let e=0;e<i;e++)r.push(o.value++);return n=>{e.uniform1iv(t,r),n.forEach(((t,n)=>{var i;e.activeTexture(e.TEXTURE0+r[n]),e.bindTexture(s,null!==(i=null==t?void 0:t.glTexture)&&void 0!==i?i:null)}))}}{const r=o.value++;return n=>{var i;e.uniform1i(t,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(s,null!==(i=null==n?void 0:n.glTexture)&&void 0!==i?i:null)}}}return()=>{console.warn("no matching uniform setter.")}}Object.defineProperty(t,"__esModule",{value:!0}),t.parseUniforms=void 0,t.parseUniforms=function(e,t){const r={value:0},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o={};for(let s=0;s<i;s++){const i=e.getActiveUniform(t,s);if(i){const s=i.size>1,a=s?i.name.replace("[0]",""):i.name,c=i.type,u=e.getUniformLocation(t,a);if(null!==u){const t=n(e,u,c,s,i.size,r);o[a]={type:c,size:i.size,value:null,setter:e=>{void 0!==e?o[a].value=e:t(o[a].value)}}}else console.warn(`uniform:[${a}] is null.`)}}return o}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.advBeautyEyeShader=void 0,t.advBeautyEyeShader={fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n    uniform vec2 eyeCenter;\n    uniform vec2 rdDir;\n    uniform float rdIntensity;\n    uniform float lgIntensity;\n    uniform float intensRatio;\n    uniform float range;\n\n    varying vec2 vuv;\n\n    mat3 scaleByNormal(vec2 normal, float k, float refx, float refy){\n        float a = 1.0 + (k - 1.0) * normal.x * normal.x;\n        float b = (k - 1.0) * normal.x * normal.y;\n        float c = 1.0 + (k - 1.0) * normal.y * normal.y;\n        return mat3(\n            a, b, 0.0,\n            b, c, 0.0,\n            (1.0 - a) * refx - b * refy, (1.0 - c) * refy - b * refx, 1.0\n        );\n    }\n\n    vec2 lgEye(vec2 uv, vec2 center, float range, float strength, float powRatio) {\n        float dist = distance(uv, center);\n        if(dist > range){\n            return uv;\n        }\n        vec2 dir = normalize(uv - center);\n        float scale = 1. - strength + strength * pow(smoothstep(0., 1., dist / range), powRatio);\n        float newDist = dist * scale;\n        return center + newDist * dir;\n    }\n\n    vec2 rdEye(vec2 uv, vec2 center, float range, float strength, float powRatio){\n        float dist = distance(uv, center);\n        if(dist > range){\n            return uv;\n        }\n        float scale = 1. - strength + strength * pow(smoothstep(0., 1., dist / range), powRatio);\n        return (scaleByNormal(rdDir, scale, center.x, center.y) * vec3(uv, 1.0)).xy;\n    }\n\n    void main() {\n        vec2 uv = vuv;\n        if(intensRatio > 0.0){\n            if(rdIntensity > 0.0){\n                float maxRdIntens = mix(1.0, 0.5, lgIntensity);\n                float rdIntens = mix(0.0, maxRdIntens, rdIntensity * intensRatio);\n                uv = lgEye(uv, eyeCenter, range * 2.0, rdIntens, 0.075);\n                uv = rdEye(uv, eyeCenter, range * 2.0, rdIntens, 0.1);\n            }\n            if(lgIntensity > 0.0){\n                float lgIntens = lgIntensity * intensRatio;\n                uv = lgEye(uv, eyeCenter, range * 2.5, lgIntens, 0.1);\n                uv = rdEye(uv, eyeCenter, range * 2.5, lgIntens, 0.05);\n            }\n        }\n        gl_FragColor = texture2D(map, uv);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.advBeautyShader=void 0,t.advBeautyShader={vShader:"\n    uniform vec2 size;\n\n    attribute vec2 position;\n    attribute vec2 tPosition;\n    attribute float zIndex;\n\n    varying vec2 vuv;\n\n    vec2 npos(vec2 pos){\n        return pos / size;\n    }\n\n    float ndcx(float x){\n        return (x - 1.0) * 2.0 + 1.0;\n    }\n\n    float ndcy(float y){\n        return (1.0 - y) * 2.0 - 1.0;\n    }\n\n    vec2 ndcpos(vec2 pos){\n        return vec2(ndcx(pos.x), ndcy(pos.y));\n    }\n\n    void main() {\n        vec2 nPos = position;\n        vec2 ntPos = tPosition;\n        if(zIndex > -0.000001){\n            nPos = npos(nPos);\n            ntPos = npos(ntPos);\n        }\n        vec2 ndcPos = ndcpos(ntPos);\n        gl_Position = vec4(ndcPos, zIndex, 1.0);\n\n        vuv = nPos;\n        vuv.y = 1.0 - vuv.y;\n    }\n",fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform float showWire;\n    uniform vec2 size;\n    uniform sampler2D map;\n    uniform sampler2D wireMap;\n    uniform sampler2D eyeTeethMaskMap;\n    uniform sampler2D teethLut;\n    uniform float eyeIntensity;\n    uniform float teethIntensity;\n    varying vec2 vuv;\n\n    vec3 lut64(vec3 color, sampler2D lut){\n        float blue = color.b * 63.0;\n\n        vec2 q1;\n        float fb = floor(blue);\n        q1.y = floor(fb * 0.125);\n        q1.x = fb - (q1.y * 8.0);\n\n        vec2 q2;\n        float cb = ceil(blue);\n        q2.y = floor(cb * 0.125);\n        q2.x = cb - (q2.y * 8.0);\n\n        vec2 t = 0.123 * color.rg + vec2(0.000976563);\n        vec2 t1 = q1 * 0.125 + t;\n        vec3 p1 = texture2D(lut, t1).rgb;\n\n        vec2 t2 = q2 * 0.125 + t;\n        vec3 p2 = texture2D(lut, t2).rgb;\n\n        return mix(p1, p2, fract(blue));\n    }\n\n    void main() {\n        vec4 color = texture2D(map, vuv);\n        if(eyeIntensity > 0.0 || teethIntensity > 0.0){\n            vec4 eyeTeethMask = texture2D(eyeTeethMaskMap, vuv);\n            float teethInten = eyeTeethMask.r > 0.0 ? teethIntensity * eyeTeethMask.a : 0.0;\n            float eyeInten = eyeTeethMask.g > 0.0 ? eyeIntensity * eyeTeethMask.a : 0.0;\n            if(teethInten>0.0){\n                color.rgb = mix(color.rgb, lut64(color.rgb, teethLut), teethInten);\n            }\n            if(eyeInten>0.0){\n                vec2 step1 = vec2(size.x / 640.0 / size.x, 0.0);\n                vec2 step2 = vec2(0.0, size.y / 480.0 /size.y);\n                vec3 sumColor = vec3(0.0, 0.0, 0.0);\n                sumColor += texture2D(map, vuv - 2.0 * step1 - 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 2.0 * step1 - 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 2.0 * step1).rgb;\n                sumColor += texture2D(map, vuv - 2.0 * step1 + 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 2.0 * step1 + 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 1.0 * step1 - 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 1.0 * step1 - 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 1.0 * step1).rgb;\n                sumColor += texture2D(map, vuv - 1.0 * step1 + 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 1.0 * step1 + 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv - 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv).rgb;\n                sumColor += texture2D(map, vuv + 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 1.0 * step1 - 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 1.0 * step1 - 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 1.0 * step1).rgb;\n                sumColor += texture2D(map, vuv + 1.0 * step1 + 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 1.0 * step1 + 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 2.0 * step1 - 2.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 2.0 * step1 - 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 2.0 * step1).rgb;\n                sumColor += texture2D(map, vuv + 2.0 * step1 + 1.0 * step2).rgb;\n                sumColor += texture2D(map, vuv + 2.0 * step1 + 2.0 * step2).rgb;\n\n                sumColor = sumColor * 0.04;\n                sumColor = clamp(sumColor + (color.rgb - sumColor) * 2.0, 0.0, 1.0);\n                sumColor = max(color.rgb, sumColor);\n                color.rgb = mix(color.rgb, sumColor, eyeInten);\n                eyeInten = 1.0 + eyeInten * 0.25;\n                color.rgb = (color.rgb - vec3(0.5)) * eyeInten + vec3(0.5);\n            }\n        }\n        if(showWire > 0.5){\n            vec4 wire = texture2D(wireMap, vuv);\n            gl_FragColor = mix(color, wire, wire.a);\n        }else{\n            gl_FragColor = color;\n        }\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.advBeautyWireShader=void 0,t.advBeautyWireShader={vShader:"\n    uniform vec2 size;\n\n    attribute vec2 position;\n\n    vec2 npos(vec2 pos){\n        return pos / size;\n    }\n\n    float ndcx(float x){\n        return (x - 1.0) * 2.0 + 1.0;\n    }\n\n    float ndcy(float y){\n        return (1.0 - y) * 2.0 - 1.0;\n    }\n\n    vec2 ndcpos(vec2 pos){\n        return vec2(ndcx(pos.x), ndcy(pos.y));\n    }\n\n    void main() {\n        vec2 nPos = npos(position);\n        vec2 ndcPos = ndcpos(nPos);\n        gl_Position = vec4(ndcPos, 0.0, 1.0);\n    }\n",fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n    void main() {\n        gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.advFaceMaskShader=void 0,t.advFaceMaskShader={vShader:"\n    uniform vec2 size;\n\n    attribute vec2 tPosition;\n    attribute vec2 uv;\n    attribute float zIndex;\n\n    varying vec2 vuv;\n\n    vec2 npos(vec2 pos){\n        return pos / size;\n    }\n\n    float ndcx(float x){\n        return (x - 1.0) * 2.0 + 1.0;\n    }\n\n    float ndcy(float y){\n        return (1.0 - y) * 2.0 - 1.0;\n    }\n\n    vec2 ndcpos(vec2 pos){\n        return vec2(ndcx(pos.x), ndcy(pos.y));\n    }\n\n    void main() {\n        vec2 nPos = tPosition;\n        if(zIndex > -0.000001){\n            nPos = npos(nPos);\n        }\n        vec2 ndcPos = ndcpos(nPos);\n        gl_Position = vec4(ndcPos, zIndex, 1.0);\n        vuv = uv;\n    }\n",fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n    uniform sampler2D maskMap;\n    uniform int index;\n    varying vec2 vuv;\n\n    void main() {\n      vec4 color = index == 0 ? vec4(0.0) : texture2D(map, vuv);\n      vec4 mask = texture2D(maskMap, vuv);\n      float a = 1.0 - (1.0 - color.a) * (1.0 - mask.a);\n      vec3 rgb = max(color.rgb, mask.rgb);\n      gl_FragColor = vec4(rgb, a);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.handlers=t.preHandle=t.Matrix3x3=t.Vector2=void 0;class n{constructor(e,t){this.value=[0,0],this.value=[e,t]}get x(){return this.value[0]}set x(e){this.value[0]=e}get y(){return this.value[1]}set y(e){this.value[1]=e}get lengthPow2(){return Math.pow(this.x,2)+Math.pow(this.y,2)}get length(){return Math.sqrt(this.lengthPow2)}static getVec(e,t){const r=2*t;if(r<0)throw new Error("index out range");const i=r+1;if(i>=e.length)throw new Error("index out range");return new n(e[r],e[i])}static setPoint(e,t,r){const n=2*t;if(n<0)throw new Error("index out range");const i=n+1;if(i>=e.length)throw new Error("index out range");e[n]=r.value[0],e[i]=r.value[1]}static normalize(e){const t=Math.sqrt(e.value[0]*e.value[0]+e.value[1]*e.value[1]);return new n(e.value[0]/t,e.value[1]/t)}static add(e,t){return new n(e.value[0]+t.value[0],e.value[1]+t.value[1])}static sub(e,t){return new n(e.value[0]-t.value[0],e.value[1]-t.value[1])}static scale(e,t){return new n(e.value[0]*t,e.value[1]*t)}static scaleByAxis(e,t,r){return new n(e.x*t,e.y*r)}static disPow2(e,t){const r=e.value,n=t.value,i=r[0]-n[0],o=r[1]-n[1];return i*i+o*o}static dis(e,t){return Math.sqrt(n.disPow2(e,t))}static lerp(e,t,r){if(!e||!t)return e||t;const i=e.value,o=t.value;return new n(i[0]+(o[0]-i[0])*r,i[1]+(o[1]-i[1])*r)}static intersectPoint(e,t,r,i){const o=e.value,s=t.value,a=r.value,c=i.value,u=a[0]-c[0],l=o[0]-s[0],d=a[1]-c[1],p=o[1]-s[1],m=l*d-p*u;if(0==m)return null;const f=o[0]*s[1]-o[1]*s[0],h=a[0]*c[1]-a[1]*c[0];return new n((f*u-l*h)/m,(f*d-p*h)/m)}static center(...e){const t=e.length;if(!t)return new n(0,0);if(1===t)return new n(...e[0].value);if(2===t)return new n((e[0].value[0]+e[1].value[0])/2,(e[0].value[1]+e[1].value[1])/2);let r=0,i=0,o=0;for(let n=t-1,s=0;s<t;n=s,s++){const t=e[n].value,a=e[s].value,c=t[0]*a[1]-a[0]*t[1];r+=c,i+=(a[0]+t[0])*c,o+=(a[1]+t[1])*c}let s=0,a=0;return 0!=r&&(s=i/(3*r),a=o/(3*r)),new n(s,a)}static dot(e,t){return e.x*t.x+e.y*t.y}static cross(e,t){return e.x*t.y-t.x*e.y}static angle(e,t){const r=n.normalize(e),i=n.normalize(t);return Math.acos(Math.min(1,Math.max(-1,n.dot(r,i))))}static fromToAngle(e,t){return n.cross(e,t)<0?-n.angle(e,t):n.angle(e,t)}}t.Vector2=n;class i{constructor(e,t,r,n,i,o,s,a,c){this.matrix=[[e,t,r],[n,i,o],[s,a,c]]}get a(){return this.matrix[0][0]}set a(e){this.matrix[0][0]=e}get b(){return this.matrix[1][0]}set b(e){this.matrix[1][0]=e}get c(){return this.matrix[0][1]}set c(e){this.matrix[0][1]=e}get d(){return this.matrix[1][1]}set d(e){this.matrix[1][1]=e}get e(){return this.matrix[0][2]}set e(e){this.matrix[0][2]=e}get f(){return this.matrix[1][2]}set f(e){this.matrix[1][2]=e}get transpose(){let e=this.matrix;return new i(e[0][0],e[1][0],e[2][0],e[0][1],e[1][1],e[2][1],e[0][2],e[1][2],e[2][2])}multiplyPoint(e){let t=e.x,r=e.y,i=t*this.matrix[0][0]+r*this.matrix[0][1]+this.matrix[0][2],o=t*this.matrix[1][0]+r*this.matrix[1][1]+this.matrix[1][2],s=t*this.matrix[2][0]+r*this.matrix[2][1]+this.matrix[2][2];return new n(i/s,o/s)}multiplyVector(e){let t=e.x,r=e.y,i=t*this.matrix[0][0]+r*this.matrix[0][1],o=t*this.matrix[1][0]+r*this.matrix[1][1];return new n(i,o)}static identity(){return new i(1,0,0,0,1,0,0,0,1)}static rotate(e,t,r){let n=Math.cos(e),o=Math.sin(e),s=i.identity();return s.matrix[0][0]=n,s.matrix[0][1]=-o,s.matrix[1][0]=o,s.matrix[1][1]=n,s.matrix[0][2]=t*(1-n)+r*o,s.matrix[1][2]=r*(1-n)-t*o,s}static scaleByNormal(e,t,r,o){e=n.normalize(e);let s=1+(t-1)*Math.pow(e.x,2),a=(t-1)*e.x*e.y,c=1+(t-1)*Math.pow(e.y,2);return new i(s,a,(1-s)*r-a*o,a,c,(1-c)*o-a*r,0,0,1)}}t.Matrix3x3=i;let o,s,a=!0;t.preHandle=e=>{o=n.getVec(e,74),s=n.getVec(e,77)},t.handlers={eyeAngle:(e,t)=>{const r=.06*(t-.5)*Math.PI,a=i.rotate(r,o.x,o.y);[52,53,54,55,56,57,72,73].forEach((t=>{const r=a.multiplyPoint(n.getVec(e,t));n.setPoint(e,t,r)}));const c=i.rotate(-r,s.x,s.y);[58,59,60,61,62,63,75,76].forEach((t=>{const r=c.multiplyPoint(n.getVec(e,t));n.setPoint(e,t,r)}))},openCanthus:(e,t)=>{t*=.05;const r=n.getVec(e,43),i=n.getVec(e,46);let o=n.getVec(e,55),s=n.getVec(e,58);const a=n.intersectPoint(r,i,o,s)||r;o=n.lerp(o,a,t),s=n.lerp(s,a,t),n.setPoint(e,55,o),n.setPoint(e,58,s),[54,56,59,63].forEach((r=>{let i=n.getVec(e,r);i=n.lerp(i,r<57?o:s,.05*t),n.setPoint(e,r,i)}))},eyeDistance:(e,t)=>{t=.1*(t-.5);const r=n.getVec(e,43),i=n.scale(n.sub(o,r),t),a=n.scale(n.sub(s,r),t);[52,53,54,55,56,57,72,73,74].forEach((t=>{const r=n.add(n.getVec(e,t),i);n.setPoint(e,t,r)})),[58,59,60,61,62,63,75,76,77].forEach((t=>{const r=n.add(n.getVec(e,t),a);n.setPoint(e,t,r)})),o=n.getVec(e,74),s=n.getVec(e,77)},roundedEye:(e,t)=>(a=!1,o=n.center(...[52,53,54,55,56,57,72,73].map((t=>n.getVec(e,t)))),s=n.center(...[58,59,60,61,62,63,75,76].map((t=>n.getVec(e,t)))),{lEyeCenter:o,rEyeCenter:s}),enlargeEye:(e,t)=>(a?(o=n.center(...[52,53,54,55,56,57,72,73].map((t=>n.getVec(e,t)))),s=n.center(...[58,59,60,61,62,63,75,76].map((t=>n.getVec(e,t))))):a=!0,{lEyeCenter:o,rEyeCenter:s}),shrinkNose:(e,t)=>{t*=.15;const r=n.getVec(e,46);[80,81,82,83].forEach((i=>{n.setPoint(e,i,n.lerp(n.getVec(e,i),r,t))}));const i=n.getVec(e,49);[47,51].forEach((r=>{n.setPoint(e,r,n.lerp(n.getVec(e,r),i,t))}))},lengthenNose:(e,t)=>{t=.25*(t-.5);const r=[80,81,82,83,47,51],i=n.getVec(e,46),o=[];r.forEach((t=>{o.push(n.sub(n.getVec(e,t),i))}));const s=n.getVec(e,49),a=n.lerp(s,n.getVec(e,87),t);n.setPoint(e,49,a);const c=n.sub(a,s),u=n.add(i,c);n.setPoint(e,46,u),o.forEach(((t,i)=>{const o=n.add(u,t);n.setPoint(e,r[i],o)}))},shrinkMouth:(e,t)=>{const r=1+.25*(t-=.65),i=1+.2*t,o=[1,.7,.2,0,.2,.7,1,.66,.33,0,.33,.66],s=[1,.66,0,.66,1,.66,0,.66],a=[84,85,86,87,88,89,90,91,92,93,94,95],c=[96,97,98,99,100,101,102,103],u=[],l=[];a.forEach((t=>{u.push(n.getVec(e,t))})),c.forEach((t=>{l.push(n.getVec(e,t))}));const d=n.center(...u);u.forEach(((t,s)=>{const c=o[s],u=r*c+i*(1-c);n.setPoint(e,a[s],n.add(d,n.scale(n.sub(t,d),u)))})),l.forEach(((t,o)=>{const a=s[o],u=r*a+i*(1-a);n.setPoint(e,c[o],n.add(d,n.scale(n.sub(t,d),u)))}))},widenMouth:(e,t)=>{t-=.5,t*=t<0?.3:.2;const r=n.getVec(e,90),o=n.getVec(e,84),s=n.getVec(e,87),a=n.getVec(e,93),c=n.intersectPoint(r,o,s,a)||n.center(s,a),u=i.scaleByNormal(n.sub(c,o),t+1,c.x,c.y),l=i.scaleByNormal(n.sub(c,r),t+1,c.x,c.y);[84,96,85,95,97,103,86,94].forEach((t=>{n.setPoint(e,t,u.multiplyPoint(n.getVec(e,t)))})),[90,100,89,91,99,101,88,92].forEach((t=>{n.setPoint(e,t,l.multiplyPoint(n.getVec(e,t)))}))},mouthCorners:(e,t)=>{const r=.06*(t-.5)*Math.PI,o=n.center(...[84,85,86,87,88,89,90,91,92,93,94,95].map((t=>n.getVec(e,t))));let s=i.rotate(r,o.value[0],o.value[1]),a=i.rotate(.66*r,o.value[0],o.value[1]),c=i.rotate(.33*r,o.value[0],o.value[1]),u=i.rotate(.1*r,o.value[0],o.value[1]),l=[s,a,u,c,a,s,a,a];[84,85,86,94,95,96,97,103].forEach(((t,r)=>{const i=l[r].multiplyPoint(n.getVec(e,t));n.setPoint(e,t,i)})),s=i.rotate(-r,o.value[0],o.value[1]),a=i.rotate(.66*-r,o.value[0],o.value[1]),c=i.rotate(.33*-r,o.value[0],o.value[1]),u=i.rotate(.1*-r,o.value[0],o.value[1]),l=[s,a,u,c,a,s,a,a],[90,89,88,92,91,100,99,101].forEach(((t,r)=>{const i=l[r].multiplyPoint(n.getVec(e,t));n.setPoint(e,t,i)}))},adjustPhiltrum:(e,t)=>{t=.25*(t-.5);const r=n.getVec(e,87),i=n.scale(n.sub(n.getVec(e,49),r),t);for(let t=84;t<104;t++)n.setPoint(e,t,n.add(n.getVec(e,t),i))},shrinkUnderjaw:(e,t)=>{const r=t*=.1,i=t,o=n.getVec(e,16),s=n.getVec(e,49),a=n.getVec(e,0),c=n.getVec(e,32),u=[[6,26],[8,24],[10,22],[12,20],[14,18]],l=[],d=[],p=[];u.forEach((t=>{const r=n.getVec(e,t[0]),i=n.getVec(e,t[1]);l.push([r,i]),d.push(n.intersectPoint(r,s,a,o)),p.push(n.intersectPoint(i,s,c,o))}));const m=[.33,.66,1,.66,.33];l.forEach(((t,o)=>{const s=n.lerp(t[0],d[o],r*m[o]),a=n.lerp(t[1],p[o],i*m[o]);n.setPoint(e,u[o][0],s),n.setPoint(e,u[o][1],a)}))},shrinkCheekbone:(e,t)=>{const r=t*=.08,i=t,o=n.getVec(e,43),s=n.getVec(e,49),a=[[0,32],[2,30],[4,28],[6,26],[8,24]],c=[],u=[];a.forEach((t=>{const r=n.getVec(e,t[0]),i=n.getVec(e,t[1]);c.push([r,i]),u.push(n.intersectPoint(r,i,o,s))}));const l=[.33,.66,.33,.22,.11];c.forEach(((t,o)=>{const s=n.lerp(t[0],u[o],r*l[o]),c=n.lerp(t[1],u[o],i*l[o]);n.setPoint(e,a[o][0],s),n.setPoint(e,a[o][1],c)}))},lengthenJaw:(e,t)=>{t=.1*(.5-t);const r=n.getVec(e,16),i=n.sub(n.getVec(e,49),r),o=[.5,.5];[12,20,14,16,18].forEach(((r,s)=>{n.setPoint(e,r,n.add(n.getVec(e,r),n.scale(i,t*(o[s]||1))))}))},narrowedFace:(e,t)=>{const r=t*=.05,i=t,o=n.getVec(e,43),s=n.getVec(e,16),a=[.33,.66,1];[[106,111],[0,32],[2,30],[4,28],[6,26],[8,24],[10,22],[12,20],[14,18]].forEach(((t,c)=>{let u=n.getVec(e,t[0]),l=n.getVec(e,t[1]),d=n.intersectPoint(u,l,o,s);const p=a[c]||1;u=n.lerp(u,d,r*p),l=n.lerp(l,d,i*p),n.setPoint(e,t[0],u),n.setPoint(e,t[1],l)}))},shrinkFace:(e,t)=>{const r=t*=.1,i=t,o=n.getVec(e,43),s=n.getVec(e,16);let a=[[2,30],[4,28],[6,26],[8,24],[10,22],[12,20],[14,18]],c=[.1,.325,.55,.775,1,.9,.8,.7];a.forEach(((t,a)=>{let u=n.getVec(e,t[0]),l=n.getVec(e,t[1]),d=n.intersectPoint(u,l,o,s);u=n.lerp(u,d,r*c[a]),l=n.lerp(l,d,i*c[a]),n.setPoint(e,t[0],u),n.setPoint(e,t[1],l)}));const u=n.getVec(e,93);a=[[14,18],[12,20]],c=[.4,.2],a.forEach(((t,o)=>{let s=n.getVec(e,t[0]),a=n.getVec(e,t[1]);s=n.lerp(s,u,r*c[o]),a=n.lerp(a,u,i*c[o]),n.setPoint(e,t[0],s),n.setPoint(e,t[1],a)})),n.setPoint(e,16,n.lerp(n.getVec(e,16),u,.6*Math.max(r,i)))},vShapedFace:(e,t)=>{const r=t*=.2,i=t,o=n.getVec(e,16),s=n.getVec(e,2),a=n.getVec(e,30),c=[[4,28],[6,26],[8,24],[10,22],[12,20],[14,18]],u=[],l=[],d=[];c.forEach((t=>{const r=n.getVec(e,t[0]),i=n.getVec(e,t[1]);u.push([r,i]),l.push(n.intersectPoint(r,i,s,o)),d.push(n.intersectPoint(i,r,a,o))}));const p=[.33,.66];u.forEach(((t,o)=>{const s=n.lerp(t[0],l[o],r*(p[o]||1)),a=n.lerp(t[1],d[o],i*(p[o]||1));n.setPoint(e,c[o][0],s),n.setPoint(e,c[o][1],a)}))},minifyFace:(e,t)=>{t*=.1;const r=n.getVec(e,43),i=n.getVec(e,49),o=n.getVec(e,2),s=n.getVec(e,30),a=n.lerp(n.intersectPoint(r,i,o,s),r,t);let c=[.1,.25,.4,.55,.7,.85];[4,6,8,10,12,14,84,85,86,94,95,96,97,103,47,80,82].forEach(((r,i)=>{const o=n.lerp(n.getVec(e,r),a,t*(c[i]||.65));n.setPoint(e,r,o)})),[28,26,24,22,20,18,88,89,90,91,92,99,100,101,51,81,83].forEach(((r,i)=>{const o=n.lerp(n.getVec(e,r),a,t*(c[i]||.65));n.setPoint(e,r,o)})),c=[1],[16,93,102,98,87,49,46].forEach(((r,i)=>{const o=n.lerp(n.getVec(e,r),a,t*(c[i]||.65));n.setPoint(e,r,o)}))},shortenFace:(e,t)=>{t*=.1;const r=n.getVec(e,43),o=n.getVec(e,49),s=n.center(r,o)||n.getVec(e,45),a=i.scaleByNormal(n.sub(r,o),1-t,s.x,s.y);for(let t=4;t<30;t+=2)n.setPoint(e,t,a.multiplyPoint(n.getVec(e,t)));for(let t=80;t<84;t++)n.setPoint(e,t,a.multiplyPoint(n.getVec(e,t)));for(let t=46;t<52;t++)n.setPoint(e,t,a.multiplyPoint(n.getVec(e,t)));for(let t=84;t<104;t++)n.setPoint(e,t,a.multiplyPoint(n.getVec(e,t)))},whitenTeeth:(e,t)=>{let r=n.dis(n.getVec(e,98),n.getVec(e,102))/(n.dis(n.getVec(e,96),n.getVec(e,100))||1);return t*Math.max(0,Math.min(1,Math.pow(5*r,2)))}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.BeautyFilter=void 0;const n=r(131),i=r(132),o=r(116),s=r(133),a=r(310),c=r(311),u=r(312),l=r(200),d=r(134),p={};class m extends d.Filter{constructor(e,t,r,n){super(e,t,r,n),this._smooth=0,this._whiten=0,this._redden=0,this._faceMask=null,this._featureParas={forehead:0,eyeRim:0,noseLine:0},this.featureEnable=!1,this.whitenMap=o.createTexture(e.gl,null,{flipY:!1}),this.reddenMap=o.createTexture(e.gl,null,{flipY:!1});const{programs:i,framebuffers:s}=this.initProgramsBuffers();this.programs=i,this.framebuffers=s,this.initUniforms()}initProgramsBuffers(){const e=this.renderer.gl,t=this.renderer.getSize(),r={},o={},d={blurX:{vShader:c.beautyBlurShader.vShader,fShader:c.beautyBlurShader.fShader,size:{width:t.width>>1,height:t.height>>1}},blurY:{vShader:c.beautyBlurShader.vShader,fShader:c.beautyBlurShader.fShader,size:{width:t.width>>1,height:t.height>>1}},highPass:{vShader:s.baseTextureShader.vShader,fShader:u.beautyHighPassShader.fShader,size:t},hBlurX:{vShader:c.beautyBlurShader.vShader,fShader:c.beautyBlurShader.fShader,size:t},hBlurY:{vShader:c.beautyBlurShader.vShader,fShader:c.beautyBlurShader.fShader,size:t},beauty:{vShader:s.baseTextureShader.vShader,fShader:a.beautyShader.fShader,size:t},whiten:{vShader:s.baseTextureShader.vShader,fShader:l.lutShader.fShader,size:t},redden:{vShader:s.baseTextureShader.vShader,fShader:l.lutShader.fShader,size:t}};for(const t in d){const{vShader:s,fShader:a,size:c}=d[t],u=new i.Program(e);u.setShader(s,"VERTEX"),u.setShader(a,"FRAGMENT"),u.setAttributeBuffer(this.posBuffer),u.setAttributeBuffer(this.uvBuffer),r[t]=u;const l=n.createFrameBuffer(e,c.width,c.height);o[t]=l}return{programs:r,framebuffers:o}}initUniforms(){const e=this.programs,t=this.framebuffers,r=this.map,{width:n,height:i}=this.renderer.getSize(),o=[n,i],s=[n>>1,i>>1];e.blurX.setUniform("map",r),e.blurX.setUniform("size",s),e.blurY.setUniform("map",t.blurX.targetTexture),e.blurY.setUniform("size",s),e.blurY.setUniform("isVertical",1),e.highPass.setUniform("map",r),e.highPass.setUniform("blurMap",t.blurY.targetTexture),e.hBlurX.setUniform("map",t.highPass.targetTexture),e.hBlurX.setUniform("size",o),e.hBlurY.setUniform("map",t.hBlurX.targetTexture),e.hBlurY.setUniform("size",o),e.hBlurY.setUniform("isVertical",1),e.beauty.setUniform("size",o),e.beauty.setUniform("map",r),e.beauty.setUniform("blurMap",t.blurY.targetTexture),e.beauty.setUniform("highPassMap",t.hBlurY.targetTexture),e.beauty.setUniform("intensity",0);const a=this.featureParas;for(const t in a)e.beauty.setUniform(t+"Inten",this._featureParas[t]);e.whiten.setUniform("map",r),e.whiten.setUniform("lut",this.whitenMap),e.whiten.setUniform("intensity",0),e.redden.setUniform("map",r),e.redden.setUniform("lut",this.reddenMap),e.redden.setUniform("intensity",0)}get map(){return super.map}set map(e){e!==this._map&&(this._map=e,["blurX","highPass","beauty"].forEach((e=>{this.programs[e].setUniform("map",this._map)})),this.mapChange())}setLutsSrc(e,t){const{whiten:r,redden:n}=e;let i=2;const s=[],a=()=>{i-=1,i<=0&&(null==t||t(s))};if(p.whiten){this.whitenMap.source=p.whiten,this.whitenMap.refresh();const e=this._whiten;this._whiten=0,this.whiten=e,a()}else o.retryLoadImage(r,3,(e=>{p.whiten=e,this.whitenMap.source=e,this.whitenMap.refresh();const t=this._whiten;this._whiten=0,this.whiten=t,a()}),(()=>{s.push(r),a()}));if(p.redden){this.reddenMap.source=p.redden,this.reddenMap.refresh();const e=this._redden;this._redden=0,this.redden=e,a()}else o.retryLoadImage(n,3,(e=>{p.redden=e,this.reddenMap.source=e,this.reddenMap.refresh();const t=this._redden;this._redden=0,this.redden=t,a()}),(()=>{s.push(n),a()}))}get smoothOut(){return this.smooth||this.featureEnable?this.framebuffers.beauty.targetTexture:this.map}get whitenOut(){return this.whiten?this.framebuffers.whiten.targetTexture:this.smoothOut}mapChange(){this.programs.whiten.setUniform("map",this.smoothOut),this.programs.redden.setUniform("map",this.whitenOut)}get smooth(){return this._smooth}set smooth(e){this._smooth!==e&&(this._smooth=e,this.programs.beauty.setUniform("intensity",this._smooth),this.mapChange())}get whiten(){return this._whiten}set whiten(e){this._whiten!==e&&(this._whiten=e,this.programs.whiten.setUniform("intensity",this.whitenMap&&this.whitenMap.source?this._whiten:0),this.mapChange())}get redden(){return this._redden}set redden(e){this._redden!==e&&(this._redden=e,this.programs.redden.setUniform("intensity",this.reddenMap&&this.reddenMap.source?this._redden:0))}set faceMask(e){this._faceMask!==e&&(this.programs.beauty.setUniform("maskMap",e),this.programs.beauty.setUniform("hasMask",e?1:0),this._faceMask=e)}set featureParas(e){let t=0;for(const r in e){const n=e[r];t+=n,this._featureParas[r]!==n&&(this.programs.beauty.setUniform(r+"Inten",n),this._featureParas[r]=n)}this.featureEnable=t>0,this.mapChange()}get output(){return this.redden?this.framebuffers.redden.targetTexture:this.whiten?this.framebuffers.whiten.targetTexture:this.smooth||this.featureEnable?this.framebuffers.beauty.targetTexture:super.output}updateSize(){const e=this.renderer.getSize(),t=[e.width,e.height],r=[e.width>>1,e.height>>1];["blurX","blurY"].forEach((e=>{const t=this.framebuffers[e];t.targetTexture.opts.width=r[0],t.targetTexture.opts.height=r[1],t.targetTexture.refresh(),this.programs[e].setUniform("size",r)})),["highPass","hBlurX","hBlurY","beauty","whiten","redden"].forEach((e=>{const r=this.framebuffers[e];r.targetTexture.opts.width=t[0],r.targetTexture.opts.height=t[1],r.targetTexture.refresh(),["highPass","whiten","redden"].indexOf(e)<0&&this.programs[e].setUniform("size",t)}))}render(){const e=this.renderer,{width:t,height:r}=e.getSize(),n=this.programs,i=this.framebuffers;(this.smooth||this.featureEnable)&&(e.setViewport(0,0,t>>1,r>>1),i.blurX.bind(),e.render(n.blurX),i.blurY.bind(),e.render(n.blurY),e.setViewport(0,0,t,r),i.highPass.bind(),e.render(n.highPass),i.hBlurX.bind(),e.render(n.hBlurX),i.hBlurY.bind(),e.render(n.hBlurY),i.beauty.bind(),e.render(n.beauty)),this.whiten&&(i.whiten.bind(),e.render(n.whiten)),this.redden&&(i.redden.bind(),e.render(n.redden))}destroy(){super.destroy();const e=this.renderer.gl;null==e||e.deleteTexture(this.whitenMap.glTexture),null==e||e.deleteTexture(this.reddenMap.glTexture)}}t.BeautyFilter=m},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.beautyShader=void 0,t.beautyShader={fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform vec2 size;\n\n    uniform sampler2D map;\n    uniform sampler2D blurMap;\n    uniform sampler2D highPassMap;\n    uniform sampler2D maskMap;\n    uniform int hasMask;\n\n    // 磨皮度\n    uniform float intensity;\n    uniform float foreheadInten;\n    uniform float eyeRimInten;\n    uniform float noseLineInten;\n\n    varying vec2 vuv;\n\n    void main() {\n        vec4 originColor = texture2D(map, vuv);\n        float _intensity = intensity;\n        if(hasMask > 0){\n            vec4 mask = texture2D(maskMap, vuv);\n            float intens = max(max(mask.r * noseLineInten, mask.g * foreheadInten), mask.b * eyeRimInten);\n            if(intens > 0.0){\n              _intensity = mix(_intensity, 1.5, intens);\n            }else{\n              _intensity *= mask.a;\n            }\n        }\n        if(_intensity > 0.0){\n            vec2 stepOffset = 0.5 / size;\n            float uOffsetX = stepOffset.x;\n            float uOffsetY = stepOffset.y;\n            float strength = _intensity * 1.0;\n\n            vec4 meanColor = texture2D(blurMap, vuv);\n            vec4 varColor = texture2D(highPassMap, vuv);\n\n            float value = clamp((min(originColor.r, meanColor.r - 0.1) - 0.2) * 4.0, 0.0, 1.0);\n            float meanValue = (varColor.r + varColor.g + varColor.b) / 3.0;\n            float currentIntensity = (1.0 - meanValue / (meanValue + 0.1)) * value * strength;\n            vec3 resultColor = mix(originColor.rgb, meanColor.rgb, currentIntensity);\n            float sum = 0.25*originColor.g;\n            sum += 0.125 *texture2D(map,vec2(vuv.x-uOffsetX, vuv.y)).g;\n            sum += 0.125 *texture2D(map,vec2(vuv.x+uOffsetX, vuv.y)).g;\n            sum += 0.125 *texture2D(map,vec2(vuv.x, vuv.y-uOffsetY)).g;\n            sum += 0.125 *texture2D(map,vec2(vuv.x, vuv.y+uOffsetY)).g;\n            sum += 0.0625*texture2D(map,vec2(vuv.x+uOffsetX, vuv.y+uOffsetY)).g;\n            sum += 0.0625*texture2D(map,vec2(vuv.x+uOffsetX, vuv.y-uOffsetY)).g;\n            sum += 0.0625*texture2D(map,vec2(vuv.x-uOffsetX, vuv.y+uOffsetY)).g;\n            sum += 0.0625*texture2D(map,vec2(vuv.x-uOffsetX, vuv.y-uOffsetY)).g;\n\n            float hPass = originColor.g - sum + 0.5;\n            float flag = step(0.5, hPass);\n            vec3 color = mix(max(vec3(0.0), (2.0*hPass + resultColor - 1.0)), min(vec3(1.0), (resultColor + 2.0*hPass - 1.0)), flag);\n\n            gl_FragColor = vec4(mix(resultColor.rgb, color.rgb, _intensity), 1.0);\n        }else{\n            gl_FragColor = originColor;\n        }\n    }"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.beautyBlurShader=void 0,t.beautyBlurShader={vShader:"\n    uniform vec2 size;\n    uniform float isVertical;\n\n    attribute vec4 position;\n    attribute vec2 uv;\n\n    varying vec2 vuv;\n    varying vec4 vTextureShift1;\n\tvarying vec4 vTextureShift2;\n\tvarying vec4 vTextureShift3;\n\tvarying vec4 vTextureShift4;\n\n    void main() {\n        gl_Position = position;\n        vuv = uv;\n        // 偏移步距\n        vec2 stepOffset = 1.0 / size;\n        if(isVertical> 0.5){\n            stepOffset.x = 0.0;\n        }else{\n            stepOffset.y = 0.0;\n        }\n\n        vTextureShift1 = vec4(uv - stepOffset, uv + stepOffset);\n\t\tvTextureShift2 = vec4(uv- 2.0 * stepOffset, uv + 2.0 * stepOffset);\n\t\tvTextureShift3 = vec4(uv - 3.0 * stepOffset, uv + 3.0 * stepOffset);\n\t\tvTextureShift4 = vec4(uv - 4.0 * stepOffset, uv + 4.0 * stepOffset);\n    }\n",fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n\n    varying vec2 vuv;\n    varying vec4 vTextureShift1;\n\tvarying vec4 vTextureShift2;\n\tvarying vec4 vTextureShift3;\n\tvarying vec4 vTextureShift4;\n\n    void main() {\n        vec4 color = texture2D(map, vuv);\n\n        vec3 sum = color.rgb;\n        sum += texture2D(map, vTextureShift1.xy).rgb;\n\t\tsum += texture2D(map, vTextureShift1.zw).rgb;\n\t\tsum += texture2D(map, vTextureShift2.xy).rgb;\n\t\tsum += texture2D(map, vTextureShift2.zw).rgb;\n\t\tsum += texture2D(map, vTextureShift3.xy).rgb;\n\t\tsum += texture2D(map, vTextureShift3.zw).rgb;\n\t\tsum += texture2D(map, vTextureShift4.xy).rgb;\n\t\tsum += texture2D(map, vTextureShift4.zw).rgb;\n\n        gl_FragColor = vec4(sum * 0.1111, 1.0);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.beautyHighPassShader=void 0,t.beautyHighPassShader={fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n    uniform sampler2D blurMap;\n\n    varying vec2 vuv;\n\n    void main() {\n        vec4 color = texture2D(map, vuv);\n        vec4 blurColor = texture2D(blurMap, vuv);\n        vec3 diffColor = (color.rgb - blurColor.rgb) * 6.0;\n        diffColor = diffColor * diffColor;\n        diffColor = min(diffColor, 1.0);\n        gl_FragColor = vec4(diffColor, 1.0);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.LutFilter=void 0;const n=r(131),i=r(132),o=r(116),s=r(133),a=r(200),c=r(134),u={};class l extends c.Filter{constructor(e,t,r,n){super(e,t,r,n),this.lutImgs={},this.curLutName=null,this.lutMap=o.createTexture(e.gl,null,{flipY:!1});const{program:i,framebuffer:s}=this.initProgramBuffer();this.programs.main=i,this.framebuffers.main=s}initProgramBuffer(){const e=this.renderer.gl,t=this.renderer.getSize(),r=new i.Program(e);r.setShader(s.baseTextureShader.vShader,"VERTEX"),r.setShader(a.lutShader.fShader,"FRAGMENT"),r.setAttributeBuffer(this.posBuffer),r.setAttributeBuffer(this.uvBuffer);const o=n.createFrameBuffer(e,t.width,t.height);return r.setUniform("map",this.map),r.setUniform("lut",this.lutMap),r.setUniform("intensity",0),{program:r,framebuffer:o}}getLutImg(e){var t;return e&&null!==(t=this.lutImgs[e])&&void 0!==t?t:null}get map(){return this._map}set map(e){this._map!==e&&(this._map=e,this.programs.main.setUniform("map",this._map))}setLutsSrc(e,t){let r=Object.keys(e).length;const n=[],i=()=>{r-=1,r<=0&&(null==t||t(n))};for(const t in e){const{src:r,intensity:s=.5}=e[t];this.lutImgs[t]={img:null,intensity:s},u[t]?(this.lutImgs[t].img=u[t],t===this.curLutName&&(this.curLutName=null,this.setlut(t)),i()):o.retryLoadImage(r,3,(e=>{u[t]=e,this.lutImgs[t].img=e,t===this.curLutName&&(this.curLutName=null,this.setlut(t)),i()}),(()=>{n.push(r),i()}))}}get output(){return this.intensity?this.framebuffers.main.targetTexture:super.output}updateSize(){const e=this.renderer.getSize(),t=this.framebuffers.main;t.targetTexture.opts.width=e.width,t.targetTexture.opts.height=e.height,t.targetTexture.refresh()}setlut(e,t){if(e!==this.curLutName){this.curLutName=e;const t=this.getLutImg(this.curLutName);t&&(this.lutMap.source=t.img,this.lutMap.refresh())}t=null!=t?t:this.intensity,this.intensity=t}get intensity(){const e=this.getLutImg(this.curLutName);return e?e.intensity:0}set intensity(e){const t=this.getLutImg(this.curLutName);t?(t.intensity=e,t.img?this.programs.main.setUniform("intensity",this.intensity):this.programs.main.setUniform("intensity",0)):this.programs.main.setUniform("intensity",0)}render(){this.intensity&&(this.framebuffers.main.bind(),this.renderer.render(this.programs.main))}destroy(){var e;super.destroy(),null===(e=this.renderer.gl)||void 0===e||e.deleteTexture(this.lutMap.glTexture)}}t.LutFilter=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.NormalFilter=void 0;const n=r(131),i=r(132),o=r(133),s=r(134);class a extends s.Filter{constructor(e,t,r,n){super(e,t,r,n),this._srcMap=null,this.pixels=null,this.initProgram()}initProgram(){const e=this.renderer.gl;let t=this.renderer.getSize();const r=new i.Program(e);r.setShader(o.baseTextureShader.vShader,"VERTEX"),r.setShader(o.baseTextureShader.yFlipFShader,"FRAGMENT"),r.setAttributeBuffer(this.posBuffer),r.setAttributeBuffer(this.uvBuffer);const s=n.createFrameBuffer(e,t.width,t.height);r.setUniform("map",this._srcMap),this.programs.imgData=r,this.framebuffers.imgData=s;const a=new i.Program(e);a.setShader(o.baseTextureShader.vShader,"VERTEX"),a.setShader(o.baseTextureShader.fShader,"FRAGMENT"),a.setAttributeBuffer(this.posBuffer),a.setAttributeBuffer(this.uvBuffer),a.setUniform("map",this._map),this.programs.main=a}getImageData(e){e!==this._srcMap&&(this._srcMap=e,this.programs.imgData.setUniform("map",this._srcMap)),this._srcMap&&this._srcMap.refresh();const t=this.renderer,{width:r,height:n}=t.getSize(),i=t.gl;return this.framebuffers.imgData.bind(),t.render(this.programs.imgData),this.pixels&&this.pixels.length===r*n*4||(this.pixels=new Uint8Array(r*n*4)),i.readPixels(0,0,r,n,i.RGBA,i.UNSIGNED_BYTE,this.pixels),this.framebuffers.imgData.bind(!0),this.pixels}get map(){return this._map}set map(e){this._map!==e&&(this._map=e,this.programs.main.setUniform("map",this._map))}updateSize(){const e=this.renderer.getSize(),t=this.framebuffers.imgData;t&&(t.targetTexture.opts.width=e.width,t.targetTexture.opts.height=e.height,t.targetTexture.refresh())}render(){const e=this.renderer,{width:t,height:r}=e.getSize(),n=e.gl;e.setViewport(0,0,t,r),n.bindFramebuffer(n.FRAMEBUFFER,null),e.render(this.programs.main)}}t.NormalFilter=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.typedArray=void 0,t.typedArray={posArray:new Int8Array([-1,1,-1,-1,1,1,1,-1]),uvArray:new Uint8Array([0,1,0,0,1,1,1,0]),advBeautyPosArray:new Int16Array((()=>{const e=[];for(let t=0;t<145;t++)e.push(0,0);return e.push(0,0,0,1,1,1,1,0),e})()),advBeautyZindexArray:new Int16Array((()=>{const e=[];for(let t=0;t<145;t++)e.push(0);return e.push(-1,-1,-1,-1),e})()),advBeautyIndicesArray:new Uint16Array([145,146,147,145,147,148,0,2,52,52,2,57,57,2,4,57,4,73,73,4,80,73,80,56,56,80,55,55,80,43,67,55,43,67,54,55,66,54,67,66,72,54,65,72,66,65,53,72,64,53,65,64,52,53,33,52,64,0,52,33,33,64,34,34,64,65,34,65,35,35,65,66,35,66,36,36,66,67,36,67,37,53,52,57,53,57,73,53,73,72,72,73,56,72,56,54,54,56,55,37,67,43,37,43,38,38,43,68,68,43,58,58,43,81,43,46,81,81,46,83,46,51,83,46,49,51,46,47,49,46,82,47,80,82,46,43,80,46,43,55,80,67,55,43,38,68,39,39,68,69,39,69,40,40,69,70,40,70,41,41,70,71,41,71,42,32,61,30,30,61,62,30,62,28,62,76,28,76,81,28,63,81,76,58,81,63,43,81,58,43,58,68,68,58,59,68,59,69,69,59,75,69,75,70,70,75,60,70,60,71,71,60,61,71,61,42,42,61,32,59,58,63,59,63,76,59,76,75,75,76,62,75,62,60,60,62,61,4,82,80,4,6,82,6,8,82,82,8,84,8,10,84,84,10,12,84,12,95,95,12,14,95,14,94,94,14,93,93,14,16,93,16,18,93,18,92,92,18,20,92,20,91,91,20,90,90,20,22,90,22,24,90,24,83,83,24,26,83,26,28,83,28,81,106,0,33,106,33,34,107,106,34,107,34,35,108,107,35,108,35,36,109,108,36,109,36,37,110,109,37,116,110,37,116,37,38,115,116,38,114,115,38,114,38,39,113,114,39,113,39,40,112,113,40,112,40,41,111,112,41,111,41,42,111,42,32,82,84,47,47,84,85,47,85,86,47,86,49,49,86,87,49,87,88,49,88,51,51,88,89,51,89,90,83,51,90,85,84,96,85,96,97,85,97,86,86,97,87,87,97,98,87,98,99,87,99,88,88,99,89,89,99,100,89,100,90,100,91,90,101,91,100,101,92,91,102,92,101,102,93,92,102,94,93,103,94,102,103,95,94,96,95,103,84,95,96,96,103,97,97,103,102,97,102,98,98,102,99,99,102,101,99,101,100,0,117,118,0,118,2,2,118,119,2,119,4,4,119,120,4,120,6,6,120,121,6,121,8,8,121,122,8,122,10,10,122,123,10,123,12,12,123,124,12,124,14,14,124,125,14,125,16,16,125,126,16,126,18,18,126,127,18,127,20,20,127,128,20,128,22,22,128,129,22,129,24,24,129,130,24,130,26,26,130,131,26,131,28,28,131,132,28,132,30,30,132,133,30,133,32,106,134,117,106,117,0,107,135,134,107,134,106,108,136,135,108,135,107,109,137,136,109,136,108,110,138,137,110,137,109,116,144,138,116,138,110,115,143,144,115,144,116,114,142,143,114,143,115,113,141,142,113,142,114,112,140,141,112,141,113,111,139,140,111,140,112,32,133,139,32,139,111]),advFaceMaskUVArray:new Float32Array([.30859375,.58203125,.30859375,.5546875,.310546875,.52734375,.3125,.5,.314453125,.47265625,.318359375,.4453125,.322265625,.41796875,.330078125,.392578125,.337890625,.369140625,.349609375,.34765625,.365234375,.328125,.380859375,.310546875,.400390625,.296875,.419921875,.28515625,.44140625,.27734375,.46484375,.271484375,.486328125,.26953125,.509765625,.271484375,.533203125,.275390625,.5546875,.283203125,.578125,.29296875,.59765625,.306640625,.6171875,.32421875,.634765625,.341796875,.650390625,.36328125,.662109375,.388671875,.669921875,.4140625,.67578125,.44140625,.6796875,.46875,.68359375,.49609375,.685546875,.525390625,.6875,.552734375,.6875,.580078125,.33984375,.634765625,.36328125,.66796875,.392578125,.673828125,.421875,.671875,.451171875,.6640625,.521484375,.666015625,.55078125,.671875,.58203125,.673828125,.611328125,.666015625,.63671875,.634765625,.486328125,.60546875,.484375,.568359375,.482421875,.533203125,.482421875,.498046875,.443359375,.47265625,.462890625,.46875,.484375,.46484375,.505859375,.470703125,.52734375,.474609375,.369140625,.599609375,.384765625,.611328125,.421875,.611328125,.4375,.59765625,.419921875,.591796875,.384765625,.591796875,.537109375,.59765625,.552734375,.611328125,.591796875,.611328125,.607421875,.59765625,.591796875,.591796875,.5546875,.591796875,.36328125,.646484375,.392578125,.650390625,.421875,.6484375,.451171875,.642578125,.521484375,.642578125,.55078125,.6484375,.580078125,.6484375,.611328125,.64453125,.40234375,.615234375,.400390625,.58984375,.40234375,.6015625,.57421875,.615234375,.57421875,.58984375,.572265625,.6015625,.4609375,.6015625,.51171875,.6015625,.443359375,.521484375,.5234375,.5234375,.431640625,.490234375,.537109375,.4921875,.416015625,.392578125,.44140625,.41796875,.470703125,.427734375,.486328125,.427734375,.5,.4296875,.53125,.419921875,.55859375,.39453125,.537109375,.375,.51171875,.36328125,.484375,.361328125,.4609375,.36328125,.4375,.375,.421875,.392578125,.453125,.408203125,.484375,.412109375,.51953125,.41015625,.552734375,.39453125,.51953125,.388671875,.484375,.38671875,.453125,.38671875,.40234375,.599609375,.57421875,.599609375,.3046875,.634765625,.31640625,.685546875,.341796875,.734375,.380859375,.7734375,.431640625,.802734375,.6875,.638671875,.671875,.693359375,.642578125,.7421875,.599609375,.78125,.546875,.806640625,.48828125,.81640625,.25390625,.576171875,.2578125,.50390625,.26171875,.43359375,.271484375,.36328125,.29296875,.298828125,.328125,.24609375,.373046875,.205078125,.427734375,.1796875,.486328125,.169921875,.546875,.177734375,.60546875,.19921875,.65625,.240234375,.69921875,.291015625,.724609375,.357421875,.736328125,.427734375,.744140625,.501953125,.74609375,.57421875,.25,.64453125,.263671875,.7109375,.296875,.7734375,.34765625,.82421875,.4140625,.86328125,.74609375,.650390625,.7265625,.720703125,.689453125,.783203125,.6328125,.833984375,.564453125,.8671875,.48828125,.880859375,0,0,0,0,0,0,0,0]),advEyeTeethPosArray:new Int16Array(48),advEyeTeethZindexArray:new Int16Array(24),advEyeTeethUVArray:new Float32Array([.927,.789,.772,.877,.49,.91,.269,.872,.078,.764,.272,.61,.506,.559,.738,.611,.927,.789,.772,.877,.49,.91,.269,.872,.078,.764,.272,.61,.506,.559,.738,.611,.067,.28,.267,.389,.512,.364,.754,.389,.933,.29,.76,.159,.497,.112,.243,.156]),advEyeTeethIndicesArray:new Uint16Array([1,0,7,1,7,6,1,6,2,2,6,5,2,5,3,3,5,4,11,12,13,11,13,14,11,14,10,10,14,15,10,15,9,9,15,8,16,23,17,17,23,22,17,22,18,18,22,19,19,22,21,19,21,20]),advForeheadPosArray:new Int16Array(98),advForeheadZindexArray:new Int16Array(49),advForeheadUVArray:new Float32Array([.12,.564,.181,.619,.26,.628,.341,.616,.41,.592,.597,.592,.666,.616,.747,.628,.827,.619,.887,.564,.051,.638,.101,.753,.154,.853,.236,.933,.355,.955,.504,.956,.652,.955,.771,.933,.853,.853,.907,.753,.956,.638,.155,.266,.281,.306,.441,.371,.598,.395,.694,.334,.763,.247,.134,.379,.242,.427,.401,.49,.604,.522,.749,.455,.87,.3,.306,.251,.397,.232,.497,.217,.593,.23,.673,.262,.356,.104,.491,.024,.652,.11,.306,.251,.397,.232,.497,.217,.593,.23,.673,.262,.356,.104,.491,.024,.652,.11]),advForeheadIndicesArray:new Uint16Array([18,0,1,11,18,1,11,1,2,12,11,2,12,2,3,13,12,3,13,3,4,14,13,4,14,4,15,15,4,5,16,15,5,17,16,5,17,5,6,17,6,18,18,6,7,19,18,7,19,7,8,20,19,8,20,8,9,27,21,28,28,21,22,29,28,22,29,22,23,30,29,23,30,23,24,31,30,24,31,24,25,32,31,25,32,25,26])}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.VirtualBackFilter=void 0;const n=r(131),i=r(317),o=r(132),s=r(116),a=r(133),c=r(318),u=r(319),l=r(134);class d extends l.Filter{constructor(e,t,r,n){super(e,t,r,n),this.intensity=.1,this.lastSetInfo={},this.sourceMap=t,this.maskMap=s.createTexture(e.gl,null),this.bkColor=new i.GlColor("#e7ad3c"),this.bkMap=s.createTexture(e.gl,null),this.initProgramBuffer()}initProgramBuffer(){const e=this.renderer.gl,t=this.renderer.getSize(),r=[s.toNthPower(t.width),s.toNthPower(t.height)],i=new o.Program(e);i.setShader(a.baseTextureShader.vShader,"VERTEX"),i.setShader(a.baseTextureShader.fShader,"FRAGMENT"),i.setAttributeBuffer(this.posBuffer),i.setAttributeBuffer(this.uvBuffer);const l=n.createFrameBuffer(e,r[0],r[1],!0);i.setUniform("map",this.sourceMap),this.programs.mip=i,this.framebuffers.mip=l;const d=new o.Program(e);d.setShader(a.baseTextureShader.vShader,"VERTEX"),d.setShader(c.mipMapBlurShader.fShader,"FRAGMENT"),d.setAttributeBuffer(this.posBuffer),d.setAttributeBuffer(this.uvBuffer);const p=n.createFrameBuffer(e,t.width,t.height);d.setUniform("map",l.targetTexture),d.setUniform("radius",.25*Math.max(t.width,t.height)),d.setUniform("intensity",.1),this.programs.blur=d,this.framebuffers.blur=p;const m=new o.Program(e);m.setShader(a.baseTextureShader.vShader,"VERTEX"),m.setShader(u.virtualBackShader.fShader,"FRAGMENT"),m.setAttributeBuffer(this.posBuffer),m.setAttributeBuffer(this.uvBuffer);const f=n.createFrameBuffer(e,t.width,t.height);m.setUniform("map",this.map),m.setUniform("maskMap",this.maskMap),m.setUniform("backColor",this.bkColor.value),m.setUniform("backMap",this.bkMap),m.setUniform("size",[t.width,t.height]),m.setUniform("bkSize",[0,0]),m.setUniform("backType",0),m.setUniform("emptyFrame",0),this.programs.main=m,this.framebuffers.main=f}get map(){return this._map}set map(e){this._map!==e&&(this._map=e,this.programs.main.setUniform("map",this._map))}set emptyFrame(e){this.programs.main.setUniform("emptyFrame",e?1:0)}setMaskMap(e){const t=this.maskMap;t&&(t.source=e,t.refresh())}setBkColor(e){this.bkColor.setValue(e||"#e7ad3c"),this.programs.main.setUniform("backColor",this.bkColor.value)}getBkInfo(){const e=this.bkMap,t=e?e.source:null,r={type:"color",size:[0,0]};return t&&("videoWidth"in t?(r.type="video",r.size=[t.videoWidth,t.videoHeight]):t instanceof Image&&(r.type="image",r.size=[t.naturalWidth,t.naturalHeight])),r}setBkMap(e){const t=this.bkMap;t&&(e instanceof Image||null===e?(t.source=e,t.refresh()):"readyState"in e&&(e.readyState<2?setTimeout((()=>{this.setBkMap(e)}),16.7):(t.source=e,t.refresh())))}setBackground(e){const t=typeof e;"string"===t||null===e?(this.setBkColor(e),this.setBkMap(null)):"object"===t&&(this.setBkColor(null),this.setBkMap(e));const r=this.getBkInfo();this.programs.main.setUniform("backType","color"===r.type?0:1),"color"!==r.type&&(this.programs.main.setUniform("backMap",this.bkMap),this.programs.main.setUniform("bkSize",r.size)),this.lastSetInfo={type:"bk",value:e}}setBlurIntensity(e){const t=this.renderer.getSize();e=Math.max(.1,Math.min(1,e)),this.programs.blur.setUniform("intensity",e),this.programs.main.setUniform("backMap",this.framebuffers.blur.targetTexture),this.programs.main.setUniform("bkSize",[t.width,t.height]),this.programs.main.setUniform("backType",1),this.lastSetInfo={type:"blur",value:e}}get output(){return this.maskMap&&this.maskMap.source?this.framebuffers.main.targetTexture:super.output}updateSize(){const e=this.renderer.getSize(),t=[s.toNthPower(e.width),s.toNthPower(e.height)];["blur","main"].forEach((t=>{const r=this.framebuffers[t];r.targetTexture.opts.width=e.width,r.targetTexture.opts.height=e.height,r.targetTexture.refresh()}));const r=this.framebuffers.mip;r.targetTexture.opts.width=t[0],r.targetTexture.opts.height=t[1],r.targetTexture.refresh(),this.programs.main.setUniform("size",[e.width,e.height]),this.programs.blur.setUniform("radius",.25*Math.max(e.width,e.height)),this.programs.main.getUniform("backMap").value===r.targetTexture&&this.programs.main.setUniform("bkSize",t)}render(){var e;if(this.maskMap&&this.maskMap.source){const t=this.renderer;if(this.programs.main.getUniform("backMap").value===this.framebuffers.blur.targetTexture){const e=t.getSize(),r=this.framebuffers.mip.targetTexture;t.setViewport(0,0,r.opts.width,r.opts.height),this.framebuffers.mip.bind(),this.programs.mip.render(),this.framebuffers.mip.targetTexture.updateMipMap(),t.setViewport(0,0,e.width,e.height),this.framebuffers.blur.bind(),this.programs.blur.render()}else"video"===this.getBkInfo().type&&(null===(e=this.bkMap)||void 0===e||e.refresh());this.framebuffers.main.bind(),this.programs.main.render()}}destroy(){var e,t;super.destroy(),null===(e=this.renderer.gl)||void 0===e||e.deleteTexture(this.maskMap.glTexture),null===(t=this.renderer.gl)||void 0===t||t.deleteTexture(this.bkMap.glTexture)}}t.VirtualBackFilter=d},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GlColor=void 0,t.GlColor=class{constructor(e){this._color=[1,1,1,1],this.convert(e)}convert(e){if("string"==typeof e){if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/i.test(e)){if(4===e.length){let t="#";for(let r=1;r<4;r+=1)t+=e.slice(r,r+1).concat(e.slice(r,r+1));e=t}const t=[];for(let r=1;r<7;r+=2)t.push(parseInt("0x"+e.slice(r,r+2)));return void this.convert(t)}console.error(`color:[${e}] format is error.`)}else this._color=e.map(((e,t)=>t<3?Math.min(Math.max(Number(e),0),255)/255:Math.min(Math.max(Number(Number(null!=e?e:1)),0),1)))}get value(){return this._color}setValue(e){this.convert(e)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mipMapBlurShader=void 0,t.mipMapBlurShader={fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n    uniform float intensity;\n    uniform float radius;\n    varying vec2 vuv;\n\n    float weight(float t, float log2radius, float gamma)\n    {\n        return exp(-gamma*pow(log2radius-t,2.));\n    }\n\n    vec3 sample_blured(vec2 uv, float radius, float gamma)\n    {\n        vec3 pix = vec3(0.);\n        float norm = 0.;\n        for(float i = 0.; i < 10.; i += 0.5)\n        {\n            float k = weight(i, log2(radius), gamma);\n            pix += k * texture2D(map, uv, i).rgb;\n            norm += k;\n        }\n        return pix*pow(norm,-0.95);\n    }\n\n    void main() {\n        gl_FragColor = vec4(sample_blured(vuv, mix(8.0, radius, intensity), intensity), 1.0);\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.virtualBackShader=void 0,t.virtualBackShader={fShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n        precision highp float;\n    #else\n        precision mediump float;\n    #endif\n\n    uniform sampler2D map;\n    uniform sampler2D maskMap;\n    uniform sampler2D backMap;\n    uniform vec3 backColor;\n    uniform vec2 size;\n    uniform vec2 bkSize;\n    uniform int backType;\n    uniform int emptyFrame;\n\n    varying vec2 vuv;\n\n    void main() {\n        if(emptyFrame > 0){\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }else{\n            vec3 color = texture2D(map, vuv).rgb;\n            float alpha = texture2D(maskMap, vuv).a;\n\n            vec3 bk = backColor;\n            // 背景图\n            if(backType == 1){\n                float ratio = size.x / size.y;\n                float bkRatio = bkSize.x / bkSize.y;\n                vec2 suv = vuv;\n                if(ratio > bkRatio){\n                    suv.y = (suv.y - 0.5) * bkRatio / ratio + 0.5;\n                }else{\n                    suv.x = (suv.x - 0.5) * ratio / bkRatio + 0.5;\n                }\n                bk = texture2D(backMap, suv).rgb;\n            }\n\n            gl_FragColor = vec4(mix(bk, color, alpha), 1.0);\n        }\n    }\n"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(10),i=r(199);class o extends n.EventEmitter{constructor(e){var t;super(),this.setAdvEffect=(...e)=>{var t;this.videPostProcess.availableCode<1||(this.logger.log(`set advbeauty effect：[${e[0]}, ${e[1]}]`),null===(t=this.videPostProcess.filters)||void 0===t||t.advBeauty.setAdvEffect(...e))},this.presetAdvEffect=(...e)=>{var t;this.videPostProcess.availableCode<1||(this.logger.log("preset advbeauty effect："+JSON.stringify(e[0])),null===(t=this.videPostProcess.filters)||void 0===t||t.advBeauty.presetAdvEffect(...e))},this.videPostProcess=e,null===(t=this.videPostProcess.filters)||void 0===t||t.advBeauty.on("advBeautyResComplete",(e=>{this.videPostProcess.emit("advBeautyResComplete",e)}))}get advancedBeautyProcess(){const e=this.videPostProcess.getPlugin("AdvancedBeauty");return e||this.logger.error("Can not get AdvancedBeauty plugin"),e}init(e){this.videPostProcess.availableCode<1||(this.advancedBeautyProcess.on("facePoints-load",(()=>{this.emit("facePoints-load"),this.advancedBeautyProcess.setFaceSize(Math.min(5,Math.max(1,e||1)))})),this.advancedBeautyProcess.init())}destroy(){this.videPostProcess.availableCode<1||(this.advancedBeautyProcess.removeAllListeners(),this.advancedBeautyProcess.destroy())}get logger(){return this.videPostProcess.logger}setTrack(e,t){var r;return e&&o.configStaticRes(i.resSet,null===(r=this.videPostProcess.filters)||void 0===r?void 0:r.advBeauty),new Promise(((r,n)=>{this.videPostProcess.setTaskAndTrack("AdvancedBeauty",e,t).then((t=>{var n;e||null===(n=this.videPostProcess.filters)||void 0===n||n.advBeauty.setAdvData([]),r(t)})).catch((e=>{n(e)}))}))}get isEnable(){return this.videPostProcess.hasTask("AdvancedBeauty")}}t.default=o,o.configStaticRes=(e,t)=>{i.AdvBeautyFilter.configStaticRes(e,t)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n={beauty:{whiten:"https://yx-web-nosdn.netease.im/common/cab8e4f0696d3d8e29ee10d6dccc1204/meibai.png",redden:"https://yx-web-nosdn.netease.im/common/c614e2af82da88807067926d7ff3be3d/hongrun.png"},filters:{ziran:{src:"https://yx-web-nosdn.netease.im/common/c89328281947fceabdc71d5fa08b2345/ziran.png",intensity:1},baixi:{src:"https://yx-web-nosdn.netease.im/common/3a22a55384b0bd5b07fca3509bfc981a/baixi.png",intensity:.5},fennen:{src:"https://yx-web-nosdn.netease.im/common/db5befdae1f46dad2e5a6d702bad19ea/fennen.png",intensity:.5},weimei:{src:"https://yx-web-nosdn.netease.im/common/cf8bfec70d7998bb0033757276c6559a/weimei.png",intensity:.5},langman:{src:"https://yx-web-nosdn.netease.im/common/1c50a14532bfa3ad503a82ddd13f0ec8/langman.png",intensity:.5},rixi:{src:"https://yx-web-nosdn.netease.im/common/c414819383913b5db0d9b686276e3d57/rixi.png",intensity:.5},landiao:{src:"https://yx-web-nosdn.netease.im/common/4c77522852dc14448603be21abc571c8/landiao.png",intensity:.5},qingliang:{src:"https://yx-web-nosdn.netease.im/common/1150e94f831d24148239001588a7ca7d/qingliang.png",intensity:.5},huaijiu:{src:"https://yx-web-nosdn.netease.im/common/6a38caeab164d1b5cc086391d6a11a74/huaijiu.png",intensity:.5},qingcheng:{src:"https://yx-web-nosdn.netease.im/common/3b3332c5ae4306312b6f3c4c552a464a/qingcheng.png",intensity:1},wuhou:{src:"https://yx-web-nosdn.netease.im/common/200fc7a12177774f4eb23f55d72643ee/wuhou.png",intensity:1},zhigan:{src:"https://yx-web-nosdn.netease.im/common/848bd44506cf8e10ecabf564e3d74809/zhigan.png",intensity:1},mopian:{src:"https://yx-web-nosdn.netease.im/common/c454efa119520f0793ce51327951ed0a/mopian.png",intensity:1},dianying:{src:"https://yx-web-nosdn.netease.im/common/3a6a22adad29c5844fc829f4f889a79f/dianying.png",intensity:1},heibai:{src:"https://yx-web-nosdn.netease.im/common/941270f2948218ea19f2d79db5e7d349/heibai.png",intensity:1}}},i=new Set;t.default=class{constructor(e){this.lutLoaded=!1,this.videPostProcess=e,this.videPostProcess.on("contextLost",(()=>{this.lutLoaded=!1})),i.add(this)}startLut(){if(this.lutLoaded)return;const e=this.videPostProcess.filters;if(!e)return;let t=2;const r=[],i=()=>{t-=1,t<=0&&this.videPostProcess.emit("beautyResComplete",r)};e.beauty.setLutsSrc(n.beauty,(e=>{r.push(...e),i()})),e.lut.setLutsSrc(n.filters,(e=>{r.push(...e),i()})),this.lutLoaded=!0}setFilter(e,t){var r;null===(r=this.videPostProcess.filters)||void 0===r||r.lut.setlut(e,t)}setBeauty(e,t){return e&&this.startLut(),new Promise(((r,n)=>{this.videPostProcess.setTaskAndTrack("BasicBeauty",e,t).then((t=>{if(!e){const e=this.videPostProcess.filters;if(!e)return;e.beauty.whiten=0,e.beauty.redden=0,e.beauty.smooth=0,e.lut.setlut(null)}r(t)})).catch((e=>{n(e)}))}))}setBeautyOptions(e){const t=this.videPostProcess.filters;t&&("smoothnessLevel"in e&&(t.beauty.smooth=e.smoothnessLevel),"brightnessLevel"in e&&(t.beauty.whiten=e.brightnessLevel),"rednessLevel"in e&&(t.beauty.redden=e.rednessLevel))}get isEnable(){return this.videPostProcess.hasTask("BasicBeauty")}static configStaticRes(e){let t=!1;e.beauty&&(n.beauty=Object.assign({},e.beauty),t=!0),e.filters&&(n.filters=Object.assign({},e.filters),t=!0),t&&i.forEach((e=>{try{e.lutLoaded=!1,e.startLut()}catch(e){}}))}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const n=r(10),i=r(116);class o extends n.EventEmitter{constructor(e){super(),this.bgOption={type:"color",color:"#e7ad3c"},this.videPostProcess=e}get segmentProcess(){return this.videPostProcess.getPlugin("VirtualBackground")}init(){this.segmentProcess.on("segment-load",(()=>{this.emit("segment-load")})),this.segmentProcess.init()}destroy(){this.segmentProcess.removeAllListeners(),this.segmentProcess.destroy()}setVirtualBackGround(e){switch(this.bgOption=e,t){case"image":const{source:t}=e;if("object"==typeof t)this.setBackGround(t);else if("string"==typeof t)if(t.includes("data:image")){const e=new Image;e.onload=()=>{this.setBackGround(e)},e.src=t}else if(t.includes("http"))i.loadImage(t,(e=>{this.setBackGround(e)}));else{const e=new Image;e.onload=()=>{this.setBackGround(e)},e.src=t}break;case"color":this.setBackGround(e.color);break;case"blur":this.setBlurIntensity(e.level/10)}}setTrack(e,t){return new Promise(((r,n)=>{this.videPostProcess.setTaskAndTrack("VirtualBackground",e,t).then((t=>{var n;e||null===(n=this.videPostProcess.filters)||void 0===n||n.virtualBackground.setMaskMap(null),r(t)})).catch((e=>{n(e)}))}))}setBackGround(e){var t;null===(t=this.videPostProcess.filters)||void 0===t||t.virtualBackground.setBackground(e)}setBlurIntensity(e){var t;null===(t=this.videPostProcess.filters)||void 0===t||t.virtualBackground.setBlurIntensity(e)}get isEnable(){return this.videPostProcess.hasTask("VirtualBackground")}set emptyFrame(e){this.videPostProcess.filters.virtualBackground.emptyFrame=e}}t.default=o},function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.loadPlugin=void 0;const i=n(r(201));t.loadPlugin=function(e,t){return new Promise(((r,n)=>{-1==i.default.indexOf(e)&&n("unsupport plugin "+e);const o=document.createElement("script");o.defer=!0,o.src=t,document.body.appendChild(o),o.onload=function(){r()},o.onerror=function(e){n(`Load plugin ${t} error`)}}))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.applyResolution=void 0,t.applyResolution=async function(e){const{track:t,targetWidth:r,targetHeight:n,keepAspectRatio:i,logger:o}=e,s=t.getSettings();if(s.width&&s.height)if(s.width!==r||s.height!==n){let e;i?(e={aspectRatio:s.width/s.height},s.width/s.height>=r/n?e.width=r:e.height=n):e={width:r,height:n},await t.applyConstraints(e),await new Promise((e=>{setTimeout(e,100)}));const a=t.getSettings();s.width!==a.width||s.height!==a.height?o.log(`applyResolution 成功修改分辨率 保留长宽比：${i} ${s.width}x${s.height} => ${a.width}x${a.height} (constraints: ${JSON.stringify(e)})【${t.label}】`):o.warn(`applyResolution 无法修改分辨率为${r}x${n}，目前的分辨率：${s.width}x${s.height} (constraints: ${JSON.stringify(e)})【${t.label}】`)}else o.log(`applyResolution 无需修改分辨率 ${s.width}x${s.height} 【${t.label}】`);else o.log(`applyResolution 摄像头不支持动态修改分辨率 【${t.label}】`)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.webassemblySupported=void 0,t.webassemblySupported=function(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){return!1}return!1}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.serverError=t.clientNotYetPublished=t.STREAM_HAS_NO_MEDIA_ATTRIBUTES=t.clientNotYetUninitialized=t.invalidArguments=t.ok=void 0,t.ok={name:"OK",code:200,desc:"success"},t.invalidArguments={name:"invalid arguments",code:1,desc:"请检查参数的有效性"},t.clientNotYetUninitialized={name:"client not yet uninitialized",code:2,desc:"请先调用createClient创建Client"},t.STREAM_HAS_NO_MEDIA_ATTRIBUTES={name:"STREAM_HAS_NO_MEDIA_ATTRIBUTES",code:10,desc:"stream不合法，没有audio、video或者screen属性"},t.clientNotYetPublished={name:"client not yet published",code:11,desc:"请先publish"},t.serverError={name:"server error code",code:414,desc:""}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.LIVE_STREAM_AUDIO_CODEC_PROFILE=t.LIVE_STREAM_AUDIO_SAMPLE_RATE=void 0,t.LIVE_STREAM_AUDIO_SAMPLE_RATE={SAMPLE_RATE_32000:32e3,SAMPLE_RATE_44100:44100,SAMPLE_RATE_48000:48e3},t.LIVE_STREAM_AUDIO_CODEC_PROFILE={LC_AAC:0,HE_AAC:1}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.NETWORK_STATUS=void 0,t.NETWORK_STATUS={0:"UNKNOWN",1:"EXCELLENT",2:"GOOD",3:"POOR",4:"BAD",5:"VERYBAD",6:"DOWN"}}])}))})(NERTC);var NIM_Web_Chatroom={exports:{}};(function(module,exports){!function(e,t){module.exports=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=624)}([function(e,t,r){var n=r(94),i=r(95),o=r(75),s=r(57),a=r(58),c=r(59),u=r(60),l=r(49),d=r(61),p=r(3),m=r(6),f=r(17),h=r(10),g=r(116),v=r(76),y=r(109),b=r(30),S=r(13),T=r(8),_=r(11),w=r(148),M=r(110),x=r(26),E=r(19),C=r(373),R=r(4),k=r(27);function A(e,t){var r=h(e);if(s){var n=s(e);t&&(n=E(n).call(n,(function(t){return a(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(b(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return O(e,t);var i=f(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?O(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0,a=function(){};return{s:a,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){l=!0,c=e},f:function(){try{u||null==r.return||r.return()}finally{if(l)throw c}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var P=r(189),N=r(147);function D(e){"object"===k(e)?(this.callFunc=e.callFunc||null,this.message=e.message||"UNKNOW ERROR"):this.message=e,this.time=new Date,this.timetag=+this.time}r(377);var L,j,U=r(47),F=U.getGlobal(),$=/\s+/;U.deduplicate=function(e){var t=[];return p(e).call(e,(function(e){-1===m(t).call(t,e)&&t.push(e)})),t},U.capFirstLetter=function(e){return e?f(e=""+e).call(e,0,1).toUpperCase()+f(e).call(e,1):""},U.guid=(L=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return L()+L()+L()+L()+L()+L()+L()+L()}),U.extend=function(e,t,r){for(var n in t)void 0!==e[n]&&!0!==r||(e[n]=t[n])},U.filterObj=function(e,t){var r={};return U.isString(t)&&(t=t.split($)),p(t).call(t,(function(t){e.hasOwnProperty(t)&&(r[t]=e[t])})),r},U.copy=function(e,t){var r;return t=t||{},e?(p(r=h(e)).call(r,(function(r){U.exist(e[r])&&(t[r]=e[r])})),t):t},U.copyWithNull=function(e,t){var r;return t=t||{},e?(p(r=h(e)).call(r,(function(r){(U.exist(e[r])||U.isnull(e[r]))&&(t[r]=e[r])})),t):t},U.findObjIndexInArray=function(e,t){e=e||[];var r=t.keyPath||"id",n=-1;return g(e).call(e,(function(e,i){if(N(e,r)===t.value)return n=i,!0})),n},U.findObjInArray=function(e,t){var r=U.findObjIndexInArray(e,t);return-1===r?null:e[r]},U.mergeObjArray=function(){var e=[],t=f([]).call(arguments,0,-1),r=arguments[arguments.length-1];U.isArray(r)&&(t.push(r),r={});var n,i=r.keyPath=r.keyPath||"id";for(r.sortPath=r.sortPath||i;!e.length&&t.length;)e=t.shift()||[],e=f(e).call(e,0);return p(t).call(t,(function(t){t&&p(t).call(t,(function(t){-1!==(n=U.findObjIndexInArray(e,{keyPath:i,value:N(t,i)}))?e[n]=U.merge({},e[n],t):e.push(t)}))})),r.notSort||(e=U.sortObjArray(e,r)),e},U.cutObjArray=function(e){var t=f(e).call(e,0),r=arguments.length,n=f([]).call(arguments,1,r-1),i=arguments[r-1];U.isObject(i)||(n.push(i),i={});var o,s=i.keyPath=i.keyPath||"id";return p(n).call(n,(function(e){U.isArray(e)||(e=[e]),p(e).call(e,(function(e){e&&(i.value=N(e,s),-1!==(o=U.findObjIndexInArray(t,i))&&v(t).call(t,o,1))}))})),t},U.sortObjArray=function(e,t){var r=(t=t||{}).sortPath||"id";P.insensitive=!!t.insensitive;var n,i,o,s=!!t.desc;return o=U.isFunction(t.compare)?t.compare:function(e,t){return n=N(e,r),i=N(t,r),s?P(i,n):P(n,i)},y(e).call(e,o)},U.emptyFunc=function(){},U.isEmptyFunc=function(e){return e===U.emptyFunc},U.notEmptyFunc=function(e){return e!==U.emptyFunc},U.splice=function(e,t,r){return v([]).call(e,t,r)},U.reshape2d=function(e,t){if(b(e)){U.verifyParamType("type",t,"number","util::reshape2d");var r=e.length;if(r<=t)return[e];for(var n=Math.ceil(r/t),i=[],o=0;o<n;o++)i.push(f(e).call(e,o*t,(o+1)*t));return i}return e},U.flatten2d=function(e){if(b(e)){var t=[];return p(e).call(e,(function(e){t=S(t).call(t,e)})),t}return e},U.dropArrayDuplicates=function(e){if(b(e)){for(var t={},r=[];e.length>0;)t[e.shift()]=!0;for(var n in t)!0===t[n]&&r.push(n);return r}return e},U.onError=function(e){throw new D(e)},U.verifyParamPresent=function(e,t,r,n){r=r||"";var i=!1;switch(U.typeOf(t)){case"undefined":case"null":i=!0;break;case"string":""===t&&(i=!0);break;case"StrStrMap":case"object":h(t).length||(i=!0);break;case"array":t.length?g(t).call(t,(function(e){if(U.notexist(e))return i=!0,!0})):i=!0}i&&U.onParamAbsent(r+e,n)},U.onParamAbsent=function(e,t){U.onParamError("缺少参数 ".concat(e,", 请确保参数不是 空字符串、空对象、空数组、null或undefined, 或数组的内容不是 null/undefined"),t)},U.verifyParamAbsent=function(e,t,r,n){r=r||"",void 0!==t&&U.onParamPresent(r+e,n)},U.onParamPresent=function(e,t){U.onParamError("多余的参数 ".concat(e),t)},U.verifyParamType=function(e,t,r,n){var i=U.typeOf(t).toLowerCase();U.isArray(r)||(r=[r]),r=T(r).call(r,(function(e){return e.toLowerCase()}));var o=!0;switch(-1===m(r).call(r,i)&&(o=!1),i){case"number":isNaN(t)&&(o=!1);break;case"string":"numeric or numeric string"===r.join("")&&(o=!!/^[0-9]+$/.test(t))}o||U.onParamInvalidType(e,r,"",n)},U.onParamInvalidType=function(e,t,r,n){r=r||"",t=U.isArray(t)?(t=T(t).call(t,(function(e){return'"'+e+'"'}))).join(", "):'"'+t+'"',U.onParamError('参数"'+r+e+'"类型错误, 合法的类型包括: ['+t+"]",n)},U.verifyParamValid=function(e,t,r,n){U.isArray(r)||(r=[r]),-1===m(r).call(r,t)&&U.onParamInvalidValue(e,r,n)},U.onParamInvalidValue=function(e,t,r){var n;U.isArray(t)||(t=[t]),t=T(t).call(t,(function(e){return'"'+e+'"'})),U.isArray(t)&&(t=t.join(", ")),U.onParamError(S(n="参数 ".concat(e,"值错误, 合法的值包括: [")).call(n,_(t),"]"),r)},U.verifyParamMin=function(e,t,r,n){t<r&&U.onParamError("参数"+e+"的值不能小于"+r,n)},U.verifyParamMax=function(e,t,r,n){t>r&&U.onParamError("参数"+e+"的值不能大于"+r,n)},U.verifyArrayMax=function(e,t,r,n){t.length>r&&U.onParamError("参数"+e+"的长度不能大于"+r,n)},U.verifyEmail=(j=/^\S+@\S+$/,function(e,t,r){j.test(t)||U.onParamError("参数"+e+"邮箱格式错误, 合法格式必须包含@符号, @符号前后至少要各有一个字符",r)}),U.verifyTel=function(){var e=/^[+\-()\d]+$/;return function(t,r,n){e.test(r)||U.onParamError("参数"+t+"电话号码格式错误, 合法字符包括+、-、英文括号和数字",n)}}(),U.verifyBirth=function(){var e=/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/;return function(t,r,n){e.test(r)||U.onParamError("参数"+t+'生日格式错误, 合法为"yyyy-MM-dd"',n)}}(),U.onParamError=function(e,t){U.onError({message:e,callFunc:t})},U.verifyOptions=function(e,t,r,n,i){if(e=e||{},t&&(U.isString(t)&&(t=t.split($)),U.isArray(t))){"boolean"!=typeof r&&(i=r||null,r=!0,n="");var o=r?U.verifyParamPresent:U.verifyParamAbsent;p(t).call(t,(function(t){o.call(U,t,e[t],n,i)}))}return e},U.verifyParamAtLeastPresentOne=function(e,t,r){t&&(U.isString(t)&&(t=t.split($)),U.isArray(t)&&(g(t).call(t,(function(t){return U.exist(e[t])}))||U.onParamError("以下参数["+t.join(", ")+"]至少需要传入一个",r)))},U.verifyParamPresentJustOne=function(e,t,r){t&&(U.isString(t)&&(t=t.split($)),U.isArray(t)&&1!==w(t).call(t,(function(t,r){return U.exist(e[r])&&t++,t}),0)&&U.onParamError("以下参数["+t.join(", ")+"]必须且只能传入一个",r))},U.verifyBooleanWithDefault=function(e,t,r,n,i){U.undef(r)&&(r=!0),$.test(t)&&(t=t.split($)),U.isArray(t)?p(t).call(t,(function(t){U.verifyBooleanWithDefault(e,t,r,n,i)})):void 0===e[t]?e[t]=r:U.isBoolean(e[t])||U.onParamInvalidType(t,"boolean",n,i)},U.verifyFileInput=function(e,t){var r;return U.verifyParamPresent("fileInput",e,"",t),U.isString(e)&&((e="undefined"==typeof document?void 0:document.getElementById(e))||U.onParamError("找不到要上传的文件对应的input, 请检查fileInput id ".concat(e),t)),e.tagName&&"input"===e.tagName.toLowerCase()&&"file"===e.type.toLowerCase()||U.onParamError(S(r="请提供正确的 fileInput, 必须为 file 类型的 input 节点 tagname:".concat(e.tagName,", filetype:")).call(r,e.type),t),e},U.verifyFileType=function(e,t){U.verifyParamValid("type",e,U.validFileTypes,t)},U.verifyCallback=function(e,t,r){$.test(t)&&(t=t.split($)),U.isArray(t)?p(t).call(t,(function(t){U.verifyCallback(e,t,r)})):e[t]?U.isFunction(e[t])||U.onParamInvalidType(t,"function","",r):e[t]=U.emptyFunc},U.verifyFileUploadCallback=function(e,t){U.verifyCallback(e,"uploadprogress uploaddone uploaderror uploadcancel",t)},U.validFileTypes=["image","audio","video","file"],U.validFileExts={image:["bmp","gif","jpg","jpeg","jng","png","webp"],audio:["mp3","wav","aac","wma","wmv","amr","mp2","flac","vorbis","ac3"],video:["mp4","rm","rmvb","wmv","avi","mpg","mpeg","mov"]},U.filterFiles=function(e,t){var r,n,i="file"===(t=t.toLowerCase()),o=[];return p([]).call(e,(function(e){var s,a;if(i)o.push(e);else if(r=f(s=e.name).call(s,M(a=e.name).call(a,".")+1),(n=e.type.split("/"))[0]&&n[1]){var c;(n[0].toLowerCase()===t||-1!==m(c=U.validFileExts[t]).call(c,r))&&o.push(e)}})),o};var B,V,H=U.supportFormData=U.notundef(F.FormData);U.getFileName=function(e){return e=U.verifyFileInput(e),H?e.files[0].name:f(t=e.value).call(t,M(r=e.value).call(r,"\\")+1);var t,r},U.getFileInfo=(B={ppt:1,pptx:2,pdf:3,doc:6,docx:7},function(e){var t={};if(!(e=U.verifyFileInput(e)).files)return t;var r=e.files[0];return H&&(t.name=r.name,t.size=r.size,t.type=r.name.match(/\.(\w+)$/),t.type=t.type&&t.type[1].toLowerCase(),t.transcodeType=B[t.type]||0),t}),U.sizeText=(V=["B","KB","MB","GB","TB","PB","EB","ZB","BB"],function(e){var t,r=0;do{t=(e=Math.floor(100*e)/100)+V[r],e/=1024,r++}while(e>1);return t}),U.promises2cmds=function(e){return T(e).call(e,(function(e){return e.cmd}))},U.objs2accounts=function(e){return T(e).call(e,(function(e){return e.account}))},U.teams2ids=function(e){return T(e).call(e,(function(e){return e.teamId}))},U.objs2ids=function(e){return T(e).call(e,(function(e){return e.id}))},U.getMaxUpdateTime=function(e){var t=T(e).call(e,(function(e){return+e.updateTime}));return Math.max.apply(Math,t)},U.genCheckUniqueFunc=function(e){return e=e||"id",function(t){this.uniqueSet=this.uniqueSet||{},this.uniqueSet[e]=this.uniqueSet[e]||{};var r=this.uniqueSet[e],n=t[e];return!r[n]&&(r[n]=!0,!0)}},U.fillPropertyWithDefault=function(e,t,r){return!!U.undef(e[t])&&(e[t]=r,!0)},U.throttle=function(e,t,r,n){var i,o,s=null,a=0;r||(r={});var c=function(){a=!1===r.leading?0:(new Date).getTime(),s=null,e.apply(i,o),s||(i=o=null)};return function(){var u=(new Date).getTime();a||!1!==r.leading||(a=u);var l=t-(u-a);return i=this,o=arguments,l<=0||l>t?(clearTimeout(s),s=null,a=u,e.apply(i,o),s||(i=o=null)):s||!1===r.trailing?s&&n&&n.apply(i,o):(s=x(c,l),n&&n.apply(i,o)),s}},U.get=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=e,o=I(t.replace(/\[(\d+)\]/g,".$1").split("."));try{for(o.s();!(r=o.n()).done;){var s=r.value;if(void 0===(i=Object(i)[s]))return n}}catch(e){o.e(e)}finally{o.f()}return i},U.pickAsString=function(e,t){var r;return e?T(r=E(t).call(t,(function(t){return void 0!==e[t]}))).call(r,(function(t){var r;return S(r="".concat(t,"=")).call(r,e[t])})).join(","):""},U.omitAsString=function(e,t){var r,n;if(!e)return"";var i={};return p(t).call(t,(function(e){i[e]=!0})),T(r=E(n=h(e)).call(n,(function(e){return!i[e]}))).call(r,(function(t){var r;return S(r="".concat(t,"=")).call(r,e[t])})).join(",")};var W={session:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?p(r=A(Object(i),!0)).call(r,(function(t){d(e,t,i[t])})):c?u(e,c(i)):p(n=A(Object(i))).call(n,(function(t){l(e,t,a(i,t))}))}return e}({},e),r=["topCustom","localCustom","extra"];return p(r).call(r,(function(e){t[e]&&(t[e]="***")})),t.lastMsg&&(t.lastMsg={idServer:t.lastMsg.idServer,idClient:t.lastMsg.idClient}),t}};U.secureOutput=function(e,t){b(t)||(t=[t]);var r=W[e];return 1===(t=T(t).call(t,(function(e){return r(e)}))).length?t[0]:t};var q={string:function(e,t,r){var n=r.required,i=r.allowEmpty,o=e[t];return!1===n&&void 0===o||"string"==typeof o&&!(!i&&""===o)},number:function(e,t,r){var n=r.required,i=r.min,o=e[t];return!1===n&&void 0===o||"number"==typeof o&&!(o<i)},enum:function(e,t,r){var n=r.required,i=C(r),o=e[t];return!1===n&&void 0===o||m(i).call(i,o)>-1},array:function(e,t,r){var n=r.required,i=e[t];return!1===n&&void 0===i||!!b(i)}};U.validate=function(e,t,r){var n,i={};return p(n=h(e)).call(n,(function(n){var o,s=e[n].type,a=q[s];a&&!a(t,n,e[n])?U.onError({message:S(o="Error in parameter verification, ".concat(n," expected value is ")).call(o,_(e[n])),callFunc:r}):i[n]=t[n]})),i},U.asyncPool=function(e,t,r){if("number"!=typeof e||"function"!=typeof r||!t||!t.length)return R.resolve();var n=0,i=[],o=[];return function s(){if(n===t.length)return R.resolve();var a=t[n++],c=R.resolve().then((function(){return r(a,t)}));i.push(c);var u=R.resolve();if(e<=t.length){var l=c.then((function(){return v(o).call(o,m(o).call(o,l),1)}));o.push(l),o.length>=e&&(u=R.race(o))}return u.then((function(){return s()}))}().then((function(){return R.all(i)}))},U.getIdArray=function(e){if(!e||"string"!=typeof e)throw new Error("id type error");var t=m(e).call(e,"-");if(t<0||t===e.length-1)throw new Error("id format error");return[f(e).call(e,0,t),f(e).call(e,t+1)]},e.exports=U},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,r(48))},function(e,t,r){var n=r(1),i=r(53),o=r(7),s=r(21),a=r(65).f,c=r(157),u=r(12),l=r(68),d=r(45),p=r(25),m=function(e){var t=function(r,n,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,o)}return i(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,i,f,h,g,v,y,b,S=e.target,T=e.global,_=e.stat,w=e.proto,M=T?n:_?n[S]:(n[S]||{}).prototype,x=T?u:u[S]||d(u,S,{})[S],E=x.prototype;for(f in t)r=!c(T?f:S+(_?".":"#")+f,e.forced)&&M&&p(M,f),g=x[f],r&&(v=e.noTargetGet?(b=a(M,f))&&b.value:M[f]),h=r&&v?v:t[f],r&&typeof g==typeof h||(y=e.bind&&r?l(h,n):e.wrap&&r?m(h):w&&s(h)?o(h):h,(e.sham||h&&h.sham||g&&g.sham)&&d(y,"sham",!0),d(x,f,y),w&&(p(u,i=S+"Prototype")||d(u,i,{}),d(u[i],f,h),e.real&&E&&!E[f]&&d(E,f,h)))}},function(e,t,r){e.exports=r(280)},function(e,t,r){e.exports=r(202)},function(e,t,r){e.exports=r(415)},function(e,t,r){e.exports=r(154)},function(e,t,r){var n=r(83),i=Function.prototype,o=i.bind,s=i.call,a=n&&o.bind(s,s);e.exports=n?function(e){return e&&a(e)}:function(e){return e&&function(){return s.apply(e,arguments)}}},function(e,t,r){e.exports=r(351)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){e.exports=r(187)},function(e,t,r){e.exports=r(355)},function(e,t){e.exports={}},function(e,t,r){e.exports=r(234)},function(e,t,r){var n=r(6),i=r(13),o=!1;try{"function"==typeof localStorage.setItem&&"function"==typeof localStorage.getItem&&(localStorage.setItem("nim_localstorage_exist_test","1"),o="1"===localStorage.getItem("nim_localstorage_exist_test"),localStorage.removeItem("nim_localstorage_exist_test"))}catch(e){o=!1}var s={nodeEnv:"production",info:{hash:"548cf846168177774d699f96d7f855f4336577ba",shortHash:"548cf84",version:"9.8.0",sdkVersion:"90800",sdkHumanVersion:"9.8.0",protocolVersion:1},lbsUrl:"https://lbs.netease.im/lbs/webconf.jsp",roomserver:"roomserver.netease.im",connectTimeout:8e3,xhrTimeout:8e3,socketTimeout:8e3,reconnectionDelay:1600,reconnectionDelayMax:8e3,reconnectionJitter:.01,reconnectiontimer:null,heartbeatInterval:3e4,cmdTimeout:8e3,hbCmdTimeout:5e3,defaultReportUrl:"https://dr.netease.im/1.gif",isWeixinApp:!1,isNodejs:!1,isRN:!1,ipVersion:0,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,PushPermissionAsked:!1,iosPushConfig:null,androidPushConfig:null,netDetectAddr:"https://roomserver-dev.netease.im/v1/sdk/detect/local",optionDefaultLinkUrl:"",defaultLinkUrl:"weblink.netease.im",ipv6DefaultLinkUrl:"weblink.netease.im",optionIpv6DefaultLinkUrl:"",wxDefaultLinkUrl:"wlnimsc0.netease.im",serverNosConfig:o?{cdnDomain:localStorage.getItem("nim_cdn_domain")||"",objectPrefix:localStorage.getItem("nim_object_prefix")||""}:{},hasLocalStorage:o,getDefaultLinkUrl:function(e){var t,r;1===s.ipVersion?(t=s.optionIpv6DefaultLinkUrl,r=s.ipv6DefaultLinkUrl):(t=s.optionDefaultLinkUrl,r=s.defaultLinkUrl);var i=t||(s.isWeixinApp?s.wxDefaultLinkUrl:r);if(!i)return!1;var o=e?"https":"http",a=e?"443":"80",c=i;return-1===n(i).call(i,"http")&&(c=o+"://"+c),-1===n(i).call(i,":")&&(c=c+":"+a),c},ipProbeAddr:{ipv4:"https://detect4.netease.im/test/",ipv6:"https://detect6.netease.im/test/"},formatSocketUrl:function(e){var t=e.url,r=e.secure?"https":"http";return-1===n(t).call(t,"http")?r+"://"+t:t},uploadUrl:"https://nos.netease.com",chunkUploadUrl:"https://wanproxy-web.127.net",commonMaxSize:104857600,chunkSize:4194304,chunkMaxSize:4194304e4,replaceUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHost:"nos.netease.com",downloadHostList:["nos.netease.com"],downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",nosCdnEnable:!0,httpsEnabled:!1,threshold:0,nosLbsUrls:[],edgeList:["https://wanproxy-web.127.net","https://nosup-hz1.127.net"],genUploadUrl:function(e){return s.uploadUrl+"/"+e},genChunkUploadUrl:function(e){return s.chunkUploadUrl?s.chunkUploadUrl+"/"+e.bucket+"/"+e.objectName:""},genDownloadUrl:function(e,t,r){var n,o,a,c,u,l=e.bucket,d=e.expireSec,p=+new Date,m=d?"&survivalTime=".concat(d):"";if(r)return i(a=i(c=i(u="https://".concat(r,"/")).call(u,t,"?createTime=")).call(c,p)).call(a,m);var f=i(n=i(o="".concat(s.replaceUrl,"?createTime=")).call(o,p)).call(n,m);return(f=s.genNosProtocolUrl(f)).replace("{bucket}",l).replace("{object}",t)},genFileUrl:function(e){var t=e.bucket,r=e.objectName;return s.genNosProtocolUrl(s.replaceUrl).replace("{bucket}",t).replace("{object}",r)},genNosProtocolUrl:function(e){return/^http/.test(e)?s.httpsEnabled&&0!==n(e).call(e,"https://")&&(e=e.replace("http","https")):e=s.httpsEnabled?"https://".concat(e):"http://".concat(e),e}};e.exports=s},function(e,t,r){e.exports=r(238)},function(e,t,r){var n=r(7);e.exports=n({}.isPrototypeOf)},function(e,t,r){e.exports=r(186)},function(e,t,r){var n=r(1),i=r(123),o=r(25),s=r(125),a=r(121),c=r(155),u=i("wks"),l=n.Symbol,d=l&&l.for,p=c?l:l&&l.withoutSetter||s;e.exports=function(e){if(!o(u,e)||!a&&"string"!=typeof u[e]){var t="Symbol."+e;a&&o(l,e)?u[e]=l[e]:u[e]=c&&d?d(t):p(t)}return u[e]}},function(e,t,r){e.exports=r(369)},function(e,t,r){var n=r(12),i=r(25),o=r(135),s=r(41).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||s(t,e,{value:o.f(e)})}},function(e,t){e.exports=function(e){return"function"==typeof e}},function(e,t,r){var n=r(12);e.exports=function(e){return n[e+"Prototype"]}},function(e,t,r){e.exports=r(402)},function(e,t,r){var n=r(9);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var n=r(7),i=r(33),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},function(e,t,r){e.exports=r(368)},function(e,t,r){var n=r(145),i=r(272);function o(t){return"function"==typeof n&&"symbol"==typeof i?(e.exports=o=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=o=function(e){return e&&"function"==typeof n&&e.constructor===n&&e!==n.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),o(t)}e.exports=o,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(21);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},,function(e,t,r){e.exports=r(171)},function(e,t,r){var n=r(83),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},,function(e,t,r){var n=r(1),i=r(84),o=n.Object;e.exports=function(e){return o(i(e))}},function(e,t,r){var n=r(1),i=r(28),o=n.String,s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not an object")}},function(e,t,r){var n=r(96),i=r(84);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(15),i=r(3),o=r(27);function s(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this;n.message=e||r.message||"","object"===o(t)?(n.event=t,n.code="Other_Error"):void 0!==t&&(n.code=t),n.timetag=+new Date,void 0!==r&&(n.event=r),n.event&&(n.callFunc=n.event.callFunc||null,delete n.event.callFunc)}s.prototype=n(Error.prototype),s.prototype.name="NIMError";var a={201:"客户端版本不对, 需升级sdk",302:"用户名或密码错误, 请检查appKey和token是否有效, account和token是否匹配",403:"非法操作或没有权限",404:"对象(用户/群/聊天室)不存在",405:"参数长度过长",408:"客户端请求超时",414:"参数错误",415:"服务不可用/没有聊天室服务器可分配",416:"频率控制",417:"重复操作",422:"帐号被禁用",500:"服务器内部错误",501:"数据库操作失败",503:"服务器繁忙",508:"删除有效期过了",509:"已失效",7101:"被拉黑",700:"批量操作部分失败",801:"群人数达到上限",802:"没有权限",803:"群不存在或未发生变化",804:"用户不在群里面",805:"群类型不匹配",806:"创建群数量达到限制",807:"群成员状态不对",809:"已经在群里",811:"强推列表中帐号数量超限",812:"群被禁言",813:"因群数量限制，部分拉人成功",814:"禁止使用群组消息已读服务",815:"群管理员人数上限",816:"批量操作部分失败",997:"协议已失效",998:"解包错误",999:"打包错误",9102:"通道失效",9103:"已经在其他端接听/拒绝过这通电话",11001:"对方离线, 通话不可送达",13002:"聊天室状态异常",13003:"在黑名单中",13004:"在禁言名单中",13006:"聊天室处于整体禁言状态,只有管理员能发言",Connect_Failed:"无法建立连接, 请确保能 ping/telnet 到云信服务器; 如果是IE8/9, 请确保项目部署在 HTTPS 环境下",Error_Internet_Disconnected:"网断了",Error_Connection_is_not_Established:"连接未建立",Error_Connection_Socket_State_not_Match:"socket状态不对",Error_Timeout:"超时",Param_Error:"参数错误",No_File_Selected:"请选择文件",Wrong_File_Type:"文件类型错误",File_Too_Large:"文件过大",Cross_Origin_Iframe:"不能获取跨域Iframe的内容",Not_Support:"不支持",NO_DB:"无数据库",DB:"数据库错误",Still_In_Team:"还在群里",Session_Exist:"会话已存在",Session_Not_Exist:"会话不存在",Error_Unknown:"未知错误",Operation_Canceled:"操作取消"},c=[200,406,808,810];i(c).call(c,(function(e){a[e]=null})),s.genError=function(e){var t=a[e];return void 0===t&&(t="操作失败"),null===t?null:new s(t,e)},s.multiInstance=function(e){return new s("不允许初始化多个实例","Not_Allow_Multi_Instance",e)},s.newNetworkError=function(e){var t="Error_Internet_Disconnected";return new s(a[t],t,e)},s.newConnectError=function(e){var t="Connect_Failed";return new s(a[t]||null,t,e)},s.newConnectionError=function(e){var t="Error_Connection_is_not_Established";return new s(a[t],t,e)},s.newSocketStateError=function(e){var t="Error_Connection_Socket_State_not_Match";return new s(a[t],t,e)},s.newTimeoutError=function(e){var t="Error_Timeout";return new s(a[t],t,e)},s.newFrequencyControlError=function(e){var t=new s(a[416],416,e);return t.from="local",t},s.newParamError=function(e,t){return new s(e||a.Param_Error,"Param_Error",t)},s.newNoFileError=function(e,t){var r="No_File_Selected";return new s(e||a[r],r,t)},s.newWrongFileTypeError=function(e,t){var r="Wrong_File_Type";return new s(e||a[r],r,t)},s.newFileTooLargeError=function(e,t){var r="File_Too_Large";return new s(e||a[r],r,t)},s.newCORSIframeError=function(e){var t="Cross_Origin_Iframe";return new s(a[t],t,e)},s.newSupportError=function(e,t,r){return new s("不支持"+e,"Not_Support_"+t,r)},s.newSupportDBError=function(e){return s.newSupportError("数据库","DB",e)},s.noDBError=function(e){return new s(a.NO_DB,"NO_DB",e)},s.newDBError=function(e){return new s(a.DB,"DB",e)},s.newUnknownError=function(e){var t="Error_Unknown";return new s(a[t],t,e)},s.stillInTeamError=function(e){var t="Still_In_Team";return new s(a[t],t,e)},s.sessionExist=function(e){var t="Session_Exist";return new s(a[t],t,e)},s.sessionNotExist=function(e){var t="Session_Not_Exist";return new s(a[t],t,e)},s.cancel=function(e){var t="Operation_Canceled";return new s(a[t],t,e)},s.customError=function(e,t){e=e||"Other_Error";var r="";return(t=t||{}).message||(r=a[e]||e),"object"!==o(e)?new s(r,e,t):new s(r,"Other_Error",void 0===t?e:t)},e.exports=s},function(e,t,r){var n=r(12),i=r(1),o=r(21),s=function(e){return o(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?s(n[e])||s(i[e]):n[e]&&n[e][t]||i[e]&&i[e][t]}},function(e,t,r){var n=r(233);e.exports=function(e){return n(e.length)}},function(e,t,r){var n=r(0),i={init:function(){i.deviceId=n.guid()}};i.init(),i.clientTypeMap={1:"Android",2:"iOS",4:"PC",8:"WindowsPhone",16:"Web",32:"Server",64:"Mac"},i.db={open:function(){}},i.rnfs=null,e.exports=i},function(e,t,r){var n=r(1),i=r(21),o=r(98),s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a function")}},function(e,t,r){var n=r(1),i=r(24),o=r(156),s=r(158),a=r(34),c=r(97),u=n.TypeError,l=Object.defineProperty,d=Object.getOwnPropertyDescriptor;t.f=i?s?function(e,t,r){if(a(e),t=c(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&"writable"in r&&!r.writable){var n=d(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return l(e,t,r)}:l:function(e,t,r){if(a(e),t=c(t),a(r),o)try{return l(e,t,r)}catch(e){}if("get"in r||"set"in r)throw u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=r(216)},function(e,t,r){var n=r(1),i=r(46),o=n.String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},function(e,t,r){var n=r(37);e.exports=n("navigator","userAgent")||""},function(e,t,r){var n=r(24),i=r(41),o=r(54);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(1),i=r(129),o=r(21),s=r(66),a=r(18)("toStringTag"),c=n.Object,u="Arguments"==s(function(){return arguments}());e.exports=i?s:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=c(e),a))?r:u?s(t):"Object"==(n=s(t))&&o(t.callee)?"Arguments":n}},function(e,t,r){(function(t){var n=r(94),i=r(95),o=r(75),s=r(30),a=r(57),c=r(58),u=r(59),l=r(60),d=r(49),p=r(207),m=r(61),f=r(27),h=r(17),g=r(26),v=r(6),y=r(110),b=r(11),S=r(3),T=r(10),_=r(109),w=r(8),M=r(19);function x(e,t){var r=T(e);if(a){var n=a(e);t&&(n=M(n).call(n,(function(t){return c(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?S(r=x(Object(i),!0)).call(r,(function(t){m(e,t,i[t])})):u?l(e,u(i)):S(n=x(Object(i))).call(n,(function(t){d(e,t,c(i,t))}))}return e}function C(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(s(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return R(e,t);var i=h(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?R(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,c=function(){};return{s:c,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){d=!0,u=e},f:function(){try{l||null==r.return||r.return()}finally{if(d)throw u}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(){return"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}}function A(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r}function I(e){return""+e.getFullYear()}function O(e){return A(e.getMonth()+1)}function P(e){return A(e.getDate())}function N(e){return A(e.getHours())}function D(e){return A(e.getMinutes())}function L(e){return A(e.getSeconds())}function j(e){return A(e.getMilliseconds(),3)}var U,F,$=(U=/yyyy|MM|dd|hh|mm|ss|SSS/g,F={yyyy:I,MM:O,dd:P,hh:N,mm:D,ss:L,SSS:j},function(e,t){return e=new Date(e),isNaN(+e)?"invalid date":(t=t||"yyyy-MM-dd").replace(U,(function(t){return F[t](e)}))});function B(e){var t;return h(t=Object.prototype.toString.call(e)).call(t,8,-1)}function V(e){return B(e).toLowerCase()}function H(e){return"string"===V(e)}function W(e){return"number"===V(e)}function q(e){return"array"===V(e)}function z(e){return"function"==typeof e}function G(e){return"date"===V(e)}function J(e){return null===e}function K(e){return null!==e}function Q(e){return void 0===e}function Y(e){return void 0!==e}function X(e){return Y(e)&&K(e)}function Z(e){return Q(e)||J(e)}function ee(e){return X(e)&&"object"===V(e)}var te=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},re=te,ne=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)},ie=ne;function oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2?arguments[2]:void 0;for(var n in e)e.hasOwnProperty(n)&&t.call(r,n,e[n])}function se(e,t){oe(t,(function(t,r){e[t]=r}))}var ae,ce=(ae=0,function(){return""+ae++});function ue(e){return H(e)&&0===v(e).call(e,"{")&&y(e).call(e,"}")===e.length-1}function le(e,t,r){if(!e)return"";var n=[];return oe(e,(function(e,t){z(t)||(G(t)?t=t.getTime():q(t)?t=t.join(","):ee(t)&&(t=b(t)),r&&(t=encodeURIComponent(t)),n.push(encodeURIComponent(e)+"="+t))})),n.join(t||",")}var de=function(){var e=/^([\w]+?:\/\/.*?(?=\/|$))/i;return function(t){return e.test(t||"")?RegExp.$1.toLowerCase():""}}();function pe(e){var t=k();return e.tagName&&"INPUT"===e.tagName.toUpperCase()||t.Blob&&e instanceof t.Blob}e.exports={o:{},emptyObj:{},f:function(){},emptyFunc:function(){},regBlank:/\s+/gi,regWhiteSpace:/\s+/gi,getGlobal:k,detectCSSFeature:function(e){var t=!1,r="Webkit Moz ms O".split(" ");if("undefined"!=typeof document){var n=document.createElement("div"),i=null;if(e=e.toLowerCase(),void 0!==n.style[e]&&(t=!0),!1===t){i=e.charAt(0).toUpperCase()+e.substr(1);for(var o=0;o<r.length;o++)if(void 0!==n.style[r[o]+i]){t=!0;break}}return t}},fix:A,getYearStr:I,getMonthStr:O,getDayStr:P,getHourStr:N,getMinuteStr:D,getSecondStr:L,getMillisecondStr:j,format:$,dateFromDateTimeLocal:function(e){return e=""+e,new Date(e.replace(/-/g,"/").replace("T"," "))},getClass:B,typeOf:V,isString:H,isNumber:W,isInt:function(e){return W(e)&&e%1==0},isBoolean:function(e){return"boolean"===V(e)},isArray:q,isFunction:z,isDate:G,isRegExp:function(e){return"regexp"===V(e)},isError:function(e){return"error"===V(e)},isnull:J,notnull:K,undef:Q,notundef:Y,exist:X,notexist:Z,isObject:ee,isEmpty:function(e){return Z(e)||(H(e)||q(e))&&0===e.length},containsNode:function(e,t){if(e===t)return!0;for(;t.parentNode;){if(t.parentNode===e)return!0;t=t.parentNode}return!1},calcHeight:function(e){var t=e.parentNode||("undefined"==typeof document?null:document.body);if(!t)return 0;(e=e.cloneNode(!0)).style.display="block",e.style.opacity=0,e.style.height="auto",t.appendChild(e);var r=e.offsetHeight;return t.removeChild(e),r},remove:function(e){e.parentNode&&e.parentNode.removeChild(e)},dataset:function(e,t,r){if(!X(r))return e.getAttribute("data-"+t);e.setAttribute("data-"+t,r)},addEventListener:te,on:re,removeEventListener:ne,off:ie,target:function(e){return e.target||e.srcElement},createIframe:function(e){if("undefined"!=typeof document){var t;if((e=e||{}).name)try{(t=document.createElement('<iframe name="'+e.name+'"></iframe>')).frameBorder=0}catch(r){(t=document.createElement("iframe")).name=e.name}else t=document.createElement("iframe");e.visible||(t.style.display="none"),z(e.onload)&&re(t,"load",(function r(n){t.src&&(e.multi||ie(t,"load",r),e.onload(n))})),(e.parent||document.body).appendChild(t);var r=e.src||"about:blank";return g((function(){t.src=r}),0),t}},html2node:function(e){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML=e;var r,n,i=[];if(t.children)for(r=0,n=t.children.length;r<n;r++)i.push(t.children[r]);else for(r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];1===o.nodeType&&i.push(o)}return i.length>1?t:i[0]}},scrollTop:function(e){return"undefined"!=typeof document&&X(e)&&(document.documentElement.scrollTop=document.body.scrollTop=e),window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},forOwn:oe,mixin:se,uniqueID:ce,isJSON:ue,parseJSON:function e(t){try{ue(t)&&(t=JSON.parse(t)),ee(t)&&oe(t,(function(r,n){switch(V(n)){case"string":case"object":t[r]=e(n)}}))}catch(e){}return t},simpleClone:function(e){var t=[],r=b(e,(function(e,r){if("object"===f(r)&&null!==r){if(-1!==v(t).call(t,r))return;t.push(r)}return r}));return JSON.parse(r)},merge:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return S(r).call(r,(function(t){se(e,t)})),e},fillUndef:function(e,t){return oe(t,(function(t,r){Q(e[t])&&(e[t]=r)})),e},checkWithDefault:function(e,t,r){var n=e[t]||e[t.toLowerCase()];return Z(n)&&(n=r,e[t]=n),n},fetch:function(e,t){return oe(e,(function(r){X(t[r])&&(e[r]=t[r])})),e},string2object:function(){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r={};return S(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(t)).call(e,(function(e){var t=e.split("="),n=t.shift();n&&(r[decodeURIComponent(n)]=decodeURIComponent(t.join("=")))})),r},object2string:le,genUrlSep:function(e){return v(e).call(e,"?")<0?"?":"&"},object2query:function(e){return le(e,"&",!0)},url2origin:de,isFileInput:pe,getKeys:function(e,t){var r=T(e);return t&&_(r).call(r,(function(t,r){var n=pe(e[t]);return n===pe(e[r])?0:n?1:-1})),r},_get:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=e,o=C(t.replace(/\[(\d+)\]/g,".$1").split("."));try{for(o.s();!(r=o.n()).done;){var s=r.value;if(void 0===(i=Object(i)[s]))return n}}catch(e){o.e(e)}finally{o.f()}return i},getLastSeveralItems:function(e){for(var t=e.length,r=[],n=function(t){var n=e[t],i=w(n).call(n,(function(e){return E(E({},e),{},{flag:"sort_flag_".concat(t)})}));r.push.apply(r,p(i))},i=0;i<t;i++)n(i);_(r).call(r,(function(e,t){return e.startTime-t.startTime}));for(var o=[],s=function(e){var t;o[e]=w(t=M(r).call(r,(function(t){return t.flag==="sort_flag_".concat(e)}))).call(t,(function(e){return E(E({},e),{},{flag:void 0})}))},a=0;a<t;a++)s(a);return o}}}).call(this,r(48))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){e.exports=r(185)},function(e,t,r){e.exports=r(393)},,function(e,t,r){var n=r(27),i=r(15),o=r(30),s=r(3),a=r(285),c=r(6),u=r(4),l=r(307),d=r(0),p=d.notundef,m=r(388),f=r(14);function h(){}var g={};h.getInstance=function(e){e=y(e),d.verifyOptions(e,"account","api::Base.getInstance");var t=this.genInstanceName(e),r=g[t];return r?h.updateInstance(r,e):r=g[t]=new this(e),r},h.updateInstance=function(e,t){e.setOptions(t),e.connect()};var v=h.fn=h.prototype=i(new l),y=function(e){return e.nosSurvivalTime?(d.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance"),d.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")):e.nosSurvivalTime=1/0,e};v.updatePrivateConf=function(e){if(e&&"object"===n(e.privateConf)){var t=e.privateConf;"string"==typeof t.lbs_web&&(e.lbsUrl=t.lbs_web),"boolean"==typeof t.link_ssl_web&&(e.secure=t.link_ssl_web),"boolean"==typeof t.https_enabled&&(e.httpsEnabled=t.https_enabled),e.uploadUrl=t.nos_uploader_web?t.nos_uploader_web:null,e.chunkUploadUrl=t.nos_uploader_web?t.nos_uploader_web:null,e.replaceUrl=t.nos_downloader?t.nos_downloader:null,e.downloadUrl=t.nos_accelerate?t.nos_accelerate:null,e.downloadHost=t.nos_accelerate_host?t.nos_accelerate_host:null,e.downloadHostList=t.nos_accelerate_host_list||[],e.downloadHost&&e.downloadHostList.push(e.downloadHost),e.nosCdnEnable=!1!==t.nos_cdn_enable,e.ntServerAddress=t.nt_server||null,e.kibanaServer=t.kibana_server,e.statisticServer=t.statistic_server,e.reportGlobalServer=t.report_global_server,e.ipVersion=t.ip_protocol_version,e.defaultLink=t.link_web||e.defaultLink,e.ipv6DefaultLink=t.link_ipv6_web||e.ipv6DefaultLink,"string"==typeof t.nos_lbs?e.nosLbsUrls=[t.nos_lbs]:e.nosLbsUrls=[],o(t.nos_edge_list)&&(e.edgeList=t.nos_edge_list)}return null===e.ntServerAddress||""===e.ntServerAddress?f.ntServerAddress=null:f.ntServerAddress=e.ntServerAddress||f.defaultReportUrl,f.uploadUrl=e.uploadUrl||f.uploadUrl,f.chunkUploadUrl=e.chunkUploadUrl||f.chunkUploadUrl,f.downloadUrl=e.downloadUrl||f.downloadUrl,f.downloadHost=e.downloadHost||f.downloadHost,f.downloadHostList=e.downloadHostList&&e.downloadHostList.length>0?e.downloadHostList:f.downloadHostList,f.nosCdnEnable=!1!==e.nosCdnEnable,f.replaceUrl=e.replaceUrl||f.replaceUrl,f.httpsEnabled=e.httpsEnabled||f.httpsEnabled,e.probe_ipv4_url&&(f.ipProbeAddr.ipv4=e.probe_ipv4_url),e.probe_ipv6_url&&(f.ipProbeAddr.ipv6=e.probe_ipv6_url),e},v.init=function(e){d.verifyOptions(e,"account","api::Base.init"),e=this.updatePrivateConf(e),d.verifyBooleanWithDefault(e,"exifOrientation",!0,"","api::Base.init"),e.lbsBackup=void 0===e.lbsBackup||e.lbsBackup;var t=this.account=e.account=e.account+"",r=e.constructor.genInstanceName(e),n=g[r];if(e._disableSingleton&&(n=null),n)return h.updateInstance(n,e),n;this.name=r,g[r]=this,this.logger=e.logger=new m({debug:e.debug,logFunc:e.logFunc,prefix:this.subType,dbLog:!1!==e.dbLog,account:e.account,expire:e.expire,logLevel:e.logLevel}),e.api=this;var i=this.protocol=new e.Protocol(e);return i.name="Protocol-"+r,i.account=t,i.api=this,i.message=this.message=new e.Message({account:t}),this.reporter=i.reporter,this.options=d.copy(e),this},v.destroy=function(e){var t=this,r=this;if(!r.__beginDestroy){var n;r.__beginDestroy=!0,e=e||{};var i,o=this.name;if(this.logger.warn("destroy::start"),!o)return this.logger&&this.logger.warn&&this.logger.warn("destroy::no instanceName"),void(r.__beginDestroy=void 0);this.protocol&&(n=this.protocol.connectTimer),this.protocol&&this.protocol.resetPush&&this.protocol.resetPush(),this.eventNames&&"function"==typeof this.eventNames&&s(i=this.eventNames()).call(i,(function(e){delete t._events[e]})),this.disconnect({done:function(t){var i,u;r.logger.warn("ApiBase::destroy: instance destroyed ..."),r.__beginDestroy=void 0,r.reporter.destroy(),s(i=a(r.options)).call(i,(function(e){0===c(e).call(e,"on")&&(r.options[e]=function(){},r.protocol.options[e]=function(){},r.protocol.api.options[e]=function(){})})),r.logger.setLogDisabled(),s(u=a(r)).call(u,(function(e){r[e]=void 0})),g&&(g[o]=null,clearTimeout(n)),e.done instanceof Function&&e.done(t)}})}},v.setOptions=function(e){this.protocol.setOptions(e)},v.processCallback=function(e,t){b(e,t)},v.processCallbackPromise=function(e,t){return new u((function(r,n){b(e,t,!0,r,n)}))};var b=function(e,t,r,n,i){var o="api::processCallback";r&&(o="api::processCallbackPromise"),d.verifyCallback(e,"done",o),e.callback=function(s,a,c){var u=e.callback.options;if(a=a||u,t&&(a=u),d.isFunction(e.cbaop)){var l=e.cbaop(s,a);p(l)&&(a=l)}var m=e.done;d.isObject(a)&&(delete a.done,delete a.cb,delete a.callback),r?s?i({message:"生成接口回调错误",callFunc:o,event:s}):n(a):m(s,a,c)},e.callback.options=d.copy(e)};v.processPs=function(e){d.notexist(e.ps)&&(e.ps=""),d.verifyArrayMax("ps",e.ps,5e3)},v.processCustom=function(e){d.notexist(e.custom)&&(e.custom="")},v.sendCmd=function(){this.protocol.sendCmd.apply(this.protocol,arguments)},v.sendCmdWithResp=function(e,t,r){this.sendCmd(e,t,(function(e,t,n){d.isFunction(r)&&(e?r(e,t):r(null,n))}))},v.cbAndSendCmd=function(e,t){var r=this.processCallbackPromise(t);return this.sendCmd(e,t),r},v.sendCmdUsePromise=function(e,t){var r=this;return new u((function(n,i){r.sendCmd(e,t,(function(e,t,r){if(e)i(e);else{var o=d.merge({},t,r);n(o)}}))}))},h.use=function(e,t){e&&e.install&&d.isFunction(e.install)&&e.install(this,t)},h.rmAllInstances=function(){for(var e in g)g[e].destroy();g={}},v.logout=function(e){e=e||{},this.protocol.shouldReconnect=!1,this.protocol.doLogout=!0,this.processCallback(e),this.sendCmd("logout",e,e.callback)},e.exports=h,r(400),r(401),r(438),r(439),r(449),r(453)},function(e,t,r){var n=r(83),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?s.bind(o):function(){return s.apply(o,arguments)})},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=!0},function(e,t,r){r(73);var n=r(264),i=r(1),o=r(46),s=r(45),a=r(74),c=r(18)("toStringTag");for(var u in n){var l=i[u],d=l&&l.prototype;d&&o(d)!==c&&s(d,c,u),a[u]=a.Array}},function(e,t,r){e.exports=r(184)},function(e,t,r){e.exports=r(317)},function(e,t,r){e.exports=r(320)},function(e,t,r){e.exports=r(323)},function(e,t,r){var n=r(206);e.exports=function(e,t,r){return t in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){(function(t){var n=r(17),i=r(6),o=r(210),s=r(50),a=r(27),c=function(){var e="object"===(void 0===t?"undefined":a(t))?t:window,r=Math.pow(2,53)-1,c=/\bOpera/,u=Object.prototype,l=u.hasOwnProperty,d=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+n(e).call(e,1)}function m(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function f(e,t){for(var r in e)l.call(e,r)&&t(e[r],r,e)}function h(e){var t;return null==e?p(e):n(t=d.call(e)).call(t,8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function v(e,t){var n=null;return function(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=r)for(;++n<i;)t(e[n],n);else f(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function y(e){return String(e).replace(/^ +| +$/g,"")}return function t(r){var u=e,l=r&&"object"===a(r)&&"String"!=h(r);l&&(u=r,r=null);var p=u.navigator||{},b=p.userAgent||"";r||(r=b);var S,T,_,w,M,x,E,C=l?!!p.likeChrome:/\bChrome\b/.test(r)&&!/internal|\n/i.test(d.toString()),R=l?"Object":"ScriptBridgingProxyObject",k=l?"Object":"Environment",A=l&&u.java?"JavaPackage":h(u.java),I=l?"Object":"RuntimeObject",O=/\bJava/.test(A)&&u.java,P=O&&h(u.environment)==k,N=O?"a":"α",D=O?"b":"β",L=u.document||{},j=u.operamini||u.opera,U=c.test(U=l&&j?j["[[Class]]"]:h(j))?U:j=null,F=r,$=[],B=null,V=r==b,H=V&&j&&"function"==typeof j.version&&j.version(),W=v([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,t){return e||RegExp("\\b"+(t.pattern||g(t))+"\\b","i").exec(r)&&(t.label||t)})),q=v(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],(function(e,t){return e||RegExp("\\b"+(t.pattern||g(t))+"\\b","i").exec(r)&&(t.label||t)})),z=K([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),G=v({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},(function(e,t,n){return e||(t[z]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(z)]||RegExp("\\b"+g(n)+"(?:\\b|\\w*\\d)","i").exec(r))&&n})),J=v(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],(function(e,t){var n=t.pattern||g(t);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(r))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),m(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,t.label||t)),e}));function K(e){return v(e,(function(e,t){var n=t.pattern||g(t);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(r)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(r)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(r))&&((e=String(t.label&&!RegExp(n,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=m(e[0].replace(RegExp(n,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}if(W&&(W=[W]),G&&!z&&(z=K([G])),(S=/\bGoogle TV\b/.exec(z))&&(z=S[0]),/\bSimulator\b/i.test(r)&&(z=(z?z+" ":"")+"Simulator"),"Opera Mini"==q&&/\bOPiOS\b/.test(r)&&$.push("running in Turbo/Uncompressed mode"),"IE"==q&&/\blike iPhone OS\b/.test(r)?(G=(S=t(r.replace(/like iPhone OS/,""))).manufacturer,z=S.product):/^iP/.test(z)?(q||(q="Safari"),J="iOS"+((S=/ OS ([\d_]+)/i.exec(r))?" "+S[1].replace(/_/g,"."):"")):"Konqueror"!=q||/buntu/i.test(J)?G&&"Google"!=G&&(/Chrome/.test(q)&&!/\bMobile Safari\b/i.test(r)||/\bVita\b/.test(z))||/\bAndroid\b/.test(J)&&/^Chrome/.test(q)&&/\bVersion\//i.test(r)?(q="Android Browser",J=/\bAndroid\b/.test(J)?J:"Android"):"Silk"==q?(/\bMobi/i.test(r)||(J="Android",$.unshift("desktop mode")),/Accelerated *= *true/i.test(r)&&$.unshift("accelerated")):"PaleMoon"==q&&(S=/\bFirefox\/([\d.]+)\b/.exec(r))?$.push("identifying as Firefox "+S[1]):"Firefox"==q&&(S=/\b(Mobile|Tablet|TV)\b/i.exec(r))?(J||(J="Firefox OS"),z||(z=S[1])):!q||(S=!/\bMinefield\b/i.test(r)&&/\b(?:Firefox|Safari)\b/.exec(q))?(q&&!z&&/[\/,]|^[^(]+?\)/.test(n(r).call(r,i(r).call(r,S+"/")+8))&&(q=null),(S=z||G||J)&&(z||G||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(J))&&(q=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(J)?J:S)+" Browser")):"Electron"==q&&(S=(/\bChrome\/([\d.]+)\b/.exec(r)||0)[1])&&$.push("Chromium "+S):J="Kubuntu",H||(H=v(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version","HeadlessChrome",g(q),"(?:Firefox|Minefield|NetFront)"],(function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(r)||0)[1]||null}))),(S=("iCab"==W&&o(H)>3?"WebKit":/\bOpera\b/.test(q)&&(/\bOPR\b/.test(r)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(r)&&!/^(?:Trident|EdgeHTML)$/.test(W)&&"WebKit"||!W&&/\bMSIE\b/i.test(r)&&("Mac OS"==J?"Tasman":"Trident")||"WebKit"==W&&/\bPlayStation\b(?! Vita\b)/i.test(q)&&"NetFront")&&(W=[S]),"IE"==q&&(S=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(r)||0)[1])?(q+=" Mobile",J="Windows Phone "+(/\+$/.test(S)?S:S+".x"),$.unshift("desktop mode")):/\bWPDesktop\b/i.test(r)?(q="IE Mobile",J="Windows Phone 8.x",$.unshift("desktop mode"),H||(H=(/\brv:([\d.]+)/.exec(r)||0)[1])):"IE"!=q&&"Trident"==W&&(S=/\brv:([\d.]+)/.exec(r))&&(q&&$.push("identifying as "+q+(H?" "+H:"")),q="IE",H=S[1]),V){if(w="global",M=null!=(_=u)?a(_[w]):"number",/^(?:boolean|number|string|undefined)$/.test(M)||"object"==M&&!_[w])h(S=u.runtime)==R?(q="Adobe AIR",J=S.flash.system.Capabilities.os):h(S=u.phantom)==I?(q="PhantomJS",H=(S=S.version||null)&&S.major+"."+S.minor+"."+S.patch):"number"==typeof L.documentMode&&(S=/\bTrident\/(\d+)/i.exec(r))?(H=[H,L.documentMode],(S=+S[1]+4)!=H[1]&&($.push("IE "+H[1]+" mode"),W&&(W[1]=""),H[1]=S),H="IE"==q?String(H[1].toFixed(1)):H[0]):"number"==typeof L.documentMode&&/^(?:Chrome|Firefox)\b/.test(q)&&($.push("masking as "+q+" "+H),q="IE",H="11.0",W=["Trident"],J="Windows");else if(O&&(F=(S=O.lang.System).getProperty("os.arch"),J=J||S.getProperty("os.name")+" "+S.getProperty("os.version")),P){try{H=u.require("ringo/engine").version.join("."),q="RingoJS"}catch(e){(S=u.system)&&S.global.system==u.system&&(q="Narwhal",J||(J=S[0].os||null))}q||(q="Rhino")}else"object"===a(u.process)&&!u.process.browser&&(S=u.process)&&("object"===a(S.versions)&&("string"==typeof S.versions.electron?($.push("Node "+S.versions.node),q="Electron",H=S.versions.electron):"string"==typeof S.versions.nw&&($.push("Chromium "+H,"Node "+S.versions.node),q="NW.js",H=S.versions.nw)),q||(q="Node.js",F=S.arch,J=S.platform,H=(H=/[\d.]+/.exec(S.version))?H[0]:null));J=J&&m(J)}if(H&&(S=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(H)||/(?:alpha|beta)(?: ?\d)?/i.exec(r+";"+(V&&p.appMinorVersion))||/\bMinefield\b/i.test(r)&&"a")&&(B=/b/i.test(S)?"beta":"alpha",H=H.replace(RegExp(S+"\\+?$"),"")+("beta"==B?D:N)+(/\d+\+?/.exec(S)||"")),"Fennec"==q||"Firefox"==q&&/\b(?:Android|Firefox OS)\b/.test(J))q="Firefox Mobile";else if("Maxthon"==q&&H)H=H.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(z))"Xbox 360"==z&&(J=null),"Xbox 360"==z&&/\bIEMobile\b/.test(r)&&$.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(q)&&(!q||z||/Browser|Mobi/.test(q))||"Windows CE"!=J&&!/Mobi/i.test(r))if("IE"==q&&V)try{null===u.external&&$.unshift("platform preview")}catch(e){$.unshift("embedded")}else(/\bBlackBerry\b/.test(z)||/\bBB10\b/.test(r))&&(S=(RegExp(z.replace(/ +/g," *")+"/([.\\d]+)","i").exec(r)||0)[1]||H)?(J=((S=[S,/BB10/.test(r)])[1]?(z=null,G="BlackBerry"):"Device Software")+" "+S[0],H=null):this!=f&&"Wii"!=z&&(V&&j||/Opera/.test(q)&&/\b(?:MSIE|Firefox)\b/i.test(r)||"Firefox"==q&&/\bOS X (?:\d+\.){2,}/.test(J)||"IE"==q&&(J&&!/^Win/.test(J)&&H>5.5||/\bWindows XP\b/.test(J)&&H>8||8==H&&!/\bTrident\b/.test(r)))&&!c.test(S=t.call(f,r.replace(c,"")+";"))&&S.name&&(S="ing as "+S.name+((S=S.version)?" "+S:""),c.test(q)?(/\bIE\b/.test(S)&&"Mac OS"==J&&(J=null),S="identify"+S):(S="mask"+S,q=U?m(U.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(S)&&(J=null),V||(H=null)),W=["Presto"],$.push(S));else q+=" Mobile";(S=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(r)||0)[1])&&(S=[o(S.replace(/\.(\d)$/,".0$1")),S],"Safari"==q&&"+"==n(x=S[1]).call(x,-1)?(q="WebKit Nightly",B="alpha",H=n(E=S[1]).call(E,0,-1)):H!=S[1]&&H!=(S[2]=(/\bSafari\/([\d.]+\+?)/i.exec(r)||0)[1])||(H=null),S[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(r)||0)[1],537.36==S[0]&&537.36==S[2]&&o(S[1])>=28&&"WebKit"==W&&(W=["Blink"]),V&&(C||S[1])?(W&&(W[1]="like Chrome"),S=S[1]||((S=S[0])<530?1:S<532?2:S<532.05?3:S<533?4:S<534.03?5:S<534.07?6:S<534.1?7:S<534.13?8:S<534.16?9:S<534.24?10:S<534.3?11:S<535.01?12:S<535.02?"13+":S<535.07?15:S<535.11?16:S<535.19?17:S<536.05?18:S<536.1?19:S<537.01?20:S<537.11?"21+":S<537.13?23:S<537.18?24:S<537.24?25:S<537.36?26:"Blink"!=W?"27":"28")):(W&&(W[1]="like Safari"),S=(S=S[0])<400?1:S<500?2:S<526?3:S<533?4:S<534?"4+":S<535?5:S<537?6:S<538?7:S<601?8:"8"),W&&(W[1]+=" "+(S+="number"==typeof S?".x":/[.+]/.test(S)?"":"+")),"Safari"==q&&(!H||s(H)>45)&&(H=S));"Opera"==q&&(S=/\bzbov|zvav$/.exec(J))?(q+=" ",$.unshift("desktop mode"),"zvav"==S?(q+="Mini",H=null):q+="Mobile",J=J.replace(RegExp(" *"+S+"$"),"")):"Safari"==q&&/\bChrome\b/.exec(W&&W[1])&&($.unshift("desktop mode"),q="Chrome Mobile",H=null,/\bOS X\b/.test(J)?(G="Apple",J="iOS 4.3+"):J=null),H&&0==i(H).call(H,S=/[\d.]+$/.exec(J))&&i(r).call(r,"/"+S+"-")>-1&&(J=y(J.replace(S,""))),W&&!/\b(?:Avant|Nook)\b/.test(q)&&(/Browser|Lunascape|Maxthon/.test(q)||"Safari"!=q&&/^iOS/.test(J)&&/\bSafari\b/.test(W[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(q)&&W[1])&&(S=W[W.length-1])&&$.push(S),$.length&&($=["("+$.join("; ")+")"]),G&&z&&i(z).call(z,G)<0&&$.push("on "+G),z&&$.push((/^on /.test($[$.length-1])?"":"on ")+z),J&&(S=/ ([\d.+]+)$/.exec(J),T=S&&"/"==J.charAt(J.length-S[0].length-1),J={architecture:32,family:S&&!T?J.replace(S[0],""):J,version:S?S[1]:null,toString:function(){var e=this.version;return this.family+(e&&!T?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(S=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(F))&&!/\bi686\b/i.test(F)?(J&&(J.architecture=64,J.family=J.family.replace(RegExp(" *"+S),"")),q&&(/\bWOW64\b/i.test(r)||V&&/\w(?:86|32)$/.test(p.cpuClass||p.platform)&&!/\bWin64; x64\b/i.test(r))&&$.unshift("32-bit")):J&&/^OS X/.test(J.family)&&"Chrome"==q&&o(H)>=39&&(J.architecture=64),r||(r=null);var Q={};return Q.description=r,Q.layout=W&&W[0],Q.manufacturer=G,Q.name=q,Q.prerelease=B,Q.product=z,Q.ua=r,Q.version=q&&H,Q.os=J||{architecture:null,family:null,version:null,toString:function(){return"null"}},Q.parse=t,Q.toString=function(){return this.description||""},Q.version&&$.unshift(H),Q.name&&$.unshift(q),J&&q&&(J!=String(J).split(" ")[0]||J!=q.split(" ")[0]&&!z)&&$.push(z?"("+J+")":"on "+J),$.length&&(Q.description=$.join(" ")),Q}()}();e.exports=c}).call(this,r(48))},function(e,t,r){var n=r(77),i=r(30),o=r(10),s=r(6),a=r(76),c=r(3),u=r(11),l=r(26),d=r(79),p=r(13),m=r(23),f=r(0),h=r(14),g=r(36);function v(e){f.undef(e.secure)&&(e.secure=!0),this.options=f.copy(e),this.keepNosSafeUrl=this.options.keepNosSafeUrl||!1;var t=e.defaultLink||e.defaultLinkUrl;f.notundef(t)&&f.isString(t)&&(h.optionDefaultLinkUrl=n(t).call(t)),f.notundef(e.ipv6DefaultLink)&&f.isString(e.ipv6DefaultLink)&&(h.optionIpv6DefaultLinkUrl=e.ipv6DefaultLink),"number"==typeof e.heartbeatInterval&&(h.heartbeatInterval=e.heartbeatInterval),i(e.nosLbsUrls)&&(h.nosLbsUrls=e.nosLbsUrls),this.init(),this.connect()}var y=v.fn=v.prototype;y.init=function(){this.logger=this.options.logger,this.getNosOriginUrlReqNum=0,this.checkNosReqNum=0,this.cmdTaskArray=[],this.timerMap={},this.cmdCallbackMap={},this.cmdContentMap={},this.initConnect(),this.reset()},y.reset=function(){this.resetConnect()},y.setOptions=function(e){var t=this.options,r=o(t),n=s(r).call(r,"account");f.verifyCallback(e,["onconnect","onerror","onwillreconnect","ondisconnect","onloginportschange","onmyinfo","onblacklist","onmutelist","onfriends","onusers","onrobots","onteams","onSuperTeams","onsessions","onSessionsWithMoreRoaming","onStickTopSessions","onroamingmsgs","onofflinemsgs","onofflinefiltermsgs","onroamingsysmsgs","onofflinesysmsgs","onofflinefiltersysmsgs","onofflinecustomsysmsgs","onofflinefiltercustomsysmsgs","onbroadcastmsg","onbroadcastmsgs","onsysmsgunread","onsyncdone","onteammembers","onsyncteammembersdone","onmsg","onsysmsg","oncustomsysmsg","onupdatemyinfo","onupdateuser","onSyncUpdateServerSession","onUpdateSuperTeamMember","onCreateSuperTeam","onUpdateSuperTeam","onAddSuperTeamMembers","onRemoveSuperTeamMembers","onUpdateSuperTeamManagers","onDismissSuperTeam","onTransferSuperTeam","onUpdateSuperTeamMembersMute","onupdateteammember","onCreateTeam","onUpdateTeam","onAddTeamMembers","onRemoveTeamMembers","onUpdateTeamManagers","onDismissTeam","onTransferTeam","onUpdateTeamMembersMute","onTeamMsgReceipt","onupdatesession","onQuickComment","onDeleteQuickComment","onPinMsgChange","onupdatesysmsgunread","onupdatesysmsg","onsynccreateteam","onsyncsupercreateteam","onsyncmarkinblacklist","onsyncmarkinmutelist","onsyncfriendaction","shouldIgnoreNotification","shouldIgnoreMsg","onDeleteMsgSelf","shouldCountNotifyUnread","onPushNotificationMultiportConfig","onPushNotificationMultiportConfigUpdate","onpushevents"],"protocol::IMProtocol"),this.logger.info("setOptions::",f.omitAsString(e,["appKey","token","loginExt","customTag"])),-1!==n&&a(r).call(r,n,1),e=f.filterObj(e,r),this.options=f.merge(t,e),this.reset()},y.sendCmd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=this;n.heartbeat();var i,s=e,a=(e=n.parser.createCmd(e,t)).SER;t=t||{},n.cmdContentMap[a]=t,t.single&&(delete t.single,1===(i=o(t)).length&&(n.cmdContentMap[a]=t[i[0]])),t.NOTSTORE&&(i=t.NOTSTORE.split(" "),c(i).call(i,(function(e){delete t[e]})),delete t.NOTSTORE),(r=r||t.callback)&&(n.cmdCallbackMap[a]=r),n.cmdTaskArray.push({cmdName:s,cmd:u(e)}),n.startCmdTaskTimer()},y.startCmdTaskTimer=function(){var e=this;e.cmdTaskTimer||(e.cmdTaskTimer=l((function(){var t=e.cmdTaskArray.shift();e.cmdTaskTimer=null,t&&e.executeCmdTask(t),e.cmdTaskArray.length&&e.startCmdTaskTimer()}),0))},y.executeCmdTask=function(e){var t=e.cmdName,r=e.cmd,n=(r=JSON.parse(r)).SER;this.isFrequencyControlled(t)?(this.logger.warn("protocol::executeCmdTask: ".concat(t," hit freq control")),this.markCallbackInvalid(n,g.newFrequencyControlError({callFunc:"protocol::executeCmdTask",message:"".concat(t," hit freq control")}))):this.hasLogin?("heartbeat"!==t&&(this.logger.debugEnable?this.logger.debug("protocol::sendCmd: ".concat(e.cmd)):this.logger.info("protocol::sendCmd: ".concat(t))),this.doSendCmd(r)):"login"===t&&this.isConnected()?(this.createLoginTime=d(),this.logger.debugEnable?this.logger.debug("protocol::sendCmd: ".concat(e.cmd)):this.logger.info("protocol::sendCmd: ".concat(t)),this.doSendCmd(r)):(this.logger.warn("protocol::executeCmdTask: ".concat(t," not connected or login")),this.markCallbackInvalid(n,g.newSocketStateError({callFunc:"protocol::executeCmdTask",message:"".concat(t," not connected or not login")})))},y.isFrequencyControlled=function(e){var t=this.frequencyControlMap&&this.frequencyControlMap[e];if(t){if(d()<t.from+t.duration)return!0;delete this.frequencyControlMap[e]}},y.doSendCmd=function(e){var t=this,r=e.SER,n=0===r?h.hbCmdTimeout:h.cmdTimeout;function i(){t.markCallbackInvalid(r,g.newSocketStateError({callFunc:"protocol::doSendCmd",message:"ser ".concat(r," socketSendJson Error")})),t.onDisconnect("protocol::doSendCmd:socketSendJson")}t.timerMap[r]=l((function(){t.markCallbackInvalid(r,g.newTimeoutError({callFunc:"protocol::doSendCmd",message:"ser ".concat(r," Timeout Error")}))}),n);try{t.socket&&t.socket.send?t.socket.send(u(e)):i()}catch(e){i()}},y.getObjWithSer=function(e){var t=this.cmdContentMap[e];return t&&!t.isImSyncDataObj&&delete this.cmdContentMap[e],t&&f.copy(t)},y.getCallbackWithSer=function(e){var t=this.cmdCallbackMap[e];return t&&!t.isImSyncDataCb&&delete this.cmdCallbackMap[e],t},y.getTimerWithSer=function(e){var t=this.timerMap[e];return delete this.timerMap[e],t},y.clearTimerWithSer=function(e){var t=this.getTimerWithSer(e);t&&clearTimeout(t)},y.markCallbackInvalid=function(e,t){this.getObjWithSer(e),this.clearTimerWithSer(e);var r=this.getCallbackWithSer(e);if(r){var n=r.options;l((function(){r(t||g.newUnknownError({ser:e}),n)}),0)}},y.markAllCallbackInvalid=function(e){var t,r=this;c(t=o(this.cmdCallbackMap)).call(t,(function(t){r.markCallbackInvalid(t,e)})),r.cmdTaskArray=[]},y.getPacketObj=function(e){var t=null;if(e&&e.raw){var r=e.raw.ser;f.notundef(r)&&(t=this.getObjWithSer(r))}return t},y.callPacketAckCallback=function(e){var t=this;if(e&&e.raw){var r=e.raw.ser;if(f.notundef(r)){t.clearTimerWithSer(r);var n,i=t.getCallbackWithSer(r);if(i)i.originUrl&&e.obj&&e.obj.file&&(e.obj.file._url_safe=e.obj.file.url,e.obj.file.url=i.originUrl,"audio"===e.obj.type&&(e.obj.file.mp3Url=i.originUrl+(~s(n=i.originUrl).call(n,"?")?"&":"?")+"audioTrans&type=mp3")),e.promise?e.promise.then((function(){i(e.error,e.obj)}),(function(n){var o;n.callFunc="protocol::callPacketAckCallback",n.message=p(o="Resp Promoise Error: cmd: ".concat(e.cmd,", ser: ")).call(o,r);var s=g.customError("CALLBACK_ACK_ERR",n);t.logger.error("protocol::callPacketAckCallback: promise error ".concat(u(n))),i(s,e.obj,e.content)})):i(e.error,e.obj,e.content)}}},y.onMessage=function(e){var t=this;t.heartbeat(),t.parser.parseResponse(e).then((function(e){if(e.notFound&&t.logger.warn("protocol::onMessage: packet not found ".concat(u(e))),e.error){var r,n;e.error.message=p(r="".concat(e.cmd," error: ")).call(r,e.error.message),t.logger.error(p(n="protocol::onMessage: packet error ".concat(u(e.error),"，raw cmd ")).call(n,e.rawStr));var i=e.raw||{};408!==i.code&&415!==i.code&&500!==i.code||t.reporter.report("nimErrEvent",{code:i.code,module:e.cmd,accid:t.account})}e.frequencyControlDuration&&(t.logger.error("protocol::onMessage: server freq control ".concat(u(e.cmd))),t.frequencyControlMap=t.frequencyControlMap||{},t.frequencyControlMap[e.cmd]={from:+new Date,duration:e.frequencyControlDuration}),e.obj=t.getPacketObj(e),"heartbeat"!==e.cmd&&(t.logger.debugEnable?t.logger.debug("protocol::recvCmd: ".concat(e.rawStr)):t.logger.log("protocol::recvCmd: ".concat(e.cmd))),e.__receiveTime=d();var o="process"+f.capFirstLetter(e.service);if(t[o])if("syncDone"===e.cmd){if(t.cmdCallbackMap[e.raw.ser]&&t.cmdCallbackMap[e.raw.ser].isImSyncDataCb){var s;t.cmdCallbackMap[e.raw.ser].isImSyncDataCb=!1;var a=m(s=function(e,t){this.checkNosReqNum++,this.getNosOriginUrlReqNum<=0||this.checkNosReqNum>=20?this[e](t):l(a,300)}).call(s,t,o,e);l((function(){a.call(t,o,e)}),10)}}else t[o](e);else t.logger.warn("protocol::onMessage: ".concat(o," not found"));t.callPacketAckCallback(e)}))},y.onMiscError=function(e,t,r){t&&this.notifyError(e,t,r)},y.onCustomError=function(e,t){var r=g.customError(e,t),n=t.message||"未知错误";this.onMiscError(n,r)},y.notifyError=function(e,t,r){var n;this.isConnected()&&(this.logger.error(p(n="".concat(e||""," ")).call(n,this.name),t,r),this.options.onerror(t,r))},y.emitAPI=function(e){var t=e.type,r=e.obj;this.api.emit(t,r)},e.exports=v,r(457),r(462),r(463),r(464),r(465)},function(e,t,r){(function(t){var n;e.exports=(n=n||function(e,n){var i;if("undefined"!=typeof window&&window.crypto&&(i=window.crypto),"undefined"!=typeof self&&self.crypto&&(i=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!=typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&void 0!==t&&t.crypto&&(i=t.crypto),!i)try{i=r(601)}catch(e){}var o=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a={},c=a.lib={},u=c.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=c.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||p).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(var a=0;a<i;a+=4)t[n+a>>>2]=r[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(o());return new l.init(t,e)}}),d=a.enc={},p=d.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new l.init(r,t/2)}},m=d.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new l.init(r,t)}},f=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(m.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return m.parse(unescape(encodeURIComponent(e)))}},h=c.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,s=this.blockSize,a=o/(4*s),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,u=e.min(4*c,o);if(c){for(var d=0;d<c;d+=s)this._doProcessBlock(i,d);r=i.splice(0,c),n.sigBytes-=u}return new l.init(r,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(c.Hasher=h.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}}),a.algo={});return a}(Math),n)}).call(this,r(48))},function(e,t,r){var n=r(24),i=r(31),o=r(114),s=r(54),a=r(35),c=r(97),u=r(25),l=r(156),d=Object.getOwnPropertyDescriptor;t.f=n?d:function(e,t){if(e=a(e),t=c(t),l)try{return d(e,t)}catch(e){}if(u(e,t))return s(!i(o.f,e,t),e[t])}},function(e,t,r){var n=r(7),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},function(e,t,r){var n,i,o=r(1),s=r(44),a=o.process,c=o.Deno,u=a&&a.versions||c&&c.version,l=u&&u.v8;l&&(i=(n=l.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},function(e,t,r){var n=r(7),i=r(40),o=r(83),s=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(9);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){return 1},1)}))}},function(e,t,r){var n=r(66);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(97),i=r(41),o=r(54);e.exports=function(e,t,r){var s=n(t);s in e?i.f(e,s,o(0,r)):e[s]=r}},function(e,t,r){var n=r(45);e.exports=function(e,t,r,i){i&&i.enumerable?e[t]=r:n(e,t,r)}},function(e,t,r){var n=r(35),i=r(146),o=r(74),s=r(103),a=r(41).f,c=r(167),u=r(55),l=r(24),d=s.set,p=s.getterFor("Array Iterator");e.exports=c(Array,"Array",(function(e,t){d(this,{type:"Array Iterator",target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");var m=o.Arguments=o.Array;if(i("keys"),i("values"),i("entries"),!u&&l&&"values"!==m.name)try{a(m,"name",{value:"values"})}catch(e){}},function(e,t){e.exports={}},function(e,t,r){e.exports=r(312)},function(e,t,r){e.exports=r(339)},function(e,t,r){e.exports=r(407)},function(e,t,r){var n=r(68),i=r(7),o=r(96),s=r(33),a=r(38),c=r(128),u=i([].push),l=function(e){var t=1==e,r=2==e,i=3==e,l=4==e,d=6==e,p=7==e,m=5==e||d;return function(f,h,g,v){for(var y,b,S=s(f),T=o(S),_=n(h,g),w=a(T),M=0,x=v||c,E=t?x(f,w):r||p?x(f,0):void 0;w>M;M++)if((m||M in T)&&(b=_(y=T[M],M,S),e))if(t)E[M]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return M;case 2:u(E,y)}else switch(e){case 4:return!1;case 7:u(E,y)}return d?-1:i||l?l:E}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},function(e,t,r){e.exports=r(412)},,function(e,t,r){var n=r(112),i=r(435),o=r(436),s=r(437);n.json=i,n.upload=o,n.chunkUpload=s,e.exports=n},function(e,t,r){var n=r(94),i=r(95),o=r(75),s=r(30),a=r(6),c=r(17),u=r(3),l=r(13),d=r(212),p=r(19);function m(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(s(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return f(e,t);var i=c(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,u=function(){};return{s:u,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,d=!0,p=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return d=e.done,e},e:function(e){p=!0,l=e},f:function(){try{d||null==r.return||r.return()}finally{if(p)throw l}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=r(14),g={genUrlSep:function(e){return-1===a(e=""+e).call(e,"?")?"?imageView&":"&"},urlQuery2Object:function(e){if("[object String]"!==Object.prototype.toString.call(e)||""===e)return{};var t=a(e).call(e,"?");if(-1!==t){var r=c(e).call(e,t+1).split("&"),n={};return u(r).call(r,(function(e){if(~a(e).call(e,"=")){var t=e.split("=");n[t[0]]=decodeURIComponent(t[1])}else n[e]=""})),n}},url2object:function(e){"[object String]"!==Object.prototype.toString.call(e)&&(e="");var t=a(e=e||"").call(e,"https")>=0?"https://":"http://",r=e.replace(t,"");a(r).call(r,"?")>=0&&(r=r.substring(0,a(r).call(r,"?")));var n=r.split("/");r=n[0];var i="";if(n.length>0&&(i=c(n).call(n,1).join("/")),-1===a(e).call(e,"?"))return{protocol:t,hostname:r,path:i,query:{}};var o=e.substr(a(e).call(e,"?")+1).split("&"),s={};return u(o).call(o,(function(e){if(a(e).call(e,"=")>0){var t=e.split("=");s[t[0]]=decodeURIComponent(t[1])}else s[e]=""})),{protocol:t,hostname:r,path:i,query:s}},object2url:function(e){var t,r=e.protocol,n=e.hostname,i=e.path,o=e.query;r=r||"http://",n=n||"",i&&(n=l(t="".concat(n,"/")).call(t,i)),o=o||{};var s,a,c,u=[];for(var d in o){var p;"imageView"!==d&&u.push(l(p="".concat(d,"=")).call(p,encodeURIComponent(o[d])))}return u.length>0?l(s=l(a="".concat(r)).call(a,n,"?imageView&")).call(s,u.join("&")):l(c="".concat(r)).call(c,n)},genPrivateUrl:function(e,t,r){if(t&&t.length){var n,i=m(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(a(e).call(e,o)>=0)return o!==r&&(e=e.replace(o,r)),e;if(a(e).call(e,o)>=0&&o===r)return e}}catch(e){i.e(e)}finally{i.f()}}var s,u,f=g.url2object(e),v=f.hostname,y=f.path,b=h.downloadUrl,S=h.downloadHostList,T=h.nosCdnEnable,_=h.serverNosConfig.cdnDomain,w=decodeURIComponent(h.serverNosConfig.objectPrefix),M=decodeURIComponent(y),x=a(M).call(M,w);if(_&&x>-1&&T)return l(s=l(u="".concat(f.protocol)).call(u,_,"/")).call(s,c(M).call(M,x));if(d(S).call(S,v)&&d(y).call(y,"/")){var E=a(y).call(y,"/"),C=y.substring(0,E),R=y.substring(E+1);return b.replace("{bucket}",C).replace("{object}",R)}var k=p(S).call(S,(function(e){return"string"==typeof v&&d(v).call(v,e)}))[0],A=k?v.replace(k,"").replace(/\W/g,""):null;return A?b.replace("{bucket}",A).replace("{object}",y):e}};e.exports=g},function(e,t,r){var n=r(9);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},function(e,t,r){var n=r(1).TypeError;e.exports=function(e){if(null==e)throw n("Can't call method on "+e);return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){var t=+e;return t!=t||0===t?0:(t>0?n:r)(t)}},function(e,t,r){var n=r(9),i=r(18),o=r(67),s=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,r){var n,i=r(34),o=r(131),s=r(132),a=r(101),c=r(161),u=r(126),l=r(102)("IE_PROTO"),d=function(){},p=function(e){return"<script>"+e+"<\/script>"},m=function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t},f=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t;f="undefined"!=typeof document?document.domain&&n?m(n):((t=u("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):m(n);for(var r=s.length;r--;)delete f.prototype[s[r]];return f()};a[l]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(d.prototype=i(e),r=new d,d.prototype=null,r[l]=e):r=f(),void 0===t?r:o.f(r,t)}},function(e,t){},function(e,t,r){var n=r(7);e.exports=n([].slice)},function(e,t,r){var n=r(129),i=r(41).f,o=r(45),s=r(25),a=r(244),c=r(18)("toStringTag");e.exports=function(e,t,r,u){if(e){var l=r?e:e.prototype;s(l,c)||i(l,c,{configurable:!0,value:t}),u&&!n&&o(l,"toString",a)}}},function(e,t,r){var n=r(11),i=r(210),o=r(27),s=r(82).genPrivateUrl,a=r(0),c=a.notundef,u=a.exist,l=r(141),d=r(199),p=d.typeMap;function m(e){e.resend?(a.verifyOptions(e,"idClient","msg::Message"),this.idClient=e.idClient):this.idClient=a.guid(),this.type=p[e.type],this.resend=e.resend?1:0,c(e.subType)&&(a.isInt(+e.subType)&&+e.subType>0?this.subType=+e.subType:a.onParamError("subType只能是大于0的整数","msg::Message")),c(e.custom)&&("object"===o(e.custom)?this.custom=n(e.custom):this.custom=""+e.custom),c(e.text)&&(this.body=""+e.text),c(e.body)&&(this.body=""+e.body),c(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),c(e.antiSpamUsingYidun)&&(this.antiSpamUsingYidun=e.antiSpamUsingYidun?1:0),c(e.antiSpamContent)&&("object"===o(e.antiSpamContent)?this.antiSpamContent=n(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),c(e.antiSpamBusinessId)&&("object"===o(e.antiSpamBusinessId)?this.antiSpamBusinessId=n(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId),c(e.yidunAntiCheating)&&(this.yidunAntiCheating=e.yidunAntiCheating+""),c(e.skipHistory)&&(this.skipHistory=e.skipHistory?1:0),c(e.highPriority)&&(this.highPriority=e.highPriority?1:0),c(e.clientAntiSpam)&&(this.clientAntiSpam=e.clientAntiSpam?1:0),c(e.env)&&(this.env=e.env),c(e.notifyTargetTags)&&(this.notifyTargetTags=e.notifyTargetTags),c(e.yidunAntiSpamExt)&&(this.yidunAntiSpamExt=e.yidunAntiSpamExt),(c(e.loc_x)||c(e.loc_y)||c(e.loc_z))&&(this.loc_x=e.loc_x,this.loc_y=e.loc_y,this.loc_z=e.loc_z)}m.validTypes=d.validTypes,a.merge(m.prototype,d.prototype),m.getType=d.getType,m.reverse=function(e){var t=a.filterObj(e,"chatroomId idClient from fromNick fromAvatar _fromAvatar_safe fromCustom userUpdateTime custom status notifyTargetTags");return c(t.fromAvatar)&&(t.fromAvatar=s(t.fromAvatar)),t=a.merge(t,{fromClientType:l.reverseType(e.fromClientType),time:+e.time,type:m.getType(e),text:u(e.body)?e.body:e.text||"",resend:1==+e.resend}),c(t.userUpdateTime)&&(t.userUpdateTime=+t.userUpdateTime),c(e.callbackExt)&&(t.callbackExt=e.callbackExt),c(e.subType)&&(t.subType=+e.subType),c(e.yidunAntiSpamRes)&&(t.yidunAntiSpamRes=e.yidunAntiSpamRes),c(e.loc_x)&&(t.x=i(e.loc_x),t.y=i(e.loc_y),t.z=i(e.loc_z)),c(e.toAccids)&&(t.toAccids=e.toAccids),t.status=t.status||"success",t},m.setExtra=function(e,t){d.setFlow(e,t)},e.exports=m},function(e,t,r){var n=r(160),i=r(132);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=r(40),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},function(e,t,r){e.exports=r(183)},function(e,t,r){e.exports=r(162)},function(e,t,r){var n=r(1),i=r(7),o=r(9),s=r(66),a=n.Object,c=i("".split);e.exports=o((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"==s(e)?c(e,""):a(e)}:a},function(e,t,r){var n=r(230),i=r(120);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},function(e,t,r){var n=r(1).String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},function(e,t,r){var n=r(85),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},function(e,t,r){var n=r(7),i=r(9),o=r(21),s=r(46),a=r(37),c=r(130),u=function(){},l=[],d=a("Reflect","construct"),p=/^\s*(?:class|function)\b/,m=n(p.exec),f=!p.exec(u),h=function(e){if(!o(e))return!1;try{return d(u,l,e),!0}catch(e){return!1}},g=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!m(p,c(e))}catch(e){return!0}};g.sham=!0,e.exports=!d||i((function(){var e;return h(h.call)||!h(Object)||!h((function(){e=!0}))||e}))?g:h},function(e,t){e.exports={}},function(e,t,r){var n=r(123),i=r(125),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t,r){var n,i,o,s=r(245),a=r(1),c=r(7),u=r(28),l=r(45),d=r(25),p=r(124),m=r(102),f=r(101),h=a.TypeError,g=a.WeakMap;if(s||p.state){var v=p.state||(p.state=new g),y=c(v.get),b=c(v.has),S=c(v.set);n=function(e,t){if(b(v,e))throw new h("Object already initialized");return t.facade=e,S(v,e,t),t},i=function(e){return y(v,e)||{}},o=function(e){return b(v,e)}}else{var T=m("state");f[T]=!0,n=function(e,t){if(d(e,T))throw new h("Object already initialized");return t.facade=e,l(e,T,t),t},i=function(e){return d(e,T)?e[T]:{}},o=function(e){return d(e,T)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw h("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(1),i=r(25),o=r(21),s=r(33),a=r(102),c=r(170),u=a("IE_PROTO"),l=n.Object,d=l.prototype;e.exports=c?l.getPrototypeOf:function(e){var t=s(e);if(i(t,u))return t[u];var r=t.constructor;return o(r)&&t instanceof r?r.prototype:t instanceof l?d:null}},function(e,t,r){var n=r(277).charAt,i=r(43),o=r(103),s=r(167),a=o.set,c=o.getterFor("String Iterator");s(String,"String",(function(e){a(this,{type:"String Iterator",string:i(e),index:0})}),(function(){var e,t=c(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(1),i=r(68),o=r(31),s=r(34),a=r(98),c=r(173),u=r(38),l=r(16),d=r(174),p=r(107),m=r(175),f=n.TypeError,h=function(e,t){this.stopped=e,this.result=t},g=h.prototype;e.exports=function(e,t,r){var n,v,y,b,S,T,_,w=r&&r.that,M=!(!r||!r.AS_ENTRIES),x=!(!r||!r.IS_ITERATOR),E=!(!r||!r.INTERRUPTED),C=i(t,w),R=function(e){return n&&m(n,"normal",e),new h(!0,e)},k=function(e){return M?(s(e),E?C(e[0],e[1],R):C(e[0],e[1])):E?C(e,R):C(e)};if(x)n=e;else{if(!(v=p(e)))throw f(a(e)+" is not iterable");if(c(v)){for(y=0,b=u(e);b>y;y++)if((S=k(e[y]))&&l(g,S))return S;return new h(!1)}n=d(e,v)}for(T=n.next;!(_=o(T,n)).done;){try{S=k(_.value)}catch(e){m(n,"throw",e)}if("object"==typeof S&&S&&l(g,S))return S}return new h(!1)}},function(e,t,r){var n=r(46),i=r(122),o=r(74),s=r(18)("iterator");e.exports=function(e){if(null!=e)return i(e,s)||i(e,"@@iterator")||o[n(e)]}},function(e,t,r){var n=r(66),i=r(1);e.exports="process"==n(i.process)},function(e,t,r){e.exports=r(343)},function(e,t,r){e.exports=r(363)},function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(e,t,r){var n=r(23),i=r(47),o=r(430),s=r(432),a=r(434),c={},u=i.f;function l(e){var t=e.upload="multipart/form-data"===(e.headers||i.o)["Content-Type"],r=!1;try{r=(location.protocol+"//"+location.host).toLowerCase()!==i.url2origin(e.url)}catch(e){}return e.cors=r,t||r||e.mode?function(e){var t=e.mode,r=o,n=i.getGlobal();return!n.FormData&&n.document&&(t="iframe"),"iframe"===t&&(r=e.upload?s:a),new r(e)}(e):new o(e)}function d(e,t,r){var n=c[e];if(n){"onload"===t&&n.result&&(r=function(e,t){t={data:t};var r=e.result.headers;return r&&(t.headers=e.req.header(r)),t}(n,r)),function(e){var t=c[e];t&&(t.req.destroy(),delete c[e])}(e);var i={type:t,result:r};u(i),i.stopped||n[t](i.result)}}function p(e,t){d(e,"onload",t)}function m(e,t){d(e,"onerror",t)}function f(e,t){var r=i.genUrlSep(e);return t=t||"",i.isObject(t)&&(t=i.object2query(t)),t&&(e+=r+t),e}function h(e,t){t=t||{};var r=i.uniqueID(),o={result:t.result,onload:t.onload||i.f,onerror:t.onerror||i.f};c[r]=o,t.onload=n(p).call(p,null,r),t.onerror=n(m).call(m,null,r),t.query&&(e=f(e,t.query));var s=t.method||"";return s&&!/get/i.test(s)||!t.data||(e=f(e,t.data),t.data=null),t.url=e,o.req=l(t),r}h.filter=function(e){i.isFunction(e)&&(u=e)},h.abort=function(e){var t=c[e];t&&t.req&&t.req.abort()},e.exports=h},function(e,t,r){var n,i=r(15),o=r(3),s=r(8),a=r(4),c=r(13),u=r(6),l=r(23),d=r(11),p=r(82).urlQuery2Object,m=r(0),f=r(36),h=r(466),g=r(467),v=r(468),y=r(469),b=r(470),S=r(471);function T(e){this.mixin(e)}T.prototype=i(function(){}.prototype,{protocol:{value:null,writable:!0,enumerable:!0,configurable:!0}}),T.prototype.setProtocol=function(e){this.protocol=e},T.prototype.mixin=function(e){var t,r,n=this;this.configMap=this.configMap||{},o(t=["idMap","cmdConfig","packetConfig"]).call(t,(function(t){n.configMap[t]=m.merge({},n.configMap[t],e.configMap&&e.configMap[t])})),o(r=["serializeMap","unserializeMap"]).call(r,(function(t){n[t]=m.merge({},n[t],e[t])}))},T.prototype.createCmd=(n=1,function(e,t){var r,i=this,a=this.configMap.cmdConfig[e],c="heartbeat"===e?0:n++;return c>32767&&(c=1,n=2),e={SID:a.sid,CID:a.cid,SER:c},a.params&&(e.Q=[],o(r=a.params).call(r,(function(r){var n=r.type,o=r.name,a=r.entity,c=t[o];if(!m.undef(c)){switch(n){case"PropertyArray":n="ArrayMable",c=s(c).call(c,(function(e){return{t:"Property",v:i.serialize(e,a)}}));break;case"Property":c=i.serialize(c,o);break;case"bool":c=c?"true":"false"}e.Q.push({t:n,v:c})}}))),e}),T.prototype.parseResponse=function(e){var t=this;return new a((function(r){var n=JSON.parse(e),i={raw:n,rawStr:e,error:f.genError(n.code)},s=t.configMap.packetConfig[n.sid+"_"+n.cid];if(!s)return i.notFound={sid:n.sid,cid:n.cid},void r(i);var d=n.r,p="notify"===s.service&&!s.cmd;if(i.isNotify=p,p){var h=n.r[1].headerPacket;if(s=t.configMap.packetConfig[h.sid+"_"+h.cid],d=n.r[1].body,!s)return i.notFound={sid:h.sid,cid:h.cid},void r(i)}if(i.service=s.service,i.cmd=s.cmd,i.error){var g,v,y=c(g="".concat(n.sid,"_")).call(g,n.cid);if(p&&(y=c(v="".concat(h.sid,"_")).call(v,h.cid)),i.error.cmd=i.cmd,i.error.callFunc="protocol::parseResponse: ".concat(y),416===i.error.code){var b=d[0];b&&(i.frequencyControlDuration=1e3*b)}}var S,T=!1;i.error&&s.trivialErrorCodes&&(T=-1!==u(S=s.trivialErrorCodes).call(S,i.error.code));var _=[];if((!i.error||T)&&s.response){var w;i.content={};var M=function(e,t,r,n){if(e&&"msg"===n||"sysMsg"===n){var i=r.content[n];m.isObject(i)&&!i.idServer&&(i.idServer=""+t.r[0])}};o(w=s.response).call(w,(function(e,r){var s,a=d[r];if(!m.undef(a)){var c=e.type,u=e.name,f=e.entity||u;switch(c){case"Property":_.push(t.unserialize(a,f).then(l(s=function(e,t,r,n,i){r.content[n]=i,M(e,t,r,n)}).call(s,this,p,n,i,u)));break;case"PropertyArray":i.content[u]=[],o(a).call(a,(function(e,r){var n;_.push(t.unserialize(e,f).then(l(n=function(e,t,n){e.content[t][r]=n}).call(n,this,i,u)))}));break;case"KVArray":default:i.content[u]=a,M(p,n,i,u);break;case"long":case"Long":case"byte":case"Byte":case"Number":i.content[u]=+a}}}))}a.all(_).then((function(){r(i)}))}))},T.prototype.serialize=function(e,t){var r=this.serializeMap[t],n={};for(var i in r)e.hasOwnProperty(i)&&(n[r[i]]=e[i]);return n},T.prototype.matchNosSafeUrl=function(e){if(!m.isString(e)||!~u(e).call(e,"_im_url=1"))return!1;var t=p(e);return!(!t||!t._im_url||1!=t._im_url)},T.prototype.getOneNosOriginUrl=function(e,t,r){var n=this;return new a((function(i){n.protocol.getNosOriginUrlReqNum++,n.protocol.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e}},(function(e,o,s){n.protocol.getNosOriginUrlReqNum--,e?n.protocol.logger.warn("error: get nos originUrl failed",e):(t["_"+r+"_safe"]=t[r],t[r]=s.nosFileUrlTag&&s.nosFileUrlTag.originUrl),i()}))}))},T.prototype.checkObjSafeUrl=function(e,t,r){var n=this;for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];if(m.isString(s)){if(this.matchNosSafeUrl(s)){var a=this.getOneNosOriginUrl(s,e,i);t.push(a),r.push(a)}}else m.isObject(s)?this.checkObjSafeUrl(s,t,r):m.isArray(s)&&o(s).call(s,(function(e){m.isObject(e)&&n.checkObjSafeUrl(e,t,r)}))}};var _=["url","avatar","fromAvatar","chatroomAvatar"];T.prototype.unserialize=function(e,t){var r=this;return new a((function(n){var i=r.unserializeMap[t],o={},s=[];if(e)for(var c in i){var p,m=[];if(e.hasOwnProperty(c)&&(o[i[c]]=e[c],r.protocol.hasLogin&&!r.protocol.keepNosSafeUrl))if("attach"===i[c]&&e[c]&&u(e[c])&&~u(p=e[c]).call(p,"_im_url=1"))try{var f,h=JSON.parse(e[c]);h.isS3||r.checkObjSafeUrl(h,m,s),a.all(m).then(l(f=function(e,t){e.attach=d(t)}).call(f,r,o,h))}catch(e){r.logger.warn("unserialize",e&&e.message)}else~u(_).call(_,i[c])&&e[c]&&r.matchNosSafeUrl(e[c])&&s.push(r.getOneNosOriginUrl(e[c],o,i[c]))}a.all(s).then((function(){n(o)}))}))},T.prototype.syncUnserialize=function(e,t){var r=this.unserializeMap[t],n={};if(e)for(var i in r)e.hasOwnProperty(i)&&(n[r[i]]=e[i]);return n};var w=new T({configMap:h,serializeMap:g,unserializeMap:v}),M=new T({configMap:y,serializeMap:b,unserializeMap:S});e.exports={IM:w,Chatroom:M}},function(e,t,r){var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!n.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,r){e.exports=r(335)},,,function(e,t,r){e.exports=r(433)},function(e,t,r){var n=r(1),i=r(37),o=r(21),s=r(16),a=r(155),c=n.Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return o(t)&&s(t.prototype,c(e))}},function(e,t,r){var n=r(67),i=r(9);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(e,t,r){var n=r(40);e.exports=function(e,t){var r=e[t];return null==r?void 0:n(r)}},function(e,t,r){var n=r(55),i=r(124);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.21.1",mode:n?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(e,t,r){var n=r(1),i=r(232),o=n["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,r){var n=r(7),i=0,o=Math.random(),s=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},function(e,t,r){var n=r(1),i=r(28),o=n.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},function(e,t,r){var n=r(35),i=r(99),o=r(38),s=function(e){return function(t,r,s){var a,c=n(t),u=o(c),l=i(s,u);if(e&&r!=r){for(;u>l;)if((a=c[l++])!=a)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},function(e,t,r){var n=r(237);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},function(e,t,r){var n={};n[r(18)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){var n=r(7),i=r(21),o=r(124),s=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},function(e,t,r){var n=r(24),i=r(158),o=r(41),s=r(34),a=r(35),c=r(92);t.f=n&&!i?Object.defineProperties:function(e,t){s(e);for(var r,n=a(t),i=c(t),u=i.length,l=0;u>l;)o.f(e,r=i[l++],n[r]);return e}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){var n=r(160),i=r(132).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(18);t.f=n},function(e,t,r){var n=r(7),i=r(34),o=r(263);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),t?e(r,n):r.__proto__=n,r}}():void 0)},function(e,t,r){var n=r(7),i=r(84),o=r(43),s=r(111),a=n("".replace),c="["+s+"]",u=RegExp("^"+c+c+"*"),l=RegExp(c+c+"*$"),d=function(e){return function(t){var r=o(i(t));return 1&e&&(r=a(r,u,"")),2&e&&(r=a(r,l,"")),r}};e.exports={start:d(1),end:d(2),trim:d(3)}},function(e,t,r){var n=r(15),i=r(26),o=r(6),s=r(3),a=r(47),c=a.f,u=r(431);function l(e){e.onload&&this.once("load",e.onload),e.onerror&&this.once("error",e.onerror),e.onbeforesend&&this.once("beforesend",e.onbeforesend),e.onaftersend&&this.once("aftersend",e.onaftersend);var t=(e=this.options=a.fetch({method:"GET",url:"",sync:!1,data:null,headers:{},cookie:!1,timeout:6e4,type:"text",form:null,input:null,putFileAtEnd:!1,proxyUrl:""},e)).headers;a.notexist(t["Content-Type"])&&(t["Content-Type"]="application/x-www-form-urlencoded"),this.send()}var d=l.prototype=n(u.prototype);d.send=function(){var e=this,t=e.options;i((function(){try{try{e.emit("beforesend",t)}catch(e){}e.doSend()}catch(t){e.onError("serverError","请求失败:"+t.message)}}),0)},d.doSend=c,d.afterSend=function(){var e=this;i((function(){e.emit("aftersend",e.options)}),0)},d.onLoad=function(e){var t,r=this.options,n=e.status,i=e.result;if("number"!=typeof n||0!==n)if(0===o(t=""+n).call(t,"2")){if("json"===r.type)try{i=JSON.parse(i)}catch(e){return void this.onError("parseError",i)}this.emit("load",i)}else this.onError("serverError","服务器返回异常状态",{status:n,result:i,date:e.date});else this.onError("netError","网络错误")},d.onError=function(e,t,r){var n=a.isObject(r)?r:{};n.code=e||"error",n.message=t||"发生错误",this.emit("error",n)},d.onTimeout=function(){this.onError("timeout","请求超时")},d.abort=function(){this.onError("abort","客户端中止")},d.header=function(e){var t=this;if(!a.isArray(e))return t.getResponseHeader(e||"");var r={};return s(e).call(e,(function(e){r[e]=t.header(e)})),r},d.getResponseHeader=c,d.destroy=c,e.exports=l},function(e,t){var r={link:{id:1,heartbeat:2,negotiateTransport:5,initTransport:6},sync:{id:5,sync:1,syncTeamMembers:2},misc:{id:6,getSimpleNosToken:1,getNosToken:2,notifyUploadLog:3,uploadSdkLogUrl:4,audioToText:5,processImage:6,getNosTokenTrans:7,notifyTransLog:8,fetchFile:9,fetchFileList:10,removeFile:11,getClientAntispam:17,fileQuickTransfer:18,getNosOriginUrl:22,getServerTime:23,getNosAccessToken:24,deleteNosAccessToken:25,getNosCdnHost:26,getGrayscaleConfig:27,getMixStorePolicy:28,getMixStoreToken:29,getBackSourceToken:30,uploadDetect:32},avSignal:{id:15,signalingCreate:1,signalingDelay:2,signalingClose:3,signalingJoin:4,signalingLeave:5,signalingInvite:6,signalingCancel:7,signalingReject:8,signalingAccept:9,signalingControl:10,signalingNotify:11,signalingMutilClientSyncNotify:12,signalingUnreadMessageSyncNotify:13,signalingChannelsSyncNotify:14,signalingGetChannelInfo:15,signalingCallEx:16,signalingJoinAndAccept:17}},n={heartbeat:{sid:r.link.id,cid:r.link.heartbeat},negotiateTransport:{sid:r.link.id,cid:r.link.negotiateTransport,params:[{type:"int",name:"sdkVersion"},{type:"Property",name:"negotiateTransportTag"}]},initTransport:{sid:r.link.id,cid:r.link.initTransport,params:[{type:"Property",name:"initTransportTag"}]},getGrayscaleConfig:{sid:r.misc.id,cid:r.misc.getGrayscaleConfig,params:[{type:"Property",name:"providers"}]},getMixStorePolicy:{sid:r.misc.id,cid:r.misc.getMixStorePolicy,params:[{type:"LongArray",name:"providers"}]},getMixStoreToken:{sid:r.misc.id,cid:r.misc.getMixStoreToken,params:[{type:"Property",name:"mixTokenReq"}]},getBackSourceToken:{sid:r.misc.id,cid:r.misc.getBackSourceToken,params:[{type:"Property",name:"mixAuthTokenReq"}]},uploadDetect:{sid:r.misc.id,cid:r.misc.uploadDetect,params:[{type:"Property",name:"notifyDetectTag"}]},getSimpleNosToken:{sid:r.misc.id,cid:r.misc.getSimpleNosToken,params:[{type:"int",name:"num"}]},getNosToken:{sid:r.misc.id,cid:r.misc.getNosToken,params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken"}]},uploadSdkLogUrl:{sid:r.misc.id,cid:r.misc.uploadSdkLogUrl,params:[{type:"string",name:"url"}]},audioToText:{sid:r.misc.id,cid:r.misc.audioToText,params:[{type:"Property",name:"audioToText"}]},processImage:{sid:r.misc.id,cid:r.misc.processImage,params:[{type:"String",name:"url"},{type:"PropertyArray",name:"imageOps",entity:"imageOp"}]},getClientAntispam:{sid:r.misc.id,cid:r.misc.getClientAntispam,params:[{type:"Property",name:"clientAntispam"}]},fileQuickTransfer:{sid:r.misc.id,cid:r.misc.fileQuickTransfer,params:[{type:"Property",name:"fileQuickTransfer"}]},getNosOriginUrl:{sid:r.misc.id,cid:r.misc.getNosOriginUrl,params:[{type:"Property",name:"nosFileUrlTag"}]},getServerTime:{sid:r.misc.id,cid:r.misc.getServerTime,params:[]},getNosAccessToken:{sid:r.misc.id,cid:r.misc.getNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},deleteNosAccessToken:{sid:r.misc.id,cid:r.misc.deleteNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},getNosTokenTrans:{sid:r.misc.id,cid:r.misc.getNosTokenTrans,params:[{type:"Property",name:"transToken"}]},fetchFile:{sid:r.misc.id,cid:r.misc.fetchFile,params:[{type:"String",name:"docId"}]},fetchFileList:{sid:r.misc.id,cid:r.misc.fetchFileList,params:[{type:"Property",name:"fileListParam"}]},removeFile:{sid:r.misc.id,cid:r.misc.removeFile,params:[{type:"String",name:"docId"}]},getNosCdnHost:{sid:r.misc.id,cid:r.misc.getNosCdnHost,params:[]},signalingCreate:{sid:r.avSignal.id,cid:r.avSignal.signalingCreate,params:[{type:"Property",name:"avSignalTag"}]},signalingDelay:{sid:r.avSignal.id,cid:r.avSignal.signalingDelay,params:[{type:"Property",name:"avSignalTag"}]},signalingClose:{sid:r.avSignal.id,cid:r.avSignal.signalingClose,params:[{type:"Property",name:"avSignalTag"}]},signalingJoin:{sid:r.avSignal.id,cid:r.avSignal.signalingJoin,params:[{type:"Property",name:"avSignalTag"}]},signalingLeave:{sid:r.avSignal.id,cid:r.avSignal.signalingLeave,params:[{type:"Property",name:"avSignalTag"}]},signalingInvite:{sid:r.avSignal.id,cid:r.avSignal.signalingInvite,params:[{type:"Property",name:"avSignalTag"}]},signalingCancel:{sid:r.avSignal.id,cid:r.avSignal.signalingCancel,params:[{type:"Property",name:"avSignalTag"}]},signalingReject:{sid:r.avSignal.id,cid:r.avSignal.signalingReject,params:[{type:"Property",name:"avSignalTag"}]},signalingAccept:{sid:r.avSignal.id,cid:r.avSignal.signalingAccept,params:[{type:"Property",name:"avSignalTag"}]},signalingControl:{sid:r.avSignal.id,cid:r.avSignal.signalingControl,params:[{type:"Property",name:"avSignalTag"}]},signalingGetChannelInfo:{sid:r.avSignal.id,cid:r.avSignal.signalingGetChannelInfo,params:[{type:"Property",name:"avSignalTag"}]},signalingCallEx:{sid:r.avSignal.id,cid:r.avSignal.signalingCallEx,params:[{type:"Property",name:"avSignalTag"}]},signalingJoinAndAccept:{sid:r.avSignal.id,cid:r.avSignal.signalingJoinAndAccept,params:[{type:"Property",name:"avSignalTag"}]}};e.exports={idMap:r,cmdConfig:n,packetConfig:{"1_2":{service:"link",cmd:"heartbeat"},"1_5":{service:"link",cmd:"negotiateTransport",response:[{type:"Property",name:"negotiateTransportTag"}]},"1_6":{service:"link",cmd:"initTransport",response:[{type:"Property",name:"initTransportTag"}]},"6_1":{service:"misc",cmd:"getSimpleNosToken",response:[{type:"PropertyArray",name:"nosTokens",entity:"nosToken"}]},"6_2":{service:"misc",cmd:"getNosToken",response:[{type:"Property",name:"nosToken"}]},"6_3":{service:"misc",cmd:"notifyUploadLog"},"6_4":{service:"misc",cmd:"uploadSdkLogUrl"},"6_5":{service:"misc",cmd:"audioToText",response:[{type:"String",name:"text"}]},"6_6":{service:"misc",cmd:"processImage",response:[{type:"String",name:"url"}]},"6_7":{service:"misc",cmd:"getNosTokenTrans",response:[{type:"Property",name:"nosToken"},{type:"String",name:"docId"}]},"6_8":{service:"misc",cmd:"notifyTransLog",response:[{type:"Property",name:"transInfo"}]},"6_9":{service:"misc",cmd:"fetchFile",response:[{type:"Property",name:"info",entity:"transInfo"}]},"6_10":{service:"misc",cmd:"fetchFileList",response:[{type:"PropertyArray",name:"list",entity:"transInfo"},{type:"Number",name:"totalCount"}]},"6_11":{service:"misc",cmd:"removeFile",response:[{type:"String",name:"res"}]},"6_17":{service:"misc",cmd:"getClientAntispam",response:[{type:"Property",name:"clientAntispam"}]},"6_18":{service:"misc",cmd:"fileQuickTransfer",response:[{type:"Property",name:"fileQuickTransfer"}]},"6_22":{service:"misc",cmd:"getNosOriginUrl",response:[{type:"Property",name:"nosFileUrlTag"}]},"6_23":{service:"misc",cmd:"getServerTime",response:[{type:"Number",name:"time"}]},"6_24":{service:"misc",cmd:"getNosAccessToken",response:[{type:"Property",name:"nosAccessTokenTag"}]},"6_25":{service:"misc",cmd:"deleteNosAccessToken"},"6_26":{service:"misc",cmd:"getNosCdnHost",response:[{type:"Property",name:"nosConfigTag"}]},"6_27":{service:"misc",cmd:"getGrayscaleConfig",response:[{type:"Property",name:"appGrayConfigTag"}]},"6_28":{service:"misc",cmd:"getMixStorePolicy",response:[{type:"Property",name:"mixStorePolicyTag"}]},"6_29":{service:"misc",cmd:"getMixStoreToken",response:[{type:"Property",name:"mixStoreTokenTag"}]},"6_30":{service:"misc",cmd:"getBackSourceToken",response:[{type:"Property",name:"backSourceTokenTag"}]},"6_31":{service:"link",cmd:"notifyDetect",response:[{type:"Property",name:"notifyDetectTag"}]},"15_1":{service:"avSignal",cmd:"signalingCreate",response:[{type:"Property",name:"avSignalTag"}]},"15_2":{service:"avSignal",cmd:"signalingDelay",response:[{type:"Property",name:"avSignalTag"}]},"15_3":{service:"avSignal",cmd:"signalingClose",response:[{type:"Property",name:"avSignalTag"}]},"15_4":{service:"avSignal",cmd:"signalingJoin",response:[{type:"Property",name:"avSignalTag"}]},"15_5":{service:"avSignal",cmd:"signalingLeave",response:[]},"15_6":{service:"avSignal",cmd:"signalingInvite",response:[]},"15_7":{service:"avSignal",cmd:"signalingCancel",response:[]},"15_8":{service:"avSignal",cmd:"signalingReject",response:[]},"15_9":{service:"avSignal",cmd:"signalingAccept",response:[]},"15_10":{service:"avSignal",cmd:"signalingControl",response:[]},"15_11":{service:"avSignal",cmd:"signalingNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_12":{service:"avSignal",cmd:"signalingMutilClientSyncNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_13":{service:"avSignal",cmd:"signalingUnreadMessageSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_14":{service:"avSignal",cmd:"signalingChannelsSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_15":{service:"avSignal",cmd:"signalingGetChannelInfo",response:[{type:"Property",name:"avSignalTag"}]},"15_16":{service:"avSignal",cmd:"signalingCallEx",response:[{type:"Property",name:"avSignalTag"}]},"15_17":{service:"avSignal",cmd:"signalingJoinAndAccept",response:[{type:"Property",name:"avSignalTag"}]}}}},,function(e,t,r){var n=r(39).clientTypeMap;function i(){}i.reverse=function(e){var t=e;return t.type=n[t.type],t},i.reverseType=function(e){return n[e]||e},e.exports=i},,function(e,t,r){var n=r(15),i=r(42),o=r(11),s=r(52),a=r(144),c=r(14),u=r(488),l=r(609),d=r(0),p=d.verifyOptions,m=d.verifyParamType,f=r(113).Chatroom;function h(e){return this.subType="chatroom",this.nosScene=e.nosScene||"chatroom",this.nosSurvivalTime=e.nosSurvivalTime,e.Protocol=a,e.Message=l,e.constructor=h,e.isAnonymous&&(e.account=e.account||"nimanon_".concat(d.guid()),e.isAnonymous=1,d.verifyOptions(e,"chatroomNick","api::Chatroom"),e.chatroomAvatar=e.chatroomAvatar||" "),this.init(e)}h.Protocol=a,h.parser=f,h.use=s.use,h.getInstance=function(e){return e.isAnonymous&&(e.account=e.account||"nimanon_".concat(d.guid()),e.isAnonymous=1,d.verifyOptions(e,"chatroomNick","api::Chatroom.getInstance"),e.chatroomAvatar=e.chatroomAvatar||" "),s.getInstance.call(this,e)},h.genInstanceName=function(e){return d.verifyOptions(e,"chatroomId","api::Chatroom.genInstanceName"),"Chatroom-account-"+e.account+"-chatroomId-"+e.chatroomId};var g=h.fn=h.prototype=n(s.prototype);h.info=g.info=c.info,g.getChatroom=function(e){this.processCallback(e),this.sendCmd("getChatroom",e)},g.updateChatroom=function(e){p(e,"chatroom needNotify","api::updateChatroom"),m("needNotify",e.needNotify,"boolean"),this.processCustom(e),this.processCallback(e),e.chatroom=new u(e.chatroom),e.antispamTag={antiSpamBusinessId:e.antiSpamBusinessId},this.sendCmd("updateChatroom",e)},g.closeChatroom=function(e){this.processCustom(e),this.processCallback(e),this.sendCmd("closeChatroom",e)},g.updateTags=function(e){d.validate({tags:{type:"array",required:!1},notifyTargetTags:{type:"string",allowEmpty:!0,required:!1},needNotify:{type:"boolean",required:!1}},e,"chatroom::updateTags");var t=i({},e);this.processCallback(t),t.tags&&(t.tags=o(t.tags)),t.needNotify&&(t.needNotify=t.needNotify?1:0),this.sendCmd("updateChatroomTags",{chatRoomTagsUpdateTag:t},t.done)},e.exports=h,r(619),r(620),r(621),r(622)},function(e,t,r){var n=r(15),i=r(23),o=r(8),s=r(17),a=r(4),c=r(5),u=r(79),l=r(63),d=r(0),p=d.undef,m=d.notundef,f=r(14),h=r(113),g=r(488),v=r(222);function y(e){d.verifyOptions(e,"appKey account chatroomId chatroomAddresses","protocol::ChatroomProtocol"),e.isAnonymous||d.verifyOptions(e,"token","protocol::ChatroomProtocol"),d.verifyParamType("chatroomAddresses",e.chatroomAddresses,"array","protocol::ChatroomProtocol"),d.verifyCallback(e,"onconnect onerror onwillreconnect ondisconnect onmsg onmsgs onrobots","protocol::ChatroomProtocol"),l.call(this,e)}var b=l.fn,S=y.fn=y.prototype=n(b);function T(e){var t=this,r=e.error;if(398===r.code)return this.logger.warn("pendingLoginFailed:398 try to reconnect socket link，backoff set min 5s"),t.forceDisconnect(),t.backoff.setMin(5e3),void(0===t.retryCount?t.refreshSocketUrl():a.resolve()).then((function(){var e;t.reconnect({allFailedCB:i(e=function(e){this.logger.error("pendingLoginFailed: ",e.code,e),this.onAuthError(e,"link::onLoginReconnectFailed")}).call(e,t,r)})}));this.logger.error("pendingLoginFailed: ",r.code,r),t.onAuthError(r,"link::onLogin")}function _(e){var t=this,r=e.error,n=e.obj;if(t.loginResult=n,r)T.call(t,e);else{if(t.resetReconnectStatus(),this.heartbeatFail=0,this.hasLogin=!0,this.autoconnect=!0,t.startHeartbeat(),t.keepNosSafeUrl)t.afterLogin(n);else{var i=[];t.parser.checkObjSafeUrl(n,i,[]),a.all(i).then((function(){t.afterLogin(n)})).catch((function(){t.afterLogin(n)}))}t.initOnlineListener()}}S.init=function(){var e;b.init.call(this),h.Chatroom.setProtocol(this),this.parser=h.Chatroom,i(e=this.sendCmd).call(e,this),this.syncResult={},this.timetags={},this.msgBuffer=[]},S.reset=function(){var e=this;b.reset.call(e);var t,r,n=e.options;p(n.msgBufferInterval)&&(n.msgBufferInterval=300),d.verifyParamType("msgBufferInterval",n.msgBufferInterval,"number","protocol::ChatroomProtocol.reset"),p(n.msgBufferSize)&&(n.msgBufferSize=500),d.verifyParamType("msgBufferSize",n.msgBufferSize,"number","protocol::ChatroomProtocol.reset"),m(n.chatroomAddresses)&&(e.socketUrls=o(t=n.chatroomAddresses).call(t,(function(t){return f.formatSocketUrl({url:t,secure:e.options.secure})})),e.socketUrlsBackup=s(r=e.socketUrls).call(r,0))},S.processChatroom=function(e){switch(e.cmd){case"login":e.error||(e.obj={chatroom:c(g).call(g,e.content.chatroom),member:c(v).call(v,e.content.chatroomMember)},this.cdnInfo={},this.initCdnData(),clearTimeout(this.queryCdnTimer),this.onCdnMsgInfo(e.content.chatroomCdnInfo)),f.isBrowser&&this.reporter.report("chatroomLogin",{accid:this.account,roomId:this.options&&this.options.chatroomId,serverIps:this.options&&this.options.chatroomAddresses&&this.options.chatroomAddresses.join(","),currentServerIp:this.url,rt:u()-this.createLoginTime,result:e.error?e.error.code:200,failReason:e.error?e.error.message:"",time:u()}),_.call(this,e);break;case"kicked":this.onKicked(e);break;case"logout":case"closeChatroom":case"updateChatroom":case"kickChatroomMember":case"updateChatroomMemberTempMute":break;case"sendMsg":this.onSendMsg(e);break;case"msg":this.onMsg(e),this.cdnInfo&&this.cdnInfo.enable&&this.correctCdnTime(+e.content.msg.time);break;case"getChatroomMembers":case"getChatroomMembersByTag":this.onChatroomMembers(e);break;case"getChatroomMemberCountByTag":this.onGetChatroomMemberCountByTag(e);break;case"getHistoryMsgs":case"getHistoryMsgsByTags":this.onHistoryMsgs(e);break;case"markChatroomMember":this.onMarkChatroomMember(e);break;case"getChatroom":this.onChatroom(e);break;case"updateMyChatroomMemberInfo":delete e.obj.chatroomMember;break;case"getChatroomMembersInfo":this.onChatroomMembersInfo(e);break;case"queueList":e.error||(e.obj=e.content);break;case"syncRobot":this.onSyncRobot(e);break;case"notifyCdnInfo":this.onCdnMsgInfo(e.content&&e.content.chatroomCdnInfo);break;case"updateChatroomTag":this.onTagsUpdate(e.content)}},S.onChatroom=function(e){e.error||(e.obj.chatroom=c(g).call(g,e.content.chatroom))},S.onTagsUpdate=function(e){if(this.logger.info("onTagsUpdate:: ",e),this.options.onTagsUpdate&&"function"==typeof this.options.onTagsUpdate){var t=e.updateTags&&e.updateTags.currentTags;try{t=JSON.parse(t)}catch(e){this.logger.error("onTagsUpdate:: parse tags failed",e)}this.options.onTagsUpdate(t)}},e.exports=y,r(597),r(598),r(599),r(608)},function(e,t,r){e.exports=r(241)},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){for(var r=t.split(".");r.length;){var n=r.shift(),i=!1;if("?"==n[n.length-1]&&(n=n.slice(0,-1),i=!0),!(e=e[n])&&i)return e}return e}},function(e,t,r){e.exports=r(358)},function(e,t,r){var n=r(419),i=r(192),o=r(424);e.exports=function(e,t){if(null==e)return{};var r,s,a=o(e,t);if(n){var c=n(e);for(s=0;s<c.length;s++)r=c[s],i(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a},e.exports.default=e.exports,e.exports.__esModule=!0},,,,function(e,t,r){var n=r(11),i=r(15),o=r(5),s=r(6),a=r(82).genPrivateUrl,c=r(91),u=r(0),l=r(14);function d(e){switch(u.notundef(e.type)?u.verifyFileType(e.type,"msg::FileMessage"):e.type="file",u.verifyOptions(e,"file","msg::FileMessage"),u.verifyOptions(e.file,"url ext size",!0,"file.","msg::FileMessage"),e.type){case"image":p.verifyFile(e.file,"msg::FileMessage");break;case"audio":m.verifyFile(e.file,"msg::FileMessage");break;case"video":f.verifyFile(e.file,"msg::FileMessage")}c.call(this,e),this.attach=n(e.file)}d.prototype=i(c.prototype),d.reverse=function(e){var t,r,n=o(c).call(c,e);(e.attach=e.attach?""+e.attach:"",e.attach&&(n.file=JSON.parse(e.attach),!n.file.isS3))&&(n.file.url=a(n.file.url)||"","audio"===n.type&&n.file.url&&!n.file.mp3Url&&(n.file.mp3Url=n.file.url+(~s(r=n.file.url).call(r,"?")?"&":"?")+"audioTrans&type=mp3"),l.httpsEnabled&&0!==s(t=n.file.url).call(t,"https://")&&(n.file.url=n.file.url.replace("http","https")));return n},e.exports=d;var p=r(611),m=r(612),f=r(613)},function(e,t,r){var n=r(227);e.exports=n},function(e,t,r){var n=r(121);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n=r(24),i=r(9),o=r(126);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(9),i=r(21),o=/#|\.prototype\./,s=function(e,t){var r=c[a(e)];return r==l||r!=u&&(i(t)?n(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=s.data={},u=s.NATIVE="N",l=s.POLYFILL="P";e.exports=s},function(e,t,r){var n=r(24),i=r(9);e.exports=n&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(e,t,r){var n=r(2),i=r(1),o=r(9),s=r(70),a=r(28),c=r(33),u=r(38),l=r(71),d=r(128),p=r(86),m=r(18),f=r(67),h=m("isConcatSpreadable"),g=i.TypeError,v=f>=51||!o((function(){var e=[];return e[h]=!1,e.concat()[0]!==e})),y=p("concat"),b=function(e){if(!a(e))return!1;var t=e[h];return void 0!==t?!!t:s(e)};n({target:"Array",proto:!0,forced:!v||!y},{concat:function(e){var t,r,n,i,o,s=c(this),a=d(s,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(b(o=-1===t?s:arguments[t])){if(p+(i=u(o))>9007199254740991)throw g("Maximum allowed index exceeded");for(r=0;r<i;r++,p++)r in o&&l(a,p,o[r])}else{if(p>=9007199254740991)throw g("Maximum allowed index exceeded");l(a,p++,o)}return a.length=p,a}})},function(e,t,r){var n=r(7),i=r(25),o=r(35),s=r(127).indexOf,a=r(101),c=n([].push);e.exports=function(e,t){var r,n=o(e),u=0,l=[];for(r in n)!i(a,r)&&i(n,r)&&c(l,r);for(;t.length>u;)i(n,r=t[u++])&&(~s(l,r)||c(l,r));return l}},function(e,t,r){var n=r(37);e.exports=n("document","documentElement")},function(e,t,r){var n=r(243);r(56),e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(37),s=r(53),a=r(31),c=r(7),u=r(55),l=r(24),d=r(121),p=r(9),m=r(25),f=r(70),h=r(21),g=r(28),v=r(16),y=r(120),b=r(34),S=r(33),T=r(35),_=r(97),w=r(43),M=r(54),x=r(87),E=r(92),C=r(133),R=r(164),k=r(134),A=r(65),I=r(41),O=r(131),P=r(114),N=r(89),D=r(72),L=r(123),j=r(102),U=r(101),F=r(125),$=r(18),B=r(135),V=r(20),H=r(90),W=r(103),q=r(78).forEach,z=j("hidden"),G=$("toPrimitive"),J=W.set,K=W.getterFor("Symbol"),Q=Object.prototype,Y=i.Symbol,X=Y&&Y.prototype,Z=i.TypeError,ee=i.QObject,te=o("JSON","stringify"),re=A.f,ne=I.f,ie=R.f,oe=P.f,se=c([].push),ae=L("symbols"),ce=L("op-symbols"),ue=L("string-to-symbol-registry"),le=L("symbol-to-string-registry"),de=L("wks"),pe=!ee||!ee.prototype||!ee.prototype.findChild,me=l&&p((function(){return 7!=x(ne({},"a",{get:function(){return ne(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=re(Q,t);n&&delete Q[t],ne(e,t,r),n&&e!==Q&&ne(Q,t,n)}:ne,fe=function(e,t){var r=ae[e]=x(X);return J(r,{type:"Symbol",tag:e,description:t}),l||(r.description=t),r},he=function(e,t,r){e===Q&&he(ce,t,r),b(e);var n=_(t);return b(r),m(ae,n)?(r.enumerable?(m(e,z)&&e[z][n]&&(e[z][n]=!1),r=x(r,{enumerable:M(0,!1)})):(m(e,z)||ne(e,z,M(1,{})),e[z][n]=!0),me(e,n,r)):ne(e,n,r)},ge=function(e,t){b(e);var r=T(t),n=E(r).concat(Se(r));return q(n,(function(t){l&&!a(ve,r,t)||he(e,t,r[t])})),e},ve=function(e){var t=_(e),r=a(oe,this,t);return!(this===Q&&m(ae,t)&&!m(ce,t))&&(!(r||!m(this,t)||!m(ae,t)||m(this,z)&&this[z][t])||r)},ye=function(e,t){var r=T(e),n=_(t);if(r!==Q||!m(ae,n)||m(ce,n)){var i=re(r,n);return!i||!m(ae,n)||m(r,z)&&r[z][n]||(i.enumerable=!0),i}},be=function(e){var t=ie(T(e)),r=[];return q(t,(function(e){m(ae,e)||m(U,e)||se(r,e)})),r},Se=function(e){var t=e===Q,r=ie(t?ce:T(e)),n=[];return q(r,(function(e){!m(ae,e)||t&&!m(Q,e)||se(n,ae[e])})),n};if(d||(D(X=(Y=function(){if(v(X,this))throw Z("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?w(arguments[0]):void 0,t=F(e),r=function(e){this===Q&&a(r,ce,e),m(this,z)&&m(this[z],t)&&(this[z][t]=!1),me(this,t,M(1,e))};return l&&pe&&me(Q,t,{configurable:!0,set:r}),fe(t,e)}).prototype,"toString",(function(){return K(this).tag})),D(Y,"withoutSetter",(function(e){return fe(F(e),e)})),P.f=ve,I.f=he,O.f=ge,A.f=ye,C.f=R.f=be,k.f=Se,B.f=function(e){return fe($(e),e)},l&&(ne(X,"description",{configurable:!0,get:function(){return K(this).description}}),u||D(Q,"propertyIsEnumerable",ve,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:Y}),q(E(de),(function(e){V(e)})),n({target:"Symbol",stat:!0,forced:!d},{for:function(e){var t=w(e);if(m(ue,t))return ue[t];var r=Y(t);return ue[t]=r,le[r]=t,r},keyFor:function(e){if(!y(e))throw Z(e+" is not a symbol");if(m(le,e))return le[e]},useSetter:function(){pe=!0},useSimple:function(){pe=!1}}),n({target:"Object",stat:!0,forced:!d,sham:!l},{create:function(e,t){return void 0===t?x(e):ge(x(e),t)},defineProperty:he,defineProperties:ge,getOwnPropertyDescriptor:ye}),n({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:be,getOwnPropertySymbols:Se}),n({target:"Object",stat:!0,forced:p((function(){k.f(1)}))},{getOwnPropertySymbols:function(e){return k.f(S(e))}}),te&&n({target:"JSON",stat:!0,forced:!d||p((function(){var e=Y();return"[null]"!=te([e])||"{}"!=te({a:e})||"{}"!=te(Object(e))}))},{stringify:function(e,t,r){var n=N(arguments),i=t;if((g(t)||void 0!==e)&&!y(e))return f(t)||(t=function(e,t){if(h(i)&&(t=a(i,this,e,t)),!y(t))return t}),n[1]=t,s(te,null,n)}}),!X[G]){var Te=X.valueOf;D(X,G,(function(e){return a(Te,this)}))}H(Y,"Symbol"),U[z]=!0},function(e,t,r){var n=r(66),i=r(35),o=r(133).f,s=r(165),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"==n(e)?function(e){try{return o(e)}catch(e){return s(a)}}(e):o(i(e))}},function(e,t,r){var n=r(1),i=r(99),o=r(38),s=r(71),a=n.Array,c=Math.max;e.exports=function(e,t,r){for(var n=o(e),u=i(t,n),l=i(void 0===r?n:r,n),d=a(c(l-u,0)),p=0;u<l;u++,p++)s(d,p,e[u]);return d.length=p,d}},function(e,t,r){r(20)("iterator")},function(e,t,r){var n=r(2),i=r(31),o=r(55),s=r(168),a=r(21),c=r(262),u=r(104),l=r(136),d=r(90),p=r(45),m=r(72),f=r(18),h=r(74),g=r(169),v=s.PROPER,y=s.CONFIGURABLE,b=g.IteratorPrototype,S=g.BUGGY_SAFARI_ITERATORS,T=f("iterator"),_=function(){return this};e.exports=function(e,t,r,s,f,g,w){c(r,t,s);var M,x,E,C=function(e){if(e===f&&O)return O;if(!S&&e in A)return A[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},R=t+" Iterator",k=!1,A=e.prototype,I=A[T]||A["@@iterator"]||f&&A[f],O=!S&&I||C(f),P="Array"==t&&A.entries||I;if(P&&(M=u(P.call(new e)))!==Object.prototype&&M.next&&(o||u(M)===b||(l?l(M,b):a(M[T])||m(M,T,_)),d(M,R,!0,!0),o&&(h[R]=_)),v&&"values"==f&&I&&"values"!==I.name&&(!o&&y?p(A,"name","values"):(k=!0,O=function(){return i(I,this)})),f)if(x={values:C("values"),keys:g?O:C("keys"),entries:C("entries")},w)for(E in x)(S||k||!(E in A))&&m(A,E,x[E]);else n({target:t,proto:!0,forced:S||k},x);return o&&!w||A[T]===O||m(A,T,O,{name:f}),h[t]=O,x}},function(e,t,r){var n=r(24),i=r(25),o=Function.prototype,s=n&&Object.getOwnPropertyDescriptor,a=i(o,"name"),c=a&&"something"===function(){}.name,u=a&&(!n||n&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:u}},function(e,t,r){var n,i,o,s=r(9),a=r(21),c=r(87),u=r(104),l=r(72),d=r(18),p=r(55),m=d("iterator"),f=!1;[].keys&&("next"in(o=[].keys())?(i=u(u(o)))!==Object.prototype&&(n=i):f=!0),null==n||s((function(){var e={};return n[m].call(e)!==e}))?n={}:p&&(n=c(n)),a(n[m])||l(n,m,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},function(e,t,r){var n=r(9);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var n=r(278);e.exports=n},function(e,t,r){var n=r(37),i=r(7),o=r(133),s=r(134),a=r(34),c=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(a(e)),r=s.f;return r?c(t,r(e)):t}},function(e,t,r){var n=r(18),i=r(74),o=n("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[o]===e)}},function(e,t,r){var n=r(1),i=r(31),o=r(40),s=r(34),a=r(98),c=r(107),u=n.TypeError;e.exports=function(e,t){var r=arguments.length<2?c(e):t;if(o(r))return s(i(r,e));throw u(a(e)+" is not iterable")}},function(e,t,r){var n=r(31),i=r(34),o=r(122);e.exports=function(e,t,r){var s,a;i(e);try{if(!(s=o(e,"return"))){if("throw"===t)throw r;return r}s=n(s,e)}catch(e){a=!0,s=e}if("throw"===t)throw r;if(a)throw s;return i(s),r}},function(e,t,r){var n=r(1);e.exports=n.Promise},function(e,t,r){var n=r(18)("iterator"),i=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){i=!0}};s[n]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},function(e,t,r){var n=r(34),i=r(299),o=r(18)("species");e.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[o])?t:i(r)}},function(e,t,r){var n,i,o,s,a=r(1),c=r(53),u=r(68),l=r(21),d=r(25),p=r(9),m=r(161),f=r(89),h=r(126),g=r(180),v=r(181),y=r(108),b=a.setImmediate,S=a.clearImmediate,T=a.process,_=a.Dispatch,w=a.Function,M=a.MessageChannel,x=a.String,E=0,C={};try{n=a.location}catch(e){}var R=function(e){if(d(C,e)){var t=C[e];delete C[e],t()}},k=function(e){return function(){R(e)}},A=function(e){R(e.data)},I=function(e){a.postMessage(x(e),n.protocol+"//"+n.host)};b&&S||(b=function(e){g(arguments.length,1);var t=l(e)?e:w(e),r=f(arguments,1);return C[++E]=function(){c(t,void 0,r)},i(E),E},S=function(e){delete C[e]},y?i=function(e){T.nextTick(k(e))}:_&&_.now?i=function(e){_.now(k(e))}:M&&!v?(s=(o=new M).port2,o.port1.onmessage=A,i=u(s.postMessage,s)):a.addEventListener&&l(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!p(I)?(i=I,a.addEventListener("message",A,!1)):i="onreadystatechange"in h("script")?function(e){m.appendChild(h("script")).onreadystatechange=function(){m.removeChild(this),R(e)}}:function(e){setTimeout(k(e),0)}),e.exports={set:b,clear:S}},function(e,t,r){var n=r(1).TypeError;e.exports=function(e,t){if(e<t)throw n("Not enough arguments");return e}},function(e,t,r){var n=r(44);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},function(e,t,r){var n=r(34),i=r(28),o=r(93);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(308);e.exports=n},function(e,t,r){var n=r(316);e.exports=n},function(e,t,r){var n=r(326);e.exports=n},function(e,t,r){var n=r(330);e.exports=n},function(e,t,r){var n=r(333);e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(53),s=r(21),a=r(44),c=r(89),u=r(180),l=/MSIE .\./.test(a),d=i.Function,p=function(e){return function(t,r){var n=u(arguments.length,1)>2,i=s(t)?t:d(t),a=n?c(arguments,2):void 0;return e(n?function(){o(i,this,a)}:i,r)}};n({global:!0,bind:!0,forced:l},{setTimeout:p(i.setTimeout),setInterval:p(i.setInterval)})},function(e,t){e.exports=function e(t,r){var n,i,o=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,s=/(^[ ]*|[ ]*$)/g,a=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,u=/^0/,l=function(t){return e.insensitive&&(""+t).toLowerCase()||""+t},d=l(t).replace(s,"")||"",p=l(r).replace(s,"")||"",m=d.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=p.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=parseInt(d.match(c),16)||1!==m.length&&d.match(a)&&Date.parse(d),g=parseInt(p.match(c),16)||h&&p.match(a)&&Date.parse(p)||null;if(g){if(h<g)return-1;if(h>g)return 1}for(var v=0,y=Math.max(m.length,f.length);v<y;v++){if(n=!(m[v]||"").match(u)&&parseFloat(m[v])||m[v]||0,i=!(f[v]||"").match(u)&&parseFloat(f[v])||f[v]||0,isNaN(n)!==isNaN(i))return isNaN(n)?1:-1;if(typeof n!=typeof i&&(n+="",i+=""),n<i)return-1;if(n>i)return 1}return 0}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(382)},function(e,t,r){e.exports=r(422)},function(e,t,r){var n=r(0),i={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},o={genResponseBody:function(e){return i[e=e||"file"]},parseResponse:function(e,t){n.notundef(e.size)&&(e.size=+e.size),n.notundef(e.w)&&(e.w=+e.w),n.notundef(e.h)&&(e.h=+e.h),n.notundef(e.dur)&&(e.dur=+e.dur);var r=e.orientation;if(n.notundef(r)&&(delete e.orientation,t&&("right, top"===r||"left, bottom"===r))){var i=e.w;e.w=e.h,e.h=i}return e}};e.exports=o},function(e,t,r){var n=r(77),i=r(6),o=r(76),s=r(119),a=r(11),c=r(47),u=c.getGlobal(),l={},d=u.name||"_parent",p=[],m=[];l.addMsgListener=function(e){p.push(e)};var f,h,g,v,y=(f=/^([\w]+?:\/\/.*?(?=\/|$))/i,function(e){return e=e||"",f.test(e)?RegExp.$1:"*"}),b=function(){var e,t,r=n(e=unescape(u.name||"")).call(e);if(r&&0===i(r).call(r,"MSG|")){u.name="";var o=c.string2object(r.replace("MSG|",""),"|"),s=(o.origin||"").toLowerCase();s&&"*"!==s&&0!==i(t=location.href.toLowerCase()).call(t,s)||function(e){for(var t=0,r=p.length;t<r;t++)try{p[t].call(null,e)}catch(e){}}({data:JSON.parse(o.data||"null"),source:u.frames[o.self]||o.self,origin:y(o.ref||("undefined"==typeof document?"":document.referrer))})}},S=(g=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return!0;return!1},function(){if(m.length){h=[];for(var e,t=m.length-1;t>=0;t--)e=m[t],g(h,e.w)||(h.push(e.w),o(m).call(m,t,1),e.w.name=e.d);h=null}}),T=l.startTimer=(v=!1,function(){v||(v=!0,u.postMessage||(s(S,100),s(b,20)))});l.postMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(c.fillUndef(t,{origin:"*",source:d}),u.postMessage){var r=t.data;u.FormData||(r=a(r)),e.postMessage(r,t.origin)}else{if(T(),c.isObject(t)){var n={};n.origin=t.origin||"",n.ref=location.href,n.self=t.source,n.data=a(t.data),t="MSG|"+c.object2string(n,"|",!0)}m.unshift({w:e,d:escape(t)})}},e.exports=l},function(e,t,r){var n=r(6),i=r(0),o={fromDataURL:function(e){var t,r,o=i.getGlobal();r=n(t=e.split(",")[0]).call(t,"base64")>=0?o.atob(e.split(",")[1]):o.decodeURIComponent(e.split(",")[1]);for(var s=e.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(r.length),c=0;c<r.length;c++)a[c]=r.charCodeAt(c);return new o.Blob([a],{type:s})}};e.exports=o},function(e,t,r){var n=r(10),i=r(8),o=r(5),s=r(0),a={stripmeta:0,blur:2,quality:3,crop:4,rotate:5,thumbnail:7,interlace:9},c={0:"stripmeta",1:"type",2:"blur",3:"quality",4:"crop",5:"rotate",6:"pixel",7:"thumbnail",8:"watermark",9:"interlace",10:"tmp"};function u(e){s.verifyOptions(e,"type","image::ImageOp"),s.verifyParamValid("type",e.type,u.validTypes,"image::ImageOp"),s.merge(this,e),this.type=a[e.type]}u.validTypes=n(a),u.reverse=function(e){var t=s.copy(e);return t.type=c[t.type],t},u.reverseImageOps=function(e){return i(e).call(e,(function(e){return o(u).call(u,e)}))},e.exports=u},function(e,t,r){var n=r(3),i=r(10),o={1:"ROOM_CLOSE",2:"ROOM_JOIN",3:"INVITE",4:"CANCEL_INVITE",5:"REJECT",6:"ACCEPT",7:"LEAVE",8:"CONTROL"},s={1:"accid",2:"uid",3:"createTime",4:"expireTime",5:"web_uid"},a={10404:"ROOM_NOT_EXISTS",10405:"ROOM_HAS_EXISTS",10406:"ROOM_MEMBER_NOT_EXISTS",10407:"ROOM_MEMBER_HAS_EXISTS",10408:"INVITE_NOT_EXISTS",10409:"INVITE_HAS_REJECT",10410:"INVITE_HAS_ACCEPT",10201:"PEER_NIM_OFFLINE",10202:"PEER_PUSH_OFFLINE",10419:"ROOM_MEMBER_EXCEED",10420:"ROOM_MEMBER_HAS_EXISTS_OTHER_CLIENT",10417:"UID_CONFLICT"};e.exports={parseAvSignalType:function(e){return o[e]||e},parseAvSignalMember:function(e){var t,r={};return n(t=i(e)).call(t,(function(t){r[s[t]]=e[t]})),r},parseAvSignalError:function(e){return e.message=a[e.code]||e.message||e,e}}},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;function getGlobal(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==global?global:{}}var root=getGlobal(),io=module.exports;void 0===root.location&&(root.location=null),root.io?module&&(module.exports=io=root.io):root.io=io,function(){!function(e,t){var r=e;r.version="0.9.11",r.protocol=1,r.transports=[],r.j=[],r.sockets={},r.connect=function(e,n){var i,o,s=r.util.parseUri(e);t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),i=r.util.uniqueUri(s);var a={host:s.ipv6uri?"["+s.host+"]":s.host,secure:"https"===s.protocol,port:s.port||("https"===s.protocol?443:80),query:s.query||""};return r.util.merge(a,n),!a["force new connection"]&&r.sockets[i]||(o=new r.Socket(a)),!a["force new connection"]&&o&&(r.sockets[i]=o),(o=o||r.sockets[i]).of(s.path.length>1?s.path:"")}}(module.exports,root),function(e,t){var r=e.util={},n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];r.parseUri=function(e){var t=e,r=e.indexOf("["),o=e.indexOf("]");-1!=r&&-1!=o&&(e=e.substring(0,r)+e.substring(r,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=n.exec(e||""),a={},c=14;c--;)a[i[c]]=s[c]||"";return-1!=r&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a},r.uniqueUri=function(e){var r=e.protocol,n=e.host,i=e.port;return"document"in t&&t.document?(n=n||document.domain,i=i||("https"==r&&"https:"!==document.location.protocol?443:document.location.port)):(n=n||"localhost",i||"https"!=r||(i=443)),(r||"http")+"://"+n+":"+(i||80)},r.query=function(e,t){var n=r.chunkQuery(e||""),i=[];for(var o in r.merge(n,r.chunkQuery(t||"")),n)n.hasOwnProperty(o)&&i.push(o+"="+n[o]);return i.length?"?"+i.join("&"):""},r.chunkQuery=function(e){for(var t,r={},n=e.split("&"),i=0,o=n.length;i<o;++i)(t=n[i].split("="))[0]&&(r[t[0]]=t[1]);return r};var o=!1;r.load=function(e){if("undefined"!=typeof document&&document&&"complete"===document.readyState||o)return e();r.on(t,"load",e,!1)},r.on=function(e,t,r,n){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener&&e.addEventListener(t,r,n)},r.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!r.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||r.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(root[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},void 0!==root&&r.load((function(){o=!0})),r.defer=function(e){if(!r.ua.webkit||"undefined"!=typeof importScripts)return e();r.load((function(){setTimeout(e,100)}))},r.merge=function(e,t,n,i){var o,s=i||[],a=void 0===n?2:n;for(o in t)t.hasOwnProperty(o)&&r.indexOf(s,o)<0&&("object"==typeof e[o]&&a?r.merge(e[o],t[o],a-1,s):(e[o]=t[o],s.push(t[o])));return e},r.mixin=function(e,t){r.merge(e.prototype,t.prototype)},r.inherit=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.intersect=function(e,t){for(var n=[],i=e.length>t.length?e:t,o=e.length>t.length?t:e,s=0,a=o.length;s<a;s++)~r.indexOf(i,o[s])&&n.push(o[s]);return n},r.indexOf=function(e,t,r){var n=e.length;for(r=r<0?r+n<0?0:r+n:r||0;r<n&&e[r]!==t;r++);return n<=r?-1:r},r.toArray=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(e[r]);return t},r.ua={},r.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),r.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),r.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,root),function(e,t){function r(){}e.EventEmitter=r,r.prototype.on=function(e,r){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(r):this.$events[e]=[this.$events[e],r]:this.$events[e]=r,this},r.prototype.addListener=r.prototype.on,r.prototype.once=function(e,t){var r=this;function n(){r.removeListener(e,n),t.apply(this,arguments)}return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,r){if(this.$events&&this.$events[e]){var n=this.$events[e];if(t.util.isArray(n)){for(var i=-1,o=0,s=n.length;o<s;o++)if(n[o]===r||n[o].listener&&n[o].listener===r){i=o;break}if(i<0)return this;n.splice(i,1),n.length||delete this.$events[e]}else(n===r||n.listener&&n.listener===r)&&delete this.$events[e]}return this},r.prototype.removeAllListeners=function(e){return void 0===e?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},r.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},r.prototype.emit=function(e){if(!this.$events)return!1;var r=this.$events[e];if(!r)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof r)r.apply(this,n);else{if(!t.util.isArray(r))return!1;for(var i=r.slice(),o=0,s=i.length;o<s;o++)i[o].apply(this,n)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={};function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,(function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function str(e,t){var r,n,i,o,s,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,r=0;r<o;r+=1)s[r]=str(r,c)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(o=rep.length,r=0;r<o;r+=1)"string"==typeof rep[r]&&(i=str(n=rep[r],c))&&s.push(quote(n)+(gap?": ":":")+i);else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(i=str(n,c))&&s.push(quote(n)+(gap?": ":":")+i);return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}JSON.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;n<r;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("socket.io:: replacer cannot JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){var j;function walk(e,t){var r,n,i=e[t];if(i&&"object"==typeof i)for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(void 0!==(n=walk(i,r))?i[r]=n:delete i[r]);return reviver.call(e,t,i)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("socket.io:: reviver cannot JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var r=e.parser={},n=r.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=r.reasons=["transport not supported","client not handshaken","unauthorized"],o=r.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;r.encodePacket=function(e){var t=a(n,e.type),r=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var d=e.reason?a(i,e.reason):"",p=e.advice?a(o,e.advice):"";""===d&&""===p||(l=d+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var m={name:e.name};e.args&&e.args.length&&(m.args=e.args),l=s.stringify(m);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,r+("data"==u?"+":""),c];return null!=l&&f.push(l),f.join(":")},r.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var r=0,n=e.length;r<n;r++)t+="�"+e[r].length+"�"+e[r];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;r.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",r=(e=a[5]||"",{type:n[a[1]],endpoint:a[4]||""});switch(t&&(r.id=t,a[3]?r.ack="data":r.ack=!0),r.type){case"error":var a=e.split("+");r.reason=i[a[0]]||"",r.advice=o[a[1]]||"";break;case"message":r.data=e||"";break;case"event":try{var u=s.parse(e);r.name=u.name,r.args=u.args}catch(e){}r.args=r.args||[];break;case"json":try{r.data=s.parse(e)}catch(e){}break;case"connect":r.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(r.ackId=a[1],r.args=[],a[3]))try{r.args=a[3]?s.parse(a[3]):[]}catch(e){}}return r},r.decodePayload=function(e){var t=function(e,t){for(var r=0,n=e;n<t.length;n++){if("�"==t.charAt(n))return r;r++}return r};if("�"==e.charAt(0)){for(var n=[],i=1,o="";i<e.length;i++)if("�"==e.charAt(i)){var s=e.substr(i+1).substr(0,o);if("�"!=e.charAt(i+1+Number(o))&&i+1+Number(o)!=e.length){var a=Number(o);l=t(i+a+1,e),s=e.substr(i+1).substr(0,a+l),i+=l}n.push(r.decodePacket(s)),i+=Number(o)+1,o=""}else o+=e.charAt(i);return n}return[r.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function r(e,t){this.socket=e,this.sessid=t}e.Transport=r,t.util.mixin(r,t.EventEmitter),r.prototype.heartbeats=function(){return!0},r.prototype.onData=function(e){if(this!==this.socket.transport)return this;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var r=t.parser.decodePayload(e);if(r&&r.length)for(var n=0,i=r.length;n<i;n++)this.onPacket(r[n])}return this},r.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},r.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout((function(){e.onDisconnect()}),this.socket.closeTimeout)}},r.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket?(this.socket.transport===this?this.socket.onDisconnect():this.socket.setBuffer(!1),this):this},r.prototype.onConnect=function(){return this.socket.onConnect(),this},r.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},r.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},r.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},r.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},r.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},r.prototype.onClose=function(){this.isOpen=!1,this.socket.transport===this?this.socket.onClose():this.socket.setBuffer(!1),this.onDisconnect(),this.onDisconnectDone instanceof Function&&this.onDisconnectDone(null),this.onConnectionOver instanceof Function&&this.onConnectionOver(null)},r.prototype.onDisconnectDone=function(){},r.prototype.onConnectionOver=function(){},r.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},r.prototype.ready=function(e,t){t.call(this)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,r){function n(e){if(this.options={port:80,secure:!1,document:"document"in r&&document,resource:"socket.io",transports:e.transports||t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var n=this;t.util.on(r,"beforeunload",(function(){n.disconnectSync()}),!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=n,t.util.mixin(n,t.EventEmitter),n.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},n.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},n.prototype.handshake=function(e){var r=this,n=this.options;function o(t){t instanceof Error?(r.connecting=!1,r.onError(t.message)):e.apply(null,t.split(":"))}var s=["http"+(n.secure?"s":"")+":/",n.host+":"+n.port,n.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS&&"undefined"!=typeof document&&document){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,c.onreadystatechange=function(){"loaded"==this.readyState&&c.parentNode&&(c.parentNode.removeChild(c),r.connecting=!1,!r.reconnecting&&r.onError("Server down or port not open"),r.publish("handshake_failed"))},a.parentNode.insertBefore(c,a),t.j.push((function(e){o(e),c.parentNode.removeChild(c)}))}else{var u=t.util.request();u.open("GET",s,!0),u.timeout=1e4,this.isXDomain()&&(u.withCredentials=!0),u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=i,200==u.status?o(u.responseText):403==u.status?(r.connecting=!1,r.onError(u.responseText),r.publish("handshake_failed")):(r.connecting=!1,!r.reconnecting&&r.onError(u.responseText),r.publish("handshake_failed")))},u.ontimeout=function(e){r.connecting=!1,!r.reconnecting&&r.onError(u.responseText),r.publish("handshake_failed")},u.send(null)}},n.prototype.connect=function(e){if(this.connecting)return this;var r=this;return r.connecting=!0,this.handshake((function(n,i,o,s){r.sessionid=n,r.closeTimeout=1e3*o,r.heartbeatTimeout=1e3*i,r.transports||(r.transports=r.origTransports=s?t.util.intersect(s.split(","),r.options.transports):r.options.transports),r.setHeartbeatTimeout(),r.once("connect",(function(){clearTimeout(r.connectTimeoutTimer),r.connectTimeoutTimer=null,e&&"function"==typeof e&&e()})),r.doConnect()})),this},n.prototype.doConnect=function(){var e=this;if(e.transport&&e.transport.clearTimeouts(),e.transport=e.getTransport(e.transports),!e.transport)return e.publish("connect_failed");e.transport.ready(e,(function(){e.connecting=!0,e.publish("connecting",e.transport.name),e.transport.open(),e.options["connect timeout"]&&(e.connectTimeoutTimer&&clearTimeout(e.connectTimeoutTimer),e.connectTimeoutTimer=setTimeout(e.tryNextTransport.bind(e),e.options["connect timeout"]))}))},n.prototype.getTransport=function(e){for(var r,n=e||this.transports,i=0;r=n[i];i++)if(t.Transport[r]&&t.Transport[r].check(this)&&(!this.isXDomain()||t.Transport[r].xdomainCheck(this)))return new t.Transport[r](this,this.sessionid);return null},n.prototype.tryNextTransport=function(){if(!this.connected&&(this.connecting=!1,this.options["try multiple transports"])){for(var e=this.transports;e.length>0&&e.splice(0,1)[0]!=this.transport.name;);e.length?this.doConnect():this.publish("connect_failed")}},n.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout((function(){e.transport&&e.transport.onClose()}),this.heartbeatTimeout)}},n.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},n.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},n.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},n.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},n.prototype.disconnectSync=function(){var e=t.util.request(),r=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",r,!1),e.send(null),this.onDisconnect("booted")},n.prototype.isXDomain=function(){var e=r&&r.location||{},t=e.port||("https:"==e.protocol?443:80);return this.options.host!==e.hostname||this.options.port!=t},n.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},n.prototype.onOpen=function(){this.open=!0},n.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},n.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},n.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},n.prototype.onDisconnect=function(e){var t=this.connected,r=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||r)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()),r&&(this.connectTimeoutTimer&&clearTimeout(this.connectTimeoutTimer),this.tryNextTransport()))},n.prototype.reconnect=function(){this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],r=this.options["try multiple transports"],n=this.options["reconnection limit"];function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer),e.removeListener("connect_failed",o),e.removeListener("connect",o),e.reconnecting=!1,delete e.reconnectionAttempts,delete e.reconnectionDelay,delete e.reconnectionTimer,delete e.redoTransports,e.options["try multiple transports"]=r}function o(){if(e.reconnecting)return e.connected?i():e.connecting&&e.reconnecting?e.reconnectionTimer=setTimeout(o,1e3):void(e.reconnectionAttempts++>=t?e.redoTransports?(e.publish("reconnect_failed"),i()):(e.on("connect_failed",o),e.options["try multiple transports"]=!0,e.transports=e.origTransports,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<n&&(e.reconnectionDelay*=2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(o,e.reconnectionDelay)))}this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(o,this.reconnectionDelay),this.on("connect",o)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t){function r(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}function n(e,t){this.namespace=e,this.name=t}e.SocketNamespace=r,t.util.mixin(r,t.EventEmitter),r.prototype.$emit=t.EventEmitter.prototype.emit,r.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},r.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},r.prototype.send=function(e,t){var r={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(r.id=++this.ackPackets,r.ack=!0,this.acks[r.id]=t),this.packet(r)},r.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),r=t[t.length-1],n={type:"event",name:e};return"function"==typeof r&&(n.id=++this.ackPackets,n.ack="data",this.acks[n.id]=r,t=t.slice(0,t.length-1)),n.args=t,this.packet(n)},r.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},r.prototype.onPacket=function(e){var r=this;function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":i=[e.name].concat(e.args),"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":console.error("SocketIO on packet error: ",e),e.advice?this.socket.onError(e):"unauthorized"===e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,r){function n(e){t.Transport.apply(this,arguments)}e.websocket=n,t.util.inherit(n,t.Transport),n.prototype.name="websocket",n.prototype.open=function(){var e,n=t.util.query(this.socket.options.query),i=this;return e||(e=r.MozWebSocket||r.WebSocket),this.websocket=new e(this.prepareUrl()+n),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.socket.setBuffer(!0),i.onClose()},this.websocket.onerror=function(e){i.onError(e)},this},t.util.ua.iDevice?n.prototype.send=function(e){var t=this;return setTimeout((function(){t.websocket.send(e)}),0),this}:n.prototype.send=function(e){return this.websocket.send(e),this},n.prototype.payload=function(e){for(var t=0,r=e.length;t<r;t++)this.packet(e[t]);return this},n.prototype.close=function(){return this.websocket.close(),this},n.prototype.onError=function(e){this.socket.onError(e)},n.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},n.check=function(){return"WebSocket"in r&&!("__addTask"in WebSocket)||"MozWebSocket"in r},n.xdomainCheck=function(){return!0},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t,r){function n(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=n,t.util.inherit(n,t.Transport),n.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},n.prototype.payload=function(e){for(var r=[],n=0,i=e.length;n<i;n++)r.push(t.parser.encodePacket(e[n]));this.send(t.parser.encodePayload(r))},n.prototype.send=function(e){return this.post(e),this},n.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),r.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=i,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,t.posting=!1,200==this.status?t.socket.setBuffer(!1):t.onClose())},this.sendXHR.send(e)},n.prototype.close=function(){return this.onClose(),this},n.prototype.request=function(e){var r=t.util.request(this.socket.isXDomain()),n=t.util.query(this.socket.options.query,"t="+ +new Date);if(r.open(e||"GET",this.prepareUrl()+n,!0),"POST"==e)try{r.setRequestHeader?r.setRequestHeader("Content-type","text/plain;charset=UTF-8"):r.contentType="text/plain"}catch(e){}return r},n.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},n.check=function(e,n){try{var i=t.util.request(n),o=r.XDomainRequest&&i instanceof XDomainRequest,s=e&&e.options&&e.options.secure?"https:":"http:",a=r.location&&s!=r.location.protocol;if(i&&(!o||!a))return!0}catch(e){}return!1},n.xdomainCheck=function(e){return n.check(e,!0)}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t,r){function n(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=n,t.util.inherit(n,t.Transport.XHR),t.util.merge(n,t.Transport.XHR),n.prototype.name="xhr-polling",n.prototype.heartbeats=function(){return!1},n.prototype.open=function(){return t.Transport.XHR.prototype.open.call(this),!1},n.prototype.get=function(){if(this.isOpen){var e=this;this.xhr=this.request(),r.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){this.onload=i,this.onerror=i,e.retryCounter=1,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.retryCounter++,!e.retryCounter||e.retryCounter>3?e.onClose():e.get()}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(e.onData(this.responseText),e.get()):e.onClose())},this.xhr.send(null)}},n.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},n.prototype.ready=function(e,r){var n=this;t.util.defer((function(){r.call(n)}))},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return io}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}).call(this,__webpack_require__(48),__webpack_require__(459)(module))},function(e,t,r){var n=r(10),i=r(39);function o(){}o.typeMap={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,g2:12,custom:100};var s=o.typeReverseMap={0:"text",1:"image",2:"audio",3:"video",4:"geo",5:"notification",6:"file",10:"tip",11:"robot",12:"g2",100:"custom"};o.validTypes=n(o.typeMap),o.setFlow=function(e,t){var r=t===e.from;r&&t===e.to&&(r=i.deviceId===e.fromDeviceId),e.flow=r?"out":"in","robot"===e.type&&e.content&&e.content.msgOut&&(e.flow="in")},o.getType=function(e){var t=e.type;return s[t]||t},e.exports=o},function(e,t,r){e.exports=function(e,t,r,n){var i=self||window;try{try{var o;try{o=new i.Blob([e])}catch(t){(o=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),o=o.getBlob()}var s=i.URL||i.webkitURL,a=s.createObjectURL(o),c=new i[t](a,r);return s.revokeObjectURL(a),c}catch(n){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),r)}}catch(e){if(!n)throw Error("Inline worker is not supported");return new i[t](n,r)}}},function(e,t,r){r(225).polyfill(),r(14).isBrowser=!0},function(e,t,r){var n=r(289);r(56),e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(16),s=r(104),a=r(136),c=r(290),u=r(87),l=r(45),d=r(54),p=r(291),m=r(292),f=r(106),h=r(293),g=r(18),v=r(294),y=g("toStringTag"),b=i.Error,S=[].push,T=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=o(_,this);a?r=a(new b,i?s(this):_):(r=i?this:u(_),l(r,y,"Error")),void 0!==t&&l(r,"message",h(t)),v&&l(r,"stack",p(r.stack,1)),m(r,n);var c=[];return f(e,S,{that:c}),l(r,"errors",c),r};a?a(T,b):c(T,b,{name:!0});var _=T.prototype=u(b.prototype,{constructor:d(1,T),message:d(1,""),name:d(1,"AggregateError")});n({global:!0},{AggregateError:T})},function(e,t,r){var n=r(2),i=r(31),o=r(40),s=r(93),a=r(115),c=r(106);n({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=s.f(t),n=r.resolve,u=r.reject,l=a((function(){var r=o(t.resolve),s=[],a=0,u=1;c(e,(function(e){var o=a++,c=!1;u++,i(r,t,e).then((function(e){c||(c=!0,s[o]={status:"fulfilled",value:e},--u||n(s))}),(function(e){c||(c=!0,s[o]={status:"rejected",reason:e},--u||n(s))}))})),--u||n(s)}));return l.error&&u(l.value),r.promise}})},function(e,t,r){var n=r(2),i=r(40),o=r(37),s=r(31),a=r(93),c=r(115),u=r(106);n({target:"Promise",stat:!0},{any:function(e){var t=this,r=o("AggregateError"),n=a.f(t),l=n.resolve,d=n.reject,p=c((function(){var n=i(t.resolve),o=[],a=0,c=1,p=!1;u(e,(function(e){var i=a++,u=!1;c++,s(n,t,e).then((function(e){u||p||(p=!0,l(e))}),(function(e){u||p||(u=!0,o[i]=e,--c||d(new r(o,"No one promise resolved")))}))})),--c||d(new r(o,"No one promise resolved"))}));return p.error&&d(p.value),n.promise}})},function(e,t,r){e.exports=r(328)},function(e,t,r){var n=r(378),i=r(381),o=r(209),s=r(387);e.exports=function(e){return n(e)||i(e)||o(e)||s()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(379)},function(e,t,r){var n=r(384),i=r(191),o=r(190);e.exports=function(e,t){var r;if(e){if("string"==typeof e)return o(e,t);var s=n(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?i(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?o(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(389)},function(e,t,r){(function(n){var i,o=r(27),s=r(17),a=r(30),c=r(4),u=r(3),l=r(49),d=r(13),p=r(10),m=r(19);!function(f,h){var g,v=(f=void 0!==f?f:"undefined"!=typeof self?self:void 0!==n?n:{}).IDBKeyRange||f.webkitIDBKeyRange,y="readwrite",b=Object.prototype.hasOwnProperty,S=function(){if(!g&&!(g=f.indexedDB||f.webkitIndexedDB||f.mozIndexedDB||f.oIndexedDB||f.msIndexedDB||(null===f.indexedDB&&f.shimIndexedDB?f.shimIndexedDB:void 0)))throw"IndexedDB required";return g},T=function(e){return e},_=function(e){var t;return s(t=Object.prototype.toString.call(e)).call(t,8,-1).toLowerCase()},w=function(e){return"function"==typeof e},M=function(e){return"number"===_(e)},x=function(e){return"array"===_(e)},E=function(e){return void 0===e},C=function(e,t){var r=this,n=!1;this.name=t,this.getIndexedDB=function(){return e},this.add=function(t){if(n)throw"Database has been closed";for(var i=[],o=0,s=0;s<arguments.length-1;s++)if(a(arguments[s+1]))for(var d=0;d<arguments[s+1].length;d++)i[o]=arguments[s+1][d],o++;else i[o]=arguments[s+1],o++;var p=e.transaction(t,y),m=p.objectStore(t);return new c((function(e,t){u(i).call(i,(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=m.add(e,r)}else t=m.add(e);t.onsuccess=function(t){var r=t.target,n=r.source.keyPath;null===n&&(n="__id__"),l(e,n,{value:r.result,enumerable:!0})}})),p.oncomplete=function(){e(i,r)},p.onerror=function(e){e.preventDefault(),t(e)},p.onabort=function(e){t(e)}}))},this.updateAndDelete=function(t,r,i){if(n)throw"Database has been closed";var o=e.transaction(t,y),s=o.objectStore(t),a=s.keyPath;return new c((function(e,t){u(r).call(r,(function(e){if(e.item&&e.key){var t=e.key;e=e.item,s.put(e,t)}else s.put(e)})),u(i).call(i,(function(e){s.delete(e[a])})),o.oncomplete=function(){e([r,i])},o.onerror=function(e){t(e)}}))},this.update=function(t){if(n)throw"Database has been closed";for(var i,o=[],s=1;s<arguments.length;s++)a(i=arguments[s])?o=d(o).call(o,i):o.push(i);var l=e.transaction(t,y),p=l.objectStore(t);return p.keyPath,new c((function(e,t){u(o).call(o,(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=p.put(e,r)}else t=p.put(e);t.onsuccess=function(e){},t.onerror=function(e){}})),l.oncomplete=function(){e(o,r)},l.onerror=function(e){t(e)},l.onabort=function(e){t(e)}}))},this.remove=function(t,r,i,o,s,l,d){if(n)throw"Database has been closed";var p=e.transaction(t,y),m=p.objectStore(t);return new c((function(e,t){function n(e){return null==e}var c;n(o)&&(o=-1/0),n(s)&&(s=1/0),null===r||a(r)||(r=[r]),n(i)?null!==r?u(r).call(r,(function(e){m.delete(e)})):m.delete(range=v.bound(o,s,l,d)):(c=null!==r?v.only(r[0]):v.bound(o,s,l,d),m.index(i).openCursor(c).onsuccess=function(e){var t=e.target.result;t&&(t.delete(),t.continue())}),p.oncomplete=function(){e()},p.onerror=function(e){t(e)},p.onabort=function(e){t(e)}}))},this.clear=function(t){if(n)throw"Database has been closed";var r=e.transaction(t,y);return r.objectStore(t).clear(),new c((function(e,t){r.oncomplete=function(){e()},r.onerror=function(e){t(e)}}))},this.close=function(){n||(e.close(),n=!0,delete A[t])},this.get=function(t,r){if(n)throw"Database has been closed";var i=e.transaction(t),o=i.objectStore(t).get(r);return new c((function(e,t){o.onsuccess=function(t){e(t.target.result)},i.onerror=function(e){t(e)}}))},this.query=function(t,r){if(n)throw"Database has been closed";return new R(t,e,r)},this.count=function(t,r){if(n)throw"Database has been closed";e.transaction(t).objectStore(t)};for(var i=0,o=e.objectStoreNames.length;i<o;i++)!function(e){for(var t in r[e]={},r)b.call(r,t)&&"close"!==t&&(r[e][t]=function(t){return function(){var n,i=d(n=[e]).call(n,s([]).call(arguments,0));return r[t].apply(r,i)}}(t))}(e.objectStoreNames[i])},R=function(e,t,r){var n,i=this,a=!1,l=!1,d=function(n,i,s,d,m,f,h){return new c((function(c,g){var b=a||l?y:"readonly",S=t.transaction(e,b),T=S.objectStore(e),_=r?T.index(r):T,M=n?v[n].apply(null,i):null,x=[],E=[M],C=0;m=m||null,f=f||[],"count"!==s&&E.push(d||"next");var R=!!a&&p(a);_[s].apply(_,E).onsuccess=function(e){var t=e.target.result;if(o(t)===o(0))x=t;else if(t)if(null!==m&&m[0]>C)C=m[0],t.advance(m[0]);else if(null!==m&&C>=m[0]+m[1]);else{var r=!0,n="value"in t?t.value:t.key;u(f).call(f,(function(e){e&&e.length&&(2===e.length?r=r&&n[e[0]]===e[1]:w(e[0])&&(r=r&&e[0].apply(void 0,[n])))})),r&&(C++,x.push(h(n)),l?t.delete():a&&(n=function(e){for(var t=0;t<R.length;t++){var r=R[t],n=a[r];n instanceof Function&&(n=n(e)),e[r]=n}return e}(n),t.update(n))),t.continue()}},S.oncomplete=function(){c(x)},S.onerror=function(e){g(e)},S.onabort=function(e){g(e)}}))},f=function(e,t){var r="next",n="openCursor",i=[],o=null,c=T,u=!1,p=function(){return d(e,t,n,u?r+"unique":r,o,i,c)},m=function(){return r=null,n="count",{execute:p}},f=function e(){return 1==(o=x(arguments[0])?arguments[0]:s(Array.prototype).call(arguments,0,2)).length&&o.unshift(0),M(o[1])||(o=null),{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:e,map:_,remove:C}},h=function e(t){return(t=!!E(t)||!!t)&&(n="openKeyCursor"),{execute:p,keys:e,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:f,map:_,remove:C}},g=function e(){return i.push(s(Array.prototype).call(arguments,0,2)),{execute:p,count:m,keys:h,filter:e,asc:v,desc:y,distinct:b,modify:S,limit:f,map:_,remove:C}},v=function e(t){return t=!!E(t)||!!t,r=t?"next":"prev",{execute:p,count:m,keys:h,filter:g,asc:e,desc:y,distinct:b,modify:S,limit:f,map:_,remove:C}},y=function e(t){return t=!!E(t)||!!t,r=t?"prev":"next",{execute:p,count:m,keys:h,filter:g,asc:v,desc:e,distinct:b,modify:S,limit:f,map:_,remove:C}},b=function e(t){return t=!!E(t)||!!t,u=t,{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:e,modify:S,limit:f,map:_,remove:C}},S=function e(t){return a=t,{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:e,limit:f,map:_,remove:C}},_=function e(t){return w(t)&&(c=t),{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:f,map:e,remove:C}},C=function e(t){return t=!!E(t)||!!t,l=t,{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:f,map:_,remove:e}};return{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:f,map:_,remove:C}};u(n="only bound upperBound lowerBound".split(" ")).call(n,(function(e){i[e]=function(){return new f(e,arguments)}})),this.filter=function(){var e=new f(null,null);return m(e).apply(e,arguments)},this.all=function(){return m(this).call(this)}},k=function(e,t,r,n){var i=e.target.result,o=new C(i,t);return A[t]=i,c.resolve(o)},A={},I={version:"0.10.2",open:function(e){var t;return new c((function(r,n){if(A[e.server])k({target:{result:A[e.server]}},e.server,e.version,e.schema).then(r,n);else{try{t=S().open(e.server,e.version)}catch(e){n(e)}t.onsuccess=function(t){k(t,e.server,e.version,e.schema).then(r,n)},t.onupgradeneeded=function(t){!function(e,t,r){for(var n in"function"==typeof t&&(t=t()),t){var i,o=t[n];for(var s in i=!b.call(t,n)||r.objectStoreNames.contains(n)?e.currentTarget.transaction.objectStore(n):r.createObjectStore(n,o.key),o.indexes){var a=o.indexes[s];try{i.index(s)}catch(e){i.createIndex(s,a.key||s,p(a).length?a:{unique:!1})}}}}(t,e.schema,t.target.result)},t.onerror=function(e){n(e)}}}))},remove:function(e){return new c((function(t,r){if(!e)return t();var n,i;o(e)===C&&(e=e.name),"string"==typeof e&&(n=A[e]),n&&"function"==typeof n.close&&n.close();try{i=S().deleteDatabase(e)}catch(e){r(e)}i.onsuccess=function(r){delete A[e],t(e)},i.onerror=function(e){r(e)},i.onblocked=function(e){r(e)}}))}};void 0!==e.exports?e.exports=I:void 0===(i=function(){return I}.call(t,r,t,e))||(e.exports=i)}(void 0)}).call(this,r(48))},function(e,t,r){e.exports=r(440)},function(e,t,r){e.exports=r(450)},function(e,t){var r={set:function(e,t,n){r[e]=t,n&&(n.support=t)}};e.exports=r},,function(e,t,r){var n=r(454);e.exports=n},function(e,t,r){var n,i=r(23),o=r(62),s=r(39),a=r(14),c=r(460),u=r(461),l={sdktype:"IM",platform:"Web",deviceId:s.deviceId,sdk_ver:a.info.version,manufactor:o.manufacturer,env:"online"},d={initUniErrReport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l.appkey=e.appKey,this.reporter=new c({common:l,request:u,logger:e.logger,autoStart:a.isBrowser}),a.isBrowser||this.reporter.pause()}};d.sendBeacon=navigator&&navigator.sendBeacon&&i(n=navigator.sendBeacon).call(n,navigator)||function(e,t){var r=new XMLHttpRequest;r.open("POST",e,!0),r.send(t)},e.exports=d},,,,function(e,t,r){var n=r(62),i=r(481),o=r(198),s=r(189),a=r(147),c=r(0),u=r(214),l=r(195),d=r(81),p=r(486),m=r(487);e.exports=function(e){c.merge(e,{platform:n,xhr:i,io:o,naturalSort:s,deepAccess:a,util:c,support:u,blob:l,ajax:d,LoggerPlugin:p,usePlugin:m})}},function(e,t,r){var n=r(8),i=r(5),o=r(10),s=r(82).genPrivateUrl,a=r(0),c=a.notundef,u={"-2":"unset","-1":"restricted",0:"common",1:"owner",2:"manager",3:"guest",4:"anonymous"};function l(e){c(e.nick)&&(this.nick=""+e.nick),c(e.avatar)&&(this.avatar=""+e.avatar),c(e.custom)&&(this.custom=""+e.custom)}l.reverse=function(e){var t=a.copy(e);return c(t.chatroomId)&&(t.chatroomId=""+t.chatroomId),c(t.avatar)&&(t.avatar=s(t.avatar)),c(t.type)&&(t.type=u[t.type]),c(t.level)&&(t.level=+t.level),c(t.online)&&(t.online=1==+t.online),c(t.enterTime)&&(t.enterTime=+t.enterTime),c(t.guest)&&(t.guest=1==+t.guest),c(t.blacked)&&(t.blacked=1==+t.blacked),c(t.gaged)&&(t.gaged=1==+t.gaged),c(t.valid)&&(t.valid=1==+t.valid),c(t.updateTime)&&(t.updateTime=+t.updateTime),c(t.tempMuted)?t.tempMuted=1==+t.tempMuted:t.tempMuted=!1,c(t.tempMuteDuration)?t.tempMuteDuration=+t.tempMuteDuration:t.tempMuteDuration=0,t.online||delete t.enterTime,t.guest&&(t.type="guest",delete t.valid),"common"!==t.type&&delete t.level,delete t.guest,t},l.reverseMembers=function(e){return n(e).call(e,(function(e){return i(l).call(l,e)}))},l.validTypes=o(u),l.typeReverseMap=u,e.exports=l},function(e,t,r){var n,i,o,s,a,c,u,l,d,p,m,f,h,g,v,y,b,S,T;e.exports=(n=r(64),r(490),void(n.lib.Cipher||(i=n,o=i.lib,s=o.Base,a=o.WordArray,c=o.BufferedBlockAlgorithm,u=i.enc,u.Utf8,l=u.Base64,d=i.algo.EvpKDF,p=o.Cipher=c.extend({cfg:s.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?T:b}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()}),o.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),m=i.mode={},f=o.BlockCipherMode=s.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),h=m.CBC=function(){var e=f.extend();function t(e,t,r){var n,i=this._iv;i?(n=i,this._iv=void 0):n=this._prevBlock;for(var o=0;o<r;o++)e[t+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i),n.encryptBlock(e,r),this._prevBlock=e.slice(r,r+i)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=e.slice(r,r+i);n.decryptBlock(e,r),t.call(this,e,r,i),this._prevBlock=o}}),e}(),g=(i.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,o=[],s=0;s<n;s+=4)o.push(i);var c=a.create(o,n);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},o.BlockCipher=p.extend({cfg:p.cfg.extend({mode:h,padding:g}),reset:function(){var e;p.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),v=o.CipherParams=s.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=(i.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?a.create([1398893684,1701076831]).concat(r).concat(t):t).toString(l)},parse:function(e){var t,r=l.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=a.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),v.create({ciphertext:r,salt:t})}},b=o.SerializableCipher=s.extend({cfg:s.extend({format:y}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),s=i.cfg;return v.create({ciphertext:o,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),S=(i.kdf={}).OpenSSL={execute:function(e,t,r,n){n||(n=a.random(8));var i=d.create({keySize:t+r}).compute(e,n),o=a.create(i.words.slice(t),4*r);return i.sigBytes=4*t,v.create({key:i,iv:o,salt:n})}},T=o.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:S}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=b.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=i.iv,b.decrypt.call(this,e,t,i.key,n)}}))))},function(e,t,r){e.exports=r(472)},function(e,t,r){(function(t,r){var n;n=function(){function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,o=void 0,s=void 0,a=function(e,t){f[i]=e,f[i+1]=t,2===(i+=2)&&(s?s(h):S())},c="undefined"!=typeof window?window:void 0,u=c||{},l=u.MutationObserver||u.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function m(){var e=setTimeout;return function(){return e(h,1)}}var f=new Array(1e3);function h(){for(var e=0;e<i;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;i=0}var g,v,y,b,S=void 0;function T(e,t){var r=this,n=new this.constructor(M);void 0===n[w]&&N(n);var i=r._state;if(i){var o=arguments[i-1];a((function(){return O(i,n,o,r._result)}))}else A(r,n,e,t);return n}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(M);return E(t,e),t}d?S=function(){return t.nextTick(h)}:l?(v=0,y=new l(h),b=document.createTextNode(""),y.observe(b,{characterData:!0}),S=function(){b.data=v=++v%2}):p?((g=new MessageChannel).port1.onmessage=h,S=function(){return g.port2.postMessage(0)}):S=void 0===c?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(h)}:m()}catch(e){return m()}}():m();var w=Math.random().toString(36).substring(2);function M(){}function x(t,r,n){r.constructor===t.constructor&&n===T&&r.constructor.resolve===_?function(e,t){1===t._state?R(e,t._result):2===t._state?k(e,t._result):A(t,void 0,(function(t){return E(e,t)}),(function(t){return k(e,t)}))}(t,r):void 0===n?R(t,r):e(n)?function(e,t,r){a((function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,(function(r){n||(n=!0,t!==r?E(e,r):R(e,r))}),(function(t){n||(n=!0,k(e,t))}),e._label);!n&&i&&(n=!0,k(e,i))}),e)}(t,r,n):R(t,r)}function E(e,t){if(e===t)k(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)R(e,t);else{var r=void 0;try{r=t.then}catch(t){return void k(e,t)}x(e,t,r)}var n,i}function C(e){e._onerror&&e._onerror(e._result),I(e)}function R(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(I,e))}function k(e,t){void 0===e._state&&(e._state=2,e._result=t,a(C,e))}function A(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+1]=r,i[o+2]=n,0===o&&e._state&&a(I,e)}function I(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,s=0;s<t.length;s+=3)n=t[s],i=t[s+r],n?O(r,n,i,o):i(o);e._subscribers.length=0}}function O(t,r,n,i){var o=e(n),s=void 0,a=void 0,c=!0;if(o){try{s=n(i)}catch(e){c=!1,a=e}if(r===s)return void k(r,new TypeError("A promises callback cannot return that same promise."))}else s=i;void 0!==r._state||(o&&c?E(r,s):!1===c?k(r,a):1===t?R(r,s):2===t&&k(r,s))}var P=0;function N(e){e[w]=P++,e._state=void 0,e._result=void 0,e._subscribers=[]}var D=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(M),this.promise[w]||N(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&R(this.promise,this._result))):k(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===_){var i=void 0,o=void 0,s=!1;try{i=e.then}catch(e){s=!0,o=e}if(i===T&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===L){var a=new r(M);s?k(a,o):x(a,e,i),this._willSettleAt(a,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;void 0===n._state&&(this._remaining--,2===e?k(n,r):this._result[t]=r),0===this._remaining&&R(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;A(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))},e}(),L=function(){function t(e){this[w]=P++,this._result=this._state=void 0,this._subscribers=[],M!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){E(e,t)}),(function(t){k(e,t)}))}catch(t){k(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this.constructor;return e(t)?this.then((function(e){return r.resolve(t()).then((function(){return e}))}),(function(e){return r.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return L.prototype.then=T,L.all=function(e){return new D(this,e).promise},L.race=function(e){var t=this;return n(e)?new t((function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},L.resolve=_,L.reject=function(e){var t=new this(M);return k(t,e),t},L._setScheduler=function(e){s=e},L._setAsap=function(e){a=e},L._asap=a,L.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=L},L.Promise=L,L},e.exports=n()}).call(this,r(226),r(48))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&m())}function m(){if(!l){var e=a(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||l||a(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){var n=r(16),i=r(228),o=Array.prototype;e.exports=function(e){var t=e.indexOf;return e===o||n(o,e)&&t===o.indexOf?i:t}},function(e,t,r){r(229);var n=r(22);e.exports=n("Array").indexOf},function(e,t,r){var n=r(2),i=r(7),o=r(127).indexOf,s=r(69),a=i([].indexOf),c=!!a&&1/a([1],1,-0)<0,u=s("indexOf");n({target:"Array",proto:!0,forced:c||!u},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return c?a(this,e,t)||0:o(this,e,t)}})},function(e,t,r){var n=r(1),i=r(31),o=r(28),s=r(120),a=r(122),c=r(231),u=r(18),l=n.TypeError,d=u("toPrimitive");e.exports=function(e,t){if(!o(e)||s(e))return e;var r,n=a(e,d);if(n){if(void 0===t&&(t="default"),r=i(n,e,t),!o(r)||s(r))return r;throw l("Can't convert object to primitive value")}return void 0===t&&(t="number"),c(e,t)}},function(e,t,r){var n=r(1),i=r(31),o=r(21),s=r(28),a=n.TypeError;e.exports=function(e,t){var r,n;if("string"===t&&o(r=e.toString)&&!s(n=i(r,e)))return n;if(o(r=e.valueOf)&&!s(n=i(r,e)))return n;if("string"!==t&&o(r=e.toString)&&!s(n=i(r,e)))return n;throw a("Can't convert object to primitive value")}},function(e,t,r){var n=r(1),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(85),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=r(235);e.exports=n},function(e,t,r){var n=r(16),i=r(236),o=Array.prototype;e.exports=function(e){var t=e.concat;return e===o||n(o,e)&&t===o.concat?i:t}},function(e,t,r){r(159);var n=r(22);e.exports=n("Array").concat},function(e,t,r){var n=r(1),i=r(70),o=r(100),s=r(28),a=r(18)("species"),c=n.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===c||i(t.prototype))||s(t)&&null===(t=t[a]))&&(t=void 0)),void 0===t?c:t}},function(e,t,r){var n=r(239);e.exports=n},function(e,t,r){r(240);var n=r(12).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){r(2)({target:"Object",stat:!0,sham:!r(24)},{create:r(87)})},function(e,t,r){var n=r(242);r(265),r(266),r(267),r(268),r(269),r(270),r(271),e.exports=n},function(e,t,r){var n=r(162);e.exports=n},function(e,t,r){r(159),r(88),r(163),r(246),r(247),r(248),r(249),r(166),r(250),r(251),r(252),r(253),r(254),r(255),r(256),r(257),r(258),r(259),r(260),r(261);var n=r(12);e.exports=n.Symbol},function(e,t,r){var n=r(129),i=r(46);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,r){var n=r(1),i=r(21),o=r(130),s=n.WeakMap;e.exports=i(s)&&/native code/.test(o(s))},function(e,t,r){r(20)("asyncIterator")},function(e,t){},function(e,t,r){r(20)("hasInstance")},function(e,t,r){r(20)("isConcatSpreadable")},function(e,t,r){r(20)("match")},function(e,t,r){r(20)("matchAll")},function(e,t,r){r(20)("replace")},function(e,t,r){r(20)("search")},function(e,t,r){r(20)("species")},function(e,t,r){r(20)("split")},function(e,t,r){r(20)("toPrimitive")},function(e,t,r){r(20)("toStringTag")},function(e,t,r){r(20)("unscopables")},function(e,t,r){var n=r(1);r(90)(n.JSON,"JSON",!0)},function(e,t){},function(e,t){},function(e,t,r){var n=r(169).IteratorPrototype,i=r(87),o=r(54),s=r(90),a=r(74),c=function(){return this};e.exports=function(e,t,r,u){var l=t+" Iterator";return e.prototype=i(n,{next:o(+!u,r)}),s(e,l,!1,!0),a[l]=c,e}},function(e,t,r){var n=r(1),i=r(21),o=n.String,s=n.TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw s("Can't set "+o(e)+" as a prototype")}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){r(20)("asyncDispose")},function(e,t,r){r(20)("dispose")},function(e,t,r){r(20)("matcher")},function(e,t,r){r(20)("metadata")},function(e,t,r){r(20)("observable")},function(e,t,r){r(20)("patternMatch")},function(e,t,r){r(20)("replaceAll")},function(e,t,r){e.exports=r(273)},function(e,t,r){var n=r(274);e.exports=n},function(e,t,r){var n=r(275);e.exports=n},function(e,t,r){var n=r(276);r(56),e.exports=n},function(e,t,r){r(73),r(88),r(105),r(166);var n=r(135);e.exports=n.f("iterator")},function(e,t,r){var n=r(7),i=r(85),o=r(43),s=r(84),a=n("".charAt),c=n("".charCodeAt),u=n("".slice),l=function(e){return function(t,r){var n,l,d=o(s(t)),p=i(r),m=d.length;return p<0||p>=m?e?"":void 0:(n=c(d,p))<55296||n>56319||p+1===m||(l=c(d,p+1))<56320||l>57343?e?a(d,p):n:e?u(d,p,p+2):l-56320+(n-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}},function(e,t,r){r(279);var n=r(12);e.exports=n.Array.isArray},function(e,t,r){r(2)({target:"Array",stat:!0},{isArray:r(70)})},function(e,t,r){r(56);var n=r(46),i=r(25),o=r(16),s=r(281),a=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===a||o(a,e)&&t===a.forEach||i(c,n(e))?s:t}},function(e,t,r){var n=r(282);e.exports=n},function(e,t,r){r(283);var n=r(22);e.exports=n("Array").forEach},function(e,t,r){var n=r(2),i=r(284);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},function(e,t,r){var n=r(78).forEach,i=r(69)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){e.exports=r(286)},function(e,t,r){var n=r(287);e.exports=n},function(e,t,r){r(288);var n=r(12).Object;e.exports=function(e){return n.getOwnPropertyNames(e)}},function(e,t,r){var n=r(2),i=r(9),o=r(164).f;n({target:"Object",stat:!0,forced:i((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:o})},function(e,t,r){r(203),r(73),r(88),r(295),r(204),r(205),r(306),r(105);var n=r(12);e.exports=n.Promise},function(e,t,r){var n=r(25),i=r(172),o=r(65),s=r(41);e.exports=function(e,t,r){for(var a=i(t),c=s.f,u=o.f,l=0;l<a.length;l++){var d=a[l];n(e,d)||r&&n(r,d)||c(e,d,u(t,d))}}},function(e,t,r){var n=r(7)("".replace),i=String(Error("zxcasd").stack),o=/\n\s*at [^:]*:[^\n]*/,s=o.test(i);e.exports=function(e,t){if(s&&"string"==typeof e)for(;t--;)e=n(e,o,"");return e}},function(e,t,r){var n=r(28),i=r(45);e.exports=function(e,t){n(t)&&"cause"in t&&i(e,"cause",t.cause)}},function(e,t,r){var n=r(43);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},function(e,t,r){var n=r(9),i=r(54);e.exports=!n((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)}))},function(e,t,r){var n,i,o,s,a=r(2),c=r(55),u=r(1),l=r(37),d=r(31),p=r(176),m=r(72),f=r(296),h=r(136),g=r(90),v=r(297),y=r(40),b=r(21),S=r(28),T=r(298),_=r(130),w=r(106),M=r(177),x=r(178),E=r(179).set,C=r(300),R=r(182),k=r(303),A=r(93),I=r(115),O=r(304),P=r(103),N=r(157),D=r(18),L=r(305),j=r(108),U=r(67),F=D("species"),$="Promise",B=P.getterFor($),V=P.set,H=P.getterFor($),W=p&&p.prototype,q=p,z=W,G=u.TypeError,J=u.document,K=u.process,Q=A.f,Y=Q,X=!!(J&&J.createEvent&&u.dispatchEvent),Z=b(u.PromiseRejectionEvent),ee=!1,te=N($,(function(){var e=_(q),t=e!==String(q);if(!t&&66===U)return!0;if(c&&!z.finally)return!0;if(U>=51&&/native code/.test(e))return!1;var r=new q((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[F]=n,!(ee=r.then((function(){}))instanceof n)||!t&&L&&!Z})),re=te||!M((function(e){q.all(e).catch((function(){}))})),ne=function(e){var t;return!(!S(e)||!b(t=e.then))&&t},ie=function(e,t){var r,n,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{a?(s||(2===t.rejection&&ue(t),t.rejection=1),!0===a?r=o:(l&&l.enter(),r=a(o),l&&(l.exit(),i=!0)),r===e.promise?u(G("Promise-chain cycle")):(n=ne(r))?d(n,r,c,u):c(r)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},oe=function(e,t){e.notified||(e.notified=!0,C((function(){for(var r,n=e.reactions;r=n.get();)ie(r,e);e.notified=!1,t&&!e.rejection&&ae(e)})))},se=function(e,t,r){var n,i;X?((n=J.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!Z&&(i=u["on"+e])?i(n):"unhandledrejection"===e&&k("Unhandled promise rejection",r)},ae=function(e){d(E,u,(function(){var t,r=e.facade,n=e.value;if(ce(e)&&(t=I((function(){j?K.emit("unhandledRejection",n,r):se("unhandledrejection",r,n)})),e.rejection=j||ce(e)?2:1,t.error))throw t.value}))},ce=function(e){return 1!==e.rejection&&!e.parent},ue=function(e){d(E,u,(function(){var t=e.facade;j?K.emit("rejectionHandled",t):se("rejectionhandled",t,e.value)}))},le=function(e,t,r){return function(n){e(t,n,r)}},de=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,oe(e,!0))},pe=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw G("Promise can't be resolved itself");var n=ne(t);n?C((function(){var r={done:!1};try{d(n,t,le(pe,r,e),le(de,r,e))}catch(t){de(r,t,e)}})):(e.value=t,e.state=1,oe(e,!1))}catch(t){de({done:!1},t,e)}}};if(te&&(z=(q=function(e){T(this,z),y(e),d(n,this);var t=B(this);try{e(le(pe,t),le(de,t))}catch(e){de(t,e)}}).prototype,(n=function(e){V(this,{type:$,done:!1,notified:!1,parent:!1,reactions:new O,rejection:!1,state:0,value:void 0})}).prototype=f(z,{then:function(e,t){var r=H(this),n=Q(x(this,q));return r.parent=!0,n.ok=!b(e)||e,n.fail=b(t)&&t,n.domain=j?K.domain:void 0,0==r.state?r.reactions.add(n):C((function(){ie(n,r)})),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=B(e);this.promise=e,this.resolve=le(pe,t),this.reject=le(de,t)},A.f=Q=function(e){return e===q||e===o?new i(e):Y(e)},!c&&b(p)&&W!==Object.prototype)){s=W.then,ee||(m(W,"then",(function(e,t){var r=this;return new q((function(e,t){d(s,r,e,t)})).then(e,t)}),{unsafe:!0}),m(W,"catch",z.catch,{unsafe:!0}));try{delete W.constructor}catch(e){}h&&h(W,z)}a({global:!0,wrap:!0,forced:te},{Promise:q}),g(q,$,!1,!0),v($),o=l($),a({target:$,stat:!0,forced:te},{reject:function(e){var t=Q(this);return d(t.reject,void 0,e),t.promise}}),a({target:$,stat:!0,forced:c||te},{resolve:function(e){return R(c&&this===o?q:this,e)}}),a({target:$,stat:!0,forced:re},{all:function(e){var t=this,r=Q(t),n=r.resolve,i=r.reject,o=I((function(){var r=y(t.resolve),o=[],s=0,a=1;w(e,(function(e){var c=s++,u=!1;a++,d(r,t,e).then((function(e){u||(u=!0,o[c]=e,--a||n(o))}),i)})),--a||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=Q(t),n=r.reject,i=I((function(){var i=y(t.resolve);w(e,(function(e){d(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},function(e,t,r){var n=r(72);e.exports=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:n(e,i,t[i],r);return e}},function(e,t,r){var n=r(37),i=r(41),o=r(18),s=r(24),a=o("species");e.exports=function(e){var t=n(e),r=i.f;s&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(1),i=r(16),o=n.TypeError;e.exports=function(e,t){if(i(t,e))return e;throw o("Incorrect invocation")}},function(e,t,r){var n=r(1),i=r(100),o=r(98),s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a constructor")}},function(e,t,r){var n,i,o,s,a,c,u,l,d=r(1),p=r(68),m=r(65).f,f=r(179).set,h=r(181),g=r(301),v=r(302),y=r(108),b=d.MutationObserver||d.WebKitMutationObserver,S=d.document,T=d.process,_=d.Promise,w=m(d,"queueMicrotask"),M=w&&w.value;M||(n=function(){var e,t;for(y&&(e=T.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?s():o=void 0,e}}o=void 0,e&&e.enter()},h||y||v||!b||!S?!g&&_&&_.resolve?((u=_.resolve(void 0)).constructor=_,l=p(u.then,u),s=function(){l(n)}):y?s=function(){T.nextTick(n)}:(f=p(f,d),s=function(){f(n)}):(a=!0,c=S.createTextNode(""),new b(n).observe(c,{characterData:!0}),s=function(){c.data=a=!a})),e.exports=M||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,s()),o=t}},function(e,t,r){var n=r(44),i=r(1);e.exports=/ipad|iphone|ipod/i.test(n)&&void 0!==i.Pebble},function(e,t,r){var n=r(44);e.exports=/web0s(?!.*chrome)/i.test(n)},function(e,t,r){var n=r(1);e.exports=function(e,t){var r=n.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}},function(e,t){var r=function(){this.head=null,this.tail=null};r.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=r},function(e,t){e.exports="object"==typeof window},function(e,t,r){var n=r(2),i=r(55),o=r(176),s=r(9),a=r(37),c=r(21),u=r(178),l=r(182),d=r(72);if(n({target:"Promise",proto:!0,real:!0,forced:!!o&&s((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=u(this,a("Promise")),r=c(e);return this.then(r?function(r){return l(t,e()).then((function(){return r}))}:e,r?function(r){return l(t,e()).then((function(){throw r}))}:e)}}),!i&&c(o)){var p=a("Promise").prototype.finally;o.prototype.finally!==p&&d(o.prototype,"finally",p,{unsafe:!0})}},function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function o(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,n||e,o),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},u.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,n,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,o),!0;case 6:return l.fn.call(l.context,t,r,n,o,s),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,m=l.length;for(u=0;u<m;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,n);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,n){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return c(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||n&&!s.once||r&&s.context!==r||c(this,o);else{for(var a=0,u=[],l=s.length;a<l;a++)(s[a].fn!==t||n&&!s[a].once||r&&s[a].context!==r)&&u.push(s[a]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&c(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,e.exports=u},function(e,t,r){r(105),r(309);var n=r(12);e.exports=n.Array.from},function(e,t,r){var n=r(2),i=r(310);n({target:"Array",stat:!0,forced:!r(177)((function(e){Array.from(e)}))},{from:i})},function(e,t,r){var n=r(1),i=r(68),o=r(31),s=r(33),a=r(311),c=r(173),u=r(100),l=r(38),d=r(71),p=r(174),m=r(107),f=n.Array;e.exports=function(e){var t=s(e),r=u(this),n=arguments.length,h=n>1?arguments[1]:void 0,g=void 0!==h;g&&(h=i(h,n>2?arguments[2]:void 0));var v,y,b,S,T,_,w=m(t),M=0;if(!w||this==f&&c(w))for(v=l(t),y=r?new this(v):f(v);v>M;M++)_=g?h(t[M],M):t[M],d(y,M,_);else for(T=(S=p(t,w)).next,y=r?new this:[];!(b=o(T,S)).done;M++)_=g?a(S,h,[b.value,M],!0):b.value,d(y,M,_);return y.length=M,y}},function(e,t,r){var n=r(34),i=r(175);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},function(e,t,r){var n=r(313);e.exports=n},function(e,t,r){var n=r(314);e.exports=n},function(e,t,r){var n=r(315);r(56),e.exports=n},function(e,t,r){r(73),r(105);var n=r(107);e.exports=n},function(e,t,r){r(163);var n=r(12);e.exports=n.Object.getOwnPropertySymbols},function(e,t,r){var n=r(318);e.exports=n},function(e,t,r){r(319);var n=r(12).Object,i=e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)};n.getOwnPropertyDescriptor.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(9),o=r(35),s=r(65).f,a=r(24),c=i((function(){s(1)}));n({target:"Object",stat:!0,forced:!a||c,sham:!a},{getOwnPropertyDescriptor:function(e,t){return s(o(e),t)}})},function(e,t,r){var n=r(321);e.exports=n},function(e,t,r){r(322);var n=r(12);e.exports=n.Object.getOwnPropertyDescriptors},function(e,t,r){var n=r(2),i=r(24),o=r(172),s=r(35),a=r(65),c=r(71);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=s(e),i=a.f,u=o(n),l={},d=0;u.length>d;)void 0!==(r=i(n,t=u[d++]))&&c(l,t,r);return l}})},function(e,t,r){var n=r(324);e.exports=n},function(e,t,r){r(325);var n=r(12).Object,i=e.exports=function(e,t){return n.defineProperties(e,t)};n.defineProperties.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(24),o=r(131).f;n({target:"Object",stat:!0,forced:Object.defineProperties!==o,sham:!i},{defineProperties:o})},function(e,t,r){r(327);var n=r(12).Object,i=e.exports=function(e,t,r){return n.defineProperty(e,t,r)};n.defineProperty.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(24),o=r(41).f;n({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!i},{defineProperty:o})},function(e,t,r){var n=r(329);e.exports=n},function(e,t,r){var n=r(185);e.exports=n},function(e,t,r){var n=r(16),i=r(331),o=Array.prototype;e.exports=function(e){var t=e.slice;return e===o||n(o,e)&&t===o.slice?i:t}},function(e,t,r){r(332);var n=r(22);e.exports=n("Array").slice},function(e,t,r){var n=r(2),i=r(1),o=r(70),s=r(100),a=r(28),c=r(99),u=r(38),l=r(35),d=r(71),p=r(18),m=r(86),f=r(89),h=m("slice"),g=p("species"),v=i.Array,y=Math.max;n({target:"Array",proto:!0,forced:!h},{slice:function(e,t){var r,n,i,p=l(this),m=u(p),h=c(e,m),b=c(void 0===t?m:t,m);if(o(p)&&(r=p.constructor,(s(r)&&(r===v||o(r.prototype))||a(r)&&null===(r=r[g]))&&(r=void 0),r===v||void 0===r))return f(p,h,b);for(n=new(void 0===r?v:r)(y(b-h,0)),i=0;h<b;h++,i++)h in p&&d(n,i,p[h]);return n.length=i,n}})},function(e,t,r){r(334);var n=r(12);e.exports=n.Object.keys},function(e,t,r){var n=r(2),i=r(33),o=r(92);n({target:"Object",stat:!0,forced:r(9)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},function(e,t,r){var n=r(336);e.exports=n},function(e,t,r){var n=r(16),i=r(337),o=Array.prototype;e.exports=function(e){var t=e.some;return e===o||n(o,e)&&t===o.some?i:t}},function(e,t,r){r(338);var n=r(22);e.exports=n("Array").some},function(e,t,r){var n=r(2),i=r(78).some;n({target:"Array",proto:!0,forced:!r(69)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(340);e.exports=n},function(e,t,r){var n=r(16),i=r(341),o=Array.prototype;e.exports=function(e){var t=e.splice;return e===o||n(o,e)&&t===o.splice?i:t}},function(e,t,r){r(342);var n=r(22);e.exports=n("Array").splice},function(e,t,r){var n=r(2),i=r(1),o=r(99),s=r(85),a=r(38),c=r(33),u=r(128),l=r(71),d=r(86)("splice"),p=i.TypeError,m=Math.max,f=Math.min;n({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var r,n,i,d,h,g,v=c(this),y=a(v),b=o(e,y),S=arguments.length;if(0===S?r=n=0:1===S?(r=0,n=y-b):(r=S-2,n=f(m(s(t),0),y-b)),y+r-n>9007199254740991)throw p("Maximum allowed length exceeded");for(i=u(v,n),d=0;d<n;d++)(h=b+d)in v&&l(i,d,v[h]);if(i.length=n,r<n){for(d=b;d<y-n;d++)g=d+r,(h=d+n)in v?v[g]=v[h]:delete v[g];for(d=y;d>y-n+r;d--)delete v[d-1]}else if(r>n)for(d=y-n;d>b;d--)g=d+r-1,(h=d+n-1)in v?v[g]=v[h]:delete v[g];for(d=0;d<r;d++)v[d+b]=arguments[d+2];return v.length=y-n+r,i}})},function(e,t,r){var n=r(344);e.exports=n},function(e,t,r){var n=r(16),i=r(345),o=Array.prototype;e.exports=function(e){var t=e.sort;return e===o||n(o,e)&&t===o.sort?i:t}},function(e,t,r){r(346);var n=r(22);e.exports=n("Array").sort},function(e,t,r){var n=r(2),i=r(7),o=r(40),s=r(33),a=r(38),c=r(43),u=r(9),l=r(347),d=r(69),p=r(348),m=r(349),f=r(67),h=r(350),g=[],v=i(g.sort),y=i(g.push),b=u((function(){g.sort(void 0)})),S=u((function(){g.sort(null)})),T=d("sort"),_=!u((function(){if(f)return f<70;if(!(p&&p>3)){if(m)return!0;if(h)return h<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)g.push({k:t+n,v:r})}for(g.sort((function(e,t){return t.v-e.v})),n=0;n<g.length;n++)t=g[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));n({target:"Array",proto:!0,forced:b||!S||!T||!_},{sort:function(e){void 0!==e&&o(e);var t=s(this);if(_)return void 0===e?v(t):v(t,e);var r,n,i=[],u=a(t);for(n=0;n<u;n++)n in t&&y(i,t[n]);for(l(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:c(t)>c(r)?1:-1}}(e)),r=i.length,n=0;n<r;)t[n]=i[n++];for(;n<u;)delete t[n++];return t}})},function(e,t,r){var n=r(165),i=Math.floor,o=function(e,t){var r=e.length,c=i(r/2);return r<8?s(e,t):a(e,o(n(e,0,c),t),o(n(e,c),t),t)},s=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},a=function(e,t,r,n){for(var i=t.length,o=r.length,s=0,a=0;s<i||a<o;)e[s+a]=s<i&&a<o?n(t[s],r[a])<=0?t[s++]:r[a++]:s<i?t[s++]:r[a++];return e};e.exports=o},function(e,t,r){var n=r(44).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},function(e,t,r){var n=r(44);e.exports=/MSIE|Trident/.test(n)},function(e,t,r){var n=r(44).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},function(e,t,r){var n=r(352);e.exports=n},function(e,t,r){var n=r(16),i=r(353),o=Array.prototype;e.exports=function(e){var t=e.map;return e===o||n(o,e)&&t===o.map?i:t}},function(e,t,r){r(354);var n=r(22);e.exports=n("Array").map},function(e,t,r){var n=r(2),i=r(78).map;n({target:"Array",proto:!0,forced:!r(86)("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(356);e.exports=n},function(e,t,r){r(357);var n=r(12),i=r(53);n.JSON||(n.JSON={stringify:JSON.stringify}),e.exports=function(e,t,r){return i(n.JSON.stringify,null,arguments)}},function(e,t,r){var n=r(2),i=r(1),o=r(37),s=r(53),a=r(7),c=r(9),u=i.Array,l=o("JSON","stringify"),d=a(/./.exec),p=a("".charAt),m=a("".charCodeAt),f=a("".replace),h=a(1..toString),g=/[\uD800-\uDFFF]/g,v=/^[\uD800-\uDBFF]$/,y=/^[\uDC00-\uDFFF]$/,b=function(e,t,r){var n=p(r,t-1),i=p(r,t+1);return d(v,e)&&!d(y,i)||d(y,e)&&!d(v,n)?"\\u"+h(m(e,0),16):e},S=c((function(){return'"\\udf06\\ud834"'!==l("\udf06\ud834")||'"\\udead"'!==l("\udead")}));l&&n({target:"JSON",stat:!0,forced:S},{stringify:function(e,t,r){for(var n=0,i=arguments.length,o=u(i);n<i;n++)o[n]=arguments[n];var a=s(l,null,o);return"string"==typeof a?f(a,g,b):a}})},function(e,t,r){var n=r(359);e.exports=n},function(e,t,r){var n=r(16),i=r(360),o=Array.prototype;e.exports=function(e){var t=e.reduce;return e===o||n(o,e)&&t===o.reduce?i:t}},function(e,t,r){r(361);var n=r(22);e.exports=n("Array").reduce},function(e,t,r){var n=r(2),i=r(362).left,o=r(69),s=r(67),a=r(108);n({target:"Array",proto:!0,forced:!o("reduce")||!a&&s>79&&s<83},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(1),i=r(40),o=r(33),s=r(96),a=r(38),c=n.TypeError,u=function(e){return function(t,r,n,u){i(r);var l=o(t),d=s(l),p=a(l),m=e?p-1:0,f=e?-1:1;if(n<2)for(;;){if(m in d){u=d[m],m+=f;break}if(m+=f,e?m<0:p<=m)throw c("Reduce of empty array with no initial value")}for(;e?m>=0:p>m;m+=f)m in d&&(u=r(u,d[m],m,l));return u}};e.exports={left:u(!1),right:u(!0)}},function(e,t,r){var n=r(364);e.exports=n},function(e,t,r){var n=r(16),i=r(365),o=Array.prototype;e.exports=function(e){var t=e.lastIndexOf;return e===o||n(o,e)&&t===o.lastIndexOf?i:t}},function(e,t,r){r(366);var n=r(22);e.exports=n("Array").lastIndexOf},function(e,t,r){var n=r(2),i=r(367);n({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},function(e,t,r){var n=r(53),i=r(35),o=r(85),s=r(38),a=r(69),c=Math.min,u=[].lastIndexOf,l=!!u&&1/[1].lastIndexOf(1,-0)<0,d=a("lastIndexOf"),p=l||!d;e.exports=p?function(e){if(l)return n(u,this,arguments)||0;var t=i(this),r=s(t),a=r-1;for(arguments.length>1&&(a=c(a,o(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===e)return a||0;return-1}:u},function(e,t,r){r(188);var n=r(12);e.exports=n.setTimeout},function(e,t,r){var n=r(370);e.exports=n},function(e,t,r){var n=r(16),i=r(371),o=Array.prototype;e.exports=function(e){var t=e.filter;return e===o||n(o,e)&&t===o.filter?i:t}},function(e,t,r){r(372);var n=r(22);e.exports=n("Array").filter},function(e,t,r){var n=r(2),i=r(78).filter;n({target:"Array",proto:!0,forced:!r(86)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(374)},function(e,t,r){r(56);var n=r(46),i=r(25),o=r(16),s=r(375),a=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.values;return e===a||o(a,e)&&t===a.values||i(c,n(e))?s:t}},function(e,t,r){var n=r(376);e.exports=n},function(e,t,r){r(73),r(88);var n=r(22);e.exports=n("Array").values},function(e,t,r){var n=r(14);"undefined"!=typeof window&&(window.console||n.isWeixinApp||(window.console={log:function(){},info:function(){},warn:function(){},error:function(){}}))},function(e,t,r){var n=r(208),i=r(190);e.exports=function(e){if(n(e))return i(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(380);e.exports=n},function(e,t,r){var n=r(171);e.exports=n},function(e,t,r){var n=r(145),i=r(75),o=r(191);e.exports=function(e){if(void 0!==n&&null!=i(e)||null!=e["@@iterator"])return o(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(383);e.exports=n},function(e,t,r){var n=r(183);e.exports=n},function(e,t,r){e.exports=r(385)},function(e,t,r){var n=r(386);e.exports=n},function(e,t,r){var n=r(186);e.exports=n},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(3),i=r(10),o=r(6),s=r(76),a=r(11),c=r(17),u=r(13),l=r(4),d=r(62),p=r(0),m=r(14),f=r(39),h={};function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!e.logLevel&&e.debug&&(e.logLevel="debug"),p.merge(this,{options:e,debugEnable:!1,api:"log",style:"color:blue;",logLevel:e.logLevel&&e.logLevel.toLowerCase()||"off",debug:p.emptyFunc,log:p.emptyFunc,info:p.emptyFunc,warn:p.emptyFunc,error:p.emptyFunc}),this.prefix=e.prefix||"",this.localEnable=h.enable&&e.dbLog&&e.account,this.setDebug(e.debug),this.localEnable&&(this._local=new h(e.account,e.expire),this._local.logError=this.error)}h=r(397);var v=g.prototype,y=["Chrome","Safari","Firefox"],b={debug:1e3,log:2e3,info:3e3,warn:4e3,error:5e3,off:6e3};function S(e){var t,r=[];return n(t=i(b)).call(t,(function(t){b[t]>=b[e]&&r.push(t)})),r}v.setDebug=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;if(t.debugEnable=e||"debug"===t.logLevel,e.style&&(t.style=e.style),p.exist(console))if("off"!==t.logLevel){var r=console,i=S(t.logLevel);n(i).call(i,(function(e){t[e]=function(){var r=t.formatArgsAndSave(arguments,e);-1!==o(y).call(y,d.name)&&p.isString(r[0])&&(r[0]="%c"+r[0],s(r).call(r,1,0,t.style)),t._log(e,r)}})),t.options.logFunc?t._log=function(){}:t._log=function(e,n){if("debug"===e&&(e="log"),r[e])try{r[e].apply?t.chrome(e,n):t.ie(e,n)}catch(e){}},t.chrome=function(e,n){-1!==o(y).call(y,d.name)?r[e].apply(r,n):t.ie(e,n)},t.ie=function(e,t){n(t).call(t,(function(t){r[e](a(t,null,4))}))}}else if(m.isRN||this.localEnable||this.options.logFunc){var c=!m.isRN&&!this.localEnable;t.log=function(){t.formatArgsAndSave(arguments,"log",c)},t.info=function(){t.formatArgsAndSave(arguments,"info",c)},t.warn=function(){t.formatArgsAndSave(arguments,"warn",c)},t.error=function(){t.formatArgsAndSave(arguments,"error",c)},t.debug=function(){t.formatArgsAndSave(arguments,"error",c)}}},v.setLogDisabled=function(){this.localEnable=!1,this.log=function(){},this.info=function(){},this.warn=function(){},this.error=function(){},this.debug=function(){}},v.formatArgsAndSave=function(e,t,r){var i,o;e=c([]).call(e,0);var l=new Date,d=T(l.getMonth()+1)+"-"+T(l.getDate())+" "+T(l.getHours())+":"+T(l.getMinutes())+":"+T(l.getSeconds())+":"+T(l.getMilliseconds(),3),m=u(i=u(o="[NIM ".concat(t.toUpperCase()," ")).call(o,d," ")).call(i,this.prefix.toUpperCase(),"]  "),f="";p.isString(e[0])?e[0]=m+e[0]:s(e).call(e,0,0,m),n(e).call(e,(function(t,r){p.isArray(t)||p.isObject(t)?(e[r]=p.simpleClone(t),f+=a(e[r])+" "):f+=t+" "}));var h=this.options.logFunc;return h&&p.isFunction(h[t])&&h[t].apply(h,e),!r&&this.writeLocalLog(f,t,+l),e},v.writeLocalLog=m.isRN?function(e,t){if(f.rnfs&&f.rnfs.writeFile&&f.rnfs.appendFile&&f.rnfs.DocumentDirectoryPath&&/error|warn|info/.test(t)){var r,n=f.rnfs,i=n.size/2-256;e+="\r\n",n.nimPromise=n.nimPromise.then((function(){return r=o(n.nimIndex),n.exists(r)})).then((function(t){return t?n.appendFile(r,e):n.writeFile(r,e)})).then((function(){return n.stat(r)})).then((function(e){if(e.size>i)return n.nimIndex++,n.nimIndex>1&&(n.nimIndex=n.nimIndex%2),n.unlink(o(n.nimIndex)).catch((function(){return l.resolve()}))})).catch((function(){}))}function o(e){return f.rnfs.DocumentDirectoryPath+"/nimlog_"+e+".log"}}:m.isBrowser?function(e,t,r){this._local&&this._local.saveLog({log:e,level:t,time:r})}:function(){};var T=function(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r};e.exports=g},function(e,t,r){var n=r(390);e.exports=n},function(e,t,r){r(391);var n=r(12);e.exports=n.parseFloat},function(e,t,r){var n=r(2),i=r(392);n({global:!0,forced:parseFloat!=i},{parseFloat:i})},function(e,t,r){var n=r(1),i=r(9),o=r(7),s=r(43),a=r(137).trim,c=r(111),u=o("".charAt),l=n.parseFloat,d=n.Symbol,p=d&&d.iterator,m=1/l(c+"-0")!=-1/0||p&&!i((function(){l(Object(p))}));e.exports=m?function(e){var t=a(s(e)),r=l(t);return 0===r&&"-"==u(t,0)?-0:r}:l},function(e,t,r){var n=r(394);e.exports=n},function(e,t,r){r(395);var n=r(12);e.exports=n.parseInt},function(e,t,r){var n=r(2),i=r(396);n({global:!0,forced:parseInt!=i},{parseInt:i})},function(e,t,r){var n=r(1),i=r(9),o=r(7),s=r(43),a=r(137).trim,c=r(111),u=n.parseInt,l=n.Symbol,d=l&&l.iterator,p=/^[+-]?0x/i,m=o(p.exec),f=8!==u(c+"08")||22!==u(c+"0x16")||d&&!i((function(){u(Object(d))}));e.exports=f?function(e,t){var r=a(s(e));return u(r,t>>>0||(m(p,r)?16:10))}:u},function(e,t,r){var n=r(17),i=r(4),o=r(398),s=r(399),a=r(0).getGlobal(),c=r(62).name,u="function"==typeof o,l=a.indexedDB&&!/^(IE)$/.test(c);function d(e,t){this.logWorker=null,this.db=null,this.logQueue=[],this.callbackList=[],this.preTime=null,this.lastTime=+new Date,this.initLogLocal({name:e,expire:t})}var p=d.prototype;d.enable=!0,p.saveLog=function(e){var t,r=this.logQueue.length,i=this.logQueue[r-1];e.time!==this.preTime?((this.logQueue.length>50||e.time-this.lastTime>6e4&&this.logQueue.length>0)&&(this.doSaveLog(n(t=this.logQueue).call(t,0)),this.lastTime=i.time,this.logQueue=[]),this.logQueue.push(e),this.preTime=e.time):i.log+="\r\n"+e.log},p.doSaveLog=function(){},p.initLogLocal=function(){},p.fetchLog=function(){},p.deleteLogs=function(){},p.logError=function(){},l?u?(p.doSaveLog=function(e){this.logWorker.postMessage(e)},p.initLogLocal=function(e){var t=this;this.logWorker=new o({}),this.logWorker.onmessage=function(e){var r=e.data||{};switch(r.type){case"fetchDone":t.fetchLogDone(r.code,r.msg);break;case"error":t.logError(r.msg)}},this.logWorker.postMessage({type:"init",msg:e})},p.fetchLog=function(){var e=this;return new i((function(t,r){0===e.callbackList.length&&e.logWorker.postMessage({type:"fetch"}),e.callbackList.push(t),e.callbackList.push(r)}))},p.fetchLogDone=function(e,t){for(var r=200===e?0:1,n=0;n<this.callbackList.length/2;n++)this.callbackList[2*n+r](t);this.callbackList=[]},p.deleteLogs=function(e){return this.logWorker.postMessage({type:"delete",msg:e}),i.resolve()}):(p.doSaveLog=function(e){var t=this;this.db.putLog(e).catch((function(e){t.logError({msg:"putLog error",error:e})}))},p.initLogLocal=function(e){var t=this;this.db=new s(e),this.db.init().catch((function(e){t.logError({msg:"dbLog init error",error:e})}))},p.fetchLog=function(){return this.db.getAllLogs()},p.deleteLogs=function(e){return this.db.deleteLogs(e)}):d.enable=!1,e.exports=d},function(e,t,r){r.r(t),r.d(t,"default",(function(){return o}));var n=r(200),i=r.n(n);function o(){return i()('!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=98)}([function(t,n,e){(function(n){var e=function(t){return t&&t.Math==Math&&t};t.exports=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof n&&n)||function(){return this}()||Function("return this")()}).call(this,e(74))},function(t,n,e){var r=e(15),o=e(7),i=e(72),c=e(14).f;t.exports=function(t){var n=r.Symbol||(r.Symbol={});o(n,t)||c(n,t,{value:i.f(t)})}},function(t,n,e){var r=e(0),o=e(52),i=e(7),c=e(54),u=e(50),a=e(77),f=o("wks"),s=r.Symbol,p=s&&s.for,l=a?s:s&&s.withoutSetter||c;t.exports=function(t){if(!i(f,t)||!u&&"string"!=typeof f[t]){var n="Symbol."+t;u&&i(s,t)?f[t]=s[t]:f[t]=a&&p?p(n):l(n)}return f[t]}},function(t,n){t.exports=function(t){return"function"==typeof t}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(31),o=Function.prototype,i=o.bind,c=o.call,u=r&&i.bind(c,c);t.exports=r?function(t){return t&&u(t)}:function(t){return t&&function(){return c.apply(t,arguments)}}},function(t,n,e){"use strict";var r=e(0),o=e(47),i=e(5),c=e(3),u=e(32).f,a=e(79),f=e(15),s=e(27),p=e(17),l=e(7),v=function(t){var n=function(e,r,i){if(this instanceof n){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,i)}return o(t,this,arguments)};return n.prototype=t.prototype,n};t.exports=function(t,n){var e,o,d,h,y,m,g,x,b=t.target,w=t.global,j=t.stat,S=t.proto,O=w?r:j?r[b]:(r[b]||{}).prototype,P=w?f:f[b]||p(f,b,{})[b],A=P.prototype;for(d in n)e=!a(w?d:b+(j?".":"#")+d,t.forced)&&O&&l(O,d),y=P[d],e&&(m=t.noTargetGet?(x=u(O,d))&&x.value:O[d]),h=e&&m?m:n[d],e&&typeof y==typeof h||(g=t.bind&&e?s(h,r):t.wrap&&e?v(h):S&&c(h)?i(h):h,(t.sham||h&&h.sham||y&&y.sham)&&p(g,"sham",!0),p(P,d,g),S&&(l(f,o=b+"Prototype")||p(f,o,{}),p(f[o],d,h),t.real&&A&&!A[d]&&p(A,d,h)))}},function(t,n,e){var r=e(5),o=e(21),i=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,n){return i(o(t),n)}},function(t,n,e){var r=e(3);t.exports=function(t){return"object"==typeof t?null!==t:r(t)}},function(t,n,e){var r=e(4);t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,n,e){var r=e(31),o=Function.prototype.call;t.exports=r?o.bind(o):function(){return o.apply(o,arguments)}},function(t,n,e){var r=e(0),o=e(8),i=r.String,c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not an object")}},function(t,n,e){var r=e(15),o=e(0),i=e(3),c=function(t){return i(t)?t:void 0};t.exports=function(t,n){return arguments.length<2?c(r[t])||c(o[t]):r[t]&&r[t][n]||o[t]&&o[t][n]}},function(t,n,e){var r=e(5);t.exports=r({}.isPrototypeOf)},function(t,n,e){var r=e(0),o=e(9),i=e(78),c=e(80),u=e(11),a=e(33),f=r.TypeError,s=Object.defineProperty,p=Object.getOwnPropertyDescriptor;n.f=o?c?function(t,n,e){if(u(t),n=a(n),u(e),"function"==typeof t&&"prototype"===n&&"value"in e&&"writable"in e&&!e.writable){var r=p(t,n);r&&r.writable&&(t[n]=e.value,e={configurable:"configurable"in e?e.configurable:r.configurable,enumerable:"enumerable"in e?e.enumerable:r.enumerable,writable:!1})}return s(t,n,e)}:s:function(t,n,e){if(u(t),n=a(n),u(e),i)try{return s(t,n,e)}catch(t){}if("get"in e||"set"in e)throw f("Accessors not supported");return"value"in e&&(t[n]=e.value),t}},function(t,n){t.exports={}},function(t,n,e){var r=e(76),o=e(48);t.exports=function(t){return r(o(t))}},function(t,n,e){var r=e(9),o=e(14),i=e(18);t.exports=r?function(t,n,e){return o.f(t,n,i(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,e){var r=e(0),o=e(3),i=e(36),c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not a function")}},function(t,n){t.exports=!0},function(t,n,e){var r=e(0),o=e(48),i=r.Object;t.exports=function(t){return i(o(t))}},function(t,n,e){var r=e(111);t.exports=function(t){return r(t.length)}},function(t,n){t.exports={}},function(t,n,e){var r=e(0),o=e(63),i=e(3),c=e(26),u=e(2)("toStringTag"),a=r.Object,f="Arguments"==c(function(){return arguments}());t.exports=o?c:function(t){var n,e,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,n){try{return t[n]}catch(t){}}(n=a(t),u))?e:f?c(n):"Object"==(r=c(n))&&i(n.callee)?"Arguments":r}},function(t,n,e){var r=e(17);t.exports=function(t,n,e,o){o&&o.enumerable?t[n]=e:r(t,n,e)}},function(t,n,e){var r=e(5),o=r({}.toString),i=r("".slice);t.exports=function(t){return i(o(t),8,-1)}},function(t,n,e){var r=e(5),o=e(19),i=e(31),c=r(r.bind);t.exports=function(t,n){return o(t),void 0===n?t:i?c(t,n):function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(63),o=e(14).f,i=e(17),c=e(7),u=e(123),a=e(2)("toStringTag");t.exports=function(t,n,e,f){if(t){var s=e?t:t.prototype;c(s,a)||o(s,a,{configurable:!0,value:n}),f&&!r&&i(s,"toString",u)}}},function(t,n,e){var r=e(26);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){var r=e(15);t.exports=function(t){return r[t+"Prototype"]}},function(t,n,e){var r=e(4);t.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},function(t,n,e){var r=e(9),o=e(10),i=e(75),c=e(18),u=e(16),a=e(33),f=e(7),s=e(78),p=Object.getOwnPropertyDescriptor;n.f=r?p:function(t,n){if(t=u(t),n=a(n),s)try{return p(t,n)}catch(t){}if(f(t,n))return c(!o(i.f,t,n),t[n])}},function(t,n,e){var r=e(103),o=e(49);t.exports=function(t){var n=r(t,"string");return o(n)?n:n+""}},function(t,n,e){var r,o,i=e(0),c=e(35),u=i.process,a=i.Deno,f=u&&u.versions||a&&a.version,s=f&&f.v8;s&&(o=(r=s.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!o&&c&&(!(r=c.match(/Edge\\/(\\d+)/))||r[1]>=74)&&(r=c.match(/Chrome\\/(\\d+)/))&&(o=+r[1]),t.exports=o},function(t,n,e){var r=e(12);t.exports=r("navigator","userAgent")||""},function(t,n,e){var r=e(0).String;t.exports=function(t){try{return r(t)}catch(t){return"Object"}}},function(t,n,e){var r=e(52),o=e(54),i=r("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},function(t,n){t.exports={}},function(t,n,e){var r,o=e(11),i=e(83),c=e(61),u=e(38),a=e(84),f=e(55),s=e(37),p=s("IE_PROTO"),l=function(){},v=function(t){return"<script>"+t+"<\\/script>"},d=function(t){t.write(v("")),t.close();var n=t.parentWindow.Object;return t=null,n},h=function(){try{r=new ActiveXObject("htmlfile")}catch(t){}var t,n;h="undefined"!=typeof document?document.domain&&r?d(r):((n=f("iframe")).style.display="none",a.appendChild(n),n.src=String("javascript:"),(t=n.contentWindow.document).open(),t.write(v("document.F=Object")),t.close(),t.F):d(r);for(var e=c.length;e--;)delete h.prototype[c[e]];return h()};u[p]=!0,t.exports=Object.create||function(t,n){var e;return null!==t?(l.prototype=o(t),e=new l,l.prototype=null,e[p]=t):e=h(),void 0===n?e:i.f(e,n)}},function(t,n,e){var r=e(0),o=e(27),i=e(10),c=e(11),u=e(36),a=e(114),f=e(22),s=e(13),p=e(115),l=e(85),v=e(116),d=r.TypeError,h=function(t,n){this.stopped=t,this.result=n},y=h.prototype;t.exports=function(t,n,e){var r,m,g,x,b,w,j,S=e&&e.that,O=!(!e||!e.AS_ENTRIES),P=!(!e||!e.IS_ITERATOR),A=!(!e||!e.INTERRUPTED),E=o(n,S),k=function(t){return r&&v(r,"normal",t),new h(!0,t)},T=function(t){return O?(c(t),A?E(t[0],t[1],k):E(t[0],t[1])):A?E(t,k):E(t)};if(P)r=t;else{if(!(m=l(t)))throw d(u(t)+" is not iterable");if(a(m)){for(g=0,x=f(t);x>g;g++)if((b=T(t[g]))&&s(y,b))return b;return new h(!1)}r=p(t,m)}for(w=r.next;!(j=i(w,r)).done;){try{b=T(j.value)}catch(t){v(r,"throw",t)}if("object"==typeof b&&b&&s(y,b))return b}return new h(!1)}},function(t,n,e){var r=e(0),o=e(24),i=r.String;t.exports=function(t){if("Symbol"===o(t))throw TypeError("Cannot convert a Symbol value to a string");return i(t)}},function(t,n,e){var r,o,i,c=e(120),u=e(0),a=e(5),f=e(8),s=e(17),p=e(7),l=e(53),v=e(37),d=e(38),h=u.TypeError,y=u.WeakMap;if(c||l.state){var m=l.state||(l.state=new y),g=a(m.get),x=a(m.has),b=a(m.set);r=function(t,n){if(x(m,t))throw new h("Object already initialized");return n.facade=t,b(m,t,n),n},o=function(t){return g(m,t)||{}},i=function(t){return x(m,t)}}else{var w=v("state");d[w]=!0,r=function(t,n){if(p(t,w))throw new h("Object already initialized");return n.facade=t,s(t,w,n),n},o=function(t){return p(t,w)?t[w]:{}},i=function(t){return p(t,w)}}t.exports={set:r,get:o,has:i,enforce:function(t){return i(t)?o(t):r(t,{})},getterFor:function(t){return function(n){var e;if(!f(n)||(e=o(n)).type!==t)throw h("Incompatible receiver, "+t+" required");return e}}}},function(t,n,e){"use strict";var r=e(19),o=function(t){var n,e;this.promise=new t((function(t,r){if(void 0!==n||void 0!==e)throw TypeError("Bad Promise constructor");n=t,e=r})),this.resolve=r(n),this.reject=r(e)};t.exports.f=function(t){return new o(t)}},function(t,n,e){e(64);var r=e(141),o=e(0),i=e(24),c=e(17),u=e(23),a=e(2)("toStringTag");for(var f in r){var s=o[f],p=s&&s.prototype;p&&i(p)!==a&&c(p,a,f),u[f]=u.Array}},function(t,n,e){var r=e(4),o=e(2),i=e(34),c=o("species");t.exports=function(t){return i>=51||!r((function(){var n=[];return(n.constructor={})[c]=function(){return{foo:1}},1!==n[t](Boolean).foo}))}},function(t,n,e){var r=e(27),o=e(5),i=e(76),c=e(21),u=e(22),a=e(95),f=o([].push),s=function(t){var n=1==t,e=2==t,o=3==t,s=4==t,p=6==t,l=7==t,v=5==t||p;return function(d,h,y,m){for(var g,x,b=c(d),w=i(b),j=r(h,y),S=u(w),O=0,P=m||a,A=n?P(d,S):e||l?P(d,0):void 0;S>O;O++)if((v||O in w)&&(x=j(g=w[O],O,b),t))if(n)A[O]=x;else if(x)switch(t){case 3:return!0;case 5:return g;case 6:return O;case 2:f(A,g)}else switch(t){case 4:return!1;case 7:f(A,g)}return p?-1:o||s?s:A}};t.exports={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6),filterReject:s(7)}},function(t,n,e){var r=e(31),o=Function.prototype,i=o.apply,c=o.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?c.bind(i):function(){return c.apply(i,arguments)})},function(t,n,e){var r=e(0).TypeError;t.exports=function(t){if(null==t)throw r("Can\'t call method on "+t);return t}},function(t,n,e){var r=e(0),o=e(12),i=e(3),c=e(13),u=e(77),a=r.Object;t.exports=u?function(t){return"symbol"==typeof t}:function(t){var n=o("Symbol");return i(n)&&c(n.prototype,a(t))}},function(t,n,e){var r=e(34),o=e(4);t.exports=!!Object.getOwnPropertySymbols&&!o((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},function(t,n,e){var r=e(19);t.exports=function(t,n){var e=t[n];return null==e?void 0:r(e)}},function(t,n,e){var r=e(20),o=e(53);(t.exports=function(t,n){return o[t]||(o[t]=void 0!==n?n:{})})("versions",[]).push({version:"3.21.1",mode:r?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(t,n,e){var r=e(0),o=e(105),i=r["__core-js_shared__"]||o("__core-js_shared__",{});t.exports=i},function(t,n,e){var r=e(5),o=0,i=Math.random(),c=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+c(++o+i,36)}},function(t,n,e){var r=e(0),o=e(8),i=r.document,c=o(i)&&o(i.createElement);t.exports=function(t){return c?i.createElement(t):{}}},function(t,n,e){var r=e(0),o=e(7),i=e(3),c=e(21),u=e(37),a=e(106),f=u("IE_PROTO"),s=r.Object,p=s.prototype;t.exports=a?s.getPrototypeOf:function(t){var n=c(t);if(o(n,f))return n[f];var e=n.constructor;return i(e)&&n instanceof e?e.prototype:n instanceof s?p:null}},function(t,n,e){var r=e(5),o=e(11),i=e(107);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,n=!1,e={};try{(t=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(e,[]),n=e instanceof Array}catch(t){}return function(e,r){return o(e),i(r),n?t(e,r):e.__proto__=r,e}}():void 0)},function(t,n,e){var r=e(81),o=e(61).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n,e){var r=e(60),o=Math.max,i=Math.min;t.exports=function(t,n){var e=r(t);return e<0?o(e+n,0):i(e,n)}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){var n=+t;return n!=n||0===n?0:(n>0?r:e)(n)}},function(t,n){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,n,e){var r=e(81),o=e(61);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r={};r[e(2)("toStringTag")]="z",t.exports="[object z]"===String(r)},function(t,n,e){"use strict";var r=e(16),o=e(119),i=e(23),c=e(42),u=e(14).f,a=e(86),f=e(20),s=e(9),p=c.set,l=c.getterFor("Array Iterator");t.exports=a(Array,"Array",(function(t,n){p(this,{type:"Array Iterator",target:r(t),index:0,kind:n})}),(function(){var t=l(this),n=t.target,e=t.kind,r=t.index++;return!n||r>=n.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==e?{value:r,done:!1}:"values"==e?{value:n[r],done:!1}:{value:[r,n[r]],done:!1}}),"values");var v=i.Arguments=i.Array;if(o("keys"),o("values"),o("entries"),!f&&s&&"values"!==v.name)try{u(v,"name",{value:"values"})}catch(t){}},function(t,n,e){var r=e(5),o=e(3),i=e(53),c=r(Function.toString);o(i.inspectSource)||(i.inspectSource=function(t){return c(t)}),t.exports=i.inspectSource},function(t,n){},function(t,n,e){var r=e(5),o=e(4),i=e(3),c=e(24),u=e(12),a=e(65),f=function(){},s=[],p=u("Reflect","construct"),l=/^\\s*(?:class|function)\\b/,v=r(l.exec),d=!l.exec(f),h=function(t){if(!i(t))return!1;try{return p(f,s,t),!0}catch(t){return!1}},y=function(t){if(!i(t))return!1;switch(c(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!v(l,a(t))}catch(t){return!0}};y.sham=!0,t.exports=!p||o((function(){var t;return h(h.call)||!h(Object)||!h((function(){t=!0}))||t}))?y:h},function(t,n,e){var r=e(5);t.exports=r([].slice)},function(t,n,e){var r=e(26),o=e(0);t.exports="process"==r(o.process)},function(t,n){t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},function(t,n,e){"use strict";var r=e(33),o=e(14),i=e(18);t.exports=function(t,n,e){var c=r(n);c in t?o.f(t,c,i(0,e)):t[c]=e}},function(t,n,e){var r=e(2);n.f=r},function(t,n,e){t.exports=e(100)},function(t,n){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n,e){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);n.f=i?function(t){var n=o(this,t);return!!n&&n.enumerable}:r},function(t,n,e){var r=e(0),o=e(5),i=e(4),c=e(26),u=r.Object,a=o("".split);t.exports=i((function(){return!u("z").propertyIsEnumerable(0)}))?function(t){return"String"==c(t)?a(t,""):u(t)}:u},function(t,n,e){var r=e(50);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,n,e){var r=e(9),o=e(4),i=e(55);t.exports=!r&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(t,n,e){var r=e(4),o=e(3),i=/#|\\.prototype\\./,c=function(t,n){var e=a[u(t)];return e==s||e!=f&&(o(n)?r(n):!!n)},u=c.normalize=function(t){return String(t).replace(i,".").toLowerCase()},a=c.data={},f=c.NATIVE="N",s=c.POLYFILL="P";t.exports=c},function(t,n,e){var r=e(9),o=e(4);t.exports=r&&o((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(t,n,e){var r=e(5),o=e(7),i=e(16),c=e(110).indexOf,u=e(38),a=r([].push);t.exports=function(t,n){var e,r=i(t),f=0,s=[];for(e in r)!o(u,e)&&o(r,e)&&a(s,e);for(;n.length>f;)o(r,e=n[f++])&&(~c(s,e)||a(s,e));return s}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(9),o=e(80),i=e(14),c=e(11),u=e(16),a=e(62);n.f=r&&!o?Object.defineProperties:function(t,n){c(t);for(var e,r=u(n),o=a(n),f=o.length,s=0;f>s;)i.f(t,e=o[s++],r[e]);return t}},function(t,n,e){var r=e(12);t.exports=r("document","documentElement")},function(t,n,e){var r=e(24),o=e(51),i=e(23),c=e(2)("iterator");t.exports=function(t){if(null!=t)return o(t,c)||o(t,"@@iterator")||i[r(t)]}},function(t,n,e){"use strict";var r=e(6),o=e(10),i=e(20),c=e(121),u=e(3),a=e(122),f=e(56),s=e(57),p=e(28),l=e(17),v=e(25),d=e(2),h=e(23),y=e(87),m=c.PROPER,g=c.CONFIGURABLE,x=y.IteratorPrototype,b=y.BUGGY_SAFARI_ITERATORS,w=d("iterator"),j=function(){return this};t.exports=function(t,n,e,c,d,y,S){a(e,n,c);var O,P,A,E=function(t){if(t===d&&_)return _;if(!b&&t in L)return L[t];switch(t){case"keys":case"values":case"entries":return function(){return new e(this,t)}}return function(){return new e(this)}},k=n+" Iterator",T=!1,L=t.prototype,I=L[w]||L["@@iterator"]||d&&L[d],_=!b&&I||E(d),M="Array"==n&&L.entries||I;if(M&&(O=f(M.call(new t)))!==Object.prototype&&O.next&&(i||f(O)===x||(s?s(O,x):u(O[w])||v(O,w,j)),p(O,k,!0,!0),i&&(h[k]=j)),m&&"values"==d&&I&&"values"!==I.name&&(!i&&g?l(L,"name","values"):(T=!0,_=function(){return o(I,this)})),d)if(P={values:E("values"),keys:y?_:E("keys"),entries:E("entries")},S)for(A in P)(b||T||!(A in L))&&v(L,A,P[A]);else r({target:n,proto:!0,forced:b||T},P);return i&&!S||L[w]===_||v(L,w,_,{name:d}),h[n]=_,P}},function(t,n,e){"use strict";var r,o,i,c=e(4),u=e(3),a=e(39),f=e(56),s=e(25),p=e(2),l=e(20),v=p("iterator"),d=!1;[].keys&&("next"in(i=[].keys())?(o=f(f(i)))!==Object.prototype&&(r=o):d=!0),null==r||c((function(){var t={};return r[v].call(t)!==t}))?r={}:l&&(r=a(r)),u(r[v])||s(r,v,(function(){return this})),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:d}},function(t,n,e){var r=e(0);t.exports=r.Promise},function(t,n,e){var r=e(11),o=e(129),i=e(2)("species");t.exports=function(t,n){var e,c=r(t).constructor;return void 0===c||null==(e=r(c)[i])?n:o(e)}},function(t,n,e){var r,o,i,c,u=e(0),a=e(47),f=e(27),s=e(3),p=e(7),l=e(4),v=e(84),d=e(68),h=e(55),y=e(130),m=e(91),g=e(69),x=u.setImmediate,b=u.clearImmediate,w=u.process,j=u.Dispatch,S=u.Function,O=u.MessageChannel,P=u.String,A=0,E={};try{r=u.location}catch(t){}var k=function(t){if(p(E,t)){var n=E[t];delete E[t],n()}},T=function(t){return function(){k(t)}},L=function(t){k(t.data)},I=function(t){u.postMessage(P(t),r.protocol+"//"+r.host)};x&&b||(x=function(t){y(arguments.length,1);var n=s(t)?t:S(t),e=d(arguments,1);return E[++A]=function(){a(n,void 0,e)},o(A),A},b=function(t){delete E[t]},g?o=function(t){w.nextTick(T(t))}:j&&j.now?o=function(t){j.now(T(t))}:O&&!m?(c=(i=new O).port2,i.port1.onmessage=L,o=f(c.postMessage,c)):u.addEventListener&&s(u.postMessage)&&!u.importScripts&&r&&"file:"!==r.protocol&&!l(I)?(o=I,u.addEventListener("message",L,!1)):o="onreadystatechange"in h("script")?function(t){v.appendChild(h("script")).onreadystatechange=function(){v.removeChild(this),k(t)}}:function(t){setTimeout(T(t),0)}),t.exports={set:x,clear:b}},function(t,n,e){var r=e(35);t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},function(t,n,e){var r=e(11),o=e(8),i=e(43);t.exports=function(t,n){if(r(t),o(n)&&n.constructor===t)return n;var e=i.f(t);return(0,e.resolve)(n),e.promise}},function(t,n,e){"use strict";var r=e(140).charAt,o=e(41),i=e(42),c=e(86),u=i.set,a=i.getterFor("String Iterator");c(String,"String",(function(t){u(this,{type:"String Iterator",string:o(t),index:0})}),(function(){var t,n=a(this),e=n.string,o=n.index;return o>=e.length?{value:void 0,done:!0}:(t=r(e,o),n.index+=t.length,{value:t,done:!1})}))},function(t,n,e){t.exports=e(142)},function(t,n,e){var r=e(151);t.exports=function(t,n){return new(r(t))(0===n?0:n)}},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(4),c=e(29),u=e(8),a=e(21),f=e(22),s=e(71),p=e(95),l=e(45),v=e(2),d=e(34),h=v("isConcatSpreadable"),y=o.TypeError,m=d>=51||!i((function(){var t=[];return t[h]=!1,t.concat()[0]!==t})),g=l("concat"),x=function(t){if(!u(t))return!1;var n=t[h];return void 0!==n?!!n:c(t)};r({target:"Array",proto:!0,forced:!m||!g},{concat:function(t){var n,e,r,o,i,c=a(this),u=p(c,0),l=0;for(n=-1,r=arguments.length;n<r;n++)if(x(i=-1===n?c:arguments[n])){if(l+(o=f(i))>9007199254740991)throw y("Maximum allowed index exceeded");for(e=0;e<o;e++,l++)e in i&&s(u,l,i[e])}else{if(l>=9007199254740991)throw y("Maximum allowed index exceeded");s(u,l++,i)}return u.length=l,u}})},function(t,n,e){e(1)("iterator")},function(t,n,e){var r=e(99),o=null;function i(t){return t&&"string"!=typeof t?t.message?t.message:t.target&&t.target.error?t.target.error.message:"unknown error":t}self.onmessage=function(t){switch(t.data.type){case"init":e=t.data.msg,(o=new r(e)).init().catch((function(t){postMessage({type:"error",msg:{msg:"dbLog init error",error:i(t)}})}));break;case"fetch":o.getAllLogs().then((function(t){postMessage({type:"fetchDone",code:200,msg:t})})).catch((function(t){postMessage({type:"fetchDone",code:500,msg:i(t)})}));break;case"delete":o.deleteLogs(n).catch((function(t){postMessage({type:"deleteLogs",code:500,msg:i(t)})}));break;default:!function(t){if(!o)return;o.putLog(t).then((function(){postMessage(200)})).catch((function(t){postMessage({type:"error",msg:{msg:"putLog error",error:i(t)}})}))}(t.data)}var n,e}},function(t,n,e){var r=e(73),o=e(94),i=e(146),c=e(152),u={log:{key:{keyPath:"time"},indexes:{level:{unique:!1},time:{unique:!0}}}};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.server=null,this.expire=t.expire||72,this.name=t.name}var f=a.prototype;f.init=function(){var t=this;if(!this.server)return c.open({server:"nim-log-"+this.name,version:1,schema:u}).then((function(n){t.server=n}))},f.putLog=function(t){var n=this;if(!this.server)return r.reject("no db server");var e=o(t).call(t,-1)[0].time-36e5*this.expire;return this.deleteLogs(e).then((function(){return n.server.add("log",t)}))},f.getAllLogs=function(){return this.server?this.server.query("log","time").all().execute().then((function(t){var n={},e=o(t).call(t,-1)[0];return n.logs=i(t).call(t,(function(t){return t.log})).join("\\r\\n"),n.time=e&&e.time,n})):r.reject("no db server")},f.deleteLogs=function(t){return this.server?this.server.remove("log",null,"time",0,t):r.reject("no db server")},t.exports=a},function(t,n,e){var r=e(101);e(44),t.exports=r},function(t,n,e){e(102),e(64),e(66),e(124),e(137),e(138),e(139),e(93);var r=e(15);t.exports=r.Promise},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(13),c=e(56),u=e(57),a=e(108),f=e(39),s=e(17),p=e(18),l=e(112),v=e(113),d=e(40),h=e(117),y=e(2),m=e(118),g=y("toStringTag"),x=o.Error,b=[].push,w=function(t,n){var e,r=arguments.length>2?arguments[2]:void 0,o=i(j,this);u?e=u(new x,o?c(this):j):(e=o?this:f(j),s(e,g,"Error")),void 0!==n&&s(e,"message",h(n)),m&&s(e,"stack",l(e.stack,1)),v(e,r);var a=[];return d(t,b,{that:a}),s(e,"errors",a),e};u?u(w,x):a(w,x,{name:!0});var j=w.prototype=f(x.prototype,{constructor:p(1,w),message:p(1,""),name:p(1,"AggregateError")});r({global:!0},{AggregateError:w})},function(t,n,e){var r=e(0),o=e(10),i=e(8),c=e(49),u=e(51),a=e(104),f=e(2),s=r.TypeError,p=f("toPrimitive");t.exports=function(t,n){if(!i(t)||c(t))return t;var e,r=u(t,p);if(r){if(void 0===n&&(n="default"),e=o(r,t,n),!i(e)||c(e))return e;throw s("Can\'t convert object to primitive value")}return void 0===n&&(n="number"),a(t,n)}},function(t,n,e){var r=e(0),o=e(10),i=e(3),c=e(8),u=r.TypeError;t.exports=function(t,n){var e,r;if("string"===n&&i(e=t.toString)&&!c(r=o(e,t)))return r;if(i(e=t.valueOf)&&!c(r=o(e,t)))return r;if("string"!==n&&i(e=t.toString)&&!c(r=o(e,t)))return r;throw u("Can\'t convert object to primitive value")}},function(t,n,e){var r=e(0),o=Object.defineProperty;t.exports=function(t,n){try{o(r,t,{value:n,configurable:!0,writable:!0})}catch(e){r[t]=n}return n}},function(t,n,e){var r=e(4);t.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,n,e){var r=e(0),o=e(3),i=r.String,c=r.TypeError;t.exports=function(t){if("object"==typeof t||o(t))return t;throw c("Can\'t set "+i(t)+" as a prototype")}},function(t,n,e){var r=e(7),o=e(109),i=e(32),c=e(14);t.exports=function(t,n,e){for(var u=o(n),a=c.f,f=i.f,s=0;s<u.length;s++){var p=u[s];r(t,p)||e&&r(e,p)||a(t,p,f(n,p))}}},function(t,n,e){var r=e(12),o=e(5),i=e(58),c=e(82),u=e(11),a=o([].concat);t.exports=r("Reflect","ownKeys")||function(t){var n=i.f(u(t)),e=c.f;return e?a(n,e(t)):n}},function(t,n,e){var r=e(16),o=e(59),i=e(22),c=function(t){return function(n,e,c){var u,a=r(n),f=i(a),s=o(c,f);if(t&&e!=e){for(;f>s;)if((u=a[s++])!=u)return!0}else for(;f>s;s++)if((t||s in a)&&a[s]===e)return t||s||0;return!t&&-1}};t.exports={includes:c(!0),indexOf:c(!1)}},function(t,n,e){var r=e(60),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){var r=e(5)("".replace),o=String(Error("zxcasd").stack),i=/\\n\\s*at [^:]*:[^\\n]*/,c=i.test(o);t.exports=function(t,n){if(c&&"string"==typeof t)for(;n--;)t=r(t,i,"");return t}},function(t,n,e){var r=e(8),o=e(17);t.exports=function(t,n){r(n)&&"cause"in n&&o(t,"cause",n.cause)}},function(t,n,e){var r=e(2),o=e(23),i=r("iterator"),c=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||c[i]===t)}},function(t,n,e){var r=e(0),o=e(10),i=e(19),c=e(11),u=e(36),a=e(85),f=r.TypeError;t.exports=function(t,n){var e=arguments.length<2?a(t):n;if(i(e))return c(o(e,t));throw f(u(t)+" is not iterable")}},function(t,n,e){var r=e(10),o=e(11),i=e(51);t.exports=function(t,n,e){var c,u;o(t);try{if(!(c=i(t,"return"))){if("throw"===n)throw e;return e}c=r(c,t)}catch(t){u=!0,c=t}if("throw"===n)throw e;if(u)throw c;return o(c),e}},function(t,n,e){var r=e(41);t.exports=function(t,n){return void 0===t?arguments.length<2?"":n:r(t)}},function(t,n,e){var r=e(4),o=e(18);t.exports=!r((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",o(1,7)),7!==t.stack)}))},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(0),o=e(3),i=e(65),c=r.WeakMap;t.exports=o(c)&&/native code/.test(i(c))},function(t,n,e){var r=e(9),o=e(7),i=Function.prototype,c=r&&Object.getOwnPropertyDescriptor,u=o(i,"name"),a=u&&"something"===function(){}.name,f=u&&(!r||r&&c(i,"name").configurable);t.exports={EXISTS:u,PROPER:a,CONFIGURABLE:f}},function(t,n,e){"use strict";var r=e(87).IteratorPrototype,o=e(39),i=e(18),c=e(28),u=e(23),a=function(){return this};t.exports=function(t,n,e,f){var s=n+" Iterator";return t.prototype=o(r,{next:i(+!f,e)}),c(t,s,!1,!0),u[s]=a,t}},function(t,n,e){"use strict";var r=e(63),o=e(24);t.exports=r?{}.toString:function(){return"[object "+o(this)+"]"}},function(t,n,e){"use strict";var r,o,i,c,u=e(6),a=e(20),f=e(0),s=e(12),p=e(10),l=e(88),v=e(25),d=e(125),h=e(57),y=e(28),m=e(126),g=e(19),x=e(3),b=e(8),w=e(127),j=e(65),S=e(40),O=e(128),P=e(89),A=e(90).set,E=e(131),k=e(92),T=e(134),L=e(43),I=e(70),_=e(135),M=e(42),D=e(79),R=e(2),C=e(136),F=e(69),N=e(34),B=R("species"),G="Promise",z=M.getterFor(G),q=M.set,V=M.getterFor(G),U=l&&l.prototype,W=l,H=U,K=f.TypeError,J=f.document,Y=f.process,X=L.f,Q=X,Z=!!(J&&J.createEvent&&f.dispatchEvent),$=x(f.PromiseRejectionEvent),tt=!1,nt=D(G,(function(){var t=j(W),n=t!==String(W);if(!n&&66===N)return!0;if(a&&!H.finally)return!0;if(N>=51&&/native code/.test(t))return!1;var e=new W((function(t){t(1)})),r=function(t){t((function(){}),(function(){}))};return(e.constructor={})[B]=r,!(tt=e.then((function(){}))instanceof r)||!n&&C&&!$})),et=nt||!O((function(t){W.all(t).catch((function(){}))})),rt=function(t){var n;return!(!b(t)||!x(n=t.then))&&n},ot=function(t,n){var e,r,o,i=n.value,c=1==n.state,u=c?t.ok:t.fail,a=t.resolve,f=t.reject,s=t.domain;try{u?(c||(2===n.rejection&&ft(n),n.rejection=1),!0===u?e=i:(s&&s.enter(),e=u(i),s&&(s.exit(),o=!0)),e===t.promise?f(K("Promise-chain cycle")):(r=rt(e))?p(r,e,a,f):a(e)):f(i)}catch(t){s&&!o&&s.exit(),f(t)}},it=function(t,n){t.notified||(t.notified=!0,E((function(){for(var e,r=t.reactions;e=r.get();)ot(e,t);t.notified=!1,n&&!t.rejection&&ut(t)})))},ct=function(t,n,e){var r,o;Z?((r=J.createEvent("Event")).promise=n,r.reason=e,r.initEvent(t,!1,!0),f.dispatchEvent(r)):r={promise:n,reason:e},!$&&(o=f["on"+t])?o(r):"unhandledrejection"===t&&T("Unhandled promise rejection",e)},ut=function(t){p(A,f,(function(){var n,e=t.facade,r=t.value;if(at(t)&&(n=I((function(){F?Y.emit("unhandledRejection",r,e):ct("unhandledrejection",e,r)})),t.rejection=F||at(t)?2:1,n.error))throw n.value}))},at=function(t){return 1!==t.rejection&&!t.parent},ft=function(t){p(A,f,(function(){var n=t.facade;F?Y.emit("rejectionHandled",n):ct("rejectionhandled",n,t.value)}))},st=function(t,n,e){return function(r){t(n,r,e)}},pt=function(t,n,e){t.done||(t.done=!0,e&&(t=e),t.value=n,t.state=2,it(t,!0))},lt=function(t,n,e){if(!t.done){t.done=!0,e&&(t=e);try{if(t.facade===n)throw K("Promise can\'t be resolved itself");var r=rt(n);r?E((function(){var e={done:!1};try{p(r,n,st(lt,e,t),st(pt,e,t))}catch(n){pt(e,n,t)}})):(t.value=n,t.state=1,it(t,!1))}catch(n){pt({done:!1},n,t)}}};if(nt&&(H=(W=function(t){w(this,H),g(t),p(r,this);var n=z(this);try{t(st(lt,n),st(pt,n))}catch(t){pt(n,t)}}).prototype,(r=function(t){q(this,{type:G,done:!1,notified:!1,parent:!1,reactions:new _,rejection:!1,state:0,value:void 0})}).prototype=d(H,{then:function(t,n){var e=V(this),r=X(P(this,W));return e.parent=!0,r.ok=!x(t)||t,r.fail=x(n)&&n,r.domain=F?Y.domain:void 0,0==e.state?e.reactions.add(r):E((function(){ot(r,e)})),r.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new r,n=z(t);this.promise=t,this.resolve=st(lt,n),this.reject=st(pt,n)},L.f=X=function(t){return t===W||t===i?new o(t):Q(t)},!a&&x(l)&&U!==Object.prototype)){c=U.then,tt||(v(U,"then",(function(t,n){var e=this;return new W((function(t,n){p(c,e,t,n)})).then(t,n)}),{unsafe:!0}),v(U,"catch",H.catch,{unsafe:!0}));try{delete U.constructor}catch(t){}h&&h(U,H)}u({global:!0,wrap:!0,forced:nt},{Promise:W}),y(W,G,!1,!0),m(G),i=s(G),u({target:G,stat:!0,forced:nt},{reject:function(t){var n=X(this);return p(n.reject,void 0,t),n.promise}}),u({target:G,stat:!0,forced:a||nt},{resolve:function(t){return k(a&&this===i?W:this,t)}}),u({target:G,stat:!0,forced:et},{all:function(t){var n=this,e=X(n),r=e.resolve,o=e.reject,i=I((function(){var e=g(n.resolve),i=[],c=0,u=1;S(t,(function(t){var a=c++,f=!1;u++,p(e,n,t).then((function(t){f||(f=!0,i[a]=t,--u||r(i))}),o)})),--u||r(i)}));return i.error&&o(i.value),e.promise},race:function(t){var n=this,e=X(n),r=e.reject,o=I((function(){var o=g(n.resolve);S(t,(function(t){p(o,n,t).then(e.resolve,r)}))}));return o.error&&r(o.value),e.promise}})},function(t,n,e){var r=e(25);t.exports=function(t,n,e){for(var o in n)e&&e.unsafe&&t[o]?t[o]=n[o]:r(t,o,n[o],e);return t}},function(t,n,e){"use strict";var r=e(12),o=e(14),i=e(2),c=e(9),u=i("species");t.exports=function(t){var n=r(t),e=o.f;c&&n&&!n[u]&&e(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,e){var r=e(0),o=e(13),i=r.TypeError;t.exports=function(t,n){if(o(n,t))return t;throw i("Incorrect invocation")}},function(t,n,e){var r=e(2)("iterator"),o=!1;try{var i=0,c={next:function(){return{done:!!i++}},return:function(){o=!0}};c[r]=function(){return this},Array.from(c,(function(){throw 2}))}catch(t){}t.exports=function(t,n){if(!n&&!o)return!1;var e=!1;try{var i={};i[r]=function(){return{next:function(){return{done:e=!0}}}},t(i)}catch(t){}return e}},function(t,n,e){var r=e(0),o=e(67),i=e(36),c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not a constructor")}},function(t,n,e){var r=e(0).TypeError;t.exports=function(t,n){if(t<n)throw r("Not enough arguments");return t}},function(t,n,e){var r,o,i,c,u,a,f,s,p=e(0),l=e(27),v=e(32).f,d=e(90).set,h=e(91),y=e(132),m=e(133),g=e(69),x=p.MutationObserver||p.WebKitMutationObserver,b=p.document,w=p.process,j=p.Promise,S=v(p,"queueMicrotask"),O=S&&S.value;O||(r=function(){var t,n;for(g&&(t=w.domain)&&t.exit();o;){n=o.fn,o=o.next;try{n()}catch(t){throw o?c():i=void 0,t}}i=void 0,t&&t.enter()},h||g||m||!x||!b?!y&&j&&j.resolve?((f=j.resolve(void 0)).constructor=j,s=l(f.then,f),c=function(){s(r)}):g?c=function(){w.nextTick(r)}:(d=l(d,p),c=function(){d(r)}):(u=!0,a=b.createTextNode(""),new x(r).observe(a,{characterData:!0}),c=function(){a.data=u=!u})),t.exports=O||function(t){var n={fn:t,next:void 0};i&&(i.next=n),o||(o=n,c()),i=n}},function(t,n,e){var r=e(35),o=e(0);t.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==o.Pebble},function(t,n,e){var r=e(35);t.exports=/web0s(?!.*chrome)/i.test(r)},function(t,n,e){var r=e(0);t.exports=function(t,n){var e=r.console;e&&e.error&&(1==arguments.length?e.error(t):e.error(t,n))}},function(t,n){var e=function(){this.head=null,this.tail=null};e.prototype={add:function(t){var n={item:t,next:null};this.head?this.tail.next=n:this.head=n,this.tail=n},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}},t.exports=e},function(t,n){t.exports="object"==typeof window},function(t,n,e){"use strict";var r=e(6),o=e(10),i=e(19),c=e(43),u=e(70),a=e(40);r({target:"Promise",stat:!0},{allSettled:function(t){var n=this,e=c.f(n),r=e.resolve,f=e.reject,s=u((function(){var e=i(n.resolve),c=[],u=0,f=1;a(t,(function(t){var i=u++,a=!1;f++,o(e,n,t).then((function(t){a||(a=!0,c[i]={status:"fulfilled",value:t},--f||r(c))}),(function(t){a||(a=!0,c[i]={status:"rejected",reason:t},--f||r(c))}))})),--f||r(c)}));return s.error&&f(s.value),e.promise}})},function(t,n,e){"use strict";var r=e(6),o=e(19),i=e(12),c=e(10),u=e(43),a=e(70),f=e(40);r({target:"Promise",stat:!0},{any:function(t){var n=this,e=i("AggregateError"),r=u.f(n),s=r.resolve,p=r.reject,l=a((function(){var r=o(n.resolve),i=[],u=0,a=1,l=!1;f(t,(function(t){var o=u++,f=!1;a++,c(r,n,t).then((function(t){f||l||(l=!0,s(t))}),(function(t){f||l||(f=!0,i[o]=t,--a||p(new e(i,"No one promise resolved")))}))})),--a||p(new e(i,"No one promise resolved"))}));return l.error&&p(l.value),r.promise}})},function(t,n,e){"use strict";var r=e(6),o=e(20),i=e(88),c=e(4),u=e(12),a=e(3),f=e(89),s=e(92),p=e(25);if(r({target:"Promise",proto:!0,real:!0,forced:!!i&&c((function(){i.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var n=f(this,u("Promise")),e=a(t);return this.then(e?function(e){return s(n,t()).then((function(){return e}))}:t,e?function(e){return s(n,t()).then((function(){throw e}))}:t)}}),!o&&a(i)){var l=u("Promise").prototype.finally;i.prototype.finally!==l&&p(i.prototype,"finally",l,{unsafe:!0})}},function(t,n,e){var r=e(5),o=e(60),i=e(41),c=e(48),u=r("".charAt),a=r("".charCodeAt),f=r("".slice),s=function(t){return function(n,e){var r,s,p=i(c(n)),l=o(e),v=p.length;return l<0||l>=v?t?"":void 0:(r=a(p,l))<55296||r>56319||l+1===v||(s=a(p,l+1))<56320||s>57343?t?u(p,l):r:t?f(p,l,l+2):s-56320+(r-55296<<10)+65536}};t.exports={codeAt:s(!1),charAt:s(!0)}},function(t,n){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(t,n,e){var r=e(143);t.exports=r},function(t,n,e){var r=e(13),o=e(144),i=Array.prototype;t.exports=function(t){var n=t.slice;return t===i||r(i,t)&&n===i.slice?o:n}},function(t,n,e){e(145);var r=e(30);t.exports=r("Array").slice},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(29),c=e(67),u=e(8),a=e(59),f=e(22),s=e(16),p=e(71),l=e(2),v=e(45),d=e(68),h=v("slice"),y=l("species"),m=o.Array,g=Math.max;r({target:"Array",proto:!0,forced:!h},{slice:function(t,n){var e,r,o,l=s(this),v=f(l),h=a(t,v),x=a(void 0===n?v:n,v);if(i(l)&&(e=l.constructor,(c(e)&&(e===m||i(e.prototype))||u(e)&&null===(e=e[y]))&&(e=void 0),e===m||void 0===e))return d(l,h,x);for(r=new(void 0===e?m:e)(g(x-h,0)),o=0;h<x;h++,o++)h in l&&p(r,o,l[h]);return r.length=o,r}})},function(t,n,e){t.exports=e(147)},function(t,n,e){var r=e(148);t.exports=r},function(t,n,e){var r=e(13),o=e(149),i=Array.prototype;t.exports=function(t){var n=t.map;return t===i||r(i,t)&&n===i.map?o:n}},function(t,n,e){e(150);var r=e(30);t.exports=r("Array").map},function(t,n,e){"use strict";var r=e(6),o=e(46).map;r({target:"Array",proto:!0,forced:!e(45)("map")},{map:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,e){var r=e(0),o=e(29),i=e(67),c=e(8),u=e(2)("species"),a=r.Array;t.exports=function(t){var n;return o(t)&&(n=t.constructor,(i(n)&&(n===a||o(n.prototype))||c(n)&&null===(n=n[u]))&&(n=void 0)),void 0===n?a:n}},function(t,n,e){(function(r){var o,i=e(153),c=e(94),u=e(190),a=e(73),f=e(194),s=e(201),p=e(205),l=e(209),v=e(213);!function(d,h){"use strict";var y,m=(d=void 0!==d?d:"undefined"!=typeof self?self:void 0!==r?r:{}).IDBKeyRange||d.webkitIDBKeyRange,g="readonly",x="readwrite",b=Object.prototype.hasOwnProperty,w=function(){if(!y&&!(y=d.indexedDB||d.webkitIndexedDB||d.mozIndexedDB||d.oIndexedDB||d.msIndexedDB||(null===d.indexedDB&&d.shimIndexedDB?d.shimIndexedDB:void 0)))throw"IndexedDB required";return y},j=function(t){return t},S=function(t){var n;return c(n=Object.prototype.toString.call(t)).call(n,8,-1).toLowerCase()},O=function(t){return"function"==typeof t},P=function(t){return"number"===S(t)},A=function(t){return"array"===S(t)},E=function(t){return void 0===t},k=function(t,n){var e=this,r=!1;this.name=n,this.getIndexedDB=function(){return t},this.add=function(n){if(r)throw"Database has been closed";for(var o=[],i=0,c=0;c<arguments.length-1;c++)if(u(arguments[c+1]))for(var p=0;p<arguments[c+1].length;p++)o[i]=arguments[c+1][p],i++;else o[i]=arguments[c+1],i++;var l=t.transaction(n,x),v=l.objectStore(n);return new a((function(t,n){f(o).call(o,(function(t){var n;if(t.item&&t.key){var e=t.key;t=t.item,n=v.add(t,e)}else n=v.add(t);n.onsuccess=function(n){var e=n.target,r=e.source.keyPath;null===r&&(r="__id__"),s(t,r,{value:e.result,enumerable:!0})}})),l.oncomplete=function(){t(o,e)},l.onerror=function(t){t.preventDefault(),n(t)},l.onabort=function(t){n(t)}}))},this.updateAndDelete=function(n,e,o){if(r)throw"Database has been closed";var i=t.transaction(n,x),c=i.objectStore(n),u=c.keyPath;return new a((function(t,n){f(e).call(e,(function(t){if(t.item&&t.key){var n=t.key;t=t.item,c.put(t,n)}else c.put(t)})),f(o).call(o,(function(t){c.delete(t[u])})),i.oncomplete=function(){t([e,o])},i.onerror=function(t){n(t)}}))},this.update=function(n){if(r)throw"Database has been closed";for(var o,i=[],c=1;c<arguments.length;c++)u(o=arguments[c])?i=p(i).call(i,o):i.push(o);var s=t.transaction(n,x),l=s.objectStore(n);l.keyPath;return new a((function(t,n){f(i).call(i,(function(t){var n;if(t.item&&t.key){var e=t.key;t=t.item,n=l.put(t,e)}else n=l.put(t);n.onsuccess=function(t){},n.onerror=function(t){}})),s.oncomplete=function(){t(i,e)},s.onerror=function(t){n(t)},s.onabort=function(t){n(t)}}))},this.remove=function(n,e,o,i,c,s,p){if(r)throw"Database has been closed";var l=t.transaction(n,x),v=l.objectStore(n);return new a((function(t,n){function r(t){return null==t}var a;(r(i)&&(i=-1/0),r(c)&&(c=1/0),null===e||u(e)||(e=[e]),r(o))?null!==e?f(e).call(e,(function(t){v.delete(t)})):v.delete(range=m.bound(i,c,s,p)):(a=null!==e?m.only(e[0]):m.bound(i,c,s,p),v.index(o).openCursor(a).onsuccess=function(t){var n=t.target.result;n&&(n.delete(),n.continue())});l.oncomplete=function(){t()},l.onerror=function(t){n(t)},l.onabort=function(t){n(t)}}))},this.clear=function(n){if(r)throw"Database has been closed";var e=t.transaction(n,x);e.objectStore(n).clear();return new a((function(t,n){e.oncomplete=function(){t()},e.onerror=function(t){n(t)}}))},this.close=function(){r||(t.close(),r=!0,delete I[n])},this.get=function(n,e){if(r)throw"Database has been closed";var o=t.transaction(n),i=o.objectStore(n).get(e);return new a((function(t,n){i.onsuccess=function(n){t(n.target.result)},o.onerror=function(t){n(t)}}))},this.query=function(n,e){if(r)throw"Database has been closed";return new T(n,t,e)},this.count=function(n,e){if(r)throw"Database has been closed";t.transaction(n).objectStore(n)};for(var o=0,i=t.objectStoreNames.length;o<i;o++)!function(t){for(var n in e[t]={},e)b.call(e,n)&&"close"!==n&&(e[t][n]=function(n){return function(){var r,o=p(r=[t]).call(r,c([]).call(arguments,0));return e[n].apply(e,o)}}(n))}(t.objectStoreNames[o])},T=function(t,n,e){var r,o=this,u=!1,s=!1,p=function(r,o,c,p,v,d,h){return new a((function(a,y){var b=u||s?x:g,w=n.transaction(t,b),j=w.objectStore(t),S=e?j.index(e):j,P=r?m[r].apply(null,o):null,A=[],E=[P],k=0;v=v||null,d=d||[],"count"!==c&&E.push(p||"next");var T=!!u&&l(u);S[c].apply(S,E).onsuccess=function(t){var n=t.target.result;if(i(n)===i(0))A=n;else if(n)if(null!==v&&v[0]>k)k=v[0],n.advance(v[0]);else if(null!==v&&k>=v[0]+v[1]);else{var e=!0,r="value"in n?n.value:n.key;f(d).call(d,(function(t){t&&t.length&&(2===t.length?e=e&&r[t[0]]===t[1]:O(t[0])&&(e=e&&t[0].apply(void 0,[r])))})),e&&(k++,A.push(h(r)),s?n.delete():u&&(r=function(t){for(var n=0;n<T.length;n++){var e=T[n],r=u[e];r instanceof Function&&(r=r(t)),t[e]=r}return t}(r),n.update(r))),n.continue()}},w.oncomplete=function(){a(A)},w.onerror=function(t){y(t)},w.onabort=function(t){y(t)}}))},d=function(t,n){var e="next",r="openCursor",o=[],i=null,a=j,f=!1,l=function(){return p(t,n,r,f?e+"unique":e,i,o,a)},v=function(){return e=null,r="count",{execute:l}},d=function t(){return 1==(i=A(arguments[0])?arguments[0]:c(Array.prototype).call(arguments,0,2)).length&&i.unshift(0),P(i[1])||(i=null),{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:t,map:w,remove:S}},h=function t(n){return(n=!!E(n)||!!n)&&(r="openKeyCursor"),{execute:l,keys:t,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},y=function t(){return o.push(c(Array.prototype).call(arguments,0,2)),{execute:l,count:v,keys:h,filter:t,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},m=function t(n){return n=!!E(n)||!!n,e=n?"next":"prev",{execute:l,count:v,keys:h,filter:y,asc:t,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},g=function t(n){return n=!!E(n)||!!n,e=n?"prev":"next",{execute:l,count:v,keys:h,filter:y,asc:m,desc:t,distinct:x,modify:b,limit:d,map:w,remove:S}},x=function t(n){return n=!!E(n)||!!n,f=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:t,modify:b,limit:d,map:w,remove:S}},b=function t(n){return u=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:t,limit:d,map:w,remove:S}},w=function t(n){return O(n)&&(a=n),{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:t,remove:S}},S=function t(n){return n=!!E(n)||!!n,s=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:t}};return{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}};f(r="only bound upperBound lowerBound".split(" ")).call(r,(function(t){o[t]=function(){return new d(t,arguments)}})),this.filter=function(){var t=new d(null,null);return v(t).apply(t,arguments)},this.all=function(){var t;return v(t=this).call(t)}},L=function(t,n,e,r){var o=t.target.result,i=new k(o,n);return I[n]=o,a.resolve(i)},I={},_={version:"0.10.2",open:function(t){var n;return new a((function(e,r){if(I[t.server])L({target:{result:I[t.server]}},t.server,t.version,t.schema).then(e,r);else{try{n=w().open(t.server,t.version)}catch(t){r(t)}n.onsuccess=function(n){L(n,t.server,t.version,t.schema).then(e,r)},n.onupgradeneeded=function(n){!function(t,n,e){for(var r in"function"==typeof n&&(n=n()),n){var o,i=n[r];for(var c in o=!b.call(n,r)||e.objectStoreNames.contains(r)?t.currentTarget.transaction.objectStore(r):e.createObjectStore(r,i.key),i.indexes){var u=i.indexes[c];try{o.index(c)}catch(t){o.createIndex(c,u.key||c,l(u).length?u:{unique:!1})}}}}(n,t.schema,n.target.result)},n.onerror=function(t){r(t)}}}))},remove:function(t){return new a((function(n,e){if(!t)return n();var r,o;i(t)===k&&(t=t.name),"string"==typeof t&&(r=I[t]),r&&"function"==typeof r.close&&r.close();try{o=w().deleteDatabase(t)}catch(t){e(t)}o.onsuccess=function(e){delete I[t],n(t)},o.onerror=function(t){e(t)},o.onblocked=function(t){e(t)}}))}};void 0!==t.exports?t.exports=_:void 0===(o=function(){return _}.call(n,e,n,t))||(t.exports=o)}(void 0)}).call(this,e(74))},function(t,n,e){var r=e(154),o=e(185);function i(n){return"function"==typeof r&&"symbol"==typeof o?(t.exports=i=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=i=function(t){return t&&"function"==typeof r&&t.constructor===r&&t!==r.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),i(n)}t.exports=i,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,n,e){t.exports=e(155)},function(t,n,e){var r=e(156);e(178),e(179),e(180),e(181),e(182),e(183),e(184),t.exports=r},function(t,n,e){var r=e(157);t.exports=r},function(t,n,e){var r=e(158);e(44),t.exports=r},function(t,n,e){e(96),e(66),e(159),e(162),e(163),e(164),e(165),e(97),e(166),e(167),e(168),e(169),e(170),e(171),e(172),e(173),e(174),e(175),e(176),e(177);var r=e(15);t.exports=r.Symbol},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(12),c=e(47),u=e(10),a=e(5),f=e(20),s=e(9),p=e(50),l=e(4),v=e(7),d=e(29),h=e(3),y=e(8),m=e(13),g=e(49),x=e(11),b=e(21),w=e(16),j=e(33),S=e(41),O=e(18),P=e(39),A=e(62),E=e(58),k=e(160),T=e(82),L=e(32),I=e(14),_=e(83),M=e(75),D=e(68),R=e(25),C=e(52),F=e(37),N=e(38),B=e(54),G=e(2),z=e(72),q=e(1),V=e(28),U=e(42),W=e(46).forEach,H=F("hidden"),K=G("toPrimitive"),J=U.set,Y=U.getterFor("Symbol"),X=Object.prototype,Q=o.Symbol,Z=Q&&Q.prototype,$=o.TypeError,tt=o.QObject,nt=i("JSON","stringify"),et=L.f,rt=I.f,ot=k.f,it=M.f,ct=a([].push),ut=C("symbols"),at=C("op-symbols"),ft=C("string-to-symbol-registry"),st=C("symbol-to-string-registry"),pt=C("wks"),lt=!tt||!tt.prototype||!tt.prototype.findChild,vt=s&&l((function(){return 7!=P(rt({},"a",{get:function(){return rt(this,"a",{value:7}).a}})).a}))?function(t,n,e){var r=et(X,n);r&&delete X[n],rt(t,n,e),r&&t!==X&&rt(X,n,r)}:rt,dt=function(t,n){var e=ut[t]=P(Z);return J(e,{type:"Symbol",tag:t,description:n}),s||(e.description=n),e},ht=function(t,n,e){t===X&&ht(at,n,e),x(t);var r=j(n);return x(e),v(ut,r)?(e.enumerable?(v(t,H)&&t[H][r]&&(t[H][r]=!1),e=P(e,{enumerable:O(0,!1)})):(v(t,H)||rt(t,H,O(1,{})),t[H][r]=!0),vt(t,r,e)):rt(t,r,e)},yt=function(t,n){x(t);var e=w(n),r=A(e).concat(bt(e));return W(r,(function(n){s&&!u(mt,e,n)||ht(t,n,e[n])})),t},mt=function(t){var n=j(t),e=u(it,this,n);return!(this===X&&v(ut,n)&&!v(at,n))&&(!(e||!v(this,n)||!v(ut,n)||v(this,H)&&this[H][n])||e)},gt=function(t,n){var e=w(t),r=j(n);if(e!==X||!v(ut,r)||v(at,r)){var o=et(e,r);return!o||!v(ut,r)||v(e,H)&&e[H][r]||(o.enumerable=!0),o}},xt=function(t){var n=ot(w(t)),e=[];return W(n,(function(t){v(ut,t)||v(N,t)||ct(e,t)})),e},bt=function(t){var n=t===X,e=ot(n?at:w(t)),r=[];return W(e,(function(t){!v(ut,t)||n&&!v(X,t)||ct(r,ut[t])})),r};(p||(R(Z=(Q=function(){if(m(Z,this))throw $("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?S(arguments[0]):void 0,n=B(t),e=function(t){this===X&&u(e,at,t),v(this,H)&&v(this[H],n)&&(this[H][n]=!1),vt(this,n,O(1,t))};return s&&lt&&vt(X,n,{configurable:!0,set:e}),dt(n,t)}).prototype,"toString",(function(){return Y(this).tag})),R(Q,"withoutSetter",(function(t){return dt(B(t),t)})),M.f=mt,I.f=ht,_.f=yt,L.f=gt,E.f=k.f=xt,T.f=bt,z.f=function(t){return dt(G(t),t)},s&&(rt(Z,"description",{configurable:!0,get:function(){return Y(this).description}}),f||R(X,"propertyIsEnumerable",mt,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!p,sham:!p},{Symbol:Q}),W(A(pt),(function(t){q(t)})),r({target:"Symbol",stat:!0,forced:!p},{for:function(t){var n=S(t);if(v(ft,n))return ft[n];var e=Q(n);return ft[n]=e,st[e]=n,e},keyFor:function(t){if(!g(t))throw $(t+" is not a symbol");if(v(st,t))return st[t]},useSetter:function(){lt=!0},useSimple:function(){lt=!1}}),r({target:"Object",stat:!0,forced:!p,sham:!s},{create:function(t,n){return void 0===n?P(t):yt(P(t),n)},defineProperty:ht,defineProperties:yt,getOwnPropertyDescriptor:gt}),r({target:"Object",stat:!0,forced:!p},{getOwnPropertyNames:xt,getOwnPropertySymbols:bt}),r({target:"Object",stat:!0,forced:l((function(){T.f(1)}))},{getOwnPropertySymbols:function(t){return T.f(b(t))}}),nt)&&r({target:"JSON",stat:!0,forced:!p||l((function(){var t=Q();return"[null]"!=nt([t])||"{}"!=nt({a:t})||"{}"!=nt(Object(t))}))},{stringify:function(t,n,e){var r=D(arguments),o=n;if((y(n)||void 0!==t)&&!g(t))return d(n)||(n=function(t,n){if(h(o)&&(n=u(o,this,t,n)),!g(n))return n}),r[1]=n,c(nt,null,r)}});if(!Z[K]){var wt=Z.valueOf;R(Z,K,(function(t){return u(wt,this)}))}V(Q,"Symbol"),N[H]=!0},function(t,n,e){var r=e(26),o=e(16),i=e(58).f,c=e(161),u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"Window"==r(t)?function(t){try{return i(t)}catch(t){return c(u)}}(t):i(o(t))}},function(t,n,e){var r=e(0),o=e(59),i=e(22),c=e(71),u=r.Array,a=Math.max;t.exports=function(t,n,e){for(var r=i(t),f=o(n,r),s=o(void 0===e?r:e,r),p=u(a(s-f,0)),l=0;f<s;f++,l++)c(p,l,t[f]);return p.length=l,p}},function(t,n,e){e(1)("asyncIterator")},function(t,n){},function(t,n,e){e(1)("hasInstance")},function(t,n,e){e(1)("isConcatSpreadable")},function(t,n,e){e(1)("match")},function(t,n,e){e(1)("matchAll")},function(t,n,e){e(1)("replace")},function(t,n,e){e(1)("search")},function(t,n,e){e(1)("species")},function(t,n,e){e(1)("split")},function(t,n,e){e(1)("toPrimitive")},function(t,n,e){e(1)("toStringTag")},function(t,n,e){e(1)("unscopables")},function(t,n,e){var r=e(0);e(28)(r.JSON,"JSON",!0)},function(t,n){},function(t,n){},function(t,n,e){e(1)("asyncDispose")},function(t,n,e){e(1)("dispose")},function(t,n,e){e(1)("matcher")},function(t,n,e){e(1)("metadata")},function(t,n,e){e(1)("observable")},function(t,n,e){e(1)("patternMatch")},function(t,n,e){e(1)("replaceAll")},function(t,n,e){t.exports=e(186)},function(t,n,e){var r=e(187);t.exports=r},function(t,n,e){var r=e(188);t.exports=r},function(t,n,e){var r=e(189);e(44),t.exports=r},function(t,n,e){e(64),e(66),e(93),e(97);var r=e(72);t.exports=r.f("iterator")},function(t,n,e){t.exports=e(191)},function(t,n,e){var r=e(192);t.exports=r},function(t,n,e){e(193);var r=e(15);t.exports=r.Array.isArray},function(t,n,e){e(6)({target:"Array",stat:!0},{isArray:e(29)})},function(t,n,e){t.exports=e(195)},function(t,n,e){e(44);var r=e(24),o=e(7),i=e(13),c=e(196),u=Array.prototype,a={DOMTokenList:!0,NodeList:!0};t.exports=function(t){var n=t.forEach;return t===u||i(u,t)&&n===u.forEach||o(a,r(t))?c:n}},function(t,n,e){var r=e(197);t.exports=r},function(t,n,e){e(198);var r=e(30);t.exports=r("Array").forEach},function(t,n,e){"use strict";var r=e(6),o=e(199);r({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},function(t,n,e){"use strict";var r=e(46).forEach,o=e(200)("forEach");t.exports=o?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},function(t,n,e){"use strict";var r=e(4);t.exports=function(t,n){var e=[][t];return!!e&&r((function(){e.call(null,n||function(){return 1},1)}))}},function(t,n,e){t.exports=e(202)},function(t,n,e){var r=e(203);t.exports=r},function(t,n,e){e(204);var r=e(15).Object,o=t.exports=function(t,n,e){return r.defineProperty(t,n,e)};r.defineProperty.sham&&(o.sham=!0)},function(t,n,e){var r=e(6),o=e(9),i=e(14).f;r({target:"Object",stat:!0,forced:Object.defineProperty!==i,sham:!o},{defineProperty:i})},function(t,n,e){t.exports=e(206)},function(t,n,e){var r=e(207);t.exports=r},function(t,n,e){var r=e(13),o=e(208),i=Array.prototype;t.exports=function(t){var n=t.concat;return t===i||r(i,t)&&n===i.concat?o:n}},function(t,n,e){e(96);var r=e(30);t.exports=r("Array").concat},function(t,n,e){t.exports=e(210)},function(t,n,e){var r=e(211);t.exports=r},function(t,n,e){e(212);var r=e(15);t.exports=r.Object.keys},function(t,n,e){var r=e(6),o=e(21),i=e(62);r({target:"Object",stat:!0,forced:e(4)((function(){i(1)}))},{keys:function(t){return i(o(t))}})},function(t,n,e){t.exports=e(214)},function(t,n,e){var r=e(215);t.exports=r},function(t,n,e){var r=e(13),o=e(216),i=Array.prototype;t.exports=function(t){var n=t.filter;return t===i||r(i,t)&&n===i.filter?o:n}},function(t,n,e){e(217);var r=e(30);t.exports=r("Array").filter},function(t,n,e){"use strict";var r=e(6),o=e(46).filter;r({target:"Array",proto:!0,forced:!e(45)("filter")},{filter:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})}]);',"Worker",void 0,void 0)}},function(e,t,r){var n=r(4),i=r(17),o=r(8),s=r(211),a={log:{key:{keyPath:"time"},indexes:{level:{unique:!1},time:{unique:!0}}}};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.server=null,this.expire=e.expire||72,this.name=e.name}var u=c.prototype;u.init=function(){var e=this;if(!this.server)return s.open({server:"nim-log-"+this.name,version:1,schema:a}).then((function(t){e.server=t}))},u.putLog=function(e){var t=this;if(!this.server)return n.reject("no db server");var r=i(e).call(e,-1)[0].time-36e5*this.expire;return this.deleteLogs(r).then((function(){return t.server.add("log",e)}))},u.getAllLogs=function(){return this.server?this.server.query("log","time").all().execute().then((function(e){var t={},r=i(e).call(e,-1)[0];return t.logs=o(e).call(e,(function(e){return e.log})).join("\r\n"),t.time=r&&r.time,t})):n.reject("no db server")},u.deleteLogs=function(e){return this.server?this.server.remove("log",null,"time",0,e):n.reject("no db server")},e.exports=c},function(e,t,r){var n=r(52).fn;n.isConnected=function(){return!!this.protocol&&this.protocol.isConnected()},n.connect=function(){this.protocol.connect()},n.disconnect=function(){}},function(e,t,r){var n=r(10),i=r(57),o=r(19),s=r(58),a=r(59),c=r(60),u=r(49),l=r(27),d=r(11),p=r(23),m=r(8),f=r(17),h=r(110),g=r(77),v=r(6),y=r(79),b=r(26),S=r(5),T=r(30),_=r(3),w=r(13),M=r(61),x=r(149),E=["loc_x","loc_y","loc_z"];function C(e,t){var r=n(e);if(i){var a=i(e);t&&(a=o(a).call(a,(function(t){return s(e,t).enumerable}))),r.push.apply(r,a)}return r}var R=r(52).fn,k=r(0),A=r(428),I=r(36),O=r(14),P=r(193),N=r(429),D=r(195);R.sendText=function(e){var t=e,r=t.loc_x,n=t.loc_y,i=t.loc_z,o=x(t,E);return void 0===r||void 0===n||void 0===i?e=function(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?_(r=C(Object(i),!0)).call(r,(function(t){M(e,t,i[t])})):a?c(e,a(i)):_(n=C(Object(i))).call(n,(function(t){u(e,t,s(i,t))}))}return e}({},o):("number"!=typeof e.loc_x&&(e.loc_x=0),"number"!=typeof e.loc_y&&(e.loc_y=0),"number"!=typeof e.loc_z&&(e.loc_z=0)),this.processCallback(e),e.msg=new this.message.TextMessage(e),this.sendMsg(e)},R.previewFile=function(e){var t,r=this,n=r.protocol.appGrayConfig;if(n&&n.grayConfig&&n.grayConfig.mixStoreEnable&&(e.mixEnable=!0),k.verifyOptions(e,"done","msg::previewFile"),e.type||(e.type="file"),k.verifyParamPresentJustOne(e,"dataURL blob fileInput filePath wxFilePath fileObject","msg::previewFile"),k.exist(e.maxSize)&&k.verifyParamType("maxSize",e.maxSize,"number","api::previewFile"),k.exist(e.commonUpload)&&k.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile"),e.nosSurvivalTime?(k.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance"),k.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")):e.nosSurvivalTime=this.nosSurvivalTime,e.filePath=e.filePath||e.wxFilePath,delete e.wxFilePath,e.dataURL)e.blob=D.fromDataURL(e.dataURL);else if(e.blob);else if(e.fileInput){if(e.fileInput=k.verifyFileInput(e.fileInput,"msg::previewFile"),e.fileInput.files){if(!e.fileInput.files.length)return void e.done(I.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::previewFile",fileInput:e.fileInput}),e);e.fileSize=e.fileInput.files[0].size}e.fileInputName=k.getFileName(e.fileInput)}this.processCallback(e);var i=d(P.genResponseBody(e.type)||{}).replace(/"/gi,'\\"'),o=null,s=e.transcode?"getNosTokenTrans":"getNosToken";if(e.transcode){k.verifyOptions(e,"fileInput","msg::previewFile");var a=k.getFileInfo(e.fileInput);o={transToken:{name:a.name,type:a.transcodeType,transType:"png"===e.transcode?11:10,size:a.size,body:i}}}else o=i;this[s]({responseBody:o,nosToken:{nosScene:e.nosScene||this.nosScene,nosSurvivalTime:e.nosSurvivalTime},callback:p(t=function(t,n){if(t)e.done(t);else if(e.transcode?(e.nosToken=n.nosToken,e.docId=n.docId):e.nosToken=n,e.logger=r.logger,e.mixEnable){var i,s;if(!this.protocol.mixStorePolicy)try{this.protocol.mixStorePolicy=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[this.options.appKey]}catch(e){r.logger.error("error:","get last mixStorePolicy failed",e)}if(!this.protocol.mixStorePolicy)return void r.logger.error("error:","get mixStorePolicy failed");e.providers=m(i=this.protocol.mixStorePolicy.providers||[]).call(i,(function(e){return Number(e)})),e.curProvider=e.providers[0]?Number(e.providers[0]):1,e.nosPolicy=this.protocol.mixStorePolicy.nosPolicy,e.s3Policy=this.protocol.mixStorePolicy.s3Policy,r.getMixStoreToken({curProvider:e.curProvider,responseBody:o,callback:p(s=function(t,n){t?e.done(t):(e.mixStoreToken=n,e.getMixStoreToken=function(t,n){r.getMixStoreToken({curProvider:t,responseBody:o,callback:function(t,r){t?e.done(t):n(r)}})},1===e.curProvider&&(e.nosToken=n),r._doPreviewFile(e))}).call(s,r)})}else this._doPreviewFile(e)}).call(t,this)})},R._doPreviewFile=function(e){var t=this;t.reporter.reportTraceStart("nos",{user_id:this.account,action:"upload"});var r=(e=k.merge(e,t.options.providers)).uploaddone,n=O.genUploadUrl(e.nosToken.bucket);e.mixEnable&&1===e.curProvider&&(n=O.genUploadUrl(e.mixStoreToken.bucket));var i,o=O.chunkUploadUrl;t.logger.info("_doPreviewFile: start upload"),e.commonUpload||!o||O.isWeixinApp||O.isNodejs||O.isRN?(e.commonUpload=!0,i=n):(this.logger.info("use chunkUrl: ",o,O.nosLbsUrls),i=o,e.nosLbsUrls=O.nosLbsUrls,t.options.edgeList?e.edgeList=t.options.edgeList:e.updateNosEdgeList=function(e){t.options.edgeList=e});var s=this.assembleUploadParams(e.nosToken);function a(n,i,o){if(t.logger.info("_doPreviewFile: upload done",n&&n.message),e.uploaddone=r,n)return t.reporter.reportTraceUpdate("nos",{operation_type:"transfer",error:n&&n.message},!1),t.reporter.reportTraceEnd("nos",1),void e.done(n,e.callback.options);if(t.reporter.reportTraceEnd("nos",0),i=P.parseResponse(i,t.options.exifOrientation),o||i.isS3||(i.url=O.genDownloadUrl(e.nosToken,s.Object,O.serverNosConfig.cdnDomain),e.nosToken.shortUrl&&(i._url_safe=e.nosToken.shortUrl)),k.exist(e.fileInputName))i.name=e.fileInputName;else if(e.blob){var a=e.blob.name;if(i.name=a||"blob-"+i.md5,!a){var c=e.blob.type;i.ext=f(c).call(c,h(c).call(c,"/")+1)}}else e.filePath?i.name=e.filePath:e.fileObject&&(i.name=e.fileObject.fileName);if(!i.ext){var u,l,d=h(u=i.name).call(u,".");i.ext=-1===d?"unknown":f(l=i.name).call(l,d+1)}i.size=i.size||0,i.isS3&&i._url_safe?t.getNosOriginUrl({safeShortUrl:i._url_safe,done:function(r,n){r?t.logger.error("error:","getNosOriginUrl failed",r):(i.url=n,e.done(null,k.copy(i)))}}):e.done(null,k.copy(i))}if(e.mixEnable&&1===e.curProvider&&(s=this.assembleUploadParams(e.mixStoreToken)),O.isWeixinApp)k.verifyOptions(e,"filePath","msg::_doPreviewFile"),t.fileQuickTransfer(e,a,(function(){var r=wx.uploadFile({url:i,filePath:e.filePath,name:"file",formData:s,fail:function(e){a({code:"FAILED",msg:e}),t.logger.error("error:","api::msg:upload file failed",e)},success:function(e){if(200===e.statusCode)try{a(null,JSON.parse(e.data))}catch(r){t.logger.error("error:","parse wx upload file res error",r),a({code:"PARSE_WX_UPLOAD_FILE_RES_ERROR",str:e.data,msg:e.errMsg})}else a({code:e.statusCode,msg:e.errMsg})}});"function"==typeof e.uploadprogress&&r&&(t.logger.info("_doPreviewFile::mini uploadprogress"),r.onProgressUpdate((function(t){e.uploadprogress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percentage:t.progress,percentageText:t.progress+"%"})})))}));else if(O.isNodejs){var c={url:i,name:"file",formData:s,success:function(e){if(200===e.statusCode)try{a(null,JSON.parse(e.data))}catch(r){t.protocol.logger.error("error:","parse nodejs upload file res error",r),a({code:"PARSE_NODEJS_UPLOAD_FILE_RES_ERROR",str:e.data,msg:e.errMsg})}else a({code:e.statusCode,msg:e.errMsg})},fail:function(e){a({code:"FAILED",msg:e}),t.protocol.logger.error("error:","api::msg:upload file failed",e)}};if(e.filePath)c.filePath=e.filePath;else{if("object"!==l(e.fileObject))throw new I("Nodejs上传fileObject参数类型应如 {fileName:..,fileData:..} ");c.fileData=e.fileObject.fileData}t.fileQuickTransfer(e,a,(function(){N.uploadFile(c)}))}else if(O.isRN){var u={url:i,name:"file",formData:s,filePath:e.filePath,success:function(e){if(e.ok&&200===e.status)try{var r=m(e.headers)&&m(e.headers).etag;e.md5=r?"string"==typeof r?r:r[0]:"UNKNOWN",a(null,e)}catch(r){t.protocol.logger.error("error:","parse React Native upload file res error",r),a({code:"PARSE_React_Native_UPLOAD_FILE_RES_ERROR",res:e})}else a({code:e.status,msg:e.statusText})},fail:function(e){a({code:"FAILED",msg:e}),t.protocol.logger.error("error:","api::msg:upload file failed",e)}};t.fileQuickTransfer(e,a,(function(){N.uploadFile(u)}))}else e.uploaddone=a,e.url=i,e.params=s,e.fileName="file",t.fileQuickTransfer(e,a,(function(){return new N(e)}))},R.fileQuickTransfer=function(e,t,r){var n,i=this;e=e||{},t instanceof Function||(t=function(){}),r instanceof Function||(r=function(){});var o=e.fastPass;if(o)try{o=JSON.parse(o),e.fastPass=o}catch(e){i.protocol.logger.error("快传参数解析失败")}var s=e.fileInputName||e.name||e.blob&&e.blob.name||"",a=e.fileSize||e.size||e.blob&&e.blob.size||0,c=o?g(n=(o.md5||e.digest||"")+"").call(n):"",u=e.type||e.blob&&e.blob.type;if(c&&a>=O.threshold){var l=!0,d={name:s,md5:c,ext:f(s).call(s,h(s).call(s,".")+1),type:u};switch(u){case"image":o&&o.w&&o.h?(d.w=o.w,d.h=o.h):(l=!1,i.protocol.logger.error("快传 image 文件缺少参数 w 或 h"));break;case"video":o&&o.w&&o.h&&o.dur?(d.w=o.w,d.h=o.h,d.dur=o.dur):(l=!1,i.protocol.logger.error("快传 video 文件缺少参数 w 或 h 或 dur"));break;case"audio":o&&o.dur?d.dur=o.dur:(l=!1,i.protocol.logger.error("快传 audio 文件缺少参数 dur"))}if(!l)return void r();var p={fileQuickTransfer:{md5:c}};return a&&(p.fileQuickTransfer.size=a),this.protocol.sendCmd("fileQuickTransfer",p,(function(e,n,o){!e&&o&&o.fileQuickTransfer&&o.fileQuickTransfer.url||(i.protocol.logger.error("misc::fileQuickTransfer: not found",e,n),r()),o&&o.fileQuickTransfer&&o.fileQuickTransfer.threshold&&(O.threshold=o.fileQuickTransfer.threshold||0),o&&o.fileQuickTransfer&&o.fileQuickTransfer.url&&(d.size=a||o.fileQuickTransfer.size,d.url=o.fileQuickTransfer.url,o.fileQuickTransfer._url_safe&&(d._url_safe=o.fileQuickTransfer._url_safe),t(e,d,!0))}))}r()},R.sendFile=function(e){if(e.type||(e.type="file"),e=k.merge(e,this.options.providers),k.verifyParamPresentJustOne(e,"dataURL blob fileInput file filePath wxFilePath fileObject","msg::sendFile"),k.exist(e.maxSize)&&k.verifyParamType("maxSize",e.maxSize,"number","api::previewFile"),k.exist(e.commonUpload)&&k.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile"),this.processCallback(e),e.filePath=e.filePath||e.wxFilePath,delete e.wxFilePath,e.dataURL)this._previewAndSendFile(e);else if(e.blob)this._previewAndSendFile(e);else if(e.fileInput){if(e.fileInput=k.verifyFileInput(e.fileInput,"msg::sendFile"),e.fileInput.files&&!e.fileInput.files.length)return void e.done(I.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::sendFile",fileInput:e.fileInput}),e.callback.options);this._previewAndSendFile(e)}else if(e.filePath||e.fileObject)this._previewAndSendFile(e);else if(e.file){var t,r=e.file._url_safe;return r&&(t=e.file.url,e.file.url=r,delete e.file._url_safe),e.msg=new this.message.FileMessage(e),this.sendMsg(e,t)}},R._previewAndSendFile=function(e){var t=this;k.verifyCallback(e,"uploaddone beforesend","msg::_previewAndSendFile"),t.reporter.reportTraceStart("nos",{user_id:this.account,action:"upload"});var r=e.done;e.done=function(n,i){if(e.done=r,n)e.uploaddone(n,e.callback.options),e.done(n,e.callback.options);else{if(/chatroom/.test(e.scene))return;var o;e.uploaddone(null,k.copy(i));var s=i._url_safe;s&&!i.isS3&&(o=i.url,i.url=s,delete i._url_safe),e.file=i,e.msg=new t.message.FileMessage(e),e.beforesend(t.sendMsg(e,o))}},t.previewFile(e)},R.assembleUploadParams=function(e){return e?{Object:decodeURIComponent(e.objectName),"x-nos-token":e.token,"x-nos-entity-type":"json"}:null},R.deleteFile=function(e){k.verifyParamPresentJustOne(e,"docId","msg::deleteFile"),this.removeFile({docId:e.docId,callback:function(t,r){t?e.error&&e.error(t,r):e.success&&e.success(r)}})},R.getFile=function(e){k.verifyParamPresentJustOne(e,"docId","msg::getFile"),this.fetchFile({docId:e.docId,callback:function(t,r){t?e.error&&e.error(t,r):e.success&&e.success(r.info)}})},R.getFileList=function(e){var t=e.fromDocId,r=void 0===t?"":t,n=e.limit,i=void 0===n?10:n,o={limit:i};r&&(o.fromDocId=r),this.fetchFileList({fileListParam:o,callback:function(t,r){t?(i>30&&(t.message=t.message+"::文档条数超过限制:30"),e.error&&e.error(t,r)):e.success&&e.success(r)}})},R.sendGeo=function(e){return this.processCallback(e),e.msg=new this.message.GeoMessage(e),this.sendMsg(e)},R.sendTipMsg=function(e){return this.processCallback(e),e.msg=new this.message.TipMessage(e),this.sendMsg(e)},R.sendCustomMsg=function(e){return this.processCallback(e),e.msg=new this.message.CustomMessage(e),this.sendMsg(e)},R.sendRobotMsg=function(e){return this.logger.warn("this api will be abandon"),this.processCallback(e),e.msg=new this.message.RobotMessage(e),this.sendMsg(e)},R.sendMsg=function(e,t){var r,n=this,i=n.protocol,o=e.msg,s={},a=!!e.isLocal;if(this.logger.warn("sendMsg::start: "+o.idClient),a&&(e.time&&(o.time=e.time),e.idClient&&(o.idClient=e.idClient),e.localFrom&&(r=e.localFrom+"")),e.resend&&("out"!==e.flow||"fail"!==e.status))return k.onError("只能重发发送失败的消息");e.callback.options.idClient=o.idClient,n.beforeSendMsg(e,s);var c=e.rtnMsg=n.formatReturnMsg(o,r);if(t&&!n.options.keepNosSafeUrl&&c.file&&(c.file._url_safe=c.file.url,c.file.url=t,"audio"===c.type&&(c.file.mp3Url=t+(~v(t).call(t,"?")?"&":"?")+"audioTrans&type=mp3")),c.hasOwnProperty("chatroomId")&&!c.chatroomId)return k.onError("聊天室未连接");if(a&&(c.status="success",c.isLocal=!0),i.storeSendMsg&&(s.promise=i.storeSendMsg(c)),e.cbaop=function(e,t){if(e)return 7101===e.code&&(c.isInBlackList=!0,c.idServer=t.idServer,c.time=t.time),"server"!==e.from?(c.status="fail",i.updateSendMsgError&&i.updateSendMsgError(c),c):void 0},!a){t&&!n.options.keepNosSafeUrl&&e.callback&&(e.callback.originUrl=t),e.toAccids&&e.toAccids.length&&(o.toAccids=d(e.toAccids)),s.msg=o;var u=y(),l=o;n.sendCmd(e.cmd,s,(function(){if(O.isBrowser){var t=arguments[0],r=arguments[1]||{},i="chatroom"===n.subType,o=0===l.scene,s={msgId:r.idServer,clientId:l.idClient,msgTime:r.time||u,fromAccid:n.account,toAccid:o?l.to:"",type:i?4:l.scene,roomId:i?n.options.chatroomId:"",tid:i||o?"":l.to,result:t?t.code:200,failReason:t?t.message:"",rt:y()-u};n.reporter&&n.reporter.report("msgSend",s)}e.callback&&e.callback.apply(n,arguments)}))}return n.afterSendMsg(e),a&&b((function(){c=k.simpleClone(c),e.done(null,c)}),0),k.copy(c)},R.beforeSendMsg=function(){},R.afterSendMsg=function(){},R.formatReturnMsg=function(e,t){var r;return e=k.copy(e),this.protocol.completeMsg(e),e.status="sending",t&&(e.from=t),S(r=this.message).call(r,e)},R.resendMsg=function(e){return k.verifyOptions(e,"msg","msg::resendMsg"),this.trimMsgFlag(e),e.resend=!0,this._sendMsgByType(e)},R.forwardMsg=function(e){return k.verifyOptions(e,"msg","msg::forwardMsg"),this.trimMsgFlag(e),this.beforeForwardMsg(e),e.forward=!0,e.msg.idClient=k.guid(),this._sendMsgByType(e)},R.trimMsgFlag=function(e){e&&e.msg&&(e.msg=k.copy(e.msg),delete e.msg.resend,delete e.msg.forward)},R.beforeForwardMsg=function(){},R._sendMsgByType=function(e){switch(k.verifyOptions(e,"msg","msg::_sendMsgByType"),k.verifyParamValid("msg.type",e.msg.type,this.message.validTypes,"msg::_sendMsgByType"),k.merge(e,e.msg),e.type){case"text":return this.sendText(e);case"image":case"audio":case"video":case"file":return this.sendFile(e);case"geo":return this.sendGeo(e);case"custom":return this.sendCustomMsg(e);case"tip":return this.sendTipMsg(e);default:throw new I("不能发送类型为 "+e.type+" 的消息")}},R.parseRobotTemplate=function(e){if(this.logger.warn("this api will be abandon"),/<template[^>/]+\/>/.test(e))return{raw:e,json:[{type:"text",name:"",text:""}]};if(!/<template[^>/]+>/.test(e))return{raw:e,json:[{type:"text",name:"",text:e}]};var t=new A({escapeMode:!1});e=e.replace(/<template [^>]+>/,"<template>");var r=t.xml2js(e);r=r.template.LinearLayout,T(r)||(r=[r]);var n=[];return r=_(r).call(r,(function(e){e.image&&(n=w(n).call(n,o(e))),e.text&&(n=w(n).call(n,i(e))),e.link&&(n=w(n).call(n,function(e){if(e.link){var t=e.link;T(t)||(t=[t]),t=m(t).call(t,(function(e){return e.image&&(e.image=o(e)),e.text&&(e.text=i(e)),"url"===e._type?(e.type="url",e.style=e._style||"",e.target=e._target,delete e._target,delete e._style):"block"===e._type&&(e.type="block",e.style=e._style||"",e.params=e._params||"",e.target=e._target,delete e._params,delete e._target,delete e._style),delete e._type,e})),e.link=t}return e.link}(e)))})),{raw:e,json:n};function i(e){var t;return T(e.text)||(e.text=[e.text]),e.text=m(t=e.text).call(t,(function(e){return{type:"text",name:e._name,text:e.__text}})),e.text}function o(e){var t;return T(e.image)||(e.image=[e.image]),e.image=m(t=e.image).call(t,(function(e){return{type:"image",name:e._name,url:e._url}})),e.image}}},function(e,t,r){var n=r(403);e.exports=n},function(e,t,r){var n=r(16),i=r(404),o=Function.prototype;e.exports=function(e){var t=e.bind;return e===o||n(o,e)&&t===o.bind?i:t}},function(e,t,r){r(405);var n=r(22);e.exports=n("Function").bind},function(e,t,r){var n=r(2),i=r(406);n({target:"Function",proto:!0,forced:Function.bind!==i},{bind:i})},function(e,t,r){var n=r(1),i=r(7),o=r(40),s=r(28),a=r(25),c=r(89),u=r(83),l=n.Function,d=i([].concat),p=i([].join),m={};e.exports=u?l.bind:function(e){var t=o(this),r=t.prototype,n=c(arguments,1),i=function(){var r=d(n,c(arguments));return this instanceof i?function(e,t,r){if(!a(m,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";m[t]=l("C,a","return new C("+p(n,",")+")")}return m[t](e,r)}(t,r.length,r):t.apply(e,r)};return s(r)&&(i.prototype=r),i}},function(e,t,r){var n=r(408);e.exports=n},function(e,t,r){var n=r(16),i=r(409),o=String.prototype;e.exports=function(e){var t=e.trim;return"string"==typeof e||e===o||n(o,e)&&t===o.trim?i:t}},function(e,t,r){r(410);var n=r(22);e.exports=n("String").trim},function(e,t,r){var n=r(2),i=r(137).trim;n({target:"String",proto:!0,forced:r(411)("trim")},{trim:function(){return i(this)}})},function(e,t,r){var n=r(168).PROPER,i=r(9),o=r(111);e.exports=function(e){return i((function(){return!!o[e]()||"​᠎"!=="​᠎"[e]()||n&&o[e].name!==e}))}},function(e,t,r){var n=r(413);e.exports=n},function(e,t,r){r(414);var n=r(12);e.exports=n.Date.now},function(e,t,r){var n=r(2),i=r(1),o=r(7),s=i.Date,a=o(s.prototype.getTime);n({target:"Date",stat:!0},{now:function(){return a(new s)}})},function(e,t,r){var n=r(416);e.exports=n},function(e,t,r){var n=r(16),i=r(417),o=Array.prototype;e.exports=function(e){var t=e.reverse;return e===o||n(o,e)&&t===o.reverse?i:t}},function(e,t,r){r(418);var n=r(22);e.exports=n("Array").reverse},function(e,t,r){var n=r(2),i=r(7),o=r(70),s=i([].reverse),a=[1,2];n({target:"Array",proto:!0,forced:String(a)===String(a.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),s(this)}})},function(e,t,r){e.exports=r(420)},function(e,t,r){var n=r(421);e.exports=n},function(e,t,r){var n=r(184);e.exports=n},function(e,t,r){var n=r(423);e.exports=n},function(e,t,r){var n=r(154);e.exports=n},function(e,t,r){var n=r(425),i=r(192);e.exports=function(e,t){if(null==e)return{};var r,o,s={},a=n(e);for(o=0;o<a.length;o++)r=a[o],i(t).call(t,r)>=0||(s[r]=e[r]);return s},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(426)},function(e,t,r){var n=r(427);e.exports=n},function(e,t,r){var n=r(187);e.exports=n},function(e,t,r){var n,i;void 0===(i="function"==typeof(n=function(e){return function(t){(t=t||{}).arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",t.jsAttributeFilter=t.jsAttributeFilter,t.jsAttributeConverter=t.jsAttributeConverter,t.attributeConverters=t.attributeConverters||[],t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[],t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],t.xmldomOptions=t.xmldomOptions||{},void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),void 0===t.useDoubleQuotes&&(t.useDoubleQuotes=!0),void 0===t.ignoreRoot&&(t.ignoreRoot=!1),void 0===t.escapeMode&&(t.escapeMode=!0),void 0===t.attributePrefix&&(t.attributePrefix="_"),void 0===t.selfClosingElements&&(t.selfClosingElements=!0),void 0===t.keepCData&&(t.keepCData=!1),void 0===t.jsDateUTC&&(t.jsDateUTC=!1),function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),"function"!=typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}();var r=1,n=3,i=4,o=8,s=9;function a(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!==t||(t=e.nodeName),t}function c(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"):e}function u(e,r,n){if("property"===t.arrayAccessForm&&(e[r]instanceof Array?e[r+"_asArray"]=e[r]:e[r+"_asArray"]=[e[r]]),!(e[r]instanceof Array)&&t.arrayAccessFormPaths.length>0){for(var i=!1,o=0;o<t.arrayAccessFormPaths.length;o++){var s=t.arrayAccessFormPaths[o];if("string"==typeof s){if(s===n){i=!0;break}}else if(s instanceof RegExp){if(s.test(n)){i=!0;break}}else if("function"==typeof s&&s(r,n)){i=!0;break}}i&&(e[r]=[e[r]])}}function l(e){var t=e.split(/[-T:+Z]/g),r=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(r.setHours(t[3],t[4],n[0]),n.length>1&&r.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function d(e,r){for(var n={__cnt:0},i=e.childNodes,s=0;s<i.length;s++){var c=i.item(s),d=a(c);c.nodeType!==o&&(n.__cnt++,null==n[d]?(n[d]=p(c,r+"."+d),u(n,d,r+"."+d)):(n[d]instanceof Array||(n[d]=[n[d]],u(n,d,r+"."+d)),n[d][n[d].length]=p(c,r+"."+d)))}for(var m=0;m<e.attributes.length;m++){var f=e.attributes.item(m);n.__cnt++;for(var h=f.value,g=0;g<t.attributeConverters.length;g++){var v=t.attributeConverters[g];v.test.call(null,f.name,f.value)&&(h=v.convert.call(null,f.name,f.value))}n[t.attributePrefix+f.name]=h}var y=e.prefix;return y&&(n.__cnt++,n.__prefix=y),n["#text"]&&(n.__text=n["#text"],n.__text instanceof Array&&(n.__text=n.__text.join("\n")),t.escapeMode&&(n.__text=n.__text.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&")),t.stripWhitespaces&&(n.__text=n.__text.trim()),delete n["#text"],"property"===t.arrayAccessForm&&delete n["#text_asArray"],n.__text=function(e,r,n){if(t.datetimeAccessFormPaths.length>0)for(var i=n.split(".#")[0],o=0;o<t.datetimeAccessFormPaths.length;o++){var s=t.datetimeAccessFormPaths[o];if("string"==typeof s){if(s===i)return l(e)}else if(s instanceof RegExp){if(s.test(i))return l(e)}else if("function"==typeof s&&s(i))return l(e)}return e}(n.__text,0,r+".#text")),n.hasOwnProperty("#cdata-section")&&(n.__cdata=n["#cdata-section"],delete n["#cdata-section"],"property"===t.arrayAccessForm&&delete n["#cdata-section_asArray"]),1===n.__cnt&&n.__text?n=n.__text:0===n.__cnt&&"text"===t.emptyNodeForm?n="":n.__cnt>1&&void 0!==n.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""===n.__text||""===n.__text.trim())&&delete n.__text,delete n.__cnt,t.keepCData||n.hasOwnProperty("__text")||!n.hasOwnProperty("__cdata")||1!==Object.keys(n).length?(t.enableToStringFunc&&(n.__text||n.__cdata)&&(n.toString=function(){return(this.__text?this.__text:"")+(this.__cdata?this.__cdata:"")}),n):n.__cdata?n.__cdata:""}function p(e,o){return e.nodeType===s?function(e){for(var n={},i=e.childNodes,o=0;o<i.length;o++){var s=i.item(o);if(s.nodeType===r){var c=a(s);t.ignoreRoot?n=p(s,c):n[c]=p(s,c)}}return n}(e):e.nodeType===r?d(e,o):e.nodeType===n||e.nodeType===i?e.nodeValue:null}function m(e,r,n,i){var o="<"+(e&&e.__prefix?e.__prefix+":":"")+r;if(n)for(var s=0;s<n.length;s++){var a=n[s],u=e[a];t.escapeMode&&(u=c(u)),o+=" "+a.substr(t.attributePrefix.length)+"=",t.useDoubleQuotes?o+='"'+u+'"':o+="'"+u+"'"}return o+(i?" />":">")}function f(e,t){return"</"+(e&&e.__prefix?e.__prefix+":":"")+t+">"}function h(e,r){return"property"===t.arrayAccessForm&&(i="_asArray",-1!==(n=r.toString()).indexOf(i,n.length-8))||0===r.toString().indexOf(t.attributePrefix)||0===r.toString().indexOf("__")||e[r]instanceof Function;var n,i}function g(e){var t=0;if(e instanceof Object)for(var r in e)h(e,r)||t++;return t}function v(e){var r=[];if(e instanceof Object)for(var n in e)-1===n.toString().indexOf("__")&&0===n.toString().indexOf(t.attributePrefix)&&r.push(n);return r}function y(e){var r="";return e instanceof Object?r+=function(e){var r="";return e.__cdata&&(r+="<![CDATA["+e.__cdata+"]]>"),(e.__text||"number"==typeof e.__text||"boolean"==typeof e.__text)&&(t.escapeMode?r+=c(e.__text):r+=e.__text),r}(e):null!==e&&(t.escapeMode?r+=c(e):r+=e),r}function b(e,r,n){var i="";return t.jsAttributeFilter&&t.jsAttributeFilter.call(null,r,e)||(t.jsAttributeConverter&&(e=t.jsAttributeConverter.call(null,r,e)),null!=e&&""!==e||!t.selfClosingElements?"object"==typeof e?"[object Array]"===Object.prototype.toString.call(e)?i+=function(e,t,r){var n="";if(0===e.length)n+=m(e,t,r,!0);else for(var i=0;i<e.length;i++)n+=b(e[i],t,v(e[i]));return n}(e,r,n):e instanceof Date?(i+=m(e,r,n,!1),i+=t.jsDateUTC?e.toUTCString():e.toISOString(),i+=f(e,r)):g(e)>0||"number"==typeof e.__text||"boolean"==typeof e.__text||e.__text||e.__cdata?(i+=m(e,r,n,!1),i+=S(e),i+=f(e,r)):t.selfClosingElements?i+=m(e,r,n,!0):(i+=m(e,r,n,!1),i+=f(e,r)):(i+=m(e,r,n,!1),i+=y(e),i+=f(e,r)):i+=m(e,r,n,!0)),i}function S(e){var t="";if(g(e)>0)for(var r in e)if(!h(e,r)){var n=e[r];t+=b(n,r,v(n))}return t+y(e)}function T(r){if(void 0===r)return null;if("string"!=typeof r)return null;var n=null,i=null;if(e)i=(n=new e(t.xmldomOptions)).parseFromString(r,"text/xml");else if(window&&window.DOMParser){n=new window.DOMParser;var o=null;if(!window.ActiveXObject&&!("ActiveXObject"in window))try{o=n.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(e){o=null}try{i=n.parseFromString(r,"text/xml"),null!==o&&i.getElementsByTagNameNS(o,"parsererror").length>0&&(i=null)}catch(e){i=null}}else 0===r.indexOf("<?")&&(r=r.substr(r.indexOf("?>")+2)),(i=new ActiveXObject("Microsoft.XMLDOM")).async="false",i.loadXML(r);return i}this.asArray=function(e){return null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?l(e):e},this.xml2dom=function(e){return T(e)},this.dom2js=function(e){return p(e,null)},this.js2dom=function(e){return T(this.js2xml(e))},this.xml2js=function(e){var t=T(e);return null!=t?this.dom2js(t):null},this.js2xml=function(e){return S(e)},this.getVersion=function(){return"3.1.1"}}})?n.apply(t,[]):n)||(e.exports=i)},function(e,t,r){var n=r(17),i=r(6),o=r(26),s=r(14),a=r(0),c=r(36),u=r(81).upload,l=r(81).chunkUpload,d=r(81).abort,p=a.supportFormData;function m(e){var t=this;t.options=a.copy(e),a.verifyOptions(e,"url fileName"),a.verifyParamPresentJustOne(e,"blob fileInput"),a.verifyCallback(e,"beginupload uploadprogress uploaddone"),e.fileInput&&(e.fileInput=a.verifyFileInput(e.fileInput)),e.type&&a.verifyFileType(e.type),e.timeout?a.verifyParamType("timeout",e.timeout,"number"):e.timeout=6e5,a.verifyFileUploadCallback(e),e.data={},e.params&&a.merge(e.data,e.params);var r,o,d=e.fileName,m=e.fileInput;function f(){if(m){if(!(o=e.type?a.filterFiles(m.files,e.type):n([]).call(m.files,0))||!o.length)return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+e.type+"类型的文件"));e.data[d]=o[0],r=m.files[0].size}else if(e.blob){var u;if(e.data[d]=e.blob,"file"!==e.type&&e.blob.type&&-1===i(u=e.blob.type).call(u,e.type))return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保选择了"+e.type+"类型的文件"));r=e.blob.size}if(e.maxSize&&r>e.maxSize)e.uploaddone(c.newFileTooLargeError("上传文件大小超过".concat(e.maxSize,"限制")));else{if(!e.commonUpload)return r>s.chunkMaxSize?void e.uploaddone(c.newFileTooLargeError("直传文件大小超过".concat(s.chunkMaxSize,"限制"))):void(t.sn=l(e,d,t,-1));if(r>s.commonMaxSize)e.uploaddone(c.newFileTooLargeError("普通上传文件大小超过".concat(s.commonMaxSize,"限制")));else if(e.s3Policy&&e.s3Policy.uploadConfig&&e.s3Policy.uploadConfig.retryPolicy){var p=e.s3Policy.uploadConfig.retryPolicy,f={accessKeyId:e.mixStoreToken.accessKeyId,secretAccessKey:e.mixStoreToken.secretAccessKey,sessionToken:e.mixStoreToken.sessionToken,region:e.mixStoreToken.region,maxRetries:p.retry},g=new e.s3;g.config.update(f);var v=decodeURIComponent(e.mixStoreToken.bucket),y=decodeURIComponent(e.mixStoreToken.objectName),b=e.data[d],S=g.upload({Bucket:v,Key:y,Body:b,Metadata:{token:e.mixStoreToken.token},ContentType:b.type||"application/octet-stream"});S.on("httpUploadProgress",(function(t){var r=Math.floor(1e4*t.loaded/t.total)/100,n={docId:e.docId,total:t.total,loaded:t.loaded,percentage:r,percentageText:r+"%"};e.fileInput&&(n.fileInput=e.fileInput),e.blob&&(n.blob=e.blob),e.uploadprogress(n)})),S.send((function(r,n){if(e.docId&&(n.docId=e.docId),r){var o;e.logger.error("error:","api::s3:upload file failed",r);var s=e.providers[(i(o=e.providers).call(o,e.curProvider)+1)%e.providers.length];p.retryNext&&s?(t.addCircuitTimer(e,s),1===s&&e.getMixStoreToken(1,(function(t){e.mixStoreToken=t,h()}))):t.onError(n)}else{var a=t.options.s3Policy.cdnSchema;a=(a=a.replace("{cdnDomain}",t.options.s3Policy.dlcdn)).replace("{objectName}",n.Key),e.uploaddone(null,{size:b.size,name:b.name,url:a,ext:b.name.split(".")[1]||"unknown",_url_safe:e.mixStoreToken.shortUrl,isS3:!0}),e.logger.info("s3 Upload done: fileObj is",{size:b.size,name:b.name,url:a,ext:b.name.split(".")[1]||"unknown",_url_safe:e.mixStoreToken.shortUrl,isS3:!0})}}))}}}function h(){if(p){if(m){if(!(o=e.type?a.filterFiles(m.files,e.type):n([]).call(m.files,0))||!o.length)return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+e.type+"类型的文件"));e.data[d]=o[0],r=m.files[0].size}else if(e.blob){var h;if(e.data[d]=e.blob,"file"!==e.type&&e.blob.type&&-1===i(h=e.blob.type).call(h,e.type))return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保选择了"+e.type+"类型的文件"));r=e.blob.size}if(e.maxSize&&r>e.maxSize)return void e.uploaddone(c.newFileTooLargeError("上传文件大小超过".concat(e.maxSize,"限制")));if(!e.commonUpload)return r>s.chunkMaxSize?void e.uploaddone(c.newFileTooLargeError("直传文件大小超过".concat(s.chunkMaxSize,"限制"))):(t.onLbsUrlFail=function(r){t.reporter.reportTraceStart("nos",{user_id:e.account,action:"upload"}),t.reporter.reportTractUpdate("nos",{operation_type:"transfer",error:"lbs failed",target:r},!1)},void(t.sn=l(e,d,t,-1)));if(r>s.commonMaxSize)return void e.uploaddone(c.newFileTooLargeError("普通上传文件大小超过".concat(s.commonMaxSize,"限制")))}else a.dataset(m,"name",d),e.data.input=m;var g={data:e.data,onaftersend:function(){e.beginupload(t)},onuploading:function(t){var r=Math.floor(1e4*t.loaded/t.total)/100,n={docId:e.docId,total:t.total,loaded:t.loaded,percentage:r,percentageText:r+"%"};e.fileInput&&(n.fileInput=e.fileInput),e.blob&&(n.blob=e.blob),e.uploadprogress(n)},onload:function(r){var n;if(e.docId&&(r.docId=e.docId),!r.Error)return e.uploaddone(null,r),void e.logger.info("nos Upload done: fileObj is",r);if(e.mixEnable&&1===e.curProvider){var o=e.nosPolicy.uploadConfig.retryPolicy,s=e.providers[(i(n=e.providers).call(n,e.curProvider)+1)%e.providers.length];o.retryNext&&s?(t.addCircuitTimer(e,s),2===s&&e.getMixStoreToken(2,(function(t){e.mixStoreToken=t,f()}))):t.onError(r)}else t.onError(r)},onerror:function(r){var n;if(e.mixEnable&&1===e.curProvider){var o,s=e.nosPolicy.uploadConfig.retryPolicy,a=e.providers[(i(o=e.providers).call(o,e.curProvider)+1)%e.providers.length];if(s.retryNext&&a)t.addCircuitTimer(e,a),2===a&&e.getMixStoreToken(2,(function(t){e.mixStoreToken=t,f()}));else try{n=r.result?JSON.parse(r.result):r,t.onError(n)}catch(n){e.uploaddone(new c(r.message,r.code),t.options)}}else try{n=r.result?JSON.parse(r.result):r,t.onError(n)}catch(n){e.uploaddone(new c(r.message,r.code),t.options)}}};p||(g.mode="iframe"),g.putFileAtEnd=!0,t.sn=u(e.url,g)}e.mixEnable&&2===e.curProvider?f():h()}m.prototype.addCircuitTimer=function(e,t){var r=this;if(e.curProvider=t,e.s3Policy&&e.nosPolicy){var n=e[1===e.curProvider?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!n||0===n)return;r.circuitTimer&&clearTimeout(r.circuitTimer),r.circuitTimer=o((function(){e.curProvider=e.providers[0],r.circuitTimer=void 0}),1e3*n)}},m.prototype.onError=function(e){var t,r,n,i=this.options;r=(t=(e=e||{}).Error||e||{}).Code||t.code||"unknown",n=t.Message||t.message||"未知错误",i.uploaddone(new c(r+"("+n+")",r))},m.prototype.abort=function(){d(this.sn)},e.exports=m},function(e,t,r){var n=r(15),i=r(23),o=r(3),s=r(26),a=r(10),c=r(47),u=r(138);function l(e){e.onuploading&&this.on("uploading",e.onuploading),u.call(this,e)}var d=u.prototype,p=l.prototype=n(d);p.doSend=function(){var e,t,r,n=this.options,u=n.headers,l=this.xhr=new XMLHttpRequest;if("multipart/form-data"===u["Content-Type"]){var d,p;delete u["Content-Type"],l.upload.onprogress=i(d=this.onProgress).call(d,this),l.upload.onload=i(p=this.onProgress).call(p,this);var m,f=n.data;n.data=new window.FormData,f&&o(m=c.getKeys(f,n.putFileAtEnd)).call(m,(function(e){var t=f[e];t.tagName&&"INPUT"===t.tagName.toUpperCase()?"file"===t.type&&o([]).call(t.files,(function(e){n.data.append(c.dataset(t,"name")||t.name||e.name||"file-"+c.uniqueID(),e)})):n.data.append(e,t)}))}else if(u["x-nos-token"]){var h,g;l.upload.onprogress=i(h=this.onProgress).call(h,this),l.upload.onload=i(g=this.onProgress).call(g,this)}l.onreadystatechange=i(e=this.onStateChange).call(e,this),0!==n.timeout&&(this.timer=s(i(r=this.onTimeout).call(r,this),n.timeout)),l.open(n.method,n.url,!n.sync),o(t=a(u)).call(t,(function(e){l.setRequestHeader(e,u[e])})),n.cookie&&"withCredentials"in l&&(l.withCredentials=!0),l.send(n.data),this.afterSend()},p.onProgress=function(e){e.lengthComputable&&e.loaded<=e.total&&this.emit("uploading",e)},p.onStateChange=function(){var e,t=this.xhr;4===t.readyState&&(e={status:t.status,result:t.responseText||""},this.onLoad(e))},p.getResponseHeader=function(e){var t=this.xhr;return t?t.getResponseHeader(e):""},p.destroy=function(){clearTimeout(this.timer);try{this.xhr.onreadystatechange=c.f,this.xhr.abort()}catch(e){}d.destroy.call(this)},e.exports=l},function(e,t,r){var n;!function(t){function i(){}var o=i.prototype,s=t.EventEmitter;function a(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}o.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp)for(r in t={},n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r]);else t=n[e]||(n[e]=[]);return t},o.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},o.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},o.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var r,n=this.getListenersAsObject(e),i="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&-1===a(n[r],t)&&n[r].push(i?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var r,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(r=a(i[n],t))&&i[n].splice(r,1);return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):s.call(this,n,i));return this},o.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"===r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var r,n,i,o,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(r=s[o].slice(0),i=0;i<r.length;i++)!0===(n=r[i]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=s,i},void 0===(n=function(){return i}.call(t,r,t,e))||(e.exports=n)}("undefined"!=typeof window?window:this||{})},function(e,t,r){var n=r(15),i=r(6),o=r(3),s=r(23),a=r(77),c=r(47),u=r(138),l=r(194),d="NEJ-UPLOAD-RESULT:",p={};function m(e){this.init(),u.call(this,e)}var f=u.prototype,h=m.prototype=n(f);h.init=function(){var e=!1;function t(e){var t=e.data;if(0===i(t).call(t,d)){var r=(t=JSON.parse(t.replace(d,""))).key,n=p[r];n&&(delete p[r],t.result=decodeURIComponent(t.result||""),n.onLoad(t.result))}}return function(){!function(){if(!e){e=!0;var r=c.getGlobal();r.postMessage?c.on(r,"message",t):(l.addMsgListener(t),l.startTimer())}}()}}(),h.doSend=function(){var e=this,t=e.options,r=e.key="zoro-ajax-upload-iframe-"+c.uniqueID();p[r]=e;var n=e.form=c.html2node('<form style="display:none;"></form>');"undefined"==typeof document||document.body.appendChild(n),n.target=r,n.method="POST",n.enctype="multipart/form-data",n.encoding="multipart/form-data";var i=t.url,a=c.genUrlSep(i);n.action=i+a+"_proxy_=form";var u,l=t.data,d=[],m=[];function f(){o(d).call(d,(function(e,t){var r=m[t];r.parentNode&&(e.name=r.name,c.isFunction(e.setAttribute)&&e.setAttribute("form",r.getAttribute("form")),r.parentNode.replaceChild(e,r))}))}l&&o(u=c.getKeys(l,t.putFileAtEnd)).call(u,(function(e){var t=l[e];if(t.tagName&&"INPUT"===t.tagName.toUpperCase()){if("file"===t.type){var r=t,i=r.cloneNode(!0);r.parentNode.insertBefore(i,r);var o=c.dataset(r,"name");o&&(r.name=o),n.appendChild(r),c.isFunction(r.setAttribute)&&(r.setAttribute("form",""),r.removeAttribute("form")),d.push(t),m.push(i)}}else{var s=c.html2node('<input type="hidden"/>');s.name=e,s.value=t,n.appendChild(s)}}));var h=e.iframe=c.createIframe({name:r,onload:function(){var t;e.aborted?f():(c.on(h,"load",s(t=e.checkResult).call(t,e)),n.submit(),f(),e.afterSend())}})},h.checkResult=function(){var e,t;try{var r,n;if(e=this.iframe.contentWindow.document.body,t=a(r=e.innerText||e.textContent||"").call(r),i(t).call(t,d)>=0||i(n=e.innerHTML).call(n,d)>=0)return}catch(e){return}this.onLoad(t)},h.onLoad=function(e){f.onLoad.call(this,{status:200,result:e}),c.remove(this.form),c.remove(this.iframe),f.destroy.call(this)},h.destroy=function(){c.remove(this.iframe),c.remove(this.form)},h.abort=function(){this.aborted=!0,delete p[this.key],f.abort.call(this)},e.exports=m},function(e,t,r){r(188);var n=r(12);e.exports=n.setInterval},function(e,t,r){var n=r(15),i=r(6),o=r(23),s=r(3),a=r(47),c=r(194),u=r(138),l={};function d(e){this.init(),u.call(this,e)}var p=u.prototype,m=d.prototype=n(p);m.init=function(){var e="NEJ-AJAX-DATA:",t=!1;function r(t){var r=t.data;if(0===i(r).call(r,e)){var n=(r=JSON.parse(r.replace(e,""))).key,o=l[n];o&&(delete l[n],r.result=decodeURIComponent(r.result||""),o.onLoad(r))}}return function(){!function(){if(!t){t=!0;var e=a.getGlobal();e.postMessage?a.on(e,"message",r):c.addMsgListener(r)}}()}}(),m.doSend=function(){var e=this.options,t=a.url2origin(e.url),r=e.proxyUrl||t+"/res/nej_proxy_frame.html",n=l[r];if(a.isArray(n)){var i;n.push(o(i=this.doSend).call(i,this,e))}else{var u;if(!n)return l[r]=[o(u=this.doSend).call(u,this,e)],void a.createIframe({src:r,onload:function(e){var t=l[r];l[r]=a.target(e).contentWindow,s(t).call(t,(function(e){try{e()}catch(e){}}))}});if(!this.aborted){var d=this.key=a.uniqueID();l[d]=this;var p=a.fetch({method:"GET",url:"",data:null,headers:{},timeout:0},e);p.key=d,c.postMessage(n,{data:p}),this.afterSend()}}},m.abort=function(){this.aborted=!0,delete l[this.key],p.abort.call(this)},e.exports=d},function(e,t,r){var n,i,o=r(11),s=r(47),a=r(112),c=(n=/json/i,i=/post/i,function(e,t){var r=(t=t||{}).data=t.data||{},c=t.headers=t.headers||{},u=s.checkWithDefault(c,"Accept","application/json"),l=s.checkWithDefault(c,"Content-Type","application/json");return n.test(u)&&(t.type="json"),i.test(t.method)&&n.test(l)&&(t.data=o(r)),a(e,t)});e.exports=c},function(e,t,r){var n=r(112);e.exports=function(e,t){return t.method="POST",t.headers=t.headers||{},t.headers["Content-Type"]="multipart/form-data",t.timeout=0,t.type=t.type||"json",n(e,t)}},function(e,t,r){var n=r(17),i=r(50),o=r(6),s=r(4),a=r(14),c=a.chunkSize,u=r(112),l={mp4:"video/mp4",avi:"video/x-msvideo",wmv:"video/x-ms-wmv",mpeg:"video/mpeg",mov:"video/quicktime",aac:"audio/x-aac",wma:"audio/x-ms-wma",wav:"audio/x-wav",mp3:"audio/mp3"};e.exports=function e(t,r,d,p){var m={file:t.data[r],fileSize:t.data[r].size,fileUploadedSize:0,percentage:0},f=t.url;function h(e){var r=m.fileUploadedSize+e.loaded,n=Math.floor(1e4*r/m.fileSize)/100;if(i(n)>=100&&(n=100,h=function(){}),m.percentage!==n){m.percentage=n;var o={docId:t.docId,total:m.fileSize,loaded:r,percentage:n,percentageText:n+"%"};t.fileInput&&(o.fileInput=t.fileInput),t.blob&&(o.blob=t.blob),t.uploadprogress(o)}}function g(n){var i=n&&n.code;function o(){try{if(n.result)var e=JSON.parse(n.result);else e=n;d.onError(e)}catch(e){d.onError(e)}}0===m.fileUploadedSize&&"abort"!==i?t.edgeList?p<t.edgeList.length-1?e(t,r,d,p+1):o():t.nosLbsUrls&&t.nosLbsUrls.length>0?function(e,t,r,n){return new s((function(i){function o(){u(r[e],{query:{version:"1.0",bucketname:t},method:"GET",onerror:s,onload:function(e){try{(e=JSON.parse(e))&&e.upload&&e.upload.length?i(e.upload):s()}catch(e){s()}}})}function s(){n.onLbsUrlFail(r[e]),e<r.length-1?(e++,o()):i([])}o()}))}(0,t.nosToken.bucket,t.nosLbsUrls,d).then((function(n){n.length>0?(t.edgeList=n,t.updateNosEdgeList&&t.updateNosEdgeList(n),e(t,r,d,p+1)):o()})):(t.edgeList=a.edgeList,e(t,r,d,p+1)):o()}"number"!=typeof p&&(p=-1),t.edgeList&&t.edgeList.length&&(p=p>0?p:0,f=t.edgeList[p]),f+="/"+t.nosToken.bucket+"/"+t.nosToken.objectName;var v=t.data.file&&t.data.file.type;if(!v||o(v).call(v,"/")<0){var y=(t.fileInputName||"").split(".").pop();"image"===t.type?v="image/"+("jpg"===y?"jpeg":y):"audio"!==t.type&&"video"!==t.type||(v=l[y])}var b={query:{offset:0,complete:c>=m.fileSize,version:"1.0"},headers:{"Content-Type":v||"application/octet-stream","x-nos-token":t.nosToken.token},method:"POST",timeout:0,onaftersend:function(){t.beginupload(d)},onuploading:h,onload:function e(r){try{r=JSON.parse(r)}catch(r){return void d.onError(r)}if(r.errMsg||r.errCode)d.onError(r);else if(r.offset<m.fileSize)delete b.onaftersend,m.fileUploadedSize=r.offset,function(t,r,i,o){var s=t.offset,a=t.offset+c;if("undefined"!=typeof FileReader){var l,p=new FileReader;p.readAsArrayBuffer(n(l=o.file).call(l,s,a)),p.addEventListener("load",(function(n){r.data=n.target.result,r.query.offset=t.offset,r.query.complete=a>=o.fileSize,r.query.context=t.context,r.onuploading=h,r.onload=e,r.onerror=g,d.sn=u(f,r)})),p.addEventListener("error",(function(e){r.onerror(e.target.error)}))}else{var m;r.data=n(m=o.file).call(m,s,a),r.query.offset=t.offset,r.query.complete=a>=o.fileSize,r.query.context=t.context,r.onuploading=h,r.onload=e,r.onerror=g,d.sn=u(f,r)}}(r,b,0,m);else{var i=a.genFileUrl(t.nosToken);"image"===t.type?u(i+"?imageInfo",{onload:function(e){try{e=JSON.parse(e),t.uploaddone(null,{docId:r.docId,w:e.Width,h:e.Height,orientation:e.Orientation||"",type:e.Type,size:e.Size||m.fileSize})}catch(e){o(e)}},onerror:function(e){if("undefined"!=typeof Image){var n=new Image;n.src=i,n.onload=function(){t.uploaddone(null,{docId:r.docId,w:n.width,h:n.height,size:m.fileSize})},n.onerror=function(e){o(e)}}else o(e)}}):"video"===t.type||"audio"===t.type?u(i+"?vinfo",{onload:function(e){try{(e=JSON.parse(e)).GetVideoInfo&&e.GetVideoInfo.VideoInfo&&(e=e.GetVideoInfo.VideoInfo),t.uploaddone(null,{docId:r.docId,w:e.Width,h:e.Height,dur:e.Duration,orientation:e.Rotate,audioCodec:e.AudioCodec,videoCodec:e.VideoCodec,container:e.Container,size:e.Size||m.fileSize})}catch(e){o(e)}},onerror:o}):t.uploaddone(null,{docId:r.docId,size:m.fileSize})}function o(e){d.onError(e)}},onerror:g};if("undefined"!=typeof FileReader){var S,T=new FileReader;T.addEventListener("load",(function(e){b.data=e.target.result,d.sn=u(f,b)})),T.addEventListener("error",(function(e){b.onerror(e.target.error)})),T.readAsArrayBuffer(n(S=m.file).call(S,0,c))}else{var _;b.data=n(_=m.file).call(_,0,c),d.sn=u(f,b)}}},function(e,t,r){var n,i=r(110),o=r(6),s=r(11),a=r(23),c=r(8),u=r(17),l=r(10),d=r(0),p=r(52).fn,m=r(196),f=r(193),h=r(36);p.transDoc=function(e){var t;d.verifyOptions(e,"fileInput done","nos::transDoc");try{var r=e.fileInput.files[0],n=["ppt","pdf","pptx","doc","docx"],c=e.fileInputName=r.name,u={ppt:1,pptx:2,pdf:3,doc:6,docx:7},l=c.substring(i(c).call(c,".")+1);if(o(n).call(n,l)<0)return void e.done(h.newNoFileError("请上传正确格式的文件【ppt, pptx, pdf, doc, docx】",{callFunc:"nos: transDoc",fileInput:e.fileInput}),e)}catch(t){return void e.done(h.newNoFileError("请上传正确的文件节点",{callFunc:"msg::previewFile",fileInput:e.fileInput}),e)}var p=s(f.genResponseBody("file")||{}).replace(/"/gi,'\\"'),m={transToken:{name:c,type:u[l],transType:"png"===e.transcode?11:10,size:r.size,body:p}};this.getNosTokenTrans({responseBody:m,nosToken:{nosScene:e.nosScene||this.nosScene,nosSurvivalTime:e.nosSurvivalTime},callback:a(t=function(t,r){t?e.done(t):(e.nosToken=r.nosToken,e.docId=r.docId,this._doPreviewFile(e))}).call(t,this)})},p.getSimpleNosToken=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.num=1,d.verifyOptions(e),this.cbAndSendCmd("getSimpleNosToken",e)},p.getNosToken=function(e){var t=e.callback,r=e.nosToken,n=e.responseBody,i={tag:r.nosScene};r.nosSurvivalTime&&r.nosSurvivalTime!==1/0&&(i.expireSec=r.nosSurvivalTime),this.sendCmd("getNosToken",{responseBody:n,nosToken:i},t)},p.getNosTokenTrans=function(e){this.sendCmd("getNosTokenTrans",e.responseBody,e.callback)},p.getMixStoreToken=function(e){this.sendCmd("getMixStoreToken",{mixTokenReq:{provider:e.curProvider,tokenCount:e.tokenCount||1,tag:"im",returnBody:e.responseBody}},e.callback)},p.packFileDownloadName=function(e){d.verifyOptions(e,"url name",!0,"","nos::packFileDownloadName");var t=e.url;return t+d.genUrlSep(t)+"download="+encodeURIComponent(e.name)},p.audioToMp3=function(e){d.verifyOptions(e,"url","nos::audioToMp3");var t=e.url;return t+d.genUrlSep(t)+"audioTrans&type=mp3"},p.removeFile=function(e){this.sendCmd("removeFile",e,e.callback)},p.fetchFile=function(e){this.sendCmd("fetchFile",e,e.callback)},p.fetchFileList=function(e){this.sendCmd("fetchFileList",e,e.callback)},p.stripImageMeta=function(e){return this.beforeProcessImage(e,"stripmeta")},p.qualityImage=function(e){return this.beforeProcessImage(e,"quality")},p.interlaceImage=function(e){return this.beforeProcessImage(e,"interlace")},p.rotateImage=function(e){return this.beforeProcessImage(e,"rotate")},p.blurImage=function(e){return this.beforeProcessImage(e,"blur")},p.cropImage=function(e){return this.beforeProcessImage(e,"crop")},p.thumbnailImage=function(e){return this.beforeProcessImage(e,"thumbnail")},p.beforeProcessImage=function(e,t){var r=d.copy(e);return r.type=t,e.ops=[r],this.processImage(e)},p.processImage=function(e){var t,r=this;d.verifyOptions(e,"url ops",!0,"","nos::processImage"),d.verifyParamType("ops",e.ops,"array","nos::processImage");var n=c(t=e.ops).call(t,(function(e){var t,n;return d.verifyOptions(e,"type",!0,"","nos::processImage"),d.verifyParamValid("type",e.type,m.validTypes,"nos::processImage"),r["gen"+u(t=e.type).call(t,0,1).toUpperCase()+u(n=e.type).call(n,1)+"Op"](e)}));r.processCallback(e),r.sendCmd("processImage",{url:e.url,imageOps:n},e.callback)},p.genStripmetaOp=function(e){return new m({type:e.type,stripmeta:e.strip?1:0})},p.genQualityOp=function(e){d.verifyOptions(e,"quality",!0,"","nos::genQualityOp"),d.verifyParamType("quality",e.quality,"number","nos::genQualityOp"),d.verifyParamMin("quality",e.quality,0,"nos::genQualityOp"),d.verifyParamMax("quality",e.quality,100,"nos::genQualityOp");var t=Math.round(e.quality);return new m({type:e.type,qualityQuality:t})},p.genInterlaceOp=function(e){return new m({type:e.type})},p.genRotateOp=function(e){for(d.verifyOptions(e,"angle",!0,"","nos::genRotateOp"),d.verifyParamType("angle",e.angle,"number","nos::genRotateOp");e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t=Math.round(e.angle);return new m({type:e.type,rotateAngle:t})},p.genBlurOp=function(e){d.verifyOptions(e,"radius sigma","nos::genBlurOp"),d.verifyParamType("radius",e.radius,"number","nos::genBlurOp"),d.verifyParamMin("radius",e.radius,1,"nos::genBlurOp"),d.verifyParamMax("radius",e.radius,50,"nos::genBlurOp"),d.verifyParamType("sigma",e.sigma,"number","nos::genBlurOp"),d.verifyParamMin("sigma",e.sigma,0,"nos::genBlurOp");var t=Math.round(e.radius),r=Math.round(e.sigma);return new m({type:e.type,blurRadius:t,blurSigma:r})},p.genCropOp=function(e){d.verifyOptions(e,"x y width height","nos::genCropOp"),d.verifyParamType("x",e.x,"number","nos::genCropOp"),d.verifyParamMin("x",e.x,0,"nos::genCropOp"),d.verifyParamType("y",e.y,"number","nos::genCropOp"),d.verifyParamMin("y",e.y,0,"nos::genCropOp"),d.verifyParamType("width",e.width,"number","nos::genCropOp"),d.verifyParamMin("width",e.width,0,"nos::genCropOp"),d.verifyParamType("height",e.height,"number","nos::genCropOp"),d.verifyParamMin("height",e.height,0,"nos::genCropOp");var t=Math.round(e.x),r=Math.round(e.y),n=Math.round(e.width),i=Math.round(e.height);return new m({type:e.type,cropX:t,cropY:r,cropWidth:n,cropHeight:i})},p.genThumbnailOp=(n={cover:"z",contain:"x",crop:"y"},function(e){d.verifyOptions(e,"mode","nos::genThumbnailOp"),d.verifyParamValid("mode",e.mode,l(n),"nos::genThumbnailOp"),"contain"===e.mode?d.verifyParamAtLeastPresentOne(e,"width height","nos::genThumbnailOp"):d.verifyOptions(e,"width height","nos::genThumbnailOp"),d.undef(e.width)&&(e.width=0),d.undef(e.height)&&(e.height=0),d.verifyParamType("width",e.width,"number","nos::genThumbnailOp"),d.verifyParamMin("width",e.width,0,"nos::genThumbnailOp"),d.verifyParamType("height",e.height,"number","nos::genThumbnailOp"),d.verifyParamMin("height",e.height,0,"nos::genThumbnailOp");var t=Math.round(e.width),r=Math.round(e.height),i=new m({type:e.type,thumbnailMode:n[e.mode],thumbnailWidth:t,thumbnailHeight:r});if("crop"===e.mode&&d.notundef(e.axis)){d.undef(e.axis.x)&&(e.axis.x=5),d.undef(e.axis.y)&&(e.axis.y=5),d.verifyParamMin("axis.x",e.axis.x,0,"nos::genThumbnailOp"),d.verifyParamMax("axis.x",e.axis.x,10,"nos::genThumbnailOp"),d.verifyParamMin("axis.y",e.axis.y,0,"nos::genThumbnailOp"),d.verifyParamMax("axis.y",e.axis.y,10,"nos::genThumbnailOp");var o=Math.round(e.axis.x),s=Math.round(e.axis.y);i.thumbnailAxisX=o,i.thumbnailAxisY=s}return d.notundef(e.enlarge)&&(d.verifyParamType("enlarge",e.enlarge,"boolean","nos::genThumbnailOp"),e.enlarge&&(i.thumbnailEnlarge=1)),i.thumbnailToStatic=this.options.thumbnailToStatic?1:0,i}),p.getNosOriginUrl=function(e){var t;d.verifyOptions(e,"safeShortUrl",!0,"","nos::getNosOriginUrl"),d.verifyParamType("safeShortUrl",e.safeShortUrl,"string","nos::getNosOriginUrl"),/^http(s)?:/.test(e.safeShortUrl)&&~o(t=e.safeShortUrl).call(t,"im_url=1")?(this.processCallback(e),this.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e.safeShortUrl}},e.callback)):e.done(new h("参数 “safeShortUrl” 内容非文件安全短链",{callFunc:"nos: getNosOriginUrl"}),e)}},function(e,t,r){var n,i=r(13),o=r(6),s=r(10),a=r(27),c=r(82),u=c.genUrlSep,l=c.url2object,d=c.object2url,p=r(0),m=r(52).fn;m.viewImageSync=function(e){var t=this.options;p.verifyOptions(e,"url","nos::viewImageSync");var r=e.url,n=l(r),s=n.protocol,c=n.hostname,u=n.path,m=n.query;if("boolean"==typeof e.strip&&(m.stripmeta=e.strip?1:0),"number"==typeof e.quality&&(p.verifyParamMin("quality",e.quality,0,"nos::viewImageSync"),p.verifyParamMax("quality",e.quality,100,"nos::viewImageSync"),m.quality=Math.round(e.quality)),"boolean"==typeof e.interlace&&(m.interlace=e.interlace?1:0),"number"==typeof e.rotate&&(m.rotate=Math.round(e.rotate)),"object"===a(e.thumbnail)){var f=e.thumbnail.mode||"crop",h=e.thumbnail.width,g=e.thumbnail.height;if(h>=0&&g>=0&&h<4096&&g<4096&&(h>0||g>0)){var v,y;switch(f){case"crop":f="y";break;case"contain":default:f="x";break;case"cover":f="z"}m.thumbnail=i(v=i(y="".concat(h)).call(y,f)).call(v,g)}}if(t.downloadUrl){var b=l(e.url),S=t.downloadUrl,T=b.path,_=o(T).call(T,"/");if(-1!==_){var w=T.substring(0,_),M=T.substring(_+1);S=S.replace("{bucket}",w).replace("{object}",M)}var x=l(S);return d({protocol:x.protocol,hostname:x.hostname,path:x.path,query:p.merge(x.query,m)})}return d({protocol:s,hostname:c,path:u,query:m})},m.viewImageStripMeta=function(e){p.verifyOptions(e,"url strip","nos::viewImageStripMeta"),p.verifyParamType("strip",e.strip,"boolean","nos::viewImageStripMeta");var t="stripmeta="+(e.strip?1:0),r=u(e.url);return e.url+r+t},m.viewImageQuality=function(e){p.verifyOptions(e,"url quality","nos::viewImageQuality"),p.verifyParamType("quality",e.quality,"number","nos::viewImageQuality"),p.verifyParamMin("quality",e.quality,0,"nos::viewImageQuality"),p.verifyParamMax("quality",e.quality,100,"nos::viewImageQuality");var t="quality="+Math.round(e.quality),r=u(e.url);return e.url+r+t},m.viewImageInterlace=function(e){p.verifyOptions(e,"url","nos::viewImageInterlace");var t=u(e.url);return e.url+t+"interlace=1"},m.viewImageRotate=function(e){for(p.verifyOptions(e,"url angle","nos::viewImageRotate"),p.verifyParamType("angle",e.angle,"number","nos::viewImageRotate");e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t="rotate="+Math.round(e.angle),r=u(e.url);return e.url+r+t},m.viewImageBlur=function(e){p.verifyOptions(e,"url radius sigma","nos::viewImageBlur"),p.verifyParamType("radius",e.radius,"number","nos::viewImageBlur"),p.verifyParamMin("radius",e.radius,1,"nos::viewImageBlur"),p.verifyParamMax("radius",e.radius,50,"nos::viewImageBlur"),p.verifyParamType("sigma",e.sigma,"number","nos::viewImageBlur"),p.verifyParamMin("sigma",e.sigma,0,"nos::viewImageBlur");var t="blur="+Math.round(e.radius)+"x"+Math.round(e.sigma),r=u(e.url);return e.url+r+t},m.viewImageCrop=function(e){p.verifyOptions(e,"url x y width height","nos::viewImageCrop"),p.verifyParamType("x",e.x,"number","nos::viewImageCrop"),p.verifyParamMin("x",e.x,0,"nos::viewImageCrop"),p.verifyParamType("y",e.y,"number","nos::viewImageCrop"),p.verifyParamMin("y",e.y,0,"nos::viewImageCrop"),p.verifyParamType("width",e.width,"number","nos::viewImageCrop"),p.verifyParamMin("width",e.width,0,"nos::viewImageCrop"),p.verifyParamType("height",e.height,"number","nos::viewImageCrop"),p.verifyParamMin("height",e.height,0,"nos::viewImageCrop");var t="crop="+Math.round(e.x)+"_"+Math.round(e.y)+"_"+Math.round(e.width)+"_"+Math.round(e.height),r=u(e.url);return e.url+r+t},m.viewImageThumbnail=(n={cover:"z",contain:"x",crop:"y"},function(e){p.verifyOptions(e,"url mode","nos::viewImageThumbnail"),p.verifyParamValid("mode",e.mode,s(n),"nos::viewImageThumbnail"),"contain"===e.mode?p.verifyParamAtLeastPresentOne(e,"width height","nos::viewImageThumbnail"):p.verifyOptions(e,"width height","nos::viewImageThumbnail"),p.undef(e.width)&&(e.width=0),p.undef(e.height)&&(e.height=0),p.verifyParamType("width",e.width,"number","nos::viewImageThumbnail"),p.verifyParamMin("width",e.width,0,"nos::viewImageThumbnail"),p.verifyParamType("height",e.height,"number","nos::viewImageThumbnail"),p.verifyParamMin("height",e.height,0,"nos::viewImageThumbnail");var t=Math.round(e.width),r=Math.round(e.height),i="thumbnail="+t+n[e.mode]+r;"crop"===e.mode&&p.notundef(e.axis)&&(p.undef(e.axis.x)&&(e.axis.x=5),p.undef(e.axis.y)&&(e.axis.y=5),p.verifyParamMin("axis.x",e.axis.x,0,"nos::viewImageThumbnail"),p.verifyParamMax("axis.x",e.axis.x,10,"nos::viewImageThumbnail"),p.verifyParamMin("axis.y",e.axis.y,0,"nos::viewImageThumbnail"),p.verifyParamMax("axis.y",e.axis.y,10,"nos::viewImageThumbnail"),i=i+"&axis="+Math.round(e.axis.x)+"_"+Math.round(e.axis.y)),p.notundef(e.enlarge)&&(p.verifyParamType("enlarge",e.enlarge,"boolean","nos::viewImageThumbnail"),e.enlarge&&(i+="&enlarge=1"));var o=u(e.url);return e.url+o+i})},function(e,t,r){var n=r(441);e.exports=n},function(e,t,r){var n=r(16),i=r(442),o=r(444),s=Array.prototype,a=String.prototype;e.exports=function(e){var t=e.includes;return e===s||n(s,e)&&t===s.includes?i:"string"==typeof e||e===a||n(a,e)&&t===a.includes?o:t}},function(e,t,r){r(443);var n=r(22);e.exports=n("Array").includes},function(e,t,r){var n=r(2),i=r(127).includes,o=r(146);n({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(e,t,r){r(445);var n=r(22);e.exports=n("String").includes},function(e,t,r){var n=r(2),i=r(7),o=r(446),s=r(84),a=r(43),c=r(448),u=i("".indexOf);n({target:"String",proto:!0,forced:!c("includes")},{includes:function(e){return!!~u(a(s(this)),a(o(e)),arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(1),i=r(447),o=n.TypeError;e.exports=function(e){if(i(e))throw o("The method doesn't accept regular expressions");return e}},function(e,t,r){var n=r(28),i=r(66),o=r(18)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(18)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){var n=r(27),i=r(11),o=r(6),s=r(213),a=r(0),c=r(52).fn,u=r(14);function l(e,t,r,n){var i=!1,s="";if(1===r?o(e).call(e,t)>=0&&(i=!0,s=t):2===r&&(s=new RegExp(t,"g")).test(e)&&(i=!0),i&&""!==s)switch(n){case 1:return e.replace(s,"**");case 2:return{code:2};case 3:return{code:3}}return e}function d(e,t){for(var r=t.match,i=t.operate,o=e,a=0;a<s(t).length;a++){var c=s(t)[a],u=c.match||r,d=c.operate||i;try{if(o=l(o,c.key,u,d),"object"===n(o))return o}catch(e){this.logger.warn("misc::filterContent: js cannot parse this regexp ",e)}}return o}c.uploadSdkLogUrl=function(e){return a.verifyOptions(e,"url","misc::uploadSdkLogUrl"),this.cbAndSendCmd("uploadSdkLogUrl",e)},c.getClientAntispamLexicon=function(e){var t=this,r=(e=e||{}).done;r instanceof Function||(r=function(){}),e={clientAntispam:{version:0}};var n=this;if(u.hasLocalStorage&&localStorage.getItem("antispamLexicon")&&"{}"!==localStorage.getItem("antispamLexicon"))try{n.antispamLexicon=JSON.parse(localStorage.getItem("antispamLexicon"))}catch(e){this.logger.error("JSON parse antispamLexicon error",e)}n.antispamLexicon&&r.call(this,null,{clientAntispam:n.antispamLexicon}),this.protocol.sendCmd("getClientAntispam",e,(function(e,o,s){e?(n.protocol.logger.error("misc::getClientAntispamLexicon:",e),r.call(t,e,{})):(u.hasLocalStorage&&localStorage.setItem("antispamLexicon",i(s.clientAntispam)),n.antispamLexicon||r.call(t,null,s),n.antispamLexicon=s.clientAntispam||{})}))},c.filterClientAntispam=function(e){var t=e.content;if(!t)return{code:404,errmsg:"待反垃圾文本content不存在"};var r=this.antispamLexicon&&this.antispamLexicon.thesaurus;if(!r)return{code:404,errmsg:"没有反垃圾词库或者词库格式不合法"};try{r=JSON.parse(r).thesaurus}catch(e){return this.protocol.logger.error("misc::filterClientAntispam: parse thesaurus error"),{code:500,errmsg:"反垃圾词库格式不合法"}}for(var i=t,o=0;o<r.length;o++)if(i=d.call(this,i,r[o]),"object"===n(i)){if(2===i.code)return{code:200,type:2,errmsg:"建议拒绝发送",content:t,result:""};if(3===i.code)return{code:200,type:3,errmsg:"建议服务器处理反垃圾，发消息带上字段clientAntiSpam",content:t,result:t}}return i===t?{code:200,type:0,errmsg:"",content:t,result:i}:{code:200,type:1,errmsg:"已对特殊字符做了过滤",content:t,result:i}},c.getServerTime=function(e){this.processCallback(e),this.sendCmd("getServerTime",{},e.callback)},c.getNosAccessToken=function(e){a.verifyOptions(e,"url","misc::getNosAccessToken"),this.processCallback(e);var t={url:e.url};e.userAgent&&(t.userAgent=e.userAgentv),e.ext&&(t.ext=e.ext),this.sendCmd("getNosAccessToken",{nosAccessTokenTag:t},(function(t,r,n){var i=n&&n.nosAccessTokenTag&&n.nosAccessTokenTag.token,s=e.url,a=i?{token:i,resUrl:o(s).call(s,"?")?s+"&token="+i:s+"?token="+i}:{};e.done(t,a)}))},c.deleteNosAccessToken=function(e){a.verifyOptions(e,"token","misc::deleteNosAccessToken"),this.processCallback(e),this.sendCmd("deleteNosAccessToken",{nosAccessTokenTag:{token:e.token}},e.callback)}},function(e,t,r){r(56);var n=r(46),i=r(25),o=r(16),s=r(451),a=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.keys;return e===a||o(a,e)&&t===a.keys||i(c,n(e))?s:t}},function(e,t,r){var n=r(452);e.exports=n},function(e,t,r){r(73),r(88);var n=r(22);e.exports=n("Array").keys},function(e,t,r){var n=r(27),i=r(4),o=r(8),s=r(11),a=r(52).fn,c=r(0),u=r(139),l=r(197);a.signalingCreate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=e.channelName,n=e.ext;return c.verifyOptions(e,"type","api::signalling"),this.sendCmdUsePromise("signalingCreate",{avSignalTag:{type:t,channelName:r,ext:n}}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingDelay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingDelay",{avSignalTag:e}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingClose=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingClose",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingJoin=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingJoin",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingLeave=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingLeave",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingGetChannelInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.channelName;return c.verifyOptions(e,"channelName","api::signalling"),this.sendCmdUsePromise("signalingGetChannelInfo",{avSignalTag:{channelName:t}}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingInvite=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.offlineEnabled,o=e.pushInfo,a=void 0===o?{}:o;c.verifyOptions(e,"channelId requestId account","api::signalling"),"object"===n(a.pushPayload)&&(a.pushPayload=s(a.pushPayload));var u=c.merge(e,a,{to:t,isSave:!0===r?1:0,needPush:!0===a.needPush?1:0,needBadge:!1===a.needBadge?0:1});return this.sendCmdUsePromise("signalingInvite",{avSignalTag:u}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,t.needBadge=1===t.needBadge,t.needPush=1===t.needPush,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingCancel=function(e){var t=e.account,r=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingCancel",{avSignalTag:c.merge(e,{to:t,isSave:!0===r?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingCreateAndJoin=function(e){var t=this,r=e.channelName,n=e.uid,o=void 0===n?0:n,s=e.offlineEnabled,a=void 0===s||s,u=e.attachExt,l=void 0===u?"":u;return this.signalingCreate(e).catch((function(e){return 10405===e.code?(t.logger.warn("api::avSignal:signalingCall room already exists:",e),t.signalingGetChannelInfo({channelName:r})):i.reject(e)})).then((function(r){var n={channelId:r.channelId,offlineEnabled:a,attachExt:l,nertcChannelName:e.nertcChannelName,nertcTokenTtl:e.nertcTokenTtl,nertcJoinRoomQueryParamMap:e.nertcJoinRoomQueryParamMap};return o&&c.merge(n,{uid:o}),t.signalingJoin(n)}))},a.signalingCall=function(e){var t=this,r=e.account,n=e.offlineEnabled,i=e.requestId;c.verifyOptions(e,"type requestId account","api::signalling");var o="";return this.signalingCreateAndJoin(e).then((function(s){o=s.channelId||o,t.logger.info("api::avSignal:signalingCall join:",o);var a={channelId:o,account:r,requestId:i,offlineEnabled:n,attachExt:e.attachExt||"",pushInfo:e.pushInfo||{},nertcTokenTtl:s.nertcTokenTtl,nertcToken:s.nertcToken};return t.signalingInvite(a)}))},a.signalingReject=function(e){var t=e.account,r=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingReject",{avSignalTag:c.merge(e,{to:t,isSave:!0===r?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingAccept=function(e){var t=this,r=e.account,n=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingAccept",{avSignalTag:c.merge(e,{to:r,isSave:!0===n?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))})).then((function(r){if(e.autoJoin){var n={channelId:e.channelId,offlineEnabled:e.offlineEnabled,attachExt:e.joinAttachExt,uid:e.uid,nertcChannelName:e.nertcChannelName,nertcTokenTtl:e.nertcTokenTtl,nertcJoinRoomQueryParamMap:e.nertcJoinRoomQueryParamMap};return t.signalingJoin(n)}return r}))},a.signalingControl=function(e){var t=e.account;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingControl",{avSignalTag:c.merge(e,t?{to:t}:{})}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingSync=function(){return this.sendCmdUsePromise("sync",{sync:{avSignal:0}}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingMarkMsgRead=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c.verifyOptions(e,"msgid","api::signalling");var t,r=u.idMap.avSignal;return t="string"==typeof e.msgid?[e.msgid]:e.msgid,this.sendCmd("batchMarkRead",{sid:r.id,cid:r.signalingNotify,ids:t})},a.signalingCallEx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.offlineEnabled,a=e.pushInfo,u=void 0===a?{}:a;"object"===n(u.pushPayload)&&(u.pushPayload=s(u.pushPayload)),c.verifyOptions(e,"type","api::signalling"),c.verifyOptions(e,"account","api::signalling");var d=c.merge(e,u,{to:t,isSave:!0===r?1:0,needPush:!0===u.needPush?1:0,needBadge:!1===u.needBadge?0:1});return this.sendCmdUsePromise("signalingCallEx",{avSignalTag:d}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingJoinAndAccept=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.channelId,r=e.attachExt,n=e.offlineEnabled,s=e.uid,a=e.account,u=e.requestId,d=e.nertcChannelName,p=e.nertcTokenTtl,m=e.nertcJoinRoomQueryParamMap;return c.verifyOptions(e,"channelId","api::signalling"),c.verifyOptions(e,"account","api::signalling"),c.verifyOptions(e,"requestId","api::signalling"),this.sendCmdUsePromise("signalingJoinAndAccept",{avSignalTag:{channelId:t,attachExt:r,isSave:!0===n?1:0,uid:s,to:a,requestId:u,nertcChannelName:d,nertcTokenTtl:p,nertcJoinRoomQueryParamMap:m}}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))}},function(e,t,r){r(455);var n=r(12);e.exports=n.Object.assign},function(e,t,r){var n=r(2),i=r(456);n({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},function(e,t,r){var n=r(24),i=r(7),o=r(31),s=r(9),a=r(92),c=r(134),u=r(114),l=r(33),d=r(96),p=Object.assign,m=Object.defineProperty,f=i([].concat);e.exports=!p||s((function(){if(n&&1!==p({b:1},p(m({},"a",{enumerable:!0,get:function(){m(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol();return e[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=p({},e)[r]||"abcdefghijklmnopqrst"!=a(p({},t)).join("")}))?function(e,t){for(var r=l(e),i=arguments.length,s=1,p=c.f,m=u.f;i>s;)for(var h,g=d(arguments[s++]),v=p?f(a(g),p(g)):a(g),y=v.length,b=0;y>b;)h=v[b++],n&&!o(m,g,h)||(r[h]=g[h]);return r}:p},function(e,t,r){var n=r(23),i=r(79),o=r(13),s=r(11),a=r(26),c=r(10),u=r(4),l=r(63).fn,d=r(36),p=r(458),m=r(198),f=r(14),h=r(217),g=r(0);function v(){this.logger.log("offlineListener enter"),this.forceDisconnect();try{this.options.ondisconnect&&this.options.ondisconnect({callFunc:"link::offlineListener",message:"offlineListener disconnect"})}catch(e){throw self.logger.error("userOption:ondisconnect function error",e),e}this.onDisconnect("link::offlineListener")}function y(){var e=this;this.logger.log("onlineListener start"),this&&this.isConnected()&&!this.connecting?(this.stopHeartbeat(),this.sendCmd("heartbeat",null,(function(t){if(t){e.logger.info("onlineListener heartbeat detect error",t);try{e.forceDisconnect(),e.onDisconnect("link::onHeartbeat")}catch(t){e.logger.info("onlineListener heartbeat websocket.onclose",t)}}else e.logger.log("onlineListener heartbeat detect success")}))):this.logger.log("onlineListener disconnected or connecting",this&&this.isConnected(),this.connecting)}l.initConnect=function(){var e;this.socket=null,this.retryCount=0,this.connecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.doLogout=!1,n(e=h.initUniErrReport).call(e,this)({appKey:this.options.appKey,logger:this.logger})},l.resetConnect=function(){var e=this.options;g.notundef(e.needReconnect)?(g.verifyParamType("needReconnect",e.needReconnect,"boolean","link::resetConnect"),this.needReconnect=e.needReconnect):this.needReconnect=!0,this.logger.info("link::resetConnect: needReconnect ".concat(this.needReconnect)),g.notundef(e.reconnectionAttempts)&&g.verifyParamType("reconnectionAttempts",e.reconnectionAttempts,"number","link::resetConnect"),g.notundef(e.noCacheLinkUrl)&&g.verifyParamType("noCacheLinkUrl",e.noCacheLinkUrl,"boolean","link::resetConnect"),this.reconnectionAttempts="number"==typeof e.reconnectionAttempts?e.reconnectionAttempts:1/0,this.backoff=new p({min:f.reconnectionDelay,max:f.reconnectionDelayMax,jitter:f.reconnectionJitter})},l.connect=function(){var e=this;if(clearTimeout(e.connectTimer),e.isConnected())e.logger.warn("link::connect: already connected");else if(e.connecting)e.logger.warn("link::connect: already connecting");else{if(f.isBrowser&&e.reporter.restore(),e.createConnectTime=i(),e.autoconnect||e.reporter.reportTraceStart("login",{user_id:e.options.account,action:"manual_login"}),e.connecting=!0,e.hasNotifyDisconnected=!1,e.shouldReconnect=!0,e.socket&&e.forceDisconnect(),e.logger.info("link::connect: connect to new socket, autoconnect is "+e.autoconnect),"string"==typeof e.options.socketUrl)return e.logger.info("link::connect: try to options.socketUrl ",e.options.socketUrl),void e.connectToUrl(e.options.socketUrl);var t=e.getNextSocketUrl();if(t&&!e.options.noCacheLinkUrl)return e.logger.info("link::connect: try to next socket link ",t),void e.connectToUrl(t);e.logger.info("link::connect: no cached socket links or links had been used up"),e.refreshSocketUrl().then((function(){e.connectToUrl(e.getNextSocketUrl())})).catch((function(){e.hasActiveDisconnected||e.onDisconnect("connect::refreshSocketUrl: failed to fetch lbs url and default socket link")}))}},l.getNextSocketUrl=function(){return this.socketUrls.shift()},l.isConnected=function(){return!!this.socket&&!!this.socket.socket&&this.socket.socket.connected},l.connectToUrl=function(e){var t,r,i,a,c,u,l=this;if(e=e||"",l.url=e,"undefined"==typeof window){var d=g.getGlobal(),p=e.split(":");d&&!d.location&&p.length>1&&(d.location={protocol:p.shift(),port:p.pop(),hostname:p.join("")}),this.options.transports=["websocket"]}var h=this.options.transports||["websocket","xhr-polling"];l.socket=m.connect(e,{transports:h,reconnect:!1,"force new connection":!0,"connect timeout":f.connectTimeout}),l.logger.info(o(t="link::connectToUrl: socket url: ".concat(e,", transports: ")).call(t,s(h))),l.handshakeUrl=e,l.socket.on("connect",n(r=l.onConnect).call(r,l)),l.socket.on("handshake_failed",n(i=l.onHandshakeFailed).call(i,l)),l.socket.on("connect_failed",n(a=l.onConnectFailed).call(a,l)),l.socket.on("error",n(c=l.onError).call(c,l)),l.socket.on("message",n(u=l.onMessage).call(u,l)),l.socket.on("disconnect",(function(t){l.logger.warn("link::connectToUrl: socket url: ".concat(e,", disconnected"),t),l.hasLogin=!1,l.doLogout?l.logout():l.onDisconnect("link::socketDisconnect")}))},l.disconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this;function r(r){t.logger.info("link::disconnect: socket finally closed, ",r),clearTimeout(t.disconnectCallbackTimer),t.msgAckBufferManager&&t.msgAckBufferManager.clear(),e(r)}if(clearTimeout(t.connectTimer),t.disconnectCallbackTimer=a((function(){e.call(t,"mark disconnected due to timeout")}),1e4),t.mixStorePolicy=null,t.appGrayConfig=null,t.resetReconnectStatus(!0),clearTimeout(t.mixStorePolicyClock),this.onlineListener&&"undefined"!=typeof window&&g.isFunction(window.removeEventListener)&&(window.removeEventListener("online",this.onlineListener),window.removeEventListener("offline",this.offlineListener)),t.socket&&t.socket.socket&&t.socket.socket.transport?t.socket.socket.transport.onDisconnectDone=function(e){r(e)}:r(null),t.isConnected())t.logger.warn("link::disconnect: start disconnecting"),t.logout();else if(t.connecting)t.logger.warn("link::disconnect: abort connecting"),t.disconnectSocket();else{t.logger.warn("link::disconnect: start otherwise"),t.connecting=!1,t.shouldReconnect=!1,t.socket=null,t.autoconnect=!1;try{t.options.ondisconnect({callFunc:"link::disconnect",message:"manually disconnect status"})}catch(e){throw t.logger.error("userOption:ondisconnect function error",e),e}}},l.resetReconnectStatus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;t.backoff&&(t.backoff.setMin(f.reconnectionDelay),t.backoff.setMax(f.reconnectionDelayMax),t.backoff.reset()),t.retryCount=0,t.autoconnect=!0,t.hasActiveDisconnected=!!e,t.logger.info("link::resetReconnectStatus: reset retryCount and backoff")},l.onConnect=function(){this.connecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.reporter.reportTraceUpdate("login",{operation_type:"TCP",target:this.url}),this.login()},l.onHandshakeFailed=function(){this.logger.warn("link::onHandshakeFailed: shandshake failed"),this.reporter.reportTraceUpdate("login",{operation_type:"TCP",error:"ws_handshake_failed",target:this.handshakeUrl},!1),this.onDisconnect("link::onHandshakeFailed")},l.onConnectFailed=function(){this.onDisconnect("link::onConnectFailed")},l.onError=function(){var e=arguments[0];if(e){if(this.reporter.reportTraceUpdate("login",{operation_type:"TCP",error:"connect_timeout"},!1),void 0!==e.x5ImgDecodeStatus)return;if("[object Object]"===Object.prototype.toString.call(e)&&c(e).length<=0)return;this.onMiscError("连接错误",new d(e,"LINK_ERROR",{callFunc:"link::onError"}))}this.connecting=!1},l.onDisconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this;this.logger.warn("socket::onDisconnect: "+e),t.connecting=!1,t.markAllCallbackInvalid(d.newNetworkError({callFunc:e})),t.msgAckBufferManager&&t.msgAckBufferManager.clear(),t.stopHeartbeat(),t.reconnect()},l.willReconnect=function(){return this.shouldReconnect&&this.needReconnect&&this.retryCount<this.reconnectionAttempts},l.reconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.willReconnect()){if(this.reporter.reportTraceStart("login",{user_id:this.options.account,action:"auto_login"}),this.socket&&(this.logger.info("link::reconnect: try to force disconnect"),this.forceDisconnect()),0===this.socketUrls.length&&!this.options.socketUrl&&"function"==typeof e.allFailedCB)return this.logger.log("reconnect: All socket links have been polled, trigger hooks"),void e.allFailedCB();this.doReconnect()}else this.notifyDisconnect()},l.doReconnect=function(){var e,t=this;t.socket=null,t.retryCount++,t.hasLogin=!1;var r,n=t.backoff.duration();t.logger.info(o(e="link::reconnect: will retry after ".concat(n,"ms, retryCount ")).call(e,t.retryCount));try{r=t.options.onwillreconnect({retryCount:t.retryCount,duration:n})}catch(e){throw t.logger.error("userOption:onwillreconnect function error",e),e}clearTimeout(t.connectTimer),t.connectTimer=a((function(){1==+t.options.authType&&r instanceof u?(t.logger.info("link::reconnect: wait onwillreconnect promise"),r.finally((function(){return t.connect()}))):t.connect()}),n)},l.notifyConnectError=function(e){var t=d.newConnectError({message:e,callFunc:"link::notifyConnectError"});this.logger.error("link::notifyConnectError:",t),this.options.onerror(t)},l.notifyDisconnect=function(e){if(this.hasNotifyDisconnected)this.logger.warn("notifyDisconnect:: already notified");else{this.hasNotifyDisconnected=!0,this.disconnectSocket(),this.forceDisconnect(),(e=e||new d).retryCount=this.retryCount,e.willReconnect=this.willReconnect(),this.backoff&&this.backoff.reset(),this.retryCount=0,this.autoconnect=!1,this.logger.info("link::notifyDisconnect: ondisconnected",e);try{this.options.ondisconnect(e)}catch(e){throw this.logger.error("userOption:ondisconnect function error",e),e}"chatroom"===this.subType?this.reporter.report("chatroomLogin",{accid:this.account,roomId:this.options&&this.options.chatroomId,serverIps:this.options&&this.options.chatroomAddresses&&this.options.chatroomAddresses.join(","),currentServerIp:this.url,rt:i()-this.createConnectTime,result:e?e.code:200,failReason:e?e.message:"",time:i()}):"im"===this.subType&&this.reporter.reportTraceEnd("login",1),this.onWbNotifyHangup instanceof Function&&this.onWbNotifyHangup({content:{account:this.account,channelId:null,timetag:+Date()}})}},l.disconnectSocket=function(){if(this.isConnected()||this.connecting){this.connecting=!1,this.shouldReconnect=!1;try{this.socket.disconnect()}catch(e){this.socket&&"function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),this.logger.info("link::disconnectSocket: disconnect failed, error ",e)}}},l.initOnlineListener=function(){this.needReconnect&&this.options&&this.options.quickReconnect?"undefined"!=typeof window&&g.isFunction(window.addEventListener)?this.onlineListener||(this.onlineListener=n(y).call(y,this),this.offlineListener=n(v).call(v,this),this.logger.info("initOnlineListener success"),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)):this.logger.warn("initOnlineListener no window.addEventListener"):this.logger.warn("initOnlineListener no quickReconnect")},l.forceDisconnect=function(){var e=this.socket||{};this.socket=null;try{"function"==typeof e.removeAllListeners&&e.removeAllListeners(),"function"==typeof e.disconnect&&e.disconnect()}catch(e){this.logger.error("forceDisconnect:: oldSocket error",e||e.message)}this.hasLogin=!1}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){e.exports=function(){var e={reportUrl:"https://statistic.live.126.net/statics/report/common/form",maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,reportInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0},t=function(){};return function(){function r(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.enable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=e,this.msgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.setConfig(t),this.reportConfig.autoStart&&this.initUploadConfig()}var n,i;return n=r,(i=[{key:"setConfig",value:function(e){this.reportConfig=Object.assign({},this.reportConfig,e)}},{key:"report",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){var n=Date.now();r?this.lowPriorityMsgList.push({module:e,msg:t,createTime:n}):this.msgList.push({module:e,msg:t,createTime:n}),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&!this.traceMsgCache[e]){var r={user_id:t.user_id,action:t.action,start_time:Date.now(),updateTime:Date.now(),extension:[]};this.traceMsgCache[e]=r}}},{key:"reportTraceUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.traceMsgCache[e]){var n=t.operation_type,i=t.code,o=t.target,s=t.error,a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["operation_type","code","target","error"]);this.traceMsgCache[e].updateTime=Date.now(),s&&s.code&&(i=s.code),this.traceMsgCache[e].extension.push({operation_type:n,code:i,succeed:r,target:o,duration:this.traceMsgCache[e].updateTime-this.traceMsgCache[e].start_time,description:JSON.stringify(a)})}}},{key:"reportTraceEnd",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.traceMsgCache[e]&&("nos"!==e||0!==t?(this.traceMsgCache[e].succeed=!t,this.traceMsgCache[e].duration=Date.now()-this.traceMsgCache[e].start_time,delete this.traceMsgCache[e].updateTime,this.report(e,this.traceMsgCache[e]),this.traceMsgCache[e]=null):this.traceMsgCache[e]=null)}},{key:"pause",value:function(){this.enable=!1}},{key:"restore",value:function(){this.enable=!0,this.initConfigLoaded||this.initUploadConfig()}},{key:"destroy",value:function(){var e=this;Object.keys(this.traceMsgCache).forEach((function(t){e.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=t,this.report=t,this.reportTraceStart=t,this.reportTraceUpdate=t,this.reportTraceEnd=t,this.pause=t,this.restore=t,this.destroy=t,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.reportConfig={},this.isDestroyed=!0}},{key:"initUploadConfig",value:function(){var e,t,r=this;if(!this.loading){this.loading=!0;var n=this.reportConfig.common||{};try{this.reportConfig.request("https://statistic.live.126.net/dispatcher/req",{method:"GET",dataType:"json",params:{deviceId:n.deviceId,sdktype:n.sdktype,sdkVer:n.sdk_ver,platform:n.platform,appkey:n.app_key},timeout:this.reportConfig.timeout}).then((function(e){var t,n;if(!r.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){var i=e.data.data||{};r.reportConfig.reportInterval=i.maxInterval>1e4?1e4:i.maxInterval,r.reportConfig.reportInterval=i.maxInterval<10?10:i.maxInterval,r.reportConfig.maxSize=i.maxSize>1e3?1e3:i.maxSize,r.reportConfig.minInterval=i.minInterval<2?2:i.minInterval,r.reportConfig.maxDelay=i.maxDelay||300,r.reportConfig.reportInterval=1e3*r.reportConfig.reportInterval,r.reportConfig.minInterval=1e3*r.reportConfig.minInterval,r.reportConfig.maxDelay=1e3*r.reportConfig.maxDelay,r.enable=!0,r.initConfigLoaded=!0,r.loading=!1,r.reportHeartBeat()}null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.log("Get reporter upload config success")}})).catch((function(e){var t,n;r.loading=!1,null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.error("Get reporter upload config failed",e)}))}catch(r){this.loading=!1,null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.error("Exec reporter request failed",r)}}}},{key:"reportHeartBeat",value:function(){var e=this;this.isDestroyed||(this.timer=setTimeout((function(){e.reportHeartBeat()}),this.reportConfig.reportInterval),this.doReport())}},{key:"doReport",value:function(){this.isDestroyed||(this.msgList.length+this.lowPriorityMsgList.length>=this.reportConfig.maxSize||Date.now()-this.lastReportTime>=this.reportConfig.reportInterval)&&this.upload()}},{key:"getUploadMsg",value:function(){var e=this,t={},r=Date.now();this.msgList=this.msgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.lowPriorityMsgList=this.lowPriorityMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.cacheMsgList=this.cacheMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay}));var n=this.msgList.slice(0,this.reportConfig.maxSize);if(this.msgList=this.msgList.slice(n.length),n.length<this.reportConfig.maxSize){var i=this.reportConfig.maxSize-n.length;n=n.concat(this.lowPriorityMsgList.slice(0,i)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice(i)}if(n.length<this.reportConfig.maxSize){var o=this.reportConfig.maxSize-n.length;n=n.concat(this.cacheMsgList.slice(0,o)),this.cacheMsgList=this.cacheMsgList.slice(o)}return n.forEach((function(e){t[e.module]?t[e.module].push(e.msg):t[e.module]=[e.msg]})),{uploadMsgArr:n,uploadMsg:t}}},{key:"upload",value:function(){var e,t,r=this;if(this.enable&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var n=this.getUploadMsg(),i=n.uploadMsgArr,o=n.uploadMsg;if(i.length){this.lastReportTime=Date.now();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",params:{common:this.reportConfig.common,event:o},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(e){var t,n;r.cacheMsgList=r.cacheMsgList.concat(i).slice(0,r.reportConfig.cacheMaxSize),null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.warn("Reporter upload failed",e)}))}catch(r){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",r)}clearTimeout(this.timer),this.reportHeartBeat()}}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),r}()}()},function(e,t,r){e.exports=function(e,t={dataType:"json",method:"GET",timeout:5e3}){const r="text"===t.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8";let n="GET"===t.method?function(e){if(e){let t="";return Object.entries(e).forEach((([e,r],n)=>{t+=0===n?"?":"&",t+=`${e}=${r}`})),t}return""}(t.params):"";return Promise.race([(i=t.timeout,o={url:e,params:t},new Promise(((e,t)=>{setTimeout((()=>{t({message:"request timeout",params:o})}),i||5e3)}))),new Promise((function(i,o){if(window.fetch&&"function"==typeof window.fetch)try{let s={method:t.method,headers:Object.assign({"Content-Type":r},t.headers)};"POST"===t.method&&(s.body=JSON.stringify(t.params)),fetch(`${e}${n}`,s).then((e=>{"text"!==t.dataType?e.json().then((t=>{e.data=t,i(e)}),o):e.text().then((t=>{e.data=t,i(e)}),o)}),o)}catch(e){o(e)}else if(window.XMLHttpRequest){const s=new XMLHttpRequest;let a;if(s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){try{a=JSON.parse(s.response||"{}")}catch(e){a=s.response}i({status:s.status,data:a})}else o(s.status)},s.open(t.method,`${e}${n}`),s.setRequestHeader("Content-Type",r),t.headers)for(let e in t.headers)s.setRequestHeader(e,t.headers[e]);s.send(JSON.stringify(t.params))}else o("request no suppout")}))]);var i,o}},function(e,t,r){var n=r(10),i=r(57),o=r(19),s=r(58),a=r(3),c=r(59),u=r(60),l=r(49),d=r(61),p=r(4);function m(e,t){var r=n(e);if(i){var a=i(e);t&&(a=o(a).call(a,(function(t){return s(e,t).enumerable}))),r.push.apply(r,a)}return r}var f,h=r(63).fn,g=r(36),v=r(62),y=r(141),b=r(39),S=r(14),T=r(0),_=T.notundef;h.login=function(){this.doLogin()},h.doLogin=function(){var e=this,t=this;p.resolve().then((function(){return t.assembleLogin()})).then((function(r){var n=e.socket&&e.socket.socket&&e.socket.socket.sessionid;if(n){if(e.socketIds||(e.socketIds={}),e.socketIds[n])return void e.logger.warn("onConnect::repeat login",n);e.socketIds[n]=!0}else e.logger.warn("onConnect:: no socketId ",e.socket&&e.socket.socket);e.logger.warn("link::doLogin: "+n+" appLogin is "+r.login.appLogin),t.sendCmd("login",function(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?a(r=m(Object(i),!0)).call(r,(function(t){d(e,t,i[t])})):c?u(e,c(i)):a(n=m(Object(i))).call(n,(function(t){l(e,t,s(i,t))}))}return e}({},r))}))},h.genSessionKey=(f={},function(){var e=this.name;return f[e]=f[e]||T.guid()}),h.assembleIMLogin=function(){var e=this.options,t=e.account;this.sdkSession=this.genSessionKey();var r={appLogin:this.autoconnect?0:1,appKey:e.appKey,account:t,token:e.token,sdkVersion:S.info.sdkVersion,sdkHumanVersion:S.info.sdkHumanVersion,protocolVersion:S.info.protocolVersion,os:"[object Object]"===v.os.toString()?v.os.family:v.os.toString(),browser:v.name+" "+v.version,clientType:S.CLIENTTYPE||16,session:this.sdkSession,deviceId:b.deviceId,isReactNative:S.isRN?1:0,customTag:e.customTag||"",sdkType:0};return r.userAgent="Native/".concat(S.info.sdkHumanVersion),S.isBrowser?r.sdkType=0:S.isRN?r.sdkType=2:S.isWeixinApp&&(r.sdkType=6),e.customClientType&&(r.customClientType=+e.customClientType),e.authType&&(r.authType=+e.authType),e.loginExt&&(r.loginExt=e.loginExt),r},h.afterLogin=T.emptyFunc,h.notifyLogin=function(){var e=this.loginResult;this.logger.info("link::notifyLogin: on connect",e);try{this.options.onconnect(e)}catch(e){throw this.logger.error("userOption:onconnect function error",e),e}},h.logout=function(){this.reporter.pause();var e="done disconnect";if(this.doLogout)return this.doLogout=!1,e="done logout",void this.onAuthError(new g(e,"logout"),"link::logout");if(this.isConnected()){var t=new g(e,"logout");this.onAuthError(t,"link::logout")}},h.onKicked=function(e){var t=e.content,r=t.from,n=t.reason,i=t.custom,o=t.customClientType,s={reason:this.kickedReasons[n]||"unknown",message:this.kickedMessages[n]||"未知原因"};if(_(r)&&(s.from=y.reverseType(r)),_(i)&&(s.custom=i),+o>0&&(s.customClientType=o),this.logger.warn("link::onKicked:",s),"silentlyKick"!==s.reason){var a=new g("被踢了","kicked");T.merge(a,s),this.onAuthError(a,"link::onKicked")}else this.logger.warn("link::onKicked: silentlyKick"),this.forceDisconnect(),this.onDisconnect("link::onKicked")},h.onAuthError=function(e,t){var r=e&&e.code;if(this.logger.error("onAuthError ",t,r),/^(Error_Internet_Disconnected|Error_Timeout|Error_Connection_Socket_State_not_Match)$/.test(r))return this.forceDisconnect(),void this.onDisconnect("link::onAuthError::"+r);(e=e||g.newConnectionError({callFunc:t})).callFunc=e.callFunc||t||null,this.shouldReconnect=!1,this.markAllCallbackInvalid(e),this.notifyDisconnect(e)}},function(e,t,r){var n=r(26),i=r(23),o=r(27),s=r(63).fn,a=r(14),c=r(0);s.processLink=function(e){switch(e.cmd){case"heartbeat":this.startHeartbeat();break;case"notifyDetect":"object"===o(c._get(e,"content.notifyDetectTag"))&&(e.content.notifyDetectTag.t3=(new Date).getTime(),this.startDetect(e))}},s.startHeartbeat=function(){var e=this;e.stopHeartbeat(),e.heartbeatTimer=n((function(){var t;e.sendCmd("heartbeat",null,i(t=e.onHeartbeat).call(t,e))}),a.heartbeatInterval)},s.startDetect=function(e){var t=e.content.notifyDetectTag;t.t4=(new Date).getTime(),this.sendCmd("uploadDetect",{notifyDetectTag:t})},s.stopHeartbeat=function(){this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},s.onHeartbeat=function(e){if(e){if(this.syncing)return this.logger.warn("onHeartbeat::ignore error in connecting"),void this.startHeartbeat();var t;e.callFunc="link::onHeartbeat",this.onCustomError("heartbeat error",e),this.heartbeatFail++,this.logger.warn("onHeartbeat::error ",e.code,e),"Error_Timeout"===e.code&&(this.getOnlineStatus()?this.heartbeatFail>1?(this.forceDisconnect(),this.onDisconnect("link::onHeartbeat")):this.sendCmd("heartbeat",null,i(t=this.onHeartbeat).call(t,this)):this.startHeartbeat())}else this.heartbeatFail=0},s.getOnlineStatus="undefined"!=typeof navigator&&"boolean"==typeof navigator.onLine?function(){return navigator.onLine}:function(){return!0},s.heartbeat=function(){}},function(e,t,r){var n=r(4),i=r(6),o=r(26),s=r(50),a=r(63).fn,c=r(196),u=r(14),l=r(39);a.processMisc=function(e){switch(e.cmd){case"getSimpleNosToken":e.error||(e.obj=e.content.nosTokens[0]);break;case"getNosToken":e.error||(e.obj=e.content.nosToken);break;case"getGrayscaleConfig":e.error||(e.obj=e.content.appGrayConfigTag);break;case"getMixStorePolicy":e.error||(e.obj=e.content.mixStorePolicyTag);break;case"getMixStoreToken":e.error||(e.obj=e.content.mixStoreTokenTag);break;case"getBackSourceToken":e.error||(e.obj=e.content.backSourceTokenTag);break;case"uploadSdkLogUrl":e.error?this.logger.error("uploadSdkLogUrl::error",e.error):this.logger.info("uploadSdkLogUrl::success",e.obj&&e.obj.url);break;case"notifyUploadLog":e.error||(u.isRN?this.uploadLocalLogRN():u.isBrowser&&this.uploadLocalLogWeb(),this.emitAPI({type:"notifyUploadLog"}));break;case"audioToText":e.error||(e.obj.text=e.content.text);break;case"processImage":e.obj.imageOps=c.reverseImageOps(e.obj.imageOps),e.error||(e.obj={url:e.content.url});break;case"getNosTokenTrans":e.error||(e.obj={nosToken:e.content.nosToken,docId:e.content.docId});break;case"getNosOriginUrl":e.error||(e.obj=e.content.nosFileUrlTag.originUrl);break;case"notifyTransLog":e.error||this.emitAPI({type:"notifyTransLog",obj:e.content.transInfo});break;case"fetchFile":case"fetchFileList":case"removeFile":e.error||(e.obj=e.content);break;case"getServerTime":e.obj=e.content&&e.content.time;break;case"getNosCdnHost":this.getNosCdnHost(e)}},a.uploadLocalLogRN=function(){if(u.isRN&&l.rnfs){var e=l.rnfs,t=this,r=e.nimIndex,o=(e.nimIndex+1)%2;e.nimPromise=e.nimPromise.then((function(){return n.all([e.exists(s(r)),e.exists(s(o))])})).then((function(t){return t&&(t[0]||t[1])?t[0]&&t[1]?e.copyFile(s(o),s(2)).then((function(){return e.readFile(s(r))})).then((function(t){return e.appendFile(s(2),t)})):t[0]?e.copyFile(s(r),s(2)):void(t[1]&&e.copyFile(s(o),s(2))):n.reject()})).then((function(){return new n((function(r){t.api.previewFile({filePath:s(2),done:function(o,a){if(n.all([e.unlink(s(2)),e.unlink(s(1)),e.unlink(s(0))]).finally((function(){r()})),o)t.logger.error("nim::uploadLocalLogRN:previewFile:error",o);else{var c=a.url;i(c).call(c,"?")>0?c+="&":c+="?",c+="download="+(new Date).getTime()+"_rn.log",t.api.uploadSdkLogUrl({url:c})}}})}))})).catch((function(r){e.unlink(s(2)).catch((function(){})),t.logger.error("nim::protocol::uploadLocalLogRN",r)}))}function s(t){return e.DocumentDirectoryPath+"/nimlog_"+t+".log"}},a.uploadLocalLogWeb=function(){var e=this;!1!==this.options.dbLog&&this.logger._local?this.logger._local.fetchLog().then((function(t){e.api.previewFile({blob:new Blob([t.logs],{type:"text/plain"}),done:function(r,n){if(r)e.logger.error("uploadLocalLogWeb::previewFile:error",r);else{e.logger.log("uploadLocalLogWeb::previewFile:success",n);var o=n.url;o+=(i(o).call(o,"?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log",e.api.uploadSdkLogUrl({url:o}),e.logger._local.deleteLogs(t.time).then((function(){e.logger.log("uploadLocalLogWeb::deleteLogs success")})).catch((function(t){return e.logger.error("uploadLocalLogWeb::deleteLogs:error ,",t)}))}}})})).catch((function(t){e.logger.error("uploadLocalLogWeb::fetchLog:error",t)})):this.logger.warn("uploadLocalLogWeb::no dbLog")},a.getNosCdnHost=function(e){var t=this,r=e.error;if(r&&(r.callFunc="events::getNosCdnHost",t.onCustomError("getNosCdnHost","EVENT_GET_NOS_CDN_HOST_ERROR",r)),e.content&&e.content.nosConfigTag){var n=e.content.nosConfigTag,i="",a="";0!==n.expire&&n.cdnDomain?-1===n.expire?(i=n.cdnDomain,a=n.objectNamePrefix):(i=n.cdnDomain,a=n.objectNamePrefix,t.nosCdnHostTimer&&clearTimeout(t.nosCdnHostTimer),t.nosCdnHostTimer=o((function(){t.sendCmd("getNosCdnHost",{})}),800*s(n.expire))):(i="",a=""),u.serverNosConfig.cdnDomain=i,u.serverNosConfig.objectPrefix=a,u.hasLocalStorage&&(localStorage.setItem("nim_cdn_domain",i),localStorage.setItem("nim_object_prefix",a))}}},function(e,t,r){var n=r(8),i=r(30),o=r(63).fn,s=r(0),a=r(197);o.processAvSignal=function(e){switch(e.cmd){case"signalingCreate":case"signalingDelay":case"signalingClose":case"signalingJoin":case"signalingLeave":case"signalingInvite":case"signalingCancel":case"signalingReject":case"signalingAccept":case"signalingControl":case"signalingSyncMsgRead":case"signalingGetChannelInfo":case"signalingCallEx":break;case"signalingNotify":this.onSignalingNotify(e);break;case"signalingMutilClientSyncNotify":this.onSignalingMutilClientSyncNotify(e);break;case"signalingUnreadMessageSyncNotify":this.onSignalingUnreadMessageSyncNotify(e);break;case"signalingChannelsSyncNotify":this.onSignalingMembersSyncNotify(e);break;default:this.logger.warn("avSignal::unhandled cmd:",e.cmd)}};var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.needPush&&(e.needPush="1"===e.needPush),e.needBadge&&(e.needBadge="1"===e.needBadge),e.channelInValid&&(e.channelInValid="1"===e.channelInValid),e.attach){var t=JSON.parse(e.attach);e.eventType=a.parseAvSignalType(t.type)}if(e.members){var r=JSON.parse(e.members);e.members=n(r).call(r,(function(e){return a.parseAvSignalMember(e)}))}return e};o.onSignalingNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{e.raw&&e.raw.r&&e.raw.r.length&&e.content&&e.content.avSignalTag&&(e.content.avSignalTag.msgid=e.raw.r[0]);var r=e.content.avSignalTag;r=i(r)?n(r).call(r,(function(e){return c(e)})):c(r),this.emitAPI({type:"signalingNotify",obj:r}),s.isFunction(this.options.onSignalingNotify)&&this.options.onSignalingNotify(r)}},o.onSignalingMutilClientSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingMutilClientSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;r=i(r)?n(r).call(r,(function(e){return c(e)})):c(r),this.emitAPI({type:"signalingMutilClientSyncNotify",obj:r}),s.isFunction(this.options.onSignalingMutilClientSyncNotify)&&this.options.onSignalingMutilClientSyncNotify(r)}},o.onSignalingUnreadMessageSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingUnreadMessageSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;i(r)&&(r=n(r).call(r,(function(e){return c(e)}))),this.emitAPI({type:"signalingUnreadMessageSyncNotify",obj:r}),s.isFunction(this.options.onSignalingUnreadMessageSyncNotify)&&this.options.onSignalingUnreadMessageSyncNotify(r)}},o.onSignalingMembersSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingMembersSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;i(r)||(r=[r]),r=n(r).call(r,(function(e){return c(e)})),this.emitAPI({type:"signalingChannelsSyncNotify",obj:r}),s.isFunction(this.options.onSignalingMembersSyncNotify)&&this.options.onSignalingMembersSyncNotify(r)}}},function(e,t,r){var n=r(19),i=r(0),o=r(139),s=i.merge({},o.idMap,{auth:{id:2,login:3,kicked:5,logout:6,multiPortLogin:7,kick:8},user:{id:3,updatePushToken:1,appBackground:2,markInBlacklist:3,getBlacklist:4,markInMutelist:5,getMutelist:6,getRelations:8,getUsers:7,updateMyInfo:10,updateDonnop:15,syncMyInfo:109,syncUpdateMyInfo:110},notify:{id:4,markRead:3,syncOfflineMsgs:4,batchMarkRead:5,syncOfflineSysMsgs:6,syncOfflineNetcallMsgs:8,syncRoamingMsgs:9,syncMsgReceipts:12,syncRobots:15,syncBroadcastMsgs:16,syncSuperTeamRoamingMsgs:17,syncOfflineSuperTeamSysMsgs:18,syncDeleteSuperTeamMsgOfflineRoaming:19,syncDeleteMsgSelf:21,syncSessionsWithMoreRoaming:22,syncStickTopSessions:23,syncSessionHistoryMsgsDelete:24,syncSessionReliableInfo:25},sync:{id:5,sync:1,syncTeamMembers:2,syncSuperTeamMembers:3},msg:{id:7,sendMsg:1,msg:2,sysMsg:3,getHistoryMsgs:6,sendCustomSysMsg:7,searchHistoryMsgs:8,deleteSessions:9,getSessions:10,syncSendMsg:101,sendMsgReceipt:11,msgReceipt:12,deleteMsg:13,msgDeleted:14,markSessionAck:16,markSessionAckBatch:25,broadcastMsg:17,clearServerHistoryMsgs:18,getServerSessions:19,getServerSession:20,updateServerSession:21,deleteServerSessions:22,deleteMsgSelf:23,deleteMsgSelfBatch:24,msgFtsInServer:26,msgFtsInServerByTiming:27,onClearServerHistoryMsgs:118,syncUpdateServerSession:121,onDeleteMsgSelf:123,onDeleteMsgSelfBatch:124},msgExtend:{id:23,getThreadMsgs:1,getMsgsByIdServer:2,addQuickComment:3,deleteQuickComment:4,onQuickComment:5,onDeleteQuickComment:6,getQuickComments:7,addCollect:8,deleteCollects:9,updateCollect:10,getCollects:11,addStickTopSession:12,deleteStickTopSession:13,updateStickTopSession:14,addMsgPin:15,updateMsgPin:16,deleteMsgPin:17,onAddMsgPin:18,onUpdateMsgPin:19,onDeleteMsgPin:20,getMsgPins:21,syncAddQuickComment:103,syncDeleteQuickComment:104,syncAddStickTopSession:112,syncDeleteStickTopSession:113,syncUpdateStickTopSession:114,syncAddMsgPin:115,syncUpdateMsgPin:116,syncDeleteMsgPin:117},team:{id:8,createTeam:1,sendTeamMsg:2,teamMsg:3,teamMsgs:4,addTeamMembers:5,removeTeamMembers:6,updateTeam:7,leaveTeam:8,getTeam:9,getTeams:10,getTeamMembers:11,dismissTeam:12,applyTeam:13,passTeamApply:14,rejectTeamApply:15,addTeamManagers:16,removeTeamManagers:17,transferTeam:18,updateInfoInTeam:19,updateNickInTeam:20,acceptTeamInvite:21,rejectTeamInvite:22,getTeamHistoryMsgs:23,searchTeamHistoryMsgs:24,updateMuteStateInTeam:25,getMyTeamMembers:26,getMutedTeamMembers:27,sendTeamMsgReceipt:28,getTeamMsgReads:29,getTeamMsgReadAccounts:30,notifyTeamMsgReads:31,muteTeamAll:32,getTeamMemberInvitorAccid:33,getTeamsById:34,syncMyTeamMembers:126,syncTeams:109,syncTeamMembers:111,syncCreateTeam:101,syncSendTeamMsg:102,syncUpdateTeamMember:119},superTeam:{id:21,sendSuperTeamMsg:2,superTeamMsg:3,addSuperTeamMembers:5,removeSuperTeamMembers:6,leaveSuperTeam:7,updateSuperTeam:8,getSuperTeam:9,getSuperTeams:12,updateInfoInSuperTeam:10,getMySuperTeamMembers:11,getSuperTeamMembers:13,getSuperTeamHistoryMsgs:14,getSuperTeamMembersByJoinTime:15,sendSuperTeamCustomSysMsg:16,deleteSuperTeamMsg:17,superTeamMsgDelete:18,superTeamCustomSysMsg:19,applySuperTeam:20,passSuperTeamApply:21,rejectSuperTeamApply:22,acceptSuperTeamInvite:23,rejectSuperTeamInvite:24,markSuperTeamSessionAck:25,addSuperTeamManagers:26,removeSuperTeamManagers:27,updateSuperTeamMute:28,updateSuperTeamMembersMute:29,updateNickInSuperTeam:30,transferSuperTeam:31,markSuperTeamSessionsAck:32,getSuperTeamMembersByAccounts:33,getMutedSuperTeamMembers:34,syncMySuperTeamMembers:111,syncSuperTeams:109,syncSuperTeamMembers:113,syncCreateSuperTeam:101,syncSendSuperTeamMsg:102,syncUpdateSuperTeamMember:110,syncDeleteSuperTeamMsg:117},friend:{id:12,friendRequest:1,syncFriendRequest:101,deleteFriend:2,syncDeleteFriend:102,updateFriend:3,syncUpdateFriend:103,getFriends:4},chatroom:{id:13,getChatroomAddress:1},filter:{id:101,sendFilterMsg:1,filterMsg:2,filterSysMsg:3,sendFilterCustomSysMsg:7},eventService:{id:14,publishEvent:1,pushEvent:2,subscribeEvent:3,unSubscribeEventsByAccounts:4,unSubscribeEventsByType:5,querySubscribeEventsByAccounts:6,querySubscribeEventsByType:7,pushEvents:9},proxyService:{id:22,httpProxy:1,onProxyMsg:2},qchat:{id:24,getQChatAddress:1}}),a=i.merge({},o.cmdConfig,{login:{sid:s.auth.id,cid:s.auth.login,params:[{type:"Property",name:"login"}]},logout:{sid:s.auth.id,cid:s.auth.logout},kick:{sid:s.auth.id,cid:s.auth.kick,params:[{type:"StrArray",name:"deviceIds"}]},updatePushToken:{sid:s.user.id,cid:s.user.updatePushToken,params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"int",name:"pushkit"}]},appBackground:{sid:s.user.id,cid:s.user.appBackground,params:[{type:"bool",name:"isBackground"},{type:"Int",name:"badge"}]},markInBlacklist:{sid:s.user.id,cid:s.user.markInBlacklist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getBlacklist:{sid:s.user.id,cid:s.user.getBlacklist,params:[{type:"long",name:"time"}]},markInMutelist:{sid:s.user.id,cid:s.user.markInMutelist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getMutelist:{sid:s.user.id,cid:s.user.getMutelist,params:[{type:"long",name:"time"}]},getRelations:{sid:s.user.id,cid:s.user.getRelations,params:[{type:"long",name:"timetag"}]},getUsers:{sid:s.user.id,cid:s.user.getUsers,params:[{type:"StrArray",name:"accounts"}]},updateMyInfo:{sid:s.user.id,cid:s.user.updateMyInfo,params:[{type:"Property",name:"user"},{type:"Property",name:"antispamTag"}]},updateDonnop:{sid:s.user.id,cid:s.user.updateDonnop,params:[{type:"Property",name:"donnop"}]},markRead:{sid:s.notify.id,cid:s.notify.markRead,params:[{type:"long",name:"id"},{type:"ph",name:"ph"}]},batchMarkRead:{sid:s.notify.id,cid:s.notify.batchMarkRead,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},sync:{sid:s.sync.id,cid:s.sync.sync,params:[{type:"Property",name:"sync"}]},syncTeamMembers:{sid:s.sync.id,cid:s.sync.syncTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},syncSuperTeamMembers:{sid:s.sync.id,cid:s.sync.syncSuperTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},sendMsg:{sid:s.msg.id,cid:s.msg.sendMsg,params:[{type:"Property",name:"msg"}]},getHistoryMsgs:{sid:s.msg.id,cid:s.msg.getHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},sendCustomSysMsg:{sid:s.msg.id,cid:s.msg.sendCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},searchHistoryMsgs:{sid:s.msg.id,cid:s.msg.searchHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSessions:{sid:s.msg.id,cid:s.msg.getSessions,params:[{type:"long",name:"time"}]},deleteSessions:{sid:s.msg.id,cid:s.msg.deleteSessions,params:[{type:"StrArray",name:"sessions"}]},sendMsgReceipt:{sid:s.msg.id,cid:s.msg.sendMsgReceipt,params:[{type:"Property",name:"msgReceipt"}]},deleteMsg:{sid:s.msg.id,cid:s.msg.deleteMsg,params:[{type:"Property",name:"sysMsg"}]},markSessionAck:{sid:s.msg.id,cid:s.msg.markSessionAck,params:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},markSessionAckBatch:{sid:s.msg.id,cid:s.msg.markSessionAckBatch,params:[{type:"PropertyArray",name:"sessionAckTags",entity:"sessionAckTag"}]},clearServerHistoryMsgs:{sid:s.msg.id,cid:s.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParams"}]},clearServerHistoryMsgsWithSync:{sid:s.msg.id,cid:s.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParamsWithSync"}]},msgFtsInServer:{sid:s.msg.id,cid:s.msg.msgFtsInServer,params:[{type:"Property",name:"msgFullSearchRequestTag"}]},msgFtsInServerByTiming:{sid:s.msg.id,cid:s.msg.msgFtsInServerByTiming,params:[{type:"Property",name:"msgTimingFullSearchRequestTag"}]},onClearServerHistoryMsgs:{sid:s.msg.id,cid:s.msg.clearServerHistoryMsgs},getServerSessions:{sid:s.msg.id,cid:s.msg.getServerSessions,params:[{type:"Property",name:"sessionReqTag"}]},getServerSession:{sid:s.msg.id,cid:s.msg.getServerSession,params:[{type:"Property",name:"session"}]},updateServerSession:{sid:s.msg.id,cid:s.msg.updateServerSession,params:[{type:"Property",name:"session"}]},deleteServerSessions:{sid:s.msg.id,cid:s.msg.deleteServerSessions,params:[{type:"PropertyArray",name:"sessions",entity:"session"}]},deleteMsgSelf:{sid:s.msg.id,cid:s.msg.deleteMsgSelf,params:[{type:"Property",name:"deleteMsgSelfTag"}]},deleteMsgSelfBatch:{sid:s.msg.id,cid:s.msg.deleteMsgSelfBatch,params:[{type:"PropertyArray",name:"deleteMsgSelfTags",entity:"deleteMsgSelfTag"}]},onDeleteMsgSelf:{sid:s.msg.id,cid:s.msg.onDeleteMsgSelf},onDeleteMsgSelfBatch:{sid:s.msg.id,cid:s.msg.onDeleteMsgSelfBatch},sendSuperTeamMsg:{sid:s.superTeam.id,cid:s.superTeam.sendSuperTeamMsg,params:[{type:"Property",name:"msg"}]},addSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.addSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}]},removeSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.removeSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},leaveSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.leaveSuperTeam,params:[{type:"long",name:"teamId"}]},updateSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.updateSuperTeam,params:[{type:"Property",name:"team"},{type:"Property",name:"antispamTag"}]},getSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeam,params:[{type:"long",name:"teamId"}]},getSuperTeams:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeams,params:[{type:"long",name:"timetag"}]},getSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},updateInfoInSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.updateInfoInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},getSuperTeamHistoryMsgs:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},applySuperTeam:{sid:s.superTeam.id,cid:s.superTeam.applySuperTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passSuperTeamApply:{sid:s.superTeam.id,cid:s.superTeam.passSuperTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:s.superTeam.id,cid:s.superTeam.rejectSuperTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:s.superTeam.id,cid:s.superTeam.acceptSuperTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:s.superTeam.id,cid:s.superTeam.rejectSuperTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},markSuperTeamSessionAck:{sid:s.superTeam.id,cid:s.superTeam.markSuperTeamSessionAck,params:[{type:"long",name:"to"},{type:"long",name:"timetag"}]},addSuperTeamManagers:{sid:s.superTeam.id,cid:s.superTeam.addSuperTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:s.superTeam.id,cid:s.superTeam.removeSuperTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateSuperTeamMute:{sid:s.superTeam.id,cid:s.superTeam.updateSuperTeamMute,params:[{type:"long",name:"teamId"},{type:"int",name:"mute"}]},updateSuperTeamMembersMute:{sid:s.superTeam.id,cid:s.superTeam.updateSuperTeamMembersMute,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"int",name:"mute"}]},updateNickInSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.updateNickInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},transferSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.transferSuperTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},markSuperTeamSessionsAck:{sid:s.superTeam.id,cid:s.superTeam.markSuperTeamSessionsAck,params:[{type:"PropertyArray",name:"sessionAckTags",entity:"sessionAckTag"}]},getSuperTeamMembersByJoinTime:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamMembersByJoinTime,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSuperTeamMembersByAccounts:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamMembersByAccounts,params:[{type:"StrArray",name:"memberIds"}]},getMutedSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.getMutedSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},sendSuperTeamCustomSysMsg:{sid:s.superTeam.id,cid:s.superTeam.sendSuperTeamCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},deleteSuperTeamMsg:{sid:s.superTeam.id,cid:s.superTeam.deleteSuperTeamMsg,params:[{type:"Property",name:"sysMsg"}]},getMySuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.getMySuperTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},createTeam:{sid:s.team.id,cid:s.team.createTeam,params:[{type:"Property",name:"team"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"Property",name:"antispamTag"}]},sendTeamMsg:{sid:s.team.id,cid:s.team.sendTeamMsg,params:[{type:"Property",name:"msg"}]},addTeamMembers:{sid:s.team.id,cid:s.team.addTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}]},removeTeamMembers:{sid:s.team.id,cid:s.team.removeTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateTeam:{sid:s.team.id,cid:s.team.updateTeam,params:[{type:"Property",name:"team"},{type:"Property",name:"antispamTag"}]},leaveTeam:{sid:s.team.id,cid:s.team.leaveTeam,params:[{type:"long",name:"teamId"}]},getTeam:{sid:s.team.id,cid:s.team.getTeam,params:[{type:"long",name:"teamId"}]},getTeams:{sid:s.team.id,cid:s.team.getTeams,params:[{type:"long",name:"timetag"}]},getTeamsById:{sid:s.team.id,cid:s.team.getTeamsById,params:[{type:"longArray",name:"teamIds"}]},getTeamMembers:{sid:s.team.id,cid:s.team.getTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},dismissTeam:{sid:s.team.id,cid:s.team.dismissTeam,params:[{type:"long",name:"teamId"}]},applyTeam:{sid:s.team.id,cid:s.team.applyTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passTeamApply:{sid:s.team.id,cid:s.team.passTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:s.team.id,cid:s.team.rejectTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},addTeamManagers:{sid:s.team.id,cid:s.team.addTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:s.team.id,cid:s.team.removeTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},transferTeam:{sid:s.team.id,cid:s.team.transferTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},updateInfoInTeam:{sid:s.team.id,cid:s.team.updateInfoInTeam,params:[{type:"Property",name:"teamMember"}]},updateNickInTeam:{sid:s.team.id,cid:s.team.updateNickInTeam,params:[{type:"Property",name:"teamMember"}]},acceptTeamInvite:{sid:s.team.id,cid:s.team.acceptTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:s.team.id,cid:s.team.rejectTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},getTeamHistoryMsgs:{sid:s.team.id,cid:s.team.getTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},searchTeamHistoryMsgs:{sid:s.team.id,cid:s.team.searchTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},updateMuteStateInTeam:{sid:s.team.id,cid:s.team.updateMuteStateInTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"int",name:"mute"}]},getMyTeamMembers:{sid:s.team.id,cid:s.team.getMyTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},getMutedTeamMembers:{sid:s.team.id,cid:s.team.getMutedTeamMembers,params:[{type:"long",name:"teamId"}]},sendTeamMsgReceipt:{sid:s.team.id,cid:s.team.sendTeamMsgReceipt,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReads:{sid:s.team.id,cid:s.team.getTeamMsgReads,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReadAccounts:{sid:s.team.id,cid:s.team.getTeamMsgReadAccounts,params:[{type:"Property",name:"teamMsgReceipt"}]},muteTeamAll:{sid:s.team.id,cid:s.team.muteTeamAll,params:[{type:"long",name:"teamId"},{type:"int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:s.team.id,cid:s.team.getTeamMemberInvitorAccid,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},friendRequest:{sid:s.friend.id,cid:s.friend.friendRequest,params:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:s.friend.id,cid:s.friend.deleteFriend,params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams"}]},updateFriend:{sid:s.friend.id,cid:s.friend.updateFriend,params:[{type:"Property",name:"friend"}]},getFriends:{sid:s.friend.id,cid:s.friend.getFriends,params:[{type:"long",name:"timetag"}]},getChatroomAddress:{sid:s.chatroom.id,cid:s.chatroom.getChatroomAddress,params:[{type:"long",name:"chatroomId"},{type:"bool",name:"isWeixinApp"},{type:"number",name:"type"}]},sendFilterMsg:{sid:n(s).id,cid:n(s).sendFilterMsg,params:[{type:"Property",name:"msg"}]},sendFilterCustomSysMsg:{sid:n(s).id,cid:n(s).sendFilterCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},publishEvent:{sid:s.eventService.id,cid:s.eventService.publishEvent,params:[{type:"Property",name:"msgEvent"}]},pushEvent:{sid:s.eventService.id,cid:s.eventService.pushEvent},subscribeEvent:{sid:s.eventService.id,cid:s.eventService.subscribeEvent,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:s.eventService.id,cid:s.eventService.unSubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:s.eventService.id,cid:s.eventService.unSubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},querySubscribeEventsByAccounts:{sid:s.eventService.id,cid:s.eventService.querySubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},querySubscribeEventsByType:{sid:s.eventService.id,cid:s.eventService.querySubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},pushEvents:{sid:s.eventService.id,cid:s.eventService.pushEvents},getThreadMsgs:{sid:s.msgExtend.id,cid:s.msgExtend.getThreadMsgs,params:[{type:"Property",name:"msg"},{type:"Property",name:"threadMsgReq"}]},getMsgsByIdServer:{sid:s.msgExtend.id,cid:s.msgExtend.getMsgsByIdServer,params:[{type:"PropertyArray",name:"reqMsgs",entity:"msg"}]},addQuickComment:{sid:s.msgExtend.id,cid:s.msgExtend.addQuickComment,params:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},deleteQuickComment:{sid:s.msgExtend.id,cid:s.msgExtend.deleteQuickComment,params:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},getQuickComments:{sid:s.msgExtend.id,cid:s.msgExtend.getQuickComments,params:[{type:"PropertyArray",name:"commentReq",entity:"commentReq"}]},addCollect:{sid:s.msgExtend.id,cid:s.msgExtend.addCollect,params:[{type:"Property",name:"collect"}]},deleteCollects:{sid:s.msgExtend.id,cid:s.msgExtend.deleteCollects,params:[{type:"PropertyArray",name:"collectList",entity:"collect"}]},updateCollect:{sid:s.msgExtend.id,cid:s.msgExtend.updateCollect,params:[{type:"Property",name:"collect"}]},getCollects:{sid:s.msgExtend.id,cid:s.msgExtend.getCollects,params:[{type:"Property",name:"collectQuery"}]},addStickTopSession:{sid:s.msgExtend.id,cid:s.msgExtend.addStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},updateStickTopSession:{sid:s.msgExtend.id,cid:s.msgExtend.updateStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},deleteStickTopSession:{sid:s.msgExtend.id,cid:s.msgExtend.deleteStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},addMsgPin:{sid:s.msgExtend.id,cid:s.msgExtend.addMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},updateMsgPin:{sid:s.msgExtend.id,cid:s.msgExtend.updateMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},deleteMsgPin:{sid:s.msgExtend.id,cid:s.msgExtend.deleteMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},getMsgPins:{sid:s.msgExtend.id,cid:s.msgExtend.getMsgPins,params:[{type:"Property",name:"msgPinReq"}]},httpProxy:{sid:s.proxyService.id,cid:s.proxyService.httpProxy,params:[{type:"Property",name:"proxyTag"}]},getQChatAddress:{sid:s.qchat.id,cid:s.qchat.getQChatAddress,params:[{type:"Property",name:"getQChatAddressTag"}]}}),c=i.merge({},o.packetConfig,{"2_3":{service:"auth",cmd:"login",response:[{type:"Property",name:"loginRes"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"},{type:"Property",name:"aosPushInfo"}]},"2_5":{service:"auth",cmd:"kicked",response:[{type:"Number",name:"from"},{type:"Number",name:"reason"},{type:"String",name:"custom"},{type:"Number",name:"customClientType"}]},"2_6":{service:"auth",cmd:"logout"},"2_7":{service:"auth",cmd:"multiPortLogin",response:[{type:"Number",name:"state"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"}]},"2_8":{service:"auth",cmd:"kick",response:[{type:"StrArray",name:"deviceIds"}]},"3_1":{service:"user",cmd:"updatePushToken"},"3_2":{service:"user",cmd:"appBackground"},"3_3":{service:"user",cmd:"markInBlacklist"},"3_103":{service:"user",cmd:"syncMarkInBlacklist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_4":{service:"user",cmd:"getBlacklist",response:[{type:"StrArray",name:"blacklist"}]},"3_5":{service:"user",cmd:"markInMutelist"},"3_105":{service:"user",cmd:"syncMarkInMutelist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_6":{service:"user",cmd:"getMutelist",response:[{type:"StrArray",name:"mutelist"}]},"3_8":{service:"user",cmd:"getRelations",response:[{type:"PropertyArray",name:"specialRelations",entity:"specialRelation"},{type:"Number",name:"timetag"}]},"3_7":{service:"user",cmd:"getUsers",response:[{type:"PropertyArray",name:"users",entity:"user"}]},"3_10":{service:"user",cmd:"updateMyInfo",response:[{type:"Number",name:"timetag"}]},"3_15":{service:"user",cmd:"updateDonnop",response:[{type:"Number",name:"timetag"}]},"3_115":{service:"user",cmd:"syncUpdateDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"3_109":{service:"user",cmd:"syncMyInfo",response:[{type:"Property",name:"user"},{type:"Number",name:"timetag"}]},"3_110":{service:"user",cmd:"syncUpdateMyInfo",response:[{type:"Property",name:"user"}]},"4_1":{service:"notify"},"4_2":{service:"notify"},"4_3":{service:"notify",cmd:"markRead"},"4_4":{service:"notify",cmd:"syncOfflineMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_5":{service:"notify",cmd:"batchMarkRead"},"4_6":{service:"notify",cmd:"syncOfflineSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_8":{service:"notify",cmd:"syncOfflineNetcallMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_9":{service:"notify",cmd:"syncRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_12":{service:"notify",cmd:"syncMsgReceipts",response:[{type:"PropertyArray",name:"msgReceipts",entity:"msgReceipt"},{type:"Number",name:"timetag"}]},"4_13":{service:"notify",cmd:"syncDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"4_14":{service:"notify",cmd:"syncSessionAck",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Number",name:"timetag"}]},"4_15":{service:"notify",cmd:"syncRobots",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"4_16":{service:"notify",cmd:"syncBroadcastMsgs",response:[{type:"PropertyArray",name:"broadcastMsgs",entity:"broadcastMsg"}]},"4_17":{service:"notify",cmd:"syncSuperTeamRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_18":{service:"notify",cmd:"syncOfflineSuperTeamSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_19":{service:"notify",cmd:"syncDeleteSuperTeamMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"4_20":{service:"notify",cmd:"syncSuperTeamSessionAck",response:[{type:"LongLongMap",name:"superTeam"},{type:"Number",name:"timetag"}]},"4_21":{service:"notify",cmd:"syncDeleteMsgSelf",response:[{type:"PropertyArray",name:"deletedMsgs",entity:"deleteMsgSelfTag"}]},"4_22":{service:"notify",cmd:"syncSessionsWithMoreRoaming",response:[{type:"PropertyArray",name:"sessions",entity:"msg"}]},"4_23":{service:"notify",cmd:"syncStickTopSessions",response:[{type:"Number",name:"timetag"},{type:"boolean",name:"modify"},{type:"PropertyArray",name:"sessions",entity:"stickTopSession"}]},"4_24":{service:"notify",cmd:"syncSessionHistoryMsgsDelete",response:[{type:"PropertyArray",name:"sessionHistoryMsgsDeleteTags",entity:"clearMsgsParamsWithSync"}]},"4_25":{service:"notify",cmd:"syncSessionReliableInfo",response:[{type:"Property",name:"context",entity:"sessionReliableSyncContextTag"},{type:"PropertyArray",name:"datas",entity:"sessionReliableSyncTag"}]},"4_100":{service:"notify",cmd:"syncOfflineFilterMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_101":{service:"notify",cmd:"syncOfflineFilterSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"5_1":{service:"sync",cmd:"syncDone",response:[{type:"Number",name:"timetag"}]},"5_2":{service:"sync",cmd:"syncTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"5_3":{service:"sync",cmd:"syncSuperTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"7_1":{service:"msg",cmd:"sendMsg",response:[{type:"Property",name:"msg"}],trivialErrorCodes:[7101]},"7_2":{service:"msg",cmd:"msg",response:[{type:"Property",name:"msg"}]},"7_3":{service:"msg",cmd:"sysMsg",response:[{type:"Property",name:"sysMsg"}]},"7_6":{service:"msg",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_7":{service:"msg",cmd:"sendCustomSysMsg",trivialErrorCodes:[7101]},"7_8":{service:"msg",cmd:"searchHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_9":{service:"msg",cmd:"deleteSessions"},"7_10":{service:"msg",cmd:"getSessions",response:[{type:"StrArray",name:"sessions"}]},"7_101":{service:"msg",cmd:"syncSendMsg",response:[{type:"Property",name:"msg"}]},"7_11":{service:"msg",cmd:"sendMsgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_12":{service:"msg",cmd:"msgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_13":{service:"msg",cmd:"onDeleteMsg"},"7_14":{service:"msg",cmd:"onMsgDeleted",response:[{type:"Property",name:"sysMsg"}]},"7_15":{service:"msg",cmd:"onDeleteMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"7_16":{service:"msg",cmd:"onMarkSessionAck"},"7_17":{service:"msg",cmd:"broadcastMsg",response:[{type:"Property",name:"broadcastMsg"}]},"7_18":{service:"msg",cmd:"clearServerHistoryMsgs",response:[{type:"Long",name:"timetag"}]},"7_19":{service:"session",cmd:"getServerSessions",response:[{type:"Property",name:"sessionReqTag"},{type:"PropertyArray",name:"sessionList",entity:"session"}]},"7_20":{service:"session",cmd:"getServerSession",response:[{type:"Property",name:"session"}]},"7_21":{service:"session",cmd:"updateServerSession"},"7_22":{service:"session",cmd:"deleteServerSessions"},"7_23":{service:"msg",cmd:"deleteMsgSelf",response:[{type:"Long",name:"timetag"}]},"7_24":{service:"msg",cmd:"deleteMsgSelfBatch",response:[{type:"Long",name:"timetag"}]},"7_25":{service:"msg",cmd:"onMarkSessionAckBatch"},"7_26":{service:"msg",cmd:"msgFtsInServer",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_27":{service:"msg",cmd:"msgFtsInServerByTiming",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_118":{service:"msg",cmd:"onClearServerHistoryMsgs",response:[{type:"Property",name:"sessionHistoryMsgsDeleteTag",entity:"clearMsgsParamsWithSync"}]},"7_123":{service:"msg",cmd:"onDeleteMsgSelf",response:[{type:"Property",name:"deleteMsgSelfTag"}]},"7_124":{service:"msg",cmd:"onDeleteMsgSelfBatch",response:[{type:"PropertyArray",name:"deleteMsgSelfTags",entity:"deleteMsgSelfTag"}]},"7_116":{service:"msg",cmd:"syncMarkSessionAck",response:[{type:"Number",name:"scene"},{type:"String",name:"to"},{type:"Number",name:"timetag"}]},"7_121":{service:"msg",cmd:"syncUpdateServerSession",response:[{type:"Property",name:"session"}]},"23_1":{service:"msgExtend",cmd:"getThreadMsgs",response:[{type:"Property",name:"threadMsg",entity:"msg"},{type:"Property",name:"threadMsgsMeta"},{type:"PropertyArray",name:"msgs",entity:"msg"}]},"23_2":{service:"msgExtend",cmd:"getMsgsByIdServer",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"23_3":{service:"msgExtend",cmd:"addQuickComment",response:[{type:"Number",name:"timetag"}]},"23_4":{service:"msgExtend",cmd:"deleteQuickComment",response:[{type:"Number",name:"timetag"}]},"23_5":{service:"msgExtend",cmd:"onQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_6":{service:"msgExtend",cmd:"onDeleteQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_7":{service:"msgExtend",cmd:"getQuickComments",response:[{type:"PropertyArray",name:"commentRes",entity:"commentRes"}]},"23_8":{service:"msgExtend",cmd:"addCollect",response:[{type:"Property",name:"collect"}]},"23_9":{service:"msgExtend",cmd:"deleteCollects",response:[{type:"Number",name:"deleteNum"}]},"23_10":{service:"msgExtend",cmd:"updateCollect",response:[{type:"Property",name:"collect"}]},"23_11":{service:"msgExtend",cmd:"getCollects",response:[{type:"Number",name:"total"},{type:"PropertyArray",name:"collectList",entity:"collect"}]},"23_12":{service:"msgExtend",cmd:"addStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_13":{service:"msgExtend",cmd:"deleteStickTopSession",response:[{type:"Number",name:"timetag"}]},"23_14":{service:"msgExtend",cmd:"updateStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_15":{service:"msgExtend",cmd:"addMsgPin",response:[{type:"Number",name:"timetag"}]},"23_16":{service:"msgExtend",cmd:"updateMsgPin",response:[{type:"Number",name:"timetag"}]},"23_17":{service:"msgExtend",cmd:"deleteMsgPin",response:[{type:"Number",name:"timetag"}]},"23_18":{service:"msgExtend",cmd:"onAddMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_19":{service:"msgExtend",cmd:"onUpdateMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_20":{service:"msgExtend",cmd:"onDeleteMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_21":{service:"msgExtend",cmd:"getMsgPins",response:[{type:"Number",name:"timetag"},{type:"Boolean",name:"modify"},{type:"PropertyArray",name:"pins",entity:"msgPinRes"}]},"23_103":{service:"msgExtend",cmd:"syncAddQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_104":{service:"msgExtend",cmd:"syncDeleteQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_112":{service:"msgExtend",cmd:"syncAddStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_113":{service:"msgExtend",cmd:"syncDeleteStickTopSession",response:[{type:"Number",name:"timetag"},{type:"Property",name:"stickTopSession"}]},"23_114":{service:"msgExtend",cmd:"syncUpdateStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_115":{service:"msgExtend",cmd:"syncAddMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_116":{service:"msgExtend",cmd:"syncUpdateMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_117":{service:"msgExtend",cmd:"syncDeleteMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"21_2":{service:"superTeam",cmd:"sendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_3":{service:"superTeam",cmd:"superTeamMsg",response:[{type:"Property",name:"msg"}]},"21_5":{service:"superTeam",cmd:"addSuperTeamMembers",response:[{type:"StrArray",name:"abortedAccidList"},{type:"long",name:"timetag"}]},"21_6":{service:"superTeam",cmd:"removeSuperTeamMembers"},"21_7":{service:"superTeam",cmd:"leaveSuperTeam"},"21_8":{service:"superTeam",cmd:"updateSuperTeam",response:[{type:"long",name:"timetag"}]},"21_9":{service:"superTeam",cmd:"getSuperTeam",response:[{type:"Property",name:"team"}]},"21_12":{service:"superTeam",cmd:"getSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_10":{service:"superTeam",cmd:"updateInfoInSuperTeam"},"21_13":{service:"superTeam",cmd:"getSuperTeamMembers",response:[{type:"long",name:"timetag"}]},"21_11":{service:"superTeam",cmd:"getMySuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_14":{service:"superTeam",cmd:"getSuperTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"21_15":{service:"superTeam",cmd:"getSuperTeamMembersByJoinTime",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_16":{service:"superTeam",cmd:"sendSuperTeamCustomSysMsg",trivialErrorCodes:[7101]},"21_17":{service:"superTeam",cmd:"onDeleteSuperTeamMsg"},"21_18":{service:"superTeam",cmd:"onSuperTeamMsgDelete",response:[{type:"Property",name:"sysMsg"}]},"21_19":{service:"superTeam",cmd:"superTeamCustomSysMsg",response:[{type:"Property",name:"sysMsg"}]},"21_20":{service:"superTeam",cmd:"applySuperTeam",response:[{type:"Property",name:"team"}]},"21_21":{service:"superTeam",cmd:"passSuperTeamApply"},"21_22":{service:"superTeam",cmd:"rejectSuperTeamApply"},"21_23":{service:"superTeam",cmd:"acceptSuperTeamInvite",response:[{type:"Property",name:"team"}]},"21_24":{service:"superTeam",cmd:"rejectSuperTeamInvite"},"21_25":{service:"superTeam",cmd:"onMarkSuperTeamSessionAck"},"21_26":{service:"superTeam",cmd:"addSuperTeamManagers"},"21_27":{service:"superTeam",cmd:"removeSuperTeamManagers"},"21_28":{service:"superTeam",cmd:"updateSuperTeamMute"},"21_29":{service:"superTeam",cmd:"updateSuperTeamMembersMute",response:[{type:"long",name:"timetag"}]},"21_30":{service:"superTeam",cmd:"updateNickInSuperTeam"},"21_31":{service:"superTeam",cmd:"transferSuperTeam"},"21_32":{service:"superTeam",cmd:"onMarkSuperTeamSessionsAck"},"21_33":{service:"superTeam",cmd:"getSuperTeamMembersByAccounts",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_34":{service:"superTeam",cmd:"getMutedSuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_113":{service:"superTeam",cmd:"syncSuperTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"superTeamMember"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_111":{service:"superTeam",cmd:"syncMySuperTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"superTeamMember"},{type:"long",name:"timetag"}]},"21_109":{service:"superTeam",cmd:"syncSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_101":{service:"superTeam",cmd:"syncCreateSuperTeam",response:[{type:"Property",name:"team"}]},"21_102":{service:"superTeam",cmd:"syncSendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_110":{service:"superTeam",cmd:"syncUpdateSuperTeamMember",response:[{type:"Property",name:"teamMember",entity:"superTeamMember"}]},"21_117":{service:"superTeam",cmd:"syncDeleteSuperTeamMsg",response:[{type:"Property",name:"sysMsg"}]},"21_125":{service:"superTeam",cmd:"syncMarkSuperTeamSessionAck",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},"8_1":{service:"team",cmd:"createTeam",response:[{type:"Property",name:"team"},{type:"StrArray",name:"abortedAccidList"}]},"8_2":{service:"team",cmd:"sendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_3":{service:"team",cmd:"teamMsg",response:[{type:"Property",name:"msg"}]},"8_4":{service:"team",cmd:"teamMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_5":{service:"team",cmd:"addTeamMembers",response:[{type:"long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},"8_6":{service:"team",cmd:"removeTeamMembers"},"8_7":{service:"team",cmd:"updateTeam",response:[{type:"Number",name:"id"},{type:"Number",name:"time"}]},"8_8":{service:"team",cmd:"leaveTeam"},"8_9":{service:"team",cmd:"getTeam",response:[{type:"Property",name:"team"}]},"8_10":{service:"team",cmd:"getTeams",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"Number",name:"timetag"}]},"8_11":{service:"team",cmd:"getTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_12":{service:"team",cmd:"dismissTeam"},"8_13":{service:"team",cmd:"applyTeam",response:[{type:"Property",name:"team"}]},"8_14":{service:"team",cmd:"passTeamApply"},"8_15":{service:"team",cmd:"rejectTeamApply"},"8_16":{service:"team",cmd:"addTeamManagers"},"8_17":{service:"team",cmd:"removeTeamManagers"},"8_18":{service:"team",cmd:"transferTeam"},"8_19":{service:"team",cmd:"updateInfoInTeam"},"8_20":{service:"team",cmd:"updateNickInTeam"},"8_21":{service:"team",cmd:"acceptTeamInvite",response:[{type:"Property",name:"team"}]},"8_22":{service:"team",cmd:"rejectTeamInvite"},"8_23":{service:"team",cmd:"getTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_24":{service:"team",cmd:"searchTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_25":{service:"team",cmd:"updateMuteStateInTeam"},"8_26":{service:"team",cmd:"getMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_27":{service:"team",cmd:"getMutedTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_28":{service:"team",cmd:"sendTeamMsgReceipt",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_29":{service:"team",cmd:"getTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_30":{service:"team",cmd:"getTeamMsgReadAccounts",response:[{type:"Property",name:"teamMsgReceipt"},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},"8_31":{service:"team",cmd:"notifyTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_32":{service:"team",cmd:"muteTeamAll",response:[]},"8_33":{service:"team",cmd:"getTeamMemberInvitorAccid",response:[{type:"object",name:"accountsMap"}]},"8_34":{service:"team",cmd:"getTeamsById",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"StrArray",name:"tids"}],trivialErrorCodes:[816]},"8_126":{service:"team",cmd:"syncMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_109":{service:"team",cmd:"syncTeams",response:[{type:"Number",name:"timetag"},{type:"PropertyArray",name:"teams",entity:"team"}]},"8_111":{service:"team",cmd:"syncTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_101":{service:"team",cmd:"syncCreateTeam",response:[{type:"Property",name:"team"}]},"8_102":{service:"team",cmd:"syncSendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_119":{service:"team",cmd:"syncUpdateTeamMember",response:[{type:"Property",name:"teamMember"}]},"12_1":{service:"friend",cmd:"friendRequest"},"12_101":{service:"friend",cmd:"syncFriendRequest",response:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}]},"12_2":{service:"friend",cmd:"deleteFriend"},"12_102":{service:"friend",cmd:"syncDeleteFriend",response:[{type:"String",name:"account"}]},"12_3":{service:"friend",cmd:"updateFriend"},"12_103":{service:"friend",cmd:"syncUpdateFriend",response:[{type:"Property",name:"friend"}]},"12_4":{service:"friend",cmd:"getFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_5":{service:"friend",cmd:"syncFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_6":{service:"friend",cmd:"syncFriendUsers",response:[{type:"PropertyArray",name:"users",entity:"user"},{type:"Number",name:"timetag"}]},"13_1":{service:"chatroom",cmd:"getChatroomAddress",response:[{type:"StrArray",name:"address"}]},"14_1":{service:"eventService",cmd:"publishEvent",response:[{type:"Property",name:"msgEvent"}]},"14_2":{service:"eventService",cmd:"pushEvent",response:[{type:"Property",name:"msgEvent"}]},"14_3":{service:"eventService",cmd:"subscribeEvent",response:[{type:"StrArray",name:"accounts"}]},"14_4":{service:"eventService",cmd:"unSubscribeEventsByAccounts",response:[{type:"StrArray",name:"accounts"}]},"14_5":{service:"eventService",cmd:"unSubscribeEventsByType"},"14_6":{service:"eventService",cmd:"querySubscribeEventsByAccounts",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_7":{service:"eventService",cmd:"querySubscribeEventsByType",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_9":{service:"eventService",cmd:"pushEvents",response:[{type:"PropertyArray",name:"msgEvents",entity:"msgEvent"}]},"22_1":{service:"proxyService",cmd:"httpProxy",response:[{type:"Property",name:"proxyTag"}]},"22_2":{service:"proxyService",cmd:"onProxyMsg",response:[{type:"Property",name:"proxyMsg",entity:"proxyMsgTag"}]},"24_1":{service:"qchat",cmd:"getQChatAddress",response:[{type:"StrArray",name:"address"}]},"101_1":{service:"filter",cmd:"sendFilterMsg",response:[{type:"Property",name:"msg"}]},"101_2":{service:"filter",cmd:"filterMsg",response:[{type:"Property",name:"msg"}]},"101_3":{service:"filter",cmd:"filterSysMsg",response:[{type:"Property",name:"sysMsg"}]},"101_7":{service:"filter",cmd:"sendFilterCustomSysMsg"}});e.exports={idMap:s,cmdConfig:a,packetConfig:c}},function(e,t){e.exports={negotiateTransportTag:{version:-1,serializeList:1,serialize:101},initTransportTag:{},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,sdkType:41,userAgent:42,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,connectionId:102,ip:103,time:109,customTag:38,customClientType:39},aosPushInfo:{pushType:110,hasTokenPreviously:111},sync:{myInfo:1,offlineMsgs:2,teams:3,netcallMsgs:6,roamingMsgs:7,relations:9,friends:11,sessions:12,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,deleteMsg:17,sessionAck:18,robots:19,broadcastMsgs:20,avSignal:21,superTeams:22,myInfoInSuperTeams:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteMsgSelf:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,filterMsgs:100},donnop:{open:1},sessionReqTag:{minTimestamp:1,maxTimestamp:2,needLastMsg:3,limit:4,hasMore:5},session:{id:1,updateTime:2,ext:3,lastMsg:4},superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,createTime:10,updateTime:11,custom:12,mute:13,invitoraccid:14,joinTime:15},team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,custom:12,mute:13,invitorAccid:14},msg:{scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resend:13,userUpdateTime:14,custom:15,pushPayload:16,pushContent:17,apnsAccounts:18,apnsContent:19,apnsForcePush:20,yidunEnable:21,antiSpamContent:22,antiSpamBusinessId:23,clientAntiSpam:24,antiSpamUsingYidun:25,needMsgReceipt:26,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,delete:39,callbackExt:40,subType:41,yidunAntiCheating:42,env:43,yidunAntiSpamExt:44,yidunAntiSpamRes:45,isHistoryable:100,isRoamingable:101,isSyncable:102,isMuted:104,cc:105,isInBlackList:106,isPushable:107,isOfflinable:108,isUnreadable:109,needPushNick:110,isReplyMsg:111,tempTeamMemberCount:112},threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2},comment:{from:1,body:2,time:3,custom:4,needPush:5,needBadge:6,pushTitle:7,apnsText:8,pushPayload:9},commentReq:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,timestamp:100},commentRes:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,detail:7,modify:8,timestamp:100},collect:{id:1,type:2,data:3,custom:4,uniqueId:5,createTime:6,updateTime:7},collectQuery:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5,type:6},stickTopSession:{id:1,topCustom:2,createTime:3,updateTime:4},pinTag:{pinFrom:1,pinCustom:2,createTime:3,updateTime:4},msgPinReq:{sessionId:1,timetag:2},msgPinRes:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,pinFrom:7,pinCustom:8},msgReceipt:{to:1,from:2,time:7,idClient:11},teamMsgReceipt:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},deleteMsgSelfTag:{scene:1,from:2,to:3,idServer:4,idClient:5,time:6,deletedTime:7,custom:8},sysMsg:{time:0,type:1,to:2,from:3,ps:4,attach:5,idServer:6,sendToOnlineUsersOnly:7,apnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,yidunEnable:12,antiSpamContent:13,deletedMsgTime:14,deletedMsgFromNick:15,opeAccount:16,env:21,callbackExt:22,cc:105,isPushable:107,isUnreadable:109,needPushNick:110},broadcastMsg:{broadcastId:1,fromAccid:2,fromUid:3,timestamp:4,body:5},friend:{account:4,flag:5,beflag:6,source:7,alias:8,bits:9,custom:10,createTime:11,updateTime:12,serverex:13},user:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,custom:10,createTime:12,updateTime:13},antispamTag:{antiSpamBusinessId:1},specialRelation:{account:0,isMuted:1,isBlacked:2,createTime:3,updateTime:4},msgType:{text:0,picture:1,audio:2,video:3,location:4,notification:5,file:6,netcall_audio:7,netcall_vedio:8,datatunnel_new:9,tips:10,robot:11,custom:100},msgEvent:{type:1,value:2,idClient:3,custom:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverCustom:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105},clearMsgsParams:{account:1,delRoam:2},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},msgFullSearchRequestTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msgLimit:5,order:6,p2pList:7,teamList:8,senderList:9,msgTypeList:10,msgSubTypeList:11},msgTimingFullSearchRequestTag:{keyword:1,fromTime:2,toTime:3,msgLimit:5,order:6,p2pList:7,teamList:8,senderList:9,msgTypeList:10,msgSubTypeList:11},delFriendParams:{delAlias:1},proxyTag:{zone:1,path:2,method:3,header:4,body:5},proxyMsgTag:{from:1,body:2,time:3},sessionAckTag:{scene:1,to:2,timetag:3},mixTokenReq:{provider:0,tokenCount:1,fileExpireSec:2,tag:3,returnBody:4},mixAuthTokenReq:{type:1,urls:2},notifyDetectTag:{type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},getQChatAddressTag:{ipType:1}}},function(e,t){e.exports={negotiateTransportTag:{"-1":"version",1:"serializeList",101:"serialize"},initTransportTag:{},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},nosAccessTokenTag:{0:"token",1:"url",2:"userAgent",3:"ext"},nosConfigTag:{1:"bucket",2:"cdnDomain",3:"expire",4:"objectNamePrefix"},appGrayConfigTag:{0:"grayConfig",1:"ttl"},mixStorePolicyTag:{0:"providers",1:"ttl",2:"mixEnable",3:"nosPolicy",4:"s3Policy"},mixStoreTokenTag:{0:"provider",1:"accessKeyId",2:"secretAccessKey",3:"sessionToken",4:"token",5:"expireAt",6:"bucket",7:"objectName",8:"fileExpireSec",9:"tag",10:"shortUrl",11:"region"},notifyDetectTag:{1:"type",2:"params",3:"result",100:"t1",101:"t2",102:"t3",103:"t4",104:"t5",105:"t6"},backSourceTokenTag:{1:"type",2:"tokens",3:"token",4:"ttl"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time",25:"nertcChannelName",26:"nertcTokenTtl",27:"nertcToken",28:"nertcJoinRoomQueryParamMap",29:"nertcJoinRoomResponse",30:"callStatus"},login:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",39:"customClientType",40:"sdkHumanVersion",112:"isReactNative",115:"authType",116:"loginExt",1e3:"token"},loginRes:{17:"lastLoginDeviceId",38:"customTag",102:"connectionId",103:"ip",104:"port",106:"country",111:"hasXMPush"},loginPort:{3:"type",4:"os",5:"mac",13:"deviceId",19:"account",32:"deviceInfo",38:"customTag",39:"customClientType",102:"connectionId",103:"ip",109:"time"},aosPushInfo:{110:"pushType",111:"hasTokenPreviously"},sync:{1:"myInfo",2:"offlineMsgs",3:"teams",6:"netcallMsgs",7:"roamingMsgs",9:"relations",11:"friends",12:"sessions",13:"friendUsers",14:"msgReceipts",15:"myTeamMembers",16:"donnop",17:"deleteMsg",18:"sessionAck",19:"robots",20:"broadcastMsgs",21:"avSignal",22:"superTeams",23:"myInfoInSuperTeams",24:"superTeamRoamingMsgs",25:"deleteSuperTeamMsg",26:"superTeamSessionAck",27:"deleteMsgSelf",28:"stickTopSessions",29:"sessionHistoryMsgsDelete",100:"filterMsgs"},donnop:{1:"open"},sessionReqTag:{1:"minTimestamp",2:"maxTimestamp",3:"needLastMsg",4:"limit",5:"hasMore"},session:{1:"id",2:"updateTime",3:"ext",4:"lastMsg",5:"lastMsgType"},superTeam:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},superTeamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"createTime",11:"updateTime",12:"custom",13:"mute",14:"invitoraccid",15:"joinTime"},team:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},teamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"joinTime",11:"updateTime",12:"custom",13:"mute",14:"invitorAccid"},msg:{0:"scene",1:"to",2:"from",4:"fromClientType",5:"fromDeviceId",6:"fromNick",7:"time",8:"type",9:"body",10:"attach",11:"idClient",12:"idServer",13:"resend",14:"userUpdateTime",15:"custom",16:"pushPayload",17:"pushContent",18:"apnsAccounts",19:"apnsContent",20:"apnsForcePush",21:"yidunEnable",22:"antiSpamContent",23:"antiSpamBusinessId",24:"clientAntiSpam",25:"antiSpamUsingYidun",26:"needMsgReceipt",28:"needUpdateSession",29:"replyMsgFromAccount",30:"replyMsgToAccount",31:"replyMsgTime",32:"replyMsgIdServer",33:"replyMsgIdClient",34:"threadMsgFromAccount",35:"threadMsgToAccount",36:"threadMsgTime",37:"threadMsgIdServer",38:"threadMsgIdClient",39:"delete",40:"callbackExt",41:"subType",42:"yidunAntiCheating",43:"env",44:"yidunAntiSpamExt",45:"yidunAntiSpamRes",100:"isHistoryable",101:"isRoamingable",102:"isSyncable",104:"isMuted",105:"cc",106:"isInBlackList",107:"isPushable",108:"isOfflinable",109:"isUnreadable",110:"needPushNick",111:"isReplyMsg",112:"tempTeamMemberCount"},threadMsgReq:{1:"beginTime",2:"endTime",3:"lastMsgId",4:"limit",5:"reverse"},threadMsgsMeta:{1:"total",2:"lastMsgTime"},comment:{1:"from",2:"body",3:"time",4:"custom",5:"needPush",6:"needBadge",7:"pushTitle",8:"apnsText",9:"pushPayload"},commentReq:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",100:"timestamp"},commentRes:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",7:"detail",8:"modify",100:"timestamp"},collect:{1:"id",2:"type",3:"data",4:"custom",5:"uniqueId",6:"createTime",7:"updateTime"},collectQuery:{1:"beginTime",2:"endTime",3:"lastMsgId",4:"limit",5:"reverse",6:"type"},stickTopSession:{1:"id",2:"topCustom",3:"createTime",4:"updateTime"},pinTag:{1:"pinFrom",2:"pinCustom",3:"createTime",4:"updateTime"},msgPinReq:{1:"sessionId",2:"timetag"},msgPinRes:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",7:"pinFrom",8:"pinCustom"},msgReceipt:{1:"to",2:"from",7:"time",11:"idClient"},teamMsgReceipt:{0:"teamId",1:"idServer",100:"read",101:"unread",102:"idClient",103:"account"},deleteMsgSelfTag:{1:"scene",2:"from",3:"to",4:"idServer",5:"idClient",6:"time",7:"deletedTime",8:"custom"},sysMsg:{0:"time",1:"type",2:"to",3:"from",4:"ps",5:"attach",6:"idServer",7:"sendToOnlineUsersOnly",8:"apnsText",9:"pushPayload",10:"deletedIdClient",11:"deletedIdServer",12:"yidunEnable",13:"antiSpamContent",14:"deletedMsgTime",15:"deletedMsgFromNick",16:"opeAccount",21:"env",22:"callbackExt",105:"cc",107:"isPushable",109:"isUnreadable",110:"needPushNick"},broadcastMsg:{1:"broadcastId",2:"fromAccid",3:"fromUid",4:"timestamp",5:"body"},friend:{4:"account",5:"flag",6:"beflag",7:"source",8:"alias",9:"bits",10:"custom",11:"createTime",12:"updateTime",13:"serverex"},user:{1:"account",3:"nick",4:"avatar",5:"sign",6:"gender",7:"email",8:"birth",9:"tel",10:"custom",12:"createTime",13:"updateTime",_4_safe:"_avatar_safe"},antispamTag:{antiSpamBusinessId:1},specialRelation:{0:"account",1:"isMuted",2:"isBlacked",3:"createTime",4:"updateTime"},msgType:{0:"text",1:"picture",2:"audio",3:"video",4:"location",5:"notification",6:"file",7:"netcall_audio",8:"netcall_vedio",9:"datatunnel_new",10:"tips",11:"robot",100:"custom"},msgEvent:{1:"type",2:"value",3:"idClient",4:"custom",5:"validTime",6:"broadcastType",7:"sync",8:"validTimeType",9:"durable",10:"time",11:"idServer",12:"clientType",13:"serverConfig",14:"serverCustom",101:"appid",103:"account",104:"enableMultiClient",106:"consid"},msgEventSubscribe:{1:"type",2:"subscribeTime",3:"sync",102:"to",104:"from",105:"time"},clearMsgsParams:{1:"account",2:"delRoam"},clearMsgsParamsWithSync:{0:"type",1:"otherAccid",2:"delRoam",3:"toTid",4:"isSyncSelf",5:"fromAccid",6:"time",7:"ext"},msgFullSearchRequestTag:{1:"keyword",2:"fromTime",3:"toTime",4:"sessionLimit",5:"msgLimit",6:"order",7:"p2pList",8:"teamList",9:"senderList",10:"msgTypeList",11:"msgSubTypeList"},delFriendParams:{1:"delAlias"},proxyTag:{1:"zone",2:"path",3:"method",4:"header",5:"body"},proxyMsgTag:{1:"from",2:"body",3:"time"},sessionReliableSyncTag:{1:"scene",2:"sessionId",3:"syncStatus",4:"syncEndMsgId",5:"syncEndMsgidClient",6:"syncEndMsgTime",7:"syncStartMsgid",8:"syncStartMsgidClient",9:"syncStartMsgTime",10:"nextMsgid",11:"nextMsgidClient",12:"nextMsgTime",13:"roamMsgSync",14:"offlineMsgSync",15:"netCallOfflineMsgSync"},sessionReliableSyncContextTag:{1:"timetag",2:"type"}}},function(e,t,r){var n=r(0),i=r(139),o=n.merge({},i.idMap,{chatroom:{id:13,login:2,kicked:3,logout:4,sendMsg:6,msg:7,getChatroomMembers:8,getHistoryMsgs:9,markChatroomMember:11,closeChatroom:12,getChatroom:13,updateChatroom:14,updateMyChatroomMemberInfo:15,getChatroomMembersInfo:16,kickChatroomMember:17,updateChatroomMemberTempMute:19,queueOffer:20,queuePoll:21,queueList:22,peak:23,queueDrop:24,queueInit:25,queueChange:26,updateTagMembersTempMute:30,getChatroomMembersByTag:31,getChatroomMemberCountByTag:32,updateCoordinate:33,updateChatroomTags:34,sendChatroomMsgAck:35,getHistoryMsgsByTags:36,notifyCdnInfo:99},user:{id:3,syncRobot:16}}),s=n.merge({},i.cmdConfig,{login:{sid:o.chatroom.id,cid:o.chatroom.login,params:[{type:"byte",name:"type"},{type:"Property",name:"login"},{type:"Property",name:"imLogin"}]},logout:{sid:o.chatroom.id,cid:o.chatroom.logout},sendMsg:{sid:o.chatroom.id,cid:o.chatroom.sendMsg,params:[{type:"Property",name:"msg"}]},getChatroomMembers:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembers,params:[{type:"byte",name:"type"},{type:"long",name:"time"},{type:"int",name:"limit"}]},getHistoryMsgs:{sid:o.chatroom.id,cid:o.chatroom.getHistoryMsgs,params:[{type:"long",name:"timetag"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},markChatroomMember:{sid:o.chatroom.id,cid:o.chatroom.markChatroomMember,params:[{type:"string",name:"account"},{type:"int",name:"type"},{type:"bool",name:"isAdd"},{type:"int",name:"level"},{type:"string",name:"custom"}]},closeChatroom:{sid:o.chatroom.id,cid:o.chatroom.closeChatroom,params:[{type:"string",name:"custom"}]},getChatroom:{sid:o.chatroom.id,cid:o.chatroom.getChatroom},updateChatroom:{sid:o.chatroom.id,cid:o.chatroom.updateChatroom,params:[{type:"Property",name:"chatroom"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"Property",name:"antispamTag"}]},updateMyChatroomMemberInfo:{sid:o.chatroom.id,cid:o.chatroom.updateMyChatroomMemberInfo,params:[{type:"Property",name:"chatroomMember"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"bool",name:"needSave"},{type:"Property",name:"antispamTag"}]},getChatroomMembersInfo:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembersInfo,params:[{type:"StrArray",name:"accounts"}]},kickChatroomMember:{sid:o.chatroom.id,cid:o.chatroom.kickChatroomMember,params:[{type:"string",name:"account"},{type:"string",name:"custom"}]},updateChatroomMemberTempMute:{sid:o.chatroom.id,cid:o.chatroom.updateChatroomMemberTempMute,params:[{type:"String",name:"account"},{type:"long",name:"duration"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"}]},queueOffer:{sid:o.chatroom.id,cid:o.chatroom.queueOffer,params:[{type:"string",name:"elementKey"},{type:"string",name:"elementValue"},{type:"bool",name:"transient"},{type:"string",name:"elementAccount"}]},queuePoll:{sid:o.chatroom.id,cid:o.chatroom.queuePoll,params:[{type:"string",name:"elementKey"}]},queueList:{sid:o.chatroom.id,cid:o.chatroom.queueList},peak:{sid:o.chatroom.id,cid:o.chatroom.peak},queueDrop:{sid:o.chatroom.id,cid:o.chatroom.queueDrop},queueInit:{sid:o.chatroom.id,cid:o.chatroom.queueInit,params:[{type:"int",name:"limit"}]},queueChange:{sid:o.chatroom.id,cid:o.chatroom.queueChange,params:[{type:"StrStrMap",name:"elementMap"},{type:"bool",name:"needNotify"},{type:"string",name:"notifyExt"}]},updateTagMembersTempMute:{sid:o.chatroom.id,cid:o.chatroom.updateTagMembersTempMute,params:[{type:"Property",name:"tagMuteReq"}]},updateCoordinate:{sid:o.chatroom.id,cid:o.chatroom.updateCoordinate,params:[{type:"Property",name:"coordinateReq"}]},getChatroomMemberCountByTag:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMemberCountByTag,params:[{type:"String",name:"tag"}]},getChatroomMembersByTag:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembersByTag,params:[{type:"Property",name:"tagMemberReq"}]},updateChatroomTags:{sid:o.chatroom.id,cid:o.chatroom.updateChatroomTags,params:[{type:"Property",name:"chatRoomTagsUpdateTag"}]},sendChatroomMsgAck:{sid:o.chatroom.id,cid:o.chatroom.sendChatroomMsgAck,params:[{type:"Property",name:"chatRoomMsgAckTag"}]},getHistoryMsgsByTags:{sid:o.chatroom.id,cid:o.chatroom.getHistoryMsgsByTags,params:[{type:"Property",name:"chatRoomTagHistoryMsgRequestTag"}]},notifyCdnInfo:{sid:o.chatroom.id,cid:o.chatroom.notifyCdnInfo},syncRobot:{sid:o.user.id,cid:o.user.syncRobot,params:[{type:"long",name:"timetag"}]}}),a=n.merge({},i.packetConfig,{"4_10":{service:"notify"},"4_11":{service:"notify"},"3_16":{service:"chatroom",cmd:"syncRobot",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"13_2":{service:"chatroom",cmd:"login",response:[{type:"Property",name:"chatroom"},{type:"Property",name:"chatroomMember"},{type:"Property",name:"chatroomCdnInfo"}]},"13_3":{service:"chatroom",cmd:"kicked",response:[{type:"Number",name:"reason"},{type:"String",name:"custom"}]},"13_4":{service:"chatroom",cmd:"logout"},"13_6":{service:"chatroom",cmd:"sendMsg",response:[{type:"Property",name:"msg"}]},"13_7":{service:"chatroom",cmd:"msg",response:[{type:"Property",name:"msg"}]},"13_8":{service:"chatroom",cmd:"getChatroomMembers",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_9":{service:"chatroom",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_11":{service:"chatroom",cmd:"markChatroomMember",response:[{type:"Property",name:"chatroomMember"}]},"13_12":{service:"chatroom",cmd:"closeChatroom"},"13_13":{service:"chatroom",cmd:"getChatroom",response:[{type:"Property",name:"chatroom"}]},"13_14":{service:"chatroom",cmd:"updateChatroom"},"13_15":{service:"chatroom",cmd:"updateMyChatroomMemberInfo"},"13_16":{service:"chatroom",cmd:"getChatroomMembersInfo",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_17":{service:"chatroom",cmd:"kickChatroomMember"},"13_19":{service:"chatroom",cmd:"updateChatroomMemberTempMute"},"13_20":{service:"chatroom",cmd:"queueOffer"},"13_21":{service:"chatroom",cmd:"queuePoll",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_22":{service:"chatroom",cmd:"queueList",response:[{type:"KVArray",name:"queueList"}]},"13_23":{service:"chatroom",cmd:"peak",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_24":{service:"chatroom",cmd:"queueDrop"},"13_25":{service:"chatroom",cmd:"queueInit"},"13_26":{service:"chatroom",cmd:"queueChange",response:[{type:"StrArray",name:"elementKeyArray"}]},"13_30":{service:"chatroom",cmd:"updateTagMembersTempMute"},"13_33":{service:"chatroom",cmd:"updateCoordinate"},"13_31":{service:"chatroom",cmd:"getChatroomMembersByTag",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_32":{service:"chatroom",cmd:"getChatroomMemberCountByTag",response:[{type:"long",name:"count"}]},"13_34":{service:"chatroom",cmd:"updateChatroomTags"},"13_36":{service:"chatroom",cmd:"getHistoryMsgsByTags",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_99":{service:"chatroom",cmd:"notifyCdnInfo",response:[{type:"Property",name:"chatroomCdnInfo"}]},"13_101":{service:"chatroom",cmd:"updateChatroomTag",response:[{type:"Property",name:"updateTags"}]}});e.exports={idMap:o,cmdConfig:s,packetConfig:a}},function(e,t){e.exports={imLogin:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,sdkType:41,userAgent:42,isReactNative:112,authType:115,loginExt:116,token:1e3,customTag:38},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},login:{appKey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,chatroomCustom:22,chatroomEnterCustom:23,session:26,isAnonymous:38,tags:39,notifyTargetTags:40,loginAuthType:41,loginExt:42,loc_x:43,loc_y:44,loc_z:45,distance:46,antiSpamBusinessId:47},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,custom:12,createTime:14,updateTime:15,queuelevel:16,creator:100,onlineMemberNum:101,mute:102},msg:{idClient:1,type:2,attach:3,custom:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromCustom:9,yidunEnable:10,antiSpamContent:11,skipHistory:12,body:13,antiSpamBusinessId:14,clientAntiSpam:15,antiSpamUsingYidun:16,time:20,from:21,chatroomId:22,fromClientType:23,highPriority:25,callbackExt:27,subType:28,yidunAntiCheating:29,env:30,notifyTargetTags:31,yidunAntiSpamExt:32,yidunAntiSpamRes:33,loc_x:34,loc_y:35,loc_z:36,toAccids:37,needHighPriorityMsgAck:38},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,custom:7,online:8,guest:9,enterTime:10,blacked:12,gaged:13,valid:14,updateTime:15,tempMuted:16,tempMuteDuration:17},antispamTag:{antiSpamBusinessId:1},chatroomCdnInfo:{enable:1,cdnUrls:2,timestamp:3,interval:4,decryptType:5,decryptKey:6,timeout:7},tagMemberReq:{tag:1,time:2,limit:3},tagMuteReq:{tag:1,duration:2,needNotify:3,custom:4,notifyTargetTags:5},coordinateReq:{x:1,y:2,z:3,distance:4},chatRoomTagsUpdateTag:{tags:1,notifyTargetTags:2,needNotify:3,ext:4},chatRoomMsgAckTag:{idClient:1,chatroomId:2},chatRoomTagHistoryMsgRequestTag:{tags:1,types:2,fromTime:3,toTime:4,limit:5,reverse:6}}},function(e,t){e.exports={imLogin:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",41:"sdkType",42:"userAgent",112:"isReactNative",1e3:"token"},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},nosAccessTokenTag:{0:"token",1:"url",2:"userAgent",3:"ext"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time",25:"nertcChannelName",26:"nertcTokenTtl",27:"nertcToken",28:"nertcJoinRoomQueryParamMap",29:"nertcJoinRoomResponse",30:"callStatus"},login:{1:"appKey",2:"account",3:"deviceId",5:"chatroomId",8:"appLogin",20:"chatroomNick",21:"chatroomAvatar",22:"chatroomCustom",23:"chatroomEnterCustom",26:"session",38:"isAnonymous",39:"tags",40:"notifyTargetTags",41:"loginAuthType",42:"loginExt",43:"loc_x",44:"loc_y",45:"loc_z",46:"distance",47:"antiSpamBusinessId",_21_safe:"_chatroomAvatar_safe"},chatroom:{1:"id",3:"name",4:"announcement",5:"broadcastUrl",12:"custom",14:"createTime",15:"updateTime",16:"queuelevel",100:"creator",101:"onlineMemberNum",102:"mute"},msg:{1:"idClient",2:"type",3:"attach",4:"custom",5:"resend",6:"userUpdateTime",7:"fromNick",8:"fromAvatar",9:"fromCustom",10:"yidunEnable",11:"antiSpamContent",12:"skipHistory",13:"body",14:"antiSpamBusinessId",15:"clientAntiSpam",16:"antiSpamUsingYidun",20:"time",21:"from",22:"chatroomId",23:"fromClientType",25:"highPriority",27:"callbackExt",28:"subType",29:"yidunAntiCheating",30:"env",31:"notifyTargetTags",32:"yidunAntiSpamExt",33:"yidunAntiSpamRes",34:"loc_x",35:"loc_y",36:"loc_z",37:"toAccids",38:"needHighPriorityMsgAck",_8_safe:"_fromAvatar_safe"},chatroomMember:{1:"chatroomId",2:"account",3:"type",4:"level",5:"nick",6:"avatar",7:"custom",8:"online",9:"guest",10:"enterTime",12:"blacked",13:"gaged",14:"valid",15:"updateTime",16:"tempMuted",17:"tempMuteDuration",_6_safe:"_avatar_safe"},antispamTag:{antiSpamBusinessId:1},chatroomCdnInfo:{1:"enable",2:"cdnUrls",3:"timestamp",4:"interval",5:"decryptType",6:"decryptKey",7:"timeout"},nosConfigTag:{1:"bucket",2:"cdnDomain",3:"expire",4:"objectNamePrefix"},updateTags:{1:"currentTags"}}},function(e,t,r){var n=r(473);e.exports=n},function(e,t,r){r(474);var n=r(12);e.exports=n.Object.getPrototypeOf},function(e,t,r){var n=r(2),i=r(9),o=r(33),s=r(104),a=r(170);n({target:"Object",stat:!0,forced:i((function(){s(1)})),sham:!a},{getPrototypeOf:function(e){return s(o(e))}})},,,,,,,function(e,t,r){var n=r(482),i=r(483),o=r(484),s=r(485);function a(e,t,r){var n=e;return i(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=s(t,{uri:e}),n.callback=r,n}function c(e,t,r){return u(t=a(e,t,r))}function u(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,r=function(r,n,i){t||(t=!0,e.callback(r,n,i))};function n(){var e=void 0;if(e=l.response?l.response:l.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(l),v)try{e=JSON.parse(e)}catch(e){}return e}function i(e){return clearTimeout(d),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,r(e,y)}function s(){if(!u){var t;clearTimeout(d),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var i=y,s=null;return 0!==t?(i={body:n(),statusCode:t,method:m,headers:{},url:p,rawRequest:l},l.getAllResponseHeaders&&(i.headers=o(l.getAllResponseHeaders()))):s=new Error("Internal XMLHttpRequest Error"),r(s,i,i.body)}}var a,u,l=e.xhr||null;l||(l=e.cors||e.useXDR?new c.XDomainRequest:new c.XMLHttpRequest);var d,p=l.url=e.uri||e.url,m=l.method=e.method||"GET",f=e.body||e.data,h=l.headers=e.headers||{},g=!!e.sync,v=!1,y={body:void 0,headers:{},statusCode:0,method:m,url:p,rawRequest:l};if("json"in e&&!1!==e.json&&(v=!0,h.accept||h.Accept||(h.Accept="application/json"),"GET"!==m&&"HEAD"!==m&&(h["content-type"]||h["Content-Type"]||(h["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(s,0)},l.onload=s,l.onerror=i,l.onprogress=function(){},l.onabort=function(){u=!0},l.ontimeout=i,l.open(m,p,!g,e.username,e.password),g||(l.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(d=setTimeout((function(){if(!u){u=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",i(e)}}),e.timeout)),l.setRequestHeader)for(a in h)h.hasOwnProperty(a)&&l.setRequestHeader(a,h[a]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(f||null),l}e.exports=c,e.exports.default=c,c.XMLHttpRequest=n.XMLHttpRequest||function(){},c.XDomainRequest="withCredentials"in new c.XMLHttpRequest?c.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var r=0;r<e.length;r++)t(e[r])}(["get","put","post","patch","head","delete"],(function(e){c["delete"===e?"del":e]=function(t,r,n){return(r=a(t,r,n)).method=e.toUpperCase(),u(r)}}))},function(e,t,r){(function(t){var r;r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=r}).call(this,r(48))},function(e,t){e.exports=function(e){if(!e)return!1;var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var r=Object.prototype.toString},function(e,t){var r=function(e){return e.replace(/^\s+|\s+$/g,"")};e.exports=function(e){if(!e)return{};for(var t,n={},i=r(e).split("\n"),o=0;o<i.length;o++){var s=i[o],a=s.indexOf(":"),c=r(s.slice(0,a)).toLowerCase(),u=r(s.slice(a+1));void 0===n[c]?n[c]=u:(t=n[c],"[object Array]"===Object.prototype.toString.call(t)?n[c].push(u):n[c]=[n[c],u])}return n}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},function(e,t,r){var n=r(27),i=r(119),o=r(13),s=r(11);function a(e){var t=this,r=e.url||null;t.level={debug:0,log:1,info:2,warn:3,error:4}[e.level]||0,t.logCache=[],t.logNum=1,t.timeInterval=5e3,window.onerror=function(e,r,n,i,o){t.error(o)},i((function(){t.logCache.length>0&&r&&t.postLogs(r,t.logCache)}),t.timeInterval)}a.prototype.debug=function(){var e;this.level>0||(console.debug.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[degbug]"]).call(e,arguments)))},a.prototype.log=function(){var e;this.level>1||(console.log.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[log]"]).call(e,arguments)))},a.prototype.info=function(){var e;this.level>2||(console.info.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[info]"]).call(e,arguments)))},a.prototype.warn=function(){var e;this.level>3||(console.warn.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[warn]"]).call(e,arguments)))},a.prototype.error=function(){var e;this.level>4||(console.error.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[error]"]).call(e,arguments)))},a.prototype.cacheLogs=function(e,t){for(var r=[],i=0;i<t.length;i++){var o=t[i];"object"===n(o)?r.push(s(o)):r.push(o)}var a=this.logNum+++" "+e+" "+r.join("; ");this.logCache.push(a.replace("%c",""))},a.prototype.postLogs=function(e,t){var r=this,n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?(console.info("LoggerPlugin::日志上报完成"),r.logCache=[],r.timeInterval=5e3):r.timeInterval+=5e3)},n.open("POST",e),n.setRequestHeader("Content-Type","plain/text;charset=utf-8"),n.timeout=360,n.send(t.join("\n"))},e.exports=a},function(e,t,r){var n=r(4),i=r(39);e.exports=function(e){var t,r,o;e.db&&(i.db=e.db),e.rnfs&&(i.rnfs=e.rnfs,i.rnfs.size||(i.rnfs.size=1048576),i.rnfs.nimPromise=(t=i.rnfs,r=t.size/2-256,0,o=i.rnfs.DocumentDirectoryPath+"/nimlog_0.log",t.exists(o).then((function(e){return e?t.stat(o):n.reject(0)})).then((function(e){return e&&e.size>r?n.reject(1):n.reject(0)})).catch((function(e){return"number"==typeof e&&(t.nimIndex=e),n.resolve()}))))}},function(e,t,r){var n=r(50),i=r(0),o=i.notundef,s=i.undef;function a(e){o(e.name)&&(this.name=""+e.name),o(e.announcement)&&(this.announcement=""+e.announcement),o(e.broadcastUrl)&&(this.broadcastUrl=""+e.broadcastUrl),o(e.custom)&&(this.custom=""+e.custom),o(e.queuelevel)&&(this.queuelevel=n(e.queuelevel))}a.reverse=function(e){var t=i.copy(e);return s(t.announcement)&&(t.announcement=""),s(t.broadcastUrl)&&(t.broadcastUrl=""),s(t.custom)&&(t.custom=""),o(t.createTime)&&(t.createTime=+t.createTime),o(t.updateTime)&&(t.updateTime=+t.updateTime),o(t.onlineMemberNum)&&(t.onlineMemberNum=+t.onlineMemberNum),o(t.mute)&&(t.mute="1"===t.mute),t},e.exports=a},function(e,t,r){var n,i,o;e.exports=(o=r(64),i=(n=o).lib.WordArray,n.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<r;a++)i.push(n.charAt(s>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var o=0;o<r.length;o++)n[r.charCodeAt(o)]=o}var s=r.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function(e,t,r){for(var n=[],o=0,s=0;s<t;s++)if(s%4){var a=r[e.charCodeAt(s-1)]<<s%4*2|r[e.charCodeAt(s)]>>>6-s%4*2;n[o>>>2]|=a<<24-o%4*8,o++}return i.create(n,o)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)},function(e,t,r){var n,i,o,s,a,c,u,l;e.exports=(l=r(64),r(603),r(604),o=(i=(n=l).lib).Base,s=i.WordArray,c=(a=n.algo).MD5,u=a.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),o=s.create(),a=o.words,c=n.keySize,u=n.iterations;a.length<c;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var l=1;l<u;l++)r=i.finalize(r),i.reset();o.concat(r)}return o.sigBytes=4*c,o}}),n.EvpKDF=function(e,t,r){return u.create(r).compute(e,t)},l.EvpKDF)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){r(201);var n=r(143);r(221)(n),e.exports=n},function(e,t,r){var n=r(17),i=r(4),o=r(26),s=r(224),a=r(144).fn;a.refreshSocketUrl=function(){var e;return this.socketUrlsBackup=this.socketUrlsBackup||[],this.socketUrls=n(e=this.socketUrlsBackup).call(e,0),this.logger.info("link::refreshSocketUrl"),i.resolve()},a.disconnect=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this.isConnected())return this.sendCmd("logout"),void o((function(){s(a).disconnect.call(e,t)}),0);this.connecting?this.logger.warn("ChatroomProtocolFn api disconnect:: connecting but exiting"):!0===this.hasActiveDisconnected?this.logger.warn("ChatroomProtocolFn api disconnect:: has tried to disconnect actively"):this.logger.warn("ChatroomProtocolFn api disconnect:: other logic entered"),s(a).disconnect.call(this,t)}},function(e,t,r){var n=r(11),i=r(144).fn,o=r(39),s=r(0);i.assembleLogin=function(){var e=this.options;this.sdkSession=this.genSessionKey();var t={appKey:e.appKey,account:e.account,deviceId:o.deviceId,chatroomId:e.chatroomId,session:this.sdkSession,appLogin:this.autoconnect?1:0},r=!0;if(void 0===e.loc_x||void 0===e.loc_y||void 0===e.loc_z?r=!1:("number"!=typeof e.loc_x&&(e.loc_x=0),"number"!=typeof e.loc_y&&(e.loc_y=0),"number"!=typeof e.loc_z&&(e.loc_z=0)),e.authType=e.loginAuthType,t=s.merge(t,s.filterObj(e,r?"chatroomNick chatroomAvatar chatroomCustom chatroomEnterCustom isAnonymous notifyTargetTags loginAuthType loginExt loc_x loc_y loc_z distance antiSpamBusinessId":"chatroomNick chatroomAvatar chatroomCustom chatroomEnterCustom isAnonymous notifyTargetTags loginAuthType loginExt distance antiSpamBusinessId")),e.tags&&e.tags.length>0)try{t.tags=n(e.tags)}catch(t){this.logger.error("assembleLogin::format tags error",e.tags,t)}return{type:1,login:t,imLogin:this.assembleIMLogin()}},i.afterLogin=function(e){var t=e.chatroom;this.sendCmd("getNosCdnHost",{}),this.chatroom=t,this.notifyLogin()},i.kickedReasons=["","chatroomClosed","managerKick","samePlatformKick","silentlyKick","blacked"],i.kickedMessages=["","聊天室关闭了","被房主或者管理员踢出","不允许同一个帐号在多个地方同时登录","悄悄被踢","被拉黑了"]},function(e,t,r){var n=r(79),i=r(5),o=r(26),s=r(76),a=r(3),c=r(42),u=r(50),l=r(17),d=r(30),p=r(119),m=r(10),f=r(144).fn,h=r(0),g=r(14),v=r(81),y=r(600),b=r(489),S=r(605),T=r(606),_=r(607);f.completeMsg=function(e){e.chatroomId=this.chatroom&&this.chatroom.id,e.from=this.options.account,e.fromClientType="Web",e.time||(e.time=+new Date)},f.onMsg=function(e){var t,r=n(),o=i(t=this.message).call(t,e.content.msg);this.checkMsgUnique(o)?(o.__handleTime=r,o.__receiveTime=e.__receiveTime,this.msgBuffer.push(o),this.msgFlushTimer||this.startMsgFlushTimer(),e&&e.content&&e.content.msg&&"1"===e.content.msg.needHighPriorityMsgAck&&this.sendCmd("sendChatroomMsgAck",{chatRoomMsgAckTag:{idClient:o.idClient,chatroomId:o.chatroomId}})):this.logger.warn("onMsg::msg::repeat",o.idClient)},f.startMsgFlushTimer=function(){var e=this,t=e.options;e.msgFlushTimer=o((function(){var r,i=s(r=e.msgBuffer).call(r,0,t.msgBufferSize);if(g.isBrowser){var o=e.relativeSeverTime||0,c=n();a(i).call(i,(function(t){if("out"!==t.flow){var r={msgId:t.idServer,clientId:t.idClient,receiveTime:t.__receiveTime,serverTime:t.time,callbackTime:c,preHandleTime:t.__handleTime,fromAccid:t.from,toAccid:e.options.account,type:4,tid:"",roomId:t.chatroomId,result:200,failReason:"",rt:n()-o-t.time};e.reporter&&e.reporter.report("msgReceive",r,!0)}delete t.__handleTime,delete t.__receiveTime}))}e.options.onmsgs(i),e.msgBuffer.length?e.startMsgFlushTimer():delete e.msgFlushTimer}),t.msgBufferInterval)},f.checkMsgUnique=h.genCheckUniqueFunc("idClient"),f.onSendMsg=function(e){var t,r=e.obj.msg;e.error?r.status="fail":(r=e.content.msg).status="success",c(r,e.obj.msg),r=i(t=this.message).call(t,r),this.checkMsgUnique(r),e.obj=r},f.onHistoryMsgs=function(e){e.error||(e.obj||(e.obj={}),e.obj.msgs=this.message.reverseMsgs(e.content.msgs))},f.onCdnMsgInfo=function(e){if(e){e.cdnUrls&&(e.cdnUrls=e.cdnUrls.split("|")),e.interval&&(e.interval=1e3*u(e.interval)),e.timeout&&(e.timeout=+e.timeout),e.enable&&(e.enable=+e.enable),e.timestamp&&(e.timestamp=+e.timestamp,this.correctCdnTime(e.timestamp));var t=!this.cdnInfo.enable&&e.enable;c(this.cdnInfo,e),t&&this.queryCdnMsgs()}},f.correctCdnTime=function(e){e&&"number"==typeof e&&(this.cdnInfo||(this.cdnInfo={}),this.cdnInfo.timestamp=e,this.cdnInfo.localTime=+new Date,this.cdnInfo.lastNow=null,this.logger.info("correctCdnTime: timestamp, localTime",e,this.cdnInfo.localTime,new Date(e),new Date(this.cdnInfo.localTime)))},f.queryCdnMsgs=function(e){var t,r=this;if(this.cdnInfo&&this.cdnInfo.enable&&this.isConnected()){this.queryCdnTimer=o((function(){return r.queryCdnMsgs()}),this.cdnInfo.interval);var n=+new Date;if(n=n-this.cdnInfo.localTime+this.cdnInfo.timestamp,n-=n%this.cdnInfo.interval,this.cdnInfo.lastNow!==n&&this.cdnInfo.cdnUrls&&this.cdnInfo.cdnUrls.length){this.cdnInfo.cdnUrls.push(this.cdnInfo.cdnUrls.shift());var i=this,s=this.cdnInfo.decryptKey,a=this.cdnInfo.timeout||Math.ceil(this.cdnInfo.interval/2),c=l(t=this.cdnInfo.cdnUrls).call(t,0);e=e||0,function t(){if(e>=3)i.finalFail++;else if(c.length){var r=c.shift().replace("#time",n),o=r.split("/")[2],u=+new Date;v(r,{timeout:a,onload:function(e){if(i.cdnInfo.lastNow>n)i.logger.warn("queryCdnMsgs::doQuery cdnInfo.lastNow > now, will throw data ",i.cdnInfo.lastNow,n,e);else{i.cdnInfo.lastNow=n,i.afterQueryCdn(o,+new Date-u,!0);try{e=JSON.parse(e)}catch(e){i.logger.warn("queryCdnMsgs::doQuery::onload parse res error: ",e)}if(e&&e.data){e.ptm&&(i.cdnInfo.timeout=e.ptm),e.pis&&(i.cdnInfo.interval=1e3*e.pis);var t,r,a=!0===e.e?(t=e.data,r=s,y.decrypt(t,b.parse(r),{mode:S,padding:T}).toString(_)):e.data;i.onCdnMsgsSmoothly(a,n,1e3*e.c)}}},onerror:function(r){if(e++,i.afterQueryCdn(o,+new Date-u,!1),404===r.status){var n;try{var s=JSON.parse(r.result);404===s.code&&s.timestamp&&(n=s.timestamp)}catch(e){i.logger.warn("queryCdnMsgs::doQuery::parse 404 result error",e,r)}!n&&r.date&&(n=+new Date(r.date)),n&&(i.correctCdnTime(n),clearTimeout(i.queryCdnTimer),i.queryCdnMsgs(e))}else t()}})}}()}}},f.onCdnMsgsSmoothly=function(e,t,r){try{e=JSON.parse(e)}catch(e){this.logger.warn("onCdnMsgsSmoothly::JSON.parse error",e)}if(this.logger.info("receive cdn msgs "+e.length+" and request time is "+new Date(t)),d(e)&&e.length){var n=this,i=this.options.msgBufferInterval,o=Math.ceil(e.length*i/r);c(),clearInterval(n.cdnSmoothTimer),n.cdnSmoothTimer=p((function(){return c()}),i)}function c(){if(n.isConnected()){var t=s(e).call(e,0,o);a(t).call(t,(function(e){var t=n.parser.syncUnserialize(e,"msg");n.onMsg({content:{msg:t}})})),e.length||clearInterval(n.cdnSmoothTimer)}}},f.resetCdnData=function(){this.cdnData={},this.finalFail=0,this.cdnDataTime=+new Date},f.initCdnData=function(){this.resetCdnData(),h.isFunction(this.options.onCdnRequestData)?(this.options.cdnRequestDataInterval=this.options.cdnRequestDataInterval||3e4,this.afterQueryCdn=function(e,t,r){var n,i=this;this.cdnData[e]||(this.cdnData[e]={success:0,fail:0,sr:0,fr:0,smr:0,fmr:0}),r?(this.cdnData[e].success++,this.cdnData[e].sr+=t,t>this.cdnData[e].smr&&(this.cdnData[e].smr=t)):(this.cdnData[e].fail++,this.cdnData[e].fr+=t,t>this.cdnData[e].fmr&&(this.cdnData[e].fmr=t)),+new Date-this.cdnDataTime<this.options.cdnRequestDataInterval||(a(n=m(this.cdnData)).call(n,(function(e){i.cdnData[e].sr=i.cdnData[e].sr/i.cdnData[e].success||0,i.cdnData[e].fr=i.cdnData[e].fr/i.cdnData[e].fail||0})),this.options.onCdnRequestData(c({},this.cdnData),this.finalFail),this.resetCdnData())}):this.afterQueryCdn=function(){}}},function(e,t,r){var n;e.exports=(n=r(64),r(489),r(602),r(490),r(223),function(){var e=n,t=e.lib.BlockCipher,r=e.algo,i=[],o=[],s=[],a=[],c=[],u=[],l=[],d=[],p=[],m=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var f=n^n<<1^n<<2^n<<3^n<<4;f=f>>>8^255&f^99,i[r]=f,o[f]=r;var h=e[r],g=e[h],v=e[g],y=257*e[f]^16843008*f;s[r]=y<<24|y>>>8,a[r]=y<<16|y>>>16,c[r]=y<<8|y>>>24,u[r]=y,y=16843009*v^65537*g^257*h^16843008*r,l[f]=y<<24|y>>>8,d[f]=y<<16|y>>>16,p[f]=y<<8|y>>>24,m[f]=y,r?(r=h^e[e[e[v^h]]],n^=e[e[n]]):r=n=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],h=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),o=this._keySchedule=[],s=0;s<n;s++)s<r?o[s]=t[s]:(u=o[s-1],s%r?r>6&&s%r==4&&(u=i[u>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u]):(u=i[(u=u<<8|u>>>24)>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u],u^=f[s/r|0]<<24),o[s]=o[s-r]^u);for(var a=this._invKeySchedule=[],c=0;c<n;c++){if(s=n-c,c%4)var u=o[s];else u=o[s-4];a[c]=c<4||s<=4?u:l[i[u>>>24]]^d[i[u>>>16&255]]^p[i[u>>>8&255]]^m[i[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,a,c,u,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,l,d,p,m,o),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,o,s,a){for(var c=this._nRounds,u=e[t]^r[0],l=e[t+1]^r[1],d=e[t+2]^r[2],p=e[t+3]^r[3],m=4,f=1;f<c;f++){var h=n[u>>>24]^i[l>>>16&255]^o[d>>>8&255]^s[255&p]^r[m++],g=n[l>>>24]^i[d>>>16&255]^o[p>>>8&255]^s[255&u]^r[m++],v=n[d>>>24]^i[p>>>16&255]^o[u>>>8&255]^s[255&l]^r[m++],y=n[p>>>24]^i[u>>>16&255]^o[l>>>8&255]^s[255&d]^r[m++];u=h,l=g,d=v,p=y}h=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[d>>>8&255]<<8|a[255&p])^r[m++],g=(a[l>>>24]<<24|a[d>>>16&255]<<16|a[p>>>8&255]<<8|a[255&u])^r[m++],v=(a[d>>>24]<<24|a[p>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^r[m++],y=(a[p>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&d])^r[m++],e[t]=h,e[t+1]=g,e[t+2]=v,e[t+3]=y},keySize:8});e.AES=t._createHelper(h)}(),n.AES)},function(e,t){},function(e,t,r){var n;e.exports=(n=r(64),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,s=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=s.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,s=e[t+0],c=e[t+1],m=e[t+2],f=e[t+3],h=e[t+4],g=e[t+5],v=e[t+6],y=e[t+7],b=e[t+8],S=e[t+9],T=e[t+10],_=e[t+11],w=e[t+12],M=e[t+13],x=e[t+14],E=e[t+15],C=o[0],R=o[1],k=o[2],A=o[3];C=u(C,R,k,A,s,7,a[0]),A=u(A,C,R,k,c,12,a[1]),k=u(k,A,C,R,m,17,a[2]),R=u(R,k,A,C,f,22,a[3]),C=u(C,R,k,A,h,7,a[4]),A=u(A,C,R,k,g,12,a[5]),k=u(k,A,C,R,v,17,a[6]),R=u(R,k,A,C,y,22,a[7]),C=u(C,R,k,A,b,7,a[8]),A=u(A,C,R,k,S,12,a[9]),k=u(k,A,C,R,T,17,a[10]),R=u(R,k,A,C,_,22,a[11]),C=u(C,R,k,A,w,7,a[12]),A=u(A,C,R,k,M,12,a[13]),k=u(k,A,C,R,x,17,a[14]),C=l(C,R=u(R,k,A,C,E,22,a[15]),k,A,c,5,a[16]),A=l(A,C,R,k,v,9,a[17]),k=l(k,A,C,R,_,14,a[18]),R=l(R,k,A,C,s,20,a[19]),C=l(C,R,k,A,g,5,a[20]),A=l(A,C,R,k,T,9,a[21]),k=l(k,A,C,R,E,14,a[22]),R=l(R,k,A,C,h,20,a[23]),C=l(C,R,k,A,S,5,a[24]),A=l(A,C,R,k,x,9,a[25]),k=l(k,A,C,R,f,14,a[26]),R=l(R,k,A,C,b,20,a[27]),C=l(C,R,k,A,M,5,a[28]),A=l(A,C,R,k,m,9,a[29]),k=l(k,A,C,R,y,14,a[30]),C=d(C,R=l(R,k,A,C,w,20,a[31]),k,A,g,4,a[32]),A=d(A,C,R,k,b,11,a[33]),k=d(k,A,C,R,_,16,a[34]),R=d(R,k,A,C,x,23,a[35]),C=d(C,R,k,A,c,4,a[36]),A=d(A,C,R,k,h,11,a[37]),k=d(k,A,C,R,y,16,a[38]),R=d(R,k,A,C,T,23,a[39]),C=d(C,R,k,A,M,4,a[40]),A=d(A,C,R,k,s,11,a[41]),k=d(k,A,C,R,f,16,a[42]),R=d(R,k,A,C,v,23,a[43]),C=d(C,R,k,A,S,4,a[44]),A=d(A,C,R,k,w,11,a[45]),k=d(k,A,C,R,E,16,a[46]),C=p(C,R=d(R,k,A,C,m,23,a[47]),k,A,s,6,a[48]),A=p(A,C,R,k,y,10,a[49]),k=p(k,A,C,R,x,15,a[50]),R=p(R,k,A,C,g,21,a[51]),C=p(C,R,k,A,w,6,a[52]),A=p(A,C,R,k,f,10,a[53]),k=p(k,A,C,R,T,15,a[54]),R=p(R,k,A,C,c,21,a[55]),C=p(C,R,k,A,b,6,a[56]),A=p(A,C,R,k,E,10,a[57]),k=p(k,A,C,R,v,15,a[58]),R=p(R,k,A,C,M,21,a[59]),C=p(C,R,k,A,h,6,a[60]),A=p(A,C,R,k,_,10,a[61]),k=p(k,A,C,R,m,15,a[62]),R=p(R,k,A,C,S,21,a[63]),o[0]=o[0]+C|0,o[1]=o[1]+R|0,o[2]=o[2]+k|0,o[3]=o[3]+A|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),s=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,i,o,s){var a=e+(t&r|~t&n)+i+s;return(a<<o|a>>>32-o)+t}function l(e,t,r,n,i,o,s){var a=e+(t&n|r&~n)+i+s;return(a<<o|a>>>32-o)+t}function d(e,t,r,n,i,o,s){var a=e+(t^r^n)+i+s;return(a<<o|a>>>32-o)+t}function p(e,t,r,n,i,o,s){var a=e+(r^(t|~n))+i+s;return(a<<o|a>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),n.MD5)},function(e,t,r){var n,i,o,s,a,c,u,l;e.exports=(i=(n=l=r(64)).lib,o=i.WordArray,s=i.Hasher,a=n.algo,c=[],u=a.SHA1=s.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var d=(n<<5|n>>>27)+a+c[u];d+=u<20?1518500249+(i&o|~i&s):u<40?1859775393+(i^o^s):u<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,a=s,s=o,o=i<<30|i>>>2,i=n,n=d}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA1=s._createHelper(u),n.HmacSHA1=s._createHmacHelper(u),l.SHA1)},function(e,t,r){var n,i,o;e.exports=(i=(n=r(64)).lib.Base,o=n.enc.Utf8,void(n.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),s=this._iKey=t.clone(),a=i.words,c=s.words,u=0;u<r;u++)a[u]^=1549556828,c[u]^=909522486;i.sigBytes=s.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},function(e,t,r){var n,i;e.exports=(i=r(64),r(223),i.mode.ECB=((n=i.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),n.Decryptor=n.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),n),i.mode.ECB)},function(e,t,r){var n;e.exports=(n=r(64),r(223),n.pad.Pkcs7)},function(e,t,r){e.exports=r(64).enc.Utf8},function(e,t,r){var n=r(5),i=r(144).fn,o=r(222);i.onChatroomMembersInfo=i.onChatroomMembers=function(e){e.error||(e.obj.members=o.reverseMembers(e.content.members))},i.onGetChatroomMemberCountByTag=function(e){e.error||(e.obj=e.content)},i.onMarkChatroomMember=function(e){e.error||(e.obj.member=n(o).call(o,e.content.chatroomMember))},i.onSyncRobot=function(e){!e.error&&this.options.onrobots?this.options.onrobots(null,e.content):this.ontions.onrobots(e.error,{})}},function(e,t,r){var n=r(5),i=r(8),o=r(0),s=function(e){this.account=e.account},a=s.prototype,c=a.Message=r(91),u=a.TextMessage=r(610),l=a.FileMessage=r(153),d=a.GeoMessage=r(614),p=a.NotificationMessage=r(615),m=a.CustomMessage=r(616),f=a.TipMessage=r(617),h=a.RobotMessage=r(618);a.validTypes=c.validTypes,a.reverse=function(e){var t;switch(c.getType(e)){case"text":t=n(u).call(u,e);break;case"image":case"audio":case"video":case"file":t=n(l).call(l,e);break;case"geo":t=n(d).call(d,e);break;case"notification":t=n(p).call(p,e);break;case"custom":t=n(m).call(m,e);break;case"tip":t=n(f).call(f,e);break;case"robot":t=n(h).call(h,e);break;default:t=n(c).call(c,e)}return c.setExtra(t,this.account),t},a.reverseMsgs=function(e,t){var r,s,a=this;return i(e).call(e,(function(e){return e=n(a).call(a,e),t&&((r=t.modifyObj)&&(e=o.merge(e,r)),s=t.mapper,o.isFunction(s)&&(e=s(e))),e}))},e.exports=s},function(e,t,r){var n=r(15),i=r(5),o=r(91),s=r(0);function a(e){s.verifyOptions(e,"text","msg::TextMessage"),e.type="text",o.call(this,e),this.attach=e.text,this.body=""}a.prototype=n(o.prototype),a.reverse=function(e){var t=i(o).call(o,e);return t.text=e.attach,t},e.exports=a},function(e,t,r){var n=r(15),i=r(0),o=r(153);function s(){}s.prototype=n(o.prototype),s.verifyFile=function(e,t){i.verifyOptions(e,"w h",!0,"file.",t)},e.exports=s},function(e,t,r){var n=r(15),i=r(153),o=r(0);function s(){}s.prototype=n(i.prototype),s.verifyFile=function(e,t){o.verifyOptions(e,"dur",!0,"file.",t)},e.exports=s},function(e,t,r){var n=r(15),i=r(153),o=r(0);function s(){}s.prototype=n(i.prototype),s.verifyFile=function(e,t){o.verifyOptions(e,"dur w h",!0,"file.",t)},e.exports=s},function(e,t,r){var n=r(11),i=r(15),o=r(5),s=r(91),a=r(0);function c(e){e.type="geo",a.verifyOptions(e,"geo","msg::GeoMessage"),a.verifyOptions(e.geo,"lng lat title",!0,"geo.","msg::GeoMessage"),a.verifyParamType("geo.lng",e.geo.lng,"number","msg::GeoMessage"),a.verifyParamType("geo.lat",e.geo.lat,"number","msg::GeoMessage"),a.verifyParamType("geo.title",e.geo.title,"string","msg::GeoMessage"),s.call(this,e),this.attach=n(e.geo)}c.prototype=i(s.prototype),c.reverse=function(e){var t=o(s).call(s,e);return e.attach=e.attach?""+e.attach:"",t.geo=e.attach?JSON.parse(e.attach):{},t},e.exports=c},function(e,t,r){var n=r(15),i=r(5),o=r(50),s=r(0).notundef,a=r(91),c={301:"memberEnter",302:"memberExit",303:"blackMember",304:"unblackMember",305:"gagMember",306:"ungagMember",307:"addManager",308:"removeManager",309:"addCommon",310:"removeCommon",311:"closeChatroom",312:"updateChatroom",313:"kickMember",314:"addTempMute",315:"removeTempMute",316:"updateMemberInfo",317:"updateQueue",318:"muteRoom",319:"unmuteRoom",320:"batchUpdateQueue",321:"addTempMuteTag",322:"removeTempMuteTag",324:"batchQueueOffer",323:"deleteChatroomMsg",325:"updateChatroomTags"};function u(){}u.prototype=n(a.prototype),u.reverse=function(e){var t=i(a).call(a,e);if(e.attach=e.attach?""+e.attach:"",e.attach){var r=JSON.parse(e.attach);if(t.attach={type:c[r.id]},s(r.data)){var n=r.data;if(s(n.operator)&&(t.attach.from=n.operator),s(n.opeNick)&&(t.attach.fromNick=n.opeNick),s(n.target)&&(t.attach.to=n.target),s(n.tarNick)&&(t.attach.toNick=n.tarNick),s(n.muteDuration)&&(t.attach.duration=o(n.muteDuration,10)),s(n.tags)&&(t.attach.tags=n.tags),"memberEnter"===t.attach.type&&(s(n.muted)?t.attach.gaged=1==+n.muted:t.attach.gaged=!1,s(n.tempMuted)?t.attach.tempMuted=1==+n.tempMuted:t.attach.tempMuted=!1,s(n.muteTtl)?t.attach.tempMuteDuration=+n.muteTtl:t.attach.tempMuteDuration=0),"deleteChatroomMsg"===t.attach.type&&(t.attach.msgId=n.msgId,t.attach.msgTime=n.msgTime),s(n.ext)&&(t.attach.custom=n.ext),s(n.queueChange)){var u=JSON.parse(n.queueChange);switch(u._e){case"OFFER":t.attach.queueChange={type:"OFFER",elementKey:u.key,elementValue:u.content};break;case"POLL":t.attach.queueChange={type:"POLL",elementKey:u.key,elementValue:u.content};break;case"DROP":t.attach.queueChange={type:"DROP"};break;case"PARTCLEAR":case"BATCH_UPDATE":t.attach.queueChange={type:u._e,elementKv:u.kvObject};break;case"BATCH_OFFER":t.attach.queueChange={type:u._e,elements:u.elements}}}}}else t.attach={};return t},e.exports=u},function(e,t,r){var n=r(11),i=r(15),o=r(5),s=r(91),a=r(0);function c(e){a.verifyOptions(e,"content","msg::CustomMessage"),e.type="custom",s.call(this,e),"string"!=typeof e.content&&(e.content=n(e.content)),this.attach=e.content}c.prototype=i(s.prototype),c.reverse=function(e){var t=o(s).call(s,e);return t.content=e.attach,t},e.exports=c},function(e,t,r){var n=r(15),i=r(5),o=r(91),s=r(0);function a(e){s.verifyOptions(e,"tip","msg::TipMessage"),e.type="tip",o.call(this,e),this.attach=e.tip}a.prototype=n(o.prototype),a.reverse=function(e){var t=i(o).call(o,e);return t.tip=e.attach,t},e.exports=a},function(e,t,r){var n=r(11),i=r(15),o=r(5),s=r(8),a=r(91),c=r(0),u={welcome:"00",text:"01",link:"03"},l={"01":"text","02":"image","03":"answer",11:"template"};function d(e){c.verifyOptions(e,"content","msg::RobotMessage");var t=e.content;switch(t.type){case"welcome":c.undef(e.body)&&(this.body="欢迎消息");break;case"text":c.verifyOptions(t,"content","msg::RobotMessage"),c.undef(e.body)&&(this.body=t.content);break;case"link":c.verifyOptions(t,"target","msg::RobotMessage")}t.type&&(t.type=u[t.type]),t={param:t,robotAccid:e.robotAccid},this.attach=n(t),e.type="robot",a.call(this,e)}d.prototype=i(a.prototype),d.reverse=function(e){var t=o(a).call(a,e);if("robot"===t.type){var r=JSON.parse(e.attach);if(r.param&&(r.param.type=l[r.param.type]||"unknown"),r.robotMsg){var n=(r=c.merge(r,r.robotMsg)).message;"bot"===r.flag?r.message=s(n).call(n,(function(e){return e.type=l[e.type]||"unknown",e})):r.flag,delete r.robotMsg}t.content=r}return t},e.exports=d},function(e,t,r){var n=r(5),i=r(30),o=r(8),s=r(19),a=r(11),c=r(0),u=c.undef,l=r(143).fn;l.beforeSendMsg=function(e){e.cmd="sendMsg"};var d={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};l.getHistoryMsgs=function(e){if(c.verifyOptions(e),u(e.timetag)?e.timetag=0:c.verifyParamType("timetag",e.timetag,"number","msg::getHistoryMsgs"),u(e.limit)?e.limit=100:c.verifyParamType("limit",e.limit,"number","msg::getHistoryMsgs"),u(n(e))?e.reverse=!1:c.verifyParamType("reverse",n(e),"boolean","msg::getHistoryMsgs"),u(e.msgTypes))e.msgTypes=[];else if(i(e.msgTypes)){var t,r;e.msgTypes=o(t=e.msgTypes).call(t,(function(e){return d[e]})),e.msgTypes=s(r=e.msgTypes).call(r,(function(e){return"number"==typeof e}))}else"number"==typeof d[e.msgTypes]?e.msgTypes=[d[e.msgTypes]]:e.msgTypes=[];this.processCallback(e),this.sendCmd("getHistoryMsgs",e,(function(t,r,n){i(n)&&(n=o(n).call(n,(function(e){return d[e.type]&&(e.type=d[e.type]),e}))),e.callback(t,r,n)}))},l.getHistoryMsgsByTags=function(e){if(c.verifyOptions(e,"tags","api::msg::getHistoryMsgsByTags"),c.verifyParamType("tags",e.tags,"array","api::msg::getHistoryMsgsByTags"),u(e.fromTime)?e.fromTime=0:c.verifyParamType("fromTime",e.fromTime,"number","api::msg::getHistoryMsgsByTags"),u(e.toTime)?e.toTime=0:c.verifyParamType("toTime",e.toTime,"number","api::msg::getHistoryMsgsByTags"),u(e.limit)?e.limit=100:c.verifyParamType("limit",e.limit,"number","msg::getHistoryMsgs"),u(n(e))?e.reverse=0:c.verifyParamType("reverse",n(e),"number","msg::getHistoryMsgs"),u(e.types))e.types=[];else if(i(e.types)){var t,r;e.types=o(t=e.types).call(t,(function(e){return d[e]})),e.types=s(r=e.types).call(r,(function(e){return"number"==typeof e}))}else"number"==typeof d[e.types]?e.types=[d[e.types]]:e.types=[];this.processCallback(e),e.types=a(e.types),e.tags=a(e.tags),this.sendCmd("getHistoryMsgsByTags",{chatRoomTagHistoryMsgRequestTag:e},e.callback)}},function(e,t,r){r(143).fn.disconnect=function(e){e=e||{},this.protocol.disconnect(e.done)}},function(e,t,r){var n=r(0),i=n.undef,o=n.verifyOptions,s=n.verifyParamType,a=r(222),c=r(143).fn;c.updateMyChatroomMemberInfo=function(e){o(e,"member needNotify","member::updateMyChatroomMemberInfo"),s("needNotify",e.needNotify,"boolean","member::updateMyChatroomMemberInfo"),e.needSave=e.needSave||!1,s("needSave",e.needSave,"boolean","member::updateMyChatroomMemberInfo"),this.processCustom(e),this.processCallback(e),e.chatroomMember=new a(e.member),e.antispamTag={antiSpamBusinessId:e.antiSpamBusinessId},this.sendCmd("updateMyChatroomMemberInfo",e)},c.getChatroomMembers=function(e){o(e,"guest","member::getChatroomMembers"),s("guest",e.guest,"boolean","member::getChatroomMembers"),i(e.time)?e.time=0:s("time",e.time,"number","member::getChatroomMembers"),i(e.limit)?e.limit=100:s("limit",e.limit,"number","member::getChatroomMembers"),this.processCallback(e),e.guest?e.type=!1===e.desc?3:1:e.type=e.onlyOnline?2:0,this.sendCmd("getChatroomMembers",e)},c.getChatroomMembersByTag=function(e){o(e,"tag","getChatroomMembersByTag::rag"),i(e.time)?e.time=0:s("time",e.time,"number","getChatroomMembersByTag::time"),i(e.limit)?e.limit=100:s("limit",e.limit,"number","getChatroomMembersByTag::limit"),this.processCallback(e),this.sendCmd("getChatroomMembersByTag",{tagMemberReq:n.filterObj(e,"tag limit time"),callback:e.callback})},c.getChatroomMemberCountByTag=function(e){o(e,"tag","getChatroomMemberCountByTag::rag"),this.processCallback(e),this.sendCmd("getChatroomMemberCountByTag",e)},c.getChatroomMembersInfo=function(e){o(e,"accounts","member::getChatroomMembersInfo"),s("accounts",e.accounts,"array","member::getChatroomMembersInfo"),this.processCallback(e),this.sendCmd("getChatroomMembersInfo",e)},c.markChatroomIdentity=function(e){o(e,"identity","member::markChatroomIdentity"),e.type={manager:1,common:2,black:-1,mute:-2}[e.identity],delete e.identity,isNaN(e.type)?o(e,"identity",'member::markChatroomIdentity. The valid value of the identity is "manager" or "common" or "black" or "mute".'):this.markChatroomMember(e)},c.markChatroomManager=function(e){e.type=1,this.markChatroomMember(e)},c.markChatroomCommonMember=function(e){e.type=2,this.markChatroomMember(e)},c.markChatroomBlacklist=function(e){e.type=-1,this.markChatroomMember(e)},c.markChatroomGaglist=function(e){e.type=-2,this.markChatroomMember(e)},c.markChatroomMember=function(e){o(e,"account type isAdd","member::markChatroomMember"),s("isAdd",e.isAdd,"boolean","member::markChatroomMember"),i(e.level)?e.level=0:s("level",e.level,"number","member::markChatroomMember"),this.processCustom(e),this.processCallback(e),this.sendCmd("markChatroomMember",e)},c.kickChatroomMember=function(e){o(e,"account","member::kickChatroomMember"),this.processCustom(e),this.processCallback(e),this.sendCmd("kickChatroomMember",e)},c.updateChatroomMemberTempMute=function(e){o(e,"account duration needNotify","member::updateChatroomMemberTempMute"),s("duration",e.duration,"number","member::updateChatroomMemberTempMute"),s("needNotify",e.needNotify,"boolean","member::updateChatroomMemberTempMute"),this.processCustom(e),this.processCallback(e),this.sendCmd("updateChatroomMemberTempMute",e)},c.updateTagMembersTempMute=function(e){o(e,"tag duration needNotify","member::updateTagMembersTempMute"),s("duration",e.duration,"number","member::updateTagMembersTempMute"),s("needNotify",e.needNotify,"boolean","member::updateTagMembersTempMute"),this.processCustom(e),this.processCallback(e);var t=n.filterObj(e,"tag duration custom notifyTargetTags");t.needNotify=e.needNotify?1:0,this.sendCmd("updateTagMembersTempMute",{tagMuteReq:t,callback:e.callback})},c.updateCoordinate=n.throttle((function(e){var t=!0;void 0===e.x||void 0===e.y||void 0===e.z?t=!1:("number"!=typeof e.x&&(e.x=0),"number"!=typeof e.y&&(e.y=0),"number"!=typeof e.z&&(e.z=0)),this.processCallback(e);var r=n.filterObj(e,t?"x y z distance":"distance");this.sendCmd("updateCoordinate",{coordinateReq:r,callback:e.callback})}),300,{},(function(e){e&&e.done&&e.done({code:416,chatroomId:this.options.chatroomId})})),c.getRobotList=function(e){this.logger.warn("this api will be abandon"),i(e.timetag)&&(e.timetag=0),this.processCallback(e),this.sendCmd("syncRobot",e)}},function(e,t,r){var n=r(143).fn,i=r(0);n.queueOffer=function(e){i.verifyOptions(e,"elementKey elementValue","msg::queueOffer");var t={elementKey:e.elementKey,elementValue:e.elementValue,transient:!!e.transient};e.elementAccount&&(t.elementAccount=e.elementAccount),this.processCallback(e),this.sendCmd("queueOffer",t,e.callback)},n.queuePoll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.elementKey=e.elementKey||"",this.processCallback(e),this.sendCmd("queuePoll",e,e.callback)},n.queueList=function(e){this.processCallback(e),this.sendCmd("queueList",e,e.callback)},n.peak=function(e){this.processCallback(e),this.sendCmd("peak",e,e.callback)},n.queueDrop=function(e){this.processCallback(e),this.sendCmd("queueDrop",e,e.callback)},n.queueChange=function(e){i.verifyOptions(e,"elementMap","msg::queueOffer"),e.needNotify?(e.needNotify=!0,i.verifyOptions(e,"notifyExt","msg::queueOffer")):e.needNotify=!1,this.processCallback(e),this.sendCmd("queueChange",e,e.callback)}},,function(e,t,r){e.exports=r(596)}])}))})(NIM_Web_Chatroom);var Chatroom=getDefaultExportFromCjs(NIM_Web_Chatroom.exports),__assign=function(){return __assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign.apply(this,arguments)};function __decorate(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}function __awaiter(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function __generator(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function __spreadArray(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var name$2="@xkit-yx/core-kit",version$2="0.9.0",description$2="",main$2="dist/index.cjs.js",module="dist/index.esm.js",unpkg="dist/index.umd.js",typings="dist/types/index.d.ts",miniprogram="dist/miniprogram",files$2=["dist"],publishConfig={access:"public"},scripts$2={dev:"rollup -c --environment DEV",build:"rollup -c --environment PROD"},repository$1={type:"git",url:"ssh://git@g.hz.netease.com:22222/yunxin-app/kit-room-web.git"},author$2="",license$1="MIT",peerDependencies={"@xkit-yx/utils":"^0.4.3","@yxim/nim-web-sdk":"9.8.0",axios:"^0.27.2",eventemitter3:"^4.0.7","nertc-web-sdk":"4.6.50","nim-web-sdk-ng":"0.11.0","yunxin-log-debug":"^1.1.6"},dependencies$2={"@xkit-yx/utils":"^0.5.1","@yxim/nim-web-sdk":"9.8.0",axios:"^0.27.2",eventemitter3:"^4.0.7","nertc-web-sdk":"4.6.50","nim-web-sdk-ng":"0.11.0","yunxin-log-debug":"^1.1.6"},devDependencies$2={"@rollup/plugin-alias":"^4.0.3","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^10.0.0","@rollup/plugin-replace":"^4.0.0","miniprogram-api-typings":"^3.4.6",rollup:"^2.33.1","rollup-plugin-commonjs":"^10.1.0","rollup-plugin-terser":"^7.0.2","rollup-plugin-typescript2":"^0.31.2"},gitHead="eb40aeaba535412ca645513da5c39b00d91efda0",packageJson={name:name$2,version:version$2,description:description$2,main:main$2,module:module,unpkg:unpkg,typings:typings,miniprogram:miniprogram,files:files$2,publishConfig:publishConfig,scripts:scripts$2,repository:repository$1,author:author$2,license:license$1,peerDependencies:peerDependencies,dependencies:dependencies$2,devDependencies:devDependencies$2,gitHead:gitHead};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var NIM_Web_NIM=createCommonjsModule((function(module,exports){!function(e,t){module.exports=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=623)}([function(e,t,r){var n=r(94),i=r(95),o=r(75),s=r(57),a=r(58),c=r(59),u=r(60),l=r(49),d=r(61),p=r(3),m=r(6),f=r(17),h=r(10),g=r(116),v=r(76),y=r(109),b=r(30),S=r(13),T=r(8),_=r(11),w=r(148),M=r(110),x=r(26),E=r(19),C=r(373),R=r(4),k=r(27);function A(e,t){var r=h(e);if(s){var n=s(e);t&&(n=E(n).call(n,(function(t){return a(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(b(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return O(e,t);var i=f(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?O(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0,a=function(){};return{s:a,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){l=!0,c=e},f:function(){try{u||null==r.return||r.return()}finally{if(l)throw c}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var P=r(189),N=r(147);function D(e){"object"===k(e)?(this.callFunc=e.callFunc||null,this.message=e.message||"UNKNOW ERROR"):this.message=e,this.time=new Date,this.timetag=+this.time}r(377);var L,j,U=r(47),F=U.getGlobal(),$=/\s+/;U.deduplicate=function(e){var t=[];return p(e).call(e,(function(e){-1===m(t).call(t,e)&&t.push(e)})),t},U.capFirstLetter=function(e){return e?f(e=""+e).call(e,0,1).toUpperCase()+f(e).call(e,1):""},U.guid=(L=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return L()+L()+L()+L()+L()+L()+L()+L()}),U.extend=function(e,t,r){for(var n in t)void 0!==e[n]&&!0!==r||(e[n]=t[n])},U.filterObj=function(e,t){var r={};return U.isString(t)&&(t=t.split($)),p(t).call(t,(function(t){e.hasOwnProperty(t)&&(r[t]=e[t])})),r},U.copy=function(e,t){var r;return t=t||{},e?(p(r=h(e)).call(r,(function(r){U.exist(e[r])&&(t[r]=e[r])})),t):t},U.copyWithNull=function(e,t){var r;return t=t||{},e?(p(r=h(e)).call(r,(function(r){(U.exist(e[r])||U.isnull(e[r]))&&(t[r]=e[r])})),t):t},U.findObjIndexInArray=function(e,t){e=e||[];var r=t.keyPath||"id",n=-1;return g(e).call(e,(function(e,i){if(N(e,r)===t.value)return n=i,!0})),n},U.findObjInArray=function(e,t){var r=U.findObjIndexInArray(e,t);return-1===r?null:e[r]},U.mergeObjArray=function(){var e=[],t=f([]).call(arguments,0,-1),r=arguments[arguments.length-1];U.isArray(r)&&(t.push(r),r={});var n,i=r.keyPath=r.keyPath||"id";for(r.sortPath=r.sortPath||i;!e.length&&t.length;)e=t.shift()||[],e=f(e).call(e,0);return p(t).call(t,(function(t){t&&p(t).call(t,(function(t){-1!==(n=U.findObjIndexInArray(e,{keyPath:i,value:N(t,i)}))?e[n]=U.merge({},e[n],t):e.push(t)}))})),r.notSort||(e=U.sortObjArray(e,r)),e},U.cutObjArray=function(e){var t=f(e).call(e,0),r=arguments.length,n=f([]).call(arguments,1,r-1),i=arguments[r-1];U.isObject(i)||(n.push(i),i={});var o,s=i.keyPath=i.keyPath||"id";return p(n).call(n,(function(e){U.isArray(e)||(e=[e]),p(e).call(e,(function(e){e&&(i.value=N(e,s),-1!==(o=U.findObjIndexInArray(t,i))&&v(t).call(t,o,1))}))})),t},U.sortObjArray=function(e,t){var r=(t=t||{}).sortPath||"id";P.insensitive=!!t.insensitive;var n,i,o,s=!!t.desc;return o=U.isFunction(t.compare)?t.compare:function(e,t){return n=N(e,r),i=N(t,r),s?P(i,n):P(n,i)},y(e).call(e,o)},U.emptyFunc=function(){},U.isEmptyFunc=function(e){return e===U.emptyFunc},U.notEmptyFunc=function(e){return e!==U.emptyFunc},U.splice=function(e,t,r){return v([]).call(e,t,r)},U.reshape2d=function(e,t){if(b(e)){U.verifyParamType("type",t,"number","util::reshape2d");var r=e.length;if(r<=t)return[e];for(var n=Math.ceil(r/t),i=[],o=0;o<n;o++)i.push(f(e).call(e,o*t,(o+1)*t));return i}return e},U.flatten2d=function(e){if(b(e)){var t=[];return p(e).call(e,(function(e){t=S(t).call(t,e)})),t}return e},U.dropArrayDuplicates=function(e){if(b(e)){for(var t={},r=[];e.length>0;)t[e.shift()]=!0;for(var n in t)!0===t[n]&&r.push(n);return r}return e},U.onError=function(e){throw new D(e)},U.verifyParamPresent=function(e,t,r,n){r=r||"";var i=!1;switch(U.typeOf(t)){case"undefined":case"null":i=!0;break;case"string":""===t&&(i=!0);break;case"StrStrMap":case"object":h(t).length||(i=!0);break;case"array":t.length?g(t).call(t,(function(e){if(U.notexist(e))return i=!0,!0})):i=!0}i&&U.onParamAbsent(r+e,n)},U.onParamAbsent=function(e,t){U.onParamError("缺少参数 ".concat(e,", 请确保参数不是 空字符串、空对象、空数组、null或undefined, 或数组的内容不是 null/undefined"),t)},U.verifyParamAbsent=function(e,t,r,n){r=r||"",void 0!==t&&U.onParamPresent(r+e,n)},U.onParamPresent=function(e,t){U.onParamError("多余的参数 ".concat(e),t)},U.verifyParamType=function(e,t,r,n){var i=U.typeOf(t).toLowerCase();U.isArray(r)||(r=[r]),r=T(r).call(r,(function(e){return e.toLowerCase()}));var o=!0;switch(-1===m(r).call(r,i)&&(o=!1),i){case"number":isNaN(t)&&(o=!1);break;case"string":"numeric or numeric string"===r.join("")&&(o=!!/^[0-9]+$/.test(t))}o||U.onParamInvalidType(e,r,"",n)},U.onParamInvalidType=function(e,t,r,n){r=r||"",t=U.isArray(t)?(t=T(t).call(t,(function(e){return'"'+e+'"'}))).join(", "):'"'+t+'"',U.onParamError('参数"'+r+e+'"类型错误, 合法的类型包括: ['+t+"]",n)},U.verifyParamValid=function(e,t,r,n){U.isArray(r)||(r=[r]),-1===m(r).call(r,t)&&U.onParamInvalidValue(e,r,n)},U.onParamInvalidValue=function(e,t,r){var n;U.isArray(t)||(t=[t]),t=T(t).call(t,(function(e){return'"'+e+'"'})),U.isArray(t)&&(t=t.join(", ")),U.onParamError(S(n="参数 ".concat(e,"值错误, 合法的值包括: [")).call(n,_(t),"]"),r)},U.verifyParamMin=function(e,t,r,n){t<r&&U.onParamError("参数"+e+"的值不能小于"+r,n)},U.verifyParamMax=function(e,t,r,n){t>r&&U.onParamError("参数"+e+"的值不能大于"+r,n)},U.verifyArrayMax=function(e,t,r,n){t.length>r&&U.onParamError("参数"+e+"的长度不能大于"+r,n)},U.verifyEmail=(j=/^\S+@\S+$/,function(e,t,r){j.test(t)||U.onParamError("参数"+e+"邮箱格式错误, 合法格式必须包含@符号, @符号前后至少要各有一个字符",r)}),U.verifyTel=function(){var e=/^[+\-()\d]+$/;return function(t,r,n){e.test(r)||U.onParamError("参数"+t+"电话号码格式错误, 合法字符包括+、-、英文括号和数字",n)}}(),U.verifyBirth=function(){var e=/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/;return function(t,r,n){e.test(r)||U.onParamError("参数"+t+'生日格式错误, 合法为"yyyy-MM-dd"',n)}}(),U.onParamError=function(e,t){U.onError({message:e,callFunc:t})},U.verifyOptions=function(e,t,r,n,i){if(e=e||{},t&&(U.isString(t)&&(t=t.split($)),U.isArray(t))){"boolean"!=typeof r&&(i=r||null,r=!0,n="");var o=r?U.verifyParamPresent:U.verifyParamAbsent;p(t).call(t,(function(t){o.call(U,t,e[t],n,i)}))}return e},U.verifyParamAtLeastPresentOne=function(e,t,r){t&&(U.isString(t)&&(t=t.split($)),U.isArray(t)&&(g(t).call(t,(function(t){return U.exist(e[t])}))||U.onParamError("以下参数["+t.join(", ")+"]至少需要传入一个",r)))},U.verifyParamPresentJustOne=function(e,t,r){t&&(U.isString(t)&&(t=t.split($)),U.isArray(t)&&1!==w(t).call(t,(function(t,r){return U.exist(e[r])&&t++,t}),0)&&U.onParamError("以下参数["+t.join(", ")+"]必须且只能传入一个",r))},U.verifyBooleanWithDefault=function(e,t,r,n,i){U.undef(r)&&(r=!0),$.test(t)&&(t=t.split($)),U.isArray(t)?p(t).call(t,(function(t){U.verifyBooleanWithDefault(e,t,r,n,i)})):void 0===e[t]?e[t]=r:U.isBoolean(e[t])||U.onParamInvalidType(t,"boolean",n,i)},U.verifyFileInput=function(e,t){var r;return U.verifyParamPresent("fileInput",e,"",t),U.isString(e)&&((e="undefined"==typeof document?void 0:document.getElementById(e))||U.onParamError("找不到要上传的文件对应的input, 请检查fileInput id ".concat(e),t)),e.tagName&&"input"===e.tagName.toLowerCase()&&"file"===e.type.toLowerCase()||U.onParamError(S(r="请提供正确的 fileInput, 必须为 file 类型的 input 节点 tagname:".concat(e.tagName,", filetype:")).call(r,e.type),t),e},U.verifyFileType=function(e,t){U.verifyParamValid("type",e,U.validFileTypes,t)},U.verifyCallback=function(e,t,r){$.test(t)&&(t=t.split($)),U.isArray(t)?p(t).call(t,(function(t){U.verifyCallback(e,t,r)})):e[t]?U.isFunction(e[t])||U.onParamInvalidType(t,"function","",r):e[t]=U.emptyFunc},U.verifyFileUploadCallback=function(e,t){U.verifyCallback(e,"uploadprogress uploaddone uploaderror uploadcancel",t)},U.validFileTypes=["image","audio","video","file"],U.validFileExts={image:["bmp","gif","jpg","jpeg","jng","png","webp"],audio:["mp3","wav","aac","wma","wmv","amr","mp2","flac","vorbis","ac3"],video:["mp4","rm","rmvb","wmv","avi","mpg","mpeg","mov"]},U.filterFiles=function(e,t){var r,n,i="file"===(t=t.toLowerCase()),o=[];return p([]).call(e,(function(e){var s,a;if(i)o.push(e);else if(r=f(s=e.name).call(s,M(a=e.name).call(a,".")+1),(n=e.type.split("/"))[0]&&n[1]){var c;(n[0].toLowerCase()===t||-1!==m(c=U.validFileExts[t]).call(c,r))&&o.push(e)}})),o};var B,V,H=U.supportFormData=U.notundef(F.FormData);U.getFileName=function(e){return e=U.verifyFileInput(e),H?e.files[0].name:f(t=e.value).call(t,M(r=e.value).call(r,"\\")+1);var t,r},U.getFileInfo=(B={ppt:1,pptx:2,pdf:3,doc:6,docx:7},function(e){var t={};if(!(e=U.verifyFileInput(e)).files)return t;var r=e.files[0];return H&&(t.name=r.name,t.size=r.size,t.type=r.name.match(/\.(\w+)$/),t.type=t.type&&t.type[1].toLowerCase(),t.transcodeType=B[t.type]||0),t}),U.sizeText=(V=["B","KB","MB","GB","TB","PB","EB","ZB","BB"],function(e){var t,r=0;do{t=(e=Math.floor(100*e)/100)+V[r],e/=1024,r++}while(e>1);return t}),U.promises2cmds=function(e){return T(e).call(e,(function(e){return e.cmd}))},U.objs2accounts=function(e){return T(e).call(e,(function(e){return e.account}))},U.teams2ids=function(e){return T(e).call(e,(function(e){return e.teamId}))},U.objs2ids=function(e){return T(e).call(e,(function(e){return e.id}))},U.getMaxUpdateTime=function(e){var t=T(e).call(e,(function(e){return+e.updateTime}));return Math.max.apply(Math,t)},U.genCheckUniqueFunc=function(e){return e=e||"id",function(t){this.uniqueSet=this.uniqueSet||{},this.uniqueSet[e]=this.uniqueSet[e]||{};var r=this.uniqueSet[e],n=t[e];return!r[n]&&(r[n]=!0,!0)}},U.fillPropertyWithDefault=function(e,t,r){return!!U.undef(e[t])&&(e[t]=r,!0)},U.throttle=function(e,t,r,n){var i,o,s=null,a=0;r||(r={});var c=function(){a=!1===r.leading?0:(new Date).getTime(),s=null,e.apply(i,o),s||(i=o=null)};return function(){var u=(new Date).getTime();a||!1!==r.leading||(a=u);var l=t-(u-a);return i=this,o=arguments,l<=0||l>t?(clearTimeout(s),s=null,a=u,e.apply(i,o),s||(i=o=null)):s||!1===r.trailing?s&&n&&n.apply(i,o):(s=x(c,l),n&&n.apply(i,o)),s}},U.get=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=e,o=I(t.replace(/\[(\d+)\]/g,".$1").split("."));try{for(o.s();!(r=o.n()).done;){var s=r.value;if(void 0===(i=Object(i)[s]))return n}}catch(e){o.e(e)}finally{o.f()}return i},U.pickAsString=function(e,t){var r;return e?T(r=E(t).call(t,(function(t){return void 0!==e[t]}))).call(r,(function(t){var r;return S(r="".concat(t,"=")).call(r,e[t])})).join(","):""},U.omitAsString=function(e,t){var r,n;if(!e)return"";var i={};return p(t).call(t,(function(e){i[e]=!0})),T(r=E(n=h(e)).call(n,(function(e){return!i[e]}))).call(r,(function(t){var r;return S(r="".concat(t,"=")).call(r,e[t])})).join(",")};var W={session:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?p(r=A(Object(i),!0)).call(r,(function(t){d(e,t,i[t])})):c?u(e,c(i)):p(n=A(Object(i))).call(n,(function(t){l(e,t,a(i,t))}))}return e}({},e),r=["topCustom","localCustom","extra"];return p(r).call(r,(function(e){t[e]&&(t[e]="***")})),t.lastMsg&&(t.lastMsg={idServer:t.lastMsg.idServer,idClient:t.lastMsg.idClient}),t}};U.secureOutput=function(e,t){b(t)||(t=[t]);var r=W[e];return 1===(t=T(t).call(t,(function(e){return r(e)}))).length?t[0]:t};var q={string:function(e,t,r){var n=r.required,i=r.allowEmpty,o=e[t];return!1===n&&void 0===o||"string"==typeof o&&!(!i&&""===o)},number:function(e,t,r){var n=r.required,i=r.min,o=e[t];return!1===n&&void 0===o||"number"==typeof o&&!(o<i)},enum:function(e,t,r){var n=r.required,i=C(r),o=e[t];return!1===n&&void 0===o||m(i).call(i,o)>-1},array:function(e,t,r){var n=r.required,i=e[t];return!1===n&&void 0===i||!!b(i)}};U.validate=function(e,t,r){var n,i={};return p(n=h(e)).call(n,(function(n){var o,s=e[n].type,a=q[s];a&&!a(t,n,e[n])?U.onError({message:S(o="Error in parameter verification, ".concat(n," expected value is ")).call(o,_(e[n])),callFunc:r}):i[n]=t[n]})),i},U.asyncPool=function(e,t,r){if("number"!=typeof e||"function"!=typeof r||!t||!t.length)return R.resolve();var n=0,i=[],o=[];return function s(){if(n===t.length)return R.resolve();var a=t[n++],c=R.resolve().then((function(){return r(a,t)}));i.push(c);var u=R.resolve();if(e<=t.length){var l=c.then((function(){return v(o).call(o,m(o).call(o,l),1)}));o.push(l),o.length>=e&&(u=R.race(o))}return u.then((function(){return s()}))}().then((function(){return R.all(i)}))},U.getIdArray=function(e){if(!e||"string"!=typeof e)throw new Error("id type error");var t=m(e).call(e,"-");if(t<0||t===e.length-1)throw new Error("id format error");return[f(e).call(e,0,t),f(e).call(e,t+1)]},e.exports=U},function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,r(48))},function(e,t,r){var n=r(1),i=r(53),o=r(7),s=r(21),a=r(65).f,c=r(157),u=r(12),l=r(68),d=r(45),p=r(25),m=function(e){var t=function(r,n,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,o)}return i(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,i,f,h,g,v,y,b,S=e.target,T=e.global,_=e.stat,w=e.proto,M=T?n:_?n[S]:(n[S]||{}).prototype,x=T?u:u[S]||d(u,S,{})[S],E=x.prototype;for(f in t)r=!c(T?f:S+(_?".":"#")+f,e.forced)&&M&&p(M,f),g=x[f],r&&(v=e.noTargetGet?(b=a(M,f))&&b.value:M[f]),h=r&&v?v:t[f],r&&typeof g==typeof h||(y=e.bind&&r?l(h,n):e.wrap&&r?m(h):w&&s(h)?o(h):h,(e.sham||h&&h.sham||g&&g.sham)&&d(y,"sham",!0),d(x,f,y),w&&(p(u,i=S+"Prototype")||d(u,i,{}),d(u[i],f,h),e.real&&E&&!E[f]&&d(E,f,h)))}},function(e,t,r){e.exports=r(280)},function(e,t,r){e.exports=r(202)},function(e,t,r){e.exports=r(415)},function(e,t,r){e.exports=r(154)},function(e,t,r){var n=r(83),i=Function.prototype,o=i.bind,s=i.call,a=n&&o.bind(s,s);e.exports=n?function(e){return e&&a(e)}:function(e){return e&&function(){return s.apply(e,arguments)}}},function(e,t,r){e.exports=r(351)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){e.exports=r(187)},function(e,t,r){e.exports=r(355)},function(e,t){e.exports={}},function(e,t,r){e.exports=r(234)},function(e,t,r){var n=r(6),i=r(13),o=!1;try{"function"==typeof localStorage.setItem&&"function"==typeof localStorage.getItem&&(localStorage.setItem("nim_localstorage_exist_test","1"),o="1"===localStorage.getItem("nim_localstorage_exist_test"),localStorage.removeItem("nim_localstorage_exist_test"))}catch(e){o=!1}var s={nodeEnv:"production",info:{hash:"548cf846168177774d699f96d7f855f4336577ba",shortHash:"548cf84",version:"9.8.0",sdkVersion:"90800",sdkHumanVersion:"9.8.0",protocolVersion:1},lbsUrl:"https://lbs.netease.im/lbs/webconf.jsp",roomserver:"roomserver.netease.im",connectTimeout:8e3,xhrTimeout:8e3,socketTimeout:8e3,reconnectionDelay:1600,reconnectionDelayMax:8e3,reconnectionJitter:.01,reconnectiontimer:null,heartbeatInterval:3e4,cmdTimeout:8e3,hbCmdTimeout:5e3,defaultReportUrl:"https://dr.netease.im/1.gif",isWeixinApp:!1,isNodejs:!1,isRN:!1,ipVersion:0,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,PushPermissionAsked:!1,iosPushConfig:null,androidPushConfig:null,netDetectAddr:"https://roomserver-dev.netease.im/v1/sdk/detect/local",optionDefaultLinkUrl:"",defaultLinkUrl:"weblink.netease.im",ipv6DefaultLinkUrl:"weblink.netease.im",optionIpv6DefaultLinkUrl:"",wxDefaultLinkUrl:"wlnimsc0.netease.im",serverNosConfig:o?{cdnDomain:localStorage.getItem("nim_cdn_domain")||"",objectPrefix:localStorage.getItem("nim_object_prefix")||""}:{},hasLocalStorage:o,getDefaultLinkUrl:function(e){var t,r;1===s.ipVersion?(t=s.optionIpv6DefaultLinkUrl,r=s.ipv6DefaultLinkUrl):(t=s.optionDefaultLinkUrl,r=s.defaultLinkUrl);var i=t||(s.isWeixinApp?s.wxDefaultLinkUrl:r);if(!i)return!1;var o=e?"https":"http",a=e?"443":"80",c=i;return-1===n(i).call(i,"http")&&(c=o+"://"+c),-1===n(i).call(i,":")&&(c=c+":"+a),c},ipProbeAddr:{ipv4:"https://detect4.netease.im/test/",ipv6:"https://detect6.netease.im/test/"},formatSocketUrl:function(e){var t=e.url,r=e.secure?"https":"http";return-1===n(t).call(t,"http")?r+"://"+t:t},uploadUrl:"https://nos.netease.com",chunkUploadUrl:"https://wanproxy-web.127.net",commonMaxSize:104857600,chunkSize:4194304,chunkMaxSize:4194304e4,replaceUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHost:"nos.netease.com",downloadHostList:["nos.netease.com"],downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",nosCdnEnable:!0,httpsEnabled:!1,threshold:0,nosLbsUrls:[],edgeList:["https://wanproxy-web.127.net","https://nosup-hz1.127.net"],genUploadUrl:function(e){return s.uploadUrl+"/"+e},genChunkUploadUrl:function(e){return s.chunkUploadUrl?s.chunkUploadUrl+"/"+e.bucket+"/"+e.objectName:""},genDownloadUrl:function(e,t,r){var n,o,a,c,u,l=e.bucket,d=e.expireSec,p=+new Date,m=d?"&survivalTime=".concat(d):"";if(r)return i(a=i(c=i(u="https://".concat(r,"/")).call(u,t,"?createTime=")).call(c,p)).call(a,m);var f=i(n=i(o="".concat(s.replaceUrl,"?createTime=")).call(o,p)).call(n,m);return(f=s.genNosProtocolUrl(f)).replace("{bucket}",l).replace("{object}",t)},genFileUrl:function(e){var t=e.bucket,r=e.objectName;return s.genNosProtocolUrl(s.replaceUrl).replace("{bucket}",t).replace("{object}",r)},genNosProtocolUrl:function(e){return/^http/.test(e)?s.httpsEnabled&&0!==n(e).call(e,"https://")&&(e=e.replace("http","https")):e=s.httpsEnabled?"https://".concat(e):"http://".concat(e),e}};e.exports=s},function(e,t,r){e.exports=r(238)},function(e,t,r){var n=r(7);e.exports=n({}.isPrototypeOf)},function(e,t,r){e.exports=r(186)},function(e,t,r){var n=r(1),i=r(123),o=r(25),s=r(125),a=r(121),c=r(155),u=i("wks"),l=n.Symbol,d=l&&l.for,p=c?l:l&&l.withoutSetter||s;e.exports=function(e){if(!o(u,e)||!a&&"string"!=typeof u[e]){var t="Symbol."+e;a&&o(l,e)?u[e]=l[e]:u[e]=c&&d?d(t):p(t)}return u[e]}},function(e,t,r){e.exports=r(369)},function(e,t,r){var n=r(12),i=r(25),o=r(135),s=r(41).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||s(t,e,{value:o.f(e)})}},function(e,t){e.exports=function(e){return"function"==typeof e}},function(e,t,r){var n=r(12);e.exports=function(e){return n[e+"Prototype"]}},function(e,t,r){e.exports=r(402)},function(e,t,r){var n=r(9);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){var n=r(7),i=r(33),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},function(e,t,r){e.exports=r(368)},function(e,t,r){var n=r(145),i=r(272);function o(t){return"function"==typeof n&&"symbol"==typeof i?(e.exports=o=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=o=function(e){return e&&"function"==typeof n&&e.constructor===n&&e!==n.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),o(t)}e.exports=o,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(21);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},function(e,t,r){var n=r(15),i=r(23),o=r(4),s=r(51),a=r(63),c=r(14),u=r(0),l=u.undef,d=r(218),p=r(113),m=r(118),f=r(505);function h(e){var t=this;u.verifyOptions(e,"appKey account token","protocol::IMProtocol"),u.verifyCallback(e,["onconnect","onerror","onwillreconnect","ondisconnect","onloginportschange","onmyinfo","onblacklist","onmutelist","onfriends","onusers","onrobots","onteams","onSuperTeams","onsessions","onSessionsWithMoreRoaming","onStickTopSessions","onroamingmsgs","onofflinemsgs","onofflinefiltermsgs","onroamingsysmsgs","onofflinesysmsgs","onofflinefiltersysmsgs","onofflinecustomsysmsgs","onofflinefiltercustomsysmsgs","onbroadcastmsg","onbroadcastmsgs","onsysmsgunread","onsyncdone","onteammembers","onsyncteammembersdone","onmsg","onsysmsg","oncustomsysmsg","onupdatemyinfo","onupdateuser","onSyncUpdateServerSession","onUpdateSuperTeamMember","onCreateSuperTeam","onUpdateSuperTeam","onAddSuperTeamMembers","onRemoveSuperTeamMembers","onUpdateSuperTeamManagers","onDismissSuperTeam","onTransferSuperTeam","onUpdateSuperTeamMembersMute","onupdateteammember","onCreateTeam","onUpdateTeam","onAddTeamMembers","onRemoveTeamMembers","onUpdateTeamManagers","onDismissTeam","onTransferTeam","onUpdateTeamMembersMute","onTeamMsgReceipt","onupdatesession","onQuickComment","onDeleteQuickComment","onPinMsgChange","onupdatesysmsgunread","onupdatesysmsg","onsynccreateteam","onsyncsupercreateteam","onsyncmarkinblacklist","onsyncmarkinmutelist","onsyncfriendaction","shouldIgnoreNotification","shouldIgnoreMsg","onDeleteMsgSelf","shouldCountNotifyUnread","onPushNotificationMultiportConfig","onPushNotificationMultiportConfigUpdate","onpushevents"],"protocol::IMProtocol"),t.db=e.api.db=new s({logger:e.logger,notifyError:function(e){t.notifyError&&t.notifyError("DB error",e)}}),a.call(t,e)}var g=a.fn,v=h.fn=h.prototype=n(g);v.init=function(){var e,t;g.init.call(this),p.IM.setProtocol(this),this.parser=p.IM,i(e=this.sendCmd).call(e,this),this.socketUrls=[],this.syncing=!0,this.hasSynced=!1,this.hasSyncedTeamMembers=!1,this.syncPromiseArray=[],this.syncResult={},this.syncTeamMembersPromiseArray=[],this.syncSuperTeamMembersPromiseArray=[],this.syncTeamMembersResult={},this.timetags={},this.superTeamMembersData={},this.saveAck={},this.sysMsgUnread=m.completeUnread({}),this.resetUnsettledMsgs(),this.resetUnsettledSysMsgs(),this.msgPromise=o.resolve(),this.sysMsgPromise=o.resolve(),this.msgDelayArr=[],this.msgDelayTimer=null,this.msgStatEnable=!1,this.nosCdnHostTimer=null,this.relativeServerTime=0,this.sessionSet={},this.msgReceiptTasks={},this.userSet={},this.pushNotificationMultiportConfig=d.getDefaultConfig(),this.msgAckBufferManager=new f({processFn:i(t=this.handleMsgsAck).call(t,this),throttleTime:500})},v.reset=function(){g.reset.call(this);var e=this.options;this.db.reset(e.db),l(e.lbsUrl)&&(e.lbsUrl=c.lbsUrl),l(e.thumbnailToStatic)&&(e.thumbnailToStatic=!0),this.autoconnect=!!e.autoconnect,this.resetAutoMarkRead()},v.resetAutoMarkRead=function(){var e=this.options;u.verifyBooleanWithDefault(e,"autoMarkRead",!0,"","protocol::resetAutoMarkRead")},v.resetUnsettledMsgs=function(){this.unhandledMsgs=[],this.unupdatedMsgs=[]},v.resetUnsettledSysMsgs=function(){this.unhandledSysMsgs=[],this.unupdatedSysMsgs=[]},v.packetFromSync=function(e){return!e.obj||!!e.obj.sync},e.exports=h,r(508),r(509),r(510),r(520),r(522),r(523),r(524),r(525),r(526),r(527),r(528),r(533),r(534),r(543),r(544),r(548),r(549),r(550),r(551),r(552),r(553)},function(e,t,r){e.exports=r(171)},function(e,t,r){var n=r(83),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},function(e,t,r){var n=r(15),i=r(52),o=r(29),s=r(14),a=r(554),c=r(113).IM;function u(e){return this.subType="im",this.nosScene=e.nosScene||"im",this.nosSurvivalTime=e.nosSurvivalTime,e.Protocol=o,e.Message=a,e.constructor=u,this.init(e)}u.Protocol=o,u.parser=c,u.use=i.use,u.getInstance=i.getInstance,u.rmAllInstances=i.rmAllInstances,u.genInstanceName=function(e){return"NIM-account-"+e.account};var l=u.fn=u.prototype=n(i.prototype);u.info=l.info=s.info,e.exports=u,r(565),r(566),r(567),r(568),r(569),r(570),r(571),r(572),r(573),r(574),r(583),r(584),r(585),r(586),r(587),r(588),r(589),r(590),r(591),r(594),r(595)},function(e,t,r){var n=r(1),i=r(84),o=n.Object;e.exports=function(e){return o(i(e))}},function(e,t,r){var n=r(1),i=r(28),o=n.String,s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not an object")}},function(e,t,r){var n=r(96),i=r(84);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(15),i=r(3),o=r(27);function s(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this;n.message=e||r.message||"","object"===o(t)?(n.event=t,n.code="Other_Error"):void 0!==t&&(n.code=t),n.timetag=+new Date,void 0!==r&&(n.event=r),n.event&&(n.callFunc=n.event.callFunc||null,delete n.event.callFunc)}s.prototype=n(Error.prototype),s.prototype.name="NIMError";var a={201:"客户端版本不对, 需升级sdk",302:"用户名或密码错误, 请检查appKey和token是否有效, account和token是否匹配",403:"非法操作或没有权限",404:"对象(用户/群/聊天室)不存在",405:"参数长度过长",408:"客户端请求超时",414:"参数错误",415:"服务不可用/没有聊天室服务器可分配",416:"频率控制",417:"重复操作",422:"帐号被禁用",500:"服务器内部错误",501:"数据库操作失败",503:"服务器繁忙",508:"删除有效期过了",509:"已失效",7101:"被拉黑",700:"批量操作部分失败",801:"群人数达到上限",802:"没有权限",803:"群不存在或未发生变化",804:"用户不在群里面",805:"群类型不匹配",806:"创建群数量达到限制",807:"群成员状态不对",809:"已经在群里",811:"强推列表中帐号数量超限",812:"群被禁言",813:"因群数量限制，部分拉人成功",814:"禁止使用群组消息已读服务",815:"群管理员人数上限",816:"批量操作部分失败",997:"协议已失效",998:"解包错误",999:"打包错误",9102:"通道失效",9103:"已经在其他端接听/拒绝过这通电话",11001:"对方离线, 通话不可送达",13002:"聊天室状态异常",13003:"在黑名单中",13004:"在禁言名单中",13006:"聊天室处于整体禁言状态,只有管理员能发言",Connect_Failed:"无法建立连接, 请确保能 ping/telnet 到云信服务器; 如果是IE8/9, 请确保项目部署在 HTTPS 环境下",Error_Internet_Disconnected:"网断了",Error_Connection_is_not_Established:"连接未建立",Error_Connection_Socket_State_not_Match:"socket状态不对",Error_Timeout:"超时",Param_Error:"参数错误",No_File_Selected:"请选择文件",Wrong_File_Type:"文件类型错误",File_Too_Large:"文件过大",Cross_Origin_Iframe:"不能获取跨域Iframe的内容",Not_Support:"不支持",NO_DB:"无数据库",DB:"数据库错误",Still_In_Team:"还在群里",Session_Exist:"会话已存在",Session_Not_Exist:"会话不存在",Error_Unknown:"未知错误",Operation_Canceled:"操作取消"},c=[200,406,808,810];i(c).call(c,(function(e){a[e]=null})),s.genError=function(e){var t=a[e];return void 0===t&&(t="操作失败"),null===t?null:new s(t,e)},s.multiInstance=function(e){return new s("不允许初始化多个实例","Not_Allow_Multi_Instance",e)},s.newNetworkError=function(e){var t="Error_Internet_Disconnected";return new s(a[t],t,e)},s.newConnectError=function(e){var t="Connect_Failed";return new s(a[t]||null,t,e)},s.newConnectionError=function(e){var t="Error_Connection_is_not_Established";return new s(a[t],t,e)},s.newSocketStateError=function(e){var t="Error_Connection_Socket_State_not_Match";return new s(a[t],t,e)},s.newTimeoutError=function(e){var t="Error_Timeout";return new s(a[t],t,e)},s.newFrequencyControlError=function(e){var t=new s(a[416],416,e);return t.from="local",t},s.newParamError=function(e,t){return new s(e||a.Param_Error,"Param_Error",t)},s.newNoFileError=function(e,t){var r="No_File_Selected";return new s(e||a[r],r,t)},s.newWrongFileTypeError=function(e,t){var r="Wrong_File_Type";return new s(e||a[r],r,t)},s.newFileTooLargeError=function(e,t){var r="File_Too_Large";return new s(e||a[r],r,t)},s.newCORSIframeError=function(e){var t="Cross_Origin_Iframe";return new s(a[t],t,e)},s.newSupportError=function(e,t,r){return new s("不支持"+e,"Not_Support_"+t,r)},s.newSupportDBError=function(e){return s.newSupportError("数据库","DB",e)},s.noDBError=function(e){return new s(a.NO_DB,"NO_DB",e)},s.newDBError=function(e){return new s(a.DB,"DB",e)},s.newUnknownError=function(e){var t="Error_Unknown";return new s(a[t],t,e)},s.stillInTeamError=function(e){var t="Still_In_Team";return new s(a[t],t,e)},s.sessionExist=function(e){var t="Session_Exist";return new s(a[t],t,e)},s.sessionNotExist=function(e){var t="Session_Not_Exist";return new s(a[t],t,e)},s.cancel=function(e){var t="Operation_Canceled";return new s(a[t],t,e)},s.customError=function(e,t){e=e||"Other_Error";var r="";return(t=t||{}).message||(r=a[e]||e),"object"!==o(e)?new s(r,e,t):new s(r,"Other_Error",void 0===t?e:t)},e.exports=s},function(e,t,r){var n=r(12),i=r(1),o=r(21),s=function(e){return o(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?s(n[e])||s(i[e]):n[e]&&n[e][t]||i[e]&&i[e][t]}},function(e,t,r){var n=r(233);e.exports=function(e){return n(e.length)}},function(e,t,r){var n=r(0),i={init:function(){i.deviceId=n.guid()}};i.init(),i.clientTypeMap={1:"Android",2:"iOS",4:"PC",8:"WindowsPhone",16:"Web",32:"Server",64:"Mac"},i.db={open:function(){}},i.rnfs=null,e.exports=i},function(e,t,r){var n=r(1),i=r(21),o=r(98),s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a function")}},function(e,t,r){var n=r(1),i=r(24),o=r(156),s=r(158),a=r(34),c=r(97),u=n.TypeError,l=Object.defineProperty,d=Object.getOwnPropertyDescriptor;t.f=i?s?function(e,t,r){if(a(e),t=c(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&"writable"in r&&!r.writable){var n=d(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return l(e,t,r)}:l:function(e,t,r){if(a(e),t=c(t),a(r),o)try{return l(e,t,r)}catch(e){}if("get"in r||"set"in r)throw u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=r(216)},function(e,t,r){var n=r(1),i=r(46),o=n.String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},function(e,t,r){var n=r(37);e.exports=n("navigator","userAgent")||""},function(e,t,r){var n=r(24),i=r(41),o=r(54);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(1),i=r(129),o=r(21),s=r(66),a=r(18)("toStringTag"),c=n.Object,u="Arguments"==s(function(){return arguments}());e.exports=i?s:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=c(e),a))?r:u?s(t):"Object"==(n=s(t))&&o(t.callee)?"Arguments":n}},function(e,t,r){(function(t){var n=r(94),i=r(95),o=r(75),s=r(30),a=r(57),c=r(58),u=r(59),l=r(60),d=r(49),p=r(207),m=r(61),f=r(27),h=r(17),g=r(26),v=r(6),y=r(110),b=r(11),S=r(3),T=r(10),_=r(109),w=r(8),M=r(19);function x(e,t){var r=T(e);if(a){var n=a(e);t&&(n=M(n).call(n,(function(t){return c(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?S(r=x(Object(i),!0)).call(r,(function(t){m(e,t,i[t])})):u?l(e,u(i)):S(n=x(Object(i))).call(n,(function(t){d(e,t,c(i,t))}))}return e}function C(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(s(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return R(e,t);var i=h(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?R(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,c=function(){};return{s:c,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,l=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){d=!0,u=e},f:function(){try{l||null==r.return||r.return()}finally{if(d)throw u}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(){return"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}}function A(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r}function I(e){return""+e.getFullYear()}function O(e){return A(e.getMonth()+1)}function P(e){return A(e.getDate())}function N(e){return A(e.getHours())}function D(e){return A(e.getMinutes())}function L(e){return A(e.getSeconds())}function j(e){return A(e.getMilliseconds(),3)}var U,F,$=(U=/yyyy|MM|dd|hh|mm|ss|SSS/g,F={yyyy:I,MM:O,dd:P,hh:N,mm:D,ss:L,SSS:j},function(e,t){return e=new Date(e),isNaN(+e)?"invalid date":(t=t||"yyyy-MM-dd").replace(U,(function(t){return F[t](e)}))});function B(e){var t;return h(t=Object.prototype.toString.call(e)).call(t,8,-1)}function V(e){return B(e).toLowerCase()}function H(e){return"string"===V(e)}function W(e){return"number"===V(e)}function q(e){return"array"===V(e)}function z(e){return"function"==typeof e}function G(e){return"date"===V(e)}function J(e){return null===e}function K(e){return null!==e}function Q(e){return void 0===e}function Y(e){return void 0!==e}function X(e){return Y(e)&&K(e)}function Z(e){return Q(e)||J(e)}function ee(e){return X(e)&&"object"===V(e)}var te=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},re=te,ne=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)},ie=ne;function oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2?arguments[2]:void 0;for(var n in e)e.hasOwnProperty(n)&&t.call(r,n,e[n])}function se(e,t){oe(t,(function(t,r){e[t]=r}))}var ae,ce=(ae=0,function(){return""+ae++});function ue(e){return H(e)&&0===v(e).call(e,"{")&&y(e).call(e,"}")===e.length-1}function le(e,t,r){if(!e)return"";var n=[];return oe(e,(function(e,t){z(t)||(G(t)?t=t.getTime():q(t)?t=t.join(","):ee(t)&&(t=b(t)),r&&(t=encodeURIComponent(t)),n.push(encodeURIComponent(e)+"="+t))})),n.join(t||",")}var de=function(){var e=/^([\w]+?:\/\/.*?(?=\/|$))/i;return function(t){return e.test(t||"")?RegExp.$1.toLowerCase():""}}();function pe(e){var t=k();return e.tagName&&"INPUT"===e.tagName.toUpperCase()||t.Blob&&e instanceof t.Blob}e.exports={o:{},emptyObj:{},f:function(){},emptyFunc:function(){},regBlank:/\s+/gi,regWhiteSpace:/\s+/gi,getGlobal:k,detectCSSFeature:function(e){var t=!1,r="Webkit Moz ms O".split(" ");if("undefined"!=typeof document){var n=document.createElement("div"),i=null;if(e=e.toLowerCase(),void 0!==n.style[e]&&(t=!0),!1===t){i=e.charAt(0).toUpperCase()+e.substr(1);for(var o=0;o<r.length;o++)if(void 0!==n.style[r[o]+i]){t=!0;break}}return t}},fix:A,getYearStr:I,getMonthStr:O,getDayStr:P,getHourStr:N,getMinuteStr:D,getSecondStr:L,getMillisecondStr:j,format:$,dateFromDateTimeLocal:function(e){return e=""+e,new Date(e.replace(/-/g,"/").replace("T"," "))},getClass:B,typeOf:V,isString:H,isNumber:W,isInt:function(e){return W(e)&&e%1==0},isBoolean:function(e){return"boolean"===V(e)},isArray:q,isFunction:z,isDate:G,isRegExp:function(e){return"regexp"===V(e)},isError:function(e){return"error"===V(e)},isnull:J,notnull:K,undef:Q,notundef:Y,exist:X,notexist:Z,isObject:ee,isEmpty:function(e){return Z(e)||(H(e)||q(e))&&0===e.length},containsNode:function(e,t){if(e===t)return!0;for(;t.parentNode;){if(t.parentNode===e)return!0;t=t.parentNode}return!1},calcHeight:function(e){var t=e.parentNode||("undefined"==typeof document?null:document.body);if(!t)return 0;(e=e.cloneNode(!0)).style.display="block",e.style.opacity=0,e.style.height="auto",t.appendChild(e);var r=e.offsetHeight;return t.removeChild(e),r},remove:function(e){e.parentNode&&e.parentNode.removeChild(e)},dataset:function(e,t,r){if(!X(r))return e.getAttribute("data-"+t);e.setAttribute("data-"+t,r)},addEventListener:te,on:re,removeEventListener:ne,off:ie,target:function(e){return e.target||e.srcElement},createIframe:function(e){if("undefined"!=typeof document){var t;if((e=e||{}).name)try{(t=document.createElement('<iframe name="'+e.name+'"></iframe>')).frameBorder=0}catch(r){(t=document.createElement("iframe")).name=e.name}else t=document.createElement("iframe");e.visible||(t.style.display="none"),z(e.onload)&&re(t,"load",(function r(n){t.src&&(e.multi||ie(t,"load",r),e.onload(n))})),(e.parent||document.body).appendChild(t);var r=e.src||"about:blank";return g((function(){t.src=r}),0),t}},html2node:function(e){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML=e;var r,n,i=[];if(t.children)for(r=0,n=t.children.length;r<n;r++)i.push(t.children[r]);else for(r=0,n=t.childNodes.length;r<n;r++){var o=t.childNodes[r];1===o.nodeType&&i.push(o)}return i.length>1?t:i[0]}},scrollTop:function(e){return"undefined"!=typeof document&&X(e)&&(document.documentElement.scrollTop=document.body.scrollTop=e),window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},forOwn:oe,mixin:se,uniqueID:ce,isJSON:ue,parseJSON:function e(t){try{ue(t)&&(t=JSON.parse(t)),ee(t)&&oe(t,(function(r,n){switch(V(n)){case"string":case"object":t[r]=e(n)}}))}catch(e){}return t},simpleClone:function(e){var t=[],r=b(e,(function(e,r){if("object"===f(r)&&null!==r){if(-1!==v(t).call(t,r))return;t.push(r)}return r}));return JSON.parse(r)},merge:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return S(r).call(r,(function(t){se(e,t)})),e},fillUndef:function(e,t){return oe(t,(function(t,r){Q(e[t])&&(e[t]=r)})),e},checkWithDefault:function(e,t,r){var n=e[t]||e[t.toLowerCase()];return Z(n)&&(n=r,e[t]=n),n},fetch:function(e,t){return oe(e,(function(r){X(t[r])&&(e[r]=t[r])})),e},string2object:function(){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r={};return S(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(t)).call(e,(function(e){var t=e.split("="),n=t.shift();n&&(r[decodeURIComponent(n)]=decodeURIComponent(t.join("=")))})),r},object2string:le,genUrlSep:function(e){return v(e).call(e,"?")<0?"?":"&"},object2query:function(e){return le(e,"&",!0)},url2origin:de,isFileInput:pe,getKeys:function(e,t){var r=T(e);return t&&_(r).call(r,(function(t,r){var n=pe(e[t]);return n===pe(e[r])?0:n?1:-1})),r},_get:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=e,o=C(t.replace(/\[(\d+)\]/g,".$1").split("."));try{for(o.s();!(r=o.n()).done;){var s=r.value;if(void 0===(i=Object(i)[s]))return n}}catch(e){o.e(e)}finally{o.f()}return i},getLastSeveralItems:function(e){for(var t=e.length,r=[],n=function(t){var n=e[t],i=w(n).call(n,(function(e){return E(E({},e),{},{flag:"sort_flag_".concat(t)})}));r.push.apply(r,p(i))},i=0;i<t;i++)n(i);_(r).call(r,(function(e,t){return e.startTime-t.startTime}));for(var o=[],s=function(e){var t;o[e]=w(t=M(r).call(r,(function(t){return t.flag==="sort_flag_".concat(e)}))).call(t,(function(e){return E(E({},e),{},{flag:void 0})}))},a=0;a<t;a++)s(a);return o}}}).call(this,r(48))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){e.exports=r(185)},function(e,t,r){e.exports=r(393)},function(e,t,r){var n=r(492);n.fn=n.prototype,e.exports=n,r(494),r(495),r(496),r(497),r(498),r(499),r(500),r(501),r(502),r(503),r(504)},function(e,t,r){var n=r(27),i=r(15),o=r(30),s=r(3),a=r(285),c=r(6),u=r(4),l=r(307),d=r(0),p=d.notundef,m=r(388),f=r(14);function h(){}var g={};h.getInstance=function(e){e=y(e),d.verifyOptions(e,"account","api::Base.getInstance");var t=this.genInstanceName(e),r=g[t];return r?h.updateInstance(r,e):r=g[t]=new this(e),r},h.updateInstance=function(e,t){e.setOptions(t),e.connect()};var v=h.fn=h.prototype=i(new l),y=function(e){return e.nosSurvivalTime?(d.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance"),d.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")):e.nosSurvivalTime=1/0,e};v.updatePrivateConf=function(e){if(e&&"object"===n(e.privateConf)){var t=e.privateConf;"string"==typeof t.lbs_web&&(e.lbsUrl=t.lbs_web),"boolean"==typeof t.link_ssl_web&&(e.secure=t.link_ssl_web),"boolean"==typeof t.https_enabled&&(e.httpsEnabled=t.https_enabled),e.uploadUrl=t.nos_uploader_web?t.nos_uploader_web:null,e.chunkUploadUrl=t.nos_uploader_web?t.nos_uploader_web:null,e.replaceUrl=t.nos_downloader?t.nos_downloader:null,e.downloadUrl=t.nos_accelerate?t.nos_accelerate:null,e.downloadHost=t.nos_accelerate_host?t.nos_accelerate_host:null,e.downloadHostList=t.nos_accelerate_host_list||[],e.downloadHost&&e.downloadHostList.push(e.downloadHost),e.nosCdnEnable=!1!==t.nos_cdn_enable,e.ntServerAddress=t.nt_server||null,e.kibanaServer=t.kibana_server,e.statisticServer=t.statistic_server,e.reportGlobalServer=t.report_global_server,e.ipVersion=t.ip_protocol_version,e.defaultLink=t.link_web||e.defaultLink,e.ipv6DefaultLink=t.link_ipv6_web||e.ipv6DefaultLink,"string"==typeof t.nos_lbs?e.nosLbsUrls=[t.nos_lbs]:e.nosLbsUrls=[],o(t.nos_edge_list)&&(e.edgeList=t.nos_edge_list)}return null===e.ntServerAddress||""===e.ntServerAddress?f.ntServerAddress=null:f.ntServerAddress=e.ntServerAddress||f.defaultReportUrl,f.uploadUrl=e.uploadUrl||f.uploadUrl,f.chunkUploadUrl=e.chunkUploadUrl||f.chunkUploadUrl,f.downloadUrl=e.downloadUrl||f.downloadUrl,f.downloadHost=e.downloadHost||f.downloadHost,f.downloadHostList=e.downloadHostList&&e.downloadHostList.length>0?e.downloadHostList:f.downloadHostList,f.nosCdnEnable=!1!==e.nosCdnEnable,f.replaceUrl=e.replaceUrl||f.replaceUrl,f.httpsEnabled=e.httpsEnabled||f.httpsEnabled,e.probe_ipv4_url&&(f.ipProbeAddr.ipv4=e.probe_ipv4_url),e.probe_ipv6_url&&(f.ipProbeAddr.ipv6=e.probe_ipv6_url),e},v.init=function(e){d.verifyOptions(e,"account","api::Base.init"),e=this.updatePrivateConf(e),d.verifyBooleanWithDefault(e,"exifOrientation",!0,"","api::Base.init"),e.lbsBackup=void 0===e.lbsBackup||e.lbsBackup;var t=this.account=e.account=e.account+"",r=e.constructor.genInstanceName(e),n=g[r];if(e._disableSingleton&&(n=null),n)return h.updateInstance(n,e),n;this.name=r,g[r]=this,this.logger=e.logger=new m({debug:e.debug,logFunc:e.logFunc,prefix:this.subType,dbLog:!1!==e.dbLog,account:e.account,expire:e.expire,logLevel:e.logLevel}),e.api=this;var i=this.protocol=new e.Protocol(e);return i.name="Protocol-"+r,i.account=t,i.api=this,i.message=this.message=new e.Message({account:t}),this.reporter=i.reporter,this.options=d.copy(e),this},v.destroy=function(e){var t=this,r=this;if(!r.__beginDestroy){var n;r.__beginDestroy=!0,e=e||{};var i,o=this.name;if(this.logger.warn("destroy::start"),!o)return this.logger&&this.logger.warn&&this.logger.warn("destroy::no instanceName"),void(r.__beginDestroy=void 0);this.protocol&&(n=this.protocol.connectTimer),this.protocol&&this.protocol.resetPush&&this.protocol.resetPush(),this.eventNames&&"function"==typeof this.eventNames&&s(i=this.eventNames()).call(i,(function(e){delete t._events[e]})),this.disconnect({done:function(t){var i,u;r.logger.warn("ApiBase::destroy: instance destroyed ..."),r.__beginDestroy=void 0,r.reporter.destroy(),s(i=a(r.options)).call(i,(function(e){0===c(e).call(e,"on")&&(r.options[e]=function(){},r.protocol.options[e]=function(){},r.protocol.api.options[e]=function(){})})),r.logger.setLogDisabled(),s(u=a(r)).call(u,(function(e){r[e]=void 0})),g&&(g[o]=null,clearTimeout(n)),e.done instanceof Function&&e.done(t)}})}},v.setOptions=function(e){this.protocol.setOptions(e)},v.processCallback=function(e,t){b(e,t)},v.processCallbackPromise=function(e,t){return new u((function(r,n){b(e,t,!0,r,n)}))};var b=function(e,t,r,n,i){var o="api::processCallback";r&&(o="api::processCallbackPromise"),d.verifyCallback(e,"done",o),e.callback=function(s,a,c){var u=e.callback.options;if(a=a||u,t&&(a=u),d.isFunction(e.cbaop)){var l=e.cbaop(s,a);p(l)&&(a=l)}var m=e.done;d.isObject(a)&&(delete a.done,delete a.cb,delete a.callback),r?s?i({message:"生成接口回调错误",callFunc:o,event:s}):n(a):m(s,a,c)},e.callback.options=d.copy(e)};v.processPs=function(e){d.notexist(e.ps)&&(e.ps=""),d.verifyArrayMax("ps",e.ps,5e3)},v.processCustom=function(e){d.notexist(e.custom)&&(e.custom="")},v.sendCmd=function(){this.protocol.sendCmd.apply(this.protocol,arguments)},v.sendCmdWithResp=function(e,t,r){this.sendCmd(e,t,(function(e,t,n){d.isFunction(r)&&(e?r(e,t):r(null,n))}))},v.cbAndSendCmd=function(e,t){var r=this.processCallbackPromise(t);return this.sendCmd(e,t),r},v.sendCmdUsePromise=function(e,t){var r=this;return new u((function(n,i){r.sendCmd(e,t,(function(e,t,r){if(e)i(e);else{var o=d.merge({},t,r);n(o)}}))}))},h.use=function(e,t){e&&e.install&&d.isFunction(e.install)&&e.install(this,t)},h.rmAllInstances=function(){for(var e in g)g[e].destroy();g={}},v.logout=function(e){e=e||{},this.protocol.shouldReconnect=!1,this.protocol.doLogout=!0,this.processCallback(e),this.sendCmd("logout",e,e.callback)},e.exports=h,r(400),r(401),r(438),r(439),r(449),r(453)},function(e,t,r){var n=r(83),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?s.bind(o):function(){return s.apply(o,arguments)})},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports=!0},function(e,t,r){r(73);var n=r(264),i=r(1),o=r(46),s=r(45),a=r(74),c=r(18)("toStringTag");for(var u in n){var l=i[u],d=l&&l.prototype;d&&o(d)!==c&&s(d,c,u),a[u]=a.Array}},function(e,t,r){e.exports=r(184)},function(e,t,r){e.exports=r(317)},function(e,t,r){e.exports=r(320)},function(e,t,r){e.exports=r(323)},function(e,t,r){var n=r(206);e.exports=function(e,t,r){return t in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){(function(t){var n=r(17),i=r(6),o=r(210),s=r(50),a=r(27),c=function(){var e="object"===(void 0===t?"undefined":a(t))?t:window,r=Math.pow(2,53)-1,c=/\bOpera/,u=Object.prototype,l=u.hasOwnProperty,d=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+n(e).call(e,1)}function m(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function f(e,t){for(var r in e)l.call(e,r)&&t(e[r],r,e)}function h(e){var t;return null==e?p(e):n(t=d.call(e)).call(t,8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function v(e,t){var n=null;return function(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=r)for(;++n<i;)t(e[n],n);else f(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function y(e){return String(e).replace(/^ +| +$/g,"")}return function t(r){var u=e,l=r&&"object"===a(r)&&"String"!=h(r);l&&(u=r,r=null);var p=u.navigator||{},b=p.userAgent||"";r||(r=b);var S,T,_,w,M,x,E,C=l?!!p.likeChrome:/\bChrome\b/.test(r)&&!/internal|\n/i.test(d.toString()),R=l?"Object":"ScriptBridgingProxyObject",k=l?"Object":"Environment",A=l&&u.java?"JavaPackage":h(u.java),I=l?"Object":"RuntimeObject",O=/\bJava/.test(A)&&u.java,P=O&&h(u.environment)==k,N=O?"a":"α",D=O?"b":"β",L=u.document||{},j=u.operamini||u.opera,U=c.test(U=l&&j?j["[[Class]]"]:h(j))?U:j=null,F=r,$=[],B=null,V=r==b,H=V&&j&&"function"==typeof j.version&&j.version(),W=v([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,t){return e||RegExp("\\b"+(t.pattern||g(t))+"\\b","i").exec(r)&&(t.label||t)})),q=v(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],(function(e,t){return e||RegExp("\\b"+(t.pattern||g(t))+"\\b","i").exec(r)&&(t.label||t)})),z=K([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),G=v({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},(function(e,t,n){return e||(t[z]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(z)]||RegExp("\\b"+g(n)+"(?:\\b|\\w*\\d)","i").exec(r))&&n})),J=v(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],(function(e,t){var n=t.pattern||g(t);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(r))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),m(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,t.label||t)),e}));function K(e){return v(e,(function(e,t){var n=t.pattern||g(t);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(r)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(r)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(r))&&((e=String(t.label&&!RegExp(n,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=m(e[0].replace(RegExp(n,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}if(W&&(W=[W]),G&&!z&&(z=K([G])),(S=/\bGoogle TV\b/.exec(z))&&(z=S[0]),/\bSimulator\b/i.test(r)&&(z=(z?z+" ":"")+"Simulator"),"Opera Mini"==q&&/\bOPiOS\b/.test(r)&&$.push("running in Turbo/Uncompressed mode"),"IE"==q&&/\blike iPhone OS\b/.test(r)?(G=(S=t(r.replace(/like iPhone OS/,""))).manufacturer,z=S.product):/^iP/.test(z)?(q||(q="Safari"),J="iOS"+((S=/ OS ([\d_]+)/i.exec(r))?" "+S[1].replace(/_/g,"."):"")):"Konqueror"!=q||/buntu/i.test(J)?G&&"Google"!=G&&(/Chrome/.test(q)&&!/\bMobile Safari\b/i.test(r)||/\bVita\b/.test(z))||/\bAndroid\b/.test(J)&&/^Chrome/.test(q)&&/\bVersion\//i.test(r)?(q="Android Browser",J=/\bAndroid\b/.test(J)?J:"Android"):"Silk"==q?(/\bMobi/i.test(r)||(J="Android",$.unshift("desktop mode")),/Accelerated *= *true/i.test(r)&&$.unshift("accelerated")):"PaleMoon"==q&&(S=/\bFirefox\/([\d.]+)\b/.exec(r))?$.push("identifying as Firefox "+S[1]):"Firefox"==q&&(S=/\b(Mobile|Tablet|TV)\b/i.exec(r))?(J||(J="Firefox OS"),z||(z=S[1])):!q||(S=!/\bMinefield\b/i.test(r)&&/\b(?:Firefox|Safari)\b/.exec(q))?(q&&!z&&/[\/,]|^[^(]+?\)/.test(n(r).call(r,i(r).call(r,S+"/")+8))&&(q=null),(S=z||G||J)&&(z||G||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(J))&&(q=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(J)?J:S)+" Browser")):"Electron"==q&&(S=(/\bChrome\/([\d.]+)\b/.exec(r)||0)[1])&&$.push("Chromium "+S):J="Kubuntu",H||(H=v(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version","HeadlessChrome",g(q),"(?:Firefox|Minefield|NetFront)"],(function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(r)||0)[1]||null}))),(S=("iCab"==W&&o(H)>3?"WebKit":/\bOpera\b/.test(q)&&(/\bOPR\b/.test(r)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(r)&&!/^(?:Trident|EdgeHTML)$/.test(W)&&"WebKit"||!W&&/\bMSIE\b/i.test(r)&&("Mac OS"==J?"Tasman":"Trident")||"WebKit"==W&&/\bPlayStation\b(?! Vita\b)/i.test(q)&&"NetFront")&&(W=[S]),"IE"==q&&(S=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(r)||0)[1])?(q+=" Mobile",J="Windows Phone "+(/\+$/.test(S)?S:S+".x"),$.unshift("desktop mode")):/\bWPDesktop\b/i.test(r)?(q="IE Mobile",J="Windows Phone 8.x",$.unshift("desktop mode"),H||(H=(/\brv:([\d.]+)/.exec(r)||0)[1])):"IE"!=q&&"Trident"==W&&(S=/\brv:([\d.]+)/.exec(r))&&(q&&$.push("identifying as "+q+(H?" "+H:"")),q="IE",H=S[1]),V){if(w="global",M=null!=(_=u)?a(_[w]):"number",/^(?:boolean|number|string|undefined)$/.test(M)||"object"==M&&!_[w])h(S=u.runtime)==R?(q="Adobe AIR",J=S.flash.system.Capabilities.os):h(S=u.phantom)==I?(q="PhantomJS",H=(S=S.version||null)&&S.major+"."+S.minor+"."+S.patch):"number"==typeof L.documentMode&&(S=/\bTrident\/(\d+)/i.exec(r))?(H=[H,L.documentMode],(S=+S[1]+4)!=H[1]&&($.push("IE "+H[1]+" mode"),W&&(W[1]=""),H[1]=S),H="IE"==q?String(H[1].toFixed(1)):H[0]):"number"==typeof L.documentMode&&/^(?:Chrome|Firefox)\b/.test(q)&&($.push("masking as "+q+" "+H),q="IE",H="11.0",W=["Trident"],J="Windows");else if(O&&(F=(S=O.lang.System).getProperty("os.arch"),J=J||S.getProperty("os.name")+" "+S.getProperty("os.version")),P){try{H=u.require("ringo/engine").version.join("."),q="RingoJS"}catch(e){(S=u.system)&&S.global.system==u.system&&(q="Narwhal",J||(J=S[0].os||null))}q||(q="Rhino")}else"object"===a(u.process)&&!u.process.browser&&(S=u.process)&&("object"===a(S.versions)&&("string"==typeof S.versions.electron?($.push("Node "+S.versions.node),q="Electron",H=S.versions.electron):"string"==typeof S.versions.nw&&($.push("Chromium "+H,"Node "+S.versions.node),q="NW.js",H=S.versions.nw)),q||(q="Node.js",F=S.arch,J=S.platform,H=(H=/[\d.]+/.exec(S.version))?H[0]:null));J=J&&m(J)}if(H&&(S=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(H)||/(?:alpha|beta)(?: ?\d)?/i.exec(r+";"+(V&&p.appMinorVersion))||/\bMinefield\b/i.test(r)&&"a")&&(B=/b/i.test(S)?"beta":"alpha",H=H.replace(RegExp(S+"\\+?$"),"")+("beta"==B?D:N)+(/\d+\+?/.exec(S)||"")),"Fennec"==q||"Firefox"==q&&/\b(?:Android|Firefox OS)\b/.test(J))q="Firefox Mobile";else if("Maxthon"==q&&H)H=H.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(z))"Xbox 360"==z&&(J=null),"Xbox 360"==z&&/\bIEMobile\b/.test(r)&&$.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(q)&&(!q||z||/Browser|Mobi/.test(q))||"Windows CE"!=J&&!/Mobi/i.test(r))if("IE"==q&&V)try{null===u.external&&$.unshift("platform preview")}catch(e){$.unshift("embedded")}else(/\bBlackBerry\b/.test(z)||/\bBB10\b/.test(r))&&(S=(RegExp(z.replace(/ +/g," *")+"/([.\\d]+)","i").exec(r)||0)[1]||H)?(J=((S=[S,/BB10/.test(r)])[1]?(z=null,G="BlackBerry"):"Device Software")+" "+S[0],H=null):this!=f&&"Wii"!=z&&(V&&j||/Opera/.test(q)&&/\b(?:MSIE|Firefox)\b/i.test(r)||"Firefox"==q&&/\bOS X (?:\d+\.){2,}/.test(J)||"IE"==q&&(J&&!/^Win/.test(J)&&H>5.5||/\bWindows XP\b/.test(J)&&H>8||8==H&&!/\bTrident\b/.test(r)))&&!c.test(S=t.call(f,r.replace(c,"")+";"))&&S.name&&(S="ing as "+S.name+((S=S.version)?" "+S:""),c.test(q)?(/\bIE\b/.test(S)&&"Mac OS"==J&&(J=null),S="identify"+S):(S="mask"+S,q=U?m(U.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(S)&&(J=null),V||(H=null)),W=["Presto"],$.push(S));else q+=" Mobile";(S=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(r)||0)[1])&&(S=[o(S.replace(/\.(\d)$/,".0$1")),S],"Safari"==q&&"+"==n(x=S[1]).call(x,-1)?(q="WebKit Nightly",B="alpha",H=n(E=S[1]).call(E,0,-1)):H!=S[1]&&H!=(S[2]=(/\bSafari\/([\d.]+\+?)/i.exec(r)||0)[1])||(H=null),S[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(r)||0)[1],537.36==S[0]&&537.36==S[2]&&o(S[1])>=28&&"WebKit"==W&&(W=["Blink"]),V&&(C||S[1])?(W&&(W[1]="like Chrome"),S=S[1]||((S=S[0])<530?1:S<532?2:S<532.05?3:S<533?4:S<534.03?5:S<534.07?6:S<534.1?7:S<534.13?8:S<534.16?9:S<534.24?10:S<534.3?11:S<535.01?12:S<535.02?"13+":S<535.07?15:S<535.11?16:S<535.19?17:S<536.05?18:S<536.1?19:S<537.01?20:S<537.11?"21+":S<537.13?23:S<537.18?24:S<537.24?25:S<537.36?26:"Blink"!=W?"27":"28")):(W&&(W[1]="like Safari"),S=(S=S[0])<400?1:S<500?2:S<526?3:S<533?4:S<534?"4+":S<535?5:S<537?6:S<538?7:S<601?8:"8"),W&&(W[1]+=" "+(S+="number"==typeof S?".x":/[.+]/.test(S)?"":"+")),"Safari"==q&&(!H||s(H)>45)&&(H=S));"Opera"==q&&(S=/\bzbov|zvav$/.exec(J))?(q+=" ",$.unshift("desktop mode"),"zvav"==S?(q+="Mini",H=null):q+="Mobile",J=J.replace(RegExp(" *"+S+"$"),"")):"Safari"==q&&/\bChrome\b/.exec(W&&W[1])&&($.unshift("desktop mode"),q="Chrome Mobile",H=null,/\bOS X\b/.test(J)?(G="Apple",J="iOS 4.3+"):J=null),H&&0==i(H).call(H,S=/[\d.]+$/.exec(J))&&i(r).call(r,"/"+S+"-")>-1&&(J=y(J.replace(S,""))),W&&!/\b(?:Avant|Nook)\b/.test(q)&&(/Browser|Lunascape|Maxthon/.test(q)||"Safari"!=q&&/^iOS/.test(J)&&/\bSafari\b/.test(W[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(q)&&W[1])&&(S=W[W.length-1])&&$.push(S),$.length&&($=["("+$.join("; ")+")"]),G&&z&&i(z).call(z,G)<0&&$.push("on "+G),z&&$.push((/^on /.test($[$.length-1])?"":"on ")+z),J&&(S=/ ([\d.+]+)$/.exec(J),T=S&&"/"==J.charAt(J.length-S[0].length-1),J={architecture:32,family:S&&!T?J.replace(S[0],""):J,version:S?S[1]:null,toString:function(){var e=this.version;return this.family+(e&&!T?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(S=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(F))&&!/\bi686\b/i.test(F)?(J&&(J.architecture=64,J.family=J.family.replace(RegExp(" *"+S),"")),q&&(/\bWOW64\b/i.test(r)||V&&/\w(?:86|32)$/.test(p.cpuClass||p.platform)&&!/\bWin64; x64\b/i.test(r))&&$.unshift("32-bit")):J&&/^OS X/.test(J.family)&&"Chrome"==q&&o(H)>=39&&(J.architecture=64),r||(r=null);var Q={};return Q.description=r,Q.layout=W&&W[0],Q.manufacturer=G,Q.name=q,Q.prerelease=B,Q.product=z,Q.ua=r,Q.version=q&&H,Q.os=J||{architecture:null,family:null,version:null,toString:function(){return"null"}},Q.parse=t,Q.toString=function(){return this.description||""},Q.version&&$.unshift(H),Q.name&&$.unshift(q),J&&q&&(J!=String(J).split(" ")[0]||J!=q.split(" ")[0]&&!z)&&$.push(z?"("+J+")":"on "+J),$.length&&(Q.description=$.join(" ")),Q}()}();e.exports=c}).call(this,r(48))},function(e,t,r){var n=r(77),i=r(30),o=r(10),s=r(6),a=r(76),c=r(3),u=r(11),l=r(26),d=r(79),p=r(13),m=r(23),f=r(0),h=r(14),g=r(36);function v(e){f.undef(e.secure)&&(e.secure=!0),this.options=f.copy(e),this.keepNosSafeUrl=this.options.keepNosSafeUrl||!1;var t=e.defaultLink||e.defaultLinkUrl;f.notundef(t)&&f.isString(t)&&(h.optionDefaultLinkUrl=n(t).call(t)),f.notundef(e.ipv6DefaultLink)&&f.isString(e.ipv6DefaultLink)&&(h.optionIpv6DefaultLinkUrl=e.ipv6DefaultLink),"number"==typeof e.heartbeatInterval&&(h.heartbeatInterval=e.heartbeatInterval),i(e.nosLbsUrls)&&(h.nosLbsUrls=e.nosLbsUrls),this.init(),this.connect()}var y=v.fn=v.prototype;y.init=function(){this.logger=this.options.logger,this.getNosOriginUrlReqNum=0,this.checkNosReqNum=0,this.cmdTaskArray=[],this.timerMap={},this.cmdCallbackMap={},this.cmdContentMap={},this.initConnect(),this.reset()},y.reset=function(){this.resetConnect()},y.setOptions=function(e){var t=this.options,r=o(t),n=s(r).call(r,"account");f.verifyCallback(e,["onconnect","onerror","onwillreconnect","ondisconnect","onloginportschange","onmyinfo","onblacklist","onmutelist","onfriends","onusers","onrobots","onteams","onSuperTeams","onsessions","onSessionsWithMoreRoaming","onStickTopSessions","onroamingmsgs","onofflinemsgs","onofflinefiltermsgs","onroamingsysmsgs","onofflinesysmsgs","onofflinefiltersysmsgs","onofflinecustomsysmsgs","onofflinefiltercustomsysmsgs","onbroadcastmsg","onbroadcastmsgs","onsysmsgunread","onsyncdone","onteammembers","onsyncteammembersdone","onmsg","onsysmsg","oncustomsysmsg","onupdatemyinfo","onupdateuser","onSyncUpdateServerSession","onUpdateSuperTeamMember","onCreateSuperTeam","onUpdateSuperTeam","onAddSuperTeamMembers","onRemoveSuperTeamMembers","onUpdateSuperTeamManagers","onDismissSuperTeam","onTransferSuperTeam","onUpdateSuperTeamMembersMute","onupdateteammember","onCreateTeam","onUpdateTeam","onAddTeamMembers","onRemoveTeamMembers","onUpdateTeamManagers","onDismissTeam","onTransferTeam","onUpdateTeamMembersMute","onTeamMsgReceipt","onupdatesession","onQuickComment","onDeleteQuickComment","onPinMsgChange","onupdatesysmsgunread","onupdatesysmsg","onsynccreateteam","onsyncsupercreateteam","onsyncmarkinblacklist","onsyncmarkinmutelist","onsyncfriendaction","shouldIgnoreNotification","shouldIgnoreMsg","onDeleteMsgSelf","shouldCountNotifyUnread","onPushNotificationMultiportConfig","onPushNotificationMultiportConfigUpdate","onpushevents"],"protocol::IMProtocol"),this.logger.info("setOptions::",f.omitAsString(e,["appKey","token","loginExt","customTag"])),-1!==n&&a(r).call(r,n,1),e=f.filterObj(e,r),this.options=f.merge(t,e),this.reset()},y.sendCmd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=this;n.heartbeat();var i,s=e,a=(e=n.parser.createCmd(e,t)).SER;t=t||{},n.cmdContentMap[a]=t,t.single&&(delete t.single,1===(i=o(t)).length&&(n.cmdContentMap[a]=t[i[0]])),t.NOTSTORE&&(i=t.NOTSTORE.split(" "),c(i).call(i,(function(e){delete t[e]})),delete t.NOTSTORE),(r=r||t.callback)&&(n.cmdCallbackMap[a]=r),n.cmdTaskArray.push({cmdName:s,cmd:u(e)}),n.startCmdTaskTimer()},y.startCmdTaskTimer=function(){var e=this;e.cmdTaskTimer||(e.cmdTaskTimer=l((function(){var t=e.cmdTaskArray.shift();e.cmdTaskTimer=null,t&&e.executeCmdTask(t),e.cmdTaskArray.length&&e.startCmdTaskTimer()}),0))},y.executeCmdTask=function(e){var t=e.cmdName,r=e.cmd,n=(r=JSON.parse(r)).SER;this.isFrequencyControlled(t)?(this.logger.warn("protocol::executeCmdTask: ".concat(t," hit freq control")),this.markCallbackInvalid(n,g.newFrequencyControlError({callFunc:"protocol::executeCmdTask",message:"".concat(t," hit freq control")}))):this.hasLogin?("heartbeat"!==t&&(this.logger.debugEnable?this.logger.debug("protocol::sendCmd: ".concat(e.cmd)):this.logger.info("protocol::sendCmd: ".concat(t))),this.doSendCmd(r)):"login"===t&&this.isConnected()?(this.createLoginTime=d(),this.logger.debugEnable?this.logger.debug("protocol::sendCmd: ".concat(e.cmd)):this.logger.info("protocol::sendCmd: ".concat(t)),this.doSendCmd(r)):(this.logger.warn("protocol::executeCmdTask: ".concat(t," not connected or login")),this.markCallbackInvalid(n,g.newSocketStateError({callFunc:"protocol::executeCmdTask",message:"".concat(t," not connected or not login")})))},y.isFrequencyControlled=function(e){var t=this.frequencyControlMap&&this.frequencyControlMap[e];if(t){if(d()<t.from+t.duration)return!0;delete this.frequencyControlMap[e]}},y.doSendCmd=function(e){var t=this,r=e.SER,n=0===r?h.hbCmdTimeout:h.cmdTimeout;function i(){t.markCallbackInvalid(r,g.newSocketStateError({callFunc:"protocol::doSendCmd",message:"ser ".concat(r," socketSendJson Error")})),t.onDisconnect("protocol::doSendCmd:socketSendJson")}t.timerMap[r]=l((function(){t.markCallbackInvalid(r,g.newTimeoutError({callFunc:"protocol::doSendCmd",message:"ser ".concat(r," Timeout Error")}))}),n);try{t.socket&&t.socket.send?t.socket.send(u(e)):i()}catch(e){i()}},y.getObjWithSer=function(e){var t=this.cmdContentMap[e];return t&&!t.isImSyncDataObj&&delete this.cmdContentMap[e],t&&f.copy(t)},y.getCallbackWithSer=function(e){var t=this.cmdCallbackMap[e];return t&&!t.isImSyncDataCb&&delete this.cmdCallbackMap[e],t},y.getTimerWithSer=function(e){var t=this.timerMap[e];return delete this.timerMap[e],t},y.clearTimerWithSer=function(e){var t=this.getTimerWithSer(e);t&&clearTimeout(t)},y.markCallbackInvalid=function(e,t){this.getObjWithSer(e),this.clearTimerWithSer(e);var r=this.getCallbackWithSer(e);if(r){var n=r.options;l((function(){r(t||g.newUnknownError({ser:e}),n)}),0)}},y.markAllCallbackInvalid=function(e){var t,r=this;c(t=o(this.cmdCallbackMap)).call(t,(function(t){r.markCallbackInvalid(t,e)})),r.cmdTaskArray=[]},y.getPacketObj=function(e){var t=null;if(e&&e.raw){var r=e.raw.ser;f.notundef(r)&&(t=this.getObjWithSer(r))}return t},y.callPacketAckCallback=function(e){var t=this;if(e&&e.raw){var r=e.raw.ser;if(f.notundef(r)){t.clearTimerWithSer(r);var n,i=t.getCallbackWithSer(r);if(i)i.originUrl&&e.obj&&e.obj.file&&(e.obj.file._url_safe=e.obj.file.url,e.obj.file.url=i.originUrl,"audio"===e.obj.type&&(e.obj.file.mp3Url=i.originUrl+(~s(n=i.originUrl).call(n,"?")?"&":"?")+"audioTrans&type=mp3")),e.promise?e.promise.then((function(){i(e.error,e.obj)}),(function(n){var o;n.callFunc="protocol::callPacketAckCallback",n.message=p(o="Resp Promoise Error: cmd: ".concat(e.cmd,", ser: ")).call(o,r);var s=g.customError("CALLBACK_ACK_ERR",n);t.logger.error("protocol::callPacketAckCallback: promise error ".concat(u(n))),i(s,e.obj,e.content)})):i(e.error,e.obj,e.content)}}},y.onMessage=function(e){var t=this;t.heartbeat(),t.parser.parseResponse(e).then((function(e){if(e.notFound&&t.logger.warn("protocol::onMessage: packet not found ".concat(u(e))),e.error){var r,n;e.error.message=p(r="".concat(e.cmd," error: ")).call(r,e.error.message),t.logger.error(p(n="protocol::onMessage: packet error ".concat(u(e.error),"，raw cmd ")).call(n,e.rawStr));var i=e.raw||{};408!==i.code&&415!==i.code&&500!==i.code||t.reporter.report("nimErrEvent",{code:i.code,module:e.cmd,accid:t.account})}e.frequencyControlDuration&&(t.logger.error("protocol::onMessage: server freq control ".concat(u(e.cmd))),t.frequencyControlMap=t.frequencyControlMap||{},t.frequencyControlMap[e.cmd]={from:+new Date,duration:e.frequencyControlDuration}),e.obj=t.getPacketObj(e),"heartbeat"!==e.cmd&&(t.logger.debugEnable?t.logger.debug("protocol::recvCmd: ".concat(e.rawStr)):t.logger.log("protocol::recvCmd: ".concat(e.cmd))),e.__receiveTime=d();var o="process"+f.capFirstLetter(e.service);if(t[o])if("syncDone"===e.cmd){if(t.cmdCallbackMap[e.raw.ser]&&t.cmdCallbackMap[e.raw.ser].isImSyncDataCb){var s;t.cmdCallbackMap[e.raw.ser].isImSyncDataCb=!1;var a=m(s=function(e,t){this.checkNosReqNum++,this.getNosOriginUrlReqNum<=0||this.checkNosReqNum>=20?this[e](t):l(a,300)}).call(s,t,o,e);l((function(){a.call(t,o,e)}),10)}}else t[o](e);else t.logger.warn("protocol::onMessage: ".concat(o," not found"));t.callPacketAckCallback(e)}))},y.onMiscError=function(e,t,r){t&&this.notifyError(e,t,r)},y.onCustomError=function(e,t){var r=g.customError(e,t),n=t.message||"未知错误";this.onMiscError(n,r)},y.notifyError=function(e,t,r){var n;this.isConnected()&&(this.logger.error(p(n="".concat(e||""," ")).call(n,this.name),t,r),this.options.onerror(t,r))},y.emitAPI=function(e){var t=e.type,r=e.obj;this.api.emit(t,r)},e.exports=v,r(457),r(462),r(463),r(464),r(465)},,function(e,t,r){var n=r(24),i=r(31),o=r(114),s=r(54),a=r(35),c=r(97),u=r(25),l=r(156),d=Object.getOwnPropertyDescriptor;t.f=n?d:function(e,t){if(e=a(e),t=c(t),l)try{return d(e,t)}catch(e){}if(u(e,t))return s(!i(o.f,e,t),e[t])}},function(e,t,r){var n=r(7),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},function(e,t,r){var n,i,o=r(1),s=r(44),a=o.process,c=o.Deno,u=a&&a.versions||c&&c.version,l=u&&u.v8;l&&(i=(n=l.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},function(e,t,r){var n=r(7),i=r(40),o=r(83),s=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(9);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){return 1},1)}))}},function(e,t,r){var n=r(66);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(97),i=r(41),o=r(54);e.exports=function(e,t,r){var s=n(t);s in e?i.f(e,s,o(0,r)):e[s]=r}},function(e,t,r){var n=r(45);e.exports=function(e,t,r,i){i&&i.enumerable?e[t]=r:n(e,t,r)}},function(e,t,r){var n=r(35),i=r(146),o=r(74),s=r(103),a=r(41).f,c=r(167),u=r(55),l=r(24),d=s.set,p=s.getterFor("Array Iterator");e.exports=c(Array,"Array",(function(e,t){d(this,{type:"Array Iterator",target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");var m=o.Arguments=o.Array;if(i("keys"),i("values"),i("entries"),!u&&l&&"values"!==m.name)try{a(m,"name",{value:"values"})}catch(e){}},function(e,t){e.exports={}},function(e,t,r){e.exports=r(312)},function(e,t,r){e.exports=r(339)},function(e,t,r){e.exports=r(407)},function(e,t,r){var n=r(68),i=r(7),o=r(96),s=r(33),a=r(38),c=r(128),u=i([].push),l=function(e){var t=1==e,r=2==e,i=3==e,l=4==e,d=6==e,p=7==e,m=5==e||d;return function(f,h,g,v){for(var y,b,S=s(f),T=o(S),_=n(h,g),w=a(T),M=0,x=v||c,E=t?x(f,w):r||p?x(f,0):void 0;w>M;M++)if((m||M in T)&&(b=_(y=T[M],M,S),e))if(t)E[M]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return M;case 2:u(E,y)}else switch(e){case 4:return!1;case 7:u(E,y)}return d?-1:i||l?l:E}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},function(e,t,r){e.exports=r(412)},function(e,t,r){var n=r(27),i=r(10),o=r(11),s=r(19),a=r(3),c=r(17),u=r(0),l=u.undef,d=u.notundef,p=u.exist,m=r(141),f=r(199),h={p2p:0,team:1,superTeam:5},g={0:"p2p",1:"team",5:"superTeam"},v=i(h),y=f.typeMap,b=f.validTypes;function S(e){u.verifyOptions(e,"scene to type","msg::Message"),u.verifyParamValid("scene",e.scene,v,"msg::Message"),this.scene=h[e.scene],this.to=""+e.to,this.type=y[e.type],this.resend=e.resend?1:0,e.resend?(u.verifyOptions(e,"idClient","msg::Message"),this.idClient=e.idClient):this.idClient=u.guid(),d(e.subType)&&(u.isInt(+e.subType)&&+e.subType>0?this.subType=+e.subType:u.onParamError("subType只能是大于0的整数","msg::Message"));var t=e.replyMsg;t&&t.idServer&&t.from&&t.to&&t.time&&(this.replyMsgFromAccount=t.from,this.replyMsgToAccount=t.to,this.replyMsgTime=t.time,this.replyMsgIdServer=t.idServer,this.replyMsgIdClient=t.idClient,t.threadMsgFromAccount&&t.threadMsgIdServer&&t.threadMsgTime&&t.threadMsgToAccount?(this.threadMsgFromAccount=t.threadMsgFromAccount,this.threadMsgToAccount=t.threadMsgToAccount,this.threadMsgTime=t.threadMsgTime,this.threadMsgIdServer=t.threadMsgIdServer,this.threadMsgIdClient=t.threadMsgIdClient):(this.threadMsgFromAccount=t.from,this.threadMsgToAccount=t.to,this.threadMsgTime=t.time,this.threadMsgIdServer=t.idServer,this.threadMsgIdClient=t.idClient)),d(e.text)&&(this.body=""+e.text),d(e.custom)&&("object"===n(e.custom)?this.custom=o(e.custom):this.custom=""+e.custom),d(e.body)&&(this.body=""+e.body),d(e.pushContent)&&(this.pushContent=""+e.pushContent),d(e.pushPayload)&&(this.pushPayload=""+e.pushPayload);var r=e.apns;if(d(r)&&"team"===e.scene){var i=r.accounts;d(i)&&u.verifyParamType("apns.accounts",i,"array","msg::Message"),this.apnsAccounts=i?o(i):"#%@all@%#",this.apnsContent=r.content||e.pushContent||"",u.verifyBooleanWithDefault(r,"forcePush",!0,"options.apns","msg::Message"),this.apnsForcePush=r.forcePush?1:0}d(e.isHistoryable)&&(this.isHistoryable=e.isHistoryable?1:0),d(e.isRoamingable)&&(this.isRoamingable=e.isRoamingable?1:0),d(e.isSyncable)&&(this.isSyncable=e.isSyncable?1:0),d(e.cc)&&(this.cc=e.cc?1:0),d(e.env)&&(this.env=e.env),d(e.isPushable)&&(this.isPushable=e.isPushable?1:0),d(e.isOfflinable)&&(this.isOfflinable=e.isOfflinable?1:0),d(e.isUnreadable)&&(this.isUnreadable=e.isUnreadable?1:0),d(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0),d(e.needMsgReceipt)&&(this.needMsgReceipt=e.needMsgReceipt?1:0),d(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),this.needUpdateSession=!1===e.needUpdateSession?0:1,d(e.antiSpamUsingYidun)&&(this.antiSpamUsingYidun=e.antiSpamUsingYidun?1:0),d(e.clientAntiSpam)&&(this.clientAntiSpam=e.clientAntiSpam?1:0),d(e.antiSpamContent)&&("object"===n(e.antiSpamContent)?this.antiSpamContent=o(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),d(e.antiSpamBusinessId)&&("object"===n(e.antiSpamBusinessId)?this.antiSpamBusinessId=o(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId),d(e.yidunAntiCheating)&&(this.yidunAntiCheating=e.yidunAntiCheating),d(e.yidunAntiSpamExt)&&(this.yidunAntiSpamExt=e.yidunAntiSpamExt)}u.merge(S.prototype,f.prototype),S.prototype.getScene=function(){return g[this.scene]},S.getType=f.getType,S.reverse=function(e){var t,r=g[e.scene];if(t="1"===e.delete?{delete:!0,scene:r||e.scene,from:e.from,time:+e.time,to:""+e.to}:{scene:r||e.scene,from:e.from,fromNick:e.fromNick,fromClientType:m.reverseType(e.fromClientType),fromDeviceId:e.fromDeviceId,to:""+e.to,time:+e.time,type:S.getType(e),text:p(e.body)?e.body:e.text||"",isHistoryable:l(e.isHistoryable)||1==+e.isHistoryable,isRoamingable:l(e.isRoamingable)||1==+e.isRoamingable,isSyncable:l(e.isSyncable)||1==+e.isSyncable,cc:l(e.cc)||1==+e.cc,isPushable:l(e.isPushable)||1==+e.isPushable,isOfflinable:l(e.isOfflinable)||1==+e.isOfflinable,isUnreadable:l(e.isUnreadable)||1==+e.isUnreadable,isReplyMsg:l(e.isReplyMsg)||1==+e.isReplyMsg,needPushNick:l(e.needPushNick)||1==+e.needPushNick,needMsgReceipt:1==+e.needMsgReceipt,isLocal:!1},e.isInBlackList&&(t.isInBlackList=1==+e.isInBlackList,t.isInBlackList&&(e.status="fail")),d(e.isMuted)&&(t.isMuted=1==+e.isMuted),d(e.resend)&&(t.resend=1==+e.resend),d(e.idClient)&&(t.idClient=e.idClient),d(e.idServer)&&(t.idServer=""+e.idServer),d(e.userUpdateTime)&&(t.userUpdateTime=+e.userUpdateTime),d(e.custom)&&(t.custom=e.custom),d(e.callbackExt)&&(t.callbackExt=e.callbackExt),d(e.subType)&&(t.subType=+e.subType),d(e.pushContent)&&(t.pushContent=e.pushContent),d(e.pushPayload)&&(t.pushPayload=e.pushPayload),d(e.tempTeamMemberCount)&&(t.tempTeamMemberCount=+e.tempTeamMemberCount),d(e.yidunAntiSpamRes)&&(t.yidunAntiSpamRes=e.yidunAntiSpamRes),d(e.apnsAccounts)){if(t.apns={},"#%@all@%#"!==e.apnsAccounts){var n=e.apnsAccounts;try{t.apns.accounts=JSON.parse(n)}catch(e){t.apns.accounts=[]}}t.apns.content=e.apnsContent||"",t.apns.forcePush=1==+e.apnsForcePush}if(d(e.needUpdateSession)&&(t.needUpdateSession=1==+e.needUpdateSession),t.status=e.status||"success",d(s(e))&&(t.filter=s(e)),e.replyMsgIdServer&&e.threadMsgIdServer){var i=["replyMsgFromAccount","replyMsgToAccount","replyMsgTime","replyMsgIdServer","replyMsgIdClient","threadMsgFromAccount","threadMsgToAccount","threadMsgTime","threadMsgIdServer","threadMsgIdClient"];a(i).call(i,(function(r){t[r]=e[r]})),t.replyMsgTime=+t.replyMsgTime,t.threadMsgTime=+t.threadMsgTime}return t},S.setExtra=function(e,t){e.target=S.getMsgTarget(e,t),e.sessionId=e.scene+"-"+e.target,f.setFlow(e,t)},S.getMsgTarget=function(e,t){return"p2p"===e.scene?e.to===t?e.from:e.to:"team"===e.scene||"superTeam"===e.scene?e.to:void 0},S.deduplication=function(e){var t,r={},n=[];return a(e).call(e,(function(e){t=e.idClient,r[t]||(r[t]=!0,n.push(e))})),n},S.sortMsgs=function(e){return e=c(e).call(e,0),u.sortObjArray(e,{sortPath:"time"}),e},S.getLastMsg=function(e){return(e=S.sortMsgs(e))[e.length-1]},S.getLastNotIgnoredMsg=function(e){for(var t=null,r=(e=S.sortMsgs(e)).length-1;r>=0;r--)if(!(t=e[r]).ignore)return t;return null},S.getMaxTimetag=function(e){return S.getLastMsg(e).time},S.validScenes=v,S.validTypes=b,S.sceneMap=h,S.sceneReverseMap=g,e.exports=S},function(e,t,r){var n=r(112),i=r(435),o=r(436),s=r(437);n.json=i,n.upload=o,n.chunkUpload=s,e.exports=n},function(e,t,r){var n=r(94),i=r(95),o=r(75),s=r(30),a=r(6),c=r(17),u=r(3),l=r(13),d=r(212),p=r(19);function m(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(s(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return f(e,t);var i=c(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,u=function(){};return{s:u,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,d=!0,p=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return d=e.done,e},e:function(e){p=!0,l=e},f:function(){try{d||null==r.return||r.return()}finally{if(p)throw l}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=r(14),g={genUrlSep:function(e){return-1===a(e=""+e).call(e,"?")?"?imageView&":"&"},urlQuery2Object:function(e){if("[object String]"!==Object.prototype.toString.call(e)||""===e)return{};var t=a(e).call(e,"?");if(-1!==t){var r=c(e).call(e,t+1).split("&"),n={};return u(r).call(r,(function(e){if(~a(e).call(e,"=")){var t=e.split("=");n[t[0]]=decodeURIComponent(t[1])}else n[e]=""})),n}},url2object:function(e){"[object String]"!==Object.prototype.toString.call(e)&&(e="");var t=a(e=e||"").call(e,"https")>=0?"https://":"http://",r=e.replace(t,"");a(r).call(r,"?")>=0&&(r=r.substring(0,a(r).call(r,"?")));var n=r.split("/");r=n[0];var i="";if(n.length>0&&(i=c(n).call(n,1).join("/")),-1===a(e).call(e,"?"))return{protocol:t,hostname:r,path:i,query:{}};var o=e.substr(a(e).call(e,"?")+1).split("&"),s={};return u(o).call(o,(function(e){if(a(e).call(e,"=")>0){var t=e.split("=");s[t[0]]=decodeURIComponent(t[1])}else s[e]=""})),{protocol:t,hostname:r,path:i,query:s}},object2url:function(e){var t,r=e.protocol,n=e.hostname,i=e.path,o=e.query;r=r||"http://",n=n||"",i&&(n=l(t="".concat(n,"/")).call(t,i)),o=o||{};var s,a,c,u=[];for(var d in o){var p;"imageView"!==d&&u.push(l(p="".concat(d,"=")).call(p,encodeURIComponent(o[d])))}return u.length>0?l(s=l(a="".concat(r)).call(a,n,"?imageView&")).call(s,u.join("&")):l(c="".concat(r)).call(c,n)},genPrivateUrl:function(e,t,r){if(t&&t.length){var n,i=m(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(a(e).call(e,o)>=0)return o!==r&&(e=e.replace(o,r)),e;if(a(e).call(e,o)>=0&&o===r)return e}}catch(e){i.e(e)}finally{i.f()}}var s,u,f=g.url2object(e),v=f.hostname,y=f.path,b=h.downloadUrl,S=h.downloadHostList,T=h.nosCdnEnable,_=h.serverNosConfig.cdnDomain,w=decodeURIComponent(h.serverNosConfig.objectPrefix),M=decodeURIComponent(y),x=a(M).call(M,w);if(_&&x>-1&&T)return l(s=l(u="".concat(f.protocol)).call(u,_,"/")).call(s,c(M).call(M,x));if(d(S).call(S,v)&&d(y).call(y,"/")){var E=a(y).call(y,"/"),C=y.substring(0,E),R=y.substring(E+1);return b.replace("{bucket}",C).replace("{object}",R)}var k=p(S).call(S,(function(e){return"string"==typeof v&&d(v).call(v,e)}))[0],A=k?v.replace(k,"").replace(/\W/g,""):null;return A?b.replace("{bucket}",A).replace("{object}",y):e}};e.exports=g},function(e,t,r){var n=r(9);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},function(e,t,r){var n=r(1).TypeError;e.exports=function(e){if(null==e)throw n("Can't call method on "+e);return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){var t=+e;return t!=t||0===t?0:(t>0?n:r)(t)}},function(e,t,r){var n=r(9),i=r(18),o=r(67),s=i("species");e.exports=function(e){return o>=51||!n((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,r){var n,i=r(34),o=r(131),s=r(132),a=r(101),c=r(161),u=r(126),l=r(102)("IE_PROTO"),d=function(){},p=function(e){return"<script>"+e+"<\/script>"},m=function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t},f=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t;f="undefined"!=typeof document?document.domain&&n?m(n):((t=u("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):m(n);for(var r=s.length;r--;)delete f.prototype[s[r]];return f()};a[l]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(d.prototype=i(e),r=new d,d.prototype=null,r[l]=e):r=f(),void 0===t?r:o.f(r,t)}},function(e,t){},function(e,t,r){var n=r(7);e.exports=n([].slice)},function(e,t,r){var n=r(129),i=r(41).f,o=r(45),s=r(25),a=r(244),c=r(18)("toStringTag");e.exports=function(e,t,r,u){if(e){var l=r?e:e.prototype;s(l,c)||i(l,c,{configurable:!0,value:t}),u&&!n&&o(l,"toString",a)}}},,function(e,t,r){var n=r(160),i=r(132);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=r(40),i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new i(e)}},function(e,t,r){e.exports=r(183)},function(e,t,r){e.exports=r(162)},function(e,t,r){var n=r(1),i=r(7),o=r(9),s=r(66),a=n.Object,c=i("".split);e.exports=o((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"==s(e)?c(e,""):a(e)}:a},function(e,t,r){var n=r(230),i=r(120);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},function(e,t,r){var n=r(1).String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},function(e,t,r){var n=r(85),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},function(e,t,r){var n=r(7),i=r(9),o=r(21),s=r(46),a=r(37),c=r(130),u=function(){},l=[],d=a("Reflect","construct"),p=/^\s*(?:class|function)\b/,m=n(p.exec),f=!p.exec(u),h=function(e){if(!o(e))return!1;try{return d(u,l,e),!0}catch(e){return!1}},g=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!m(p,c(e))}catch(e){return!0}};g.sham=!0,e.exports=!d||i((function(){var e;return h(h.call)||!h(Object)||!h((function(){e=!0}))||e}))?g:h},function(e,t){e.exports={}},function(e,t,r){var n=r(123),i=r(125),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t,r){var n,i,o,s=r(245),a=r(1),c=r(7),u=r(28),l=r(45),d=r(25),p=r(124),m=r(102),f=r(101),h=a.TypeError,g=a.WeakMap;if(s||p.state){var v=p.state||(p.state=new g),y=c(v.get),b=c(v.has),S=c(v.set);n=function(e,t){if(b(v,e))throw new h("Object already initialized");return t.facade=e,S(v,e,t),t},i=function(e){return y(v,e)||{}},o=function(e){return b(v,e)}}else{var T=m("state");f[T]=!0,n=function(e,t){if(d(e,T))throw new h("Object already initialized");return t.facade=e,l(e,T,t),t},i=function(e){return d(e,T)?e[T]:{}},o=function(e){return d(e,T)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw h("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(1),i=r(25),o=r(21),s=r(33),a=r(102),c=r(170),u=a("IE_PROTO"),l=n.Object,d=l.prototype;e.exports=c?l.getPrototypeOf:function(e){var t=s(e);if(i(t,u))return t[u];var r=t.constructor;return o(r)&&t instanceof r?r.prototype:t instanceof l?d:null}},function(e,t,r){var n=r(277).charAt,i=r(43),o=r(103),s=r(167),a=o.set,c=o.getterFor("String Iterator");s(String,"String",(function(e){a(this,{type:"String Iterator",string:i(e),index:0})}),(function(){var e,t=c(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=n(r,i),t.index+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(1),i=r(68),o=r(31),s=r(34),a=r(98),c=r(173),u=r(38),l=r(16),d=r(174),p=r(107),m=r(175),f=n.TypeError,h=function(e,t){this.stopped=e,this.result=t},g=h.prototype;e.exports=function(e,t,r){var n,v,y,b,S,T,_,w=r&&r.that,M=!(!r||!r.AS_ENTRIES),x=!(!r||!r.IS_ITERATOR),E=!(!r||!r.INTERRUPTED),C=i(t,w),R=function(e){return n&&m(n,"normal",e),new h(!0,e)},k=function(e){return M?(s(e),E?C(e[0],e[1],R):C(e[0],e[1])):E?C(e,R):C(e)};if(x)n=e;else{if(!(v=p(e)))throw f(a(e)+" is not iterable");if(c(v)){for(y=0,b=u(e);b>y;y++)if((S=k(e[y]))&&l(g,S))return S;return new h(!1)}n=d(e,v)}for(T=n.next;!(_=o(T,n)).done;){try{S=k(_.value)}catch(e){m(n,"throw",e)}if("object"==typeof S&&S&&l(g,S))return S}return new h(!1)}},function(e,t,r){var n=r(46),i=r(122),o=r(74),s=r(18)("iterator");e.exports=function(e){if(null!=e)return i(e,s)||i(e,"@@iterator")||o[n(e)]}},function(e,t,r){var n=r(66),i=r(1);e.exports="process"==n(i.process)},function(e,t,r){e.exports=r(343)},function(e,t,r){e.exports=r(363)},function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(e,t,r){var n=r(23),i=r(47),o=r(430),s=r(432),a=r(434),c={},u=i.f;function l(e){var t=e.upload="multipart/form-data"===(e.headers||i.o)["Content-Type"],r=!1;try{r=(location.protocol+"//"+location.host).toLowerCase()!==i.url2origin(e.url)}catch(e){}return e.cors=r,t||r||e.mode?function(e){var t=e.mode,r=o,n=i.getGlobal();return!n.FormData&&n.document&&(t="iframe"),"iframe"===t&&(r=e.upload?s:a),new r(e)}(e):new o(e)}function d(e,t,r){var n=c[e];if(n){"onload"===t&&n.result&&(r=function(e,t){t={data:t};var r=e.result.headers;return r&&(t.headers=e.req.header(r)),t}(n,r)),function(e){var t=c[e];t&&(t.req.destroy(),delete c[e])}(e);var i={type:t,result:r};u(i),i.stopped||n[t](i.result)}}function p(e,t){d(e,"onload",t)}function m(e,t){d(e,"onerror",t)}function f(e,t){var r=i.genUrlSep(e);return t=t||"",i.isObject(t)&&(t=i.object2query(t)),t&&(e+=r+t),e}function h(e,t){t=t||{};var r=i.uniqueID(),o={result:t.result,onload:t.onload||i.f,onerror:t.onerror||i.f};c[r]=o,t.onload=n(p).call(p,null,r),t.onerror=n(m).call(m,null,r),t.query&&(e=f(e,t.query));var s=t.method||"";return s&&!/get/i.test(s)||!t.data||(e=f(e,t.data),t.data=null),t.url=e,o.req=l(t),r}h.filter=function(e){i.isFunction(e)&&(u=e)},h.abort=function(e){var t=c[e];t&&t.req&&t.req.abort()},e.exports=h},function(e,t,r){var n,i=r(15),o=r(3),s=r(8),a=r(4),c=r(13),u=r(6),l=r(23),d=r(11),p=r(82).urlQuery2Object,m=r(0),f=r(36),h=r(466),g=r(467),v=r(468),y=r(469),b=r(470),S=r(471);function T(e){this.mixin(e)}T.prototype=i(function(){}.prototype,{protocol:{value:null,writable:!0,enumerable:!0,configurable:!0}}),T.prototype.setProtocol=function(e){this.protocol=e},T.prototype.mixin=function(e){var t,r,n=this;this.configMap=this.configMap||{},o(t=["idMap","cmdConfig","packetConfig"]).call(t,(function(t){n.configMap[t]=m.merge({},n.configMap[t],e.configMap&&e.configMap[t])})),o(r=["serializeMap","unserializeMap"]).call(r,(function(t){n[t]=m.merge({},n[t],e[t])}))},T.prototype.createCmd=(n=1,function(e,t){var r,i=this,a=this.configMap.cmdConfig[e],c="heartbeat"===e?0:n++;return c>32767&&(c=1,n=2),e={SID:a.sid,CID:a.cid,SER:c},a.params&&(e.Q=[],o(r=a.params).call(r,(function(r){var n=r.type,o=r.name,a=r.entity,c=t[o];if(!m.undef(c)){switch(n){case"PropertyArray":n="ArrayMable",c=s(c).call(c,(function(e){return{t:"Property",v:i.serialize(e,a)}}));break;case"Property":c=i.serialize(c,o);break;case"bool":c=c?"true":"false"}e.Q.push({t:n,v:c})}}))),e}),T.prototype.parseResponse=function(e){var t=this;return new a((function(r){var n=JSON.parse(e),i={raw:n,rawStr:e,error:f.genError(n.code)},s=t.configMap.packetConfig[n.sid+"_"+n.cid];if(!s)return i.notFound={sid:n.sid,cid:n.cid},void r(i);var d=n.r,p="notify"===s.service&&!s.cmd;if(i.isNotify=p,p){var h=n.r[1].headerPacket;if(s=t.configMap.packetConfig[h.sid+"_"+h.cid],d=n.r[1].body,!s)return i.notFound={sid:h.sid,cid:h.cid},void r(i)}if(i.service=s.service,i.cmd=s.cmd,i.error){var g,v,y=c(g="".concat(n.sid,"_")).call(g,n.cid);if(p&&(y=c(v="".concat(h.sid,"_")).call(v,h.cid)),i.error.cmd=i.cmd,i.error.callFunc="protocol::parseResponse: ".concat(y),416===i.error.code){var b=d[0];b&&(i.frequencyControlDuration=1e3*b)}}var S,T=!1;i.error&&s.trivialErrorCodes&&(T=-1!==u(S=s.trivialErrorCodes).call(S,i.error.code));var _=[];if((!i.error||T)&&s.response){var w;i.content={};var M=function(e,t,r,n){if(e&&"msg"===n||"sysMsg"===n){var i=r.content[n];m.isObject(i)&&!i.idServer&&(i.idServer=""+t.r[0])}};o(w=s.response).call(w,(function(e,r){var s,a=d[r];if(!m.undef(a)){var c=e.type,u=e.name,f=e.entity||u;switch(c){case"Property":_.push(t.unserialize(a,f).then(l(s=function(e,t,r,n,i){r.content[n]=i,M(e,t,r,n)}).call(s,this,p,n,i,u)));break;case"PropertyArray":i.content[u]=[],o(a).call(a,(function(e,r){var n;_.push(t.unserialize(e,f).then(l(n=function(e,t,n){e.content[t][r]=n}).call(n,this,i,u)))}));break;case"KVArray":default:i.content[u]=a,M(p,n,i,u);break;case"long":case"Long":case"byte":case"Byte":case"Number":i.content[u]=+a}}}))}a.all(_).then((function(){r(i)}))}))},T.prototype.serialize=function(e,t){var r=this.serializeMap[t],n={};for(var i in r)e.hasOwnProperty(i)&&(n[r[i]]=e[i]);return n},T.prototype.matchNosSafeUrl=function(e){if(!m.isString(e)||!~u(e).call(e,"_im_url=1"))return!1;var t=p(e);return!(!t||!t._im_url||1!=t._im_url)},T.prototype.getOneNosOriginUrl=function(e,t,r){var n=this;return new a((function(i){n.protocol.getNosOriginUrlReqNum++,n.protocol.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e}},(function(e,o,s){n.protocol.getNosOriginUrlReqNum--,e?n.protocol.logger.warn("error: get nos originUrl failed",e):(t["_"+r+"_safe"]=t[r],t[r]=s.nosFileUrlTag&&s.nosFileUrlTag.originUrl),i()}))}))},T.prototype.checkObjSafeUrl=function(e,t,r){var n=this;for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];if(m.isString(s)){if(this.matchNosSafeUrl(s)){var a=this.getOneNosOriginUrl(s,e,i);t.push(a),r.push(a)}}else m.isObject(s)?this.checkObjSafeUrl(s,t,r):m.isArray(s)&&o(s).call(s,(function(e){m.isObject(e)&&n.checkObjSafeUrl(e,t,r)}))}};var _=["url","avatar","fromAvatar","chatroomAvatar"];T.prototype.unserialize=function(e,t){var r=this;return new a((function(n){var i=r.unserializeMap[t],o={},s=[];if(e)for(var c in i){var p,m=[];if(e.hasOwnProperty(c)&&(o[i[c]]=e[c],r.protocol.hasLogin&&!r.protocol.keepNosSafeUrl))if("attach"===i[c]&&e[c]&&u(e[c])&&~u(p=e[c]).call(p,"_im_url=1"))try{var f,h=JSON.parse(e[c]);h.isS3||r.checkObjSafeUrl(h,m,s),a.all(m).then(l(f=function(e,t){e.attach=d(t)}).call(f,r,o,h))}catch(e){r.logger.warn("unserialize",e&&e.message)}else~u(_).call(_,i[c])&&e[c]&&r.matchNosSafeUrl(e[c])&&s.push(r.getOneNosOriginUrl(e[c],o,i[c]))}a.all(s).then((function(){n(o)}))}))},T.prototype.syncUnserialize=function(e,t){var r=this.unserializeMap[t],n={};if(e)for(var i in r)e.hasOwnProperty(i)&&(n[r[i]]=e[i]);return n};var w=new T({configMap:h,serializeMap:g,unserializeMap:v}),M=new T({configMap:y,serializeMap:b,unserializeMap:S});e.exports={IM:w,Chatroom:M}},function(e,t,r){var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!n.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,r){e.exports=r(335)},function(e,t,r){var n=r(8),i=r(5),o=r(0),s=o.notundef,a=o.fillPropertyWithDefault,c={0:"normal",1:"owner",2:"manager"};function u(e){o.verifyOptions(e,"teamId","team::TeamMember"),o.verifyParamAtLeastPresentOne(e,"nickInTeam muteTeam muteNotiType custom","team::TeamMember"),this.teamId=e.teamId,s(e.account)&&(this.account=e.account),s(e.nickInTeam)&&(this.nickInTeam=e.nickInTeam),s(e.muteNotiType)?this.bits=e.muteNotiType:s(e.muteTeam)&&(this.bits=0,e.muteTeam&&(this.bits+=1)),s(e.mute)&&(this.mute=e.mute?1:0),s(e.custom)&&(this.custom=""+e.custom)}u.reverse=function(e){var t=o.copy(e);if(s(t.teamId)&&(t.teamId=""+t.teamId),s(t.type)&&(t.type=c[t.type]),s(t.active)&&(t.active=1==+t.active),s(t.valid)&&(t.valid=1==+t.valid),s(t.mute)&&(t.mute=1==+t.mute),s(t.joinTime)&&(t.joinTime=+t.joinTime),s(t.updateTime)&&(t.updateTime=+t.updateTime),s(t.bits)){var r=t.bits;delete t.bits,t.muteTeam=!!(1&r),t.muteNotiType=r}return s(t.teamId)&&s(t.account)&&(t.id=u.genId(t.teamId,t.account)),t},u.reverseMembers=function(e){return n(e).call(e,(function(e){return i(u).call(u,e)}))},u.fillProperties=function(e){var t=a(e,"mute",!1),r=a(e,"custom","");return t||r},u.genId=function(e,t){return e+"-"+t},u.accounts2ids=function(e,t){return n(t).call(t,(function(t){return u.genId(e,t)}))},u.assembleMembers=function(e,t){return o.isArray(t)||(t=[t]),n(t).call(t,(function(t){return u.assembleMember(e,t)}))},u.assembleMember=function(e,t){return{id:u.genId(e.teamId,t),account:t,teamId:e.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0,invitorAccid:""}},u.assembleOwner=function(e){var t=u.assembleMember(e,e.owner);return t.type="owner",t},e.exports=u},function(e,t,r){var n,i=r(27),o=r(6),s=r(11),a=r(13),c=r(10),u=r(17),l=r(5),d=r(19),p=r(8),m=r(3),f=r(0),h=f.undef,g=f.notundef,v=r(113).IM,y=r(140),b=r(117),S={customP2p:100,customTeam:101,customSuperTeam:103,deleteMsgP2p:7,deleteMsgTeam:8,deleteMsgSuperTeam:12,deleteOnewayMsgP2p:13,deleteOnewayMsgTeam:14},T={0:"applyTeam",1:"rejectTeamApply",2:"teamInvite",3:"rejectTeamInvite",5:"friendRequest",6:"deleteFriend",7:"deleteMsgP2p",8:"deleteMsgTeam",12:"deleteMsgSuperTeam",13:"deleteMsgP2pOneWay",14:"deleteMsgTeamOneWay",15:"applySuperTeam",16:"rejectSuperTeamApply",17:"superTeamInvite",18:"rejectSuperTeamInvite",100:"customP2p",101:"customTeam",103:"customSuperTeam",102:"customP2p"},_={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},w=["team","superTeam","friend","msg"],M={applyTeam:"team",rejectTeamApply:"team",teamInvite:"team",rejectTeamInvite:"team",applySuperTeam:"superTeam",rejectSuperTeamApply:"superTeam",superTeamInvite:"superTeam",rejectSuperTeamInvite:"superTeam",addFriend:"friend",applyFriend:"friend",passFriendApply:"friend",rejectFriendApply:"friend",deleteFriend:"friend",deleteMsg:"msg"};function x(e){var t,r;f.verifyOptions(e,"type to","sysmsg::SystemMessage"),f.verifyParamValid("type",e.type,x.validTypes,"sysmsg::SystemMessage"),-1!==o(t=e.type).call(t,"custom")&&(f.verifyOptions(e,"content","sysmsg::SystemMessage"),this.attach=e.content,g(e.apnsText)&&(this.apnsText=""+e.apnsText),g(e.pushPayload)&&("object"===i(e.pushPayload)?this.pushPayload=s(e.pushPayload):this.pushPayload=""+e.pushPayload),g(e.sendToOnlineUsersOnly)&&(this.sendToOnlineUsersOnly=e.sendToOnlineUsersOnly?0:1),g(e.cc)&&(this.cc=e.cc?1:0),g(e.isPushable)&&(this.isPushable=e.isPushable?1:0),g(e.isUnreadable)&&(this.isUnreadable=e.isUnreadable?1:0),g(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0)),0===o(r=e.type).call(r,"deleteMsg")&&(e.apnsText&&(this.apnsText=e.apnsText),e.pushPayload&&(this.pushPayload=e.pushPayload),e.attach&&(this.attach=e.attach)),this.time=e.time||+new Date,this.type=S[e.type],this.to=e.to,g(e.from)&&(this.from=e.from),g(e.ps)&&(this.ps=e.ps),g(e.deletedIdClient)&&(this.deletedIdClient=e.deletedIdClient),g(e.deletedIdServer)&&(this.deletedIdServer=e.deletedIdServer),g(e.opeAccount)&&(this.opeAccount=e.opeAccount),g(e.yidunEnable)&&(this.yidunEnable=e.yidunEnable?1:0),g(e.antiSpamContent)&&("object"===i(e.antiSpamContent)?this.antiSpamContent=s(e.antiSpamContent):this.antiSpamContent=""+e.antiSpamContent),g(e.antiSpamBusinessId)&&("object"===i(e.antiSpamBusinessId)?this.antiSpamBusinessId=s(e.antiSpamBusinessId):this.antiSpamBusinessId=""+e.antiSpamBusinessId),g(e.env)&&(this.env=e.env),this.idClient=e.idClient||f.guid()}x.validTypes=a(n=c(S)).call(n,c(M)),x.validCategories=["team","friend"],x.isCustom=function(e){return"custom"===e.type},x.reverse=function(e){var t,r,n={time:+e.time,to:e.to,type:T[e.type]};if(g(e.from)&&(n.from=e.from),g(e.idServer)&&(n.idServer=""+e.idServer),g(e.deletedIdClient)&&(n.deletedIdClient=e.deletedIdClient),g(e.deletedIdServer)&&(n.deletedIdServer=""+e.deletedIdServer),g(e.deletedMsgTime)&&(n.deletedMsgTime=+e.deletedMsgTime),g(e.deletedMsgFromNick)&&(n.deletedMsgFromNick=""+e.deletedMsgFromNick),g(e.opeAccount)&&(n.opeAccount=e.opeAccount),g(e.ps)&&(n.ps=e.ps),g(e.callbackExt)&&(n.callbackExt=e.callbackExt),e.attach=e.attach?""+e.attach:"","customP2p"===n.type||"customTeam"===n.type||"customSuperTeam"===n.type)n.content=e.attach,g(e.apnsText)&&(n.apnsText=e.apnsText),g(e.pushPayload)&&(n.pushPayload=e.pushPayload),f.merge(n,{sendToOnlineUsersOnly:h(e.sendToOnlineUsersOnly)||0==+e.sendToOnlineUsersOnly,cc:h(e.cc)||1==+e.cc,isPushable:h(e.isPushable)||1==+e.isPushable,isUnreadable:h(e.isUnreadable)||1==+e.isUnreadable,needPushNick:g(e.needPushNick)&&1==+e.needPushNick}),n.scene=u(r=n.type).call(r,6).toLowerCase(),n.type="custom";else if(0===o(t=n.type).call(t,"deleteMsg")){e.apnsText&&(n.apnsText=e.apnsText),e.pushPayload&&(n.pushPayload=e.pushPayload),e.attach&&(n.attach=e.attach);var i=n.type.toLowerCase();o(i).call(i,"p2p")>-1?n.scene="p2p":o(i).call(i,"superteam")>-1?n.scene="superTeam":o(i).call(i,"team")>-1&&(n.scene="team"),n.type="deleteMsg"}else{if(e.attach){n.attach={};var s=JSON.parse(e.attach);g(s.vt)?(n.type=_[s.vt],s.serverex&&1===s.serverex[0]&&(n.serverex=s.serverex[1]),delete n.attach):(g(s.tinfo)&&(n.attach.team=l(y).call(y,v.syncUnserialize(s.tinfo,"team"))),g(s.tlist)&&(n.attach.member=l(b).call(b,v.syncUnserialize(s.tlist,"teamMember"))),g(s.attach)&&(n.attach.custom=s.attach))}n.category=M[n.type],n.read=!1,n.state="init"}return g(e.cc)&&(n.cc=1==+e.cc),n.status=e.status||"success",g(d(e))&&(n.filter=d(e)),n},x.reverseSysMsgs=function(e,t){var r=(t=t||{}).mapper,n=f.isFunction(r);return p(e).call(e,(function(e){return e=l(x).call(x,e),n&&(e=r(e)),e}))},x.completeUnread=function(e){var t,r;return e=e||{},m(w).call(w,(function(t){delete e[t]})),m(t=c(M)).call(t,(function(t){e[t]=e[t]||0,e[t]<0&&(e[t]=0),e[r=M[t]]=e[r]||0,e[r]=e[r]+e[t]})),e.total=0,m(w).call(w,(function(t){e.total+=e[t]})),e},e.exports=x},function(e,t,r){e.exports=r(433)},function(e,t,r){var n=r(1),i=r(37),o=r(21),s=r(16),a=r(155),c=n.Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return o(t)&&s(t.prototype,c(e))}},function(e,t,r){var n=r(67),i=r(9);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(e,t,r){var n=r(40);e.exports=function(e,t){var r=e[t];return null==r?void 0:n(r)}},function(e,t,r){var n=r(55),i=r(124);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.21.1",mode:n?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(e,t,r){var n=r(1),i=r(232),o=n["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,r){var n=r(7),i=0,o=Math.random(),s=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},function(e,t,r){var n=r(1),i=r(28),o=n.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},function(e,t,r){var n=r(35),i=r(99),o=r(38),s=function(e){return function(t,r,s){var a,c=n(t),u=o(c),l=i(s,u);if(e&&r!=r){for(;u>l;)if((a=c[l++])!=a)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},function(e,t,r){var n=r(237);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},function(e,t,r){var n={};n[r(18)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){var n=r(7),i=r(21),o=r(124),s=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},function(e,t,r){var n=r(24),i=r(158),o=r(41),s=r(34),a=r(35),c=r(92);t.f=n&&!i?Object.defineProperties:function(e,t){s(e);for(var r,n=a(t),i=c(t),u=i.length,l=0;u>l;)o.f(e,r=i[l++],n[r]);return e}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){var n=r(160),i=r(132).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(18);t.f=n},function(e,t,r){var n=r(7),i=r(34),o=r(263);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return i(r),o(n),t?e(r,n):r.__proto__=n,r}}():void 0)},function(e,t,r){var n=r(7),i=r(84),o=r(43),s=r(111),a=n("".replace),c="["+s+"]",u=RegExp("^"+c+c+"*"),l=RegExp(c+c+"*$"),d=function(e){return function(t){var r=o(i(t));return 1&e&&(r=a(r,u,"")),2&e&&(r=a(r,l,"")),r}};e.exports={start:d(1),end:d(2),trim:d(3)}},function(e,t,r){var n=r(15),i=r(26),o=r(6),s=r(3),a=r(47),c=a.f,u=r(431);function l(e){e.onload&&this.once("load",e.onload),e.onerror&&this.once("error",e.onerror),e.onbeforesend&&this.once("beforesend",e.onbeforesend),e.onaftersend&&this.once("aftersend",e.onaftersend);var t=(e=this.options=a.fetch({method:"GET",url:"",sync:!1,data:null,headers:{},cookie:!1,timeout:6e4,type:"text",form:null,input:null,putFileAtEnd:!1,proxyUrl:""},e)).headers;a.notexist(t["Content-Type"])&&(t["Content-Type"]="application/x-www-form-urlencoded"),this.send()}var d=l.prototype=n(u.prototype);d.send=function(){var e=this,t=e.options;i((function(){try{try{e.emit("beforesend",t)}catch(e){}e.doSend()}catch(t){e.onError("serverError","请求失败:"+t.message)}}),0)},d.doSend=c,d.afterSend=function(){var e=this;i((function(){e.emit("aftersend",e.options)}),0)},d.onLoad=function(e){var t,r=this.options,n=e.status,i=e.result;if("number"!=typeof n||0!==n)if(0===o(t=""+n).call(t,"2")){if("json"===r.type)try{i=JSON.parse(i)}catch(e){return void this.onError("parseError",i)}this.emit("load",i)}else this.onError("serverError","服务器返回异常状态",{status:n,result:i,date:e.date});else this.onError("netError","网络错误")},d.onError=function(e,t,r){var n=a.isObject(r)?r:{};n.code=e||"error",n.message=t||"发生错误",this.emit("error",n)},d.onTimeout=function(){this.onError("timeout","请求超时")},d.abort=function(){this.onError("abort","客户端中止")},d.header=function(e){var t=this;if(!a.isArray(e))return t.getResponseHeader(e||"");var r={};return s(e).call(e,(function(e){r[e]=t.header(e)})),r},d.getResponseHeader=c,d.destroy=c,e.exports=l},function(e,t){var r={link:{id:1,heartbeat:2,negotiateTransport:5,initTransport:6},sync:{id:5,sync:1,syncTeamMembers:2},misc:{id:6,getSimpleNosToken:1,getNosToken:2,notifyUploadLog:3,uploadSdkLogUrl:4,audioToText:5,processImage:6,getNosTokenTrans:7,notifyTransLog:8,fetchFile:9,fetchFileList:10,removeFile:11,getClientAntispam:17,fileQuickTransfer:18,getNosOriginUrl:22,getServerTime:23,getNosAccessToken:24,deleteNosAccessToken:25,getNosCdnHost:26,getGrayscaleConfig:27,getMixStorePolicy:28,getMixStoreToken:29,getBackSourceToken:30,uploadDetect:32},avSignal:{id:15,signalingCreate:1,signalingDelay:2,signalingClose:3,signalingJoin:4,signalingLeave:5,signalingInvite:6,signalingCancel:7,signalingReject:8,signalingAccept:9,signalingControl:10,signalingNotify:11,signalingMutilClientSyncNotify:12,signalingUnreadMessageSyncNotify:13,signalingChannelsSyncNotify:14,signalingGetChannelInfo:15,signalingCallEx:16,signalingJoinAndAccept:17}},n={heartbeat:{sid:r.link.id,cid:r.link.heartbeat},negotiateTransport:{sid:r.link.id,cid:r.link.negotiateTransport,params:[{type:"int",name:"sdkVersion"},{type:"Property",name:"negotiateTransportTag"}]},initTransport:{sid:r.link.id,cid:r.link.initTransport,params:[{type:"Property",name:"initTransportTag"}]},getGrayscaleConfig:{sid:r.misc.id,cid:r.misc.getGrayscaleConfig,params:[{type:"Property",name:"providers"}]},getMixStorePolicy:{sid:r.misc.id,cid:r.misc.getMixStorePolicy,params:[{type:"LongArray",name:"providers"}]},getMixStoreToken:{sid:r.misc.id,cid:r.misc.getMixStoreToken,params:[{type:"Property",name:"mixTokenReq"}]},getBackSourceToken:{sid:r.misc.id,cid:r.misc.getBackSourceToken,params:[{type:"Property",name:"mixAuthTokenReq"}]},uploadDetect:{sid:r.misc.id,cid:r.misc.uploadDetect,params:[{type:"Property",name:"notifyDetectTag"}]},getSimpleNosToken:{sid:r.misc.id,cid:r.misc.getSimpleNosToken,params:[{type:"int",name:"num"}]},getNosToken:{sid:r.misc.id,cid:r.misc.getNosToken,params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken"}]},uploadSdkLogUrl:{sid:r.misc.id,cid:r.misc.uploadSdkLogUrl,params:[{type:"string",name:"url"}]},audioToText:{sid:r.misc.id,cid:r.misc.audioToText,params:[{type:"Property",name:"audioToText"}]},processImage:{sid:r.misc.id,cid:r.misc.processImage,params:[{type:"String",name:"url"},{type:"PropertyArray",name:"imageOps",entity:"imageOp"}]},getClientAntispam:{sid:r.misc.id,cid:r.misc.getClientAntispam,params:[{type:"Property",name:"clientAntispam"}]},fileQuickTransfer:{sid:r.misc.id,cid:r.misc.fileQuickTransfer,params:[{type:"Property",name:"fileQuickTransfer"}]},getNosOriginUrl:{sid:r.misc.id,cid:r.misc.getNosOriginUrl,params:[{type:"Property",name:"nosFileUrlTag"}]},getServerTime:{sid:r.misc.id,cid:r.misc.getServerTime,params:[]},getNosAccessToken:{sid:r.misc.id,cid:r.misc.getNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},deleteNosAccessToken:{sid:r.misc.id,cid:r.misc.deleteNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},getNosTokenTrans:{sid:r.misc.id,cid:r.misc.getNosTokenTrans,params:[{type:"Property",name:"transToken"}]},fetchFile:{sid:r.misc.id,cid:r.misc.fetchFile,params:[{type:"String",name:"docId"}]},fetchFileList:{sid:r.misc.id,cid:r.misc.fetchFileList,params:[{type:"Property",name:"fileListParam"}]},removeFile:{sid:r.misc.id,cid:r.misc.removeFile,params:[{type:"String",name:"docId"}]},getNosCdnHost:{sid:r.misc.id,cid:r.misc.getNosCdnHost,params:[]},signalingCreate:{sid:r.avSignal.id,cid:r.avSignal.signalingCreate,params:[{type:"Property",name:"avSignalTag"}]},signalingDelay:{sid:r.avSignal.id,cid:r.avSignal.signalingDelay,params:[{type:"Property",name:"avSignalTag"}]},signalingClose:{sid:r.avSignal.id,cid:r.avSignal.signalingClose,params:[{type:"Property",name:"avSignalTag"}]},signalingJoin:{sid:r.avSignal.id,cid:r.avSignal.signalingJoin,params:[{type:"Property",name:"avSignalTag"}]},signalingLeave:{sid:r.avSignal.id,cid:r.avSignal.signalingLeave,params:[{type:"Property",name:"avSignalTag"}]},signalingInvite:{sid:r.avSignal.id,cid:r.avSignal.signalingInvite,params:[{type:"Property",name:"avSignalTag"}]},signalingCancel:{sid:r.avSignal.id,cid:r.avSignal.signalingCancel,params:[{type:"Property",name:"avSignalTag"}]},signalingReject:{sid:r.avSignal.id,cid:r.avSignal.signalingReject,params:[{type:"Property",name:"avSignalTag"}]},signalingAccept:{sid:r.avSignal.id,cid:r.avSignal.signalingAccept,params:[{type:"Property",name:"avSignalTag"}]},signalingControl:{sid:r.avSignal.id,cid:r.avSignal.signalingControl,params:[{type:"Property",name:"avSignalTag"}]},signalingGetChannelInfo:{sid:r.avSignal.id,cid:r.avSignal.signalingGetChannelInfo,params:[{type:"Property",name:"avSignalTag"}]},signalingCallEx:{sid:r.avSignal.id,cid:r.avSignal.signalingCallEx,params:[{type:"Property",name:"avSignalTag"}]},signalingJoinAndAccept:{sid:r.avSignal.id,cid:r.avSignal.signalingJoinAndAccept,params:[{type:"Property",name:"avSignalTag"}]}};e.exports={idMap:r,cmdConfig:n,packetConfig:{"1_2":{service:"link",cmd:"heartbeat"},"1_5":{service:"link",cmd:"negotiateTransport",response:[{type:"Property",name:"negotiateTransportTag"}]},"1_6":{service:"link",cmd:"initTransport",response:[{type:"Property",name:"initTransportTag"}]},"6_1":{service:"misc",cmd:"getSimpleNosToken",response:[{type:"PropertyArray",name:"nosTokens",entity:"nosToken"}]},"6_2":{service:"misc",cmd:"getNosToken",response:[{type:"Property",name:"nosToken"}]},"6_3":{service:"misc",cmd:"notifyUploadLog"},"6_4":{service:"misc",cmd:"uploadSdkLogUrl"},"6_5":{service:"misc",cmd:"audioToText",response:[{type:"String",name:"text"}]},"6_6":{service:"misc",cmd:"processImage",response:[{type:"String",name:"url"}]},"6_7":{service:"misc",cmd:"getNosTokenTrans",response:[{type:"Property",name:"nosToken"},{type:"String",name:"docId"}]},"6_8":{service:"misc",cmd:"notifyTransLog",response:[{type:"Property",name:"transInfo"}]},"6_9":{service:"misc",cmd:"fetchFile",response:[{type:"Property",name:"info",entity:"transInfo"}]},"6_10":{service:"misc",cmd:"fetchFileList",response:[{type:"PropertyArray",name:"list",entity:"transInfo"},{type:"Number",name:"totalCount"}]},"6_11":{service:"misc",cmd:"removeFile",response:[{type:"String",name:"res"}]},"6_17":{service:"misc",cmd:"getClientAntispam",response:[{type:"Property",name:"clientAntispam"}]},"6_18":{service:"misc",cmd:"fileQuickTransfer",response:[{type:"Property",name:"fileQuickTransfer"}]},"6_22":{service:"misc",cmd:"getNosOriginUrl",response:[{type:"Property",name:"nosFileUrlTag"}]},"6_23":{service:"misc",cmd:"getServerTime",response:[{type:"Number",name:"time"}]},"6_24":{service:"misc",cmd:"getNosAccessToken",response:[{type:"Property",name:"nosAccessTokenTag"}]},"6_25":{service:"misc",cmd:"deleteNosAccessToken"},"6_26":{service:"misc",cmd:"getNosCdnHost",response:[{type:"Property",name:"nosConfigTag"}]},"6_27":{service:"misc",cmd:"getGrayscaleConfig",response:[{type:"Property",name:"appGrayConfigTag"}]},"6_28":{service:"misc",cmd:"getMixStorePolicy",response:[{type:"Property",name:"mixStorePolicyTag"}]},"6_29":{service:"misc",cmd:"getMixStoreToken",response:[{type:"Property",name:"mixStoreTokenTag"}]},"6_30":{service:"misc",cmd:"getBackSourceToken",response:[{type:"Property",name:"backSourceTokenTag"}]},"6_31":{service:"link",cmd:"notifyDetect",response:[{type:"Property",name:"notifyDetectTag"}]},"15_1":{service:"avSignal",cmd:"signalingCreate",response:[{type:"Property",name:"avSignalTag"}]},"15_2":{service:"avSignal",cmd:"signalingDelay",response:[{type:"Property",name:"avSignalTag"}]},"15_3":{service:"avSignal",cmd:"signalingClose",response:[{type:"Property",name:"avSignalTag"}]},"15_4":{service:"avSignal",cmd:"signalingJoin",response:[{type:"Property",name:"avSignalTag"}]},"15_5":{service:"avSignal",cmd:"signalingLeave",response:[]},"15_6":{service:"avSignal",cmd:"signalingInvite",response:[]},"15_7":{service:"avSignal",cmd:"signalingCancel",response:[]},"15_8":{service:"avSignal",cmd:"signalingReject",response:[]},"15_9":{service:"avSignal",cmd:"signalingAccept",response:[]},"15_10":{service:"avSignal",cmd:"signalingControl",response:[]},"15_11":{service:"avSignal",cmd:"signalingNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_12":{service:"avSignal",cmd:"signalingMutilClientSyncNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_13":{service:"avSignal",cmd:"signalingUnreadMessageSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_14":{service:"avSignal",cmd:"signalingChannelsSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_15":{service:"avSignal",cmd:"signalingGetChannelInfo",response:[{type:"Property",name:"avSignalTag"}]},"15_16":{service:"avSignal",cmd:"signalingCallEx",response:[{type:"Property",name:"avSignalTag"}]},"15_17":{service:"avSignal",cmd:"signalingJoinAndAccept",response:[{type:"Property",name:"avSignalTag"}]}}}},function(e,t,r){var n=r(10),i=r(3),o=r(23),s=r(0),a=s.notundef,c=s.fillPropertyWithDefault,u=n,l={},d={},p=[],m={},f={normal:0,advanced:1},h={0:"normal",1:"advanced"},g=u(f),v=l.joinMode={noVerify:0,needVerify:1,rejectAll:2};d.joinMode={0:"noVerify",1:"needVerify",2:"rejectAll"},p.push("join"),m.joinMode=u(v);var y=l.beInviteMode={needVerify:0,noVerify:1};d.beInviteMode={0:"needVerify",1:"noVerify"},p.push("beInvite"),m.beInviteMode=u(y);var b=l.inviteMode={manager:0,all:1};d.inviteMode={0:"manager",1:"all"},p.push("invite"),m.inviteMode=u(b);var S=l.updateTeamMode={manager:0,all:1};d.updateTeamMode={0:"manager",1:"all"},p.push("updateTeam"),m.updateTeamMode=u(S);var T=l.updateCustomMode={manager:0,all:1};function _(e){var t;switch(s.verifyOptions(e,"action","team::Team"),e.action){case"create":s.verifyOptions(e,"teamId",!1,"team::Team"),s.verifyOptions(e,"type name","team::Team"),s.verifyParamValid("type",e.type,g,"team::Team"),a(e.level)&&(s.verifyParamType("level",e.level,"number","team::Team"),this.level=e.level);break;case"update":s.verifyOptions(e,"teamId","team::Team"),s.verifyOptions(e,"type",!1,"team::Team")}a(e.teamId)&&(this.teamId=e.teamId),a(e.type)&&(this.type=f[e.type]),a(e.avatar)&&(this.avatar=""+e.avatar),a(e.name)&&(this.name=""+e.name),a(e.intro)&&(this.intro=""+e.intro),a(e.announcement)&&(this.announcement=""+e.announcement),i(p).call(p,o(t=this.setMode).call(t,this,e)),a(e.custom)&&(this.custom=""+e.custom)}function w(e,t){a(e[t+="Mode"])&&(e[t]=d[t][e[t]])}d.updateCustomMode={0:"manager",1:"all"},p.push("updateCustom"),m.updateCustomMode=u(T),_.prototype.setMode=function(e,t){a(e[t+="Mode"])&&(s.verifyParamValid(t,e[t],m[t],"team::Team"),this[t]=l[t][e[t]])},_.reverse=function(e,t){var r=s.copy(e);if(a(r.teamId)&&(r.teamId=""+r.teamId),a(r.type)&&(r.type=h[r.type]),a(r.level)&&(r.level=+r.level),a(r.valid)&&(r.valid=1==+r.valid),a(r.memberNum)&&(r.memberNum=+r.memberNum),a(r.memberUpdateTime)&&(r.memberUpdateTime=+r.memberUpdateTime),a(r.createTime)&&(r.createTime=+r.createTime),a(r.updateTime)&&(r.updateTime=+r.updateTime),a(r.validToCurrentUser)&&(r.validToCurrentUser="1"===r.validToCurrentUser),a(r.mute)&&(r.mute="1"===r.mute),a(r.muteType))switch(r.muteType){case"0":r.mute=!1,r.muteType="none";break;case"1":r.mute=!0,r.muteType="normal";break;case"3":r.mute=!0,r.muteType="all"}else a(r.mute)&&(1===r.mute?(r.mute=!0,r.muteType="normal"):(r.mute=!1,r.muteType="none"));return i(p).call(p,o(w).call(w,null,r)),delete r.bits,t||_.fillProperties(r),r},_.fillProperties=function(e){var t=c(e,"beInviteMode","needVerify"),r=c(e,"inviteMode","manager"),n=c(e,"updateTeamMode","manager"),i=c(e,"updateCustomMode","manager"),o=c(e,"avatar","");return t||r||n||i||o},e.exports=_},function(e,t,r){var n=r(39).clientTypeMap;function i(){}i.reverse=function(e){var t=e;return t.type=n[t.type],t},i.reverseType=function(e){return n[e]||e},e.exports=i},function(e,t,r){var n=r(0);function i(){}i.parse=function(e){var t=e.split("|");return{scene:t[0],to:t[1]}},i.genSessionByMsg=function(e){return{id:e.sessionId,scene:e.scene,to:e.target,updateTime:e.time,lastMsg:e}},i.appendLastMsg=function(e){var t=e.lastMsg;e["last"+n.capFirstLetter(t.type)+"Msg"]=t,e["last"+n.capFirstLetter(t.flow)+"Msg"]=t},i.genSessionByMsgs=function(e,t){var r=e.getLastNotIgnoredMsg(t);return r?i.genSessionByMsg(r):null},i.trim=function(e){delete e.msgReceiptSendTime,delete e.msgReceiptServerTime,delete e.ack,delete e.unreadMsgs,e.isDeleted||delete e.isDeleted},i.isComplete=function(e){return e.id&&e.scene&&e.to},e.exports=i},,,function(e,t,r){e.exports=r(241)},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){for(var r=t.split(".");r.length;){var n=r.shift(),i=!1;if("?"==n[n.length-1]&&(n=n.slice(0,-1),i=!0),!(e=e[n])&&i)return e}return e}},function(e,t,r){e.exports=r(358)},function(e,t,r){var n=r(419),i=r(192),o=r(424);e.exports=function(e,t){if(null==e)return{};var r,s,a=o(e,t);if(n){var c=n(e);for(s=0;s<c.length;s++)r=c[s],i(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(8),i=r(5),o=r(0),s=o.notundef,a=o.fillPropertyWithDefault,c={0:"normal",1:"owner",2:"manager"};function u(e){o.verifyOptions(e,"teamId","superTeam::TeamMember"),o.verifyParamAtLeastPresentOne(e,"nickInTeam muteTeam custom","superTeam::SuperTeamMember"),this.teamId=e.teamId,s(e.account)&&(this.account=e.account),s(e.nickInTeam)&&(this.nickInTeam=e.nickInTeam),s(e.muteTeam)&&(this.bits=0,e.muteTeam&&(this.bits+=1)),s(e.mute)&&(this.mute=e.mute?1:0),s(e.custom)&&(this.custom=""+e.custom)}u.reverse=function(e){var t=o.copy(e);if(s(t.teamId)&&(t.teamId=""+t.teamId),s(t.type)&&(t.type=c[t.type]),s(t.active)&&(t.active=1==+t.active),s(t.valid)&&(t.valid=1==+t.valid),s(t.mute)&&(t.mute=1==+t.mute),s(t.joinTime)&&(t.joinTime=+t.joinTime),s(t.updateTime)&&(t.updateTime=+t.updateTime),s(t.bits)){var r=t.bits;delete t.bits,t.muteTeam=!!(1&r)}return s(t.teamId)&&s(t.account)&&(t.id=u.genId(t.teamId,t.account)),t},u.reverseMembers=function(e){return n(e).call(e,(function(e){return i(u).call(u,e)}))},u.fillProperties=function(e){var t=a(e,"mute",!1),r=a(e,"custom","");return t||r},u.genId=function(e,t){return e+"-"+t},u.accounts2ids=function(e,t){return n(t).call(t,(function(t){return u.genId(e,t)}))},u.assembleMembers=function(e,t){return o.isArray(t)||(t=[t]),n(t).call(t,(function(t){return u.assembleMember(e,t)}))},u.assembleMember=function(e,t){return{id:u.genId(e.teamId,t),account:t,teamId:e.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}},u.assembleOwner=function(e){var t=u.assembleMember(e,e.owner);return t.type="owner",t},e.exports=u},function(e,t,r){var n=r(8),i=r(5),o=r(10),s=r(82).genPrivateUrl,a=r(0),c={unknown:0,male:1,female:2},u={0:"unknown",1:"male",2:"female"};function l(e){a.merge(this,e),a.notundef(this.gender)&&(a.verifyParamValid("gender",this.gender,l.validGenders,"user::User"),this.gender=c[this.gender]),a.notundef(this.email)&&""!==this.email&&a.verifyEmail("email",this.email,"user::User"),a.notundef(this.birth)&&""!==this.birth&&a.verifyBirth("birth",this.birth,"user::User"),a.notundef(this.tel)&&""!==this.tel&&a.verifyTel("tel",this.tel,"user::User")}l.reverse=function(e,t,r){var n=a.filterObj(e,"account nick avatar _avatar_safe sign gender email birth tel custom createTime updateTime");return a.notundef(n.avatar)&&(n.avatar=s(n.avatar,t,r)),a.notundef(n.gender)&&(n.gender=u[n.gender]),a.notundef(n.createTime)&&(n.createTime=+n.createTime),a.notundef(n.updateTime)&&(n.updateTime=+n.updateTime),n},l.reverseUsers=function(e){return n(e).call(e,(function(e){return i(l).call(l,e)}))},l.validGenders=o(c),e.exports=l},function(e,t,r){var n=r(11),i=r(15),o=r(5),s=r(6),a=r(82).genPrivateUrl,c=r(80),u=r(0),l=r(14);function d(e){switch(u.notundef(e.type)?u.verifyFileType(e.type,"msg::FileMessage"):e.type="file",u.verifyOptions(e,"file","msg::FileMessage"),u.verifyOptions(e.file,"url ext size",!0,"file.","msg::FileMessage"),e.type){case"image":p.verifyFile(e.file,"msg::FileMessage");break;case"audio":m.verifyFile(e.file,"msg::FileMessage");break;case"video":f.verifyFile(e.file,"msg::FileMessage")}c.call(this,e),this.attach=n(e.file)}d.prototype=i(c.prototype),d.reverse=function(e){var t,r,n=o(c).call(c,e);(e.attach=e.attach?""+e.attach:"",e.attach&&(n.file=JSON.parse(e.attach),!n.file.isS3))&&(n.file.url=a(n.file.url)||"","audio"===n.type&&n.file.url&&!n.file.mp3Url&&(n.file.mp3Url=n.file.url+(~s(r=n.file.url).call(r,"?")?"&":"?")+"audioTrans&type=mp3"),l.httpsEnabled&&0!==s(t=n.file.url).call(t,"https://")&&(n.file.url=n.file.url.replace("http","https")));return n},e.exports=d;var p=r(556),m=r(557),f=r(558)},,function(e,t,r){var n=r(227);e.exports=n},function(e,t,r){var n=r(121);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n=r(24),i=r(9),o=r(126);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(9),i=r(21),o=/#|\.prototype\./,s=function(e,t){var r=c[a(e)];return r==l||r!=u&&(i(t)?n(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=s.data={},u=s.NATIVE="N",l=s.POLYFILL="P";e.exports=s},function(e,t,r){var n=r(24),i=r(9);e.exports=n&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(e,t,r){var n=r(2),i=r(1),o=r(9),s=r(70),a=r(28),c=r(33),u=r(38),l=r(71),d=r(128),p=r(86),m=r(18),f=r(67),h=m("isConcatSpreadable"),g=i.TypeError,v=f>=51||!o((function(){var e=[];return e[h]=!1,e.concat()[0]!==e})),y=p("concat"),b=function(e){if(!a(e))return!1;var t=e[h];return void 0!==t?!!t:s(e)};n({target:"Array",proto:!0,forced:!v||!y},{concat:function(e){var t,r,n,i,o,s=c(this),a=d(s,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(b(o=-1===t?s:arguments[t])){if(p+(i=u(o))>9007199254740991)throw g("Maximum allowed index exceeded");for(r=0;r<i;r++,p++)r in o&&l(a,p,o[r])}else{if(p>=9007199254740991)throw g("Maximum allowed index exceeded");l(a,p++,o)}return a.length=p,a}})},function(e,t,r){var n=r(7),i=r(25),o=r(35),s=r(127).indexOf,a=r(101),c=n([].push);e.exports=function(e,t){var r,n=o(e),u=0,l=[];for(r in n)!i(a,r)&&i(n,r)&&c(l,r);for(;t.length>u;)i(n,r=t[u++])&&(~s(l,r)||c(l,r));return l}},function(e,t,r){var n=r(37);e.exports=n("document","documentElement")},function(e,t,r){var n=r(243);r(56),e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(37),s=r(53),a=r(31),c=r(7),u=r(55),l=r(24),d=r(121),p=r(9),m=r(25),f=r(70),h=r(21),g=r(28),v=r(16),y=r(120),b=r(34),S=r(33),T=r(35),_=r(97),w=r(43),M=r(54),x=r(87),E=r(92),C=r(133),R=r(164),k=r(134),A=r(65),I=r(41),O=r(131),P=r(114),N=r(89),D=r(72),L=r(123),j=r(102),U=r(101),F=r(125),$=r(18),B=r(135),V=r(20),H=r(90),W=r(103),q=r(78).forEach,z=j("hidden"),G=$("toPrimitive"),J=W.set,K=W.getterFor("Symbol"),Q=Object.prototype,Y=i.Symbol,X=Y&&Y.prototype,Z=i.TypeError,ee=i.QObject,te=o("JSON","stringify"),re=A.f,ne=I.f,ie=R.f,oe=P.f,se=c([].push),ae=L("symbols"),ce=L("op-symbols"),ue=L("string-to-symbol-registry"),le=L("symbol-to-string-registry"),de=L("wks"),pe=!ee||!ee.prototype||!ee.prototype.findChild,me=l&&p((function(){return 7!=x(ne({},"a",{get:function(){return ne(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=re(Q,t);n&&delete Q[t],ne(e,t,r),n&&e!==Q&&ne(Q,t,n)}:ne,fe=function(e,t){var r=ae[e]=x(X);return J(r,{type:"Symbol",tag:e,description:t}),l||(r.description=t),r},he=function(e,t,r){e===Q&&he(ce,t,r),b(e);var n=_(t);return b(r),m(ae,n)?(r.enumerable?(m(e,z)&&e[z][n]&&(e[z][n]=!1),r=x(r,{enumerable:M(0,!1)})):(m(e,z)||ne(e,z,M(1,{})),e[z][n]=!0),me(e,n,r)):ne(e,n,r)},ge=function(e,t){b(e);var r=T(t),n=E(r).concat(Se(r));return q(n,(function(t){l&&!a(ve,r,t)||he(e,t,r[t])})),e},ve=function(e){var t=_(e),r=a(oe,this,t);return!(this===Q&&m(ae,t)&&!m(ce,t))&&(!(r||!m(this,t)||!m(ae,t)||m(this,z)&&this[z][t])||r)},ye=function(e,t){var r=T(e),n=_(t);if(r!==Q||!m(ae,n)||m(ce,n)){var i=re(r,n);return!i||!m(ae,n)||m(r,z)&&r[z][n]||(i.enumerable=!0),i}},be=function(e){var t=ie(T(e)),r=[];return q(t,(function(e){m(ae,e)||m(U,e)||se(r,e)})),r},Se=function(e){var t=e===Q,r=ie(t?ce:T(e)),n=[];return q(r,(function(e){!m(ae,e)||t&&!m(Q,e)||se(n,ae[e])})),n};if(d||(D(X=(Y=function(){if(v(X,this))throw Z("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?w(arguments[0]):void 0,t=F(e),r=function(e){this===Q&&a(r,ce,e),m(this,z)&&m(this[z],t)&&(this[z][t]=!1),me(this,t,M(1,e))};return l&&pe&&me(Q,t,{configurable:!0,set:r}),fe(t,e)}).prototype,"toString",(function(){return K(this).tag})),D(Y,"withoutSetter",(function(e){return fe(F(e),e)})),P.f=ve,I.f=he,O.f=ge,A.f=ye,C.f=R.f=be,k.f=Se,B.f=function(e){return fe($(e),e)},l&&(ne(X,"description",{configurable:!0,get:function(){return K(this).description}}),u||D(Q,"propertyIsEnumerable",ve,{unsafe:!0}))),n({global:!0,wrap:!0,forced:!d,sham:!d},{Symbol:Y}),q(E(de),(function(e){V(e)})),n({target:"Symbol",stat:!0,forced:!d},{for:function(e){var t=w(e);if(m(ue,t))return ue[t];var r=Y(t);return ue[t]=r,le[r]=t,r},keyFor:function(e){if(!y(e))throw Z(e+" is not a symbol");if(m(le,e))return le[e]},useSetter:function(){pe=!0},useSimple:function(){pe=!1}}),n({target:"Object",stat:!0,forced:!d,sham:!l},{create:function(e,t){return void 0===t?x(e):ge(x(e),t)},defineProperty:he,defineProperties:ge,getOwnPropertyDescriptor:ye}),n({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:be,getOwnPropertySymbols:Se}),n({target:"Object",stat:!0,forced:p((function(){k.f(1)}))},{getOwnPropertySymbols:function(e){return k.f(S(e))}}),te&&n({target:"JSON",stat:!0,forced:!d||p((function(){var e=Y();return"[null]"!=te([e])||"{}"!=te({a:e})||"{}"!=te(Object(e))}))},{stringify:function(e,t,r){var n=N(arguments),i=t;if((g(t)||void 0!==e)&&!y(e))return f(t)||(t=function(e,t){if(h(i)&&(t=a(i,this,e,t)),!y(t))return t}),n[1]=t,s(te,null,n)}}),!X[G]){var Te=X.valueOf;D(X,G,(function(e){return a(Te,this)}))}H(Y,"Symbol"),U[z]=!0},function(e,t,r){var n=r(66),i=r(35),o=r(133).f,s=r(165),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"==n(e)?function(e){try{return o(e)}catch(e){return s(a)}}(e):o(i(e))}},function(e,t,r){var n=r(1),i=r(99),o=r(38),s=r(71),a=n.Array,c=Math.max;e.exports=function(e,t,r){for(var n=o(e),u=i(t,n),l=i(void 0===r?n:r,n),d=a(c(l-u,0)),p=0;u<l;u++,p++)s(d,p,e[u]);return d.length=p,d}},function(e,t,r){r(20)("iterator")},function(e,t,r){var n=r(2),i=r(31),o=r(55),s=r(168),a=r(21),c=r(262),u=r(104),l=r(136),d=r(90),p=r(45),m=r(72),f=r(18),h=r(74),g=r(169),v=s.PROPER,y=s.CONFIGURABLE,b=g.IteratorPrototype,S=g.BUGGY_SAFARI_ITERATORS,T=f("iterator"),_=function(){return this};e.exports=function(e,t,r,s,f,g,w){c(r,t,s);var M,x,E,C=function(e){if(e===f&&O)return O;if(!S&&e in A)return A[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},R=t+" Iterator",k=!1,A=e.prototype,I=A[T]||A["@@iterator"]||f&&A[f],O=!S&&I||C(f),P="Array"==t&&A.entries||I;if(P&&(M=u(P.call(new e)))!==Object.prototype&&M.next&&(o||u(M)===b||(l?l(M,b):a(M[T])||m(M,T,_)),d(M,R,!0,!0),o&&(h[R]=_)),v&&"values"==f&&I&&"values"!==I.name&&(!o&&y?p(A,"name","values"):(k=!0,O=function(){return i(I,this)})),f)if(x={values:C("values"),keys:g?O:C("keys"),entries:C("entries")},w)for(E in x)(S||k||!(E in A))&&m(A,E,x[E]);else n({target:t,proto:!0,forced:S||k},x);return o&&!w||A[T]===O||m(A,T,O,{name:f}),h[t]=O,x}},function(e,t,r){var n=r(24),i=r(25),o=Function.prototype,s=n&&Object.getOwnPropertyDescriptor,a=i(o,"name"),c=a&&"something"===function(){}.name,u=a&&(!n||n&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:u}},function(e,t,r){var n,i,o,s=r(9),a=r(21),c=r(87),u=r(104),l=r(72),d=r(18),p=r(55),m=d("iterator"),f=!1;[].keys&&("next"in(o=[].keys())?(i=u(u(o)))!==Object.prototype&&(n=i):f=!0),null==n||s((function(){var e={};return n[m].call(e)!==e}))?n={}:p&&(n=c(n)),a(n[m])||l(n,m,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}},function(e,t,r){var n=r(9);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var n=r(278);e.exports=n},function(e,t,r){var n=r(37),i=r(7),o=r(133),s=r(134),a=r(34),c=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(a(e)),r=s.f;return r?c(t,r(e)):t}},function(e,t,r){var n=r(18),i=r(74),o=n("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[o]===e)}},function(e,t,r){var n=r(1),i=r(31),o=r(40),s=r(34),a=r(98),c=r(107),u=n.TypeError;e.exports=function(e,t){var r=arguments.length<2?c(e):t;if(o(r))return s(i(r,e));throw u(a(e)+" is not iterable")}},function(e,t,r){var n=r(31),i=r(34),o=r(122);e.exports=function(e,t,r){var s,a;i(e);try{if(!(s=o(e,"return"))){if("throw"===t)throw r;return r}s=n(s,e)}catch(e){a=!0,s=e}if("throw"===t)throw r;if(a)throw s;return i(s),r}},function(e,t,r){var n=r(1);e.exports=n.Promise},function(e,t,r){var n=r(18)("iterator"),i=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){i=!0}};s[n]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},function(e,t,r){var n=r(34),i=r(299),o=r(18)("species");e.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[o])?t:i(r)}},function(e,t,r){var n,i,o,s,a=r(1),c=r(53),u=r(68),l=r(21),d=r(25),p=r(9),m=r(161),f=r(89),h=r(126),g=r(180),v=r(181),y=r(108),b=a.setImmediate,S=a.clearImmediate,T=a.process,_=a.Dispatch,w=a.Function,M=a.MessageChannel,x=a.String,E=0,C={};try{n=a.location}catch(e){}var R=function(e){if(d(C,e)){var t=C[e];delete C[e],t()}},k=function(e){return function(){R(e)}},A=function(e){R(e.data)},I=function(e){a.postMessage(x(e),n.protocol+"//"+n.host)};b&&S||(b=function(e){g(arguments.length,1);var t=l(e)?e:w(e),r=f(arguments,1);return C[++E]=function(){c(t,void 0,r)},i(E),E},S=function(e){delete C[e]},y?i=function(e){T.nextTick(k(e))}:_&&_.now?i=function(e){_.now(k(e))}:M&&!v?(s=(o=new M).port2,o.port1.onmessage=A,i=u(s.postMessage,s)):a.addEventListener&&l(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!p(I)?(i=I,a.addEventListener("message",A,!1)):i="onreadystatechange"in h("script")?function(e){m.appendChild(h("script")).onreadystatechange=function(){m.removeChild(this),R(e)}}:function(e){setTimeout(k(e),0)}),e.exports={set:b,clear:S}},function(e,t,r){var n=r(1).TypeError;e.exports=function(e,t){if(e<t)throw n("Not enough arguments");return e}},function(e,t,r){var n=r(44);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},function(e,t,r){var n=r(34),i=r(28),o=r(93);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(308);e.exports=n},function(e,t,r){var n=r(316);e.exports=n},function(e,t,r){var n=r(326);e.exports=n},function(e,t,r){var n=r(330);e.exports=n},function(e,t,r){var n=r(333);e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(53),s=r(21),a=r(44),c=r(89),u=r(180),l=/MSIE .\./.test(a),d=i.Function,p=function(e){return function(t,r){var n=u(arguments.length,1)>2,i=s(t)?t:d(t),a=n?c(arguments,2):void 0;return e(n?function(){o(i,this,a)}:i,r)}};n({global:!0,bind:!0,forced:l},{setTimeout:p(i.setTimeout),setInterval:p(i.setInterval)})},function(e,t){e.exports=function e(t,r){var n,i,o=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,s=/(^[ ]*|[ ]*$)/g,a=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,u=/^0/,l=function(t){return e.insensitive&&(""+t).toLowerCase()||""+t},d=l(t).replace(s,"")||"",p=l(r).replace(s,"")||"",m=d.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=p.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=parseInt(d.match(c),16)||1!==m.length&&d.match(a)&&Date.parse(d),g=parseInt(p.match(c),16)||h&&p.match(a)&&Date.parse(p)||null;if(g){if(h<g)return-1;if(h>g)return 1}for(var v=0,y=Math.max(m.length,f.length);v<y;v++){if(n=!(m[v]||"").match(u)&&parseFloat(m[v])||m[v]||0,i=!(f[v]||"").match(u)&&parseFloat(f[v])||f[v]||0,isNaN(n)!==isNaN(i))return isNaN(n)?1:-1;if(typeof n!=typeof i&&(n+="",i+=""),n<i)return-1;if(n>i)return 1}return 0}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(382)},function(e,t,r){e.exports=r(422)},function(e,t,r){var n=r(0),i={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},o={genResponseBody:function(e){return i[e=e||"file"]},parseResponse:function(e,t){n.notundef(e.size)&&(e.size=+e.size),n.notundef(e.w)&&(e.w=+e.w),n.notundef(e.h)&&(e.h=+e.h),n.notundef(e.dur)&&(e.dur=+e.dur);var r=e.orientation;if(n.notundef(r)&&(delete e.orientation,t&&("right, top"===r||"left, bottom"===r))){var i=e.w;e.w=e.h,e.h=i}return e}};e.exports=o},function(e,t,r){var n=r(77),i=r(6),o=r(76),s=r(119),a=r(11),c=r(47),u=c.getGlobal(),l={},d=u.name||"_parent",p=[],m=[];l.addMsgListener=function(e){p.push(e)};var f,h,g,v,y=(f=/^([\w]+?:\/\/.*?(?=\/|$))/i,function(e){return e=e||"",f.test(e)?RegExp.$1:"*"}),b=function(){var e,t,r=n(e=unescape(u.name||"")).call(e);if(r&&0===i(r).call(r,"MSG|")){u.name="";var o=c.string2object(r.replace("MSG|",""),"|"),s=(o.origin||"").toLowerCase();s&&"*"!==s&&0!==i(t=location.href.toLowerCase()).call(t,s)||function(e){for(var t=0,r=p.length;t<r;t++)try{p[t].call(null,e)}catch(e){}}({data:JSON.parse(o.data||"null"),source:u.frames[o.self]||o.self,origin:y(o.ref||("undefined"==typeof document?"":document.referrer))})}},S=(g=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return!0;return!1},function(){if(m.length){h=[];for(var e,t=m.length-1;t>=0;t--)e=m[t],g(h,e.w)||(h.push(e.w),o(m).call(m,t,1),e.w.name=e.d);h=null}}),T=l.startTimer=(v=!1,function(){v||(v=!0,u.postMessage||(s(S,100),s(b,20)))});l.postMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(c.fillUndef(t,{origin:"*",source:d}),u.postMessage){var r=t.data;u.FormData||(r=a(r)),e.postMessage(r,t.origin)}else{if(T(),c.isObject(t)){var n={};n.origin=t.origin||"",n.ref=location.href,n.self=t.source,n.data=a(t.data),t="MSG|"+c.object2string(n,"|",!0)}m.unshift({w:e,d:escape(t)})}},e.exports=l},function(e,t,r){var n=r(6),i=r(0),o={fromDataURL:function(e){var t,r,o=i.getGlobal();r=n(t=e.split(",")[0]).call(t,"base64")>=0?o.atob(e.split(",")[1]):o.decodeURIComponent(e.split(",")[1]);for(var s=e.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(r.length),c=0;c<r.length;c++)a[c]=r.charCodeAt(c);return new o.Blob([a],{type:s})}};e.exports=o},function(e,t,r){var n=r(10),i=r(8),o=r(5),s=r(0),a={stripmeta:0,blur:2,quality:3,crop:4,rotate:5,thumbnail:7,interlace:9},c={0:"stripmeta",1:"type",2:"blur",3:"quality",4:"crop",5:"rotate",6:"pixel",7:"thumbnail",8:"watermark",9:"interlace",10:"tmp"};function u(e){s.verifyOptions(e,"type","image::ImageOp"),s.verifyParamValid("type",e.type,u.validTypes,"image::ImageOp"),s.merge(this,e),this.type=a[e.type]}u.validTypes=n(a),u.reverse=function(e){var t=s.copy(e);return t.type=c[t.type],t},u.reverseImageOps=function(e){return i(e).call(e,(function(e){return o(u).call(u,e)}))},e.exports=u},function(e,t,r){var n=r(3),i=r(10),o={1:"ROOM_CLOSE",2:"ROOM_JOIN",3:"INVITE",4:"CANCEL_INVITE",5:"REJECT",6:"ACCEPT",7:"LEAVE",8:"CONTROL"},s={1:"accid",2:"uid",3:"createTime",4:"expireTime",5:"web_uid"},a={10404:"ROOM_NOT_EXISTS",10405:"ROOM_HAS_EXISTS",10406:"ROOM_MEMBER_NOT_EXISTS",10407:"ROOM_MEMBER_HAS_EXISTS",10408:"INVITE_NOT_EXISTS",10409:"INVITE_HAS_REJECT",10410:"INVITE_HAS_ACCEPT",10201:"PEER_NIM_OFFLINE",10202:"PEER_PUSH_OFFLINE",10419:"ROOM_MEMBER_EXCEED",10420:"ROOM_MEMBER_HAS_EXISTS_OTHER_CLIENT",10417:"UID_CONFLICT"};e.exports={parseAvSignalType:function(e){return o[e]||e},parseAvSignalMember:function(e){var t,r={};return n(t=i(e)).call(t,(function(t){r[s[t]]=e[t]})),r},parseAvSignalError:function(e){return e.message=a[e.code]||e.message||e,e}}},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;function getGlobal(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==global?global:{}}var root=getGlobal(),io=module.exports;void 0===root.location&&(root.location=null),root.io?module&&(module.exports=io=root.io):root.io=io,function(){!function(e,t){var r=e;r.version="0.9.11",r.protocol=1,r.transports=[],r.j=[],r.sockets={},r.connect=function(e,n){var i,o,s=r.util.parseUri(e);t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),i=r.util.uniqueUri(s);var a={host:s.ipv6uri?"["+s.host+"]":s.host,secure:"https"===s.protocol,port:s.port||("https"===s.protocol?443:80),query:s.query||""};return r.util.merge(a,n),!a["force new connection"]&&r.sockets[i]||(o=new r.Socket(a)),!a["force new connection"]&&o&&(r.sockets[i]=o),(o=o||r.sockets[i]).of(s.path.length>1?s.path:"")}}(module.exports,root),function(e,t){var r=e.util={},n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];r.parseUri=function(e){var t=e,r=e.indexOf("["),o=e.indexOf("]");-1!=r&&-1!=o&&(e=e.substring(0,r)+e.substring(r,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=n.exec(e||""),a={},c=14;c--;)a[i[c]]=s[c]||"";return-1!=r&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a},r.uniqueUri=function(e){var r=e.protocol,n=e.host,i=e.port;return"document"in t&&t.document?(n=n||document.domain,i=i||("https"==r&&"https:"!==document.location.protocol?443:document.location.port)):(n=n||"localhost",i||"https"!=r||(i=443)),(r||"http")+"://"+n+":"+(i||80)},r.query=function(e,t){var n=r.chunkQuery(e||""),i=[];for(var o in r.merge(n,r.chunkQuery(t||"")),n)n.hasOwnProperty(o)&&i.push(o+"="+n[o]);return i.length?"?"+i.join("&"):""},r.chunkQuery=function(e){for(var t,r={},n=e.split("&"),i=0,o=n.length;i<o;++i)(t=n[i].split("="))[0]&&(r[t[0]]=t[1]);return r};var o=!1;r.load=function(e){if("undefined"!=typeof document&&document&&"complete"===document.readyState||o)return e();r.on(t,"load",e,!1)},r.on=function(e,t,r,n){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener&&e.addEventListener(t,r,n)},r.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!r.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||r.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(root[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},void 0!==root&&r.load((function(){o=!0})),r.defer=function(e){if(!r.ua.webkit||"undefined"!=typeof importScripts)return e();r.load((function(){setTimeout(e,100)}))},r.merge=function(e,t,n,i){var o,s=i||[],a=void 0===n?2:n;for(o in t)t.hasOwnProperty(o)&&r.indexOf(s,o)<0&&("object"==typeof e[o]&&a?r.merge(e[o],t[o],a-1,s):(e[o]=t[o],s.push(t[o])));return e},r.mixin=function(e,t){r.merge(e.prototype,t.prototype)},r.inherit=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.intersect=function(e,t){for(var n=[],i=e.length>t.length?e:t,o=e.length>t.length?t:e,s=0,a=o.length;s<a;s++)~r.indexOf(i,o[s])&&n.push(o[s]);return n},r.indexOf=function(e,t,r){var n=e.length;for(r=r<0?r+n<0?0:r+n:r||0;r<n&&e[r]!==t;r++);return n<=r?-1:r},r.toArray=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(e[r]);return t},r.ua={},r.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),r.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),r.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,root),function(e,t){function r(){}e.EventEmitter=r,r.prototype.on=function(e,r){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(r):this.$events[e]=[this.$events[e],r]:this.$events[e]=r,this},r.prototype.addListener=r.prototype.on,r.prototype.once=function(e,t){var r=this;function n(){r.removeListener(e,n),t.apply(this,arguments)}return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,r){if(this.$events&&this.$events[e]){var n=this.$events[e];if(t.util.isArray(n)){for(var i=-1,o=0,s=n.length;o<s;o++)if(n[o]===r||n[o].listener&&n[o].listener===r){i=o;break}if(i<0)return this;n.splice(i,1),n.length||delete this.$events[e]}else(n===r||n.listener&&n.listener===r)&&delete this.$events[e]}return this},r.prototype.removeAllListeners=function(e){return void 0===e?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},r.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},r.prototype.emit=function(e){if(!this.$events)return!1;var r=this.$events[e];if(!r)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof r)r.apply(this,n);else{if(!t.util.isArray(r))return!1;for(var i=r.slice(),o=0,s=i.length;o<s;o++)i[o].apply(this,n)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={};function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,(function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function str(e,t){var r,n,i,o,s,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,r=0;r<o;r+=1)s[r]=str(r,c)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(o=rep.length,r=0;r<o;r+=1)"string"==typeof rep[r]&&(i=str(n=rep[r],c))&&s.push(quote(n)+(gap?": ":":")+i);else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(i=str(n,c))&&s.push(quote(n)+(gap?": ":":")+i);return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}JSON.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;n<r;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("socket.io:: replacer cannot JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){var j;function walk(e,t){var r,n,i=e[t];if(i&&"object"==typeof i)for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(void 0!==(n=walk(i,r))?i[r]=n:delete i[r]);return reviver.call(e,t,i)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("socket.io:: reviver cannot JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var r=e.parser={},n=r.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=r.reasons=["transport not supported","client not handshaken","unauthorized"],o=r.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;r.encodePacket=function(e){var t=a(n,e.type),r=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var d=e.reason?a(i,e.reason):"",p=e.advice?a(o,e.advice):"";""===d&&""===p||(l=d+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var m={name:e.name};e.args&&e.args.length&&(m.args=e.args),l=s.stringify(m);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,r+("data"==u?"+":""),c];return null!=l&&f.push(l),f.join(":")},r.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var r=0,n=e.length;r<n;r++)t+="�"+e[r].length+"�"+e[r];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;r.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",r=(e=a[5]||"",{type:n[a[1]],endpoint:a[4]||""});switch(t&&(r.id=t,a[3]?r.ack="data":r.ack=!0),r.type){case"error":var a=e.split("+");r.reason=i[a[0]]||"",r.advice=o[a[1]]||"";break;case"message":r.data=e||"";break;case"event":try{var u=s.parse(e);r.name=u.name,r.args=u.args}catch(e){}r.args=r.args||[];break;case"json":try{r.data=s.parse(e)}catch(e){}break;case"connect":r.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(r.ackId=a[1],r.args=[],a[3]))try{r.args=a[3]?s.parse(a[3]):[]}catch(e){}}return r},r.decodePayload=function(e){var t=function(e,t){for(var r=0,n=e;n<t.length;n++){if("�"==t.charAt(n))return r;r++}return r};if("�"==e.charAt(0)){for(var n=[],i=1,o="";i<e.length;i++)if("�"==e.charAt(i)){var s=e.substr(i+1).substr(0,o);if("�"!=e.charAt(i+1+Number(o))&&i+1+Number(o)!=e.length){var a=Number(o);l=t(i+a+1,e),s=e.substr(i+1).substr(0,a+l),i+=l}n.push(r.decodePacket(s)),i+=Number(o)+1,o=""}else o+=e.charAt(i);return n}return[r.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function r(e,t){this.socket=e,this.sessid=t}e.Transport=r,t.util.mixin(r,t.EventEmitter),r.prototype.heartbeats=function(){return!0},r.prototype.onData=function(e){if(this!==this.socket.transport)return this;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var r=t.parser.decodePayload(e);if(r&&r.length)for(var n=0,i=r.length;n<i;n++)this.onPacket(r[n])}return this},r.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},r.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout((function(){e.onDisconnect()}),this.socket.closeTimeout)}},r.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket?(this.socket.transport===this?this.socket.onDisconnect():this.socket.setBuffer(!1),this):this},r.prototype.onConnect=function(){return this.socket.onConnect(),this},r.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},r.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},r.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},r.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},r.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},r.prototype.onClose=function(){this.isOpen=!1,this.socket.transport===this?this.socket.onClose():this.socket.setBuffer(!1),this.onDisconnect(),this.onDisconnectDone instanceof Function&&this.onDisconnectDone(null),this.onConnectionOver instanceof Function&&this.onConnectionOver(null)},r.prototype.onDisconnectDone=function(){},r.prototype.onConnectionOver=function(){},r.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},r.prototype.ready=function(e,t){t.call(this)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,r){function n(e){if(this.options={port:80,secure:!1,document:"document"in r&&document,resource:"socket.io",transports:e.transports||t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var n=this;t.util.on(r,"beforeunload",(function(){n.disconnectSync()}),!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=n,t.util.mixin(n,t.EventEmitter),n.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},n.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},n.prototype.handshake=function(e){var r=this,n=this.options;function o(t){t instanceof Error?(r.connecting=!1,r.onError(t.message)):e.apply(null,t.split(":"))}var s=["http"+(n.secure?"s":"")+":/",n.host+":"+n.port,n.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS&&"undefined"!=typeof document&&document){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,c.onreadystatechange=function(){"loaded"==this.readyState&&c.parentNode&&(c.parentNode.removeChild(c),r.connecting=!1,!r.reconnecting&&r.onError("Server down or port not open"),r.publish("handshake_failed"))},a.parentNode.insertBefore(c,a),t.j.push((function(e){o(e),c.parentNode.removeChild(c)}))}else{var u=t.util.request();u.open("GET",s,!0),u.timeout=1e4,this.isXDomain()&&(u.withCredentials=!0),u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=i,200==u.status?o(u.responseText):403==u.status?(r.connecting=!1,r.onError(u.responseText),r.publish("handshake_failed")):(r.connecting=!1,!r.reconnecting&&r.onError(u.responseText),r.publish("handshake_failed")))},u.ontimeout=function(e){r.connecting=!1,!r.reconnecting&&r.onError(u.responseText),r.publish("handshake_failed")},u.send(null)}},n.prototype.connect=function(e){if(this.connecting)return this;var r=this;return r.connecting=!0,this.handshake((function(n,i,o,s){r.sessionid=n,r.closeTimeout=1e3*o,r.heartbeatTimeout=1e3*i,r.transports||(r.transports=r.origTransports=s?t.util.intersect(s.split(","),r.options.transports):r.options.transports),r.setHeartbeatTimeout(),r.once("connect",(function(){clearTimeout(r.connectTimeoutTimer),r.connectTimeoutTimer=null,e&&"function"==typeof e&&e()})),r.doConnect()})),this},n.prototype.doConnect=function(){var e=this;if(e.transport&&e.transport.clearTimeouts(),e.transport=e.getTransport(e.transports),!e.transport)return e.publish("connect_failed");e.transport.ready(e,(function(){e.connecting=!0,e.publish("connecting",e.transport.name),e.transport.open(),e.options["connect timeout"]&&(e.connectTimeoutTimer&&clearTimeout(e.connectTimeoutTimer),e.connectTimeoutTimer=setTimeout(e.tryNextTransport.bind(e),e.options["connect timeout"]))}))},n.prototype.getTransport=function(e){for(var r,n=e||this.transports,i=0;r=n[i];i++)if(t.Transport[r]&&t.Transport[r].check(this)&&(!this.isXDomain()||t.Transport[r].xdomainCheck(this)))return new t.Transport[r](this,this.sessionid);return null},n.prototype.tryNextTransport=function(){if(!this.connected&&(this.connecting=!1,this.options["try multiple transports"])){for(var e=this.transports;e.length>0&&e.splice(0,1)[0]!=this.transport.name;);e.length?this.doConnect():this.publish("connect_failed")}},n.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout((function(){e.transport&&e.transport.onClose()}),this.heartbeatTimeout)}},n.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},n.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},n.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},n.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},n.prototype.disconnectSync=function(){var e=t.util.request(),r=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",r,!1),e.send(null),this.onDisconnect("booted")},n.prototype.isXDomain=function(){var e=r&&r.location||{},t=e.port||("https:"==e.protocol?443:80);return this.options.host!==e.hostname||this.options.port!=t},n.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},n.prototype.onOpen=function(){this.open=!0},n.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},n.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},n.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},n.prototype.onDisconnect=function(e){var t=this.connected,r=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||r)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()),r&&(this.connectTimeoutTimer&&clearTimeout(this.connectTimeoutTimer),this.tryNextTransport()))},n.prototype.reconnect=function(){this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],r=this.options["try multiple transports"],n=this.options["reconnection limit"];function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer),e.removeListener("connect_failed",o),e.removeListener("connect",o),e.reconnecting=!1,delete e.reconnectionAttempts,delete e.reconnectionDelay,delete e.reconnectionTimer,delete e.redoTransports,e.options["try multiple transports"]=r}function o(){if(e.reconnecting)return e.connected?i():e.connecting&&e.reconnecting?e.reconnectionTimer=setTimeout(o,1e3):void(e.reconnectionAttempts++>=t?e.redoTransports?(e.publish("reconnect_failed"),i()):(e.on("connect_failed",o),e.options["try multiple transports"]=!0,e.transports=e.origTransports,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<n&&(e.reconnectionDelay*=2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(o,e.reconnectionDelay)))}this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(o,this.reconnectionDelay),this.on("connect",o)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t){function r(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}function n(e,t){this.namespace=e,this.name=t}e.SocketNamespace=r,t.util.mixin(r,t.EventEmitter),r.prototype.$emit=t.EventEmitter.prototype.emit,r.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},r.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},r.prototype.send=function(e,t){var r={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(r.id=++this.ackPackets,r.ack=!0,this.acks[r.id]=t),this.packet(r)},r.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),r=t[t.length-1],n={type:"event",name:e};return"function"==typeof r&&(n.id=++this.ackPackets,n.ack="data",this.acks[n.id]=r,t=t.slice(0,t.length-1)),n.args=t,this.packet(n)},r.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},r.prototype.onPacket=function(e){var r=this;function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":i=[e.name].concat(e.args),"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":console.error("SocketIO on packet error: ",e),e.advice?this.socket.onError(e):"unauthorized"===e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,r){function n(e){t.Transport.apply(this,arguments)}e.websocket=n,t.util.inherit(n,t.Transport),n.prototype.name="websocket",n.prototype.open=function(){var e,n=t.util.query(this.socket.options.query),i=this;return e||(e=r.MozWebSocket||r.WebSocket),this.websocket=new e(this.prepareUrl()+n),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.socket.setBuffer(!0),i.onClose()},this.websocket.onerror=function(e){i.onError(e)},this},t.util.ua.iDevice?n.prototype.send=function(e){var t=this;return setTimeout((function(){t.websocket.send(e)}),0),this}:n.prototype.send=function(e){return this.websocket.send(e),this},n.prototype.payload=function(e){for(var t=0,r=e.length;t<r;t++)this.packet(e[t]);return this},n.prototype.close=function(){return this.websocket.close(),this},n.prototype.onError=function(e){this.socket.onError(e)},n.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},n.check=function(){return"WebSocket"in r&&!("__addTask"in WebSocket)||"MozWebSocket"in r},n.xdomainCheck=function(){return!0},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t,r){function n(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=n,t.util.inherit(n,t.Transport),n.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},n.prototype.payload=function(e){for(var r=[],n=0,i=e.length;n<i;n++)r.push(t.parser.encodePacket(e[n]));this.send(t.parser.encodePayload(r))},n.prototype.send=function(e){return this.post(e),this},n.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),r.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=i,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,t.posting=!1,200==this.status?t.socket.setBuffer(!1):t.onClose())},this.sendXHR.send(e)},n.prototype.close=function(){return this.onClose(),this},n.prototype.request=function(e){var r=t.util.request(this.socket.isXDomain()),n=t.util.query(this.socket.options.query,"t="+ +new Date);if(r.open(e||"GET",this.prepareUrl()+n,!0),"POST"==e)try{r.setRequestHeader?r.setRequestHeader("Content-type","text/plain;charset=UTF-8"):r.contentType="text/plain"}catch(e){}return r},n.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},n.check=function(e,n){try{var i=t.util.request(n),o=r.XDomainRequest&&i instanceof XDomainRequest,s=e&&e.options&&e.options.secure?"https:":"http:",a=r.location&&s!=r.location.protocol;if(i&&(!o||!a))return!0}catch(e){}return!1},n.xdomainCheck=function(e){return n.check(e,!0)}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),function(e,t,r){function n(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=n,t.util.inherit(n,t.Transport.XHR),t.util.merge(n,t.Transport.XHR),n.prototype.name="xhr-polling",n.prototype.heartbeats=function(){return!1},n.prototype.open=function(){return t.Transport.XHR.prototype.open.call(this),!1},n.prototype.get=function(){if(this.isOpen){var e=this;this.xhr=this.request(),r.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){this.onload=i,this.onerror=i,e.retryCounter=1,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.retryCounter++,!e.retryCounter||e.retryCounter>3?e.onClose():e.get()}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(e.onData(this.responseText),e.get()):e.onClose())},this.xhr.send(null)}},n.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},n.prototype.ready=function(e,r){var n=this;t.util.defer((function(){r.call(n)}))},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,root),__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return io}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}).call(this,__webpack_require__(48),__webpack_require__(459)(module))},function(e,t,r){var n=r(10),i=r(39);function o(){}o.typeMap={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,g2:12,custom:100};var s=o.typeReverseMap={0:"text",1:"image",2:"audio",3:"video",4:"geo",5:"notification",6:"file",10:"tip",11:"robot",12:"g2",100:"custom"};o.validTypes=n(o.typeMap),o.setFlow=function(e,t){var r=t===e.from;r&&t===e.to&&(r=i.deviceId===e.fromDeviceId),e.flow=r?"out":"in","robot"===e.type&&e.content&&e.content.msgOut&&(e.flow="in")},o.getType=function(e){var t=e.type;return s[t]||t},e.exports=o},function(e,t,r){e.exports=function(e,t,r,n){var i=self||window;try{try{var o;try{o=new i.Blob([e])}catch(t){(o=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),o=o.getBlob()}var s=i.URL||i.webkitURL,a=s.createObjectURL(o),c=new i[t](a,r);return s.revokeObjectURL(a),c}catch(n){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),r)}}catch(e){if(!n)throw Error("Inline worker is not supported");return new i[t](n,r)}}},function(e,t,r){r(225).polyfill(),r(14).isBrowser=!0},function(e,t,r){var n=r(289);r(56),e.exports=n},function(e,t,r){var n=r(2),i=r(1),o=r(16),s=r(104),a=r(136),c=r(290),u=r(87),l=r(45),d=r(54),p=r(291),m=r(292),f=r(106),h=r(293),g=r(18),v=r(294),y=g("toStringTag"),b=i.Error,S=[].push,T=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=o(_,this);a?r=a(new b,i?s(this):_):(r=i?this:u(_),l(r,y,"Error")),void 0!==t&&l(r,"message",h(t)),v&&l(r,"stack",p(r.stack,1)),m(r,n);var c=[];return f(e,S,{that:c}),l(r,"errors",c),r};a?a(T,b):c(T,b,{name:!0});var _=T.prototype=u(b.prototype,{constructor:d(1,T),message:d(1,""),name:d(1,"AggregateError")});n({global:!0},{AggregateError:T})},function(e,t,r){var n=r(2),i=r(31),o=r(40),s=r(93),a=r(115),c=r(106);n({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=s.f(t),n=r.resolve,u=r.reject,l=a((function(){var r=o(t.resolve),s=[],a=0,u=1;c(e,(function(e){var o=a++,c=!1;u++,i(r,t,e).then((function(e){c||(c=!0,s[o]={status:"fulfilled",value:e},--u||n(s))}),(function(e){c||(c=!0,s[o]={status:"rejected",reason:e},--u||n(s))}))})),--u||n(s)}));return l.error&&u(l.value),r.promise}})},function(e,t,r){var n=r(2),i=r(40),o=r(37),s=r(31),a=r(93),c=r(115),u=r(106);n({target:"Promise",stat:!0},{any:function(e){var t=this,r=o("AggregateError"),n=a.f(t),l=n.resolve,d=n.reject,p=c((function(){var n=i(t.resolve),o=[],a=0,c=1,p=!1;u(e,(function(e){var i=a++,u=!1;c++,s(n,t,e).then((function(e){u||p||(p=!0,l(e))}),(function(e){u||p||(u=!0,o[i]=e,--c||d(new r(o,"No one promise resolved")))}))})),--c||d(new r(o,"No one promise resolved"))}));return p.error&&d(p.value),n.promise}})},function(e,t,r){e.exports=r(328)},function(e,t,r){var n=r(378),i=r(381),o=r(209),s=r(387);e.exports=function(e){return n(e)||i(e)||o(e)||s()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(379)},function(e,t,r){var n=r(384),i=r(191),o=r(190);e.exports=function(e,t){var r;if(e){if("string"==typeof e)return o(e,t);var s=n(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?i(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?o(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(389)},function(e,t,r){(function(n){var i,o=r(27),s=r(17),a=r(30),c=r(4),u=r(3),l=r(49),d=r(13),p=r(10),m=r(19);!function(f,h){var g,v=(f=void 0!==f?f:"undefined"!=typeof self?self:void 0!==n?n:{}).IDBKeyRange||f.webkitIDBKeyRange,y="readwrite",b=Object.prototype.hasOwnProperty,S=function(){if(!g&&!(g=f.indexedDB||f.webkitIndexedDB||f.mozIndexedDB||f.oIndexedDB||f.msIndexedDB||(null===f.indexedDB&&f.shimIndexedDB?f.shimIndexedDB:void 0)))throw"IndexedDB required";return g},T=function(e){return e},_=function(e){var t;return s(t=Object.prototype.toString.call(e)).call(t,8,-1).toLowerCase()},w=function(e){return"function"==typeof e},M=function(e){return"number"===_(e)},x=function(e){return"array"===_(e)},E=function(e){return void 0===e},C=function(e,t){var r=this,n=!1;this.name=t,this.getIndexedDB=function(){return e},this.add=function(t){if(n)throw"Database has been closed";for(var i=[],o=0,s=0;s<arguments.length-1;s++)if(a(arguments[s+1]))for(var d=0;d<arguments[s+1].length;d++)i[o]=arguments[s+1][d],o++;else i[o]=arguments[s+1],o++;var p=e.transaction(t,y),m=p.objectStore(t);return new c((function(e,t){u(i).call(i,(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=m.add(e,r)}else t=m.add(e);t.onsuccess=function(t){var r=t.target,n=r.source.keyPath;null===n&&(n="__id__"),l(e,n,{value:r.result,enumerable:!0})}})),p.oncomplete=function(){e(i,r)},p.onerror=function(e){e.preventDefault(),t(e)},p.onabort=function(e){t(e)}}))},this.updateAndDelete=function(t,r,i){if(n)throw"Database has been closed";var o=e.transaction(t,y),s=o.objectStore(t),a=s.keyPath;return new c((function(e,t){u(r).call(r,(function(e){if(e.item&&e.key){var t=e.key;e=e.item,s.put(e,t)}else s.put(e)})),u(i).call(i,(function(e){s.delete(e[a])})),o.oncomplete=function(){e([r,i])},o.onerror=function(e){t(e)}}))},this.update=function(t){if(n)throw"Database has been closed";for(var i,o=[],s=1;s<arguments.length;s++)a(i=arguments[s])?o=d(o).call(o,i):o.push(i);var l=e.transaction(t,y),p=l.objectStore(t);return p.keyPath,new c((function(e,t){u(o).call(o,(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=p.put(e,r)}else t=p.put(e);t.onsuccess=function(e){},t.onerror=function(e){}})),l.oncomplete=function(){e(o,r)},l.onerror=function(e){t(e)},l.onabort=function(e){t(e)}}))},this.remove=function(t,r,i,o,s,l,d){if(n)throw"Database has been closed";var p=e.transaction(t,y),m=p.objectStore(t);return new c((function(e,t){function n(e){return null==e}var c;n(o)&&(o=-1/0),n(s)&&(s=1/0),null===r||a(r)||(r=[r]),n(i)?null!==r?u(r).call(r,(function(e){m.delete(e)})):m.delete(range=v.bound(o,s,l,d)):(c=null!==r?v.only(r[0]):v.bound(o,s,l,d),m.index(i).openCursor(c).onsuccess=function(e){var t=e.target.result;t&&(t.delete(),t.continue())}),p.oncomplete=function(){e()},p.onerror=function(e){t(e)},p.onabort=function(e){t(e)}}))},this.clear=function(t){if(n)throw"Database has been closed";var r=e.transaction(t,y);return r.objectStore(t).clear(),new c((function(e,t){r.oncomplete=function(){e()},r.onerror=function(e){t(e)}}))},this.close=function(){n||(e.close(),n=!0,delete A[t])},this.get=function(t,r){if(n)throw"Database has been closed";var i=e.transaction(t),o=i.objectStore(t).get(r);return new c((function(e,t){o.onsuccess=function(t){e(t.target.result)},i.onerror=function(e){t(e)}}))},this.query=function(t,r){if(n)throw"Database has been closed";return new R(t,e,r)},this.count=function(t,r){if(n)throw"Database has been closed";e.transaction(t).objectStore(t)};for(var i=0,o=e.objectStoreNames.length;i<o;i++)!function(e){for(var t in r[e]={},r)b.call(r,t)&&"close"!==t&&(r[e][t]=function(t){return function(){var n,i=d(n=[e]).call(n,s([]).call(arguments,0));return r[t].apply(r,i)}}(t))}(e.objectStoreNames[i])},R=function(e,t,r){var n,i=this,a=!1,l=!1,d=function(n,i,s,d,m,f,h){return new c((function(c,g){var b=a||l?y:"readonly",S=t.transaction(e,b),T=S.objectStore(e),_=r?T.index(r):T,M=n?v[n].apply(null,i):null,x=[],E=[M],C=0;m=m||null,f=f||[],"count"!==s&&E.push(d||"next");var R=!!a&&p(a);_[s].apply(_,E).onsuccess=function(e){var t=e.target.result;if(o(t)===o(0))x=t;else if(t)if(null!==m&&m[0]>C)C=m[0],t.advance(m[0]);else if(null!==m&&C>=m[0]+m[1]);else{var r=!0,n="value"in t?t.value:t.key;u(f).call(f,(function(e){e&&e.length&&(2===e.length?r=r&&n[e[0]]===e[1]:w(e[0])&&(r=r&&e[0].apply(void 0,[n])))})),r&&(C++,x.push(h(n)),l?t.delete():a&&(n=function(e){for(var t=0;t<R.length;t++){var r=R[t],n=a[r];n instanceof Function&&(n=n(e)),e[r]=n}return e}(n),t.update(n))),t.continue()}},S.oncomplete=function(){c(x)},S.onerror=function(e){g(e)},S.onabort=function(e){g(e)}}))},f=function(e,t){var r="next",n="openCursor",i=[],o=null,c=T,u=!1,p=function(){return d(e,t,n,u?r+"unique":r,o,i,c)},m=function(){return r=null,n="count",{execute:p}},f=function e(){return 1==(o=x(arguments[0])?arguments[0]:s(Array.prototype).call(arguments,0,2)).length&&o.unshift(0),M(o[1])||(o=null),{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:e,map:_,remove:C}},h=function e(t){return(t=!!E(t)||!!t)&&(n="openKeyCursor"),{execute:p,keys:e,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:f,map:_,remove:C}},g=function e(){return i.push(s(Array.prototype).call(arguments,0,2)),{execute:p,count:m,keys:h,filter:e,asc:v,desc:y,distinct:b,modify:S,limit:f,map:_,remove:C}},v=function e(t){return t=!!E(t)||!!t,r=t?"next":"prev",{execute:p,count:m,keys:h,filter:g,asc:e,desc:y,distinct:b,modify:S,limit:f,map:_,remove:C}},y=function e(t){return t=!!E(t)||!!t,r=t?"prev":"next",{execute:p,count:m,keys:h,filter:g,asc:v,desc:e,distinct:b,modify:S,limit:f,map:_,remove:C}},b=function e(t){return t=!!E(t)||!!t,u=t,{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:e,modify:S,limit:f,map:_,remove:C}},S=function e(t){return a=t,{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:e,limit:f,map:_,remove:C}},_=function e(t){return w(t)&&(c=t),{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:f,map:e,remove:C}},C=function e(t){return t=!!E(t)||!!t,l=t,{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:f,map:_,remove:e}};return{execute:p,count:m,keys:h,filter:g,asc:v,desc:y,distinct:b,modify:S,limit:f,map:_,remove:C}};u(n="only bound upperBound lowerBound".split(" ")).call(n,(function(e){i[e]=function(){return new f(e,arguments)}})),this.filter=function(){var e=new f(null,null);return m(e).apply(e,arguments)},this.all=function(){return m(this).call(this)}},k=function(e,t,r,n){var i=e.target.result,o=new C(i,t);return A[t]=i,c.resolve(o)},A={},I={version:"0.10.2",open:function(e){var t;return new c((function(r,n){if(A[e.server])k({target:{result:A[e.server]}},e.server,e.version,e.schema).then(r,n);else{try{t=S().open(e.server,e.version)}catch(e){n(e)}t.onsuccess=function(t){k(t,e.server,e.version,e.schema).then(r,n)},t.onupgradeneeded=function(t){!function(e,t,r){for(var n in"function"==typeof t&&(t=t()),t){var i,o=t[n];for(var s in i=!b.call(t,n)||r.objectStoreNames.contains(n)?e.currentTarget.transaction.objectStore(n):r.createObjectStore(n,o.key),o.indexes){var a=o.indexes[s];try{i.index(s)}catch(e){i.createIndex(s,a.key||s,p(a).length?a:{unique:!1})}}}}(t,e.schema,t.target.result)},t.onerror=function(e){n(e)}}}))},remove:function(e){return new c((function(t,r){if(!e)return t();var n,i;o(e)===C&&(e=e.name),"string"==typeof e&&(n=A[e]),n&&"function"==typeof n.close&&n.close();try{i=S().deleteDatabase(e)}catch(e){r(e)}i.onsuccess=function(r){delete A[e],t(e)},i.onerror=function(e){r(e)},i.onblocked=function(e){r(e)}}))}};void 0!==e.exports?e.exports=I:void 0===(i=function(){return I}.call(t,r,t,e))||(e.exports=i)}(void 0)}).call(this,r(48))},function(e,t,r){e.exports=r(440)},function(e,t,r){e.exports=r(450)},function(e,t){var r={set:function(e,t,n){r[e]=t,n&&(n.support=t)}};e.exports=r},function(e,t,r){var n=r(10),i=r(3),o=r(23),s=r(0),a=s.notundef,c=s.fillPropertyWithDefault,u=n,l={},d={},p={},m=[],f={normal:0,advanced:1},h={manager:0,all:1};l.inviteMode=l.updateCustomMode=l.updateTeamMode=h;var g={0:"normal",1:"advanced"},v=l.joinMode={noVerify:0,needVerify:1,rejectAll:2};d.joinMode={0:"noVerify",1:"needVerify",2:"rejectAll"},p.joinMode=u(v),m.push("join");var y=l.beInviteMode={needVerify:0,noVerify:1};function b(e){var t;s.verifyOptions(e,"action","superTeam::SuperTeam"),s.verifyOptions(e,"teamId","superTeam::SuperTeam"),a(e.teamId)&&(this.teamId=e.teamId),a(e.type)&&(this.type=f[e.type]),a(e.avatar)&&(this.avatar=""+e.avatar),a(e.name)&&(this.name=""+e.name),a(e.intro)&&(this.intro=""+e.intro),a(e.announcement)&&(this.announcement=""+e.announcement),a(e.custom)&&(this.custom=""+e.custom),a(e.inviteMode)&&(this.inviteMode=h[e.inviteMode]),a(e.updateCustomMode)&&(this.updateCustomMode=h[e.updateCustomMode]),a(e.updateTeamMode)&&(this.updateTeamMode=h[e.updateTeamMode]),i(m).call(m,o(t=this.setMode).call(t,this,e))}function S(e,t){a(e[t+="Mode"])&&(e[t]=d[t][e[t]])}d.beInviteMode={0:"needVerify",1:"noVerify"},m.push("beInvite"),d.inviteMode=d.updateCustomMode=d.updateTeamMode={0:"manager",1:"all"},m.push("invite"),m.push("updateCustom"),m.push("updateTeam"),p.inviteMode=p.updateCustomMode=p.updateTeamMode=u(h),p.beInviteMode=u(y),b.prototype.setMode=function(e,t){a(e[t+="Mode"])&&(s.verifyParamValid(t,e[t],p[t],"Superteam::Team"),this[t]=l[t][e[t]])},b.reverse=function(e,t){var r=s.copy(e);if(a(r.teamId)&&(r.teamId=""+r.teamId),a(r.type)&&(r.type=g[r.type]),a(r.level)&&(r.level=+r.level),a(r.valid)&&(r.valid=1==+r.valid),a(r.memberNum)&&(r.memberNum=+r.memberNum),a(r.memberUpdateTime)&&(r.memberUpdateTime=+r.memberUpdateTime),a(r.createTime)&&(r.createTime=+r.createTime),a(r.updateTime)&&(r.updateTime=+r.updateTime),a(r.validToCurrentUser)&&(r.validToCurrentUser="1"===r.validToCurrentUser),a(r.mute)&&(r.mute="1"===r.mute),a(r.muteType))switch(r.muteType){case"0":r.mute=!1,r.muteType="none";break;case"1":r.mute=!0,r.muteType="normal";break;case"3":r.mute=!0,r.muteType="all"}else a(r.mute)&&(1===r.mute?(r.mute=!0,r.muteType="normal"):(r.mute=!1,r.muteType="none"));return i(m).call(m,o(S).call(S,null,r)),delete r.bits,t||b.fillProperties(r),r},b.fillProperties=function(e){return c(e,"avatar","")},e.exports=b},function(e,t,r){var n=r(454);e.exports=n},function(e,t,r){var n,i=r(23),o=r(62),s=r(39),a=r(14),c=r(460),u=r(461),l={sdktype:"IM",platform:"Web",deviceId:s.deviceId,sdk_ver:a.info.version,manufactor:o.manufacturer,env:"online"},d={initUniErrReport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l.appkey=e.appKey,this.reporter=new c({common:l,request:u,logger:e.logger,autoStart:a.isBrowser}),a.isBrowser||this.reporter.pause()}};d.sendBeacon=navigator&&navigator.sendBeacon&&i(n=navigator.sendBeacon).call(n,navigator)||function(e,t){var r=new XMLHttpRequest;r.open("POST",e,!0),r.send(t)},e.exports=d},function(e,t,r){var n=r(0).notundef;function i(e){n(e.shouldPushNotificationWhenPCOnline)&&(this.open=e.shouldPushNotificationWhenPCOnline?2:1)}i.getDefaultConfig=function(){return{shouldPushNotificationWhenPCOnline:!0}},i.reverse=function(e){return{shouldPushNotificationWhenPCOnline:1!=+e.open}},e.exports=i},function(e,t,r){e.exports=r(535)},function(e,t,r){var n=r(536);function i(e,t,r,i,o,s,a){try{var c=e[s](a),u=c.value}catch(e){return void r(e)}c.done?t(u):n.resolve(u).then(i,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new n((function(n,o){var s=e.apply(t,r);function a(e){i(s,n,o,a,c,"next",e)}function c(e){i(s,n,o,a,c,"throw",e)}a(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(62),i=r(481),o=r(198),s=r(189),a=r(147),c=r(0),u=r(214),l=r(195),d=r(81),p=r(486),m=r(487);e.exports=function(e){c.merge(e,{platform:n,xhr:i,io:o,naturalSort:s,deepAccess:a,util:c,support:u,blob:l,ajax:d,LoggerPlugin:p,usePlugin:m})}},,,function(e,t,r){e.exports=r(472)},function(e,t,r){(function(t,r){var n;n=function(){function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,o=void 0,s=void 0,a=function(e,t){f[i]=e,f[i+1]=t,2===(i+=2)&&(s?s(h):S())},c="undefined"!=typeof window?window:void 0,u=c||{},l=u.MutationObserver||u.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function m(){var e=setTimeout;return function(){return e(h,1)}}var f=new Array(1e3);function h(){for(var e=0;e<i;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;i=0}var g,v,y,b,S=void 0;function T(e,t){var r=this,n=new this.constructor(M);void 0===n[w]&&N(n);var i=r._state;if(i){var o=arguments[i-1];a((function(){return O(i,n,o,r._result)}))}else A(r,n,e,t);return n}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(M);return E(t,e),t}d?S=function(){return t.nextTick(h)}:l?(v=0,y=new l(h),b=document.createTextNode(""),y.observe(b,{characterData:!0}),S=function(){b.data=v=++v%2}):p?((g=new MessageChannel).port1.onmessage=h,S=function(){return g.port2.postMessage(0)}):S=void 0===c?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(h)}:m()}catch(e){return m()}}():m();var w=Math.random().toString(36).substring(2);function M(){}function x(t,r,n){r.constructor===t.constructor&&n===T&&r.constructor.resolve===_?function(e,t){1===t._state?R(e,t._result):2===t._state?k(e,t._result):A(t,void 0,(function(t){return E(e,t)}),(function(t){return k(e,t)}))}(t,r):void 0===n?R(t,r):e(n)?function(e,t,r){a((function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,(function(r){n||(n=!0,t!==r?E(e,r):R(e,r))}),(function(t){n||(n=!0,k(e,t))}),e._label);!n&&i&&(n=!0,k(e,i))}),e)}(t,r,n):R(t,r)}function E(e,t){if(e===t)k(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)R(e,t);else{var r=void 0;try{r=t.then}catch(t){return void k(e,t)}x(e,t,r)}var n,i}function C(e){e._onerror&&e._onerror(e._result),I(e)}function R(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(I,e))}function k(e,t){void 0===e._state&&(e._state=2,e._result=t,a(C,e))}function A(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+1]=r,i[o+2]=n,0===o&&e._state&&a(I,e)}function I(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,s=0;s<t.length;s+=3)n=t[s],i=t[s+r],n?O(r,n,i,o):i(o);e._subscribers.length=0}}function O(t,r,n,i){var o=e(n),s=void 0,a=void 0,c=!0;if(o){try{s=n(i)}catch(e){c=!1,a=e}if(r===s)return void k(r,new TypeError("A promises callback cannot return that same promise."))}else s=i;void 0!==r._state||(o&&c?E(r,s):!1===c?k(r,a):1===t?R(r,s):2===t&&k(r,s))}var P=0;function N(e){e[w]=P++,e._state=void 0,e._result=void 0,e._subscribers=[]}var D=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(M),this.promise[w]||N(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&R(this.promise,this._result))):k(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===_){var i=void 0,o=void 0,s=!1;try{i=e.then}catch(e){s=!0,o=e}if(i===T&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===L){var a=new r(M);s?k(a,o):x(a,e,i),this._willSettleAt(a,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;void 0===n._state&&(this._remaining--,2===e?k(n,r):this._result[t]=r),0===this._remaining&&R(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;A(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))},e}(),L=function(){function t(e){this[w]=P++,this._result=this._state=void 0,this._subscribers=[],M!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){E(e,t)}),(function(t){k(e,t)}))}catch(t){k(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this.constructor;return e(t)?this.then((function(e){return r.resolve(t()).then((function(){return e}))}),(function(e){return r.resolve(t()).then((function(){throw e}))})):this.then(t,t)},t}();return L.prototype.then=T,L.all=function(e){return new D(this,e).promise},L.race=function(e){var t=this;return n(e)?new t((function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},L.resolve=_,L.reject=function(e){var t=new this(M);return k(t,e),t},L._setScheduler=function(e){s=e},L._setAsap=function(e){a=e},L._asap=a,L.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=L},L.Promise=L,L},e.exports=n()}).call(this,r(226),r(48))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&m())}function m(){if(!l){var e=a(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||l||a(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){var n=r(16),i=r(228),o=Array.prototype;e.exports=function(e){var t=e.indexOf;return e===o||n(o,e)&&t===o.indexOf?i:t}},function(e,t,r){r(229);var n=r(22);e.exports=n("Array").indexOf},function(e,t,r){var n=r(2),i=r(7),o=r(127).indexOf,s=r(69),a=i([].indexOf),c=!!a&&1/a([1],1,-0)<0,u=s("indexOf");n({target:"Array",proto:!0,forced:c||!u},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return c?a(this,e,t)||0:o(this,e,t)}})},function(e,t,r){var n=r(1),i=r(31),o=r(28),s=r(120),a=r(122),c=r(231),u=r(18),l=n.TypeError,d=u("toPrimitive");e.exports=function(e,t){if(!o(e)||s(e))return e;var r,n=a(e,d);if(n){if(void 0===t&&(t="default"),r=i(n,e,t),!o(r)||s(r))return r;throw l("Can't convert object to primitive value")}return void 0===t&&(t="number"),c(e,t)}},function(e,t,r){var n=r(1),i=r(31),o=r(21),s=r(28),a=n.TypeError;e.exports=function(e,t){var r,n;if("string"===t&&o(r=e.toString)&&!s(n=i(r,e)))return n;if(o(r=e.valueOf)&&!s(n=i(r,e)))return n;if("string"!==t&&o(r=e.toString)&&!s(n=i(r,e)))return n;throw a("Can't convert object to primitive value")}},function(e,t,r){var n=r(1),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(85),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=r(235);e.exports=n},function(e,t,r){var n=r(16),i=r(236),o=Array.prototype;e.exports=function(e){var t=e.concat;return e===o||n(o,e)&&t===o.concat?i:t}},function(e,t,r){r(159);var n=r(22);e.exports=n("Array").concat},function(e,t,r){var n=r(1),i=r(70),o=r(100),s=r(28),a=r(18)("species"),c=n.Array;e.exports=function(e){var t;return i(e)&&(t=e.constructor,(o(t)&&(t===c||i(t.prototype))||s(t)&&null===(t=t[a]))&&(t=void 0)),void 0===t?c:t}},function(e,t,r){var n=r(239);e.exports=n},function(e,t,r){r(240);var n=r(12).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){r(2)({target:"Object",stat:!0,sham:!r(24)},{create:r(87)})},function(e,t,r){var n=r(242);r(265),r(266),r(267),r(268),r(269),r(270),r(271),e.exports=n},function(e,t,r){var n=r(162);e.exports=n},function(e,t,r){r(159),r(88),r(163),r(246),r(247),r(248),r(249),r(166),r(250),r(251),r(252),r(253),r(254),r(255),r(256),r(257),r(258),r(259),r(260),r(261);var n=r(12);e.exports=n.Symbol},function(e,t,r){var n=r(129),i=r(46);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,r){var n=r(1),i=r(21),o=r(130),s=n.WeakMap;e.exports=i(s)&&/native code/.test(o(s))},function(e,t,r){r(20)("asyncIterator")},function(e,t){},function(e,t,r){r(20)("hasInstance")},function(e,t,r){r(20)("isConcatSpreadable")},function(e,t,r){r(20)("match")},function(e,t,r){r(20)("matchAll")},function(e,t,r){r(20)("replace")},function(e,t,r){r(20)("search")},function(e,t,r){r(20)("species")},function(e,t,r){r(20)("split")},function(e,t,r){r(20)("toPrimitive")},function(e,t,r){r(20)("toStringTag")},function(e,t,r){r(20)("unscopables")},function(e,t,r){var n=r(1);r(90)(n.JSON,"JSON",!0)},function(e,t){},function(e,t){},function(e,t,r){var n=r(169).IteratorPrototype,i=r(87),o=r(54),s=r(90),a=r(74),c=function(){return this};e.exports=function(e,t,r,u){var l=t+" Iterator";return e.prototype=i(n,{next:o(+!u,r)}),s(e,l,!1,!0),a[l]=c,e}},function(e,t,r){var n=r(1),i=r(21),o=n.String,s=n.TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw s("Can't set "+o(e)+" as a prototype")}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,r){r(20)("asyncDispose")},function(e,t,r){r(20)("dispose")},function(e,t,r){r(20)("matcher")},function(e,t,r){r(20)("metadata")},function(e,t,r){r(20)("observable")},function(e,t,r){r(20)("patternMatch")},function(e,t,r){r(20)("replaceAll")},function(e,t,r){e.exports=r(273)},function(e,t,r){var n=r(274);e.exports=n},function(e,t,r){var n=r(275);e.exports=n},function(e,t,r){var n=r(276);r(56),e.exports=n},function(e,t,r){r(73),r(88),r(105),r(166);var n=r(135);e.exports=n.f("iterator")},function(e,t,r){var n=r(7),i=r(85),o=r(43),s=r(84),a=n("".charAt),c=n("".charCodeAt),u=n("".slice),l=function(e){return function(t,r){var n,l,d=o(s(t)),p=i(r),m=d.length;return p<0||p>=m?e?"":void 0:(n=c(d,p))<55296||n>56319||p+1===m||(l=c(d,p+1))<56320||l>57343?e?a(d,p):n:e?u(d,p,p+2):l-56320+(n-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}},function(e,t,r){r(279);var n=r(12);e.exports=n.Array.isArray},function(e,t,r){r(2)({target:"Array",stat:!0},{isArray:r(70)})},function(e,t,r){r(56);var n=r(46),i=r(25),o=r(16),s=r(281),a=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.forEach;return e===a||o(a,e)&&t===a.forEach||i(c,n(e))?s:t}},function(e,t,r){var n=r(282);e.exports=n},function(e,t,r){r(283);var n=r(22);e.exports=n("Array").forEach},function(e,t,r){var n=r(2),i=r(284);n({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},function(e,t,r){var n=r(78).forEach,i=r(69)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},function(e,t,r){e.exports=r(286)},function(e,t,r){var n=r(287);e.exports=n},function(e,t,r){r(288);var n=r(12).Object;e.exports=function(e){return n.getOwnPropertyNames(e)}},function(e,t,r){var n=r(2),i=r(9),o=r(164).f;n({target:"Object",stat:!0,forced:i((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:o})},function(e,t,r){r(203),r(73),r(88),r(295),r(204),r(205),r(306),r(105);var n=r(12);e.exports=n.Promise},function(e,t,r){var n=r(25),i=r(172),o=r(65),s=r(41);e.exports=function(e,t,r){for(var a=i(t),c=s.f,u=o.f,l=0;l<a.length;l++){var d=a[l];n(e,d)||r&&n(r,d)||c(e,d,u(t,d))}}},function(e,t,r){var n=r(7)("".replace),i=String(Error("zxcasd").stack),o=/\n\s*at [^:]*:[^\n]*/,s=o.test(i);e.exports=function(e,t){if(s&&"string"==typeof e)for(;t--;)e=n(e,o,"");return e}},function(e,t,r){var n=r(28),i=r(45);e.exports=function(e,t){n(t)&&"cause"in t&&i(e,"cause",t.cause)}},function(e,t,r){var n=r(43);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},function(e,t,r){var n=r(9),i=r(54);e.exports=!n((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)}))},function(e,t,r){var n,i,o,s,a=r(2),c=r(55),u=r(1),l=r(37),d=r(31),p=r(176),m=r(72),f=r(296),h=r(136),g=r(90),v=r(297),y=r(40),b=r(21),S=r(28),T=r(298),_=r(130),w=r(106),M=r(177),x=r(178),E=r(179).set,C=r(300),R=r(182),k=r(303),A=r(93),I=r(115),O=r(304),P=r(103),N=r(157),D=r(18),L=r(305),j=r(108),U=r(67),F=D("species"),$="Promise",B=P.getterFor($),V=P.set,H=P.getterFor($),W=p&&p.prototype,q=p,z=W,G=u.TypeError,J=u.document,K=u.process,Q=A.f,Y=Q,X=!!(J&&J.createEvent&&u.dispatchEvent),Z=b(u.PromiseRejectionEvent),ee=!1,te=N($,(function(){var e=_(q),t=e!==String(q);if(!t&&66===U)return!0;if(c&&!z.finally)return!0;if(U>=51&&/native code/.test(e))return!1;var r=new q((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[F]=n,!(ee=r.then((function(){}))instanceof n)||!t&&L&&!Z})),re=te||!M((function(e){q.all(e).catch((function(){}))})),ne=function(e){var t;return!(!S(e)||!b(t=e.then))&&t},ie=function(e,t){var r,n,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{a?(s||(2===t.rejection&&ue(t),t.rejection=1),!0===a?r=o:(l&&l.enter(),r=a(o),l&&(l.exit(),i=!0)),r===e.promise?u(G("Promise-chain cycle")):(n=ne(r))?d(n,r,c,u):c(r)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},oe=function(e,t){e.notified||(e.notified=!0,C((function(){for(var r,n=e.reactions;r=n.get();)ie(r,e);e.notified=!1,t&&!e.rejection&&ae(e)})))},se=function(e,t,r){var n,i;X?((n=J.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u.dispatchEvent(n)):n={promise:t,reason:r},!Z&&(i=u["on"+e])?i(n):"unhandledrejection"===e&&k("Unhandled promise rejection",r)},ae=function(e){d(E,u,(function(){var t,r=e.facade,n=e.value;if(ce(e)&&(t=I((function(){j?K.emit("unhandledRejection",n,r):se("unhandledrejection",r,n)})),e.rejection=j||ce(e)?2:1,t.error))throw t.value}))},ce=function(e){return 1!==e.rejection&&!e.parent},ue=function(e){d(E,u,(function(){var t=e.facade;j?K.emit("rejectionHandled",t):se("rejectionhandled",t,e.value)}))},le=function(e,t,r){return function(n){e(t,n,r)}},de=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,oe(e,!0))},pe=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw G("Promise can't be resolved itself");var n=ne(t);n?C((function(){var r={done:!1};try{d(n,t,le(pe,r,e),le(de,r,e))}catch(t){de(r,t,e)}})):(e.value=t,e.state=1,oe(e,!1))}catch(t){de({done:!1},t,e)}}};if(te&&(z=(q=function(e){T(this,z),y(e),d(n,this);var t=B(this);try{e(le(pe,t),le(de,t))}catch(e){de(t,e)}}).prototype,(n=function(e){V(this,{type:$,done:!1,notified:!1,parent:!1,reactions:new O,rejection:!1,state:0,value:void 0})}).prototype=f(z,{then:function(e,t){var r=H(this),n=Q(x(this,q));return r.parent=!0,n.ok=!b(e)||e,n.fail=b(t)&&t,n.domain=j?K.domain:void 0,0==r.state?r.reactions.add(n):C((function(){ie(n,r)})),n.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n,t=B(e);this.promise=e,this.resolve=le(pe,t),this.reject=le(de,t)},A.f=Q=function(e){return e===q||e===o?new i(e):Y(e)},!c&&b(p)&&W!==Object.prototype)){s=W.then,ee||(m(W,"then",(function(e,t){var r=this;return new q((function(e,t){d(s,r,e,t)})).then(e,t)}),{unsafe:!0}),m(W,"catch",z.catch,{unsafe:!0}));try{delete W.constructor}catch(e){}h&&h(W,z)}a({global:!0,wrap:!0,forced:te},{Promise:q}),g(q,$,!1,!0),v($),o=l($),a({target:$,stat:!0,forced:te},{reject:function(e){var t=Q(this);return d(t.reject,void 0,e),t.promise}}),a({target:$,stat:!0,forced:c||te},{resolve:function(e){return R(c&&this===o?q:this,e)}}),a({target:$,stat:!0,forced:re},{all:function(e){var t=this,r=Q(t),n=r.resolve,i=r.reject,o=I((function(){var r=y(t.resolve),o=[],s=0,a=1;w(e,(function(e){var c=s++,u=!1;a++,d(r,t,e).then((function(e){u||(u=!0,o[c]=e,--a||n(o))}),i)})),--a||n(o)}));return o.error&&i(o.value),r.promise},race:function(e){var t=this,r=Q(t),n=r.reject,i=I((function(){var i=y(t.resolve);w(e,(function(e){d(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}})},function(e,t,r){var n=r(72);e.exports=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:n(e,i,t[i],r);return e}},function(e,t,r){var n=r(37),i=r(41),o=r(18),s=r(24),a=o("species");e.exports=function(e){var t=n(e),r=i.f;s&&t&&!t[a]&&r(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(1),i=r(16),o=n.TypeError;e.exports=function(e,t){if(i(t,e))return e;throw o("Incorrect invocation")}},function(e,t,r){var n=r(1),i=r(100),o=r(98),s=n.TypeError;e.exports=function(e){if(i(e))return e;throw s(o(e)+" is not a constructor")}},function(e,t,r){var n,i,o,s,a,c,u,l,d=r(1),p=r(68),m=r(65).f,f=r(179).set,h=r(181),g=r(301),v=r(302),y=r(108),b=d.MutationObserver||d.WebKitMutationObserver,S=d.document,T=d.process,_=d.Promise,w=m(d,"queueMicrotask"),M=w&&w.value;M||(n=function(){var e,t;for(y&&(e=T.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?s():o=void 0,e}}o=void 0,e&&e.enter()},h||y||v||!b||!S?!g&&_&&_.resolve?((u=_.resolve(void 0)).constructor=_,l=p(u.then,u),s=function(){l(n)}):y?s=function(){T.nextTick(n)}:(f=p(f,d),s=function(){f(n)}):(a=!0,c=S.createTextNode(""),new b(n).observe(c,{characterData:!0}),s=function(){c.data=a=!a})),e.exports=M||function(e){var t={fn:e,next:void 0};o&&(o.next=t),i||(i=t,s()),o=t}},function(e,t,r){var n=r(44),i=r(1);e.exports=/ipad|iphone|ipod/i.test(n)&&void 0!==i.Pebble},function(e,t,r){var n=r(44);e.exports=/web0s(?!.*chrome)/i.test(n)},function(e,t,r){var n=r(1);e.exports=function(e,t){var r=n.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}},function(e,t){var r=function(){this.head=null,this.tail=null};r.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=r},function(e,t){e.exports="object"==typeof window},function(e,t,r){var n=r(2),i=r(55),o=r(176),s=r(9),a=r(37),c=r(21),u=r(178),l=r(182),d=r(72);if(n({target:"Promise",proto:!0,real:!0,forced:!!o&&s((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=u(this,a("Promise")),r=c(e);return this.then(r?function(r){return l(t,e()).then((function(){return r}))}:e,r?function(r){return l(t,e()).then((function(){throw r}))}:e)}}),!i&&c(o)){var p=a("Promise").prototype.finally;o.prototype.finally!==p&&d(o.prototype,"finally",p,{unsafe:!0})}},function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function o(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,n||e,o),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},u.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,n,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,o),!0;case 6:return l.fn.call(l.context,t,r,n,o,s),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,m=l.length;for(u=0;u<m;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,n);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,n){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return c(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||n&&!s.once||r&&s.context!==r||c(this,o);else{for(var a=0,u=[],l=s.length;a<l;a++)(s[a].fn!==t||n&&!s[a].once||r&&s[a].context!==r)&&u.push(s[a]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&c(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,e.exports=u},function(e,t,r){r(105),r(309);var n=r(12);e.exports=n.Array.from},function(e,t,r){var n=r(2),i=r(310);n({target:"Array",stat:!0,forced:!r(177)((function(e){Array.from(e)}))},{from:i})},function(e,t,r){var n=r(1),i=r(68),o=r(31),s=r(33),a=r(311),c=r(173),u=r(100),l=r(38),d=r(71),p=r(174),m=r(107),f=n.Array;e.exports=function(e){var t=s(e),r=u(this),n=arguments.length,h=n>1?arguments[1]:void 0,g=void 0!==h;g&&(h=i(h,n>2?arguments[2]:void 0));var v,y,b,S,T,_,w=m(t),M=0;if(!w||this==f&&c(w))for(v=l(t),y=r?new this(v):f(v);v>M;M++)_=g?h(t[M],M):t[M],d(y,M,_);else for(T=(S=p(t,w)).next,y=r?new this:[];!(b=o(T,S)).done;M++)_=g?a(S,h,[b.value,M],!0):b.value,d(y,M,_);return y.length=M,y}},function(e,t,r){var n=r(34),i=r(175);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},function(e,t,r){var n=r(313);e.exports=n},function(e,t,r){var n=r(314);e.exports=n},function(e,t,r){var n=r(315);r(56),e.exports=n},function(e,t,r){r(73),r(105);var n=r(107);e.exports=n},function(e,t,r){r(163);var n=r(12);e.exports=n.Object.getOwnPropertySymbols},function(e,t,r){var n=r(318);e.exports=n},function(e,t,r){r(319);var n=r(12).Object,i=e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)};n.getOwnPropertyDescriptor.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(9),o=r(35),s=r(65).f,a=r(24),c=i((function(){s(1)}));n({target:"Object",stat:!0,forced:!a||c,sham:!a},{getOwnPropertyDescriptor:function(e,t){return s(o(e),t)}})},function(e,t,r){var n=r(321);e.exports=n},function(e,t,r){r(322);var n=r(12);e.exports=n.Object.getOwnPropertyDescriptors},function(e,t,r){var n=r(2),i=r(24),o=r(172),s=r(35),a=r(65),c=r(71);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=s(e),i=a.f,u=o(n),l={},d=0;u.length>d;)void 0!==(r=i(n,t=u[d++]))&&c(l,t,r);return l}})},function(e,t,r){var n=r(324);e.exports=n},function(e,t,r){r(325);var n=r(12).Object,i=e.exports=function(e,t){return n.defineProperties(e,t)};n.defineProperties.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(24),o=r(131).f;n({target:"Object",stat:!0,forced:Object.defineProperties!==o,sham:!i},{defineProperties:o})},function(e,t,r){r(327);var n=r(12).Object,i=e.exports=function(e,t,r){return n.defineProperty(e,t,r)};n.defineProperty.sham&&(i.sham=!0)},function(e,t,r){var n=r(2),i=r(24),o=r(41).f;n({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!i},{defineProperty:o})},function(e,t,r){var n=r(329);e.exports=n},function(e,t,r){var n=r(185);e.exports=n},function(e,t,r){var n=r(16),i=r(331),o=Array.prototype;e.exports=function(e){var t=e.slice;return e===o||n(o,e)&&t===o.slice?i:t}},function(e,t,r){r(332);var n=r(22);e.exports=n("Array").slice},function(e,t,r){var n=r(2),i=r(1),o=r(70),s=r(100),a=r(28),c=r(99),u=r(38),l=r(35),d=r(71),p=r(18),m=r(86),f=r(89),h=m("slice"),g=p("species"),v=i.Array,y=Math.max;n({target:"Array",proto:!0,forced:!h},{slice:function(e,t){var r,n,i,p=l(this),m=u(p),h=c(e,m),b=c(void 0===t?m:t,m);if(o(p)&&(r=p.constructor,(s(r)&&(r===v||o(r.prototype))||a(r)&&null===(r=r[g]))&&(r=void 0),r===v||void 0===r))return f(p,h,b);for(n=new(void 0===r?v:r)(y(b-h,0)),i=0;h<b;h++,i++)h in p&&d(n,i,p[h]);return n.length=i,n}})},function(e,t,r){r(334);var n=r(12);e.exports=n.Object.keys},function(e,t,r){var n=r(2),i=r(33),o=r(92);n({target:"Object",stat:!0,forced:r(9)((function(){o(1)}))},{keys:function(e){return o(i(e))}})},function(e,t,r){var n=r(336);e.exports=n},function(e,t,r){var n=r(16),i=r(337),o=Array.prototype;e.exports=function(e){var t=e.some;return e===o||n(o,e)&&t===o.some?i:t}},function(e,t,r){r(338);var n=r(22);e.exports=n("Array").some},function(e,t,r){var n=r(2),i=r(78).some;n({target:"Array",proto:!0,forced:!r(69)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(340);e.exports=n},function(e,t,r){var n=r(16),i=r(341),o=Array.prototype;e.exports=function(e){var t=e.splice;return e===o||n(o,e)&&t===o.splice?i:t}},function(e,t,r){r(342);var n=r(22);e.exports=n("Array").splice},function(e,t,r){var n=r(2),i=r(1),o=r(99),s=r(85),a=r(38),c=r(33),u=r(128),l=r(71),d=r(86)("splice"),p=i.TypeError,m=Math.max,f=Math.min;n({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var r,n,i,d,h,g,v=c(this),y=a(v),b=o(e,y),S=arguments.length;if(0===S?r=n=0:1===S?(r=0,n=y-b):(r=S-2,n=f(m(s(t),0),y-b)),y+r-n>9007199254740991)throw p("Maximum allowed length exceeded");for(i=u(v,n),d=0;d<n;d++)(h=b+d)in v&&l(i,d,v[h]);if(i.length=n,r<n){for(d=b;d<y-n;d++)g=d+r,(h=d+n)in v?v[g]=v[h]:delete v[g];for(d=y;d>y-n+r;d--)delete v[d-1]}else if(r>n)for(d=y-n;d>b;d--)g=d+r-1,(h=d+n-1)in v?v[g]=v[h]:delete v[g];for(d=0;d<r;d++)v[d+b]=arguments[d+2];return v.length=y-n+r,i}})},function(e,t,r){var n=r(344);e.exports=n},function(e,t,r){var n=r(16),i=r(345),o=Array.prototype;e.exports=function(e){var t=e.sort;return e===o||n(o,e)&&t===o.sort?i:t}},function(e,t,r){r(346);var n=r(22);e.exports=n("Array").sort},function(e,t,r){var n=r(2),i=r(7),o=r(40),s=r(33),a=r(38),c=r(43),u=r(9),l=r(347),d=r(69),p=r(348),m=r(349),f=r(67),h=r(350),g=[],v=i(g.sort),y=i(g.push),b=u((function(){g.sort(void 0)})),S=u((function(){g.sort(null)})),T=d("sort"),_=!u((function(){if(f)return f<70;if(!(p&&p>3)){if(m)return!0;if(h)return h<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)g.push({k:t+n,v:r})}for(g.sort((function(e,t){return t.v-e.v})),n=0;n<g.length;n++)t=g[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));n({target:"Array",proto:!0,forced:b||!S||!T||!_},{sort:function(e){void 0!==e&&o(e);var t=s(this);if(_)return void 0===e?v(t):v(t,e);var r,n,i=[],u=a(t);for(n=0;n<u;n++)n in t&&y(i,t[n]);for(l(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:c(t)>c(r)?1:-1}}(e)),r=i.length,n=0;n<r;)t[n]=i[n++];for(;n<u;)delete t[n++];return t}})},function(e,t,r){var n=r(165),i=Math.floor,o=function(e,t){var r=e.length,c=i(r/2);return r<8?s(e,t):a(e,o(n(e,0,c),t),o(n(e,c),t),t)},s=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},a=function(e,t,r,n){for(var i=t.length,o=r.length,s=0,a=0;s<i||a<o;)e[s+a]=s<i&&a<o?n(t[s],r[a])<=0?t[s++]:r[a++]:s<i?t[s++]:r[a++];return e};e.exports=o},function(e,t,r){var n=r(44).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},function(e,t,r){var n=r(44);e.exports=/MSIE|Trident/.test(n)},function(e,t,r){var n=r(44).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},function(e,t,r){var n=r(352);e.exports=n},function(e,t,r){var n=r(16),i=r(353),o=Array.prototype;e.exports=function(e){var t=e.map;return e===o||n(o,e)&&t===o.map?i:t}},function(e,t,r){r(354);var n=r(22);e.exports=n("Array").map},function(e,t,r){var n=r(2),i=r(78).map;n({target:"Array",proto:!0,forced:!r(86)("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(356);e.exports=n},function(e,t,r){r(357);var n=r(12),i=r(53);n.JSON||(n.JSON={stringify:JSON.stringify}),e.exports=function(e,t,r){return i(n.JSON.stringify,null,arguments)}},function(e,t,r){var n=r(2),i=r(1),o=r(37),s=r(53),a=r(7),c=r(9),u=i.Array,l=o("JSON","stringify"),d=a(/./.exec),p=a("".charAt),m=a("".charCodeAt),f=a("".replace),h=a(1..toString),g=/[\uD800-\uDFFF]/g,v=/^[\uD800-\uDBFF]$/,y=/^[\uDC00-\uDFFF]$/,b=function(e,t,r){var n=p(r,t-1),i=p(r,t+1);return d(v,e)&&!d(y,i)||d(y,e)&&!d(v,n)?"\\u"+h(m(e,0),16):e},S=c((function(){return'"\\udf06\\ud834"'!==l("\udf06\ud834")||'"\\udead"'!==l("\udead")}));l&&n({target:"JSON",stat:!0,forced:S},{stringify:function(e,t,r){for(var n=0,i=arguments.length,o=u(i);n<i;n++)o[n]=arguments[n];var a=s(l,null,o);return"string"==typeof a?f(a,g,b):a}})},function(e,t,r){var n=r(359);e.exports=n},function(e,t,r){var n=r(16),i=r(360),o=Array.prototype;e.exports=function(e){var t=e.reduce;return e===o||n(o,e)&&t===o.reduce?i:t}},function(e,t,r){r(361);var n=r(22);e.exports=n("Array").reduce},function(e,t,r){var n=r(2),i=r(362).left,o=r(69),s=r(67),a=r(108);n({target:"Array",proto:!0,forced:!o("reduce")||!a&&s>79&&s<83},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(1),i=r(40),o=r(33),s=r(96),a=r(38),c=n.TypeError,u=function(e){return function(t,r,n,u){i(r);var l=o(t),d=s(l),p=a(l),m=e?p-1:0,f=e?-1:1;if(n<2)for(;;){if(m in d){u=d[m],m+=f;break}if(m+=f,e?m<0:p<=m)throw c("Reduce of empty array with no initial value")}for(;e?m>=0:p>m;m+=f)m in d&&(u=r(u,d[m],m,l));return u}};e.exports={left:u(!1),right:u(!0)}},function(e,t,r){var n=r(364);e.exports=n},function(e,t,r){var n=r(16),i=r(365),o=Array.prototype;e.exports=function(e){var t=e.lastIndexOf;return e===o||n(o,e)&&t===o.lastIndexOf?i:t}},function(e,t,r){r(366);var n=r(22);e.exports=n("Array").lastIndexOf},function(e,t,r){var n=r(2),i=r(367);n({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},function(e,t,r){var n=r(53),i=r(35),o=r(85),s=r(38),a=r(69),c=Math.min,u=[].lastIndexOf,l=!!u&&1/[1].lastIndexOf(1,-0)<0,d=a("lastIndexOf"),p=l||!d;e.exports=p?function(e){if(l)return n(u,this,arguments)||0;var t=i(this),r=s(t),a=r-1;for(arguments.length>1&&(a=c(a,o(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===e)return a||0;return-1}:u},function(e,t,r){r(188);var n=r(12);e.exports=n.setTimeout},function(e,t,r){var n=r(370);e.exports=n},function(e,t,r){var n=r(16),i=r(371),o=Array.prototype;e.exports=function(e){var t=e.filter;return e===o||n(o,e)&&t===o.filter?i:t}},function(e,t,r){r(372);var n=r(22);e.exports=n("Array").filter},function(e,t,r){var n=r(2),i=r(78).filter;n({target:"Array",proto:!0,forced:!r(86)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){e.exports=r(374)},function(e,t,r){r(56);var n=r(46),i=r(25),o=r(16),s=r(375),a=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.values;return e===a||o(a,e)&&t===a.values||i(c,n(e))?s:t}},function(e,t,r){var n=r(376);e.exports=n},function(e,t,r){r(73),r(88);var n=r(22);e.exports=n("Array").values},function(e,t,r){var n=r(14);"undefined"!=typeof window&&(window.console||n.isWeixinApp||(window.console={log:function(){},info:function(){},warn:function(){},error:function(){}}))},function(e,t,r){var n=r(208),i=r(190);e.exports=function(e){if(n(e))return i(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(380);e.exports=n},function(e,t,r){var n=r(171);e.exports=n},function(e,t,r){var n=r(145),i=r(75),o=r(191);e.exports=function(e){if(void 0!==n&&null!=i(e)||null!=e["@@iterator"])return o(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(383);e.exports=n},function(e,t,r){var n=r(183);e.exports=n},function(e,t,r){e.exports=r(385)},function(e,t,r){var n=r(386);e.exports=n},function(e,t,r){var n=r(186);e.exports=n},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(3),i=r(10),o=r(6),s=r(76),a=r(11),c=r(17),u=r(13),l=r(4),d=r(62),p=r(0),m=r(14),f=r(39),h={};function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!e.logLevel&&e.debug&&(e.logLevel="debug"),p.merge(this,{options:e,debugEnable:!1,api:"log",style:"color:blue;",logLevel:e.logLevel&&e.logLevel.toLowerCase()||"off",debug:p.emptyFunc,log:p.emptyFunc,info:p.emptyFunc,warn:p.emptyFunc,error:p.emptyFunc}),this.prefix=e.prefix||"",this.localEnable=h.enable&&e.dbLog&&e.account,this.setDebug(e.debug),this.localEnable&&(this._local=new h(e.account,e.expire),this._local.logError=this.error)}h=r(397);var v=g.prototype,y=["Chrome","Safari","Firefox"],b={debug:1e3,log:2e3,info:3e3,warn:4e3,error:5e3,off:6e3};function S(e){var t,r=[];return n(t=i(b)).call(t,(function(t){b[t]>=b[e]&&r.push(t)})),r}v.setDebug=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;if(t.debugEnable=e||"debug"===t.logLevel,e.style&&(t.style=e.style),p.exist(console))if("off"!==t.logLevel){var r=console,i=S(t.logLevel);n(i).call(i,(function(e){t[e]=function(){var r=t.formatArgsAndSave(arguments,e);-1!==o(y).call(y,d.name)&&p.isString(r[0])&&(r[0]="%c"+r[0],s(r).call(r,1,0,t.style)),t._log(e,r)}})),t.options.logFunc?t._log=function(){}:t._log=function(e,n){if("debug"===e&&(e="log"),r[e])try{r[e].apply?t.chrome(e,n):t.ie(e,n)}catch(e){}},t.chrome=function(e,n){-1!==o(y).call(y,d.name)?r[e].apply(r,n):t.ie(e,n)},t.ie=function(e,t){n(t).call(t,(function(t){r[e](a(t,null,4))}))}}else if(m.isRN||this.localEnable||this.options.logFunc){var c=!m.isRN&&!this.localEnable;t.log=function(){t.formatArgsAndSave(arguments,"log",c)},t.info=function(){t.formatArgsAndSave(arguments,"info",c)},t.warn=function(){t.formatArgsAndSave(arguments,"warn",c)},t.error=function(){t.formatArgsAndSave(arguments,"error",c)},t.debug=function(){t.formatArgsAndSave(arguments,"error",c)}}},v.setLogDisabled=function(){this.localEnable=!1,this.log=function(){},this.info=function(){},this.warn=function(){},this.error=function(){},this.debug=function(){}},v.formatArgsAndSave=function(e,t,r){var i,o;e=c([]).call(e,0);var l=new Date,d=T(l.getMonth()+1)+"-"+T(l.getDate())+" "+T(l.getHours())+":"+T(l.getMinutes())+":"+T(l.getSeconds())+":"+T(l.getMilliseconds(),3),m=u(i=u(o="[NIM ".concat(t.toUpperCase()," ")).call(o,d," ")).call(i,this.prefix.toUpperCase(),"]  "),f="";p.isString(e[0])?e[0]=m+e[0]:s(e).call(e,0,0,m),n(e).call(e,(function(t,r){p.isArray(t)||p.isObject(t)?(e[r]=p.simpleClone(t),f+=a(e[r])+" "):f+=t+" "}));var h=this.options.logFunc;return h&&p.isFunction(h[t])&&h[t].apply(h,e),!r&&this.writeLocalLog(f,t,+l),e},v.writeLocalLog=m.isRN?function(e,t){if(f.rnfs&&f.rnfs.writeFile&&f.rnfs.appendFile&&f.rnfs.DocumentDirectoryPath&&/error|warn|info/.test(t)){var r,n=f.rnfs,i=n.size/2-256;e+="\r\n",n.nimPromise=n.nimPromise.then((function(){return r=o(n.nimIndex),n.exists(r)})).then((function(t){return t?n.appendFile(r,e):n.writeFile(r,e)})).then((function(){return n.stat(r)})).then((function(e){if(e.size>i)return n.nimIndex++,n.nimIndex>1&&(n.nimIndex=n.nimIndex%2),n.unlink(o(n.nimIndex)).catch((function(){return l.resolve()}))})).catch((function(){}))}function o(e){return f.rnfs.DocumentDirectoryPath+"/nimlog_"+e+".log"}}:m.isBrowser?function(e,t,r){this._local&&this._local.saveLog({log:e,level:t,time:r})}:function(){};var T=function(e,t){t=t||2;for(var r=""+e;r.length<t;)r="0"+r;return r};e.exports=g},function(e,t,r){var n=r(390);e.exports=n},function(e,t,r){r(391);var n=r(12);e.exports=n.parseFloat},function(e,t,r){var n=r(2),i=r(392);n({global:!0,forced:parseFloat!=i},{parseFloat:i})},function(e,t,r){var n=r(1),i=r(9),o=r(7),s=r(43),a=r(137).trim,c=r(111),u=o("".charAt),l=n.parseFloat,d=n.Symbol,p=d&&d.iterator,m=1/l(c+"-0")!=-1/0||p&&!i((function(){l(Object(p))}));e.exports=m?function(e){var t=a(s(e)),r=l(t);return 0===r&&"-"==u(t,0)?-0:r}:l},function(e,t,r){var n=r(394);e.exports=n},function(e,t,r){r(395);var n=r(12);e.exports=n.parseInt},function(e,t,r){var n=r(2),i=r(396);n({global:!0,forced:parseInt!=i},{parseInt:i})},function(e,t,r){var n=r(1),i=r(9),o=r(7),s=r(43),a=r(137).trim,c=r(111),u=n.parseInt,l=n.Symbol,d=l&&l.iterator,p=/^[+-]?0x/i,m=o(p.exec),f=8!==u(c+"08")||22!==u(c+"0x16")||d&&!i((function(){u(Object(d))}));e.exports=f?function(e,t){var r=a(s(e));return u(r,t>>>0||(m(p,r)?16:10))}:u},function(e,t,r){var n=r(17),i=r(4),o=r(398),s=r(399),a=r(0).getGlobal(),c=r(62).name,u="function"==typeof o,l=a.indexedDB&&!/^(IE)$/.test(c);function d(e,t){this.logWorker=null,this.db=null,this.logQueue=[],this.callbackList=[],this.preTime=null,this.lastTime=+new Date,this.initLogLocal({name:e,expire:t})}var p=d.prototype;d.enable=!0,p.saveLog=function(e){var t,r=this.logQueue.length,i=this.logQueue[r-1];e.time!==this.preTime?((this.logQueue.length>50||e.time-this.lastTime>6e4&&this.logQueue.length>0)&&(this.doSaveLog(n(t=this.logQueue).call(t,0)),this.lastTime=i.time,this.logQueue=[]),this.logQueue.push(e),this.preTime=e.time):i.log+="\r\n"+e.log},p.doSaveLog=function(){},p.initLogLocal=function(){},p.fetchLog=function(){},p.deleteLogs=function(){},p.logError=function(){},l?u?(p.doSaveLog=function(e){this.logWorker.postMessage(e)},p.initLogLocal=function(e){var t=this;this.logWorker=new o({}),this.logWorker.onmessage=function(e){var r=e.data||{};switch(r.type){case"fetchDone":t.fetchLogDone(r.code,r.msg);break;case"error":t.logError(r.msg)}},this.logWorker.postMessage({type:"init",msg:e})},p.fetchLog=function(){var e=this;return new i((function(t,r){0===e.callbackList.length&&e.logWorker.postMessage({type:"fetch"}),e.callbackList.push(t),e.callbackList.push(r)}))},p.fetchLogDone=function(e,t){for(var r=200===e?0:1,n=0;n<this.callbackList.length/2;n++)this.callbackList[2*n+r](t);this.callbackList=[]},p.deleteLogs=function(e){return this.logWorker.postMessage({type:"delete",msg:e}),i.resolve()}):(p.doSaveLog=function(e){var t=this;this.db.putLog(e).catch((function(e){t.logError({msg:"putLog error",error:e})}))},p.initLogLocal=function(e){var t=this;this.db=new s(e),this.db.init().catch((function(e){t.logError({msg:"dbLog init error",error:e})}))},p.fetchLog=function(){return this.db.getAllLogs()},p.deleteLogs=function(e){return this.db.deleteLogs(e)}):d.enable=!1,e.exports=d},function(e,t,r){r.r(t),r.d(t,"default",(function(){return o}));var n=r(200),i=r.n(n);function o(){return i()('!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=98)}([function(t,n,e){(function(n){var e=function(t){return t&&t.Math==Math&&t};t.exports=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof n&&n)||function(){return this}()||Function("return this")()}).call(this,e(74))},function(t,n,e){var r=e(15),o=e(7),i=e(72),c=e(14).f;t.exports=function(t){var n=r.Symbol||(r.Symbol={});o(n,t)||c(n,t,{value:i.f(t)})}},function(t,n,e){var r=e(0),o=e(52),i=e(7),c=e(54),u=e(50),a=e(77),f=o("wks"),s=r.Symbol,p=s&&s.for,l=a?s:s&&s.withoutSetter||c;t.exports=function(t){if(!i(f,t)||!u&&"string"!=typeof f[t]){var n="Symbol."+t;u&&i(s,t)?f[t]=s[t]:f[t]=a&&p?p(n):l(n)}return f[t]}},function(t,n){t.exports=function(t){return"function"==typeof t}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(31),o=Function.prototype,i=o.bind,c=o.call,u=r&&i.bind(c,c);t.exports=r?function(t){return t&&u(t)}:function(t){return t&&function(){return c.apply(t,arguments)}}},function(t,n,e){"use strict";var r=e(0),o=e(47),i=e(5),c=e(3),u=e(32).f,a=e(79),f=e(15),s=e(27),p=e(17),l=e(7),v=function(t){var n=function(e,r,i){if(this instanceof n){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,i)}return o(t,this,arguments)};return n.prototype=t.prototype,n};t.exports=function(t,n){var e,o,d,h,y,m,g,x,b=t.target,w=t.global,j=t.stat,S=t.proto,O=w?r:j?r[b]:(r[b]||{}).prototype,P=w?f:f[b]||p(f,b,{})[b],A=P.prototype;for(d in n)e=!a(w?d:b+(j?".":"#")+d,t.forced)&&O&&l(O,d),y=P[d],e&&(m=t.noTargetGet?(x=u(O,d))&&x.value:O[d]),h=e&&m?m:n[d],e&&typeof y==typeof h||(g=t.bind&&e?s(h,r):t.wrap&&e?v(h):S&&c(h)?i(h):h,(t.sham||h&&h.sham||y&&y.sham)&&p(g,"sham",!0),p(P,d,g),S&&(l(f,o=b+"Prototype")||p(f,o,{}),p(f[o],d,h),t.real&&A&&!A[d]&&p(A,d,h)))}},function(t,n,e){var r=e(5),o=e(21),i=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,n){return i(o(t),n)}},function(t,n,e){var r=e(3);t.exports=function(t){return"object"==typeof t?null!==t:r(t)}},function(t,n,e){var r=e(4);t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,n,e){var r=e(31),o=Function.prototype.call;t.exports=r?o.bind(o):function(){return o.apply(o,arguments)}},function(t,n,e){var r=e(0),o=e(8),i=r.String,c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not an object")}},function(t,n,e){var r=e(15),o=e(0),i=e(3),c=function(t){return i(t)?t:void 0};t.exports=function(t,n){return arguments.length<2?c(r[t])||c(o[t]):r[t]&&r[t][n]||o[t]&&o[t][n]}},function(t,n,e){var r=e(5);t.exports=r({}.isPrototypeOf)},function(t,n,e){var r=e(0),o=e(9),i=e(78),c=e(80),u=e(11),a=e(33),f=r.TypeError,s=Object.defineProperty,p=Object.getOwnPropertyDescriptor;n.f=o?c?function(t,n,e){if(u(t),n=a(n),u(e),"function"==typeof t&&"prototype"===n&&"value"in e&&"writable"in e&&!e.writable){var r=p(t,n);r&&r.writable&&(t[n]=e.value,e={configurable:"configurable"in e?e.configurable:r.configurable,enumerable:"enumerable"in e?e.enumerable:r.enumerable,writable:!1})}return s(t,n,e)}:s:function(t,n,e){if(u(t),n=a(n),u(e),i)try{return s(t,n,e)}catch(t){}if("get"in e||"set"in e)throw f("Accessors not supported");return"value"in e&&(t[n]=e.value),t}},function(t,n){t.exports={}},function(t,n,e){var r=e(76),o=e(48);t.exports=function(t){return r(o(t))}},function(t,n,e){var r=e(9),o=e(14),i=e(18);t.exports=r?function(t,n,e){return o.f(t,n,i(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,e){var r=e(0),o=e(3),i=e(36),c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not a function")}},function(t,n){t.exports=!0},function(t,n,e){var r=e(0),o=e(48),i=r.Object;t.exports=function(t){return i(o(t))}},function(t,n,e){var r=e(111);t.exports=function(t){return r(t.length)}},function(t,n){t.exports={}},function(t,n,e){var r=e(0),o=e(63),i=e(3),c=e(26),u=e(2)("toStringTag"),a=r.Object,f="Arguments"==c(function(){return arguments}());t.exports=o?c:function(t){var n,e,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,n){try{return t[n]}catch(t){}}(n=a(t),u))?e:f?c(n):"Object"==(r=c(n))&&i(n.callee)?"Arguments":r}},function(t,n,e){var r=e(17);t.exports=function(t,n,e,o){o&&o.enumerable?t[n]=e:r(t,n,e)}},function(t,n,e){var r=e(5),o=r({}.toString),i=r("".slice);t.exports=function(t){return i(o(t),8,-1)}},function(t,n,e){var r=e(5),o=e(19),i=e(31),c=r(r.bind);t.exports=function(t,n){return o(t),void 0===n?t:i?c(t,n):function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(63),o=e(14).f,i=e(17),c=e(7),u=e(123),a=e(2)("toStringTag");t.exports=function(t,n,e,f){if(t){var s=e?t:t.prototype;c(s,a)||o(s,a,{configurable:!0,value:n}),f&&!r&&i(s,"toString",u)}}},function(t,n,e){var r=e(26);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){var r=e(15);t.exports=function(t){return r[t+"Prototype"]}},function(t,n,e){var r=e(4);t.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},function(t,n,e){var r=e(9),o=e(10),i=e(75),c=e(18),u=e(16),a=e(33),f=e(7),s=e(78),p=Object.getOwnPropertyDescriptor;n.f=r?p:function(t,n){if(t=u(t),n=a(n),s)try{return p(t,n)}catch(t){}if(f(t,n))return c(!o(i.f,t,n),t[n])}},function(t,n,e){var r=e(103),o=e(49);t.exports=function(t){var n=r(t,"string");return o(n)?n:n+""}},function(t,n,e){var r,o,i=e(0),c=e(35),u=i.process,a=i.Deno,f=u&&u.versions||a&&a.version,s=f&&f.v8;s&&(o=(r=s.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!o&&c&&(!(r=c.match(/Edge\\/(\\d+)/))||r[1]>=74)&&(r=c.match(/Chrome\\/(\\d+)/))&&(o=+r[1]),t.exports=o},function(t,n,e){var r=e(12);t.exports=r("navigator","userAgent")||""},function(t,n,e){var r=e(0).String;t.exports=function(t){try{return r(t)}catch(t){return"Object"}}},function(t,n,e){var r=e(52),o=e(54),i=r("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},function(t,n){t.exports={}},function(t,n,e){var r,o=e(11),i=e(83),c=e(61),u=e(38),a=e(84),f=e(55),s=e(37),p=s("IE_PROTO"),l=function(){},v=function(t){return"<script>"+t+"<\\/script>"},d=function(t){t.write(v("")),t.close();var n=t.parentWindow.Object;return t=null,n},h=function(){try{r=new ActiveXObject("htmlfile")}catch(t){}var t,n;h="undefined"!=typeof document?document.domain&&r?d(r):((n=f("iframe")).style.display="none",a.appendChild(n),n.src=String("javascript:"),(t=n.contentWindow.document).open(),t.write(v("document.F=Object")),t.close(),t.F):d(r);for(var e=c.length;e--;)delete h.prototype[c[e]];return h()};u[p]=!0,t.exports=Object.create||function(t,n){var e;return null!==t?(l.prototype=o(t),e=new l,l.prototype=null,e[p]=t):e=h(),void 0===n?e:i.f(e,n)}},function(t,n,e){var r=e(0),o=e(27),i=e(10),c=e(11),u=e(36),a=e(114),f=e(22),s=e(13),p=e(115),l=e(85),v=e(116),d=r.TypeError,h=function(t,n){this.stopped=t,this.result=n},y=h.prototype;t.exports=function(t,n,e){var r,m,g,x,b,w,j,S=e&&e.that,O=!(!e||!e.AS_ENTRIES),P=!(!e||!e.IS_ITERATOR),A=!(!e||!e.INTERRUPTED),E=o(n,S),k=function(t){return r&&v(r,"normal",t),new h(!0,t)},T=function(t){return O?(c(t),A?E(t[0],t[1],k):E(t[0],t[1])):A?E(t,k):E(t)};if(P)r=t;else{if(!(m=l(t)))throw d(u(t)+" is not iterable");if(a(m)){for(g=0,x=f(t);x>g;g++)if((b=T(t[g]))&&s(y,b))return b;return new h(!1)}r=p(t,m)}for(w=r.next;!(j=i(w,r)).done;){try{b=T(j.value)}catch(t){v(r,"throw",t)}if("object"==typeof b&&b&&s(y,b))return b}return new h(!1)}},function(t,n,e){var r=e(0),o=e(24),i=r.String;t.exports=function(t){if("Symbol"===o(t))throw TypeError("Cannot convert a Symbol value to a string");return i(t)}},function(t,n,e){var r,o,i,c=e(120),u=e(0),a=e(5),f=e(8),s=e(17),p=e(7),l=e(53),v=e(37),d=e(38),h=u.TypeError,y=u.WeakMap;if(c||l.state){var m=l.state||(l.state=new y),g=a(m.get),x=a(m.has),b=a(m.set);r=function(t,n){if(x(m,t))throw new h("Object already initialized");return n.facade=t,b(m,t,n),n},o=function(t){return g(m,t)||{}},i=function(t){return x(m,t)}}else{var w=v("state");d[w]=!0,r=function(t,n){if(p(t,w))throw new h("Object already initialized");return n.facade=t,s(t,w,n),n},o=function(t){return p(t,w)?t[w]:{}},i=function(t){return p(t,w)}}t.exports={set:r,get:o,has:i,enforce:function(t){return i(t)?o(t):r(t,{})},getterFor:function(t){return function(n){var e;if(!f(n)||(e=o(n)).type!==t)throw h("Incompatible receiver, "+t+" required");return e}}}},function(t,n,e){"use strict";var r=e(19),o=function(t){var n,e;this.promise=new t((function(t,r){if(void 0!==n||void 0!==e)throw TypeError("Bad Promise constructor");n=t,e=r})),this.resolve=r(n),this.reject=r(e)};t.exports.f=function(t){return new o(t)}},function(t,n,e){e(64);var r=e(141),o=e(0),i=e(24),c=e(17),u=e(23),a=e(2)("toStringTag");for(var f in r){var s=o[f],p=s&&s.prototype;p&&i(p)!==a&&c(p,a,f),u[f]=u.Array}},function(t,n,e){var r=e(4),o=e(2),i=e(34),c=o("species");t.exports=function(t){return i>=51||!r((function(){var n=[];return(n.constructor={})[c]=function(){return{foo:1}},1!==n[t](Boolean).foo}))}},function(t,n,e){var r=e(27),o=e(5),i=e(76),c=e(21),u=e(22),a=e(95),f=o([].push),s=function(t){var n=1==t,e=2==t,o=3==t,s=4==t,p=6==t,l=7==t,v=5==t||p;return function(d,h,y,m){for(var g,x,b=c(d),w=i(b),j=r(h,y),S=u(w),O=0,P=m||a,A=n?P(d,S):e||l?P(d,0):void 0;S>O;O++)if((v||O in w)&&(x=j(g=w[O],O,b),t))if(n)A[O]=x;else if(x)switch(t){case 3:return!0;case 5:return g;case 6:return O;case 2:f(A,g)}else switch(t){case 4:return!1;case 7:f(A,g)}return p?-1:o||s?s:A}};t.exports={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6),filterReject:s(7)}},function(t,n,e){var r=e(31),o=Function.prototype,i=o.apply,c=o.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?c.bind(i):function(){return c.apply(i,arguments)})},function(t,n,e){var r=e(0).TypeError;t.exports=function(t){if(null==t)throw r("Can\'t call method on "+t);return t}},function(t,n,e){var r=e(0),o=e(12),i=e(3),c=e(13),u=e(77),a=r.Object;t.exports=u?function(t){return"symbol"==typeof t}:function(t){var n=o("Symbol");return i(n)&&c(n.prototype,a(t))}},function(t,n,e){var r=e(34),o=e(4);t.exports=!!Object.getOwnPropertySymbols&&!o((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},function(t,n,e){var r=e(19);t.exports=function(t,n){var e=t[n];return null==e?void 0:r(e)}},function(t,n,e){var r=e(20),o=e(53);(t.exports=function(t,n){return o[t]||(o[t]=void 0!==n?n:{})})("versions",[]).push({version:"3.21.1",mode:r?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(t,n,e){var r=e(0),o=e(105),i=r["__core-js_shared__"]||o("__core-js_shared__",{});t.exports=i},function(t,n,e){var r=e(5),o=0,i=Math.random(),c=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+c(++o+i,36)}},function(t,n,e){var r=e(0),o=e(8),i=r.document,c=o(i)&&o(i.createElement);t.exports=function(t){return c?i.createElement(t):{}}},function(t,n,e){var r=e(0),o=e(7),i=e(3),c=e(21),u=e(37),a=e(106),f=u("IE_PROTO"),s=r.Object,p=s.prototype;t.exports=a?s.getPrototypeOf:function(t){var n=c(t);if(o(n,f))return n[f];var e=n.constructor;return i(e)&&n instanceof e?e.prototype:n instanceof s?p:null}},function(t,n,e){var r=e(5),o=e(11),i=e(107);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,n=!1,e={};try{(t=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(e,[]),n=e instanceof Array}catch(t){}return function(e,r){return o(e),i(r),n?t(e,r):e.__proto__=r,e}}():void 0)},function(t,n,e){var r=e(81),o=e(61).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n,e){var r=e(60),o=Math.max,i=Math.min;t.exports=function(t,n){var e=r(t);return e<0?o(e+n,0):i(e,n)}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){var n=+t;return n!=n||0===n?0:(n>0?r:e)(n)}},function(t,n){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,n,e){var r=e(81),o=e(61);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r={};r[e(2)("toStringTag")]="z",t.exports="[object z]"===String(r)},function(t,n,e){"use strict";var r=e(16),o=e(119),i=e(23),c=e(42),u=e(14).f,a=e(86),f=e(20),s=e(9),p=c.set,l=c.getterFor("Array Iterator");t.exports=a(Array,"Array",(function(t,n){p(this,{type:"Array Iterator",target:r(t),index:0,kind:n})}),(function(){var t=l(this),n=t.target,e=t.kind,r=t.index++;return!n||r>=n.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==e?{value:r,done:!1}:"values"==e?{value:n[r],done:!1}:{value:[r,n[r]],done:!1}}),"values");var v=i.Arguments=i.Array;if(o("keys"),o("values"),o("entries"),!f&&s&&"values"!==v.name)try{u(v,"name",{value:"values"})}catch(t){}},function(t,n,e){var r=e(5),o=e(3),i=e(53),c=r(Function.toString);o(i.inspectSource)||(i.inspectSource=function(t){return c(t)}),t.exports=i.inspectSource},function(t,n){},function(t,n,e){var r=e(5),o=e(4),i=e(3),c=e(24),u=e(12),a=e(65),f=function(){},s=[],p=u("Reflect","construct"),l=/^\\s*(?:class|function)\\b/,v=r(l.exec),d=!l.exec(f),h=function(t){if(!i(t))return!1;try{return p(f,s,t),!0}catch(t){return!1}},y=function(t){if(!i(t))return!1;switch(c(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!v(l,a(t))}catch(t){return!0}};y.sham=!0,t.exports=!p||o((function(){var t;return h(h.call)||!h(Object)||!h((function(){t=!0}))||t}))?y:h},function(t,n,e){var r=e(5);t.exports=r([].slice)},function(t,n,e){var r=e(26),o=e(0);t.exports="process"==r(o.process)},function(t,n){t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},function(t,n,e){"use strict";var r=e(33),o=e(14),i=e(18);t.exports=function(t,n,e){var c=r(n);c in t?o.f(t,c,i(0,e)):t[c]=e}},function(t,n,e){var r=e(2);n.f=r},function(t,n,e){t.exports=e(100)},function(t,n){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n,e){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);n.f=i?function(t){var n=o(this,t);return!!n&&n.enumerable}:r},function(t,n,e){var r=e(0),o=e(5),i=e(4),c=e(26),u=r.Object,a=o("".split);t.exports=i((function(){return!u("z").propertyIsEnumerable(0)}))?function(t){return"String"==c(t)?a(t,""):u(t)}:u},function(t,n,e){var r=e(50);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,n,e){var r=e(9),o=e(4),i=e(55);t.exports=!r&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(t,n,e){var r=e(4),o=e(3),i=/#|\\.prototype\\./,c=function(t,n){var e=a[u(t)];return e==s||e!=f&&(o(n)?r(n):!!n)},u=c.normalize=function(t){return String(t).replace(i,".").toLowerCase()},a=c.data={},f=c.NATIVE="N",s=c.POLYFILL="P";t.exports=c},function(t,n,e){var r=e(9),o=e(4);t.exports=r&&o((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(t,n,e){var r=e(5),o=e(7),i=e(16),c=e(110).indexOf,u=e(38),a=r([].push);t.exports=function(t,n){var e,r=i(t),f=0,s=[];for(e in r)!o(u,e)&&o(r,e)&&a(s,e);for(;n.length>f;)o(r,e=n[f++])&&(~c(s,e)||a(s,e));return s}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(9),o=e(80),i=e(14),c=e(11),u=e(16),a=e(62);n.f=r&&!o?Object.defineProperties:function(t,n){c(t);for(var e,r=u(n),o=a(n),f=o.length,s=0;f>s;)i.f(t,e=o[s++],r[e]);return t}},function(t,n,e){var r=e(12);t.exports=r("document","documentElement")},function(t,n,e){var r=e(24),o=e(51),i=e(23),c=e(2)("iterator");t.exports=function(t){if(null!=t)return o(t,c)||o(t,"@@iterator")||i[r(t)]}},function(t,n,e){"use strict";var r=e(6),o=e(10),i=e(20),c=e(121),u=e(3),a=e(122),f=e(56),s=e(57),p=e(28),l=e(17),v=e(25),d=e(2),h=e(23),y=e(87),m=c.PROPER,g=c.CONFIGURABLE,x=y.IteratorPrototype,b=y.BUGGY_SAFARI_ITERATORS,w=d("iterator"),j=function(){return this};t.exports=function(t,n,e,c,d,y,S){a(e,n,c);var O,P,A,E=function(t){if(t===d&&_)return _;if(!b&&t in L)return L[t];switch(t){case"keys":case"values":case"entries":return function(){return new e(this,t)}}return function(){return new e(this)}},k=n+" Iterator",T=!1,L=t.prototype,I=L[w]||L["@@iterator"]||d&&L[d],_=!b&&I||E(d),M="Array"==n&&L.entries||I;if(M&&(O=f(M.call(new t)))!==Object.prototype&&O.next&&(i||f(O)===x||(s?s(O,x):u(O[w])||v(O,w,j)),p(O,k,!0,!0),i&&(h[k]=j)),m&&"values"==d&&I&&"values"!==I.name&&(!i&&g?l(L,"name","values"):(T=!0,_=function(){return o(I,this)})),d)if(P={values:E("values"),keys:y?_:E("keys"),entries:E("entries")},S)for(A in P)(b||T||!(A in L))&&v(L,A,P[A]);else r({target:n,proto:!0,forced:b||T},P);return i&&!S||L[w]===_||v(L,w,_,{name:d}),h[n]=_,P}},function(t,n,e){"use strict";var r,o,i,c=e(4),u=e(3),a=e(39),f=e(56),s=e(25),p=e(2),l=e(20),v=p("iterator"),d=!1;[].keys&&("next"in(i=[].keys())?(o=f(f(i)))!==Object.prototype&&(r=o):d=!0),null==r||c((function(){var t={};return r[v].call(t)!==t}))?r={}:l&&(r=a(r)),u(r[v])||s(r,v,(function(){return this})),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:d}},function(t,n,e){var r=e(0);t.exports=r.Promise},function(t,n,e){var r=e(11),o=e(129),i=e(2)("species");t.exports=function(t,n){var e,c=r(t).constructor;return void 0===c||null==(e=r(c)[i])?n:o(e)}},function(t,n,e){var r,o,i,c,u=e(0),a=e(47),f=e(27),s=e(3),p=e(7),l=e(4),v=e(84),d=e(68),h=e(55),y=e(130),m=e(91),g=e(69),x=u.setImmediate,b=u.clearImmediate,w=u.process,j=u.Dispatch,S=u.Function,O=u.MessageChannel,P=u.String,A=0,E={};try{r=u.location}catch(t){}var k=function(t){if(p(E,t)){var n=E[t];delete E[t],n()}},T=function(t){return function(){k(t)}},L=function(t){k(t.data)},I=function(t){u.postMessage(P(t),r.protocol+"//"+r.host)};x&&b||(x=function(t){y(arguments.length,1);var n=s(t)?t:S(t),e=d(arguments,1);return E[++A]=function(){a(n,void 0,e)},o(A),A},b=function(t){delete E[t]},g?o=function(t){w.nextTick(T(t))}:j&&j.now?o=function(t){j.now(T(t))}:O&&!m?(c=(i=new O).port2,i.port1.onmessage=L,o=f(c.postMessage,c)):u.addEventListener&&s(u.postMessage)&&!u.importScripts&&r&&"file:"!==r.protocol&&!l(I)?(o=I,u.addEventListener("message",L,!1)):o="onreadystatechange"in h("script")?function(t){v.appendChild(h("script")).onreadystatechange=function(){v.removeChild(this),k(t)}}:function(t){setTimeout(T(t),0)}),t.exports={set:x,clear:b}},function(t,n,e){var r=e(35);t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},function(t,n,e){var r=e(11),o=e(8),i=e(43);t.exports=function(t,n){if(r(t),o(n)&&n.constructor===t)return n;var e=i.f(t);return(0,e.resolve)(n),e.promise}},function(t,n,e){"use strict";var r=e(140).charAt,o=e(41),i=e(42),c=e(86),u=i.set,a=i.getterFor("String Iterator");c(String,"String",(function(t){u(this,{type:"String Iterator",string:o(t),index:0})}),(function(){var t,n=a(this),e=n.string,o=n.index;return o>=e.length?{value:void 0,done:!0}:(t=r(e,o),n.index+=t.length,{value:t,done:!1})}))},function(t,n,e){t.exports=e(142)},function(t,n,e){var r=e(151);t.exports=function(t,n){return new(r(t))(0===n?0:n)}},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(4),c=e(29),u=e(8),a=e(21),f=e(22),s=e(71),p=e(95),l=e(45),v=e(2),d=e(34),h=v("isConcatSpreadable"),y=o.TypeError,m=d>=51||!i((function(){var t=[];return t[h]=!1,t.concat()[0]!==t})),g=l("concat"),x=function(t){if(!u(t))return!1;var n=t[h];return void 0!==n?!!n:c(t)};r({target:"Array",proto:!0,forced:!m||!g},{concat:function(t){var n,e,r,o,i,c=a(this),u=p(c,0),l=0;for(n=-1,r=arguments.length;n<r;n++)if(x(i=-1===n?c:arguments[n])){if(l+(o=f(i))>9007199254740991)throw y("Maximum allowed index exceeded");for(e=0;e<o;e++,l++)e in i&&s(u,l,i[e])}else{if(l>=9007199254740991)throw y("Maximum allowed index exceeded");s(u,l++,i)}return u.length=l,u}})},function(t,n,e){e(1)("iterator")},function(t,n,e){var r=e(99),o=null;function i(t){return t&&"string"!=typeof t?t.message?t.message:t.target&&t.target.error?t.target.error.message:"unknown error":t}self.onmessage=function(t){switch(t.data.type){case"init":e=t.data.msg,(o=new r(e)).init().catch((function(t){postMessage({type:"error",msg:{msg:"dbLog init error",error:i(t)}})}));break;case"fetch":o.getAllLogs().then((function(t){postMessage({type:"fetchDone",code:200,msg:t})})).catch((function(t){postMessage({type:"fetchDone",code:500,msg:i(t)})}));break;case"delete":o.deleteLogs(n).catch((function(t){postMessage({type:"deleteLogs",code:500,msg:i(t)})}));break;default:!function(t){if(!o)return;o.putLog(t).then((function(){postMessage(200)})).catch((function(t){postMessage({type:"error",msg:{msg:"putLog error",error:i(t)}})}))}(t.data)}var n,e}},function(t,n,e){var r=e(73),o=e(94),i=e(146),c=e(152),u={log:{key:{keyPath:"time"},indexes:{level:{unique:!1},time:{unique:!0}}}};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.server=null,this.expire=t.expire||72,this.name=t.name}var f=a.prototype;f.init=function(){var t=this;if(!this.server)return c.open({server:"nim-log-"+this.name,version:1,schema:u}).then((function(n){t.server=n}))},f.putLog=function(t){var n=this;if(!this.server)return r.reject("no db server");var e=o(t).call(t,-1)[0].time-36e5*this.expire;return this.deleteLogs(e).then((function(){return n.server.add("log",t)}))},f.getAllLogs=function(){return this.server?this.server.query("log","time").all().execute().then((function(t){var n={},e=o(t).call(t,-1)[0];return n.logs=i(t).call(t,(function(t){return t.log})).join("\\r\\n"),n.time=e&&e.time,n})):r.reject("no db server")},f.deleteLogs=function(t){return this.server?this.server.remove("log",null,"time",0,t):r.reject("no db server")},t.exports=a},function(t,n,e){var r=e(101);e(44),t.exports=r},function(t,n,e){e(102),e(64),e(66),e(124),e(137),e(138),e(139),e(93);var r=e(15);t.exports=r.Promise},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(13),c=e(56),u=e(57),a=e(108),f=e(39),s=e(17),p=e(18),l=e(112),v=e(113),d=e(40),h=e(117),y=e(2),m=e(118),g=y("toStringTag"),x=o.Error,b=[].push,w=function(t,n){var e,r=arguments.length>2?arguments[2]:void 0,o=i(j,this);u?e=u(new x,o?c(this):j):(e=o?this:f(j),s(e,g,"Error")),void 0!==n&&s(e,"message",h(n)),m&&s(e,"stack",l(e.stack,1)),v(e,r);var a=[];return d(t,b,{that:a}),s(e,"errors",a),e};u?u(w,x):a(w,x,{name:!0});var j=w.prototype=f(x.prototype,{constructor:p(1,w),message:p(1,""),name:p(1,"AggregateError")});r({global:!0},{AggregateError:w})},function(t,n,e){var r=e(0),o=e(10),i=e(8),c=e(49),u=e(51),a=e(104),f=e(2),s=r.TypeError,p=f("toPrimitive");t.exports=function(t,n){if(!i(t)||c(t))return t;var e,r=u(t,p);if(r){if(void 0===n&&(n="default"),e=o(r,t,n),!i(e)||c(e))return e;throw s("Can\'t convert object to primitive value")}return void 0===n&&(n="number"),a(t,n)}},function(t,n,e){var r=e(0),o=e(10),i=e(3),c=e(8),u=r.TypeError;t.exports=function(t,n){var e,r;if("string"===n&&i(e=t.toString)&&!c(r=o(e,t)))return r;if(i(e=t.valueOf)&&!c(r=o(e,t)))return r;if("string"!==n&&i(e=t.toString)&&!c(r=o(e,t)))return r;throw u("Can\'t convert object to primitive value")}},function(t,n,e){var r=e(0),o=Object.defineProperty;t.exports=function(t,n){try{o(r,t,{value:n,configurable:!0,writable:!0})}catch(e){r[t]=n}return n}},function(t,n,e){var r=e(4);t.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,n,e){var r=e(0),o=e(3),i=r.String,c=r.TypeError;t.exports=function(t){if("object"==typeof t||o(t))return t;throw c("Can\'t set "+i(t)+" as a prototype")}},function(t,n,e){var r=e(7),o=e(109),i=e(32),c=e(14);t.exports=function(t,n,e){for(var u=o(n),a=c.f,f=i.f,s=0;s<u.length;s++){var p=u[s];r(t,p)||e&&r(e,p)||a(t,p,f(n,p))}}},function(t,n,e){var r=e(12),o=e(5),i=e(58),c=e(82),u=e(11),a=o([].concat);t.exports=r("Reflect","ownKeys")||function(t){var n=i.f(u(t)),e=c.f;return e?a(n,e(t)):n}},function(t,n,e){var r=e(16),o=e(59),i=e(22),c=function(t){return function(n,e,c){var u,a=r(n),f=i(a),s=o(c,f);if(t&&e!=e){for(;f>s;)if((u=a[s++])!=u)return!0}else for(;f>s;s++)if((t||s in a)&&a[s]===e)return t||s||0;return!t&&-1}};t.exports={includes:c(!0),indexOf:c(!1)}},function(t,n,e){var r=e(60),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){var r=e(5)("".replace),o=String(Error("zxcasd").stack),i=/\\n\\s*at [^:]*:[^\\n]*/,c=i.test(o);t.exports=function(t,n){if(c&&"string"==typeof t)for(;n--;)t=r(t,i,"");return t}},function(t,n,e){var r=e(8),o=e(17);t.exports=function(t,n){r(n)&&"cause"in n&&o(t,"cause",n.cause)}},function(t,n,e){var r=e(2),o=e(23),i=r("iterator"),c=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||c[i]===t)}},function(t,n,e){var r=e(0),o=e(10),i=e(19),c=e(11),u=e(36),a=e(85),f=r.TypeError;t.exports=function(t,n){var e=arguments.length<2?a(t):n;if(i(e))return c(o(e,t));throw f(u(t)+" is not iterable")}},function(t,n,e){var r=e(10),o=e(11),i=e(51);t.exports=function(t,n,e){var c,u;o(t);try{if(!(c=i(t,"return"))){if("throw"===n)throw e;return e}c=r(c,t)}catch(t){u=!0,c=t}if("throw"===n)throw e;if(u)throw c;return o(c),e}},function(t,n,e){var r=e(41);t.exports=function(t,n){return void 0===t?arguments.length<2?"":n:r(t)}},function(t,n,e){var r=e(4),o=e(18);t.exports=!r((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",o(1,7)),7!==t.stack)}))},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(0),o=e(3),i=e(65),c=r.WeakMap;t.exports=o(c)&&/native code/.test(i(c))},function(t,n,e){var r=e(9),o=e(7),i=Function.prototype,c=r&&Object.getOwnPropertyDescriptor,u=o(i,"name"),a=u&&"something"===function(){}.name,f=u&&(!r||r&&c(i,"name").configurable);t.exports={EXISTS:u,PROPER:a,CONFIGURABLE:f}},function(t,n,e){"use strict";var r=e(87).IteratorPrototype,o=e(39),i=e(18),c=e(28),u=e(23),a=function(){return this};t.exports=function(t,n,e,f){var s=n+" Iterator";return t.prototype=o(r,{next:i(+!f,e)}),c(t,s,!1,!0),u[s]=a,t}},function(t,n,e){"use strict";var r=e(63),o=e(24);t.exports=r?{}.toString:function(){return"[object "+o(this)+"]"}},function(t,n,e){"use strict";var r,o,i,c,u=e(6),a=e(20),f=e(0),s=e(12),p=e(10),l=e(88),v=e(25),d=e(125),h=e(57),y=e(28),m=e(126),g=e(19),x=e(3),b=e(8),w=e(127),j=e(65),S=e(40),O=e(128),P=e(89),A=e(90).set,E=e(131),k=e(92),T=e(134),L=e(43),I=e(70),_=e(135),M=e(42),D=e(79),R=e(2),C=e(136),F=e(69),N=e(34),B=R("species"),G="Promise",z=M.getterFor(G),q=M.set,V=M.getterFor(G),U=l&&l.prototype,W=l,H=U,K=f.TypeError,J=f.document,Y=f.process,X=L.f,Q=X,Z=!!(J&&J.createEvent&&f.dispatchEvent),$=x(f.PromiseRejectionEvent),tt=!1,nt=D(G,(function(){var t=j(W),n=t!==String(W);if(!n&&66===N)return!0;if(a&&!H.finally)return!0;if(N>=51&&/native code/.test(t))return!1;var e=new W((function(t){t(1)})),r=function(t){t((function(){}),(function(){}))};return(e.constructor={})[B]=r,!(tt=e.then((function(){}))instanceof r)||!n&&C&&!$})),et=nt||!O((function(t){W.all(t).catch((function(){}))})),rt=function(t){var n;return!(!b(t)||!x(n=t.then))&&n},ot=function(t,n){var e,r,o,i=n.value,c=1==n.state,u=c?t.ok:t.fail,a=t.resolve,f=t.reject,s=t.domain;try{u?(c||(2===n.rejection&&ft(n),n.rejection=1),!0===u?e=i:(s&&s.enter(),e=u(i),s&&(s.exit(),o=!0)),e===t.promise?f(K("Promise-chain cycle")):(r=rt(e))?p(r,e,a,f):a(e)):f(i)}catch(t){s&&!o&&s.exit(),f(t)}},it=function(t,n){t.notified||(t.notified=!0,E((function(){for(var e,r=t.reactions;e=r.get();)ot(e,t);t.notified=!1,n&&!t.rejection&&ut(t)})))},ct=function(t,n,e){var r,o;Z?((r=J.createEvent("Event")).promise=n,r.reason=e,r.initEvent(t,!1,!0),f.dispatchEvent(r)):r={promise:n,reason:e},!$&&(o=f["on"+t])?o(r):"unhandledrejection"===t&&T("Unhandled promise rejection",e)},ut=function(t){p(A,f,(function(){var n,e=t.facade,r=t.value;if(at(t)&&(n=I((function(){F?Y.emit("unhandledRejection",r,e):ct("unhandledrejection",e,r)})),t.rejection=F||at(t)?2:1,n.error))throw n.value}))},at=function(t){return 1!==t.rejection&&!t.parent},ft=function(t){p(A,f,(function(){var n=t.facade;F?Y.emit("rejectionHandled",n):ct("rejectionhandled",n,t.value)}))},st=function(t,n,e){return function(r){t(n,r,e)}},pt=function(t,n,e){t.done||(t.done=!0,e&&(t=e),t.value=n,t.state=2,it(t,!0))},lt=function(t,n,e){if(!t.done){t.done=!0,e&&(t=e);try{if(t.facade===n)throw K("Promise can\'t be resolved itself");var r=rt(n);r?E((function(){var e={done:!1};try{p(r,n,st(lt,e,t),st(pt,e,t))}catch(n){pt(e,n,t)}})):(t.value=n,t.state=1,it(t,!1))}catch(n){pt({done:!1},n,t)}}};if(nt&&(H=(W=function(t){w(this,H),g(t),p(r,this);var n=z(this);try{t(st(lt,n),st(pt,n))}catch(t){pt(n,t)}}).prototype,(r=function(t){q(this,{type:G,done:!1,notified:!1,parent:!1,reactions:new _,rejection:!1,state:0,value:void 0})}).prototype=d(H,{then:function(t,n){var e=V(this),r=X(P(this,W));return e.parent=!0,r.ok=!x(t)||t,r.fail=x(n)&&n,r.domain=F?Y.domain:void 0,0==e.state?e.reactions.add(r):E((function(){ot(r,e)})),r.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new r,n=z(t);this.promise=t,this.resolve=st(lt,n),this.reject=st(pt,n)},L.f=X=function(t){return t===W||t===i?new o(t):Q(t)},!a&&x(l)&&U!==Object.prototype)){c=U.then,tt||(v(U,"then",(function(t,n){var e=this;return new W((function(t,n){p(c,e,t,n)})).then(t,n)}),{unsafe:!0}),v(U,"catch",H.catch,{unsafe:!0}));try{delete U.constructor}catch(t){}h&&h(U,H)}u({global:!0,wrap:!0,forced:nt},{Promise:W}),y(W,G,!1,!0),m(G),i=s(G),u({target:G,stat:!0,forced:nt},{reject:function(t){var n=X(this);return p(n.reject,void 0,t),n.promise}}),u({target:G,stat:!0,forced:a||nt},{resolve:function(t){return k(a&&this===i?W:this,t)}}),u({target:G,stat:!0,forced:et},{all:function(t){var n=this,e=X(n),r=e.resolve,o=e.reject,i=I((function(){var e=g(n.resolve),i=[],c=0,u=1;S(t,(function(t){var a=c++,f=!1;u++,p(e,n,t).then((function(t){f||(f=!0,i[a]=t,--u||r(i))}),o)})),--u||r(i)}));return i.error&&o(i.value),e.promise},race:function(t){var n=this,e=X(n),r=e.reject,o=I((function(){var o=g(n.resolve);S(t,(function(t){p(o,n,t).then(e.resolve,r)}))}));return o.error&&r(o.value),e.promise}})},function(t,n,e){var r=e(25);t.exports=function(t,n,e){for(var o in n)e&&e.unsafe&&t[o]?t[o]=n[o]:r(t,o,n[o],e);return t}},function(t,n,e){"use strict";var r=e(12),o=e(14),i=e(2),c=e(9),u=i("species");t.exports=function(t){var n=r(t),e=o.f;c&&n&&!n[u]&&e(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,e){var r=e(0),o=e(13),i=r.TypeError;t.exports=function(t,n){if(o(n,t))return t;throw i("Incorrect invocation")}},function(t,n,e){var r=e(2)("iterator"),o=!1;try{var i=0,c={next:function(){return{done:!!i++}},return:function(){o=!0}};c[r]=function(){return this},Array.from(c,(function(){throw 2}))}catch(t){}t.exports=function(t,n){if(!n&&!o)return!1;var e=!1;try{var i={};i[r]=function(){return{next:function(){return{done:e=!0}}}},t(i)}catch(t){}return e}},function(t,n,e){var r=e(0),o=e(67),i=e(36),c=r.TypeError;t.exports=function(t){if(o(t))return t;throw c(i(t)+" is not a constructor")}},function(t,n,e){var r=e(0).TypeError;t.exports=function(t,n){if(t<n)throw r("Not enough arguments");return t}},function(t,n,e){var r,o,i,c,u,a,f,s,p=e(0),l=e(27),v=e(32).f,d=e(90).set,h=e(91),y=e(132),m=e(133),g=e(69),x=p.MutationObserver||p.WebKitMutationObserver,b=p.document,w=p.process,j=p.Promise,S=v(p,"queueMicrotask"),O=S&&S.value;O||(r=function(){var t,n;for(g&&(t=w.domain)&&t.exit();o;){n=o.fn,o=o.next;try{n()}catch(t){throw o?c():i=void 0,t}}i=void 0,t&&t.enter()},h||g||m||!x||!b?!y&&j&&j.resolve?((f=j.resolve(void 0)).constructor=j,s=l(f.then,f),c=function(){s(r)}):g?c=function(){w.nextTick(r)}:(d=l(d,p),c=function(){d(r)}):(u=!0,a=b.createTextNode(""),new x(r).observe(a,{characterData:!0}),c=function(){a.data=u=!u})),t.exports=O||function(t){var n={fn:t,next:void 0};i&&(i.next=n),o||(o=n,c()),i=n}},function(t,n,e){var r=e(35),o=e(0);t.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==o.Pebble},function(t,n,e){var r=e(35);t.exports=/web0s(?!.*chrome)/i.test(r)},function(t,n,e){var r=e(0);t.exports=function(t,n){var e=r.console;e&&e.error&&(1==arguments.length?e.error(t):e.error(t,n))}},function(t,n){var e=function(){this.head=null,this.tail=null};e.prototype={add:function(t){var n={item:t,next:null};this.head?this.tail.next=n:this.head=n,this.tail=n},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}},t.exports=e},function(t,n){t.exports="object"==typeof window},function(t,n,e){"use strict";var r=e(6),o=e(10),i=e(19),c=e(43),u=e(70),a=e(40);r({target:"Promise",stat:!0},{allSettled:function(t){var n=this,e=c.f(n),r=e.resolve,f=e.reject,s=u((function(){var e=i(n.resolve),c=[],u=0,f=1;a(t,(function(t){var i=u++,a=!1;f++,o(e,n,t).then((function(t){a||(a=!0,c[i]={status:"fulfilled",value:t},--f||r(c))}),(function(t){a||(a=!0,c[i]={status:"rejected",reason:t},--f||r(c))}))})),--f||r(c)}));return s.error&&f(s.value),e.promise}})},function(t,n,e){"use strict";var r=e(6),o=e(19),i=e(12),c=e(10),u=e(43),a=e(70),f=e(40);r({target:"Promise",stat:!0},{any:function(t){var n=this,e=i("AggregateError"),r=u.f(n),s=r.resolve,p=r.reject,l=a((function(){var r=o(n.resolve),i=[],u=0,a=1,l=!1;f(t,(function(t){var o=u++,f=!1;a++,c(r,n,t).then((function(t){f||l||(l=!0,s(t))}),(function(t){f||l||(f=!0,i[o]=t,--a||p(new e(i,"No one promise resolved")))}))})),--a||p(new e(i,"No one promise resolved"))}));return l.error&&p(l.value),r.promise}})},function(t,n,e){"use strict";var r=e(6),o=e(20),i=e(88),c=e(4),u=e(12),a=e(3),f=e(89),s=e(92),p=e(25);if(r({target:"Promise",proto:!0,real:!0,forced:!!i&&c((function(){i.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var n=f(this,u("Promise")),e=a(t);return this.then(e?function(e){return s(n,t()).then((function(){return e}))}:t,e?function(e){return s(n,t()).then((function(){throw e}))}:t)}}),!o&&a(i)){var l=u("Promise").prototype.finally;i.prototype.finally!==l&&p(i.prototype,"finally",l,{unsafe:!0})}},function(t,n,e){var r=e(5),o=e(60),i=e(41),c=e(48),u=r("".charAt),a=r("".charCodeAt),f=r("".slice),s=function(t){return function(n,e){var r,s,p=i(c(n)),l=o(e),v=p.length;return l<0||l>=v?t?"":void 0:(r=a(p,l))<55296||r>56319||l+1===v||(s=a(p,l+1))<56320||s>57343?t?u(p,l):r:t?f(p,l,l+2):s-56320+(r-55296<<10)+65536}};t.exports={codeAt:s(!1),charAt:s(!0)}},function(t,n){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(t,n,e){var r=e(143);t.exports=r},function(t,n,e){var r=e(13),o=e(144),i=Array.prototype;t.exports=function(t){var n=t.slice;return t===i||r(i,t)&&n===i.slice?o:n}},function(t,n,e){e(145);var r=e(30);t.exports=r("Array").slice},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(29),c=e(67),u=e(8),a=e(59),f=e(22),s=e(16),p=e(71),l=e(2),v=e(45),d=e(68),h=v("slice"),y=l("species"),m=o.Array,g=Math.max;r({target:"Array",proto:!0,forced:!h},{slice:function(t,n){var e,r,o,l=s(this),v=f(l),h=a(t,v),x=a(void 0===n?v:n,v);if(i(l)&&(e=l.constructor,(c(e)&&(e===m||i(e.prototype))||u(e)&&null===(e=e[y]))&&(e=void 0),e===m||void 0===e))return d(l,h,x);for(r=new(void 0===e?m:e)(g(x-h,0)),o=0;h<x;h++,o++)h in l&&p(r,o,l[h]);return r.length=o,r}})},function(t,n,e){t.exports=e(147)},function(t,n,e){var r=e(148);t.exports=r},function(t,n,e){var r=e(13),o=e(149),i=Array.prototype;t.exports=function(t){var n=t.map;return t===i||r(i,t)&&n===i.map?o:n}},function(t,n,e){e(150);var r=e(30);t.exports=r("Array").map},function(t,n,e){"use strict";var r=e(6),o=e(46).map;r({target:"Array",proto:!0,forced:!e(45)("map")},{map:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,e){var r=e(0),o=e(29),i=e(67),c=e(8),u=e(2)("species"),a=r.Array;t.exports=function(t){var n;return o(t)&&(n=t.constructor,(i(n)&&(n===a||o(n.prototype))||c(n)&&null===(n=n[u]))&&(n=void 0)),void 0===n?a:n}},function(t,n,e){(function(r){var o,i=e(153),c=e(94),u=e(190),a=e(73),f=e(194),s=e(201),p=e(205),l=e(209),v=e(213);!function(d,h){"use strict";var y,m=(d=void 0!==d?d:"undefined"!=typeof self?self:void 0!==r?r:{}).IDBKeyRange||d.webkitIDBKeyRange,g="readonly",x="readwrite",b=Object.prototype.hasOwnProperty,w=function(){if(!y&&!(y=d.indexedDB||d.webkitIndexedDB||d.mozIndexedDB||d.oIndexedDB||d.msIndexedDB||(null===d.indexedDB&&d.shimIndexedDB?d.shimIndexedDB:void 0)))throw"IndexedDB required";return y},j=function(t){return t},S=function(t){var n;return c(n=Object.prototype.toString.call(t)).call(n,8,-1).toLowerCase()},O=function(t){return"function"==typeof t},P=function(t){return"number"===S(t)},A=function(t){return"array"===S(t)},E=function(t){return void 0===t},k=function(t,n){var e=this,r=!1;this.name=n,this.getIndexedDB=function(){return t},this.add=function(n){if(r)throw"Database has been closed";for(var o=[],i=0,c=0;c<arguments.length-1;c++)if(u(arguments[c+1]))for(var p=0;p<arguments[c+1].length;p++)o[i]=arguments[c+1][p],i++;else o[i]=arguments[c+1],i++;var l=t.transaction(n,x),v=l.objectStore(n);return new a((function(t,n){f(o).call(o,(function(t){var n;if(t.item&&t.key){var e=t.key;t=t.item,n=v.add(t,e)}else n=v.add(t);n.onsuccess=function(n){var e=n.target,r=e.source.keyPath;null===r&&(r="__id__"),s(t,r,{value:e.result,enumerable:!0})}})),l.oncomplete=function(){t(o,e)},l.onerror=function(t){t.preventDefault(),n(t)},l.onabort=function(t){n(t)}}))},this.updateAndDelete=function(n,e,o){if(r)throw"Database has been closed";var i=t.transaction(n,x),c=i.objectStore(n),u=c.keyPath;return new a((function(t,n){f(e).call(e,(function(t){if(t.item&&t.key){var n=t.key;t=t.item,c.put(t,n)}else c.put(t)})),f(o).call(o,(function(t){c.delete(t[u])})),i.oncomplete=function(){t([e,o])},i.onerror=function(t){n(t)}}))},this.update=function(n){if(r)throw"Database has been closed";for(var o,i=[],c=1;c<arguments.length;c++)u(o=arguments[c])?i=p(i).call(i,o):i.push(o);var s=t.transaction(n,x),l=s.objectStore(n);l.keyPath;return new a((function(t,n){f(i).call(i,(function(t){var n;if(t.item&&t.key){var e=t.key;t=t.item,n=l.put(t,e)}else n=l.put(t);n.onsuccess=function(t){},n.onerror=function(t){}})),s.oncomplete=function(){t(i,e)},s.onerror=function(t){n(t)},s.onabort=function(t){n(t)}}))},this.remove=function(n,e,o,i,c,s,p){if(r)throw"Database has been closed";var l=t.transaction(n,x),v=l.objectStore(n);return new a((function(t,n){function r(t){return null==t}var a;(r(i)&&(i=-1/0),r(c)&&(c=1/0),null===e||u(e)||(e=[e]),r(o))?null!==e?f(e).call(e,(function(t){v.delete(t)})):v.delete(range=m.bound(i,c,s,p)):(a=null!==e?m.only(e[0]):m.bound(i,c,s,p),v.index(o).openCursor(a).onsuccess=function(t){var n=t.target.result;n&&(n.delete(),n.continue())});l.oncomplete=function(){t()},l.onerror=function(t){n(t)},l.onabort=function(t){n(t)}}))},this.clear=function(n){if(r)throw"Database has been closed";var e=t.transaction(n,x);e.objectStore(n).clear();return new a((function(t,n){e.oncomplete=function(){t()},e.onerror=function(t){n(t)}}))},this.close=function(){r||(t.close(),r=!0,delete I[n])},this.get=function(n,e){if(r)throw"Database has been closed";var o=t.transaction(n),i=o.objectStore(n).get(e);return new a((function(t,n){i.onsuccess=function(n){t(n.target.result)},o.onerror=function(t){n(t)}}))},this.query=function(n,e){if(r)throw"Database has been closed";return new T(n,t,e)},this.count=function(n,e){if(r)throw"Database has been closed";t.transaction(n).objectStore(n)};for(var o=0,i=t.objectStoreNames.length;o<i;o++)!function(t){for(var n in e[t]={},e)b.call(e,n)&&"close"!==n&&(e[t][n]=function(n){return function(){var r,o=p(r=[t]).call(r,c([]).call(arguments,0));return e[n].apply(e,o)}}(n))}(t.objectStoreNames[o])},T=function(t,n,e){var r,o=this,u=!1,s=!1,p=function(r,o,c,p,v,d,h){return new a((function(a,y){var b=u||s?x:g,w=n.transaction(t,b),j=w.objectStore(t),S=e?j.index(e):j,P=r?m[r].apply(null,o):null,A=[],E=[P],k=0;v=v||null,d=d||[],"count"!==c&&E.push(p||"next");var T=!!u&&l(u);S[c].apply(S,E).onsuccess=function(t){var n=t.target.result;if(i(n)===i(0))A=n;else if(n)if(null!==v&&v[0]>k)k=v[0],n.advance(v[0]);else if(null!==v&&k>=v[0]+v[1]);else{var e=!0,r="value"in n?n.value:n.key;f(d).call(d,(function(t){t&&t.length&&(2===t.length?e=e&&r[t[0]]===t[1]:O(t[0])&&(e=e&&t[0].apply(void 0,[r])))})),e&&(k++,A.push(h(r)),s?n.delete():u&&(r=function(t){for(var n=0;n<T.length;n++){var e=T[n],r=u[e];r instanceof Function&&(r=r(t)),t[e]=r}return t}(r),n.update(r))),n.continue()}},w.oncomplete=function(){a(A)},w.onerror=function(t){y(t)},w.onabort=function(t){y(t)}}))},d=function(t,n){var e="next",r="openCursor",o=[],i=null,a=j,f=!1,l=function(){return p(t,n,r,f?e+"unique":e,i,o,a)},v=function(){return e=null,r="count",{execute:l}},d=function t(){return 1==(i=A(arguments[0])?arguments[0]:c(Array.prototype).call(arguments,0,2)).length&&i.unshift(0),P(i[1])||(i=null),{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:t,map:w,remove:S}},h=function t(n){return(n=!!E(n)||!!n)&&(r="openKeyCursor"),{execute:l,keys:t,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},y=function t(){return o.push(c(Array.prototype).call(arguments,0,2)),{execute:l,count:v,keys:h,filter:t,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},m=function t(n){return n=!!E(n)||!!n,e=n?"next":"prev",{execute:l,count:v,keys:h,filter:y,asc:t,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},g=function t(n){return n=!!E(n)||!!n,e=n?"prev":"next",{execute:l,count:v,keys:h,filter:y,asc:m,desc:t,distinct:x,modify:b,limit:d,map:w,remove:S}},x=function t(n){return n=!!E(n)||!!n,f=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:t,modify:b,limit:d,map:w,remove:S}},b=function t(n){return u=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:t,limit:d,map:w,remove:S}},w=function t(n){return O(n)&&(a=n),{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:t,remove:S}},S=function t(n){return n=!!E(n)||!!n,s=n,{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:t}};return{execute:l,count:v,keys:h,filter:y,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}};f(r="only bound upperBound lowerBound".split(" ")).call(r,(function(t){o[t]=function(){return new d(t,arguments)}})),this.filter=function(){var t=new d(null,null);return v(t).apply(t,arguments)},this.all=function(){var t;return v(t=this).call(t)}},L=function(t,n,e,r){var o=t.target.result,i=new k(o,n);return I[n]=o,a.resolve(i)},I={},_={version:"0.10.2",open:function(t){var n;return new a((function(e,r){if(I[t.server])L({target:{result:I[t.server]}},t.server,t.version,t.schema).then(e,r);else{try{n=w().open(t.server,t.version)}catch(t){r(t)}n.onsuccess=function(n){L(n,t.server,t.version,t.schema).then(e,r)},n.onupgradeneeded=function(n){!function(t,n,e){for(var r in"function"==typeof n&&(n=n()),n){var o,i=n[r];for(var c in o=!b.call(n,r)||e.objectStoreNames.contains(r)?t.currentTarget.transaction.objectStore(r):e.createObjectStore(r,i.key),i.indexes){var u=i.indexes[c];try{o.index(c)}catch(t){o.createIndex(c,u.key||c,l(u).length?u:{unique:!1})}}}}(n,t.schema,n.target.result)},n.onerror=function(t){r(t)}}}))},remove:function(t){return new a((function(n,e){if(!t)return n();var r,o;i(t)===k&&(t=t.name),"string"==typeof t&&(r=I[t]),r&&"function"==typeof r.close&&r.close();try{o=w().deleteDatabase(t)}catch(t){e(t)}o.onsuccess=function(e){delete I[t],n(t)},o.onerror=function(t){e(t)},o.onblocked=function(t){e(t)}}))}};void 0!==t.exports?t.exports=_:void 0===(o=function(){return _}.call(n,e,n,t))||(t.exports=o)}(void 0)}).call(this,e(74))},function(t,n,e){var r=e(154),o=e(185);function i(n){return"function"==typeof r&&"symbol"==typeof o?(t.exports=i=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=i=function(t){return t&&"function"==typeof r&&t.constructor===r&&t!==r.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),i(n)}t.exports=i,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,n,e){t.exports=e(155)},function(t,n,e){var r=e(156);e(178),e(179),e(180),e(181),e(182),e(183),e(184),t.exports=r},function(t,n,e){var r=e(157);t.exports=r},function(t,n,e){var r=e(158);e(44),t.exports=r},function(t,n,e){e(96),e(66),e(159),e(162),e(163),e(164),e(165),e(97),e(166),e(167),e(168),e(169),e(170),e(171),e(172),e(173),e(174),e(175),e(176),e(177);var r=e(15);t.exports=r.Symbol},function(t,n,e){"use strict";var r=e(6),o=e(0),i=e(12),c=e(47),u=e(10),a=e(5),f=e(20),s=e(9),p=e(50),l=e(4),v=e(7),d=e(29),h=e(3),y=e(8),m=e(13),g=e(49),x=e(11),b=e(21),w=e(16),j=e(33),S=e(41),O=e(18),P=e(39),A=e(62),E=e(58),k=e(160),T=e(82),L=e(32),I=e(14),_=e(83),M=e(75),D=e(68),R=e(25),C=e(52),F=e(37),N=e(38),B=e(54),G=e(2),z=e(72),q=e(1),V=e(28),U=e(42),W=e(46).forEach,H=F("hidden"),K=G("toPrimitive"),J=U.set,Y=U.getterFor("Symbol"),X=Object.prototype,Q=o.Symbol,Z=Q&&Q.prototype,$=o.TypeError,tt=o.QObject,nt=i("JSON","stringify"),et=L.f,rt=I.f,ot=k.f,it=M.f,ct=a([].push),ut=C("symbols"),at=C("op-symbols"),ft=C("string-to-symbol-registry"),st=C("symbol-to-string-registry"),pt=C("wks"),lt=!tt||!tt.prototype||!tt.prototype.findChild,vt=s&&l((function(){return 7!=P(rt({},"a",{get:function(){return rt(this,"a",{value:7}).a}})).a}))?function(t,n,e){var r=et(X,n);r&&delete X[n],rt(t,n,e),r&&t!==X&&rt(X,n,r)}:rt,dt=function(t,n){var e=ut[t]=P(Z);return J(e,{type:"Symbol",tag:t,description:n}),s||(e.description=n),e},ht=function(t,n,e){t===X&&ht(at,n,e),x(t);var r=j(n);return x(e),v(ut,r)?(e.enumerable?(v(t,H)&&t[H][r]&&(t[H][r]=!1),e=P(e,{enumerable:O(0,!1)})):(v(t,H)||rt(t,H,O(1,{})),t[H][r]=!0),vt(t,r,e)):rt(t,r,e)},yt=function(t,n){x(t);var e=w(n),r=A(e).concat(bt(e));return W(r,(function(n){s&&!u(mt,e,n)||ht(t,n,e[n])})),t},mt=function(t){var n=j(t),e=u(it,this,n);return!(this===X&&v(ut,n)&&!v(at,n))&&(!(e||!v(this,n)||!v(ut,n)||v(this,H)&&this[H][n])||e)},gt=function(t,n){var e=w(t),r=j(n);if(e!==X||!v(ut,r)||v(at,r)){var o=et(e,r);return!o||!v(ut,r)||v(e,H)&&e[H][r]||(o.enumerable=!0),o}},xt=function(t){var n=ot(w(t)),e=[];return W(n,(function(t){v(ut,t)||v(N,t)||ct(e,t)})),e},bt=function(t){var n=t===X,e=ot(n?at:w(t)),r=[];return W(e,(function(t){!v(ut,t)||n&&!v(X,t)||ct(r,ut[t])})),r};(p||(R(Z=(Q=function(){if(m(Z,this))throw $("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?S(arguments[0]):void 0,n=B(t),e=function(t){this===X&&u(e,at,t),v(this,H)&&v(this[H],n)&&(this[H][n]=!1),vt(this,n,O(1,t))};return s&&lt&&vt(X,n,{configurable:!0,set:e}),dt(n,t)}).prototype,"toString",(function(){return Y(this).tag})),R(Q,"withoutSetter",(function(t){return dt(B(t),t)})),M.f=mt,I.f=ht,_.f=yt,L.f=gt,E.f=k.f=xt,T.f=bt,z.f=function(t){return dt(G(t),t)},s&&(rt(Z,"description",{configurable:!0,get:function(){return Y(this).description}}),f||R(X,"propertyIsEnumerable",mt,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!p,sham:!p},{Symbol:Q}),W(A(pt),(function(t){q(t)})),r({target:"Symbol",stat:!0,forced:!p},{for:function(t){var n=S(t);if(v(ft,n))return ft[n];var e=Q(n);return ft[n]=e,st[e]=n,e},keyFor:function(t){if(!g(t))throw $(t+" is not a symbol");if(v(st,t))return st[t]},useSetter:function(){lt=!0},useSimple:function(){lt=!1}}),r({target:"Object",stat:!0,forced:!p,sham:!s},{create:function(t,n){return void 0===n?P(t):yt(P(t),n)},defineProperty:ht,defineProperties:yt,getOwnPropertyDescriptor:gt}),r({target:"Object",stat:!0,forced:!p},{getOwnPropertyNames:xt,getOwnPropertySymbols:bt}),r({target:"Object",stat:!0,forced:l((function(){T.f(1)}))},{getOwnPropertySymbols:function(t){return T.f(b(t))}}),nt)&&r({target:"JSON",stat:!0,forced:!p||l((function(){var t=Q();return"[null]"!=nt([t])||"{}"!=nt({a:t})||"{}"!=nt(Object(t))}))},{stringify:function(t,n,e){var r=D(arguments),o=n;if((y(n)||void 0!==t)&&!g(t))return d(n)||(n=function(t,n){if(h(o)&&(n=u(o,this,t,n)),!g(n))return n}),r[1]=n,c(nt,null,r)}});if(!Z[K]){var wt=Z.valueOf;R(Z,K,(function(t){return u(wt,this)}))}V(Q,"Symbol"),N[H]=!0},function(t,n,e){var r=e(26),o=e(16),i=e(58).f,c=e(161),u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"Window"==r(t)?function(t){try{return i(t)}catch(t){return c(u)}}(t):i(o(t))}},function(t,n,e){var r=e(0),o=e(59),i=e(22),c=e(71),u=r.Array,a=Math.max;t.exports=function(t,n,e){for(var r=i(t),f=o(n,r),s=o(void 0===e?r:e,r),p=u(a(s-f,0)),l=0;f<s;f++,l++)c(p,l,t[f]);return p.length=l,p}},function(t,n,e){e(1)("asyncIterator")},function(t,n){},function(t,n,e){e(1)("hasInstance")},function(t,n,e){e(1)("isConcatSpreadable")},function(t,n,e){e(1)("match")},function(t,n,e){e(1)("matchAll")},function(t,n,e){e(1)("replace")},function(t,n,e){e(1)("search")},function(t,n,e){e(1)("species")},function(t,n,e){e(1)("split")},function(t,n,e){e(1)("toPrimitive")},function(t,n,e){e(1)("toStringTag")},function(t,n,e){e(1)("unscopables")},function(t,n,e){var r=e(0);e(28)(r.JSON,"JSON",!0)},function(t,n){},function(t,n){},function(t,n,e){e(1)("asyncDispose")},function(t,n,e){e(1)("dispose")},function(t,n,e){e(1)("matcher")},function(t,n,e){e(1)("metadata")},function(t,n,e){e(1)("observable")},function(t,n,e){e(1)("patternMatch")},function(t,n,e){e(1)("replaceAll")},function(t,n,e){t.exports=e(186)},function(t,n,e){var r=e(187);t.exports=r},function(t,n,e){var r=e(188);t.exports=r},function(t,n,e){var r=e(189);e(44),t.exports=r},function(t,n,e){e(64),e(66),e(93),e(97);var r=e(72);t.exports=r.f("iterator")},function(t,n,e){t.exports=e(191)},function(t,n,e){var r=e(192);t.exports=r},function(t,n,e){e(193);var r=e(15);t.exports=r.Array.isArray},function(t,n,e){e(6)({target:"Array",stat:!0},{isArray:e(29)})},function(t,n,e){t.exports=e(195)},function(t,n,e){e(44);var r=e(24),o=e(7),i=e(13),c=e(196),u=Array.prototype,a={DOMTokenList:!0,NodeList:!0};t.exports=function(t){var n=t.forEach;return t===u||i(u,t)&&n===u.forEach||o(a,r(t))?c:n}},function(t,n,e){var r=e(197);t.exports=r},function(t,n,e){e(198);var r=e(30);t.exports=r("Array").forEach},function(t,n,e){"use strict";var r=e(6),o=e(199);r({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},function(t,n,e){"use strict";var r=e(46).forEach,o=e(200)("forEach");t.exports=o?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},function(t,n,e){"use strict";var r=e(4);t.exports=function(t,n){var e=[][t];return!!e&&r((function(){e.call(null,n||function(){return 1},1)}))}},function(t,n,e){t.exports=e(202)},function(t,n,e){var r=e(203);t.exports=r},function(t,n,e){e(204);var r=e(15).Object,o=t.exports=function(t,n,e){return r.defineProperty(t,n,e)};r.defineProperty.sham&&(o.sham=!0)},function(t,n,e){var r=e(6),o=e(9),i=e(14).f;r({target:"Object",stat:!0,forced:Object.defineProperty!==i,sham:!o},{defineProperty:i})},function(t,n,e){t.exports=e(206)},function(t,n,e){var r=e(207);t.exports=r},function(t,n,e){var r=e(13),o=e(208),i=Array.prototype;t.exports=function(t){var n=t.concat;return t===i||r(i,t)&&n===i.concat?o:n}},function(t,n,e){e(96);var r=e(30);t.exports=r("Array").concat},function(t,n,e){t.exports=e(210)},function(t,n,e){var r=e(211);t.exports=r},function(t,n,e){e(212);var r=e(15);t.exports=r.Object.keys},function(t,n,e){var r=e(6),o=e(21),i=e(62);r({target:"Object",stat:!0,forced:e(4)((function(){i(1)}))},{keys:function(t){return i(o(t))}})},function(t,n,e){t.exports=e(214)},function(t,n,e){var r=e(215);t.exports=r},function(t,n,e){var r=e(13),o=e(216),i=Array.prototype;t.exports=function(t){var n=t.filter;return t===i||r(i,t)&&n===i.filter?o:n}},function(t,n,e){e(217);var r=e(30);t.exports=r("Array").filter},function(t,n,e){"use strict";var r=e(6),o=e(46).filter;r({target:"Array",proto:!0,forced:!e(45)("filter")},{filter:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})}]);',"Worker",void 0,void 0)}},function(e,t,r){var n=r(4),i=r(17),o=r(8),s=r(211),a={log:{key:{keyPath:"time"},indexes:{level:{unique:!1},time:{unique:!0}}}};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.server=null,this.expire=e.expire||72,this.name=e.name}var u=c.prototype;u.init=function(){var e=this;if(!this.server)return s.open({server:"nim-log-"+this.name,version:1,schema:a}).then((function(t){e.server=t}))},u.putLog=function(e){var t=this;if(!this.server)return n.reject("no db server");var r=i(e).call(e,-1)[0].time-36e5*this.expire;return this.deleteLogs(r).then((function(){return t.server.add("log",e)}))},u.getAllLogs=function(){return this.server?this.server.query("log","time").all().execute().then((function(e){var t={},r=i(e).call(e,-1)[0];return t.logs=o(e).call(e,(function(e){return e.log})).join("\r\n"),t.time=r&&r.time,t})):n.reject("no db server")},u.deleteLogs=function(e){return this.server?this.server.remove("log",null,"time",0,e):n.reject("no db server")},e.exports=c},function(e,t,r){var n=r(52).fn;n.isConnected=function(){return!!this.protocol&&this.protocol.isConnected()},n.connect=function(){this.protocol.connect()},n.disconnect=function(){}},function(e,t,r){var n=r(10),i=r(57),o=r(19),s=r(58),a=r(59),c=r(60),u=r(49),l=r(27),d=r(11),p=r(23),m=r(8),f=r(17),h=r(110),g=r(77),v=r(6),y=r(79),b=r(26),S=r(5),T=r(30),_=r(3),w=r(13),M=r(61),x=r(149),E=["loc_x","loc_y","loc_z"];function C(e,t){var r=n(e);if(i){var a=i(e);t&&(a=o(a).call(a,(function(t){return s(e,t).enumerable}))),r.push.apply(r,a)}return r}var R=r(52).fn,k=r(0),A=r(428),I=r(36),O=r(14),P=r(193),N=r(429),D=r(195);R.sendText=function(e){var t=e,r=t.loc_x,n=t.loc_y,i=t.loc_z,o=x(t,E);return void 0===r||void 0===n||void 0===i?e=function(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?_(r=C(Object(i),!0)).call(r,(function(t){M(e,t,i[t])})):a?c(e,a(i)):_(n=C(Object(i))).call(n,(function(t){u(e,t,s(i,t))}))}return e}({},o):("number"!=typeof e.loc_x&&(e.loc_x=0),"number"!=typeof e.loc_y&&(e.loc_y=0),"number"!=typeof e.loc_z&&(e.loc_z=0)),this.processCallback(e),e.msg=new this.message.TextMessage(e),this.sendMsg(e)},R.previewFile=function(e){var t,r=this,n=r.protocol.appGrayConfig;if(n&&n.grayConfig&&n.grayConfig.mixStoreEnable&&(e.mixEnable=!0),k.verifyOptions(e,"done","msg::previewFile"),e.type||(e.type="file"),k.verifyParamPresentJustOne(e,"dataURL blob fileInput filePath wxFilePath fileObject","msg::previewFile"),k.exist(e.maxSize)&&k.verifyParamType("maxSize",e.maxSize,"number","api::previewFile"),k.exist(e.commonUpload)&&k.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile"),e.nosSurvivalTime?(k.verifyParamType("nosSurvivalTime",e.nosSurvivalTime,"number","api::Base.getInstance"),k.verifyParamMin("nosSurvivalTime",e.nosSurvivalTime,86400,"api::Base.getInstance")):e.nosSurvivalTime=this.nosSurvivalTime,e.filePath=e.filePath||e.wxFilePath,delete e.wxFilePath,e.dataURL)e.blob=D.fromDataURL(e.dataURL);else if(e.blob);else if(e.fileInput){if(e.fileInput=k.verifyFileInput(e.fileInput,"msg::previewFile"),e.fileInput.files){if(!e.fileInput.files.length)return void e.done(I.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::previewFile",fileInput:e.fileInput}),e);e.fileSize=e.fileInput.files[0].size}e.fileInputName=k.getFileName(e.fileInput)}this.processCallback(e);var i=d(P.genResponseBody(e.type)||{}).replace(/"/gi,'\\"'),o=null,s=e.transcode?"getNosTokenTrans":"getNosToken";if(e.transcode){k.verifyOptions(e,"fileInput","msg::previewFile");var a=k.getFileInfo(e.fileInput);o={transToken:{name:a.name,type:a.transcodeType,transType:"png"===e.transcode?11:10,size:a.size,body:i}}}else o=i;this[s]({responseBody:o,nosToken:{nosScene:e.nosScene||this.nosScene,nosSurvivalTime:e.nosSurvivalTime},callback:p(t=function(t,n){if(t)e.done(t);else if(e.transcode?(e.nosToken=n.nosToken,e.docId=n.docId):e.nosToken=n,e.logger=r.logger,e.mixEnable){var i,s;if(!this.protocol.mixStorePolicy)try{this.protocol.mixStorePolicy=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[this.options.appKey]}catch(e){r.logger.error("error:","get last mixStorePolicy failed",e)}if(!this.protocol.mixStorePolicy)return void r.logger.error("error:","get mixStorePolicy failed");e.providers=m(i=this.protocol.mixStorePolicy.providers||[]).call(i,(function(e){return Number(e)})),e.curProvider=e.providers[0]?Number(e.providers[0]):1,e.nosPolicy=this.protocol.mixStorePolicy.nosPolicy,e.s3Policy=this.protocol.mixStorePolicy.s3Policy,r.getMixStoreToken({curProvider:e.curProvider,responseBody:o,callback:p(s=function(t,n){t?e.done(t):(e.mixStoreToken=n,e.getMixStoreToken=function(t,n){r.getMixStoreToken({curProvider:t,responseBody:o,callback:function(t,r){t?e.done(t):n(r)}})},1===e.curProvider&&(e.nosToken=n),r._doPreviewFile(e))}).call(s,r)})}else this._doPreviewFile(e)}).call(t,this)})},R._doPreviewFile=function(e){var t=this;t.reporter.reportTraceStart("nos",{user_id:this.account,action:"upload"});var r=(e=k.merge(e,t.options.providers)).uploaddone,n=O.genUploadUrl(e.nosToken.bucket);e.mixEnable&&1===e.curProvider&&(n=O.genUploadUrl(e.mixStoreToken.bucket));var i,o=O.chunkUploadUrl;t.logger.info("_doPreviewFile: start upload"),e.commonUpload||!o||O.isWeixinApp||O.isNodejs||O.isRN?(e.commonUpload=!0,i=n):(this.logger.info("use chunkUrl: ",o,O.nosLbsUrls),i=o,e.nosLbsUrls=O.nosLbsUrls,t.options.edgeList?e.edgeList=t.options.edgeList:e.updateNosEdgeList=function(e){t.options.edgeList=e});var s=this.assembleUploadParams(e.nosToken);function a(n,i,o){if(t.logger.info("_doPreviewFile: upload done",n&&n.message),e.uploaddone=r,n)return t.reporter.reportTraceUpdate("nos",{operation_type:"transfer",error:n&&n.message},!1),t.reporter.reportTraceEnd("nos",1),void e.done(n,e.callback.options);if(t.reporter.reportTraceEnd("nos",0),i=P.parseResponse(i,t.options.exifOrientation),o||i.isS3||(i.url=O.genDownloadUrl(e.nosToken,s.Object,O.serverNosConfig.cdnDomain),e.nosToken.shortUrl&&(i._url_safe=e.nosToken.shortUrl)),k.exist(e.fileInputName))i.name=e.fileInputName;else if(e.blob){var a=e.blob.name;if(i.name=a||"blob-"+i.md5,!a){var c=e.blob.type;i.ext=f(c).call(c,h(c).call(c,"/")+1)}}else e.filePath?i.name=e.filePath:e.fileObject&&(i.name=e.fileObject.fileName);if(!i.ext){var u,l,d=h(u=i.name).call(u,".");i.ext=-1===d?"unknown":f(l=i.name).call(l,d+1)}i.size=i.size||0,i.isS3&&i._url_safe?t.getNosOriginUrl({safeShortUrl:i._url_safe,done:function(r,n){r?t.logger.error("error:","getNosOriginUrl failed",r):(i.url=n,e.done(null,k.copy(i)))}}):e.done(null,k.copy(i))}if(e.mixEnable&&1===e.curProvider&&(s=this.assembleUploadParams(e.mixStoreToken)),O.isWeixinApp)k.verifyOptions(e,"filePath","msg::_doPreviewFile"),t.fileQuickTransfer(e,a,(function(){var r=wx.uploadFile({url:i,filePath:e.filePath,name:"file",formData:s,fail:function(e){a({code:"FAILED",msg:e}),t.logger.error("error:","api::msg:upload file failed",e)},success:function(e){if(200===e.statusCode)try{a(null,JSON.parse(e.data))}catch(r){t.logger.error("error:","parse wx upload file res error",r),a({code:"PARSE_WX_UPLOAD_FILE_RES_ERROR",str:e.data,msg:e.errMsg})}else a({code:e.statusCode,msg:e.errMsg})}});"function"==typeof e.uploadprogress&&r&&(t.logger.info("_doPreviewFile::mini uploadprogress"),r.onProgressUpdate((function(t){e.uploadprogress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percentage:t.progress,percentageText:t.progress+"%"})})))}));else if(O.isNodejs){var c={url:i,name:"file",formData:s,success:function(e){if(200===e.statusCode)try{a(null,JSON.parse(e.data))}catch(r){t.protocol.logger.error("error:","parse nodejs upload file res error",r),a({code:"PARSE_NODEJS_UPLOAD_FILE_RES_ERROR",str:e.data,msg:e.errMsg})}else a({code:e.statusCode,msg:e.errMsg})},fail:function(e){a({code:"FAILED",msg:e}),t.protocol.logger.error("error:","api::msg:upload file failed",e)}};if(e.filePath)c.filePath=e.filePath;else{if("object"!==l(e.fileObject))throw new I("Nodejs上传fileObject参数类型应如 {fileName:..,fileData:..} ");c.fileData=e.fileObject.fileData}t.fileQuickTransfer(e,a,(function(){N.uploadFile(c)}))}else if(O.isRN){var u={url:i,name:"file",formData:s,filePath:e.filePath,success:function(e){if(e.ok&&200===e.status)try{var r=m(e.headers)&&m(e.headers).etag;e.md5=r?"string"==typeof r?r:r[0]:"UNKNOWN",a(null,e)}catch(r){t.protocol.logger.error("error:","parse React Native upload file res error",r),a({code:"PARSE_React_Native_UPLOAD_FILE_RES_ERROR",res:e})}else a({code:e.status,msg:e.statusText})},fail:function(e){a({code:"FAILED",msg:e}),t.protocol.logger.error("error:","api::msg:upload file failed",e)}};t.fileQuickTransfer(e,a,(function(){N.uploadFile(u)}))}else e.uploaddone=a,e.url=i,e.params=s,e.fileName="file",t.fileQuickTransfer(e,a,(function(){return new N(e)}))},R.fileQuickTransfer=function(e,t,r){var n,i=this;e=e||{},t instanceof Function||(t=function(){}),r instanceof Function||(r=function(){});var o=e.fastPass;if(o)try{o=JSON.parse(o),e.fastPass=o}catch(e){i.protocol.logger.error("快传参数解析失败")}var s=e.fileInputName||e.name||e.blob&&e.blob.name||"",a=e.fileSize||e.size||e.blob&&e.blob.size||0,c=o?g(n=(o.md5||e.digest||"")+"").call(n):"",u=e.type||e.blob&&e.blob.type;if(c&&a>=O.threshold){var l=!0,d={name:s,md5:c,ext:f(s).call(s,h(s).call(s,".")+1),type:u};switch(u){case"image":o&&o.w&&o.h?(d.w=o.w,d.h=o.h):(l=!1,i.protocol.logger.error("快传 image 文件缺少参数 w 或 h"));break;case"video":o&&o.w&&o.h&&o.dur?(d.w=o.w,d.h=o.h,d.dur=o.dur):(l=!1,i.protocol.logger.error("快传 video 文件缺少参数 w 或 h 或 dur"));break;case"audio":o&&o.dur?d.dur=o.dur:(l=!1,i.protocol.logger.error("快传 audio 文件缺少参数 dur"))}if(!l)return void r();var p={fileQuickTransfer:{md5:c}};return a&&(p.fileQuickTransfer.size=a),this.protocol.sendCmd("fileQuickTransfer",p,(function(e,n,o){!e&&o&&o.fileQuickTransfer&&o.fileQuickTransfer.url||(i.protocol.logger.error("misc::fileQuickTransfer: not found",e,n),r()),o&&o.fileQuickTransfer&&o.fileQuickTransfer.threshold&&(O.threshold=o.fileQuickTransfer.threshold||0),o&&o.fileQuickTransfer&&o.fileQuickTransfer.url&&(d.size=a||o.fileQuickTransfer.size,d.url=o.fileQuickTransfer.url,o.fileQuickTransfer._url_safe&&(d._url_safe=o.fileQuickTransfer._url_safe),t(e,d,!0))}))}r()},R.sendFile=function(e){if(e.type||(e.type="file"),e=k.merge(e,this.options.providers),k.verifyParamPresentJustOne(e,"dataURL blob fileInput file filePath wxFilePath fileObject","msg::sendFile"),k.exist(e.maxSize)&&k.verifyParamType("maxSize",e.maxSize,"number","api::previewFile"),k.exist(e.commonUpload)&&k.verifyParamType("commonUpload",e.commonUpload,"boolean","api::previewFile"),this.processCallback(e),e.filePath=e.filePath||e.wxFilePath,delete e.wxFilePath,e.dataURL)this._previewAndSendFile(e);else if(e.blob)this._previewAndSendFile(e);else if(e.fileInput){if(e.fileInput=k.verifyFileInput(e.fileInput,"msg::sendFile"),e.fileInput.files&&!e.fileInput.files.length)return void e.done(I.newNoFileError("请选择"+e.type+"文件",{callFunc:"msg::sendFile",fileInput:e.fileInput}),e.callback.options);this._previewAndSendFile(e)}else if(e.filePath||e.fileObject)this._previewAndSendFile(e);else if(e.file){var t,r=e.file._url_safe;return r&&(t=e.file.url,e.file.url=r,delete e.file._url_safe),e.msg=new this.message.FileMessage(e),this.sendMsg(e,t)}},R._previewAndSendFile=function(e){var t=this;k.verifyCallback(e,"uploaddone beforesend","msg::_previewAndSendFile"),t.reporter.reportTraceStart("nos",{user_id:this.account,action:"upload"});var r=e.done;e.done=function(n,i){if(e.done=r,n)e.uploaddone(n,e.callback.options),e.done(n,e.callback.options);else{if(/chatroom/.test(e.scene))return;var o;e.uploaddone(null,k.copy(i));var s=i._url_safe;s&&!i.isS3&&(o=i.url,i.url=s,delete i._url_safe),e.file=i,e.msg=new t.message.FileMessage(e),e.beforesend(t.sendMsg(e,o))}},t.previewFile(e)},R.assembleUploadParams=function(e){return e?{Object:decodeURIComponent(e.objectName),"x-nos-token":e.token,"x-nos-entity-type":"json"}:null},R.deleteFile=function(e){k.verifyParamPresentJustOne(e,"docId","msg::deleteFile"),this.removeFile({docId:e.docId,callback:function(t,r){t?e.error&&e.error(t,r):e.success&&e.success(r)}})},R.getFile=function(e){k.verifyParamPresentJustOne(e,"docId","msg::getFile"),this.fetchFile({docId:e.docId,callback:function(t,r){t?e.error&&e.error(t,r):e.success&&e.success(r.info)}})},R.getFileList=function(e){var t=e.fromDocId,r=void 0===t?"":t,n=e.limit,i=void 0===n?10:n,o={limit:i};r&&(o.fromDocId=r),this.fetchFileList({fileListParam:o,callback:function(t,r){t?(i>30&&(t.message=t.message+"::文档条数超过限制:30"),e.error&&e.error(t,r)):e.success&&e.success(r)}})},R.sendGeo=function(e){return this.processCallback(e),e.msg=new this.message.GeoMessage(e),this.sendMsg(e)},R.sendTipMsg=function(e){return this.processCallback(e),e.msg=new this.message.TipMessage(e),this.sendMsg(e)},R.sendCustomMsg=function(e){return this.processCallback(e),e.msg=new this.message.CustomMessage(e),this.sendMsg(e)},R.sendRobotMsg=function(e){return this.logger.warn("this api will be abandon"),this.processCallback(e),e.msg=new this.message.RobotMessage(e),this.sendMsg(e)},R.sendMsg=function(e,t){var r,n=this,i=n.protocol,o=e.msg,s={},a=!!e.isLocal;if(this.logger.warn("sendMsg::start: "+o.idClient),a&&(e.time&&(o.time=e.time),e.idClient&&(o.idClient=e.idClient),e.localFrom&&(r=e.localFrom+"")),e.resend&&("out"!==e.flow||"fail"!==e.status))return k.onError("只能重发发送失败的消息");e.callback.options.idClient=o.idClient,n.beforeSendMsg(e,s);var c=e.rtnMsg=n.formatReturnMsg(o,r);if(t&&!n.options.keepNosSafeUrl&&c.file&&(c.file._url_safe=c.file.url,c.file.url=t,"audio"===c.type&&(c.file.mp3Url=t+(~v(t).call(t,"?")?"&":"?")+"audioTrans&type=mp3")),c.hasOwnProperty("chatroomId")&&!c.chatroomId)return k.onError("聊天室未连接");if(a&&(c.status="success",c.isLocal=!0),i.storeSendMsg&&(s.promise=i.storeSendMsg(c)),e.cbaop=function(e,t){if(e)return 7101===e.code&&(c.isInBlackList=!0,c.idServer=t.idServer,c.time=t.time),"server"!==e.from?(c.status="fail",i.updateSendMsgError&&i.updateSendMsgError(c),c):void 0},!a){t&&!n.options.keepNosSafeUrl&&e.callback&&(e.callback.originUrl=t),e.toAccids&&e.toAccids.length&&(o.toAccids=d(e.toAccids)),s.msg=o;var u=y(),l=o;n.sendCmd(e.cmd,s,(function(){if(O.isBrowser){var t=arguments[0],r=arguments[1]||{},i="chatroom"===n.subType,o=0===l.scene,s={msgId:r.idServer,clientId:l.idClient,msgTime:r.time||u,fromAccid:n.account,toAccid:o?l.to:"",type:i?4:l.scene,roomId:i?n.options.chatroomId:"",tid:i||o?"":l.to,result:t?t.code:200,failReason:t?t.message:"",rt:y()-u};n.reporter&&n.reporter.report("msgSend",s)}e.callback&&e.callback.apply(n,arguments)}))}return n.afterSendMsg(e),a&&b((function(){c=k.simpleClone(c),e.done(null,c)}),0),k.copy(c)},R.beforeSendMsg=function(){},R.afterSendMsg=function(){},R.formatReturnMsg=function(e,t){var r;return e=k.copy(e),this.protocol.completeMsg(e),e.status="sending",t&&(e.from=t),S(r=this.message).call(r,e)},R.resendMsg=function(e){return k.verifyOptions(e,"msg","msg::resendMsg"),this.trimMsgFlag(e),e.resend=!0,this._sendMsgByType(e)},R.forwardMsg=function(e){return k.verifyOptions(e,"msg","msg::forwardMsg"),this.trimMsgFlag(e),this.beforeForwardMsg(e),e.forward=!0,e.msg.idClient=k.guid(),this._sendMsgByType(e)},R.trimMsgFlag=function(e){e&&e.msg&&(e.msg=k.copy(e.msg),delete e.msg.resend,delete e.msg.forward)},R.beforeForwardMsg=function(){},R._sendMsgByType=function(e){switch(k.verifyOptions(e,"msg","msg::_sendMsgByType"),k.verifyParamValid("msg.type",e.msg.type,this.message.validTypes,"msg::_sendMsgByType"),k.merge(e,e.msg),e.type){case"text":return this.sendText(e);case"image":case"audio":case"video":case"file":return this.sendFile(e);case"geo":return this.sendGeo(e);case"custom":return this.sendCustomMsg(e);case"tip":return this.sendTipMsg(e);default:throw new I("不能发送类型为 "+e.type+" 的消息")}},R.parseRobotTemplate=function(e){if(this.logger.warn("this api will be abandon"),/<template[^>/]+\/>/.test(e))return{raw:e,json:[{type:"text",name:"",text:""}]};if(!/<template[^>/]+>/.test(e))return{raw:e,json:[{type:"text",name:"",text:e}]};var t=new A({escapeMode:!1});e=e.replace(/<template [^>]+>/,"<template>");var r=t.xml2js(e);r=r.template.LinearLayout,T(r)||(r=[r]);var n=[];return r=_(r).call(r,(function(e){e.image&&(n=w(n).call(n,o(e))),e.text&&(n=w(n).call(n,i(e))),e.link&&(n=w(n).call(n,function(e){if(e.link){var t=e.link;T(t)||(t=[t]),t=m(t).call(t,(function(e){return e.image&&(e.image=o(e)),e.text&&(e.text=i(e)),"url"===e._type?(e.type="url",e.style=e._style||"",e.target=e._target,delete e._target,delete e._style):"block"===e._type&&(e.type="block",e.style=e._style||"",e.params=e._params||"",e.target=e._target,delete e._params,delete e._target,delete e._style),delete e._type,e})),e.link=t}return e.link}(e)))})),{raw:e,json:n};function i(e){var t;return T(e.text)||(e.text=[e.text]),e.text=m(t=e.text).call(t,(function(e){return{type:"text",name:e._name,text:e.__text}})),e.text}function o(e){var t;return T(e.image)||(e.image=[e.image]),e.image=m(t=e.image).call(t,(function(e){return{type:"image",name:e._name,url:e._url}})),e.image}}},function(e,t,r){var n=r(403);e.exports=n},function(e,t,r){var n=r(16),i=r(404),o=Function.prototype;e.exports=function(e){var t=e.bind;return e===o||n(o,e)&&t===o.bind?i:t}},function(e,t,r){r(405);var n=r(22);e.exports=n("Function").bind},function(e,t,r){var n=r(2),i=r(406);n({target:"Function",proto:!0,forced:Function.bind!==i},{bind:i})},function(e,t,r){var n=r(1),i=r(7),o=r(40),s=r(28),a=r(25),c=r(89),u=r(83),l=n.Function,d=i([].concat),p=i([].join),m={};e.exports=u?l.bind:function(e){var t=o(this),r=t.prototype,n=c(arguments,1),i=function(){var r=d(n,c(arguments));return this instanceof i?function(e,t,r){if(!a(m,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";m[t]=l("C,a","return new C("+p(n,",")+")")}return m[t](e,r)}(t,r.length,r):t.apply(e,r)};return s(r)&&(i.prototype=r),i}},function(e,t,r){var n=r(408);e.exports=n},function(e,t,r){var n=r(16),i=r(409),o=String.prototype;e.exports=function(e){var t=e.trim;return"string"==typeof e||e===o||n(o,e)&&t===o.trim?i:t}},function(e,t,r){r(410);var n=r(22);e.exports=n("String").trim},function(e,t,r){var n=r(2),i=r(137).trim;n({target:"String",proto:!0,forced:r(411)("trim")},{trim:function(){return i(this)}})},function(e,t,r){var n=r(168).PROPER,i=r(9),o=r(111);e.exports=function(e){return i((function(){return!!o[e]()||"​᠎"!=="​᠎"[e]()||n&&o[e].name!==e}))}},function(e,t,r){var n=r(413);e.exports=n},function(e,t,r){r(414);var n=r(12);e.exports=n.Date.now},function(e,t,r){var n=r(2),i=r(1),o=r(7),s=i.Date,a=o(s.prototype.getTime);n({target:"Date",stat:!0},{now:function(){return a(new s)}})},function(e,t,r){var n=r(416);e.exports=n},function(e,t,r){var n=r(16),i=r(417),o=Array.prototype;e.exports=function(e){var t=e.reverse;return e===o||n(o,e)&&t===o.reverse?i:t}},function(e,t,r){r(418);var n=r(22);e.exports=n("Array").reverse},function(e,t,r){var n=r(2),i=r(7),o=r(70),s=i([].reverse),a=[1,2];n({target:"Array",proto:!0,forced:String(a)===String(a.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),s(this)}})},function(e,t,r){e.exports=r(420)},function(e,t,r){var n=r(421);e.exports=n},function(e,t,r){var n=r(184);e.exports=n},function(e,t,r){var n=r(423);e.exports=n},function(e,t,r){var n=r(154);e.exports=n},function(e,t,r){var n=r(425),i=r(192);e.exports=function(e,t){if(null==e)return{};var r,o,s={},a=n(e);for(o=0;o<a.length;o++)r=a[o],i(t).call(t,r)>=0||(s[r]=e[r]);return s},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(426)},function(e,t,r){var n=r(427);e.exports=n},function(e,t,r){var n=r(187);e.exports=n},function(e,t,r){var n,i;void 0===(i="function"==typeof(n=function(e){return function(t){(t=t||{}).arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",t.jsAttributeFilter=t.jsAttributeFilter,t.jsAttributeConverter=t.jsAttributeConverter,t.attributeConverters=t.attributeConverters||[],t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[],t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],t.xmldomOptions=t.xmldomOptions||{},void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),void 0===t.useDoubleQuotes&&(t.useDoubleQuotes=!0),void 0===t.ignoreRoot&&(t.ignoreRoot=!1),void 0===t.escapeMode&&(t.escapeMode=!0),void 0===t.attributePrefix&&(t.attributePrefix="_"),void 0===t.selfClosingElements&&(t.selfClosingElements=!0),void 0===t.keepCData&&(t.keepCData=!1),void 0===t.jsDateUTC&&(t.jsDateUTC=!1),function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),"function"!=typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}();var r=1,n=3,i=4,o=8,s=9;function a(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!==t||(t=e.nodeName),t}function c(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"):e}function u(e,r,n){if("property"===t.arrayAccessForm&&(e[r]instanceof Array?e[r+"_asArray"]=e[r]:e[r+"_asArray"]=[e[r]]),!(e[r]instanceof Array)&&t.arrayAccessFormPaths.length>0){for(var i=!1,o=0;o<t.arrayAccessFormPaths.length;o++){var s=t.arrayAccessFormPaths[o];if("string"==typeof s){if(s===n){i=!0;break}}else if(s instanceof RegExp){if(s.test(n)){i=!0;break}}else if("function"==typeof s&&s(r,n)){i=!0;break}}i&&(e[r]=[e[r]])}}function l(e){var t=e.split(/[-T:+Z]/g),r=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(r.setHours(t[3],t[4],n[0]),n.length>1&&r.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function d(e,r){for(var n={__cnt:0},i=e.childNodes,s=0;s<i.length;s++){var c=i.item(s),d=a(c);c.nodeType!==o&&(n.__cnt++,null==n[d]?(n[d]=p(c,r+"."+d),u(n,d,r+"."+d)):(n[d]instanceof Array||(n[d]=[n[d]],u(n,d,r+"."+d)),n[d][n[d].length]=p(c,r+"."+d)))}for(var m=0;m<e.attributes.length;m++){var f=e.attributes.item(m);n.__cnt++;for(var h=f.value,g=0;g<t.attributeConverters.length;g++){var v=t.attributeConverters[g];v.test.call(null,f.name,f.value)&&(h=v.convert.call(null,f.name,f.value))}n[t.attributePrefix+f.name]=h}var y=e.prefix;return y&&(n.__cnt++,n.__prefix=y),n["#text"]&&(n.__text=n["#text"],n.__text instanceof Array&&(n.__text=n.__text.join("\n")),t.escapeMode&&(n.__text=n.__text.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&")),t.stripWhitespaces&&(n.__text=n.__text.trim()),delete n["#text"],"property"===t.arrayAccessForm&&delete n["#text_asArray"],n.__text=function(e,r,n){if(t.datetimeAccessFormPaths.length>0)for(var i=n.split(".#")[0],o=0;o<t.datetimeAccessFormPaths.length;o++){var s=t.datetimeAccessFormPaths[o];if("string"==typeof s){if(s===i)return l(e)}else if(s instanceof RegExp){if(s.test(i))return l(e)}else if("function"==typeof s&&s(i))return l(e)}return e}(n.__text,0,r+".#text")),n.hasOwnProperty("#cdata-section")&&(n.__cdata=n["#cdata-section"],delete n["#cdata-section"],"property"===t.arrayAccessForm&&delete n["#cdata-section_asArray"]),1===n.__cnt&&n.__text?n=n.__text:0===n.__cnt&&"text"===t.emptyNodeForm?n="":n.__cnt>1&&void 0!==n.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""===n.__text||""===n.__text.trim())&&delete n.__text,delete n.__cnt,t.keepCData||n.hasOwnProperty("__text")||!n.hasOwnProperty("__cdata")||1!==Object.keys(n).length?(t.enableToStringFunc&&(n.__text||n.__cdata)&&(n.toString=function(){return(this.__text?this.__text:"")+(this.__cdata?this.__cdata:"")}),n):n.__cdata?n.__cdata:""}function p(e,o){return e.nodeType===s?function(e){for(var n={},i=e.childNodes,o=0;o<i.length;o++){var s=i.item(o);if(s.nodeType===r){var c=a(s);t.ignoreRoot?n=p(s,c):n[c]=p(s,c)}}return n}(e):e.nodeType===r?d(e,o):e.nodeType===n||e.nodeType===i?e.nodeValue:null}function m(e,r,n,i){var o="<"+(e&&e.__prefix?e.__prefix+":":"")+r;if(n)for(var s=0;s<n.length;s++){var a=n[s],u=e[a];t.escapeMode&&(u=c(u)),o+=" "+a.substr(t.attributePrefix.length)+"=",t.useDoubleQuotes?o+='"'+u+'"':o+="'"+u+"'"}return o+(i?" />":">")}function f(e,t){return"</"+(e&&e.__prefix?e.__prefix+":":"")+t+">"}function h(e,r){return"property"===t.arrayAccessForm&&(i="_asArray",-1!==(n=r.toString()).indexOf(i,n.length-8))||0===r.toString().indexOf(t.attributePrefix)||0===r.toString().indexOf("__")||e[r]instanceof Function;var n,i}function g(e){var t=0;if(e instanceof Object)for(var r in e)h(e,r)||t++;return t}function v(e){var r=[];if(e instanceof Object)for(var n in e)-1===n.toString().indexOf("__")&&0===n.toString().indexOf(t.attributePrefix)&&r.push(n);return r}function y(e){var r="";return e instanceof Object?r+=function(e){var r="";return e.__cdata&&(r+="<![CDATA["+e.__cdata+"]]>"),(e.__text||"number"==typeof e.__text||"boolean"==typeof e.__text)&&(t.escapeMode?r+=c(e.__text):r+=e.__text),r}(e):null!==e&&(t.escapeMode?r+=c(e):r+=e),r}function b(e,r,n){var i="";return t.jsAttributeFilter&&t.jsAttributeFilter.call(null,r,e)||(t.jsAttributeConverter&&(e=t.jsAttributeConverter.call(null,r,e)),null!=e&&""!==e||!t.selfClosingElements?"object"==typeof e?"[object Array]"===Object.prototype.toString.call(e)?i+=function(e,t,r){var n="";if(0===e.length)n+=m(e,t,r,!0);else for(var i=0;i<e.length;i++)n+=b(e[i],t,v(e[i]));return n}(e,r,n):e instanceof Date?(i+=m(e,r,n,!1),i+=t.jsDateUTC?e.toUTCString():e.toISOString(),i+=f(e,r)):g(e)>0||"number"==typeof e.__text||"boolean"==typeof e.__text||e.__text||e.__cdata?(i+=m(e,r,n,!1),i+=S(e),i+=f(e,r)):t.selfClosingElements?i+=m(e,r,n,!0):(i+=m(e,r,n,!1),i+=f(e,r)):(i+=m(e,r,n,!1),i+=y(e),i+=f(e,r)):i+=m(e,r,n,!0)),i}function S(e){var t="";if(g(e)>0)for(var r in e)if(!h(e,r)){var n=e[r];t+=b(n,r,v(n))}return t+y(e)}function T(r){if(void 0===r)return null;if("string"!=typeof r)return null;var n=null,i=null;if(e)i=(n=new e(t.xmldomOptions)).parseFromString(r,"text/xml");else if(window&&window.DOMParser){n=new window.DOMParser;var o=null;if(!window.ActiveXObject&&!("ActiveXObject"in window))try{o=n.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(e){o=null}try{i=n.parseFromString(r,"text/xml"),null!==o&&i.getElementsByTagNameNS(o,"parsererror").length>0&&(i=null)}catch(e){i=null}}else 0===r.indexOf("<?")&&(r=r.substr(r.indexOf("?>")+2)),(i=new ActiveXObject("Microsoft.XMLDOM")).async="false",i.loadXML(r);return i}this.asArray=function(e){return null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?l(e):e},this.xml2dom=function(e){return T(e)},this.dom2js=function(e){return p(e,null)},this.js2dom=function(e){return T(this.js2xml(e))},this.xml2js=function(e){var t=T(e);return null!=t?this.dom2js(t):null},this.js2xml=function(e){return S(e)},this.getVersion=function(){return"3.1.1"}}})?n.apply(t,[]):n)||(e.exports=i)},function(e,t,r){var n=r(17),i=r(6),o=r(26),s=r(14),a=r(0),c=r(36),u=r(81).upload,l=r(81).chunkUpload,d=r(81).abort,p=a.supportFormData;function m(e){var t=this;t.options=a.copy(e),a.verifyOptions(e,"url fileName"),a.verifyParamPresentJustOne(e,"blob fileInput"),a.verifyCallback(e,"beginupload uploadprogress uploaddone"),e.fileInput&&(e.fileInput=a.verifyFileInput(e.fileInput)),e.type&&a.verifyFileType(e.type),e.timeout?a.verifyParamType("timeout",e.timeout,"number"):e.timeout=6e5,a.verifyFileUploadCallback(e),e.data={},e.params&&a.merge(e.data,e.params);var r,o,d=e.fileName,m=e.fileInput;function f(){if(m){if(!(o=e.type?a.filterFiles(m.files,e.type):n([]).call(m.files,0))||!o.length)return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+e.type+"类型的文件"));e.data[d]=o[0],r=m.files[0].size}else if(e.blob){var u;if(e.data[d]=e.blob,"file"!==e.type&&e.blob.type&&-1===i(u=e.blob.type).call(u,e.type))return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保选择了"+e.type+"类型的文件"));r=e.blob.size}if(e.maxSize&&r>e.maxSize)e.uploaddone(c.newFileTooLargeError("上传文件大小超过".concat(e.maxSize,"限制")));else{if(!e.commonUpload)return r>s.chunkMaxSize?void e.uploaddone(c.newFileTooLargeError("直传文件大小超过".concat(s.chunkMaxSize,"限制"))):void(t.sn=l(e,d,t,-1));if(r>s.commonMaxSize)e.uploaddone(c.newFileTooLargeError("普通上传文件大小超过".concat(s.commonMaxSize,"限制")));else if(e.s3Policy&&e.s3Policy.uploadConfig&&e.s3Policy.uploadConfig.retryPolicy){var p=e.s3Policy.uploadConfig.retryPolicy,f={accessKeyId:e.mixStoreToken.accessKeyId,secretAccessKey:e.mixStoreToken.secretAccessKey,sessionToken:e.mixStoreToken.sessionToken,region:e.mixStoreToken.region,maxRetries:p.retry},g=new e.s3;g.config.update(f);var v=decodeURIComponent(e.mixStoreToken.bucket),y=decodeURIComponent(e.mixStoreToken.objectName),b=e.data[d],S=g.upload({Bucket:v,Key:y,Body:b,Metadata:{token:e.mixStoreToken.token},ContentType:b.type||"application/octet-stream"});S.on("httpUploadProgress",(function(t){var r=Math.floor(1e4*t.loaded/t.total)/100,n={docId:e.docId,total:t.total,loaded:t.loaded,percentage:r,percentageText:r+"%"};e.fileInput&&(n.fileInput=e.fileInput),e.blob&&(n.blob=e.blob),e.uploadprogress(n)})),S.send((function(r,n){if(e.docId&&(n.docId=e.docId),r){var o;e.logger.error("error:","api::s3:upload file failed",r);var s=e.providers[(i(o=e.providers).call(o,e.curProvider)+1)%e.providers.length];p.retryNext&&s?(t.addCircuitTimer(e,s),1===s&&e.getMixStoreToken(1,(function(t){e.mixStoreToken=t,h()}))):t.onError(n)}else{var a=t.options.s3Policy.cdnSchema;a=(a=a.replace("{cdnDomain}",t.options.s3Policy.dlcdn)).replace("{objectName}",n.Key),e.uploaddone(null,{size:b.size,name:b.name,url:a,ext:b.name.split(".")[1]||"unknown",_url_safe:e.mixStoreToken.shortUrl,isS3:!0}),e.logger.info("s3 Upload done: fileObj is",{size:b.size,name:b.name,url:a,ext:b.name.split(".")[1]||"unknown",_url_safe:e.mixStoreToken.shortUrl,isS3:!0})}}))}}}function h(){if(p){if(m){if(!(o=e.type?a.filterFiles(m.files,e.type):n([]).call(m.files,0))||!o.length)return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+e.type+"类型的文件"));e.data[d]=o[0],r=m.files[0].size}else if(e.blob){var h;if(e.data[d]=e.blob,"file"!==e.type&&e.blob.type&&-1===i(h=e.blob.type).call(h,e.type))return void e.uploaddone(c.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保选择了"+e.type+"类型的文件"));r=e.blob.size}if(e.maxSize&&r>e.maxSize)return void e.uploaddone(c.newFileTooLargeError("上传文件大小超过".concat(e.maxSize,"限制")));if(!e.commonUpload)return r>s.chunkMaxSize?void e.uploaddone(c.newFileTooLargeError("直传文件大小超过".concat(s.chunkMaxSize,"限制"))):(t.onLbsUrlFail=function(r){t.reporter.reportTraceStart("nos",{user_id:e.account,action:"upload"}),t.reporter.reportTractUpdate("nos",{operation_type:"transfer",error:"lbs failed",target:r},!1)},void(t.sn=l(e,d,t,-1)));if(r>s.commonMaxSize)return void e.uploaddone(c.newFileTooLargeError("普通上传文件大小超过".concat(s.commonMaxSize,"限制")))}else a.dataset(m,"name",d),e.data.input=m;var g={data:e.data,onaftersend:function(){e.beginupload(t)},onuploading:function(t){var r=Math.floor(1e4*t.loaded/t.total)/100,n={docId:e.docId,total:t.total,loaded:t.loaded,percentage:r,percentageText:r+"%"};e.fileInput&&(n.fileInput=e.fileInput),e.blob&&(n.blob=e.blob),e.uploadprogress(n)},onload:function(r){var n;if(e.docId&&(r.docId=e.docId),!r.Error)return e.uploaddone(null,r),void e.logger.info("nos Upload done: fileObj is",r);if(e.mixEnable&&1===e.curProvider){var o=e.nosPolicy.uploadConfig.retryPolicy,s=e.providers[(i(n=e.providers).call(n,e.curProvider)+1)%e.providers.length];o.retryNext&&s?(t.addCircuitTimer(e,s),2===s&&e.getMixStoreToken(2,(function(t){e.mixStoreToken=t,f()}))):t.onError(r)}else t.onError(r)},onerror:function(r){var n;if(e.mixEnable&&1===e.curProvider){var o,s=e.nosPolicy.uploadConfig.retryPolicy,a=e.providers[(i(o=e.providers).call(o,e.curProvider)+1)%e.providers.length];if(s.retryNext&&a)t.addCircuitTimer(e,a),2===a&&e.getMixStoreToken(2,(function(t){e.mixStoreToken=t,f()}));else try{n=r.result?JSON.parse(r.result):r,t.onError(n)}catch(n){e.uploaddone(new c(r.message,r.code),t.options)}}else try{n=r.result?JSON.parse(r.result):r,t.onError(n)}catch(n){e.uploaddone(new c(r.message,r.code),t.options)}}};p||(g.mode="iframe"),g.putFileAtEnd=!0,t.sn=u(e.url,g)}e.mixEnable&&2===e.curProvider?f():h()}m.prototype.addCircuitTimer=function(e,t){var r=this;if(e.curProvider=t,e.s3Policy&&e.nosPolicy){var n=e[1===e.curProvider?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!n||0===n)return;r.circuitTimer&&clearTimeout(r.circuitTimer),r.circuitTimer=o((function(){e.curProvider=e.providers[0],r.circuitTimer=void 0}),1e3*n)}},m.prototype.onError=function(e){var t,r,n,i=this.options;r=(t=(e=e||{}).Error||e||{}).Code||t.code||"unknown",n=t.Message||t.message||"未知错误",i.uploaddone(new c(r+"("+n+")",r))},m.prototype.abort=function(){d(this.sn)},e.exports=m},function(e,t,r){var n=r(15),i=r(23),o=r(3),s=r(26),a=r(10),c=r(47),u=r(138);function l(e){e.onuploading&&this.on("uploading",e.onuploading),u.call(this,e)}var d=u.prototype,p=l.prototype=n(d);p.doSend=function(){var e,t,r,n=this.options,u=n.headers,l=this.xhr=new XMLHttpRequest;if("multipart/form-data"===u["Content-Type"]){var d,p;delete u["Content-Type"],l.upload.onprogress=i(d=this.onProgress).call(d,this),l.upload.onload=i(p=this.onProgress).call(p,this);var m,f=n.data;n.data=new window.FormData,f&&o(m=c.getKeys(f,n.putFileAtEnd)).call(m,(function(e){var t=f[e];t.tagName&&"INPUT"===t.tagName.toUpperCase()?"file"===t.type&&o([]).call(t.files,(function(e){n.data.append(c.dataset(t,"name")||t.name||e.name||"file-"+c.uniqueID(),e)})):n.data.append(e,t)}))}else if(u["x-nos-token"]){var h,g;l.upload.onprogress=i(h=this.onProgress).call(h,this),l.upload.onload=i(g=this.onProgress).call(g,this)}l.onreadystatechange=i(e=this.onStateChange).call(e,this),0!==n.timeout&&(this.timer=s(i(r=this.onTimeout).call(r,this),n.timeout)),l.open(n.method,n.url,!n.sync),o(t=a(u)).call(t,(function(e){l.setRequestHeader(e,u[e])})),n.cookie&&"withCredentials"in l&&(l.withCredentials=!0),l.send(n.data),this.afterSend()},p.onProgress=function(e){e.lengthComputable&&e.loaded<=e.total&&this.emit("uploading",e)},p.onStateChange=function(){var e,t=this.xhr;4===t.readyState&&(e={status:t.status,result:t.responseText||""},this.onLoad(e))},p.getResponseHeader=function(e){var t=this.xhr;return t?t.getResponseHeader(e):""},p.destroy=function(){clearTimeout(this.timer);try{this.xhr.onreadystatechange=c.f,this.xhr.abort()}catch(e){}d.destroy.call(this)},e.exports=l},function(e,t,r){var n;!function(t){function i(){}var o=i.prototype,s=t.EventEmitter;function a(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}o.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp)for(r in t={},n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r]);else t=n[e]||(n[e]=[]);return t},o.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},o.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},o.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var r,n=this.getListenersAsObject(e),i="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&-1===a(n[r],t)&&n[r].push(i?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var r,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(r=a(i[n],t))&&i[n].splice(r,1);return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):s.call(this,n,i));return this},o.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"===r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var r,n,i,o,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(r=s[o].slice(0),i=0;i<r.length;i++)!0===(n=r[i]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=s,i},void 0===(n=function(){return i}.call(t,r,t,e))||(e.exports=n)}("undefined"!=typeof window?window:this||{})},function(e,t,r){var n=r(15),i=r(6),o=r(3),s=r(23),a=r(77),c=r(47),u=r(138),l=r(194),d="NEJ-UPLOAD-RESULT:",p={};function m(e){this.init(),u.call(this,e)}var f=u.prototype,h=m.prototype=n(f);h.init=function(){var e=!1;function t(e){var t=e.data;if(0===i(t).call(t,d)){var r=(t=JSON.parse(t.replace(d,""))).key,n=p[r];n&&(delete p[r],t.result=decodeURIComponent(t.result||""),n.onLoad(t.result))}}return function(){!function(){if(!e){e=!0;var r=c.getGlobal();r.postMessage?c.on(r,"message",t):(l.addMsgListener(t),l.startTimer())}}()}}(),h.doSend=function(){var e=this,t=e.options,r=e.key="zoro-ajax-upload-iframe-"+c.uniqueID();p[r]=e;var n=e.form=c.html2node('<form style="display:none;"></form>');"undefined"==typeof document||document.body.appendChild(n),n.target=r,n.method="POST",n.enctype="multipart/form-data",n.encoding="multipart/form-data";var i=t.url,a=c.genUrlSep(i);n.action=i+a+"_proxy_=form";var u,l=t.data,d=[],m=[];function f(){o(d).call(d,(function(e,t){var r=m[t];r.parentNode&&(e.name=r.name,c.isFunction(e.setAttribute)&&e.setAttribute("form",r.getAttribute("form")),r.parentNode.replaceChild(e,r))}))}l&&o(u=c.getKeys(l,t.putFileAtEnd)).call(u,(function(e){var t=l[e];if(t.tagName&&"INPUT"===t.tagName.toUpperCase()){if("file"===t.type){var r=t,i=r.cloneNode(!0);r.parentNode.insertBefore(i,r);var o=c.dataset(r,"name");o&&(r.name=o),n.appendChild(r),c.isFunction(r.setAttribute)&&(r.setAttribute("form",""),r.removeAttribute("form")),d.push(t),m.push(i)}}else{var s=c.html2node('<input type="hidden"/>');s.name=e,s.value=t,n.appendChild(s)}}));var h=e.iframe=c.createIframe({name:r,onload:function(){var t;e.aborted?f():(c.on(h,"load",s(t=e.checkResult).call(t,e)),n.submit(),f(),e.afterSend())}})},h.checkResult=function(){var e,t;try{var r,n;if(e=this.iframe.contentWindow.document.body,t=a(r=e.innerText||e.textContent||"").call(r),i(t).call(t,d)>=0||i(n=e.innerHTML).call(n,d)>=0)return}catch(e){return}this.onLoad(t)},h.onLoad=function(e){f.onLoad.call(this,{status:200,result:e}),c.remove(this.form),c.remove(this.iframe),f.destroy.call(this)},h.destroy=function(){c.remove(this.iframe),c.remove(this.form)},h.abort=function(){this.aborted=!0,delete p[this.key],f.abort.call(this)},e.exports=m},function(e,t,r){r(188);var n=r(12);e.exports=n.setInterval},function(e,t,r){var n=r(15),i=r(6),o=r(23),s=r(3),a=r(47),c=r(194),u=r(138),l={};function d(e){this.init(),u.call(this,e)}var p=u.prototype,m=d.prototype=n(p);m.init=function(){var e="NEJ-AJAX-DATA:",t=!1;function r(t){var r=t.data;if(0===i(r).call(r,e)){var n=(r=JSON.parse(r.replace(e,""))).key,o=l[n];o&&(delete l[n],r.result=decodeURIComponent(r.result||""),o.onLoad(r))}}return function(){!function(){if(!t){t=!0;var e=a.getGlobal();e.postMessage?a.on(e,"message",r):c.addMsgListener(r)}}()}}(),m.doSend=function(){var e=this.options,t=a.url2origin(e.url),r=e.proxyUrl||t+"/res/nej_proxy_frame.html",n=l[r];if(a.isArray(n)){var i;n.push(o(i=this.doSend).call(i,this,e))}else{var u;if(!n)return l[r]=[o(u=this.doSend).call(u,this,e)],void a.createIframe({src:r,onload:function(e){var t=l[r];l[r]=a.target(e).contentWindow,s(t).call(t,(function(e){try{e()}catch(e){}}))}});if(!this.aborted){var d=this.key=a.uniqueID();l[d]=this;var p=a.fetch({method:"GET",url:"",data:null,headers:{},timeout:0},e);p.key=d,c.postMessage(n,{data:p}),this.afterSend()}}},m.abort=function(){this.aborted=!0,delete l[this.key],p.abort.call(this)},e.exports=d},function(e,t,r){var n,i,o=r(11),s=r(47),a=r(112),c=(n=/json/i,i=/post/i,function(e,t){var r=(t=t||{}).data=t.data||{},c=t.headers=t.headers||{},u=s.checkWithDefault(c,"Accept","application/json"),l=s.checkWithDefault(c,"Content-Type","application/json");return n.test(u)&&(t.type="json"),i.test(t.method)&&n.test(l)&&(t.data=o(r)),a(e,t)});e.exports=c},function(e,t,r){var n=r(112);e.exports=function(e,t){return t.method="POST",t.headers=t.headers||{},t.headers["Content-Type"]="multipart/form-data",t.timeout=0,t.type=t.type||"json",n(e,t)}},function(e,t,r){var n=r(17),i=r(50),o=r(6),s=r(4),a=r(14),c=a.chunkSize,u=r(112),l={mp4:"video/mp4",avi:"video/x-msvideo",wmv:"video/x-ms-wmv",mpeg:"video/mpeg",mov:"video/quicktime",aac:"audio/x-aac",wma:"audio/x-ms-wma",wav:"audio/x-wav",mp3:"audio/mp3"};e.exports=function e(t,r,d,p){var m={file:t.data[r],fileSize:t.data[r].size,fileUploadedSize:0,percentage:0},f=t.url;function h(e){var r=m.fileUploadedSize+e.loaded,n=Math.floor(1e4*r/m.fileSize)/100;if(i(n)>=100&&(n=100,h=function(){}),m.percentage!==n){m.percentage=n;var o={docId:t.docId,total:m.fileSize,loaded:r,percentage:n,percentageText:n+"%"};t.fileInput&&(o.fileInput=t.fileInput),t.blob&&(o.blob=t.blob),t.uploadprogress(o)}}function g(n){var i=n&&n.code;function o(){try{if(n.result)var e=JSON.parse(n.result);else e=n;d.onError(e)}catch(e){d.onError(e)}}0===m.fileUploadedSize&&"abort"!==i?t.edgeList?p<t.edgeList.length-1?e(t,r,d,p+1):o():t.nosLbsUrls&&t.nosLbsUrls.length>0?function(e,t,r,n){return new s((function(i){function o(){u(r[e],{query:{version:"1.0",bucketname:t},method:"GET",onerror:s,onload:function(e){try{(e=JSON.parse(e))&&e.upload&&e.upload.length?i(e.upload):s()}catch(e){s()}}})}function s(){n.onLbsUrlFail(r[e]),e<r.length-1?(e++,o()):i([])}o()}))}(0,t.nosToken.bucket,t.nosLbsUrls,d).then((function(n){n.length>0?(t.edgeList=n,t.updateNosEdgeList&&t.updateNosEdgeList(n),e(t,r,d,p+1)):o()})):(t.edgeList=a.edgeList,e(t,r,d,p+1)):o()}"number"!=typeof p&&(p=-1),t.edgeList&&t.edgeList.length&&(p=p>0?p:0,f=t.edgeList[p]),f+="/"+t.nosToken.bucket+"/"+t.nosToken.objectName;var v=t.data.file&&t.data.file.type;if(!v||o(v).call(v,"/")<0){var y=(t.fileInputName||"").split(".").pop();"image"===t.type?v="image/"+("jpg"===y?"jpeg":y):"audio"!==t.type&&"video"!==t.type||(v=l[y])}var b={query:{offset:0,complete:c>=m.fileSize,version:"1.0"},headers:{"Content-Type":v||"application/octet-stream","x-nos-token":t.nosToken.token},method:"POST",timeout:0,onaftersend:function(){t.beginupload(d)},onuploading:h,onload:function e(r){try{r=JSON.parse(r)}catch(r){return void d.onError(r)}if(r.errMsg||r.errCode)d.onError(r);else if(r.offset<m.fileSize)delete b.onaftersend,m.fileUploadedSize=r.offset,function(t,r,i,o){var s=t.offset,a=t.offset+c;if("undefined"!=typeof FileReader){var l,p=new FileReader;p.readAsArrayBuffer(n(l=o.file).call(l,s,a)),p.addEventListener("load",(function(n){r.data=n.target.result,r.query.offset=t.offset,r.query.complete=a>=o.fileSize,r.query.context=t.context,r.onuploading=h,r.onload=e,r.onerror=g,d.sn=u(f,r)})),p.addEventListener("error",(function(e){r.onerror(e.target.error)}))}else{var m;r.data=n(m=o.file).call(m,s,a),r.query.offset=t.offset,r.query.complete=a>=o.fileSize,r.query.context=t.context,r.onuploading=h,r.onload=e,r.onerror=g,d.sn=u(f,r)}}(r,b,0,m);else{var i=a.genFileUrl(t.nosToken);"image"===t.type?u(i+"?imageInfo",{onload:function(e){try{e=JSON.parse(e),t.uploaddone(null,{docId:r.docId,w:e.Width,h:e.Height,orientation:e.Orientation||"",type:e.Type,size:e.Size||m.fileSize})}catch(e){o(e)}},onerror:function(e){if("undefined"!=typeof Image){var n=new Image;n.src=i,n.onload=function(){t.uploaddone(null,{docId:r.docId,w:n.width,h:n.height,size:m.fileSize})},n.onerror=function(e){o(e)}}else o(e)}}):"video"===t.type||"audio"===t.type?u(i+"?vinfo",{onload:function(e){try{(e=JSON.parse(e)).GetVideoInfo&&e.GetVideoInfo.VideoInfo&&(e=e.GetVideoInfo.VideoInfo),t.uploaddone(null,{docId:r.docId,w:e.Width,h:e.Height,dur:e.Duration,orientation:e.Rotate,audioCodec:e.AudioCodec,videoCodec:e.VideoCodec,container:e.Container,size:e.Size||m.fileSize})}catch(e){o(e)}},onerror:o}):t.uploaddone(null,{docId:r.docId,size:m.fileSize})}function o(e){d.onError(e)}},onerror:g};if("undefined"!=typeof FileReader){var S,T=new FileReader;T.addEventListener("load",(function(e){b.data=e.target.result,d.sn=u(f,b)})),T.addEventListener("error",(function(e){b.onerror(e.target.error)})),T.readAsArrayBuffer(n(S=m.file).call(S,0,c))}else{var _;b.data=n(_=m.file).call(_,0,c),d.sn=u(f,b)}}},function(e,t,r){var n,i=r(110),o=r(6),s=r(11),a=r(23),c=r(8),u=r(17),l=r(10),d=r(0),p=r(52).fn,m=r(196),f=r(193),h=r(36);p.transDoc=function(e){var t;d.verifyOptions(e,"fileInput done","nos::transDoc");try{var r=e.fileInput.files[0],n=["ppt","pdf","pptx","doc","docx"],c=e.fileInputName=r.name,u={ppt:1,pptx:2,pdf:3,doc:6,docx:7},l=c.substring(i(c).call(c,".")+1);if(o(n).call(n,l)<0)return void e.done(h.newNoFileError("请上传正确格式的文件【ppt, pptx, pdf, doc, docx】",{callFunc:"nos: transDoc",fileInput:e.fileInput}),e)}catch(t){return void e.done(h.newNoFileError("请上传正确的文件节点",{callFunc:"msg::previewFile",fileInput:e.fileInput}),e)}var p=s(f.genResponseBody("file")||{}).replace(/"/gi,'\\"'),m={transToken:{name:c,type:u[l],transType:"png"===e.transcode?11:10,size:r.size,body:p}};this.getNosTokenTrans({responseBody:m,nosToken:{nosScene:e.nosScene||this.nosScene,nosSurvivalTime:e.nosSurvivalTime},callback:a(t=function(t,r){t?e.done(t):(e.nosToken=r.nosToken,e.docId=r.docId,this._doPreviewFile(e))}).call(t,this)})},p.getSimpleNosToken=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.num=1,d.verifyOptions(e),this.cbAndSendCmd("getSimpleNosToken",e)},p.getNosToken=function(e){var t=e.callback,r=e.nosToken,n=e.responseBody,i={tag:r.nosScene};r.nosSurvivalTime&&r.nosSurvivalTime!==1/0&&(i.expireSec=r.nosSurvivalTime),this.sendCmd("getNosToken",{responseBody:n,nosToken:i},t)},p.getNosTokenTrans=function(e){this.sendCmd("getNosTokenTrans",e.responseBody,e.callback)},p.getMixStoreToken=function(e){this.sendCmd("getMixStoreToken",{mixTokenReq:{provider:e.curProvider,tokenCount:e.tokenCount||1,tag:"im",returnBody:e.responseBody}},e.callback)},p.packFileDownloadName=function(e){d.verifyOptions(e,"url name",!0,"","nos::packFileDownloadName");var t=e.url;return t+d.genUrlSep(t)+"download="+encodeURIComponent(e.name)},p.audioToMp3=function(e){d.verifyOptions(e,"url","nos::audioToMp3");var t=e.url;return t+d.genUrlSep(t)+"audioTrans&type=mp3"},p.removeFile=function(e){this.sendCmd("removeFile",e,e.callback)},p.fetchFile=function(e){this.sendCmd("fetchFile",e,e.callback)},p.fetchFileList=function(e){this.sendCmd("fetchFileList",e,e.callback)},p.stripImageMeta=function(e){return this.beforeProcessImage(e,"stripmeta")},p.qualityImage=function(e){return this.beforeProcessImage(e,"quality")},p.interlaceImage=function(e){return this.beforeProcessImage(e,"interlace")},p.rotateImage=function(e){return this.beforeProcessImage(e,"rotate")},p.blurImage=function(e){return this.beforeProcessImage(e,"blur")},p.cropImage=function(e){return this.beforeProcessImage(e,"crop")},p.thumbnailImage=function(e){return this.beforeProcessImage(e,"thumbnail")},p.beforeProcessImage=function(e,t){var r=d.copy(e);return r.type=t,e.ops=[r],this.processImage(e)},p.processImage=function(e){var t,r=this;d.verifyOptions(e,"url ops",!0,"","nos::processImage"),d.verifyParamType("ops",e.ops,"array","nos::processImage");var n=c(t=e.ops).call(t,(function(e){var t,n;return d.verifyOptions(e,"type",!0,"","nos::processImage"),d.verifyParamValid("type",e.type,m.validTypes,"nos::processImage"),r["gen"+u(t=e.type).call(t,0,1).toUpperCase()+u(n=e.type).call(n,1)+"Op"](e)}));r.processCallback(e),r.sendCmd("processImage",{url:e.url,imageOps:n},e.callback)},p.genStripmetaOp=function(e){return new m({type:e.type,stripmeta:e.strip?1:0})},p.genQualityOp=function(e){d.verifyOptions(e,"quality",!0,"","nos::genQualityOp"),d.verifyParamType("quality",e.quality,"number","nos::genQualityOp"),d.verifyParamMin("quality",e.quality,0,"nos::genQualityOp"),d.verifyParamMax("quality",e.quality,100,"nos::genQualityOp");var t=Math.round(e.quality);return new m({type:e.type,qualityQuality:t})},p.genInterlaceOp=function(e){return new m({type:e.type})},p.genRotateOp=function(e){for(d.verifyOptions(e,"angle",!0,"","nos::genRotateOp"),d.verifyParamType("angle",e.angle,"number","nos::genRotateOp");e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t=Math.round(e.angle);return new m({type:e.type,rotateAngle:t})},p.genBlurOp=function(e){d.verifyOptions(e,"radius sigma","nos::genBlurOp"),d.verifyParamType("radius",e.radius,"number","nos::genBlurOp"),d.verifyParamMin("radius",e.radius,1,"nos::genBlurOp"),d.verifyParamMax("radius",e.radius,50,"nos::genBlurOp"),d.verifyParamType("sigma",e.sigma,"number","nos::genBlurOp"),d.verifyParamMin("sigma",e.sigma,0,"nos::genBlurOp");var t=Math.round(e.radius),r=Math.round(e.sigma);return new m({type:e.type,blurRadius:t,blurSigma:r})},p.genCropOp=function(e){d.verifyOptions(e,"x y width height","nos::genCropOp"),d.verifyParamType("x",e.x,"number","nos::genCropOp"),d.verifyParamMin("x",e.x,0,"nos::genCropOp"),d.verifyParamType("y",e.y,"number","nos::genCropOp"),d.verifyParamMin("y",e.y,0,"nos::genCropOp"),d.verifyParamType("width",e.width,"number","nos::genCropOp"),d.verifyParamMin("width",e.width,0,"nos::genCropOp"),d.verifyParamType("height",e.height,"number","nos::genCropOp"),d.verifyParamMin("height",e.height,0,"nos::genCropOp");var t=Math.round(e.x),r=Math.round(e.y),n=Math.round(e.width),i=Math.round(e.height);return new m({type:e.type,cropX:t,cropY:r,cropWidth:n,cropHeight:i})},p.genThumbnailOp=(n={cover:"z",contain:"x",crop:"y"},function(e){d.verifyOptions(e,"mode","nos::genThumbnailOp"),d.verifyParamValid("mode",e.mode,l(n),"nos::genThumbnailOp"),"contain"===e.mode?d.verifyParamAtLeastPresentOne(e,"width height","nos::genThumbnailOp"):d.verifyOptions(e,"width height","nos::genThumbnailOp"),d.undef(e.width)&&(e.width=0),d.undef(e.height)&&(e.height=0),d.verifyParamType("width",e.width,"number","nos::genThumbnailOp"),d.verifyParamMin("width",e.width,0,"nos::genThumbnailOp"),d.verifyParamType("height",e.height,"number","nos::genThumbnailOp"),d.verifyParamMin("height",e.height,0,"nos::genThumbnailOp");var t=Math.round(e.width),r=Math.round(e.height),i=new m({type:e.type,thumbnailMode:n[e.mode],thumbnailWidth:t,thumbnailHeight:r});if("crop"===e.mode&&d.notundef(e.axis)){d.undef(e.axis.x)&&(e.axis.x=5),d.undef(e.axis.y)&&(e.axis.y=5),d.verifyParamMin("axis.x",e.axis.x,0,"nos::genThumbnailOp"),d.verifyParamMax("axis.x",e.axis.x,10,"nos::genThumbnailOp"),d.verifyParamMin("axis.y",e.axis.y,0,"nos::genThumbnailOp"),d.verifyParamMax("axis.y",e.axis.y,10,"nos::genThumbnailOp");var o=Math.round(e.axis.x),s=Math.round(e.axis.y);i.thumbnailAxisX=o,i.thumbnailAxisY=s}return d.notundef(e.enlarge)&&(d.verifyParamType("enlarge",e.enlarge,"boolean","nos::genThumbnailOp"),e.enlarge&&(i.thumbnailEnlarge=1)),i.thumbnailToStatic=this.options.thumbnailToStatic?1:0,i}),p.getNosOriginUrl=function(e){var t;d.verifyOptions(e,"safeShortUrl",!0,"","nos::getNosOriginUrl"),d.verifyParamType("safeShortUrl",e.safeShortUrl,"string","nos::getNosOriginUrl"),/^http(s)?:/.test(e.safeShortUrl)&&~o(t=e.safeShortUrl).call(t,"im_url=1")?(this.processCallback(e),this.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:e.safeShortUrl}},e.callback)):e.done(new h("参数 “safeShortUrl” 内容非文件安全短链",{callFunc:"nos: getNosOriginUrl"}),e)}},function(e,t,r){var n,i=r(13),o=r(6),s=r(10),a=r(27),c=r(82),u=c.genUrlSep,l=c.url2object,d=c.object2url,p=r(0),m=r(52).fn;m.viewImageSync=function(e){var t=this.options;p.verifyOptions(e,"url","nos::viewImageSync");var r=e.url,n=l(r),s=n.protocol,c=n.hostname,u=n.path,m=n.query;if("boolean"==typeof e.strip&&(m.stripmeta=e.strip?1:0),"number"==typeof e.quality&&(p.verifyParamMin("quality",e.quality,0,"nos::viewImageSync"),p.verifyParamMax("quality",e.quality,100,"nos::viewImageSync"),m.quality=Math.round(e.quality)),"boolean"==typeof e.interlace&&(m.interlace=e.interlace?1:0),"number"==typeof e.rotate&&(m.rotate=Math.round(e.rotate)),"object"===a(e.thumbnail)){var f=e.thumbnail.mode||"crop",h=e.thumbnail.width,g=e.thumbnail.height;if(h>=0&&g>=0&&h<4096&&g<4096&&(h>0||g>0)){var v,y;switch(f){case"crop":f="y";break;case"contain":default:f="x";break;case"cover":f="z"}m.thumbnail=i(v=i(y="".concat(h)).call(y,f)).call(v,g)}}if(t.downloadUrl){var b=l(e.url),S=t.downloadUrl,T=b.path,_=o(T).call(T,"/");if(-1!==_){var w=T.substring(0,_),M=T.substring(_+1);S=S.replace("{bucket}",w).replace("{object}",M)}var x=l(S);return d({protocol:x.protocol,hostname:x.hostname,path:x.path,query:p.merge(x.query,m)})}return d({protocol:s,hostname:c,path:u,query:m})},m.viewImageStripMeta=function(e){p.verifyOptions(e,"url strip","nos::viewImageStripMeta"),p.verifyParamType("strip",e.strip,"boolean","nos::viewImageStripMeta");var t="stripmeta="+(e.strip?1:0),r=u(e.url);return e.url+r+t},m.viewImageQuality=function(e){p.verifyOptions(e,"url quality","nos::viewImageQuality"),p.verifyParamType("quality",e.quality,"number","nos::viewImageQuality"),p.verifyParamMin("quality",e.quality,0,"nos::viewImageQuality"),p.verifyParamMax("quality",e.quality,100,"nos::viewImageQuality");var t="quality="+Math.round(e.quality),r=u(e.url);return e.url+r+t},m.viewImageInterlace=function(e){p.verifyOptions(e,"url","nos::viewImageInterlace");var t=u(e.url);return e.url+t+"interlace=1"},m.viewImageRotate=function(e){for(p.verifyOptions(e,"url angle","nos::viewImageRotate"),p.verifyParamType("angle",e.angle,"number","nos::viewImageRotate");e.angle<0;)e.angle=e.angle+360;e.angle=e.angle%360;var t="rotate="+Math.round(e.angle),r=u(e.url);return e.url+r+t},m.viewImageBlur=function(e){p.verifyOptions(e,"url radius sigma","nos::viewImageBlur"),p.verifyParamType("radius",e.radius,"number","nos::viewImageBlur"),p.verifyParamMin("radius",e.radius,1,"nos::viewImageBlur"),p.verifyParamMax("radius",e.radius,50,"nos::viewImageBlur"),p.verifyParamType("sigma",e.sigma,"number","nos::viewImageBlur"),p.verifyParamMin("sigma",e.sigma,0,"nos::viewImageBlur");var t="blur="+Math.round(e.radius)+"x"+Math.round(e.sigma),r=u(e.url);return e.url+r+t},m.viewImageCrop=function(e){p.verifyOptions(e,"url x y width height","nos::viewImageCrop"),p.verifyParamType("x",e.x,"number","nos::viewImageCrop"),p.verifyParamMin("x",e.x,0,"nos::viewImageCrop"),p.verifyParamType("y",e.y,"number","nos::viewImageCrop"),p.verifyParamMin("y",e.y,0,"nos::viewImageCrop"),p.verifyParamType("width",e.width,"number","nos::viewImageCrop"),p.verifyParamMin("width",e.width,0,"nos::viewImageCrop"),p.verifyParamType("height",e.height,"number","nos::viewImageCrop"),p.verifyParamMin("height",e.height,0,"nos::viewImageCrop");var t="crop="+Math.round(e.x)+"_"+Math.round(e.y)+"_"+Math.round(e.width)+"_"+Math.round(e.height),r=u(e.url);return e.url+r+t},m.viewImageThumbnail=(n={cover:"z",contain:"x",crop:"y"},function(e){p.verifyOptions(e,"url mode","nos::viewImageThumbnail"),p.verifyParamValid("mode",e.mode,s(n),"nos::viewImageThumbnail"),"contain"===e.mode?p.verifyParamAtLeastPresentOne(e,"width height","nos::viewImageThumbnail"):p.verifyOptions(e,"width height","nos::viewImageThumbnail"),p.undef(e.width)&&(e.width=0),p.undef(e.height)&&(e.height=0),p.verifyParamType("width",e.width,"number","nos::viewImageThumbnail"),p.verifyParamMin("width",e.width,0,"nos::viewImageThumbnail"),p.verifyParamType("height",e.height,"number","nos::viewImageThumbnail"),p.verifyParamMin("height",e.height,0,"nos::viewImageThumbnail");var t=Math.round(e.width),r=Math.round(e.height),i="thumbnail="+t+n[e.mode]+r;"crop"===e.mode&&p.notundef(e.axis)&&(p.undef(e.axis.x)&&(e.axis.x=5),p.undef(e.axis.y)&&(e.axis.y=5),p.verifyParamMin("axis.x",e.axis.x,0,"nos::viewImageThumbnail"),p.verifyParamMax("axis.x",e.axis.x,10,"nos::viewImageThumbnail"),p.verifyParamMin("axis.y",e.axis.y,0,"nos::viewImageThumbnail"),p.verifyParamMax("axis.y",e.axis.y,10,"nos::viewImageThumbnail"),i=i+"&axis="+Math.round(e.axis.x)+"_"+Math.round(e.axis.y)),p.notundef(e.enlarge)&&(p.verifyParamType("enlarge",e.enlarge,"boolean","nos::viewImageThumbnail"),e.enlarge&&(i+="&enlarge=1"));var o=u(e.url);return e.url+o+i})},function(e,t,r){var n=r(441);e.exports=n},function(e,t,r){var n=r(16),i=r(442),o=r(444),s=Array.prototype,a=String.prototype;e.exports=function(e){var t=e.includes;return e===s||n(s,e)&&t===s.includes?i:"string"==typeof e||e===a||n(a,e)&&t===a.includes?o:t}},function(e,t,r){r(443);var n=r(22);e.exports=n("Array").includes},function(e,t,r){var n=r(2),i=r(127).includes,o=r(146);n({target:"Array",proto:!0},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(e,t,r){r(445);var n=r(22);e.exports=n("String").includes},function(e,t,r){var n=r(2),i=r(7),o=r(446),s=r(84),a=r(43),c=r(448),u=i("".indexOf);n({target:"String",proto:!0,forced:!c("includes")},{includes:function(e){return!!~u(a(s(this)),a(o(e)),arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){var n=r(1),i=r(447),o=n.TypeError;e.exports=function(e){if(i(e))throw o("The method doesn't accept regular expressions");return e}},function(e,t,r){var n=r(28),i=r(66),o=r(18)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(18)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,r){var n=r(27),i=r(11),o=r(6),s=r(213),a=r(0),c=r(52).fn,u=r(14);function l(e,t,r,n){var i=!1,s="";if(1===r?o(e).call(e,t)>=0&&(i=!0,s=t):2===r&&(s=new RegExp(t,"g")).test(e)&&(i=!0),i&&""!==s)switch(n){case 1:return e.replace(s,"**");case 2:return{code:2};case 3:return{code:3}}return e}function d(e,t){for(var r=t.match,i=t.operate,o=e,a=0;a<s(t).length;a++){var c=s(t)[a],u=c.match||r,d=c.operate||i;try{if(o=l(o,c.key,u,d),"object"===n(o))return o}catch(e){this.logger.warn("misc::filterContent: js cannot parse this regexp ",e)}}return o}c.uploadSdkLogUrl=function(e){return a.verifyOptions(e,"url","misc::uploadSdkLogUrl"),this.cbAndSendCmd("uploadSdkLogUrl",e)},c.getClientAntispamLexicon=function(e){var t=this,r=(e=e||{}).done;r instanceof Function||(r=function(){}),e={clientAntispam:{version:0}};var n=this;if(u.hasLocalStorage&&localStorage.getItem("antispamLexicon")&&"{}"!==localStorage.getItem("antispamLexicon"))try{n.antispamLexicon=JSON.parse(localStorage.getItem("antispamLexicon"))}catch(e){this.logger.error("JSON parse antispamLexicon error",e)}n.antispamLexicon&&r.call(this,null,{clientAntispam:n.antispamLexicon}),this.protocol.sendCmd("getClientAntispam",e,(function(e,o,s){e?(n.protocol.logger.error("misc::getClientAntispamLexicon:",e),r.call(t,e,{})):(u.hasLocalStorage&&localStorage.setItem("antispamLexicon",i(s.clientAntispam)),n.antispamLexicon||r.call(t,null,s),n.antispamLexicon=s.clientAntispam||{})}))},c.filterClientAntispam=function(e){var t=e.content;if(!t)return{code:404,errmsg:"待反垃圾文本content不存在"};var r=this.antispamLexicon&&this.antispamLexicon.thesaurus;if(!r)return{code:404,errmsg:"没有反垃圾词库或者词库格式不合法"};try{r=JSON.parse(r).thesaurus}catch(e){return this.protocol.logger.error("misc::filterClientAntispam: parse thesaurus error"),{code:500,errmsg:"反垃圾词库格式不合法"}}for(var i=t,o=0;o<r.length;o++)if(i=d.call(this,i,r[o]),"object"===n(i)){if(2===i.code)return{code:200,type:2,errmsg:"建议拒绝发送",content:t,result:""};if(3===i.code)return{code:200,type:3,errmsg:"建议服务器处理反垃圾，发消息带上字段clientAntiSpam",content:t,result:t}}return i===t?{code:200,type:0,errmsg:"",content:t,result:i}:{code:200,type:1,errmsg:"已对特殊字符做了过滤",content:t,result:i}},c.getServerTime=function(e){this.processCallback(e),this.sendCmd("getServerTime",{},e.callback)},c.getNosAccessToken=function(e){a.verifyOptions(e,"url","misc::getNosAccessToken"),this.processCallback(e);var t={url:e.url};e.userAgent&&(t.userAgent=e.userAgentv),e.ext&&(t.ext=e.ext),this.sendCmd("getNosAccessToken",{nosAccessTokenTag:t},(function(t,r,n){var i=n&&n.nosAccessTokenTag&&n.nosAccessTokenTag.token,s=e.url,a=i?{token:i,resUrl:o(s).call(s,"?")?s+"&token="+i:s+"?token="+i}:{};e.done(t,a)}))},c.deleteNosAccessToken=function(e){a.verifyOptions(e,"token","misc::deleteNosAccessToken"),this.processCallback(e),this.sendCmd("deleteNosAccessToken",{nosAccessTokenTag:{token:e.token}},e.callback)}},function(e,t,r){r(56);var n=r(46),i=r(25),o=r(16),s=r(451),a=Array.prototype,c={DOMTokenList:!0,NodeList:!0};e.exports=function(e){var t=e.keys;return e===a||o(a,e)&&t===a.keys||i(c,n(e))?s:t}},function(e,t,r){var n=r(452);e.exports=n},function(e,t,r){r(73),r(88);var n=r(22);e.exports=n("Array").keys},function(e,t,r){var n=r(27),i=r(4),o=r(8),s=r(11),a=r(52).fn,c=r(0),u=r(139),l=r(197);a.signalingCreate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=e.channelName,n=e.ext;return c.verifyOptions(e,"type","api::signalling"),this.sendCmdUsePromise("signalingCreate",{avSignalTag:{type:t,channelName:r,ext:n}}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingDelay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingDelay",{avSignalTag:e}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingClose=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingClose",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingJoin=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingJoin",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingLeave=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offlineEnabled;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingLeave",{avSignalTag:c.merge(e,{isSave:!0===t?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingGetChannelInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.channelName;return c.verifyOptions(e,"channelName","api::signalling"),this.sendCmdUsePromise("signalingGetChannelInfo",{avSignalTag:{channelName:t}}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingInvite=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.offlineEnabled,o=e.pushInfo,a=void 0===o?{}:o;c.verifyOptions(e,"channelId requestId account","api::signalling"),"object"===n(a.pushPayload)&&(a.pushPayload=s(a.pushPayload));var u=c.merge(e,a,{to:t,isSave:!0===r?1:0,needPush:!0===a.needPush?1:0,needBadge:!1===a.needBadge?0:1});return this.sendCmdUsePromise("signalingInvite",{avSignalTag:u}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,t.needBadge=1===t.needBadge,t.needPush=1===t.needPush,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingCancel=function(e){var t=e.account,r=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingCancel",{avSignalTag:c.merge(e,{to:t,isSave:!0===r?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingCreateAndJoin=function(e){var t=this,r=e.channelName,n=e.uid,o=void 0===n?0:n,s=e.offlineEnabled,a=void 0===s||s,u=e.attachExt,l=void 0===u?"":u;return this.signalingCreate(e).catch((function(e){return 10405===e.code?(t.logger.warn("api::avSignal:signalingCall room already exists:",e),t.signalingGetChannelInfo({channelName:r})):i.reject(e)})).then((function(r){var n={channelId:r.channelId,offlineEnabled:a,attachExt:l,nertcChannelName:e.nertcChannelName,nertcTokenTtl:e.nertcTokenTtl,nertcJoinRoomQueryParamMap:e.nertcJoinRoomQueryParamMap};return o&&c.merge(n,{uid:o}),t.signalingJoin(n)}))},a.signalingCall=function(e){var t=this,r=e.account,n=e.offlineEnabled,i=e.requestId;c.verifyOptions(e,"type requestId account","api::signalling");var o="";return this.signalingCreateAndJoin(e).then((function(s){o=s.channelId||o,t.logger.info("api::avSignal:signalingCall join:",o);var a={channelId:o,account:r,requestId:i,offlineEnabled:n,attachExt:e.attachExt||"",pushInfo:e.pushInfo||{},nertcTokenTtl:s.nertcTokenTtl,nertcToken:s.nertcToken};return t.signalingInvite(a)}))},a.signalingReject=function(e){var t=e.account,r=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingReject",{avSignalTag:c.merge(e,{to:t,isSave:!0===r?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingAccept=function(e){var t=this,r=e.account,n=e.offlineEnabled;return c.verifyOptions(e,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingAccept",{avSignalTag:c.merge(e,{to:r,isSave:!0===n?1:0})}).then((function(e){var t=e.avSignalTag;return t.offlineEnabled=1===t.isSave,delete t.isSave,i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))})).then((function(r){if(e.autoJoin){var n={channelId:e.channelId,offlineEnabled:e.offlineEnabled,attachExt:e.joinAttachExt,uid:e.uid,nertcChannelName:e.nertcChannelName,nertcTokenTtl:e.nertcTokenTtl,nertcJoinRoomQueryParamMap:e.nertcJoinRoomQueryParamMap};return t.signalingJoin(n)}return r}))},a.signalingControl=function(e){var t=e.account;return c.verifyOptions(e,"channelId","api::signalling"),this.sendCmdUsePromise("signalingControl",{avSignalTag:c.merge(e,t?{to:t}:{})}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingSync=function(){return this.sendCmdUsePromise("sync",{sync:{avSignal:0}}).then((function(e){var t=e.avSignalTag;return i.resolve(t)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingMarkMsgRead=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c.verifyOptions(e,"msgid","api::signalling");var t,r=u.idMap.avSignal;return t="string"==typeof e.msgid?[e.msgid]:e.msgid,this.sendCmd("batchMarkRead",{sid:r.id,cid:r.signalingNotify,ids:t})},a.signalingCallEx=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,r=e.offlineEnabled,a=e.pushInfo,u=void 0===a?{}:a;"object"===n(u.pushPayload)&&(u.pushPayload=s(u.pushPayload)),c.verifyOptions(e,"type","api::signalling"),c.verifyOptions(e,"account","api::signalling");var d=c.merge(e,u,{to:t,isSave:!0===r?1:0,needPush:!0===u.needPush?1:0,needBadge:!1===u.needBadge?0:1});return this.sendCmdUsePromise("signalingCallEx",{avSignalTag:d}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))},a.signalingJoinAndAccept=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.channelId,r=e.attachExt,n=e.offlineEnabled,s=e.uid,a=e.account,u=e.requestId,d=e.nertcChannelName,p=e.nertcTokenTtl,m=e.nertcJoinRoomQueryParamMap;return c.verifyOptions(e,"channelId","api::signalling"),c.verifyOptions(e,"account","api::signalling"),c.verifyOptions(e,"requestId","api::signalling"),this.sendCmdUsePromise("signalingJoinAndAccept",{avSignalTag:{channelId:t,attachExt:r,isSave:!0===n?1:0,uid:s,to:a,requestId:u,nertcChannelName:d,nertcTokenTtl:p,nertcJoinRoomQueryParamMap:m}}).then((function(e){var t,r=e.avSignalTag,n=r.members;return"string"==typeof r.members&&(n=o(t=JSON.parse(r.members)).call(t,(function(e){return l.parseAvSignalMember(e)}))),r.members=n,i.resolve(r)})).catch((function(e){return i.reject(l.parseAvSignalError(e))}))}},function(e,t,r){r(455);var n=r(12);e.exports=n.Object.assign},function(e,t,r){var n=r(2),i=r(456);n({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},function(e,t,r){var n=r(24),i=r(7),o=r(31),s=r(9),a=r(92),c=r(134),u=r(114),l=r(33),d=r(96),p=Object.assign,m=Object.defineProperty,f=i([].concat);e.exports=!p||s((function(){if(n&&1!==p({b:1},p(m({},"a",{enumerable:!0,get:function(){m(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol();return e[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=p({},e)[r]||"abcdefghijklmnopqrst"!=a(p({},t)).join("")}))?function(e,t){for(var r=l(e),i=arguments.length,s=1,p=c.f,m=u.f;i>s;)for(var h,g=d(arguments[s++]),v=p?f(a(g),p(g)):a(g),y=v.length,b=0;y>b;)h=v[b++],n&&!o(m,g,h)||(r[h]=g[h]);return r}:p},function(e,t,r){var n=r(23),i=r(79),o=r(13),s=r(11),a=r(26),c=r(10),u=r(4),l=r(63).fn,d=r(36),p=r(458),m=r(198),f=r(14),h=r(217),g=r(0);function v(){this.logger.log("offlineListener enter"),this.forceDisconnect();try{this.options.ondisconnect&&this.options.ondisconnect({callFunc:"link::offlineListener",message:"offlineListener disconnect"})}catch(e){throw self.logger.error("userOption:ondisconnect function error",e),e}this.onDisconnect("link::offlineListener")}function y(){var e=this;this.logger.log("onlineListener start"),this&&this.isConnected()&&!this.connecting?(this.stopHeartbeat(),this.sendCmd("heartbeat",null,(function(t){if(t){e.logger.info("onlineListener heartbeat detect error",t);try{e.forceDisconnect(),e.onDisconnect("link::onHeartbeat")}catch(t){e.logger.info("onlineListener heartbeat websocket.onclose",t)}}else e.logger.log("onlineListener heartbeat detect success")}))):this.logger.log("onlineListener disconnected or connecting",this&&this.isConnected(),this.connecting)}l.initConnect=function(){var e;this.socket=null,this.retryCount=0,this.connecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.doLogout=!1,n(e=h.initUniErrReport).call(e,this)({appKey:this.options.appKey,logger:this.logger})},l.resetConnect=function(){var e=this.options;g.notundef(e.needReconnect)?(g.verifyParamType("needReconnect",e.needReconnect,"boolean","link::resetConnect"),this.needReconnect=e.needReconnect):this.needReconnect=!0,this.logger.info("link::resetConnect: needReconnect ".concat(this.needReconnect)),g.notundef(e.reconnectionAttempts)&&g.verifyParamType("reconnectionAttempts",e.reconnectionAttempts,"number","link::resetConnect"),g.notundef(e.noCacheLinkUrl)&&g.verifyParamType("noCacheLinkUrl",e.noCacheLinkUrl,"boolean","link::resetConnect"),this.reconnectionAttempts="number"==typeof e.reconnectionAttempts?e.reconnectionAttempts:1/0,this.backoff=new p({min:f.reconnectionDelay,max:f.reconnectionDelayMax,jitter:f.reconnectionJitter})},l.connect=function(){var e=this;if(clearTimeout(e.connectTimer),e.isConnected())e.logger.warn("link::connect: already connected");else if(e.connecting)e.logger.warn("link::connect: already connecting");else{if(f.isBrowser&&e.reporter.restore(),e.createConnectTime=i(),e.autoconnect||e.reporter.reportTraceStart("login",{user_id:e.options.account,action:"manual_login"}),e.connecting=!0,e.hasNotifyDisconnected=!1,e.shouldReconnect=!0,e.socket&&e.forceDisconnect(),e.logger.info("link::connect: connect to new socket, autoconnect is "+e.autoconnect),"string"==typeof e.options.socketUrl)return e.logger.info("link::connect: try to options.socketUrl ",e.options.socketUrl),void e.connectToUrl(e.options.socketUrl);var t=e.getNextSocketUrl();if(t&&!e.options.noCacheLinkUrl)return e.logger.info("link::connect: try to next socket link ",t),void e.connectToUrl(t);e.logger.info("link::connect: no cached socket links or links had been used up"),e.refreshSocketUrl().then((function(){e.connectToUrl(e.getNextSocketUrl())})).catch((function(){e.hasActiveDisconnected||e.onDisconnect("connect::refreshSocketUrl: failed to fetch lbs url and default socket link")}))}},l.getNextSocketUrl=function(){return this.socketUrls.shift()},l.isConnected=function(){return!!this.socket&&!!this.socket.socket&&this.socket.socket.connected},l.connectToUrl=function(e){var t,r,i,a,c,u,l=this;if(e=e||"",l.url=e,"undefined"==typeof window){var d=g.getGlobal(),p=e.split(":");d&&!d.location&&p.length>1&&(d.location={protocol:p.shift(),port:p.pop(),hostname:p.join("")}),this.options.transports=["websocket"]}var h=this.options.transports||["websocket","xhr-polling"];l.socket=m.connect(e,{transports:h,reconnect:!1,"force new connection":!0,"connect timeout":f.connectTimeout}),l.logger.info(o(t="link::connectToUrl: socket url: ".concat(e,", transports: ")).call(t,s(h))),l.handshakeUrl=e,l.socket.on("connect",n(r=l.onConnect).call(r,l)),l.socket.on("handshake_failed",n(i=l.onHandshakeFailed).call(i,l)),l.socket.on("connect_failed",n(a=l.onConnectFailed).call(a,l)),l.socket.on("error",n(c=l.onError).call(c,l)),l.socket.on("message",n(u=l.onMessage).call(u,l)),l.socket.on("disconnect",(function(t){l.logger.warn("link::connectToUrl: socket url: ".concat(e,", disconnected"),t),l.hasLogin=!1,l.doLogout?l.logout():l.onDisconnect("link::socketDisconnect")}))},l.disconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this;function r(r){t.logger.info("link::disconnect: socket finally closed, ",r),clearTimeout(t.disconnectCallbackTimer),t.msgAckBufferManager&&t.msgAckBufferManager.clear(),e(r)}if(clearTimeout(t.connectTimer),t.disconnectCallbackTimer=a((function(){e.call(t,"mark disconnected due to timeout")}),1e4),t.mixStorePolicy=null,t.appGrayConfig=null,t.resetReconnectStatus(!0),clearTimeout(t.mixStorePolicyClock),this.onlineListener&&"undefined"!=typeof window&&g.isFunction(window.removeEventListener)&&(window.removeEventListener("online",this.onlineListener),window.removeEventListener("offline",this.offlineListener)),t.socket&&t.socket.socket&&t.socket.socket.transport?t.socket.socket.transport.onDisconnectDone=function(e){r(e)}:r(null),t.isConnected())t.logger.warn("link::disconnect: start disconnecting"),t.logout();else if(t.connecting)t.logger.warn("link::disconnect: abort connecting"),t.disconnectSocket();else{t.logger.warn("link::disconnect: start otherwise"),t.connecting=!1,t.shouldReconnect=!1,t.socket=null,t.autoconnect=!1;try{t.options.ondisconnect({callFunc:"link::disconnect",message:"manually disconnect status"})}catch(e){throw t.logger.error("userOption:ondisconnect function error",e),e}}},l.resetReconnectStatus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;t.backoff&&(t.backoff.setMin(f.reconnectionDelay),t.backoff.setMax(f.reconnectionDelayMax),t.backoff.reset()),t.retryCount=0,t.autoconnect=!0,t.hasActiveDisconnected=!!e,t.logger.info("link::resetReconnectStatus: reset retryCount and backoff")},l.onConnect=function(){this.connecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.reporter.reportTraceUpdate("login",{operation_type:"TCP",target:this.url}),this.login()},l.onHandshakeFailed=function(){this.logger.warn("link::onHandshakeFailed: shandshake failed"),this.reporter.reportTraceUpdate("login",{operation_type:"TCP",error:"ws_handshake_failed",target:this.handshakeUrl},!1),this.onDisconnect("link::onHandshakeFailed")},l.onConnectFailed=function(){this.onDisconnect("link::onConnectFailed")},l.onError=function(){var e=arguments[0];if(e){if(this.reporter.reportTraceUpdate("login",{operation_type:"TCP",error:"connect_timeout"},!1),void 0!==e.x5ImgDecodeStatus)return;if("[object Object]"===Object.prototype.toString.call(e)&&c(e).length<=0)return;this.onMiscError("连接错误",new d(e,"LINK_ERROR",{callFunc:"link::onError"}))}this.connecting=!1},l.onDisconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this;this.logger.warn("socket::onDisconnect: "+e),t.connecting=!1,t.markAllCallbackInvalid(d.newNetworkError({callFunc:e})),t.msgAckBufferManager&&t.msgAckBufferManager.clear(),t.stopHeartbeat(),t.reconnect()},l.willReconnect=function(){return this.shouldReconnect&&this.needReconnect&&this.retryCount<this.reconnectionAttempts},l.reconnect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.willReconnect()){if(this.reporter.reportTraceStart("login",{user_id:this.options.account,action:"auto_login"}),this.socket&&(this.logger.info("link::reconnect: try to force disconnect"),this.forceDisconnect()),0===this.socketUrls.length&&!this.options.socketUrl&&"function"==typeof e.allFailedCB)return this.logger.log("reconnect: All socket links have been polled, trigger hooks"),void e.allFailedCB();this.doReconnect()}else this.notifyDisconnect()},l.doReconnect=function(){var e,t=this;t.socket=null,t.retryCount++,t.hasLogin=!1;var r,n=t.backoff.duration();t.logger.info(o(e="link::reconnect: will retry after ".concat(n,"ms, retryCount ")).call(e,t.retryCount));try{r=t.options.onwillreconnect({retryCount:t.retryCount,duration:n})}catch(e){throw t.logger.error("userOption:onwillreconnect function error",e),e}clearTimeout(t.connectTimer),t.connectTimer=a((function(){1==+t.options.authType&&r instanceof u?(t.logger.info("link::reconnect: wait onwillreconnect promise"),r.finally((function(){return t.connect()}))):t.connect()}),n)},l.notifyConnectError=function(e){var t=d.newConnectError({message:e,callFunc:"link::notifyConnectError"});this.logger.error("link::notifyConnectError:",t),this.options.onerror(t)},l.notifyDisconnect=function(e){if(this.hasNotifyDisconnected)this.logger.warn("notifyDisconnect:: already notified");else{this.hasNotifyDisconnected=!0,this.disconnectSocket(),this.forceDisconnect(),(e=e||new d).retryCount=this.retryCount,e.willReconnect=this.willReconnect(),this.backoff&&this.backoff.reset(),this.retryCount=0,this.autoconnect=!1,this.logger.info("link::notifyDisconnect: ondisconnected",e);try{this.options.ondisconnect(e)}catch(e){throw this.logger.error("userOption:ondisconnect function error",e),e}"chatroom"===this.subType?this.reporter.report("chatroomLogin",{accid:this.account,roomId:this.options&&this.options.chatroomId,serverIps:this.options&&this.options.chatroomAddresses&&this.options.chatroomAddresses.join(","),currentServerIp:this.url,rt:i()-this.createConnectTime,result:e?e.code:200,failReason:e?e.message:"",time:i()}):"im"===this.subType&&this.reporter.reportTraceEnd("login",1),this.onWbNotifyHangup instanceof Function&&this.onWbNotifyHangup({content:{account:this.account,channelId:null,timetag:+Date()}})}},l.disconnectSocket=function(){if(this.isConnected()||this.connecting){this.connecting=!1,this.shouldReconnect=!1;try{this.socket.disconnect()}catch(e){this.socket&&"function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),this.logger.info("link::disconnectSocket: disconnect failed, error ",e)}}},l.initOnlineListener=function(){this.needReconnect&&this.options&&this.options.quickReconnect?"undefined"!=typeof window&&g.isFunction(window.addEventListener)?this.onlineListener||(this.onlineListener=n(y).call(y,this),this.offlineListener=n(v).call(v,this),this.logger.info("initOnlineListener success"),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)):this.logger.warn("initOnlineListener no window.addEventListener"):this.logger.warn("initOnlineListener no quickReconnect")},l.forceDisconnect=function(){var e=this.socket||{};this.socket=null;try{"function"==typeof e.removeAllListeners&&e.removeAllListeners(),"function"==typeof e.disconnect&&e.disconnect()}catch(e){this.logger.error("forceDisconnect:: oldSocket error",e||e.message)}this.hasLogin=!1}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){e.exports=function(){var e={reportUrl:"https://statistic.live.126.net/statics/report/common/form",maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,reportInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0},t=function(){};return function(){function r(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.enable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=e,this.msgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.setConfig(t),this.reportConfig.autoStart&&this.initUploadConfig()}var n,i;return n=r,(i=[{key:"setConfig",value:function(e){this.reportConfig=Object.assign({},this.reportConfig,e)}},{key:"report",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){var n=Date.now();r?this.lowPriorityMsgList.push({module:e,msg:t,createTime:n}):this.msgList.push({module:e,msg:t,createTime:n}),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&!this.traceMsgCache[e]){var r={user_id:t.user_id,action:t.action,start_time:Date.now(),updateTime:Date.now(),extension:[]};this.traceMsgCache[e]=r}}},{key:"reportTraceUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.traceMsgCache[e]){var n=t.operation_type,i=t.code,o=t.target,s=t.error,a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["operation_type","code","target","error"]);this.traceMsgCache[e].updateTime=Date.now(),s&&s.code&&(i=s.code),this.traceMsgCache[e].extension.push({operation_type:n,code:i,succeed:r,target:o,duration:this.traceMsgCache[e].updateTime-this.traceMsgCache[e].start_time,description:JSON.stringify(a)})}}},{key:"reportTraceEnd",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.traceMsgCache[e]&&("nos"!==e||0!==t?(this.traceMsgCache[e].succeed=!t,this.traceMsgCache[e].duration=Date.now()-this.traceMsgCache[e].start_time,delete this.traceMsgCache[e].updateTime,this.report(e,this.traceMsgCache[e]),this.traceMsgCache[e]=null):this.traceMsgCache[e]=null)}},{key:"pause",value:function(){this.enable=!1}},{key:"restore",value:function(){this.enable=!0,this.initConfigLoaded||this.initUploadConfig()}},{key:"destroy",value:function(){var e=this;Object.keys(this.traceMsgCache).forEach((function(t){e.reportTraceEnd(t,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=t,this.report=t,this.reportTraceStart=t,this.reportTraceUpdate=t,this.reportTraceEnd=t,this.pause=t,this.restore=t,this.destroy=t,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.reportConfig={},this.isDestroyed=!0}},{key:"initUploadConfig",value:function(){var e,t,r=this;if(!this.loading){this.loading=!0;var n=this.reportConfig.common||{};try{this.reportConfig.request("https://statistic.live.126.net/dispatcher/req",{method:"GET",dataType:"json",params:{deviceId:n.deviceId,sdktype:n.sdktype,sdkVer:n.sdk_ver,platform:n.platform,appkey:n.app_key},timeout:this.reportConfig.timeout}).then((function(e){var t,n;if(!r.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){var i=e.data.data||{};r.reportConfig.reportInterval=i.maxInterval>1e4?1e4:i.maxInterval,r.reportConfig.reportInterval=i.maxInterval<10?10:i.maxInterval,r.reportConfig.maxSize=i.maxSize>1e3?1e3:i.maxSize,r.reportConfig.minInterval=i.minInterval<2?2:i.minInterval,r.reportConfig.maxDelay=i.maxDelay||300,r.reportConfig.reportInterval=1e3*r.reportConfig.reportInterval,r.reportConfig.minInterval=1e3*r.reportConfig.minInterval,r.reportConfig.maxDelay=1e3*r.reportConfig.maxDelay,r.enable=!0,r.initConfigLoaded=!0,r.loading=!1,r.reportHeartBeat()}null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.log("Get reporter upload config success")}})).catch((function(e){var t,n;r.loading=!1,null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.error("Get reporter upload config failed",e)}))}catch(r){this.loading=!1,null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.error("Exec reporter request failed",r)}}}},{key:"reportHeartBeat",value:function(){var e=this;this.isDestroyed||(this.timer=setTimeout((function(){e.reportHeartBeat()}),this.reportConfig.reportInterval),this.doReport())}},{key:"doReport",value:function(){this.isDestroyed||(this.msgList.length+this.lowPriorityMsgList.length>=this.reportConfig.maxSize||Date.now()-this.lastReportTime>=this.reportConfig.reportInterval)&&this.upload()}},{key:"getUploadMsg",value:function(){var e=this,t={},r=Date.now();this.msgList=this.msgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.lowPriorityMsgList=this.lowPriorityMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay})),this.cacheMsgList=this.cacheMsgList.filter((function(t){return r-t.createTime<e.reportConfig.maxDelay}));var n=this.msgList.slice(0,this.reportConfig.maxSize);if(this.msgList=this.msgList.slice(n.length),n.length<this.reportConfig.maxSize){var i=this.reportConfig.maxSize-n.length;n=n.concat(this.lowPriorityMsgList.slice(0,i)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice(i)}if(n.length<this.reportConfig.maxSize){var o=this.reportConfig.maxSize-n.length;n=n.concat(this.cacheMsgList.slice(0,o)),this.cacheMsgList=this.cacheMsgList.slice(o)}return n.forEach((function(e){t[e.module]?t[e.module].push(e.msg):t[e.module]=[e.msg]})),{uploadMsgArr:n,uploadMsg:t}}},{key:"upload",value:function(){var e,t,r=this;if(this.enable&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var n=this.getUploadMsg(),i=n.uploadMsgArr,o=n.uploadMsg;if(i.length){this.lastReportTime=Date.now();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",params:{common:this.reportConfig.common,event:o},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(e){var t,n;r.cacheMsgList=r.cacheMsgList.concat(i).slice(0,r.reportConfig.cacheMaxSize),null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.warn("Reporter upload failed",e)}))}catch(r){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",r)}clearTimeout(this.timer),this.reportHeartBeat()}}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),r}()}()},function(e,t,r){e.exports=function(e,t={dataType:"json",method:"GET",timeout:5e3}){const r="text"===t.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8";let n="GET"===t.method?function(e){if(e){let t="";return Object.entries(e).forEach((([e,r],n)=>{t+=0===n?"?":"&",t+=`${e}=${r}`})),t}return""}(t.params):"";return Promise.race([(i=t.timeout,o={url:e,params:t},new Promise(((e,t)=>{setTimeout((()=>{t({message:"request timeout",params:o})}),i||5e3)}))),new Promise((function(i,o){if(window.fetch&&"function"==typeof window.fetch)try{let s={method:t.method,headers:Object.assign({"Content-Type":r},t.headers)};"POST"===t.method&&(s.body=JSON.stringify(t.params)),fetch(`${e}${n}`,s).then((e=>{"text"!==t.dataType?e.json().then((t=>{e.data=t,i(e)}),o):e.text().then((t=>{e.data=t,i(e)}),o)}),o)}catch(e){o(e)}else if(window.XMLHttpRequest){const s=new XMLHttpRequest;let a;if(s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){try{a=JSON.parse(s.response||"{}")}catch(e){a=s.response}i({status:s.status,data:a})}else o(s.status)},s.open(t.method,`${e}${n}`),s.setRequestHeader("Content-Type",r),t.headers)for(let e in t.headers)s.setRequestHeader(e,t.headers[e]);s.send(JSON.stringify(t.params))}else o("request no suppout")}))]);var i,o}},function(e,t,r){var n=r(10),i=r(57),o=r(19),s=r(58),a=r(3),c=r(59),u=r(60),l=r(49),d=r(61),p=r(4);function m(e,t){var r=n(e);if(i){var a=i(e);t&&(a=o(a).call(a,(function(t){return s(e,t).enumerable}))),r.push.apply(r,a)}return r}var f,h=r(63).fn,g=r(36),v=r(62),y=r(141),b=r(39),S=r(14),T=r(0),_=T.notundef;h.login=function(){this.doLogin()},h.doLogin=function(){var e=this,t=this;p.resolve().then((function(){return t.assembleLogin()})).then((function(r){var n=e.socket&&e.socket.socket&&e.socket.socket.sessionid;if(n){if(e.socketIds||(e.socketIds={}),e.socketIds[n])return void e.logger.warn("onConnect::repeat login",n);e.socketIds[n]=!0}else e.logger.warn("onConnect:: no socketId ",e.socket&&e.socket.socket);e.logger.warn("link::doLogin: "+n+" appLogin is "+r.login.appLogin),t.sendCmd("login",function(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?a(r=m(Object(i),!0)).call(r,(function(t){d(e,t,i[t])})):c?u(e,c(i)):a(n=m(Object(i))).call(n,(function(t){l(e,t,s(i,t))}))}return e}({},r))}))},h.genSessionKey=(f={},function(){var e=this.name;return f[e]=f[e]||T.guid()}),h.assembleIMLogin=function(){var e=this.options,t=e.account;this.sdkSession=this.genSessionKey();var r={appLogin:this.autoconnect?0:1,appKey:e.appKey,account:t,token:e.token,sdkVersion:S.info.sdkVersion,sdkHumanVersion:S.info.sdkHumanVersion,protocolVersion:S.info.protocolVersion,os:"[object Object]"===v.os.toString()?v.os.family:v.os.toString(),browser:v.name+" "+v.version,clientType:S.CLIENTTYPE||16,session:this.sdkSession,deviceId:b.deviceId,isReactNative:S.isRN?1:0,customTag:e.customTag||"",sdkType:0};return r.userAgent="Native/".concat(S.info.sdkHumanVersion),S.isBrowser?r.sdkType=0:S.isRN?r.sdkType=2:S.isWeixinApp&&(r.sdkType=6),e.customClientType&&(r.customClientType=+e.customClientType),e.authType&&(r.authType=+e.authType),e.loginExt&&(r.loginExt=e.loginExt),r},h.afterLogin=T.emptyFunc,h.notifyLogin=function(){var e=this.loginResult;this.logger.info("link::notifyLogin: on connect",e);try{this.options.onconnect(e)}catch(e){throw this.logger.error("userOption:onconnect function error",e),e}},h.logout=function(){this.reporter.pause();var e="done disconnect";if(this.doLogout)return this.doLogout=!1,e="done logout",void this.onAuthError(new g(e,"logout"),"link::logout");if(this.isConnected()){var t=new g(e,"logout");this.onAuthError(t,"link::logout")}},h.onKicked=function(e){var t=e.content,r=t.from,n=t.reason,i=t.custom,o=t.customClientType,s={reason:this.kickedReasons[n]||"unknown",message:this.kickedMessages[n]||"未知原因"};if(_(r)&&(s.from=y.reverseType(r)),_(i)&&(s.custom=i),+o>0&&(s.customClientType=o),this.logger.warn("link::onKicked:",s),"silentlyKick"!==s.reason){var a=new g("被踢了","kicked");T.merge(a,s),this.onAuthError(a,"link::onKicked")}else this.logger.warn("link::onKicked: silentlyKick"),this.forceDisconnect(),this.onDisconnect("link::onKicked")},h.onAuthError=function(e,t){var r=e&&e.code;if(this.logger.error("onAuthError ",t,r),/^(Error_Internet_Disconnected|Error_Timeout|Error_Connection_Socket_State_not_Match)$/.test(r))return this.forceDisconnect(),void this.onDisconnect("link::onAuthError::"+r);(e=e||g.newConnectionError({callFunc:t})).callFunc=e.callFunc||t||null,this.shouldReconnect=!1,this.markAllCallbackInvalid(e),this.notifyDisconnect(e)}},function(e,t,r){var n=r(26),i=r(23),o=r(27),s=r(63).fn,a=r(14),c=r(0);s.processLink=function(e){switch(e.cmd){case"heartbeat":this.startHeartbeat();break;case"notifyDetect":"object"===o(c._get(e,"content.notifyDetectTag"))&&(e.content.notifyDetectTag.t3=(new Date).getTime(),this.startDetect(e))}},s.startHeartbeat=function(){var e=this;e.stopHeartbeat(),e.heartbeatTimer=n((function(){var t;e.sendCmd("heartbeat",null,i(t=e.onHeartbeat).call(t,e))}),a.heartbeatInterval)},s.startDetect=function(e){var t=e.content.notifyDetectTag;t.t4=(new Date).getTime(),this.sendCmd("uploadDetect",{notifyDetectTag:t})},s.stopHeartbeat=function(){this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},s.onHeartbeat=function(e){if(e){if(this.syncing)return this.logger.warn("onHeartbeat::ignore error in connecting"),void this.startHeartbeat();var t;e.callFunc="link::onHeartbeat",this.onCustomError("heartbeat error",e),this.heartbeatFail++,this.logger.warn("onHeartbeat::error ",e.code,e),"Error_Timeout"===e.code&&(this.getOnlineStatus()?this.heartbeatFail>1?(this.forceDisconnect(),this.onDisconnect("link::onHeartbeat")):this.sendCmd("heartbeat",null,i(t=this.onHeartbeat).call(t,this)):this.startHeartbeat())}else this.heartbeatFail=0},s.getOnlineStatus="undefined"!=typeof navigator&&"boolean"==typeof navigator.onLine?function(){return navigator.onLine}:function(){return!0},s.heartbeat=function(){}},function(e,t,r){var n=r(4),i=r(6),o=r(26),s=r(50),a=r(63).fn,c=r(196),u=r(14),l=r(39);a.processMisc=function(e){switch(e.cmd){case"getSimpleNosToken":e.error||(e.obj=e.content.nosTokens[0]);break;case"getNosToken":e.error||(e.obj=e.content.nosToken);break;case"getGrayscaleConfig":e.error||(e.obj=e.content.appGrayConfigTag);break;case"getMixStorePolicy":e.error||(e.obj=e.content.mixStorePolicyTag);break;case"getMixStoreToken":e.error||(e.obj=e.content.mixStoreTokenTag);break;case"getBackSourceToken":e.error||(e.obj=e.content.backSourceTokenTag);break;case"uploadSdkLogUrl":e.error?this.logger.error("uploadSdkLogUrl::error",e.error):this.logger.info("uploadSdkLogUrl::success",e.obj&&e.obj.url);break;case"notifyUploadLog":e.error||(u.isRN?this.uploadLocalLogRN():u.isBrowser&&this.uploadLocalLogWeb(),this.emitAPI({type:"notifyUploadLog"}));break;case"audioToText":e.error||(e.obj.text=e.content.text);break;case"processImage":e.obj.imageOps=c.reverseImageOps(e.obj.imageOps),e.error||(e.obj={url:e.content.url});break;case"getNosTokenTrans":e.error||(e.obj={nosToken:e.content.nosToken,docId:e.content.docId});break;case"getNosOriginUrl":e.error||(e.obj=e.content.nosFileUrlTag.originUrl);break;case"notifyTransLog":e.error||this.emitAPI({type:"notifyTransLog",obj:e.content.transInfo});break;case"fetchFile":case"fetchFileList":case"removeFile":e.error||(e.obj=e.content);break;case"getServerTime":e.obj=e.content&&e.content.time;break;case"getNosCdnHost":this.getNosCdnHost(e)}},a.uploadLocalLogRN=function(){if(u.isRN&&l.rnfs){var e=l.rnfs,t=this,r=e.nimIndex,o=(e.nimIndex+1)%2;e.nimPromise=e.nimPromise.then((function(){return n.all([e.exists(s(r)),e.exists(s(o))])})).then((function(t){return t&&(t[0]||t[1])?t[0]&&t[1]?e.copyFile(s(o),s(2)).then((function(){return e.readFile(s(r))})).then((function(t){return e.appendFile(s(2),t)})):t[0]?e.copyFile(s(r),s(2)):void(t[1]&&e.copyFile(s(o),s(2))):n.reject()})).then((function(){return new n((function(r){t.api.previewFile({filePath:s(2),done:function(o,a){if(n.all([e.unlink(s(2)),e.unlink(s(1)),e.unlink(s(0))]).finally((function(){r()})),o)t.logger.error("nim::uploadLocalLogRN:previewFile:error",o);else{var c=a.url;i(c).call(c,"?")>0?c+="&":c+="?",c+="download="+(new Date).getTime()+"_rn.log",t.api.uploadSdkLogUrl({url:c})}}})}))})).catch((function(r){e.unlink(s(2)).catch((function(){})),t.logger.error("nim::protocol::uploadLocalLogRN",r)}))}function s(t){return e.DocumentDirectoryPath+"/nimlog_"+t+".log"}},a.uploadLocalLogWeb=function(){var e=this;!1!==this.options.dbLog&&this.logger._local?this.logger._local.fetchLog().then((function(t){e.api.previewFile({blob:new Blob([t.logs],{type:"text/plain"}),done:function(r,n){if(r)e.logger.error("uploadLocalLogWeb::previewFile:error",r);else{e.logger.log("uploadLocalLogWeb::previewFile:success",n);var o=n.url;o+=(i(o).call(o,"?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log",e.api.uploadSdkLogUrl({url:o}),e.logger._local.deleteLogs(t.time).then((function(){e.logger.log("uploadLocalLogWeb::deleteLogs success")})).catch((function(t){return e.logger.error("uploadLocalLogWeb::deleteLogs:error ,",t)}))}}})})).catch((function(t){e.logger.error("uploadLocalLogWeb::fetchLog:error",t)})):this.logger.warn("uploadLocalLogWeb::no dbLog")},a.getNosCdnHost=function(e){var t=this,r=e.error;if(r&&(r.callFunc="events::getNosCdnHost",t.onCustomError("getNosCdnHost","EVENT_GET_NOS_CDN_HOST_ERROR",r)),e.content&&e.content.nosConfigTag){var n=e.content.nosConfigTag,i="",a="";0!==n.expire&&n.cdnDomain?-1===n.expire?(i=n.cdnDomain,a=n.objectNamePrefix):(i=n.cdnDomain,a=n.objectNamePrefix,t.nosCdnHostTimer&&clearTimeout(t.nosCdnHostTimer),t.nosCdnHostTimer=o((function(){t.sendCmd("getNosCdnHost",{})}),800*s(n.expire))):(i="",a=""),u.serverNosConfig.cdnDomain=i,u.serverNosConfig.objectPrefix=a,u.hasLocalStorage&&(localStorage.setItem("nim_cdn_domain",i),localStorage.setItem("nim_object_prefix",a))}}},function(e,t,r){var n=r(8),i=r(30),o=r(63).fn,s=r(0),a=r(197);o.processAvSignal=function(e){switch(e.cmd){case"signalingCreate":case"signalingDelay":case"signalingClose":case"signalingJoin":case"signalingLeave":case"signalingInvite":case"signalingCancel":case"signalingReject":case"signalingAccept":case"signalingControl":case"signalingSyncMsgRead":case"signalingGetChannelInfo":case"signalingCallEx":break;case"signalingNotify":this.onSignalingNotify(e);break;case"signalingMutilClientSyncNotify":this.onSignalingMutilClientSyncNotify(e);break;case"signalingUnreadMessageSyncNotify":this.onSignalingUnreadMessageSyncNotify(e);break;case"signalingChannelsSyncNotify":this.onSignalingMembersSyncNotify(e);break;default:this.logger.warn("avSignal::unhandled cmd:",e.cmd)}};var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.needPush&&(e.needPush="1"===e.needPush),e.needBadge&&(e.needBadge="1"===e.needBadge),e.channelInValid&&(e.channelInValid="1"===e.channelInValid),e.attach){var t=JSON.parse(e.attach);e.eventType=a.parseAvSignalType(t.type)}if(e.members){var r=JSON.parse(e.members);e.members=n(r).call(r,(function(e){return a.parseAvSignalMember(e)}))}return e};o.onSignalingNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{e.raw&&e.raw.r&&e.raw.r.length&&e.content&&e.content.avSignalTag&&(e.content.avSignalTag.msgid=e.raw.r[0]);var r=e.content.avSignalTag;r=i(r)?n(r).call(r,(function(e){return c(e)})):c(r),this.emitAPI({type:"signalingNotify",obj:r}),s.isFunction(this.options.onSignalingNotify)&&this.options.onSignalingNotify(r)}},o.onSignalingMutilClientSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingMutilClientSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;r=i(r)?n(r).call(r,(function(e){return c(e)})):c(r),this.emitAPI({type:"signalingMutilClientSyncNotify",obj:r}),s.isFunction(this.options.onSignalingMutilClientSyncNotify)&&this.options.onSignalingMutilClientSyncNotify(r)}},o.onSignalingUnreadMessageSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingUnreadMessageSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;i(r)&&(r=n(r).call(r,(function(e){return c(e)}))),this.emitAPI({type:"signalingUnreadMessageSyncNotify",obj:r}),s.isFunction(this.options.onSignalingUnreadMessageSyncNotify)&&this.options.onSignalingUnreadMessageSyncNotify(r)}},o.onSignalingMembersSyncNotify=function(e){if(e.error){var t=e.error;this.logger.error("protocal::avSignal:onSignalingMembersSyncNotify error",t),this.emitAPI({type:"error",error:t}),this.options.onerror(t)}else{var r=e.content.avSignalTag;i(r)||(r=[r]),r=n(r).call(r,(function(e){return c(e)})),this.emitAPI({type:"signalingChannelsSyncNotify",obj:r}),s.isFunction(this.options.onSignalingMembersSyncNotify)&&this.options.onSignalingMembersSyncNotify(r)}}},function(e,t,r){var n=r(19),i=r(0),o=r(139),s=i.merge({},o.idMap,{auth:{id:2,login:3,kicked:5,logout:6,multiPortLogin:7,kick:8},user:{id:3,updatePushToken:1,appBackground:2,markInBlacklist:3,getBlacklist:4,markInMutelist:5,getMutelist:6,getRelations:8,getUsers:7,updateMyInfo:10,updateDonnop:15,syncMyInfo:109,syncUpdateMyInfo:110},notify:{id:4,markRead:3,syncOfflineMsgs:4,batchMarkRead:5,syncOfflineSysMsgs:6,syncOfflineNetcallMsgs:8,syncRoamingMsgs:9,syncMsgReceipts:12,syncRobots:15,syncBroadcastMsgs:16,syncSuperTeamRoamingMsgs:17,syncOfflineSuperTeamSysMsgs:18,syncDeleteSuperTeamMsgOfflineRoaming:19,syncDeleteMsgSelf:21,syncSessionsWithMoreRoaming:22,syncStickTopSessions:23,syncSessionHistoryMsgsDelete:24,syncSessionReliableInfo:25},sync:{id:5,sync:1,syncTeamMembers:2,syncSuperTeamMembers:3},msg:{id:7,sendMsg:1,msg:2,sysMsg:3,getHistoryMsgs:6,sendCustomSysMsg:7,searchHistoryMsgs:8,deleteSessions:9,getSessions:10,syncSendMsg:101,sendMsgReceipt:11,msgReceipt:12,deleteMsg:13,msgDeleted:14,markSessionAck:16,markSessionAckBatch:25,broadcastMsg:17,clearServerHistoryMsgs:18,getServerSessions:19,getServerSession:20,updateServerSession:21,deleteServerSessions:22,deleteMsgSelf:23,deleteMsgSelfBatch:24,msgFtsInServer:26,msgFtsInServerByTiming:27,onClearServerHistoryMsgs:118,syncUpdateServerSession:121,onDeleteMsgSelf:123,onDeleteMsgSelfBatch:124},msgExtend:{id:23,getThreadMsgs:1,getMsgsByIdServer:2,addQuickComment:3,deleteQuickComment:4,onQuickComment:5,onDeleteQuickComment:6,getQuickComments:7,addCollect:8,deleteCollects:9,updateCollect:10,getCollects:11,addStickTopSession:12,deleteStickTopSession:13,updateStickTopSession:14,addMsgPin:15,updateMsgPin:16,deleteMsgPin:17,onAddMsgPin:18,onUpdateMsgPin:19,onDeleteMsgPin:20,getMsgPins:21,syncAddQuickComment:103,syncDeleteQuickComment:104,syncAddStickTopSession:112,syncDeleteStickTopSession:113,syncUpdateStickTopSession:114,syncAddMsgPin:115,syncUpdateMsgPin:116,syncDeleteMsgPin:117},team:{id:8,createTeam:1,sendTeamMsg:2,teamMsg:3,teamMsgs:4,addTeamMembers:5,removeTeamMembers:6,updateTeam:7,leaveTeam:8,getTeam:9,getTeams:10,getTeamMembers:11,dismissTeam:12,applyTeam:13,passTeamApply:14,rejectTeamApply:15,addTeamManagers:16,removeTeamManagers:17,transferTeam:18,updateInfoInTeam:19,updateNickInTeam:20,acceptTeamInvite:21,rejectTeamInvite:22,getTeamHistoryMsgs:23,searchTeamHistoryMsgs:24,updateMuteStateInTeam:25,getMyTeamMembers:26,getMutedTeamMembers:27,sendTeamMsgReceipt:28,getTeamMsgReads:29,getTeamMsgReadAccounts:30,notifyTeamMsgReads:31,muteTeamAll:32,getTeamMemberInvitorAccid:33,getTeamsById:34,syncMyTeamMembers:126,syncTeams:109,syncTeamMembers:111,syncCreateTeam:101,syncSendTeamMsg:102,syncUpdateTeamMember:119},superTeam:{id:21,sendSuperTeamMsg:2,superTeamMsg:3,addSuperTeamMembers:5,removeSuperTeamMembers:6,leaveSuperTeam:7,updateSuperTeam:8,getSuperTeam:9,getSuperTeams:12,updateInfoInSuperTeam:10,getMySuperTeamMembers:11,getSuperTeamMembers:13,getSuperTeamHistoryMsgs:14,getSuperTeamMembersByJoinTime:15,sendSuperTeamCustomSysMsg:16,deleteSuperTeamMsg:17,superTeamMsgDelete:18,superTeamCustomSysMsg:19,applySuperTeam:20,passSuperTeamApply:21,rejectSuperTeamApply:22,acceptSuperTeamInvite:23,rejectSuperTeamInvite:24,markSuperTeamSessionAck:25,addSuperTeamManagers:26,removeSuperTeamManagers:27,updateSuperTeamMute:28,updateSuperTeamMembersMute:29,updateNickInSuperTeam:30,transferSuperTeam:31,markSuperTeamSessionsAck:32,getSuperTeamMembersByAccounts:33,getMutedSuperTeamMembers:34,syncMySuperTeamMembers:111,syncSuperTeams:109,syncSuperTeamMembers:113,syncCreateSuperTeam:101,syncSendSuperTeamMsg:102,syncUpdateSuperTeamMember:110,syncDeleteSuperTeamMsg:117},friend:{id:12,friendRequest:1,syncFriendRequest:101,deleteFriend:2,syncDeleteFriend:102,updateFriend:3,syncUpdateFriend:103,getFriends:4},chatroom:{id:13,getChatroomAddress:1},filter:{id:101,sendFilterMsg:1,filterMsg:2,filterSysMsg:3,sendFilterCustomSysMsg:7},eventService:{id:14,publishEvent:1,pushEvent:2,subscribeEvent:3,unSubscribeEventsByAccounts:4,unSubscribeEventsByType:5,querySubscribeEventsByAccounts:6,querySubscribeEventsByType:7,pushEvents:9},proxyService:{id:22,httpProxy:1,onProxyMsg:2},qchat:{id:24,getQChatAddress:1}}),a=i.merge({},o.cmdConfig,{login:{sid:s.auth.id,cid:s.auth.login,params:[{type:"Property",name:"login"}]},logout:{sid:s.auth.id,cid:s.auth.logout},kick:{sid:s.auth.id,cid:s.auth.kick,params:[{type:"StrArray",name:"deviceIds"}]},updatePushToken:{sid:s.user.id,cid:s.user.updatePushToken,params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"int",name:"pushkit"}]},appBackground:{sid:s.user.id,cid:s.user.appBackground,params:[{type:"bool",name:"isBackground"},{type:"Int",name:"badge"}]},markInBlacklist:{sid:s.user.id,cid:s.user.markInBlacklist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getBlacklist:{sid:s.user.id,cid:s.user.getBlacklist,params:[{type:"long",name:"time"}]},markInMutelist:{sid:s.user.id,cid:s.user.markInMutelist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getMutelist:{sid:s.user.id,cid:s.user.getMutelist,params:[{type:"long",name:"time"}]},getRelations:{sid:s.user.id,cid:s.user.getRelations,params:[{type:"long",name:"timetag"}]},getUsers:{sid:s.user.id,cid:s.user.getUsers,params:[{type:"StrArray",name:"accounts"}]},updateMyInfo:{sid:s.user.id,cid:s.user.updateMyInfo,params:[{type:"Property",name:"user"},{type:"Property",name:"antispamTag"}]},updateDonnop:{sid:s.user.id,cid:s.user.updateDonnop,params:[{type:"Property",name:"donnop"}]},markRead:{sid:s.notify.id,cid:s.notify.markRead,params:[{type:"long",name:"id"},{type:"ph",name:"ph"}]},batchMarkRead:{sid:s.notify.id,cid:s.notify.batchMarkRead,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},sync:{sid:s.sync.id,cid:s.sync.sync,params:[{type:"Property",name:"sync"}]},syncTeamMembers:{sid:s.sync.id,cid:s.sync.syncTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},syncSuperTeamMembers:{sid:s.sync.id,cid:s.sync.syncSuperTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},sendMsg:{sid:s.msg.id,cid:s.msg.sendMsg,params:[{type:"Property",name:"msg"}]},getHistoryMsgs:{sid:s.msg.id,cid:s.msg.getHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},sendCustomSysMsg:{sid:s.msg.id,cid:s.msg.sendCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},searchHistoryMsgs:{sid:s.msg.id,cid:s.msg.searchHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSessions:{sid:s.msg.id,cid:s.msg.getSessions,params:[{type:"long",name:"time"}]},deleteSessions:{sid:s.msg.id,cid:s.msg.deleteSessions,params:[{type:"StrArray",name:"sessions"}]},sendMsgReceipt:{sid:s.msg.id,cid:s.msg.sendMsgReceipt,params:[{type:"Property",name:"msgReceipt"}]},deleteMsg:{sid:s.msg.id,cid:s.msg.deleteMsg,params:[{type:"Property",name:"sysMsg"}]},markSessionAck:{sid:s.msg.id,cid:s.msg.markSessionAck,params:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},markSessionAckBatch:{sid:s.msg.id,cid:s.msg.markSessionAckBatch,params:[{type:"PropertyArray",name:"sessionAckTags",entity:"sessionAckTag"}]},clearServerHistoryMsgs:{sid:s.msg.id,cid:s.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParams"}]},clearServerHistoryMsgsWithSync:{sid:s.msg.id,cid:s.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParamsWithSync"}]},msgFtsInServer:{sid:s.msg.id,cid:s.msg.msgFtsInServer,params:[{type:"Property",name:"msgFullSearchRequestTag"}]},msgFtsInServerByTiming:{sid:s.msg.id,cid:s.msg.msgFtsInServerByTiming,params:[{type:"Property",name:"msgTimingFullSearchRequestTag"}]},onClearServerHistoryMsgs:{sid:s.msg.id,cid:s.msg.clearServerHistoryMsgs},getServerSessions:{sid:s.msg.id,cid:s.msg.getServerSessions,params:[{type:"Property",name:"sessionReqTag"}]},getServerSession:{sid:s.msg.id,cid:s.msg.getServerSession,params:[{type:"Property",name:"session"}]},updateServerSession:{sid:s.msg.id,cid:s.msg.updateServerSession,params:[{type:"Property",name:"session"}]},deleteServerSessions:{sid:s.msg.id,cid:s.msg.deleteServerSessions,params:[{type:"PropertyArray",name:"sessions",entity:"session"}]},deleteMsgSelf:{sid:s.msg.id,cid:s.msg.deleteMsgSelf,params:[{type:"Property",name:"deleteMsgSelfTag"}]},deleteMsgSelfBatch:{sid:s.msg.id,cid:s.msg.deleteMsgSelfBatch,params:[{type:"PropertyArray",name:"deleteMsgSelfTags",entity:"deleteMsgSelfTag"}]},onDeleteMsgSelf:{sid:s.msg.id,cid:s.msg.onDeleteMsgSelf},onDeleteMsgSelfBatch:{sid:s.msg.id,cid:s.msg.onDeleteMsgSelfBatch},sendSuperTeamMsg:{sid:s.superTeam.id,cid:s.superTeam.sendSuperTeamMsg,params:[{type:"Property",name:"msg"}]},addSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.addSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}]},removeSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.removeSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},leaveSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.leaveSuperTeam,params:[{type:"long",name:"teamId"}]},updateSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.updateSuperTeam,params:[{type:"Property",name:"team"},{type:"Property",name:"antispamTag"}]},getSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeam,params:[{type:"long",name:"teamId"}]},getSuperTeams:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeams,params:[{type:"long",name:"timetag"}]},getSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},updateInfoInSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.updateInfoInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},getSuperTeamHistoryMsgs:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},applySuperTeam:{sid:s.superTeam.id,cid:s.superTeam.applySuperTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passSuperTeamApply:{sid:s.superTeam.id,cid:s.superTeam.passSuperTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:s.superTeam.id,cid:s.superTeam.rejectSuperTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:s.superTeam.id,cid:s.superTeam.acceptSuperTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:s.superTeam.id,cid:s.superTeam.rejectSuperTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},markSuperTeamSessionAck:{sid:s.superTeam.id,cid:s.superTeam.markSuperTeamSessionAck,params:[{type:"long",name:"to"},{type:"long",name:"timetag"}]},addSuperTeamManagers:{sid:s.superTeam.id,cid:s.superTeam.addSuperTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:s.superTeam.id,cid:s.superTeam.removeSuperTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateSuperTeamMute:{sid:s.superTeam.id,cid:s.superTeam.updateSuperTeamMute,params:[{type:"long",name:"teamId"},{type:"int",name:"mute"}]},updateSuperTeamMembersMute:{sid:s.superTeam.id,cid:s.superTeam.updateSuperTeamMembersMute,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"int",name:"mute"}]},updateNickInSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.updateNickInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},transferSuperTeam:{sid:s.superTeam.id,cid:s.superTeam.transferSuperTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},markSuperTeamSessionsAck:{sid:s.superTeam.id,cid:s.superTeam.markSuperTeamSessionsAck,params:[{type:"PropertyArray",name:"sessionAckTags",entity:"sessionAckTag"}]},getSuperTeamMembersByJoinTime:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamMembersByJoinTime,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSuperTeamMembersByAccounts:{sid:s.superTeam.id,cid:s.superTeam.getSuperTeamMembersByAccounts,params:[{type:"StrArray",name:"memberIds"}]},getMutedSuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.getMutedSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},sendSuperTeamCustomSysMsg:{sid:s.superTeam.id,cid:s.superTeam.sendSuperTeamCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},deleteSuperTeamMsg:{sid:s.superTeam.id,cid:s.superTeam.deleteSuperTeamMsg,params:[{type:"Property",name:"sysMsg"}]},getMySuperTeamMembers:{sid:s.superTeam.id,cid:s.superTeam.getMySuperTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},createTeam:{sid:s.team.id,cid:s.team.createTeam,params:[{type:"Property",name:"team"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"Property",name:"antispamTag"}]},sendTeamMsg:{sid:s.team.id,cid:s.team.sendTeamMsg,params:[{type:"Property",name:"msg"}]},addTeamMembers:{sid:s.team.id,cid:s.team.addTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}]},removeTeamMembers:{sid:s.team.id,cid:s.team.removeTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateTeam:{sid:s.team.id,cid:s.team.updateTeam,params:[{type:"Property",name:"team"},{type:"Property",name:"antispamTag"}]},leaveTeam:{sid:s.team.id,cid:s.team.leaveTeam,params:[{type:"long",name:"teamId"}]},getTeam:{sid:s.team.id,cid:s.team.getTeam,params:[{type:"long",name:"teamId"}]},getTeams:{sid:s.team.id,cid:s.team.getTeams,params:[{type:"long",name:"timetag"}]},getTeamsById:{sid:s.team.id,cid:s.team.getTeamsById,params:[{type:"longArray",name:"teamIds"}]},getTeamMembers:{sid:s.team.id,cid:s.team.getTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},dismissTeam:{sid:s.team.id,cid:s.team.dismissTeam,params:[{type:"long",name:"teamId"}]},applyTeam:{sid:s.team.id,cid:s.team.applyTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passTeamApply:{sid:s.team.id,cid:s.team.passTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:s.team.id,cid:s.team.rejectTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},addTeamManagers:{sid:s.team.id,cid:s.team.addTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:s.team.id,cid:s.team.removeTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},transferTeam:{sid:s.team.id,cid:s.team.transferTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},updateInfoInTeam:{sid:s.team.id,cid:s.team.updateInfoInTeam,params:[{type:"Property",name:"teamMember"}]},updateNickInTeam:{sid:s.team.id,cid:s.team.updateNickInTeam,params:[{type:"Property",name:"teamMember"}]},acceptTeamInvite:{sid:s.team.id,cid:s.team.acceptTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:s.team.id,cid:s.team.rejectTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},getTeamHistoryMsgs:{sid:s.team.id,cid:s.team.getTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},searchTeamHistoryMsgs:{sid:s.team.id,cid:s.team.searchTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},updateMuteStateInTeam:{sid:s.team.id,cid:s.team.updateMuteStateInTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"int",name:"mute"}]},getMyTeamMembers:{sid:s.team.id,cid:s.team.getMyTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},getMutedTeamMembers:{sid:s.team.id,cid:s.team.getMutedTeamMembers,params:[{type:"long",name:"teamId"}]},sendTeamMsgReceipt:{sid:s.team.id,cid:s.team.sendTeamMsgReceipt,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReads:{sid:s.team.id,cid:s.team.getTeamMsgReads,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReadAccounts:{sid:s.team.id,cid:s.team.getTeamMsgReadAccounts,params:[{type:"Property",name:"teamMsgReceipt"}]},muteTeamAll:{sid:s.team.id,cid:s.team.muteTeamAll,params:[{type:"long",name:"teamId"},{type:"int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:s.team.id,cid:s.team.getTeamMemberInvitorAccid,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},friendRequest:{sid:s.friend.id,cid:s.friend.friendRequest,params:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:s.friend.id,cid:s.friend.deleteFriend,params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams"}]},updateFriend:{sid:s.friend.id,cid:s.friend.updateFriend,params:[{type:"Property",name:"friend"}]},getFriends:{sid:s.friend.id,cid:s.friend.getFriends,params:[{type:"long",name:"timetag"}]},getChatroomAddress:{sid:s.chatroom.id,cid:s.chatroom.getChatroomAddress,params:[{type:"long",name:"chatroomId"},{type:"bool",name:"isWeixinApp"},{type:"number",name:"type"}]},sendFilterMsg:{sid:n(s).id,cid:n(s).sendFilterMsg,params:[{type:"Property",name:"msg"}]},sendFilterCustomSysMsg:{sid:n(s).id,cid:n(s).sendFilterCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},publishEvent:{sid:s.eventService.id,cid:s.eventService.publishEvent,params:[{type:"Property",name:"msgEvent"}]},pushEvent:{sid:s.eventService.id,cid:s.eventService.pushEvent},subscribeEvent:{sid:s.eventService.id,cid:s.eventService.subscribeEvent,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:s.eventService.id,cid:s.eventService.unSubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:s.eventService.id,cid:s.eventService.unSubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},querySubscribeEventsByAccounts:{sid:s.eventService.id,cid:s.eventService.querySubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},querySubscribeEventsByType:{sid:s.eventService.id,cid:s.eventService.querySubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},pushEvents:{sid:s.eventService.id,cid:s.eventService.pushEvents},getThreadMsgs:{sid:s.msgExtend.id,cid:s.msgExtend.getThreadMsgs,params:[{type:"Property",name:"msg"},{type:"Property",name:"threadMsgReq"}]},getMsgsByIdServer:{sid:s.msgExtend.id,cid:s.msgExtend.getMsgsByIdServer,params:[{type:"PropertyArray",name:"reqMsgs",entity:"msg"}]},addQuickComment:{sid:s.msgExtend.id,cid:s.msgExtend.addQuickComment,params:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},deleteQuickComment:{sid:s.msgExtend.id,cid:s.msgExtend.deleteQuickComment,params:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},getQuickComments:{sid:s.msgExtend.id,cid:s.msgExtend.getQuickComments,params:[{type:"PropertyArray",name:"commentReq",entity:"commentReq"}]},addCollect:{sid:s.msgExtend.id,cid:s.msgExtend.addCollect,params:[{type:"Property",name:"collect"}]},deleteCollects:{sid:s.msgExtend.id,cid:s.msgExtend.deleteCollects,params:[{type:"PropertyArray",name:"collectList",entity:"collect"}]},updateCollect:{sid:s.msgExtend.id,cid:s.msgExtend.updateCollect,params:[{type:"Property",name:"collect"}]},getCollects:{sid:s.msgExtend.id,cid:s.msgExtend.getCollects,params:[{type:"Property",name:"collectQuery"}]},addStickTopSession:{sid:s.msgExtend.id,cid:s.msgExtend.addStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},updateStickTopSession:{sid:s.msgExtend.id,cid:s.msgExtend.updateStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},deleteStickTopSession:{sid:s.msgExtend.id,cid:s.msgExtend.deleteStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},addMsgPin:{sid:s.msgExtend.id,cid:s.msgExtend.addMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},updateMsgPin:{sid:s.msgExtend.id,cid:s.msgExtend.updateMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},deleteMsgPin:{sid:s.msgExtend.id,cid:s.msgExtend.deleteMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},getMsgPins:{sid:s.msgExtend.id,cid:s.msgExtend.getMsgPins,params:[{type:"Property",name:"msgPinReq"}]},httpProxy:{sid:s.proxyService.id,cid:s.proxyService.httpProxy,params:[{type:"Property",name:"proxyTag"}]},getQChatAddress:{sid:s.qchat.id,cid:s.qchat.getQChatAddress,params:[{type:"Property",name:"getQChatAddressTag"}]}}),c=i.merge({},o.packetConfig,{"2_3":{service:"auth",cmd:"login",response:[{type:"Property",name:"loginRes"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"},{type:"Property",name:"aosPushInfo"}]},"2_5":{service:"auth",cmd:"kicked",response:[{type:"Number",name:"from"},{type:"Number",name:"reason"},{type:"String",name:"custom"},{type:"Number",name:"customClientType"}]},"2_6":{service:"auth",cmd:"logout"},"2_7":{service:"auth",cmd:"multiPortLogin",response:[{type:"Number",name:"state"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"}]},"2_8":{service:"auth",cmd:"kick",response:[{type:"StrArray",name:"deviceIds"}]},"3_1":{service:"user",cmd:"updatePushToken"},"3_2":{service:"user",cmd:"appBackground"},"3_3":{service:"user",cmd:"markInBlacklist"},"3_103":{service:"user",cmd:"syncMarkInBlacklist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_4":{service:"user",cmd:"getBlacklist",response:[{type:"StrArray",name:"blacklist"}]},"3_5":{service:"user",cmd:"markInMutelist"},"3_105":{service:"user",cmd:"syncMarkInMutelist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_6":{service:"user",cmd:"getMutelist",response:[{type:"StrArray",name:"mutelist"}]},"3_8":{service:"user",cmd:"getRelations",response:[{type:"PropertyArray",name:"specialRelations",entity:"specialRelation"},{type:"Number",name:"timetag"}]},"3_7":{service:"user",cmd:"getUsers",response:[{type:"PropertyArray",name:"users",entity:"user"}]},"3_10":{service:"user",cmd:"updateMyInfo",response:[{type:"Number",name:"timetag"}]},"3_15":{service:"user",cmd:"updateDonnop",response:[{type:"Number",name:"timetag"}]},"3_115":{service:"user",cmd:"syncUpdateDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"3_109":{service:"user",cmd:"syncMyInfo",response:[{type:"Property",name:"user"},{type:"Number",name:"timetag"}]},"3_110":{service:"user",cmd:"syncUpdateMyInfo",response:[{type:"Property",name:"user"}]},"4_1":{service:"notify"},"4_2":{service:"notify"},"4_3":{service:"notify",cmd:"markRead"},"4_4":{service:"notify",cmd:"syncOfflineMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_5":{service:"notify",cmd:"batchMarkRead"},"4_6":{service:"notify",cmd:"syncOfflineSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_8":{service:"notify",cmd:"syncOfflineNetcallMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_9":{service:"notify",cmd:"syncRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_12":{service:"notify",cmd:"syncMsgReceipts",response:[{type:"PropertyArray",name:"msgReceipts",entity:"msgReceipt"},{type:"Number",name:"timetag"}]},"4_13":{service:"notify",cmd:"syncDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"4_14":{service:"notify",cmd:"syncSessionAck",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Number",name:"timetag"}]},"4_15":{service:"notify",cmd:"syncRobots",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"4_16":{service:"notify",cmd:"syncBroadcastMsgs",response:[{type:"PropertyArray",name:"broadcastMsgs",entity:"broadcastMsg"}]},"4_17":{service:"notify",cmd:"syncSuperTeamRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_18":{service:"notify",cmd:"syncOfflineSuperTeamSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_19":{service:"notify",cmd:"syncDeleteSuperTeamMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"4_20":{service:"notify",cmd:"syncSuperTeamSessionAck",response:[{type:"LongLongMap",name:"superTeam"},{type:"Number",name:"timetag"}]},"4_21":{service:"notify",cmd:"syncDeleteMsgSelf",response:[{type:"PropertyArray",name:"deletedMsgs",entity:"deleteMsgSelfTag"}]},"4_22":{service:"notify",cmd:"syncSessionsWithMoreRoaming",response:[{type:"PropertyArray",name:"sessions",entity:"msg"}]},"4_23":{service:"notify",cmd:"syncStickTopSessions",response:[{type:"Number",name:"timetag"},{type:"boolean",name:"modify"},{type:"PropertyArray",name:"sessions",entity:"stickTopSession"}]},"4_24":{service:"notify",cmd:"syncSessionHistoryMsgsDelete",response:[{type:"PropertyArray",name:"sessionHistoryMsgsDeleteTags",entity:"clearMsgsParamsWithSync"}]},"4_25":{service:"notify",cmd:"syncSessionReliableInfo",response:[{type:"Property",name:"context",entity:"sessionReliableSyncContextTag"},{type:"PropertyArray",name:"datas",entity:"sessionReliableSyncTag"}]},"4_100":{service:"notify",cmd:"syncOfflineFilterMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_101":{service:"notify",cmd:"syncOfflineFilterSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"5_1":{service:"sync",cmd:"syncDone",response:[{type:"Number",name:"timetag"}]},"5_2":{service:"sync",cmd:"syncTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"5_3":{service:"sync",cmd:"syncSuperTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"7_1":{service:"msg",cmd:"sendMsg",response:[{type:"Property",name:"msg"}],trivialErrorCodes:[7101]},"7_2":{service:"msg",cmd:"msg",response:[{type:"Property",name:"msg"}]},"7_3":{service:"msg",cmd:"sysMsg",response:[{type:"Property",name:"sysMsg"}]},"7_6":{service:"msg",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_7":{service:"msg",cmd:"sendCustomSysMsg",trivialErrorCodes:[7101]},"7_8":{service:"msg",cmd:"searchHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_9":{service:"msg",cmd:"deleteSessions"},"7_10":{service:"msg",cmd:"getSessions",response:[{type:"StrArray",name:"sessions"}]},"7_101":{service:"msg",cmd:"syncSendMsg",response:[{type:"Property",name:"msg"}]},"7_11":{service:"msg",cmd:"sendMsgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_12":{service:"msg",cmd:"msgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_13":{service:"msg",cmd:"onDeleteMsg"},"7_14":{service:"msg",cmd:"onMsgDeleted",response:[{type:"Property",name:"sysMsg"}]},"7_15":{service:"msg",cmd:"onDeleteMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"7_16":{service:"msg",cmd:"onMarkSessionAck"},"7_17":{service:"msg",cmd:"broadcastMsg",response:[{type:"Property",name:"broadcastMsg"}]},"7_18":{service:"msg",cmd:"clearServerHistoryMsgs",response:[{type:"Long",name:"timetag"}]},"7_19":{service:"session",cmd:"getServerSessions",response:[{type:"Property",name:"sessionReqTag"},{type:"PropertyArray",name:"sessionList",entity:"session"}]},"7_20":{service:"session",cmd:"getServerSession",response:[{type:"Property",name:"session"}]},"7_21":{service:"session",cmd:"updateServerSession"},"7_22":{service:"session",cmd:"deleteServerSessions"},"7_23":{service:"msg",cmd:"deleteMsgSelf",response:[{type:"Long",name:"timetag"}]},"7_24":{service:"msg",cmd:"deleteMsgSelfBatch",response:[{type:"Long",name:"timetag"}]},"7_25":{service:"msg",cmd:"onMarkSessionAckBatch"},"7_26":{service:"msg",cmd:"msgFtsInServer",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_27":{service:"msg",cmd:"msgFtsInServerByTiming",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_118":{service:"msg",cmd:"onClearServerHistoryMsgs",response:[{type:"Property",name:"sessionHistoryMsgsDeleteTag",entity:"clearMsgsParamsWithSync"}]},"7_123":{service:"msg",cmd:"onDeleteMsgSelf",response:[{type:"Property",name:"deleteMsgSelfTag"}]},"7_124":{service:"msg",cmd:"onDeleteMsgSelfBatch",response:[{type:"PropertyArray",name:"deleteMsgSelfTags",entity:"deleteMsgSelfTag"}]},"7_116":{service:"msg",cmd:"syncMarkSessionAck",response:[{type:"Number",name:"scene"},{type:"String",name:"to"},{type:"Number",name:"timetag"}]},"7_121":{service:"msg",cmd:"syncUpdateServerSession",response:[{type:"Property",name:"session"}]},"23_1":{service:"msgExtend",cmd:"getThreadMsgs",response:[{type:"Property",name:"threadMsg",entity:"msg"},{type:"Property",name:"threadMsgsMeta"},{type:"PropertyArray",name:"msgs",entity:"msg"}]},"23_2":{service:"msgExtend",cmd:"getMsgsByIdServer",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"23_3":{service:"msgExtend",cmd:"addQuickComment",response:[{type:"Number",name:"timetag"}]},"23_4":{service:"msgExtend",cmd:"deleteQuickComment",response:[{type:"Number",name:"timetag"}]},"23_5":{service:"msgExtend",cmd:"onQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_6":{service:"msgExtend",cmd:"onDeleteQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_7":{service:"msgExtend",cmd:"getQuickComments",response:[{type:"PropertyArray",name:"commentRes",entity:"commentRes"}]},"23_8":{service:"msgExtend",cmd:"addCollect",response:[{type:"Property",name:"collect"}]},"23_9":{service:"msgExtend",cmd:"deleteCollects",response:[{type:"Number",name:"deleteNum"}]},"23_10":{service:"msgExtend",cmd:"updateCollect",response:[{type:"Property",name:"collect"}]},"23_11":{service:"msgExtend",cmd:"getCollects",response:[{type:"Number",name:"total"},{type:"PropertyArray",name:"collectList",entity:"collect"}]},"23_12":{service:"msgExtend",cmd:"addStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_13":{service:"msgExtend",cmd:"deleteStickTopSession",response:[{type:"Number",name:"timetag"}]},"23_14":{service:"msgExtend",cmd:"updateStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_15":{service:"msgExtend",cmd:"addMsgPin",response:[{type:"Number",name:"timetag"}]},"23_16":{service:"msgExtend",cmd:"updateMsgPin",response:[{type:"Number",name:"timetag"}]},"23_17":{service:"msgExtend",cmd:"deleteMsgPin",response:[{type:"Number",name:"timetag"}]},"23_18":{service:"msgExtend",cmd:"onAddMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_19":{service:"msgExtend",cmd:"onUpdateMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_20":{service:"msgExtend",cmd:"onDeleteMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_21":{service:"msgExtend",cmd:"getMsgPins",response:[{type:"Number",name:"timetag"},{type:"Boolean",name:"modify"},{type:"PropertyArray",name:"pins",entity:"msgPinRes"}]},"23_103":{service:"msgExtend",cmd:"syncAddQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_104":{service:"msgExtend",cmd:"syncDeleteQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_112":{service:"msgExtend",cmd:"syncAddStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_113":{service:"msgExtend",cmd:"syncDeleteStickTopSession",response:[{type:"Number",name:"timetag"},{type:"Property",name:"stickTopSession"}]},"23_114":{service:"msgExtend",cmd:"syncUpdateStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_115":{service:"msgExtend",cmd:"syncAddMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_116":{service:"msgExtend",cmd:"syncUpdateMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_117":{service:"msgExtend",cmd:"syncDeleteMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"21_2":{service:"superTeam",cmd:"sendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_3":{service:"superTeam",cmd:"superTeamMsg",response:[{type:"Property",name:"msg"}]},"21_5":{service:"superTeam",cmd:"addSuperTeamMembers",response:[{type:"StrArray",name:"abortedAccidList"},{type:"long",name:"timetag"}]},"21_6":{service:"superTeam",cmd:"removeSuperTeamMembers"},"21_7":{service:"superTeam",cmd:"leaveSuperTeam"},"21_8":{service:"superTeam",cmd:"updateSuperTeam",response:[{type:"long",name:"timetag"}]},"21_9":{service:"superTeam",cmd:"getSuperTeam",response:[{type:"Property",name:"team"}]},"21_12":{service:"superTeam",cmd:"getSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_10":{service:"superTeam",cmd:"updateInfoInSuperTeam"},"21_13":{service:"superTeam",cmd:"getSuperTeamMembers",response:[{type:"long",name:"timetag"}]},"21_11":{service:"superTeam",cmd:"getMySuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_14":{service:"superTeam",cmd:"getSuperTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"21_15":{service:"superTeam",cmd:"getSuperTeamMembersByJoinTime",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_16":{service:"superTeam",cmd:"sendSuperTeamCustomSysMsg",trivialErrorCodes:[7101]},"21_17":{service:"superTeam",cmd:"onDeleteSuperTeamMsg"},"21_18":{service:"superTeam",cmd:"onSuperTeamMsgDelete",response:[{type:"Property",name:"sysMsg"}]},"21_19":{service:"superTeam",cmd:"superTeamCustomSysMsg",response:[{type:"Property",name:"sysMsg"}]},"21_20":{service:"superTeam",cmd:"applySuperTeam",response:[{type:"Property",name:"team"}]},"21_21":{service:"superTeam",cmd:"passSuperTeamApply"},"21_22":{service:"superTeam",cmd:"rejectSuperTeamApply"},"21_23":{service:"superTeam",cmd:"acceptSuperTeamInvite",response:[{type:"Property",name:"team"}]},"21_24":{service:"superTeam",cmd:"rejectSuperTeamInvite"},"21_25":{service:"superTeam",cmd:"onMarkSuperTeamSessionAck"},"21_26":{service:"superTeam",cmd:"addSuperTeamManagers"},"21_27":{service:"superTeam",cmd:"removeSuperTeamManagers"},"21_28":{service:"superTeam",cmd:"updateSuperTeamMute"},"21_29":{service:"superTeam",cmd:"updateSuperTeamMembersMute",response:[{type:"long",name:"timetag"}]},"21_30":{service:"superTeam",cmd:"updateNickInSuperTeam"},"21_31":{service:"superTeam",cmd:"transferSuperTeam"},"21_32":{service:"superTeam",cmd:"onMarkSuperTeamSessionsAck"},"21_33":{service:"superTeam",cmd:"getSuperTeamMembersByAccounts",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_34":{service:"superTeam",cmd:"getMutedSuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_113":{service:"superTeam",cmd:"syncSuperTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"superTeamMember"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_111":{service:"superTeam",cmd:"syncMySuperTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"superTeamMember"},{type:"long",name:"timetag"}]},"21_109":{service:"superTeam",cmd:"syncSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_101":{service:"superTeam",cmd:"syncCreateSuperTeam",response:[{type:"Property",name:"team"}]},"21_102":{service:"superTeam",cmd:"syncSendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_110":{service:"superTeam",cmd:"syncUpdateSuperTeamMember",response:[{type:"Property",name:"teamMember",entity:"superTeamMember"}]},"21_117":{service:"superTeam",cmd:"syncDeleteSuperTeamMsg",response:[{type:"Property",name:"sysMsg"}]},"21_125":{service:"superTeam",cmd:"syncMarkSuperTeamSessionAck",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},"8_1":{service:"team",cmd:"createTeam",response:[{type:"Property",name:"team"},{type:"StrArray",name:"abortedAccidList"}]},"8_2":{service:"team",cmd:"sendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_3":{service:"team",cmd:"teamMsg",response:[{type:"Property",name:"msg"}]},"8_4":{service:"team",cmd:"teamMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_5":{service:"team",cmd:"addTeamMembers",response:[{type:"long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},"8_6":{service:"team",cmd:"removeTeamMembers"},"8_7":{service:"team",cmd:"updateTeam",response:[{type:"Number",name:"id"},{type:"Number",name:"time"}]},"8_8":{service:"team",cmd:"leaveTeam"},"8_9":{service:"team",cmd:"getTeam",response:[{type:"Property",name:"team"}]},"8_10":{service:"team",cmd:"getTeams",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"Number",name:"timetag"}]},"8_11":{service:"team",cmd:"getTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_12":{service:"team",cmd:"dismissTeam"},"8_13":{service:"team",cmd:"applyTeam",response:[{type:"Property",name:"team"}]},"8_14":{service:"team",cmd:"passTeamApply"},"8_15":{service:"team",cmd:"rejectTeamApply"},"8_16":{service:"team",cmd:"addTeamManagers"},"8_17":{service:"team",cmd:"removeTeamManagers"},"8_18":{service:"team",cmd:"transferTeam"},"8_19":{service:"team",cmd:"updateInfoInTeam"},"8_20":{service:"team",cmd:"updateNickInTeam"},"8_21":{service:"team",cmd:"acceptTeamInvite",response:[{type:"Property",name:"team"}]},"8_22":{service:"team",cmd:"rejectTeamInvite"},"8_23":{service:"team",cmd:"getTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_24":{service:"team",cmd:"searchTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_25":{service:"team",cmd:"updateMuteStateInTeam"},"8_26":{service:"team",cmd:"getMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_27":{service:"team",cmd:"getMutedTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_28":{service:"team",cmd:"sendTeamMsgReceipt",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_29":{service:"team",cmd:"getTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_30":{service:"team",cmd:"getTeamMsgReadAccounts",response:[{type:"Property",name:"teamMsgReceipt"},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},"8_31":{service:"team",cmd:"notifyTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_32":{service:"team",cmd:"muteTeamAll",response:[]},"8_33":{service:"team",cmd:"getTeamMemberInvitorAccid",response:[{type:"object",name:"accountsMap"}]},"8_34":{service:"team",cmd:"getTeamsById",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"StrArray",name:"tids"}],trivialErrorCodes:[816]},"8_126":{service:"team",cmd:"syncMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_109":{service:"team",cmd:"syncTeams",response:[{type:"Number",name:"timetag"},{type:"PropertyArray",name:"teams",entity:"team"}]},"8_111":{service:"team",cmd:"syncTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_101":{service:"team",cmd:"syncCreateTeam",response:[{type:"Property",name:"team"}]},"8_102":{service:"team",cmd:"syncSendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_119":{service:"team",cmd:"syncUpdateTeamMember",response:[{type:"Property",name:"teamMember"}]},"12_1":{service:"friend",cmd:"friendRequest"},"12_101":{service:"friend",cmd:"syncFriendRequest",response:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}]},"12_2":{service:"friend",cmd:"deleteFriend"},"12_102":{service:"friend",cmd:"syncDeleteFriend",response:[{type:"String",name:"account"}]},"12_3":{service:"friend",cmd:"updateFriend"},"12_103":{service:"friend",cmd:"syncUpdateFriend",response:[{type:"Property",name:"friend"}]},"12_4":{service:"friend",cmd:"getFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_5":{service:"friend",cmd:"syncFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_6":{service:"friend",cmd:"syncFriendUsers",response:[{type:"PropertyArray",name:"users",entity:"user"},{type:"Number",name:"timetag"}]},"13_1":{service:"chatroom",cmd:"getChatroomAddress",response:[{type:"StrArray",name:"address"}]},"14_1":{service:"eventService",cmd:"publishEvent",response:[{type:"Property",name:"msgEvent"}]},"14_2":{service:"eventService",cmd:"pushEvent",response:[{type:"Property",name:"msgEvent"}]},"14_3":{service:"eventService",cmd:"subscribeEvent",response:[{type:"StrArray",name:"accounts"}]},"14_4":{service:"eventService",cmd:"unSubscribeEventsByAccounts",response:[{type:"StrArray",name:"accounts"}]},"14_5":{service:"eventService",cmd:"unSubscribeEventsByType"},"14_6":{service:"eventService",cmd:"querySubscribeEventsByAccounts",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_7":{service:"eventService",cmd:"querySubscribeEventsByType",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_9":{service:"eventService",cmd:"pushEvents",response:[{type:"PropertyArray",name:"msgEvents",entity:"msgEvent"}]},"22_1":{service:"proxyService",cmd:"httpProxy",response:[{type:"Property",name:"proxyTag"}]},"22_2":{service:"proxyService",cmd:"onProxyMsg",response:[{type:"Property",name:"proxyMsg",entity:"proxyMsgTag"}]},"24_1":{service:"qchat",cmd:"getQChatAddress",response:[{type:"StrArray",name:"address"}]},"101_1":{service:"filter",cmd:"sendFilterMsg",response:[{type:"Property",name:"msg"}]},"101_2":{service:"filter",cmd:"filterMsg",response:[{type:"Property",name:"msg"}]},"101_3":{service:"filter",cmd:"filterSysMsg",response:[{type:"Property",name:"sysMsg"}]},"101_7":{service:"filter",cmd:"sendFilterCustomSysMsg"}});e.exports={idMap:s,cmdConfig:a,packetConfig:c}},function(e,t){e.exports={negotiateTransportTag:{version:-1,serializeList:1,serialize:101},initTransportTag:{},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,sdkType:41,userAgent:42,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,connectionId:102,ip:103,time:109,customTag:38,customClientType:39},aosPushInfo:{pushType:110,hasTokenPreviously:111},sync:{myInfo:1,offlineMsgs:2,teams:3,netcallMsgs:6,roamingMsgs:7,relations:9,friends:11,sessions:12,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,deleteMsg:17,sessionAck:18,robots:19,broadcastMsgs:20,avSignal:21,superTeams:22,myInfoInSuperTeams:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteMsgSelf:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,filterMsgs:100},donnop:{open:1},sessionReqTag:{minTimestamp:1,maxTimestamp:2,needLastMsg:3,limit:4,hasMore:5},session:{id:1,updateTime:2,ext:3,lastMsg:4},superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,createTime:10,updateTime:11,custom:12,mute:13,invitoraccid:14,joinTime:15},team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,custom:12,mute:13,invitorAccid:14},msg:{scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resend:13,userUpdateTime:14,custom:15,pushPayload:16,pushContent:17,apnsAccounts:18,apnsContent:19,apnsForcePush:20,yidunEnable:21,antiSpamContent:22,antiSpamBusinessId:23,clientAntiSpam:24,antiSpamUsingYidun:25,needMsgReceipt:26,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,delete:39,callbackExt:40,subType:41,yidunAntiCheating:42,env:43,yidunAntiSpamExt:44,yidunAntiSpamRes:45,isHistoryable:100,isRoamingable:101,isSyncable:102,isMuted:104,cc:105,isInBlackList:106,isPushable:107,isOfflinable:108,isUnreadable:109,needPushNick:110,isReplyMsg:111,tempTeamMemberCount:112},threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2},comment:{from:1,body:2,time:3,custom:4,needPush:5,needBadge:6,pushTitle:7,apnsText:8,pushPayload:9},commentReq:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,timestamp:100},commentRes:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,detail:7,modify:8,timestamp:100},collect:{id:1,type:2,data:3,custom:4,uniqueId:5,createTime:6,updateTime:7},collectQuery:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5,type:6},stickTopSession:{id:1,topCustom:2,createTime:3,updateTime:4},pinTag:{pinFrom:1,pinCustom:2,createTime:3,updateTime:4},msgPinReq:{sessionId:1,timetag:2},msgPinRes:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,pinFrom:7,pinCustom:8},msgReceipt:{to:1,from:2,time:7,idClient:11},teamMsgReceipt:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},deleteMsgSelfTag:{scene:1,from:2,to:3,idServer:4,idClient:5,time:6,deletedTime:7,custom:8},sysMsg:{time:0,type:1,to:2,from:3,ps:4,attach:5,idServer:6,sendToOnlineUsersOnly:7,apnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,yidunEnable:12,antiSpamContent:13,deletedMsgTime:14,deletedMsgFromNick:15,opeAccount:16,env:21,callbackExt:22,cc:105,isPushable:107,isUnreadable:109,needPushNick:110},broadcastMsg:{broadcastId:1,fromAccid:2,fromUid:3,timestamp:4,body:5},friend:{account:4,flag:5,beflag:6,source:7,alias:8,bits:9,custom:10,createTime:11,updateTime:12,serverex:13},user:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,custom:10,createTime:12,updateTime:13},antispamTag:{antiSpamBusinessId:1},specialRelation:{account:0,isMuted:1,isBlacked:2,createTime:3,updateTime:4},msgType:{text:0,picture:1,audio:2,video:3,location:4,notification:5,file:6,netcall_audio:7,netcall_vedio:8,datatunnel_new:9,tips:10,robot:11,custom:100},msgEvent:{type:1,value:2,idClient:3,custom:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverCustom:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105},clearMsgsParams:{account:1,delRoam:2},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},msgFullSearchRequestTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msgLimit:5,order:6,p2pList:7,teamList:8,senderList:9,msgTypeList:10,msgSubTypeList:11},msgTimingFullSearchRequestTag:{keyword:1,fromTime:2,toTime:3,msgLimit:5,order:6,p2pList:7,teamList:8,senderList:9,msgTypeList:10,msgSubTypeList:11},delFriendParams:{delAlias:1},proxyTag:{zone:1,path:2,method:3,header:4,body:5},proxyMsgTag:{from:1,body:2,time:3},sessionAckTag:{scene:1,to:2,timetag:3},mixTokenReq:{provider:0,tokenCount:1,fileExpireSec:2,tag:3,returnBody:4},mixAuthTokenReq:{type:1,urls:2},notifyDetectTag:{type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},getQChatAddressTag:{ipType:1}}},function(e,t){e.exports={negotiateTransportTag:{"-1":"version",1:"serializeList",101:"serialize"},initTransportTag:{},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},nosAccessTokenTag:{0:"token",1:"url",2:"userAgent",3:"ext"},nosConfigTag:{1:"bucket",2:"cdnDomain",3:"expire",4:"objectNamePrefix"},appGrayConfigTag:{0:"grayConfig",1:"ttl"},mixStorePolicyTag:{0:"providers",1:"ttl",2:"mixEnable",3:"nosPolicy",4:"s3Policy"},mixStoreTokenTag:{0:"provider",1:"accessKeyId",2:"secretAccessKey",3:"sessionToken",4:"token",5:"expireAt",6:"bucket",7:"objectName",8:"fileExpireSec",9:"tag",10:"shortUrl",11:"region"},notifyDetectTag:{1:"type",2:"params",3:"result",100:"t1",101:"t2",102:"t3",103:"t4",104:"t5",105:"t6"},backSourceTokenTag:{1:"type",2:"tokens",3:"token",4:"ttl"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time",25:"nertcChannelName",26:"nertcTokenTtl",27:"nertcToken",28:"nertcJoinRoomQueryParamMap",29:"nertcJoinRoomResponse",30:"callStatus"},login:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",39:"customClientType",40:"sdkHumanVersion",112:"isReactNative",115:"authType",116:"loginExt",1e3:"token"},loginRes:{17:"lastLoginDeviceId",38:"customTag",102:"connectionId",103:"ip",104:"port",106:"country",111:"hasXMPush"},loginPort:{3:"type",4:"os",5:"mac",13:"deviceId",19:"account",32:"deviceInfo",38:"customTag",39:"customClientType",102:"connectionId",103:"ip",109:"time"},aosPushInfo:{110:"pushType",111:"hasTokenPreviously"},sync:{1:"myInfo",2:"offlineMsgs",3:"teams",6:"netcallMsgs",7:"roamingMsgs",9:"relations",11:"friends",12:"sessions",13:"friendUsers",14:"msgReceipts",15:"myTeamMembers",16:"donnop",17:"deleteMsg",18:"sessionAck",19:"robots",20:"broadcastMsgs",21:"avSignal",22:"superTeams",23:"myInfoInSuperTeams",24:"superTeamRoamingMsgs",25:"deleteSuperTeamMsg",26:"superTeamSessionAck",27:"deleteMsgSelf",28:"stickTopSessions",29:"sessionHistoryMsgsDelete",100:"filterMsgs"},donnop:{1:"open"},sessionReqTag:{1:"minTimestamp",2:"maxTimestamp",3:"needLastMsg",4:"limit",5:"hasMore"},session:{1:"id",2:"updateTime",3:"ext",4:"lastMsg",5:"lastMsgType"},superTeam:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},superTeamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"createTime",11:"updateTime",12:"custom",13:"mute",14:"invitoraccid",15:"joinTime"},team:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},teamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"joinTime",11:"updateTime",12:"custom",13:"mute",14:"invitorAccid"},msg:{0:"scene",1:"to",2:"from",4:"fromClientType",5:"fromDeviceId",6:"fromNick",7:"time",8:"type",9:"body",10:"attach",11:"idClient",12:"idServer",13:"resend",14:"userUpdateTime",15:"custom",16:"pushPayload",17:"pushContent",18:"apnsAccounts",19:"apnsContent",20:"apnsForcePush",21:"yidunEnable",22:"antiSpamContent",23:"antiSpamBusinessId",24:"clientAntiSpam",25:"antiSpamUsingYidun",26:"needMsgReceipt",28:"needUpdateSession",29:"replyMsgFromAccount",30:"replyMsgToAccount",31:"replyMsgTime",32:"replyMsgIdServer",33:"replyMsgIdClient",34:"threadMsgFromAccount",35:"threadMsgToAccount",36:"threadMsgTime",37:"threadMsgIdServer",38:"threadMsgIdClient",39:"delete",40:"callbackExt",41:"subType",42:"yidunAntiCheating",43:"env",44:"yidunAntiSpamExt",45:"yidunAntiSpamRes",100:"isHistoryable",101:"isRoamingable",102:"isSyncable",104:"isMuted",105:"cc",106:"isInBlackList",107:"isPushable",108:"isOfflinable",109:"isUnreadable",110:"needPushNick",111:"isReplyMsg",112:"tempTeamMemberCount"},threadMsgReq:{1:"beginTime",2:"endTime",3:"lastMsgId",4:"limit",5:"reverse"},threadMsgsMeta:{1:"total",2:"lastMsgTime"},comment:{1:"from",2:"body",3:"time",4:"custom",5:"needPush",6:"needBadge",7:"pushTitle",8:"apnsText",9:"pushPayload"},commentReq:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",100:"timestamp"},commentRes:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",7:"detail",8:"modify",100:"timestamp"},collect:{1:"id",2:"type",3:"data",4:"custom",5:"uniqueId",6:"createTime",7:"updateTime"},collectQuery:{1:"beginTime",2:"endTime",3:"lastMsgId",4:"limit",5:"reverse",6:"type"},stickTopSession:{1:"id",2:"topCustom",3:"createTime",4:"updateTime"},pinTag:{1:"pinFrom",2:"pinCustom",3:"createTime",4:"updateTime"},msgPinReq:{1:"sessionId",2:"timetag"},msgPinRes:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",7:"pinFrom",8:"pinCustom"},msgReceipt:{1:"to",2:"from",7:"time",11:"idClient"},teamMsgReceipt:{0:"teamId",1:"idServer",100:"read",101:"unread",102:"idClient",103:"account"},deleteMsgSelfTag:{1:"scene",2:"from",3:"to",4:"idServer",5:"idClient",6:"time",7:"deletedTime",8:"custom"},sysMsg:{0:"time",1:"type",2:"to",3:"from",4:"ps",5:"attach",6:"idServer",7:"sendToOnlineUsersOnly",8:"apnsText",9:"pushPayload",10:"deletedIdClient",11:"deletedIdServer",12:"yidunEnable",13:"antiSpamContent",14:"deletedMsgTime",15:"deletedMsgFromNick",16:"opeAccount",21:"env",22:"callbackExt",105:"cc",107:"isPushable",109:"isUnreadable",110:"needPushNick"},broadcastMsg:{1:"broadcastId",2:"fromAccid",3:"fromUid",4:"timestamp",5:"body"},friend:{4:"account",5:"flag",6:"beflag",7:"source",8:"alias",9:"bits",10:"custom",11:"createTime",12:"updateTime",13:"serverex"},user:{1:"account",3:"nick",4:"avatar",5:"sign",6:"gender",7:"email",8:"birth",9:"tel",10:"custom",12:"createTime",13:"updateTime",_4_safe:"_avatar_safe"},antispamTag:{antiSpamBusinessId:1},specialRelation:{0:"account",1:"isMuted",2:"isBlacked",3:"createTime",4:"updateTime"},msgType:{0:"text",1:"picture",2:"audio",3:"video",4:"location",5:"notification",6:"file",7:"netcall_audio",8:"netcall_vedio",9:"datatunnel_new",10:"tips",11:"robot",100:"custom"},msgEvent:{1:"type",2:"value",3:"idClient",4:"custom",5:"validTime",6:"broadcastType",7:"sync",8:"validTimeType",9:"durable",10:"time",11:"idServer",12:"clientType",13:"serverConfig",14:"serverCustom",101:"appid",103:"account",104:"enableMultiClient",106:"consid"},msgEventSubscribe:{1:"type",2:"subscribeTime",3:"sync",102:"to",104:"from",105:"time"},clearMsgsParams:{1:"account",2:"delRoam"},clearMsgsParamsWithSync:{0:"type",1:"otherAccid",2:"delRoam",3:"toTid",4:"isSyncSelf",5:"fromAccid",6:"time",7:"ext"},msgFullSearchRequestTag:{1:"keyword",2:"fromTime",3:"toTime",4:"sessionLimit",5:"msgLimit",6:"order",7:"p2pList",8:"teamList",9:"senderList",10:"msgTypeList",11:"msgSubTypeList"},delFriendParams:{1:"delAlias"},proxyTag:{1:"zone",2:"path",3:"method",4:"header",5:"body"},proxyMsgTag:{1:"from",2:"body",3:"time"},sessionReliableSyncTag:{1:"scene",2:"sessionId",3:"syncStatus",4:"syncEndMsgId",5:"syncEndMsgidClient",6:"syncEndMsgTime",7:"syncStartMsgid",8:"syncStartMsgidClient",9:"syncStartMsgTime",10:"nextMsgid",11:"nextMsgidClient",12:"nextMsgTime",13:"roamMsgSync",14:"offlineMsgSync",15:"netCallOfflineMsgSync"},sessionReliableSyncContextTag:{1:"timetag",2:"type"}}},function(e,t,r){var n=r(0),i=r(139),o=n.merge({},i.idMap,{chatroom:{id:13,login:2,kicked:3,logout:4,sendMsg:6,msg:7,getChatroomMembers:8,getHistoryMsgs:9,markChatroomMember:11,closeChatroom:12,getChatroom:13,updateChatroom:14,updateMyChatroomMemberInfo:15,getChatroomMembersInfo:16,kickChatroomMember:17,updateChatroomMemberTempMute:19,queueOffer:20,queuePoll:21,queueList:22,peak:23,queueDrop:24,queueInit:25,queueChange:26,updateTagMembersTempMute:30,getChatroomMembersByTag:31,getChatroomMemberCountByTag:32,updateCoordinate:33,updateChatroomTags:34,sendChatroomMsgAck:35,getHistoryMsgsByTags:36,notifyCdnInfo:99},user:{id:3,syncRobot:16}}),s=n.merge({},i.cmdConfig,{login:{sid:o.chatroom.id,cid:o.chatroom.login,params:[{type:"byte",name:"type"},{type:"Property",name:"login"},{type:"Property",name:"imLogin"}]},logout:{sid:o.chatroom.id,cid:o.chatroom.logout},sendMsg:{sid:o.chatroom.id,cid:o.chatroom.sendMsg,params:[{type:"Property",name:"msg"}]},getChatroomMembers:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembers,params:[{type:"byte",name:"type"},{type:"long",name:"time"},{type:"int",name:"limit"}]},getHistoryMsgs:{sid:o.chatroom.id,cid:o.chatroom.getHistoryMsgs,params:[{type:"long",name:"timetag"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},markChatroomMember:{sid:o.chatroom.id,cid:o.chatroom.markChatroomMember,params:[{type:"string",name:"account"},{type:"int",name:"type"},{type:"bool",name:"isAdd"},{type:"int",name:"level"},{type:"string",name:"custom"}]},closeChatroom:{sid:o.chatroom.id,cid:o.chatroom.closeChatroom,params:[{type:"string",name:"custom"}]},getChatroom:{sid:o.chatroom.id,cid:o.chatroom.getChatroom},updateChatroom:{sid:o.chatroom.id,cid:o.chatroom.updateChatroom,params:[{type:"Property",name:"chatroom"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"Property",name:"antispamTag"}]},updateMyChatroomMemberInfo:{sid:o.chatroom.id,cid:o.chatroom.updateMyChatroomMemberInfo,params:[{type:"Property",name:"chatroomMember"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"bool",name:"needSave"},{type:"Property",name:"antispamTag"}]},getChatroomMembersInfo:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembersInfo,params:[{type:"StrArray",name:"accounts"}]},kickChatroomMember:{sid:o.chatroom.id,cid:o.chatroom.kickChatroomMember,params:[{type:"string",name:"account"},{type:"string",name:"custom"}]},updateChatroomMemberTempMute:{sid:o.chatroom.id,cid:o.chatroom.updateChatroomMemberTempMute,params:[{type:"String",name:"account"},{type:"long",name:"duration"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"}]},queueOffer:{sid:o.chatroom.id,cid:o.chatroom.queueOffer,params:[{type:"string",name:"elementKey"},{type:"string",name:"elementValue"},{type:"bool",name:"transient"},{type:"string",name:"elementAccount"}]},queuePoll:{sid:o.chatroom.id,cid:o.chatroom.queuePoll,params:[{type:"string",name:"elementKey"}]},queueList:{sid:o.chatroom.id,cid:o.chatroom.queueList},peak:{sid:o.chatroom.id,cid:o.chatroom.peak},queueDrop:{sid:o.chatroom.id,cid:o.chatroom.queueDrop},queueInit:{sid:o.chatroom.id,cid:o.chatroom.queueInit,params:[{type:"int",name:"limit"}]},queueChange:{sid:o.chatroom.id,cid:o.chatroom.queueChange,params:[{type:"StrStrMap",name:"elementMap"},{type:"bool",name:"needNotify"},{type:"string",name:"notifyExt"}]},updateTagMembersTempMute:{sid:o.chatroom.id,cid:o.chatroom.updateTagMembersTempMute,params:[{type:"Property",name:"tagMuteReq"}]},updateCoordinate:{sid:o.chatroom.id,cid:o.chatroom.updateCoordinate,params:[{type:"Property",name:"coordinateReq"}]},getChatroomMemberCountByTag:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMemberCountByTag,params:[{type:"String",name:"tag"}]},getChatroomMembersByTag:{sid:o.chatroom.id,cid:o.chatroom.getChatroomMembersByTag,params:[{type:"Property",name:"tagMemberReq"}]},updateChatroomTags:{sid:o.chatroom.id,cid:o.chatroom.updateChatroomTags,params:[{type:"Property",name:"chatRoomTagsUpdateTag"}]},sendChatroomMsgAck:{sid:o.chatroom.id,cid:o.chatroom.sendChatroomMsgAck,params:[{type:"Property",name:"chatRoomMsgAckTag"}]},getHistoryMsgsByTags:{sid:o.chatroom.id,cid:o.chatroom.getHistoryMsgsByTags,params:[{type:"Property",name:"chatRoomTagHistoryMsgRequestTag"}]},notifyCdnInfo:{sid:o.chatroom.id,cid:o.chatroom.notifyCdnInfo},syncRobot:{sid:o.user.id,cid:o.user.syncRobot,params:[{type:"long",name:"timetag"}]}}),a=n.merge({},i.packetConfig,{"4_10":{service:"notify"},"4_11":{service:"notify"},"3_16":{service:"chatroom",cmd:"syncRobot",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"13_2":{service:"chatroom",cmd:"login",response:[{type:"Property",name:"chatroom"},{type:"Property",name:"chatroomMember"},{type:"Property",name:"chatroomCdnInfo"}]},"13_3":{service:"chatroom",cmd:"kicked",response:[{type:"Number",name:"reason"},{type:"String",name:"custom"}]},"13_4":{service:"chatroom",cmd:"logout"},"13_6":{service:"chatroom",cmd:"sendMsg",response:[{type:"Property",name:"msg"}]},"13_7":{service:"chatroom",cmd:"msg",response:[{type:"Property",name:"msg"}]},"13_8":{service:"chatroom",cmd:"getChatroomMembers",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_9":{service:"chatroom",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_11":{service:"chatroom",cmd:"markChatroomMember",response:[{type:"Property",name:"chatroomMember"}]},"13_12":{service:"chatroom",cmd:"closeChatroom"},"13_13":{service:"chatroom",cmd:"getChatroom",response:[{type:"Property",name:"chatroom"}]},"13_14":{service:"chatroom",cmd:"updateChatroom"},"13_15":{service:"chatroom",cmd:"updateMyChatroomMemberInfo"},"13_16":{service:"chatroom",cmd:"getChatroomMembersInfo",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_17":{service:"chatroom",cmd:"kickChatroomMember"},"13_19":{service:"chatroom",cmd:"updateChatroomMemberTempMute"},"13_20":{service:"chatroom",cmd:"queueOffer"},"13_21":{service:"chatroom",cmd:"queuePoll",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_22":{service:"chatroom",cmd:"queueList",response:[{type:"KVArray",name:"queueList"}]},"13_23":{service:"chatroom",cmd:"peak",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_24":{service:"chatroom",cmd:"queueDrop"},"13_25":{service:"chatroom",cmd:"queueInit"},"13_26":{service:"chatroom",cmd:"queueChange",response:[{type:"StrArray",name:"elementKeyArray"}]},"13_30":{service:"chatroom",cmd:"updateTagMembersTempMute"},"13_33":{service:"chatroom",cmd:"updateCoordinate"},"13_31":{service:"chatroom",cmd:"getChatroomMembersByTag",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_32":{service:"chatroom",cmd:"getChatroomMemberCountByTag",response:[{type:"long",name:"count"}]},"13_34":{service:"chatroom",cmd:"updateChatroomTags"},"13_36":{service:"chatroom",cmd:"getHistoryMsgsByTags",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_99":{service:"chatroom",cmd:"notifyCdnInfo",response:[{type:"Property",name:"chatroomCdnInfo"}]},"13_101":{service:"chatroom",cmd:"updateChatroomTag",response:[{type:"Property",name:"updateTags"}]}});e.exports={idMap:o,cmdConfig:s,packetConfig:a}},function(e,t){e.exports={imLogin:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,sdkType:41,userAgent:42,isReactNative:112,authType:115,loginExt:116,token:1e3,customTag:38},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},login:{appKey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,chatroomCustom:22,chatroomEnterCustom:23,session:26,isAnonymous:38,tags:39,notifyTargetTags:40,loginAuthType:41,loginExt:42,loc_x:43,loc_y:44,loc_z:45,distance:46,antiSpamBusinessId:47},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,custom:12,createTime:14,updateTime:15,queuelevel:16,creator:100,onlineMemberNum:101,mute:102},msg:{idClient:1,type:2,attach:3,custom:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromCustom:9,yidunEnable:10,antiSpamContent:11,skipHistory:12,body:13,antiSpamBusinessId:14,clientAntiSpam:15,antiSpamUsingYidun:16,time:20,from:21,chatroomId:22,fromClientType:23,highPriority:25,callbackExt:27,subType:28,yidunAntiCheating:29,env:30,notifyTargetTags:31,yidunAntiSpamExt:32,yidunAntiSpamRes:33,loc_x:34,loc_y:35,loc_z:36,toAccids:37,needHighPriorityMsgAck:38},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,custom:7,online:8,guest:9,enterTime:10,blacked:12,gaged:13,valid:14,updateTime:15,tempMuted:16,tempMuteDuration:17},antispamTag:{antiSpamBusinessId:1},chatroomCdnInfo:{enable:1,cdnUrls:2,timestamp:3,interval:4,decryptType:5,decryptKey:6,timeout:7},tagMemberReq:{tag:1,time:2,limit:3},tagMuteReq:{tag:1,duration:2,needNotify:3,custom:4,notifyTargetTags:5},coordinateReq:{x:1,y:2,z:3,distance:4},chatRoomTagsUpdateTag:{tags:1,notifyTargetTags:2,needNotify:3,ext:4},chatRoomMsgAckTag:{idClient:1,chatroomId:2},chatRoomTagHistoryMsgRequestTag:{tags:1,types:2,fromTime:3,toTime:4,limit:5,reverse:6}}},function(e,t){e.exports={imLogin:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",41:"sdkType",42:"userAgent",112:"isReactNative",1e3:"token"},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},nosAccessTokenTag:{0:"token",1:"url",2:"userAgent",3:"ext"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time",25:"nertcChannelName",26:"nertcTokenTtl",27:"nertcToken",28:"nertcJoinRoomQueryParamMap",29:"nertcJoinRoomResponse",30:"callStatus"},login:{1:"appKey",2:"account",3:"deviceId",5:"chatroomId",8:"appLogin",20:"chatroomNick",21:"chatroomAvatar",22:"chatroomCustom",23:"chatroomEnterCustom",26:"session",38:"isAnonymous",39:"tags",40:"notifyTargetTags",41:"loginAuthType",42:"loginExt",43:"loc_x",44:"loc_y",45:"loc_z",46:"distance",47:"antiSpamBusinessId",_21_safe:"_chatroomAvatar_safe"},chatroom:{1:"id",3:"name",4:"announcement",5:"broadcastUrl",12:"custom",14:"createTime",15:"updateTime",16:"queuelevel",100:"creator",101:"onlineMemberNum",102:"mute"},msg:{1:"idClient",2:"type",3:"attach",4:"custom",5:"resend",6:"userUpdateTime",7:"fromNick",8:"fromAvatar",9:"fromCustom",10:"yidunEnable",11:"antiSpamContent",12:"skipHistory",13:"body",14:"antiSpamBusinessId",15:"clientAntiSpam",16:"antiSpamUsingYidun",20:"time",21:"from",22:"chatroomId",23:"fromClientType",25:"highPriority",27:"callbackExt",28:"subType",29:"yidunAntiCheating",30:"env",31:"notifyTargetTags",32:"yidunAntiSpamExt",33:"yidunAntiSpamRes",34:"loc_x",35:"loc_y",36:"loc_z",37:"toAccids",38:"needHighPriorityMsgAck",_8_safe:"_fromAvatar_safe"},chatroomMember:{1:"chatroomId",2:"account",3:"type",4:"level",5:"nick",6:"avatar",7:"custom",8:"online",9:"guest",10:"enterTime",12:"blacked",13:"gaged",14:"valid",15:"updateTime",16:"tempMuted",17:"tempMuteDuration",_6_safe:"_avatar_safe"},antispamTag:{antiSpamBusinessId:1},chatroomCdnInfo:{1:"enable",2:"cdnUrls",3:"timestamp",4:"interval",5:"decryptType",6:"decryptKey",7:"timeout"},nosConfigTag:{1:"bucket",2:"cdnDomain",3:"expire",4:"objectNamePrefix"},updateTags:{1:"currentTags"}}},function(e,t,r){var n=r(473);e.exports=n},function(e,t,r){r(474);var n=r(12);e.exports=n.Object.getPrototypeOf},function(e,t,r){var n=r(2),i=r(9),o=r(33),s=r(104),a=r(170);n({target:"Object",stat:!0,forced:i((function(){s(1)})),sham:!a},{getPrototypeOf:function(e){return s(o(e))}})},function(e,t,r){e.exports=r(511)},function(e,t,r){var n=r(10),i=r(42),o=r(0),s=o.notundef,a={addFriend:1,applyFriend:2,passFriendApply:3,rejectFriendApply:4},c={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};function u(e){o.verifyOptions(e,"account","friend::Friend"),o.verifyParamAtLeastPresentOne(e,"alias custom","friend::Friend"),this.account=e.account,s(e.alias)&&(this.alias=e.alias),s(e.custom)&&(this.custom=e.custom)}u.reverse=function(e){var t=o.filterObj(e,"account alias custom createTime updateTime serverex");return s(e.flag)&&(t.valid="1"===e.flag),s(t.createTime)&&(t.createTime=+t.createTime),s(t.updateTime)&&(t.updateTime=+t.updateTime),t},u.validTypes=function(){return n(a)},u.getByteFromType=function(e){return a[e]},u.getTypeFromByte=function(e){return c[e]},u.assembleFriend=function(e){var t=+new Date;return i({},e,{alias:"",createTime:t,custom:"",updateTime:t,valid:!0})},e.exports=u},function(e,t,r){var n=r(478),i=r(42),o=r(0),s=o.notundef;function a(e,t){n(e.body)||o.onParamError("body只能是整数",t),this.body=e.body,this.from=e.from||"",this.custom=e.custom||"",s(e.pushTitle)&&(this.pushTitle=e.pushTitle),s(e.apnsText)&&(this.apnsText=e.apnsText),s(e.pushPayload)&&(this.pushPayload=e.pushPayload),s(e.needPush)&&(this.needPush=!0===e.needPush?1:0),s(e.needBadge)&&(this.needBadge=!0===e.needBadge?1:0)}a.reverse=function(e){var t=i({},e);return s(e.needBadge)&&(t.needBadge=1==+e.needBadge),s(e.needPush)&&(t.needPush=1==+e.needPush),t.body=+e.body,t.time=+e.time,t},e.exports=a},function(e,t,r){e.exports=r(529)},function(e,t,r){var n=r(478),i=r(42),o=r(0);function s(e,t){n(e.type)||o.onParamError("Collect.type只能是整数",t),o.notundef(e.uniqueId)&&(this.uniqueId=e.uniqueId),this.type=e.type,this.data=e.data||"",this.custom=e.custom||""}s.reverse=function(e){var t=i({},e);return t.type=+t.type,t.createTime=+t.createTime,t.updateTime=+t.updateTime,t},e.exports=s},function(e,t,r){var n=r(545),i=r(546),o=r(209),s=r(547);e.exports=function(e,t){return n(e)||i(e,t)||o(e,t)||s()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(482),i=r(483),o=r(484),s=r(485);function a(e,t,r){var n=e;return i(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=s(t,{uri:e}),n.callback=r,n}function c(e,t,r){return u(t=a(e,t,r))}function u(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,r=function(r,n,i){t||(t=!0,e.callback(r,n,i))};function n(){var e=void 0;if(e=l.response?l.response:l.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(l),v)try{e=JSON.parse(e)}catch(e){}return e}function i(e){return clearTimeout(d),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,r(e,y)}function s(){if(!u){var t;clearTimeout(d),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var i=y,s=null;return 0!==t?(i={body:n(),statusCode:t,method:m,headers:{},url:p,rawRequest:l},l.getAllResponseHeaders&&(i.headers=o(l.getAllResponseHeaders()))):s=new Error("Internal XMLHttpRequest Error"),r(s,i,i.body)}}var a,u,l=e.xhr||null;l||(l=e.cors||e.useXDR?new c.XDomainRequest:new c.XMLHttpRequest);var d,p=l.url=e.uri||e.url,m=l.method=e.method||"GET",f=e.body||e.data,h=l.headers=e.headers||{},g=!!e.sync,v=!1,y={body:void 0,headers:{},statusCode:0,method:m,url:p,rawRequest:l};if("json"in e&&!1!==e.json&&(v=!0,h.accept||h.Accept||(h.Accept="application/json"),"GET"!==m&&"HEAD"!==m&&(h["content-type"]||h["Content-Type"]||(h["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(s,0)},l.onload=s,l.onerror=i,l.onprogress=function(){},l.onabort=function(){u=!0},l.ontimeout=i,l.open(m,p,!g,e.username,e.password),g||(l.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(d=setTimeout((function(){if(!u){u=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",i(e)}}),e.timeout)),l.setRequestHeader)for(a in h)h.hasOwnProperty(a)&&l.setRequestHeader(a,h[a]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(f||null),l}e.exports=c,e.exports.default=c,c.XMLHttpRequest=n.XMLHttpRequest||function(){},c.XDomainRequest="withCredentials"in new c.XMLHttpRequest?c.XMLHttpRequest:n.XDomainRequest,function(e,t){for(var r=0;r<e.length;r++)t(e[r])}(["get","put","post","patch","head","delete"],(function(e){c["delete"===e?"del":e]=function(t,r,n){return(r=a(t,r,n)).method=e.toUpperCase(),u(r)}}))},function(e,t,r){(function(t){var r;r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=r}).call(this,r(48))},function(e,t){e.exports=function(e){if(!e)return!1;var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var r=Object.prototype.toString},function(e,t){var r=function(e){return e.replace(/^\s+|\s+$/g,"")};e.exports=function(e){if(!e)return{};for(var t,n={},i=r(e).split("\n"),o=0;o<i.length;o++){var s=i[o],a=s.indexOf(":"),c=r(s.slice(0,a)).toLowerCase(),u=r(s.slice(a+1));void 0===n[c]?n[c]=u:(t=n[c],"[object Array]"===Object.prototype.toString.call(t)?n[c].push(u):n[c]=[n[c],u])}return n}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},function(e,t,r){var n=r(27),i=r(119),o=r(13),s=r(11);function a(e){var t=this,r=e.url||null;t.level={debug:0,log:1,info:2,warn:3,error:4}[e.level]||0,t.logCache=[],t.logNum=1,t.timeInterval=5e3,window.onerror=function(e,r,n,i,o){t.error(o)},i((function(){t.logCache.length>0&&r&&t.postLogs(r,t.logCache)}),t.timeInterval)}a.prototype.debug=function(){var e;this.level>0||(console.debug.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[degbug]"]).call(e,arguments)))},a.prototype.log=function(){var e;this.level>1||(console.log.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[log]"]).call(e,arguments)))},a.prototype.info=function(){var e;this.level>2||(console.info.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[info]"]).call(e,arguments)))},a.prototype.warn=function(){var e;this.level>3||(console.warn.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[warn]"]).call(e,arguments)))},a.prototype.error=function(){var e;this.level>4||(console.error.apply(this,arguments),this.cacheLogs.apply(this,o(e=["[error]"]).call(e,arguments)))},a.prototype.cacheLogs=function(e,t){for(var r=[],i=0;i<t.length;i++){var o=t[i];"object"===n(o)?r.push(s(o)):r.push(o)}var a=this.logNum+++" "+e+" "+r.join("; ");this.logCache.push(a.replace("%c",""))},a.prototype.postLogs=function(e,t){var r=this,n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?(console.info("LoggerPlugin::日志上报完成"),r.logCache=[],r.timeInterval=5e3):r.timeInterval+=5e3)},n.open("POST",e),n.setRequestHeader("Content-Type","plain/text;charset=utf-8"),n.timeout=360,n.send(t.join("\n"))},e.exports=a},function(e,t,r){var n=r(4),i=r(39);e.exports=function(e){var t,r,o;e.db&&(i.db=e.db),e.rnfs&&(i.rnfs=e.rnfs,i.rnfs.size||(i.rnfs.size=1048576),i.rnfs.nimPromise=(t=i.rnfs,r=t.size/2-256,0,o=i.rnfs.DocumentDirectoryPath+"/nimlog_0.log",t.exists(o).then((function(e){return e?t.stat(o):n.reject(0)})).then((function(e){return e&&e.size>r?n.reject(1):n.reject(0)})).catch((function(e){return"number"==typeof e&&(t.nimIndex=e),n.resolve()}))))}},,,,function(e,t,r){r(201);var n=r(32);r(221)(n),e.exports=n},function(e,t,r){var n=r(4),i=r(17),o=r(3),s=r(13),a=r(213),c=r(8),u=r(19),l=r(62),d=r(147),p=r(211),m=r(493),f=r(0),h=r(214),g=r(36),v=g.newSupportDBError,y=g.noDBError,b=!1;function S(e){b=e,h.set("db",e,p)}function T(e){this.concurrency=0,this.pendingTasks=[],this.queue=n.resolve(),this.logger=e.logger,this.notifyError=e.notifyError}S(!!f.getGlobal().indexedDB),"IE"===l.name&&S(!1),"Microsoft Edge"===l.name&&S(!1),"Safari"===l.name&&S(!1);var _=T.prototype;_.reset=f.emptyFunc,b&&(_.reset=function(e){this.enable=!1!==e}),_.addTask=function(e){var t=this;return new n((function(r,n){function i(e){t.concurrency--;var r=t.pendingTasks.shift();r&&t.addTask(r),e()}if(t.concurrency<100)return t.concurrency++,e().then((function(t){i((function(){r(t),e.resolve&&e.resolve(t)}))}),(function(r){i((function(){var i=(r=r||{}).event||r,o={event:i,callFunc:r.callFunc||"db::addTask"};t.logger.error("db::error event is",i),n(o),e.reject&&e.reject(o)}))}));e.resolve||(e.resolve=r,e.reject=n),t.pendingTasks.push(e)}))},_.init=function(e){var t=this;return t.addTask((function(){return t.enable?t.server?n.resolve():(t.name="nim-"+e,p.open({server:t.name,version:m.version,schema:m.schema}).then((function(e){t.logger.info("db::init: ".concat(t.name)),t.server=e}),(function(e){throw S(!1),t.server=null,t.name=null,e}))):n.reject(v({callFunc:"db::init"}))}))},_.destroy=function(){var e=this;return e.addTask((function(){return e.enable?e.server?p.remove(e.name).then((function(){e.logger.info("db::destroy: ".concat(e.name)),e.server=null,e.name=null})):n.resolve():n.reject(v({callFunc:"db::destroy"}))}))},_.clear=function(){var e=this;return e.addTask((function(){return e.enable?e.server?e.server.clear("timetag").then((function(){var t=i([]).call(e.server.getIndexedDB().objectStoreNames),r=[];if(o(t).call(t,(function(t){r.push(e.server.clear(t))})),r.length)return n.all(r).then((function(){e.logger.info("db::clear: ".concat(e.name))})).catch((function(t){return e.logger.error("db::clear: ",t),n.reject(t)}))})):n.resolve():n.reject(v({callFunc:"db::clear"}))}))},_.close=function(){this.server&&(this.server.close(),this.server=null,this.name=null)},_.remove=function(e,t,r,n,i,o,a){var c=this;return c.addTask((function(){return c.checkDB(),c.server.remove(e,t,r,n,i,o,a).then((function(){var n;c.logger.info(s(n="db::delete: ".concat(e," ")).call(n,t||r))})).catch((function(e){c.logger.error("db::remove::server.remove error",e)}))}))},_.put=function(e,t){var r=this;return r.addTask((function(){return r.checkDB(),f.isArray(t)||(t=[t]),r.server.update(e,t).then((function(t){var n=[e],i=m.keyPath(e),s=[];return i&&(o(t).call(t,(function(e){s.push(d(e,i))})),n.push(1===s.length?s[0]:s)),n.unshift("db::put:"),"timetag"===e&&n.push(t[0]),r.logger.log.apply(r.logger.log,n),t}))}))},_.get=function(e,t){var r=this;return r.addTask((function(){return r.checkDB(),r.server.get(e,t)}))},_.modifyOrPut=function(e){var t=this,r=e.table,n=f.copy(e.obj),i=e.key,o=e.modifyObjWhenPut,s=f.copy(n);return delete s[i],t.getOne(r,null,n[i],{modifyObj:s}).then((function(e){return e?(s.idClient?s={idClient:s.idClient,server:s.server,pinFrom:s.pinFrom}:(s.lastMsg=s.lastMsg&&s.lastMsg.idServer+"_"+s.lastMsg.idClient,s.localCustom=s.localCustom&&"***",s.topCustom=s.topCustom&&"***"),t.logger.log("db::modifyOrPut: update table ".concat(r),s),e):(n=f.merge(n,o),t.put(r,n).then((function(e){return e[0]})))}))},_.updateAndDelete=function(e,t,r){var n=this;return n.addTask((function(){return n.checkDB(),n.server.updateAndDelete(e,t,r)}))},_.getAll=function(e,t){var r=this;return r.addTask((function(){var n,i,o;return r.checkDB(),(t=t||{}).keys=!0===a(t),t.desc=!0===t.desc,t.distinct=!0===t.distinct,c(n=a(i=u(o=r.server.query(e,t.index)).call(o,u(t))).call(i,a(t)).desc(t.desc).limit(t.limit).distinct(t.distinct)).call(n,t.mapper).modify(t.modifyObj).execute()}))},_.getOnly=function(e,t,r,n){var i=this;return i.addTask((function(){var o,s,l;return i.checkDB(),(n=n||{}).keys=!0===a(n),n.desc=!0===n.desc,n.distinct=!0===n.distinct,n.remove=!0===n.remove,c(o=a(s=u(l=i.server.query(e,t).only(r)).call(l,u(n))).call(s,a(n)).desc(n.desc).limit(n.limit).distinct(n.distinct)).call(o,n.mapper).modify(n.modifyObj).remove(n.remove).execute()}))},_.getOne=function(){return this.getOnly.apply(this,arguments).then((function(e){return e[0]}))},_.clearTable=function(e){var t=this;return t.addTask((function(){return t.checkDB(),t.server.clear(e)}))},_.checkDB=function(){if(!this.enable)throw v({callFunc:"db::checkDB"});if(!this.server)throw y({callFunc:"db::checkDB"})},e.exports=T},function(e,t){var r={version:12},n={kv:{key:{keyPath:"key"}},timetag:{key:{keyPath:"name"}},sessionsWithMoreRoaming:{key:{keyPath:"id"}},msgReadDetail:{key:{keyPath:"idClient"}},blacklist:{key:{keyPath:"account"}},mutelist:{key:{keyPath:"account"}},friend:{key:{keyPath:"account"}},user:{key:{keyPath:"account"}},team:{key:{keyPath:"teamId"}},teamMember:{key:{keyPath:"id"},indexes:{teamId:{unique:!1},account:{unique:!1}}},superTeam:{key:{keyPath:"teamId"}},superTeamMember:{key:{keyPath:"id"},indexes:{teamId:{unique:!1},account:{unique:!1},id:{unique:!1}}},msg:{key:{autoIncrement:!0},indexes:{idClient:{unique:!0},sessionId:{unique:!1},time:{unique:!1},type:{unique:!1},sessionType:{unique:!1},status:{unique:!1},sessionTime:{key:["sessionId","time"],unique:!1}}},msg1:{key:{keyPath:"idClient"},indexes:{sessionId:{unique:!1},time:{unique:!1},status:{unique:!1},sessionTime:{key:["sessionId","time"],unique:!1}}},msgPin:{key:{keyPath:"idClient"},indexes:{sessionId:{unique:!1}}},broadcastMsg:{key:{keyPath:"broadcastId"},indexes:{time:{unique:!1}}},sysMsg:{key:{autoIncrement:!0},indexes:{idServer:{unique:!0},category:{unique:!1},type:{unique:!1}}},sysMsgUnread:{key:{keyPath:"type"}},session:{key:{keyPath:"id"},indexes:{updateTime:{unique:!1}}}};r.keyPath=function(e){return n[e].key.keyPath},r.schema=function(){return window._nimForceSyncIM=!0,n},e.exports=r},function(e,t,r){var n=r(51).fn;n.setKey=function(e,t){return this.put("kv",{key:e,value:t})},n.getKey=function(e){return this.get("kv",e).then((function(e){return e&&e.value}))},n.setDonnop=function(e){return this.setKey("donnop",e)},n.getDonnop=function(){return this.getKey("donnop")}},function(e,t,r){var n=r(6),i=r(50),o=r(51).fn;o.getTimetags=function(e){var t={};return this.getAll("timetag",{filter:e,mapper:function(e){var r;return-1!==n(r=e.name).call(r,"team-")?t[e.name]=0:t[e.name]=e.value,e}}).then((function(){return t}))},o.getTeamMemberTimetags=function(){return this.getTimetags((function(e){var t;return-1!==n(t=e.name).call(t,"team-")}))},o.getTimetag=function(e){return this.getOne("timetag",null,e).then((function(e){return(e=e||{value:0}).value}))},o.getTeamMemberTimetag=function(){return 0},o.updateTimetag=function(e,t){var r=this,n={name:e,value:t};return this.put("timetag",n).catch((function(e){r.notifyError&&r.notifyError(e)}))},o.updateMyInfoTimetag=function(e){return this.updateTimetag("myInfo",e)},o.updateRelationTimetag=function(e){return this.updateTimetag("relations",e)},o.getRelationsTimetag=function(){return this.getTimetag("relations")},o.updateFriendTimetag=function(e){return this.updateTimetag("friends",e)},o.getFriendsTimetag=function(){return this.getTimetag("friends")},o.updateFriendUserTimetag=function(e){return this.updateTimetag("friendUsers",e)},o.updateTeamTimetag=function(e){return this.updateTimetag("teams",e)},o.getTeamsTimetag=function(){return this.getTimetag("teams")},o.updateSuperTeamTimetag=function(e){return this.updateTimetag("superTeams",e)},o.getSuperTeamsTimetag=function(){return this.getTimetag("superTeams")},o.updateTeamMemberTimetag=function(e,t){return this.updateTimetag("team-"+e,t)},o.getTeamMembersTimetag=function(e){return this.getTimetag("team-"+e)},o.updateSuperTeamMemberTimetag=function(e,t){return this.updateTimetag("superTeam-"+e,t)},o.getSuperTeamMembersTimetag=function(e){return this.getTimetag("superTeam-"+e)},o.updateMyTeamMembersTimetag=function(e){return this.updateTimetag("myTeamMembers",e)},o.getBroadcastMsgTimetag=function(){return this.getTimetag("broadcastMsg")},o.updateBroadcastMsgTimetag=function(e){return this.updateTimetag("broadcastMsg",i(e))},o.updateRoamingMsgTimetag=function(e){return this.updateTimetag("roamingMsgs",e)},o.updateSuperTeamRoamingMsgTimetag=function(e){return this.updateTimetag("superTeamRoamingMsgs",e)},o.updateMsgReceiptsTimetag=function(e){return this.updateTimetag("msgReceipts",e)},o.updateDonnopTimetag=function(e){return this.updateTimetag("donnop",e)},o.updateSessionAck=function(e){return this.updateTimetag("sessionAck",e)},o.updateDeleteMsgSelf=function(e){return this.updateTimetag("deleteMsgSelf",e)},o.updateSuperTeamSessionAck=function(e){return this.updateTimetag("superTeamSessionAck",e)},o.deleteTimetag=function(e){return this.remove("timetag",e)},o.deleteTeamMemberTimetag=function(e){return this.deleteTimetag("team-"+e)},o.deleteSuperTeamMemberTimetag=function(e){return this.deleteTimetag("superTeam-"+e)}},function(e,t,r){var n=r(4),i=r(51).fn,o=r(0);i.mergeRelations=function(e,t,r,i,o){var s=this,a=s.updateAndDelete("blacklist",e,t),c=s.updateAndDelete("mutelist",r,i);return n.all([a,c]).then((function(){return s.logger.info("db::mergeRelations: timetag ".concat(o)),s.updateRelationTimetag(o),[e,t,r,i,o]}))},i.getRelations=function(){var e=this.getAll("blacklist"),t=this.getAll("mutelist");return n.all([e,t])},i.markInBlacklist=function(e){if((e=o.copy(e)).isAdd){var t=e.record;return this.put("blacklist",t)}var r=e.account;return this.remove("blacklist",r)},i.markInMutelist=function(e){if((e=o.copy(e)).isAdd){var t=e.record;return this.put("mutelist",t)}var r=e.account;return this.remove("mutelist",r)}},function(e,t,r){var n=r(8),i=r(4),o=r(51).fn,s=r(0);o.mergeFriends=function(e,t,r){var i=this;return i.updateAndDelete("friend",e,t).then((function(){return i.logger.log("db::mergeFriends: updateAndDelete done",e&&n(e).call(e,(function(e){return e.account})).join(",")),r&&i.updateFriendTimetag(r),[e,t,r]}))},o.putFriend=function(e){return this.put("friend",e)},o.updateFriend=function(e){var t=this,r=(e=s.copy(e)).account;return this.getOne("friend",null,r,{modifyObj:e}).then((function(e){return e?t.logger.log("db::updateFriend: ".concat(r)):t.logger.warn("db::updateFriend: no record ".concat(r)),e}))},o.deleteFriend=function(e){var t=this.remove("friend",e),r=this.deleteUser(e);return i.all([t,r])},o.getFriends=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getAll("friend",{filter:function(t){return void 0!==e.updateTime?t.valid&&t.updateTime>e.updateTime:t.valid}})},o.getFriend=function(e){return this.getOne("friend",null,e)},o.getUserFromBlackList=function(e){return this.getOne("blacklist",null,e)}},function(e,t,r){var n=r(4),i=r(3),o=r(13),s=r(8),a=r(51).fn,c=r(0),u=r(36),l=r(140),d=r(117);function p(e){return e.valid&&e.validToCurrentUser}function m(e){return e&&e.valid}function f(e){return e&&c.fillUndef(e,{mute:!1,custom:""}),e}a.mergeTeams=function(e,t,r){var i=this,o=i.put("team",e),s=i.leaveTeams(t,r);return n.all([o,s]).then((function(){return i.logger.log("db::mergeTeams:"),i.updateTeamTimetag(r),[e,t,r]}))},a.putTeam=function(e){if(e)return c.isArray(e)||(e=[e]),i(e).call(e,(function(e){e.validToCurrentUser=!0})),this.put("team",e)},a.updateTeam=function(e){var t=this,r=(e=c.copy(e)).teamId;return t.getOne("team",null,r,{modifyObj:e}).then((function(n){if(n)t.logger.log("db::updateTeam: ".concat(r));else if(t.logger.warn("db::updateTeam: no record ".concat(r)),e.validToCurrentUser)return t.putTeam(e);return n}))},a.transferTeam=function(e,t,r){var n=this,i=e.teamId,s=e.memberUpdateTime,a={teamId:i,account:t,type:"normal",updateTime:s},c={teamId:i,account:r,type:"owner",updateTime:s};return n.updateTeamMembers([a,c]).then((function(){return n.putTeam(e).then((function(){var i,s;return n.logger.info(o(i=o(s="db::transferTeam: ".concat(e.teamId," ")).call(s,t," -> ")).call(i,r)),[e,t,r]}))}))},a.leaveTeam=function(e){var t=this;return t.updateTeam({teamId:e,validToCurrentUser:!1}).then((function(){return t.removeAllTeamMembers(e)}))},a.dismissTeam=function(e,t){var r=this,n={teamId:e,valid:!1,validToCurrentUser:!1,updateTime:t};return r.updateTeam(n).then((function(){return r.removeAllTeamMembers(e)}))},a.leaveTeams=function(e,t){var r,o=this,s=[];return i(e).call(e,(function(e){r=o.leaveTeam(e.teamId,t),s.push(r)})),n.all(s)},a.getTeamsByTeamIds=function(e){var t,r=this,o=[];return i(e).call(e,(function(e){t=r.getTeam(e),o.push(t)})),n.all(o)},a.getTeam=function(e){e=""+e;var t=this;return t.getOne("team",null,e).then((function(e){return e?(t.updateTeamProperties([e]),e):null}))},a.getTeams=function(){var e=this;return e.getAll("team",{filter:p}).then((function(t){return e.updateTeamProperties(t),t}))},a.updateTeamProperties=function(e){i(e).call(e,(function(e){e&&l.fillProperties(e)}))},a.mergeTeamMembers=function(e,t,r,i){var o=this,s=o.putTeamMembers(t),a=o.updateTeamMembers(r);return n.all([s,a]).then((function(){return o.logger.log("db::mergeTeamMembers: ".concat(e)),o.updateTeamMemberTimetag(e,i)}))},a.putTeamMembers=function(e){return this.put("teamMember",e)},a.getTeamMembersByAccount=function(e){return this.getOnly("teamMember","account",e,{filter:m,mapper:f}).then()},a.getTeamMembers=function(e){var t=this;return e=""+e,t.getOnly("teamMember","teamId",e,{filter:function(e){return e.valid},mapper:f}).then((function(e){return t.updateTeamMemberProperties(e).then((function(){return e}))}))},a.updateTeamMemberProperties=function(e){var t,r=this,o=[];return i(e).call(e,(function(e){d.fillProperties(e)&&(t=r.updateTeamMember(e),o.push(t))})),n.all(o)},a.getInvalidTeamMembers=function(e,t){var r=this;e=""+e;var o,s=[];return i(t).call(t,(function(t){o=r.getOne("teamMember",null,d.genId(e,t)).then((function(e){return f(e)})),s.push(o)})),n.all(s)},a.updateTeamMember=function(e){var t=this,r=e.teamId,n=e.account,i=d.genId(r,n),s=c.filterObj(e,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne("teamMember",null,i,{modifyObj:s,mapper:f}).then((function(e){var i,a;return e?t.logger.log(o(i="db::updateTeamMember: ".concat(r," ")).call(i,n),c.pickAsString(s,["muteTeam","mute","updateTime","type","valid"])):t.logger.warn(o(a="db::updateTeam: no record ".concat(r," ")).call(a,n)),e}))},a.updateTeamMembers=function(e){var t=this;if(!e.length)return n.resolve();var r,o=[];return i(e).call(e,(function(e){r=t.updateTeamMember(e),o.push(r)})),n.all(o)},a.updateTeamManagers=function(e,t,r,n){var i=s(t).call(t,(function(t){return{teamId:e,account:t,type:r?"manager":"normal",updateTime:n}}));return this.updateTeamMembers(i)},a.removeTeamMembersByAccounts=function(e,t){var r=s(t).call(t,(function(t){return{teamId:e,account:t,valid:!1}}));return this.updateTeamMembers(r)},a.removeAllTeamMembers=function(e){var t=this;return t.getOnly("teamMember","teamId",e,{modifyObj:{valid:!1}}).then((function(){return t.logger.warn("db::removeAllTeamMembers: ".concat(e)),t.deleteTeamMemberTimetag(e)}))},a.deleteTeamMembers=function(e){var t=this;return t.getOnly("teamMember","teamId",e,{remove:!0}).then((function(){t.logger.warn("db::deleteTeamMembers: ".concat(e)),t.deleteTeamMemberTimetag(e)}))},a.deleteTeam=function(e){var t,r=this,o=[];return c.isArray(e)||(e=[e]),i(e).call(e,(function(e){e=""+e,t=r.get("team",e).then((function(t){if(t&&p(t))throw u.stillInTeamError({callFunc:"team::deleteTeam",team:t});var i=r.remove("team",e),o=r.deleteTeamMembers(e);return n.all([i,o])})),o.push(t)})),1===o.length?o[0]:n.all(o)}},function(e,t,r){var n=r(4),i=r(3),o=r(5),s=r(13),a=r(8),c=r(51).fn,u=r(0),l=r(36),d=r(215),p=r(150);function m(e){return e.valid&&e.validToCurrentUser}function f(e){return e&&u.fillUndef(e,{mute:!1,custom:""}),e}c.mergeSuperTeams=function(e,t,r){var i=this,o=i.put("superTeam",e),s=i.leaveTeams(t,r);return n.all([o,s]).then((function(){return i.logger.log("db::mergeSuperTeams:"),i.updateSuperTeamTimetag(r),[e,t,r]}))},c.putSuperTeam=function(e){if(e)return u.isArray(e)||(e=[e]),i(e).call(e,(function(e){e.validToCurrentUser=!0})),this.put("superTeam",e)},c.updateSuperTeam=function(e){var t=this,r=(e=u.copy(e)).teamId;return t.getOne("superTeam",null,r,{modifyObj:e}).then((function(n){return n?(t.logger.info("db::updateSuperTeam: ".concat(r)),n):(t.logger.warn("db::updateSuperTeam: no record ".concat(r)),t.putSuperTeam(e))}))},c.leaveSuperTeam=function(e){var t=this;return t.updateSuperTeam({teamId:e,validToCurrentUser:!1}).then((function(){return t.removeAllSuperTeamMembers(e)}))},c.dismissSuperTeam=function(e,t){var r=this,n={teamId:e,valid:!1,validToCurrentUser:!1,updateTime:t};return r.updateSuperTeam(n).then((function(){return r.removeAllSuperTeamMembers(e)}))},c.leaveSuperTeams=function(e,t){var r,o=this,s=[];return i(e).call(e,(function(e){r=o.leaveSuperTeam(e.teamId,t),s.push(r)})),n.all(s)},c.getSuperTeamsByTeamIds=function(e){var t,r=this,o=[];return i(e).call(e,(function(e){t=r.getSuperTeam(e),o.push(t)})),n.all(o)},c.getSuperTeam=function(e){e=""+e;var t=this;return t.getOne("superTeam",null,e).then((function(e){return e?(t.updateSuperTeamProperties([e]),e):null}))},c.getSuperTeams=function(){var e=this;return e.getAll("superTeam",{filter:m}).then((function(t){return e.updateSuperTeamProperties(t),t}))},c.updateSuperTeamProperties=function(e){i(e).call(e,(function(e){e&&d.fillProperties(e)}))},c.mergeSuperTeamMembers=function(e,t,r,i){var o=this,s=o.putSuperTeamMembers(t),a=o.updateSuperTeamMembers(r);return n.all([s,a]).then((function(){return o.logger.log("db::mergeSuperTeamMembers: ".concat(e)),null!=i?o.updateSuperTeamMemberTimetag(e,i):n.resolve()}))},c.putSuperTeamMembers=function(e){return this.put("superTeamMember",e)},c.getSuperTeamMemberById=function(e){return this.get("superTeamMember",e)},c.getSuperTeamMembers=function(e,t){var r=this;e=""+e;var n={filter:function(e){return e.valid},mapper:f};if(t){if("number"!=typeof t.joinTime)return void r.logger.error("db::getSuperTeamMembers::params.joinTime should be number, not ",t.joinTime);t.limit&&(n.limit=t.limit),o(t)?n.filter=function(e){return e.valid&&e.joinTime<=t.joinTime}:n.filter=function(e){return e.valid&&e.joinTime>=t.joinTime}}return r.getOnly("superTeamMember","teamId",e,n).then((function(e){return r.updateSuperTeamMemberProperties(e).then((function(){return e}))}))},c.updateSuperTeamMemberProperties=function(e){var t,r=this,o=[];return i(e).call(e,(function(e){p.fillProperties(e)&&(t=r.updateSuperTeamMember(e),o.push(t))})),n.all(o)},c.getInvalidSuperTeamMembers=function(e,t){var r=this;e=""+e;var o,s=[];return i(t).call(t,(function(t){o=r.getOne("superTeamMember","id",p.genId(e,t)).then((function(e){return f(e)})),s.push(o)})),n.all(s)},c.updateSuperTeamMember=function(e){var t=this,r=e.teamId,n=e.account,i=p.genId(r,n),o=u.filterObj(e,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne("superTeamMember","id",i,{modifyObj:o,mapper:f}).then((function(e){var i,a;return e?t.logger.log(s(i="db::updateSuperTeamMember: ".concat(r," ")).call(i,n),u.pickAsString(o,["muteTeam","mute","updateTime","type","valid"])):t.logger.warn(s(a="db::updateSuperTeam: no record ".concat(r," ")).call(a,n)),e}))},c.updateSuperTeamMembers=function(e){var t=this;if(!e.length)return n.resolve();var r,o=[];return i(e).call(e,(function(e){r=t.updateSuperTeamMember(e),o.push(r)})),n.all(o)},c.removeSuperTeamMembersByAccounts=function(e,t){var r=a(t).call(t,(function(t){return{teamId:e,account:t,valid:!1}}));return this.updateSuperTeamMembers(r)},c.removeAllSuperTeamMembers=function(e){var t=this;return t.getOnly("superTeamMember","teamId",e,{modifyObj:{valid:!1}}).then((function(){return t.logger.warn("db::removeAllSuperTeamMembers: ".concat(e)),t.deleteSuperTeamMemberTimetag(e)}))},c.deleteSuperTeamMembers=function(e){var t=this;return t.getOnly("superTeamMember","teamId",e,{remove:!0}).then((function(){t.logger.warn("db::deleteSuperTeamMembers: ".concat(e)),t.deleteSuperTeamMemberTimetag(e)}))},c.deleteSuperTeam=function(e){var t,r=this,o=[];return u.isArray(e)||(e=[e]),i(e).call(e,(function(e){e=""+e,t=r.get("superTeam",e).then((function(t){if(t&&m(t))throw l.stillInTeamError({callFunc:"team::deleteTeam",team:t});var i=r.remove("superTeam",e),o=r.deleteSuperTeamMembers(e);return n.all([i,o])})),o.push(t)})),1===o.length?o[0]:n.all(o)},c.transferSuperTeam=function(e,t,r){var n=this;return n.updateSuperTeamMembers([t,r]).then((function(){return n.putSuperTeam(e).then((function(){var i,o;return n.logger.info(s(i=s(o="db::transferSuperTeam: ".concat(e.teamId," ")).call(o,t.account," -> ")).call(i,r.account)),[e,t,r]}))}))}},function(e,t,r){var n=r(3),i=r(4),o=r(6),s=r(51).fn,a=r(0);s.mergeMyInfo=function(e,t){var r=this;return r.put("user",e).then((function(){return t?r.updateMyInfoTimetag(e.updateTime):e}))},s.mergeFriendUsers=function(e,t){var r=this;return r.putUsers(e).then((function(){r.updateFriendUserTimetag(t)}))},s.putUsers=function(e){return this.put("user",e)},s.putUser=function(e){return this.put("user",e)},s.updateUser=function(e){var t=this,r=(e=a.copy(e)).account;return this.getOne("user",null,r,{modifyObj:e}).then((function(e){return e?t.logger.log("db::updateUser: ".concat(r)):t.logger.warn("db::updateUser: no record ".concat(r)),e}))},s.putUsersIfIsFriend=function(e){var t,r=this,o=[],s=[];return n(e).call(e,(function(e){t=r.getFriend(e.account).then((function(n){return n&&(t=r.putUser(e),s.push(t)),n})),o.push(t)})),i.all(o).then((function(){return i.all(s).then((function(e){return e}))}))},s.deleteUser=function(e){return this.remove("user",e)},s.getUser=function(e){return this.getOne("user",null,e)},s.getUsers=function(e){return this.getAll("user",{filter:function(t){return-1!==o(e).call(e,t.account)}})},s.getAllUsers=function(){return this.getAll("user")}},function(e,t,r){var n=r(19),i=r(4),o=r(13),s=r(3),a=r(42),c=r(30),u=r(6),l=r(8),d=r(51).fn,p=r(0),m=r(14);d.putMsg=function(e){var t=this;return p.isArray(e)||(e=[e]),!e.length||n(e[0])?i.resolve():(e=n(e).call(e,(function(e){return!e.ignore})),t.put("msg1",e).catch((function(r){return t.notifyError&&t.notifyError(r),i.resolve(e,r)})))},d.putMsgReadDetail=function(e){var t=this;if(e.idClient)return this.put("msgReadDetail",e).catch((function(e){t.logger.error("putMsgReadDetail error",e)}))},d.getMsgReadDetail=function(e){return this.getOne("msgReadDetail",null,e)},d.updateMsg=function(e){var t=this;if(!n(e)){var r=e.idClient,s=p.filterObj(e,"resend status idServer time localCustom commentTimetag comments hasSendAck");return t.getOne("msg1",null,r,{modifyObj:s}).then((function(e){var n,i,a;return e?t.logger.info(o(n=o(i=o(a="db::updateMsg: ".concat(r,"，idServer: ")).call(a,s.idServer,"，status: ")).call(i,s.status,"，time: ")).call(n,s.time)):t.logger.warn("db::updateMsg: no record ".concat(r)),e})).catch((function(r){return t.notifyError&&t.notifyError(r),i.resolve(e)}))}},d.updateMsgBatch=function(e){var t=this;if(m.isRN)this.logger.warn("react native can not support updateMsgBatch");else{this.checkDB();var r=this.server.getIndexedDB().transaction(["msg1"],"readwrite").objectStore("msg1");s(e).call(e,(function(e){if(e.idClient){var n=r.get(e.idClient);n.onerror=function(e){t.logger.error("updateMsgBatch::store.get:error",e)},n.onsuccess=function(){var i=n.result||e;r.put(a({},i,e)).onerror=function(e){t.logger.error("updateMsgBatch::store.put:error",e)}}}}))}},d.getMsgs=function(e){return m.isBrowser?this.getMsgsIndexedDB(e):m.isRN?this.getMsgsRN(e):i.resolve()},d.getMsgsRN=function(e){var t={};return"number"==typeof e.start&&(t.lowerBound=["time",e.start]),"number"==typeof e.end&&e.end!==1/0&&(t.upperBound=["time",e.end]),t.desc=!1,t.index="time","boolean"==typeof e.desc&&(t.desc=e.desc),"number"==typeof e.limit&&(t.limit=e.limit),t.searchIndex=[],e.sessionId&&t.searchIndex.push(["sessionId",e.sessionId]),"string"==typeof e.type&&t.searchIndex.push(["type",e.type]),this.getAll("msg1",t)},d.getMsgsIndexedDB=function(e){var t;this.checkDB();var r="time",i=!1,s=!1,a=(e=e||{}).sessionId||[],l=e.sessionIds||[];p.isString(a)?a=[a]:c(a)||(a=[]),p.isString(l)?l=[l]:c(l)||(l=[]);var d=o(a).call(a,l);1===d.length?(i=!0,r="sessionTime",a=d[0]):d.length>1&&(i=!0,s=!0,l=d);var m=e.start||0,f=e.end||1/0,h=m,g=f;i&&!s&&(h=[a,m],g=[a,f]);var v=!1!==e.desc,y=e.limit||100,b=!1,S=!1,T=e.type||[],_=e.types||[];p.isString(T)?T=[T]:c(T)||(T=[]),p.isString(_)?_=[_]:c(_)||(_=[]);var w=o(T).call(T,_);1===w.length?(b=!0,T=w[0]):w.length>1&&(b=!0,S=!0,_=w);var M,x=e.subTypes&&e.subTypes.length,E=e.keyword||"",C=e.filterFunc;return(s||b||E||x||p.isFunction(C))&&(M=function(t){var r;if(s&&-1===u(l).call(l,t.sessionId))return!1;if(b)if(S){if(-1===u(_).call(_,t.type))return!1}else if(T!==t.type)return!1;if(x&&-1===u(r=e.subTypes).call(r,t.subType))return!1;if(E){var n=t.text||t.tip||"";if(-1===u(n).call(n,E))return!1}return!C||C(t)}),n(t=this.server.query("msg1",r).bound(h,g,!0,!0).desc(v).limit(y)).call(t,M).execute()},d.getMsgCountAfterAck=function(e){return m.isBrowser?this.getMsgCountAfterAckIndexedDB(e):m.isRN?this.getMsgCountAfterAckRN(e):i.resolve()},d.getMsgCountAfterAckRN=function(e){var t=this,r=e=e||{},o=r.sessionId,s=r.ack;return t.checkDB(),t.getAll("msg1",{searchIndex:["sessionId",o],lowerBound:["time",s]}).then((function(r){var o=n(r).call(r,(function(r){if("out"===r.flow||!1===r.isUnreadable)return!1;if("notification"===r.type)try{return e.shouldCountNotifyUnread(r)}catch(e){throw t.logger.error("userOption:shouldCountNotifyUnread function error",e),e}return!0}));return i.resolve(o.length)}))},d.getMsgCountAfterAckIndexedDB=function(e){var t=this,r=(e=e||{}).sessionId;return t.checkDB(),t.server.query("msg1","sessionTime").bound([r,e.ack],[r,1/0],!0,!0).execute().then((function(r){var o=n(r).call(r,(function(r){if("out"===r.flow||!1===r.isUnreadable)return!1;if("notification"===r.type)try{return e.shouldCountNotifyUnread(r)}catch(e){throw t.logger.error("userOption:shouldCountNotifyUnread function error",e),e}return!0}));return i.resolve(o.length)}))},d.amendMsg=function(e){return e?(p.notexist(e.text)&&(e.text=""),e):null},d.getMsgByIdClient=function(e){var t=this;return t.getOne("msg1",null,e).then((function(e){return t.amendMsg(e)}))},d.getMsgsByIdClients=function(e){var t,r=this,n=[];return s(e).call(e,(function(e){t=r.getMsgByIdClient(e),n.push(t)})),i.all(n)},d.clearSendingMsgs=function(){var e=this;return e.getOnly("msg1","status","sending",{modifyObj:{status:"fail"}}).then((function(t){e.logger.info("db::clearSendingMsgs: msgs send failed",t&&l(t).call(t,(function(e){return e.idClient})).join(","))}))},d.deleteMsg=function(e){var t,r=this,n=[];return p.isArray(e)||(e=[e]),s(e).call(e,(function(e){t=r.getOne("msg1",null,e,{remove:!0}).then((function(t){return r.logger.info("db::deleteMsg done",e,t&&t.idClient),t})).catch((function(t){throw r.logger.error("db::deleteMsg failed",e,t),t})),n.push(t)})),1===n.length?n[0]:i.all(n)},d.deleteMsgsBySessionId=function(e){var t=this,r=null,n=e.start,i=e.end;return void 0!==n&&void 0!==i?r=function(e){return e>n&&e<i}:void 0!==n?r=function(e){return e>n}:void 0!==i&&(r=function(e){return e<i}),r?t.getOnly("msg1","sessionId",e.sessionId).then((function(e){var n=[];return l(e=e||[]).call(e,(function(e){r(e.time)&&n.push(e.idClient)})),t.logger.info("db::deleteMsgsBySessionId: session results",n),t.deleteMsg(n)})):t.getOnly("msg1","sessionId",e.sessionId,{remove:!0})},d.deleteMsgsByTime=function(e){return this.remove("msg1",null,"time",e.start,e.end,!0,!0)},d.deleteAllMsgs=function(){var e=this.clearTable("msg1"),t=this.clearTable("session");return i.all([e,t])},d.getMsgPins=function(e){return this.getOnly("msgPin","sessionId",e)},d.deleteMsgPins=function(e){return this.getOnly("msgPin","sessionId",e,{remove:!0})},d.putMsgPin=function(e){var t=this;return this.modifyOrPut({table:"msgPin",obj:e,key:"idClient"}).catch((function(e){t.notifyError&&t.notifyError(e)}))},d.putMsgPins=function(e){return this.put("msgPin",e)},d.deleteMsgPin=function(e){var t=this;return this.getOne("msgPin",null,e.idClient,{remove:!0}).then((function(e){return t.logger.info("db::deleteMsgPin:",e.idClient),e}))}},function(e,t,r){var n=r(4),i=r(19),o=r(3),s=r(5),a=r(10),c=r(51).fn,u=r(0),l=u.notundef;c.putSysMsg=function(e){var t=this;return new n((function(r){if(u.isArray(e)||(e=[e]),!i(e[0])){var n=[],s=e.length;o(e).call(e,(function(e){e=u.copy(e),t.put("sysMsg",e).then((function(e){n.push(e[0]),a()}),a)}))}function a(){0==--s&&r(n)}}))},c.getSysMsgs=function(e){var t=!s(e=e||{}),r=e.limit||100,n=null,i=null;e.category&&(n="category",i=e.category),e.type&&(n="type",i=e.type);var o,a=e.lastIdServer,c=!1,u=e.read;return(l(a)||l(u))&&(o=function(e){return l(a)?(a=""+a,c?t():(e.idServer===a&&(c=!0),!1)):t();function t(){return!l(u)||e.read===u}}),e={filter:o,desc:t,limit:r},n?this.getOnly("sysMsg",n,i,e):this.getAll("sysMsg",e)},c.getSysMsgByIdServer=function(e){return this.getOne("sysMsg","idServer",e)},c.updateSysMsg=function(e){var t=this;if(!i(e)){var r=""+e.idServer,n=u.filterObj(e,"read state error localCustom");return this.getOne("sysMsg","idServer",r,{modifyObj:n}).then((function(e){return e?t.logger.log("db::updateSysMsg: ".concat(r),u.pickAsString(n,["read","state","error"])):t.logger.warn("db::updateSession: ".concat(r)),e}))}},c.markSysMsgRead=function(e){var t=this;return new n((function(r,i){u.isArray(e)||(e=[e]);var s,a,c=[],l=[];o(e).call(e,(function(e){s=t.getSysMsgByIdServer(e.idServer).then((function(e){e&&!e.read&&(a=t.updateSysMsg({idServer:e.idServer,read:!0}),l.push(a))}),i),c.push(s)})),n.all(c).then((function(){n.all(l).then((function(e){r(e)}),i)}),i)}))},c.deleteSysMsg=function(e){var t,r=this,i=[];return u.isArray(e)||(e=[e]),o(e).call(e,(function(e){e=""+e,t=r.getOne("sysMsg","idServer",e,{remove:!0}),i.push(t)})),1===i.length?i[0]:n.all(i)},c.deleteAllSysMsgs=function(){var e=this.clearTable("sysMsg"),t=this.clearTable("sysMsgUnread");return n.all([e,t])},c.getSysMsgUnread=function(){return this.getAll("sysMsgUnread").then((function(e){var t={};return o(e).call(e,(function(e){t[e.type]=e.num})),t}))},c.updateSysMsgUnread=function(e){var t,r=this;e=u.copy(e);var n=[];return o(t=a(e)).call(t,(function(t){n.push({type:t,num:e[t]})})),this.put("sysMsgUnread",n).then((function(){return r.logger.info("db::updateSysMsgUnread: ",e),e}))}},function(e,t,r){var n=r(4),i=r(3),o=r(51).fn,s=r(0);o.putBroadcastMsg=function(e){var t=this;return new n((function(r){s.isArray(e)||(e=[e]);var n=[],o=e.length;function a(){0==--o&&r(n)}i(e).call(e,(function(e){e=s.copy(e),t.put("broadcastMsg",e).then((function(e){n.push(e[0]),a()}),a)}))}))},o.getBroadcastMsgs=function(e){return e=e||{},this.getAll("broadcastMsg",e)}},function(e,t,r){var n=r(4),i=r(5),o=r(13),s=r(30),a=r(3),c=r(51).fn,u=r(0),l=u.notundef;c.putSession=function(e){var t=this,r=e.unread;return void 0===(e=u.merge({},e)).updateTime&&e.lastMsg&&e.lastMsg.time&&(e.updateTime=e.lastMsg.time),(e.lastMsg||!e.ack&&!e.msgReceiptTime)&&(e.isDeleted=!1),delete e.unread,this.modifyOrPut({table:"session",obj:e,key:"id",modifyObjWhenPut:{unread:0}}).catch((function(i){return t.notifyError&&t.notifyError(i),e.unread=r,n.resolve(e)}))},c.getAllSessions=function(){return this.getAll("session",{index:"updateTime",desc:!0}).catch((function(e){self.notifyError&&self.notifyError(e)}))},c.getSessions=function(e){var t=!i(e=e||{}),r=e.limit||100,n=e.lastSessionId,o=e.sessionId,s=!1,a=this,c=function(){return!0},u=function(){return!0};return l(o)?this.getSession(o,e.isDeleted):(l(n)&&(c=function(e){return e.id===n&&(s=!0),s}),e.includeDeleted||(u=function(e){return!e.isDeleted}),this.getAll("session",{index:"updateTime",desc:t,limit:r,filter:function(e){return c(e)&&u(e)}}).catch((function(e){a.notifyError&&a.notifyError(e)})))},c.getSession=function(e,t){var r=this;return this.get("session",e).then((function(e){return n.resolve(!t&&e&&e.isDeleted?void 0:e)})).catch((function(e){r.notifyError&&r.notifyError(e)}))},c.updateSession=function(e){var t=this,r=e.id,n=u.filterObj(e,"ack unread lastMsg localCustom msgReceiptTime msgReceiptServerTime isTop topCustom isDeleted");return e.lastMsg&&(n.lastMsg=e.lastMsg),this.getOne("session",null,r,{modifyObj:n}).then((function(e){if(e){var i,s=o(i="db::updateSession: ".concat(r," ")).call(i,u.pickAsString(n,["ack","unread","msgReceiptTime","msgReceiptServerTime","isTop","isDeleted"]));s+=n.lastMsg?" lastMsg.idClient:".concat(u.get(n,"lastMsg.idClient")):"",t.logger.info(s)}else t.logger.warn("db::updateSession: no record ".concat(r));return e})).catch((function(e){t.notifyError&&t.notifyError(e)}))},c.getStickTopSessions=function(){var e=this;return this.getAll("session",{filter:function(e){return e&&e.isTop}}).catch((function(t){e.notifyError&&e.notifyError(t)}))},c.deleteSession=function(e){return this.remove("session",e)},c.deleteSessionLogic=function(e){var t=this;if(!s(e))return this.getOne("session",null,e,{modifyObj:{isDeleted:!0}});var r=[];return a(e).call(e,(function(e){r.push(t.getOne("session",null,e,{modifyObj:{isDeleted:!0}}))})),n.all(r)},c.putSessionsWithMoreRoaming=function(e){return this.put("sessionsWithMoreRoaming",e)},c.updateSessionsWithMoreRoaming=function(e){var t=e.id;return delete e.id,this.getOne("sessionsWithMoreRoaming",null,t,{modifyObj:e})},c.deleteSessionsWithMoreRoaming=function(e){return this.remove("sessionsWithMoreRoaming",e)},c.getSessionsWithMoreRoaming=function(e){return e?this.get("sessionsWithMoreRoaming",e):this.getAll("sessionsWithMoreRoaming")}},function(e,t,r){var n=r(13),i=r(506),o=r(507),s=r(0).throttle,a=function(){function e(t){i(this,e),this.arr=[],this.timer=null,this.maxLength=t.maxLength||100,this.throttleTime=t.throttleTime||5e3,this.processFn=t.processFn||function(){},this.throttleFn=t.processFn||function(){},t.processFn&&(this.throttleFn=s((function(e){t.processFn(e),e.length=0}),this.throttleTime,{leading:!1}))}return o(e,[{key:"add",value:function(e){var t;"[object Array]"===Object.prototype.toString.call(e)?this.arr=n(t=this.arr).call(t,e):this.arr.push(e),this.arr.length>=this.maxLength&&(this.processFn(this.arr),this.arr=[]),this.timer=this.throttleFn(this.arr)}},{key:"destroy",value:function(){this.arr=[],this.timer&&clearTimeout(this.timer),this.processFn=function(){},this.throttleFn=function(){}}},{key:"clear",value:function(){this.arr=[],this.timer&&clearTimeout(this.timer)}}]),e}();e.exports=a},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(206);function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),n(e,i.key,i)}}e.exports=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(4),i=r(26),o=r(13),s=r(19),a=r(6),c=r(17),u=r(23),l=r(3),d=r(11),p=r(50),m=r(148),f=r(116),h=r(119),g=r(224),v=r(29).fn,y=r(14),b=r(0),S=r(81);function T(e,t){var r,n,s,c=this,p=y.getDefaultLinkUrl(c.options.secure);c.socketUrls=[p],c.reporter.reportTraceUpdate("login",{operation_type:"HTTP",target:t}),c.msgStatEnable=!!e.common["msg.stat.enable"],c.msgStatEnable&&(c.msgDelayTimer=i(u(s=c.doReportMsgDelay).call(s,c),1e4)),l(r=e.common.link).call(r,(function(e){c.socketUrls.unshift(y.formatSocketUrl({url:e,secure:c.options.secure}))})),l(n=e.common["link.default"]).call(n,(function(e){var t,r;e=y.formatSocketUrl({url:e,secure:c.options.secure}),-1===a(t=c.socketUrls).call(t,e)&&(c.socketUrls=o(r=c.socketUrls).call(r,e))}));try{y.uploadUrl=e.nosup[0]}catch(e){}if(y.chunkUploadUrl=y.chunkUploadUrl||e["nos-chunk"]||"",c.logger.info("link::refreshSocketUrl: ".concat(t," ajax load , got socket urls "),c.socketUrls),y.hasLocalStorage){e.common["lbs.backup"]&&c.options.lbsBackup&&localStorage.setItem("nim_lbs_backup",d(e.common["lbs.backup"]));var m=b.get(e,"common.report.apierror.on");e.common.report&&localStorage.setItem("nim_lbs_fail_report_on",!1===m?"0":"1");var f=b.get(e,"common.report.apierror.threshold.time");f&&localStorage.setItem("nim_lbs_fail_report_time",f)}}v.probeIp=function(){var e=y.ipProbeAddr;return new n((function(t){var r=0,n=-1;function o(){2==++r&&(r=-1,t(n))}S(e.ipv4,{timeout:2e3,onerror:o,onload:function(e){n++,o()}}),S(e.ipv6,{timeout:2e3,onerror:o,onload:function(e){n+=2,o()}}),i((function(){r||-1===n||(r=-1,t(n))}),100)}))},v.refreshSocketUrl=function(){var e=this;return y.isWeixinApp?this.doRefreshSocketUrl(2):2===this.options.ipVersion?this.probeIp().then((function(t){return e.doRefreshSocketUrl(t)})):this.doRefreshSocketUrl(this.options.ipVersion)},v.doRefreshSocketUrl=function(e){var t,r,n=this.options.lbsUrl||y.lbsUrl;1!==e&&2!==e&&(e=0),y.ipVersion=e;var i=this.options.lbsBackupUrlsCustomer||[],c=[];this.options.lbsBackup&&y.hasLocalStorage&&(c=(c=localStorage.getItem("nim_lbs_backup"))?JSON.parse(c):[]);var u=o(t=o(r=[n]).call(r,c)).call(t,i);return u=s(u).call(u,(function(e,t,r){return a(r).call(r,e)===t})),E.call(this,u)},v.doRequestLbs=function(e){var t=this.options,r=y.info;return e=e+b.genUrlSep(e)+"id="+t.account+"&sv="+r.sdkVersion+"&pv="+r.protocolVersion+"&networkType="+y.ipVersion+"&k="+t.appKey,this.logger.info("doRequestLbs ".concat(c(e).call(e,0,-32))),new n((function(t,r){y.isWeixinApp?wx.request({url:e,success:function(e){var n=e&&e.statusCode,i=e&&e.data;200===n?t(i):r(i)},fail:function(e){r(e)}}):S(e,{proxyUrl:b.url2origin(e)+"/lbs/res/cors/nej_proxy_frame.html",timeout:y.xhrTimeout,onload:function(e){t(JSON.parse(e))},onerror:function(e){r(e)}})}))};var _=[],w=null;if(y.hasLocalStorage){var M=localStorage.getItem("nim_lbs_fail_report_time");M=M?p(M):6e4,w=b.throttle((function(){if(_.length>0){var e=d(_);S("https://statistic.live.126.net/statics/report/im/api/error",{method:"POST",timeout:2e3,headers:{"Content-Type":"application/json"},data:e,onload:function(){},onerror:function(){var t,r=o(t=JSON.parse(e)).call(t,_);_=m(r).call(r,(function(e,t){return f(e).call(e,(function(e){return e.request_url===t.url&&e.error_code===t.code}))||e.push(t),e}),[])}}),_=[]}}),M,{leading:!1})}function x(e,t,r){var n=(new Date).getTime(),i=t.status||10001;this.reporter.reportTraceUpdate("login",{operation_type:"HTTP",target:e},!1),f(_).call(_,(function(t){return t.request_url===e&&t.error_code===i}))||_.push({request_url:e,appkey:this.options.appKey,accid:this.options.account,timestamp:n,error_code:i,platform:"web",send_time:n-r}),y.hasLocalStorage&&"0"!==localStorage.getItem("nim_lbs_fail_report_on")&&w&&w()}function E(e){var t=this;if(!(e&&e.length>0))throw new Error("No  lbs url to try");var r=0,i=0,o=!1,s=null;t.logger.log("doRequestBackupLbsUrls: use lbs url in index ",r,e);var a=function(){var a=e[r++],c=(new Date).getTime();return t.doRequestLbs(a).then((function(e){if(s&&clearInterval(s),!1===o)return T.call(t,e,a),o=!0,n.resolve()})).catch((function(r){if(i+=1,t.logger.error("doRequestBackupLbsUrls: ".concat(a," ajax lbs error"),r),x.call(t,a,r,c),i>=e.length){t.logger.warn("doRequestBackupLbsUrls backup lbs all tried"),t.reporter.reportTraceUpdate("login",{operation_type:"HTTP",error:"no backup lbs"},!1);var o=y.getDefaultLinkUrl(t.options.secure);return t.logger.warn("doRequestBackupLbsUrls: use default socket link",o),t.socketUrls=[o],n.resolve()}return t.logger.warn("doRequestBackupLbsUrls: wait for next lbs request"),n.reject()}))};return new n((function(n,i){s=h((function(){if(!(r>=e.length))return t.hasActiveDisconnected?(s&&clearInterval(s),void i()):void a().then((function(){s&&clearInterval(s),n()})).catch((function(){}));s&&clearInterval(s)}),2e3),a().then((function(){s&&clearInterval(s),n()})).catch((function(){}))}))}v.disconnect=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this.isConnected())return this.sendCmd("logout"),void i((function(){g(v).disconnect.call(e,t)}),0);this.connecting?this.logger.warn("IMProtocolFn api disconnect:: connecting but exiting"):!0===this.hasActiveDisconnected?this.logger.warn("IMProtocolFn api disconnect:: has tried to disconnect actively"):this.logger.warn("IMProtocolFn api disconnect:: other logic entered"),g(v).disconnect.call(this,t)}},function(e,t,r){var n=r(4),i=r(11),o=r(26),s=r(23),a=r(50),c=r(6),u=r(3),l=r(19),d=r(29).fn,p=r(141),m=r(14),f=r(39),h="NIM-AllGrayscaleConfig",g="NIM-AllMixStorePolicy";function v(){var e=this;if(m.hasLocalStorage&&localStorage.getItem(h)){var t=null;try{t=JSON.parse(localStorage.getItem(h))[e.options.appKey]}catch(t){e.logger.error("appGrayConfig error",t)}t&&(e.appGrayConfig=t.timeStamp+1e3*t.ttl>(new Date).getTime()?t:null,e.appGrayConfig&&y.apply(e))}e.appGrayConfig||e.sendCmd("getGrayscaleConfig",{providers:""},(function(t,r){if(t)e.logger.error("Calculate Delay time, getGrayscaleConfig error",t);else if(r){var n=r;if(n.grayConfig=JSON.parse(n.grayConfig),n.ttl=Number(n.ttl),n.timeStamp=(new Date).getTime(),e.appGrayConfig=n,m.hasLocalStorage){var o=localStorage.getItem(h)?JSON.parse(localStorage.getItem(h)):{};o[e.options.appKey]=n,localStorage.setItem(h,i(o))}y.apply(e)}else e.logger.error("Calculate Delay time, getGrayscaleConfig error",r)}))}function y(){var e=this;if(m.hasLocalStorage&&localStorage.getItem(g)){var t=null;try{t=JSON.parse(localStorage.getItem(g))[e.options.appKey]}catch(t){e.logger.error("mixStorePolicy error",t)}t&&(e.mixStorePolicy=t.timeStamp+1e3*t.ttl>(new Date).getTime()?t:null,e.mixStorePolicy&&t.ttl&&0!==t.ttl&&(e.mixStorePolicyClock=o(s(y).call(y,e),1e3*t.ttl)))}e.mixStorePolicy||e.sendCmd("getMixStorePolicy",{providers:e.options.providers&&e.options.providers.s3?[1,2]:[1]},(function(t,r){if(t){e.logger.error("Calculate Delay time, getMixStorePolicy error",t);try{r=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[e.options.appKey]}catch(t){e.logger.error("error:","get last mixStorePolicy failed",t)}}else if(r){var n=r;if(n.ttl=Number(n.ttl),n.providers=n.providers.split(","),n.nosPolicy=n.nosPolicy?JSON.parse(n.nosPolicy):null,n.s3Policy=n.s3Policy?JSON.parse(n.s3Policy):null,n.timeStamp=(new Date).getTime(),e.mixStorePolicy=n,n.ttl&&0!==n.ttl&&(e.mixStorePolicyClock=o(s(y).call(y,e),1e3*n.ttl)),m.hasLocalStorage){var a=localStorage.getItem(g)?JSON.parse(localStorage.getItem(g)):{};a[e.options.appKey]=n,localStorage.setItem(g,i(a))}}else e.logger.error("Calculate Delay time, mixStorePolicy error",r)}))}function b(e){var t=this,r=this,n=e.error;399===n.code?(this.logger.warn("pendingLoginFailed:399, refresh LBS url and reconnecting"),r.forceDisconnect(),r.doRefreshSocketUrl(m.ipVersion).then((function(){r.reconnect()})).catch((function(){t.logger.warn("pendingLoginFailed:399, refresh LBS url failed")}))):398===n.code?(this.logger.warn("pendingLoginFailed:398 try to reconnect socket link，backoff set min 5s"),r.backoff.setMin(5e3),r.reconnect()):(this.logger.error("pendingLoginFailed: ",n.code,n),r.onAuthError(n,"link::onLogin"))}function S(e){var t=this,r=0,n=e.error,i=e.obj;t.loginResult=i,n?(t.reporter.reportTraceUpdate("login",{operation_type:"protocol",error:n},!1),t.reporter.reportTraceEnd("login",1),b.call(t,e)):(t.resetReconnectStatus(),this.heartbeatFail=0,this.hasLogin=!0,this.autoconnect=!0,t.startHeartbeat(),t.afterLogin(i),t.initOnlineListener(),r=5e3,t.reporter.reportTraceUpdate("login",{operation_type:"protocol",target:"2-2"}),t.reporter.reportTraceEnd("login",0)),!0===t.options.logReport&&o((function(){var e={appKey:t.options.appKey,sdk_ver:m.info.version,deviceId:f.deviceId};t.reporter.report("logReport",e)}),r)}d.assembleLogin=function(){var e=this.assembleIMLogin();return this.addPushInfo instanceof Function?this.addPushInfo(e):n.resolve({login:e})},d.afterLogin=function(){var e=this,t=this;t.sendCmd("getNosCdnHost",{});var r=(new Date).getTime();t.sendCmd("getServerTime",{},(function(e,n){if(e)t.logger.error("Calculate Delay time, getServerTime error",e);else if(n){var i=(new Date).getTime(),o=(i-r)/2,s=n.getTime?n.getTime():n;t.relativeSeverTime=a(i-s-o)}else t.logger.warn("Calculate Delay time, getServerTime not correct")})),v.apply(this),this.initPush instanceof Function&&this.initPush();var n=this.db;if(n.enable){var i=this.account;this.options.appendAppKeyForDBName&&(i+="-"+this.options.appKey),this.db.init(i).then((function(){e.notifyLogin(),e.syncData()}),(function(t){e.logger.warn("link::afterLogin: no db",t),n.reset(!1),e.notifyLogin(),e.syncData()}))}else this.logger.info("link::afterLogin: no db"),this.notifyLogin(),this.syncData()},d.getFileAuthToken=function(e){var t=this,r=t.mixStorePolicy.nosPolicy.authPolicy.policyType;-1!==r?c(r).call(r,e.type)<0?t.logger.error("this type Token error not support"):3!=e.type||e.urls&&e.urls.length?t.sendCmd("getBackSourceToken",{mixAuthTokenReq:e},(function(r,n){if(r)return t.logger.error("getBackSourceToken error",r),r;e.done&&e.done(n)})):t.logger.error("urls is Required when type 3"):t.logger.error("don't need token")},d.processAuth=function(e){switch(e.cmd){case"login":e.error||(e.content=e.content||{},this.loginAndroidPush&&this.loginAndroidPush(e.content.aosPushInfo||{}),e.obj=e.content.loginRes,this.connectionId=e.content.loginRes.connectionId,this.onLoginPortsChange(e,2)),S.call(this,e);break;case"kicked":return void this.onKicked(e);case"multiPortLogin":this.onLoginPortsChange(e,e.content.state);break;case"kick":e.error||(e.obj.deviceIds=e.content.deviceIds)}},d.onLoginPortsChange=function(e,t){var r=this,n=e.content.loginPorts;if(n&&n.length){var i=!0;switch(t){case 2:i=!0;break;case 3:i=!1}if(u(n).call(n,(function(e){e.type=p.reverseType(e.type),e.customClientType&&(e.customClientType=+e.customClientType),e.time=+e.time,e.online=i})),(n=l(n).call(n,(function(e){return e.connectionId!==r.connectionId}))).length){r.logger.info("link::onLoginPortsChange:",n);try{r.options.onloginportschange(n)}catch(e){throw r.logger.error("userOption:onloginportschange function error",e),e}}}},d.kickedReasons=["","samePlatformKick","serverKick","otherPlatformKick","silentlyKick"],d.kickedMessages=["","不允许同一个帐号在多个地方同时登录","被服务器踢了","被其它端踢了","悄悄被踢"]},function(e,t,r){var n=r(207),i=r(4),o=r(23),s=r(475),a=r(42),c=r(3),u=r(10),l=r(109),d=r(13),p=r(19),m=r(6),f=r(8),h=r(515),g=r(76),v=r(26),y=r(77),b=r(29).fn,S=r(0),T=r(36),_=S.undef,w=S.objs2ids,M=S.objs2accounts,x=S.teams2ids,E=r(142),C=S.getGlobal();b.beforeSync=function(){var e=this.db;return e.enable?e.clearSendingMsgs():i.resolve()},b.syncData=function(){var e=this,t=e.db,r=e.options,n=t.enable;function i(t){var i;e.syncPromiseArray=[],e.syncResult={},e.syncTeamMembersPromiseArray=[],e.syncSuperTeamMembersPromiseArray=[],e.syncTeamMembersResult={},e.checkNosReqNum=0,e.getNosOriginUrlReqNum=0,S.verifyBooleanWithDefault(r,"syncRelations syncFriends syncFriendUsers syncTeams syncSuperTeams syncRoamingMsgs syncSuperTeamRoamingMsgs syncMsgReceipts syncExtraTeamInfo",!0,"","sync::syncData"),S.verifyBooleanWithDefault(r,"syncFilter syncTeamMembers syncSuperTeamMembers",!1,"","sync::syncData");var s={};t=t||{},C._nimForceSyncIM&&(e.logger.warn("sync::syncData: nimForceSyncIM"),delete t.teams,C._nimForceSyncIM=!1),s.myInfo=t.myInfo||0,s.deleteMsgSelf=t.deleteMsgSelf||0,s.offlineMsgs=0,r.syncRelations&&(s.relations=t.relations||0),r.syncFriends&&(s.friends=t.friends||0),r.syncFriendUsers&&(s.friendUsers=t.friendUsers||0),r.syncRobots&&(s.robots=t.robots||0),r.syncTeams&&(s.teams=t.teams||0),r.syncSuperTeams&&(s.superTeams=t.superTeams||0),r.syncStickTopSessions&&(s.stickTopSessions=t.stickTopSessions||0),r.syncSessionUnread&&(s.sessionAck=n&&t.sessionAck||0,s.superTeamSessionAck=n&&t.superTeamSessionAck||0),r.syncRoamingMsgs&&(s.roamingMsgs=n&&t.roamingMsgs||t.roamingMsgs||0),r.syncSuperTeamRoamingMsgs&&(s.superTeamRoamingMsgs=n&&t.superTeamRoamingMsgs||0),r.syncMsgReceipts&&(s.msgReceipts=t.msgReceipts||0),r.syncExtraTeamInfo&&(s.myTeamMembers=t.myTeamMembers||0),r.syncBroadcastMsgs&&(s.broadcastMsgs=t.broadcastMsg||0),s.donnop=t.donnop||0,s.deleteMsg=t.deleteMsg||0,s.deleteSuperTeamMsg=t.deleteSuperTeamMsg||0,s.sessionHistoryMsgsDelete=t.sessionHistoryMsgsDelete||0,s.netcallMsgs=0,r.syncFilter&&(s.filterMsgs=0);var a=o(i=e.onSyncData).call(i,e);a.isImSyncDataCb=!0,e.logger.info("syncData:: start sync",s),e.sendCmd("sync",{sync:s,isImSyncDataObj:!0},a)}e.syncing=!0,n?e.beforeSync().then((function(){return e.db.getTimetags()})).then((function(e){i(e)}),(function(){i()})):i(e.timetags)},b.onSyncData=function(e){e&&this.syncRetryTimes>3&&(this.syncRetryTimes=0,e.callFunc="sync::onSyncData",this.onCustomError("SYNC_DATA_ERROR",e))},b.processSync=function(e){switch(this.syncRetryTimes=this.syncRetryTimes||0,this.syncRetryTimes++,e.cmd){case"syncDone":e.error?this.syncRetryTimes>3||this.syncData():(this.timetags.sync=e.content.timetag,this.onSyncDone());break;case"syncTeamMembersDone":this.onSyncTeamMembersDone()}},b.onSyncDone=function(){var e,t,r,o,b,C,R,k,A,I,O,P,N,D,L,j,U,F,$,B,V,H,W,q,z,G,J,K,Q=this,Y=Q.db,X=Y.enable,Z=Q.options,ee=Q.syncPromiseArray,te=Q.syncResult;function re(){if(ee){Q.logger.info("sync::onSyncDone: after sync",S.promises2cmds(ee)),ee=[],t=te.blacklist||[],r=te.invalidBlacklist||[],o=te.mutelist||[],b=te.invalidMutelist||[],C=te.friends,R=te.invalidFriends||[],k=te.myInfo,A=te.users,O=te.superTeams,N=te.invalidSuperTeams,I=te.teams,P=te.invalidTeams||[],D=te.sessions||{},L=s(a({},Q.sessionSet)),j=te.ackMap,te.msgReceipts,U=te.roamingMsgs,F=te.offlineMsgs,$=te.offlineFilterMsgs,V=te.offlineSysMsgs,H=te.offlineCustomSysMsgs,W=te.offlineFilterSysMsgs,q=te.offlineFilterCustomSysMsgs,z=te.sysMsgUnread,G=te.sessionsWithMoreRoaming,K=te.clearServerHistoryMsgs||[];var h=i.resolve();!function(){if(X){var e,t=[ne()];D&&c(e=u(D)).call(e,(function(e){t.push(Y.putSession(D[e]))})),h=i.all(t).then((function(){var e,t=d(e=[]).call(e,n(u(j||{})),n(u(D||{})));t=p(t).call(t,(function(e,t,r){return m(r).call(r,e)===t}));var r=[];return c(t).call(t,(function(e){var t,n=D[e];(n.lastMsg||n.ack)&&(t=(t=n.ack?i.resolve(n):Y.getSession(n.id)).then((function(t){var r=t.ack||0;return Y.getMsgCountAfterAck({shouldCountNotifyUnread:Q.options.shouldCountNotifyUnread,sessionId:e,ack:r}).then((function(r){return t.unread=r||0,D[e]=Q.mergeSession(t),Y.updateSession(t)}))})),r.push(t))})),i.all(r)})).then((function(){var e=[];return Q.saveAck.p2pTeam&&e.push(Y.updateSessionAck(Q.saveAck.p2pTeam).catch((function(e){return Q.logger.error("sessionAck::syncSessionAck::updatetimetag db",e),i.reject(e)}))),Q.saveAck.superTeam&&e.push(Y.updateSuperTeamSessionAck(Q.saveAck.superTeam).catch((function(e){return Q.logger.error("sessionAck::syncSuperTeamSessionAck::updatetimetag db",e),i.reject(e)}))),i.all(e)}))}else if(D){var r,o,s;c(r=[U,F]).call(r,(function(e){e&&c(e).call(e,(function(e){var t;(o=D[e.sessionId]).unread=o.unread||0,o.unreadMsgs=o.unreadMsgs||[],s=o.ack||0,c(t=e.msgs).call(t,(function(e){if(!(s>=e.time))if("notification"===e.type){var t;try{t=Q.options.shouldCountNotifyUnread(e)}catch(e){throw Q.logger.error("userOption:shouldCountNotifyUnread function error",e),e}t&&o.unread++}else"in"===e.flow&&!1!==e.isUnreadable&&(o.unread++,o.unreadMsgs.push(e))})),Q.mergeSession(o)}))}))}}(),h.then((function(){if(X&&!Q.hasSynced)Q.hasSynced=!0,Z.syncRelations&&(e=Y.getRelations().then((function(e){t=e[0],o=e[1],t.invalid=r,o.invalid=b})).catch((function(e){return e._msg="on relations error",Q.logger.error("sync::syncRelation: ",e),i.reject(e)})),ee.push(e)),Z.syncFriends&&(e=Y.getFriends().then((function(e){(C=e).invalid=R})).catch((function(e){return e._msg="on friends error",Q.logger.error("sync::syncFriends: ",e),i.reject(e)})),ee.push(e)),_(k)&&(e=Y.getUser(Q.account).then((function(e){k=e})).catch((function(e){return e._msg="on myInfo error",Q.logger.error("sync::syncMyInfo: ",e),i.reject(e)})),ee.push(e)),Z.syncFriendUsers&&(e=Y.getFriends().then((function(e){return f(e).call(e,(function(e){return e.account}))})).then((function(e){return Y.getUsers(e)})).then((function(e){A=e})).catch((function(e){return e._msg="on users error",Q.logger.error("sync::syncFriendUser: ",e),i.reject(e)})),ee.push(e)),Z.syncTeams&&(e=Y.getTeams().then((function(e){(I=e).invalid=P})).catch((function(e){return e._msg="on teams error",Q.logger.error("sync::syncTeams: ",e),i.reject(e)})),ee.push(e)),Z.syncSuperTeams&&(e=Y.getSuperTeams().then((function(e){(O=e).invalid=N})).catch((function(e){return e._msg="on superteams error",Q.logger.error("sync::syncSuperTeams: ",e),i.reject(e)})),ee.push(e)),e=Y.getTeamMembersByAccount(Q.account).then((function(e){Q.mergeMyTeamMembers(e)})).catch((function(e){return Q.logger.error("sync::getTeamMembersByAccount: ",e),i.reject(e)})),ee.push(e),e=Y.getDonnop().then((function(e){Q.mergeDonnop(e)})).catch((function(e){return Q.logger.error("sync::donnop: ",e),i.reject(e)})),ee.push(e),e=Y.getAllSessions().then((function(e){D=e})).catch((function(e){return Q.logger.error("sync::getSession: ",e),i.reject(e)})),ee.push(e),e=Y.getSysMsgUnread().then((function(e){z=e})).catch((function(e){return e._msg="on sysMsgUnread error",Q.logger.error("sync::getSysMsgUnread: ",e),i.reject(e)})),ee.push(e),ee.push(Y.getSessionsWithMoreRoaming().then((function(e){G=e})));else{var n,s,a=[];c(n=u(D)).call(n,(function(e){(s=D[e]).lastMsg&&a.push(s)})),D=l(a).call(a,(function(e,t){return t.updateTime-e.updateTime}))}i.all(ee).then(ie).then(oe,(function(e){Q.logger.error("taskAfterSync syncDBDataPromise error:",e),e.callFunc="sync::onSyncDone",e.message="taskAfterSync syncDBDataPromise 出错",Q.onCustomError("SYNC_SESSION_ACK_ERROR",e)}))}))}else Q.logger.warn("sync::onSyncDone: after sync --no promiseArray")}function ne(){var e=[];return U&&c(U).call(U,(function(t){var r;e=d(r=[]).call(r,n(e),n(t.msgs))})),F&&c(F).call(F,(function(t){var r;e=d(r=[]).call(r,n(e),n(t.msgs))})),e.length?Y.putMsg(e).then((function(){return e})):i.resolve(e)}function ie(){Q.logger.info("sync::onSyncDone: taskAfterSync"),function(){if(te.deleteMsgSysMsgs){var e,t={};U&&c(U).call(U,(function(e){t[e.sessionId]=e}));var r={};F&&c(F).call(F,(function(e){r[e.sessionId]=e}));var i=Q.api;if(c(e=te.deleteMsgSysMsgs).call(e,(function(e){var n;c(n=e.sysMsgs).call(n,(function(n){var o=n.msg,s=o.sessionId;"roaming"===e.type&&t[s]?t[s].msgs=i.cutMsgs(t[s].msgs,o):r[s]&&(r[s].msgs=i.cutMsgs(r[s].msgs,o))}))})),!Y.enable){var o,a=d(o=[]).call(o,n(U||[]),n(F||[]));c(a).call(a,(function(e){if(e.msgs.length){var t=Q.genSessionByMsgs(e.msgs);Q.cacheSyncedSession(t),D.unshift(t)}else{var r=h(D).call(D,(function(t){return t.id===e.sessionId}));g(D).call(D,r,1)}}));var u={};c(D).call(D,(function(e){if(u[e.id]){var t=e.lastMsg.time>u[e.id].lastMsg.time?e.lastMsg:u[e.id].lastMsg;u[e.id]=e,u[e.id].lastMsg=t}else u[e.id]=e})),D=s(u),D=l(D).call(D,(function(e,t){return t.updateTime-e.updateTime}))}}}(),J=Q.syncResult.stickTopSessions||[],c(J).call(J,(function(e,t){J[t]=Q.mergeSession(e)})),c(D).call(D,(function(e){var t=Q.sessionSet[e.id];t&&t.isTop&&(e.isTop=!0)}));var e=[Q.deleteMsgOfflineRoaming(te.deleteMsgSysMsgs,D)];return K&&c(K).call(K,(function(t){e.push(function(e,t){var r;Q.logger.info("sync::taskAfterSync:sessionHistoryMsgsDelete ".concat(e)),t=t||(new Date).getTime();var n=p(D).call(D,(function(t){return t.id===e}));r=Q.getSessionInCache(e)||n[0];var o=!1!==Z.rollbackClearMsgsUnread,s=[];return Y.enable&&s.push(Y.deleteMsgsBySessionId({sessionId:e,end:t})),o&&r&&(r.lastMsg=null,r.unread=0,r=Q.mergeSession(r),Y.enable&&s.push(Y.updateSession(r))),i.all(s)}(t.sessionId,t.time))})),i.all(e)}function oe(){v(se,0)}function se(){var e,r,n=[],s=[];if(t&&t.length){Q.logger.info("sync::notifyDataAsync: on blacklist",M(t));try{Z.onblacklist(t)}catch(e){throw Q.logger.error("userOption:onblacklist function error",e),e}}if(o&&o.length){Q.logger.info("sync::notifyDataAsync: on mutelist",M(o));try{Z.onmutelist(o)}catch(e){throw Q.logger.error("userOption:onmutelist function error",e),e}}if(C){Q.logger.info("sync::notifyDataAsync: on friends",M(C));try{Z.onfriends(C)}catch(e){throw Q.logger.error("userOption:onfriends function error",e),e}}if(k){Q.logger.info("sync::notifyDataAsync: on myInfo"),Q.myInfo=k;try{Z.onmyinfo(S.copy(k))}catch(e){throw Q.logger.error("userOption:onmyinfo function error",e),e}}if(A){c(A).call(A,(function(e){Q.mergeUser(e)})),Q.logger.info("sync::notifyDataAsync: on users",M(A));try{Z.onusers(A)}catch(e){throw Q.logger.error("userOption:onusers function error",e),e}}if(I){Q.logger.info("sync::notifyDataAsync: on teams",x(I));try{Z.onteams(I)}catch(e){throw Q.logger.error("userOption:onteams function error",e),e}}if(O){Q.logger.info("sync::notifyDataAsync: onSuperTeams",x(O));try{Z.onSuperTeams(O)}catch(e){throw Q.logger.error("userOption:onSuperTeams function error",e),e}}if(D&&D.length){D=p(D).call(D,(function(e){return Q.mergeSession(e),!e.isDeleted&&(y(E).call(E,e),!0)})),Q.logger.info("sync::notifyDataAsync: on sessions",w(D),S.secureOutput("session",D));try{!X&&Q.timetags&&Q.timetags.roamingMsgs?Z.onsessions(p(L).call(L,(function(e){return E.isComplete(e)}))):Z.onsessions(D)}catch(e){throw Q.logger.error("userOption:onsessions function error",e),e}}else if(!X&&L.length){Q.logger.info("sync::notifyDataAsync: on sessions",w(D),S.secureOutput("session",D));try{Z.onsessions(L)}catch(e){throw Q.logger.error("userOption:onsessions function error",e),e}}if(J&&J.length){c(J).call(J,(function(e){Q.mergeSession(e),y(E).call(E,e)})),Q.logger.info("sync::notifyDataAsync: onStickTopSessions",w(J),S.secureOutput("session",J));try{Z.onStickTopSessions(J)}catch(e){throw Q.logger.error("userOption:onStickTopSessions function error",e),e}}if(U&&c(U).call(U,(function(e){if("superTeam"===e.scene?s.push(e.timetag):n.push(e.timetag),(r=e.msgs).length){Q.logger.info("sync::notifyDataAsync: on roaming msgs",e.sessionId,r.length);try{Z.onroamingmsgs(e)}catch(e){throw Q.logger.error("userOption:onroamingmsgs function error",e),e}}})),F&&c(F).call(F,(function(e){if("superTeam"===e.scene?s.push(e.timetag):n.push(e.timetag),(r=e.msgs).length){Q.logger.info("sync::notifyDataAsync: on offline msgs",e.sessionId,r.length,f(r).call(r,(function(e){return e.idServer})));try{Z.onofflinemsgs(e)}catch(e){throw Q.logger.error("userOption:onofflinemsgs function error",e),e}}})),$&&c($).call($,(function(e){if(n.push(e.timetag),(r=e.msgs).length){Q.logger.info("sync::notifyDataAsync: on offline filter msgs",e.sessionId,r.length);try{Z.onofflinefiltermsgs(r)}catch(e){throw Q.logger.error("userOption:onofflinefiltermsgs function error",e),e}}})),G){Q.logger.info("sync::notifyDataAsync: on sessionsWithMoreRoaming",w(G),G);try{Z.onSessionsWithMoreRoaming(G)}catch(e){throw Q.logger.error("userOption:onSessionsWithMoreRoaming function error",e),e}}var a,u=[],l=[];if(te.deleteMsgSysMsgs&&c(a=te.deleteMsgSysMsgs).call(a,(function(e){"roaming"===e.type?u=d(u).call(u,e.sysMsgs):l=d(l).call(l,e.sysMsgs)})),u.length&&(B=d(B=B||[]).call(B,u)),l.length&&(V=d(V=V||[]).call(V,l)),B){Q.logger.info("sync::notifyDataAsync: on roaming sys msgs",B.length);try{Z.onroamingsysmsgs(B)}catch(e){throw Q.logger.error("userOption:onroamingsysmsgs function error",e),e}}if(V){Q.logger.info("sync::notifyDataAsync: on offline sys msgs",V.length);try{Z.onofflinesysmsgs(V)}catch(e){throw Q.logger.error("userOption:onofflinesysmsgs function error",e),e}}if(W){Q.logger.info("sync::notifyDataAsync: on offline filter sys msgs",W.length);try{Z.onofflinefiltersysmsgs(W)}catch(e){throw Q.logger.error("userOption:onofflinefiltersysmsgs function error",e),e}}if(H){Q.logger.info("sync::notifyDataAsync: on offline custom sys msgs",H.length);try{Z.onofflinecustomsysmsgs(H)}catch(e){throw Q.logger.error("userOption:onofflinecustomsysmsgs function error",e),e}}if(q){Q.logger.info("sync::notifyDataAsync: on offline filter custom sys msgs",q.length);try{Z.onofflinefiltercustomsysmsgs(q)}catch(e){throw Q.logger.error("userOption:onofflinefiltercustomsysmsgs function error",e),e}}if(z){z=S.merge({},Q.sysMsgUnread,z),Q.sysMsgUnread=S.merge({},z),Q.logger.info("sync::notifyDataAsync: on sysMsgUnread",z);try{Z.onsysmsgunread(z)}catch(e){throw Q.logger.error("userOption:onsysmsgunread function error",e),e}}var m=Q.getPushNotificationMultiportConfig();Q.logger.info("sync::notifyDataAsync: on pushNotificationMultiportConfig",m);try{Z.onPushNotificationMultiportConfig(m)}catch(e){throw Q.logger.error("userOption:onPushNotificationMultiportConfig function error",e),e}var h=s.length&&Math.max.apply(Math,s);if(e=n.length&&Math.max.apply(Math,n),Y.enable){var g=[];h&&g.push(Q.db.updateSuperTeamRoamingMsgTimetag(h)),e&&g.push(Q.db.updateRoamingMsgTimetag(e)),i.all(g).then(ae).catch(ae)}else Q.timetags.superTeamRoamingMsgs=h,Q.timetags.roamingMsgs=e||Q.timetags.roamingMsgs,ae();Q.syncPromiseArray=[],Q.syncResult={}}function ae(){if(Q.processUnsettledMsgs(),Q.processUnsettledSysMsgs(),Q.syncing)try{Z.onsyncdone()}catch(e){throw Q.logger&&Q.logger.error("userOption:onsyncdone function error",e),e}if(Q.syncing=!1,Z.syncTeamMembers&&I&&I.length)throw new T("sync team members api deprecated!")}ee&&ee.length?i.all(ee).then(re).catch((function(e){re(),Q.logger.error(e),e.callFunc="sync::onSyncDone",e.message="afterSync syncNormalPromise 出错",Q.onCustomError("SYNC_promiseArray_ERROR",e)})):re()},b.syncTeamMembers=function(e){var t,r,n=this;n.timetags,r={},c(e).call(e,(function(e){r[e.teamId]=0}),n),n.sendCmd("syncTeamMembers",{sync:r},o(t=n.onSyncTeamMembers).call(t,n))},b.onSyncTeamMembers=function(e){e.callFunc="sync::onSyncTeamMembers",e.message="同步群成员错误",this.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)},b.onSyncTeamMembersDone=function(){var e,t=this,r=t.db,n=t.options,o=t.syncTeamMembersResult,s=t.syncTeamMembersPromiseArray;function a(){t.logger.log("sync::onSyncTeamMembersDone: afterSync",S.promises2cmds(s)),s=[],r.enable&&!t.hasSyncedTeamMembers?(t.hasSyncedTeamMembers=!0,function(){if(!n.syncTeams||!n.syncTeamMembers)return p();r.getTeams().then((function(r){c(r).call(r,(function(r){var n=r.teamId;e=new i((function(e,r){t.api.getTeamMembers({teamId:n,done:function(t,i){t&&r({callFunc:"sync::getTeamMembers: teamId-".concat(n),message:"sync team members error"}),o[n]=i.members||[],e()}})})),s.push(e)})),s.length?i.all(s).then(l,(function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="pullFullData promiseArray notifyData 错误",t.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)})):l()}),(function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="pullFullData getTeams 错误",t.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)}))}()):l()}function l(){v(d,0)}function d(){var e,r,i;c(e=u(o)).call(e,(function(e){-1===m(e).call(e,"invalid")&&(r=o[e],i=o[e+"-invalid"]||[],r.invalid=i,function(e,r){t.logger.info("sync::onSyncTeamMembersDone: onTeamMembers",e,M(r),r);try{n.onteammembers({teamId:e,members:r})}catch(e){throw t.logger.error("userOption:onteammembers function error",e),e}}(e,r))})),p()}function p(){t.logger.info("sync::onSyncTeamMembersDone: bingo");try{n.onsyncteammembersdone()}catch(e){throw t.logger.error("userOption:onsyncteammembersdone function error",e),e}t.syncTeamMembersResult=null,t.syncTeamMembersPromiseArray=null}s.length?i.all(s).then(a,(function(e){e.callFunc="sync::onSyncTeamMembersDone",e.message="同步群成员 syncTeamMembersPromiseArray 错误",t.onCustomError("SYNC_TEAM_MEMBERS_ERROR",e)})).catch((function(e){t.logger.log("sync::onSyncTeamMembersDone: syncTeamMembersPromiseArray promise ",e),a()})):a()}},function(e,t,r){var n=r(512);e.exports=n},function(e,t,r){r(513);var n=r(12);e.exports=n.Object.values},function(e,t,r){var n=r(2),i=r(514).values;n({target:"Object",stat:!0},{values:function(e){return i(e)}})},function(e,t,r){var n=r(24),i=r(7),o=r(92),s=r(35),a=i(r(114).f),c=i([].push),u=function(e){return function(t){for(var r,i=s(t),u=o(i),l=u.length,d=0,p=[];l>d;)r=u[d++],n&&!a(i,r)||c(p,e?[r,i[r]]:i[r]);return p}};e.exports={entries:u(!0),values:u(!1)}},function(e,t,r){e.exports=r(516)},function(e,t,r){var n=r(517);e.exports=n},function(e,t,r){var n=r(16),i=r(518),o=Array.prototype;e.exports=function(e){var t=e.findIndex;return e===o||n(o,e)&&t===o.findIndex?i:t}},function(e,t,r){r(519);var n=r(22);e.exports=n("Array").findIndex},function(e,t,r){var n=r(2),i=r(78).findIndex,o=r(146),s=!0;"findIndex"in[]&&Array(1).findIndex((function(){s=!1})),n({target:"Array",proto:!0,forced:s},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("findIndex")},function(e,t,r){var n=r(8),i=r(5),o=r(4),s=r(3),a=r(29).fn,c=r(0),u=c.objs2accounts,l=r(521),d=r(151);a.processUser=function(e){var t,r=this,o=r.db,s=e.obj,a=e.error,c=e.content;switch(e.cmd){case"markInBlacklist":a||r.markInBlacklist(s);break;case"syncMarkInBlacklist":r.markInBlacklist(c,!0);break;case"markInMutelist":a||r.markInMutelist(s);break;case"syncMarkInMutelist":r.markInMutelist(c,!0);break;case"getRelations":a||r.onRelations(e);break;case"syncMyInfo":r.onMyInfo(e,!0);break;case"updateMyInfo":a||(s.user.updateTime=c.timetag,r.onUpdateMyInfo(e,s.user));break;case"syncUpdateMyInfo":r.onUpdateMyInfo(e,c.user,!0);break;case"getUsers":var u;a||(t=n(u=c.users).call(u,(function(e){return e=i(d).call(d,e,r.mixStorePolicy&&r.mixStorePolicy.s3Policy?r.mixStorePolicy.s3Policy.dlcdns:[],r.mixStorePolicy&&r.mixStorePolicy.s3Policy?r.mixStorePolicy.s3Policy.dlcdn:""),r.mergeUser(e),e})),e.obj=t,o.enable&&o.putUsers(t));break;case"updateDonnop":r.onUpdateDonnop(e);break;case"syncUpdateDonnop":r.onDonnop(e,!1)}},a.onMyInfo=function(e){var t,r=this,n=r.db,s=e.error,a=e.content,c=new o((function(e,o){var c,l;s?(s&&(s.callFunc="user::onMyInfo"),e(s),r.syncData()):(t=i(d).call(d,a.user),n.enable?(c=e,l=o,n.mergeMyInfo(t,!0).then((function(){u(),c()})).then(void 0,(function(e){e.message="db.mergeMyInfo error",e.callFunc="user::onMyInfo",l(e)}))):(u(),e()))})).catch((function(e){return r.logger.error("user::onMyInfo: ",e),o.reject(e)}));function u(){r.timetags.myInfo=t.updateTime,r.syncResult.myInfo=t}c.cmd="myInfo",r.syncPromiseArray.push(c)},a.onUpdateMyInfo=function(e,t,r){var n=this.db,o=i(d).call(d,t),s=c.merge(this.myInfo,o);if(this.myInfo=s,r){this.logger.info("user::onUpdateMyInfo:",s&&s.account);try{this.options.onupdatemyinfo(s)}catch(e){throw this.logger.error("userOption:onupdatemyinfo function error",e),e}}else e.obj=s;n.enable&&(o.account=this.account,n.updateUser(o))},a.onRelations=function(e){var t,r=this,n=r.db,i=e.error,a=r.packetFromSync(e),c=e.content.specialRelations,d=!0,p=[],m=[],f=[],h=[],g=new o((function(g,y){var b,S;i?a&&(g(i),r.syncData()):(s(c).call(c,(function(e){var t={account:(e=l.parse(e)).account,createTime:e.createTime,updateTime:e.updateTime};e.isBlacked?p.push(t):m.push(t),e.isMuted?f.push(t):h.push(t)})),r.logger.info("user::onRelations: parse blacklist",u(p),p,"delete",u(m),m),r.logger.info("user::onRelations: parse mutelist",u(f),f,"delete",u(h),h),c.length?(d=!0,t=e.content.timetag):d=!1,n.enable?(b=g,S=y,e.promise=new o((function(e,i){function o(){a?(v(),e(),b()):n.getRelations().then((function(t){p=t[0],f=t[1],v(),e(),b()})).then(void 0,(function(e){e.message="db.getRelations error",e.callFunc="user::onRelations",i(e),S(e)}))}d?n.mergeRelations(p,m,f,h,t).then((function(){o()})).then(void 0,(function(e){e.message="db.mergeRelations error",e.callFunc="user::onRelations",i(e),S(e)})):(r.logger.warn("user::onRelations: no relations need merge"),o())})).then(void 0,(function(e){throw e.message="merge relations data error",e.callFunc="user::onRelations",S(e),e}))):(v(),g()))})).catch((function(e){return r.logger.error("user::onRelations: ",e),o.reject(e)}));function v(){r.timetags.relations=t,p.invalid=m,f.invalid=h,a?(r.syncResult.blacklist=p,r.syncResult.mutelist=f,r.syncResult.invalidBlacklist=m,r.syncResult.invalidMutelist=h):(r.logger.info("user::onRelations: get relations",p,f),e.obj.blacklist=p,e.obj.mutelist=f)}a&&(g.cmd="relations",r.syncPromiseArray.push(g))},a.markInBlacklist=function(e,t){var r=this.db;if(e.record={account:e.account,updateTime:+new Date},r.enable&&r.markInBlacklist(e),t){this.logger.info("user::markInBlacklist:",e);try{this.options.onsyncmarkinblacklist(e)}catch(e){throw this.logger.error("userOption:onsyncmarkinblacklist function error",e),e}}},a.markInMutelist=function(e,t){var r=this.db;if(e.record={account:e.account,updateTime:+new Date},r.enable&&r.markInMutelist(e),t){this.logger.info("user::markInMutelist:",e);try{this.options.onsyncmarkinmutelist(e)}catch(e){throw this.logger.error("userOption:onsyncmarkinmutelist function error",e),e}}},a.mergeUser=function(e){this.userSet[e.account]=e}},function(e,t,r){var n=r(0);function i(){}i.parse=function(e){var t=n.copy(e);return t.isBlacked="1"===t.isBlacked,t.isMuted="1"===t.isMuted,t.createTime=+t.createTime,t.updateTime=+t.updateTime,t},e.exports=i},function(e,t,r){var n=r(149),i=r(3),o=r(5),s=r(4),a=r(8),c=["type"],u=r(29).fn,l=r(0),d=l.objs2accounts,p=r(476),m=r(151);u.processFriend=function(e){var t=e.obj,r=e.content,n=e.error;switch(e.cmd){case"friendRequest":this.updateFriendSysMsg(e),n||this.onFriendRequest(t);break;case"syncFriendRequest":this.onFriendRequest(r,!0);break;case"deleteFriend":n||this.onDeleteFriend(t);break;case"syncDeleteFriend":this.onDeleteFriend(r,!0);break;case"updateFriend":n||this.onUpdateFriend(t);break;case"syncUpdateFriend":this.onUpdateFriend(r.friend,!0);break;case"getFriends":this.getFriends(e);break;case"syncFriends":this.onFriends(e);break;case"syncFriendUsers":this.onFriendUsers(e)}},u.getFriends=function(e){var t=e.content.friends,r=[],n=[];i(t).call(t,(function(e){(e=o(p).call(p,e)).valid?r.push(e):n.push(e)})),r.invalid=n,e.obj=r},u.onFriends=function(e){var t,r=this,n=r.db,a=e.error,c=e.content.friends,u=!0,l=[],m=[],f=new s((function(f,g){var v,y;a?g(a):(u&&i(c).call(c,(function(e){(e=o(p).call(p,e)).valid?l.push(e):m.push(e)})),r.logger.info("friend::onFriends: parse friends",d(l),"delete",d(m)),c.length?(u=!0,t=e.content.timetag):u=!1,n.enable?(v=f,y=g,e.promise=new s((function(e,i){function o(){h(),e(),v()}u?n.mergeFriends(l,m,t).then((function(){o()})).then(void 0,(function(e){e._msg="merge friends error",i(e),y(e)})):(r.logger.info("friend::onFriends: no merge friends"),o())})).then(void 0,(function(e){throw e._msg="merge friends data error",y(e),e}))):(h(),f()))})).catch((function(e){return r.logger.error("friend::onFriends: ",e),s.reject(e)}));function h(){r.timetags.friends=t,l.invalid=m,r.syncResult.friends=l,r.syncResult.invalidFriends=m}f.cmd="friends",r.syncPromiseArray.push(f)},u.onFriendRequest=function(e,t){var r=s.resolve(),i=this.db,o=e.type,a=n(e,c);if("addFriend"===(o=e.type=p.getTypeFromByte(o)||o)||"passFriendApply"===o){var u=e.friend=p.assembleFriend(a);i.enable&&(r=i.putFriend(u))}return t&&this.onSyncFriendAction(e),r},u.onSyncFriendAction=function(e){this.logger.info("friend::onSyncFriendActionon: ".concat(e.type,", "),e.account);try{this.options.onsyncfriendaction(e)}catch(e){throw this.logger.error("userOption:onSyncFriendActionon function error",e),e}},u.onDeleteFriend=function(e,t){var r=s.resolve(),n=this.db;return n.enable&&(r=n.deleteFriend(e.account)),t&&(e.type="deleteFriend",this.onSyncFriendAction(e)),r},u.onUpdateFriend=function(e,t){var r=this.db,n=o(p).call(p,e);r.enable&&r.updateFriend(n),t&&this.onSyncFriendAction({type:"updateFriend",friend:n})},u.onFriendUsers=function(e){var t,r=this.db,n=e.content,i=a(t=n.users).call(t,(function(e){return o(m).call(m,e)}));this.logger.info("friend::onFriendUsers: parse users",d(i));var c=n.timetag,u=s.resolve();r.enable&&(u=r.mergeFriendUsers(i,c)),this.timetags.friendUsers=c,u.cmd="friendUsers",this.syncPromiseArray.push(u),this.syncResult.users=i,this.syncing||this.onSyncDone()},u.updateFriendSysMsg=function(e){var t,r,n=e.obj,i=e.error;if(e.obj.idServer){if(i)t="error",i=l.filterObj(i,"code message");else{var o=n.type;switch(o=p.getTypeFromByte(o)||o){case"passFriendApply":t="passed";break;case"rejectFriendApply":t="rejected"}}r={idServer:n.idServer,state:t,from:n.account,type:"applyFriend"},i&&(r.error=i),this.updateSysMsg(r)}}},function(e,t,r){var n=r(30),i=r(19),o=r(29).fn,s=r(0);o.onRobots=function(e){var t=e.content;if(s.isFunction(this.options.onrobots)&&n(t.robots)){var r,o=i(r=t.robots).call(r,(function(e){return!!e.botid}));o.length>0&&this.options.onrobots(o||[])}}},function(e,t,r){var n=r(5),i=r(3),o=r(26),s=r(116),a=r(4),c=r(8),u=r(19),l=r(10),d=r(29).fn,p=r(0),m=p.objs2accounts,f=p.teams2ids,h=r(140),g=r(117);d.processTeam=function(e){var t,r,i,o=e.error;switch(void 0===e.obj&&(e.obj={}),e.cmd){case"createTeam":t=e.obj.team,o||(t=e.content.team),t=n(h).call(h,t),e.obj.team=t,i=g.assembleOwner(t),e.obj.owner=i,o||(this.logger.info("team::processTeam: create team ",t&&t.teamId,i&&i.account),this.onCreateTeam(t,i));break;case"syncCreateTeam":t=n(h).call(h,e.content.team),i=g.assembleOwner(t),this.logger.info("team::processTeam: sync createTeam",t&&t.teamId,i&&i.account);try{this.options.onsynccreateteam(t,i)}catch(o){throw this.logger.error("userOption:onsynccreateteam function error",o),o}this.onCreateTeam(t,i);break;case"sendSuperTeamMsg":case"sendTeamMsg":this.onSendMsg(e);break;case"teamMsg":case"syncSendTeamMsg":this.onMsg(e);break;case"teamMsgs":this.onMsgs(e);break;case"addTeamMembers":case"removeTeamMembers":case"leaveTeam":case"dismissTeam":case"addTeamManagers":case"removeTeamManagers":case"transferTeam":case"updateMuteStateInTeam":break;case"updateInfoInTeam":o||((r=e.obj).account=this.account,r.id=g.genId(r.teamId,r.account),r=n(g).call(g,r),e.obj=r,this.mergeMyTeamMembers(r),this.onUpdateTeamMember(r));break;case"updateNickInTeam":e.obj=n(g).call(g,e.obj);break;case"updateTeam":e.obj=n(h).call(h,e.obj,!0);break;case"applyTeam":case"getTeam":e.error||(e.obj=n(h).call(h,e.content.team));break;case"passTeamApply":this.updateTeamSysMsgState(e,"passed");break;case"rejectTeamApply":case"rejectTeamInvite":this.updateTeamSysMsgState(e,"rejected");break;case"acceptTeamInvite":this.updateTeamSysMsgState(e,"passed"),e.error||(e.obj=n(h).call(h,e.content.team));break;case"getTeams":case"syncTeams":this.onTeams(e);break;case"getTeamMembers":case"syncTeamMembers":this.onTeamMembers(e);break;case"getTeamHistoryMsgs":case"searchTeamHistoryMsgs":this.onHistoryMsgs(e);break;case"notifyTeamMsgReads":this.onTeamMsgReceipt(e);break;case"syncUpdateTeamMember":r=n(g).call(g,e.content.teamMember),this.onUpdateTeamMember(r),r.account===this.account&&this.mergeMyTeamMembers(r);break;case"getMyTeamMembers":e.error||(e.obj=g.reverseMembers(e.content.teamMembers));break;case"getMutedTeamMembers":e.error||(e.obj={teamId:e.obj.teamId,members:g.reverseMembers(e.content.teamMembers)});break;case"syncMyTeamMembers":this.onSyncMyTeamMembers(e);break;case"sendTeamMsgReceipt":this.sendTeamMsgReceipt(e);break;case"getTeamMsgReads":this.getTeamMsgReads(e);break;case"getTeamMsgReadAccounts":this.getTeamMsgReadAccounts(e);break;case"getTeamsById":this.getTeamsById(e)}},d.getTeamMsgReads=function(e){var t=this;if(e.error)this.logger.error("team::sendTeamMsgReceipt: ",e.error);else{var r=p._get(e,"content.teamMsgReceipts")||[];if(this.db.enable){var n=[];i(r).call(r,(function(e){e.idClient&&n.push({idClient:e.idClient,unread:+e.unread,read:+e.read})})),n.length>0&&o((function(){return t.db.updateMsgBatch(n)}),0)}}},d.getTeamMsgReadAccounts=function(e){if(e.error)this.logger.error("team::getTeamMsgReadAccounts: ",e.error);else{var t=p._get(e,"content.readAccounts")||[],r=p._get(e,"content.unreadAccounts")||[],n=p._get(e,"content.teamMsgReceipt.idClient")||[];this.db.putMsgReadDetail({idClient:n,readAccounts:t,unreadAccounts:r})}},d.sendTeamMsgReceipt=function(e){var t=this;if(e.error)this.logger.error("team::sendTeamMsgReceipt: ",e.error);else{var r=p._get(e,"obj.teamMsgReceipts")||[],n=p._get(e,"content.teamMsgReceipts")||[];if(this.db.enable){var a=[];i(r).call(r,(function(e){s(n).call(n,(function(t){return e.idServer===t.idServer}))||a.push({idClient:e.idClient,hasRead:!0})})),a.length>0&&(this.logger.log("sendTeamMsgReceipt::updateMsgBatch"),o((function(){return t.db.updateMsgBatch(a)}),0))}}},d.onCreateTeam=function(e,t){var r=this.db;r.enable&&(r.putTeam(e),r.putTeamMembers(t));try{this.options.onCreateTeam(e,t)}catch(e){throw this.logger.error("userOption:onCreateTeam function error",e),e}},d.onTeams=function(e){e.content=e.content||{};var t,r=this,o=r.db,s=r.packetFromSync(e),c=e.content.teams||[],u=!0,l=[],d=[];if(e.error&&803===e.error.code)e.error=null,u=!1;var p=new a((function(p,f){var g,v;e.error?s&&f(e.error):(u&&i(c).call(c,(function(e){(e=n(h).call(h,e)).validToCurrentUser?l.push(e):d.push(e)})),c.length?(u=!0,t=e.content.timetag):u=!1,o.enable?(g=p,v=f,e.promise=new a((function(e,n){function i(){s?(m(),e(),g()):o.getTeams().then((function(t){l=t,m(),e(),g()})).catch((function(e){e.message="db.getTeams error",e.callFunc="team::afterMergeData",n(e),v(e)}))}u?o.mergeTeams(l,d,t).then((function(){i()})).catch((function(e){var t={callFunc:"team::onTeams:mergeData",message:"db.mergeTeams error",event:e};n(t),v(t)})):(r.logger.warn("team::onTeams:mergeData: no teams need merge"),i())})).then(void 0,(function(e){throw e.message="merge teams data error",e.callFunc="team::mergeData",v(e),e}))):(m(),p()))})).catch((function(e){return r.logger.error("team::onTeams: ",e),a.reject(e)}));function m(){r.timetags.teams=t,l.invalid=d,s?(r.syncResult.teams=l,r.syncResult.invalidTeams=d,r.syncing||r.onSyncDone()):(r.logger.info("team::onTeams: not in syncing, get teams",f(l)),e.obj=l)}s&&(p.cmd="teams",r.syncPromiseArray.push(p))},d.getTeamsById=function(e){var t;if(e.error){if(816!==e.error.code)return;this.logger.error("team::getTeamsById: ",e.error),e.error=null}e.content.teams=c(t=e.content.teams).call(t,(function(e){return n(h).call(h,e)})),e.obj=e.content},d.onTeamMembers=function(e){e.content=e.content||{};var t,r,o=this,s=o.packetFromSync(e),c=e.content.members||[],u=!0,l=[],d=[];if(e.obj&&(r=e.obj.teamId),r||(r=e.content.teamId),r=""+r,e.error&&406===e.error.code)e.error=null,u=!1;var p=new a((function(a,p){e.error?s&&(o.logger.error("team::onTeamMember: team error:",r,e.error),p({callFunc:"team::onTeamMembers",event:e.error,message:"teamId-".concat(r," 获取群成员错误")})):(u&&i(c).call(c,(function(e){(e=n(g).call(g,e)).valid?l.push(e):d.push(e)})),c.length?(u=!0,t=e.content.timetag):u=!1,l.invalid=d,s?(o.syncTeamMembersResult[r]=l,o.syncTeamMembersResult[r+"-invalid"]=d,o.timetags["team-"+r]=t):(o.logger.info("team::onTeamMembers: not syncing, get members",r,m(l)),e.obj={teamId:r,members:l}),a())}));s&&(p.cmd=r,o.syncTeamMembersPromiseArray.push(p))},d.onUpdateTeamMember=function(e){e.updateTime||(e.updateTime=+new Date),this.logger.info("team::onUpdateTeamMember: ",e&&e.account);try{this.options.onupdateteammember(p.simpleClone(e))}catch(e){throw this.logger.error("userOption:onupdateteammember function error",e),e}var t={teamId:e.teamId,memberUpdateTime:e.updateTime};this.onUpdateTeam(t);var r=this.db;r.enable&&r.updateTeamMember(e)},d.onUpdateTeam=function(e){this.logger.info("team::onUpdateTeam:",e&&e.teamId);try{this.options.onUpdateTeam(p.simpleClone(e))}catch(e){throw this.logger.error("userOption:onUpdateTeam function error",e),e}var t=this.db;t.enable&&t.updateTeam(e)},d.onSyncMyTeamMembers=function(e){var t=this,r=t.db,n=g.reverseMembers(e.content.teamMembers);if(r.enable){var i=r.putTeamMembers(n).then((function(){return r.updateMyTeamMembersTimetag(e.content.timetag)})).catch((function(e){return t.logger.error("team::syncMyTeamMember: ",e),a.reject(e)}));i.cmd="myTeamMembers",t.syncTeamMembersPromiseArray.push(i)}t.mergeMyTeamMembers(n)},d.mergeMyTeamMembers=function(e){p.isArray(e)||(e=[e]);var t=this.myTeamMembersMap=this.myTeamMembersMap||{};i(e).call(e,(function(e){var r=e.teamId;t[r]=p.merge(t[r],e)}))},d.notifyForNewTeamMsg=function(e){p.isArray(e)||(e=[e]);var t=this,r=this.myTeamMembersMap||{},n={},o=[];i(e).call(e,(function(e){p.exist(r[e])?n[e]=r[e].muteNotiType:o.push(e)}));var s=a.resolve({map:n});return o.length&&(s=t.api.getMyTeamMembers({teamIds:o,promise:!0}).then((function(r){t.mergeMyTeamMembers(r),i(r).call(r,(function(e){n[e.teamId]=e.muteNotiType}));var o=u(e).call(e,(function(e){return!n[e]}));return a.resolve({map:n,miss:o})})).catch((function(e){return l(n).length>0?a.resolve({map:n,miss:o,error:e}):a.reject(e)}))),s},d.updateTeamSysMsgState=function(e,t){var r,n=e.error;n&&(t="error",n=p.filterObj(n,"code message")),r={idServer:e.obj.idServer,state:t,from:e.obj.from,type:e.obj.type},n&&(r.error=n),this.updateSysMsg(r)},d.onTeamMsgReceipt=function(e){var t=e.content,r=e.error;if(r&&this.logger.error("team::onTeamMsgReceipt:",r),t&&t.teamMsgReceipts)try{this.options.onTeamMsgReceipt(t)}catch(r){throw this.logger.error("userOption:onTeamMsgReceipt function error",r),r}}},function(e,t,r){var n=r(5),i=r(4),o=r(3),s=r(29).fn,a=r(0),c=a.teams2ids,u=r(215),l=r(150);s.processSuperTeam=function(e){var t,r,i,o=e.error;switch(void 0===e.obj&&(e.obj={}),e.cmd){case"sendSuperTeamMsg":this.onSendMsg(e);break;case"superTeamMsg":case"syncSendSuperTeamMsg":this.onMsg(e);break;case"sendSuperTeamCustomSysMsg":this.onSendSysMsg(e);break;case"superTeamCustomSysMsg":this.onSysMsg(e);break;case"syncSuperTeams":case"getSuperTeams":this.onSuperTeams(e);break;case"syncCreateSuperTeam":t=n(u).call(u,e.content.team),i=l.assembleOwner(t),this.logger.info("team::processTeam: sync createTeam",t&&t.teamId,i&&i.account),this.options.onSyncCreateSuperTeam(t,i),this.onCreateSuperTeam(t,i);break;case"getSuperTeamHistoryMsgs":case"searchSuperTeamHistoryMsgs":this.onHistoryMsgs(e);break;case"addSuperTeamMembers":case"removeSuperTeamMembers":case"leaveSuperTeam":case"addSuperTeamManagers":case"removeSuperTeamManagers":case"transferSuperTeam":break;case"updateInfoInSuperTeam":o||((r=e.obj).account=this.account,r.id=l.genId(r.teamId,r.account),r=n(l).call(l,r),e.obj=r,this.onUpdateSuperTeamMember(r));break;case"updateNickInTeam":e.obj=n(l).call(l,e.obj);break;case"syncUpdateSuperTeamMember":r=n(l).call(l,e.content.teamMember),this.onUpdateSuperTeamMember(r);break;case"updateSuperTeam":e.obj=n(u).call(u,e.obj,!0);break;case"getSuperTeam":e.error||(e.obj=n(u).call(u,e.content.team));break;case"syncSuperTeamMembers":this.onSyncSuperTeamMembers(e);break;case"getSuperTeamMembers":e.error||this.onGetAllSuperTeamMembers(e);break;case"getSuperTeamMembersByJoinTime":case"getSuperTeamMembersByAccounts":case"getMutedSuperTeamMembers":e.error||this.onSuperTeamMembers(e);break;case"onDeleteSuperTeamMsg":this.onDeleteMsg(e);break;case"onSuperTeamMsgDelete":case"syncDeleteSuperTeamMsg":this.onMsgDeleted(e,!0);break;case"onMarkSuperTeamSessionAck":this.onMarkSessionAck(e);break;case"syncMarkSuperTeamSessionAck":this.syncMarkSessionAck(e)}},s.onSuperTeams=function(e){e.content=e.content||{};var t,r=this,s=r.db,a=r.packetFromSync(e),l=e.content.teams||[],d=!0,p=[],m=[];if(e.error&&803===e.error.code)e.error=null,d=!1;var f=new i((function(c,f){var g,v;e.error?a&&f(e.error):(d&&o(l).call(l,(function(e){(e=n(u).call(u,e)).validToCurrentUser?p.push(e):m.push(e)})),l.length?(d=!0,t=e.content.timetag):d=!1,s.enable?(g=c,v=f,e.promise=new i((function(e,n){function i(){a?(h(),e(),g()):s.getSuperTeams().then((function(t){p=t,h(),e(),g()})).then(void 0,(function(e){e.message="db.getSuperTeams error",e.callFunc="superTeam::afterMergeData",n(e),v(e)}))}d?s.mergeSuperTeams(p,m,t).then((function(){i()})).then(void 0,(function(e){var t={callFunc:"superTeam::onSuperTeams:mergeData",message:"db.mergeSuperTeams error",event:e};n(t),v(t)})):(r.logger.warn("superTeam::onSuperTeams:mergeData: no teams need merge"),i())})).then(void 0,(function(e){throw e.message="merge teams data error",e.callFunc="superTeam::mergeData",v(e),e}))):(h(),c()))})).catch((function(e){return r.logger.error("superTeam::onSuperTeams: ",e),i.reject(e)}));function h(){r.timetags.superTeams=t,p.invalid=m,a?(r.syncResult.superTeams=p,r.syncResult.invalidSuperTeams=m):(r.logger.info("superTeam::onSuperTeams: not in syncing, get teams",c(p)),e.obj=p)}a&&(f.cmd="superteams",r.syncPromiseArray.push(f))},s.onCreateSuperTeam=function(e,t){var r=this.db;r.enable&&(r.putSuperTeam(e),r.putSuperTeamMembers(t))},s.onGetAllSuperTeamMembers=function(e){var t=this,r=this.db,n=e.raw.ser,o=this.superTeamMembersData[n]||{},s=o.teamId||e.obj&&e.obj.teamId;if(r.enable){var a=e.content&&e.content.timetag,c=200===e.raw.code?i.all(o.pArr):i.resolve();e.promise=c.then((function(){return r.getSuperTeamMembers(s).then((function(t){a&&r.updateSuperTeamMemberTimetag(s,a),e.obj={members:t,invalid:[],teamId:s}}))})).catch((function(e){return t.logger.error(e)}))}else e.obj={members:o.members,invalid:o.invalid,teamId:s};this.superTeamMembersData[n]=void 0},s.onSyncSuperTeamMembers=function(e){var t,r=this.db,s=[],a=[],c=e.content.members||[],u=e.raw.ser;if(e.obj&&(t=e.obj.teamId),t||(t=e.content.teamId),o(c).call(c,(function(e){(e=n(l).call(l,e)).valid?a.push(e):s.push(e)})),r.enable){this.superTeamMembersData[u]=this.superTeamMembersData[u]||{teamId:t,pArr:[]};var d=i.resolve();e.content&&e.content.isAll&&(d=r.deleteSuperTeamMembers(t));var p=d.then((function(){return r.mergeSuperTeamMembers(t,a,s)})).then((function(){return i.resolve()}));this.superTeamMembersData[u].pArr.push(p)}else this.superTeamMembersData[u]=this.superTeamMembersData[u]||{teamId:t,members:[],invalid:[]},a.length&&(this.superTeamMembersData[u].members=this.api.mergeTeamMembers(this.superTeamMembersData[u].members,a)),s.length&&(this.superTeamMembersData[u].invalid=this.api.mergeTeamMembers(this.superTeamMembersData[u].invalid,s));e.raw=void 0},s.onSuperTeamMembers=function(e,t){var r,i=this.db,s=[],a=[],c=e.content.members||[];o(c).call(c,(function(e){(e=n(l).call(l,e)).valid?a.push(e):s.push(e)})),e.obj&&(r=e.obj.teamId),r||(r=e.content.teamId||a[0]&&a[0].teamId),i.enable&&!t&&i.mergeSuperTeamMembers(r,a,s),e.obj={members:a,invalid:s,teamId:r}},s.onUpdateSuperTeamMember=function(e){e.updateTime||(e.updateTime=+new Date),this.logger.info("superTeam::onUpdateSuperTeamMember: ",e&&e.account);try{this.options.onUpdateSuperTeamMember(a.simpleClone(e))}catch(e){throw this.logger.error("userOption:onUpdateSuperTeamMember function error",e),e}var t={teamId:e.teamId,memberUpdateTime:e.updateTime};this.onUpdateSuperTeam(t);var r=this.db;r.enable&&r.updateSuperTeamMember(e)},s.onUpdateSuperTeam=function(e){this.logger.info("superteam::onUpdateSuperTeam:",e&&e.teamId);try{this.options.onUpdateSuperTeam(a.simpleClone(e))}catch(e){throw this.logger.error("userOption:onUpdateSuperTeam function error",e),e}var t=this.db;t.enable&&t.updateSuperTeam(e)}},function(e,t,r){var n=r(5),i=r(4),o=r(26),s=r(29).fn,a=r(0),c=r(218);s.processNotify=function(e){switch(e.cmd){case"syncOfflineNetcallMsgs":case"syncOfflineMsgs":this.onOfflineMsgs(e);break;case"batchMarkRead":break;case"syncOfflineSysMsgs":case"syncOfflineSuperTeamSysMsgs":this.onOfflineSysMsgs(e);break;case"syncRoamingMsgs":case"syncSuperTeamRoamingMsgs":this.onRoamingMsgs(e);break;case"syncOfflineFilterMsgs":this.onOfflineMsgs(e,!0);break;case"syncOfflineFilterSysMsgs":this.onOfflineSysMsgs(e,!0);break;case"syncMsgReceipts":this.onOfflineMsgReceipts(e);break;case"syncDonnop":this.onDonnop(e,!0);break;case"syncSessionAck":this.syncSessionAck(e);break;case"syncSuperTeamSessionAck":this.syncSuperTeamSessionAck(e);break;case"syncRobots":this.onRobots(e);break;case"syncBroadcastMsgs":this.onBroadcastMsgs(e);break;case"syncDeleteSuperTeamMsgOfflineRoaming":this.onDeleteMsgOfflineRoaming(e);break;case"syncDeleteMsgSelf":this.syncDeleteMsgSelf(e);break;case"syncSessionsWithMoreRoaming":this.syncSessionsWithMoreRoaming(e);break;case"syncStickTopSessions":this.syncStickTopSessions(e);break;case"syncSessionHistoryMsgsDelete":this.syncSessionHistoryMsgsDelete(e)}},s.onDonnop=function(e,t){if(!e.error){var r=this,o=r.db,s=n(c).call(c,e.content.donnop);r.mergeDonnop(s);var a=r.dbDonnop();if(t){var u=e.content.timetag;r.timetags.donnop=u,o.enable&&(a=a.then((function(){return r.db.updateDonnopTimetag(u)})).catch((function(e){return r.logger.error("notify::onDonnop: ",e),i.reject(e)}))),a.cmd="donnop",r.syncPromiseArray.push(a)}else r.onPushNotificationMultiportConfigUpdate()}},s.onUpdateDonnop=function(e){if(!e.error){var t=e.obj;t&&(this.mergeDonnop(a.filterObj(t,["shouldPushNotificationWhenPCOnline"])),this.dbDonnop(),this.onPushNotificationMultiportConfigUpdate())}},s.getPushNotificationMultiportConfig=function(){return a.merge({},this.pushNotificationMultiportConfig)},s.mergeDonnop=function(e){this.pushNotificationMultiportConfig=a.merge({},this.pushNotificationMultiportConfig,e)},s.dbDonnop=function(){return this.db.enable?this.db.setDonnop(this.pushNotificationMultiportConfig):i.resolve()},s.onPushNotificationMultiportConfigUpdate=function(){var e=this;o((function(){var t=e.getPushNotificationMultiportConfig();e.logger.info("link::onPushNotificationMultiportConfigUpdate:",t);try{e.options.onPushNotificationMultiportConfigUpdate(t)}catch(t){throw e.logger.error("userOption:onPushNotificationMultiportConfigUpdate function error",t),t}}))}},function(e,t,r){var n=r(17),i=r(94),o=r(95),s=r(75),a=r(30),c=r(3),u=r(19),l=r(4),d=r(8),p=r(10),m=r(6),f=r(11),h=r(5),g=r(109),v=r(79),y=r(13),b=r(26),S=r(23),T=r(42);function _(e,t){var r=void 0!==o&&s(e)||e["@@iterator"];if(!r){if(a(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return w(e,t);var o=n(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?i(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?w(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var c=0,u=function(){};return{s:u,n:function(){return c>=e.length?{done:!0}:{done:!1,value:e[c++]}},e:function(e){throw e},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,d=!0,p=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return d=e.done,e},e:function(e){p=!0,l=e},f:function(){try{d||null==r.return||r.return()}finally{if(p)throw l}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var M=r(29).fn,x=r(0),E=x.undef,C=r(39),R=r(117),k=r(150),A=r(142),I=r(217),O=r(14),P=r(62);function N(e,t,r){var n=this,i=n.message.Message,o=r?"offlineFilterMsgs":"offlineMsgs";if(!(t&&t.length>0))return l.resolve();var s=i.getMaxTimetag(t),a=t[0].scene,c=t[0].target;n.markMsgRead(t),t=i.sortMsgs(t),t=i.deduplication(t);var u=n.genSessionByMsgs(t);n.cacheSyncedSession(u);var d=n.putMsg(t,"offlineMsgs").then((function(t){var r=t;(r=n.filterIgnore(r)).length&&(n.logger.info("msg::onOfflineMsgs： toreLastSession",o,e,r.length),n.syncResult[o]=n.syncResult[o]||[],n.syncResult[o].push({sessionId:e,scene:a,to:c,msgs:r,timetag:s}))})).catch((function(e){return n.logger.error("msg::onOfflineMsgs: ",e),l.reject(e)}));return d.cmd="offlineMsgs-"+e,d}M.processMsg=function(e){switch(e.cmd){case"sendMsg":this.onSendMsg(e);break;case"msg":case"syncSendMsg":this.onMsg(e);break;case"sysMsg":this.onSysMsg(e);break;case"broadcastMsg":this.onBroadcastMsg(e);break;case"sendCustomSysMsg":this.onSendSysMsg(e);break;case"getHistoryMsgs":case"searchHistoryMsgs":this.onHistoryMsgs(e);break;case"msgFtsInServer":case"msgFtsInServerByTiming":this.onmsgFtsInServer(e);break;case"deleteSessions":this.onDeleteSessions(e);break;case"sendMsgReceipt":this.onSendMsgReceipt(e);break;case"msgReceipt":this.onMsgReceipt(e);break;case"onDeleteMsg":this.onDeleteMsg(e);break;case"onMsgDeleted":this.onMsgDeleted(e);break;case"onDeleteMsgOfflineRoaming":this.onDeleteMsgOfflineRoaming(e);break;case"onMarkSessionAck":this.onMarkSessionAck(e);break;case"syncMarkSessionAck":this.syncMarkSessionAck(e);break;case"syncUpdateServerSession":this.onSyncUpdateServerSession(e);break;case"deleteMsgSelf":this.deleteMsgSelf(e);break;case"deleteMsgSelfBatch":this.deleteMsgSelfBatch(e);break;case"onDeleteMsgSelf":this.onDeleteMsgSelf(e);break;case"onDeleteMsgSelfBatch":this.onDeleteMsgSelfBatch(e);break;case"clearServerHistoryMsgs":this.clearServerHistoryMsgs(e);break;case"onClearServerHistoryMsgs":this.onClearServerHistoryMsgs(e)}},M.checkIgnore=function(e){var t=this;c(e).call(e,(function(e){if(!e.ignore){try{t.options.shouldIgnoreMsg(e)&&(e.ignore=!0)}catch(e){throw t.logger.error("userOption:shouldIgnoreMsg function error",e),e}var r;try{r=t.options.shouldIgnoreNotification(e)}catch(e){throw t.logger.error("userOption:shouldIgnoreNotification function error",e),e}"notification"===e.type&&r&&(e.ignore=!0)}}))},M.filterIgnore=function(e){return u(e).call(e,(function(e){return!e.ignore}))},M.genSessionByMsgs=function(e){return this.checkIgnore(e),A.genSessionByMsgs(this.message.Message,e)},M.onRoamingMsgs=function(e){var t=this,r=t.message,n=r.Message,i=n.getMaxTimetag,o=r.reverseMsgs(e.content.msgs),s=i(o);o=n.sortMsgs(o);var a=(o=n.deduplication(o))[0],c=a.sessionId,u=t.genSessionByMsgs(o);t.cacheSyncedSession(u);var d=t.putMsg(o,"roamingMsgs").then((function(e){o=e,(o=t.filterIgnore(o)).length&&(t.logger.info("msg::onRoamingMsgs: putRoamingMsgs",c,o.length),t.syncResult.roamingMsgs=t.syncResult.roamingMsgs||[],t.syncResult.roamingMsgs.push({sessionId:c,scene:a.scene,to:a.target,msgs:o,timetag:s}),t.syncing||t.onSyncDone())})).catch((function(e){return t.logger.error("msg::onRoamingMsgs: ",e),l.reject(e)}));d.cmd="roamingMsgs-"+c,t.syncPromiseArray.push(d)},M.onOfflineMsgs=function(e,t){var r,n=this,i=this.message,o=null;t&&(o={filter:!0});var s=i.reverseMsgs(e.content.msgs,{modifyObj:o}),a={};c(s).call(s,(function(e){a[e.sessionId]=a[e.sessionId]||[],a[e.sessionId].push(e)}));var u=d(r=p(a)).call(r,(function(e){return{sessionId:e,msgs:a[e]}})),l=x.asyncPool(50,u,(function(e){return N.call(n,e.sessionId,e.msgs,t)}));this.syncPromiseArray.push(l)},M.completeMsg=function(e){return e.from=this.account,e.fromNick=this.myInfo&&this.myInfo.nick,e.fromClientType="Web",e.fromDeviceId=C.deviceId,e.time||(e.time=+new Date),e},M.onMsgs=function(e){var t=this,r=t.message.reverseMsgs(e.content.msgs,{mapper:function(r){r.__receiveTime=e.__receiveTime,t.handleMsg(r)}});t.pushMsgDelay(r)},M.onMsg=function(e,t){var r;if(e.content.msg.attach){var n=null;try{n=JSON.parse(e.content.msg.attach)}catch(e){}if(!this.mixStorePolicy)try{this.mixStorePolicy=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[this.options.appKey]}catch(e){this.logger.error("error:","get last mixStorePolicy failed",e)}if(n&&n.url&&this.mixStorePolicy.s3Policy&&this.mixStorePolicy.s3Policy.dlcdns&&this.mixStorePolicy.s3Policy.dlcdns.length){var i,o=_(this.mixStorePolicy.s3Policy.dlcdns);try{for(o.s();!(i=o.n()).done;){var s,a=i.value;m(s=n.url).call(s,a)>=0&&(n.isS3=!0,a!==this.mixStorePolicy.s3Policy.dlcdn&&(n.url=n.url.replace(a,this.mixStorePolicy.s3Policy.dlcdn)))}}catch(e){o.e(e)}finally{o.f()}}e.content.msg.attach=f(n)}var c=h(r=this.message).call(r,e.content.msg);c.__receiveTime=e.__receiveTime,t&&(c.filter=!0),"syncSendMsg"!==e.cmd||c.from!==c.to?(this.pushMsgDelay([c]),this.syncing?(this.logger.info("msg::onMsg:is in syncing ..."),this.unhandledMsgs.push({type:"onMsg",msg:c})):this.handleMsg(c)):this.logger.warn("onMsg::syncSendMsg to self, so ignore",c.idClient,c.idServer)},M.onBroadcastMsgs=function(e){var t=e.content.broadcastMsgs;t=g(t).call(t,(function(e,t){return e.broadcastId-t.broadcastId})),this.putBroadcastMsgs(t)},M.onBroadcastMsg=function(e){var t=e.content.broadcastMsg;t.time=t.timestamp,this.syncing?this.unhandledMsgs.push({type:"onBroadcastMsg",msg:t}):t&&this.putBroadcastMsg(t)},M.pushMsgTask=function(e){this.msgPromise=this.msgPromise.then((function(){return e()}))},M.pushMsgDelay=function(e){if(e&&e.length>0){var t=this;if(t.msgStatEnable&&!O.isWeixinApp&&void 0!==t.relativeSeverTime){var r,n=d(e).call(e,(function(e){return{appkey:t.options.appKey,accid:e.to,fromAccid:e.from,msgId:e.idServer,serverTime:e.time,receiveTime:v()-t.relativeSeverTime,sessionId:t.sdkSession,platform:"web",sdk_ver:O.info.version,manufactor:P.name+" "+P.version}}));t.msgDelayArr=y(r=t.msgDelayArr).call(r,n),t.msgDelayArr.length>5&&t.doReportMsgDelay()}}},M.doReportMsgDelay=function(){var e,t=f(this.msgDelayArr);this.msgDelayArr&&this.msgDelayArr.length>0&&(I.sendBeacon("https://statistic.live.126.net/statics/report/im/sdk/msgreceived",t),this.msgDelayArr=[]),this.msgDelayTimer&&clearTimeout(this.msgDelayTimer),this.socket&&(this.msgDelayTimer=b(S(e=this.doReportMsgDelay).call(e,this),1e4))},M.handleMsg=function(e){var t=this,r=t.db,n=e.time,i=v(),o=e.__receiveTime;delete e.__receiveTime,t.markMsgRead(e),t.msgPromise=t.msgPromise.then((function(){return t.putMsg(e,"onMsg")})).then((function(){var i;return t.logger.info(y(i="msg::handleMsg:putMsg: done ".concat(e.idServer," ")).call(i,e.idClient)),r.enable?"superTeam"===e.scene?r.updateSuperTeamRoamingMsgTimetag(n):r.updateRoamingMsgTimetag(n):(t.timetags["superTeam"===e.scene?"superTeamRoamingMsgs":"roamingMsgs"]=n,l.resolve())})).then((function(){if(e)return t.checkUserUpdate(e)})).then((function(){if(e){var r=e.type;if("notification"===(t.logger.info("msg::handleMsg:checkUserUpdate: "+e.scene+" "+r+" msg"+("notification"===r?" "+e.attach.type:"")),r))return t.onTeamNotificationMsg(e)}})).then((function(){e&&!e.ignore&&(t.logger.info("msg::handleMsg:onmsg: ",e.idClient,e.idServer),b((function(){try{t.options.onmsg(x.copy(e));var r=t.relativeSeverTime||0,n="p2p"===e.scene;if(O.isBrowser&&"out"!==e.flow){var s={msgId:e.idServer,clientId:e.idClient,receiveTime:o,serverTime:e.time,callbackTime:v(),preHandleTime:i,fromAccid:e.from,toAccid:t.options.account,type:t.message.sceneMap[e.scene],tid:n?"":e.to,result:200,failReason:"",rt:v()-r-e.time};t.reporter&&t.reporter.report("msgReceive",s,!0)}}catch(e){throw t.logger.error("userOption:onmsg function error",e),e}}),0))})).catch((function(e){e.callFunc="msg::handleMsg",t.onCustomError("消息处理错误",e)}))},M.putMsg=function(e,t){if(x.isArray(e)||(e=[e]),u(e[0]))return l.resolve(e);var r,n=this,i=n.db,o=i.enable,s=l.resolve(),a=n.message.Message.getLastMsg(e),p=a.flow,m=n.genSessionByMsgs(e);h(m);var f=[];function h(e){"roamingMsgs"!==t&&"offlineMsgs"!==t||n.cacheSyncedSession(e)}return s=(s=(s=s.then((function(){var r;return o||n.options.autoMarkRead||"roamingMsgs"===t||!m||(n.sessionUnreadMsgs=n.sessionUnreadMsgs||{},n.sessionUnreadMsgs[m.id]=n.sessionUnreadMsgs[m.id]||[],n.sessionUnreadMsgs[m.id]=y(r=n.sessionUnreadMsgs[m.id]).call(r,u(e).call(e,(function(e){try{return n.options.shouldCountNotifyUnread(e)}catch(e){throw n.logger.error("userOption:shouldCountNotifyUnread function error",e),e}})))),"offlineMsgs"===t||"roamingMsgs"===t?l.reject(e):o?i.putMsg(e):e})).then((function(t){var r=[];return c(e).call(e,(function(e){n.checkMsgUnique(e)&&r.push(e)})),e=r,f=o?t:e,l.resolve(e)}))).then((function(e){return e.length&&o&&m?new l((function(t){i.getSessions({sessionId:m.id}).then((function(r){if(r&&r.lastMsg){var n=r.lastMsg;m.lastMsg&&m.lastMsg.time<n.time&&(m.lastMsg=n)}f&&f.length?m?i.putSession(m).then((function(e){t(e)})):t(r):(f=e,t(r))}))})):l.resolve(m)}))).then((function(e){if(m&&f.length){r=a.sessionId!==n.currSessionId;var s="roamingMsgs"===t,u=n.options.syncSessionUnread,l=m.id,g=n.getSessionInCache(l,!0)||{},v=g.ack||0;if("offlineMsgs"===t||s&&u||"onMsg"===t&&"in"===p&&r){var y;if(o&&e){var b=g.unread||0;(m=e).unread=b,v=v||m.ack||0}else(e=g)&&(m.unread=e.unread||0);h(m),m.unread=m.unread||0;var S=0;c(f).call(f,(function(e){var t;try{t=n.options.shouldCountNotifyUnread(e)}catch(e){throw n.logger.error("userOption:shouldCountNotifyUnread function error",e),e}var r=("notification"!==e.type||"notification"===e.type&&t)&&(E(e.isUnreadable)||e.isUnreadable);if(r&&u&&(r=e.time>v&&"out"!==e.flow),r&&(S++,u&&!o)){var i=g.unreadMsgs||[];i.push(e),m.unreadMsgs=i}})),m.unread+=S;var T=x.secureOutput("session",m);if(T.unreadMsgs&&(T.unreadMsgs=d(y=T.unreadMsgs).call(y,(function(e){return e&&e.idServer}))),n.logger.info("msg::putMsg:updateSession: ",T),h(m),o)return i.updateSession({id:m.id,unread:m.unread})}}})),"onMsg"===t&&(s=s.then((function(){e.length&&m&&(n.onUpdateSession(m),n.options.syncSessionUnread&&!r&&n.api.resetSessionUnread(n.currSessionId))}))),s.then((function(){return l.resolve(e)})).catch((function(e){return e&&e.length?l.resolve(e):l.reject(e)}))},M.putBroadcastMsgs=function(e){var t=this,r=t.db,n=e.length;if(n>0){if(t.doMarkBroadcastMsgsRead(e),r.enable){var i=e[n-1].broadcastId;return r.updateBroadcastMsgTimetag(i),r.putBroadcastMsg(e).then((function(){return b((function(){t.doMarkMsgsRead();try{t.options.onbroadcastmsgs(x.copy(e))}catch(e){throw t.logger.error("userOption:onbroadcastmsgs function error",e),e}}),0),l.resolve(e)}))}b((function(){try{t.options.onbroadcastmsgs(x.copy(e))}catch(e){throw t.logger.error("userOption:onbroadcastmsgs function error",e),e}}),0)}return e},M.putBroadcastMsg=function(e){var t=this,r=t.db;return t.doMarkBroadcastMsgsRead([e]),r.enable?(e.broadcastId&&r.updateBroadcastMsgTimetag(e.broadcastId),r.putBroadcastMsg(e).then((function(){return b((function(){try{t.options.onbroadcastmsg(x.copy(e))}catch(e){throw t.logger.error("userOption:onbroadcastmsg function error",e),e}}),0),l.resolve(e)}))):(b((function(){try{t.options.onbroadcastmsg(x.copy(e))}catch(e){throw t.logger.error("userOption:onbroadcastmsg function error",e),e}}),0),e)},M.doMarkBroadcastMsgsRead=function(e){e=d(e).call(e,(function(e){return e.broadcastId})),this.sendCmd("batchMarkRead",{sid:7,cid:17,ids:e})},M.cacheSyncedSession=function(e){if(e&&this.syncResult){e=T({},e),this.syncResult.sessions=this.syncResult.sessions||{};var t=e.id,r=this.syncResult.sessions[t]||{};r&&r.ack<e.ack&&(e.ack=void 0),r&&r.msgReceiptTime<e.msgReceiptTime&&(e.msgReceiptTime=void 0);var n=x.get(r,"lastMsg.time"),i=x.get(e,"lastMsg.time");n&&i&&n>i&&(e.lastMsg=r.lastMsg),this.syncResult.sessions[t]=T(r,e),this.syncResult.sessions[t]=T({},this.mergeSession(this.syncResult.sessions[t]))}},M.checkMsgUnique=x.genCheckUniqueFunc("idClient"),M.revokeMsgUniqueCheck=function(e){this.uniqueSet&&this.uniqueSet.idClient&&(this.uniqueSet.idClient[e]=!1)},M.storeSendMsg=function(e){if(!this.syncing){var t=this.putMsg(e,"sendMsg");return this.msgPromise=this.msgPromise.then((function(){return t})),t}this.unhandledMsgs.push({type:"sendMsg",msg:e})},M.updateSendMsgError=function(e){if(!this.syncing){var t=this.updateMsg(e);return this.msgPromise=this.msgPromise.then((function(){return t})),t}this.unupdatedMsgs.push(e)},M.onSendMsg=function(e,t){var r,n,i=this,o=e.content&&e.content.msg,s=e.obj&&e.obj.msg||o;if(s)if(this.logger.warn(y(r=y(n="sendMsg::end: ".concat(o&&o.idServer," ")).call(n,s.idClient," ")).call(r,e&&e.raw&&e.raw.ser)),e.obj)c();else{var a=i.db;a&&a.enable&&a.getMsgByIdClient(s.idClient).then((function(e){e&&(s=e,c())})).catch((function(){return c()}))}else this.logger.error("sendMsg::error::get msg failed, msg empty");function c(){var r;i.completeMsg(s);var n=e.error&&7101===e.error.code;e.error&&!n||(s.idServer=o.idServer,s.time=+o.time,o.yidunAntiSpamRes&&(s.yidunAntiSpamRes=o.yidunAntiSpamRes),o.callbackExt&&(s.callbackExt=o.callbackExt)),n&&(s.isInBlackList=!0),e.error?s.status="fail":s.status="success",s=h(r=i.message).call(r,s),t&&(s.filter=!0),e.obj=s,i.syncing?i.unupdatedMsgs.push(s):i.msgPromise=l.all([i.msgPromise,e.obj.promise]).then((function(e){return e.length||(s.resend=!0),i.updateMsg(s).then((function(){return i.options.syncSessionUnread&&i.currSessionId===s.sessionId&&i.api.resetSessionUnread(i.currSessionId),i.resolveMsgReceiptTask(s),s}))})).catch((function(e){i.logger.error("onSendMsg::dealMsg error",e)}))}},M.updateLocalMsg=function(e){var t=this.updateMsg(e);return this.msgPromise=this.msgPromise.then((function(){return t})),t},M.updateMsg=function(e){if(u(e)||this.options.shouldIgnoreMsg(e))return l.resolve(e);var t=this,r=t.db,n="success"===e.status,i=A.genSessionByMsg(e),o=!!e.isLocal;return t.onUpdateSession(i),r.enable?r.updateMsg(e).then((function(t){var s=r.updateSession(i),a=l.resolve();return n&&t&&!o&&(a="superTeam"===e.scene?r.updateSuperTeamRoamingMsgTimetag(t.time):r.updateRoamingMsgTimetag(t.time)),l.all([s,a])})).catch((function(e){t.logger.error("updateMsg error",e)})):(n&&!o&&(t.timetags.roamingMsgs=e.time),l.resolve(e))},M.updateRoamingMsgTimetag=function(e){var t=this.db;return t.enable?t.updateRoamingMsgTimetag(e):(this.timetags.roamingMsgs=e,l.resolve(e))},M.checkUserUpdate=function(e){var t=this,r=e.from;return t.logger.info("handleMsg::checkUserUpdate: ",r,t.account),r===t.account?l.resolve():new l((function(n){var i=t.userSet[r];if(i){var o=+i.updateTime,s=+e.userUpdateTime;!isNaN(o)&&!isNaN(s)&&x.isNumber(o)&&x.isNumber(s)&&o<s?a():n()}else a();function a(){t.api.getUser({account:r,sync:!0,done:function(e,r){e||b((function(){t.logger.log("user::checkUserUpdate: onupdateuser",r&&r.account);try{t.options.onupdateuser(r)}catch(e){throw t.logger.error("userOption:onupdateuser function error",e),e}}),0),n()}})}}))},M.processUnsettledMsgs=function(){var e,t,r=this;c(e=r.unhandledMsgs).call(e,(function(e){var t=e.msg;switch(e.type){case"onMsg":r.handleMsg(t);break;case"sendMsg":r.msgPromise=r.msgPromise.then((function(){return r.putMsg(t)}));break;case"onBroadcastMsg":r.msgPromise=r.msgPromise.then((function(){return r.putBroadcastMsg(t)}))}})),c(t=r.unupdatedMsgs).call(t,(function(e){r.msgPromise=r.msgPromise.then((function(){return r.updateMsg(e)}))})),r.resetUnsettledMsgs()},M.onTeamNotificationMsg=function(e){var t=e.attach,r=t.type,n=e.from,i=e.to,o=e.time,s=t.team,a=t.account,c=t.accounts;switch(r){case"updateTeam":return s.updateTime=o,this.onUpdateTeam(s);case"addTeamMembers":return this.onAddTeamMembers(e,s,c);case"removeTeamMembers":return this.onRemoveTeamMembers(s,i,c);case"acceptTeamInvite":return this.onAddTeamMembers(e,s,[n]);case"passTeamApply":return this.onAddTeamMembers(e,s,[a]);case"addTeamManagers":return this.updateTeamManagers(e,i,c,!0,o);case"removeTeamManagers":return this.updateTeamManagers(e,i,c,!1,o);case"leaveTeam":return this.onRemoveTeamMembers(s,i,[n]);case"dismissTeam":return this.onDismissTeam(i,o);case"transferTeam":return this.transferTeam(e,s,n,a);case"updateTeamMute":return this.onUpdateTeamMembersMute(e,s,[a],t.mute);case"updateSuperTeam":return s.updateTime=o,this.onUpdateSuperTeam(s);case"addSuperTeamMembers":return this.onAddSuperTeamMembers(e,s,c);case"passSuperTeamApply":return this.onAddSuperTeamMembers(e,s,[a]);case"removeSuperTeamMembers":return this.onRemoveSuperTeamMembers(s,i,c);case"leaveSuperTeam":return this.onRemoveSuperTeamMembers(s,i,[n]);case"dismissSuperTeam":return this.onDismissSuperTeam(i,o);case"transferSuperTeam":return this.transferSuperTeam(e,s,n,a);case"addSuperTeamManagers":return this.updateSuperTeamManagers(e,i,c,!0,o);case"removeSuperTeamManagers":return this.updateSuperTeamManagers(e,i,c,!1,o);case"updateSuperTeamMembersMute":return this.onUpdateSuperTeamMembersMute(e,s,c,t.mute)}},M.onAddSuperTeamMembers=function(e,t,r){var n=this.db,i=k.assembleMembers(t,r);e.attach.members=i;var o={team:t,accounts:r,members:i};this.logger.info("team::onAddSuperTeamMembers: ".concat(o.team.teamId,", "),o.accounts);try{this.options.onAddSuperTeamMembers(x.simpleClone(o))}catch(e){throw this.logger.error("userOption:onAddSuperTeamMembers function error",e),e}if(n.enable){var s=n.putSuperTeamMembers(i),a=n.putSuperTeam(t);return l.all([s,a])}},M.onRemoveSuperTeamMembers=function(e,t,r){var n=this.db,i={team:e,accounts:r};this.logger.info("team::onRemoveSuperTeamMembers: ".concat(i.team.teamId,", "),i.accounts);try{this.options.onRemoveSuperTeamMembers&&this.options.onRemoveSuperTeamMembers(x.simpleClone(i))}catch(e){throw this.logger.error("userOption:onRemoveSuperTeamMembers function error",e),this.options.onerror&&this.options.onerror(e),new Error("Excute onRemoveSuperTeamMembers failed"+e.message)}if(n.enable){if(-1===m(r).call(r,this.account)){var o=n.removeSuperTeamMembersByAccounts(t,r),s=l.resolve();return e&&(s=n.putSuperTeam(e)),l.all([o,s])}return n.leaveSuperTeam(t)}},M.onDismissSuperTeam=function(e,t){var r=this.db,n={teamId:e};this.logger.info("team::onDismissSuperTeam:",e);try{this.options.onDismissSuperTeam(n)}catch(e){throw this.logger.error("userOption:onDismissSuperTeam function error",e),e}if(r.enable)return r.dismissSuperTeam(e,t)},M.onAddTeamMembers=function(e,t,r){var n=this,i=n.db,o=t.teamId,s=R.assembleMembers(t,r);e.attach.members=s;var a={team:t,accounts:r,members:s};n.logger.info("team::onAddTeamMembers: ",o,r);try{n.options.onAddTeamMembers(x.simpleClone(a))}catch(e){throw n.logger.error("userOption:onAddTeamMembers function error",e),e}if(i.enable){var c,u=i.putTeam(t);return-1===m(r).call(r,n.account)?c=i.putTeamMembers(s):(n.logger.log("team::onAddTeamMembers: user join team",o),u=new l((function(e){n.api.getTeamMembers({teamId:o,sync:!0,done:function(){e()}})}))),l.all([c,u])}},M.onRemoveTeamMembers=function(e,t,r){var n=this.db,i={team:e,accounts:r};this.logger.info("team::onRemoveTeamMembers: ".concat(e.teamId),r);try{this.options.onRemoveTeamMembers(x.simpleClone(i))}catch(e){throw this.logger.error("userOption:onRemoveTeamMembers function error",e),e}if(n.enable){if(-1===m(r).call(r,this.account)){var o=n.removeTeamMembersByAccounts(t,r),s=l.resolve();return e&&(s=n.putTeam(e)),l.all([o,s])}return n.leaveTeam(t)}},M.updateTeamManagers=function(e,t,r,n,i){var o=this.db,s=e.attach.members=d(r).call(r,(function(e){return{id:R.genId(t,e),type:n?"manager":"normal",updateTime:i}})),a={teamId:""+t,memberUpdateTime:i};e.attach.team=a;var c={team:a,accounts:r,isManager:n,members:s};this.logger.info("team::updateTeamManagers:",t,r,n);try{this.options.onUpdateTeamManagers(x.simpleClone(c))}catch(e){throw this.logger.error("userOption:onUpdateTeamManagers function error",e),e}if(o.enable){var u=o.updateTeam(a),p=o.updateTeamManagers(t,r,n,i);return l.all([u,p])}},M.updateSuperTeamManagers=function(e,t,r,n,i){var o=this.db,s=e.attach.members=d(r).call(r,(function(e){return{id:R.genId(t,e),teamId:t,account:e,type:n?"manager":"normal",updateTime:i}})),a={teamId:""+t,memberUpdateTime:i};e.attach.team=a;var c={team:a,accounts:r,isManager:n,members:s};this.logger.info("team::updateSuperTeamManagers:",t,r,n);try{this.options.onUpdateSuperTeamManagers(x.simpleClone(c))}catch(e){throw this.logger.error("userOption:onUpdateSuperTeamManagers function error",e),e}if(o.enable){var u=o.updateSuperTeam(a),p=o.updateSuperTeamMembers(s);return l.all([u,p])}},M.onDismissTeam=function(e,t){var r=this.db,n={teamId:e};this.logger.info("team::onDismissTeam:",e);try{this.options.onDismissTeam(n)}catch(e){throw this.logger.error("userOption:onDismissTeam function error",e),e}if(r.enable)return r.dismissTeam(e,t)},M.transferTeam=function(e,t,r,n){var i=this.db,o=t.teamId,s=t.memberUpdateTime,a={id:R.genId(o,r),type:"normal",updateTime:s},c={id:R.genId(o,n),type:"owner",updateTime:s};e.attach.members=[a,c];var u={team:t,from:a,to:c};this.logger.info("team::transferTeam: from to",o,r,n);try{this.options.onTransferTeam(x.simpleClone(u))}catch(e){throw this.logger.error("userOption:onTransferTeam function error",e),e}if(i.enable)return i.transferTeam(t,r,n)},M.transferSuperTeam=function(e,t,r,n){var i=this.db,o=t.teamId,s=t.memberUpdateTime,a={teamId:o,type:"normal",account:r,updateTime:s},c={teamId:o,type:"owner",account:n,updateTime:s};e.attach.members=[a,c];var u={team:t,from:a,to:c};this.logger.info("team::transferSuperTeam: from to ",o,r,n);try{this.options.onTransferSuperTeam(x.simpleClone(u))}catch(e){throw this.logger.error("userOption:onTransferSuperTeam function error",e),e}if(i.enable)return i.transferSuperTeam(t,a,c)},M.onUpdateTeamMembersMute=function(e,t,r,n){var i=this.db,o=d(r).call(r,(function(e){return{id:R.genId(t.teamId,e),account:e,teamId:t.teamId,mute:n,updateTime:t.memberUpdateTime}}));e.attach.members=o;var s={team:t,accounts:r,members:o,mute:n};this.logger.info("team::onUpdateTeamMembersMute:",t.teamId,r,n);try{this.options.onUpdateTeamMembersMute(x.simpleClone(s))}catch(e){throw this.logger.error("userOption:onUpdateTeamMembersMute function error",e),e}if(i.enable){var a=i.updateTeamMembers(o),c=i.putTeam(t);return l.all([a,c])}},M.onUpdateSuperTeamMembersMute=function(e,t,r,n){var i=this.db,o=d(r).call(r,(function(e){return{id:k.genId(t.teamId,e),account:e,teamId:t.teamId,mute:n,updateTime:t.memberUpdateTime}}));e.attach.members=o;var s={team:t,accounts:r,members:o,mute:n};this.logger.info("team::onUpdateSuperTeamMembersMute:",t.teamId,r,n);try{this.options.onUpdateSuperTeamMembersMute(x.simpleClone(s))}catch(e){throw this.logger.error("userOption:onUpdateSuperTeamMembersMute function error",e),e}if(i.enable){var a=i.updateSuperTeamMembers(o),c=i.putSuperTeam(t);return l.all([a,c])}},M.onHistoryMsgs=function(e){e.error||(e.obj.msgs=this.message.reverseMsgs(e.content.msgs))},M.onmsgFtsInServer=function(e){if(!e.error){var t=this.message.reverseMsgs(e.content.msgs);e.obj.msgs=t,e.content.msgs=t}},M.isFilterMsgs=function(e){return!!u(e[0])},M.splitMsgs=function(e,t,r,n){c(e).call(e,(function(e){if(u(e))n.push(e);else switch(e.scene){case"p2p":t.push(e);break;case"team":r.push(e)}}))},M.markMsgRead=function(e,t){if(x.isArray(e)||(e=[e]),this.db.enable||this.options.autoMarkRead||t){var r=d(e).call(e,(function(e){return{flag:"msg",idServer:e.idServer,scene:e.scene,filter:u(e),type:e.type,attachType:e.attach&&e.attach.type}}));this.msgAckBufferManager.add(r)}},M.markSysMsgRead=function(e,t){if(x.isArray(e)||(e=[e]),this.db.enable||this.options.autoMarkRead||t){var r=d(e).call(e,(function(e){return{flag:"systemMsg",idServer:e.idServer,scene:e.scene,filter:u(e),type:e.type}}));this.msgAckBufferManager.add(r)}},M.handleMsgsAck=function(e){var t,r=this,n={p2pSysMsgs:{sid:7,cid:3,msgs:[]},p2pMsgs:{sid:7,cid:2,msgs:[]},superTeamSysMsgs:{sid:21,cid:19,msgs:[]},teamMsgs:{sid:8,cid:3,msgs:[]},filterSysMsgs:{sid:101,cid:3,msgs:[]},filterMsgs:{sid:101,cid:2,msgs:[]},netcallMsgs:{sid:9,cid:11,msgs:[]}};c(e).call(e,(function(e){/^(netcallBill|netcallMiss|netcallReject)$/.test(e.attachType)?n.netcallMsgs.msgs.push(e):u(e)?"systemMsg"===e.flag?n.filterSysMsgs.msgs.push(e):n.filterMsgs.msgs.push(e):"systemMsg"!==e.flag?"p2p"===e.scene?n.p2pMsgs.msgs.push(e):"team"===e.scene&&n.teamMsgs.msgs.push(e):"superTeam"===e.scene?n.superTeamSysMsgs.msgs.push(e):n.p2pSysMsgs.msgs.push(e)})),c(t=p(n)).call(t,(function(e){return r.doMarkMsgsRead(n[e].sid,n[e].cid,n[e].msgs)}))},M.doMarkMsgsRead=function(e,t,r){r&&r.length&&(this.logger.log("markMsgRead::batchMarkRead",e,t,r),this.sendCmd("batchMarkRead",{sid:e,cid:t,ids:d(r).call(r,(function(e){return e.idServer}))}))}},function(e,t,r){var n=r(57),i=r(58),o=r(59),s=r(60),a=r(49),c=r(61),u=r(5),l=r(3),d=r(10),p=r(19),m=r(4),f=r(42);function h(e,t){var r=d(e);if(n){var o=n(e);t&&(o=p(o).call(o,(function(t){return i(e,t).enumerable}))),r.push.apply(r,o)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r,n,u=null!=arguments[t]?arguments[t]:{};t%2?l(r=h(Object(u),!0)).call(r,(function(t){c(e,t,u[t])})):o?s(e,o(u)):l(n=h(Object(u))).call(n,(function(t){a(e,t,i(u,t))}))}return e}var v=r(29).fn,y=r(477),b=r(479);function S(e,t,r){var n=this,i=this.timetags&&this.timetags.sync;this.db.enable&&i&&t&&this.db.getMsgByIdClient(e).then((function(e){if(e&&!(e.commentTimetag&&e.commentTimetag<=i&&e.time<=i)){if(e.commentTimetag=t.time,e.comments=e.comments||[],r){var o;e.comments=p(o=e.comments).call(o,(function(e){return e.body!==t.body||e.from!==t.from}))}else{for(var s,a=0;a<e.comments.length;a++)if(e.comments[a].from===t.from&&e.comments[a].body===t.body){e.comments[a]=t,s=!0;break}s||e.comments.push(t)}var c={idClient:e.idClient,comments:e.comments,commentTimetag:e.commentTimetag};n.db.updateMsg(c)}}))}function T(e){e.scene=this.message.sceneReverseMap[+e.scene]||e.scene,e.time=+e.time}v.processMsgExtend=function(e){switch(e.cmd){case"getThreadMsgs":this.onGetThreadMsgs(e);break;case"getMsgsByIdServer":this.onGetMsgsByIdServer(e);break;case"addQuickComment":this.changeQuickComment(e);break;case"deleteQuickComment":this.changeQuickComment(e,!0);break;case"onQuickComment":case"syncAddQuickComment":this.onQuickComment(e);break;case"onDeleteQuickComment":case"syncDeleteQuickComment":this.onQuickComment(e,!0);break;case"getQuickComments":this.getQuickComments(e);break;case"addCollect":case"updateCollect":this.addCollect(e);break;case"deleteCollects":this.deleteCollects(e);break;case"getCollects":this.getCollects(e);break;case"addStickTopSession":case"syncAddStickTopSession":this.onChangeStickTopSession(e,"add");break;case"updateStickTopSession":case"syncUpdateStickTopSession":this.onChangeStickTopSession(e,"update");break;case"deleteStickTopSession":case"syncDeleteStickTopSession":this.onChangeStickTopSession(e,"delete");break;case"addMsgPin":case"onAddMsgPin":case"syncAddMsgPin":this.pinMsgChange(e,"add");break;case"updateMsgPin":case"onUpdateMsgPin":case"syncUpdateMsgPin":this.pinMsgChange(e,"update");break;case"deleteMsgPin":case"onDeleteMsgPin":case"syncDeleteMsgPin":this.pinMsgChange(e,"delete");break;case"getMsgPins":this.getMsgPins(e)}},v.onGetThreadMsgs=function(e){if(!e.error){var t;e.obj.msgs=this.message.reverseMsgs(e.content.msgs),e.obj.threadMsg=u(t=this.message).call(t,e.content.threadMsg);var r=e.content.threadMsgsMeta||{};e.obj.total=r.total,e.obj.timetag=r.lastMsgTime}},v.onGetMsgsByIdServer=function(e){e.error||(e.obj.msgs=this.message.reverseMsgs(e.content.msgs))},v.changeQuickComment=function(e,t){e.error||(e.obj.comment.time=e.content.timetag,e.obj.comment=u(y).call(y,e.obj.comment),T.call(this,e.obj.msg),S.call(this,e.obj.msg.idClient,e.obj.comment,t))},v.onQuickComment=function(e,t){if(e.content){var r=e.content,n=r.comment,i=r.msg;if(n&&i){if(T.call(this,i),n=u(y).call(y,n),t)try{this.options.onDeleteQuickComment(e.content.msg,n)}catch(e){throw this.logger.error("userOption:onDeleteQuickComment function error",e),e}else try{this.options.onQuickComment(e.content.msg,n)}catch(e){throw this.logger.error("userOption:onQuickComment function error",e),e}S.call(this,i.idClient,n,t)}}},v.getQuickComments=function(e){var t,r=this;if(!e.error){var n=e.obj.idMap,i=e.obj.indexMap,o=e.content&&e.content.commentRes||[];l(o).call(o,(function(e){var t=[],i=r.parser.unserializeMap.comment;if(1==+e.modify)try{t=JSON.parse(e.detail)}catch(e){r.logger.warn("getQuickComments parse detail error",e)}if(l(t).call(t,(function(e,r){var n,o={};l(n=d(e)).call(n,(function(t){o[i[t]]=e[t]})),o=u(y).call(y,o),t[r]=o})),e.timestamp=+e.timestamp,n[e.idClient]){var o={idClient:e.idClient,commentTimetag:e.timestamp};n[e.idClient].commentTimetag=e.timestamp,1==+e.modify&&(n[e.idClient].comments=t,o.comments=t),r.db.enable&&r.db.updateMsg(o)}else n[e.idClient]={idServer:e.idServer,idClient:e.idClient,comments:t,commentTimetag:e.timestamp,scene:r.message.sceneReverseMap[e.scene]||e.scene}})),e.obj=[],l(t=d(i)).call(t,(function(t){e.obj[i[t]]=n[t]}))}},v.addCollect=function(e){e.error||(e.obj.collect=u(b).call(b,e.content.collect))},v.deleteCollects=function(e){e.error||(e.obj.deleteNum=e.content.deleteNum)},v.getCollects=function(e){if(!e.error){var t=[],r=e.content.collectList||[];l(r).call(r,(function(e){t.push(u(b).call(b,e))})),e.obj.collectList=t,e.obj.total=e.content.total}},v.onChangeStickTopSession=function(e,t){var r=this;if(!e.error){var n=e.content.stickTopSession||e.obj.stickTopSession||{},i=e.content.timetag||+n.updateTime,o=n.id.split("|");"super_team"===o[0]&&(o[0]="superTeam"),n={id:o.join("-"),scene:o[0],to:o[1],topCustom:n.topCustom||""},"delete"===t?n.isTop=!1:"add"===t&&(n.isTop=!0),n=this.onUpdateSession(n),e.obj&&(e.obj.stickTopSession=n),this.db.enable&&(this.db.updateSession(n).then((function(e){e||r.db.putSession(n)})),this.db.updateTimetag("stickTopSessions",i))}},v.pinMsgChange=function(e,t){var r=this;if(!e.error){e.content=e.content||{};var n=this,i=this.db,o=e.obj&&e.obj.msg,s=e.content.msg||o||{},a=e.content.pinTag||e.obj.pinTag,c=e.content.timetag||+a.updateTime,u=m.resolve();T.call(this,s),i.enable&&(u=i.getMsgByIdClient(s.idClient)),a.createTime&&(a.createTime=+a.createTime),a.updateTime&&(a.updateTime=+a.updateTime),u.then((function(u){if(s=u||s,u?s=u:s.sessionId=s.scene+"-"+r.message.Message.getMsgTarget(s,r.account),o)e.obj.msg=s,e.obj.pinTag=a;else try{r.options.onPinMsgChange({msg:s,pinTag:a},t)}catch(e){throw n.logger.error("userOption:onPinMsgChange function error",e),e}return i.enable&&i["delete"===t?"deleteMsgPin":"putMsgPin"](g(g({},s),{},{pinFrom:a.pinFrom,pinCustom:a.pinCustom})).then((function(){var e="pin-"+s.sessionId,t=n.timetags.sync;return i.getTimetag(e).then((function(r){return r>t?i.updateTimetag(e,c):m.resolve()}))})).catch((function(e){n.logger.error("msgExtend::pinMsgChange:error",e)})),m.resolve})).then((function(){})),e.promise=u}},v.getMsgPins=function(e){var t=this;if(!e.error){var r=this.db,n=e.content||{};if(n.pins=n.pins||[],n.modify){var i,o=[];r.enable&&(r.updateTimetag("pin-"+e.obj.id,n.timetag),l(i=n.pins).call(i,(function(t){t.sessionId=e.obj.id,o.push(r.getMsgByIdClient(t.idClient))}))),e.promise=m.all(o).then((function(i){var o;l(o=n.pins).call(o,(function(r,n){i[n]?f(r,i[n]):(r.sessionId=e.obj.id,T.call(t,r))})),e.obj.pins=n.pins,r.enable&&r.deleteMsgPins(e.obj.id).then((function(){return r.putMsgPins(n.pins)})).catch((function(e){t.logger.error("msgExtend::getMsgPins:change db error",e)}))}))}else r.enable?(r.updateTimetag("pin-"+e.obj.id,n.timetag),e.promise=r.getMsgPins(e.obj.id).then((function(t){e.obj.pins=t||[]}))):e.obj.pins=[]}}},function(e,t,r){var n=r(530);e.exports=n},function(e,t,r){r(531);var n=r(12);e.exports=n.Number.isInteger},function(e,t,r){r(2)({target:"Number",stat:!0},{isInteger:r(532)})},function(e,t,r){var n=r(28),i=Math.floor;e.exports=Number.isInteger||function(e){return!n(e)&&isFinite(e)&&i(e)===e}},function(e,t,r){var n=r(4),i=r(3),o=r(13),s=r(29).fn,a=r(0);s.onOfflineMsgReceipts=function(e){var t,r=this,o=r.db,s=e.content.msgReceipts,a=[],c=n.resolve();this.logger.info("onOfflineMsgReceipts",s),i(s).call(s,(function(e){t={id:"p2p-"+e.from,msgReceiptTime:+e.time},r.cacheSyncedSession(t)})),r.syncResult.msgReceipts=a,o.enable&&(c=o.updateMsgReceiptsTimetag(e.content.timetag)),c.cmd=a,r.syncPromiseArray.push(c)},s.shouldUpdateSessionFromMsgReceipt=function(e,t){return!e||!e.msgReceiptServerTime||t.time>e.msgReceiptServerTime},s.genSessionFromMsgReceipt=function(e,t){var r=t.time,n={id:t.sessionId,msgReceiptTime:r,msgReceiptServerTime:r};return e&&e.id===t.sessionId&&(n=a.merge({},e,n)),e&&e.updateTime||(n.updateTime=r),n},s.onMsgReceipt=function(e){var t=this,r=t.db,i=e.content.msgReceipt;i.time=+i.time;var o=i.idClient,s=n.resolve();r.enable&&o&&(s=r.getMsgByIdClient(o)),this.logger.info("onMsgReceipt::",i),s.then((function(e){var r;if(e){if(!e.idServer)return void(t.msgReceiptTasks[o]=i);r=e.time}else r=i.time;i.msgReceiptTime=r,t.updateSessionMsgReceiptTime(i)}))},s.resolveMsgReceiptTask=function(e){var t=this.msgReceiptTasks[e.idClient];t&&(t.msgReceiptTime=e.time,this.updateSessionMsgReceiptTime(t))},s.updateSessionMsgReceiptTime=function(e){var t=this.db,r={id:"p2p-"+e.from,msgReceiptTime:e.msgReceiptTime,msgReceiptServerTime:e.time};(this.getSessionInCache(r.id)||{}).msgReceiptTime>=r.msgReceiptTime?this.logger.warn("receive old msgReceiptTime",e):(t.enable&&t.putSession(r),this.onUpdateSession(r))},s.onSendMsgReceipt=function(e){var t;if(!e.error)if(e.obj&&e.obj.msgReceipt){var r=e.obj.msgReceipt,n=+r.time,i=+e.content.msgReceipt.time,s=this.getSessionInCache("p2p-"+r.to);s?(this.logger.info(o(t="sendMsgReceipt on:: param time ".concat(n,", res time ")).call(t,i)),s.msgReceiptSendTime=Math.min(n,i)):this.logger.info("sendMsgReceipt on:: session is undefined or logically deleted, failed to send read receipt")}else this.logger.info("sendMsgReceipt on:: origin msg is missing, it maybe timeout")},s.shouldSendMsgReceipt=function(e){if(e&&"p2p"===e.scene&&"success"===e.status){var t=this.getSessionInCache(e.sessionId);if(t){var r=t.msgReceiptSendTime;return!r||r<e.time}}return!1},s.isMsgRemoteRead=function(e){if(e&&"p2p"===e.scene&&"out"===e.flow&&"success"===e.status){var t=this.getSessionInCache(e.sessionId);if(t&&t.msgReceiptTime)return e.time<=t.msgReceiptTime}return!1}},function(e,t,r){var n=r(219),i=r(220),o=r(79),s=r(5),a=r(3),c=r(13),u=r(8),l=r(4),d=r(77),p=r(148),m=r(10),f=r(19),h=r(50),g=r(17),v=r(23),y=r(212),b=r(29).fn,S=r(118),T=r(142),_=r(0);function w(e,t){return M.apply(this,arguments)}function M(){return(M=i(n.mark((function e(t,r){var i,o,s,c,u,l,d,p,m,f,h,g,b,S=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(o=this).db,c=[],a(t).call(t,(function(e){S.revokeMsgUniqueCheck(e.idClient),c.push(e.idClient)})),o.options.rollbackDelMsgUnread){e.next=14;break}return e.next=7,s.deleteMsg(c);case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0=[];case 10:return u=e.t0,u="[object Array]"===Object.prototype.toString.call(u)?u:[u],o.logger.info("msg::_deleteMsgSelfBatchInDb, rollback false, affect: ".concat(u.length," rows")),e.abrupt("return");case 14:return l=!1,d=o.options.cbUpdateSession||v(i=o.updateSessionInDbWithNotify).call(i,o),p=o.getSessionInCache(r)||{id:r},m=p.lastMsg||{},y(c).call(c,m.idClient)&&(l=!0),o.logger.info("msg::_deleteMsgSelfBatchInDb session change before:",r,l,p.unread),e.next=22,s.deleteMsg(c);case 22:if(e.t1=e.sent,e.t1){e.next=25;break}e.t1=[];case 25:if(f=e.t1,f="[object Array]"===Object.prototype.toString.call(f)?f:[f],o.logger.info("msg::_deleteMsgSelfBatchInDb affect:",f.length," rows"),!l){e.next=34;break}return e.next=31,s.getMsgs({sessionId:r,limit:1});case 31:h=e.sent,m=h&&h[0]?h[0]:m,p.lastMsg=m;case 34:if(g=!1,p&&p.unread&&(b=p&&p.ack||0,a(f).call(f,(function(e){b<e.time&&"in"===e.flow&&(p.unread=p.unread-1,g=!0)}))),!l&&!g){e.next=39;break}return o.logger.info("msg::_deleteMsgSelfBatchInDb session change after:",r,p.unread),e.abrupt("return",d(p));case 39:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function x(e,t){t=t||(new Date).getTime();var r=this.db,n=this.getSessionInCache(e),i=!1!==this.options.rollbackClearMsgsUnread,o=[];return r.enable&&o.push(r.deleteMsgsBySessionId({sessionId:e,end:t})),i&&n&&(n=this.mergeSession({id:n.id,unread:0,lastMsg:null,unreadMsgs:[]}),n=this.onUpdateSession(n)),r.enable&&i&&n&&o.push(r.updateSession(n)),l.all(o)}b.onDeleteMsg=function(e){var t=this.db;if(delete e.obj.sysMsg,!e.error){var r=e.obj.msg;e.promise=this.deleteLocalMsg(r).then((function(){if(t.enable){var e="superTeam"===r.scene?"deleteSuperTeamMsg":"deleteMsg";t.getTimetag(e).then((function(r){r=r||0,o()+1>=r&&t.updateTimetag(e,o()+1)}))}}))}},b.onMsgDeleted=function(e,t){if(!e.error){var r=this,n=r.db,i=s(S).call(S,e.content.sysMsg);i=r.processDeleteMsgSysMsg(i),t||r.markSysMsgRead(i),r.deleteLocalMsg(i.msg).then((function(){if(n.enable){var e=t?"deleteSuperTeamMsg":"deleteMsg";n.updateTimetag(e,i.time+1)}r.handleSysMsg(i)}))}},b.processDeleteMsgSysMsg=function(e){var t;return e.msg={},a(t=["scene","from","to"]).call(t,(function(t){e.msg[t]=e[t]})),e.msg.idClient=e.deletedIdClient,e.msg.idServer=e.deletedIdServer,e.msg.time=e.deletedMsgTime,e.msg.fromNick=e.deletedMsgFromNick,e.opeAccount=e.opeAccount||e.from,e.msg.opeAccount=e.opeAccount,this.message.Message.setExtra(e.msg,this.account),e},b.onDeleteMsgOfflineRoaming=function(e){if(!e.error){var t,r=this,n=1==+e.content.type?"offline":"roaming",i=S.reverseSysMsgs(e.content.sysMsgs,{mapper:function(e){return r.processDeleteMsgSysMsg(e)}}),o=i&&i[0]&&"superTeam"===i[0].scene;r.logger.info(c(t="msg::onDeleteMsgOfflineRoaming: on delete ".concat(n," ")).call(t,o?"superTeam":""," idServer deletedIdClient deletedIdClient="),u(i).call(i,(function(e){var t,r;return c(t=c(r="".concat(e.idServer,"-")).call(r,e.deletedIdServer,"-")).call(t,e.deletedIdClient)}))),"offline"===n&&r.markSysMsgRead(i);var s=e.content.timetag;o?(r.timetags.deleteSuperTeamMsg=s,r.syncResult.deleteSuperTeamMsgTimetag=s):(r.timetags.deleteMsg=s,r.syncResult.deleteMsgTimetag=s);var a=r.putSysMsg(i,"offlineSysMsgs").catch((function(e){return r.logger.error("msgDelete::onDeleteMsgOfflineRoaming: ",e),l.reject(e)}));a.cmd="deleteMsgSysMsgs "+n,r.syncPromiseArray.push(a),r.syncResult.deleteMsgSysMsgs=r.syncResult.deleteMsgSysMsgs||[],r.syncResult.deleteMsgSysMsgs.push({type:n,sysMsgs:i})}},b.deleteMsgOfflineRoaming=function(e,t){if(!e)return l.resolve();var r=this;r.logger.info("msg::deleteMsgOfflineRoaming: ",u(e).call(e,(function(e){var t;return e.type+" "+u(t=e.sysMsgs).call(t,(function(e){var t,r;return c(t=c(r="".concat(e.idServer,"-")).call(r,e.deletedIdServer,"-")).call(t,e.deletedIdClient)}))})),_.secureOutput("session",t));var n=r.db,i=[];return a(e).call(e,(function(e){var o;a(o=e.sysMsgs).call(o,(function(e){var o=r.deleteLocalMsg(e.msg,{cbUpdateSession:function(e){e=r.mergeSession(e),e=_.simpleClone(e),d(T).call(T,e);var i=_.findObjIndexInArray(t,{value:e.id});if(-1!==i&&(t[i]=_.merge({},t[i],e)),n.enable)return n.updateSession(e)}});i.push(o)}))})),l.all(i).then((function(){n.enable&&(r.syncResult.deleteMsgTimetag&&n.updateTimetag("deleteMsg",r.syncResult.deleteMsgTimetag),r.syncResult.deleteSuperTeamMsgTimetag&&n.updateTimetag("deleteSuperTeamMsg",r.syncResult.deleteSuperTeamMsgTimetag))}))},b.deleteMsgSelf=function(e){if(!e.error){var t=this.db,r=e.obj&&e.obj.deleteMsgSelfTag;if(r){var n=e.content&&e.content.timetag;r.scene=r.scene+""=="1"?"p2p":"team";var i=[this.deleteLocalMsg(r)];n<=this.timetags.deleteMsgSelf||(this.timetags.deleteMsgSelf=n,t.enable&&i.push(t.updateDeleteMsgSelf(n))),e.promise=l.all(i)}}},b.deleteMsgSelfBatch=function(){var e=i(n.mark((function e(t){var r,i,o,s,c,d,h,g;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}return e.abrupt("return");case 2:if(i=this,o=this.db,(s=t.obj&&t.obj.deleteMsgSelfTags)&&s.length>0){e.next=7;break}return e.abrupt("return");case 7:if(c=p(s).call(s,(function(e,t){var r=t.sessionId;e[r]=e[r]||[],e[r].push(t);var n=i.findSession(r);return n&&n.lastMsg&&t&&n.lastMsg.idClient===t.idClient&&(n.lastMsg=null,i.onUpdateSession(n)),e}),{}),o.enable){e.next=11;break}return a(d=m(c)).call(d,(function(e){var t=c[e],r=i.getSessionInCache(e);if(i.options.rollbackDelMsgUnread&&r){var n=r.ack||0,o=f(t).call(t,(function(e){return n<e.time&&"in"===e.flow}));o.length>0&&r.unread&&(r.unread=r.unread?r.unread-o.length:0,i.onUpdateSession(r))}})),e.abrupt("return",l.resolve());case 11:h=u(r=m(c)).call(r,(function(e){var t=c[e];return w.call(i,t,e)})),(g=t.content&&t.content.timetag)<=i.timetags.deleteMsgSelf||(i.timetags.deleteMsgSelf=g,h.push(o.updateDeleteMsgSelf(g))),t.promise=l.all(h);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),b.onDeleteMsgSelf=function(e){var t=this,r=this.db,n=e.content.deleteMsgSelfTag;n.scene=n.scene+""=="1"?"p2p":"team";try{t.options.onDeleteMsgSelf([n])}catch(e){throw t.logger.error("userOption:onDeleteMsgSelf function error",e),e}t.deleteLocalMsg(n).then((function(){var e=n.deletedTime;return e<=t.timetags.deleteMsgSelf||!r.enable?l.resolve():(t.timetags.deleteMsgSelf=e,r.updateDeleteMsgSelf(e))})).catch((function(e){t.logger.error("onDeleteMsgSelf error",e)}))},b.onDeleteMsgSelfBatch=function(e){var t=this;if(!e.error){var r={1:"p2p",2:"team"},n=_.get(e,"content.deleteMsgSelfTags")||[];a(n).call(n,(function(e){var n;e.scene=r[e.scene],e.sessionId=c(n="".concat(e.scene,"-")).call(n,t.message.Message.getMsgTarget(e,t.account)),e.deletedTime=h(e.deletedTime),e.time=h(e.time)}));var i=_.get(e,"content.deleteMsgSelfTags[0].deletedTime");i=h(i)||0,this.options.onDeleteMsgSelf(n),this.deleteMsgSelfBatch({obj:{deleteMsgSelfTags:n},content:{timetag:i}})}},b.clearServerHistoryMsgs=function(e){if(!e.error){var t=this.db,r=e.obj&&e.obj.clearMsgsParamsWithSync;if(r){var n="p2p"==(r.type&&"2"===r.type.toString()?"team":"p2p")?"p2p-".concat(r.otherAccid):"team-".concat(r.toTid),i=e.content&&h(e.content.timetag);i&&i>this.timetags.sessionHistoryMsgsDelete&&(this.timetags.sessionHistoryMsgsDelete=i,t.enable&&t.updateTimetag("sessionHistoryMsgsDelete",this.timetags.sessionHistoryMsgsDelete)),x.call(this,n,i)}}},b.onClearServerHistoryMsgs=function(e){if(!e.error){var t=this.db,r=e.content&&e.content.sessionHistoryMsgsDeleteTag;if(r){var n="p2p"==(r.type&&"2"===r.type.toString()?"team":"p2p")?"p2p-".concat(r.otherAccid):"team-".concat(r.toTid),i=h(r.time);this.options.onClearServerHistoryMsgs&&this.options.onClearServerHistoryMsgs([{sessionId:n,time:i}]),i<=this.timetags.sessionHistoryMsgsDelete||(this.timetags.sessionHistoryMsgsDelete=i,t.enable&&t.updateTimetag("sessionHistoryMsgsDelete",this.timetags.sessionHistoryMsgsDelete)),x.call(this,n,i)}}},b.syncSessionHistoryMsgsDelete=function(e){if(!e.error){var t=this.db,r=e.content&&e.content.sessionHistoryMsgsDeleteTags;if(r&&r.length>0){var n=u(r).call(r,(function(e){return{sessionId:"p2p"==(e.type&&"2"===e.type.toString()?"team":"p2p")?"p2p-".concat(e.otherAccid):"team-".concat(e.toTid),time:h(e.time)}}));this.options.onClearServerHistoryMsgs&&this.options.onClearServerHistoryMsgs(n),this.syncResult.clearServerHistoryMsgs=n;var i=0;a(n).call(n,(function(e){e.time>i&&(i=e.time)})),t.enable&&t.updateTimetag("sessionHistoryMsgsDelete",i)}}},b.syncDeleteMsgSelf=function(e){var t=this,r=this.db,n=e.content.deletedMsgs;if(n&&0!==n.length){var i=[];a(n).call(n,(function(e){e.scene="1"===e.scene?"p2p":"team",e.deletedTime=+e.deletedTime,e.time=+e.time,i.push(t.deleteLocalMsg(e))}));try{t.options.onDeleteMsgSelf(n)}catch(e){throw t.logger.error("userOption:onDeleteMsgSelf function error",e),e}l.all(i).then((function(){var e=g(n).call(n,-1)[0].deletedTime;if(!(t.timetags.deleteMsgSelf>=e))return t.timetags.deleteMsgSelf=e,r.enable?r.updateDeleteMsgSelf(e):void 0})).catch((function(e){t.logger.error("syncDeleteMsgSelf error",e)}))}},b.deleteLocalMsg=function(){var e=i(n.mark((function e(t,r){var i,o,s,a,c,u,l,d,p,m,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(s=(o=this).db,a=(r=r||{}).cbUpdateSession||v(i=o.updateSessionInDbWithNotify).call(i,o),this.revokeMsgUniqueCheck(t&&t.idClient),c=t.sessionId||t.scene+"-"+this.message.Message.getMsgTarget(t,this.account),u=!1,l=o.getSessionInCache(c),o.options.rollbackDelMsgUnread&&l&&(d=l.ack||0,l&&d<t.time&&"in"===t.flow&&l.unread&&(o.logger.info("msgDelete::deleteLocalMsg:cache.getSessions: unread",l.id,l.unread),l.unread=l.unread-1,u=!0)),l&&l.lastMsg&&l.lastMsg.idClient==t.idClient&&(o.logger.info("msgDelete::deleteLocalMsg:cache.getSessions: lastMsg",l.id,l.unread),l.lastMsg=null,u=!0),!s.enable){e.next=39;break}return p=null,e.next=16,s.getMsgByIdClient(t.idClient);case 16:return e.sent||o.logger.info("msgDelete::deleteLocalMsg::db.deleteMsg no find in DB",t),o.logger.info("msgDelete::deleteLocalMsg::db.deleteMsg ",t.idClient),e.next=21,s.deleteMsg(t.idClient);case 21:if(!l||null!==l.lastMsg){e.next=26;break}return e.next=24,s.getMsgs({sessionId:c,limit:1});case 24:(m=e.sent)&&m[0]&&(p=m[0]);case 26:if(l||!o.options.rollbackDelMsgUnread){e.next=36;break}return o.logger.info("msgDelete::deleteLocalMsg::Can not find session in cache,will find in DB",c),e.next=30,s.getSession(c);case 30:if(f=e.sent){e.next=33;break}return e.abrupt("return");case 33:d=(l=f).ack||0,l&&d<t.time&&"in"===t.flow&&l.unread&&(o.logger.info("msgDelete::deleteLocalMsg:db.getSessions: unread",f.id,f.unread),l.unread=l.unread-1,u=!0);case 36:if(l&&null===l.lastMsg&&p&&(o.logger.info("msgDelete::deleteLocalMsg:db.getSessions: lastMsg",c,p),l.lastMsg=p||null,u=!0),!u){e.next=39;break}return e.abrupt("return",a(l));case 39:if(s.enable||!u){e.next=42;break}return o.onUpdateSession(l),e.abrupt("return");case 42:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),b.deleteLocalMsgs=function(e){var t=this,r=t.db;return new l((function(n,i){if(function(n){var i=t.getSessionInCache(e.sessionId);if(i&&e.updateSession){var o=i.lastMsg;o&&(!e.start&&!e.end||o.time>e.start&&o.time<e.end)&&(i.lastMsg=null,t.logger.log("deleteLocalMsgs::delete cacheSession lastMsg done, options is",e),r.enable||(t.onUpdateSession(i),n()))}}(n),r.enable)return r.deleteMsgsBySessionId(e).then((function(){e.updateSession&&t.checkAndUpdateLocalSessionByMsg(e.sessionId),n()}),(function(e){return i(e)}))}))}},function(e,t,r){var n=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function a(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof d?t:d,o=Object.create(i.prototype),s=new w(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=S(s,r);if(a){if(a===l)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,s),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function p(){}function m(){}var f={};a(f,i,(function(){return this}));var h=Object.getPrototypeOf,g=h&&h(h(M([])));g&&g!==t&&r.call(g,i)&&(f=g);var v=m.prototype=d.prototype=Object.create(f);function y(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(i,o){function s(){return new t((function(n,s){!function n(i,o,s,a){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,a)}))}a(c.arg)}(i,o,n,s)}))}return n=n?n.then(s,s):s()}}function S(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function M(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return p.prototype=m,a(v,"constructor",m),a(m,"constructor",p),p.displayName=a(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,a(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),a(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var s=new b(c(t,r,n,i),o);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},y(v),a(v,s,"Generator"),a(v,i,(function(){return this})),a(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=M,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:M(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},function(e,t,r){e.exports=r(537)},function(e,t,r){var n=r(538);r(539),r(540),r(541),r(542),e.exports=n},function(e,t,r){var n=r(202);e.exports=n},function(e,t,r){r(203)},function(e,t,r){r(204)},function(e,t,r){var n=r(2),i=r(93),o=r(115);n({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=i.f(this),r=o(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}})},function(e,t,r){r(205)},function(e,t,r){var n=r(76),i=r(8),o=r(5),s=r(13),a=r(4),c=r(26),u=r(19),l=r(3),d=r(29).fn,p=r(0),m=r(118);d.splitSysMsgs=function(e,t){for(var r,i=e.length-1;i>=0;i--)r=e[i],m.isCustom(r)&&(n(e).call(e,i,1),t.push(r))},d.onOfflineSysMsgs=function(e,t){var r,n=this,c=i(r=e.content.sysMsgs).call(r,(function(e){return e=o(m).call(m,e),t&&(e.filter=!0),e}));c=o(c).call(c),n.markSysMsgRead(c);var u=[];n.splitSysMsgs(c,u);var l,d=t?"offlineFilterSysMsgs":"offlineSysMsgs",p=t?"offlineFilterCustomSysMsgs":"offlineCustomSysMsgs";if(c.length){var f=n.putSysMsg(c,"offlineSysMsgs").then((function(e){var t;(c=e).length&&(n.logger.info("sysmsg::onOfflineSysMsgs: ",d,c.length,c&&i(c).call(c,(function(e){return e.idServer}))),n.syncResult[d]=n.syncResult[d]||[],n.syncResult[d]=s(t=n.syncResult[d]).call(t,c))})).catch((function(e){return n.logger.error("sysMsg::onOfflineSysMsgs: ",e),a.reject(e)}));f.cmd="sysMsgs",n.syncPromiseArray.push(f)}u.length&&(n.logger.info("sysmsg::onOfflineSysMsgs: ",p,i(u).call(u,(function(e){return e.idServer}))),n.syncResult[p]=n.syncResult[p]||[],n.syncResult[p]=s(l=n.syncResult[p]).call(l,u))},d.onSendSysMsg=function(e,t){var r=e.obj||{};r?(this.completeSysMsg(r),e.error?r.status="fail":r.status="success",r=o(m).call(m,r),t&&(e.obj.filter=!0),e.obj=r):this.logger.warn("onSendSysMsg::no obj")},d.completeSysMsg=function(e){return e.from=this.account,e},d.onSysMsg=function(e,t){var r=o(m).call(m,e.content.sysMsg);if(this.markSysMsgRead(r),t&&(r.filter=!0),m.isCustom(r)){this.logger.info("sysmsg::onSysMsg: on customSysMsg");try{this.options.oncustomsysmsg(r)}catch(e){throw this.logger.error("userOption:oncustomsysmsg function error",e),e}}else this.syncing?this.unhandledSysMsgs.push(r):this.handleSysMsg(r)},d.handleSysMsg=function(e){var t=this,r=e.type,n=e.from,i=e.serverex;t.sysMsgPromise=t.sysMsgPromise.then((function(){return t.putSysMsg(e,"onSysMsg")})).then((function(t){e=t[0]})).then((function(){if(e){var o,s=a.resolve();switch(r){case"addFriend":o={type:"addFriend",account:n},i&&(o.serverex=i),s=t.onFriendRequest(o);break;case"passFriendApply":o={type:"passFriendApply",account:n},s=t.onFriendRequest(o);break;case"deleteFriend":s=t.onDeleteFriend({account:n})}return o&&o.friend&&(e.friend=o.friend),s}})).then((function(){e&&(t.logger.info("sysmsg::handleSysMsg: ",r,p.pickAsString(e,["idServer","deletedIdClient","deletedIdServer"])),c((function(){try{t.options.onsysmsg(e)}catch(e){throw t.logger.error("userOption:onsysmsg function error",e),e}}),0))}))},d.putSysMsg=function(e,t){if(p.isArray(e)||(e=[e]),u(e[0]))return a.resolve(e);var r=this,n=r.db,i=n.enable,o=a.resolve(),s=[];return(o=(o=o.then((function(){return i?n.putSysMsg(e):e})).then((function(t){var n=[];l(e).call(e,(function(e){r.checkSysMsgUnique(e)&&n.push(e)})),e=n,s=i?t:e}))).then((function(){return r.getSysMsgUnread().then((function(n){return s.length||((s=e).backward=!0),r.updateSysMsgUnread(s,n,1).then((function(e){"offlineSysMsgs"===t&&(r.syncResult.sysMsgUnread=e),"onSysMsg"===t&&r.onUpdateSysMsgUnread(e)}))}))}))).then((function(){return e}))},d.checkSysMsgUnique=p.genCheckUniqueFunc("idServer"),d.getSysMsgUnread=function(){var e=this,t=e.db;return new a((function(r){t.enable?t.getSysMsgUnread().then((function(e){r(e)}),(function(){r(e.sysMsgUnread)})):r(e.sysMsgUnread)}))},d.updateSysMsgUnread=function(e,t,r){if(p.isArray(e)||(e=[e]),!e.length)return a.resolve(t);t=t||{};var n,i=this.db;return l(e).call(e,(function(e){(r>0&&!e.read||r<0&&e.read)&&(n=e.type,t[n]=(t[n]||0)+r)})),t=m.completeUnread(t),this.sysMsgUnread=t,i.enable&&!e.backward?i.updateSysMsgUnread(t):a.resolve(t)},d.reduceSysMsgUnread=function(e){var t=this;return t.getSysMsgUnread().then((function(r){return t.updateSysMsgUnread(e,r,-1)})).then((function(e){t.onUpdateSysMsgUnread(e)}))},d.onUpdateSysMsgUnread=function(e){var t=this;c((function(){t.logger.info("sysmsg::onUpdateSysMsgUnread:",e);try{t.options.onupdatesysmsgunread(e)}catch(e){throw t.logger.error("userOption:onupdatesysmsgunread function error",e),e}}),0)},d.updateSysMsg=function(e){var t=this,r=t.db;(r.enable?r.updateSysMsg(e):a.resolve(e)).then((function(e){t.onUpdateSysMsg(e)}))},d.onUpdateSysMsg=function(e){var t=this;c((function(){p.isArray(e)||(e=[e]),l(e).call(e,(function(e){t.logger.info("sysmsg::onUpdateSysMsg:",e.idServer);try{t.options.onupdatesysmsg(e)}catch(e){throw t.logger.error("userOption:onupdatesysmsg function error",e),e}}))}),0)},d.processUnsettledSysMsgs=function(){var e,t=this;l(e=t.unhandledSysMsgs).call(e,(function(e){t.handleSysMsg(e)})),t.resetUnsettledSysMsgs()}},function(e,t,r){var n=r(57),i=r(58),o=r(59),s=r(60),a=r(49),c=r(480),u=r(61),l=r(3),d=r(6),p=r(17),m=r(5),f=r(4),h=r(8),g=r(77),v=r(19),y=r(42),b=r(10),S=r(13);function T(e,t){var r=b(e);if(n){var o=n(e);t&&(o=v(o).call(o,(function(t){return i(e,t).enumerable}))),r.push.apply(r,o)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r,n,c=null!=arguments[t]?arguments[t]:{};t%2?l(r=T(Object(c),!0)).call(r,(function(t){u(e,t,c[t])})):o?s(e,o(c)):l(n=T(Object(c))).call(n,(function(t){a(e,t,i(c,t))}))}return e}var w=r(29).fn,M=r(0),x=r(142),E=r(36),C=r(118);w.processSession=function(e){if(!e.error)switch(e.cmd){case"getServerSessions":this.onGetServerSessions(e);break;case"getServerSession":this.onGetServerSession(e);break;case"updateServerSession":this.onUpdateServerSession(e)}},w.onGetServerSessions=function(e){var t=this,r=e.content&&e.content.sessionReqTag,n=e.content&&e.content.sessionList,i=[];l(n).call(n,(function(e){var r,n;if(e.id=e.id.split("|").join("-"),0===d(r=e.id).call(r,"super_team")&&(e.id="superTeam"+p(n=e.id).call(n,10)),e.updateTime=+e.updateTime,e.lastMsg){var o="1"===e.lastMsgType?"sysMsg":"msg";i.push(t.parser.unserialize(JSON.parse(e.lastMsg),o).then((function(r){var n;e.lastMsg="msg"===o?m(n=t.message).call(n,r):m(C).call(C,r)})))}})),e.promise=f.all(i).then((function(){e.obj={sessionList:n,hasMore:"1"===r.hasMore},r.minTimestamp&&(e.obj.minTimestamp=+r.minTimestamp)}))},w.onGetServerSession=function(e){var t,r,n=this,i=e.content&&e.content.session;if(i)if(i.id=i.id.split("|").join("-"),0===d(t=i.id).call(t,"super_team")&&(i.id="superTeam"+p(r=i.id).call(r,10)),i.updateTime=+i.updateTime,i.lastMsg){var o=e.content.session&&"1"===e.content.session.lastMsgType?"sysMsg":"msg";e.promise=n.parser.unserialize(JSON.parse(i.lastMsg),o).then((function(t){var r;i.lastMsg="msg"===o?m(r=n.message).call(r,t):m(C).call(C,t),e.obj=i}))}else e.obj=i},w.onUpdateServerSession=function(e){e.obj={}},w.onSyncUpdateServerSession=function(e){var t,r,n=this,i=this,o=e.content&&e.content.session;if(o)if(o.id=o.id.split("|").join("-"),0===d(t=o.id).call(t,"super_team")&&(o.id="superTeam"+p(r=o.id).call(r,10)),o.updateTime=+o.updateTime,o.lastMsg)i.parser.unserialize(JSON.parse(o.lastMsg),"msg").then((function(e){var t;o.lastMsg=m(t=i.message).call(t,e);try{n.options.onSyncUpdateServerSession(M.simpleClone(o))}catch(e){throw i.logger.error("userOption:onSyncUpdateServerSession function error",e),e}}));else try{this.options.onSyncUpdateServerSession(M.simpleClone(o))}catch(e){throw i.logger.error("userOption:onSyncUpdateServerSession function error",e),e}},w.mergeSession=function(e){e=M.copyWithNull(e);var t=this.sessionSet,r=e.id,n=t[r]||{},i=!1;return x.isComplete(e)?delete n.isDeleted:n.isDeleted&&(i=!0),t[r]=M.merge(n,e),e=i?e:t[r],M.undef(e.unread)&&(e.unread=0),e},w.mergeSessions=function(e){var t=this;return h(e=e||[]).call(e,(function(e){return t.mergeSession(e)}))},w.onDeleteSessions=function(e){var t;e.obj=h(t=e.obj.sessions).call(t,(function(e){return x.parse(e)}))},w.onUpdateSession=function(e){if(e){if(e=this.mergeSession(e),e=M.simpleClone(e),g(x).call(x,e),x.isComplete(e))return this.logger.info("session::onUpdateSession: ".concat(e.id),e.id,M.secureOutput("session",e)),this.options.onupdatesessions?this.options.onupdatesessions([e]):this.options.onupdatesession(e),e;this.logger.warn("session::onUpdateSession::session is not complete",M.secureOutput("session",e))}},w.onUpdateSessions=function(e){var t=this;if(e){e=t.mergeSessions(e),e=M.simpleClone(e),l(e).call(e,(function(e){g(x).call(x,e)}));var r=v(e).call(e,(function(e){return x.isComplete(e)})),n=v(e).call(e,(function(e){return!x.isComplete(e)}));if(n&&n.length>0&&t.logger.warn("session::onUpdateSessions::sessions is not complete",h(n).call(n,(function(e){return e.id})),M.secureOutput("session",n)),0!==r.length)return t.logger.info("session::onUpdateSessions:",M.secureOutput("session",r)),t.options.onupdatesessions?t.options.onupdatesessions(r):l(r).call(r,(function(e){t.options.onupdatesession(e)})),r;t.logger.warn("session::onUpdateSessions::completeSessions is empty")}},w.setCurrSession=function(e){e=""+e,this.currSessionId=e,this.logger.info("session::setCurrSession:",e)},w.resetSessionUnread=function(e){var t=e.id;this.db.enable&&this.db.updateSession({id:t,unread:0}),!this.options.autoMarkRead&&this.sessionUnreadMsgs&&this.sessionUnreadMsgs[t]&&(this.markMsgRead(this.sessionUnreadMsgs[t],!0),this.sessionUnreadMsgs[t]=[]),this.getSessionInCache(t)?this.onUpdateSession({id:t,unread:0}):this.onUpdateSession(_(_({},e),{},{unread:0}))},w.resetSessionsUnread=function(e){var t=this,r=this.db;r.enable&&h(e).call(e,(function(e){r.updateSession({id:e.id,unread:0})}));var n=!this.options.autoMarkRead&&this.sessionUnreadMsgs;e=h(e).call(e,(function(e){return n&&t.sessionUnreadMsgs[e.id]&&(t.markMsgRead(t.sessionUnreadMsgs[e.id],!0),t.sessionUnreadMsgs[e.id]=[]),t.getSessionInCache(e.id)?{id:e.id,unread:0}:_(_({},e),{},{unread:0})})),this.onUpdateSessions(e)},w.insertLocalSession=function(e){var t=this,r=t.db,n=e.scene+"-"+e.to,i=t.getSessionInCache(n);return i&&x.isComplete(i)?f.reject(E.sessionExist({callFunc:"session::insertLocalSession",session:i})):(r.enable?r.getMsgs({sessionId:n,limit:1}):f.resolve()).then((function(o){if(M.isArray(o)&&1===o.length){var s=o[0];(i=x.genSessionByMsg(s)).updateTime=s.time}else i={id:n,scene:e.scene,to:e.to,updateTime:+e.updateTime||+new Date,lastMsg:null};return t.onUpdateSession(i),r.enable?r.putSession(i):f.resolve(i)}))},w.checkAndUpdateLocalSessionByMsg=function(e){var t,r=this.db,n=this,i=this.options.syncSessionUnread&&e!==this.currSessionId,o=r.getMsgs({sessionId:e,limit:1}),s=r.getSession(e).then((function(o){if(o)return t=y({},o),o.ack=o.ack||0,i?r.getMsgs({sessionId:e,start:o.ack}):f.resolve();n.logger.error("can't find session that sessionId = ".concat(e))}));return f.all([o,s]).then((function(i){var o,s,a=c(i,2),u=a[0],d=a[1],p={id:e};if(!t)return n.logger.error("checkAndUpdateLocalSessionByMsg:can not find session",e),f.resolve(200);if(o=t&&!t.lastMsg?null:t.lastMsg.idClient,u&&u[0]?s=(u=u[0]).idClient:(s=null,u=null),o!==s&&(p.lastMsg=u),void 0!==d){var m=0;l(d=d||[]).call(d,(function(e){var t;try{t=n.options.shouldCountNotifyUnread(e)}catch(e){throw n.logger.error("userOption:shouldCountNotifyUnread function error",e),e}e.isUnreadable&&"in"===e.flow&&("notification"!==e.type||t)&&m++})),m!==t.unread&&(p.unread=m)}return b(p).length>1?(n.logger.info("session::checkAndUpdateLocalSessionByMsg::needUpdate newSession:",M.secureOutput("session",p)),r.updateSession(p).then((function(){return n.onUpdateSession(p)}))):f.resolve(200)}))},w.syncSessionsWithMoreRoaming=function(e){var t=this,r=e&&e.content&&e.content.sessions;if(r&&r.length){var n={0:"p2p",1:"team",5:"superTeam"};if(l(r).call(r,(function(e){var r,i=e.to===t.options.account?e.from:e.to;e.scene=n[e.scene],e.id=S(r="".concat(e.scene,"-")).call(r,i),e.time=+e.time})),this.db.enable){var i=this.db.putSessionsWithMoreRoaming(r);i.cmd="syncSessionsWithMoreRoaming",this.syncPromiseArray.push(i)}this.syncing&&this.syncResult?this.syncResult.sessionsWithMoreRoaming=r:this.logger.warn("syncSessionsWithMoreRoaming::not in syncing or no syncResult")}},w.syncStickTopSessions=function(e){var t=this,r=this.db,n=[],i=[],o=f.resolve(),s=e.content.sessions||[];this.syncing&&this.syncResult?(l(s).call(s,(function(e){var t=e.id.split("|");"super_team"===t[0]&&(t[0]="superTeam"),e.id=t.join("-"),e.scene=t[0],e.to=t[1],e.isTop=!0,n.push(t.join("-")),delete e.createTime,delete e.updateTime,r.enable&&i.push(r.putSession(e))})),r.enable&&(o=r.updateTimetag("stickTopSessions",e.content.timetag)),o.then((function(){return r.enable?r.getStickTopSessions():[]})).then((function(o){if(e.content.modify){var s=[];l(o).call(o,(function(e){d(n).call(n,e.id)>-1||(s.push(e.id),e.isTop=!1,e.topCustom="",i.push(r.putSession(e)))}))}else t.syncResult.stickTopSessions=o;return f.all(i)})),this.syncResult.stickTopSessions=s,o.cmd="syncStickTopSessions",this.syncPromiseArray.push(o)):this.logger.warn("syncSessionsWithMoreRoaming::not in syncing or no syncResult")},w.getSessionInCache=function(e,t){var r=this.sessionSet[e];return!r||r.isDeleted&&!t?void 0:r},w.deleteSessionInCache=function(e,t){var r=this;M.isArray(e)||(e=[e]),t?l(e).call(e,(function(e){r.sessionSet[e]&&(r.sessionSet[e].isDeleted=!0)})):l(e).call(e,(function(e){return delete r.sessionSet[e]})),this.logger.info("sessions::deleteSessionInCache::delete session done",e,t)},w.updateSessionInCache=function(e){return this.logger.info("session::updateSessionInCache: ".concat(e.id),e.id,e),this.getSessionInCache(e.id)?e=this.mergeSession(e):(this.logger.info("session::updateSessionInCache: can not find session in cache ".concat(e.id)),null)},w.updateSessionInDbWithNotify=function(e,t){var r=this;return new f((function(n,i){var o=r.db;if(r.getSessionInCache(e.id)){var s=f.resolve(),a=M.filterObj(e,"id lastMsg localCustom unread");o.enable&&(s=o.updateSession(a)),s.then((function(e){return r.onUpdateSession(e,t)})).then(n,(function(e){i({callFunc:"session::updateLocalSession",event:e})}))}else i(E.sessionNotExist({sessionId:e.id,callFunc:"session::updateLocalSession"}))}))}},function(e,t,r){var n=r(208);e.exports=function(e){if(n(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(145),i=r(75);e.exports=function(e,t){var r=null==e?null:void 0!==n&&i(e)||e["@@iterator"];if(null!=r){var o,s,a=[],c=!0,u=!1;try{for(r=r.call(e);!(c=(o=r.next()).done)&&(a.push(o.value),!t||a.length!==t);c=!0);}catch(e){u=!0,s=e}finally{try{c||null==r.return||r.return()}finally{if(u)throw s}}return a}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(3),i=r(10),o=r(13),s=r(42),a=r(29).fn,c=r(0);a.syncSessionAck=function(e){var t,r=this;if(this.logger.info("syncSessionAck::",e.content),r.syncing&&r.syncResult){r.saveAck.p2pTeam=e.content.timetag;var a={};n(t=[[e.content.p2p,"p2p"],[e.content.team.m_map,"team"]]).call(t,(function(e){var t,s=e[0],c=e[1];n(t=i(s)).call(t,(function(e){var t,n;a[o(t="".concat(c,"-")).call(t,e)]=s[e];var i={id:o(n="".concat(c,"-")).call(n,e),ack:s[e]};r.cacheSyncedSession(i)}))})),r.syncResult.ackMap?r.syncResult.ackMap=s(r.syncResult.ackMap,a):r.syncResult.ackMap=a}else r.logger.warn("syncSessionAck: not in syncing or no syncResult",r.syncing,!!r.syncResult)},a.syncSuperTeamSessionAck=function(e){var t,r=this;if(r.syncResult){r.saveAck.superTeam=e.content.timetag;var o={},a=e.content.superTeam.m_map;n(t=i(a)).call(t,(function(e){o["superTeam-".concat(e)]=a[e];var t={id:"superTeam-".concat(e),ack:a[e]};r.cacheSyncedSession(t)})),r.syncResult.ackMap?r.syncResult.ackMap=s(r.syncResult.ackMap,o):r.syncResult.ackMap=o}},a.onMarkSessionAck=function(e){e.error||this.storeSessionAck(e.obj)},a.syncMarkSessionAck=function(e){this.storeSessionAck(e.content,!0)},a.storeSessionAck=function(e,t){var r;if(this.options.syncSessionUnread&&e){var n;switch(e.scene){case 0:n="p2p";break;case 1:n="team";break;default:n="superTeam"}var i=o(r="".concat(n,"-")).call(r,e.to),s=e.timetag;if(s<=((this.getSessionInCache(i)||{}).ack||0))this.logger.warn("session::storeSessionAck: ack <= ackInMemory",s);else{var a={id:i,ack:s};this.mergeSession(a),this.logger.info("session::storeSessionAck:",c.secureOutput("session",a)),this.markUnreadBySessionAck({sessionId:i,ack:a.ack},t)}}},a.markUnreadBySessionAck=function(e,t){var r=e.sessionId,n=e.ack,i=this,o=i.db;if(o.enable)i.pushMsgTask((function(){return o.getMsgCountAfterAck({shouldCountNotifyUnread:i.options.shouldCountNotifyUnread,sessionId:r,ack:n}).then((function(e){var s={id:r,unread:e,ack:n};return i.logger.info("session::markUnreadBySessionAck: db.getMsgCountAfterAck done",s),i.syncing?i.cacheSyncedSession(s):t&&i.onUpdateSession(s),o.updateSession(s)})).catch((function(e){i.logger.error("markUnreadBySessionAck::error",e)}))}));else{var s=i.getSessionInCache(r);if(s){var a=s.unreadMsgs;if(a&&a.length){for(var c=0,u=[],l=a.length-1;l>=0;l--){var d=a[l];if(!(d.time>n))break;c++,u.push(d)}s.unreadMsgs=u,s.unread=c,i.logger.info("session::markUnreadBySessionAck: unread ".concat(c)),i.syncing?i.cacheSyncedSession(s):t&&i.onUpdateSession(s)}}}}},function(e,t,r){var n=r(29).fn;n.processChatroom=function(e){if("getChatroomAddress"===e.cmd)this.onChatroomAddress(e)},n.onChatroomAddress=function(e){e.error||(e.obj.address=e.content.address)}},function(e,t,r){var n=r(29).fn;n.processQchat=function(e){if("getQChatAddress"===e.cmd)this.onQChatAddress(e)},n.onQChatAddress=function(e){e.error||(e.obj.address=e.content.address)}},function(e,t,r){r(29).fn.processFilter=function(e){switch(e.cmd){case"sendFilterMsg":this.onSendMsg(e,!0);break;case"filterMsg":this.onMsg(e,!0);break;case"filterSysMsg":this.onSysMsg(e,!0);break;case"sendFilterCustomSysMsg":this.onSendSysMsg(e,!0)}}},function(e,t,r){var n=r(8),i=r(39),o=r(29).fn,s=r(0),a=i.clientTypeMap;function c(e){e=e||{};var t=s.copy(e);return t.clientType&&(t.clientType=a[t.clientType]||""),t.serverCustom&&(t.custom=JSON.parse(t.serverCustom),"string"==typeof t.custom[0]&&(t.custom=t.custom[0]),delete t.serverCustom),t}o.processEventService=function(e){var t=e.content,r=e.error,i=this.options||{};switch(r&&(r.callFunc="events::processsEventService",this.onCustomError("事件服务解包失败","EVENT_SERVICE_ERROR",r)),e.cmd){case"pushEvent":if(s.isFunction(i.onpushevents)){var o={msgEvents:[c(t.msgEvent)]};try{i.onpushevents(o)}catch(r){throw this.logger.error("userOption:onpushevents function error",r),r}}break;case"pushEvents":if(s.isFunction(i.onpushevents)){var a=t.msgEvents;a={msgEvents:n(a).call(a,(function(e){return c(e)}))};try{i.onpushevents(a)}catch(r){throw this.logger.error("userOption:onpushevents function error",r),r}}}}},function(e,t,r){var n=r(29).fn,i=r(0);n.processProxyService=function(e){var t=e.error;switch(t&&(t.callFunc="events::processProxyService",this.onCustomError("proxyService","EVENT_PROXY_SERVICE_ERROR",t)),e.cmd){case"onProxyMsg":if(i.isFunction(this.options.onProxyMsg)){var r=e.content.proxyMsg||{};r.time&&(r.time=+r.time),this.options.onProxyMsg(r)}break;case"httpProxy":e.obj=e.content&&e.content.proxyTag}}},function(e,t,r){var n=r(5),i=r(8),o=r(0),s=function(e){this.account=e.account},a=s.prototype,c=a.Message=r(80),u=a.TextMessage=r(555),l=a.FileMessage=r(152),d=a.GeoMessage=r(559),p=a.NotificationMessage=r(560),m=a.CustomMessage=r(561),f=a.TipMessage=r(562),h=a.RobotMessage=r(563),g=a.G2Message=r(564);a.validScenes=c.validScenes,a.validTypes=c.validTypes,a.sceneMap=c.sceneMap,a.sceneReverseMap=c.sceneReverseMap,a.reverse=function(e){var t;switch(c.getType(e)){case"text":t=n(u).call(u,e);break;case"image":case"audio":case"video":case"file":t=n(l).call(l,e);break;case"geo":t=n(d).call(d,e);break;case"notification":t=n(p).call(p,e);break;case"custom":t=n(m).call(m,e);break;case"tip":t=n(f).call(f,e);break;case"g2":t=n(g).call(g,e);break;case"robot":t=n(h).call(h,e);break;default:t=n(c).call(c,e)}return c.setExtra(t,this.account),t},a.reverseMsgs=function(e,t){var r,s,a=this;return i(e).call(e,(function(e){return e=n(a).call(a,e),t&&((r=t.modifyObj)&&(e=o.merge(e,r)),s=t.mapper,o.isFunction(s)&&(e=s(e))),e}))},e.exports=s},function(e,t,r){var n=r(15),i=r(5),o=r(80),s=r(0);function a(e){s.verifyOptions(e,"text","msg::TextMessage"),e.type="text",o.call(this,e)}a.prototype=n(o.prototype),a.reverse=function(e){return i(o).call(o,e)},e.exports=a},function(e,t,r){var n=r(15),i=r(152);function o(){}o.prototype=n(i.prototype),o.verifyFile=function(e,t){return!0},e.exports=o},function(e,t,r){var n=r(15),i=r(152);function o(){}o.prototype=n(i.prototype),o.verifyFile=function(){},e.exports=o},function(e,t,r){var n=r(15),i=r(152);function o(){}o.prototype=n(i.prototype),o.verifyFile=function(){},e.exports=o},function(e,t,r){var n=r(11),i=r(15),o=r(5),s=r(80),a=r(0);function c(e){e.type="geo",a.verifyOptions(e,"geo","msg::GeoMessage"),a.verifyOptions(e.geo,"lng lat title",!0,"geo.","msg::GeoMessage"),a.verifyParamType("geo.lng",e.geo.lng,"number","msg::GeoMessage"),a.verifyParamType("geo.lat",e.geo.lat,"number","msg::GeoMessage"),a.verifyParamType("geo.title",e.geo.title,"string","msg::GeoMessage"),s.call(this,e),this.attach=n(e.geo)}c.prototype=i(s.prototype),c.reverse=function(e){var t=o(s).call(s,e);return e.attach=e.attach?""+e.attach:"",t.geo=e.attach?JSON.parse(e.attach):{},t},e.exports=c},function(e,t,r){var n=r(15),i=r(5),o=r(8),s=r(116),a=r(0).notundef,c=r(80),u=r(113).IM,l=r(140),d=r(151),p={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function m(){}m.prototype=n(c.prototype),m.reverse=function(e){var t=i(c).call(c,e);if(e.attach=e.attach?""+e.attach:"",e.attach){var r=JSON.parse(e.attach);if(t.attach={type:p[r.id]||r.id},a(r.data)){var n,m,f=r.data;a(f.tinfo)&&(t.attach.team=i(l).call(l,u.syncUnserialize(f.tinfo,"team"),!0)),a(f.ids)&&(t.attach.accounts=f.ids),a(f.id)&&(t.attach.account=f.id),a(f.uinfos)&&(t.attach.users=o(n=f.uinfos).call(n,(function(e){return i(d).call(d,u.syncUnserialize(e,"user"))}))),a(f.mute)&&(t.attach.mute=1==+f.mute),a(f.attach)&&(t.attach.custom=f.attach),a(f.channel)&&(t.attach.channelId=f.channel),a(f.calltype)&&(t.attach.netcallType=f.calltype),a(f.duration)&&(t.attach.duration=f.duration),a(f.time)&&(t.attach.time=f.time),a(f.from)&&(t.attach.from=f.from),a(f.ext)&&(t.attach.ext=f.ext),t.attach.accounts&&t.attach.accounts.length<=2&&t.from===t.to&&s(m=t.attach.accounts).call(m,(function(e){if(e!==t.to)return t.to=e,!0}))}}else t.attach={};return t},e.exports=m},function(e,t,r){var n=r(15),i=r(5),o=r(80),s=r(0);function a(e){s.verifyOptions(e,"content","msg::CustomMessage"),e.type="custom",o.call(this,e),this.attach=e.content}a.prototype=n(o.prototype),a.reverse=function(e){var t=i(o).call(o,e);return t.content=e.attach,t},e.exports=a},function(e,t,r){var n=r(15),i=r(5),o=r(80),s=r(0);function a(e){s.verifyOptions(e,"tip","msg::TipMessage"),e.type="tip",o.call(this,e),this.body=e.tip}a.prototype=n(o.prototype),a.reverse=function(e){var t=i(o).call(o,e);return t.text="",t.tip=e.body,e.attach&&(t.attach=e.attach),t},e.exports=a},function(e,t,r){var n=r(11),i=r(15),o=r(5),s=r(8),a=r(80),c=r(0),u={welcome:"00",text:"01",link:"03"},l={"01":"text","02":"image","03":"answer",11:"template"};function d(e){c.verifyOptions(e,"content","msg::RobotMessage"),c.undef(e.robotAccid)&&(e.robotAccid=e.to);var t=e.content;switch(t.type){case"welcome":c.undef(e.body)&&(this.body="欢迎消息");break;case"text":c.verifyOptions(t,"content","msg::RobotMessage"),c.undef(e.body)&&(this.body=t.content);break;case"link":c.verifyOptions(t,"target","msg::RobotMessage")}t.type&&(t.type=u[t.type]),t={param:t,robotAccid:e.robotAccid},this.attach=n(t),e.type="robot",a.call(this,e)}d.prototype=i(a.prototype),d.reverse=function(e){var t=o(a).call(a,e);if("robot"===t.type){var r=JSON.parse(e.attach);if(r.param&&(r.param.type=l[r.param.type]||"unknown"),r.robotMsg){var n=(r=c.merge(r,r.robotMsg)).message;"bot"===r.flag?r.message=s(n).call(n,(function(e){return e.type=l[e.type]||"unknown",e})):r.flag,delete r.robotMsg}t.content=r}return t},e.exports=d},function(e,t,r){var n=r(11),i=r(15),o=r(5),s=r(80),a=r(0);function c(e){a.verifyOptions(e,"attach","msg::G2Message"),e.type="g2",s.call(this,e),this.attach=n(e.attach)}c.prototype=i(s.prototype),c.reverse=function(e){var t=o(s).call(s,e);return e.attach&&(t.attach=JSON.parse(e.attach)),t},e.exports=c},function(e,t,r){var n=r(61),i=r(219),o=r(27),s=r(220),a=r(8),c=r(19),u=r(6),l=r(4),d=r(3),p=r(42),m=r(10),f=r(57),h=r(58),g=r(59),v=r(60),y=r(49);function b(e,t){var r=m(e);if(f){var n=f(e);t&&(n=c(n).call(n,(function(t){return h(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r,i,o=null!=arguments[t]?arguments[t]:{};t%2?d(r=b(Object(o),!0)).call(r,(function(t){n(e,t,o[t])})):g?v(e,g(o)):d(i=b(Object(o))).call(i,(function(t){y(e,t,h(o,t))}))}return e}var T=r(32).fn,_=r(0),w=_.isArray,M=r(117);T.mergeObjArray=function(e,t,r){return e||(e=[]),t?(w(t)||(t=[t]),t.length?(r=r||{},_.mergeObjArray(e,t,r)):e):e},T.cutObjArray=function(e,t,r){return e&&t?(w(t)||(t=[t]),t.length?(r=r||{},_.cutObjArray(e,t,r)):e):e},T.mergeLoginPorts=function(e,t){return this.mergeObjArray(e,t,{keyPath:"deviceId"})},T.cutLoginPorts=function(e,t){return this.cutObjArray(e,t,{keyPath:"deviceId",sortPath:"type"})},T.mergeRelations=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},T.cutRelations=function(e,t){return this.cutObjArray(e,t,{keyPath:"account"})},T.findRelation=function(e,t){return _.findObjInArray(e,{keyPath:"account",value:t})},T.mergeFriends=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},T.cutFriends=function(e,t){return this.cutObjArray(e,t,{keyPath:"account"})},T.cutFriendsByAccounts=function(e,t){w(t)||(t=[t]);var r=a(t).call(t,(function(e){return{account:e}}));return this.cutFriends(e,r)},T.findFriend=function(e,t){return _.findObjInArray(e,{keyPath:"account",value:t})},T.mergeUsers=function(e,t){return this.mergeObjArray(e,t,{keyPath:"account"})},T.findUser=function(e,t){return _.findObjInArray(e,{keyPath:"account",value:t})},T.mergeTeams=function(e,t){return this.mergeObjArray(e,t,{keyPath:"teamId"})},T.cutTeams=function(e,t){return this.cutObjArray(e,t,{keyPath:"teamId"})},T.findTeam=function(e,t){return _.findObjInArray(e,{keyPath:"teamId",value:t})},T.assembleTeamOwner=M.assembleOwner,T.assembleTeamMembers=M.assembleMembers,T.genTeamMemberId=M.genId,T.mergeTeamMembers=function(e,t){return this.mergeObjArray(e,t)},T.cutTeamMembers=function(e,t){return this.cutObjArray(e,t)},T.cutTeamMembersByAccounts=function(e,t,r){w(r)||(r=[r]);var n=M.assembleMembers({teamId:t},r);return this.cutTeamMembers(e,n)},T.findTeamMember=function(e,t){return _.findObjInArray(e,{keyPath:"id",value:t})},T.mergeSessions=function(e,t){return this.mergeObjArray(e,t,{sortPath:"updateTime",desc:!0})},T.cutSessions=function(e,t){return this.cutObjArray(e,t)},T.cutSessionsByIds=function(e,t){w(t)||(t=[t]);var r=a(t).call(t,(function(e){return{id:e}}));return this.cutSessions(e,r)},T.findSession=function(e,t){return _.findObjInArray(e,{keyPath:"id",value:t})},T.mergeMsgs=function(e,t){return this.mergeObjArray(e,t,{keyPath:"idClient",sortPath:"time"})},T.cutMsgs=function(e,t){return this.cutObjArray(e,t,{keyPath:"idClient"})},T.cutMsgsByIdClients=function(e,t){w(t)||(t=[t]);var r=a(t).call(t,(function(e){return{idClient:e}}));return this.cutMsgs(e,r)},T.findMsg=function(e,t){return _.findObjInArray(e,{keyPath:"idClient",value:t})},T.mergeSysMsgs=function(e,t){return this.mergeObjArray(e,t,{keyPath:"idServer",desc:!0})},T.cutSysMsgs=function(e,t){return this.cutObjArray(e,t,{keyPath:"idServer"})},T.cutSysMsgsByIdServers=function(e,t){w(t)||(t=[t]);var r=a(t).call(t,(function(e){return{idServer:e}}));return this.cutSysMsgs(e,r)},T.findSysMsg=function(e,t){return _.findObjInArray(e,{keyPath:"idServer",value:t})},T.searchLocal=function(e){if(_.verifyOptions(e,"keyword","searchLocal"),this.db.enable){var t,r=this,n=this.db,f=e.keyword+"",h=["account","nick","alias"],g=["id","scene","lastMsg.type","lastMsg.text","localCustom","target.account","target.nick","target.alias","target.name"],v="",y=e.keyPath;switch(y?(v=(y=(y+"").split(".")).shift(),y=y.join(".")):v="all",v){case"user":y&&(h=c(h).call(h,(function(e){return e===y||0===u(e).call(e,y+".")}))),w(h).then((function(t){e.done(null,{sessions:[],users:t})}));break;case"session":y&&(g=c(g).call(g,(function(e){return e===y||0===u(e).call(e,y+".")}))),b(g,!y||u(y).call(y,"target")>-1).then((function(t){e.done(null,{sessions:t,users:[]})}));break;case"all":x().then((function(){l.all([b(g,!0),w(h)]).then((function(t){e.done(null,{sessions:t[0],users:t[1]})}))}));break;default:e.done(null,{sessions:[],users:[],msg:'keyPath must start with "user" or "session"'})}}else e.done(null,{sessions:[],users:[],msg:"no db"});function b(e,t){return T.apply(this,arguments)}function T(){return(T=s(i.mark((function e(t,r){var o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r?[n.getSessions(),x(),n.getTeams(),n.getSuperTeams()]:[n.getSessions()],e.abrupt("return",l.all(o).then((function(e){var n,i=e[0]||[],o={p2p:e[1]||[],team:e[2]||[],superTeam:e[3]||[]},s={};return r&&(d(n=m(o)).call(n,(function(e){var t;d(t=o[e]).call(t,(function(t){var r=t.teamId||t.account;s[e+"-"+r]=t}))})),d(i).call(i,(function(e){e.target=s[e.id]}))),C(t,i)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return M.apply(this,arguments)}function M(){return(M=s(i.mark((function e(t){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x();case 2:return r=e.sent,e.abrupt("return",C(t,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return E.apply(this,arguments)}function E(){return(E=s(i.mark((function e(){var n,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,r.db.getFriends();case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0=[];case 7:return n=e.t0,o=r.protocol.userSet||{},t=a(n).call(n,(function(e){return S(S({},e),o[e.account])})),e.abrupt("return",t);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){var r=[];return d(t).call(t,(function(t){for(var n=0;n<e.length;n++){var i=R(t,e[n].split("."));if(i&&u(i).call(i,f)>-1){r.push(p({},t));break}}})),r}function R(e,t){if("object"===o(e)&&e)return 1===t.length?e[t[0]]:R(e[t.shift()],t)}}},function(e,t,r){var n=r(17),i=r(32).fn,o=r(0);i.kick=function(e){var t;o.verifyOptions(e,"deviceIds","link::kick"),this.processCallback(e),this.sendCmd("kick",{deviceIds:n(t=e.deviceIds).call(t,0)},e.callback)},i.disconnect=function(e){e=e||{},this.protocol.disconnect(e.done)}},function(e,t,r){var n=r(32).fn,i=r(0);n.markInBlacklist=function(e){i.verifyOptions(e,"account isAdd","relation::markInBlacklist"),i.verifyParamType("isAdd",e.isAdd,"boolean","relation::markInBlacklist"),this.processCallback(e),this.sendCmd("markInBlacklist",{account:e.account,isAdd:e.isAdd},e.callback)},n.addToBlacklist=function(e){return e.isAdd=!0,this.markInBlacklist(e)},n.removeFromBlacklist=function(e){return e.isAdd=!1,this.markInBlacklist(e)},n.markInMutelist=function(e){i.verifyOptions(e,"account","relation::markInMutelist"),i.verifyParamType("isAdd",e.isAdd,"boolean","relation::markInMutelist"),this.processCallback(e),this.sendCmd("markInMutelist",{account:e.account,isAdd:e.isAdd},e.callback)},n.addToMutelist=function(e){return e.isAdd=!0,this.markInMutelist(e)},n.removeFromMutelist=function(e){return e.isAdd=!1,this.markInMutelist(e)},n.getRelations=function(e){var t=this,r=t.db,n=0;function o(){t.sendCmd("getRelations",{timetag:n,NOTSTORE:"timetag"},e.callback)}e=i.verifyOptions(e),t.processCallback(e),r.enable?r.getRelationsTimetag().then((function(e){n=e,o()}),o):o()}},function(e,t,r){var n=r(13),i=r(3),o=r(6),s=r(32).fn,a=r(0),c=a.objs2accounts,u=r(151);s.updateMyInfo=function(e){a.verifyOptions(e),this.processCallback(e),e.user=new u(e),delete e.user.account,this.sendCmd("updateMyInfo",{user:e.user,antispamTag:{antiSpamBusinessId:e.antiSpamBusinessId},single:!0},e.callback)},s.getMyInfo=function(e){return(e=e||{}).account=this.account,this.getUser(e)},s.getUser=function(e){var t,r=this,n=r.db;function i(){r.sendCmd("getUsers",{accounts:[t],single:!0},e.callback)}a.verifyOptions(e,"account","user::getUser"),r.processCallback(e),e.cbaop=function(e,n){if(!e)return n=n[0]||null,r.logger.info("api::getUser: cbaop ".concat(t)),n},t=e.account,e.sync?i():n.enable?n.getUser(t).then((function(t){t?e.done(null,t):i()}),i):i()},s.getUsers=function(e){var t,r=this,s=r.db,u=[];function l(){r.sendCmd("getUsers",{accounts:t,single:!0},e.callback)}a.verifyOptions(e,"accounts","user::getUsers"),a.verifyParamType("accounts",e.accounts,"array","user::getUsers"),r.processCallback(e),e.cbaop=function(e,i){if(!e)return i=n(i).call(i,u),r.logger.info("api::getUsers: cbaop ".concat(t)),i},t=a.deduplicate(e.accounts),a.verifyArrayMax("accounts",e.accounts,150,"user::getUsers"),e.sync?l():s.enable?s.getUsers(t).then((function(r){if(r&&r.length===t.length)e.done(null,r);else{u=r;var n=c(r),s=[];i(t).call(t,(function(e){-1===o(n).call(n,e)&&s.push(e)})),t=s,l()}}),l):l()}},function(e,t,r){var n=r(109),i=r(32).fn,o=r(0),s=o.notundef,a=r(476);i.friendRequest=function(e){o.verifyOptions(e,"type account","friend::friendRequest"),o.verifyParamValid("type",e.type,a.validTypes(),"friend::friendRequest"),this.processPs(e),this.processCallback(e);var t={account:e.account,type:a.getByteFromType(e.type),ps:e.ps};s(e.idServer)&&(t.idServer=e.idServer),this.sendCmd("friendRequest",t,e.callback)},i.addFriend=function(e){e.type="addFriend",this.friendRequest(e)},i.applyFriend=function(e){e.type="applyFriend",this.friendRequest(e)},i.passFriendApply=function(e){o.verifyOptions(e,"idServer","friend::passFriendApply"),e.type="passFriendApply",this.friendRequest(e)},i.rejectFriendApply=function(e){o.verifyOptions(e,"idServer","friend::rejectFriendApply"),e.type="rejectFriendApply",this.friendRequest(e)},i.deleteFriend=function(e){o.verifyOptions(e,"account","friend::deleteFriend");var t=!0===e.delAlias;this.processCallback(e),this.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:t?1:0}},e.callback)},i.updateFriend=function(e){this.processCallback(e);var t=new a(e);this.sendCmd("updateFriend",{friend:t,single:!0},e.callback)},i.getFriends=function(e){var t=this.db;o.validate({timetag:{type:"number",required:!1}},e,"friend::getFriends"),this.processCallback(e),t.enable?t.getFriends({updateTime:e.updateTime||0}).then((function(t){(t=n(t).call(t,(function(e,t){return e.updateTime-t.updateTime}))).invalid=[],e.done(null,t)})):this.sendCmd("getFriends",{timetag:e.updateTime||0,NOTSTORE:"timetag"},e.callback)},i.isMyFriend=function(e){var t=this.db;o.validate({account:{type:"string",allowEmpty:!1,require:!0}},e),this.processCallback(e),t.enable||e.done(null,!1),t.getFriend(e.account).then((function(t){t&&!0===t.valid?e.done(null,!0):e.done(null,!1)}))},i.isUserInBlackList=function(e){var t=this.db;o.validate({account:{type:"string",allowEmpty:!1,require:!0}},e),this.processCallback(e),t.enable||e.done(null,!1),t.getUserFromBlackList(e.account).then((function(t){t&&t.account?e.done(null,!0):e.done(null,!1)}))}},function(e,t,r){r(32).fn.getRobots=function(e){this.logger.warn("this api will be abandon"),(e=e||{}).type="getRobots",this.processCallback(e),this.sendCmd("sync",{sync:{robots:0}},e.callback)}},function(e,t,r){var n=r(17),i=r(8),o=r(19),s=r(4),a=r(32).fn,c=r(0),u=c.undef,l=r(140),d=r(117);a.createTeam=function(e){var t;c.verifyOptions(e,"type name","team::createTeam"),u(e.accounts)?e.accounts=[]:c.verifyParamType("accounts",e.accounts,"array","team::createTeam"),e.action="create",this.processPs(e),this.processCallback(e),e.team=new l(e);var r={team:e.team,accounts:n(t=e.accounts).call(t,0),ps:e.ps,antispamTag:{antiSpamBusinessId:e.antiSpamBusinessId}};this.sendCmd("createTeam",r,e.callback)},a.updateTeam=function(e){c.verifyOptions(e,"teamId","team::updateTeam"),e.action="update",this.processCallback(e),e.team=new l(e),this.sendCmd("updateTeam",{team:e.team,antispamTag:{antiSpamBusinessId:e.antiSpamBusinessId},single:!0},e.callback)},a.addTeamMembers=function(e){var t;c.verifyOptions(e,"teamId accounts","team::addTeamMembers"),c.verifyParamType("accounts",e.accounts,"array","team::addTeamMembers"),this.processPs(e),c.notexist(e.custom)&&(e.custom=""),this.processCallback(e);var r={teamId:e.teamId,accounts:n(t=e.accounts).call(t,0),ps:e.ps,attach:e.custom};this.sendCmd("addTeamMembers",r,e.callback)},a.removeTeamMembers=function(e){var t;c.verifyOptions(e,"teamId accounts","team::removeTeamMembers"),c.verifyParamType("accounts",e.accounts,"array","team::removeTeamMembers"),this.processCallback(e);var r={teamId:e.teamId,accounts:n(t=e.accounts).call(t,0)};this.sendCmd("removeTeamMembers",r,e.callback)},a.acceptTeamInvite=function(e){c.verifyOptions(e,"idServer teamId from","team::acceptTeamInvite"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,type:"teamInvite"};this.sendCmd("acceptTeamInvite",t,e.callback)},a.rejectTeamInvite=function(e){c.verifyOptions(e,"idServer teamId from","team::rejectTeamInvite"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps,type:"teamInvite"};this.sendCmd("rejectTeamInvite",t,e.callback)},a.applyTeam=function(e){c.verifyOptions(e,"teamId","team::applyTeam"),this.processPs(e),this.processCallback(e);var t={teamId:e.teamId,ps:e.ps};this.sendCmd("applyTeam",t,e.callback)},a.passTeamApply=function(e){c.verifyOptions(e,"idServer teamId from","team::passTeamApply"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,type:"applyTeam"};this.sendCmd("passTeamApply",t,e.callback)},a.rejectTeamApply=function(e){c.verifyOptions(e,"idServer teamId from","team::rejectTeamApply"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps,type:"applyTeam"};this.sendCmd("rejectTeamApply",t,e.callback)},a.addTeamManagers=function(e){var t;c.verifyOptions(e,"teamId accounts","team::addTeamManagers"),c.verifyParamType("accounts",e.accounts,"array","team::addTeamManagers"),this.processCallback(e);var r={teamId:e.teamId,accounts:n(t=e.accounts).call(t,0)};this.sendCmd("addTeamManagers",r,e.callback)},a.removeTeamManagers=function(e){var t;c.verifyOptions(e,"teamId accounts","team::removeTeamManagers"),c.verifyParamType("accounts",e.accounts,"array","team::removeTeamManagers"),this.processCallback(e);var r={teamId:e.teamId,accounts:n(t=e.accounts).call(t,0)};this.sendCmd("removeTeamManagers",r,e.callback)},a.updateInfoInTeam=function(e){c.verifyOptions(e,"teamId","team::updateInfoInTeam"),this.processCallback(e),this.sendCmd("updateInfoInTeam",{teamMember:new d(e),single:!0},e.callback)},a.updateNickInTeam=function(e){c.verifyOptions(e,"teamId account","team::updateNickInTeam"),this.processCallback(e),this.sendCmd("updateNickInTeam",{teamMember:new d(e),single:!0},e.callback)},a.updateMuteStateInTeam=function(e){c.verifyOptions(e,"teamId account mute","team::updateMuteStateInTeam"),this.processCallback(e),e.mute=e.mute?1:0,this.sendCmd("updateMuteStateInTeam",e)},a.getMutedTeamMembers=function(e){c.verifyOptions(e,"teamId","team::getMutedTeamMembers"),this.processCallback(e),this.sendCmd("getMutedTeamMembers",e)},a.leaveTeam=function(e){c.verifyOptions(e,"teamId","team::leaveTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("leaveTeam",t,e.callback)},a.transferTeam=function(e){c.verifyOptions(e,"teamId account leave","team::transferTeam"),c.verifyParamType("leave",e.leave,"boolean","team::transferTeam"),this.processCallback(e);var t={teamId:e.teamId,account:e.account,leave:e.leave};this.sendCmd("transferTeam",t,e.callback)},a.dismissTeam=function(e){c.verifyOptions(e,"teamId","team::dismissTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("dismissTeam",t,e.callback)},a.getTeam=function(e){var t,r=this,n=r.db;function i(){r.sendCmd("getTeam",{teamId:e.teamId},e.callback)}c.verifyOptions(e,"teamId","team::getTeam"),r.processCallback(e),e.cbaop=function(e){e||r.logger.info("api::getTeam: cbaop ".concat(t))},t=e.teamId,n.enable&&!e.sync?n.getTeam(t).then((function(n){n&&n.validToCurrentUser?(r.logger.log("api::getTeam: db.getTeam ".concat(t)),e.done(null,n)):i()}),i):i()},a.getTeams=function(e){var t=this,r=t.db,n=0;function i(){t.sendCmd("getTeams",{timetag:n,NOTSTORE:"timetag"},e.callback)}c.verifyOptions(e),t.processCallback(e),r.enable?r.getTeamsTimetag().then((function(e){n=e,i()}),i):i()},a.getTeamsById=function(e){c.verifyOptions(e,"teamIds","teams::getTeamsById"),this.processCallback(e),this.sendCmd("getTeamsById",{teamIds:e.teamIds},e.callback)},a.getTeamMembers=function(e){c.verifyOptions(e,"teamId","team::getTeamMembers"),this.processCallback(e),this.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0,NOTSTORE:"timetag"},e.callback)},a.getTeamMemberByTeamIdAndAccount=function(e){c.verifyParamType("teamId",e.teamId,"numeric or numeric string","team::getTeamMemberByTeamIdAndAccount"),c.verifyOptions(e,"account","team::getTeamMemberByTeamIdAndAccount"),this.processCallback(e),this.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0,NOTSTORE:"timetag"},(function(t,r,n){var i={};if(r&&r.members&&r.members.length)for(var o=0;o<r.members.length;o++)if(r.members[o].account===e.account){i[e.account]=r.members[o];break}e.callback(t,i,n)}))},a.getTeamMemberInvitorAccid=function(e){c.verifyParamType("teamId",e.teamId,"numeric or numeric string","team::getTeamMemberInvitorAccid"),u(e.accounts)||(c.verifyParamType("accounts",e.accounts,"array","team::getTeamMemberInvitorAccid"),e.accounts.length>200&&c.onParamError("accounts 参数数组长度不能超过200","team::getTeamMemberInvitorAccid"));var t,r={teamId:e.teamId};e.accounts.length&&(r.accounts=n(t=e.accounts).call(t,0)),this.processCallback(e),this.sendCmd("getTeamMemberInvitorAccid",r,(function(t,r,n){e.callback(t,n&&n.accountsMap||{})}))},a.notifyForNewTeamMsg=function(e){c.verifyOptions(e,"teamIds","team::notifyForNewTeamMsg"),this.protocol.notifyForNewTeamMsg(e.teamIds).then((function(t){e.done(t.error||null,i(t),t.miss)}),(function(t){e.done(t)}))},a.getMyTeamMembers=function(e){c.verifyOptions(e,"teamIds","team::getMyTeamMembers");var t=this.processCallbackPromise(e);return this.sendCmd("getMyTeamMembers",e),t},a.getLocalTeams=function(e){var t,r=this.db,n=[];function i(){e.teams=n,e.done(t,e)}c.verifyOptions(e,"teamIds","team::getLocalTeams"),c.verifyParamType("teamIds",e.teamIds,"array","team::getLocalTeams"),this.processCallback(e),r.enable?r.getTeamsByTeamIds(e.teamIds).then((function(e){n=o(e).call(e,(function(e){return!!e})),i()}),(function(e){t=e,i()})):i()},a.getLocalTeamMembers=function(e){var t,r=this.db,n=[];function i(){e.members=n,e.done(t,e)}c.verifyOptions(e,"teamId accounts","team::getLocalTeamMembers"),c.verifyParamType("accounts",e.accounts,"array","team::getLocalTeamMembers"),this.processCallback(e),r.enable?r.getInvalidTeamMembers(e.teamId,e.accounts).then((function(e){n=o(e).call(e,(function(e){return!!e})),i()}),(function(e){t=e,i()})):i()},a.deleteLocalTeam=function(e){var t,r=this.db;function n(){e.done(t,e)}c.verifyOptions(e,"teamId","team::deleteLocalTeam"),this.processCallback(e),r.enable?r.deleteTeam(e.teamId).then((function(){n()}),(function(e){t=e,n()})):n()},a.muteTeamAll=function(e){c.verifyOptions(e,"teamId mute","team::muteTeamAll"),e.mute=e.mute?1:0,this.processCallback(e),this.sendCmd("muteTeamAll",e)},a.sendTeamMsgReceipt=function(e){c.verifyOptions(e,"teamMsgReceipts","team::sendTeamMsgReceipt"),e.teamMsgReceipts.length>50?this.logger.error("team::sendTeamMsgReceipt：teamMsgReceipts length over 50"):(this.processCallback(e),this.sendCmd("sendTeamMsgReceipt",e))},a.getTeamMsgReads=function(e){c.verifyOptions(e,"teamMsgReceipts","team::getTeamMsgReads"),this.processCallback(e),this.sendCmd("getTeamMsgReads",e)},a.getTeamMsgReadAccounts=function(e){var t,r=this,n=this;c.verifyOptions(e,"teamMsgReceipt","team::getTeamMsgReadAccounts"),e.callback=function(r,n,i){r&&t?(n=n||{teamMsgReceipt:e.teamMsgReceipt},e.done(r,n,{teamMsgReceipt:e.teamMsgReceipt,unreadAccounts:t.unreadAccounts,readAccounts:t.readAccounts})):e.done(r,n,i)},this.db.enable&&e.teamMsgReceipt.idClient?this.db.getMsgReadDetail(e.teamMsgReceipt.idClient).then((function(r){if(t=r,!r)return s.reject("no record");if(r.unreadAccounts&&r.unreadAccounts.length>0)return s.reject("unreadAccounts.length > 0");var i={teamMsgReceipt:e.teamMsgReceipt,unreadAccounts:r.unreadAccounts,readAccounts:r.readAccounts};n.logger.info("getTeamMsgReadAccounts from db"),e.done(null,{teamMsgReceipt:e.teamMsgReceipt},i)})).catch((function(t){r.logger.warn("db.getMsgReadDetail invalid",t),n.sendCmd("getTeamMsgReadAccounts",e)})):n.sendCmd("getTeamMsgReadAccounts",e)}},function(e,t,r){var n=r(480),i=r(4),o=r(5),s=r(23),a=r(17),c=r(8),u=r(3),l=r(13),d=r(32).fn,p=r(0),m=p.undef,f=r(215),h=r(150);function g(e){var t=this.db;if(!t.enable)return i.resolve({valid:!1});var r=t.getSuperTeam(e),o=t.getSuperTeamMembersTimetag(e);return i.all([r,o]).then((function(e){var t=n(e,2),r=t[0],o=t[1],s=r&&r.memberUpdateTime,a={timetag:o=o||0};return s&&o>=s&&(a.valid=!0),i.resolve(a)})).catch((function(){return i.resolve({timetag:0})}))}d.addSuperTeamMembers=function(e){p.verifyOptions(e,"teamId accounts","superTeam::addSuperTeamMembers"),p.verifyParamType("accounts",e.accounts,"array","superTeam::addSuperTeamMembers");var t=p.deduplicate(e.accounts);this.processPs(e),this.processCallback(e);var r={teamId:e.teamId,accounts:t,ps:e.ps};this.sendCmd("addSuperTeamMembers",r,e.callback)},d.removeSuperTeamMembers=function(e){p.verifyOptions(e,"teamId accounts","team::removeSuperTeamMembers"),p.verifyParamType("accounts",e.accounts,"array","team::removeSuperTeamMembers");var t=p.deduplicate(e.accounts);this.processCallback(e);var r={teamId:e.teamId,accounts:t};this.sendCmd("removeSuperTeamMembers",r,e.callback)},d.leaveSuperTeam=function(e){p.verifyOptions(e,"teamId","superTeam::leaveSuperTeam"),this.processCallback(e);var t={teamId:e.teamId};this.sendCmd("leaveSuperTeam",t,e.callback)},d.getSuperTeam=function(e){var t,r=this,n=r.db;function i(){r.sendCmd("getSuperTeam",{teamId:e.teamId},e.callback)}p.verifyOptions(e,"teamId","team::getSuperTeam"),r.processCallback(e),e.cbaop=function(e){e||r.logger.info("api::getSuperTeam: cbaop ".concat(t))},t=e.teamId,n.enable&&!e.sync?n.getSuperTeam(t).then((function(n){n&&n.validToCurrentUser?(r.logger.log("api::getSuperTeam: db.getSuperTeam ".concat(t)),e.done(null,n)):i()})).catch((function(){i()})):i()},d.getSuperTeams=function(e){var t=this,r=t.db,n=0;function i(){t.sendCmd("getSuperTeams",{timetag:n,NOTSTORE:"timetag"},e.callback)}p.verifyOptions(e),t.processCallback(e),r.enable?r.getSuperTeamsTimetag().then((function(e){n=e,i()}),i):i()},d.updateSuperTeam=function(e){p.verifyOptions(e,"teamId","superTeam::updateSuperTeam"),e.action="update",this.processCallback(e),e.team=new f(e),this.sendCmd("updateSuperTeam",{team:e.team,antispamTag:{antiSpamBusinessId:e.antiSpamBusinessId},single:!0},e.callback)},d.updateInfoInSuperTeam=function(e){p.verifyOptions(e,"teamId","superTeam::updateInfoInSuperTeam"),this.processCallback(e),this.sendCmd("updateInfoInSuperTeam",{superTeamMember:new h(e),single:!0},e.callback)},d.getSuperTeamMembersByJoinTime=function(e){var t=e.joinTime,r=o(e),n=e.limit,i=e.teamId;r=!!r,m(t)&&(t=0),m(n)&&(n=100),p.verifyOptions(e,"teamId","superTeam::getSuperTeamMembersByJoinTime"),p.verifyParamType("joinTime",t,"number","api::superTeam::getSuperTeamMembersByJoinTime"),p.verifyParamType("limit",n,"number","api::superTeam::getSuperTeamMembersByJoinTime"),this.processCallback(e),this.sendCmd("getSuperTeamMembersByJoinTime",{teamId:i,limit:n,joinTime:t,reverse:r,timetag:0,NOTSTORE:"timetag"},e.callback)},d.getAllSuperTeamMembers=function(e){var t=this,r=this.db;function n(r){r=r||0,t.sendCmd("getSuperTeamMembers",{teamId:e.teamId,timetag:r,NOTSTORE:"timetag"},e.callback)}p.verifyOptions(e,"teamId","superTeam::getAllSuperTeamMembers"),t.processCallback(e),s(g).call(g,this)(e.teamId).then((function(i){var o=i.valid,s=i.timetag;o?(t.logger.info("getAllSuperTeamMembers from local db"),r.getSuperTeamMembers(e.teamId).then((function(t){var r={teamId:e.teamId,members:t};e.done(null,r)}),(function(){return n()}))):n(s)}))},d.applySuperTeam=function(e){p.verifyOptions(e,"teamId","team::applySuperTeam"),p.verifyOptions(e,"teamId","team::applySuperTeam"),this.processPs(e),this.processCallback(e);var t={teamId:e.teamId,ps:e.ps};this.sendCmd("applySuperTeam",t,e.callback)},d.passSuperTeamApply=function(e){p.verifyOptions(e,"idServer teamId from","team::passSuperTeamApply"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("passSuperTeamApply",t,e.callback)},d.rejectSuperTeamApply=function(e){p.verifyOptions(e,"idServer teamId from","team::rejectSuperTeamApply"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectSuperTeamApply",t,e.callback)},d.acceptSuperTeamInvite=function(e){p.verifyOptions(e,"idServer teamId from","team::acceptSuperTeamInvite"),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from};this.sendCmd("acceptSuperTeamInvite",t,e.callback)},d.rejectSuperTeamInvite=function(e){p.verifyOptions(e,"idServer teamId from","team::rejectSuperTeamInvite"),this.processPs(e),this.processCallback(e);var t={idServer:e.idServer,teamId:e.teamId,from:e.from,ps:e.ps};this.sendCmd("rejectSuperTeamInvite",t,e.callback)},d.addSuperTeamManagers=function(e){var t;p.verifyOptions(e,"teamId accounts","team::addSuperTeamManagers"),p.verifyParamType("accounts",e.accounts,"array","team::addSuperTeamManagers"),this.processCallback(e);var r={teamId:e.teamId,accounts:a(t=e.accounts).call(t,0)};this.sendCmd("addSuperTeamManagers",r,e.callback)},d.removeSuperTeamManagers=function(e){var t;p.verifyOptions(e,"teamId accounts","team::removeSuperTeamManagers"),p.verifyParamType("accounts",e.accounts,"array","team::removeSuperTeamManagers"),this.processCallback(e);var r={teamId:e.teamId,accounts:a(t=e.accounts).call(t,0)};this.sendCmd("removeSuperTeamManagers",r,e.callback)},d.updateSuperTeamMembersMute=function(e){p.verifyOptions(e,"teamId accounts mute","team::updateSuperTeamMembersMute"),p.verifyParamType("accounts",e.accounts,"array","team::updateSuperTeamMembersMute"),p.verifyArrayMax("accounts",e.accounts,10),this.processCallback(e),e.mute=e.mute?1:0,this.sendCmd("updateSuperTeamMembersMute",e)},d.updateSuperTeamMute=function(e){p.verifyOptions(e,"teamId mute","team::updateSuperTeamMute"),e.mute=e.mute?1:0,this.processCallback(e),this.sendCmd("updateSuperTeamMute",e)},d.updateNickInSuperTeam=function(e){p.verifyOptions(e,"teamId account","team::updateNickInSuperTeam"),this.processCallback(e),this.sendCmd("updateNickInSuperTeam",{superTeamMember:new h(e),single:!0},e.callback)},d.transferSuperTeam=function(e){p.verifyOptions(e,"teamId account leave","team::transferSuperTeam"),p.verifyParamType("leave",e.leave,"boolean","team::transferSuperTeam"),this.processCallback(e);var t={teamId:e.teamId,account:e.account,leave:e.leave};this.sendCmd("transferSuperTeam",t,e.callback)},d.getSuperTeamMembersByAccounts=function(e){var t=this,r=this.db,n=e.teamId,o=e.accounts;if(p.verifyOptions(e,"teamId accounts","superTeam::getSuperTeamMembersByAccounts"),p.verifyParamType("accounts",o,"array","superTeam::getSuperTeamMembersByAccounts"),p.verifyArrayMax("accounts",o,20),o.length<=0)return p.onParamError("参数accounts不能为空数组","superTeam::getSuperTeamMembersByAccounts");function s(){var r=c(o).call(o,(function(e){return n+"|"+e}));t.processCallback(e),t.sendCmd("getSuperTeamMembersByAccounts",{memberIds:r},(function(t,r){e.done(null,{accounts:o,members:r.members,invaldAccounts:r.invalid})}))}g.call(this,n).then((function(t){var a,c,d;return t.valid?(a=[],c=[],d=[],u(o).call(o,(function(e){var t,i=r.getSuperTeamMemberById(l(t="".concat(n,"-")).call(t,e)).then((function(e){c.push(e)})).catch((function(){d.push(e)}));a.push(i)})),void i.all(a).then((function(){e.done(null,{accounts:o,members:c,invaldAccounts:d})}))):s()})).catch((function(){return s()}))},d.getMutedSuperTeamMembers=function(e){var t=e.joinTime,r=o(e),n=e.limit,i=e.teamId;r=!!r,m(t)&&(t=0),m(n)&&(n=100),p.verifyOptions(e,"teamId","superTeam::getSuperTeamMembersByJoinTime"),p.verifyParamType("joinTime",t,"number","api::superTeam::getSuperTeamMembersByJoinTime"),p.verifyParamType("limit",n,"number","api::superTeam::getSuperTeamMembersByJoinTime"),this.processCallback(e),this.sendCmd("getMutedSuperTeamMembers",{teamId:i,limit:n,joinTime:t,reverse:r},e.callback)}},function(e,t,r){var n=r(94),i=r(95),o=r(75),s=r(8),a=r(3),c=r(4),u=r(13),l=r(5),d=r(475),p=r(42),m=r(17),f=r(30),h=r(19),g=r(6);function v(e,t){var r=void 0!==i&&o(e)||e["@@iterator"];if(!r){if(f(e)||(r=function(e,t){var r;if(e){if("string"==typeof e)return y(e,t);var i=m(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?n(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?y(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var s=0,a=function(){};return{s:a,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){l=!0,c=e},f:function(){try{u||null==r.return||r.return()}finally{if(l)throw c}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var b=r(32).fn,S=r(0),T=S.undef,_=S.notundef,w=r(199);function M(e,t){var r=this,n=[],i=[],o=this.db,s=this;return o.enable?(a(e).call(e,(function(e){var t=r.protocol.getSessionInCache(e);t?l(t,e):i.push(o.getSession(e).then((function(t){return l(t,e)})))})),c.all(i).then((function(){return n}))):(a(e).call(e,(function(e){return l(r.protocol.getSessionInCache(e),e)})),c.resolve(n));function l(e,r){var i,o,a,c;e?e.lastMsg?e.scene&&e.to?e.ack>=e.lastMsg.time?s.logger.warn(u(i="".concat(t," not need ack ")).call(i,e.id)):n.push(e):s.logger.warn(u(o="".concat(t," session.scene|to undefined ")).call(o,e.id)):s.logger.warn(u(a="".concat(t," session.lastMsg undefined ")).call(a,e.id)):s.logger.warn(u(c="".concat(t," session undefined ")).call(c,r))}}b.setCurrSession=function(e){this.resetSessionUnread(e),this.protocol.setCurrSession(e)},b.resetAllSessionUnread=function(){for(var e in this.protocol.sessionSet)this.protocol.sessionSet[e].unread>0&&this.resetSessionUnread(e)},b.resetSessionsUnread=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this;r.logger.info("resetSessionsUnread::",e),M.call(this,e,"api::resetSessionsUnread").then((function(e){if(r.protocol.resetSessionsUnread(e),r.options.syncSessionUnread&&0!==e.length){var n=s(e).call(e,(function(e){return{scene:"p2p"===e.scene?0:1,to:e.to,timetag:e.lastMsg.time}}));r.sendCmd("markSessionAckBatch",{sessionAckTags:n},(function(e){t(e||null)}))}else t()}))},b.resetSuperTeamSessionsUnread=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this;r.logger.info("resetSuperTeamSessionsUnread::",e),M.call(this,e,"api::resetSuperTeamSessionsUnread").then((function(e){if(r.protocol.resetSessionsUnread(e),r.options.syncSessionUnread&&0!==e.length){var n=s(e).call(e,(function(e){return{to:e.to,timetag:e.lastMsg.time}}));r.sendCmd("markSuperTeamSessionsAck",{sessionAckTags:n},(function(e){t(e||null)}))}else t()}))},b.resetSessionUnread=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this,n=!1!==r.options.resetUnreadMode,i=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r?t(r,e):t(null)};r.logger.info("resetSessionUnread::use reset mode",n);var o=r.protocol.getSessionInCache(e);(!o&&this.db.enable?r.db.getSession(e):c.resolve(o)).then((function(t){return t?r.options.syncSessionUnread?(n&&r.protocol.resetSessionUnread(t),void function(t){if(!t.lastMsg)return r.logger.warn("api::resetSessionUnread: session.lastMsg undefined ".concat(e)),i();if(!t.scene||!t.to)return r.logger.warn("api::resetSessionUnread: session.scene|to undefined ".concat(e)),i();var o=t.lastMsg.time;if(t&&t.ack&&t.ack>=o)return r.logger.warn("api::resetSessionUnread: session ack not needs ".concat(e)),i();var s={done:function(e){e?(r.logger.error({message:e||"mark ack failed",callFunc:"resetSessionUnread"}),i(e||"mark ack failed")):(n||r.protocol.resetSessionUnread(t),i())}};if(r.processCallback(s),"superTeam"===t.scene)r.sendCmd("markSuperTeamSessionAck",{to:t.to,timetag:o},s.callback);else{var a={scene:"p2p"===t.scene?0:1,to:t.to,timetag:o};r.sendCmd("markSessionAck",a,s.callback)}}(t)):(r.protocol.resetSessionUnread(t),i()):(r.logger.warn("api::resetSessionUnread: session undefined ".concat(e)),i())}))},b.resetCurrSession=function(){this.protocol.setCurrSession("")},b.insertLocalSession=function(e){var t,r;function n(){e.session=r,e.done(t,e)}S.verifyOptions(e,"scene to","scene::insertLocalSession"),S.verifyParamValid("scene",e.scene,this.message.validScenes,"scene::insertLocalSession"),this.protocol.insertLocalSession(e).then((function(e){r=e,n()}),(function(e){t=e,n()}))},b.getLocalSessions=function(e){var t=[];S.verifyOptions(e),T(e.limit)&&(e.limit=100),S.verifyParamType("limit",e.limit,"number","scene::getLocalSessions"),_(l(e))?S.verifyParamType("reverse",l(e),"boolean","scene::getLocalSessions"):e.reverse=!1,this.processCallback(e);var r=d(this.protocol.sessionSet),n=0,i=e.lastSessionId;if(l(e)){var o,s=v(r);try{for(s.s();!(o=s.n()).done;){var a=o.value,c=a.id;if(i)c===i&&(i=void 0);else if(void 0!==a.lastMsg){if(++n>e.limit)break;t.push(p({},a))}}}catch(e){s.e(e)}finally{s.f()}}else{var u,f,h=v(r);try{for(h.s();!(f=h.n()).done;){var g=f.value;if(i===g.id)break;void 0!==g.lastMsg&&t.push(g)}}catch(e){h.e(e)}finally{h.f()}t=l(u=m(t).call(t,-e.limit)).call(u)}this.logger.debug("getLocalSessions::sessions is",t),e.sessions=t,delete e.callback,e.done(void 0,e)},b.getLocalSession=function(e){var t,r=this,n=r.db,i=null;if(S.verifyOptions(e,"sessionId","scene::getLocalSession"),S.verifyParamType("sessionId",e.sessionId,"string","scene::getLocalSession"),i=r.protocol.getSessionInCache(e.sessionId),r.logger.debug("getLocalSession::cache session is",i),!i&&n.enable)return r.processCallback(e),void n.getSession(e.sessionId).then((function(e){e&&(i=e,r.logger.debug("getLocalSession::db session is",i)),o()}),(function(e){t=e,o()}));function o(){e.done(t,i)}o()},b.getLocalSessionsByMsgType=function(e){var t,r=this.db,n=e.exclude,i=[],o=m(t=w.validTypes).call(t,0);if(_(n)){if("string"==typeof n)n=[n];else if(!f(n))return void S.onParamInvalidType("exclude",["string","string array"],"","exclude::getLocalSessionsByMsgType");n=h(n).call(n,(function(e){return g(o).call(o,e)>-1})),o=h(o).call(o,(function(e){return-1===g(n).call(n,e)}))}this.processCallback(e),r.enable?r.getSessions().then((function(t){n&&0!==n.length?o&&0!==o.length?(a(t).call(t,(function(e,s){var a,u,l;e.lastMsg&&g(n).call(n,e.lastMsg.type)>-1&&(a=s,u=e.id,l=r.getMsgs({sessionId:u,limit:1,types:o}).then((function(e){return e&&e[0]?t[a].lastMsg=e[0]:t[a].lastMsg=null,c.resolve()})),i.push(l))})),c.all(i).then((function(){e.done(null,{exclude:n,sessions:t})}))):e.done(null,{exclude:n,sessions:s(t).call(t,(function(e){e.lastMsg=null}))}):e.done(null,{exclude:n,sessions:t})})):e.done(null,{exclude:n,sessions:[]})},b.updateLocalSession=function(e){var t,r=this,n=r.db;S.verifyOptions(e,"id","scene::updateLocalSession"),r.processCallback(e);var i=S.filterObj(e,"id localCustom");function o(){!1!==e.needNotify&&r.protocol.onUpdateSession(i),e.session=i,e.done(t,e)}i=r.protocol.updateSessionInCache(e),n.enable&&i?n.updateSession(i).then((function(e){i=e,o()}),(function(e){t=e,o()})):o()},b.deleteLocalSession=function(e){var t,r=this,n=r.db;if(S.verifyOptions(e,"id","session::deleteLocalSession"),r.processCallback(e),r.protocol.deleteSessionInCache(e.id,e.isLogic),n.enable?(e.isLogic?n.deleteSessionLogic(e.id):n.deleteSession(e.id)).then((function(){r.logger.info("sessions::deleteSessionInDb::delete session done",e.id),o()}),(function(e){t=e,o()})):o(),e.isDeleteRoaming){var i="string"==typeof e.id?[e.id]:e.id;i=s(i).call(i,(function(e){return e.replace("-","|")})),this.sendCmd("deleteSessions",{sessions:i},(function(){}))}function o(){e.done(t,e)}},b.deleteSession=function(e,t){t||this.logger.warn("this api will be abandon,please use “deleteRoamingMsgBySession”"),S.verifyOptions(e,"scene to","session::deleteSession"),this.processCallback(e),e.sessions=[{scene:e.scene,to:e.to}],this.deleteSessions(e)},b.deleteRoamingMsgBySession=function(e){this.deleteSession(e,!0)},b.deleteSessions=function(e){var t,r;S.verifyOptions(e,"sessions","session::deleteSessions"),S.verifyParamType("sessions",e.sessions,"array","session::deleteSessions"),a(t=e.sessions).call(t,(function(e,t){S.verifyOptions(e,"scene to",!0,"sessions["+t+"].","session::deleteSessions")})),this.processCallback(e),this.sendCmd("deleteSessions",{sessions:s(r=e.sessions).call(r,(function(e){return e.scene+"|"+e.to}))},e.callback)},b.getServerSessions=function(e){_(e.minTimestamp)&&S.verifyParamType("minTimestamp",e.minTimestamp,"number","session::deleteSessions"),_(e.maxTimestamp)&&S.verifyParamType("maxTimestamp",e.maxTimestamp,"number","session::deleteSessions"),_(e.needLastMsg)&&(e.needLastMsg=!1===e.needLastMsg?0:1),_(e.limit)&&(S.verifyParamType("limit",e.limit,"number","session::deleteSessions"),S.verifyParamMax("limit",e.limit,100,"scene::getLocalSessions")),this.processCallback(e),this.sendCmd("getServerSessions",{sessionReqTag:e},e.callback)},b.getServerSession=function(e){S.verifyOptions(e,"scene to","scene::getServerSession"),S.verifyParamValid("scene",e.scene,this.message.validScenes,"scene::getServerSession"),S.verifyParamType("to",e.to,"string","to::getServerSession");var t=e.scene+"|"+e.to;"superTeam"===e.scene&&(t="super_team|"+e.to),this.processCallback(e),this.sendCmd("getServerSession",{session:{id:t}},e.callback)},b.updateServerSession=function(e){S.verifyOptions(e,"scene to","scene::updateServerSession"),S.verifyParamValid("scene",e.scene,this.message.validScenes,"scene::updateServerSession"),S.verifyParamType("to",e.to,"string","to::updateServerSession"),_(e.extra)&&S.verifyParamType("extra",e.extra,"string","extra::updateServerSession");var t=e.scene+"|"+e.to;"superTeam"===e.scene&&(t="super_team|"+e.to),this.processCallback(e),this.sendCmd("updateServerSession",{session:{id:t,ext:e.extra||""}},e.callback)},b.deleteServerSessions=function(e){var t,r=this;S.verifyOptions(e,"sessions","scene::deleteServerSessions"),S.verifyParamType("sessions",e.sessions,"array","sessions::deleteServerSessions");var n=[];a(t=e.sessions).call(t,(function(e){S.verifyParamValid("scene",e.scene,r.message.validScenes,"scene::deleteServerSessions"),S.verifyParamType("to",e.to,"string","to::deleteServerSessions");var t=e.scene+"|"+e.to;"superTeam"===e.scene&&(t="super_team|"+e.to),n.push({id:t})})),this.processCallback(e),this.sendCmd("deleteServerSessions",{sessions:n},e.callback)},b.updateSessionsWithMoreRoaming=function(e){var t;if(S.verifyOptions(e,"msg","session::updateSessionsWithMoreRoaming"),S.verifyCallback(e,"done","session::updateSessionsWithMoreRoaming"),!this.db.enable)return e.done(null,"db is disable");var r={time:e.msg.time,idServer:e.msg.idServer,to:e.msg.to,from:e.msg.from};S.verifyParamType("msg.time",e.msg.time,"number","time::updateSessionsWithMoreRoaming"),S.verifyParamType("msg.idServer",e.msg.idServer,"string","idServer::updateSessionsWithMoreRoaming"),S.verifyParamType("msg.from",e.msg.from,"string","from::updateSessionsWithMoreRoaming"),S.verifyParamType("msg.to",e.msg.to,"string","to::updateSessionsWithMoreRoaming"),S.verifyParamValid("scene",e.msg.scene,this.message.validScenes,"scene::updateSessionsWithMoreRoaming");var n=r.to===this.account?r.from:r.to;r.id=u(t="".concat(e.msg.scene,"-")).call(t,n),this.db.updateSessionsWithMoreRoaming(r).then((function(t){e.done(null,t)})).catch((function(t){e.done(t)}))},b.deleteSessionsWithMoreRoaming=function(e){if(S.verifyOptions(e,"id","session::deleteSessionsWithMoreRoaming"),S.verifyCallback(e,"done","session::deleteSessionsWithMoreRoaming"),!this.db.enable)return e.done(null,"db is disable");this.db.deleteSessionsWithMoreRoaming(e.id).then((function(t){e.done(null,t)})).catch((function(t){e.done(t)}))},b.getSessionsWithMoreRoaming=function(e){if(S.verifyCallback(e,"done","session::getSessionsWithMoreRoaming"),!this.db.enable)return e.done(null,"db is disable");this.db.getSessionsWithMoreRoaming(e.id).then((function(t){e.done(null,t)})).catch((function(t){e.done(t)}))}},function(e,t,r){var n=r(10),i=r(57),o=r(58),s=r(59),a=r(60),c=r(49),u=r(149),l=r(575),d=r(219),p=r(220),m=r(61),f=r(19),h=r(17),g=r(3),v=r(30),y=r(116),b=r(8),S=r(13),T=r(5),_=r(11),w=r(579),M=["callback","done"];function x(e,t){var r=n(e);if(i){var s=i(e);t&&(s=f(s).call(s,(function(t){return o(e,t).enumerable}))),r.push.apply(r,s)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?g(r=x(Object(i),!0)).call(r,(function(t){m(e,t,i[t])})):s?a(e,s(i)):g(n=x(Object(i))).call(n,(function(t){c(e,t,o(i,t))}))}return e}var C=r(32).fn,R=r(0),k=R.undef,A=R.notundef,I=r(39),O=r(142),P=r(118),N=r(36);C.sendG2Msg=function(e){return this.processCallback(e),e.msg=new this.message.G2Message(e),this.sendMsg(e)},C.beforeSendMsg=function(e){var t,r=this.protocol,n=e.msg;switch(n.to===this.account&&(n.fromDeviceId=I.deviceId),n.userUpdateTime=r.myInfo&&r.myInfo.updateTime,n.getScene()){case"p2p":t="sendMsg";break;case"team":t="sendTeamMsg";break;case"superTeam":t="sendSuperTeamMsg"}f(e)&&(t="sendFilterMsg",n.filter=!0),e.cmd=t},C.afterSendMsg=function(e){var t=e.rtnMsg;if(!t||!t.ignore){var r=this.protocol.getSessionInCache(t.sessionId);e.isLocal&&r&&r.lastMsg&&t.time<r.lastMsg.time||this.protocol.onUpdateSession(O.genSessionByMsg(t))}},C.beforeForwardMsg=function(e){R.verifyOptions(e,"msg scene to","msg::beforeForwardMsg"),e.msg.scene=e.scene,e.msg.to=e.to},C.markMsgRead=function(e){var t=this.protocol;!e||this.db.enable||t.options.autoMarkRead?this.logger.warn("api::markMsgRead: 不需要标记消息为已收到 (没有消息, 或者启用了数据库, 或者启用了自动标记已收到)"):t.markMsgRead(e,!0)},C.sendMsgReceipt=function(e){if(R.verifyOptions(e),this.processCallback(e),e.msg){R.verifyOptions(e,"msg","msg::sendMsgReceipt");var t=e.msg;R.verifyOptions(t,"target idClient time",!0,"msg.","msg::sendMsgReceipt"),this.protocol.shouldSendMsgReceipt(t)?this.sendCmd("sendMsgReceipt",{msgReceipt:{to:t.target,idClient:t.idClient,time:t.time}},e.callback):e.done()}else e.done()},C.isMsgRemoteRead=function(e){return this.protocol.isMsgRemoteRead(e)},C.recallMsg=function(e){this.deleteMsg(e,!0)},C.deleteMsg=function(e,t){var r;t||this.logger.warn("this api will be abandon,please use “recallMsg”"),R.verifyOptions(e,"msg","msg::deleteMsg");var n=e.msg;if("team"!==n.scene&&n.from!==this.account||"success"!==n.status||n.isLocal)return e.done(N.newParamError("只能删除自己发的, 并且发送成功的消息，且不能是本地消息",{callFunc:"msg::deleteMsg"}),e);R.verifyOptions(n,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsg"),R.verifyParamValid("msg.scene",n.scene,this.message.validScenes,"msg::deleteMsg"),this.processPs(e),this.processCallback(e);var i={deletedIdClient:n.idClient,deletedIdServer:n.idServer,time:n.time,from:n.from,to:n.to,opeAccount:n.from},o="superTeam"===n.scene?"deleteSuperTeamMsg":"deleteMsg";i.type="deleteMsg"+n.scene[0].toUpperCase()+h(r=n.scene).call(r,1);var s=["ps","apnsText","pushPayload","env","opeAccount","attach"];g(s).call(s,(function(t){e[t]&&(i[t]=e[t])})),i=new P(i),this.sendCmd(o,{sysMsg:i,msg:n},e.callback)},C.deleteMsgSelf=function(e){R.verifyOptions(e,"msg","msg::deleteMsgSelf");var t=e.msg;if("superTeam"===t.scene)return e.done(N.newParamError("单向删除暂不支持超大群场景",{callFunc:"msg::deleteMsgSelf"}),e);R.verifyOptions(t,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsgSelf"),R.verifyParamValid("msg.scene",t.scene,this.message.validScenes,"msg::deleteMsgSelf"),this.processCallback(e);var r={scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,time:t.time,idClient:t.idClient,idServer:t.idServer,custom:e.custom};this.sendCmd("deleteMsgSelf",{deleteMsgSelfTag:r},e.callback)},C.deleteMsgSelfBatch=function(e){var t,r,n,i=this;if(R.verifyOptions(e,"msgs","msg::deleteMsgSelfBatch"),(!v(e.msgs)||0===e.msgs.length||e.msgs.length>100)&&R.onParamError("msgs应该是数组且数据长度应大于0小于等于100","msg::deleteMsgSelfBatch"),y(t=e.msgs).call(t,(function(e){return"superTeam"===e.scene})))return e.done(N.newParamError("消息列表中存在超大群消息，单向删除暂不支持超大群场景",{callFunc:"msg::deleteMsgSelfBatch"}),e);g(r=e.msgs).call(r,(function(e){R.verifyOptions(e,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsgSelfBatch"),R.verifyParamValid("msg.scene",e.scene,i.message.validScenes,"msg::deleteMsgSelfBatch")})),this.processCallback(e);var o=b(n=e.msgs).call(n,(function(t){var r;return{scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,time:t.time,idClient:t.idClient,idServer:t.idServer,sessionId:t.sessionId||S(r="".concat(t.scene,"-")).call(r,t.to),custom:e.custom}}));this.sendCmd("deleteMsgSelfBatch",{deleteMsgSelfTags:o},e.callback)};var D={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};C.getHistoryMsgs=function(e){R.verifyOptions(e,"scene to","msg::getHistoryMsgs"),R.verifyParamValid("scene",e.scene,this.message.validScenes,"msg::getHistoryMsgs"),void 0===e.beginTime&&(e.beginTime=0);var t,r=this.protocol.getSessionInCache(e.scene+"-"+e.to),n=r&&r.lastEmptyTime;if(n>e.beginTime&&(e.beginTime=n),R.verifyParamType("beginTime",e.beginTime,"number","msg::getHistoryMsgs"),void 0===e.endTime&&(e.endTime=0),R.verifyParamType("endTime",e.endTime,"number","msg::getHistoryMsgs"),e.lastMsgId=e.lastMsgId&&+e.lastMsgId?e.lastMsgId:"0",void 0===e.limit&&(e.limit=100),R.verifyParamType("limit",e.limit,"number","msg::getHistoryMsgs"),R.verifyParamMax("limit",e.limit,100,"msg::getHistoryMsgs"),A(T(e))?R.verifyParamType("reverse",T(e),"boolean","msg::getHistoryMsgs"):e.reverse=!1,A(e.asc)?R.verifyParamType("asc",e.asc,"boolean","msg::getHistoryMsgs"):e.asc=!1,k(e.msgTypes))e.msgTypes=[];else if(v(e.msgTypes)){var i,o;e.msgTypes=b(i=e.msgTypes).call(i,(function(e){return D[e]})),e.msgTypes=f(o=e.msgTypes).call(o,(function(e){return"number"==typeof e}))}else"number"==typeof D[e.msgTypes]?e.msgTypes=[D[e.msgTypes]]:e.msgTypes=[];switch(this.processCallback(e),e.asc&&(e.cbaop=function(e,t){var r;e||(t.msgs=T(r=t.msgs).call(r))}),e.scene){case"p2p":t="getHistoryMsgs";break;case"team":t="getTeamHistoryMsgs";break;case"superTeam":t="getSuperTeamHistoryMsgs"}var s={scene:e.scene,to:e.to,beginTime:e.beginTime,endTime:e.endTime,lastMsgId:e.lastMsgId,limit:e.limit,reverse:T(e),msgTypes:e.msgTypes};this.sendCmd(t,s,e.callback)},C.searchHistoryMsgs=function(e){R.verifyOptions(e,"scene to keyword","msg::searchHistoryMsgs"),R.verifyParamValid("scene",e.scene,this.message.validScenes,"msg::searchHistoryMsgs"),void 0===e.beginTime&&(e.beginTime=0);var t,r=this.protocol.getSessionInCache(e.scene+"-"+e.to),n=r&&r.lastEmptyTime;switch(n>e.beginTime&&(e.beginTime=n),R.verifyParamType("beginTime",e.beginTime,"number","msg::searchHistoryMsgs"),void 0===e.endTime&&(e.endTime=0),R.verifyParamType("endTime",e.endTime,"number","msg::searchHistoryMsgs"),void 0===e.limit&&(e.limit=100),R.verifyParamType("limit",e.limit,"number","msg::searchHistoryMsgs"),R.verifyParamMax("limit",e.limit,100,"msg::searchHistoryMsgs"),A(T(e))?R.verifyParamType("reverse",T(e),"boolean","msg::searchHistoryMsgs"):e.reverse=!1,A(e.asc)?R.verifyParamType("asc",e.asc,"boolean","msg::searchHistoryMsgs"):e.asc=!1,this.processCallback(e),e.asc&&(e.cbaop=function(e,t){var r;e||(t.msgs=T(r=t.msgs).call(r))}),e.scene){case"p2p":t="searchHistoryMsgs";break;case"team":t="searchTeamHistoryMsgs"}var i=R.filterObj(e,"scene to beginTime endTime keyword limit reverse");this.sendCmd(t,i,e.callback)},C.getLocalMsgs=function(e){var t=this,r=t.db,n=[];R.verifyOptions(e);var i=!1;A(e.start)&&(i=!0,R.verifyParamType("start",e.start,"number","msg::getLocalMsgs"));var o=!1;if(A(e.end)&&(o=!0,R.verifyParamType("end",e.end,"number","msg::getLocalMsgs")),i&&o&&e.end<=e.start&&R.onParamError("参数 end 必须晚于 start"),A(e.subTypes)&&R.verifyParamType("subTypes",e.subTypes,"array","msg::getLocalMsgs"),k(e.limit)&&(e.limit=100),R.verifyParamType("limit",e.limit,"number","msg::getLocalMsgs"),R.verifyParamMin("limit",e.limit,1,"msg::getLocalMsgs"),t.processCallback(e),r.enable){var s=(new Date).getTime();r.getMsgs(e).then((function(r){var i;n=r,t.logger.info(S(i="api::getLocalMsgs: query db cost ".concat((new Date).getTime()-s," ms and the conditions is ")).call(i,_(e))),a()}),(function(e){(e=e||{}).message=e.message||"msg::getLocalMsgs:db error",a()}))}else a();function a(){var t=R.simpleClone(e);t.msgs=n,delete t.callback,delete t.done,e.done(null,t)}},C.getLocalMsgsInUnread=function(e){var t=this;R.validate({sessionId:{type:"string",allowEmpty:!1}},e),this.getLocalSession({sessionId:e.sessionId,done:function(r,n){r?e.done&&e.done(r):n?(n.ack=n.ack||0,t.getLocalMsgs(E({sessionId:e.sessionId,start:n.ack,limit:w,filterFunc:function(e){return"in"===e.flow&&!0===e.isUnreadable},done:function(){}},e))):e.done&&e.done(new Error("session ".concat(e.sessionId," not exist")))}})},C.getLocalMsgByIdClient=function(e){var t=this.db,r=null,n=null;function i(){e.msg=n,e.done(r,e)}R.verifyOptions(e,"idClient","msg::getLocalMsgByIdClient"),this.processCallback(e),t.enable?t.getMsgByIdClient(e.idClient).then((function(e){e&&(n=e),i()}),(function(e){r=e,i()})):(this.logger.warn("because db is false,error is null"),i())},C.getLocalMsgsByIdClients=function(e){var t,r=this.db,n=[];function i(){e.msgs=n,e.done(t,e)}R.verifyOptions(e,"idClients","msg::getLocalMsgByIdClients"),R.verifyParamType("idClients",e.idClients,"array","msg::getLocalMsgByIdClients"),this.processCallback(e),r.enable?r.getMsgsByIdClients(e.idClients).then((function(e){n=f(e).call(e,(function(e){return!!e})),i()}),(function(e){t=e,i()})):i()},C.updateLocalMsg=function(e){var t,r=this.db,n=null;if(R.verifyOptions(e,"idClient","msg::updateLocalMsg"),this.processCallback(e),r.enable){var i=R.filterObj(e,"idClient localCustom");r.updateMsg(i).then((function(e){n=e,o()}),(function(e){t=e,o()}))}else o();function o(){e.msg=n,e.done(t,e)}},C.deleteLocalMsg=function(){var e=p(d.mark((function e(t){var r,n,i,o;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){t.done(n,t)},r=this,R.verifyOptions(t,"msg","msg::deleteLocalMsg"),i=t.msg,R.verifyOptions(i,"idClient sessionId",!0,"msg.","msg::deleteLocalMsg"),r.processCallback(t),e.prev=6,e.next=9,r.protocol.deleteLocalMsg(i);case 9:o(),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(6),n=e.t0,o();case 16:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}(),C.deleteLocalMsgsBySession=function(e){var t,r=this,n=r.db;R.verifyOptions(e,"scene to","msg::deleteLocalMsgsBySession"),R.verifyParamValid("scene",e.scene,r.message.validScenes,"msg::deleteLocalMsgsBySession"),e.sessionId=e.scene+"-"+e.to,e.delLastMsg=!0===e.delLastMsg,e.isTag=!0===e.isTag;var i=(new Date).getTime();function o(){e.done(t,e)}r.processCallback(e);var s={id:e.sessionId};e.delLastMsg&&(s.lastMsg=null),e.isTag&&(s.lastEmptyTime=i),n.enable?n.deleteMsgsBySessionId(e).then((function(){e.delLastMsg||e.isTag?n.updateSession(s).then((function(t){r.protocol.onUpdateSession(t),e.session=t,o()})):o()})).catch((function(e){t=e,o()})):(this.logger.warn("because db is false,error is null"),o(),(e.delLastMsg||e.isTag)&&r.protocol.onUpdateSession(s))},C.deleteLocalMsgs=function(e){var t;function r(){e.done(t,e)}e.updateSession=!1!==e.updateSession,R.verifyOptions(e,"sessionId","msg::deleteLocalMsgsBySession"),A(e.start)&&R.verifyParamType("start",e.start,"number","msg::deleteLocalMsgs"),A(e.end)&&R.verifyParamType("end",e.end,"number","msg::deleteLocalMsgs"),A(e.end)&&A(e.start)&&e.end<=e.start&&R.onParamError("参数 end 必须大于 start"),this.processCallback(e),this.protocol.deleteLocalMsgs(e).then((function(){r()}),(function(e){t=e,r()}))},C.deleteAllLocalMsgs=function(e){var t,r=this.db;function n(){e.done(t,e)}this.processCallback(e),this.protocol.sessionSet={},r.enable?r.deleteAllMsgs().then((function(){n()}),(function(e){t=e,n()})):(this.logger.warn("because db is false,error is null"),n())},C.saveMsgsToLocal=function(e){var t;this.db.enable||(this.logger.warn("because db is false,error is null"),e.done(null,[])),R.verifyOptions(e,"msgs done","msg::saveMsgsToLocal"),R.verifyParamType("msgs",e.msgs,"Array","msg::saveMsgsToLocal");var r=b(t=e.msgs).call(t,(function(e){var t=E({},e);return t.hasOwnProperty("needUpdateSession")||(t.needUpdateSession=!0),t}));this.db.putMsg(r).then((function(t,r){r?e.done(r):e.done(null,t)}))},C.clearServerHistoryMsgs=function(e){R.verifyOptions(e,"account","msg::clearServerHistoryMsgs");var t=!1!==e.delRoam;this.processCallback(e),this.sendCmd("clearServerHistoryMsgs",{clearMsgsParams:{account:e.account,delRoam:t?1:0}},e.callback)},C.clearServerHistoryMsgsWithSync=function(e){R.verifyOptions(e,"scene to","msg::clearServerHistoryMsgsWithSync");var t={type:"team"===e.scene?2:1,isDeleteRoam:1,isSyncSelf:!0===e.isSyncSelf?1:0};t[2===t.type?"toTid":"otherAccid"]=e.to,void 0!==e.ext&&(t.ext=e.ext),this.processCallback(e),this.sendCmd("clearServerHistoryMsgsWithSync",{clearMsgsParamsWithSync:t},e.callback)},C.msgFtsInServer=function(e){this.processCallback(e);var t=l({},e);R.validate({keyword:{type:"string"},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",min:0,required:!1},msgLimit:{type:"number",min:0,required:!1},order:{type:"enum",values:["ASC","DESC"],required:!1},p2pList:{type:"array",required:!1},teamList:{type:"array",required:!1},senderList:{type:"array",required:!1},msgTypeList:{type:"array",required:!1},msgSubTypeList:{type:"array",required:!1}},t,"msg::msgFtsInServer"),A(t.toTime)&&A(t.fromTime)&&t.toTime<t.fromTime&&R.onParamError("Options error: toTime should be greater than fromTime");var r,n={ASC:1,DESC:2};t.order&&n[t.order]&&(t.order=n[t.order]),t.msgTypeList&&(t.msgTypeList=b(r=t.msgTypeList).call(r,(function(e){return D[e]})));var i=["p2pList","teamList","senderList","msgTypeList","msgSubTypeList"];g(i).call(i,(function(e){v(t[e])&&(t[e]=t[e].join(","))})),this.sendCmd("msgFtsInServer",{msgFullSearchRequestTag:t},e.callback)},C.msgFtsInServerByTiming=function(e){this.processCallback(e),e.callback,e.done;var t=u(e,M);R.validate({keyword:{type:"string"},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},msgLimit:{type:"number",min:0,required:!1},order:{type:"enum",values:["ASC","DESC"],required:!1},p2pList:{type:"array",required:!1},teamList:{type:"array",required:!1},senderList:{type:"array",required:!1},msgTypeList:{type:"array",required:!1},msgSubTypeList:{type:"array",required:!1}},t,"msg::msgFtsInServerByTimeSort"),A(t.toTime)&&A(t.fromTime)&&t.toTime<t.fromTime&&R.onParamError("Options error: toTime should be greater than fromTime");var r,n={ASC:1,DESC:2};void 0===t.msgLimit&&(t.msgLimit=20),t.order&&n[t.order]&&(t.order=n[t.order]),t.msgTypeList&&(t.msgTypeList=b(r=t.msgTypeList).call(r,(function(e){return D[e]})));var i=["p2pList","teamList","senderList","msgTypeList","msgSubTypeList"];g(i).call(i,(function(e){v(t[e])&&(t[e]=t[e].join(","))})),this.sendCmd("msgFtsInServerByTiming",{msgTimingFullSearchRequestTag:t},e.callback)}},function(e,t,r){var n=r(576);function i(){return e.exports=i=n||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.exports.default=e.exports,e.exports.__esModule=!0,i.apply(this,arguments)}e.exports=i,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(577)},function(e,t,r){var n=r(578);e.exports=n},function(e,t,r){var n=r(216);e.exports=n},function(e,t,r){e.exports=r(580)},function(e,t,r){var n=r(581);e.exports=n},function(e,t,r){r(582),e.exports=9007199254740991},function(e,t,r){r(2)({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){var n=r(5),i=r(30),o=r(17),s=r(3),a=r(11),c=r(10),u=r(19),l=r(32).fn,d=r(0),p=r(477),m=r(479),f=d.notundef;function h(e,t,r,n){r=r||"",d.verifyParamType(r+"from",e.from,"string",t),d.verifyParamType(r+"to",e.to,"string",t),d.verifyParamType(r+"idServer",e.idServer,"string",t),d.verifyParamType(r+"time",e.time,"number",t),d.verifyParamValid(r+"scene",e.scene,this.message.validScenes,t),n||d.verifyParamType(r+"idClient",e.idClient,"string",t)}l.getThreadMsgs=function(e){d.verifyCallback(e,"done","msg::getThreadMsgs"),d.verifyOptions(e,"scene threadMsgFromAccount threadMsgToAccount threadMsgIdServer threadMsgTime","msg::getThreadMsgs"),d.verifyParamType("threadMsgFromAccount",e.threadMsgFromAccount,"string","msg::getThreadMsgs"),d.verifyParamType("threadMsgToAccount",e.threadMsgToAccount,"string","msg::getThreadMsgs"),d.verifyParamType("threadMsgIdServer",e.threadMsgIdServer,"string","msg::getThreadMsgs"),d.verifyParamType("threadMsgTime",e.threadMsgTime,"number","msg::getThreadMsgs"),d.verifyParamValid("scene",e.scene,this.message.validScenes,"msg::getThreadMsgs"),this.processCallback(e);var t={scene:this.message.sceneMap[e.scene],from:e.threadMsgFromAccount,to:e.threadMsgToAccount,time:e.threadMsgTime,idServer:e.threadMsgIdServer},r={limit:e.limit<100?e.limit:100,beginTime:"number"==typeof e.beginTime?e.beginTime:0,reverse:!0===n(e)?1:0};"number"==typeof e.endTime&&(r.endTime=e.endTime,r.endTime<=r.beginTime&&d.onParamError("endTime应该大于beginTime","msg::getThreadMsgs")),e.lastMsgId&&(r.lastMsgId=e.lastMsgId),this.sendCmd("getThreadMsgs",{msg:t,threadMsgReq:r,NOTSTORE:"msg threadMsgReq"},e.callback)},l.getMsgsByIdServer=function(e){var t,r,n=this,a=this,c="msg::getMsgsByIdServer";d.verifyCallback(e,"done",c),(!i(e.reqMsgs)||0===e.reqMsgs.length||e.reqMsgs.length>100)&&d.onParamError("reqMsgs应该是数组且数据长度应大于0小于等于100",c),e.reqMsgs=o(t=e.reqMsgs).call(t,0),s(r=e.reqMsgs).call(r,(function(e,t){h.call(a,e,c,"reqMsgs[".concat(t,"]."),!0),e.scene=n.message.sceneMap[e.scene]})),this.processCallback(e),this.sendCmd("getMsgsByIdServer",{reqMsgs:e.reqMsgs},e.callback)},l.addQuickComment=function(e){d.verifyOptions(e,"msg body","msg::addQuickComment"),h.call(this,e.msg,"msg::addQuickComment");var t=new p(e,"msg::addQuickComment");t.from=this.account;var r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("addQuickComment",{msg:r,comment:t},e.callback)},l.deleteQuickComment=function(e){d.verifyOptions(e,"msg body","msg::deleteQuickComment"),h.call(this,e.msg,"msg::deleteQuickComment");var t=new p(e,"msg::addQuickComment");t.from=this.account;var r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("deleteQuickComment",{msg:r,comment:t},e.callback)},l.getQuickComments=function(e){var t=this,r="msg::getQuickComments",n=this,o={},l={};d.verifyOptions(e,"msgs","msg::getQuickComments"),(!i(e.msgs)||0===e.msgs.length||e.msgs.length>20)&&d.onParamError("msgs应该是数组且数据长度应大于0小于等于20",r);var p=[];try{p=JSON.parse(a(e.msgs))}catch(e){d.onParamError("msgs 不是合法的对象",r)}s(p).call(p,(function(e,i){h.call(n,e,r,"msgs[".concat(i,"]."),!0),e.scene=t.message.sceneMap[e.scene],o[e.idClient]=null,l[e.idClient]=i})),this.processCallback(e),this.getLocalMsgsByIdClients({idClients:c(o),done:function(t,r){var i,a=n.protocol.timetags.sync;!t&&r.msgs&&r.msgs.length&&a&&(s(i=r.msgs).call(i,(function(e){o[e.idClient]=e})),p=u(p).call(p,(function(e){var t=o[e.idClient];return!(t&&(t.commentTimetag&&(e.timestamp=t.commentTimetag),t.commentTimetag>a))}))),n.sendCmd("getQuickComments",{commentReq:p,idMap:o,indexMap:l},e.callback)}})},l.addCollect=function(e){d.verifyOptions(e,"type data","msg::addCollect");var t=new m(e,"msg::addCollect");this.processCallback(e),this.sendCmd("addCollect",{collect:t},e.callback)},l.deleteCollects=function(e){var t;d.verifyOptions(e,"collectList","msg::deleteCollects"),(!i(e.collectList)||0===e.collectList.length||e.collectList.length>100)&&d.onParamError("collectList应该是数组且数据长度应大于0小于等于100","msg::deleteCollects"),s(t=e.collectList).call(t,(function(e,t){d.verifyParamType("collectList[".concat(t,"].id"),e.id,"string","msg::deleteCollects"),d.verifyParamType("collectList[".concat(t,"].createTime"),e.createTime,"number","msg::deleteCollects")})),this.processCallback(e),this.sendCmd("deleteCollects",{collectList:e.collectList},e.callback)},l.updateCollect=function(e){d.verifyOptions(e,"collect","msg::updateCollect"),d.verifyParamType("collect.id",e.collect.id,"string","msg::updateCollect"),d.verifyParamType("collect.createTime",e.collect.createTime,"number","msg::updateCollect"),this.processCallback(e),this.sendCmd("updateCollect",{collect:e.collect},e.callback)},l.getCollects=function(e){d.verifyCallback(e,"done","msg::getCollects");var t={},r=["type","beginTime","endTime","limit"];s(r).call(r,(function(r){f(e[r])&&(d.verifyParamType(r,e[r],"number","msg::getCollects"),t[r]=e[r])})),e.limit>100&&d.onParamError("limit不能大于100","msg::getCollects"),e.beginTime>e.endTime&&d.onParamError("beginTime不能大于endTime","msg::getCollects"),f(e.lastId)&&(d.verifyParamType("lastId",e.lastId,"string","msg::getCollects"),t.lastMsgId=e.lastId),f(n(e))&&(t.reverse=!0===n(e)?1:0),this.processCallback(e),this.sendCmd("getCollects",{collectQuery:t,NOTSTORE:"collectQuery"},e.callback)},l.addStickTopSession=function(e){d.verifyOptions(e,"id","msg::addStickTopSession");var t=d.getIdArray(e.id);d.verifyParamValid("id的前半部分",t[0],this.message.validScenes,"msg::addStickTopSession"),d.verifyParamType("id的后半部分",t[1],"string","msg::addStickTopSession"),"superTeam"===t[0]&&(t[0]="super_team");var r={id:t=t.join("|")};e.topCustom&&(d.verifyParamType("topCustom",e.topCustom,"string","msg::addStickTopSession"),r.topCustom=e.topCustom),this.processCallback(e),this.sendCmd("addStickTopSession",{stickTopSession:r},e.callback)},l.deleteStickTopSession=function(e){d.verifyOptions(e,"id","msg::deleteStickTopSession");var t=d.getIdArray(e.id);d.verifyParamValid("id的前半部分",t[0],this.message.validScenes,"msg::deleteStickTopSession"),d.verifyParamType("id的后半部分",t[1],"string","msg::deleteStickTopSession"),"superTeam"===t[0]&&(t[0]="super_team"),t=t.join("|"),this.processCallback(e),this.sendCmd("deleteStickTopSession",{stickTopSession:{id:t}},e.callback)},l.updateStickTopSession=function(e){d.verifyOptions(e,"id","msg::updateStickTopSession");var t=d.getIdArray(e.id);d.verifyParamValid("id的前半部分",t[0],this.message.validScenes,"msg::updateStickTopSession"),d.verifyParamType("id的后半部分",t[1],"string","msg::updateStickTopSession"),"superTeam"===t[0]&&(t[0]="super_team");var r={id:t=t.join("|")};e.topCustom&&(d.verifyParamType("topCustom",e.topCustom,"string","msg::updateStickTopSession"),r.topCustom=e.topCustom),this.processCallback(e),this.sendCmd("updateStickTopSession",{stickTopSession:r},e.callback)},l.getStickTopSessions=function(e){d.verifyOptions(e,"done","msg::getStickTopSessions"),this.processCallback(e);var t,r=this.protocol.sessionSet,n=[];for(var i in r)(t=this.protocol.getSessionInCache(i,e.findDelete))&&t.isTop&&n.push(r[i]);e.callback(null,n)},l.addMsgPin=function(e){d.verifyOptions(e,"msg","msg::addMsgPin"),h.call(this,e.msg,"msg::addMsgPin");var t={pinFrom:this.account};f(e.pinCustom)&&(d.verifyParamType("pinCustom",e.pinCustom,"string","msg::addMsgPin"),t.pinCustom=e.pinCustom);var r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("addMsgPin",{msg:r,pinTag:t},e.callback)},l.updateMsgPin=function(e){d.verifyOptions(e,"msg","msg::updateMsgPin"),h.call(this,e.msg,"msg::updateMsgPin");var t={pinFrom:this.account};f(e.pinCustom)&&(d.verifyParamType("pinCustom",e.pinCustom,"string","msg::updateMsgPin"),t.pinCustom=e.pinCustom);var r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("updateMsgPin",{msg:r,pinTag:t},e.callback)},l.deleteMsgPin=function(e){d.verifyOptions(e,"msg","msg::deleteMsgPin"),h.call(this,e.msg,"msg::deleteMsgPin");var t={pinFrom:this.account},r={scene:this.message.sceneMap[e.msg.scene],from:e.msg.from,to:e.msg.to,time:e.msg.time,idServer:e.msg.idServer,idClient:e.msg.idClient};this.processCallback(e),this.sendCmd("deleteMsgPin",{msg:r,pinTag:t},e.callback)},l.getMsgPins=function(e){var t=this;d.verifyOptions(e,"id","msg::getMsgPins");var r=this.db,n=d.getIdArray(e.id);d.verifyParamValid("id的前半部分",n[0],this.message.validScenes,"msg::getMsgPins"),d.verifyParamType("id的后半部分",n[1],"string","msg::getMsgPins"),"superTeam"===n[0]&&(n[0]="super_team");var i={sessionId:n=n.join("|"),timetag:0};if(this.processCallback(e),r.enable){var o=this.protocol.timetags.sync;r.getTimetag("pin-"+e.id).then((function(n){n>o?r.getMsgPins(e.id).then((function(t){return e.callback(null,{pins:t||[]})})).catch((function(t){return e.callback(t)})):(i.timetag=n,s.call(t))}))}else s.call(this);function s(){this.sendCmd("getMsgPins",{msgPinReq:i,id:e.id,NOTSTORE:"msgPinReq"},e.callback)}}},function(e,t,r){var n=r(4),i=r(19),o=r(3),s=r(5),a=r(32).fn,c=r(0),u=c.undef,l=c.notundef,d=r(118);a.markSysMsgRead=function(e){var t,r=this.db,s=n.resolve(),a=this.protocol;c.verifyOptions(e,"sysMsgs","sysmsg::markSysMsgRead");var u=e.sysMsgs;function l(){e.done(t,e)}c.isArray(u)||(u=[u]),r.enable?s=r.markSysMsgRead(u).then((function(e){u=e,a.onUpdateSysMsg(e)})):(u=i(u).call(u,(function(e){return!e.read}))).length&&(a.options.autoMarkRead||a.markSysMsgRead(u,!0),o(u).call(u,(function(e){e.read=!0})),a.onUpdateSysMsg(u)),s.then((function(){return a.reduceSysMsgUnread(u)})).then(l,(function(e){t=e,l()}))},a.sendCustomSysMsg=function(e){c.verifyOptions(e,"scene to content","sysmsg::sendCustomSysMsg"),c.verifyParamValid("scene",e.scene,this.message.validScenes,"sysmsg::sendCustomSysMsg"),this.processCallback(e);var t="sendCustomSysMsg";return"p2p"===e.scene?e.type="customP2p":"superTeam"===e.scene?(e.type="customSuperTeam",t="sendSuperTeamCustomSysMsg"):e.type="customTeam",e.sysMsg=new d(e),i(e)&&(t="sendFilterCustomSysMsg"),this.sendCmd(t,{sysMsg:e.sysMsg,single:!0},e.callback),this.formatReturnSysMsg(e.sysMsg)},a.formatReturnSysMsg=function(e){return e=c.copy(e),this.protocol.completeSysMsg(e),e.status="sending",s(d).call(d,e)},a.getLocalSysMsgs=function(e){var t,r=this.db,n=[];function i(){e.sysMsgs=n,e.done(t,e)}c.verifyOptions(e),e.category&&c.verifyParamValid("category",e.category,d.validCategories,"sysmsg::getLocalSysMsgs"),e.type&&c.verifyParamValid("type",e.type,d.validTypes,"sysmsg::getLocalSysMsgs"),u(e.limit)&&(e.limit=100),c.verifyParamType("limit",e.limit,"number","sysmsg::getLocalSysMsgs"),c.verifyParamMax("limit",e.limit,100,"sysmsg::getLocalSysMsgs"),l(s(e))?c.verifyParamType("reverse",s(e),"boolean","sysmsg::getLocalSysMsgs"):e.reverse=!1,this.processCallback(e),r.enable?r.getSysMsgs(e).then((function(e){n=e,i()}),(function(e){t=e,i()})):i()},a.updateLocalSysMsg=function(e){var t,r=this.db,n=null;if(c.verifyOptions(e,"idServer","sysmsg::updateLocalSysMsg"),this.processCallback(e),r.enable){var i=c.filterObj(e,"idServer state localCustom");r.updateSysMsg(i).then((function(e){n=e,o()}),(function(e){t=e,o()}))}else o();function o(){e.sysMsg=n,e.done(t,e)}},a.deleteLocalSysMsg=function(e){var t,r=this.db;function n(){e.done(t,e)}c.verifyOptions(e,"idServer","sysmsg::deleteLocalSysMsg"),this.processCallback(e),r.enable?r.deleteSysMsg(e.idServer).then((function(){n()}),(function(e){t=e,n()})):n()},a.deleteAllLocalSysMsgs=function(e){var t,r=this,n=r.db;function i(){r.protocol.onUpdateSysMsgUnread({}),e.done(t,e)}r.processCallback(e),n.enable?n.deleteAllSysMsgs().then((function(){i()}),(function(e){t=e,i()})):i()}},function(e,t,r){var n=r(32).fn,i=r(0),o=r(14);n.getChatroomAddress=function(e){i.verifyOptions(e,"chatroomId","chatroom::getChatroomAddress"),e.isWeixinApp=o.isWeixinApp,e.type=o.ipVersion,this.processCallback(e),this.sendCmd("getChatroomAddress",e)}},function(e,t){},function(e,t){},function(e,t,r){var n=r(32).fn,i=r(0);n.audioToText=function(e){i.verifyOptions(e,"url","audio::audioToText"),e.audioToText=i.filterObj(e,"url"),this.processCallback(e),this.sendCmd("audioToText",e)}},function(e,t,r){var n=r(32).fn;n.clearDB=function(e){var t=this.db;this.processCallback(e);var r=e.done;t.enable?t.clear().then(r,r):r()},n.removeDB=function(e){var t=this.db;this.processCallback(e);var r=e.done;t.enable?t.destroy().then(r,r):r()},n.closeDB=function(e){var t=this.db;this.processCallback(e);var r=e.done;t.enable?t.close().then(r,r):r()}},function(e,t,r){var n=r(32).fn,i=r(218),o=r(0),s=o.undef;n.getPushNotificationMultiportConfig=function(){return this.protocol.getPushNotificationMultiportConfig()},n.updatePushNotificationMultiportConfig=function(e){o.verifyOptions(e),s(e.shouldPushNotificationWhenPCOnline)&&(e.shouldPushNotificationWhenPCOnline=!0),e.donnop=new i(e),this.processCallback(e),this.sendCmd("updateDonnop",e)}},function(e,t,r){var n=r(3),i=r(4),o=r(13),s=r(27),a=r(32).fn,c=r(0),u=r(592),l=r(593);function d(e){return"object"===s(e)&&(e.msgEventSubscribes?e=e.msgEventSubscribes:e.msgEventSubscribe?e=e.msgEventSubscribe:e.accounts?e=e.accounts:e.msgEvent&&(e=e.msgEvent).time&&(e.time=+e.time),1===e.sync?e.sync=!0:0===e.sync&&(e.sync=!1)),e}a.batchSendEventsCmds=function(e,t,r){var s=this,a=c.dropArrayDuplicates(t.accounts);a=c.reshape2d(a,100);var u=[];n(a).call(a,(function(r){u.push(new i((function(n,i){var o=c.simpleClone(t);o.accounts=r,s.sendCmdWithResp(e,o,(function(e,t){e?i(e):n(d(t))}))})))})),i.all(u).then((function(e){var t=null;if(e.length>0)if(e[0].msgEventSubscribe){var i=e[0].msgEventSubscribe;i=d(i);var s=[];n(e).call(e,(function(e){s=o(s).call(s,e.accounts)})),t={accounts:s,msgEventSubscribe:i}}else t=[],n(e).call(e,(function(e){t=o(t).call(t,e)}));r(null,t)}),(function(e){r(e,null)}))},a.publishEvent=function(e){var t=new u(e);t=t.assembleEvent(),this.processCallback(e),this.sendCmdWithResp("publishEvent",{msgEvent:t},(function(t,r){t||(r=d(r)),e.callback(t,r)}))},a.subscribeEvent=function(e){c.verifyOptions(e,"accounts","event::subscribeEvent");var t=new l(e);c.verifyParamType("accounts",e.accounts,"array","event::subscribeEvent"),this.processCallback(e),t=t.assembleEvent(),this.batchSendEventsCmds("subscribeEvent",{msgEventSubscribe:t,accounts:e.accounts},(function(t,r){!t&&r&&(r={failedAccounts:r}),e.callback(t,r)}))},a.unSubscribeEventsByAccounts=function(e){c.verifyOptions(e,"accounts","event::unSubscribeEventsByAccounts"),c.verifyParamType("accounts",e.accounts,"array","event::unSubscribeEventsByAccounts");var t=new l(e);t=t.assembleEvent(),this.processCallback(e),this.batchSendEventsCmds("unSubscribeEventsByAccounts",{msgEventSubscribe:t,accounts:e.accounts},(function(t,r){!t&&r&&(r={failedAccounts:r}),e.callback(t,r)}))},a.unSubscribeEventsByType=function(e){var t=new l(e);t=t.assembleEvent(),this.processCallback(e),this.sendCmdWithResp("unSubscribeEventsByType",{msgEventSubscribe:t},(function(t,r){e.callback(t,r)}))},a.querySubscribeEventsByAccounts=function(e){c.verifyOptions(e,"accounts","event::querySubscribeEventsByAccounts"),c.verifyParamType("accounts",e.accounts,"array","event::querySubscribeEventsByAccounts");var t=new l(e);t=t.assembleEvent(),this.processCallback(e),this.batchSendEventsCmds("querySubscribeEventsByAccounts",{msgEventSubscribe:t,accounts:e.accounts},(function(t,r){!t&&r&&(r={msgEventSubscribes:r}),e.callback(t,r)}))},a.querySubscribeEventsByType=function(e){var t=new l(e);t=t.assembleEvent(),this.processCallback(e),this.sendCmdWithResp("querySubscribeEventsByType",{msgEventSubscribe:t},(function(t,r){t||(r={msgEventSubscribes:d(r)}),e.callback(t,r)}))}},function(e,t,r){var n=r(6),i=r(0),o=i.notundef,s=r(36);function a(e){if(i.verifyOptions(e,"type value","event::MsgEvent"),i.verifyParamType("type",e.type,"number","event::MsgEvent"),i.verifyParamType("value",e.value,"number","event::MsgEvent"),this.type=e.type,this.value=e.value,this.idClient=i.guid(),o(e.custom)&&(this.custom=""+e.custom),this.validTime=e.validTime||604800,i.verifyParamType("validTime",this.validTime,"number","event::MsgEvent"),i.verifyParamMin("validTime",this.validTime,60,"event::MsgEvent"),i.verifyParamMax("validTime",this.validTime,604800,"event::MsgEvent"),o(e.broadcastType)){var t;if(i.verifyParamType("broadcastType",e.broadcastType,"number","event::MsgEvent"),n(t=[1,2]).call(t,e.broadcastType)<0)throw new s('参数错误"broadcastType":只能为1或2');this.broadcastType=e.broadcastType}else this.broadcastType=2;o(e.sync)?(i.verifyParamType("sync",e.sync,"boolean","event::MsgEvent"),this.sync=e.sync):this.sync=!1}a.prototype.assembleEvent=function(){return{type:this.type,value:this.value,idClient:this.idClient,custom:this.custom||"",validTime:this.validTime,broadcastType:this.broadcastType,sync:!0===this.sync?1:0}},e.exports=a},function(e,t,r){var n=r(0),i=n.notundef;function o(e){n.verifyOptions(e,"type","event::MsgEventSubscribe"),n.verifyParamType("type",e.type,"number","event::MsgEventSubscribe"),n.findObjIndexInArray([1,2,3],e.type)<0&&n.verifyParamMin("type",e.type,1e5,"event::MsgEventSubscribe"),this.type=e.type,i(e.subscribeTime)?(n.verifyParamType("subscribeTime",e.subscribeTime,"number","event::MsgEventSubscribe"),n.verifyParamMin("subscribeTime",e.subscribeTime,60,"event::MsgEventSubscribe"),n.verifyParamMax("subscribeTime",e.subscribeTime,2592e3,"event::MsgEventSubscribe"),this.subscribeTime=e.subscribeTime):this.subscribeTime=2592e3,i(e.sync)?(n.verifyParamType("sync",e.sync,"boolean","event::MsgEventSubscribe"),this.sync=e.sync):this.sync=!0}o.prototype.assembleEvent=function(){return{type:this.type,subscribeTime:this.subscribeTime,sync:!0===this.sync?1:0}},e.exports=o},function(e,t,r){var n=r(42),i=r(32).fn,o=r(0);i.httpRequestProxy=function(e){o.verifyOptions(e,"path","misc::httpRequestProxy");var t=n({},e);delete t.done,this.processCallback(e),this.sendCmd("httpProxy",{proxyTag:t},e.callback)}},function(e,t,r){var n=r(32).fn,i=r(14);n.getQChatAddress=function(e){this.processCallback(e),this.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:i.ipVersion}},e.done)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){e.exports=r(491)}])}))})),NIM=unwrapExports(NIM_Web_NIM);NIM_Web_NIM.NIM;var name$1="@yxim/nim-web-sdk",version$1="9.8.0",privateVersion="7.9.0.0",sdkVersion=90800,protocolVersion=1,description$1="NIM Web SDK 网易云信|真正稳定的即时通讯云服务",main$1="dist/SDK/NIM_Web_SDK.js",types$4="dist/types/index.d.ts",directories={test:"test"},scripts$1={prepare:"husky install",clean:"rm -rf ./dist",lint:"npx eslint ./src ./test","build:sdk":"webpack --config webpack.config.js","build:api":"jsdoc -r -c ./build/api/jsdoc.config.json -t ./external/ink-docstrap/template -d ./dist/api && npm run build:ts-api","zip:api":"cross-env NODE_ENV=production npm run build:api && node build/api/zip.js","zip:sdk":"cross-env NODE_ENV=production node build/sdk/zip.js",copy:"cross-env NODE_ENV=production node build/sdk/copy.js ",dev:"npm run clean && cross-env PLATFORM=all npm run build:sdk -- -w",tsc:"tsc --emitDeclarationOnly","analyzer:browser":"npm run clean && cross-env PLATFORM=browser NODE_ENV=production ANALYZER_BROWSER=true npm run build:sdk","analyzer:miniapp":"npm run clean && cross-env PLATFORM=miniapp NODE_ENV=production ANALYZER_MINIAPP=true npm run build:sdk",pack:"npm run clean && cross-env PLATFORM=all NODE_ENV=production npm run build:sdk && npm run tsc && npm run zip:sdk && npm run copy",test:"jest --coverage --coverageReporters='json-summary'","build:ts-api":"typedoc --name NIM --tsconfig ./typedocNIM.json && typedoc --name Chatroom --tsconfig ./typedocChatroom.json"},files$1=["dist/SDK/","dist/types/"],author$1="netease",dependencies$1={axios:"^0.18.0",backo2:"^1.0.2","crypto-js":"^4.1.1","deep-access":"^0.1.1","es6-promise":"^4.2.4",eventemitter3:"^4.0.7","javascript-natural-sort":"^0.7.1",md5:"^2.2.1","object-assign":"^4.1.1",ws:"^5.1.1",x2js:"^3.2.1",xhr:"^2.4.1"},devDependencies$1={"@babel/cli":"^7.16.0","@babel/core":"^7.16.0","@babel/plugin-transform-runtime":"^7.16.4","@babel/preset-env":"^7.16.4","@babel/runtime-corejs3":"^7.16.3","@typescript-eslint/eslint-plugin":"^5.28.0","@typescript-eslint/parser":"^5.28.0","@yxfe/nepublisher":"0.0.17","@yxfe/nim-log-reporter":"^0.0.13","@yxfe/request":"^0.2.8",archiver:"^2.1.1","babel-loader":"^8.2.3","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-transform-async-to-generator":"^6.24.1","babel-plugin-transform-runtime":"^6.23.0","core-js":"^3.19.1","cross-env":"^5.1.4",eslint:"^8.9.0","eslint-config-prettier":"^8.5.0","eslint-plugin-prettier":"^4.0.0","fs-extra":"^5.0.0",happypack:"^5.0.1",husky:"^8.0.1","imports-loader":"^0.8.0","ink-docstrap":"^1.3.2","javascript-state-machine":"^3.1.0",jest:"^27.5.1","js-conditional-compile-loader":"^1.0.15",jsdoc:"^3.6.0","npm-run-all":"^4.1.2","on-build-webpack":"^0.1.0","pre-build-webpack":"^0.1.0",prettier:"^2.7.1",prettyjson:"^1.1.3",prompt:"^1.0.0","raw-loader":"^0.5.1",typedoc:"^0.22.11",typescript:"^4.5.4","watch-cli":"^0.2.3",webpack:"^4.5.0","webpack-bundle-analyzer":"^4.5.0","webpack-cli":"^3.3.12","webpack-merge":"^4.1.2","wolfy87-eventemitter":"^5.2.4","worker-loader":"^3.0.4",yaml:"^0.3.0",yargs:"^11.0.0"},imPackageJson$1={name:name$1,private:!1,version:version$1,privateVersion:privateVersion,sdkVersion:sdkVersion,protocolVersion:protocolVersion,description:description$1,main:main$1,types:types$4,directories:directories,scripts:scripts$1,files:files$1,author:author$1,dependencies:dependencies$1,devDependencies:devDependencies$1},NIMWebSystemMessageType;!function(e){e[e.addFriend=0]="addFriend",e[e.applyFriend=1]="applyFriend",e[e.applySuperTeam=2]="applySuperTeam",e[e.applyTeam=3]="applyTeam",e[e.custom=4]="custom",e[e.deleteFriend=5]="deleteFriend",e[e.deleteMsg=6]="deleteMsg",e[e.passFriendApply=7]="passFriendApply",e[e.rejectFriendApply=8]="rejectFriendApply",e[e.rejectSuperTeamApply=9]="rejectSuperTeamApply",e[e.rejectSuperTeamInvite=10]="rejectSuperTeamInvite",e[e.rejectTeamApply=11]="rejectTeamApply",e[e.rejectTeamInvite=12]="rejectTeamInvite",e[e.superTeamInvite=13]="superTeamInvite",e[e.teamInvite=14]="teamInvite"}(NIMWebSystemMessageType||(NIMWebSystemMessageType={}));var logger$1=c$1({level:"debug",appName:packageJson.name,version:packageJson.version}),loggerDec$1=a$1("nim-kit-core-1",logger$1),NimKitCore$1=function(){function e(e){var t=e.initOptions,r=e.otherOptions,n=void 0===r?{}:r,i=e.funcOptions,o=void 0===i?{}:i,s=e.platform,a=void 0===s?"Web":s,c=this;this.version=imPackageJson$1.version,this.connectState="idle",this.emitter=new Eventemitter,this.initOptions=t,this.otherOptions=n,this.platform=a;var u={onconnect:function(e){c.emit("logined",e),c.connectState="connected"},ondisconnect:function(e){if(c.connectState="disconnected",e)switch(e.code){case 302:case 417:default:c.emit("disconnect");break;case"kicked":c.emit("kicked",e)}else c.emit("disconnect")},onwillreconnect:function(e){c.connectState="connecting",c.emit("willReconnect",e)},onProxyMsg:function(e){c.emit("proxyMsg",e)},onmsg:function(e){var t=c._formatMsg1to2(e);c.emit("msg",t)},onsessions:function(e){var t=e.map((function(e){return c._formatSession1to2(e)}));c.emit("sessions",t)},onupdatesession:function(e){var t=c._formatSession1to2(e);c.emit("updateSession",t)},onAddTeamMembers:function(e){c.emit("addTeamMembers",__assign(__assign({},e),{members:e.members.map(c._formatTeamMember1to2.bind(c))}))},onRemoveTeamMembers:function(e){c.emit("removeTeamMembers",e)},onupdateteammember:function(e){c.emit("updateTeamMember",c._formatTeamMember1to2(e))},onUpdateTeamManagers:function(e){c.emit("updateTeamManagers",__assign(__assign({},e),{members:e.members.map(c._formatTeamMember1to2.bind(c))}))},onUpdateTeamMembersMute:function(e){c.emit("updateTeamMembersMute",__assign(__assign({},e),{members:e.members.map(c._formatTeamMember1to2.bind(c))}))},onteams:function(e){c.emit("teams",e)},onsynccreateteam:function(e){c.emit("createTeam",e,{})},onCreateTeam:function(e){c.emit("createTeam",e,{})},onDismissTeam:function(e){c.emit("dismissTeam",e)},onUpdateTeam:function(e){c.emit("updateTeam",e)},onTransferTeam:function(e){c.emit("transferTeam",e)},onsyncfriendaction:function(e){var t=e.account,r=e.friend,n=e.type;c.emit("syncFriend",{account:t,friend:r,type:n})},onfriends:function(e){c.emit("friends",e)},onDeleteMsgSelf:function(e){var t=e.map((function(e){return c._formatMsg1to2(e)}));c.emit("deleteSelfMsgs",t)},onblacklist:function(e){c.emit("relations",{blackList:e,muteList:[]})},onsyncmarkinblacklist:function(e){c.emit("updateBlackList",e)},onmutelist:function(e){c.emit("relations",{blackList:[],muteList:e})},onsyncmarkinmutelist:function(e){c.emit("updateBlackList",e)},onusers:function(e){c.emit("users",e)},onmyinfo:function(e){c.emit("syncMyNameCard",e)},onupdatemyinfo:function(e){c.emit("updateMyNameCard",__assign(__assign({},e),{signature:e.sign,ext:e.custom}))},onsysmsg:function(e){c.emit("sysMsg",c._formatSysMsg1to2(e))},onofflinesysmsgs:function(e){var t=e.map(c._formatSysMsg1to2);c.emit("syncSysMsgs",t)},onroamingsysmsgs:function(e){var t=e.map(c._formatSysMsg1to2);c.emit("syncSysMsgs",t)},onupdatesysmsg:function(e){var t=c._formatSysMsg1to2(e);c.emit("updateSystemMessages",[{idServer:t.idServer,state:"passed"===t.state?"pass":"rejected"===t.state?"decline":"invalid",from:t.from,type:t.type}])},onTeamMsgReceipt:function(e){c.emit("teamMsgReceipts",e.teamMsgReceipts)},onsyncdone:function(){c.emit("syncdone")},onloginportschange:function(e){c.emit("multiPortLogin",e)}},l=this._hijackFunc(o,u);this.nim=NIM.getInstance(__assign(__assign(__assign({},t),{appKey:t.appkey,account:t.account,token:t.token,debug:"off"!==t.debugLevel,privateConf:n.serverConfig,db:!1,shouldIgnoreNotification:function(){return!1},shouldCountNotifyUnread:function(){return!1},syncSessionUnread:!0,rollbackDelMsgUnread:!0,rollbackClearMsgsUnread:!0,syncStickTopSessions:!0}),l));["ContactKit","ConversationKit","ChatKit","SearchKit"].forEach((function(e){new EventTracking$1({appKey:c.initOptions.appkey,version:"9.3.1",component:e,imVersion:c.version,platform:c.platform}).track("init","")}))}return e.prototype.getNIM=function(){return this.nim},e.prototype.connect=function(){return this._connect()},e.prototype.disconnect=function(){return this._disconnect()},e.prototype.destroy=function(){return this._destroy()},e.prototype.saveMyUserInfo=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n;return __generator(this,(function(i){switch(i.label){case 0:if(!e.file||!e.type)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._uploadFile({file:e.file,type:e.type})];case 2:return t=i.sent(),[3,4];case 3:return r=i.sent(),logger$1.error("uploadFile error: ",r),logger$1.warn("去除头像信息继续保存用户信息"),[3,4];case 4:return n={nick:e.nick,signature:e.signature,avatar:t?t.url:e.avatar,gender:e.gender,email:e.email,birth:e.birth,tel:e.tel,ext:e.ext},[4,this._updateMyNameCard(n)];case 5:return[2,i.sent()]}}))}))},e.prototype.getTeamMembers=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._getTeamMembers(e)]}))}))},e.prototype.isSessionExist=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,this._getSession({id:e})];case 1:return[2,!!(t=r.sent())&&void 0!==t.lastMsg]}}))}))},e.prototype.resetSessionUnreadCount=function(e){return this._resetSessionUnreadCount(e)},e.prototype.addFriend=function(e){return this._addFriend(e)},e.prototype.applyFriend=function(e){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(r){return[2,new Promise((function(r,n){t.nim.applyFriend(__assign(__assign({},e),{done:function(e){if(e)return n(e);r()}}))}))]}))}))},e.prototype.deleteFriend=function(e){return this._deleteFriend(e)},e.prototype.updateFriend=function(e){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(r){return[2,new Promise((function(r,n){t.nim.updateFriend(__assign(__assign({},e),{custom:e.ext,done:function(e,t){if(e)return n(e);r()}}))}))]}))}))},e.prototype.setBlack=function(e){return this._setBlack(e)},e.prototype.deleteSession=function(e){return this._deleteSession(e)},e.prototype.setMute=function(e){return this._setMute(e)},e.prototype.createTeam=function(e){return this._createTeam(e)},e.prototype.getUsersNameCardFromServer=function(e){return this._getUsersNameCardFromServer(e)},e.prototype.getTeamInfo=function(e){return this._getTeamInfo(e)},e.prototype.applyTeam=function(e){return this._applyTeam(e)},e.prototype.addTeamMembers=function(e){return this._addTeamMembers(e)},e.prototype.removeTeamMembers=function(e){return this._removeTeamMembers(e)},e.prototype.updateTeamInfo=function(e){return this._updateTeamInfo(e)},e.prototype.muteTeam=function(e){return this._muteTeam(e)},e.prototype.dismissTeam=function(e){return this._dismissTeam(e)},e.prototype.leaveTeam=function(e){return this._leaveTeam(e)},e.prototype.sendTextMsg=function(e){return this._sendTextMsg(__assign(__assign({},e),{resend:!1}))},e.prototype.sendCustomMsg=function(e){return this._sendCustomMsg(__assign(__assign({},e),{resend:!1}))},e.prototype.sendImageMsg=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._sendFileMsg(__assign(__assign({},e),{resend:!1,type:"image"}))];case 1:return[2,t.sent()]}}))}))},e.prototype.sendFileMsg=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._sendFileMsg(__assign(__assign({},e),{resend:!1,type:"file"}))];case 1:return[2,t.sent()]}}))}))},e.prototype.resendMsg=function(e){var t=e.msg;return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(e=JSON.stringify(t.attach),t.type){case"text":return[2,this._sendTextMsg(__assign(__assign({},t),{status:this._formatMsgStatus2to1(t.status),attach:e,resend:!0}))];case"file":return[2,this._sendFileMsg(__assign(__assign({},t),{status:this._formatMsgStatus2to1(t.status),resend:!0,type:"file"}))];case"image":return[2,this._sendFileMsg(__assign(__assign({},t),{status:this._formatMsgStatus2to1(t.status),resend:!0,type:"image"}))];case"custom":return[2,this._sendCustomMsg(__assign(__assign({},t),{status:this._formatMsgStatus2to1(t.status),attach:e,resend:!0}))];default:throw Error("resendMs type is not supported.")}}))}))},e.prototype.recallMsg=function(e){return this._recallMsg(e)},e.prototype.sendMsgReceipt=function(e){return this._sendMsgReceipt(e)},e.prototype.sendTeamMsgReceipt=function(e){return this._sendTeamMsgReceipt(e)},e.prototype.getTeamMsgReads=function(e){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(r){return[2,new Promise((function(r,n){t.nim.getTeamMsgReads(__assign(__assign({},e),{done:function(e,t,i){if(e)return n(e);r(i.teamMsgReceipts)}}))}))]}))}))},e.prototype.deleteSelfMsgs=function(e){return this._deleteSelfMsgs(e)},e.prototype.getHistoryMsgs=function(e){return this._getHistoryMsgs(e)},e.prototype.passFriendApply=function(e){var t=this;return new Promise((function(r,n){t.nim.passFriendApply(__assign(__assign({idServer:(Math.random()+"").slice(-6)},e),{done:function(e,t){if(e)return n(e);r()}}))}))},e.prototype.rejectFriendApply=function(e){var t=this;return new Promise((function(r,n){t.nim.rejectFriendApply(__assign(__assign({idServer:(Math.random()+"").slice(-6)},e),{done:function(e,t){if(e)return n(e);r()}}))}))},e.prototype.passTeamApply=function(e){var t=this;return new Promise((function(r,n){t.nim.passTeamApply(__assign(__assign({idServer:(Math.random()+"").slice(-6)},e),{done:function(e,t){if(e)return n(e);r()}}))}))},e.prototype.rejectTeamApply=function(e){var t=this;return new Promise((function(r,n){t.nim.rejectTeamApply(__assign(__assign({idServer:(Math.random()+"").slice(-6)},e),{done:function(e,t){if(e)return n(e);r()}}))}))},e.prototype.acceptTeamInvite=function(e){var t=this;return new Promise((function(r,n){t.nim.acceptTeamInvite(__assign(__assign({idServer:(Math.random()+"").slice(-6)},e),{done:function(e,t){if(e)return n(e);r()}}))}))},e.prototype.rejectTeamInvite=function(e){var t=this;return new Promise((function(r,n){t.nim.rejectTeamInvite(__assign(__assign({idServer:(Math.random()+"").slice(-6)},e),{done:function(e,t){if(e)return n(e);r()}}))}))},e.prototype.addStickTopSession=function(e){var t=this;return new Promise((function(r,n){t.nim.addStickTopSession({id:e.id,topCustom:e.ext,done:function(e,i){if(e)return n(e);var o=t._formatSession1to2(i.stickTopSession);r(o)}})}))},e.prototype.deleteStickTopSession=function(e){var t=this;return new Promise((function(r,n){t.nim.deleteStickTopSession({id:e.id,done:function(e,i){if(e)return n(e);var o=t._formatSession1to2(i.stickTopSession);r(o)}})}))},e.prototype.updateMyMemberInfo=function(e){var t=this;return new Promise((function(r,n){t.nim.updateInfoInTeam(__assign(__assign({},e),{muteNotiType:e.bitConfigMask?e.bitConfigMask+"":void 0,custom:e.ext,done:function(e,i){if(e)return n(e);r(t._formatTeamMember1to2(i))}}))}))},e.prototype.on=function(e,t,r){return this.emitter.on(e,t,r),this},e.prototype.off=function(e,t,r,n){return this.emitter.off(e,t,r,n),this},e.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=this.emitter).emit.apply(t,__spreadArray([e],__read(r),!1))},e.prototype._hijackFunc=function(e,t){var r={};return Object.keys(t).forEach((function(n){var i=e[n],o=t[n];r[n]=i?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.apply(this,e),o.apply(this,e)}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.apply(this,e)}})),__assign(__assign({},e),r)},e.prototype._updateMyNameCard=function(e){var t=this;return new Promise((function(r,n){t.nim.updateMyInfo(__assign(__assign({},e),{sign:e.signature,custom:e.ext,done:function(e,t){e?n(e):r(t)}}))}))},e.prototype._getRelations=function(){var e=this;return new Promise((function(t,r){e.nim.getRelations({done:function(e,n){e?r(e):t(n)}})}))},e.prototype._getTeamMembers=function(e){var t=this;return new Promise((function(r,n){t.nim.getTeamMembers(__assign(__assign({},e),{done:function(e,i){e?n(e):r((i.members||[]).map(t._formatTeamMember1to2.bind(t)))}}))}))},e.prototype._getSession=function(e){var t=this;return new Promise((function(r,n){t.nim.getLocalSession({sessionId:e.id,done:function(e,i){if(e)n(e);else{var o=i?t._formatSession1to2(i):i;r(o)}}})}))},e.prototype._uploadFile=function(e){var t=this;return new Promise((function(r,n){t.nim.previewFile(__assign(__assign({},e),{blob:e.file,done:function(e,t){e?n(e):r(t)}}))}))},e.prototype._getUsersNameCardFromServer=function(e){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(r){return[2,new Promise((function(r,n){if(!e.accounts||!e.accounts.length)return r([]);t.nim.getUsers(__assign(__assign({},e),{done:function(e,t){if(e)n(e);else{var i=t.map((function(e){return __assign(__assign({},e),{ext:e.custom,signature:e.sign})}));r(i)}}}))}))]}))}))},e.prototype._formatSysMsg1to2=function(e){switch(e.type){case"addFriend":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"friendRequest",attach:__assign(__assign({},e.attach),{type:"addFriend"})});case"applyFriend":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"friendRequest",attach:__assign(__assign({},e.attach),{type:"applyFriend"})});case"applySuperTeam":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"applySuperTeam"});case"applyTeam":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"applyTeam"});case"custom":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"p2p"===e.scene?"customP2p":"team"===e.scene?"customTeam":"customSuperTeam"});case"deleteFriend":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"deleteFriend"});case"deleteMsg":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",recallMessageInfo:(null==e?void 0:e.msg)||{},type:"p2p"===e.scene?"recallMsgP2p":"team"===e.scene?"recallMsgTeam":"recallMsgSuperTeam"});case"passFriendApply":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"friendRequest",attach:__assign(__assign({},e.attach),{type:"passFriendApply"})});case"rejectFriendApply":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"friendRequest",attach:__assign(__assign({},e.attach),{type:"rejectFriendApply"})});case"rejectSuperTeamApply":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"rejectSuperTeamApply"});case"rejectSuperTeamInvite":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"rejectSuperTeamInvite"});case"rejectTeamApply":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"rejectTeamApply"});case"rejectTeamInvite":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"rejectTeamInvite"});case"superTeamInvite":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"superTeamInvite"});case"teamInvite":return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:"teamInvite"});default:return __assign(__assign({},e),{feature:"default",idServer:e.idServer||"",type:""})}},e.prototype._formatMsgStatus1to2=function(e,t){return t?"refused":{sending:"sending",success:"sent",fail:"sendFailed"}[e]||e},e.prototype._formatMsgStatus2to1=function(e){return"refused"===e?"fail":{sending:"sending",sent:"success",sendFailed:"fail"}[e]||e},e.prototype._formatSession1to2=function(e){return __assign(__assign({},e),{stickTopInfo:{id:e.id,isStickOnTop:!!e.isTop,ext:e.topCustom},lastMsg:e.lastMsg?this._formatMsg1to2(e.lastMsg):e.lastMsg})},e.prototype._formatMsg1to2=function(e){var t=this._formatMsgStatus1to2(e.status,e.isInBlackList);switch(e.type){case"video":case"file":case"image":case"audio":return __assign(__assign({},e),{body:e.text||"",attach:e.file,status:t,ext:e.custom});case"geo":return __assign(__assign({},e),{body:e.text||"",attach:e.geo,status:t,ext:e.custom});case"robot":case"custom":var r=void 0;try{r=JSON.parse(e.content||"")}catch(e){r={}}return __assign(__assign({},e),{body:e.text||"",attach:r,status:t,ext:e.custom});case"tip":return __assign(__assign({},e),{body:e.tip||"",status:t,ext:e.custom});case"text":return __assign(__assign({},e),{body:e.text||"",status:t,ext:e.custom});default:return __assign(__assign({},e),{status:t,ext:e.custom})}},e.prototype._formatMsg2to1=function(e){var t=this._formatMsgStatus2to1(e.status);switch(e.type){case"video":case"file":case"image":case"audio":return __assign(__assign({},e),{text:e.body||"",file:e.attach,status:t,custom:e.ext});case"geo":return __assign(__assign({},e),{text:e.body||"",geo:e.attach,status:t,custom:e.ext});case"robot":case"custom":var r=void 0;try{r=JSON.stringify(e.attach||"")}catch(e){r=""}return __assign(__assign({},e),{text:e.body||"",content:r,status:t,custom:e.ext});case"tip":return __assign(__assign({},e),{tip:e.body||"",status:t,custom:e.ext});case"text":return __assign(__assign({},e),{text:e.body||"",status:t,custom:e.ext});default:return __assign(__assign({},e),{status:t,custom:e.ext})}},e.prototype._formatTeam1to2=function(e){return __assign(__assign({},e),{ext:e.custom,serverExt:e.serverCustom,updateExtMode:e.updateCustomMode})},e.prototype._formatTeamMember1to2=function(e){return __assign(__assign({},e),{bitConfigMask:e.muteNotiType?Number(e.muteNotiType):void 0,ext:e.custom})},e.prototype._formatPushInfo2to1=function(e){if(e){var t;try{t=JSON.parse(e.forcePushIDsList||"")}catch(e){t=[]}return{needPushNick:e.needPushNick,isPushable:e.needPush,pushContent:e.pushContent,pushPayload:e.pushPayload,apns:{accounts:t,content:e.pushApnsText,forcePush:e.needForcePush}}}},e.prototype._sendTextMsg=function(e){var t=this;return new Promise((function(r,n){var i,o=e.body,s=e.ext,a=e.onSendBefore,c=t._formatPushInfo2to1(e.pushInfo),u=t.nim.sendText(__assign(__assign(__assign({},e),c),{text:o,custom:s,needMsgReceipt:(null===(i=e.teamSpecializationInfo)||void 0===i?void 0:i.needACK)||!1,done:function(e,i){var o=t._formatMsg1to2(i);if(e)return n(__assign(__assign({},e),{msg:o}));r(o)}})),l=t._formatMsg1to2(u);null==a||a(l)}))},e.prototype._sendCustomMsg=function(e){var t=this;return new Promise((function(r,n){var i,o=e.body,s=e.attach,a=e.ext,c=e.onSendBefore,u=t._formatPushInfo2to1(e.pushInfo),l=t.nim.sendCustomMsg(__assign(__assign(__assign({},e),u),{text:o,content:s,custom:a,needMsgReceipt:(null===(i=e.teamSpecializationInfo)||void 0===i?void 0:i.needACK)||!1,done:function(e,i){var o=t._formatMsg1to2(i);if(e)return n(__assign(__assign({},e),{msg:o}));r(o)}})),d=t._formatMsg1to2(l);null==c||c(d)}))},e.prototype._sendFileMsg=function(e){var t=this;return new Promise((function(r,n){var i,o=e.body,s=e.ext,a=e.file,c=e.resend,u=e.attach,l=e.onSendBefore,d=e.onUploadDone,p=e.onUploadProgress,m=e.onUploadStart,f=t._formatPushInfo2to1(e.pushInfo),h=c?{file:u}:{file:void 0,blob:a};t.nim.sendFile(__assign(__assign(__assign(__assign(__assign({},e),f),{text:o,custom:s}),h),{needMsgReceipt:(null===(i=e.teamSpecializationInfo)||void 0===i?void 0:i.needACK)||!1,beginupload:m,uploadprogress:p,beforesend:function(e){var r=t._formatMsg1to2(e);null==l||l(r)},uploaddone:function(e,t){if(e)return n(__assign(__assign({},e),{name:"uploadError"}));null==d||d(t)},done:function(e,i){var o=t._formatMsg1to2(i);if(e)return n(__assign(__assign({},e),{msg:o}));r(o)}}))}))},e.prototype._connect=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.nim.connect()]}))}))},e.prototype._disconnect=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.nim.disconnect()]}))}))},e.prototype._destroy=function(){var e=this;return new Promise((function(t){e.nim.destroy({done:function(){t()}})}))},e.prototype._resetSessionUnreadCount=function(e){var t=this;return new Promise((function(r,n){t.nim.resetSessionUnread(e.id,(function(e){e?n(e):r()}))}))},e.prototype._addFriend=function(e){var t=this;return new Promise((function(r,n){t.nim.addFriend(__assign(__assign({},e),{done:function(e,t){e?n(e):r(t.friend)}}))}))},e.prototype._deleteFriend=function(e){var t=this;return new Promise((function(r,n){t.nim.deleteFriend(__assign(__assign({},e),{done:function(e){e?n(e):r()}}))}))},e.prototype._setBlack=function(e){var t=this;return new Promise((function(r,n){t.nim.markInBlacklist(__assign(__assign({},e),{done:function(e){e?n(e):r()}}))}))},e.prototype._deleteSession=function(e){var t=this;return new Promise((function(r,n){t.nim.deleteLocalSession({id:e.id,isDeleteRoaming:e.isSyncToServer,done:function(e){e?n(e):r()}})}))},e.prototype._setMute=function(e){var t=this;return new Promise((function(r,n){t.nim.markInMutelist(__assign(__assign({},e),{done:function(e){e?n(e):r()}}))}))},e.prototype._createTeam=function(e){var t=this;return new Promise((function(r,n){var i=__assign(__assign({},e),{custom:e.ext||"",updateCustomMode:e.updateExtMode||""});t.nim.createTeam(__assign(__assign({},i),{done:function(e,i){e?n(e):r(t._formatTeam1to2(i.team))}}))}))},e.prototype._getTeamInfo=function(e){var t=this;return new Promise((function(r,n){t.nim.getTeam(__assign(__assign({},e),{done:function(e,i){e?n(e):r(t._formatTeam1to2(i))}}))}))},e.prototype._applyTeam=function(e){var t=this;return new Promise((function(r,n){t.nim.applyTeam(__assign(__assign({},e),{done:function(e,i){e?n(e):r(t._formatTeam1to2(i))}}))}))},e.prototype._addTeamMembers=function(e){var t=this;return new Promise((function(r,n){t.nim.addTeamMembers(__assign(__assign({},e),{custom:e.ext,done:function(e,t){e?n(e):r()}}))}))},e.prototype._removeTeamMembers=function(e){var t=this;return new Promise((function(r,n){t.nim.removeTeamMembers(__assign(__assign({},e),{done:function(e){if(e)return n(e);r()}}))}))},e.prototype._updateTeamInfo=function(e){var t=this,r=e.ext,n=e.updateExtMode;return new Promise((function(i,o){return t.nim.updateTeam(__assign(__assign({},e),{custom:r,updateCustomMode:n,done:function(e,t){if(e)return o(e);i(t)}}))}))},e.prototype._muteTeam=function(e){var t=this;return new Promise((function(r,n){return t.nim.muteTeamAll(__assign(__assign({},e),{done:function(e){if(e)return n(e);r()}}))}))},e.prototype._dismissTeam=function(e){var t=this;return new Promise((function(r,n){return t.nim.dismissTeam(__assign(__assign({},e),{done:function(e){if(e)return n(e);r()}}))}))},e.prototype._leaveTeam=function(e){var t=this;return new Promise((function(r,n){return t.nim.leaveTeam(__assign(__assign({},e),{done:function(e){if(e)return n(e);r()}}))}))},e.prototype._recallMsg=function(e){var t=this;return new Promise((function(r,n){t.nim.recallMsg(__assign(__assign({},e),{msg:t._formatMsg2to1(e.msg),done:function(t){if(t)return n(t);r(e.msg)}}))}))},e.prototype._sendMsgReceipt=function(e){var t=this;return new Promise((function(r,n){t.nim.sendMsgReceipt(__assign(__assign({},e),{msg:t._formatMsg2to1(e.msg),done:function(e){e?n(e):r()}}))}))},e.prototype._sendTeamMsgReceipt=function(e){var t=this;return new Promise((function(r,n){t.nim.sendTeamMsgReceipt(__assign(__assign({},e),{done:function(e){e?n(e):r()}}))}))},e.prototype._deleteSelfMsgs=function(e){var t=this;return new Promise((function(r,n){var i=e.msgs[0],o=i.from,s=i.to,a=i.idClient,c=i.scene,u=i.time,l=i.idServer,d=void 0===l?"":l;t.nim.deleteMsgSelf({msg:i,done:function(e){if(e)return n(e);r([{deletedTime:Date.now(),from:o,idClient:a,idServer:d,scene:c,time:u,to:s}])}})}))},e.prototype._getHistoryMsgs=function(e){var t=this;return new Promise((function(r,n){t.nim.getHistoryMsgs(__assign(__assign({},e),{done:function(e,i){if(e)n(e);else{var o=(i.msgs||[]).map(t._formatMsg1to2.bind(t));r(o)}}}))}))},e.getInstance=function(t){return this.ins||(this.ins=new e(t)),this.ins},__decorate([loggerDec$1],e.prototype,"connect",null),__decorate([loggerDec$1],e.prototype,"disconnect",null),__decorate([loggerDec$1],e.prototype,"destroy",null),__decorate([loggerDec$1],e.prototype,"saveMyUserInfo",null),__decorate([loggerDec$1],e.prototype,"getTeamMembers",null),__decorate([loggerDec$1],e.prototype,"isSessionExist",null),__decorate([loggerDec$1],e.prototype,"resetSessionUnreadCount",null),__decorate([loggerDec$1],e.prototype,"addFriend",null),__decorate([loggerDec$1],e.prototype,"applyFriend",null),__decorate([loggerDec$1],e.prototype,"deleteFriend",null),__decorate([loggerDec$1],e.prototype,"updateFriend",null),__decorate([loggerDec$1],e.prototype,"setBlack",null),__decorate([loggerDec$1],e.prototype,"deleteSession",null),__decorate([loggerDec$1],e.prototype,"setMute",null),__decorate([loggerDec$1],e.prototype,"createTeam",null),__decorate([loggerDec$1],e.prototype,"getUsersNameCardFromServer",null),__decorate([loggerDec$1],e.prototype,"getTeamInfo",null),__decorate([loggerDec$1],e.prototype,"applyTeam",null),__decorate([loggerDec$1],e.prototype,"addTeamMembers",null),__decorate([loggerDec$1],e.prototype,"removeTeamMembers",null),__decorate([loggerDec$1],e.prototype,"updateTeamInfo",null),__decorate([loggerDec$1],e.prototype,"muteTeam",null),__decorate([loggerDec$1],e.prototype,"dismissTeam",null),__decorate([loggerDec$1],e.prototype,"leaveTeam",null),__decorate([loggerDec$1],e.prototype,"sendTextMsg",null),__decorate([loggerDec$1],e.prototype,"sendCustomMsg",null),__decorate([loggerDec$1],e.prototype,"sendImageMsg",null),__decorate([loggerDec$1],e.prototype,"sendFileMsg",null),__decorate([loggerDec$1],e.prototype,"resendMsg",null),__decorate([loggerDec$1],e.prototype,"recallMsg",null),__decorate([loggerDec$1],e.prototype,"sendMsgReceipt",null),__decorate([loggerDec$1],e.prototype,"sendTeamMsgReceipt",null),__decorate([loggerDec$1],e.prototype,"getTeamMsgReads",null),__decorate([loggerDec$1],e.prototype,"deleteSelfMsgs",null),__decorate([loggerDec$1],e.prototype,"getHistoryMsgs",null),__decorate([loggerDec$1],e.prototype,"passFriendApply",null),__decorate([loggerDec$1],e.prototype,"rejectFriendApply",null),__decorate([loggerDec$1],e.prototype,"passTeamApply",null),__decorate([loggerDec$1],e.prototype,"rejectTeamApply",null),__decorate([loggerDec$1],e.prototype,"acceptTeamInvite",null),__decorate([loggerDec$1],e.prototype,"rejectTeamInvite",null),__decorate([loggerDec$1],e.prototype,"addStickTopSession",null),__decorate([loggerDec$1],e.prototype,"deleteStickTopSession",null),__decorate([loggerDec$1],e.prototype,"updateMyMemberInfo",null),e}(),name="nim-web-sdk-ng",version="0.11.0",sdk={version:90800,versionFormat:"0.11.0"},description="Yunxin IM SDK next generation",main="./dist/NIM_BROWSER_SDK.js",types$3="./dist/NIM_BROWSER_SDK/index.d.ts",scripts={prepare:"husky install",test:"jest --maxWorkers 1",lint:"npx eslint ./src",dev:"cd pages/ && npm run dev",clean:"rm -rf ./dist",emitTypes:"tsc --emitDeclarationOnly",build:"npm run clean && npm run emitTypes && rollup --config ./build/rollup.config.js","pages:build":"cd pages/ && npm install && npm run build && cp -rf dist/ ../dist/",api:"npm run translate && npm run build:api",translate:"rm -rf ./apidocs && multilingual-tool convert --indir=src/typings --outdir=apidocs --includes=ts","build:api":"typedoc --name Chatroom --tsconfig ./typedocChatroom.cn.json && typedoc --name Chatroom --tsconfig ./typedocChatroom.en.json && typedoc --name NIM --tsconfig ./typedocNIM.cn.json && typedoc --name NIM --tsconfig ./typedocNIM.en.json && typedoc --name QChat --tsconfig ./typedocQChat.json","api-diff":"multilingual-tool diff --dir=src/typings --receiver=3070898 --exclude=DS_Store"},repository={type:"git",url:"ssh://git@g.hz.netease.com:22222/yunxin/im/sdk.git"},keywords=["im","sdk"],author="yunxin",license="ISC",eslintIgnore=["dist/"],files=["README.md","CHANGELOG.md","dist/esm/","dist/CHATROOM*","dist/NIM*","dist/QCHAT*"],devDependencies={"@babel/core":"^7.13.15","@babel/plugin-proposal-class-properties":"^7.13.0","@babel/plugin-transform-runtime":"^7.13.15","@babel/preset-env":"^7.13.15","@babel/preset-typescript":"^7.13.0","@babel/runtime":"^7.13.10","@babel/runtime-corejs3":"^7.13.10","@microsoft/api-extractor":"^7.19.4","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^18.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.1","@rollup/plugin-replace":"^3.0.0","@rollup/plugin-typescript":"^8.3.0","@types/backo2":"^1.0.1","@types/jest":"^27.4.1","@types/lodash":"^4.14.177","@types/platform":"^1.3.3","@typescript-eslint/eslint-plugin":"^5.12.0","@typescript-eslint/parser":"^5.12.0","@yxfe/multilingual-tool":"^1.0.30","@yxfe/nim-log-reporter":"^0.0.13","@yxfe/nos-uploader":"^1.0.9","@yxfe/request":"^0.2.8",backo2:"^1.0.2","core-js":"^3.10.1","cross-env":"^7.0.3",eslint:"^8.9.0","eslint-config-prettier":"^8.5.0","eslint-plugin-prettier":"^4.0.0",eventemitter3:"^4.0.7",husky:"^7.0.4",jest:"^27.5.1","neroom-web-sdk":"1.7.0",platform:"^1.3.6","pre-commit":"^1.2.2",prettier:"^2.6.1",rollup:"^2.45.2","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-banner":"^0.2.1","rollup-plugin-banner2":"^1.2.2","rollup-plugin-copy":"^3.4.0","rollup-plugin-insert":"^1.3.2","rollup-plugin-terser":"^7.0.2","ts-jest":"^27.1.4",tslib:"^2.3.1",typedoc:"^0.22.11",typescript:"^4.5.4"},dependencies={"lodash-es":"^4.17.21",platform:"^1.3.6"},imPackageJson={name:name,version:version,sdk:sdk,description:description,main:main,types:types$3,scripts:scripts,repository:repository,keywords:keywords,author:author,license:license,eslintIgnore:eslintIgnore,files:files,devDependencies:devDependencies,dependencies:dependencies},logger=c$1({level:"debug",appName:packageJson.name,version:packageJson.version}),loggerDec=a$1("nim-kit-core-2",logger),NimKitCore=function(){function e(e){var t=e.initOptions,r=e.otherOptions,n=void 0===r?{}:r,i=e.platform,o=void 0===i?"Web":i,s=this;this.version=imPackageJson.version,this.initOptions=t,this.otherOptions=n,this.platform=o,this.nim=new NIM$1(t,__assign(__assign({},n),{sessionConfig:__assign(__assign({},n.sessionConfig),{unreadCountFilterFn:function(e){return"notification"!==e.type}}),syncOptions:__assign(__assign({},n.syncOptions),{stickTopSessions:!0})}));["ContactKit","ConversationKit","ChatKit","SearchKit"].forEach((function(e){new EventTracking$1({appKey:s.initOptions.appkey,version:"9.3.1",component:e,imVersion:s.version,platform:s.platform}).track("init","")})),this._getTeams=frequencyControl(this._getTeams,1e3),this._getMuteList=frequencyControl(this._getMuteList,1e3),this._getBlackList=frequencyControl(this._getBlackList,1e3),this._getFriends=frequencyControl(this._getFriends,1e3)}return Object.defineProperty(e.prototype,"connectState",{get:function(){return{unconnected:"idle",connecting:"connecting",connected:"connected",logined:"connected",waitReconnect:"connecting",destroyed:"disconnected"}[this.nim.status]||"idle"},enumerable:!1,configurable:!0}),e.prototype.getNIM=function(){return this.nim},e.prototype.saveMyUserInfo=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n;return __generator(this,(function(i){switch(i.label){case 0:if(!e.file&&!e.filePath||!e.type)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._uploadFile({file:e.file,type:e.type,filePath:e.filePath})];case 2:return t=i.sent(),[3,4];case 3:return r=i.sent(),logger.error("uploadFile error: ",r),logger.warn("去除头像信息继续保存用户信息"),[3,4];case 4:return n={nick:e.nick,signature:e.signature,avatar:t?t.url:e.avatar,gender:e.gender,email:e.email,birth:e.birth,tel:e.tel,ext:e.ext},[4,this._updateMyNameCard(n)];case 5:return[2,i.sent()]}}))}))},e.prototype.getTeamMembers=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._getTeamMembers(e)]}))}))},e.prototype.isSessionExist=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){return[2,!!(t=this._getSession({id:e}))&&void 0!==t.lastMsg]}))}))},e.prototype.resetSessionUnreadCount=function(e){return this._resetSessionUnreadCount(e)},e.prototype.addFriend=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._addFriend(e)]}))}))},e.prototype.applyFriend=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.friend.applyFriend(e)]}))}))},e.prototype.deleteFriend=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._deleteFriend(e)]}))}))},e.prototype.updateFriend=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.friend.updateFriend(e)]}))}))},e.prototype.setBlack=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._setBlack(e)]}))}))},e.prototype.deleteSession=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._deleteSession(e)]}))}))},e.prototype.setMute=function(e){return this._setMute(e)},e.prototype.getUsersNameCardFromServer=function(e){return this._getUsersNameCardFromServer(e)},e.prototype.createTeam=function(e){return this._createTeam(e)},e.prototype.getTeamInfo=function(e){return this._getTeamInfo(e)},e.prototype.applyTeam=function(e){return this._applyTeam(e)},e.prototype.addTeamMembers=function(e){return this._addTeamMembers(e)},e.prototype.removeTeamMembers=function(e){return this._removeTeamMembers(e)},e.prototype.updateTeamInfo=function(e){return this._updateTeamInfo(e)},e.prototype.muteTeam=function(e){return this._muteTeam(e)},e.prototype.dismissTeam=function(e){return this._dismissTeam(e)},e.prototype.leaveTeam=function(e){return this._leaveTeam(e)},e.prototype.sendTextMsg=function(e){return this._sendTextMsg(e)},e.prototype.sendImageMsg=function(e){return this._sendImageMsg(e)},e.prototype.sendFileMsg=function(e){return this._sendFileMsg(e)},e.prototype.sendCustomMsg=function(e){return this._sendCustomMsg(e)},e.prototype.sendMsgReceipt=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.nim.msg.sendMsgReceipt(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.sendTeamMsgReceipt=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.sendTeamMsgReceipt(e)]}))}))},e.prototype.getTeamMsgReads=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.getTeamMsgReads(e)]}))}))},e.prototype.deleteSelfMsgs=function(e){return this._deleteSelfMsgs(e)},e.prototype.getHistoryMsgs=function(e){return this._getHistoryMsgs(e)},e.prototype.resendMsg=function(e){return this._resendMsg(e)},e.prototype.recallMsg=function(e){return this._recallMsg(e)},e.prototype.passFriendApply=function(e){return this.nim.friend.passFriendApply(e)},e.prototype.rejectFriendApply=function(e){return this.nim.friend.rejectFriendApply(e)},e.prototype.passTeamApply=function(e){return this.nim.team.passTeamApply(e)},e.prototype.rejectTeamApply=function(e){return this.nim.team.rejectTeamApply(e)},e.prototype.acceptTeamInvite=function(e){return this.nim.team.acceptTeamInvite(e)},e.prototype.rejectTeamInvite=function(e){return this.nim.team.rejectTeamInvite(e)},e.prototype.addStickTopSession=function(e){return this.nim.session.addStickTopSession(e)},e.prototype.deleteStickTopSession=function(e){return this.nim.session.deleteStickTopSession(e)},e.prototype.updateMyMemberInfo=function(e){return this.nim.team.updateMyMemberInfo(e)},e.prototype.connect=function(){return this._connect()},e.prototype.disconnect=function(){return this._disconnect()},e.prototype.destroy=function(){return this._destroy()},e.prototype.on=function(e,t,r){return this.nim.on(e,t,r),this},e.prototype.off=function(e,t,r,n){return this.nim.off(e,t,r,n),this},e.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=this.nim).emit.apply(t,__spreadArray([e],__read(r),!1))},e.prototype._getTeams=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.nim.team.getTeams()];case 1:return[2,t.sent()];case 2:if(803===(null==(e=t.sent())?void 0:e.code))return[2,[]];throw e;case 3:return[2]}}))}))},e.prototype._getMuteList=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.nim.user.getMuteList()];case 1:return[2,e.sent().filter((function(e){return!!e.isMuted}))]}}))}))},e.prototype._getBlackList=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.nim.user.getBlackList()];case 1:return[2,e.sent().filter((function(e){return!!e.isBlack}))]}}))}))},e.prototype._getFriends=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.nim.friend.getFriends()];case 1:return[2,e.sent().filter((function(e){return!!e.valid}))]}}))}))},e.prototype._addFriend=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.friend.addFriend(e)]}))}))},e.prototype._deleteFriend=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.friend.deleteFriend(e)]}))}))},e.prototype._setBlack=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.user.setBlack(e)]}))}))},e.prototype._setMute=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.user.setMute(e)]}))}))},e.prototype._getUsersNameCardFromServer=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return e.accounts&&e.accounts.length?[2,this.nim.user.getUsersNameCardFromServer(e)]:[2,[]]}))}))},e.prototype._getSessions=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.session.getSessions(e)]}))}))},e.prototype._getSession=function(e){return this.nim.session.getSession(e)},e.prototype._uploadFile=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.cloudStorage.uploadFile(e)]}))}))},e.prototype._updateMyNameCard=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.user.updateMyNameCard(e)]}))}))},e.prototype._getTeamMembers=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.getTeamMembers(e)]}))}))},e.prototype._resetSessionUnreadCount=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.session.resetSessionUnreadCount(e)]}))}))},e.prototype._deleteSession=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.session.deleteSession(e)]}))}))},e.prototype._createTeam=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.createTeam(e)]}))}))},e.prototype._getTeamInfo=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.getTeamInfo(e)]}))}))},e.prototype._applyTeam=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.applyTeam(e)]}))}))},e.prototype._addTeamMembers=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.addTeamMembers(e)]}))}))},e.prototype._removeTeamMembers=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.removeTeamMembers(e)]}))}))},e.prototype._updateTeamInfo=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.updateTeamInfo(e)]}))}))},e.prototype._muteTeam=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.muteTeam(e)]}))}))},e.prototype._dismissTeam=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.dismissTeam(e)]}))}))},e.prototype._leaveTeam=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.team.leaveTeam(e)]}))}))},e.prototype._sendTextMsg=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.sendTextMsg(e)]}))}))},e.prototype._sendImageMsg=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.sendImageMsg(e)]}))}))},e.prototype._sendFileMsg=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.sendFileMsg(e)]}))}))},e.prototype._sendCustomMsg=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.sendCustomMsg(e)]}))}))},e.prototype._deleteSelfMsgs=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.deleteSelfMsgs(e)]}))}))},e.prototype._getHistoryMsgs=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msgLog.getHistoryMsgs(e)]}))}))},e.prototype._resendMsg=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.resendMsg(e)]}))}))},e.prototype._recallMsg=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.nim.msg.recallMsg(e)]}))}))},e.prototype._connect=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.nim.connect()]}))}))},e.prototype._disconnect=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.nim.disconnect()]}))}))},e.prototype._destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.nim.destroy()]}))}))},e.getInstance=function(t){return this.ins||(this.ins=new e(t)),this.ins},__decorate([loggerDec],e.prototype,"saveMyUserInfo",null),__decorate([loggerDec],e.prototype,"getTeamMembers",null),__decorate([loggerDec],e.prototype,"isSessionExist",null),__decorate([loggerDec],e.prototype,"resetSessionUnreadCount",null),__decorate([loggerDec],e.prototype,"addFriend",null),__decorate([loggerDec],e.prototype,"applyFriend",null),__decorate([loggerDec],e.prototype,"deleteFriend",null),__decorate([loggerDec],e.prototype,"updateFriend",null),__decorate([loggerDec],e.prototype,"setBlack",null),__decorate([loggerDec],e.prototype,"deleteSession",null),__decorate([loggerDec],e.prototype,"setMute",null),__decorate([loggerDec],e.prototype,"getUsersNameCardFromServer",null),__decorate([loggerDec],e.prototype,"createTeam",null),__decorate([loggerDec],e.prototype,"getTeamInfo",null),__decorate([loggerDec],e.prototype,"applyTeam",null),__decorate([loggerDec],e.prototype,"addTeamMembers",null),__decorate([loggerDec],e.prototype,"removeTeamMembers",null),__decorate([loggerDec],e.prototype,"updateTeamInfo",null),__decorate([loggerDec],e.prototype,"muteTeam",null),__decorate([loggerDec],e.prototype,"dismissTeam",null),__decorate([loggerDec],e.prototype,"leaveTeam",null),__decorate([loggerDec],e.prototype,"sendTextMsg",null),__decorate([loggerDec],e.prototype,"sendImageMsg",null),__decorate([loggerDec],e.prototype,"sendFileMsg",null),__decorate([loggerDec],e.prototype,"sendCustomMsg",null),__decorate([loggerDec],e.prototype,"sendMsgReceipt",null),__decorate([loggerDec],e.prototype,"sendTeamMsgReceipt",null),__decorate([loggerDec],e.prototype,"getTeamMsgReads",null),__decorate([loggerDec],e.prototype,"deleteSelfMsgs",null),__decorate([loggerDec],e.prototype,"getHistoryMsgs",null),__decorate([loggerDec],e.prototype,"resendMsg",null),__decorate([loggerDec],e.prototype,"recallMsg",null),__decorate([loggerDec],e.prototype,"passFriendApply",null),__decorate([loggerDec],e.prototype,"rejectFriendApply",null),__decorate([loggerDec],e.prototype,"passTeamApply",null),__decorate([loggerDec],e.prototype,"rejectTeamApply",null),__decorate([loggerDec],e.prototype,"acceptTeamInvite",null),__decorate([loggerDec],e.prototype,"rejectTeamInvite",null),__decorate([loggerDec],e.prototype,"addStickTopSession",null),__decorate([loggerDec],e.prototype,"deleteStickTopSession",null),__decorate([loggerDec],e.prototype,"updateMyMemberInfo",null),__decorate([loggerDec],e.prototype,"connect",null),__decorate([loggerDec],e.prototype,"disconnect",null),__decorate([loggerDec],e.prototype,"destroy",null),e}();function NimKitCoreFactory(e){switch(e){case 1:return NimKitCore$1;case 2:return NimKitCore;default:throw new Error("NimKitCoreFactory: version not found")}}function mergeFuncObj(e,t){var r={};return Object.keys(t).forEach((function(n){var i=e?e[n]:void 0,o=t[n];r[n]=i?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.apply(this,e),o.apply(this,e)}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.apply(this,e)}})),__assign(__assign({},e),r)}var ChatroomKitCore$1=function(){function e(e){var t=this;this._options=e,this._emitter=new Eventemitter,this._options.appkey;var r={onconnect:function(e){t._emitter.emit("logined",e)},ondisconnect:function(e){t._emitter.emit("disconnect",e)},onwillreconnect:function(e){t._emitter.emit("willReconnect",e)},onmsgs:function(e){e=Array.isArray(e)?e.map((function(e){return t._formatChatroomMsg1to2(e)})):t._formatChatroomMsg1to2(e),t._emitter.emit("chatroomMsg",e)},onTagsUpdate:function(e){console.log("onTagsUpdate",e),t._emitter.emit("tagsUpdate",e)},onerror:function(e){console.error("onError",e),t._emitter.emit("error",e)}},n=mergeFuncObj(this._options.callbackOptions,r);this._chatroom=Chatroom.getInstance(__assign(__assign({},this._formatInitOptions(this._options)),n))}return Object.defineProperty(e.prototype,"version",{get:function(){return"1"},enumerable:!1,configurable:!0}),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this._chatroom.connect()]}))}))},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){return[2,new Promise((function(t,r){e._chatroom.disconnect({done:function(e,n){e?r(e):t(n)}})}))]}))}))},e.prototype.setOptions=function(e){this._options=e,this._chatroom&&this._chatroom.setOptions(__assign(__assign({},e),this._formatInitOptions(e)))},e.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){return[2,new Promise((function(t,r){e._chatroom?e._chatroom.destroy({done:function(e){e?r(e):t()}}):t()}))]}))}))},e.prototype.getChatroom=function(){return this._chatroom},e.prototype.sendTextMsg=function(e){var t=this;return new Promise((function(r,n){t._chatroom.sendText(__assign(__assign({},e),{text:e.body,custom:e.ext,done:function(e,i){e?n(e):(i=t._formatChatroomMsg1to2(i),r(i))}}))}))},e.prototype.sendFileMsg=function(e){throw Error("Method not implemented.")},e.prototype.queryMembers=function(e){var t=this;return new Promise((function(r,n){var i=e.limit,o=e.time,s={regular:{guest:!1,onlyOnline:!1},temp:{guest:!0,desc:!0},regularOnline:{guest:!1,onlyOnline:!0},regularReverse:{guest:!0,desc:!1}}[e.type]||{};t._chatroom.getChatroomMembers(__assign(__assign(__assign({},e),s),{limit:i,time:o,done:function(e,t){if(e)return n(e);r(t.members)}}))}))},e.prototype.updateMyRoomRole=function(e){var t=this;return new Promise((function(r,n){var i=__assign({},e);e.member&&e.member.ext&&(i.custom=e.member.ext),e.ext&&(i.custom=e.ext),t._chatroom.updateMyChatroomMemberInfo(__assign(__assign({},i),{done:function(e,t){if(e)return n(e);r(t)}}))}))},e.prototype.queryMessageHistory=function(e){var t=this;return new Promise((function(r,n){t._chatroom.getHistoryMsgs(__assign(__assign({},e),{done:function(e,i){if(e)n(e);else{var o=[];i.msgs&&(o=i.msgs.map((function(e){return t._formatChatroomMsg1to2(e)}))),r(o)}}}))}))},e.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return(t=this._emitter).emit.apply(t,__spreadArray([e],__read(r),!1))},e.prototype.off=function(e,t,r,n){return this._emitter.off(e,t,r,n),this},e.prototype.on=function(e,t,r){return this._emitter.on(e,t,r),this},e.prototype._formatChatroomMsg1to2=function(e){var t=__assign({},e);switch(e.type){case"video":case"file":case"image":case"audio":t=__assign(__assign({},e),{body:e.text||"",attach:e.file,ext:e.custom});break;case"geo":t=__assign(__assign({},e),{body:e.text||"",attach:e.geo,ext:e.custom});case"robot":case"custom":var r=void 0;try{r=JSON.parse(e.content||"")}catch(e){r={}}t=__assign(__assign({},e),{body:e.text||"",attach:r,ext:e.custom});case"tip":t=__assign(__assign({},e),{body:e.tip||"",ext:e.custom});case"text":t=__assign(__assign({},e),{body:e.text||"",ext:e.custom});default:t=__assign(__assign({},e),{ext:e.custom})}return __assign(__assign({},t),{fromExt:e.fromCustom})},e.prototype._formatMsg2to1=function(e){var t=__assign({},e);switch(e.type){case"video":case"file":case"image":case"geo":t=__assign(__assign({},e),{text:e.body||"",geo:e.attach,custom:e.ext});break;case"robot":case"custom":var r=void 0;try{r=JSON.stringify(e.attach||"")}catch(e){r=""}t=__assign(__assign({},e),{text:e.body||"",content:r,custom:e.ext});break;case"tip":t=__assign(__assign({},e),{tip:e.body||"",custom:e.ext});break;case"text":t=__assign(__assign({},e),{text:e.body||"",custom:e.ext});break;default:t=__assign(__assign({},e),{custom:e.ext})}return __assign(__assign({},t),{fromCustom:e.fromExt})},e.prototype._formatInitOptions=function(e){return __assign(__assign({},e),{chatroomCustom:e.chatroomExt,appKey:e.appkey,debug:"off"!==e.debugLevel,logLevel:e.debugLevel})},e}(),ChatroomKitCore=function(){function e(){}return Object.defineProperty(e.prototype,"version",{get:function(){return"2"},enumerable:!1,configurable:!0}),e.prototype.connect=function(){return Promise.resolve(void 0)},e.prototype.destroy=function(){return Promise.resolve(void 0)},e.prototype.disconnect=function(){return Promise.resolve(void 0)},e.prototype.emit=function(e){return!1},e.prototype.getChatroom=function(){},e.prototype.off=function(e,t,r,n){return this},e.prototype.on=function(e,t,r){return this},e.prototype.queryMembers=function(e){return Promise.resolve([])},e.prototype.queryMessageHistory=function(e){return Promise.resolve([])},e.prototype.sendFileMsg=function(e){throw Error("Method not implemented.")},e.prototype.sendTextMsg=function(e){throw Error("Method not implemented.")},e.prototype.setOptions=function(e){throw Error("Method not implemented.")},e.prototype.updateMyRoomRole=function(e){throw Error("Method not implemented.")},e}();function ChatroomKitCoreFactory(e){switch(e){case 1:return ChatroomKitCore$1;case 2:return ChatroomKitCore;default:throw new Error("ChatroomKitCoreFactory: version not found")}}var XKitServiceManager=function(){function e(){this._services=new Map}return e.prototype.registerService=function(e,t){e||(this._services[e]=t)},e.prototype.callService=function(e,t,r){var n,i=this._services.get(e);return i?i.onMethodCall?i.onMethodCall(t,r):null===(n=i[t])||void 0===n?void 0:n.call(i,r):null},e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e._instance=null,e}(),XKit=function(){function e(){this._tag="XKitCore"}return e.prototype.initialize=function(e){var t=e.reporterInfoOption;return this.initReporter(t),this},e.prototype.registerService=function(e){XKitServiceManager.getInstance().registerService(e.serviceName,e)},e.prototype.callService=function(e,t,r){return XKitServiceManager.getInstance().callService(e,t,r)},e.prototype.initReporter=function(e){new EventTracking$1({appKey:e.appKey,version:e.version,nertcVersion:e.nertcVersion,imVersion:e.imVersion,platform:e.platform,component:e.component}).track("init","")},e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.instance=null,e}(),a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)};function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var c,l$1=function(){return l$1=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},l$1.apply(this,arguments)};function h(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function d(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function m(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function _(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function p(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.WEB="web",e.ANDROID="android",e.IOS="ios",e.PC="pc",e.MINIAPP="miniApp",e.MAC="mac",e.SIP="SIP",e.UNKNOWN="unknown"}(c||(c={}));var f,g,v,E,S,A,b,R,M,T,y,C={log:0,trace:1,debug:2,info:3,warn:4,error:5};!function(e){e.Audio="audio",e.Video="video",e.Screen="screen",e.AudioSlave="audioSlave"}(f||(f={})),function(e){e.MEMBER_AUDIO_MUTE_CHANGED="memberAudioMuteChanged",e.MEMBER_JOIN_CHATROOM="memberJoinChatroom",e.MEMBER_JOIN_ROOM="memberJoinRoom",e.MEMBER_JOIN_RTC_CHANNEL="memberJoinRtcChannel",e.MEMBER_LEAVE_CHATROOM="memberLeaveChatroom",e.MEMBER_LEAVE_ROOM="memberLeaveRoom",e.MEMBER_LEAVE_RT_CHANNEL="memberLeaveRtcChannel",e.MEMBER_ROLE_CHANGED="memberRoleChanged",e.MEMBER_SCREEN_SHARE_STATE_CHANGED="memberScreenShareStateChanged",e.MEMBER_VIDEO_MUTE_CHANGED="memberVideoMuteChanged",e.MEMBER_WHITEBOARD_STATE_CHANGED="memberWhiteboardStateChanged",e.MEMBER_WHITEBOARD_PERMISSION_CHANGED="memberWhiteboardPermissionChanged",e.RECEIVE_CHATROOM_MESSAGES="receiveChatroomMessages",e.ROOM_ENDED="roomEnded",e.RTC_CHANNEL_ERROR="rtcChannelError",e.SYNC_DATA_ERROR="syncDataError",e.SYNC_DATA_DONE="syncDataDone"}(g||(g={})),function(e){e[e.ROOM_STATE_CHANGED=1]="ROOM_STATE_CHANGED",e[e.ROOM_STATE_DELETE=2]="ROOM_STATE_DELETE",e[e.ROOM_PROPERTIES_CHANGED=10]="ROOM_PROPERTIES_CHANGED",e[e.ROOM_PROPERTIES_DELETE=11]="ROOM_PROPERTIES_DELETE",e[e.ROOM_REMAINING_CHANGED=13]="ROOM_REMAINING_CHANGED",e[e.MEMBER_PROPERTIES_CHANGED=20]="MEMBER_PROPERTIES_CHANGED",e[e.MEMBER_PROPERTIES_DELETE=21]="MEMBER_PROPERTIES_DELETE",e[e.MEMBER_JOIN_ROOM=30]="MEMBER_JOIN_ROOM",e[e.MEMBER_LEAVE_ROOM=33]="MEMBER_LEAVE_ROOM",e[e.MEMBER_JOIN_RTC_ROOM=32]="MEMBER_JOIN_RTC_ROOM",e[e.MEMBER_LEAVE_RTC_ROOM=31]="MEMBER_LEAVE_RTC_ROOM",e[e.MEMBER_JOIN_CHATROOM_ROOM=34]="MEMBER_JOIN_CHATROOM_ROOM",e[e.MEMBER_LEAVE_CHATROOM_ROOM=35]="MEMBER_LEAVE_CHATROOM_ROOM",e[e.MEMBER_STREAM_STATE_CHANGED=40]="MEMBER_STREAM_STATE_CHANGED",e[e.MEMBER_STREAM_STATE_DELETE=41]="MEMBER_STREAM_STATE_DELETE",e[e.MEMBER_STREAM_STATE_INIT=42]="MEMBER_STREAM_STATE_INIT",e[e.MEMBER_ROLE_TYPE_CHANGED=70]="MEMBER_ROLE_TYPE_CHANGED",e[e.MEMBER_NICKNAME_CHANGED=71]="MEMBER_NICKNAME_CHANGED",e[e.ROOM_ENDED=51]="ROOM_ENDED",e[e.PASS_THROUGH_MESSAGE=99]="PASS_THROUGH_MESSAGE",e[e.ROOM_LIVE_STATE_CHANGED=111]="ROOM_LIVE_STATE_CHANGED"}(v||(v={})),function(e){e[e.KICK_OUT=0]="KICK_OUT",e[e.UNAUTHORIZED=1]="UNAUTHORIZED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.ACCOUNT_TOKEN_ERROR=3]="ACCOUNT_TOKEN_ERROR",e[e.LOGGED_IN=4]="LOGGED_IN",e[e.LOGGED_OUT=5]="LOGGED_OUT",e[e.TOKEN_EXPIRED=1026]="TOKEN_EXPIRED",e[e.TOKEN_INCORRECT=1027]="TOKEN_INCORRECT"}(E||(E={})),function(e){e[e.ACTIVE=0]="ACTIVE",e[e.INACTIVE=1]="INACTIVE",e[e.CHANGED=2]="CHANGED"}(S||(S={})),function(e){e.TEXT="text",e.IMAGE="image",e.AUDIO="audio",e.VIDEO="video",e.FILE="file",e.GEO="geo",e.CUSTOM="custom",e.TIP="tip",e.NOTIFICATION="notification",e.ATTACHSTR="attachStr"}(A||(A={})),function(e){e.UNKNOWN="UNKNOWN",e.LOGIN_STATE_ERROR="LOGIN_STATE_ERROR",e.CLOSE_BY_BACKEND="CLOSE_BY_BACKEND",e.ALL_MEMBERS_OUT="ALL_MEMBERS_OUT",e.END_OF_LIFE="END_OF_LIFE",e.CLOSE_BY_MEMBER="CLOSE_BY_MEMBER",e.KICK_OUT="KICK_OUT",e.SYNC_DATA_ERROR="SYNC_DATA_ERROR",e.LEAVE_BY_SELF="LEAVE_BY_SELF",e.kICK_BY_SELF="kICK_BY_SELF"}(b||(b={})),function(e){e.NEAuthService="authService",e.NERoomService="roomService",e.NEMessageService="messageService"}(R||(R={})),function(e){e[e.FAILURE=-1]="FAILURE",e[e.SUCCESS=0]="SUCCESS",e[e.UNAUTHORIZED=402]="UNAUTHORIZED",e[e.TOKEN_EXPIRED=1026]="TOKEN_EXPIRED",e[e.TOKEN_INCORRECT=1027]="TOKEN_INCORRECT",e[e.IM_REUSE_NOT_LOGIN=100004]="IM_REUSE_NOT_LOGIN",e[e.IM_REUSE_ACCOUNT_NOT_MATCH=100005]="IM_REUSE_ACCOUNT_NOT_MATCH"}(M||(M={})),function(e){e.SUCCESS="success",e.FAILURE="failure",e.NOT_SUPPORT="not support",e.NOT_INIT_RTC="not init rtc",e.NOT_INIT_CHATROOM="not init chatroom",e.NOT_JOIN_ROOMKIT="not join roomkit",e.NOT_JOIN_RTC="not join rtc",e.NOT_JOIN_WHITEBOARD="not join whiteboard",e.NOT_INIT_PREVIEW="not init preview",e.NOT_JOIN_CHATROOM="not join chatroom",e.CHATROOM_JOIN_FAIL="join chatroom fail",e.NO_UUID="lack of uuid",e.NO_DEVICEID="no deviceId",e.GET_REMOTE_MEMBER_FAILED_BY_UUID="get remote member fail by uuid",e.NO_MESSAGE_CONTENT="lack of message content",e.NO_APPKEY="lack of appKey",e.NOT_OPEN_VIDEO="not open video",e.NOT_SHARING_SCREEN="Member is not sharing screen",e.MEMBER_IS_EMPTY="Member is empty",e.PARAMS_IS_INCORRECT="params is incorrect"}(T||(T={})),function(e){e[e.OPEN=1]="OPEN",e[e.CLOSE=0]="CLOSE"}(y||(y={}));var I,O,N,U,w,L,P,D,k,V,G,q,B,H,K,x,j="not login";function J(e,t){return{code:M.SUCCESS,message:t||T.SUCCESS,data:e}}function W(e,t,r){if(e){if(e.code)throw{code:r||e.code,message:e.msg||e.message||T.FAILURE};throw{code:r||M.FAILURE,message:t||T.FAILURE,data:e}}throw{code:r||M.FAILURE,message:t||T.FAILURE}}function F(e,t,r){return e?e.code?{code:r||e.code,message:e.msg||T.FAILURE,data:e}:{code:r||M.FAILURE,message:t||T.FAILURE,data:e}:{code:r||M.FAILURE,message:t||T.FAILURE,data:null}}!function(e){e.CHATROOM_MESSAGE_RECEIVE="chatroomMessagesReceive",e.CHATROOM_FILE_UPLOAD_PROGRESS="chatroomFileUploadProgress"}(I||(I={})),function(e){e.UNAUTHORIZED="unauthorized",e.TOKEN_EXPIRED="tokenExpired",e.TOKEN_INCORRECT="tokenIncorrect"}(O||(O={})),function(e){e.STREAM_ADDED="streamAdded",e.STREAM_REMOVED="streamRemoved",e.STREAM_SUBSCRIBED="streamSubscribed",e.NETWORK_QUALITY="network-quality",e.CLIENT_BANNED="clientBanned",e.CHANNEL_CLOSED="channelClosed",e.CONNECTION_STATE_CHHANGE="connectionStateChange",e.STOP_SCREEN_SHARE="stopScreenShare",e.VOLUME_INDICATOR="volume-indicator",e.PEER_ONLINE="peer-online",e.PEER_LEAVE="peer-leave",e.RTC_STATS="rtcStats",e.ACTIVE_SPEAKER="activeSpeaker",e.DISCONNECTED="disconnected",e.OPEN="open",e.WILLRECONNECT="willreconnect",e.RECONNECTED="reconnected",e.SENDCOMMANDOVERTIME="sendCommandOverTime",e.ERROR="error",e.ROLE_CHANGED="roleChanged",e.SYNCDONE="syncDone",e.MUTE_AUDIO="muteAudio",e.MUTE_VIDEO="muteVideo",e.UNMUTE_VIDEO="unmuteVideo",e.UNMUTE_AUDIO="unmuteAudio",e.ABILITY_NOT_SUPPORT="ability-not-support",e.RECORD_DEVICES_CHANGE="recording-device-changed",e.CAMERA_DEVICE_CHANGE="camera-changed",e.SPEAKER_DEVICE_CHANGE="playout-device-changed",e.CONNECTION_STATE_CHANGE="connection-state-change",e.VIDEO_TRACK_ENDED="videoTrackEnded",e.MINIAPP_STREAM_CHANGED="miniapp-stream-changed",e.ACCESS_DENIED="accessDenied",e.UNMUTE_SCREEN="unmute-screen",e.NOTALLOWEDERROR="notAllowedError",e.START_SCREEN_AUDIO="startScreenAudio",e.STOP_SCREEN_AUDIO="stopScreenAudio"}(N||(N={})),function(e){e[e.kickout=0]="kickout",e[e.muteVideo=10]="muteVideo",e[e.muteAudio=11]="muteAudio",e[e.muteAllAudio=12]="muteAllAudio",e[e.lockRoom=13]="lockRoom",e[e.unmuteVideo=15]="unmuteVideo",e[e.unmuteAudio=16]="unmuteAudio",e[e.unmuteAllAudio=17]="unmuteAllAudio",e[e.unlockRoom=18]="unlockRoom",e[e.muteAllVideo=20]="muteAllVideo",e[e.unmuteAllVideo=21]="unmuteAllVideo",e[e.changeHost=22]="changeHost",e[e.focusVideo=30]="focusVideo",e[e.unfocusVideo=31]="unfocusVideo",e[e.hangUp=32]="hangUp",e[e.unHangUp=33]="unHangUp",e[e.forceMuteAllAudio=40]="forceMuteAllAudio",e[e.acceptHandsUp=41]="acceptHandsUp",e[e.rejectHandsUp=42]="rejectHandsUp",e[e.muteVideoBySelf=50]="muteVideoBySelf",e[e.muteAudioBySelf=51]="muteAudioBySelf",e[e.stopScreenShareBySelf=52]="stopScreenShareBySelf",e[e.stopScreenShare=53]="stopScreenShare",e[e.unmuteVideoBySelf=55]="unmuteVideoBySelf",e[e.unmuteAudioBySelf=56]="unmuteAudioBySelf",e[e.startScreenShareBySelf=57]="startScreenShareBySelf",e[e.handsUp=58]="handsUp",e[e.unHandsUp=59]="unHandsUp",e[e.startWhiteBoard=60]="startWhiteBoard",e[e.stopWhiteBoard=61]="stopWhiteBoard",e[e.enableWhiteBoard=62]="enableWhiteBoard",e[e.disableWhiteBoard=63]="disableWhiteBoard",e[e.common=66]="common",e[e.transformAudioToVideo=67]="transformAudioToVideo",e[e.transformVideoToAudio=68]="transformVideoToAudio",e[e.audioStateChanged=100]="audioStateChanged",e[e.videoStateChanged=101]="videoStateChanged",e[e.focusVideoChanged=102]="focusVideoChanged",e[e.hostChanged=103]="hostChanged",e[e.roleTypeChanged=23]="roleTypeChanged",e[e.roomNameChanged=104]="roomNameChanged",e[e.screenShareChanged=105]="screenShareChanged",e[e.memberComeBack=106]="memberComeBack",e[e.lockStateChanged=107]="lockStateChanged",e[e.memberKickedOut=108]="memberKickedOut",e[e.kickedOutByOtherClient=109]="kickedOutByOtherClient",e[e.roomInfoChanged=110]="roomInfoChanged",e[e.memberHandsUp=111]="memberHandsUp",e[e.passwordChangedByOtherClient=1e3]="passwordChangedByOtherClient"}(U||(U={})),function(e){e[e.HIGH=0]="HIGH",e[e.LOW=1]="LOW"}(w||(w={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.EXCELLENT=1]="EXCELLENT",e[e.GOOD=2]="GOOD",e[e.POOR=3]="POOR",e[e.BAD=4]="BAD",e[e.VERYBAD=5]="VERYBAD",e[e.DOWN=6]="DOWN"}(L||(L={})),function(e){e.AUDIO_DEVICE="audio_device",e.VIDEO_DEVICE="video_device",e.AUDIO="audio",e.VIDEO="video",e.SUB_VIDEO="subVideo"}(P||(P={})),function(e){e[e.SAMPLE_RATE_32000=32e3]="SAMPLE_RATE_32000",e[e.SAMPLE_RATE_44100=44100]="SAMPLE_RATE_44100",e[e.SAMPLE_RATE_48000=48e3]="SAMPLE_RATE_48000"}(D||(D={})),function(e){e[e["LC-AAC"]=0]="LC-AAC",e[e["HE-AAC"]=1]="HE-AAC"}(k||(k={})),function(e){e[e.NONE=0]="NONE",e[e.GALLERY=1]="GALLERY",e[e.FOCUS=2]="FOCUS",e[e.SCREEN_SHARE=4]="SCREEN_SHARE"}(V||(V={})),function(e){e[e.INVALID=0]="INVALID",e[e.INIT=1]="INIT",e[e.STARTED=2]="STARTED",e[e.ENDED=3]="ENDED"}(G||(G={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.ONLINE_NORMAL=1]="ONLINE_NORMAL",e[e.GUEST_DESC=2]="GUEST_DESC",e[e.GUEST_ASC=3]="GUEST_ASC"}(q||(q={})),function(e){e[e.I420=0]="I420",e[e.NV21=1]="NV21",e[e.RGBA=2]="RGBA",e[e.TEXTURE_OES=3]="TEXTURE_OES",e[e.TEXTURE_RGB=4]="TEXTURE_RGB"}(B||(B={})),function(e){e[e.ModeVideo=0]="ModeVideo",e[e.ModeAudio=1]="ModeAudio"}(H||(H={})),function(e){e.speech_low_quality="speech_low_quality",e.speech_standard="speech_standard",e.music_standard="music_standard",e.standard_stereo="standard_stereo",e.high_quality="high_quality",e.high_quality_stereo="high_quality_stereo"}(K||(K={})),function(e){e.CHINESE="CHINESE",e.ENGLISH="ENGLISH",e.JAPANESE="JAPANESE"}(x||(x={}));var Y=function(e){function t(t){var r=e.call(this,{isSupported:t.isSupported})||this;return r._token="",r._isInit=!1,t.rtc?(r.isSupported=t.isSupported,r.logger=t.logger,r._rtc=t.rtc,r._token=t.token,r):(t.isSupported=!1,r)}return u(t,e),t.prototype.setupLocalVideoCanvas=function(e){return this.isSupported?this._isInit?(this._rtc.setupLocalVideoCanvas(e),0):(console.error(T.NOT_INIT_RTC),-1):(console.error(T.NOT_SUPPORT),-1)},t.prototype.enumRecordDevices=function(){return this._rtc.getMicrophones().then((function(e){return J(e.map((function(e){return{deviceId:e.deviceId,deviceName:e.label}})))}))},t.prototype.enumCameraDevices=function(){return this._rtc.getCameras().then((function(e){return J(e.map((function(e){return{deviceId:e.deviceId,deviceName:e.label}})))}))},t.prototype.enumPlayoutDevices=function(){return this._rtc.getSpeakers().then((function(e){return J(e.map((function(e){return{deviceId:e.deviceId,deviceName:e.label}})))}))},t.prototype.getSelectedRecordDevice=function(){return this._rtc.getMicId()},t.prototype.getSelectedCameraDevice=function(){return this._rtc.getCameraId()},t.prototype.getSelectedPlayoutDevice=function(){return this._rtc.getSpeakerId()},t.prototype.switchDevice=function(e){return h(this,void 0,void 0,(function(){var t,r,n;return d(this,(function(i){switch(i.label){case 0:this.logger.log("switchDevice",e),i.label=1;case 1:return i.trys.push([1,3,,9]),[4,this._rtc.switchDevice({type:e.type,deviceId:e.deviceId})];case 2:return t=i.sent(),this.logger.log("switchDevice success ",t),[2,t];case 3:if(r=i.sent(),"camera"!==(null==e?void 0:e.type))return[3,8];i.label=4;case 4:return i.trys.push([4,7,,8]),[4,this._rtc.close("video")];case 5:return i.sent(),[4,this._rtc.open("video",{},!0,null==e?void 0:e.deviceId)];case 6:return i.sent(),[2,J({type:null==e?void 0:e.type,deviceId:null==e?void 0:e.deviceId})];case 7:throw n=i.sent(),new Error(n);case 8:throw new Error(r);case 9:return[2]}}))}))},t.prototype.setSelectedRecordDevice=function(e){return this.switchDevice({deviceId:e,type:"microphone"})},t.prototype.setSelectedCameraDevice=function(e){return this.switchDevice({deviceId:e,type:"camera"})},t.prototype.setSelectedPlayoutDevice=function(e){return this.switchDevice({deviceId:e,type:"speaker"})},t}((function(e){this.isSupported=!1,this.isSupported=e.isSupported})),Q=function(e){function t(r){var n=e.call(this,{rtc:r.rtc,isSupported:!!r.rtc,token:r.token,logger:r.logger})||this;n.isSupported=!1,n.muteMyAudioTimer=null,n.muteMyVideoTimer=null,n._subscribedStreamMap=new Map,n._subscribedSubStreamMap=new Map,n._subscribeAudioStreamMap=new Map,n._isJoined=!1,n._screenSharingUserUuid="",n._addNotAllowListenerMap=new Map,n._videoProfile={resolution:480,frameRate:15},n._screenProfile={resolution:1080,frameRate:5},n._audioProfile=K.music_standard,n._privateRtcConfig=null,n._enableRecord=!1,n._debug=!0,n._operationStreamSequence=0,n._maxReTryCount=3,n._needToSendMuteAudio=!1,n._needToSendMuteVideo=!1,r.rtc&&r.appKey&&r.channelName&&r.cid||(n.isSupported=!1),n._debug=!1!==r.debug,n._enableRecord=!!(null==r?void 0:r.enableRecord),n._privateRtcConfig=r.privateRtcConfig,n._emitter=r.emitter,n._isInit=!0,n.logger=r.logger,n.logger.log(t.TAG_NAME,"constructor",r),n.isSupported=!0,n._screenSharingUserUuid=r.screenSharingUserUuid,n._localMember=r.member;var i=n._localMember.role;if(i&&i.params&&i.params.video){var o=i.params.video.height,s=i.params.video.fps;n._videoProfile.resolution=o||480,n._videoProfile.frameRate=s||15}return i&&i.params&&i.params.audio&&(n._audioProfile=i.params.audio.profile||K.speech_standard),i&&i.params&&i.params.screen&&(o=i.params.screen.videoProfile,s=i.params.screen.fps,n._screenProfile.resolution=n._getScreenVideoProfile(o),n._screenProfile.frameRate=s||5),n._setMemberIsInClientRtc=r.setMemberIsInClientRtc,n._rtc=r.rtc,n._appKey=r.appKey,n._request=r.request,n._channelName=r.channelName,n._token=r.token,n._uid=r.uid,n._remoteMemberMap=r.remoteMemberMap,n._rtc.init({nrtcAppKey:n._appKey,neRtcServerAddresses:n._privateRtcConfig}),n.rtcClient=n._rtc._client,n}return u(t,e),t.prototype.stopMemberScreenShare=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){return e?(t=this.getScreenSharingUserUuid())&&t==e?this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.stopScreenShare()]:[2,this._changeMemberStream(e,P.SUB_VIDEO,!1)]:[2,F(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)]:[2,W(null,"".concat(e,">").concat(t," ").concat(T.NOT_SHARING_SCREEN))]:[2,W(null,T.MEMBER_IS_EMPTY)]}))}))},t.prototype.muteMemberAudio=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.muteMyAudio()]:[2,this._changeMemberStream(e,P.AUDIO,!1)]:[2,F(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)]}))}))},t.prototype.muteMemberVideo=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.muteMyVideo()]:[2,this._changeMemberStream(e,P.VIDEO,!1)]:[2,F(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)]}))}))},t.prototype.unmuteMemberAudio=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.unmuteMyAudio()]:[2,this._changeMemberStream(e,P.AUDIO,!0)]:[2,F(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)]}))}))},t.prototype.unmuteMemberVideo=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return this._getRtcUidByUuid(e)?e===this._localMember.uuid?[2,this.unmuteMyVideo()]:[2,this._changeMemberStream(e,P.VIDEO,!0)]:[2,F(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)]}))}))},t.prototype.joinRtcChannel=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(this._isJoined)return this.logger.warn("已加入rtcChannel 请勿重复加入"),[2,J(null)];this.logger.tracking("userAction",t.TAG_NAME,{method:"joinRtcChannel",uid:this._uid,token:this._token}),r.label=1;case 1:return r.trys.push([1,8,,9]),this._addRtcListener(),this._rtc.setProfile({videoProfile:{resolution:this._videoProfile.resolution,frameRate:this._videoProfile.frameRate},screenProfile:{resolution:this._screenProfile.resolution,frameRate:this._screenProfile.frameRate},audioProfile:this._audioProfile}),[4,this._request.joinRtcChannelApi(this._channelName)];case 2:if(r.sent(),!this._localMember.role.rtcRole)return[3,6];r.label=3;case 3:return r.trys.push([3,5,,6]),[4,this._rtc.setClientRole(this._localMember.role.rtcRole)];case 4:return r.sent(),[3,6];case 5:return e=r.sent(),this.logger.warn("setClientRole error",e),[3,6];case 6:return[4,this._rtc.joinRtcChannel({channelName:this._channelName,uid:this._uid,token:this._token},{noCloudRecord:!this._enableRecord})];case 7:return r.sent(),this._isJoined=!0,[2,J(null)];case 8:return[2,W(r.sent())];case 9:return[2]}}))}))},t.prototype.leaveRtcChannel=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,{method:"leaveRtcChannel",channelName:this._channelName}),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.leaveRtcChannelApi(this._channelName)];case 2:return e.sent(),[4,this._rtc.leaveRtcChannel()];case 3:return e.sent(),this._resetState(),[2,J(null)];case 4:return[2,W(e.sent(),T.FAILURE)];case 5:return[2]}}))}))},t.prototype.setRemoteMemberMap=function(e){return this._remoteMemberMap=e,J(null)},t.prototype.setLocalMember=function(e){return this._localMember=e,J(null)},t.prototype.setScreenSharingUserUuid=function(e){this._screenSharingUserUuid=e},t.prototype.destroy=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._rtc.leaveRtcChannel()];case 2:return e.sent(),this._resetState(),this._isInit=!1,[2,J(null)];case 3:return[2,W(e.sent(),T.FAILURE)];case 4:return[2]}}))}))},t.prototype.muteMyAudio=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,{method:"muteMyAudio"}),r.label=1;case 1:return r.trys.push([1,4,,7]),[4,this._rtc.close("audio")];case 2:return r.sent(),[4,this._muteStreamRequest({streamKey:P.AUDIO},this._maxReTryCount,"audio")];case 3:return r.sent(),[2,J(null)];case 4:return(e=r.sent()).code&&10229==e.code?[4,this._muteStreamRequest({streamKey:P.AUDIO},this._maxReTryCount,"audio")]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,W(e)];case 7:return[2]}}))}))},t.prototype.operateStream=function(e,t){return void 0===t&&(t=!0),h(this,void 0,void 0,(function(){return d(this,(function(r){return t?[2,this._rtc.open(e)]:[2,this._rtc.close(e)]}))}))},t.prototype.playLocalStream=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:if(!this._localMember.isVideoOn&&"video"===e)return[2,W(null,T.NOT_OPEN_VIDEO)];t.label=1;case 1:return t.trys.push([1,6,,7]),"screen"===e?[3,3]:[4,this._rtc.playLocalStream(e,{audio:"audio"===e,video:"video"===e,screen:!1})];case 2:return t.sent(),[3,5];case 3:return[4,this._rtc.playLocalSubStream()];case 4:t.sent(),t.label=5;case 5:return[2,J(null)];case 6:return[2,W(t.sent())];case 7:return[2]}}))}))},t.prototype.muteMyVideo=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,{method:"muteMyVideo"}),r.label=1;case 1:return r.trys.push([1,4,,7]),[4,this._rtc.close("video")];case 2:return r.sent(),[4,this._muteStreamRequest({streamKey:P.VIDEO},this._maxReTryCount,"video")];case 3:return r.sent(),[2,J(null)];case 4:return(e=r.sent()).code&&10231==e.code?[4,this._muteStreamRequest({streamKey:P.VIDEO},this._maxReTryCount,"video")]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,W(e)];case 7:return[2]}}))}))},t.prototype.setupLocalVideoCanvas=function(e){return this.isSupported?this._isInit?(this._rtc.setupLocalVideoCanvas(e),0):(console.error(T.NOT_INIT_RTC),-1):(console.error(T.NOT_SUPPORT),-1)},t.prototype.setupRemoteVideoSubStreamCanvas=function(e,r){var n=this._getRtcUidByUuid(r);if(!n)return console.error(T.GET_REMOTE_MEMBER_FAILED_BY_UUID),-1;if(this.logger.tracking("userAction",t.TAG_NAME,{method:"setupRemoteVideoSubStreamCanvas",userUuid:r,rtcUid:n}),this._rtc.setupRemoteSubVideoCanvas(e,n),this._subscribedSubStreamMap.has(n)){var i=this._subscribedSubStreamMap.get(n);i&&i.isSubscribed&&i.streamObj&&this._playRemoteSubStream(i.streamObj.stream,n)}return 0},t.prototype.getLocalAudioStats=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this._rtc.getLocalAudioStats().then((function(e){if(e&&e[0]){var t=e[0];return{codecType:t.CodecType,muteState:t.MuteState,recordingLevel:t.RecordingLevel,samplingRate:t.SamplingRate,sendBitrate:t.SendBitrate,sendLevel:t.SendLevel}}return{codecType:"",muteState:!1,recordingLevel:0,samplingRate:0,sendBitrate:0,sendLevel:0}}))]}))}))},t.prototype.getTransportStats=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this._rtc.getTransportStats().then((function(e){return{upRtt:e.txRtt,downRtt:e.rxRtt,NetworkType:e.NetworkType,OutgoingAvailableBandwidth:e.OutgoingAvailableBandwidth}}))]}))}))},t.prototype.getLocalVideoStats=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this._rtc.getLocalVideoStats().then((function(e){var t=[];for(var r in e){var n=e[r];t.push({layerType:n.LayerType,captureFrameRate:n.CaptureFrameRate,captureResolutionHeight:n.CaptureResolutionHeight,captureResolutionWidth:n.CaptureResolutionWidth,encodeDelay:n.EncodeDelay,muteState:n.MuteState,sendBitrate:n.SendBitrate,sendFrameRate:n.SendFrameRate,sendResolutionHeight:n.SendResolutionHeight,sendResolutionWidth:n.SendResolutionWidth,targetSendBitrate:n.TargetSendBitrate,totalDuration:n.TotalDuration,totalFreezeTime:n.TotalFreezeTime})}return t}))]}))}))},t.prototype.getRemoteAudioStats=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this._rtc.getRemoteAudioStats().then((function(e){var t=[];for(var r in e){var n=e[r];t.push({codecType:n.CodecType,end2EndDelay:n.End2EndDelay,muteState:n.MuteState,packetLossRate:n.PacketLossRate,recvBitrate:n.RecvBitrate,recvLevel:n.RecvLevel,totalFreezeTime:n.TotalFreezeTime,totalPlayDuration:n.TotalPlayDuration,transportDelay:n.TransportDelay})}return t}))]}))}))},t.prototype.getRemoteVideoStats=function(){return h(this,void 0,void 0,(function(){var e,t,r;return d(this,(function(n){switch(n.label){case 0:return e=[],[4,this._rtc.getRemoteVideoStats("video")];case 1:return t=n.sent(),[4,this._rtc.getRemoteVideoStats("screen")];case 2:return r=n.sent(),Object.keys(t).forEach((function(n){var i=[];t[n]&&i.push(t[n]),r[n]&&i.push(r[n]),e.push({userUuid:n,layers:i})})),[2,e]}}))}))},t.prototype.getSessionStats=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this._rtc.getSessionStats().then((function(e){return{duration:e.Duration,recvBitrate:e.RecvBitrate,recvBytes:e.RecvBytes,sendBitrate:e.SendBitrate,sendBytes:e.SendBytes,userCount:e.UserCount}}))]}))}))},t.prototype.setupRemoteVideoCanvas=function(e,r){var n=this._getRtcUidByUuid(r);if(!n)return console.error(T.GET_REMOTE_MEMBER_FAILED_BY_UUID),-1;if(this.logger.log(t.TAG_NAME,"setupRemoteVideoCanvas",r,n),n&&this._rtc.setupRemoteVideoCanvas(e,n),this._subscribedStreamMap.has(n)){var i=this._subscribedStreamMap.get(n);i&&i.isSubscribed&&i.streamObj&&this._playRemoteStream(i.streamObj.stream,n,"video")}return 0},t.prototype.setupRemoteStreamContext=function(e,r,n){var i=this._getRtcUidByUuid(e);if(!i)return this.logger.error(T.GET_REMOTE_MEMBER_FAILED_BY_UUID),-1;if(this.logger.log(t.TAG_NAME,"setupRemoteStreamContext",e,i,r),i&&this._rtc.setupRemoteStreamContext({context:n,rtcUid:i,mediaType:r}),this._subscribedStreamMap.has(i)){var o=this._subscribedStreamMap.get(i);o&&o.isSubscribed&&o.streamObj&&this._rtc.playRemoteStream({stream:o.streamObj.stream,uid:i,type:r})}return 0},t.prototype.startScreenShare=function(e){return h(this,void 0,void 0,(function(){var r,n,i;return d(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,l$1({method:"startScreenShare"},e)),o.label=1;case 1:return o.trys.push([1,10,,13]),e&&(e.resolution||e.frameRate)?(r={},e.resolution&&(r.resolution=e.resolution),e.frameRate&&(r.frameRate=e.frameRate),[4,this.setLocalScreenProfile(r)]):[3,3];case 2:o.sent(),o.label=3;case 3:return n=(null==e?void 0:e.sourceId)?{sourceId:e.sourceId}:{},[4,this._rtc.open("screen",n)];case 4:return o.sent(),this._rtc.localStream?this._rtc.localStream.hasScreen()||(null==e?void 0:e.sourceId)?[4,this._request.changeMemberStreamsApi({isOpen:!0,roomUuid:this._channelName,streamKey:P.SUB_VIDEO,userUuid:this._localMember.uuid,sequence:this._operationStreamSequence++})]:[3,6]:[3,8];case 5:return o.sent(),[2,J(null)];case 6:return[2,W("open screenShare failed")];case 7:return[3,9];case 8:return[2,J(null)];case 9:return[3,13];case 10:return i=o.sent(),this.logger.log("startScreenShare",i),i.code&&41009!=i.code?[4,this._rtc.close("screen")]:[3,12];case 11:o.sent(),o.label=12;case 12:return[2,W(i)];case 13:return[2]}}))}))},t.prototype.stopScreenShare=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,{method:"stopScreenShare"}),e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.changeMemberStreamsApi({isOpen:!1,roomUuid:this._channelName,streamKey:P.SUB_VIDEO,userUuid:this._localMember.uuid,sequence:this._operationStreamSequence++})];case 2:return e.sent(),[4,this._rtc.close("screen")];case 3:return e.sent(),[2,J(null)];case 4:return[2,W(e.sent())];case 5:return[2]}}))}))},t.prototype.subscribeRemoteVideoSubStream=function(e){return h(this,void 0,void 0,(function(){var r,n;return d(this,(function(i){switch(i.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];i.label=1;case 1:return i.trys.push([1,5,,6]),this.logger.tracking("userAction",t.TAG_NAME,{method:"subscribeRemoteVideoSubStream",userUuid:e}),(r=this._getRtcUidByUuid(e))?(n=this._subscribedSubStreamMap.get(r))&&n.streamObj?(n.isSubscribed=!0,this._subscribedSubStreamMap.set(r,n),[4,this._subscribeStream(n.streamObj.stream,!0,f.Screen,r)]):[3,3]:[2,W(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)];case 2:return i.sent(),[3,4];case 3:this._subscribedSubStreamMap.set(r,{isSubscribed:!0,streamObj:null}),i.label=4;case 4:return[2,J(null)];case 5:return[2,W(i.sent())];case 6:return[2]}}))}))},t.prototype.unsubscribeRemoteVideoSubStream=function(e){return h(this,void 0,void 0,(function(){var r,n;return d(this,(function(i){switch(i.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];if(this.logger.tracking("userAction",t.TAG_NAME,{method:"unsubscribeRemoteVideoSubStream"}),!(r=this._getRtcUidByUuid(e)))return[2,W(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)];if(!(n=this._subscribedSubStreamMap.get(r)))return[3,5];if(!n.isSubscribed||!n.streamObj)return[3,4];this._rtc.stopPlayingRemoteStream("screen",n.streamObj.stream),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._subscribeStream(n.streamObj.stream,!1,f.Screen,r)];case 2:return i.sent(),[3,4];case 3:return[2,W(i.sent())];case 4:return n.isSubscribed=!1,this._subscribedSubStreamMap.set(r,n),[2,J(null)];case 5:return console.warn("之前未订阅无须取消"),[2,J(null)]}}))}))},t.prototype.subscribeRemoteVideoStream=function(e,r){return h(this,void 0,void 0,(function(){var n,i;return d(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];o.label=1;case 1:return o.trys.push([1,5,,6]),this.logger.tracking("userAction",t.TAG_NAME,{method:"subscribeRemoteVideoStream",userUuid:e,streamType:r}),(n=this._getRtcUidByUuid(e))?(i=this._subscribedStreamMap.get(n))&&i.streamObj?(i.isSubscribed=!0,i.streamType=r,this._subscribedStreamMap.set(Number(n),i),[4,this._subscribeStream(i.streamObj.stream,!0,f.Video,n,r)]):[3,3]:[2,W(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)];case 2:return o.sent(),[3,4];case 3:this._subscribedStreamMap.set(Number(n),{isSubscribed:!0,streamObj:null,streamType:r}),o.label=4;case 4:return[2,J(null)];case 5:return[2,W(o.sent())];case 6:return[2]}}))}))},t.prototype.unsubscribeRemoteVideoStream=function(e,r){return h(this,void 0,void 0,(function(){var r,n;return d(this,(function(i){switch(i.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];if(this.logger.tracking("userAction",t.TAG_NAME,{method:"unsubscribeRemoteVideoStream",userUuid:e}),!(r=this._getRtcUidByUuid(e)))return[2,W(null,T.GET_REMOTE_MEMBER_FAILED_BY_UUID)];if(!(n=this._subscribedStreamMap.get(r)))return[3,5];if(!n.isSubscribed||!n.streamObj)return[3,4];this.logger.debug("取消订阅的流",n.streamObj),this._rtc.stopPlayingRemoteStream(f.Video,n.streamObj.stream),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._subscribeStream(n.streamObj.stream,!1,f.Video,r)];case 2:return i.sent(),[3,4];case 3:return[2,W(i.sent())];case 4:return n.isSubscribed=!1,this._subscribedStreamMap.set(r,n),[2,J(null)];case 5:return console.warn("之前未订阅无须取消",r),[2,J(null)]}}))}))},t.prototype.switchDevice=function(e){return h(this,void 0,void 0,(function(){var r,n,i;return d(this,(function(o){switch(o.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,l$1({method:"switchDevice"},e)),o.label=1;case 1:return o.trys.push([1,3,,9]),[4,this._rtc.switchDevice({type:e.type,deviceId:e.deviceId})];case 2:return r=o.sent(),this.logger.log(t.TAG_NAME,"switchDevice success ",r),[2,r];case 3:if(n=o.sent(),"camera"!==(null==e?void 0:e.type))return[3,8];o.label=4;case 4:return o.trys.push([4,7,,8]),[4,this._rtc.close(f.Video)];case 5:return o.sent(),[4,this._rtc.open(f.Video,{},!0,null==e?void 0:e.deviceId)];case 6:return o.sent(),[2,J({type:null==e?void 0:e.type,deviceId:null==e?void 0:e.deviceId})];case 7:throw i=o.sent(),new Error(i);case 8:throw new Error(n);case 9:return[2]}}))}))},t.prototype.unmuteMyAudio=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,{method:"unmuteMyAudio"}),this.muteMyAudioTimer&&clearTimeout(this.muteMyAudioTimer),this.muteMyAudioTimer=null,this.logger.log(t.TAG_NAME,"unmuteMyAudio 修改了 _needToSendMuteAudio",this._needToSendMuteAudio),this._needToSendMuteAudio=!1,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.changeMemberStreamsApi({isOpen:!0,roomUuid:this._channelName,streamKey:P.AUDIO,userUuid:this._localMember.uuid,sequence:this._operationStreamSequence++})];case 2:return e.sent(),[4,this._rtc.open(f.Audio)];case 3:return e.sent(),[2,J(null)];case 4:return e.sent(),[2,W()];case 5:return[2]}}))}))},t.prototype.unmuteMyVideo=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,{method:"unmuteMyAudio"}),this.muteMyVideoTimer&&clearTimeout(this.muteMyVideoTimer),this.muteMyVideoTimer=null,this.logger.log(t.TAG_NAME,"unmuteMyVideo 修改了 _needToSendMuteVideo",this._needToSendMuteVideo),this._needToSendMuteVideo=!1,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._request.changeMemberStreamsApi({isOpen:!0,roomUuid:this._channelName,streamKey:P.VIDEO,userUuid:this._localMember.uuid,sequence:this._operationStreamSequence++})];case 2:return e.sent(),[4,this._rtc.open("video")];case 3:return e.sent(),[2,J(null)];case 4:return[2,W(e.sent())];case 5:return[2]}}))}))},t.prototype.getScreenSharingUserUuid=function(){return this._screenSharingUserUuid},t.prototype.setLocalAudioProfile=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,{method:"setLocalAudioProfile",profile:e}),r.label=1;case 1:return r.trys.push([1,7,,8]),this._localMember.isAudioOn?[4,this._rtc.close(f.Audio)]:[3,5];case 2:return r.sent(),[4,this._rtc.setAudioProfile(e)];case 3:return r.sent(),[4,this._rtc.open(f.Audio)];case 4:return r.sent(),[3,6];case 5:this._rtc.setAudioProfile(e),r.label=6;case 6:return[2,J(null)];case 7:return[2,W(r.sent())];case 8:return[2]}}))}))},t.prototype.setAudioProfile=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return[2,this.setLocalAudioProfile(e)]}))}))},t.prototype.setLocalVideoConfig=function(e){return h(this,void 0,void 0,(function(){var r,n,i;return d(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];this._isJoined||this.logger.warn(T.NOT_JOIN_RTC),this.logger.tracking("userAction",t.TAG_NAME,l$1({method:"setLocalVideoProfile"},e)),this._videoProfile=l$1(l$1({},this._videoProfile),e),r=this._videoProfile,n=r.resolution,i=r.frameRate,o.label=1;case 1:return o.trys.push([1,6,,7]),this._localMember.isVideoOn?[4,this._rtc.close("video")]:[3,4];case 2:return o.sent(),this._rtc.setVideoProfile(n,i),[4,this._rtc.open("video")];case 3:return o.sent(),[3,5];case 4:this._rtc.setVideoProfile(n,i),o.label=5;case 5:return[2,J(null)];case 6:return[2,W(o.sent())];case 7:return[2]}}))}))},t.prototype.setLocalScreenProfile=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(r){if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_RTC)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_RTC)];this.logger.tracking("userAction",t.TAG_NAME,l$1({method:"setLocalScreenProfile"},e)),this._screenProfile=l$1(l$1({},this._screenProfile),e);try{return this._rtc.setScreenProfile(this._screenProfile.resolution,this._screenProfile.frameRate),[2,J(null)]}catch(e){return[2,W(e)]}return[2]}))}))},t.prototype.addLiveStreamTask=function(e){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:if(this.logger.tracking("userAction",t.TAG_NAME,l$1({method:"addLiveStreamTask"},e)),!e.layout)throw new Error("liveStreamTaskInfo ".concat(T.PARAMS_IS_INCORRECT));r=this._liveStreamTaskInfo2RtcTask(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._rtc.addTasks({rtmpTasks:[r]})];case 2:return n.sent(),[2,J(null)];case 3:return[2,W(n.sent())];case 4:return[2]}}))}))},t.prototype.updateLiveStreamTask=function(e){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,l$1({method:"updateLiveStreamTask"},e)),r=this._liveStreamTaskInfo2RtcTask(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._rtc.updateTasks({rtmpTasks:[r]})];case 2:return n.sent(),[2,J(null)];case 3:return[2,W(n.sent())];case 4:return[2]}}))}))},t.prototype.removeLiveStreamTask=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:if(this.logger.tracking("userAction",t.TAG_NAME,{method:"removeLiveStreamTask",taskId:e}),!e)return[2,W(null,T.PARAMS_IS_INCORRECT)];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._rtc.deleteTasks({taskIds:[e]})];case 2:return r.sent(),[2,J(null)];case 3:return[2,W(r.sent())];case 4:return[2]}}))}))},t.prototype.enableEarBack=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),this._localMember.isAudioOn?(this.logger.log(t.TAG_NAME,"enableEarBack"),[4,this._rtc.playLocalStream(f.Audio,{audio:!0})]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2,J(null)];case 3:return[2,W(e.sent())];case 4:return[2]}}))}))},t.prototype.disableEarBack=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),this._localMember.isAudioOn?(this.logger.log(t.TAG_NAME,"disableEarBack"),[4,this._rtc.stopLocalStream(f.Audio)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2,J(null)];case 3:return[2,W(e.sent())];case 4:return[2]}}))}))},t.prototype.playEffect=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t.playbackVolume&&0!==t.playbackVolume&&this._rtc.setEffectsVolume(t.playbackVolume),[4,this._rtc.playEffect({soundId:e,filePath:t.path,cycle:t.loopCount})];case 1:return r.sent(),[2,J(null)];case 2:return[2,W(r.sent())];case 3:return[2]}}))}))},t.prototype.setAudioMixingPlaybackVolume=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rtc.adjustAudioMixingVolume(e)];case 1:return t.sent(),[2,J(null)];case 2:return[2,W(t.sent())];case 3:return[2]}}))}))},t.prototype.setEffectSendVolume=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rtc.setEffectsVolume(e)];case 1:return t.sent(),[2,J(null)];case 2:return[2,W(t.sent())];case 3:return[2]}}))}))},t.prototype.startAudioMixing=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:e.playbackVolume||0===e.playbackVolume||(e.playbackVolume=100),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._rtc.startAudioMixing({audioFilePath:e.path,auidoMixingEnd:e.audioMixingEnd||null,cycle:e.loopCount||0,loopback:e.loopback,playStartTime:e.playStartTime||0,replace:e.replace,volume:e.playbackVolume})];case 2:return t.sent(),[2,J(null)];case 3:return[2,W(t.sent())];case 4:return[2]}}))}))},t.prototype.stopAllEffects=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._rtc.stopAllEffects()];case 1:return e.sent(),[2,J(null)];case 2:return[2,W(e.sent())];case 3:return[2]}}))}))},t.prototype.stopAudioMixing=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._rtc.stopAudioMixing()];case 1:return e.sent(),[2,J(null)];case 2:return[2,W(e.sent())];case 3:return[2]}}))}))},t.prototype.stopEffect=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rtc.stopEffect(e)];case 1:return t.sent(),[2,J(null)];case 2:return[2,W(t.sent())];case 3:return[2]}}))}))},t.prototype.pushExternalVideoFrame=function(e){return e?(this._rtc.setExternalVideoSource(e),0):(this.logger.warn("videoSource is required"),-1)},t.prototype.seExternalVideoSource=function(e){return this._rtc.setEnableExternalVideo(e),0},t.prototype.adjustRecordingSignalVolume=function(e){return e<0||e>100?(this.logger.warn("volume must be between 0 and 100"),-1):(this._rtc.setCaptureVolume(e),0)},t.prototype.disableLocalSubStreamAudio=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._rtc.muteAudioSlave()];case 1:return e.sent(),[2,J(null)];case 2:return[2,W(e.sent())];case 3:return[2]}}))}))},t.prototype.enableLocalSubStreamAudio=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"enableLocalSubStreamAudio"}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._rtc.unmuteAudioSlave()];case 2:return e.sent(),[2,J(null)];case 3:return[2,W(e.sent())];case 4:return[2]}}))}))},t.prototype.getEffectDuration=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t={soundId:e.effectId,filePath:e.filePath,cycle:e.cycle},[4,this._rtc.getAudioEffectsDuration(t)];case 1:return[2,J(r.sent())];case 2:return[2,W(r.sent())];case 3:return[2]}}))}))},t.prototype.pauseAllEffects=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._rtc.pauseAllEffects()];case 1:return e.sent(),[2,J(null)];case 2:return[2,W(e.sent())];case 3:return[2]}}))}))},t.prototype.pauseEffect=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rtc.pauseEffect(e)];case 1:return t.sent(),[2,J(null)];case 2:return[2,W(t.sent())];case 3:return[2]}}))}))},t.prototype.resumeAllEffects=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._rtc.resumeAllEffects()];case 1:return e.sent(),[2,J(null)];case 2:return[2,W(e.sent())];case 3:return[2]}}))}))},t.prototype.resumeEffect=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._rtc.resumeEffect(e)];case 1:return t.sent(),[2,J(null)];case 2:return[2,W(t.sent())];case 3:return[2]}}))}))},t.prototype.setChannelProfile=function(e){return this._rtc.setChannelProfile(e),0},t.prototype._getRtcUidByUuid=function(e){var t;if(this._localMember.uuid===e?t=this._localMember:this._remoteMemberMap.has(e)&&(t=this._remoteMemberMap.get(e)),t)return t.rtcUid?Number(t.rtcUid):t.rtcUid;this.logger.error("getRtcUidByUuid: ".concat(e," not in the remoteMemberMap"),this._remoteMemberMap)},t.prototype._getUuidByRtcUid=function(e){var t,r,n="";if(this._localMember.rtcUid===+e)n=this._localMember.uuid;else try{for(var i=m(this._remoteMemberMap.values()),o=i.next();!o.done;o=i.next()){var s=o.value;if(s.rtcUid==+e){n=s.uuid;break}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},t.prototype.stopPlayingRemoteStream=function(e,t){var r=this._getRtcUidByUuid(t);if(r){var n=this._subscribedSubStreamMap.get(r);n&&n.streamObj&&this._rtc.stopPlayingRemoteStream(e,n.streamObj.stream)}},t.prototype.replayRemoteStream=function(e){var t,r;return h(this,void 0,void 0,(function(){var n,i,o,s,a;return d(this,(function(c){if(n=e.userUuid,e.type,!(i=this._getRtcUidByUuid(n)))return[2,W("该用户不存在")];try{return o=this._subscribedStreamMap.get(i),s=this._subscribeAudioStreamMap.get(i),a=this._subscribedSubStreamMap.get(i),o&&o.streamObj&&o.isSubscribed?null===(t=o.streamObj.stream)||void 0===t||t.resume():s&&s.stream?s.stream.resume():a&&a.streamObj&&a.isSubscribed&&(null===(r=a.streamObj.stream)||void 0===r||r.resume()),[2,J(null)]}catch(e){return[2,W(e)]}return[2]}))}))},t.prototype.adjustPlaybackSignalVolume=function(e){return e<=100&&e>=0?(this._rtc.setPlaybackVolume(e),0):-1},t.prototype.pauseLocalAudioRecording=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"pauseLocalAudioRecording"}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._rtc.muteAudio()];case 2:return e.sent(),[2,J(null)];case 3:return[2,W(e.sent())];case 4:return[2]}}))}))},t.prototype.pauseLocalVideoCapture=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"pauseLocalVideoCapture"}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._rtc.muteVideo()];case 2:return e.sent(),[2,J(null)];case 3:return[2,W(e.sent())];case 4:return[2]}}))}))},t.prototype.resumeLocalAudioRecording=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"resumeLocalAudioRecording"}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._rtc.unmuteAudio()];case 2:return e.sent(),[2,J(null)];case 3:return[2,W(e.sent())];case 4:return[2]}}))}))},t.prototype.resumeLocalVideoCapture=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"resumeLocalVideoCapture"}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._rtc.unmuteVideo()];case 2:return e.sent(),[2,J(null)];case 3:return[2,W(e.sent())];case 4:return[2]}}))}))},t.prototype._subscribeStream=function(e,t,r,n,i){return h(this,void 0,void 0,(function(){var o,s,a,c,u;return d(this,(function(l){switch(l.label){case 0:return l.trys.push([0,5,,6]),t?(o=void 0,r===f.Audio?(s=this._subscribedSubStreamMap.get(n),a=this._subscribedStreamMap.get(n),o={audio:!0,screen:Boolean(s&&s.isSubscribed&&s.streamObj),video:Boolean(a&&a.isSubscribed&&a.streamObj)}):r===f.Video?(s=this._subscribedSubStreamMap.get(n),o={video:!0,audio:!0,screen:Boolean(s&&s.isSubscribed&&s.streamObj),highOrLow:i}):r===f.AudioSlave?(s=this._subscribedSubStreamMap.get(n),a=this._subscribedStreamMap.get(n),o={screen:Boolean(s&&s.isSubscribed&&s.streamObj),video:Boolean(a&&a.isSubscribed&&a.streamObj),audio:!0,audioSlave:!0}):(a=this._subscribedStreamMap.get(n),o={screen:!0,video:Boolean(a&&a.isSubscribed&&a.streamObj),audio:!0}),[4,this._rtc.subscribe(e,o,{mediaType:r,rtcUid:n})]):[3,2];case 1:return l.sent(),[3,4];case 2:return[4,this._rtc.subscribe(e,(u={},u[r]=!1,u),{mediaType:r,rtcUid:n,unsubscribe:!0})];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:return c=l.sent(),[2,Promise.reject(c)];case 6:return[2]}}))}))},t.prototype._playRemoteStream=function(e,t,r){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._rtc.playRemoteStream({stream:e,uid:t,type:r})];case 1:return n.sent(),[2,J(null)];case 2:return[2,W(n.sent())];case 3:return[2]}}))}))},t.prototype._changeMemberStream=function(e,t,r){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._request.changeMemberStreamsApi({roomUuid:this._channelName,userUuid:e,streamKey:t,isOpen:r,sequence:this._operationStreamSequence++})];case 1:return[2,J(n.sent())];case 2:return[2,W(n.sent())];case 3:return[2]}}))}))},t.prototype._resetState=function(){this._subscribedStreamMap.clear(),this._subscribedSubStreamMap.clear(),this._subscribeAudioStreamMap.clear(),this._addNotAllowListenerMap.clear(),this._operationStreamSequence=0,this._isJoined=!1,this._removeListener()},t.prototype._addRtcListener=function(){var e=this;return this.isSupported?this._isInit?(this._rtc.on(N.STREAM_ADDED,(function(r){return h(e,void 0,void 0,(function(){var e,n,i;return d(this,(function(o){switch(o.label){case 0:return this.logger.log(t.TAG_NAME,"STREAM_ADDED",r),(e=r.stream.streamID)===this._localMember.rtcUid?[2]:"video"!==r.mediaType?[3,4]:(i=this._subscribedStreamMap.get(e))&&i.isSubscribed?(i.streamObj=r,this._subscribedStreamMap.set(e,i),[4,this._subscribeStream(r.stream,!0,f.Video,e,i.streamType)]):[3,2];case 1:return o.sent(),[3,3];case 2:this._subscribedStreamMap.set(e,{isSubscribed:!1,streamType:w.HIGH,streamObj:r}),o.label=3;case 3:return[3,11];case 4:return"audio"!==r.mediaType?[3,6]:[4,this._subscribeStream(r.stream,!0,f.Audio,e)];case 5:return o.sent(),[3,11];case 6:return"audioSlave"!==r.mediaType?[3,8]:[4,this._subscribeStream(r.stream,!0,f.AudioSlave,e)];case 7:return o.sent(),n=this._getUuidByRtcUid(e),this._emitter.emit(N.START_SCREEN_AUDIO,{userUuid:n}),[3,11];case 8:return(i=this._subscribedSubStreamMap.get(e))&&i.isSubscribed?(i.streamObj=r,this._subscribedSubStreamMap.set(e,i),[4,this._subscribeStream(r.stream,!0,f.Screen,e)]):[3,10];case 9:return o.sent(),[3,11];case 10:this._subscribedSubStreamMap.set(e,{isSubscribed:!1,streamObj:r}),o.label=11;case 11:return[2]}}))}))})),this._rtc.on(N.STREAM_SUBSCRIBED,(function(r){return h(e,void 0,void 0,(function(){var e,n,i,o=this;return d(this,(function(s){switch(s.label){case 0:return this.logger.log(t.TAG_NAME,"STREAM_SUBSCRIBED",r.stream.streamID,r.mediaType),e=r.stream.streamID,n=r,this._addNotAllowListenerMap.has(e)||(n.stream.on(N.NOTALLOWEDERROR,(function(n){if(41030===n.getCode()){var i=o._getUuidByRtcUid(e);o.logger.log(t.TAG_NAME,"STREAM_SUBSCRIBED NOTALLOWEDERROR",i),o._emitter.emit(N.NOTALLOWEDERROR,{userUuid:i,type:r.mediaType})}})),this._addNotAllowListenerMap.set(e,!0)),"audio"!==r.mediaType?[3,2]:(this.logger.log("音频自动订阅完成"),this._subscribeAudioStreamMap.set(e,{stream:n.stream}),[4,this._playRemoteStream(n.stream,e,"audio")]);case 1:return s.sent(),[3,11];case 2:return"video"!==r.mediaType?[3,6]:(i=this._subscribedStreamMap.get(e))?[4,this._playRemoteStream(n.stream,e,"video")]:[3,4];case 3:return s.sent(),this._subscribedStreamMap.set(e,l$1(l$1({},i),{isSubscribed:!0,streamObj:n})),[3,5];case 4:this._subscribedStreamMap.set(e,{isSubscribed:!0,streamObj:n,streamType:w.HIGH}),s.label=5;case 5:return[3,11];case 6:return"screen"!==r.mediaType?[3,9]:this._subscribedSubStreamMap.has(e)?[4,this._playRemoteSubStream(n.stream,e)]:[3,8];case 7:s.sent(),s.label=8;case 8:return this._subscribedSubStreamMap.set(e,{isSubscribed:!0,streamObj:n}),[3,11];case 9:return"audioSlave"!==r.mediaType?[3,11]:[4,this._playRemoteSubStream(n.stream,e,"audioSlave")];case 10:s.sent(),s.label=11;case 11:return[2]}}))}))})),this._rtc.on(N.STREAM_REMOVED,(function(r){return h(e,void 0,void 0,(function(){var e,n,i,o,s;return d(this,(function(a){switch(a.label){case 0:if(this.logger.log(t.TAG_NAME,"STREAM_REMOVED",r),e=r.stream.streamID,"screen"!==r.mediaType)return[3,6];if(!(i=this._subscribedSubStreamMap.get(e)))return[3,5];if(!i.streamObj)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),this._rtc.stopPlayingRemoteStream("screen",i.streamObj.stream),[4,this._subscribeStream(i.streamObj.stream,!1,f.Screen,e)];case 2:return a.sent(),[3,4];case 3:return n=a.sent(),this.logger.warn("unsubscribe screen stream failed: ",n),[3,4];case 4:this._subscribedSubStreamMap.set(e,l$1(l$1({},i),{streamObj:null})),a.label=5;case 5:return[3,13];case 6:if("video"!==r.mediaType)return[3,12];if(!(i=this._subscribedStreamMap.get(e)))return[3,11];if(!i.streamObj)return[3,10];a.label=7;case 7:return a.trys.push([7,9,,10]),this._rtc.stopPlayingRemoteStream("video",i.streamObj.stream),[4,this._subscribeStream(i.streamObj.stream,!1,f.Video,e)];case 8:return a.sent(),[3,10];case 9:return o=a.sent(),this.logger.warn("unsubscribe video stream failed: ",o),[3,10];case 10:this._subscribedStreamMap.set(e,l$1(l$1({},i),{streamObj:null})),a.label=11;case 11:return[3,13];case 12:"audio"===r.mediaType?this._subscribeAudioStreamMap.delete(e):"audioSlave"===r.mediaType&&(s=this._getUuidByRtcUid(e),this._emitter.emit(N.STOP_SCREEN_AUDIO,{userUuid:s})),a.label=13;case 13:return[2]}}))}))})),this._rtc.on(N.STOP_SCREEN_SHARE,(function(){return h(e,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this.logger.log(t.TAG_NAME,"STOP_SCREEN_SHARE",this._localMember),this._localMember.isSharingScreen?[4,this.stopScreenShare()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})),this._rtc.on(N.ACTIVE_SPEAKER,(function(t){return h(e,void 0,void 0,(function(){var e;return d(this,(function(r){return e=this._getUuidByRtcUid(t.uid),this._emitter.emit(N.ACTIVE_SPEAKER,{userUuid:e,volume:t.level}),[2]}))}))})),this._rtc.on(N.VOLUME_INDICATOR,(function(t){var r=t.map((function(t){return{userUuid:e._getUuidByRtcUid(t.uid),volume:t.level}}));e._emitter.emit(N.VOLUME_INDICATOR,r)})),this._rtc.on(N.PEER_ONLINE,(function(t){var r=e._getUuidByRtcUid(String(t.uid));e._setMemberIsInClientRtc(r,t.uid,!0);var n=e._remoteMemberMap.get(r);n&&n._isInServerRtc&&(n.isInRtcChannel=!0,e._remoteMemberMap.set(r,n))})),this._rtc.on(N.PEER_LEAVE,(function(t){e.logger.log("PEER_LEAVE",t.uid);var r=e._getUuidByRtcUid(String(t.uid));e._setMemberIsInClientRtc(r,t.uid,!1);var n=e._remoteMemberMap.get(r);n&&(n._isInServerRtc||(n.isInRtcChannel=!1,e._remoteMemberMap.set(r,n)))})),this._rtc.on(N.CONNECTION_STATE_CHANGE,(function(t){"DISCONNECTED"===t.curState&&t.reconnect&&(e._isJoined=!1),e._emitter.emit(N.CONNECTION_STATE_CHANGE,t)})),this._rtc.on(N.NETWORK_QUALITY,(function(t){var r=t.map((function(t){return{userUuid:e._getUuidByRtcUid(t.uid),downStatus:t.downlinkNetworkQuality,upStatus:t.uplinkNetworkQuality}}));e._emitter.emit(N.NETWORK_QUALITY,r)})),this._rtc.on(N.VIDEO_TRACK_ENDED,(function(){return h(e,void 0,void 0,(function(){return d(this,(function(e){return this.logger.error("VIDEO_TRACK_ENDED"),this._emitter.emit(N.VIDEO_TRACK_ENDED),[2]}))}))})),this._rtc.on(N.ERROR,(function(t){e.logger.error("RTC_ERROR",t),e._emitter.emit(N.ERROR,t)})),this._rtc.on(N.ABILITY_NOT_SUPPORT,(function(t){var r=e._getUuidByRtcUid(String(t.uid));r&&(e.logger.error("ABILITY_NOT_SUPPORT",r),t.uid=r),e._emitter.emit(N.ABILITY_NOT_SUPPORT,t)})),this._rtc.on(N.MINIAPP_STREAM_CHANGED,(function(t){var r=e._getUuidByRtcUid(String(t.uid)),n=e._remoteMemberMap.get(r);"local"===t.uid&&(r=e._localMember.uuid,n=e._localMember),n&&(n.miniAppStreamInfo=Object.assign(n.miniAppStreamInfo||{},t.stream),e._emitter.emit(N.MINIAPP_STREAM_CHANGED,n))})),this._rtc.on(N.CAMERA_DEVICE_CHANGE,(function(t){e._emitter.emit(N.CAMERA_DEVICE_CHANGE,t)})),this._rtc.on(N.SPEAKER_DEVICE_CHANGE,(function(t){e._emitter.emit(N.SPEAKER_DEVICE_CHANGE,t)})),this._rtc.on(N.RECORD_DEVICES_CHANGE,(function(t){e._emitter.emit(N.RECORD_DEVICES_CHANGE,t)})),void((null===window||void 0===window?void 0:window.addEventListener)?window.addEventListener("online",this._onlineHandler.bind(this)):"undefined"!=typeof wx&&(this.logger.log(t.TAG_NAME,"wx环境 监听网络变化 onNetworkStatusChange"),wx.onNetworkStatusChange(this._wxNetworkListener.bind(this))))):W(null,T.NOT_INIT_RTC):W(null,T.NOT_SUPPORT)},t.prototype._wxNetworkListener=function(e){this.logger.log(t.TAG_NAME,"wx.onNetworkStatusChange ",e,e.isConnected,this._needToSendMuteAudio,this._needToSendMuteVideo),e.isConnected&&this._onlineHandler.bind(this)()},t.prototype._onlineHandler=function(){this.logger.tracking("userAction",t.TAG_NAME,{method:"online",needToSendMuteAudio:this._needToSendMuteAudio,needToSendMuteVideo:this._needToSendMuteVideo}),this.logger.log(t.TAG_NAME,"重连后 _needToSendMuteAudio:",this._needToSendMuteAudio,"；_needToSendMuteVideo:",this._needToSendMuteVideo),this._needToSendMuteAudio&&this._muteStreamRequest({streamKey:P.AUDIO},this._maxReTryCount,"audio"),this._needToSendMuteVideo&&this._muteStreamRequest({streamKey:P.VIDEO},this._maxReTryCount,"video")},t.prototype._removeListener=function(){this._rtc.off(N.STREAM_SUBSCRIBED),this._rtc.off(N.STREAM_REMOVED),this._rtc.off(N.STREAM_ADDED),this._rtc.off(N.STOP_SCREEN_SHARE),this._rtc.off(N.CONNECTION_STATE_CHANGE),this._rtc.off(N.ERROR),this._rtc.off(N.CAMERA_DEVICE_CHANGE),this._rtc.off(N.SPEAKER_DEVICE_CHANGE),this._rtc.off(N.RECORD_DEVICES_CHANGE),this._rtc.off(N.ACTIVE_SPEAKER),this._rtc.off(N.VOLUME_INDICATOR),this._rtc.off(N.PEER_ONLINE),this._rtc.off(N.PEER_LEAVE),this._rtc.off(N.CONNECTION_STATE_CHANGE),this._rtc.off(N.NETWORK_QUALITY),this._rtc.off(N.VIDEO_TRACK_ENDED),this._rtc.off(N.ERROR),this._rtc.off(N.ABILITY_NOT_SUPPORT),this._rtc.off(N.MINIAPP_STREAM_CHANGED),this._rtc.off(N.CAMERA_DEVICE_CHANGE),this._rtc.off(N.SPEAKER_DEVICE_CHANGE),this._rtc.off(N.RECORD_DEVICES_CHANGE),(null===window||void 0===window?void 0:window.removeEventListener)?window.removeEventListener("online",this._onlineHandler.bind(this)):"undefined"!=typeof wx&&wx.offNetworkStatusChange(this._wxNetworkListener.bind(this))},t.prototype._playRemoteSubStream=function(e,t,r){return void 0===r&&(r="screen"),h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._rtc.playRemoteStream({stream:e,uid:t,type:r})];case 1:return n.sent(),[2,J(null)];case 2:return[2,W(n.sent())];case 3:return[2]}}))}))},t.prototype._getScreenVideoProfile=function(e){return{LOW:180,STANDARD:360,HD720P:702,HD1080P:1080}[e]||1080},t.prototype._muteStreamRequest=function(e,r,n){return h(this,void 0,void 0,(function(){var i,o,s=this;return d(this,(function(a){switch(a.label){case 0:return"undefined"!=typeof window||"undefined"==typeof navigator?[3,1]:(this.logger.debug("当前网络状态",navigator.onLine),navigator.onLine?[3,5]:("audio"===n?this._needToSendMuteAudio=!0:"video"===n&&(this._needToSendMuteVideo=!0),[2]));case 1:if("undefined"==typeof wx)return[3,5];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,wx.getNetworkType()];case 3:return i=a.sent(),this.logger.debug(t.TAG_NAME,"wx环境当前网络状态",i),i&&"none"!==i.networkType?[3,5]:("audio"===n?this._needToSendMuteAudio=!0:"video"===n&&(this._needToSendMuteVideo=!0),this.logger.log(t.TAG_NAME,"wx断网",this._needToSendMuteAudio,this._needToSendMuteVideo),[2]);case 4:return o=a.sent(),console.error("wx.getNetworkType error ",o),[2];case 5:return[2,this._request.changeMemberStreamsApi(l$1({isOpen:!1,roomUuid:this._channelName,userUuid:this._localMember.uuid,sequence:this._operationStreamSequence++},e)).then((function(){"audio"===n?(s.muteMyAudioTimer&&clearTimeout(s.muteMyAudioTimer),s.muteMyAudioTimer=null):"video"===n&&(s.muteMyVideoTimer&&clearTimeout(s.muteMyVideoTimer),s.muteMyVideoTimer=null),r<s._maxReTryCount&&!s.muteMyVideoTimer&&!s.muteMyAudioTimer&&s._emitter.emit(g.SYNC_DATA_DONE)})).catch((function(t){if(console.error(">>>>>>>>>>>",t,r),r<=0)s._emitter.emit(g.SYNC_DATA_ERROR);else{var i=l$1(l$1({},e),{sequence:s._operationStreamSequence++});"audio"===n?(s.muteMyAudioTimer&&clearTimeout(s.muteMyAudioTimer),s.muteMyAudioTimer=setTimeout((function(){s.muteMyAudioTimer=null,s._muteStreamRequest(i,--r,n)}),15e3)):"video"===n&&(s.muteMyVideoTimer&&clearTimeout(s.muteMyVideoTimer),s.muteMyVideoTimer=setTimeout((function(){s.muteMyVideoTimer=null,s._muteStreamRequest(i,--r,n)}),15e3))}}))]}}))}))},t.prototype._liveStreamTaskInfo2RtcTask=function(e){var t=this,r=e.layout;if(!r)throw new Error("liveStreamTaskInfo ".concat(T.PARAMS_IS_INCORRECT));var n=r.userTranscodingList?r.userTranscodingList.map((function(e){return{uid:t._getRtcUidByUuid(e.uuid)||"",x:e.x,y:e.y,width:e.width,height:e.height,pushAudio:e.audioPush,pushVideo:e.videoPush,zOrder:e.zOrder,adaption:1}})):[],i={canvas:{width:r.width,height:r.height,color:r.backgroundColor},users:n,images:r.images?r.images:[]},o={audioParam:{}},s=e.config;return s&&((s.audioBitrate||0===s.audioBitrate)&&(o.audioParam.bitRate=s.audioBitrate),s.sampleRate&&(o.audioParam.sampleRate=s.sampleRate),s.channels&&(o.audioParam.channels=s.channels),s.audioCodecProfile&&(o.audioParam.codecProfile=s.audioCodecProfile),o.singleVideoNoTrans=s.singleVideoPassThrough),{taskId:e.taskId,streamUrl:e.streamUrl,record:e.serverRecordEnabled,layout:i,extraInfo:e.extraInfo,config:o}},t.TAG_NAME="NERoomRtcController",t}(Y),z=function(){function e(t){this.isSupported=!0,this._whiteboard=null,this._drawPlugin=null,this._toolCollection=null,this._WhiteBoardSDK=null,this._ToolCollectionSDK=null,this._roomUuid="",this.hasTransDoc=!1,this._isJoined=!1,this._debug=!0,t.whiteboard,t.toolCollection;var r=t.isSupported,n=t.request,i=t.roomUuid,o=t.logger,s=t.roomWhiteboard,a=t.localMember,c=t.wbSharingUserUuid,u=t.debug;this.isSupported=r,this.isSupported?(this.logger=o,this._request=n,this._roomUuid=i,this._initOptions=t,this._roomWhiteboard=s,this._localMember=a,this._debug=!1!==u,this.logger.log(e.TAG_NAME,"constructor",t),this._wbSharingUuid=c):this.isSupported=!1}return Object.defineProperty(e.prototype,"isJoinedWhiteboard",{get:function(){return this._isJoined},enumerable:!1,configurable:!0}),e.prototype.setWhiteboardNeedInfo=function(t){try{return this.logger.tracking("userAction",e.TAG_NAME,{method:"setWhiteboardNeedInfo",userUuid:t}),this._wbSharingUuid=t,J(null)}catch(e){return F(e,T.FAILURE)}},e.prototype.getWhiteboardSharingUserUuid=function(){if(!this.isSupported)throw new Error(T.NOT_SUPPORT);if(!this._isJoined)throw new Error(T.NOT_JOIN_WHITEBOARD);return this._wbSharingUuid||""},e.prototype.resetWhiteboardCanvas=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return e?[3,2]:[4,this._drawPlugin.setContainer(e)];case 1:return t.sent(),[2,J(null)];case 2:return[2,this.setupWhiteboardCanvas(e)]}}))}))},e.prototype.setupWhiteboardCanvas=function(t){return h(this,void 0,void 0,(function(){var r,n,i;return d(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._drawPlugin||!this._isJoined)return[2,W(null,T.NOT_JOIN_WHITEBOARD)];if(t&&"[object String]"==Object.prototype.toString.call(t)?(n=document.querySelector(t),r=n||void 0):r=t,!r)return[2,W({code:M.FAILURE,msg:"view is not exit"})];this.logger.log(e.TAG_NAME,"设置白板视图--start--"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._drawPlugin.setContainer(r)];case 2:return o.sent(),this.logger.log(e.TAG_NAME,"设置白板视图 success "),[3,4];case 3:return i=o.sent(),this.logger.error(e.TAG_NAME,"setupWhiteboardCanvas fail:","".concat(r),"".concat(i)),[2,W({code:M.FAILURE,msg:i})];case 4:return this._setToolCollection(r),[2,J(null)]}}))}))},e.prototype.setEnableDraw=function(t){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._drawPlugin||!this._toolCollection||!this._isJoined)return[2,W(null,T.NOT_JOIN_WHITEBOARD)];n.label=1;case 1:return n.trys.push([1,5,,6]),[4,this.getWhiteboardSharingUserUuid()];case 2:return!n.sent()&&t?[2,W({code:M.FAILURE,msg:"房间内白板尚未开启"})]:(this.logger.log(e.TAG_NAME,"设置白板是否可绘制--start--",t),[4,this._drawPlugin.enableDraw(t)]);case 3:return n.sent(),this.logger.log(e.TAG_NAME,"白板设置完成 ",t),[4,this._toolCollection.setVisibility({bottomRight:{visible:t},topRight:{visible:t},left:{visible:t,exclude:t?["exportImage","opacity"]:[]},bottomLeft:{visible:!0,exclude:t?[]:["visionControl"]}})];case 4:return n.sent(),this.logger.log(e.TAG_NAME,"设置工具栏显隐 success ",t),[3,6];case 5:return r=n.sent(),this.logger.error(e.TAG_NAME,"设置白板是否可绘制失败 ","".concat(t),"".concat(r)),[2,W({code:M.FAILURE,msg:r})];case 6:return[2,J(null)]}}))}))},e.prototype.startWhiteboardShare=function(){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_WHITEBOARD)];this.logger.tracking("userAction",e.TAG_NAME,{method:"startWhiteboardShare"}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.updateRoomPropertiesApi({roomUuid:this._roomUuid,propertyKey:"wbSharingUuid",associatedUuid:this._localMember.uuid,data:{value:this._localMember.uuid}})];case 2:return r.sent(),this.logger.log(e.TAG_NAME,"开始共享白板 success"),[2,J(null)];case 3:return t=r.sent(),this.logger.error(e.TAG_NAME,"startWhiteboardShare fail:",t),[2,W(t)];case 4:return[2]}}))}))},e.prototype.stopWhiteboardShare=function(){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_WHITEBOARD)];this.logger.tracking("userAction",e.TAG_NAME,{method:"stopWhiteboardShare"}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.deleteRoomPropertyApi({roomUuid:this._roomUuid,propertyKey:"wbSharingUuid"})];case 2:return r.sent(),this._drawPlugin.unlockCameraWithContent(),this.logger.log(e.TAG_NAME,"停止共享白板 success"),[2,J(null)];case 3:return t=r.sent(),this.logger.error(e.TAG_NAME,"stopWhiteboardShare fail:",t),[2,W(t)];case 4:return[2]}}))}))},e.prototype.initWhiteboard=function(){return h(this,void 0,void 0,(function(){var t,r,n,i,o,s,a,c,u,l,p,m,f,g=this;return d(this,(function(v){switch(v.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(this._isJoined)return this.logger.warn(e.TAG_NAME,"已加入白板房间 请勿重复加入"),[2,J(null)];this.logger.log(e.TAG_NAME,"初始化白板--start--"),t=this._initOptions,(r=document.createElement("div")).id="initWbDom",n=this._roomWhiteboard.channelName,t.privateConf&&(o=t.privateConf,s=o.roomServer,a=o.sdkLogNosServer,c=o.dataReportServer,u=o.directNosServer,l=o.mediaUploadServer,p=o.docTransServer,i={roomServerAddr:s,sdkLogNosAddr:a,dataReportAddr:c,directNosAddr:u,mediaUploadAddr:l,docTransAddr:p}),v.label=1;case 1:return v.trys.push([1,5,,6]),[4,this._loadWhiteboardJS()];case 2:return v.sent(),this._WhiteBoardSDK=window.WhiteBoardSDK,this._ToolCollectionSDK=window.ToolCollection,m=this,[4,this._WhiteBoardSDK.getInstance({appKey:t.appKey,nickname:t.nickname,uid:t.uid,platform:"web",container:r,record:!1,privateConf:i||{},getAuthInfo:function(){return h(g,void 0,void 0,(function(){return d(this,(function(e){return[2,{checksum:t.checksum,nonce:t.nonce,curTime:t.curTime}]}))}))}})];case 3:return m._whiteboard=v.sent(),this.logger.log(e.TAG_NAME,"创建白板实例"),[4,this._whiteboard.joinRoom({channel:n,createRoom:!0},{ondisconnected:function(){g._WhiteBoardSDK.hideToast()}}).then((function(t){g._drawPlugin=t,g._drawPlugin.setColor("rgb(224, 32, 32)"),g._isJoined=!0,g.logger.log(e.TAG_NAME,"白板加入房间")})).catch((function(t){return g.logger.error(e.TAG_NAME,"白板joinRoom fail:",n,t),W({code:M.FAILURE,msg:t})}))];case 4:return v.sent(),[2,J(null)];case 5:return f=v.sent(),this.logger.error(e.TAG_NAME,"initWhiteboard fail:",n,f),[2,W({code:M.FAILURE,msg:f})];case 6:return[2]}}))}))},e.prototype.destroy=function(){return h(this,void 0,void 0,(function(){return d(this,(function(t){this.logger.tracking("userAction",e.TAG_NAME,{method:"destroy"});try{return this._whiteboard&&this._whiteboard.destroy(),this._toolCollection&&this._toolCollection.destroy(),this._toolCollection=null,this._drawPlugin=null,this._whiteboard=null,this._isJoined=!1,this.logger.log(e.TAG_NAME,"白板destroy success"),[2,J(null)]}catch(t){return this.logger.error(e.TAG_NAME,"白板destroy fail:","".concat(t)),[2,W({code:M.FAILURE,msg:t})]}return[2]}))}))},e.prototype.stopMemberWhiteboardShare=function(t){return this._wbSharingUuid!==t?W("".concat(t," not sharing whiteboard")):(this.logger.tracking("userAction",e.TAG_NAME,{method:"stopMemberWhiteboardShare",userUuid:t}),this.stopWhiteboardShare())},e.prototype.setCanvasBackgroundColor=function(e){return this._drawPlugin.setAppConfig({canvasBgColor:e}),0},e.prototype.lockCameraWithContent=function(e,t){return this._drawPlugin.lockCameraWithContent({width:e,height:t}),0},e.prototype._loadUrl=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){return(t=document.createElement("script")).type="text/javascript",t.src=e,document.head.appendChild(t),[2,new Promise((function(r,n){t.onload=function(){r(!0)},t.onerror=function(){n("url was not find: "+e)}}))]}))}))},e.prototype._loadWhiteboardJS=function(){var t;return h(this,void 0,void 0,(function(){var r,n,i,o,s,a;return d(this,(function(c){switch(c.label){case 0:return r=null===(t=this._initOptions.privateConf)||void 0===t?void 0:t.privateSDKUrl,n=(null==r?void 0:r.WhiteboardUrl)?r.WhiteboardUrl:e.WhiteboardUrl,i=(null==r?void 0:r.ToolCollectionUrl)?r.ToolCollectionUrl:e.ToolCollectionUrl,o=(null==r?void 0:r.PPTRendererUrl)?r.PPTRendererUrl:e.PPTRendererUrl,s=[],(a=Array.prototype.slice.call(document.getElementsByTagName("script"))).find((function(e){return e.src===n}))||s.push(this._loadUrl(n)),a.find((function(e){return e.src===i}))||s.push(this._loadUrl(i)),a.find((function(e){return e.src===o}))||this._loadUrl(o),[4,Promise.all(s)];case 1:return[2,c.sent()]}}))}))},e.prototype._setToolCollection=function(t){var r;return h(this,void 0,void 0,(function(){var n,i=this;return d(this,(function(o){return this.isSupported?this._drawPlugin&&this._isJoined?(this.logger.log(e.TAG_NAME,"设置工具栏--start-- "),this._toolCollection=this._ToolCollectionSDK.getInstance({container:t,handler:this._drawPlugin,options:{platform:"web",debug:!0}}),this._toolCollection.addOrSetTool({position:"left",item:{tool:"video",hint:"视频上传"},insertAfterTool:"image"}),this._toolCollection.show(),n=document.getElementById("initWbDom"),null===(r=null==n?void 0:n.parentNode)||void 0===r||r.removeChild(n),this.logger.log(e.TAG_NAME,"设置工具栏 success "),this._drawPlugin.on("event:appState:change",(function(e,t){var r,n;"board"===e&&(!i.hasTransDoc&&i._drawPlugin.hasTransDoc()?(i.hasTransDoc=!0,null===(r=i._toolCollection)||void 0===r||r.addOrSetContainer({position:"bottomRight",items:[{tool:"prevPage",hint:"上一页"},{tool:"prevAnim",hint:"上一步"},{tool:"pageInfo"},{tool:"nextAnim",hint:"下一步"},{tool:"nextPage",hint:"下一页"},{tool:"preview",hint:"预览",previewSliderPosition:"right"}]})):i.hasTransDoc&&!i._drawPlugin.hasTransDoc()&&(i.hasTransDoc=!1,null===(n=i._toolCollection)||void 0===n||n.addOrSetContainer({position:"bottomRight",items:[{tool:"firstPage",hint:"第一页"},{tool:"prevPage",hint:"上一页"},{tool:"pageInfo"},{tool:"nextPage",hint:"下一页"},{tool:"lastPage",hint:"最后一页"},{tool:"preview",hint:"预览",previewSliderPosition:"right"}]})))})),[2]):[2,W({code:M.FAILURE,msg:T.NOT_JOIN_WHITEBOARD})]:[2,W(null,T.NOT_SUPPORT)]}))}))},e.TAG_NAME="NERoomWhiteboardController",e.WhiteboardUrl="https://roomkit.netease.im/static/wbsdk/3.8.7/g2/sdk/WhiteBoardSDK_v3.8.7.js",e.ToolCollectionUrl="https://roomkit.netease.im/static/wbsdk/3.8.7/g2/sdk/ToolCollection_v3.8.7.js",e.PPTRendererUrl="https://roomkit.netease.im/static/wbsdk/3.8.7/g2/sdk/pptRenderer_v3.8.7.js",e}(),X=function(){function e(t){this.isSupported=!0,this._account="",this._isJoined=!1,this._isInit=!1,this._loadingFileMap=new Map,this.logger=t.logger,this.logger.log(e.TAG_NAME,"constructor",t),this.isSupported=t.isSupported,this.isSupported&&(this._emitter=t.emitter,this.chatroomInit(t))}return e.prototype.joinChatroom=function(){return h(this,void 0,void 0,(function(){var t,r=this;return d(this,(function(n){switch(n.label){case 0:if(this.logger.tracking("userAction",e.TAG_NAME,{method:"joinChatroom"}),!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(this._isJoined)return this.logger.warn("已加入聊天室 请勿重复加入"),[2,J(null)];if(!this._isInit)return[2,W(null,T.NOT_INIT_CHATROOM)];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._chatroom.login(this._loginParams)];case 2:return n.sent(),this._isJoined=!0,this._chatroom.on("onRecvMsg",(function(e){r._emitter.emit(I.CHATROOM_MESSAGE_RECEIVE,e)})),[2,J(null)];case 3:return t=n.sent(),this.logger.tracking("failure",e.TAG_NAME,{method:"joinChatroom",error:t}),[2,W(t,T.CHATROOM_JOIN_FAIL)];case 4:return[2]}}))}))},e.prototype.leaveChatroom=function(){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:if(this.logger.tracking("userAction",e.TAG_NAME,{method:"leaveChatroom"}),!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_CHATROOM)];if(!this._isJoined)return[2,W(null,T.NOT_JOIN_CHATROOM)];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._resetState()];case 2:return r.sent(),[2,J(null)];case 3:return t=r.sent(),this.logger.error(e.TAG_NAME,t,"leaveChatroom"),[2,W(null)];case 4:return[2]}}))}))},e.prototype.destroy=function(){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:this.logger.log(e.TAG_NAME,"destory"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._resetState()];case 2:return r.sent(),this._isInit=!1,[2,J(null)];case 3:return t=r.sent(),this.logger.error(e.TAG_NAME,t,"destory"),[2,W(null)];case 4:return[2]}}))}))},e.prototype.updateMyChatroomMemberInfo=function(e){return this.isSupported?this._isJoined?this._isInit?this._chatroom.updateMyChatroomMemberInfo(e):W(null,T.NOT_INIT_CHATROOM):W(null,T.NOT_JOIN_CHATROOM):W(null,T.NOT_SUPPORT)},e.prototype.sendBroadcastTextMessage=function(t){var r=this;return new Promise((function(n,i){if(r.logger.log(e.TAG_NAME,"sendBroadcastTextMessage"),!r.isSupported)return i(T.NOT_SUPPORT);if(!r._isJoined)return i(T.NOT_JOIN_CHATROOM);if(!r._isInit)return i(T.NOT_INIT_CHATROOM);if(!t.trim())return i(T.NO_MESSAGE_CONTENT);var o={text:t,type:"text",fromAccount:r._account,toAccids:[],done:function(e,t){e?i(e):n(t)}};r._chatroom.sendTextMessage(o)})).then((function(e){return J(e)})).catch((function(e){return W(e)}))},e.prototype.resendTextMessage=function(t,r,n){var i=this;return new Promise((function(o,s){if(i.logger.log(e.TAG_NAME,"resendTextMessage",n),!i.isSupported)return s(T.NOT_SUPPORT);if(!i._isJoined)return s(T.NOT_JOIN_CHATROOM);if(!i._isInit)return s(T.NOT_INIT_CHATROOM);if(!t.trim())return s(T.NO_MESSAGE_CONTENT);var a={text:t,type:"text",idClient:r,fromAccount:i._account,toAccids:n,done:function(e,t){e?s(e):o(t)}};i._chatroom.resendTextMessage(a)})).then((function(e){return J(e)})).catch((function(e){return W(e)}))},e.prototype.sendDirectTextMessage=function(t,r,n){var i=this;return new Promise((function(o,s){if(i.logger.log(e.TAG_NAME,"sendDirectTextMessage",t),!i.isSupported)return s(T.NOT_SUPPORT);if(!i._isJoined)return s(T.NOT_JOIN_CHATROOM);if(!i._isInit)return s(T.NOT_INIT_CHATROOM);if(!t)return s(T.NO_UUID);if(!r.trim())return s(T.NO_MESSAGE_CONTENT);var a={text:r,type:"text",fromAccount:i._account,custom:n||JSON.stringify({toAccids:[t]}),toAccids:[t],done:function(e,t){e?s(e):o(t)}};i._chatroom.sendTextMessage(a)})).then((function(e){return J(e)})).catch((function(e){return W(e)}))},e.prototype.sendGroupTextMessage=function(t,r,n){var i=this;return new Promise((function(o,s){if(i.logger.log(e.TAG_NAME,"sendGroupTextMessage",t),!i.isSupported)return s(T.NOT_SUPPORT);if(!i._isJoined)return s(T.NOT_JOIN_CHATROOM);if(!i._isInit)return s(T.NOT_INIT_CHATROOM);if(!t.length)return s(T.NO_UUID);if(!r.trim())return s(T.NO_MESSAGE_CONTENT);var a={text:r,type:"text",custom:n||JSON.stringify({toAccids:t}),fromAccount:i._account,toAccids:t,done:function(e,t){e?s(e):o(t)}};i._chatroom.sendTextMessage(a)})).then((function(e){return J(e)})).catch((function(e){return W(e)}))},e.prototype.getHistoryMsgs=function(t){var r=this;return new Promise((function(n,i){return r.logger.log(e.TAG_NAME,"getHistoryMsgs",t),r.isSupported?r._isJoined?r._isInit?(t=l$1(l$1({},t),{done:function(e,t){e?i(e):n(t)}}),void r._chatroom.getHistoryMsgs(t)):i(T.NOT_INIT_CHATROOM):i(T.NOT_JOIN_CHATROOM):i(T.NOT_SUPPORT)})).then((function(e){return J(e)})).catch((function(e){return W(e)}))},e.prototype.fetchChatRoomMembers=function(e,t){var r;switch(e){case q.NORMAL:r={guest:!1,limit:t};break;case q.ONLINE_NORMAL:r={guest:!1,onlyOnline:!0,limit:t};break;case q.GUEST_DESC:r={desc:!0,guest:!0,limit:t};break;case q.GUEST_ASC:r={desc:!1,guest:!0,limit:t}}return this._chatroom.getMembers(r||{}).then((function(e){return e.map((function(e){return{nick:e.nick,avatar:e.avatar}}))}))},e.prototype.sendFileMessage=function(t,r,n,i){return this.logger.log(e.TAG_NAME,"sendFileMessage"),this._sendFile({messageUuid:t,blob:r,type:"file",userUuids:n,custom:i})},e.prototype.sendImageMessage=function(t,r,n,i){return this.logger.log(e.TAG_NAME,"sendImageMessage"),this._sendFile({messageUuid:t,blob:r,type:"image",userUuids:n,custom:i})},e.prototype.cancelSendFileMessage=function(t){return h(this,void 0,void 0,(function(){return d(this,(function(r){this.logger.log(e.TAG_NAME,"cancelSendFileMessage ",t);try{return this._loadingFileMap.has(t)?(this._loadingFileMap.get(t).abort(),[2,J(null)]):[2,W(T.FAILURE)]}catch(e){return[2,W(e)]}return[2]}))}))},e.prototype._sendFile=function(t){return h(this,void 0,void 0,(function(){var r,n,i,o,s=this;return d(this,(function(a){return r=t.messageUuid,n=t.blob,i=t.type,o=t.userUuids,[2,new Promise((function(a,c){if(!s.isSupported)return c(T.NOT_SUPPORT);if(!s._isJoined)return c(T.NOT_JOIN_CHATROOM);if(!s._isInit)return c(T.NOT_INIT_CHATROOM);if(!n)return c(T.NO_MESSAGE_CONTENT);var u={type:i,blob:n,fromAccount:s._account,done:function(t,n){s.logger.log(e.TAG_NAME,"_sendFile done"),t?c(t):(n.messageUuid=r,s._loadingFileMap.delete(r),a(n))},uploadprogress:function(e){s._emitter.emit(I.CHATROOM_FILE_UPLOAD_PROGRESS,{messageUuid:r,transferred:null==e?void 0:e.loaded,total:null==e?void 0:e.total})},beginupload:function(e){r&&s._loadingFileMap.set(r,e)}};o&&o.length>0?(u.toAccids=o,u.custom=t.custom?t.custom:JSON.stringify({toAccids:o})):u.toAccids=[],s.logger.log(e.TAG_NAME,"sendFileParms ",u),s._chatroom.sendFileMessage(u)})).then((function(e){return J(e)})).catch((function(e){return W(e)}))]}))}))},e.prototype._removeChatRoomListener=function(){this._chatroom.off("onRecvMsg")},e.prototype.chatroomInit=function(e){var t=e.appKey,r=e.debug,n=e.account,i=e.token,o=e.chatroomNick,s=e.chatroom,a=e.chatroomId,c=e.tags,u=e.notifyTargetTags,l=e.chatroomCustom;this._chatroom=s,this._account=n,this._loginParams={appKey:t,debug:r,account:n,token:i,chatroomId:a,chatroomNick:o,tags:c,notifyTargetTags:u,chatroomCustom:l},this._isInit=!0},e.prototype._resetState=function(){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:if(this.logger.log(e.TAG_NAME,"_resetState"),!this.isSupported||!this._isInit)return[2];this._isJoined=!1,this._loadingFileMap.clear(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._chatroom.logout()];case 2:return r.sent(),this._removeChatRoomListener(),[3,4];case 3:throw t=r.sent(),this.logger.error(e.TAG_NAME,"_resetState",t),new Error(t);case 4:return[2]}}))}))},e.TAG_NAME="NERoomChatController",e}();function Z(e,t){var r=t.roleConfigs[e];if(!r)throw new Error("role not exits");var n=r.params;return{name:e,limit:r.limit,params:{audio:n&&n.audio,video:n&&n.video,screen:n&&n.screen},rtcRole:r.rtcRole,hide:r.hide}}var $=function(){},ee=function(){function e(e){this._liveInfo=null,this._debug=!0,this.logger=e.logger,this._request=e.request,this._rtcController=e.rtcController,this._roomUuid=e.roomUuid,this.isSupported=e.isSupported,this._debug=!1!==e.debug}return e.prototype.getLiveInfo=function(){try{return JSON.parse(JSON.stringify(this._liveInfo))}catch(e){return null}},e.prototype.setLiveInfoFromRoomPropertiesLive=function(e){var t=this._parseRoomPropertiesLive(e);this.setLiveInfo(t)},e.prototype.setLiveInfo=function(e){this._liveInfo?this._liveInfo=l$1(l$1({},this._liveInfo),e):this._liveInfo=e},e.prototype.startLive=function(t){return h(this,void 0,void 0,(function(){var r,n=this;return d(this,(function(i){return this.logger.tracking("userAction",e.TAG_NAME,l$1({method:"startLive"},t)),r=this._getRtcUidListByUuidList(t.userUuidList),[2,this._request.startLive({roomUuid:this._roomUuid,data:{title:t.title,liveLayout:t.liveLayout,liveChatRoomIndependent:!1,liveAVRoomUids:r,password:t.password,extensionConfig:t.extensionConfig}}).then((function(e){var r=n._getUuidListByRtcUidList(e.liveAVRoomUids),i={taskId:e.taskId,pushUrl:e.pushUrl,chatRoomId:e.chatRoomId,pullHttpUrl:e.pullHttpUrl,pullRtmpUrl:e.pullRtmpUrl,pullRtsUrl:e.pullRtsUrl,pullHlsUrl:e.pullHlsUrl,title:e.title,liveLayout:e.liveLayout,password:t.password,userUuidList:r,state:G.INVALID,extensionConfig:e.extensionConfig};return n.setLiveInfo(i),J(i)})).catch((function(e){return W(e)}))]}))}))},e.prototype.stopLive=function(){return h(this,void 0,void 0,(function(){return d(this,(function(t){return this.logger.tracking("userAction",e.TAG_NAME,{method:"stopLive"}),[2,this._request.endLive({roomUuid:this._roomUuid}).then((function(e){return J(null)})).catch((function(e){return W(e)}))]}))}))},e.prototype.updateLive=function(t){return h(this,void 0,void 0,(function(){var r,n=this;return d(this,(function(i){return this.logger.tracking("userAction",e.TAG_NAME,{method:"updateLive"}),r=this._getRtcUidListByUuidList(t.userUuidList),[2,this._request.updateLive({roomUuid:this._roomUuid,data:{title:t.title,liveLayout:t.liveLayout,password:t.password,liveAVRoomUids:r,extensionConfig:t.extensionConfig||""}}).then((function(e){var r=n._getUuidListByRtcUidList(e.liveAVRoomUids);return J({taskId:e.taskId,pushUrl:e.pushUrl,chatRoomId:e.chatRoomId,pullHttpUrl:e.pullHttpUrl,pullRtmpUrl:e.pullRtmpUrl,pullRtsUrl:e.pullRtsUrl,pullHlsUrl:e.pullHlsUrl,title:e.title,liveLayout:e.liveLayout,password:t.password,userUuidList:r,state:G.INVALID,extensionConfig:e.extensionConfig})})).catch((function(e){return W(e)}))]}))}))},e.prototype.addLiveStreamTask=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return[2,this._rtcController.addLiveStreamTask(e).then((function(){return J(null)})).catch((function(e){return W(e)}))]}))}))},e.prototype.removeLiveStreamTask=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return[2,this._rtcController.removeLiveStreamTask(e).then((function(){return J(null)})).catch((function(e){return W(e)}))]}))}))},e.prototype.updateLiveStreamTask=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return[2,this._rtcController.updateLiveStreamTask(e).then((function(){return J(null)})).catch((function(e){return W(e)}))]}))}))},e.prototype._getUuidListByRtcUidList=function(e){var t=this,r=[];return e&&Array.isArray(e)&&e.forEach((function(e){var n=t._rtcController._getUuidByRtcUid(String(e));r.push(n)})),r},e.prototype._getRtcUidListByUuidList=function(e){var t=this,r=[];return e&&Array.isArray(e)&&e.forEach((function(e){var n=t._rtcController._getRtcUidByUuid(e);n&&r.push(n)})),r},e.prototype._parseRoomPropertiesLive=function(e){var t={liveLayout:e.liveLayout,state:e.state,extensionConfig:e.extensionConfig,pushUrl:e.pushUrl,pullHttpUrl:e.pullHttpUrl,pullRtmpUrl:e.pullRtmpUrl,pullRtsUrl:e.pullRtsUrl,pullHlsUrl:e.pullHlsUrl,title:e.title,password:e.password};if(e.extensionConfig)try{var r=JSON.parse(e.extensionConfig);r.listUids&&(t.userUuidList=r.listUids)}catch(e){console.warn("extensionConfig parse error")}return t},e.TAG_NAME="NERoomLiveController",e}(),te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.roomName="",t.roomUuid="",t.userName="",t.appKey="",t.isRoomLocked=!1,t._sequence=0,t._listeners={},t._rtcStatsListeners={},t._screenSharingUserUuid="",t._remoteIsInClientRtcMap=new Map,t._rtcListenerTimer=null,t._isFetching=!1,t._isLeavedRoom=!1,t._deviceId="",t._delayToRequest=!1,t._memberByEntry=null,t._getSequenceInfoCount=0,t._getSequenceInfoTimer=null,t._getSequenceInfoStartTime=0,t._sequenceCache=[],t._controlNotifyListener=function(e){var r=JSON.parse(e.body);if(99!==r.cmd&&"RM"!==r.type&&r.data.roomUuid==t.roomUuid)if(r.sequence-t._sequence>1&&-1!==r.sequence)if(t._joinRoomInfo.eventBuffMillis){if(t._sequenceCachePushAndSort(r),t._getSequenceInfoTimer)return void console.log("正在延迟请求");t._throttleGetSequenceInfo()}else{var n=t._sequence;t._sequenceCache.length>0&&(n=t._sequenceCache[t._sequenceCache.length-1].sequence),t._handleSequenceNotRight(n)}else if(t._listenerHandlesMap[r.cmd]&&t._listenerHandlesMap[r.cmd](r.data),-1!==r.sequence&&(t._sequence=r.sequence),t._sequenceCache.length>0){for(var i=-1,o=0;o<t._sequenceCache.length;o++){var s=t._sequenceCache[o];if(s.sequence-t._sequence>1)break;t._sequence=s.sequence,i=o}if(i>-1){var a=t._sequenceCache.splice(0,i+1);t._handleMergeSequenceInfo(a)}}},t}return u(t,e),t.prototype.initialize=function(e){var r,n,i,o;return h(this,void 0,void 0,(function(){var s,a,c,u,l,p,m,f,h,g,v,y,b,S,T,w;return d(this,(function(d){switch(d.label){case 0:this._logger=e.logger,this._logger.tracking("userAction",t.TAG_NAME,l$1({method:"initialize"},e)),this._request=e.request,this._deviceId=e.deviceId,this._roomInfo=e.snapshotData.snapshot.room,this._joinRoomInfo=e.joinRoomInfo,this._templateConfig=e.templateConfig,this._sequence=e.snapshotData.sequence,this.roomName=e.roomName,this.roomUuid=e.roomUuid,this.appKey=e.appKey,this._logger=e.logger,this._eventEmitter=e.eventEmitter,this.event=e.outEventEmitter,this._im=e.IM,this._roomProperties=e.roomProperties,s=e.member,this._memberByEntry=s,this.userName=s.userName,a=null===(r=e.member)||void 0===r?void 0:r.wbAuth,c=a.checksum,u=a.curTime,l=a.nonce,p=a.wbKey,m=(null===(i=null===(n=e.roomProperties)||void 0===n?void 0:n.chatRoom)||void 0===i?void 0:i.chatRoomId)||"",f=e.roomProperties,h=f.whiteboard,g=f.wbSharingUuid,v=_(this._createRemoteMembers(e.snapshotData.snapshot.members,e.snapshotData.snapshot.room,s.userUuid),2),y=v[0],b=v[1],this._globalEventListener=e.globalEventListener,this._remoteMemberMap=y,this._localMember=b,this._deleteRoomContext=e.deleteRoomContext,d.label=1;case 1:return d.trys.push([1,4,,5]),this._globalEventListener.beforeRtcEngineInitialize?[4,this._globalEventListener.beforeRtcEngineInitialize(this.roomUuid)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[3,5];case 4:return S=d.sent(),this._logger.warn("beforeRtcEngineInitialize error: ",S),[3,5];case 5:this.rtcController=new Q({rtc:e.Rtc,debug:e.debug,setMemberIsInClientRtc:this._setMemberIsInClientRtc.bind(this),channelName:e.roomUuid,enableRecord:e.enableRecord,uid:s.rtcUid,appKey:this.appKey,cid:e.cid,screenSharingUserUuid:this._screenSharingUserUuid,remoteMemberMap:this._remoteMemberMap,token:s.rtcToken,request:e.request,emitter:this._eventEmitter,member:this._localMember,logger:e.logger,privateRtcConfig:e.privateRtcConfig}),d.label=6;case 6:return d.trys.push([6,9,,10]),this._globalEventListener.afterRtcEngineInitialize?[4,this._globalEventListener.afterRtcEngineInitialize(this.roomUuid,{rtcEngine:{client:this.rtcController.rtcClient}})]:[3,8];case 7:d.sent(),d.label=8;case 8:return[3,10];case 9:return T=d.sent(),this._logger.warn("beforeRtcEngineInitialize error: ",T),[3,10];case 10:return this.chatController=new X({chatroom:e.Chatroom,appKey:e.appKey,debug:e.debug,account:s.userUuid,token:this._request.imToken,logger:this._logger,emitter:this._eventEmitter,chatroomId:m,chatroomNick:s.userName,isSupported:!!m,notifyTargetTags:JSON.stringify({tag:".*",matchType:"regex"})}),this.whiteboardController=new z({debug:e.debug,roomUuid:e.roomUuid,appKey:p||e.appKey,uid:s.rtcUid,checksum:c,nonce:l,curTime:u,record:!1,privateConf:e.privateWhiteboardConfig,isSupported:!!(null==h?void 0:h.channelName),whiteboard:e.Whiteboard,wbSharingUserUuid:g?g.value:"",toolCollection:e.toolCollection,request:e.request,logger:this._logger,roomWhiteboard:h,localMember:this._localMember}),this.liveController=new ee({debug:e.debug,roomUuid:e.roomUuid,request:e.request,logger:e.logger,rtcController:this.rtcController,isSupported:!!(null===(o=e.roomProperties.live)||void 0===o?void 0:o.pushUrl)}),(w=e.roomProperties.live)&&(w.password=w.password?w.password:e.joinRoomInfo.livePassword,this.liveController.setLiveInfoFromRoomPropertiesLive(w)),this._initListener(),[2]}}))}))},Object.defineProperty(t.prototype,"remoteMembers",{get:function(){return JSON.parse(JSON.stringify(this._membersMap2List()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rtcStartTime",{get:function(){var e;return(null===(e=this._roomProperties)||void 0===e?void 0:e.rtc)?this._roomProperties.rtc.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localMember",{get:function(){return JSON.parse(JSON.stringify(this._localMember))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roomProperties",{get:function(){return JSON.parse(JSON.stringify(this._roomProperties))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sipCid",{get:function(){var e;return null===(e=this._roomProperties.sip)||void 0===e?void 0:e.sipCid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remainingSeconds",{get:function(){return this._joinRoomInfo.remainingSeconds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"password",{get:function(){return this._joinRoomInfo.password},enumerable:!1,configurable:!0}),t.prototype.addRoomListener=function(e){this._listeners=e||{}},t.prototype.on=function(e,t){t&&this.event.on(e,t)},t.prototype.off=function(e,t){t?this.event.off(e,t):this.event.off(e)},t.prototype.changeMemberRole=function(e,r){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:this._logger.tracking("userAction",t.TAG_NAME,{method:"changeMemberRole",roomUuid:this.roomUuid,userUuid:e,role:r}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._request.updateMemberInfoApi({roomUuid:this.roomUuid,userUuid:e,data:{role:r}})];case 2:return n.sent(),[2,J(null)];case 3:return[2,W(n.sent())];case 4:return[2]}}))}))},t.prototype.changeMyName=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:this._logger.tracking("userAction",t.TAG_NAME,{method:"changeMyName",roomUuid:this.roomUuid,name:e}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.updateMemberInfoApi({roomUuid:this.roomUuid,userUuid:this._localMember.uuid,data:{userName:e}})];case 2:r.sent();try{this.chatController&&this.chatController.updateMyChatroomMemberInfo({member:{nick:e},needNotify:!0})}catch(e){this._logger.log("change chatroom name error",e)}return[2,J(null)];case 3:return[2,W(r.sent())];case 4:return[2]}}))}))},t.prototype.handOverMyRole=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:if(this._logger.tracking("userAction",t.TAG_NAME,{method:"handOverMyRole",roomUuid:this.roomUuid,userUuid:e}),!e)return[2,W(null,"userUuid is required")];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.handOverRoleApi({roomUuid:this.roomUuid,userUuid:e})];case 2:return r.sent(),[2,J(null)];case 3:return[2,W(r.sent())];case 4:return[2]}}))}))},t.prototype.changeMemberNickname=function(e,r){return h(this,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:this._logger.tracking("userAction",t.TAG_NAME,{method:"changeMemberNickname",roomUuid:this.roomUuid,userUuid:e,nickname:r}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._request.updateMemberInfoApi({roomUuid:this.roomUuid,userUuid:e,data:{userName:r}})];case 2:if(n.sent(),e===this._localMember.uuid)try{this.chatController&&this.chatController.updateMyChatroomMemberInfo({member:{nick:r},needNotify:!0})}catch(e){this._logger.log("change chatroom name error",e)}return[2,J(null)];case 3:return[2,W(n.sent())];case 4:return[2]}}))}))},t.prototype.endRoom=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:this._logger.tracking("userAction",t.TAG_NAME,{method:"endRoom"}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._request.endRoomApi(this.roomUuid)];case 2:return e.sent(),[2,J(null)];case 3:return[2,W(e.sent())];case 4:return[2]}}))}))},t.prototype.kickMemberOut=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(r){return e?(this._logger.tracking("userAction",t.TAG_NAME,{method:"kickMemberOut",userUuid:e}),[2,this._request.removeOrLeaveRoomApi({roomUuid:this.roomUuid,userUuid:e}).then((function(e){return J(null)})).catch((function(e){return W(e)}))]):[2,W(null,T.NO_UUID)]}))}))},t.prototype.leaveRoom=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:this._logger.tracking("userAction",t.TAG_NAME,{method:"leaveRoom"}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._request.removeOrLeaveRoomApi({roomUuid:this.roomUuid,userUuid:this._localMember.uuid})];case 2:return r.sent(),[2,J(null)];case 3:return e=r.sent(),this.destroy(),[2,W(e)];case 4:return[2]}}))}))},t.prototype.destroy=function(){var e,r,n,i;return h(this,void 0,void 0,(function(){var o;return d(this,(function(s){switch(s.label){case 0:this._logger.log(t.TAG_NAME,"开始销毁"),s.label=1;case 1:s.trys.push([1,11,,12]),this._isLeavedRoom=!0,this._im.off("controlNotify",this._controlNotifyListener),this._im.off("imDisconnect"),this._eventEmitter.off(N.CONNECTION_STATE_CHANGE),this._eventEmitter.off(N.ERROR),this._eventEmitter.off(N.MINIAPP_STREAM_CHANGED),this._eventEmitter.off(N.VOLUME_INDICATOR),this._eventEmitter.off(N.ACTIVE_SPEAKER),this._eventEmitter.off(N.CAMERA_DEVICE_CHANGE),this._eventEmitter.off(N.SPEAKER_DEVICE_CHANGE),this._eventEmitter.off(N.RECORD_DEVICES_CHANGE),this._eventEmitter.off(N.NETWORK_QUALITY),this._eventEmitter.off(N.NOTALLOWEDERROR),this._eventEmitter.off(g.SYNC_DATA_DONE),this._eventEmitter.off(g.SYNC_DATA_ERROR),this._eventEmitter.off(I.CHATROOM_MESSAGE_RECEIVE),this._eventEmitter.off(I.CHATROOM_FILE_UPLOAD_PROGRESS),this.event.removeAllListeners(),this.removeRoomListener(),this.removeRtcStatsListener(),this._request.setCrossAppAuthorization(null),s.label=2;case 2:return s.trys.push([2,5,,6]),this._globalEventListener.beforeRtcEngineRelease?[4,this._globalEventListener.beforeRtcEngineRelease(this.roomUuid,{rtcEngine:{client:this.rtcController.rtcClient}})]:[3,4];case 3:s.sent(),s.label=4;case 4:return[3,6];case 5:return o=s.sent(),this._logger.warn("执行beforeRtcEngineRelease错误",o),[3,6];case 6:return[4,null===(e=this.rtcController)||void 0===e?void 0:e.destroy()];case 7:return s.sent(),this.rtcController=null,[4,null===(r=this.chatController)||void 0===r?void 0:r.destroy()];case 8:return s.sent(),this.chatController=null,(null===(n=this.whiteboardController)||void 0===n?void 0:n.isJoinedWhiteboard)?[4,null===(i=this.whiteboardController)||void 0===i?void 0:i.destroy()]:[3,10];case 9:s.sent(),s.label=10;case 10:return this.whiteboardController=null,this._remoteMemberMap.clear(),this._localMember=this._resetMember(),this._sequence=0,this.roomName="",this.userName="",this.appKey="",this._getSequenceInfoStartTime=0,this._getSequenceInfoCount=0,this._isFetching=!1,this._deleteRoomContext(this.roomUuid),this.roomUuid="",[2,J(null)];case 11:return[2,W(s.sent())];case 12:return[2]}}))}))},t.prototype.removeRoomListener=function(e){var t=this;e?Object.keys(e).forEach((function(e){t._listeners[e]&&delete t._listeners[e]})):this._listeners={},this.event.removeAllListeners()},t.prototype.updateRoomProperty=function(e,r,n){return h(this,void 0,void 0,(function(){var i;return d(this,(function(o){switch(o.label){case 0:this._logger.tracking("userAction",t.TAG_NAME,{method:"updateRoomProperty",value:r,associatedUserUuid:n}),i=r,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._request.updateRoomPropertiesApi({roomUuid:this.roomUuid,propertyKey:e,associatedUuid:n,data:!i.value&&""!=i.value||1!==Object.keys(i).length?{value:i}:i})];case 2:return[2,J(o.sent())];case 3:return[2,W(o.sent())];case 4:return[2]}}))}))},t.prototype.deleteRoomProperty=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._request.deleteRoomPropertyApi({roomUuid:this.roomUuid,propertyKey:e})];case 1:return[2,J(t.sent())];case 2:return[2,W(t.sent())];case 3:return[2]}}))}))},t.prototype.updateMemberProperty=function(e,r,n){return h(this,void 0,void 0,(function(){var i;return d(this,(function(o){switch(o.label){case 0:this._logger.tracking("userAction",t.TAG_NAME,{method:"updateRoomProperty",key:r,value:n});try{i=JSON.parse(n)}catch(e){i=n}o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._request.updateMemberPropertiesApi({userUuid:e,roomUuid:this.roomUuid,propertyKey:r,value:!i.value&&""!=i.value||1!==Object.keys(i).length?{value:i}:i})];case 2:return o.sent(),[2,J(null)];case 3:return[2,W(o.sent())];case 4:return[2]}}))}))},t.prototype.deleteMemberProperty=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._request.deleteMemberPropertyApi({userUuid:e,roomUuid:this.roomUuid,propertyKey:t})];case 1:return[2,J(r.sent())];case 2:return[2,W(r.sent())];case 3:return[2]}}))}))},t.prototype.lockRoom=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this._changeRoomLockState(y.OPEN)]}))}))},t.prototype.unlockRoom=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return[2,this._changeRoomLockState(y.CLOSE)]}))}))},t.prototype.getMember=function(e){return e?this._localMember.uuid===e?this.localMember:this._remoteMemberMap.get(e)||null:null},t.prototype.addRtcStatsListener=function(e){var t=this;this._rtcStatsListeners=e||{},this._rtcListenerTimer&&(clearInterval(this._rtcListenerTimer),this._rtcListenerTimer=null),this._rtcListenerTimer=setInterval((function(){return h(t,void 0,void 0,(function(){var e=this;return d(this,(function(t){return this.rtcController.getSessionStats().then((function(t){return h(e,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:e={},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.rtcController.getTransportStats()];case 2:return e=r.sent(),[3,4];case 3:return r.sent(),[3,4];case 4:return t=l$1(l$1({},t),e),this._rtcStatsListeners.onRtcStats&&this._rtcStatsListeners.onRtcStats(t),[2]}}))}))})),this.rtcController.getLocalAudioStats().then((function(t){e._rtcStatsListeners.onLocalAudioStats&&e._rtcStatsListeners.onLocalAudioStats(t)})),this.rtcController.getLocalVideoStats().then((function(t){e._rtcStatsListeners.onLocalVideoStats&&e._rtcStatsListeners.onLocalVideoStats(t)})),this.rtcController.getRemoteAudioStats().then((function(t){e._rtcStatsListeners.onRemoteAudioStats&&e._rtcStatsListeners.onRemoteAudioStats(t)})),this.rtcController.getRemoteVideoStats().then((function(t){e._rtcStatsListeners.onRemoteVideoStats&&e._rtcStatsListeners.onRemoteVideoStats(t)})),[2]}))}))}),2e3)},t.prototype.removeRtcStatsListener=function(e){this._rtcStatsListeners={},this._rtcListenerTimer&&(clearInterval(this._rtcListenerTimer),this._rtcListenerTimer=null)},t.prototype._createRemoteMembers=function(e,t,r){var n=this,i=new Map;e.forEach((function(e){e.streams.subVideo&&1===e.streams.subVideo.value&&(n._screenSharingUserUuid=e.userUuid),i.set(e.userUuid,n._createMember(e,t))}));var o=i.get(r);return!o&&this._memberByEntry&&(o=this._createMember(this._memberByEntry,t)),i.delete(r),[i,o]},t.prototype._createMember=function(e,t){var r,n,i,o,s="";t.properties.wbSharingUuid&&t.properties.wbSharingUuid.value&&(s=t.properties.wbSharingUuid.value);var a=Boolean(e.streams.subVideo&&1===e.streams.subVideo.value),c={};this._localMember&&e.userUuid===this._localMember.uuid?c=this._localMember:this._remoteMemberMap&&this._remoteMemberMap.has(e.userUuid)&&(c=this._remoteMemberMap.get(e.userUuid));var u=Z(e.role,this._templateConfig);return l$1(l$1({},c),{isAudioOn:Boolean(e.streams.audio&&1===e.streams.audio.value),avatar:e.userIcon,isInChatroom:Boolean((null===(r=e.properties)||void 0===r?void 0:r.states.chatroomState)&&2===(null===(n=e.properties)||void 0===n?void 0:n.states.chatroomState)),isInRtcChannel:Boolean((null===(i=e.properties)||void 0===i?void 0:i.states.rtcState)&&2===(null===(o=e.properties)||void 0===o?void 0:o.states.rtcState)),isSharingScreen:a,isVideoOn:Boolean(e.streams.video&&1===e.streams.video.value),isSharingWhiteboard:Boolean(!!s&&s===e.userUuid),name:e.userName,rtcUid:e.rtcUid,properties:e.properties,role:u,uuid:e.userUuid,clientType:e.clientType,rtcRole:e.rtcRole,hide:!!u.hide})},t.prototype._changeRoomLockState=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._request.updateRoomPropertiesApi({roomUuid:this.roomUuid,propertyKey:"lock",data:{value:e}})];case 1:return[2,J(t.sent())];case 2:return[2,W(t.sent())];case 3:return[2]}}))}))},t.prototype._membersMap2List=function(){var e,t,r=[];try{for(var n=m(this._remoteMemberMap.values()),i=n.next();!i.done;i=n.next()){var o=i.value;r.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},t.prototype._addInnerListeners=function(){var e=this;this._eventEmitter.on(N.CONNECTION_STATE_CHANGE,(function(t){return h(e,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:if("CONNECTED"!==t.curState||"CONNECTING"!==t.prevState||!t.reconnect)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),this.rtcController.muteMyAudioTimer||this.rtcController.muteMyVideoTimer?(this._delayToRequest=!0,[2]):[4,this._handleSequenceNotRight(-1)];case 2:return r.sent(),[3,4];case 3:return 1004===(e=r.sent()).code||1021===e.code?(this._listeners.onRoomEnded&&this._listeners.onRoomEnded(b.LEAVE_BY_SELF),this.destroy(),[2]):[3,4];case 4:return!this._isLeavedRoom&&this._listeners.onRoomConnectStateChanged&&this._listeners.onRoomConnectStateChanged(t),[2]}}))}))})),this._eventEmitter.on(N.ERROR,(function(t){return h(e,void 0,void 0,(function(){return d(this,(function(e){return this._listeners.onRtcChannelError&&this._listeners.onRtcChannelError(t),[2]}))}))})),this._eventEmitter.on(N.ABILITY_NOT_SUPPORT,(function(t){return h(e,void 0,void 0,(function(){return d(this,(function(e){return this._listeners.onRtcAbilityNotSupport&&this._listeners.onRtcAbilityNotSupport(t),[2]}))}))})),this._eventEmitter.on(N.MINIAPP_STREAM_CHANGED,(function(t){return h(e,void 0,void 0,(function(){var e,r,n;return d(this,(function(i){return this._logger.log("MINIAPP_STREAM_CHANGED ",t),e=_(this._getMember(t.uuid),2),r=e[0],n=e[1],r?(this._setMember(r,n),this._listeners.onMemberStreamChanged&&this._listeners.onMemberStreamChanged(t),[2]):(this._logger.error("not found member ".concat(t.uuid)),[2])}))}))})),this._eventEmitter.on(N.VOLUME_INDICATOR,(function(t){e._listeners.onRtcRemoteAudioVolumeIndication&&e._listeners.onRtcRemoteAudioVolumeIndication(t)})),this._eventEmitter.on(N.ACTIVE_SPEAKER,(function(t){e._listeners.onRtcActiveSpeakerChanged&&e._listeners.onRtcActiveSpeakerChanged(t)})),this._eventEmitter.on(N.CAMERA_DEVICE_CHANGE,(function(t){e._listeners.onCameraDeviceChanged&&e._listeners.onCameraDeviceChanged(t)})),this._eventEmitter.on(N.SPEAKER_DEVICE_CHANGE,(function(t){e._listeners.onPlayoutDeviceChanged&&e._listeners.onPlayoutDeviceChanged(t)})),this._eventEmitter.on(N.RECORD_DEVICES_CHANGE,(function(t){e._listeners.onRecordDeviceChanged&&e._listeners.onRecordDeviceChanged(t)})),this._eventEmitter.on(N.NETWORK_QUALITY,(function(t){e._rtcStatsListeners.onNetworkQuality&&e._rtcStatsListeners.onNetworkQuality(t)})),this._eventEmitter.on(I.CHATROOM_MESSAGE_RECEIVE,(function(t){e._listeners.onReceiveChatroomMessages&&e._listeners.onReceiveChatroomMessages(t),e.event.emit("onReceiveChatroomMessages",t)})),this._eventEmitter.on(N.NETWORK_QUALITY,(function(t){e._listeners.onRtcNetworkQuality&&e._listeners.onRtcNetworkQuality(t),e.event.emit("onRtcNetworkQuality",t)})),this._eventEmitter.on(N.NOTALLOWEDERROR,(function(t){e._listeners.onAutoPlayNotAllowed&&e._listeners.onAutoPlayNotAllowed(t),e.event.emit("onAutoPlayNotAllowed",t)})),this._eventEmitter.on(I.CHATROOM_FILE_UPLOAD_PROGRESS,(function(t){var r=t.messageUuid,n=t.transferred,i=t.total;e._listeners.onChatroomMessageAttachmentProgress&&e._listeners.onChatroomMessageAttachmentProgress(r,n,i),e.event.emit("onChatroomMessageAttachmentProgress",r,n,i)})),this._eventEmitter.on(N.START_SCREEN_AUDIO,(function(t){e._listeners.onRtcUserAudioSubStreamStart&&e._listeners.onRtcUserAudioSubStreamStart(t.userUuid),e.event.emit("onRtcUserAudioSubStreamStart",t.userUuid)})),this._eventEmitter.on(N.STOP_SCREEN_AUDIO,(function(t){e._listeners.onRtcUserAudioSubStreamStop&&e._listeners.onRtcUserAudioSubStreamStop(t.userUuid),e.event.emit("onRtcUserAudioSubStreamStop",t.userUuid)})),this._eventEmitter.on(N.VIDEO_TRACK_ENDED,(function(){e._listeners.onRtcVideoTrackEnded&&e._listeners.onRtcVideoTrackEnded(),e.event.emit("onRtcVideoTrackEnded")})),this._eventEmitter.on(g.SYNC_DATA_DONE,(function(){e._logger.tracking("api",t.TAG_NAME,{method:"sync_data_done",delayToRequest:e._delayToRequest}),e._delayToRequest&&(e._delayToRequest=!1,e._handleSequenceNotRight(-1))})),this._eventEmitter.on(g.SYNC_DATA_ERROR,(function(){return h(e,void 0,void 0,(function(){return d(this,(function(e){return this._logger.tracking("api",t.TAG_NAME,{method:"sync_data_error"}),this._syncDataErrorHandle(),[2]}))}))}))},t.prototype._syncDataErrorHandle=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this._listeners.onRoomEnded&&this._listeners.onRoomEnded(b.SYNC_DATA_ERROR),this.event.emit("onRoomEnded",b.SYNC_DATA_ERROR),[4,this.destroy()];case 1:return e.sent(),[2]}}))}))},t.prototype._createListenerHandlesMap=function(e){var t,r=this;return void 0===e&&(e=!1),(t={})[v.MEMBER_JOIN_ROOM]=function(t){var n=t.members[0];if(n.userUuid!==r._localMember.uuid){var i=r._createMember(n,r._roomInfo);r._remoteMemberMap.set(i.uuid,i),r.rtcController&&r.rtcController.setRemoteMemberMap(r._remoteMemberMap),e||(r._listeners.onMemberJoinRoom&&r._listeners.onMemberJoinRoom([i]),r.event.emit("onMemberJoinRoom",[i]))}},t[v.MEMBER_LEAVE_ROOM]=function(t){return h(r,void 0,void 0,(function(){var r,n,i,o,s,a,c;return d(this,(function(u){switch(u.label){case 0:if(t.roomUuid!=this.roomUuid)return[2];if(r=t.members[0],n=_(this._getMember(r.userUuid),2),i=n[0],o=n[1],i&&this.rtcController&&i.uuid===this.rtcController.getScreenSharingUserUuid()&&this.rtcController.setScreenSharingUserUuid(""),!o)return[3,5];if(i){if(c=l$1(l$1({},i),{reason:r.reason}),this._listeners.onMemberLeaveRoom&&this._listeners.onMemberLeaveRoom([c]),s=b.LEAVE_BY_SELF,this._deviceId!==r.reason.deviceId)return[2];"SELF_KICK"===r.reason.type?s=b.kICK_BY_SELF:"NORMAL"===r.reason.type?s=b.LEAVE_BY_SELF:"ADMIN_KICK"===r.reason.type&&(s=b.KICK_OUT),this._listeners.onRoomEnded&&this._listeners.onRoomEnded(s),this.event.emit("onRoomEnded",s)}return r.rtcUid?[3,2]:[4,this.destroy()];case 1:return u.sent(),[3,4];case 2:return r.rtcUid&&r.rtcUid==this._localMember.rtcUid?(console.warn("用户互踢"),[4,this.destroy()]):[3,4];case 3:u.sent(),u.label=4;case 4:return[3,6];case 5:if((a=this._remoteMemberMap.get(r.userUuid))&&(a.rtcUid?a.rtcUid==r.rtcUid&&this._remoteMemberMap.delete(r.userUuid):this._remoteMemberMap.delete(r.userUuid)),this.rtcController&&this.rtcController.setRemoteMemberMap(this._remoteMemberMap),i&&(c=l$1(l$1({},i),{reason:r.reason}),!a||a.rtcUid==r.rtcUid)){if(e)return[2];this._listeners.onMemberLeaveRoom&&this._listeners.onMemberLeaveRoom([c]),this.event.emit("onMemberLeaveRoom",[c])}u.label=6;case 6:return[2]}}))}))},t[v.ROOM_REMAINING_CHANGED]=function(e){return h(r,void 0,void 0,(function(){var t;return d(this,(function(r){return e.roomUuid!==this.roomUuid||(t=e.remainingSeconds||-1,this._joinRoomInfo.remainingSeconds=t,this._listeners.onRoomRemainingSecondsRenewed&&this._listeners.onRoomRemainingSecondsRenewed(t),this.event.emit("onRoomRemainingSecondsRenewed",t)),[2]}))}))},t[v.ROOM_ENDED]=function(e){return h(r,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return e.roomUuid!==this.roomUuid?[2]:(this._listeners.onRoomEnded&&this._listeners.onRoomEnded(b[e.reason]),this.event.emit("onRoomEnded",b[e.reason]),[4,this.destroy()]);case 1:return t.sent(),[2]}}))}))},t[v.MEMBER_ROLE_TYPE_CHANGED]=function(t){var n=t.member,i=Z(t.role,r._templateConfig),o=_(r._getMember(n.userUuid),2),s=o[0],a=o[1];if(s){var c=s.role;s.role=i,r._setMember(s,a),a&&r._handlePermissionByRoleChanged(i.name),e||(r._listeners.onMemberRoleChanged&&r._listeners.onMemberRoleChanged(s,c,i),r.event.emit("onMemberRoleChanged",s,c,i))}else r._logger.error("not found member ".concat(n.userUuid))},t[v.MEMBER_JOIN_RTC_ROOM]=function(t){var n=r._createMember(t.members[0],r._roomInfo),i=_(r._getMember(n.uuid),2),o=i[0],s=i[1];if(o){if(n.isInRtcChannel=!0,n._isInServerRtc=!0,o=l$1(l$1({},o),n),r._setMember(o,s),o.rtcUid&&r._remoteIsInClientRtcMap.get(o.rtcUid)&&o._isInServerRtc){if(e)return;r._listeners.onMemberJoinRtcChannel&&r._listeners.onMemberJoinRtcChannel([o]),r.event.emit("onMemberJoinRtcChannel",[o])}}else r._logger.error("not found member ".concat(n.uuid))},t[v.MEMBER_LEAVE_RTC_ROOM]=function(t){var n=t.members[0],i=_(r._getMember(n.userUuid),2),o=i[0],s=i[1];o?(o.isInRtcChannel=!1,o._isInServerRtc=!1,!o.rtcUid||r._remoteIsInClientRtcMap.get(o.rtcUid)||o.isInRtcChannel||(o.rtcUid=0,e||(r._listeners.onMemberLeaveRtcChannel&&r._listeners.onMemberLeaveRtcChannel([o]),r.event.emit("onMemberLeaveRtcChannel",[o]))),r._setMember(o,s)):console.warn("member ".concat(n.userUuid," not in RtcChannel"))},t[v.MEMBER_NICKNAME_CHANGED]=function(t){var n=t.member,i=_(r._getMember(n.userUuid),2),o=i[0],s=i[1];o?(o.name=n.userName,r._setMember(o,s),e||(r._listeners.onMemberNameChanged&&r._listeners.onMemberNameChanged(o,o.name),r.event.emit("onMemberNameChanged",o,o.name))):r._logger.error("MEMBER_NICKNAME_CHANGED not found member ".concat(n.userUuid))},t[v.MEMBER_PROPERTIES_CHANGED]=function(t){var n=t.member,i=_(r._getMember(n.userUuid),2),o=i[0],s=i[1];o?_(r._getMember(t.operatorMember.userUuid),1)[0]?(o.properties=l$1(l$1({},o.properties),t.properties),r._setMember(o,s),e||(r._listeners.onMemberPropertiesChanged&&r._listeners.onMemberPropertiesChanged(o,t.properties),r.event.emit("onMemberPropertiesChanged",o,t.properties))):r._logger.error("not found operatorMember ".concat(t.operatorMember.userUuid)):r._logger.error("MEMBER_PROPERTIES_CHANGED not found member ".concat(n.userUuid))},t[v.MEMBER_PROPERTIES_DELETE]=function(t){var n,i,o=t.member,s=_(r._getMember(o.userUuid),2),a=s[0],c=s[1];if(a){var u=a.properties[t.key];if(delete a.properties[t.key],"whiteboard"===t.key){if(!_(r._getMember(t.operatorMember.userUuid),1)[0])return void r._logger.error("not found operatorMember ".concat(t.operatorMember.userUuid));r._logger.log("成员白板属性删除 "),a.isSharingWhiteboard=!1}r._setMember(a,c),e||(r._listeners.onMemberPropertiesDeleted&&r._listeners.onMemberPropertiesDeleted(a.uuid,((n={})[t.key]=u,n)),r.event.emit("onMemberPropertiesDeleted",a.uuid,((i={})[t.key]=u,i)))}else r._logger.error("MEMBER_PROPERTIES_DELETE not found member ".concat(o.userUuid))},t[v.MEMBER_STREAM_STATE_CHANGED]=function(t){return h(r,void 0,void 0,(function(){var r,n,i,o,s,a,c;return d(this,(function(u){if(r=t.streams,n=t.member,i=_(this._getMember(t.operatorMember.userUuid),1),o=i[0],s=_(this._getMember(n.userUuid),2),a=s[0],c=s[1],!a)return this._logger.error("MEMBER_STREAM_STATE_CHANGED not found member ".concat(n.userUuid)),[2];if(!o)return this._logger.error("not found operatorMember ".concat(t.operatorMember.userUuid)),[2];if(r.video){if(a.isVideoOn=1===r.video.value,this._setMember(a,c),c&&o.uuid!==a.uuid&&this.rtcController&&this.rtcController.operateStream("video",a.isVideoOn),e)return[2];this._listeners.onMemberVideoMuteChanged&&this._listeners.onMemberVideoMuteChanged(a,!a.isVideoOn,o),this.event.emit("onMemberVideoMuteChanged",a,!a.isVideoOn,o)}else if(r.audio){if(a.isAudioOn=1===r.audio.value,this._setMember(a,c),c&&o.uuid!==a.uuid&&this.rtcController&&this.rtcController.operateStream("audio",a.isAudioOn),e)return[2];this._listeners.onMemberAudioMuteChanged&&this._listeners.onMemberAudioMuteChanged(a,!a.isAudioOn,o),this.event.emit("onMemberAudioMuteChanged",a,!a.isAudioOn,o)}else if(r.subVideo){if(!o)return this._logger.error("not found operatorMember ".concat(t.operatorMember.userUuid)),[2];if(a.isSharingScreen=1===r.subVideo.value,this._setMember(a,c),c&&o.uuid!==a.uuid&&a.isSharingScreen&&this.rtcController&&this.rtcController.operateStream("screen",a.isSharingScreen),this.rtcController&&this.rtcController.setScreenSharingUserUuid(a.isSharingScreen?a.uuid:""),e)return[2];this._listeners.onMemberScreenShareStateChanged&&this._listeners.onMemberScreenShareStateChanged(a,a.isSharingScreen,o),this.event.emit("onMemberScreenShareStateChanged",a,a.isSharingScreen,o)}return[2]}))}))},t[v.MEMBER_STREAM_STATE_DELETE]=function(t){return h(r,void 0,void 0,(function(){var r,n,i,o,s,a;return d(this,(function(c){if(r=t.member,n=_(this._getMember(r.userUuid),2),i=n[0],o=n[1],s=_(this._getMember(t.operatorMember.userUuid),1),a=s[0],!i)return this._logger.error("MEMBER_STREAM_STATE_DELETE not found member ".concat(r.userUuid,", ")),[2];if(!a)return this._logger.error("not found operatorMember ".concat(t.operatorMember.userUuid)),[2];if("video"===t.streamType)i.isVideoOn=!1,e||(this._listeners.onMemberVideoMuteChanged&&this._listeners.onMemberVideoMuteChanged(i,!0,a),this.event.emit("onMemberVideoMuteChanged",i,!0,a)),o&&a.uuid!==i.uuid&&this.rtcController&&this.rtcController.operateStream("video",!1);else if("audio"===t.streamType)i.isAudioOn=!1,e||(this._listeners.onMemberAudioMuteChanged&&this._listeners.onMemberAudioMuteChanged(i,!0,a),this.event.emit("onMemberAudioMuteChanged",i,!0,a)),o&&a.uuid!==i.uuid&&this.rtcController&&this.rtcController.operateStream("audio",!1);else if("subVideo"===t.streamType){if(!a)return this._logger.error("not found operatorMember ".concat(t.operatorMember.userUuid)),[2];o&&a.uuid!==i.uuid&&this.rtcController&&this.rtcController.operateStream("screen",!1),i.isSharingScreen=!1,this.rtcController&&this.rtcController.setScreenSharingUserUuid(""),e||(this._listeners.onMemberScreenShareStateChanged&&this._listeners.onMemberScreenShareStateChanged(i,!1,a),this.event.emit("onMemberScreenShareStateChanged",i,!1,a))}return this._setMember(i,o),[2]}))}))},t[v.MEMBER_STREAM_STATE_INIT]=function(t){var n=t.member;if(t.roomUuid===r.roomUuid){var i=_(r._getMember(n.userUuid),2),o=i[0],s=i[1];o?(o.isAudioOn&&(o.isAudioOn=!1,e||(r._listeners.onMemberAudioMuteChanged&&r._listeners.onMemberAudioMuteChanged(o,!0,o),r.event.emit("onMemberAudioMuteChanged",o,!0,o))),o.isVideoOn&&(o.isVideoOn=!1,e||(r._listeners.onMemberVideoMuteChanged&&r._listeners.onMemberVideoMuteChanged(o,!0,o),r.event.emit("onMemberVideoMuteChanged",o,!0,o))),o.isSharingScreen&&(o.isSharingScreen=!1,r.rtcController&&r.rtcController.setScreenSharingUserUuid(""),e||(r._listeners.onMemberScreenShareStateChanged&&r._listeners.onMemberScreenShareStateChanged(o,!1,o),r.event.emit("onMemberScreenShareStateChanged",o,!1,o))),r._setMember(o,s)):r._logger.error("MEMBER_STREAM_STATE_INIT not found member ".concat(n.userUuid))}},t[v.ROOM_PROPERTIES_CHANGED]=function(t){var n;if(t.properties){var i=t.properties;r._roomInfo.properties=l$1(l$1({},r._roomInfo.properties),i),r._roomProperties=l$1(l$1({},r._roomProperties),i);var o=i.wbSharingUuid;if(o){r._logger.log("房间白板属性变更 ",o);var s=o.value,a=_(r._getMember(s),2),c=a[0],u=a[1];if(!c)return void r._logger.error("ROOM_PROPERTIES_CHANGED not found member ".concat(s));var l=_(r._getMember(t.operatorMember.userUuid),1)[0];if(!l)return void r._logger.error("not found operatorMember ".concat(t.operatorMember.userUuid));c.isSharingWhiteboard=c.uuid===s,null===(n=r.whiteboardController)||void 0===n||n.setWhiteboardNeedInfo(s),r._setMember(c,u),e||(r._listeners.onMemberWhiteboardStateChanged&&r._listeners.onMemberWhiteboardStateChanged(l$1({},c),c.isSharingWhiteboard,l),r.event.emit("onMemberWhiteboardStateChanged",l$1({},c),c.isSharingWhiteboard,l))}else i.lock?(r._logger.log("房间锁定状态变更",i),r.isRoomLocked=1===i.lock.value,e||(r._listeners.onRoomLockStateChanged&&r._listeners.onRoomLockStateChanged(r.isRoomLocked),r.event.emit("onRoomLockStateChanged",r.isRoomLocked))):(r._logger.log("房间属性变更",i),e||(r._listeners.onRoomPropertiesChanged&&r._listeners.onRoomPropertiesChanged(i),r.event.emit("onRoomPropertiesChanged",i)))}},t[v.ROOM_PROPERTIES_DELETE]=function(t){var n,i,o,s=r._roomProperties[t.key];if(s&&"wbSharingUuid"===t.key){r._logger.log("房间白板属性删除",s);var a=_(r._getMember(s.value),2),c=a[0],u=a[1],l=_(r._getMember(t.operatorMember.userUuid),1)[0];c||l?c&&(c.isSharingWhiteboard=!1,r._setMember(c,u)):(r._logger.warn("ROOM_PROPERTIES_DELETE not found member ".concat(s.value)),r._logger.warn("not found operatorMember ".concat(t.operatorMember.userUuid))),e||(r._listeners.onMemberWhiteboardStateChanged&&r._listeners.onMemberWhiteboardStateChanged(c,!1,l),r.event.emit("onMemberWhiteboardStateChanged",c,!1,l)),s.value="",null===(o=r.whiteboardController)||void 0===o||o.setWhiteboardNeedInfo("")}var d=r._roomProperties[t.key];delete r._roomInfo.properties[t.key],delete r._roomProperties[t.key],e||(r._listeners.onRoomPropertiesDeleted&&r._listeners.onRoomPropertiesDeleted(((n={})[t.key]=d,n)),r.event.emit("onRoomPropertiesDeleted",((i={})[t.key]=d,i)))},t[v.ROOM_STATE_CHANGED]=function(){},t[v.ROOM_STATE_DELETE]=function(){},t[v.MEMBER_JOIN_CHATROOM_ROOM]=function(t){var n=t.members[0],i=_(r._getMember(n.userUuid),2),o=i[0],s=i[1];o?(o.isInChatroom=!0,r._setMember(o,s),e||(r._listeners.onMemberJoinChatroom&&r._listeners.onMemberJoinChatroom([o]),r.event.emit("onMemberJoinChatroom",[o]))):console.warn("member ".concat(n.userUuid," not in room"))},t[v.MEMBER_LEAVE_CHATROOM_ROOM]=function(t){var n=t.members[0],i=_(r._getMember(n.userUuid),2),o=i[0],s=i[1];o?(o.isInChatroom=!1,r._setMember(o,s),e||(r._listeners.onMemberLeaveChatroom&&r._listeners.onMemberLeaveChatroom([o]),r.event.emit("onMemberLeaveChatroom",[o]))):console.warn("member ".concat(n.userUuid," not in room"))},t[v.ROOM_LIVE_STATE_CHANGED]=function(t){var n=l$1({},t);r.liveController&&(t.liveAVRoomUids&&Array.isArray(t.liveAVRoomUids)&&(n.userUuidList=r.liveController._getUuidListByRtcUidList(t.liveAVRoomUids)),r._roomProperties.live&&(r._roomProperties.live=l$1(l$1({},r._roomProperties.live),n)),r.liveController.setLiveInfo(n)),e||(r._listeners.onRoomLiveStateChanged&&r._listeners.onRoomLiveStateChanged(t.state),r.event.emit("onRoomLiveStateChanged",t.state))},t},t.prototype._setMember=function(e,t){t?(this._localMember=e,this.rtcController&&this.rtcController.setLocalMember(this._localMember)):(this._remoteMemberMap.set(e.uuid,e),this.rtcController&&this.rtcController.setRemoteMemberMap(this._remoteMemberMap))},t.prototype._setMemberIsInClientRtc=function(e,t,r){if(this._logger.log("setMemberIsInClientRtc",e,t,r),this._remoteIsInClientRtcMap.set(t,r),e){var n=_(this._getMember(e),2),i=n[0],o=n[1];this._logger.log("localMember",i),i&&(i.rtcUid=t,r?(i._isInServerRtc||i.isInRtcChannel)&&(i.isInRtcChannel=!0,this._listeners.onMemberJoinRtcChannel&&this._listeners.onMemberJoinRtcChannel([i]),this.event.emit("onMemberJoinRtcChannel",[i])):!1===i._isInServerRtc&&(i.isInRtcChannel=!1,i.rtcUid=0,this._listeners.onMemberLeaveRtcChannel&&this._listeners.onMemberLeaveRtcChannel([i]),this.event.emit("onMemberLeaveRtcChannel",[i])),this._setMember(i,o))}},t.prototype._getMember=function(e){var t,r=!1;return this._localMember&&e===this._localMember.uuid?(t=this._localMember,r=!0):t=this._remoteMemberMap.get(e),t&&(t=JSON.parse(JSON.stringify(t))),[t,r]},t.prototype._initListener=function(){var e=this;this._listenerHandlesMap=this._createListenerHandlesMap(),this._listenerHandlesNotNotifyMap=this._createListenerHandlesMap(!0),this._logger.log("initListener"),this._im.on("imDisconnect",(function(t){return h(e,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return"kicked"!==t.code?[3,2]:(this._listeners.onRoomEnded&&this._listeners.onRoomEnded(b.kICK_BY_SELF),this.event.emit("onRoomEnded",b.kICK_BY_SELF),[4,this.destroy()]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))})),this._im.on("imConnect",(function(t){return h(e,void 0,void 0,(function(){return d(this,(function(e){return this._isFetching||this._handleSequenceNotRight(-2),[2]}))}))})),this._im.on("controlNotify",this._controlNotifyListener),this._addInnerListeners()},t.prototype._throttleGetSequenceInfo=function(){return h(this,void 0,void 0,(function(){var e=this;return d(this,(function(t){return this._isFetching||this._getSequenceInfoTimer?(console.warn("正在请求中",this._isFetching,this._getSequenceInfoStartTime),[2]):(this._getSequenceInfoTimer=setTimeout((function(){return h(e,void 0,void 0,(function(){var e;return d(this,(function(t){return console.warn("_getSequenceInfoTimer 开始执行延迟请求",this._sequenceCache),this._getSequenceInfoTimer=null,this._sequenceCache.length>0&&(e=this._sequenceCache[this._sequenceCache.length-1].sequence,this._handleSequenceNotRight(e)),[2]}))}))}),this._joinRoomInfo.eventBuffMillis||0),[2])}))}))},t.prototype._handleMergeSequenceInfo=function(e){var t=this,r=JSON.parse(JSON.stringify(this._roomInfo));r.remainingSeconds=this._joinRoomInfo.remainingSeconds;var n=JSON.parse(JSON.stringify(this._roomProperties)),i=function(e){var t,r,n=new Map,i=e.entries();try{for(var o=m(i),s=o.next();!s.done;s=o.next()){var a=_(s.value,2),c=a[0],u=a[1];try{n.set(c,JSON.parse(JSON.stringify(u)))}catch(e){console.warn("deepCloneMap error: ",e)}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n}(this._remoteMemberMap),o=JSON.parse(JSON.stringify(this._localMember));e.forEach((function(e){if(e.cmd===v.ROOM_REMAINING_CHANGED){var r=0;e.ts&&(r=e.timestamp?e.ts-e.timestamp:e.ts);var n=e.data.remainingSeconds||0;e.data.remainingSeconds=Math.max((1e3*n-r)/1e3,-1)}t._sequence=e.sequence,t._listenerHandlesNotNotifyMap[e.cmd]&&t._listenerHandlesNotNotifyMap[e.cmd](e.data)})),this._diffRoomInfo(r,n),this._diffMember(i,o)},t.prototype._sequenceCachePushAndSort=function(e){for(var t=0,r=this._sequenceCache.length-1,n=0;t<=r&&(n=Math.floor((t+r)/2),this._sequenceCache[n].sequence!==e.sequence);)e.sequence<this._sequenceCache[n].sequence?r=n-1:t=n+1;this._sequenceCache.splice(n+1,0,e)},t.prototype._resetMember=function(){return{isAudioOn:!1,isInChatroom:!1,isInRtcChannel:!1,isSharingScreen:!1,isVideoOn:!1,isSharingWhiteboard:!1,avatar:"",name:"",rtcUid:0,properties:{},role:{name:"",limit:0,params:{audio:{profile:"",scenario:""},screen:{videoProfile:"",fps:5},video:{fps:15,height:0,width:0}}},uuid:"",clientType:c.WEB,hide:!1}},t.prototype._handleSequenceNotRight=function(e){return h(this,void 0,void 0,(function(){var r,n,i=this;return d(this,(function(o){switch(o.label){case 0:r=(new Date).getTime(),0===this._getSequenceInfoStartTime&&(this._getSequenceInfoStartTime=r),this._logger.warn(t.TAG_NAME,"存在消息丢失",this._sequence,e),o.label=1;case 1:return o.trys.push([1,3,,6]),this._isFetching=!0,[4,this._getSequenceInfo(this._sequence,e)];case 2:return o.sent(),this._getSequenceInfoStartTime=0,this._getSequenceInfoCount=0,this._isFetching=!1,[3,6];case 3:return n=o.sent(),console.error(n),1004!==n.code&&1021!==n.code?[3,5]:(this._listeners.onRoomEnded&&this._listeners.onRoomEnded(1004===n.code?b.CLOSE_BY_MEMBER:b.LEAVE_BY_SELF),[4,this.destroy()]);case 4:return o.sent(),[2];case 5:return r-this._getSequenceInfoStartTime>=6e4?(this._getSequenceInfoStartTime=0,this._getSequenceInfoCount=0,this._isFetching=!1,this._logger.debug("超时退出"),this._logger.tracking("failure",t.TAG_NAME,{method:"sync_data_error"}),this._syncDataErrorHandle(),[2]):this.roomUuid?(setTimeout((function(){console.log("开始规避>>>>",i._getSequenceInfoCount,i._getSequenceInfoStartTime),i._getSequenceInfoCount+=1,i._handleSequenceNotRight(e)}),1e3*Math.min(Math.pow(2,this._getSequenceInfoCount)+Math.random(),16)),[3,6]):[2];case 6:return[2]}}))}))},t.prototype._getSequenceInfo=function(e,t){return h(this,void 0,void 0,(function(){var r,n;return d(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._request.getSequenceApi({roomUuid:this.roomUuid,nextSequence:e+1,trigger:t})];case 1:return(r=i.sent()).snapshot?(console.log("获取到全量数据"),this._diffMeetingInfo(r)):(console.log("获取到增量数据"),this._diffGetSequenceInfo(r.list)),[3,3];case 2:return n=i.sent(),[2,Promise.reject(n)];case 3:return[2]}}))}))},t.prototype._diffGetSequenceInfo=function(e){var t=this,r=[];if(e.forEach((function(e){e.sequence>t._sequence&&r.push(e)})),console.warn("getSequence",r.length),r.length>0){var n=r[r.length-1],i=this._getSequenceCacheIndexByLastSequence(n.sequence);if(console.warn("currentIndex",i),i>-1){var o=this._sequenceCache.splice(0,i+1);r=p(p([],_(r),!1),_(o),!1),this._handleMergeSequenceInfo(r)}else this._handleMergeSequenceInfo(r);this._sequenceCache.length>0&&this._throttleGetSequenceInfo()}},t.prototype._getSequenceCacheIndexByLastSequence=function(e){var t=this._sequenceCache.filter((function(t){return t.sequence>e}));this._sequenceCache=t;for(var r=-1,n=0;n<this._sequenceCache.length;n++){var i=this._sequenceCache[n];if(i.sequence-e>1)break;e=i.sequence,r=n}return r},t.prototype._getMeetingInfo=function(){return h(this,void 0,void 0,(function(){var e,t;return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._request.getSnapshotApi(this.roomUuid)];case 1:return e=r.sent(),this._diffMeetingInfo(e),[3,3];case 2:return t=r.sent(),[2,Promise.reject(t)];case 3:return[2]}}))}))},t.prototype._diffMeetingInfo=function(e){var t,r=e.snapshot.room,n=_(this._createRemoteMembers(e.snapshot.members,e.snapshot.room,this._localMember.uuid),2),i=n[0],o=n[1],s=this._roomInfo;s.remainingSeconds=this._joinRoomInfo.remainingSeconds;var a=this._roomProperties,c=this._remoteMemberMap,u=this._localMember;this._roomInfo=r,this._roomProperties=l$1({},e.snapshot.room.properties);var l=this._roomInfo.properties.whiteboard;null===(t=this.whiteboardController)||void 0===t||t.setWhiteboardNeedInfo(l),this._remoteMemberMap=i,this._localMember=o;var d=this._getSequenceCacheIndexByLastSequence(e.sequence);if(d>-1){var p=this._sequenceCache.splice(0,d+1);this._handleMergeSequenceInfo(p)}else this._diffRoomInfo(s,a),this._diffMember(c,u),this._sequence=e.sequence;this._sequenceCache.length>0&&this._throttleGetSequenceInfo()},t.prototype._diffMember=function(e,t){var r,n,i,o,s=[],a=[];e.set(t.uuid,t),this._remoteMemberMap.set(this._localMember.uuid,this._localMember);var c=function(e,r){var n=u._remoteMemberMap.get(e);if(n){if(r.role.name!=n.role.name&&(r.uuid===u._localMember.uuid&&u._handlePermissionByRoleChanged(r.role.name),u._listeners.onMemberRoleChanged&&u._listeners.onMemberRoleChanged(n,r.role,n.role),u.event.emit("onMemberRoleChanged",n,r.role,n.role)),r.isInRtcChannel!=n.isInRtcChannel&&(n.isInRtcChannel?(u._listeners.onMemberJoinRtcChannel&&u._listeners.onMemberJoinRtcChannel([n]),u.event.emit("onMemberJoinRtcChannel",[n])):(u._listeners.onMemberLeaveRtcChannel&&u._listeners.onMemberLeaveRtcChannel([n]),u.event.emit("onMemberLeaveRtcChannel",[n]))),r.name!=n.name&&(u._listeners.onMemberNameChanged&&u._listeners.onMemberNameChanged(n,n.name),u.event.emit("onMemberNameChanged",n,n.name)),r.isVideoOn!=n.isVideoOn&&(u._listeners.onMemberVideoMuteChanged&&u._listeners.onMemberVideoMuteChanged(n,!n.isVideoOn,n),u.event.emit("onMemberVideoMuteChanged",n,!n.isVideoOn,n)),r.isAudioOn!=n.isAudioOn&&(u._listeners.onMemberAudioMuteChanged&&u._listeners.onMemberAudioMuteChanged(n,!n.isAudioOn,n),u.event.emit("onMemberAudioMuteChanged",n,!n.isAudioOn,n)),r.isSharingScreen!=n.isSharingScreen&&(u.rtcController&&u.rtcController.setScreenSharingUserUuid(n.isSharingScreen?n.uuid:""),u._listeners.onMemberScreenShareStateChanged&&u._listeners.onMemberScreenShareStateChanged(n,n.isSharingScreen,n),u.event.emit("onMemberScreenShareStateChanged",n,n.isSharingScreen,n)),r.isInChatroom!=n.isInChatroom&&(n.isInChatroom?(u._listeners.onMemberJoinChatroom&&u._listeners.onMemberJoinChatroom([n]),u.event.emit("onMemberJoinChatroom",[n])):(u._listeners.onMemberLeaveChatroom&&u._listeners.onMemberLeaveChatroom([n]),u.event.emit("onMemberLeaveChatroom",[n]))),n.properties){var i={},o={},a=n.properties,c=r.properties,l=Object.keys(c),d=Object.keys(a);l.forEach((function(e){var t=d.indexOf(e);if(t>=0){var r=JSON.stringify(a[e]),n=JSON.stringify(c[e]);"[object Object]"===Object.prototype.toString.call(a[e])&&"[object Object]"===Object.prototype.toString.call(c[e])&&(r=JSON.stringify(l$1(l$1({},c[e]),a[e]))),r!=n&&(i[e]=a[e])}else o[e]=c[e];d.splice(t,1)})),d.length>0&&d.forEach((function(e){i[e]=a[e]})),Object.keys(i).length>0&&(u._listeners.onMemberPropertiesChanged&&u._listeners.onMemberPropertiesChanged(n,i),u.event.emit("onMemberPropertiesChanged",n,i)),Object.keys(o).length>0&&(u._listeners.onMemberPropertiesDeleted&&u._listeners.onMemberPropertiesDeleted(t.uuid,o),u.event.emit("onMemberPropertiesDeleted",t.uuid,o))}}else s.push(r)},u=this;try{for(var l=m(e.entries()),d=l.next();!d.done;d=l.next()){var p=_(d.value,2);c(p[0],p[1])}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}s.length>0&&(this._listeners.onMemberLeaveRoom&&this._listeners.onMemberLeaveRoom(s),this.event.emit("onMemberLeaveRoom",s));try{for(var f=m(this._remoteMemberMap.keys()),h=f.next();!h.done;h=f.next()){var g=h.value;if(!e.has(g)){var v=this._remoteMemberMap.get(g);v&&a.push(v)}}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}a.length>0&&(this._listeners.onMemberJoinRoom&&this._listeners.onMemberJoinRoom(a),this.event.emit("onMemberJoinRoom",a)),this._remoteMemberMap.delete(this._localMember.uuid),e.delete(t.uuid)},t.prototype._diffRoomInfo=function(e,t){var r=this;console.warn("开始房间属性diff");var n=Object.keys(t),i=Object.keys(this._roomProperties),o={},s={};e.remainingSeconds!=this._joinRoomInfo.remainingSeconds&&(this._listeners.onRoomRemainingSecondsRenewed&&this._listeners.onRoomRemainingSecondsRenewed(this._joinRoomInfo.remainingSeconds||-1),this.event.emit("onRoomRemainingTimeChanged",this._joinRoomInfo.remainingSeconds||-1)),n.forEach((function(n){var a,c,u,l,d,p,m,f,h=i.indexOf(n);if(h>=0)if("wbSharingUuid"===n){var g=null===(a=r._roomInfo.properties[n])||void 0===a?void 0:a.value;if((null===(c=t[n])||void 0===c?void 0:c.value)!=g){var v=r._remoteMemberMap.get(g);r._listeners.onMemberWhiteboardStateChanged&&r._listeners.onMemberWhiteboardStateChanged(l$1({},v),!0,l$1({},v)),r.event.emit("onMemberWhiteboardStateChanged",l$1({},v),!0,l$1({},v))}}else if("lock"===n){var y=null===(u=r._roomInfo.properties[n])||void 0===u?void 0:u.value;(null===(l=t[n])||void 0===l?void 0:l.value)!=y&&(r.isRoomLocked=1==y,r._listeners.onRoomLockStateChanged&&r._listeners.onRoomLockStateChanged(r.isRoomLocked),r.event.emit("onRoomLockStateChanged",r.isRoomLocked))}else if("live"===n){var b=r._roomInfo.properties[n];if(b)b.password=r._roomInfo.livePassword||b.password,null===(m=r.liveController)||void 0===m||m.setLiveInfoFromRoomPropertiesLive(l$1({},b)),b.state!=(null===(f=t[n])||void 0===f?void 0:f.state)&&(r._listeners.onRoomLiveStateChanged&&r._listeners.onRoomLiveStateChanged(b.state),r.event.emit("onRoomLiveStateChanged",b.state));else{var S=null===(d=r.liveController)||void 0===d?void 0:d.getLiveInfo();S&&(S.state=G.ENDED,null===(p=r.liveController)||void 0===p||p.setLiveInfo(S)),r._listeners.onRoomLiveStateChanged&&r._listeners.onRoomLiveStateChanged(G.ENDED),r.event.emit("onRoomLiveStateChanged",G.ENDED)}}else{var T=JSON.stringify(e.properties[n]),_=JSON.stringify(r._roomProperties[n]);"[object Object]"===Object.prototype.toString.call(e.properties[n])&&"[object Object]"===Object.prototype.toString.call(r._roomProperties[n])&&(_=JSON.stringify(l$1(l$1({},e.properties[n]),r._roomProperties[n]))),_!=T&&(s[n]=r._roomProperties[n])}else o[n]=t[n];i.splice(h,1)})),i.length>0&&i.forEach((function(e,t){var n,i,o;if("wbSharingUuid"===e){var a=null===(n=r._roomInfo.properties[e])||void 0===n?void 0:n.value,c=r._remoteMemberMap.get(a);r._listeners.onMemberWhiteboardStateChanged&&r._listeners.onMemberWhiteboardStateChanged(l$1({},c),!0,l$1({},c)),r.event.emit("onMemberWhiteboardStateChanged",l$1({},c),!0,l$1({},c))}else if("lock"===e){var u=null===(i=r._roomInfo.properties[e])||void 0===i?void 0:i.value;r.isRoomLocked=1==u,r._listeners.onRoomLockStateChanged&&r._listeners.onRoomLockStateChanged(r.isRoomLocked),r.event.emit("onRoomLockStateChanged",r.isRoomLocked)}else if("live"===e){var l=r._roomInfo.properties[e];l.password=r._roomInfo.livePassword||l.password,null===(o=r.liveController)||void 0===o||o.setLiveInfoFromRoomPropertiesLive(l$1({},l)),r._listeners.onRoomLiveStateChanged&&r._listeners.onRoomLiveStateChanged(l.state),r.event.emit("onRoomLiveStateChanged",l.state)}else s[e]=r._roomInfo.properties[e]})),Object.keys(s).length>0&&(this._listeners.onRoomPropertiesChanged&&this._listeners.onRoomPropertiesChanged(s),this.event.emit("onRoomPropertiesChanged",s));var a=Object.keys(o);a.length>0&&(a.forEach((function(e){var n;if("wbSharingUuid"===e){var i,s=null===(n=t[e])||void 0===n?void 0:n.value;(i=s===r._localMember.uuid?r._localMember:r._remoteMemberMap.get(s))&&(r._listeners.onMemberWhiteboardStateChanged&&r._listeners.onMemberWhiteboardStateChanged(l$1({},i),!1,l$1({},i)),r.event.emit("onMemberWhiteboardStateChanged",l$1({},i),!0,l$1({},i))),delete o[e]}else"lock"===e?(r.isRoomLocked=!1,r._listeners.onRoomLockStateChanged&&r._listeners.onRoomLockStateChanged(r.isRoomLocked),r.event.emit("onRoomLockStateChanged",r.isRoomLocked),delete o[e]):"live"===e&&(r._listeners.onRoomLiveStateChanged&&r._listeners.onRoomLiveStateChanged(G.ENDED),r.event.emit("onRoomLiveStateChanged",G.ENDED),delete o[e])})),Object.keys(o).length>0&&(this._listeners.onRoomPropertiesDeleted&&this._listeners.onRoomPropertiesDeleted(o),this.event.emit("onRoomPropertiesDeleted",o)))},t.prototype._handlePermissionByRoleChanged=function(e){var t=function(e,t){var r,n=null===(r=t.permissions.member)||void 0===r?void 0:r.streams,i=n.audio,o=n.video,s=n.subVideo,a=!0,c=!0,u=!0;if(i.roles){var l=i.roles.findIndex((function(e){return e.split(".")[0]==e}));a=l>=0}return o.roles&&(l=o.roles.findIndex((function(e){return e.split(".")[0]==e})),c=l>=0),s.roles&&(l=s.roles.findIndex((function(e){return e.split(".")[0]==e})),u=l>=0),{audio:a,video:c,subVideo:u}}(0,this._templateConfig);this._logger.log("角色变更rolePermissions",t),!t.audio&&this._localMember.isAudioOn&&this.rtcController&&this.rtcController.muteMyAudio,!t.video&&this._localMember.isVideoOn&&this.rtcController&&this.rtcController.muteMyVideo(),!t.subVideo&&this._localMember.isSharingScreen&&this.rtcController&&this.rtcController.stopScreenShare()},t.TAG_NAME="NERoomContextService",t}($),re=function(e){function t(r){var n=e.call(this,{rtc:r.rtc,isSupported:!!r.rtc,token:r.token,logger:r.logger})||this;return n.isSupported=!0,n._appkey="",n._testAudio=null,n._microTestTimer=0,n._testMic=!1,n._testSpeaker=!1,n._listener={},n.isSupported=r.isSupported,r.rtc?(n.logger=r.logger,n._rtc=r.rtc,n._appkey=r.appkey||"123123",n._token=r.token,n.logger.log(t.TAG_NAME,"constructor",r),n.init(),n):(n.isSupported=!1,n)}return u(t,e),t.prototype.init=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];this.logger.log(t.TAG_NAME,"init--start--");try{this._rtc.init({nrtcAppKey:this._appkey}),this._rtc.setUid(11),this._rtc.setMediaParams({audio:!1,video:!1,screen:!1}),this._isInit=!0,this.logger.log(t.TAG_NAME,"init success")}catch(e){return this.logger.log(t.TAG_NAME,"init fail",e),[2,W(e)]}return[2]}))}))},t.prototype.getDeviceListData=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0})];case 1:return t.sent(),[2,this._rtc.getDeviceListData()];case 2:throw e=t.sent(),new Error(e);case 3:return[2]}}))}))},t.prototype.switchDevice=function(e){var r;return h(this,void 0,void 0,(function(){var n,i;return d(this,(function(o){switch(o.label){case 0:if(!this.isSupported)throw new Error(T.NOT_SUPPORT);if(!this._isInit)throw new Error(T.NOT_INIT_PREVIEW);if(this._testMic||this._testSpeaker)throw new Error("请先停止设备检测");this.logger.log(t.TAG_NAME,"switchDevice"),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this._rtc.switchDevice(e)];case 2:return n=o.sent(),[4,null===(r=this._testAudio)||void 0===r?void 0:r.setSinkId(n.deviceId)];case 3:return o.sent(),[2,n];case 4:throw i=o.sent(),new Error(i);case 5:return[2]}}))}))},t.prototype.startRecordDeviceTest=function(e){return h(this,void 0,void 0,(function(){var r,n,i=this;return d(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,W(M.FAILURE,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(M.FAILURE,T.NOT_INIT_PREVIEW)];if(this._testSpeaker)return[2,W({code:M.FAILURE,msg:"请先停止扬声器检测"})];if(this._testMic)return[2,W({msg:"麦克风检测进行时..."})];this.logger.log(t.TAG_NAME,"startCheckMicrophone--start--"),o.label=1;case 1:return o.trys.push([1,3,,4]),this._videoView||((r=document.createElement("div")).id="tempDivForLocalStream",r.style.height="10px",r.style.width="10px",document.body.appendChild(r),this._rtc.setupLocalVideoCanvas(r)),this._rtc.setMediaParams({audio:!1}),[4,this._rtc.open("audio",{},!1)];case 2:return o.sent(),i._microTestTimer=window.setInterval((function(){var t=i._rtc.getAudioLevel();e&&e(M.SUCCESS,t)}),100),this._testMic=!0,this.logger.log(t.TAG_NAME,"startCheckMicrophone success"),[2,J(null)];case 3:return n=o.sent(),this.logger.log(t.TAG_NAME,"startCheckMicrophone fail",n),[2,W(n)];case 4:return[2]}}))}))},t.prototype.stopRecordDeviceTest=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_PREVIEW)];if(!this._testMic)return[2,W({msg:"请先开始麦克风检测"})];this.logger.log(t.TAG_NAME,"stopCheckMicrophone--start--");try{return this._rtc.close("audio"),window.clearInterval(this._microTestTimer),this._microTestTimer=0,this._testMic=!1,this.logger.log(t.TAG_NAME,"stopCheckMicrophone success"),[2,J(null)]}catch(e){return this.logger.log(t.TAG_NAME,"stopCheckMicrophone fail",e),[2,W(e)]}return[2]}))}))},t.prototype.startPlayoutDeviceTest=function(e){var r;return h(this,void 0,void 0,(function(){var n;return d(this,(function(i){if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_PREVIEW)];if(this._testMic)return[2,W({code:M.FAILURE,msg:"请先停止麦克风检测"})];if(this._testSpeaker)return[2,W({msg:"扬声器检测进行时..."})];try{return this.logger.log(t.TAG_NAME,"startCheckSpeaker"),e=e||"https://app.yunxin.163.com/webdemo/audio/rain.mp3",this._testAudio=new Audio(e),this._testAudio.loop=!0,(n=this._rtc.getSpeakerId())&&(null===(r=this._testAudio)||void 0===r||r.setSinkId(n)),this._testAudio.play(),this._testSpeaker=!0,[2,J(null)]}catch(e){return[2,W(e)]}return[2]}))}))},t.prototype.stopPlayoutDeviceTest=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return this.isSupported?this._isInit?this._testAudio?(this.logger.log(t.TAG_NAME,"stopCheckSpeaker"),this._testAudio.pause(),this._testSpeaker=!1,[2,J(null)]):[2,W({code:M.FAILURE,msg:"请先开始扬声器检测"})]:[2,W(null,T.NOT_INIT_PREVIEW)]:[2,W(null,T.NOT_SUPPORT)]}))}))},t.prototype.setupLocalVideoCanvas=function(e){if(!this.isSupported)return this.logger.error(T.NOT_SUPPORT),-1;if(!this._isInit)return this.logger.error(T.NOT_INIT_PREVIEW),-1;if(!e)return this.logger.error("请设置正确的绘制视图"),-1;this.logger.log(t.TAG_NAME,"setVideoView--start--");try{this._videoView=e,this._rtc.setupLocalVideoCanvas(e);var r=document.getElementById("tempDivForLocalStream");if(r){var n=null==r?void 0:r.parentNode;null==n||n.removeChild(r)}return this.logger.log(t.TAG_NAME,"setVideoView success"),0}catch(e){return this.logger.log(t.TAG_NAME,"setVideoView fail",e),-1}},t.prototype.startPreview=function(e){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_PREVIEW)];if(!this._videoView&&!e)return[2,W({code:M.FAILURE,msg:"请先设置视图"})];this.logger.log(t.TAG_NAME,"startVideoPreview--start--"),n.label=1;case 1:return n.trys.push([1,3,,4]),e&&this.setupLocalVideoCanvas(e),[4,this._rtc.open("video",{},!1)];case 2:return n.sent(),this.logger.log(t.TAG_NAME,"startVideoPreview success"),[2,J(null)];case 3:return r=n.sent(),this.logger.log(t.TAG_NAME,"startVideoPreview fail",r),[2,W(r)];case 4:return[2]}}))}))},t.prototype.stopPreview=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_PREVIEW)];this.logger.log(t.TAG_NAME,"stopVideoPreview--start--"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._rtc.close("video")];case 2:return r.sent(),this.logger.log(t.TAG_NAME,"stopVideoPreview success"),[2,J(null)];case 3:return e=r.sent(),this.logger.log(t.TAG_NAME,"stopVideoPreview fail",e),[2,W(e)];case 4:return[2]}}))}))},t.prototype.checkSystemRequirements=function(){if(!this.isSupported)throw new Error(T.NOT_SUPPORT);if(!this._isInit)throw new Error(T.NOT_INIT_PREVIEW);this.logger.log(t.TAG_NAME,"checkSystemRequirements--start--");try{var e=this._rtc.checkSystemRequirements();return this.logger.log(t.TAG_NAME,"checkSystemRequirements success",e),e}catch(e){throw this.logger.log(t.TAG_NAME,"checkSystemRequirements fail",e),new Error(e)}},t.prototype.destroy=function(){var e;return h(this,void 0,void 0,(function(){var r,n,i;return d(this,(function(o){switch(o.label){case 0:if(!this.isSupported)return[2,W(null,T.NOT_SUPPORT)];if(!this._isInit)return[2,W(null,T.NOT_INIT_PREVIEW)];this.logger.log(t.TAG_NAME,"destroy--start--"),o.label=1;case 1:return o.trys.push([1,6,,7]),this._testMic?[4,this.stopRecordDeviceTest()]:[3,3];case 2:o.sent(),o.label=3;case 3:return this._testSpeaker?[4,this.stopPlayoutDeviceTest()]:[3,5];case 4:o.sent(),o.label=5;case 5:return this._testAudio=null,(r=document.getElementById("tempDivForLocalStream"))&&(null==(n=null==r?void 0:r.parentNode)||n.removeChild(r)),this._rtc.destroy(),null===(e=this._recvClient)||void 0===e||e.destroy(),this._recvClient=null,this._isInit=!1,this.logger.log(t.TAG_NAME,"destroy success"),[3,7];case 6:return i=o.sent(),this.logger.log(t.TAG_NAME,"destroy fail",i),[2,W(i)];case 7:return[2]}}))}))},t.TAG_NAME="NEPreviewController",t}(Y),ie=function(){function e(e){this._listeners={},this._eventEmitter=e.eventEmitter,this.previewController=new re({logger:e.logger,rtc:e.Rtc,appkey:e.appKey,token:e.token,isSupported:!!e.Rtc}),this._initListener()}return e.prototype.addPreviewRoomListener=function(e){this._listeners=e||{}},e.prototype.removePreviewRoomListener=function(e){this._listeners={}},e.prototype.destroy=function(){this.previewController.destroy()},e.prototype._initListener=function(){var e=this;this._eventEmitter.on(N.CAMERA_DEVICE_CHANGE,(function(t){e._listeners.onCameraDeviceChanged&&e._listeners.onCameraDeviceChanged(t)})),this._eventEmitter.on(N.SPEAKER_DEVICE_CHANGE,(function(t){e._listeners.onPlayoutDeviceChanged&&e._listeners.onPlayoutDeviceChanged(t)})),this._eventEmitter.on(N.RECORD_DEVICES_CHANGE,(function(t){e._listeners.onRecordDeviceChanged&&e._listeners.onRecordDeviceChanged(t)}))},e}(),oe=function(e){function t(t){var r=e.call(this)||this;return r._roomContext=null,r._roomContextMap=new Map,r._enableRecord=!1,r._request=t.request,r._Rtc=t.rtc,r._PreviewRtc=t.previewRtc,r._Chatroom=t.chatroom,r._Whiteboard=t.whiteboard,r._ToolCollection=t.toolCollection,r._eventEmitter=t.eventEmitter,r._outEventEmitter=t.eventEmitter,r._logger=t.logger,r._debug=t.debug||!1,r._Im=t.IM,r._privateRtcConfig=t.privateRtcConfig,r._privateWhiteboardConfig=t.privateWhiteboardConfig,r._deviceId=t.deviceId,r._globalEventListener=t.globalEventListener,r}return u(t,e),t.prototype.createRoom=function(e,r){return h(this,void 0,void 0,(function(){var n;return d(this,(function(i){switch(i.label){case 0:this._logger.tracking("userAction",t.TAG_NAME,{method:"createRoom",params:e,options:r}),i.label=1;case 1:return i.trys.push([1,3,,4]),r=r||{enableChatroom:!0,enableLive:!1,enableRecord:!0,enableRtc:!0,enableWhiteboard:!1},[4,this._request.createRoomApi({properties:e.initialProperties,roomName:e.roomName,roomUuid:e.roomUuid,configId:e.templateId,password:e.password,config:{resource:{rtc:null==r?void 0:r.enableRtc,chatroom:null==r?void 0:r.enableChatroom,whiteboard:null==r?void 0:r.enableWhiteboard,live:null==r?void 0:r.enableLive,record:null==r?void 0:r.enableRecord}}})];case 2:return i.sent(),this._enableRecord=null==r?void 0:r.enableRecord,[2,J(null)];case 3:return n=i.sent(),this._logger.tracking("failure",t.TAG_NAME,{method:"createRoom",error:n}),[2,W(n)];case 4:return[2]}}))}))},t.prototype.getRoomContext=function(e){return this._roomContextMap.get(e)||null},t.prototype.getPreviewRoomContext=function(){return this._previewRoomContext||(this._previewRoomContext=new ie({debug:this._debug,Rtc:this._PreviewRtc,eventEmitter:this._eventEmitter,appKey:"",token:"",logger:this._logger})),this._previewRoomContext},t.prototype.getTemplateConfig=function(e){return this._request.getRoomConfigApi(e)},t.prototype.previewRoom=function(e,t){return h(this,void 0,void 0,(function(){return d(this,(function(e){return this._previewRoomContext||(this._previewRoomContext=new ie({debug:this._debug,Rtc:this._PreviewRtc,eventEmitter:this._eventEmitter,appKey:"",token:"",logger:this._logger})),[2,J(this._previewRoomContext)]}))}))},t.prototype.joinRoom=function(e,r){return h(this,void 0,void 0,(function(){var n,i,o,s,a,c,u,l,p,m,f,h;return d(this,(function(d){switch(d.label){case 0:if(this._logger.tracking("userAction",t.TAG_NAME,{method:"joinRoom",params:e,options:r}),!e.role||!e.roomUuid)throw this._logger.error(t.TAG_NAME,"joinRoom params error"),new Error("joinRoom params error");e.crossAppAuthorization&&this._request.setCrossAppAuthorization(e.crossAppAuthorization),d.label=1;case 1:return d.trys.push([1,6,,7]),n=this,[4,this._request.getRoomConfigApi(e.roomUuid)];case 2:return n._templateConfig=d.sent(),[4,this._request.joinRoomApi({role:e.role,roomUuid:e.roomUuid,userName:e.userName,password:e.password,userIcon:e.avatar,properties:e.initialProperties})];case 3:return i=d.sent(),o=i.member,s=i.room,this._logger.log(t.TAG_NAME,"joinRoomInfo",{member:o,room:s}),a=s.roomName,c=s.roomUuid,u=s.properties,l=s.rtcCid,[4,this._request.getSnapshotApi(c)];case 4:if(p=d.sent(),m=this._roomContextMap.get(e.roomUuid)){if(m.roomUuid)return console.warn("重复加入房间",e.roomUuid),[2,J(m)];console.warn("该房间已销毁重新初始化: ",e.roomUuid),this._roomContextMap.delete(e.roomUuid)}return[4,(f=new te).initialize({debug:this._debug,deviceId:this._deviceId,Rtc:this._Rtc,Chatroom:this._Chatroom,Whiteboard:this._Whiteboard,roomName:a,roomUuid:c,cid:l,enableRecord:this._enableRecord,toolCollection:this._ToolCollection,request:this._request,eventEmitter:this._eventEmitter,outEventEmitter:this._outEventEmitter,roomProperties:u,appKey:o.rtcKey,member:o,deleteRoomContext:this._deleteRoomContext.bind(this),templateConfig:this._templateConfig,snapshotData:p,joinRoomInfo:s,logger:this._logger,IM:this._Im,privateRtcConfig:this._privateRtcConfig,privateWhiteboardConfig:this._privateWhiteboardConfig,globalEventListener:this._globalEventListener})];case 5:return d.sent(),this._roomContextMap.set(c,f),[2,J(f)];case 6:return h=d.sent(),this._logger.tracking("failure",t.TAG_NAME,{method:"joinRoom",error:h}),[2,Promise.reject(h)];case 7:return[2]}}))}))},t.prototype.destroy=function(){return h(this,void 0,void 0,(function(){var e,t,r,n,i,o;return d(this,(function(s){switch(s.label){case 0:this._logger.tracking("userAction","NERoomService",{method:"destroy"}),s.label=1;case 1:s.trys.push([1,6,7,8]),e=m(this._roomContextMap.keys()),t=e.next(),s.label=2;case 2:return t.done?[3,5]:(r=t.value,[4,this._resetState(r)]);case 3:s.sent(),s.label=4;case 4:return t=e.next(),[3,2];case 5:return[3,8];case 6:return n=s.sent(),i={error:n},[3,8];case 7:try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))},t.prototype._resetState=function(e){var r;return h(this,void 0,void 0,(function(){var n;return d(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),this._roomContextMap.has(e)?[4,null===(r=this._roomContextMap.get(e))||void 0===r?void 0:r.destroy()]:[3,2];case 1:i.sent(),this._roomContextMap.delete(e),i.label=2;case 2:return[3,4];case 3:return n=i.sent(),this._logger.error(t.TAG_NAME,"resetState",n),[3,4];case 4:return[2]}}))}))},t.prototype._deleteRoomContext=function(e){this._roomContextMap.has(e)&&this._roomContextMap.delete(e)},t.TAG_NAME="NERoomService",t}($),ne=function(e){function t(t){var r=e.call(this)||this;return r.isLoggedIn=!1,r.debug=!1,r.imPrivateConf=void 0,r._im=t.IM,r._request=t.request,r.logger=t.logger,r.imPrivateConf=t.privateConf,r._eventEmitter=t.eventEmitter,r}return u(t,e),t.prototype.addAuthListener=function(e){var r=this;this.logger.log(t.TAG_NAME,"addAuthListener"),this._im.on("imDisconnect",(function(n){if(r.logger.log(t.TAG_NAME,"连接断开",n),n)switch(n.code){case 302:e.onAuthEvent&&e.onAuthEvent(E.ACCOUNT_TOKEN_ERROR);break;case 417:break;case"kicked":e.onAuthEvent&&e.onAuthEvent(E.KICK_OUT)}})),this._im.on("imConnect",(function(n){r.logger.log(t.TAG_NAME,"连接成功",n),e.onAuthEvent&&e.onAuthEvent(E.LOGGED_IN)})),this._im.on("imLogout",(function(n){r.logger.log(t.TAG_NAME,"退出登录",n),e.onAuthEvent&&e.onAuthEvent(E.LOGGED_OUT)})),this._eventEmitter.on(O.UNAUTHORIZED,(function(n){return h(r,void 0,void 0,(function(){return d(this,(function(r){return this.logger.log(t.TAG_NAME,"unauthorized"),this.logout().finally((function(){e.onAuthEvent&&e.onAuthEvent(n)})),[2]}))}))})),this._eventEmitter.on(O.TOKEN_EXPIRED,(function(n){r.logger.log(t.TAG_NAME,"token_expired"),e.onAuthEvent&&e.onAuthEvent(n)}))},t.prototype.login=function(e,r){return h(this,void 0,void 0,(function(){var n,i;return d(this,(function(o){switch(o.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"login",account:e}),o.label=1;case 1:return o.trys.push([1,4,,5]),this._request.setToken(r),this._request.setUserUuid(e),this._request.setHeaders({}),[4,this._request.loginApi()];case 2:return n=o.sent(),this.roomAccountId=n.userUuid,this.roomAccountToken=n.imToken,this.roomAppKey=n.imKey,[4,this.loginIM({appKey:n.imKey,token:n.imToken,account:n.userUuid})];case 3:return o.sent(),[2,J(null)];case 4:throw i=o.sent(),this.logger.error(t.TAG_NAME,"login fail：",i),this._request.setToken(""),this._request.setUserUuid(""),i;case 5:return[2]}}))}))},t.prototype.loginByDynamicToken=function(e,r){return h(this,void 0,void 0,(function(){var n,i;return d(this,(function(o){switch(o.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"loginByDynamicToken",account:e,token:r}),this._request.setHeaders({authType:1}),this._request.setUserUuid(e),this._request.setToken(r),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this._request.loginByIMApi()];case 2:return n=o.sent(),this.roomAccountId=n.userUuid,this.roomAccountToken=this._im.nim.options.token,this.roomAppKey=n.imKey,[4,this.loginIM({appKey:n.imKey,token:this.roomAccountToken,account:n.userUuid})];case 3:return o.sent(),[2,J(null)];case 4:throw i=o.sent(),this.logger.error(t.TAG_NAME,"loginByDynamicToken fail：",i),this._request.setToken(""),this._request.setUserUuid(""),i;case 5:return[2]}}))}))},t.prototype.loginByIM=function(e,r,n){return h(this,void 0,void 0,(function(){var i,o;return d(this,(function(s){switch(s.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"loginByIM",account:e,dynamicToken:r,imToken:n}),s.label=1;case 1:return s.trys.push([1,4,,5]),this._request.setHeaders({authType:1}),this._request.setUserUuid(e),this._request.setToken(r),[4,this._request.loginByIMApi()];case 2:return i=s.sent(),this.roomAccountId=i.userUuid,this.roomAccountToken=n,this.roomAppKey=i.imKey,[4,this.loginIM({appKey:i.imKey,token:n,account:i.userUuid})];case 3:return s.sent(),[2,J(null)];case 4:throw o=s.sent(),this.logger.error(t.TAG_NAME,"loginByIM fail：",o),this._request.setToken(""),this._request.setUserUuid(""),o;case 5:return[2]}}))}))},t.prototype.logout=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"logout"}),r.label=1;case 1:return r.trys.push([1,3,,4]),this.isLoggedIn=!1,[4,this._im.logout()];case 2:return r.sent(),this._request.setToken(""),this._request.setUserUuid(""),[2,J(null)];case 3:throw e=r.sent(),this.logger.error(t.TAG_NAME,"logout fail: ",e),e;case 4:return[2]}}))}))},t.prototype.removeAuthListener=function(){this.logger.log(t.TAG_NAME,"removeAuthListener"),this._im.off("imDisconnect"),this._im.off("imConnect"),this._eventEmitter.off(O.UNAUTHORIZED),this._eventEmitter.off(O.TOKEN_EXPIRED)},t.prototype.resetState=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return this.isLoggedIn?[4,this.logout()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.removeAuthListener(),this._request.setHeaders({}),this.imPrivateConf=void 0,[2]}}))}))},t.prototype.renewToken=function(e){return h(this,void 0,void 0,(function(){var t,r;return d(this,(function(n){switch(n.label){case 0:if(!e)return[2,W(null,"token is empty")];t=this._request.token,this._request.setToken(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._request.checkToken()];case 2:return n.sent(),[2,J(null)];case 3:return r=n.sent(),this._request.setToken(t),[2,W(r)];case 4:return[2]}}))}))},t.prototype.destroy=function(){this.logger.tracking("userAction",t.TAG_NAME,{method:"destroy"}),this.resetState()},t.prototype.loginIM=function(e){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:this.logger.tracking("userAction",t.TAG_NAME,{method:"loginIM"}),n.label=1;case 1:if(n.trys.push([1,3,,4]),!this.roomAppKey||!this.roomAccountId||!this.roomAccountToken)throw Error(j);return this._im.init(l$1(l$1({},e),{imPrivateConf:this.imPrivateConf,roomAppKey:this.roomAppKey,roomAccountId:this.roomAccountId,roomAccountToken:this.roomAccountToken})),this._request.setImToken(this.roomAccountToken),[4,this._im.login()];case 2:return n.sent(),this.isLoggedIn=!0,[3,4];case 3:throw r=n.sent(),this.logger.error(t.TAG_NAME,"loginIM fail: ",r),r;case 4:return[2]}}))}))},t.TAG_NAME="NEAuthService",t}($),se=function(e){function t(r){var n=e.call(this)||this;return n._listener=null,n._controlNotifyListener=function(e){return h(n,void 0,void 0,(function(){var r,n,i,o,s,a;return d(this,(function(c){return(r=JSON.parse(e.body)).cmd<98||"R"===r.type||(this._logger.log(t.TAG_NAME,"controlNotify",r),n=r.data.message,i=r.data.roomUuid,o=null===(s=r.data.operatorMember)||void 0===s?void 0:s.userUuid,(null===(a=this._listener)||void 0===a?void 0:a.onReceiveCustomMessage)&&this._listener.onReceiveCustomMessage({roomUuid:i,senderUuid:o,data:n,commandId:r.cmd})),[2]}))}))},n._im=r.IM,n._request=r.request,n._logger=r.logger,n}return u(t,e),t.prototype.addMessageChannelListener=function(e){e&&(this._listener=e,this._im.on("controlNotify",this._controlNotifyListener))},t.prototype.removeMessageChannelListener=function(){var e;null===(e=this._im)||void 0===e||e.off("controlNotify",this._controlNotifyListener)},t.prototype.sendCustomMessage=function(e,r,n,i){return h(this,void 0,void 0,(function(){return d(this,(function(o){return this._logger.log(t.TAG_NAME,"sendCustomMessage",i),[2,this._request.passThroughMessageApi({roomUuid:e,userUuid:r,data:{cmdId:n,message:i}}).then((function(e){return J(e)})).catch((function(e){return W(e)}))]}))}))},t.prototype.sendCustomMessageToRoom=function(e,r,n){return h(this,void 0,void 0,(function(){return d(this,(function(i){return this._logger.log(t.TAG_NAME,"sendCustomMessageToRoom",n),[2,this._request.passThroughMessageToRoomApi({roomUuid:e,data:{cmdId:r,message:n}}).then((function(e){return J(e)})).catch((function(e){return W(e)}))]}))}))},t.prototype.destroy=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return this.removeMessageChannelListener(),[2,J(null)]}))}))},t.TAG_NAME="NEMessageChannelService",t}($),ae="1.17.2",ue=function(){function e(e){this.isInitialized=!1,this._debug=!1,this._roomService=null,this._authService=null,this._messageService=null,this._whiteboard=null,this._ToolCollection=null,this._privateWhiteboardConfig=null,this._privateRtcConfig=null,this._privateImConfig=null,this._listeners={};var t=e.logger,r=e.EventEmitter,n=e.emitter,i=e.Chatroom,o=e.Rtc,s=e.Whiteboard,a=e.request,c=e.Im,u=e.ToolCollection,l=e.deviceId,d=e.xKit;s&&(this._whiteboard=s),u&&(this._ToolCollection=u),this._deviceId=l,this._IM=c,this._RTC=o,this._Chatroom=i,this._request=a,this._EventEmitter=r,this._eventEmitter=n,this._debug=!1!==e.debug,this._logger=t,this._xKit=d}return e.prototype.getService=function(e){switch(e){case R.NERoomService:return this._getRoomService();case R.NEAuthService:return this._getAuthService();case R.NEMessageService:return this._getMessageService();default:return this._getRoomService()}},Object.defineProperty(e.prototype,"sdkVersions",{get:function(){return{imVersion:"9.6.3",roomKitVersion:ae,rtcVersion:this._RTC.version,whiteboardVersion:"3.8.7"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authService",{get:function(){return this._getAuthService()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomService",{get:function(){return this._getRoomService()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"messageChannelService",{get:function(){return this._getMessageService()},enumerable:!1,configurable:!0}),e.prototype.switchLanguage=function(e){var t,r,n=null===(t=this._request)||void 0===t?void 0:t.getDefaultLanguage();switch(e){case"CHINESE":n="zh-CN";break;case"ENGLISH":n="en-US";break;case"JAPANESE":n="ja-JP"}return null===(r=this._request)||void 0===r||r.setHeaders({"accept-language":n}),0},e.prototype.initialize=function(e){var t;return h(this,void 0,void 0,(function(){var r,n,i,o,s,a;return d(this,(function(u){switch(u.label){case 0:return e.appKey?(this._debug=!1!==e.debug,this._logger.setLevel(this._debug?"log":"warn"),this._logger.setEventTracking(!1!==e.eventTracking),this._logger.setAppKey(e.appKey),this._logger.tracking("init","Roomkit",{method:"initialize",serverConfig:e.serverConfig,serverUrl:e.serverUrl,extras:e.extras}),r=this.sdkVersions,null===(t=this._xKit)||void 0===t||t.initialize({reporterInfoOption:{appKey:e.appKey,version:r.roomKitVersion,nertcVersion:r.rtcVersion,imVersion:r.imVersion,platform:"Web",component:"RoomKit",cacheCount:10}}),this.isInitialized?(this._logger.warn("已初始化"),[2,J(null)]):(this._logger.log("initialize",e),n=this._debug,i=new this._EventEmitter,this._outEventEmitter=new this._EventEmitter,o=new this._IM({logger:this._logger,debug:n,emitter:i,deviceId:this._deviceId,version:"9.6.3",clientType:c.WEB,reuseIM:e.im}),this._im=o,this._chatroom=new this._Chatroom({debug:n,logger:this._logger,emitter:i,im:o}),this._previewRtc=new this._RTC({logger:this._logger,emitter:this._eventEmitter,debug:n}),this._rtc=new this._RTC({logger:this._logger,emitter:i,debug:n}),this._request.setAppKey(e.appKey),e.serverConfig?(this._handleServerConfig(e.serverConfig),[3,5]):[3,1])):[2,F(null,T.NO_APPKEY)];case 1:if(!e.serverUrl)return[3,5];u.label=2;case 2:return u.trys.push([2,4,,5]),[4,this._request.getSkuEnv(e.serverUrl)];case 3:return s=u.sent(),this._handleServerConfig(s),[3,5];case 4:return a=u.sent(),console.warn("getSkuEnv failed",a),[3,5];case 5:return this._authService=new ne({IM:this._im,eventEmitter:this._eventEmitter,request:this._request,logger:this._logger,privateConf:this._privateImConfig}),this._roomService=new oe({debug:this._debug,request:this._request,rtc:this._rtc,previewRtc:this._previewRtc,whiteboard:this._whiteboard,toolCollection:this._ToolCollection,chatroom:this._chatroom,eventEmitter:this._eventEmitter,outEventEmitter:this._outEventEmitter,IM:this._im,logger:this._logger,privateRtcConfig:this._privateRtcConfig,privateWhiteboardConfig:this._privateWhiteboardConfig,deviceId:this._deviceId,globalEventListener:this._listeners}),this._messageService=new se({IM:this._im,request:this._request,logger:this._logger}),this.isInitialized=!0,[2,J(null)]}}))}))},e.prototype.release=function(){var e,t,r;try{return null===(e=this._roomService)||void 0===e||e.destroy(),null===(t=this._authService)||void 0===t||t.destroy(),null===(r=this._messageService)||void 0===r||r.destroy(),this._rtc.destroy(),this._im.destroy(),this.isInitialized=!1,J(null)}catch(e){return F(e,T.FAILURE)}},e.prototype.emit=function(e,t){this._im&&this._im.onReuseIm(e,t)},e.prototype.reuseIM=function(e){if(e.getInstance){var t=this,r=e.getInstance.bind(e);this._logger.log("开始复写getInstance"),e.getInstance=function(e){var n={onwillreconnect:"reuseImWillReconnect",ondisconnect:"reuseImDisconnect",onerror:"reuseImError",onmsgs:"reuseImMsgs",onProxyMsg:"reuseImProxyMsg"};return Object.keys(n).forEach((function(r){var i=e[r];e[r]=function(e){i&&"[object Function]"===Object.prototype.toString.call(i)&&i.call(this,e),t.emit(n[r],e)}})),r(e)}}return e},e.prototype.addGlobalEventListener=function(e){this._listeners=e||{}},e.prototype.removeGlobalEventListener=function(e){var t=this;e?Object.keys(e).forEach((function(e){t._listeners[e]&&delete t._listeners[e]})):this._listeners={}},e.prototype._getRoomService=function(){return this._roomService||(this._roomService=new oe({deviceId:this._deviceId,debug:this._debug,request:this._request,rtc:this._rtc,previewRtc:this._previewRtc,whiteboard:this._whiteboard,toolCollection:this._ToolCollection,chatroom:this._chatroom,eventEmitter:this._eventEmitter,outEventEmitter:this._outEventEmitter,logger:this._logger,IM:this._im,privateRtcConfig:this._privateRtcConfig,privateWhiteboardConfig:this._privateWhiteboardConfig,globalEventListener:this._listeners})),this._roomService},e.prototype._getAuthService=function(){return this._authService||(this._authService=new ne({IM:this._im,eventEmitter:this._eventEmitter,request:this._request,logger:this._logger,privateConf:this._privateImConfig})),this._authService},e.prototype._getMessageService=function(){return this._messageService||(this._messageService=new se({IM:this._im,request:this._request,logger:this._logger})),this._messageService},e.prototype._handleServerConfig=function(e){this._privateImConfig=e.imServerConfig||null,this._privateRtcConfig=e.rtcServerConfig||null,this._privateWhiteboardConfig=e.whiteboardServerConfig||null;var t=e.roomKitServerConfig;t&&t.roomServer&&this._request.setBaseUrl(t.roomServer)},e.TAG_NAME="RoomKit",e}(),ce=function(){function e(e){var t=this;this.imToken="",this.crossAppAuthorization=null,this.config=void 0,this.headers={"accept-language":this.getDefaultLanguage()};var r=e.appKey,n=e.baseDomain,i=e.versionCode,o=e.clientType,s=e.token,a=e.userUuid,c=e.deviceId;this.appKey=r,this.baseDomain=n,this.versionCode=i,this.clientType=o,this.token=s,this.userUuid=a,this.request=function(r){var n,s,a;return r.headers=l$1(l$1({clientType:o,user:(null===(n=t.crossAppAuthorization)||void 0===n?void 0:n.user)||t.userUuid,token:(null===(s=t.crossAppAuthorization)||void 0===s?void 0:s.token)||t.token,versionCode:i,deviceId:c,AppKey:(null===(a=t.crossAppAuthorization)||void 0===a?void 0:a.appKey)||t.appKey},t.headers),r.headers),r.baseURL=r.baseURL?r.baseURL:t.baseDomain,e.request(r).then((function(e){return e.data}))}}return e.prototype.setCrossAppAuthorization=function(e){this.crossAppAuthorization=e},Object.defineProperty(e.prototype,"currentAppKey",{get:function(){var e;return(null===(e=this.crossAppAuthorization)||void 0===e?void 0:e.appKey)||this.appKey},enumerable:!1,configurable:!0}),e.prototype.setAppKey=function(e){this.appKey=e},e.prototype.setToken=function(e){this.token=e},e.prototype.setUserUuid=function(e){this.userUuid=e},e.prototype.setImToken=function(e){this.imToken=e},e.prototype.setBaseUrl=function(e){this.baseDomain=e},e.prototype.setHeaders=function(e){this.headers=l$1(l$1({},this.headers),e)},e.prototype.getRoomInfoApi=function(e){return this.request({method:"GET",url:"/scene/apps/".concat(this.currentAppKey,"/v2/rooms/").concat(e)})},e.prototype.loginByAnonymousApi=function(e){var t=this;return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/anonymous/login"),headers:{Authorization:e}}).then((function(e){return t.config=e,e}))},e.prototype.getRoomConfigApi=function(e){return this.request({method:"GET",url:"/scene/apps/".concat(this.currentAppKey,"/v2/rooms/").concat(e,"/config")})},e.prototype.joinRoomApi=function(e){var t=e.roomUuid,r=e.userName,n=e.role,i=e.streams,o=e.properties,s=e.password,a=e.userIcon;return this.request({method:"POST",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(t,"/entry"),data:{userName:r,role:n,userIcon:a,streams:i,password:s,properties:o}})},e.prototype.deleteRoomApi=function(e){return this.request({method:"DELETE",url:"/scene/apps/".concat(this.appKey,"/v2/rooms/").concat(e)})},e.prototype.updateMemberPropertiesApi=function(e){var t=e.roomUuid,r=e.propertyKey,n=e.userUuid,i=e.value;return this.request({method:"PUT",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(t,"/members/").concat(n,"/properties/").concat(r),data:i})},e.prototype.deleteMemberPropertyApi=function(e){var t=e.roomUuid,r=e.propertyKey,n=e.userUuid;return this.request({method:"DELETE",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(t,"/members/").concat(n,"/properties/").concat(r)})},e.prototype.loginApi=function(){var e=this;return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/login")}).then((function(t){return e.config=t,t}))},e.prototype.loginByIMApi=function(){var e=this;return this.request({method:"POST",url:"/scene/apps/".concat(this.appKey,"/v1/login"),headers:{authType:1}}).then((function(t){return e.config=t,t}))},e.prototype.createRoomApi=function(e){var t=e.roomUuid,r=e.roomName,n=e.properties,i=e.configId,o=e.config;return this.request({method:"PUT",url:"/scene/apps/".concat(this.appKey,"/v2/rooms/").concat(t),data:{roomName:r,properties:n,configId:i,config:o,password:e.password}})},e.prototype.endRoomApi=function(e){return this.request({method:"DELETE",url:"/scene/apps/".concat(this.currentAppKey,"/v2/rooms/").concat(e)})},e.prototype.removeOrLeaveRoomApi=function(e){return this.request({method:"DELETE",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e.roomUuid,"/members/").concat(e.userUuid),data:e.data})},e.prototype.updateMemberInfoApi=function(e){var t=e.roomUuid,r=e.userUuid;return this.request({method:"PUT",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(t,"/members/").concat(r),data:e.data})},e.prototype.updateRoomPropertiesApi=function(e){var t=e.roomUuid,r=e.propertyKey;return this.request({method:"PUT",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(t,"/properties/").concat(r),data:e.data,params:{a:e.associatedUuid}})},e.prototype.deleteRoomPropertyApi=function(e){var t=e.roomUuid,r=e.propertyKey;return this.request({method:"DELETE",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(t,"/properties/").concat(r)})},e.prototype.joinRtcChannelApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e,"/members/joinRtc")})},e.prototype.leaveRtcChannelApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e,"/members/leaveRtc")})},e.prototype.changeMemberStreamsApi=function(e){return this.request({method:e.isOpen?"PUT":"DELETE",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e.roomUuid,"/members/").concat(e.userUuid,"/streams/").concat(e.streamKey),data:{value:e.isOpen?1:0},headers:{"x-operation-number":e.sequence}})},e.prototype.handOverRoleApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e.roomUuid,"/members/").concat(e.userUuid,"/handoverRole")})},e.prototype.getSnapshotApi=function(e){return this.request({method:"GET",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e,"/snapshot")})},e.prototype.getSequenceApi=function(e){return this.request({method:"GET",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e.roomUuid,"/sequence?nextId=").concat(e.nextSequence,"&trigger=").concat(e.trigger)})},e.prototype.passThroughMessageApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e.roomUuid,"/members/").concat(e.userUuid,"/send"),data:e.data})},e.prototype.passThroughMessageToRoomApi=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.currentAppKey,"/v1/rooms/").concat(e.roomUuid,"/send"),data:e.data})},e.prototype.checkToken=function(){return this.request({method:"POST",url:"/scene/apps/".concat(this.currentAppKey,"/v1/checkToken")})},e.prototype.startLive=function(e){return this.request({method:"PUT",url:"/scene/apps/".concat(this.currentAppKey,"/v1/").concat(e.roomUuid,"/live/start"),data:e.data})},e.prototype.endLive=function(e){return this.request({method:"DELETE",url:"/scene/apps/".concat(this.currentAppKey,"/v1/").concat(e.roomUuid,"/live/end")})},e.prototype.getSkuEnv=function(e){return this.request({baseURL:e,method:"GET",url:"/scene/apps/".concat(this.currentAppKey,"/v1/skuEnv")}).then((function(t){var r=t.im,n=t.rtc,i=t.whiteboard,o={roomKitServerConfig:{roomServer:e}};return r&&(o.imServerConfig={lbs:r.weblbsUrl,link:r.link_web,linkSslWeb:r.websdkSsl,nosUploader:r.nos_uploader,httpsEnabled:r.https_enabled,nosDownloader:r.nos_downloader,nosLbs:r.nos_lbs}),n&&(o.rtcServerConfig={channelServer:n.channelServer,statisticsServer:n.statisticsServer,roomServer:n.roomServer,compatServer:n.compatServer,nosLbsServer:n.nosLbsServer,nosUploadSever:n.nosUploadSever,nosTokenServer:n.nosTokenServer,useIPv6:n.useIPv6}),i&&(o.whiteboardServerConfig={roomServer:i.roomServer,sdkLogNosServer:i.sdkLogNosServer,dataReportServer:i.dataReportServer,directNosServer:i.directNosServer,mediaUploadServer:i.mediaUploadServer,docTransServer:i.docTransServer,privateSDKUrl:i.privateSDKUrl}),o}))},e.prototype.updateLive=function(e){return this.request({method:"POST",url:"/scene/apps/".concat(this.currentAppKey,"/v1/").concat(e.roomUuid,"/live/update"),data:e.data})},e.prototype.getDefaultLanguage=function(){return["zh-CN","en-US","ja-JP"].includes(null===navigator||void 0===navigator?void 0:navigator.language)?null===navigator||void 0===navigator?void 0:navigator.language:"en-US"},e}(),le=function(){function e(e){this.debug=!1,this.nrtcAppKey="",this.enableExternalVideo=!1,this.logger=e.logger,this.debug=e.debug,this.emitter=e.emitter}return e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];(t=this.emitter).emit.apply(t,p([e],_(r),!1))},e.prototype.setExternalVideoSource=function(e){this.externalVideoSource=e},e.prototype.setEnableExternalVideo=function(e){this.enableExternalVideo=e},e}(),he={10:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_10,15:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_15,20:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_20,25:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25,30:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_30,5:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5},de={1080:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_1080p,180:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_180p,480:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_480p,720:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p},me=function(e){function t(t){var r=e.call(this,{logger:t.logger,emitter:t.emitter,debug:t.debug})||this;return r._neRtcServerAddresses=void 0,r._playOutVolume=null,r._recordVolume=null,r._isLocalCut=!1,r._isLocalSubCut=!1,r._remoteCanvasMap=new Map,r._remoteSubCanvasMap=new Map,r._microphones=null,r._cameras=null,r._speakers=null,r._gatherMediaParams={audio:!1,video:!1,screen:!1},r._profile={videoProfile:{resolution:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},screenProfile:{resolution:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_1080p,frameRate:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_5},audioProfile:"music_standard"},r._deviceIds={micId:"",speakerId:"",cameraId:""},r}return u(t,e),t.prototype.setUid=function(e){this._uid=e},t.prototype.setMediaParams=function(e){this._gatherMediaParams=Object.assign(this._gatherMediaParams,e)},t.prototype.close=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),this.logger.log(t.TAG_NAME,"close",e),this._gatherMediaParams[e]=!1,this.localStream?[4,this.localStream.close({type:e})]:[3,3];case 1:return r.sent(),"screen"===e&&this.localStream.screenAudio?[4,this.localStream.close({type:"screenAudio"})]:[3,3];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:throw r.sent();case 5:return[2]}}))}))},t.prototype.setupRemoteStreamContext=function(e){throw new Error("Method not implemented.")},t.prototype.setClientRole=function(e){return this._client.setClientRole(e)},t.prototype.destroy=function(){this.debug=!1,this.nrtcAppKey="",this._neRtcServerAddresses=void 0,this._resetState(),this._removeRtcListener(),this._client&&this._client.destroy(),this._client=void 0},t.prototype.getAudioLevel=function(){return this.localStream?100*Number(this.localStream.getAudioLevel()):-1},t.prototype.getCameraId=function(){return this._deviceIds.cameraId},t.prototype.getLocalStream=function(){return this.localStream},t.prototype.getMicId=function(){return this._deviceIds.micId},t.prototype.getOutVolume=function(){return 0},t.prototype.getSpeakerId=function(){return this._deviceIds.speakerId},t.prototype.init=function(e){this._neRtcServerAddresses=e.neRtcServerAddresses,NERTC.exports.Logger.enableLogUpload(),this._client=NERTC.exports.createClient({appkey:e.nrtcAppKey,debug:this.debug}),this._addRtcListener(),NERTC.exports.getParameters().controlOnPaused=!1,NERTC.exports.getParameters().hideControlOnResume=!1},t.prototype.joinRtcChannel=function(e,r){return h(this,void 0,void 0,(function(){var n,i,o,s,a,c,u,l,p,m;return d(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,14,,15]),this._uid=e.uid,!this._client)throw new Error("client is not init");return this.logger.debug(t.TAG_NAME,"joinRtcChannel"),[4,this._client.join({channelName:e.channelName,uid:e.uid,token:e.token,neRtcServerAddresses:this._neRtcServerAddresses||{},joinChannelRecordConfig:!1!==(null==r?void 0:r.noCloudRecord)?void 0:{isHostSpeaker:!1,recordAudio:!0,recordVideo:!0,recordType:0}})];case 1:n=d.sent(),d.label=2;case 2:return d.trys.push([2,12,,13]),[4,this._getDefaultDevice("camera")];case 3:return(i=d.sent())&&(this._deviceIds.cameraId=i.deviceId),[4,this._getDefaultDevice("microphone")];case 4:return(o=d.sent())&&(this._deviceIds.micId=o.deviceId),[4,this._getDefaultDevice("speaker")];case 5:return(s=d.sent())&&(this._deviceIds.speakerId=s.deviceId),r?(this._gatherMediaParams.audio=!1===r.noAudio,this._gatherMediaParams.video=!1===r.noVideo):(this._gatherMediaParams.audio=!1,this._gatherMediaParams.video=!1),this._gatherMediaParams.screen=!1,a=this._gatherMediaParams,c=a.audio,u=a.video,l=a.screen,this._gatherMediaParams.audio||this._gatherMediaParams.video?(p=this._gatherMediaParams.video?"video":"audio",[4,this._initLocalStream({video:u,audio:c,screen:l,sourceId:""})]):[3,9];case 6:return d.sent(),[4,this.playLocalStream(p,{audio:!1,video:this._gatherMediaParams.video,screen:!1})];case 7:return d.sent(),[4,this._client.publish(this.localStream)];case 8:return d.sent(),[3,11];case 9:return[4,this._initLocalStream()];case 10:d.sent(),d.label=11;case 11:return[2,n];case 12:return d.sent(),[3,13];case 13:return[3,15];case 14:throw m=d.sent(),this.logger.error(t.TAG_NAME,"joinRtc fail: ",m),m;case 15:return[2]}}))}))},t.prototype.leaveRtcChannel=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,4,5]),this.logger.log(t.TAG_NAME,"leaveRtc"),this._client?[4,this._client.leave()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:throw e=r.sent(),this.logger.error(t.TAG_NAME,"leaveRtc fail: ",e),e;case 4:return this._resetState(),[7];case 5:return[2]}}))}))},t.prototype.open=function(e,r,n,i){return void 0===r&&(r={}),void 0===n&&(n=!0),h(this,void 0,void 0,(function(){var o,s,a,c,u,l;return d(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,27,,28]),!this._localView&&"audio"!=e)throw Error("localView is null");return this.logger.log(t.TAG_NAME,"open",e,r,n,i),this.localStream?[3,8]:(this._gatherMediaParams[e]=!0,[4,this._initLocalStream({audio:"audio"===e,video:"video"===e,screen:"screen"===e,sourceId:r.sourceId})]);case 1:return d.sent(),"video"!==e?[3,3]:[4,this.playLocalStream(e)];case 2:return d.sent(),[3,5];case 3:return"screen"!==e?[3,5]:[4,this.playLocalSubStream()];case 4:d.sent(),d.label=5;case 5:return n?[4,this._client.publish(this.localStream)]:[3,7];case 6:d.sent(),d.label=7;case 7:return[3,26];case 8:if(!this.localStream)throw Error("localStream is null");return(o=l$1({type:e,deviceId:"video"===e?i||this._deviceIds.cameraId:"audio"===e?this._deviceIds.micId:void 0,videoSource:this.enableExternalVideo?this.externalVideoSource:void 0},r)).screenAudio="screen"===e&&!o.sourceId,o=l$1(l$1({},o),r),"video"!==e?[3,9]:(s=this._profile.videoProfile,c=s.resolution,u=s.frameRate,this.localStream.setVideoProfile({resolution:c,frameRate:u}),[3,18]);case 9:if("audio"!==e)return[3,14];d.label=10;case 10:return d.trys.push([10,12,,13]),[4,this.setAudioProfile(this._profile.audioProfile)];case 11:case 12:return d.sent(),[3,13];case 13:return[3,18];case 14:if("screen"!==e)return[3,18];a=this._profile.screenProfile,c=a.resolution,u=a.frameRate,d.label=15;case 15:return d.trys.push([15,17,,18]),[4,this.localStream.setScreenProfile(c,u)];case 16:case 17:return d.sent(),[3,18];case 18:return[4,this.localStream.open(o)];case 19:return d.sent(),"screen"!==e?[3,21]:[4,this.playLocalSubStream()];case 20:return d.sent(),[3,23];case 21:return[4,this.playLocalStream(e)];case 22:d.sent(),d.label=23;case 23:return"audio"===e&&null!==this._recordVolume&&this.setCaptureVolume(this._recordVolume),"video"===e&&i&&(this._deviceIds.cameraId=i),n?[4,this._client.publish(this.localStream)]:[3,25];case 24:d.sent(),d.label=25;case 25:d.label=26;case 26:return[3,28];case 27:throw l=d.sent(),this.logger.error(t.TAG_NAME,"open fail: ",l),l;case 28:return[2]}}))}))},t.prototype.muteAudio=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.muteAudio()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.muteVideo=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.muteVideo()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.muteScreen=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.muteScreen()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.unmuteVideo=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.unmuteVideo()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.unmuteAudio=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.unmuteVideo()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.unmuteScreen=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:if(!this._localView)throw Error("localView is null");if(this.logger.log(t.TAG_NAME,"muteAudio"),!this.localStream)throw Error("localStream is null");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.localStream.unmuteScreen()];case 2:return e.sent(),[3,4];case 3:throw e.sent();case 4:return[2]}}))}))},t.prototype.playLocalSubStream=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),!this._localSubView)throw Error("localSubView is null");if(!this.localStream)throw Error("localStream is null");return[4,this.localStream.play(this._localSubView,{audio:!1,video:!1,screen:!0,audioSlave:!0})];case 1:return r.sent(),this.localStream.setLocalRenderMode({width:this._localSubView.clientWidth,height:this._localSubView.clientHeight,cut:this._isLocalSubCut},"screen"),[3,3];case 2:throw e=r.sent(),this.logger.error(t.TAG_NAME,"playLocalSubStream fail: ",e),e;case 3:return[2]}}))}))},t.prototype.stopLocalStream=function(e){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.localStream.stop(e)];case 1:return n.sent(),[3,3];case 2:throw r=n.sent(),this.logger.error(t.TAG_NAME,"stopLocalStream fail: ",r),r;case 3:return[2]}}))}))},t.prototype.playLocalStream=function(e,r){return void 0===r&&(r={audio:!1,video:!0,screen:!1}),h(this,void 0,void 0,(function(){var n;return d(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this._localView&&"audio"!=e)throw Error("localView is null");return this.localStream?(r.video&&"video"===e&&this.localStream.stop("video"),[4,this.localStream.play(this._localView,r)]):(this.logger.warn("localStream is null"),[2]);case 1:return i.sent(),this.localStream.setLocalRenderMode({width:this._localView?this._localView.clientWidth:0,height:this._localView?this._localView.clientHeight:0,cut:this._isLocalCut}),[3,3];case 2:throw n=i.sent(),this.logger.error(t.TAG_NAME,"playLocalStream fail: ",n),n;case 3:return[2]}}))}))},t.prototype.playLocalVideo=function(e){return h(this,void 0,void 0,(function(){var r,n,i,o,s;return d(this,(function(a){switch(a.label){case 0:return a.trys.push([0,9,,10]),this.logger.log(t.TAG_NAME,"playLocalVideo",e),r=e.view,n=e.cut,i=void 0!==n&&n,o=e.subView,e.subCut,this.localStream?[3,2]:[4,this._initLocalStream({audio:!1,video:!0,screen:!1,sourceId:""})];case 1:a.sent(),a.label=2;case 2:return this._isLocalCut=i,this._localView=r,[4,this.playLocalStream("video")];case 3:return a.sent(),o?(this._isLocalSubCut=i,this._localSubView=r,[4,this.playLocalSubStream()]):[3,5];case 4:a.sent(),a.label=5;case 5:return this._client&&this.localStream?[4,this._client.publish(this.localStream)]:[3,7];case 6:return a.sent(),[3,8];case 7:throw Error("client or localStream is null");case 8:return[3,10];case 9:throw s=a.sent(),this.logger.error(t.TAG_NAME,"playLocalVideo fail: ",s),s;case 10:return[2]}}))}))},t.prototype.setupLocalVideoCanvas=function(e){var t;if(!(t=e&&"[object String]"==Object.prototype.toString.call(e)?document.querySelector(e)||void 0:e))throw new Error("view is not exit");this._localView=t,this._localSubView=t},t.prototype.setupRemoteVideoCanvas=function(e,t){this._remoteCanvasMap.set(t,e)},t.prototype.setupRemoteSubStreamVideoCanvas=function(e,t){this._remoteSubCanvasMap.set(t,e)},t.prototype.stopPlayingRemoteStream=function(e,t){t&&t.stop(e)},t.prototype.setPlaybackVolume=function(e){this.setOutVolume(e)},t.prototype.setAudioVolume=function(e){this.setOutVolume(e)},t.prototype.playRemoteStream=function(e){return h(this,void 0,void 0,(function(){var r,n,i,o,s,a,c,u,l,p;return d(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,3,,4]),this.logger.log(t.TAG_NAME,"playRemoteVideo",e),r=e.stream,n=e.cut,i=void 0!==n&&n,o=e.type,s=this._remoteCanvasMap.get(e.uid),a=this._remoteSubCanvasMap.get(e.uid),r.video&&!s&&"video"===o)throw new Error("view is null");if("screen"===o&&!a)throw new Error("subview is null");return c=o===f.Screen||o===f.AudioSlave,u=c?a:s,l={audio:!1,video:!1,screen:!1,audioSlave:!1},o===f.Audio?(u=u||"",l.audio=!0):o===f.Video?(r.stop(f.Video),l.video=!0):o===f.Screen?(r.stop(f.Screen),l.screen=!0):o===f.AudioSlave&&(r.stop(f.AudioSlave),l.audioSlave=!0),this.logger.debug("playOptions",l),[4,r.play(u,l)];case 1:return d.sent(),[4,r.setRemoteRenderMode({width:u?u.clientWidth:0,height:u?u.clientHeight:0,cut:i},c?"screen":"video")];case 2:return d.sent(),[3,4];case 3:throw p=d.sent(),this.logger.error(t.TAG_NAME,"playRemoteVideo fail: ",p),p;case 4:return[2]}}))}))},t.prototype.setCaptureVolume=function(e,t){void 0===t&&(t="microphone"),this.logger.log("setPlaybackVolume",e),this.localStream&&this.localStream.hasAudio()&&this.localStream.setCaptureVolume(e,t),this._recordVolume=e},t.prototype.setChannelProfile=function(e){this._client.setChannelProfile(e)},t.prototype.pauseAllEffects=function(){return this.localStream.pauseAllEffects()},t.prototype.pauseEffect=function(e){return this.localStream.pauseEffect(e)},t.prototype.resumeEffect=function(e){return this.localStream.resumeEffect(e)},t.prototype.resumeAllEffects=function(){return this.localStream.resumeAllEffects()},t.prototype.muteAudioSlave=function(){return this.localStream.muteAudioSlave()},t.prototype.unmuteAudioSlave=function(){return this.localStream.unmuteAudioSlave()},t.prototype.getAudioEffectsDuration=function(e){return this.localStream.getAudioEffectsDuration(e)},t.prototype.setOutVolume=function(e){this.logger.log("setPlaybackVolume",e),this._client&&this._client.setPlaybackVolume(e),this._playOutVolume=e},t.prototype.setProfile=function(e){var t={resolution:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},r={resolution:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},n=K[e.audioProfile]||K.music_standard;e.videoProfile&&(t.resolution=de[e.videoProfile.resolution]||NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,t.frameRate=he[e.videoProfile.frameRate]||NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25),e.screenProfile&&(r.resolution=de[e.screenProfile.resolution]||NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,r.frameRate=he[e.screenProfile.frameRate]||NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25),this._profile=l$1(l$1({},this._profile),{videoProfile:t,audioProfile:n,screenProfile:r})},t.prototype.subscribe=function(e,t){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:return this._client?(t&&e.setSubscribeConfig(t),[4,this._client.subscribe(e)]):[3,4];case 1:return n.sent(),!t.highOrLow&&0!==t.highOrLow||!t.video?[3,3]:(NERTC.exports.STREAM_TYPE.HIGH,r=1===t.highOrLow?NERTC.exports.STREAM_TYPE.LOW:NERTC.exports.STREAM_TYPE.HIGH,this.logger.log("setRemoteStreamType",r),[4,this._client.setRemoteStreamType(e,r,"video")]);case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:throw new Error("client is null");case 5:return[2]}}))}))},t.prototype.switchDevice=function(e){var t;return h(this,void 0,void 0,(function(){var r,n,i;return d(this,(function(o){switch(o.label){case 0:r=e.type,n=e.deviceId,this.logger.log("switchDevice",JSON.stringify({type:r,deviceId:n})),o.label=1;case 1:switch(o.trys.push([1,13,,14]),r){case"camera":return[3,2];case"microphone":return[3,6];case"speaker":return[3,10]}return[3,11];case 2:return this.localStream&&this.localStream.hasVideo()?[3,3]:(this._deviceIds.cameraId=n,[3,5]);case 3:return[4,this.localStream.switchDevice("video",n)];case 4:o.sent(),this._deviceIds.cameraId=n,o.label=5;case 5:return[3,12];case 6:return this.localStream&&this.localStream.hasAudio()?[3,7]:(this._deviceIds.micId=n,[3,9]);case 7:return[4,this.localStream.switchDevice("audio",n)];case 8:o.sent(),this._deviceIds.micId=n,o.label=9;case 9:return[3,12];case 10:if(!this._client)throw new Error("client is not init");return Object.values(this._client.adapterRef.remoteStreamMap).forEach((function(e){e.setAudioOutput(n)})),this._deviceIds.speakerId=n,[3,12];case 11:return[3,12];case 12:return this.logger.log("switchDevice success",{type:r,deviceId:n}),[2,{type:r,deviceId:n}];case 13:if(i=o.sent(),1008===(null===(t=null==i?void 0:i.getCode)||void 0===t?void 0:t.call(i)))return[2,Promise.resolve({type:r,deviceId:n})];throw this.logger.error("switchDevice fail: ",i),i;case 14:return[2]}}))}))},t.prototype.takeSnapshot=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return this.localStream?[4,this.localStream.takeSnapshot(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.unsubscribe=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return this._client?[4,this._client.unsubscribe(e)]:[3,2];case 1:return t.sent(),[3,3];case 2:throw new Error("client is null");case 3:return[2]}}))}))},t.prototype.setupRemoteSubVideoCanvas=function(e,t){this._remoteSubCanvasMap.set(t,e)},t.prototype.checkSystemRequirements=function(){return NERTC.exports.checkSystemRequirements()},t.prototype.createClient=function(e){return h(this,void 0,void 0,(function(){var t,r;return d(this,(function(n){return t=e.appkey,r=e.debug,[2,NERTC.exports.createClient({appkey:t,debug:r})]}))}))},t.prototype.getMicrophones=function(){return h(this,void 0,void 0,(function(){var e,t;return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this,[4,NERTC.exports.getMicrophones()];case 1:return e._microphones=r.sent(),[2,JSON.parse(JSON.stringify(this._microphones))];case 2:throw t=r.sent(),new Error(t);case 3:return[2]}}))}))},t.prototype.getCameras=function(){return h(this,void 0,void 0,(function(){var e,t;return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,NERTC.exports.getCameras()];case 1:return e=r.sent(),this._cameras=p([],_(e),!1),[2,JSON.parse(JSON.stringify(this._cameras))];case 2:throw t=r.sent(),new Error(t);case 3:return[2]}}))}))},t.prototype.getSpeakers=function(){return h(this,void 0,void 0,(function(){var e,t;return d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this,[4,NERTC.exports.getSpeakers()];case 1:return e._speakers=r.sent(),[2,JSON.parse(JSON.stringify(this._speakers))];case 2:throw t=r.sent(),new Error(t);case 3:return[2]}}))}))},t.prototype.getDeviceListData=function(){return h(this,void 0,void 0,(function(){var e,r,n,i,o,s,a,c,u,l,p;return d(this,(function(d){switch(d.label){case 0:return d.trys.push([0,6,,7]),this.localStream?[3,2]:[4,this._initLocalStream({audio:!0,video:!0,screen:!0,sourceId:""})];case 1:d.sent(),d.label=2;case 2:return this.logger.log(t.TAG_NAME,"getDeviceListData--start--"),[4,this.getMicrophones()];case 3:return e=d.sent(),[4,this.getCameras()];case 4:return r=d.sent(),[4,this.getSpeakers()];case 5:return n=d.sent(),i=null==r?void 0:r.find((function(e){return"default"===e.deviceId})),o=null==e?void 0:e.find((function(e){return"default"===e.deviceId})),s=null==n?void 0:n.find((function(e){return"default"===e.deviceId})),a=(null==i?void 0:i.deviceId)||this._deviceIds.cameraId||(r[0]?r[0].deviceId:""),c=(null==o?void 0:o.deviceId)||this._deviceIds.micId||(e[0]?e[0].deviceId:""),u=(null==s?void 0:s.deviceId)||this._deviceIds.speakerId||(n[0]?n[0].deviceId:""),l={microphones:e,cameras:r,speakers:n,speakerSelect:u,microphoneSelect:c,cameraSelect:a},this.logger.log(t.TAG_NAME,"getDeviceListData success",l),[2,l];case 6:throw p=d.sent(),this.logger.log(t.TAG_NAME,"getDeviceListData fail",p),new Error(p);case 7:return[2]}}))}))},t.prototype.unpublish=function(){return h(this,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._client.unpublish(this.localStream)];case 1:return t.sent(),[3,3];case 2:throw e=t.sent(),new Error(e);case 3:return[2]}}))}))},t.prototype.setVideoProfile=function(e,r){return h(this,void 0,void 0,(function(){return d(this,(function(n){try{this.logger.log(t.TAG_NAME,"setVideoProfile",e,r),e=de[e]||NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,r=he[r]||NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25,this._profile.videoProfile={frameRate:r,resolution:e},this.localStream&&(this.logger.log(t.TAG_NAME,"localStream",this.localStream),this.localStream.setVideoProfile({resolution:e,frameRate:r}))}catch(e){throw new Error(e)}return[2]}))}))},t.prototype.setScreenProfile=function(e,r){return h(this,void 0,void 0,(function(){return d(this,(function(n){try{this.logger.log(t.TAG_NAME,"setScreenProfile",e,r),e=de[e]||NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,r=he[r]||NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25,this._profile.screenProfile={frameRate:r,resolution:e},this.localStream&&(this.logger.log(t.TAG_NAME,"localStream",this.localStream),this.localStream.setScreenProfile({resolution:e,frameRate:r}))}catch(e){throw new Error(e)}return[2]}))}))},t.prototype.setAudioProfile=function(e){var r;return h(this,void 0,void 0,(function(){var n;return d(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),this.logger.log(t.TAG_NAME,"setAudioProfile--start--",e),this._profile.audioProfile=K[e]||K.music_standard,this.localStream?[3,2]:[4,this._initLocalStream()];case 1:return i.sent(),[3,3];case 2:null===(r=this.localStream)||void 0===r||r.setAudioProfile(e),i.label=3;case 3:return[3,5];case 4:throw n=i.sent(),new Error(n);case 5:return[2]}}))}))},t.prototype.getLocalAudioStats=function(){return this._client?this._client.getLocalAudioStats():(this.logger.warn("client not exited"),[])},t.prototype.getTransportStats=function(){var e;return null===(e=this._client)||void 0===e?void 0:e.getTransportStats()},t.prototype.addTasks=function(e){return this._client.addTasks(e)},t.prototype.updateTasks=function(e){return this._client.updateTasks(e)},t.prototype.deleteTasks=function(e){return this._client.deleteTasks(e)},t.prototype.playEffect=function(e){return this.localStream.playEffect(e)},t.prototype.stopEffect=function(e){return this.localStream.stopEffect(e)},t.prototype.stopAllEffects=function(){return this.localStream.stopAllEffects()},t.prototype.setEffectsVolume=function(e){this.localStream.setEffectsVolume(e)},t.prototype.startAudioMixing=function(e){return this.localStream.startAudioMixing(e)},t.prototype.stopAudioMixing=function(){return this.localStream.stopAudioMixing()},t.prototype.adjustAudioMixingVolume=function(e){return this.localStream.adjustAudioMixingVolume(e)},t.prototype.getLocalVideoStats=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return this._client?[2,this._client.getLocalVideoStats()]:(this.logger.warn("client not exited"),[2,{}])}))}))},t.prototype.getRemoteAudioStats=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return this._client?[2,this._client.getRemoteAudioStats()]:(this.logger.warn("client not exited"),[2,{}])}))}))},t.prototype.getRemoteVideoStats=function(e){return h(this,void 0,void 0,(function(){return d(this,(function(t){return this._client?[2,this._client.getRemoteVideoStats(e)]:(this.logger.warn("client not exited"),[2,{}])}))}))},t.prototype.getSessionStats=function(){return h(this,void 0,void 0,(function(){return d(this,(function(e){return this._client?[2,this._client.getSessionStats()]:(this.logger.warn("client not exited"),[2,{}])}))}))},t.prototype._addRtcListener=function(){var e=this;this._client&&(this._client.on("stream-added",(function(t){e.emit(N.STREAM_ADDED,t)})),this._client.on("stream-removed",(function(t){e.emit(N.STREAM_REMOVED,t)})),this._client.on("stream-subscribed",(function(t){e.emit(N.STREAM_SUBSCRIBED,t)})),this._client.on("stopScreenSharing",(function(t){e.emit(N.STOP_SCREEN_SHARE,t)})),this._client.on("peer-online",(function(t){e.emit(N.PEER_ONLINE,t)})),this._client.on("peer-leave",(function(t){e.emit(N.PEER_LEAVE,t)})),this._client.on("volume-indicator",(function(t){e.emit(N.VOLUME_INDICATOR,t)})),this._client.on("active-speaker",(function(t){e.emit(N.ACTIVE_SPEAKER,t)})),this._client.on(N.RECORD_DEVICES_CHANGE,(function(t){"CHANGED"===t.state&&(e._deviceIds.micId=t.device.deviceId),e.emit(N.RECORD_DEVICES_CHANGE,t)})),this._client.on(N.CAMERA_DEVICE_CHANGE,(function(t){"CHANGED"===t.state&&(e._deviceIds.cameraId=t.device.deviceId),e.emit(N.CAMERA_DEVICE_CHANGE,t)})),this._client.on(N.SPEAKER_DEVICE_CHANGE,(function(t){"CHANGED"===t.state&&(e._deviceIds.speakerId=t.device.deviceId),e.emit(N.SPEAKER_DEVICE_CHANGE,t)})),this._client.on(N.CONNECTION_STATE_CHANGE,(function(t){e.emit(N.CONNECTION_STATE_CHANGE,t)})),this._client.on(N.VIDEO_TRACK_ENDED,(function(){e.emit(N.VIDEO_TRACK_ENDED)})),this._client.on(N.ERROR,(function(t){e.emit(N.ERROR,t)})),this._client.on(N.NETWORK_QUALITY,(function(t){e.emit(N.NETWORK_QUALITY,t)})))},t.prototype._removeRtcListener=function(){this._client&&(this._client.off("peer-online"),this._client.off("peer-leave"),this._client.off("stream-added"),this._client.off("stream-removed"),this._client.off("stream-subscribed"),this._client.off("network-quality"),this._client.off("client-banned"),this._client.off("channel-closed"),this._client.off("connection-state-change"),this._client.off("stopScreenSharing"),this._client.off("recording-device-changed"))},t.prototype._getDefaultDevice=function(e){return h(this,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:switch(t=[],e){case"camera":return[3,1];case"microphone":return[3,3];case"speaker":return[3,5]}return[3,7];case 1:return[4,this.getCameras()];case 2:case 4:case 6:return t=r.sent(),[3,7];case 3:return[4,this.getMicrophones()];case 5:return[4,this.getSpeakers()];case 7:return t.length?[2,t.find((function(e){return"default"===e.deviceId}))||t[0]]:[2,void 0]}}))}))},t.prototype._initLocalStream=function(e){return void 0===e&&(e={video:!1,audio:!1,screen:!1,sourceId:""}),h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,2,,3]),this.logger.debug("_initLocalStream",e),!this._uid)throw Error("no uid, please joinRtc first.");return this.localStream=NERTC.exports.createStream({audio:e.audio,video:e.video,screen:e.screen,screenAudio:e.screen,uid:this._uid,client:this._client,microphoneId:this._deviceIds.micId,cameraId:this._deviceIds.cameraId,videoSource:this.enableExternalVideo?this.externalVideoSource:void 0,sourceId:e.sourceId}),this._setMediaProfile(),[4,this.localStream.init()];case 1:return n.sent(),null!==this._recordVolume&&e.audio&&this.setCaptureVolume(this._recordVolume),null!==this._playOutVolume&&this.setOutVolume(this._playOutVolume),[3,3];case 2:throw r=n.sent(),this.localStream=null,this.logger.error(t.TAG_NAME,"initLocalStream fail: ",r),r;case 3:return[2]}}))}))},t.prototype._setMediaProfile=function(){if(this.localStream){var e=this._profile.videoProfile,t=this._profile.screenProfile;this.localStream.setVideoProfile({resolution:e.resolution,frameRate:e.frameRate}),this.localStream.setScreenProfile({resolution:t.resolution,frameRate:t.frameRate}),this.localStream.setAudioProfile(this._profile.audioProfile)}},t.prototype._resetState=function(){this._uid=void 0,this._deviceIds={micId:"",speakerId:"",cameraId:""},this._profile={videoProfile:{resolution:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},screenProfile:{resolution:NERTC.exports.VIDEO_QUALITY.VIDEO_QUALITY_720p,frameRate:NERTC.exports.VIDEO_FRAME_RATE.CHAT_VIDEO_FRAME_RATE_25},audioProfile:"music_standard"},this._localView=void 0,this._localSubView=void 0,this._isLocalCut=!1,this._isLocalSubCut=!1,this._gatherMediaParams={audio:!1,video:!1,screen:!1},this._playOutVolume=null,this._recordVolume=null,this.localStream&&(this.localStream.destroy(),this.localStream=void 0)},t.checkSystemRequirementsStatic=function(){return NERTC.exports.checkSystemRequirements()},t.TAG_NAME="NERTC",t.version=NERTC.exports.VERSION,t}(le),_e=function(){function e(e){var t=e.level,r=e.appName,n=void 0===r?"":r,i=e.version,o=void 0===i?"":i,s=e.eventTracking;this.appKey="",this.isOpenEventTracking=!0,this._genUserAgent=function(){var e=String(navigator.userAgent).toLocaleLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/)||[];return{browser:e[1]?e[1].replace(/version/,"safari"):"unknow",ver:e[2]?e[2]:"unknow"}},this.level=C[t],this.appName=n,this.version=o,this.eventTracking=s}return e.prototype.tracking=function(e,t,r){var n;this.isOpenEventTracking&&(null===(n=this.eventTracking)||void 0===n||n.track(e,l$1({module:t},r))),this.log(t,r)},e.prototype.setLevel=function(e){this.level=C[e]},e.prototype.setEventTracking=function(e){this.isOpenEventTracking=e},e.prototype.log=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._print.apply(this,p(["log",e],_(t),!1))},e.prototype.trace=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._print.apply(this,p(["trace",e],_(t),!1))},e.prototype.debug=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._print.apply(this,p(["debug",e],_(t),!1))},e.prototype.info=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._print.apply(this,p(["info",e],_(t),!1))},e.prototype.warn=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._print.apply(this,p(["warn",e],_(t),!1))},e.prototype.error=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._print.apply(this,p(["error",e],_(t),!1))},e.prototype.setAppKey=function(e){this.appKey=e,this.eventTracking&&(this.eventTracking.appKey=e)},e.prototype._print=function(e,t){for(var r=this,n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={log:"I",debug:"D",info:"I",warn:"W",error:"E"};if(C[e]>=this.level&&console[e]){var s=n;if(Array.isArray(n)&&(s=n.map((function(e){return r._sensitive(e)}))),"roomkit-wx"===this.appName)console[e].apply(console,p(["".concat(this._genTime(),"[").concat(o[e],"][").concat(this.appName," ").concat(this.version,"][").concat(t,"]").concat("log"===e?"[API]":"")],_(s),!1));else{var a=this._genUserAgent();console[e].apply(console,p(["".concat(this._genTime(),"[").concat(o[e],"][").concat(this.appName," ").concat(this.version," ").concat(a.browser,":").concat(a.ver,"][").concat(t,"]").concat("log"===e?"[API]":"")],_(s),!1))}}},e.prototype._genTime=function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours()<10?"0".concat(e.getHours()):e.getHours(),o=e.getMinutes()<10?"0".concat(e.getMinutes()):e.getMinutes(),s=e.getSeconds()<10?"0".concat(e.getSeconds()):e.getSeconds();return"".concat(t,"-").concat(r,"-").concat(n," ").concat(i,":").concat(o,":").concat(s)},e.prototype._sensitive=function(e){var t=e;if("[object Object]"===Object.prototype.toString.call(e)||Array.isArray(e))try{t=JSON.stringify(e)}catch(e){}else"[object Number]"===Object.prototype.toString.call(e)&&(t=String(e));return"[object String]"===Object.prototype.toString.call(t)?t=this._replace(t):t},e.prototype._replace=function(e){var t=this;return e.replace(/(["']?)(appkey|rtcKey|imKey)(["']?:\s*?["'])([a-z0-9]{32})(["'])/gi,(function(e,r,n,i,o,s){return"".concat(r).concat(n).concat(i).concat(t._replacePos(o,4,4)).concat(s)}))},e.prototype._replacePos=function(e,t,r){var n=e,i=e.length;if(t>i)return e;if(t<i-r){var o=n.substring(0,t),s=n.substring(i-4,i);n="".concat(o,"******").concat(s)}else t>=i-r&&(o=n.substring(0,t),n="".concat(o,"******"));return n},e}(),pe=function(){function e(e){var t=e.logger,r=e.debug,n=e.emitter,i=e.deviceId,o=e.version,s=e.clientType,a=e.reuseIM;this.nim=null,this.privateConf=void 0,this.imPrivateConf=void 0,this.appKey="",this.debug=!1,this.token="",this.account="",this.roomAppKey="",this.roomAccountId="",this.roomAccountToken="",this.deviceId="",this.isReuseIM=!1,this.logger=t,this.debug=r,this.emitter=n,this.deviceId=i,this.version=o,this.clientType=s,this.isReuseIM=!!a,this.isReuseIM&&(this.nim=a)}return e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];(t=this.emitter).emit.apply(t,p([e],_(r),!1))},e}(),fe=function(e){function t(t){return e.call(this,t)||this}return u(t,e),t.prototype.init=function(e){this.appKey=e.appKey,this.token=e.token,this.account=e.account,this.imPrivateConf=e.imPrivateConf,this.roomAccountId=e.roomAccountId,this.roomAppKey=e.roomAppKey,this.roomAccountToken=e.roomAccountToken},t.prototype.resetState=function(){this.isReuseIM||this.nim.removeAllListeners(),this.nim=null},t.prototype.destroy=function(){return this.appKey="",this.token="",this.account="",this.imPrivateConf=void 0,this.roomAccountId="",this.roomAppKey="",this.roomAccountToken="",this.roomId="",this._nimKitInstance&&(this._nimKitInstance.off("logined"),this._nimKitInstance.off("willReconnect"),this._nimKitInstance.off("disconnect"),this._nimKitInstance.off("kicked"),this._nimKitInstance.off("proxyMsg")),this.logout()},t.prototype.login=function(){var e=this;return new Promise((function(r,n){if(e.isReuseIM){if(!e.nim)throw new Error("nim is null");return e.nim.options.account!==e.account?(e.logger.error("reuse IM, but IM account not match",e.nim.options.account,e.account),n(M.IM_REUSE_ACCOUNT_NOT_MATCH)):e.nim.protocol.isConnected()?r():n(M.IM_REUSE_NOT_LOGIN)}var i={};if(e.imPrivateConf){var o=e.imPrivateConf,s=o.lbs,a=o.link,c=o.linkSslWeb,u=o.nosUploader,l=o.httpsEnabled,d=o.nosDownloader,p=o.nosLbs;i.nos_lbs=p,i.lbs_web=s,i.link_web=a,i.nos_uploader_web=u,i.link_ssl_web=c,i.https_enabled=l,i.nos_downloader=d,e.privateConf=i}if(e.nim)return r();var m=new(NimKitCoreFactory(1))({initOptions:{account:e.account,appkey:e.appKey,token:e.token,customTag:e.deviceId,debugLevel:e.debug?"debug":"off"},otherOptions:{serverConfig:l$1(l$1({},i),e.imPrivateConf)}});e._nimKitInstance=m,e.nim=m.getNIM(),m.on("logined",(function(n){e.logger.log(t.TAG_NAME,"login connected"),e.emit("imConnect",n),r()})),m.on("willReconnect",(function(r){e.logger.log(t.TAG_NAME,"onwillreconnect",r),e.emit("imWillReConnect",r)})),m.on("disconnect",(function(){e.logger.log(t.TAG_NAME,"login disconnect"),e.emit("imDisconnect",{code:302}),e.resetState(),n({code:302})})),m.on("kicked",(function(r){e.logger.log(t.TAG_NAME,"login disconnect",r),e.emit("imDisconnect",r),e.resetState(),n(r)})),m.on("proxyMsg",(function(r){e.emit("controlNotify",r),e.logger.debug(t.TAG_NAME,"onProxyMsg",JSON.stringify(r))}))}))},t.prototype.logout=function(){var e=this;return new Promise((function(t,r){if(e.isReuseIM)return e.emit("imLogout",null),t();e.nim?e.nim.destroy({done:function(r){e.emit("imLogout",r),e.nim=null,t()}}):t()}))},t.prototype.setRoomId=function(e){this.roomId=e},t.prototype.sendHostProxy=function(e){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:this.logger.log(t.TAG_NAME,"sendHostProxy",e),n.label=1;case 1:if(n.trys.push([1,3,,4]),!this.roomId)throw new Error("roomId is empty");return[4,this.sendProxy({path:"/v1/sdk/meeting/control/host",body:{meetingId:this.roomId,action:e.action,members:e.accountIds,avRoomUids:e.avRoomUids}})];case 2:return n.sent(),[3,4];case 3:throw r=n.sent(),this.logger.error(t.TAG_NAME,"sendHostProxy fail: ",r),r;case 4:return[2]}}))}))},t.prototype.sendMemberProxy=function(e){return h(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:this.logger.log(t.TAG_NAME,"sendMemberProxy"),n.label=1;case 1:if(n.trys.push([1,3,,4]),!this.roomId)throw new Error("roomId is empty");return[4,this.sendProxy({path:"/v1/sdk/meeting/control/member",body:{meetingId:this.roomId,action:e.action,avRoomUids:e.avRoomUids}})];case 2:return n.sent(),[3,4];case 3:throw r=n.sent(),this.logger.error(t.TAG_NAME,"sendMemberProxy fail: ",r),r;case 4:return[2]}}))}))},t.prototype.sendProxy=function(e){var t=this,r={clientType:this.clientType,meetingSdkVersion:this.version,appKey:this.roomAppKey,accountId:this.roomAccountId,accountToken:this.roomAccountToken,deviceId:this.deviceId};return new Promise((function(n,i){if(!t.nim)throw new Error("nim is null");return t.nim.options.account!==t.account?(t.logger.error("reuse IM, but IM account not match",t.nim.options.account,t.account),i(M.IM_REUSE_ACCOUNT_NOT_MATCH)):t.nim.protocol.isConnected()?void t.nim.httpRequestProxy({header:JSON.stringify(r),path:e.path,body:JSON.stringify(e.body),done:function(e,t){e?i(e):n(JSON.parse(t.body))}}):(t.logger.error("reuse IM, but IM not login"),i(M.IM_REUSE_NOT_LOGIN))}))},t.prototype.onReuseIm=function(e,r){if(this.isReuseIM)switch(e){case"reuseImWillReconnect":this.logger.log(t.TAG_NAME,"reuseImWillReconnect",r),this.emit("imWillReConnect",r);break;case"reuseImDisconnect":this.logger.log(t.TAG_NAME,"reuseImDisconnect"),this.emit("imDisconnect",r),this.resetState();break;case"reuseImError":this.logger.log(t.TAG_NAME,"reuseImError",r);break;case"reuseImMsgs":this.emit("onRecvMsg",r);break;case"reuseImProxyMsg":this.logger.log(t.TAG_NAME,"reuseImProxyMsg",r),this.emit("controlNotify",r)}},t.TAG_NAME="IMImpl",t}(pe),ge=function(e){function t(t){return e.call(this,{emitter:t.emitter,debug:t.debug,logger:t.logger,imImpl:t.im})||this}return u(t,e),t.prototype.login=function(e){var r=e.account,n=e.appKey,i=e.token,o=e.chatroomId,s=e.chatroomNick,a=e.tags,c=e.notifyTargetTags,u=e.chatroomCustom;return h(this,void 0,void 0,(function(){var e=this;return d(this,(function(l){return this.logger.log(t.TAG_NAME,"joinChatroom"),[2,new Promise((function(l,d){if(e.nim)return e._removeListener(),e._addListener(),void l();e.imImpl.nim.getChatroomAddress({chatroomId:o,done:function(p,m){if(p)return e.logger.log(t.TAG_NAME,"init fail: ",p),d(p);var f=ChatroomKitCoreFactory(1),h=e.imImpl.privateConf||{};e.logger.log("imPrivateConf",h);var g=new f({appkey:e.imImpl.appKey||n,needReconnect:!0,quickReconnect:!0,account:r,token:i,chatroomId:o,chatroomNick:s,tags:a,notifyTargetTags:c,chatroomExt:u,debugLevel:e.debug?"debug":"off",chatroomAddresses:m.address,commonUpload:!0,secure:!e.imImpl.imPrivateConf||!1!==e.imImpl.imPrivateConf.httpsEnabled,privateConf:l$1({},h)});e.chatroomKitInstance=g,g.on("logined",(function(){e.logger.log(t.TAG_NAME,"chatroom onconnect"),e.isConnect=!0,e.imAccid=r,e.nim=g.getChatroom(),l()})),g.on("disconnect",(function(r){e.logger.log(t.TAG_NAME,"chatroom ondisconnect"),e.resetState(),d()})),e._addListener()}})}))]}))}))},t.prototype.logout=function(){return h(this,void 0,void 0,(function(){return d(this,(function(t){return this._removeListener(),this.chatroomKitInstance?[2,e.prototype.logout.call(this)]:[2]}))}))},t.prototype._addListener=function(){var e=this;this.chatroomKitInstance&&(this.chatroomKitInstance.on("chatroomMsg",(function(r){e.logger.log(t.TAG_NAME,"chatroom onmsgs",r),e.parseMsgs(r)})),this.chatroomKitInstance.on("error",(function(r){e.logger.log(t.TAG_NAME,"chatroom error: ",r)})))},t.prototype._removeListener=function(){this.chatroomKitInstance&&(this.chatroomKitInstance.off("disconnect"),this.chatroomKitInstance.off("error"),this.chatroomKitInstance.off("chatroomMsg"))},t.TAG_NAME="NERoomChat-Web",t}(function(){function e(e){this.imAccid="",this.isConnect=!1,this.debug=e.debug,this.imImpl=e.imImpl,this.logger=e.logger,this.emitter=e.emitter}return e.prototype.logout=function(){var e=this;return new Promise((function(t,r){e.nim?(e.nim.destroy({done:function(e){e?r(e):t()}}),e.resetState()):t()}))},e.prototype.sendTextMessage=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return this.nim.sendText(e)},e.prototype.resendTextMessage=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return this.nim.sendText(l$1(l$1({},e),{flow:"out",status:"fail",resend:!0}))},e.prototype.sendFileMessage=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return this.nim.sendFile(e)},e.prototype.resendFileMessage=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return this.nim.sendFile(l$1(l$1({},e),{flow:"out",status:"fail",resend:!0}))},e.prototype.getHistoryMsgs=function(e){if(!this.nim||!this.isConnect)throw"Chatroom disconnected.";return e=e||{},this.nim.getHistoryMsgs(l$1({},e))},e.prototype.getMembers=function(e){var t=this,r=e.guest,n=void 0===r||r,i=e.limit,o=void 0===i?100:i,s=e.time;return new Promise((function(e,r){t.nim.getChatroomMembers({guest:n,limit:o,time:s,done:function(n,i){if(n)return t.logger.error("getMembers failed: ",n),r(n);t.logger.log("getMembers success: ",i),e(i.members)}})}))},e.prototype.updateMyChatroomMemberInfo=function(e){var t=this;return new Promise((function(r,n){t.nim.updateMyChatroomMemberInfo(l$1(l$1({},e),{done:function(e,i){if(e)return t.logger.error("updateMyChatroomMemberInfo failed: ",e),n(e);t.logger.log("updateMyChatroomMemberInfo success: ",i),r(i.members)}}))}))},e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.off=function(e){this.emitter.off(e)},e.prototype.parseMsgs=function(e){var t=this,r=e.map((function(e){return l$1(l$1({},e),{isMe:e.fromUserUuid===t.imAccid})}));this.emitter.emit("onRecvMsg",r)},e.prototype.resetState=function(){this.nim=null,this.isConnect=!1,this.imAccid=""},e}()),ve=function(e){function t(r){var n=this,i="https://roomkit.netease.im",o=axios.create({baseURL:i}),s=!r||!1!==r.debug,a=!r||!1!==r.eventTracking,u=new ce({appKey:"",baseDomain:i,clientType:c.WEB,request:o,token:"",userUuid:"",deviceId:t.getDeviceId(),versionCode:ae}),l=new _e({level:s?"log":"warn",appName:"RoomKit",version:ae,eventTracking:a?new EventTracking$1({appKey:"",version:ae,component:"RoomKit",nertcVersion:me.version,imVersion:"9.6.3",platform:"Web"}):void 0}),d=new Eventemitter,p={Chatroom:ge,Im:fe,Rtc:me,EventEmitter:Eventemitter,emitter:d,logger:l,request:u,debug:s,xKit:new XKit,deviceId:t.getDeviceId()};return(n=e.call(this,p)||this)._emitter=d,o.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),o.interceptors.response.use((function(e){var t=e.data.code;return 0!==t?(t==M.TOKEN_INCORRECT||t===M.UNAUTHORIZED?n._emitter.emit(O.UNAUTHORIZED,t):t===M.TOKEN_EXPIRED&&n._emitter.emit(O.TOKEN_EXPIRED,t),Promise.reject(e.data)):e.data}),(function(e){return Promise.reject(e)})),n}return u(t,e),Object.defineProperty(t.prototype,"deviceId",{get:function(){return t.getDeviceId()},enumerable:!1,configurable:!0}),t.getInstance=function(e){return t._instance||(t._instance=new t(e)),t._instance},t.getDeviceId=function(){var e,t=window.sessionStorage.getItem("NERoomkit-uuid");return t||(e=(new Date).getTime(),t="xxxxxxxx-xxxx-xxxx-xxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})),window.sessionStorage.setItem("NERoomkit-uuid",t),t)},t.checkSystemRequirements=function(){return me.checkSystemRequirementsStatic()},t._instance=null,t}(ue);const Auth=({renderCallback:e})=>{const[t,r]=react.exports.useState(!1),[n,i]=react.exports.useState(""),o=react.exports.useRef(""),[s,a]=react.exports.useState(!1),[c,u]=react.exports.useState(),[l,d]=react.exports.useState(""),{dispatch:p,memberList:m}=react.exports.useContext(MeetingInfoContext),{eventEmitter:f,neMeeting:h,dispatch:g}=react.exports.useContext(GlobalContext);react.exports.useEffect((()=>{null==f||f.on(UserEventType.LoginWithPassword,(e=>{const{options:t,callback:r}=e;b(t.username,t.password).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))})),null==f||f.on(UserEventType.Login,(e=>{const{options:t,callback:r}=e;v(t.accountId,t.accountToken).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))})),null==f||f.on(UserEventType.Logout,(e=>{const{callback:t}=e;y().then((()=>{t&&t()})).catch((e=>{t&&t(e)}))})),null==f||f.on(UserEventType.CreateMeeting,(e=>{const{options:t,callback:r}=e;S(t).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))})),null==f||f.on(UserEventType.JoinMeeting,(e=>{const{options:t,callback:r}=e;x(t).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))})),null==f||f.on(UserEventType.AnonymousJoinMeeting,(e=>{const{options:t,callback:r}=e;E(t).then((()=>{r&&r()})).catch((e=>{r&&r(e)}))}));try{null==h||h.getGlobalConfig().then((e=>{w({globalConfig:e})})),e&&e()}catch(e){console.warn("renderCallback failed",e)}}),[]),react.exports.useEffect((()=>{d("")}),[n]);const v=(e,t)=>h.login({accountId:e,accountToken:t,loginType:1}),y=()=>h.logout(),b=(e,t)=>h.login({username:e,password:t,loginType:2}),S=e=>h.create(e).then((()=>{const t=null==h?void 0:h.getMeetingInfo();console.log("创建会议成功",t),w({showSubject:!!e.showSubject}),t&&p&&p({type:ActionType.SET_MEETING,data:t})})),T=e=>{w({showSubject:!!e.showSubject,showMeetingRemainingTip:!!e.showMeetingRemainingTip}),p&&p({type:ActionType.UPDATE_MEETING_INFO,data:{isUnMutedVideo:1===e.video,isUnMutedAudio:1===e.audio}}),M();const t=null==h?void 0:h.getMeetingInfo();t&&t.meetingInfo&&(t.meetingInfo.isUnMutedAudio=1===e.audio,t.meetingInfo.isUnMutedVideo=1===e.video),t&&(m&&m.length>0&&m.forEach((e=>{const r=t.memberList.findIndex((t=>e.uuid==t.uuid));r<0&&(console.log("存在未同步>>",e),t.memberList.push(e))})),p&&p({type:ActionType.SET_MEETING,data:t}))},_=(e,t)=>{switch(e.code){case 3104:case 1004:Toast.info("会议不存在"),M();break;case 1020:o.current&&d("会议密码错误"),u(t),r(!0);break;case 1019:Toast.info("会议已锁定，新参会者将无法加入会议"),M();break;default:Toast.info(e.message),M(),console.log(e,"加入失败")}};function w(e){g&&g({type:ActionType.UPDATE_GLOBAL_CONFIG,data:e})}function M(){g&&g({type:ActionType.JOIN_LOADING,data:!1}),r(!1),i(""),d(""),a(!1),o.current=""}const x=e=>{if(!e.meetingId&&!e.meetingNum)throw Toast.info("请输入会议号"),new Error("meetingNum is empty");return g&&g({type:ActionType.JOIN_LOADING,data:!0}),a(!1),h.join(e).then((t=>{T({video:e.video,audio:e.audio,showSubject:e.showSubject,showMeetingRemainingTip:!!e.showMeetingRemainingTip})})).catch((t=>{var r;return t.data&&(null===(r=t.data.message)||void 0===r?void 0:r.includes("mediaDevices is not support"))?(Toast.info("mediaDevices is not support"),T({video:null==e?void 0:e.video,audio:null==e?void 0:e.audio,showSubject:null==e?void 0:e.showSubject,showMeetingRemainingTip:!!e.showMeetingRemainingTip}),Promise.resolve()):(_(t,e),Promise.reject(t))}))},E=e=>{if(!e.meetingId&&!e.meetingNum)throw Toast.info("请输入会议号"),new Error("meetingId is empty");return g&&g({type:ActionType.JOIN_LOADING,data:!0}),a(!0),h.anonymousJoin(e).then((t=>{if([-101,-102].includes(null==t?void 0:t.code))throw t;T({video:e.video,audio:e.audio,showSubject:e.showSubject,showMeetingRemainingTip:!!e.showMeetingRemainingTip})})).catch((t=>{var r,n;return t.data&&((null===(r=t.data.message)||void 0===r?void 0:r.includes("mediaDevices is not support"))||(null===(n=t.data.message)||void 0===n?void 0:n.includes("getDevices")))?(Toast.info("mediaDevices is not support"),T({video:null==e?void 0:e.video,audio:null==e?void 0:e.audio,showSubject:null==e?void 0:e.showSubject,showMeetingRemainingTip:!!e.showMeetingRemainingTip}),Promise.resolve()):(_(t,e),Promise.reject(t))}))};return jsxRuntime.exports.jsx(jsxRuntime.exports.Fragment,{children:jsxRuntime.exports.jsx(Dialog,Object.assign({visible:t,title:"会议密码",confirmText:"加入会议",cancelText:"取消",onCancel:()=>{M()},onConfirm:()=>{!function(){if(!n.trim())return void d("请输入正确的会议密码");const e=Object.assign(Object.assign({},c),{password:n});console.log(e,"joinOption"),r(!1),s?null==f||f.emit(UserEventType.AnonymousJoinMeeting,{options:e}):null==f||f.emit(UserEventType.JoinMeeting,{options:e})}()}},{children:jsxRuntime.exports.jsxs("div",Object.assign({style:{minHeight:80,paddingTop:10}},{children:[jsxRuntime.exports.jsx("input",{style:{border:l?"1px solid red":"none"},className:"input-ele",placeholder:"请输入会议密码",maxLength:20,value:n.replace(/[^\d]/g,""),required:!0,onChange:e=>{let t=e.target.value;t=t.replace(/[^\d]/g,""),i(t),o.current=t}}),l?jsxRuntime.exports.jsx("div",Object.assign({style:{color:"#ff3141",marginTop:10,fontSize:12}},{children:l})):""]}))}))})},eventEmitter=new Eventemitter,outEventEmitter=new Eventemitter,roomkit=new ve,joinLoading=void 0;function loadAsyncScript(e,t){const r=document.createElement("script");r.type="text/javascript",r.readyState?r.onreadystatechange=function(){"complete"!==r.readyState&&"loaded"!==r.readyState||t&&t()}:r.onload=function(){t&&t()},r.src=e,document.head.appendChild(r)}const render=(e,t,r)=>__awaiter$2(void 0,void 0,void 0,(function*(){const n=t.neMeeting;let i;yield n.init(Object.assign(Object.assign({},t),{appKey:t.appKey,meetingServerDomain:t.meetingServerDomain}));try{i=yield n.getGlobalConfig()}catch(e){console.warn("getGlobalConfig",e)}ReactDOM.render(jsxRuntime.exports.jsx(GlobalContextProvider,Object.assign({outEventEmitter:outEventEmitter,eventEmitter:eventEmitter,neMeeting:n,joinLoading:joinLoading,globalConfig:i},{children:jsxRuntime.exports.jsxs(MeetingInfoContextProvider,Object.assign({memberList:[],meetingInfo:createMeetingInfoFactory()},{children:[jsxRuntime.exports.jsx(Auth,{renderCallback:r}),jsxRuntime.exports.jsx(App,{width:t.width,height:t.height})]}))})),e)})),NEMeetingKit=new Proxy({view:null,NEMeetingInfo:null,toolBarList:[],moreBarList:[],memberInfo:{},joinMemberInfo:{},remoteMemberList:[],localMember:{},neMeeting:null,isInitialized:!1,login:(e,t)=>{console.log("login",e),eventEmitter.emit(UserEventType.Login,{options:e,callback:t})},logout:e=>{eventEmitter.emit(UserEventType.Logout,{callback:e})},loginWithPassword:(e,t)=>{console.log("loginWithPassword",e),eventEmitter.emit(UserEventType.LoginWithPassword,{options:e,callback:t})},init:(e=0,t=0,r,n)=>{if(NEMeetingKit.isInitialized)return void console.warn("已初始化过");const i=new NEMeetingService({roomkit:roomkit,eventEmitter:eventEmitter});if(NEMeetingKit.neMeeting=i,!r||!r.appKey)throw new Error("init failed: appKey is empty");const o=document.getElementById("ne-web-meeting");if(!o)throw new Error("init failed: not found #ne-web-meeting");NEMeetingKit.view=o,NEMeetingKit.isInitialized=!0,render(o,Object.assign(Object.assign({width:e,height:t,neMeeting:i},r),{appKey:r.appKey,meetingServerDomain:r.meetingServerDomain}),n)},checkSystemRequirements:()=>null==ve?void 0:ve.checkSystemRequirements(),anonymousJoinMeeting:(e,t)=>{eventEmitter.emit(UserEventType.AnonymousJoinMeeting,{options:e,callback:t})},create:(e,t)=>{eventEmitter.emit(UserEventType.CreateMeeting,{options:e,callback:t})},join:(e,t)=>{eventEmitter.emit(UserEventType.JoinMeeting,{options:e,callback:t})},afterLeave:e=>{e&&eventEmitter.emit(UserEventType.SetLeaveCallback,{callback:e})},destroy:()=>{console.log("destroy"),eventEmitter.emit("destroy"),NEMeetingKit.view&&ReactDOM.unmountComponentAtNode(NEMeetingKit.view),NEMeetingKit.view=null,NEMeetingKit.neMeeting=null,NEMeetingKit.isInitialized=!1,outEventEmitter.removeAllListeners()},on:(e,t)=>{outEventEmitter.on(e,t)},off:(e,t)=>{if(!e)throw new Error("please add your eventName when you use off");t?outEventEmitter.off(e,t):outEventEmitter.off(e)},uploadLog:(e,t)=>Promise.resolve([]),downloadLog:(e,t)=>Promise.resolve()},{get:function(e,t){var r,n,i,o,s,a,c,u,l;switch(t){case"memberInfo":let d=null;const p=null===(n=null===(r=NEMeetingKit.neMeeting)||void 0===r?void 0:r.roomContext)||void 0===n?void 0:n.localMember;return p&&(d=Object.assign(Object.assign({},p),{role:null===(i=p.role)||void 0===i?void 0:i.name})),d;case"joinMemberInfo":const m=null===(s=null===(o=NEMeetingKit.neMeeting)||void 0===o?void 0:o.roomContext)||void 0===s?void 0:s.remoteMembers,f=null===(c=null===(a=NEMeetingKit.neMeeting)||void 0===a?void 0:a.roomContext)||void 0===c?void 0:c.localMember,h={};return m&&Array.isArray(m)&&m.forEach((e=>{var t;(e.isInRtcChannel||e.uuid===(null==f?void 0:f.uuid))&&(h[e.uuid]=Object.assign(Object.assign({},e),{role:null===(t=e.role)||void 0===t?void 0:t.name}))})),f&&(h[f.uuid]=Object.assign(Object.assign({},f),{role:null===(u=f.role)||void 0===u?void 0:u.name})),h;case"meetingInfo":case"NEMeetingInfo":{const e=null===(l=NEMeetingKit.neMeeting)||void 0===l?void 0:l.getMeetingInfo();if(e){const{meetingInfo:t}=e;return{isHost:!!t.hostUuid&&t.hostUuid===t.localMember.uuid,isLocked:t.isLocked,meetingId:t.meetingId,meetingNum:t.meetingNum,password:t.password,shortMeetingNum:t.shortMeetingNum,sipId:t.sipCid}}return{}}default:return e[t]}}});loadAsyncScript("//at.alicdn.com/t/font_2183559_zbxov2d0djl.js");var index={actions:NEMeetingKit};return index}));
